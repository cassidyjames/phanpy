{"version":3,"file":"compose-8ZaO0ddO.js","sources":["../../src/compose.jsx"],"sourcesContent":["import './index.css';\nimport './app.css';\nimport './polyfills';\n\nimport { i18n } from '@lingui/core';\nimport { I18nProvider } from '@lingui/react';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { render } from 'preact';\nimport { useEffect, useState } from 'preact/hooks';\n\nimport ComposeSuspense from './components/compose-suspense';\nimport { IconSpriteProvider } from './components/icon-sprite-manager';\nimport Loader from './components/loader';\nimport { initActivateLang } from './utils/lang';\nimport { initPWAViewport } from './utils/pwa-viewport';\nimport { initStates } from './utils/states';\nimport { getCurrentAccount } from './utils/store-utils';\nimport useTitle from './utils/useTitle';\n\ninitActivateLang();\ninitPWAViewport();\n\nif (window.opener) {\n  console = window.opener.console;\n}\n\nfunction App() {\n  const { t } = useLingui();\n  const [uiState, setUIState] = useState('default');\n  const [isLoggedIn, setIsLoggedIn] = useState(null);\n\n  const { editStatus, replyToStatus, draftStatus, quoteStatus } =\n    window.__COMPOSE__ || {};\n\n  useTitle(\n    editStatus\n      ? t`Editing source status`\n      : replyToStatus\n        ? t`Replying to @${\n            replyToStatus.account?.acct || replyToStatus.account?.username\n          }`\n        : t`Compose`,\n  );\n\n  useEffect(() => {\n    const account = getCurrentAccount();\n    setIsLoggedIn(!!account);\n    if (account) {\n      initStates();\n    }\n  }, []);\n\n  useEffect(() => {\n    if (uiState === 'closed') {\n      try {\n        // Focus parent window\n        window.opener.focus();\n      } catch (e) {}\n      window.close();\n    }\n  }, [uiState]);\n\n  if (uiState === 'closed') {\n    return (\n      <div class=\"box\">\n        <p>\n          <Trans>You may close this page now.</Trans>\n        </p>\n        <p>\n          <button\n            onClick={() => {\n              window.close();\n            }}\n          >\n            <Trans>Close window</Trans>\n          </button>\n        </p>\n      </div>\n    );\n  }\n\n  console.debug('OPEN COMPOSE');\n\n  if (isLoggedIn === false) {\n    return (\n      <div class=\"box\">\n        <h1>\n          <Trans>Error</Trans>\n        </h1>\n        <p>\n          <Trans>Login required.</Trans>\n        </p>\n        <p>\n          <a href=\"/\">\n            <Trans>Go home</Trans>\n          </a>\n        </p>\n      </div>\n    );\n  }\n\n  if (isLoggedIn) {\n    return (\n      <ComposeSuspense\n        editStatus={editStatus}\n        replyToStatus={replyToStatus}\n        draftStatus={draftStatus}\n        quoteStatus={quoteStatus}\n        standalone\n        hasOpener={window.opener}\n        onClose={(results) => {\n          const { newStatus, fn = () => {} } = results || {};\n          try {\n            if (newStatus) {\n              window.opener.__STATES__.reloadStatusPage++;\n            }\n            fn();\n            setUIState('closed');\n          } catch (e) {}\n        }}\n      />\n    );\n  }\n\n  return (\n    <div class=\"box\">\n      <Loader />\n    </div>\n  );\n}\n\nrender(\n  <I18nProvider i18n={i18n}>\n    <IconSpriteProvider>\n      <App />\n    </IconSpriteProvider>\n  </I18nProvider>,\n  document.getElementById('app-standalone'),\n);\n"],"names":["initActivateLang","initPWAViewport","window","opener","console","App","t","_useLingui","uiState","setUIState","useState","isLoggedIn","setIsLoggedIn","editStatus","replyToStatus","draftStatus","quoteStatus","__COMPOSE__","useTitle","_t","id","values","0","account","acct","username","useEffect","getCurrentAccount","initStates","focus","close","_jsxs","class","children","_jsx","_Trans","onClick","href","standalone","hasOpener","newStatus","fn","results","Loader","render","I18nProvider","i18n","IconSpriteProvider"],"mappings":"0JAmBAA,EAAAA,EACAC,EAAAA,EAEIC,OAAOC,SACTC,QAAUF,OAAOC,OAAOC,SAG1B,SAASC,GAAM,CACb,KAAM,CAAEC,EAAAA,CAAAA,EAAGC,EAAAA,EACL,CAACC,EAASC,CAAU,EAAIC,EAAS,SAAS,EAC1C,CAACC,EAAYC,CAAa,EAAIF,EAAS,IAAI,EAE3C,CAAEG,WAAAA,EAAYC,cAAAA,EAAeC,YAAAA,EAAaC,YAAAA,CAAAA,EAC9Cd,OAAOe,aAAe,CAAA,EA8BxB,OA5BAC,EACYC,EAAVN,EACI,CAAAO,GAAA,QAAA,EACAN,EACE,CAAAM,GAAA,SAAAC,OAAA,CAAAC,EACER,EAAcS,SAASC,MAAQV,EAAcS,SAASE,QAAAA,CAAQ,EAEhE,CAAAL,GAAA,QAAA,CALqB,CAM7B,EAEAM,EAAU,IAAM,CACd,MAAMH,EAAUI,EAAAA,EAChBf,EAAc,CAAC,CAACW,CAAO,EACnBA,GACFK,EAAAA,CAEJ,EAAG,CAAA,CAAE,EAELF,EAAU,IAAM,CACd,GAAIlB,IAAY,SAAU,CACxB,GAAI,CAEFN,OAAOC,OAAO0B,MAAAA,CAChB,MAAY,CAAC,CACb3B,OAAO4B,MAAAA,CACT,CACF,EAAG,CAACtB,CAAO,CAAC,EAERA,IAAY,SAEZuB,EAAA,MAAA,CAAKC,MAAM,MAAKC,UACdC,EAAA,IAAA,CAAAD,SACEC,EAAAC,EAAA,CAAAf,GAAA,QAAA,CAA0C,CAAA,CACzC,EACHc,EAAA,IAAA,CAAAD,SACEC,EAAA,SAAA,CACEE,QAASA,IAAM,CACblC,OAAO4B,MAAAA,CACT,EAAEG,SAEFC,EAAAC,EAAA,CAAAf,GAAA,QAAA,CAA0B,CAAA,CACpB,CAAA,CACP,CAAC,CAAA,CACD,EAIThB,IAAc,WAEK,CACjB,YACO4B,SAAM,CAAAE,EAAA,KAAA,CAAKD,SACdC,EAAAC,EAAA,CAAAF,GAAAA,QACE,CAAA,CAAA,CAAA,EAAmBC,EAAA,IAAA,CACjB,SACJA,EAAAC,EAAA,CAAAF,GAAAA,QACE,CAAA,CAAA,CAAA,EAA6BC,EAAA,IAAA,CAC5B,SACHA,EAAA,IAAA,CAAAD,KAAAA,IACKI,SAAKH,EAAAC,EAAA,CAAGF,GAAAA,QACT,CAAA,CAAA,CAAA,CAAqB,CAAA,CAAC,CACrB,CAAA,EAIXtB,EAEIA,EAAAA,EAAY,CACd,WAAAE,EAEIA,cAAAA,EACAC,YAAAA,EACAC,YAAAA,EACAC,WAAAA,GACAsB,UAAAA,OAAU,OACVC,WAAkBpC,OAEhB,UAAAqC,EAAQA,GAAAA,EAAAA,IAAAA,CAAWC,CAAW,EAACC,GAAA,CAAA,EAAE,GAAIA,CACjCF,GACF,OAAIA,OAAW,WAAA,mBAEfC,EAAA,EACAA,EAAG,QAAA,CACHhC,MAAAA,CACF,CAAY,CAAC,CAAA,EAIrByB,EAAA,MAAA,CAEA,YACOF,SAAME,EAAAS,EAAA,CAAA,CAAA,CAAA,CAAA,CACA,CAGfC,EAAAV,EAAAW,EAAA,CAEAD,KAAAA,EACgBE,SAAAA,EAAAA,EAAAA,CAAWb,WACtBc,EAAAA,CAAAA,CAAAA,CAAkB,CAAA,CACX,CAAA,EACY,SAAA,eAAA,gBAAA,CAAA"}