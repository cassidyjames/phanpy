import{a as B,s as v,b as Ie,u as mn,o as Jn,I as w,M as ge,c as Z,A as Ge,N as vt,d as Ne,L as W,g as tt,e as gn,l as Xn,t as Wt,f as de,R as Tt,h as Zn,p as nt,i as Fe,j as bn,k as Mt,E as yn,m as Pe,n as qe,q as Qn,r as ve,v as Kt,T as wn,w as ot,x as vn,y as Yt,z as es,B as xe,C as ts,S as Te,D as ns,F as ss,G as Sn,H as kn,J as zt,K as $e,O as In,P as is,Q as os,U as cs,V as ht,W as as,X as Jt,Y as rs,Z as Xt,_ as Zt}from"./useTitle-5ed37b88.js";import{_ as E,p as N,x as Ve,h as C,c as St,u as Ce,o as e,a as ue,k as $,s as Ct,b as Tn,M as Ke,d as te,e as De,f as st,F as me,T as We,S as ls,I as it,y as ze,g as Cn,l as Qt,i as $n,j as xn,m as ds,n as Be,A as us,q as hs,J as fs,C as Ln,r as Ye,t as ps,v as ms,w as at,z as Rn,B as en,D as gs,E as bs,R as Bt,G as we,H as ys,K as ws}from"./vendor-07e2fc23.js";function kt(t=()=>{},n=[]){const a=E(t);N(()=>{a.current=t},[n]),N(()=>{const o=()=>{const i=document.hidden||document.visibilityState==="hidden";a.current(!i)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[])}const vs=Ve(function({isLoggedIn:n}){const[a,o]=C(!0);kt(o);const i=E(),s=St(()=>{const{masto:h,streaming:u,instance:r}=B();(async()=>{var f;if(v.notificationsLast){const b=h.v1.notifications.list({limit:1,since_id:v.notificationsLast.id}),{value:c}=await b.next();if(c!=null&&c.length){let m;try{const p=await h.v1.markers.fetch({timeline:"notifications"});m=(f=p==null?void 0:p.notifications)==null?void 0:f.lastReadId}catch{}m?v.notificationsShowNew=c[0].id!==m:v.notificationsShowNew=!0}}if(u){let b=i.current=u.user.notification.subscribe();for await(const c of b){if(!b)break;c.event==="notification"&&Ie(c.payload,r,{skipThreading:!0}),v.notificationsShowNew=!0}}})()},3e3);N(()=>(n&&a&&s(),()=>{var h,u,r;(h=s==null?void 0:s.cancel)==null||h.call(s),(r=(u=i.current)==null?void 0:u.unsubscribe)==null||r.call(u),i.current=null}),[a,n]);const l=E(),d=()=>{l.current=Date.now(),fetch("./version.json").then(h=>h.json()).then(h=>{h&&(v.appVersion=h)}).catch(h=>{})};return mn(d,a&&1e3*60*30),kt(h=>{h&&(l.current?Date.now()-l.current>1e3*60*60&&d():d())}),null});function Ss(){function t(n){n.shiftKey?Jn()||(alert("Looks like your browser is blocking popups."),v.showCompose=!0):v.showCompose=!0}return Ce("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const ks=Ve(function(){const n=ue(v);function a(){v.showKeyboardShortcutsHelp=!1}Ce("?, shift+?",i=>{v.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")});const o=Ce("esc",a,[]);return!!n.showKeyboardShortcutsHelp&&e(ge,{class:"light",onClick:i=>{i.target===i.currentTarget&&a()},children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:o,children:[e("button",{type:"button",class:"sheet-close",onClick:a,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e($,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e($,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e($,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e($,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e($,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Send post",keys:e($,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Favourite",keys:e("kbd",{children:"f"})},{action:"Boost",keys:e($,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})}].map(({action:i,keys:s})=>e("tr",{children:[e("th",{children:i}),e("td",{children:s})]},i))})})]})})});function Is({onClose:t}){const{masto:n}=B(),a=Z.local.getJSON("accounts"),o=Z.session.get("currentAccount"),i=a.length>1,[s,l]=Ct(h=>h+1,0),[d]=Tn();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:d,children:a.map((h,u)=>{const r=h.info.id===o,f=u===0;return e("li",{children:[e("div",{children:[i&&e("span",{class:`current ${r?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(Ge,{url:h.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(r)try{const b=await n.v1.accounts.$select(h.info.id).fetch();h.info=b,Z.local.setJSON("accounts",a),l()}catch{}}}),e(vt,{account:i?{...h.info,acct:/@/.test(h.info.acct)?h.info.acct:`${h.info.acct}@${h.instanceURL}`}:h.info,showAcct:!0,onClick:()=>{r?v.showAccount=`${h.info.username}@${h.instanceURL}`:(Z.session.set("currentAccount",h.info.id),location.reload())}})]}),e("div",{class:"actions",children:[f&&i&&e($,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Ke,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(te,{onClick:()=>{v.showAccount=`${h.info.username}@${h.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(De,{}),i&&e(te,{disabled:f,onClick:()=>{a.splice(u,1),a.unshift(h),Z.local.setJSON("accounts",a),l()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Ne,{subMenu:!0,confirmLabel:e($,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",h.info.acct,"?"]})]}),disabled:!r,menuItemClassName:"danger",onClick:()=>{a.splice(u,1),Z.local.setJSON("accounts",a),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},h.info.id)})}),e("p",{children:e(W,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),i&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const An=""+new URL("logo-f0531a6b.svg",import.meta.url).href;function tn(t){const{masto:n}=B();return n.v1.push.subscription.create(t)}function Ts(){const{masto:t}=B();return t.v1.push.subscription.fetch()}function Cs(t){const{masto:n}=B();return n.v1.push.subscription.update(t)}function $s(){const{masto:t}=B();return t.v1.push.subscription.remove()}function $t(){return"serviceWorker"in navigator&&"PushManager"in window}function Mn(){return navigator.serviceWorker.getRegistration()}async function Ot(){const t=await Mn(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Dn(t){const n="=".repeat((4-t.length%4)%4),a=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(a),i=new Uint8Array(o.length);for(let s=0;s<o.length;++s)i[s]=o.charCodeAt(s);return i}async function xs(){if(!$t())return;const{subscription:t}=await Ot();let n=null;try{n=await Ts()}catch(a){if(!/(not found|unknown)/i.test(a.message))throw a}if(n&&t){const a=n.endpoint===t.endpoint,{vapidKey:o}=tt(),i=n.serverKey===o;if(!a)throw new Error("Backend subscription endpoint changed");if(!i)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:a}=tt(),{applicationServerKey:o}=t.options,i=Dn(a).toString(),s=new Uint8Array(o).toString();if(!(i===s))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function nn({data:t,policy:n}){if(!$t())return;let{registration:a,subscription:o}=await Ot(),i=null;if(o)try{i=await Cs({data:t,policy:n})}catch{i=await tn({subscription:o,data:t,policy:n})}else{const{vapidKey:s}=tt();if(!s)throw new Error("No server key found");o=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Dn(s)}),i=await tn({subscription:o,data:t,policy:n})}return{subscription:o,backendSubscription:i}}async function sn(){if(!$t())return;const{subscription:t}=await Ot();t&&(await $s(),await t.unsubscribe())}const on=16,je=[16,17,18,19,20];function Ls({onClose:t}){const n=ue(v),a=Z.local.get("theme")||"auto",o=E(),i=n.settings.contentTranslationTargetLanguage||null,s=gn(),l=Xn(s),d=Z.local.get("textSize")||on,[h,u]=C(Z.account.get("preferences")||{}),{masto:r,authenticated:f,instance:b}=B();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:o,onInput:c=>{c.preventDefault();const p=new FormData(o.current).get("theme"),y=document.documentElement;p==="auto"?y.classList.remove("is-light","is-dark"):(y.classList.toggle("is-light",p==="light"),y.classList.toggle("is-dark",p==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",p==="auto"?"dark light":p),p==="auto"?Z.local.del("theme"):Z.local.set("theme",p)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:a==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:a==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:a!=="light"&&a!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:je[0]},children:"A"})," ",e("input",{type:"range",min:je[0],max:je[je.length-1],step:"1",value:d,list:"sizes",onChange:c=>{const m=parseInt(c.target.value,10);document.documentElement.style.setProperty("--text-size",`${m}px`),m===on?Z.local.del("textSize"):Z.local.set("textSize",c.target.value)}})," ",e("span",{style:{fontSize:je[je.length-1]},children:"A"}),e("datalist",{id:"sizes",children:je.map(c=>e("option",{value:c}))})]})]})]})}),f&&e($,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:h["posting:default:visibility"]||"public",onChange:c=>{const{value:m}=c.target;(async()=>{try{await r.v1.accounts.updateCredentials({source:{privacy:m}}),u({...h,"posting:default:visibility":m}),Z.account.set("preferences",{...h,"posting:default:visibility":m})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${b}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",b,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:c=>{v.settings.autoRefresh=c.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:c=>{v.settings.boostsCarousel=c.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:c=>{const{checked:m}=c.target;v.settings.contentTranslation=m,m||(v.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:i||"",disabled:!n.settings.contentTranslation,onChange:c=>{v.settings.contentTranslationTargetLanguage=c.target.value||null},children:[e("option",{value:"",children:["System language (",l,")"]}),e("option",{disabled:!0,children:"──────────"}),Wt.map(c=>e("option",{value:c.code,children:c.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e($,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Wt.map(c=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(c.code),onChange:m=>{const{checked:p}=m.target;p?v.settings.contentTranslationHideLanguages.push(c.code):v.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(y=>y!==c.code)}})," ",c.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses an external API to translate, powered by"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:c=>{v.settings.contentTranslationAutoInline=c.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:c=>{v.settings.cloakMode=c.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),f&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{v.showDrafts=!0,v.showSettings=!1},children:"Unsent drafts"})})]})}),f&&e(Rs,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:An,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:c=>{c.preventDefault(),v.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:c=>{c.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:["Version:"," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2023-10-24T15:31:24.812Z".slice(0,10).replace(/-/g,".")}.45b250b`,onClick:c=>{c.target.select();try{navigator.clipboard.writeText(c.target.value),de("Version string copied")}catch{de("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/45b250b",target:"_blank",rel:"noopener noreferrer",children:e(Tt,{datetime:new Date("2023-10-24T15:31:24.812Z")})}),")"]})]})]})]})]})}function Rs({onClose:t}){if(!$t())return null;const{instance:n}=B(),[a,o]=C("default"),i=E(),[s,l]=C(!1),[d,h]=C(!1),u=E();N(()=>{(async()=>{o("loading");try{const{subscription:f,backendSubscription:b}=await xs();if(b!=null&&b.policy&&b.policy!=="none"){l(!0);const{alerts:c,policy:m}=b;u.current=m;const{elements:p}=i.current,y=p.namedItem(m);y&&(y.value=m),Object.keys(c).forEach(g=>{const S=p.namedItem(g);(S==null?void 0:S.type)==="checkbox"&&(S.checked=!0)})}o("default")}catch(f){/outside.*authorized/i.test(f.message)?h(!0):alert((f==null?void 0:f.message)||f),o("error")}})()},[]);const r=a==="loading";return e("form",{ref:i,onChange:()=>{const f=Object.fromEntries(new FormData(i.current)),b=!!f["policy-allow"],c={policy:f.policy,data:{alerts:{mention:!!f.mention,favourite:!!f.favourite,reblog:!!f.reblog,follow:!!f.follow,follow_request:!!f.followRequest,poll:!!f.poll,update:!!f.update,status:!!f.status}}};let m=0;Object.keys(c.data.alerts).forEach(y=>{c.data.alerts[y]?m++:delete c.data.alerts[y]});const p=u.current!==c.policy;b&&m>0?p?sn().then(()=>{nn(c)}).catch(y=>{alert("Failed to update subscription. Please try again.")}):nn(c).catch(y=>{alert("Failed to update subscription. Please try again.")}):sn().catch(y=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:r||d,name:"policy-allow",checked:s,onChange:async f=>{const{checked:b}=f.target;if(b){const c=await Notification.requestPermission();c==="granted"?l(!0):(l(!1),c==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else l(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:r||d||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(f=>e("option",{value:f.value,children:f.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Favourites"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(f=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:f.value})," ",f.label]})}))})})})}),d&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(W,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const Dt=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const a=document.querySelectorAll("#modal-container > *");if(a!=null&&a.length){const l=a[a.length-1],d=l.querySelector('[tabindex="-1"]')||l;if(d){d.focus();return}}if(document.querySelector(".deck-backdrop"))return;const i=document.querySelectorAll(".deck-container"),s=i[i.length-1];s&&s.tabIndex===-1&&s.focus()}},100);return()=>clearTimeout(t)};function En(t){if(!t)return;const n=st(),a=E(n.pathname);N(()=>{a.current&&n.pathname!==a.current&&(t==null||t())},[n.pathname,t])}function qt({list:t,onClose:n}){const{masto:a}=B(),[o,i]=C("default"),s=!!t,l=E(),d=E(),h=E();N(()=>{s&&(l.current.value=t.title,d.current.value=t.repliesPolicy,h.current&&(h.current.checked=t.exclusive))},[s]);const u=Zn("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:s?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:r=>{r.preventDefault();const f=new FormData(r.target),b=f.get("title"),c=f.get("replies_policy"),m=f.get("exclusive")==="on";i("loading"),(async()=>{try{let p;s?p=await a.v1.lists.$select(t.id).update({title:b,replies_policy:c,exclusive:m}):p=await a.v1.lists.create({title:b,replies_policy:c,exclusive:m}),i("default"),n==null||n({state:"success",list:p})}catch{i("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:l,type:"text",id:"list-title",name:"title",required:!0,disabled:o==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:d,name:"replies_policy",required:!0,disabled:o==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),u&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:h,type:"checkbox",name:"exclusive",disabled:o==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:o==="loading",children:s?"Save":"Create"}),s&&e(Ne,{disabled:o==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{i("loading"),(async()=>{try{await a.v1.lists.$select(t.id).remove(),i("default"),n==null||n({state:"deleted"})}catch{i("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete…"})})]})]})})]})}const As=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],cn={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},an=80,_n=1e3*60*10;function Ms(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Ds=nt(Ms,{maxAge:_n});async function Es(t,n){const a=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:o}=await a,i={total:o.length,originals:0,replies:0,boosts:0};return o.forEach(s=>{s.reblog?i.boosts++:s.inReplyToId&&s.inReplyToAccountId!==s.account.id?i.replies++:i.originals++}),o.length&&(i.daysSinceLastPost=Math.ceil((Date.now()-new Date(o[o.length-1].createdAt))/864e5)),i}const _s=nt(Es,{maxAge:_n});function Pn({account:t,fetchAccount:n=()=>{},standalone:a,instance:o,authenticated:i}){const{masto:s}=B({instance:o}),{masto:l}=B(),[d,h]=C("default"),u=typeof t=="string",[r,f]=C(u?null:t),b=me(()=>t.id===Z.session.get("currentAccount"),[t==null?void 0:t.id]),c=me(()=>o===B().instance,[o]);N(()=>{if(!u){f(t);return}h("loading"),(async()=>{try{const U=await n();v.accounts[`${U.id}@${o}`]=U,f(U),h("default")}catch{f(null),h("error")}})()},[u,t,n]);const{acct:m,avatar:p,avatarStatic:y,bot:g,createdAt:S,displayName:k,emojis:I,fields:x,followersCount:_,followingCount:D,group:M,id:H,lastStatusAt:ne,locked:L,note:F,statusesCount:J,url:ie,username:Ae,memorial:G,moved:oe,roles:V}=r||{};let A=!1,{header:O,headerStatic:K}=r||{};(!O||/missing\.png$/.test(O))&&p&&!/missing\.png$/.test(p)&&(O=p,A=!0,y&&!/missing\.png$/.test(y)&&(K=y));const ae=me(()=>ie?new URL(ie).hostname:null,[ie]),[Se,Le]=C([]),re=E(),z=E([]);async function X(U){(U||!re.current)&&(re.current=s.v1.accounts.$select(H).followers.list({limit:an}));const le=await re.current.next();if(b||!c)return le;const{value:be}=le;let ye=[];if(U){const _e=await s.v1.accounts.familiarFollowers.fetch({id:[H]});z.current=_e[0].accounts,ye=[...z.current,...be.filter(Ue=>!z.current.some(Me=>Me.id===Ue.id))]}else be!=null&&be.length&&(ye=be.filter(_e=>!z.current.some(Ue=>Ue.id===_e.id)));return{...le,value:ye}}const Y=E();async function ce(U){return(U||!Y.current)&&(Y.current=s.v1.accounts.$select(H).following.list({limit:an})),await Y.current.next()}const Q=a?"div":W,T=o?`/${o}/a/${H}`:`/a/${H}`,[R,q]=C([]),[P,ee]=C(),[ke,se]=C("default"),he=!!(P!=null&&P.total),Re=async U=>{try{const le=await Ds(U,l);q(le[0].accounts.slice(0,Ps))}catch{}},fe=async()=>{if(H){se("loading");try{const U=await _s(H,s);ee(U),se("default")}catch{se("error")}}},Ee=We(({relationship:U,currentID:le})=>{U.following||(Re(le),a||fe())},[a,H]);return e("div",{class:`account-container  ${d==="loading"?"skeleton":""}`,style:{"--header-color-1":Se[0],"--header-color-2":Se[1],"--header-color-3":Se[2],"--header-color-4":Se[3]},children:[d==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:u?t:ie,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),d==="loading"?e($,{children:[e("header",{children:e(Fe,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):r&&e($,{children:[!!oe&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:k})," has indicated that their new account is now:"]}),e(Fe,{account:oe,instance:o,onClick:U=>{U.stopPropagation(),v.showAccount=oe}})]}),O&&!/missing\.png$/.test(O)&&e("img",{src:O,alt:"",class:`header-banner ${A?"header-is-avatar":""}`,onError:U=>{U.target.crossOrigin?U.target.src!==K?U.target.src=K:(U.target.removeAttribute("crossorigin"),U.target.src=O):U.target.src!==K?U.target.src=K:U.target.remove()},crossOrigin:"anonymous",onLoad:U=>{U.target.classList.add("loaded");try{const le=document.createElement("canvas"),be=le.getContext("2d",{willReadFrequently:!0});le.width=U.target.width,le.height=U.target.height,be.drawImage(U.target,0,0);const ye=10,Ue=[be.getImageData(0,0,ye,ye).data,be.getImageData(U.target.width-ye,0,ye,ye).data,be.getImageData(0,U.target.height-ye,ye,ye).data,be.getImageData(U.target.width-ye,U.target.height-ye,ye,ye).data].map(Me=>{let j=0,pe=0,Je=0,dt=0;for(let Xe=0;Xe<Me.length;Xe+=4)j+=Me[Xe],pe+=Me[Xe+1],Je+=Me[Xe+2],dt+=Me[Xe+3];const ut=Me.length/4;return[j/ut,pe/ut,Je/ut,dt/ut]}).map(Me=>{const[j,pe,Je,dt]=Us(Me);return`rgba(${j}, ${pe}, ${Je}, ${dt})`});Le(Ue)}catch{}}}),e("header",{children:e(Fe,{account:r,instance:o,avatarSize:"xxxl",external:a,internal:!a})}),e("main",{tabIndex:"-1",children:[!!G&&e("span",{class:"tag",children:"In Memoriam"}),!!g&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!M&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),V==null?void 0:V.map(U=>e("span",{class:"tag",children:[U.name,!!ae&&e($,{children:[" ",e("span",{class:"more-insignificant",children:ae})]})]})),e("div",{class:"note",dir:"auto",onClick:bn({instance:o}),dangerouslySetInnerHTML:{__html:Mt(F,{emojis:I})}}),e("div",{class:"account-metadata-box",children:[(x==null?void 0:x.length)>0&&e("div",{class:"profile-metadata",children:x.map(({name:U,value:le,verifiedAt:be},ye)=>e("div",{class:`profile-field ${be?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(yn,{text:U,emojis:I})," ",!!be&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:Mt(le,{emojis:I})}})]},U+ye))}),e("div",{class:"stats",children:[e(Q,{tabIndex:0,to:T,onClick:()=>{setTimeout(()=>{v.showGenericAccounts={heading:"Followers",fetchAccounts:X}},0)},children:[!!R.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:R.map(U=>e(Ge,{url:U.avatarStatic,size:"s",alt:`${U.displayName} @${U.acct}`,squircle:U==null?void 0:U.bot}))})}),e("span",{title:_,children:Pe(_)})," ","Followers"]}),e(Q,{class:"insignificant",tabIndex:0,to:T,onClick:()=>{setTimeout(()=>{v.showGenericAccounts={heading:"Following",fetchAccounts:ce}},0)},children:[e("span",{title:D,children:Pe(D)})," ","Following",e("br",{})]}),e(Q,{class:"insignificant",to:T,children:[e("span",{title:J,children:Pe(J)})," ","Posts"]}),!!S&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:S,children:qe(S,{hideTime:!0})})]})]})]}),!!P&&e(Q,{to:T,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:he?e("div",{class:"posting-stats",title:`${Math.round(P.originals/P.total*100)}% original posts, ${Math.round(P.replies/P.total*100)}% replies, ${Math.round(P.boosts/P.total*100)}% boosts`,children:[e("div",{children:P.daysSinceLastPost<365?`Last ${P.total} post${P.total>1?"s":""} in the past 
                      ${P.daysSinceLastPost} day${P.daysSinceLastPost>1?"s":""}`:`
                      Last ${P.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${P.originals/P.total*100}%`,"--replies-percentage":`${(P.originals+P.replies)/P.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!P,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:ke==="loading",onClick:()=>{fe()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${ke==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})}),e(Ns,{info:r,instance:o,authenticated:i,onRelationshipChange:Ee})]})]})]})}const Ps=3;function Ns({info:t,instance:n,authenticated:a,onRelationshipChange:o=()=>{}}){var Q;if(!t)return null;const{masto:i,instance:s,authenticated:l}=B(),d=n===s,[h,u]=C("default"),[r,f]=C(null),{id:b,acct:c,url:m,username:p,locked:y,lastStatusAt:g,note:S,fields:k,moved:I}=t,x=E(b),{following:_,showingReblogs:D,notifying:M,followedBy:H,blocking:ne,blockedBy:L,muting:F,mutingNotifications:J,requested:ie,domainBlocking:Ae,endorsed:G,note:oe}=r||{},[V,A]=C(null),[O,K]=C(!1);N(()=>{if(t){const T=Z.session.get("currentAccount");let R;(async()=>{if(d&&a)R=b;else if(!d&&l){const P=t.acct.includes("@");try{const ee=await i.v2.search.fetch({q:P?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});ee.accounts.length&&(R=ee.accounts[0].id,A(ee.accounts[0]))}catch{}}if(!R)return;if(T===R){K(!0);return}if(x.current=R,I)return;u("loading");const q=i.v1.accounts.relationships.fetch({id:[R]});try{const P=await q;if(u("default"),P.length){const ee=P[0];f(ee),o({relationship:ee,currentID:R})}}catch{u("error")}})()}},[t,a]),N(()=>{t&&O&&Qn(t)},[t,O]);const ae=h==="loading",Se=E(null),[Le,re]=C(!1),[z,X]=C(!1),[Y,ce]=C(!1);return e($,{children:[e("div",{class:"actions",children:[e("span",{children:[H?e("span",{class:"tag",children:"Following you"}):g?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:qe(g,{hideTime:!0})})]}):e("span",{}),F&&e("span",{class:"tag danger",children:"Muted"}),ne&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!oe&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{ce(!0)},dir:"auto",children:e("span",{children:oe})}),e(Ke,{instanceRef:Se,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:T=>{var R,q;T.target===T.currentTarget&&((q=(R=Se.current)==null?void 0:R.closeMenu)==null||q.call(R))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:ae,children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[l&&!O&&e($,{children:[e(te,{onClick:()=>{v.showCompose={draftStatus:{status:`@${(V==null?void 0:V.acct)||c} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",p]})]}),e(te,{onClick:()=>{re(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(te,{onClick:()=>{ce(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:oe?"Edit private note":"Add private note"})]}),_&&e(te,{onClick:()=>{X(!0)},children:[e(w,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(De,{})]}),e(te,{href:m,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:Fs(m)})]}),e("div",{class:"menu-horizontal",children:[e(te,{onClick:()=>{try{navigator.clipboard.writeText(m),de("Link copied")}catch{de("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((Q=navigator==null?void 0:navigator.canShare)==null?void 0:Q.call(navigator,{url:m}))&&e(te,{onClick:()=>{try{navigator.share({url:m})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!r&&e($,{children:[e(De,{}),F?e(te,{onClick:()=>{u("loading"),(async()=>{try{const T=await i.v1.accounts.$select((V==null?void 0:V.id)||b).unmute();f(T),u("default"),de(`Unmuted @${p}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{u("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",p]})]}):e(ls,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e($,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",p,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:As.map(T=>e(te,{onClick:()=>{u("loading"),(async()=>{try{const R=await i.v1.accounts.$select((V==null?void 0:V.id)||b).mute({duration:T});f(R),u("default"),de(`Muted @${p} for ${cn[T]}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{u("error"),de(`Unable to mute @${p}`)}})()},children:cn[T]}))})}),e(Ne,{subMenu:!0,confirm:!ne,confirmLabel:e($,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",p,"?"]})]}),menuItemClassName:"danger",onClick:()=>{u("loading"),(async()=>{try{if(ne){const T=await i.v1.accounts.$select((V==null?void 0:V.id)||b).unblock();f(T),u("default"),de(`Unblocked @${p}`)}else{const T=await i.v1.accounts.$select((V==null?void 0:V.id)||b).block();f(T),u("default"),de(`Blocked @${p}`)}v.reloadGenericAccounts.id="block",v.reloadGenericAccounts.counter++}catch{u("error"),ne?de(`Unable to unblock @${p}`):de(`Unable to block @${p}`)}})()},children:ne?e($,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",p]})]}):e($,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",p,"…"]})]})})]})]}),!r&&h==="loading"&&e(ve,{abrupt:!0}),!!r&&e(Ne,{confirm:_||ie,confirmLabel:e("span",{children:ie?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:ae,onClick:()=>{u("loading"),(async()=>{try{let T;_||ie?T=await i.v1.accounts.$select(x.current).unfollow():T=await i.v1.accounts.$select(x.current).follow(),T&&f(T),u("default")}catch(T){alert(T),u("error")}})()},children:e("button",{type:"button",class:`${_||ie?"light swap":""}`,"data-swap-state":_||ie?"danger":"",disabled:ae,children:_?e($,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):ie?e($,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):y?e($,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!Le&&e(ge,{class:"light",onClose:()=>{re(!1)},children:e(zs,{note:S,fields:k,onClose:()=>re(!1)})}),!!z&&e(ge,{class:"light",onClose:()=>{X(!1)},children:e(Bs,{accountID:x.current,onClose:()=>X(!1)})}),!!Y&&e(ge,{class:"light",onClose:()=>{ce(!1)},children:e(Os,{account:t,note:oe,onRelationshipChange:T=>{f(T)},onClose:()=>ce(!1)})})]})}function Us([t,n,a]){const o=.2126*t+.7152*n+.0722*a;let i;return o>=220?i=1:o<=50?i=.1:i=o/255,i=Math.min(1,i),[t,n,a,i]}function Fs(t){if(!t)return;const n=new URL(t),{host:a,pathname:o}=n,i=o.replace(/\/$/,"").replace(/^\//,"");return e($,{children:[e("span",{class:"more-insignificant",children:[a,"/"]}),e("wbr",{}),e("span",{children:i})]})}function zs({note:t,fields:n,onClose:a}){const o=(n==null?void 0:n.map(({name:s,value:l})=>`${s}
${Kt(l)}`).join(`

`))||"",i=Kt(t)+(o?`

${o}`:"");return e("div",{class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close",onClick:a,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:i}),e(wn,{forceTranslate:!0,text:i})]})]})}function Bs({accountID:t,onClose:n}){const{masto:a}=B(),[o,i]=C("default"),[s,l]=C([]),[d,h]=C([]),[u,r]=Ct(c=>c+1,0);N(()=>{i("loading"),(async()=>{try{const c=await a.v1.lists.list();c.sort((p,y)=>p.title.localeCompare(y.title));const m=await a.v1.accounts.$select(t).lists.list();l(c),h(m),i("default")}catch{i("error")}})()},[u]);const[f,b]=C(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[s.length>0?e("ul",{class:"list-add-remove",children:s.map(c=>{const m=d.some(p=>p.id===c.id);return e("li",{children:e("button",{type:"button",class:`light ${m?"checked":""}`,disabled:o==="loading",onClick:()=>{i("loading"),(async()=>{try{m?await a.v1.lists.$select(c.id).accounts.remove({accountIds:[t]}):await a.v1.lists.$select(c.id).accounts.create({accountIds:[t]}),r()}catch{i("error"),alert(m?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:c.title})]})})})}):o==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):o==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>b(!0),disabled:o!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),f&&e(ge,{class:"light",onClick:c=>{c.target===c.currentTarget&&b(!1)},children:e(qt,{list:f==null?void 0:f.list,onClose:c=>{c.state==="success"&&r(),b(!1)}})})]})}function Os({account:t,note:n,onRelationshipChange:a=()=>{},onClose:o=()=>{}}){const{masto:i}=B(),[s,l]=C("default"),d=E(null);return N(()=>{let h;return d.current&&!n&&(h=setTimeout(()=>{var u,r;(r=(u=d.current).focus)==null||r.call(u)},100)),()=>{clearTimeout(h)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:h=>{h.preventDefault();const r=new FormData(h.target).get("note");(r==null?void 0:r.trim())!==(n==null?void 0:n.trim())&&(l("loading"),(async()=>{try{const f=await i.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:r});l("default"),a(f),o()}catch(f){l("error"),alert((f==null?void 0:f.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:d,name:"note",disabled:s==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:s==="loading",onClick:()=>{o==null||o()},children:"Cancel"}),e("span",{children:[e(ve,{abrupt:!0,hidden:s!=="loading"}),e("button",{disabled:s==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function qs({account:t,instance:n,onClose:a}){const{masto:o,instance:i,authenticated:s}=B({instance:n}),l=typeof t=="string";return N(()=>{l||(v.accounts[`${t.id}@${i}`]=t)},[t]),En(a),e("div",{class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close outer",onClick:a,children:e(w,{icon:"x"})}),e(Pn,{instance:i,authenticated:s,account:t,fetchAccount:async()=>{if(l)try{return await o.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const h=await o.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:s});if(h.accounts.length)return h.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const r=new URL(t).pathname.replace(/^\//,""),f=await o.v2.search.fetch({q:r,type:"accounts",limit:1,resolve:s});if(f.accounts.length)return f.accounts[0]}}else return t}})]})}function Hs({onClose:t}){const{masto:n}=B(),[a,o]=C("default"),[i,s]=C([]),[l,d]=Ct(u=>u+1,0);N(()=>{o("loading"),(async()=>{try{const u=await ot.drafts.keys();if(u.length){const r=vn(),f=u.filter(b=>b.startsWith(r));if(f.length){const b=await ot.drafts.getMany(f);b.sort((c,m)=>new Date(m.updatedAt).getTime()-new Date(c.updatedAt).getTime()),s(b)}else s([])}else s([]);o("default")}catch{o("error")}})()},[l]);const h=(i==null?void 0:i.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(ve,{abrupt:!0,hidden:a!=="loading"})]}),h&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:h?e($,{children:[e("ul",{class:"drafts-list",children:i.map(u=>{const{updatedAt:r,key:f,draftStatus:b,replyTo:c}=u,m=new Date(r);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:c?"reply":"quill",size:"s"})," ",e("time",{children:[!!c&&e($,{children:["@",c.account.acct,e("br",{})]}),qe(m)]})]}),e(Ne,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:a==="loading",onClick:()=>{(async()=>{try{await ot.drafts.del(f),d()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:a==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:a==="loading",class:"draft-item",onClick:async()=>{let p;if(c){o("loading");try{p=await n.v1.statuses.$select(c.id).fetch()}catch{alert("Error fetching reply-to status!"),o("default");return}o("default")}window.__COMPOSE__={draftStatus:b,replyToStatus:p},v.showCompose=!0,v.showDrafts=!1},children:e(Vs,{draft:u})})]},r)})}),i.length>1&&e("p",{children:e(Ne,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:a==="loading",onClick:()=>{(async()=>{o("loading");try{await ot.drafts.delMany(i.map(u=>u.key)),o("default"),d()}catch{alert("Error deleting drafts! Please try again."),o("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:a==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function Vs({draft:t}){var f;const{draftStatus:n,replyTo:a}=t,{status:o,spoilerText:i,poll:s,mediaAttachments:l}=n,d=((f=s==null?void 0:s.options)==null?void 0:f.length)>0,h=(l==null?void 0:l.length)>0,u=d||h,r=me(()=>{if(!h)return;const b=l.find(p=>/image/.test(p.type));if(!b)return;const{file:c}=b;return URL.createObjectURL(c)},[h,l]);return e($,{children:e("div",{class:"mini-draft",children:[u&&e("div",{class:`mini-draft-aside ${r?"has-image":""}`,style:r?{"--bg-image":`url(${r})`}:{},children:[d&&e(w,{icon:"poll"}),h&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:l==null?void 0:l.length})]})]}),e("div",{class:"mini-draft-main",children:[!!i&&e("div",{class:"mini-draft-spoiler",children:i}),!!o&&e("div",{class:"mini-draft-status",children:o})]})]})})}function js({onClose:t=()=>{}}){const n=ue(v),[a,o]=C("default"),[i,s]=C([]),[l,d]=C(!1);if(En(t),!n.showGenericAccounts)return null;const{id:h,heading:u,fetchAccounts:r,accounts:f,showReactions:b}=n.showGenericAccounts,c=m=>{r&&(m&&s([]),o("loading"),(async()=>{try{const{done:p,value:y}=await r(m);Array.isArray(y)?(s(m?y:g=>[...g,...y]),d(!p)):d(!1),o("default")}catch{o("error")}})())};return N(()=>{(f==null?void 0:f.length)>0?s(f):c(!0)},[f,r]),N(()=>{var m;((m=n.reloadGenericAccounts)==null?void 0:m.id)===h&&c(!0)},[n.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:u||"Accounts"})}),e("main",{children:i.length>0?e($,{children:[e("ul",{class:"accounts-list",children:i.map(m=>{var p;return e("li",{children:[b&&((p=m._types)==null?void 0:p.length)>0&&e("div",{class:"reactions-block",children:m._types.map(y=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[y],class:`${y}-icon`}))}),e(Fe,{account:m})]},m.id+(m._types||""))})}),a==="default"?l?e(it,{onChange:m=>{m&&c()},children:e("button",{type:"button",class:"plain block",onClick:()=>c(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):a==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})})]}):a==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):a==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Nn({alt:t,lang:n,onClose:a}){const o=ue(v),[i,s]=C(!1),l=gn(!0),d=o.settings.contentTranslationHideLanguages||[],h=!!n&&n!==l&&!Yt([n],[l])&&!d.find(u=>n===u||Yt([n],[u]));return e("div",{class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close outer",onClick:a,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Ke,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:e(te,{disabled:i,onClick:()=>{s(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]})})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap"},children:t}),(h||i)&&e(wn,{forceTranslate:i,sourceLanguage:n,text:t})]})]})}function Un({mediaAttachments:t,statusID:n,instance:a,lang:o,index:i=0,onClose:s=()=>{}}){var p,y;const l=E(null),[d,h]=C(i),u=E(null);ze(()=>{var g;(g=u.current)==null||g.scrollIntoView()},[]);const r=E(n);N(()=>{const g=i*l.current.clientWidth,S=r.current!==n;S&&(r.current=n),l.current.scrollTo({left:g,behavior:S?"auto":"smooth"}),l.current.focus()},[i,n]);const[f,b]=C(!0);N(()=>{let g=()=>{s()};return l.current&&l.current.addEventListener("swiped-down",g),()=>{l.current&&l.current.removeEventListener("swiped-down",g)}},[]),Ce("esc",s,[s]);const[c,m]=C(!1);return N(()=>{let g=()=>{const{clientWidth:S,scrollLeft:k}=l.current,I=Math.round(k/S);h(I)};return l.current&&l.current.addEventListener("scroll",g,{passive:!0}),()=>{l.current&&l.current.removeEventListener("scroll",g)}},[]),N(()=>{let g=setTimeout(()=>{var S,k;(k=(S=l.current)==null?void 0:S.focus)==null||k.call(S)},100);return()=>clearTimeout(g)},[]),e("div",{class:"media-modal-container",children:[e("div",{ref:l,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:g=>{(g.target.classList.contains("carousel-item")||g.target.classList.contains("media")||g.target.classList.contains("media-zoom"))&&s()},children:t==null?void 0:t.map((g,S)=>{const{blurhash:k}=g,I=k?Cn(k):null;return e("div",{class:"carousel-item",style:{"--average-color":`rgb(${I==null?void 0:I.join(",")})`,"--average-color-alpha":`rgba(${I==null?void 0:I.join(",")}, .5)`},tabindex:"0",ref:S===d?u:null,onClick:x=>{x.target!==x.currentTarget&&b(!f)},children:[!!g.description&&e("button",{type:"button",class:"media-alt",hidden:!f,onClick:()=>{m({alt:g.description,lang:o})},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:o,dir:"auto",children:g.description})]}),e(es,{media:g,showOriginal:!0,lang:o})]},g.id)})}),e("div",{class:"carousel-top-controls",hidden:!f,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((g,S)=>e("button",{type:"button",disabled:S===d,class:`carousel-dot ${S===d?"active":""}`,onClick:k=>{k.preventDefault(),k.stopPropagation(),l.current.scrollTo({left:l.current.clientWidth*S,behavior:"smooth"}),l.current.focus()},children:e(w,{icon:"round",size:"s"})},g.id))}):e("span",{}),e("span",{children:[e(Ke,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:e(xe,{href:((p=t[d])==null?void 0:p.remoteUrl)||((y=t[d])==null?void 0:y.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]})})," ",e(W,{to:`${a?`/${a}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${d+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!f,children:[e("button",{type:"button",class:"carousel-button",hidden:d===0,onClick:g=>{g.preventDefault(),g.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(d-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:d===t.length-1,onClick:g=>{g.preventDefault(),g.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(d+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]}),!!c&&e(ge,{class:"light",onClick:g=>{g.target===g.currentTarget&&(m(!1),l.current.focus())},children:e(Nn,{alt:c.alt||c,lang:c==null?void 0:c.lang,onClose:()=>m(!1)})})]})}const Gs=""+new URL("floating-button-ef345856.svg",import.meta.url).href,Ws=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,Ks=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function Et({children:t}){if(typeof t=="string")return t;const[n,a]=C("");return N(()=>{Promise.resolve(t).then(a)},[t]),n}const et=9,Ys=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],Fn={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Favourites",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},bt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},It={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:nt(async({id:t})=>(await B().masto.v1.lists.$select(t).fetch()).title),path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||B().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||B().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t,path:({query:t})=>`/search?q=${t}`,icon:"search"},"account-statuses":{id:"account-statuses",title:nt(async({id:t})=>{const n=await B().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Favourites",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||B().instance,path:({hashtag:t,instance:n})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}`,icon:"hashtag"}};function Js({onClose:t}){const n=ue(v),{masto:a}=B(),{shortcuts:o}=n,[i,s]=C([]),[l,d]=C([]),[h,u]=C(!1),[r,f]=C(!1),[b]=Tn();return N(()=>{(async()=>{try{const c=await a.v1.lists.list();c.sort((m,p)=>m.title.localeCompare(p.title)),s(c)}catch{}})(),(async()=>{try{const c=a.v1.followedTags.list(),m=[];do{const{value:p,done:y}=await c.next();if(y||(p==null?void 0:p.length)===0)break;m.push(...p)}while(!0);d(m)}catch{}})()},[]),e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Gs},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Ks},{value:"multi-column",label:"Multi-column",imgURL:Ws}].map(({value:c,label:m,imgURL:p})=>e("label",{children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:c,checked:n.settings.shortcutsViewMode===c||c==="float-button"&&!n.settings.shortcutsViewMode,onChange:y=>{v.settings.shortcutsViewMode=y.target.value}})," ",e("img",{src:p,alt:"",width:"80",height:"58"})," ",e("span",{children:m})]}))}),o.length>0?e("ol",{class:"shortcuts-list",ref:b,children:o.filter(Boolean).map((c,m)=>{const p=Object.values(c).join("-"),{type:y}=c;if(!It[y])return null;let{icon:g,title:S,subtitle:k}=It[y];return typeof S=="function"&&(S=S(c,m)),typeof k=="function"&&(k=k(c,m)),typeof g=="function"&&(g=g(c,m)),e("li",{children:[e(w,{icon:g}),e("span",{class:"shortcut-text",children:[e(Et,{children:S}),k&&e($,{children:[" ",e("small",{class:"ib insignificant",children:k})]})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:m===0,onClick:()=>{const I=Array.from(v.shortcuts);if(m>0){const x=v.shortcuts[m-1];I[m-1]=c,I[m]=x,v.shortcuts=I}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:m===o.length-1,onClick:()=>{const I=Array.from(v.shortcuts);if(m<v.shortcuts.length-1){const x=v.shortcuts[m+1];I[m+1]=c,I[m]=x,v.shortcuts=I}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{u({shortcut:c,shortcutIndex:m})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},p)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:c=>{c.preventDefault(),v.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:o.length>=et&&`Max ${et} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>f(!0),children:"Import/export"}),e("button",{type:"button",disabled:o.length>=et,onClick:()=>u(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),h&&e(ge,{class:"light",onClick:c=>{c.target===c.currentTarget&&u(!1)},children:e(Xs,{shortcut:h.shortcut,shortcutIndex:h.shortcutIndex,lists:i,followedHashtags:l,onSubmit:({result:c,mode:m})=>{m==="edit"?v.shortcuts[h.shortcutIndex]=c:v.shortcuts.push(c)},onClose:()=>u(!1)})}),r&&e(ge,{class:"light",onClick:c=>{c.target===c.currentTarget&&f(!1)},children:e(Zs,{shortcuts:o,onClose:()=>f(!1)})})]})}function Xs({lists:t,followedHashtags:n,onSubmit:a,disabled:o,shortcut:i,shortcutIndex:s,onClose:l}){var f,b;const d=!!i,[h,u]=C((i==null?void 0:i.type)||null),r=E();return N(()=>{if(d&&h&&bt[h]){const c=r.current;bt[h].forEach(({name:m,type:p})=>{const y=c.querySelector(`[name="${m}"]`);y&&i[m]&&(p==="checkbox"?y.checked=i[m]==="on":y.value=i[m])})}},[d,h]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!l&&e("button",{type:"button",class:"sheet-close",onClick:l,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[d?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:r,onSubmit:c=>{c.preventDefault();const m=new FormData(c.target),p={};m.forEach((y,g)=>{p[g]=y==null?void 0:y.trim(),g==="instance"&&(p[g]=p[g].replace(/^https?:\/\//,"").replace(/\/+$/,""),p[g]=p[g].replace(/^@?[^@]+@/,""))}),p.type&&(a({result:p,mode:d?"edit":"add"}),c.target.reset(),u(null),l==null||l())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:o,onChange:c=>{u(c.target.value)},defaultValue:d?i.type:void 0,name:"type",children:[e("option",{}),Ys.map(c=>e("option",{value:c,children:Fn[c]}))]})]})}),(b=(f=bt[h])==null?void 0:f.map)==null?void 0:b.call(f,({text:c,name:m,type:p,placeholder:y,pattern:g,notRequired:S})=>h==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!S,disabled:o,children:t.map(k=>e("option",{value:k.id,children:k.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:c})," ",e("input",{type:p,name:m,placeholder:y,required:p==="text"&&!S,disabled:o,list:h==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:g}),h==="hashtag"&&n.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:n.map(k=>e("option",{value:k.name}))})]})})),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:o,children:d?"Save":"Add"}),d&&e("button",{type:"button",class:"light danger",onClick:()=>{v.shortcuts.splice(s,1),l==null||l()},children:"Remove"})]})]})})]})}function Zs({shortcuts:t,onClose:n}){var u;const a=me(()=>!t||!t.filter(Boolean).length?"":Qt.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,i]=C(""),[s,l]=C("default"),d=me(()=>{if(!o)return l("default"),null;try{const r=JSON.parse(Qt.decompressFromEncodedURIComponent(o));if(!Array.isArray(r))throw new Error("Not an array");return l("default"),r}catch{try{const f=JSON.parse(o);if(!Array.isArray(f))throw new Error("Not an array");return l("default"),f}catch{return l("error"),null}}},[o]),h=v.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:r=>{i(r.target.value)}})}),!!d&&Array.isArray(d)&&e($,{children:[e("p",{children:[e("b",{children:d.length})," shortcut",d.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:d.map(r=>{var f,b;return e("li",{children:[e("span",{style:{opacity:t.some(c=>Object.keys(c).every(m=>c[m]===r[m]))?1:0},children:"*"}),e("span",{children:[Fn[r.type],r.type==="list"&&" ⚠️"," ",(b=(f=bt[r.type])==null?void 0:f.map)==null?void 0:b.call(f,({text:c,name:m,type:p})=>r[m]?e($,{children:[e("span",{class:"tag collapsed insignificant",children:[c,":"," ",p==="checkbox"?r[m]==="on"?"✅":"❌":r[m]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[h&&e($,{children:[e(Ne,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const r=d.filter(c=>!v.shortcuts.some(m=>Object.keys(m).every(p=>m[p]===c[p])));if(!r.length){de("No new shortcuts to import");return}let f=[...v.shortcuts,...r];const b=f.length>et;b&&(f=f.slice(0,et)),v.shortcuts=f,de(b?`Shortcuts imported. Exceeded max ${et}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!d,children:"Import & append…"})})," "]}),e(Ne,{confirmLabel:h?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:h?"danger":void 0,onClick:()=>{v.shortcuts=d,de("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!d,children:h?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:a,readOnly:!0,onClick:r=>{if(r.target.value){r.target.select();try{navigator.clipboard.writeText(r.target.value),de("Shortcuts copied")}catch{de("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.clipboard.writeText(a),de("Shortcut settings copied")}catch{de("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((u=navigator==null?void 0:navigator.canShare)==null?void 0:u.call(navigator,{text:a}))&&e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.share({text:a})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",a.length>0&&e("small",{class:"insignificant",children:[a.length," characters"]})]}),!!a&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}$n(v,t=>{for(const[n,a,o,i]of t)/^show/i.test(a)&&!o&&Dt()});function Qs(){var o,i,s,l,d,h,u,r;const t=ue(v),n=xn(),a=st();return e($,{children:[!!t.showCompose&&e(ge,{children:e(ts,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((o=window.__COMPOSE__)==null?void 0:o.replyToStatus)||null,editStatus:((i=v.showCompose)==null?void 0:i.editStatus)||((s=window.__COMPOSE__)==null?void 0:s.editStatus)||null,draftStatus:((l=v.showCompose)==null?void 0:l.draftStatus)||((d=window.__COMPOSE__)==null?void 0:d.draftStatus)||null,onClose:f=>{const{newStatus:b,instance:c,type:m}=f||{};v.showCompose=!1,window.__COMPOSE__=null,b&&(v.reloadStatusPage++,de({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[m||"post"],delay:1e3,duration:1e4,onClick:p=>{p.hideToast(),v.prevLocation=a,n(c?`/${c}/s/${b.id}`:`/s/${b.id}`)}}))}})}),!!t.showSettings&&e(ge,{onClose:()=>{v.showSettings=!1},children:e(Ls,{onClose:()=>{v.showSettings=!1}})}),!!t.showAccounts&&e(ge,{onClose:()=>{v.showAccounts=!1},children:e(Is,{onClose:()=>{v.showAccounts=!1}})}),!!t.showAccount&&e(ge,{class:"light",onClose:()=>{v.showAccount=!1},children:e(qs,{account:((h=t.showAccount)==null?void 0:h.account)||t.showAccount,instance:(u=t.showAccount)==null?void 0:u.instance,onClose:({destination:f}={})=>{v.showAccount=!1}})}),!!t.showDrafts&&e(ge,{onClose:()=>{v.showDrafts=!1},children:e(Hs,{onClose:()=>v.showDrafts=!1})}),!!t.showMediaModal&&e(ge,{onClick:f=>{(f.target===f.currentTarget||f.target.classList.contains("media"))&&(v.showMediaModal=!1)},children:e(Un,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{v.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(ge,{class:"light",onClose:()=>{v.showShortcutsSettings=!1},children:e(Js,{onClose:()=>v.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(ge,{class:"light",onClose:()=>{v.showGenericAccounts=!1},children:e(js,{onClose:()=>v.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(ge,{class:"light",onClick:f=>{f.target===f.currentTarget&&(v.showMediaAlt=!1)},children:e(Nn,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(r=t.showMediaAlt)==null?void 0:r.lang,onClose:()=>{v.showMediaAlt=!1}})})]})}function _t({accountID:t,onChange:n}){const{masto:a}=B(),[o,i]=C("default"),[s,l]=C(null),[d,h]=C(null),u=d!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:o==="loading"||u,onClick:()=>{i("loading"),l("accept"),(async()=>{try{const r=await a.v1.followRequests.$select(t).authorize();if(!(r!=null&&r.followedBy))throw new Error("Follow request not accepted");h(r),n()}catch{}i("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:o==="loading"||u,class:"light danger",onClick:()=>{i("loading"),l("reject"),(async()=>{try{const r=await a.v1.followRequests.$select(t).reject();if(r!=null&&r.followedBy)throw new Error("Follow request not rejected");h(r),n()}catch{i("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:u&&s?s==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(ve,{hidden:o!=="loading"})})]})}const rn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},Ze={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"favourited your post.","favourite+account":t=>`favourited ${t} of your posts.`,favourite_reply:"favourited your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & favourited your post.","favourite+reblog+account":t=>`boosted & favourited ${t} of your posts.`,"favourite+reblog_reply":"boosted & favourited your reply.","admin.sign_up":"signed up.","admin.report":t=>e($,{children:["reported ",t]})},Lt=50;function Ht({notification:t,instance:n,reload:a,isStatic:o}){var D,M,H,ne;const{id:i,status:s,account:l,report:d,_accounts:h,_statuses:u}=t;let{type:r}=t;const f=(s==null?void 0:s.reblog)||s,b=f==null?void 0:f.id,c=Z.session.get("currentAccount"),m=c===(l==null?void 0:l.id),p=(D=s==null?void 0:s.poll)==null?void 0:D.voted,y=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==c&&((M=s==null?void 0:s.account)==null?void 0:M.id)===c;let g=0,S=0;if(r==="favourite+reblog"){for(const L of h)(H=L._types)!=null&&H.includes("favourite")&&g++,(ne=L._types)!=null&&ne.includes("reblog")&&S++;!S&&g&&(r="favourite"),!g&&S&&(r="reblog")}let k;if(r==="poll"?k=Ze[m?"poll-self":p?"poll-voted":"poll"]:r==="reblog"||r==="favourite"||r==="favourite+reblog"?(u==null?void 0:u.length)>1?k=Ze[`${r}+account`]:y?k=Ze[`${r}_reply`]:k=Ze[r]:Ze[r]?k=Ze[r]:k=`[Unknown notification type: ${r}]`,typeof k=="function"){const L=(u==null?void 0:u.length)||(h==null?void 0:h.length);if(L)k=k(L);else if(r==="admin.report"){const F=d==null?void 0:d.targetAccount;F&&(k=k(e(vt,{account:F,showAvatar:!0})))}}if(r==="mention"&&!s)return null;const I=t.createdAt&&new Date(t.createdAt).toLocaleString(),x={"favourite+reblog":"Boosted/Favourited by…",favourite:"Favourited by…",reblog:"Boosted by…",follow:"Followed by…"}[r]||"Accounts",_=()=>{v.showGenericAccounts={heading:x,accounts:h,showReactions:r==="favourite+reblog"}};return e("div",{class:`notification notification-${r}`,tabIndex:"0",children:[e("div",{class:`notification-type notification-${r}`,title:I,children:r==="favourite+reblog"?e($,{children:[e(w,{icon:"rocket",size:"xl",alt:r,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:r,class:"favourite-icon"})]}):e(w,{icon:rn[r]||"notification",size:"xl",alt:r})}),e("div",{class:"notification-content",children:[r!=="mention"&&e($,{children:[e("p",{children:[!/poll|update/i.test(r)&&e($,{children:(h==null?void 0:h.length)>1?e($,{children:[e("b",{tabIndex:"0",onClick:_,children:[e("span",{title:h.length,children:Pe(h.length)})," ","people"]})," "]}):e($,{children:[e(vt,{account:l,showAvatar:!0})," "]})}),k,r==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(Tt,{datetime:t.createdAt,format:"micro"})]})]}),r==="follow_request"&&e(_t,{accountID:l.id,onChange:()=>{}})]}),(h==null?void 0:h.length)>1&&e("p",{class:"avatars-stack",children:[h.slice(0,Lt).map((L,F)=>e($,{children:[e("a",{href:L.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:J=>{J.preventDefault(),v.showAccount=L},children:[e(Ge,{url:L.avatarStatic,size:h.length<=10?"xxl":h.length<20?"xl":h.length<30?"l":h.length<40?"m":"s",alt:`${L.displayName} @${L.acct}`,squircle:L==null?void 0:L.bot},L.id),r==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:L._types.map(J=>e(w,{icon:rn[J],size:"s",class:`${J}-icon`}))})]})," "]})),e("button",{type:"button",class:"small plain",onClick:_,children:[h.length>Lt&&`+${h.length-Lt}`,e(w,{icon:"chevron-down"})]})]}),(u==null?void 0:u.length)>1&&e("ul",{class:"notification-group-statuses",children:u.map(L=>e("li",{children:e(ln,{class:`status-link status-type-${r}`,to:n?`/${n}/s/${L.id}`:`/s/${L.id}`,children:e(Te,{status:L,size:"s"})})},L.id))}),s&&(!(u!=null&&u.length)||(u==null?void 0:u.length)<=1)&&e(ln,{class:`status-link status-type-${r}`,to:n?`/${n}/s/${b}`:`/s/${b}`,onContextMenu:L=>{const F=L.target.querySelector(".status");if(F){if(L.metaKey)return;L.preventDefault(),F.dispatchEvent(new MouseEvent("contextmenu",{clientX:L.clientX,clientY:L.clientY}))}},children:o?e(Te,{status:f,size:"s"}):e(Te,{statusID:b,size:"s"})})]})]})}function ln(t){const n=ns();return e(W,{...t,"data-read-more":"Read more →",ref:n})}const ei=Ve(function(){if(!("serviceWorker"in navigator))return null;const n=ue(v),{routeNotification:a}=n,{id:o,accessToken:i}=a||{},[s,l]=C(!1);ze(()=>{if(!o||!i)return;const{instance:h}=B(),{masto:u,instance:r}=B({accessToken:i}),f=h===r,b=i?ss(i):tt();(async()=>{const c=await u.v1.notifications.$select(o).fetch();if(c&&b){const m=b.instanceURL,{type:p,status:y,account:g}=c,S=!!document.querySelector("#modal-container > *"),k=p==="follow"&&!!(g!=null&&g.id),I=!!(g!=null&&g.id),x=!!(y!=null&&y.id);k&&f?v.showAccount={account:g,instance:m}:S||!f||I&&x?l({id:o,account:b,notification:c,sameInstance:f}):x?location.hash=`/${h}/s/${y.id}`:k?location.hash=`/${h}/a/${g.id}`:location.hash="/notifications"}})()},[o,i]),ze(()=>{const h=u=>{const{type:r,id:f,accessToken:b}=(u==null?void 0:u.data)||{};r==="notification"&&(v.routeNotification={id:f,accessToken:b})};return navigator.serviceWorker.addEventListener("message",h),()=>{navigator.serviceWorker.removeEventListener("message",h)}},[]),ze(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),kt(h=>{h&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const d=()=>{l(!1),v.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(s){const{id:h,account:u,notification:r,sameInstance:f}=s;return e(ge,{class:"light",onClick:b=>{b.target===b.currentTarget&&d()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:d,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!f&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:b=>{const{target:c}=b;(b.target.tagName==="BUTTON"||b.target.tagName==="A")&&d()},children:e(Ht,{instance:u.instanceURL,notification:r,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(W,{to:"/notifications",class:"button light",onClick:d,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null});const zn=ds((t,n)=>{const{instance:a}=B(),[o,i]=Be(),[s,l]=C(!1),[d,h]=C(o.get("q")||""),u=o.get("type"),r=E(null),f=E(null);return us(n,()=>({setValue:b=>{h(b)},focus:()=>{f.current.focus()},select:()=>{f.current.select()},blur:()=>{f.current.blur()}})),e("form",{ref:r,class:"search-popover-container",onSubmit:b=>{var m;if(b.preventDefault(),/\/search/.test(location.hash))if(d){const p={q:d};u&&(p.type=u),i(p)}else i({});else d?location.hash=`/search?q=${encodeURIComponent(d)}${u?`&type=${u}`:""}`:location.hash="/search";(m=t==null?void 0:t.onSubmit)==null||m.call(t,b)},children:[e("input",{ref:f,value:d,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:b=>{b.target.value||i({})},onInput:b=>{h(b.target.value),l(!0)},onFocus:()=>{l(!0)},onBlur:()=>{var b,c;setTimeout(()=>{l(!1)},100),(c=(b=r.current)==null?void 0:b.querySelector(".search-popover-item.focus"))==null||c.classList.remove("focus")},onKeyDown:b=>{var m;const{key:c}=b;switch(c){case"Escape":l(!1);break;case"Down":case"ArrowDown":if(b.preventDefault(),s){const p=r.current.querySelector(".search-popover-item.focus");if(p){let y=p.nextElementSibling;for(;y&&y.hidden;)y=y.nextElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(S=>S!==y).forEach(S=>{S.classList.remove("focus")}))}else{const y=r.current.querySelector(".search-popover-item");y&&y.classList.add("focus")}}break;case"Up":case"ArrowUp":if(b.preventDefault(),s){const p=document.querySelector(".search-popover-item.focus");if(p){let y=p.previousElementSibling;for(;y&&y.hidden;)y=y.previousElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(S=>S!==y).forEach(S=>{S.classList.remove("focus")}))}else{const y=document.querySelector(".search-popover-item:last-child");y&&y.classList.add("focus")}}break;case"Enter":if(s){const p=document.querySelector(".search-popover-item.focus");p&&(b.preventDefault(),p.click()),l(!1),(m=t==null?void 0:t.onSubmit)==null||m.call(t,b)}break}}}),e("div",{class:"search-popover",hidden:!s||!d,children:!!d&&[{label:e($,{children:["Posts with ",e("q",{children:d})]}),to:`/search?q=${encodeURIComponent(d)}&type=statuses`,hidden:/^https?:/.test(d)},{label:e($,{children:["Posts tagged with ",e("mark",{children:["#",d.replace(/^#/,"")]})]}),to:`/${a}/t/${d.replace(/^#/,"")}`,hidden:/^@/.test(d)||/^https?:/.test(d)||/\s/.test(d),top:/^#/.test(d),type:"link"},{label:e($,{children:["Look up ",e("mark",{children:d})]}),to:`/${d}`,hidden:!/^https?:/.test(d),top:/^https?:/.test(d),type:"link"},{label:e($,{children:["Accounts with ",e("q",{children:d})]}),to:`/search?q=${encodeURIComponent(d)}&type=accounts`}].sort((b,c)=>b.top&&!c.top?-1:!b.top&&c.top?1:0).map(({label:b,to:c,hidden:m,type:p})=>e(W,{to:c,class:"search-popover-item",hidden:m,onClick:y=>{var g;(g=t==null?void 0:t.onSubmit)==null||g.call(t,y)},children:[e(w,{icon:p==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:b})," "]}))})]})}),ti=Ve(function({onClose:n=()=>{}}){const[a,o]=C(!1),i=E(null);Ce("/",l=>{o(!0),setTimeout(()=>{var d,h,u,r;(h=(d=i.current)==null?void 0:d.focus)==null||h.call(d),(r=(u=i.current)==null?void 0:u.select)==null||r.call(u)},0)},{preventDefault:!0,ignoreEventWhen:l=>{const d=/\/search/.test(location.hash),h=!!document.querySelector("#modal-container > *");return d||h}});const s=()=>{o(!1),n()};return Ce("esc",l=>{var d,h;(h=(d=i.current)==null?void 0:d.blur)==null||h.call(d),s()},{enabled:a,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!a,onClick:l=>{l.target===l.currentTarget&&s()},children:e(zn,{ref:i,onSubmit:()=>{s()}})})});function ni(){const{instance:t}=B(),n=ue(v),{shortcuts:a,settings:o}=n;if(!a.length||o.shortcutsColumnsMode||o.shortcutsViewMode==="multi-column")return null;const i=E(),s=me(()=>a.map((d,h)=>{const{type:u,...r}=d;if(!It[u])return null;let{id:f,path:b,title:c,subtitle:m,icon:p}=It[u];return typeof f=="function"&&(f=f(r,h)),typeof b=="function"&&(b=b({...r,instance:r.instance||t},h)),typeof c=="function"&&(c=c(r,h)),typeof m=="function"&&(m=m(r,h)),typeof p=="function"&&(p=p(r,h)),{id:f,path:b,title:c,subtitle:m,icon:p}}).filter(Boolean),[a]),l=xn();return Ce(["1","2","3","4","5","6","7","8","9"],(d,h)=>{var r,f;const u=parseInt(h.keys[0],10)-1;if(u<s.length){const{path:b}=s[u];b&&(l(b),(f=(r=i.current)==null?void 0:r.closeMenu)==null||f.call(r))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",children:e("ul",{children:s.map(({id:d,path:h,title:u,subtitle:r,icon:f},b)=>e("li",{children:e(W,{class:r?"has-subtitle":"",to:h,onClick:c=>{if(c.target.classList.contains("is-active")){c.preventDefault();const m=document.getElementById(`${d}-page`);if(m){m.scrollTop=0;const p=m.querySelector(".updates-button");p&&p.click()}}},children:[e(w,{icon:f,size:"xl",alt:u}),e("span",{children:[e(Et,{children:u}),r&&e($,{children:[e("br",{}),e("small",{children:r})]})]})]})},b+u))})}):e(Ke,{instanceRef:i,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:d=>{var h,u;try{const{target:r}=d;getComputedStyle(r).pointerEvents==="none"&&((u=(h=i.current)==null?void 0:h.closeMenu)==null||u.call(h))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:s.map(({path:d,title:h,subtitle:u,icon:r},f)=>e(xe,{to:d,class:"glass-menu-item",children:[e(w,{icon:r,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Et,{children:h})}),u&&e($,{children:[" ",e("small",{class:"more-insignificant",children:u})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:f+1})]},f+h))})})}const si=Ve(ni);function rt(t){const{containerProps:n}=t,a=hs(),o=E();return e(Ke,{boundingBoxPadding:Sn(),repositionFlag:`${a.width}x${a.height}`,...t,instanceRef:o,containerProps:{onClick:i=>{var s,l,d;i.target===i.currentTarget&&((l=(s=o.current)==null?void 0:s.closeMenu)==null||l.call(s)),(d=n==null?void 0:n.onClick)==null||d.call(n,i)},...n}})}function ii(t){var i;let n=[],a=[],o=0;for(let s=0;s<t.length;s++){const l=t[s];l.reblog&&!((i=l.account)!=null&&i.group)?(a.push(l),o++):(n.push(l),o<3&&(o=0))}if(t.length>10&&(a.length>t.length/4||o>=3)){const s=a.map(l=>l.id);if(a.length>t.length*3/4)n=[...n,{id:s,items:a,type:"boosts"}];else{const l=Math.floor(n.length/2);n=[...n.slice(0,l),{id:s,items:a,type:"boosts"},...n.slice(l)]}return n}else return t}function dn(t,n){const a=Z.account.get("boostedStatusIDs")||{},o=t.filter(s=>{if(!s.reblog)return!0;const l=`${n}-${s.reblog.id}`,d=a[l];return d&&d!==s.id?!1:(a[l]=s.id,!0)}),i=Object.keys(a);return i.length>50&&i.slice(0,i.length-50).forEach(s=>{delete a[s]}),Z.account.set("boostedStatusIDs",a),o}function oi(t){const n=[];let a=0;t.forEach(s=>{for(let d=0;d<n.length;d++){if(n[d].find(h=>h.id===s.id))return;if(n[d].find(h=>h.id===s.inReplyToId)||n[d].find(h=>h.inReplyToId===s.id)){n[d].push(s);return}}const l=t.find(d=>d.id===s.inReplyToId);l&&(n[a++]=[s,l])});for(let s=0;s<n.length;s++)for(let l=s+1;l<n.length;l++)n[s].find(h=>n[l].includes(h))&&(n[s]=[...n[s],...n[l]],n[s]=n[s].filter((h,u,r)=>r.findIndex(f=>f.id===h.id)===u),n.splice(l,1),l--);n.forEach(s=>{s.sort((l,d)=>!l.inReplyToId&&!d.inReplyToId?new Date(l.createdAt)-new Date(d.createdAt):l.inReplyToId===d.id?1:d.inReplyToId===l.id||!l.inReplyToId?-1:d.inReplyToId?new Date(l.createdAt)-new Date(d.createdAt):1)}),n.forEach(s=>{const l=s[0].account.id;s.forEach(d=>{d.account.id!==l&&(d._differentAuthor=!0)})}),n.length;const o=[],i=[];return t.forEach(s=>{if(s.reblog){o.push(s);return}for(let l=0;l<n.length;l++)if(n[l].find(d=>d.id===s.id)){if(i.includes(l))return;const d=n[l];d.sort((u,r)=>{const f=new Date(u.createdAt),b=new Date(r.createdAt);return f-b});const h=d[0].account.id;o.push({id:d.map(u=>u.id),items:d,type:d.every(u=>u.account.id===h)?"thread":"conversation"}),i.push(l);return}o.push(s)}),o}function xt({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:a=1,scrollThresholdStart:o=10,scrollThresholdEnd:i=10,direction:s="vertical",distanceFromStartPx:l,distanceFromEndPx:d}={}){const[h,u]=C(null),[r,f]=C(!1),[b,c]=C(!1),[m,p]=C(!1),[y,g]=C(!1),S=s==="vertical";return ze(()=>{const k=t.current;if(!k)return{};let I=S?k.scrollTop:k.scrollLeft;function x(){const{scrollTop:_,scrollLeft:D,scrollHeight:M,scrollWidth:H,clientHeight:ne,clientWidth:L}=k,F=S?_:D,J=S?M:H,ie=S?ne:L,Ae=Math.abs(F-I),G=l||Math.min(ie*n,J,F),oe=d||Math.min(ie*a,J,J-F-ie);Ae>=(I<F?i:o)&&(u(I<F?"end":"start"),I=F),f(F<=0),c(F+ie>=J),p(F<=G),g(F+ie>=J-oe)}return k.addEventListener("scroll",x,{passive:!0}),()=>k.removeEventListener("scroll",x)},[n,a,o,i]),{scrollDirection:h,reachStart:r,reachEnd:b,nearReachStart:m,nearReachEnd:y,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function lt(t){var k,I,x,_,D;const n=ue(v),{masto:a,instance:o,authenticated:i}=B(),[s,l]=C(),[d,h]=C(!1);N(()=>{const M=Z.local.getJSON("accounts")||[],H=M.find(ne=>ne.info.id===Z.session.get("currentAccount"));H&&l(H),h(M.length>1)},[]);const u=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(M=>M.type==="following"),r=fs(()=>{v.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),f=E(),[b,c]=C(void 0),m=Sn([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),p=E();async function y(M){return(M||!p.current)&&(p.current=a.v1.mutes.list({limit:80})),await p.current.next()}const g=E();async function S(M){return(M||!g.current)&&(g.current=a.v1.blocks.list({limit:80})),await g.current.next()}return e($,{children:[e("button",{ref:f,type:"button",class:`button plain nav-menu-button ${d?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{c(M=>M?void 0:"open")},onContextMenu:M=>{M.preventDefault(),v.showAccounts=!0},...r(),children:[d&&e(Ge,{url:((k=s==null?void 0:s.info)==null?void 0:k.avatar)||((I=s==null?void 0:s.info)==null?void 0:I.avatarStatic),size:"l",squircle:(x=s==null?void 0:s.info)==null?void 0:x.bot}),e(w,{icon:"menu",size:d?"s":"l"})]}),e(Ln,{menuClassName:"nav-menu",state:b,anchorRef:f,onClose:()=>{c(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{c(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:m,unmountOnClose:!0,children:[!!((_=n.appVersion)!=null&&_.commitHash)&&n.appVersion.commitHash!=="45b250b"&&e("div",{class:"top-menu",children:[e(te,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(De,{})]}),e("section",{children:[e(xe,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),i&&e($,{children:[u&&e(xe,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(xe,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(xe,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(De,{}),e(xe,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(xe,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(xe,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(xe,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Favourites"})]})]}),e(De,{}),e(xe,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(xe,{to:`/${o}/p/l`,children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Local"})]}),e(xe,{to:`/${o}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(xe,{to:`/${o}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:i?e($,{children:[e(De,{}),((D=s==null?void 0:s.info)==null?void 0:D.id)&&e(xe,{to:`/${o}/a/${s.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(te,{onClick:()=>{v.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(te,{onClick:()=>{v.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:y}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(te,{onClick:()=>{v.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:S}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(De,{className:"divider-grow"}),e(te,{onClick:()=>{v.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(te,{onClick:()=>{v.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(te,{onClick:()=>{v.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e($,{children:[e(De,{}),e(xe,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(te,{onClick:()=>{v.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const ft={block:"nearest",inline:"center",behavior:"smooth"};function Oe({title:t,titleComponent:n,id:a,instance:o,emptyText:i,errorText:s,useItemID:l,boostsCarousel:d,fetchItems:h=()=>{},checkForUpdates:u=()=>{},checkForUpdatesInterval:r=6e4,headerStart:f,headerEnd:b,timelineStart:c,allowFilters:m,refresh:p}){const y=ue(v),[g,S]=C([]),[k,I]=C("default"),[x,_]=C(!1),[D,M]=C(!1),[H,ne]=C(!0),L=E(),F=St(z=>{M(!1),k!=="loading"&&(I("loading"),(async()=>{try{let{done:X,value:Y}=await h(z);Array.isArray(Y)?(d&&(Y=ii(Y)),Y=oi(Y),S(z?Y:ce=>[...ce,...Y]),Y.length||(X=!0),_(!X)):_(!1),I("default")}catch{I("error")}finally{F.cancel()}})())},1500,{leading:!0,trailing:!1}),J=".timeline-item, .timeline-item-alt",ie=Ce("j, shift+j",(z,X)=>{const Y=document.activeElement.closest(J),ce=Y==null?void 0:Y.getBoundingClientRect(),Q=Array.from(L.current.querySelectorAll(J));if(Y&&ce.top<L.current.clientHeight&&ce.bottom>0){const T=Q.indexOf(Y);let R=Q[T+1];X.shift&&(R=Q.find((q,P)=>P>T&&!q.classList.contains("timeline-item-alt"))),R&&(R.focus(),R.scrollIntoView(ft))}else{const T=Q.find(R=>{const q=R.getBoundingClientRect();return q.top>=44&&q.left>=0});T&&(T.focus(),T.scrollIntoView(ft))}}),Ae=Ce("k, shift+k",(z,X)=>{const Y=document.activeElement.closest(J),ce=Y==null?void 0:Y.getBoundingClientRect(),Q=Array.from(L.current.querySelectorAll(J));if(Y&&ce.top<L.current.clientHeight&&ce.bottom>0){const T=Q.indexOf(Y);let R=Q[T-1];X.shift&&(R=Q.findLast((q,P)=>P<T&&!q.classList.contains("timeline-item-alt"))),R&&(R.focus(),R.scrollIntoView(ft))}else{const T=Q.find(R=>{const q=R.getBoundingClientRect();return q.top>=44&&q.left>=0});T&&(T.focus(),T.scrollIntoView(ft))}}),G=Ce(["enter","o"],()=>{const z=document.activeElement.closest(J);z&&z.click()}),{scrollDirection:oe,nearReachStart:V,nearReachEnd:A,reachStart:O,reachEnd:K}=xt({scrollableRef:L,distanceFromEnd:2,scrollThresholdStart:44});N(()=>{var z;(z=L.current)==null||z.scrollTo({top:0}),F(!0)},[]),N(()=>{F(!0)},[p]),N(()=>{O&&F(!0)},[O]),N(()=>{(A||K&&x)&&F()},[A,x]);const ae=We(async({disableIdleCheck:z=!1}={})=>{y.settings.autoRefresh&&L.current.scrollTop===0&&(z||window.__IDLE__)&&!ri()?F(!0):await u()&&M(!0)},[a,F,u,y.settings.autoRefresh]),Se=St(ae,3e3),Le=E();kt(z=>{if(z){const X=Date.now()-Le.current;(!Le.current||X>1e3*60)&&Se({disableIdleCheck:!0})}else Le.current=Date.now(),Se.cancel();ne(z)},[u,ae,y.settings.autoRefresh]),mn(ae,H&&!D?r:null);const re=oe==="end"&&!V;return e("div",{id:`${a}-page`,class:"deck-container",ref:z=>{L.current=z,ie.current=z,Ae.current=z,G.current=z},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{hidden:re,onClick:z=>{var X;z.target.closest("a, button")||(X=L.current)==null||X.scrollTo({top:0,behavior:"smooth"})},onDblClick:z=>{z.target.closest("a, button")||F(!0)},class:k==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(lt,{}),f??e(W,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!b&&b})]}),g.length>0&&k!=="loading"&&!re&&D&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var z;F(!0),(z=L.current)==null||z.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!c&&e("div",{class:`timeline-start ${k==="loading"?"loading":""}`,children:c}),g.length?e($,{children:[e("ul",{class:"timeline",children:[g.map(z=>{const{id:X,reblog:Y,items:ce,type:Q,_pinned:T}=z,R=(Y==null?void 0:Y.id)||X,q=o?`/${o}/s/${R}`:`/s/${R}`;let P="";Q==="boosts"?P=`${ce.length} Boosts`:Q==="pinned"&&(P="Pinned posts");const ee=Q==="boosts"||Q==="pinned";if(ce){if(ee)return ce.sort((se,he)=>se._filtered&&!he._filtered?1:!se._filtered&&he._filtered?-1:0),e("li",{class:"timeline-item-carousel",children:e(ci,{title:P,class:`${Q}-carousel`,children:ce.map(se=>{const{id:he,reblog:Re}=se,fe=(Re==null?void 0:Re.id)||he,Ee=o?`/${o}/s/${fe}`:`/s/${fe}`;return e("li",{children:e(W,{class:"status-carousel-link timeline-item-alt",to:Ee,children:l?e(Te,{statusID:he,instance:o,size:"s",contentTextWeight:!0,allowFilters:m}):e(Te,{status:se,instance:o,size:"s",contentTextWeight:!0,allowFilters:m})})},he)})})},`timeline-${X}`);const ke=ce.length>3;return ce.map((se,he)=>{const{id:Re,_differentAuthor:fe}=se,Ee=o?`/${o}/s/${Re}`:`/s/${Re}`,U=he>0&&he<ce.length-1,le=se.sensitive&&!!se.spoilerText,be=!fe&&le&&he>0||ke&&U&&(Q==="thread"||Q==="conversation"&&!fe&&!ce[he-1]._differentAuthor&&!ce[he+1]._differentAuthor);return e("li",{class:`timeline-item-container timeline-item-container-type-${Q} timeline-item-container-${he===0?"start":he===ce.length-1?"end":"middle"} ${fe?"timeline-item-diff-author":""}`,children:e(W,{class:"status-link timeline-item",to:Ee,children:be?e(ai,{status:se,instance:o}):l?e(Te,{statusID:Re,instance:o,allowFilters:m}):e(Te,{status:se,instance:o,allowFilters:m})})},`timeline-${Re}`)})}return e("li",{children:e(W,{class:"status-link timeline-item",to:q,children:l?e(Te,{statusID:X,instance:o,allowFilters:m}):e(Te,{status:z,instance:o,allowFilters:m})})},`timeline-${X+T}`)}),x&&k==="loading"&&e($,{children:[e("li",{style:{height:"20vh"},children:e(Te,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(Te,{skeleton:!0})})]})]}),k==="default"&&(x?e(it,{onChange:z=>{z&&F()},children:e("button",{type:"button",class:"plain block",onClick:()=>F(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):k==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((z,X)=>e("li",{children:e(Te,{skeleton:!0})},X))}):k!=="error"&&e("p",{class:"ui-state",children:i}),k==="error"&&e("p",{class:"ui-state",children:[s,e("br",{}),e("br",{}),e("button",{class:"button plain",onClick:()=>F(!g.length),children:"Try again"})]})]})})}function ci({title:t,class:n,children:a}){const o=E(),{reachStart:i,reachEnd:s,init:l}=xt({scrollableRef:o,direction:"horizontal"});return N(()=>{l==null||l()},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{type:"button",class:"small plain2",disabled:i,onClick:()=>{var d,h;(h=o.current)==null||h.scrollBy({left:-Math.min(320,(d=o.current)==null?void 0:d.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var d,h;(h=o.current)==null||h.scrollBy({left:Math.min(320,(d=o.current)==null?void 0:d.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:o,children:a})]})}function ai({status:t,instance:n}){const a=ue(v),{id:o,visibility:i}=t,s=kn(t),l=zt(o,n);return e("article",{class:`status compact-thread ${i==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[a.statusThreadNumber[l]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),a.statusThreadNumber[l]?` ${a.statusThreadNumber[l]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:s,children:[s,t.sensitive&&t.spoilerText&&e($,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function ri(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const Qe=20,Vt=1983,un=`${Vt}-01`,li=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function di(t){var o;const{masto:n}=B({instance:t}),a=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((o=a==null?void 0:a.statuses)!=null&&o.length)}const ui=nt(di);function hi(){const t=ue(v),{id:n,...a}=Ye(),[o,i]=Be(),s=o.get("month"),l=!o.get("replies"),d=!!o.get("boosts"),h=o.get("tagged"),u=!!o.get("media"),{masto:r,instance:f,authenticated:b}=B({instance:a.instance}),c=E(),m=[s,l,d,h,u],[p,y]=C(),g=E(0);N(()=>{g.current=0},m);const S=me(()=>f===B().instance,[f]),[k,I]=C(!1);N(()=>{S&&p!=null&&p.acct&&(async()=>{const G=await ui(f);I(G)})()},[f,S,p==null?void 0:p.acct]);async function x(G){var ae,Se,Le;const oe=/^\d{4}-[01]\d$/.test(s),V=((Se=(ae=s==null?void 0:s.split)==null?void 0:ae.call(s,"-"))==null?void 0:Se[0])>=Vt;if(oe&&V){if(!p)return{value:[],done:!0};const[re,z]=s.split("-"),X=parseInt(z,10)-1,Y=new Date(re,X,0),ce=`${Y.getFullYear()}-${(Y.getMonth()+1).toString().padStart(2,"0")}-${Y.getDate().toString().padStart(2,"0")}`,Q=new Date(re,X+1,1),T=`${Q.getFullYear()}-${(Q.getMonth()+1).toString().padStart(2,"0")}-${Q.getDate().toString().padStart(2,"0")}`;let R;G?(R=Qe+1,g.current=0):(R=Qe+g.current+1,g.current+=Qe);const q=await r.v2.search.fetch({q:`from:${p.acct} after:${ce} before:${T}`,type:"statuses",limit:R,offset:g.current});if((Le=q==null?void 0:q.statuses)!=null&&Le.length){const P=q.statuses.slice(0,Qe);P.forEach(ke=>{Ie(ke,f)});const ee=q.statuses.length<=Qe;return{value:P,done:ee}}else return{value:[],done:!0}}const A=[];if(G){const{value:re}=await r.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(re!=null&&re.length&&!h&&!u)if(re.forEach(z=>{z._pinned=!0,Ie(z,f)}),re.length>=3){const z=re.map(X=>X.id);A.push({id:z,items:re,type:"pinned"})}else A.push(...re)}(G||!c.current)&&(c.current=r.v1.accounts.$select(n).statuses.list({limit:Qe,exclude_replies:l,exclude_reblogs:d,only_media:u,tagged:h}));const{value:O,done:K}=await c.current.next();return O!=null&&O.length&&(A.push(...O),O.forEach(re=>{Ie(re,f)})),{value:A,done:K}}const[_,D]=C([]);$e(`${p!=null&&p.displayName?p.displayName+" ":""}@${p!=null&&p.acct?p.acct:"Account posts"}`,"/:instance?/a/:id"),N(()=>{(async()=>{try{const G=await r.v1.accounts.$select(n).fetch();y(G)}catch{}try{const G=await r.v1.accounts.$select(n).featuredTags.list();D(G)}catch{}})()},[n]);const{displayName:M,acct:H,emojis:ne}=p||{},L=E(),F=me(()=>{const G=t.accounts[`${n}@${f}`],oe=!l||d||h||u||!!s;return e($,{children:[e(Pn,{instance:f,account:G||n,fetchAccount:()=>r.v1.accounts.$select(n).fetch(),authenticated:b,standalone:!0}),e("div",{class:"filter-bar",ref:L,children:[oe?e(W,{to:`/${f}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(W,{to:`/${f}/a/${n}${l?"?replies=1":""}`,onClick:()=>{l&&de("Showing post with replies")},class:l?"":"is-active",children:"+ Replies"}),e(W,{to:`/${f}/a/${n}${d?"":"?boosts=0"}`,onClick:()=>{d||de("Showing posts without boosts")},class:d?"is-active":"",children:"- Boosts"}),e(W,{to:`/${f}/a/${n}${u?"":"?media=1"}`,onClick:()=>{u||de("Showing posts with media")},class:u?"is-active":"",children:"Media"}),_.map(V=>e(W,{to:`/${f}/a/${n}${h===V.name?"":`?tagged=${encodeURIComponent(V.name)}`}`,onClick:()=>{h!==V.name&&de(`Showing posts tagged with #${V.name}`)},class:h===V.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),V.name]})},V.id)),k&&(li?e("label",{class:`filter-field ${s?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(p!=null&&p.acct),value:s||"",min:un,max:new Date().toISOString().slice(0,7),onInput:V=>{const{value:A,validity:O}=V.currentTarget;O.valid&&i(A?{month:A}:{})}})]}):e(fi,{class:`filter-field ${s?"is-active":""}`,disabled:!(p!=null&&p.acct),value:s||"",min:un,max:new Date().toISOString().slice(0,7),onInput:V=>{const{value:A,validity:O}=V;O.valid&&i(A?{month:A}:{})}}))]})]})},[n,f,b,_,k,...m]);N(()=>{var oe;const G=(oe=L.current)==null?void 0:oe.querySelector(".is-active");G&&L.current.scrollTo({behavior:"smooth",left:G.offsetLeft-(L.current.offsetWidth-G.offsetWidth)/2})},[_,k,...m]);const J=me(()=>p!=null&&p.url?new URL(p.url).hostname:null,[p]),Ae=!!p&&!(f===J);return e(Oe,{title:`${p!=null&&p.acct?"@"+p.acct:"Posts"}`,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:e(yn,{text:M,emojis:ne})}),e("div",{children:e("span",{children:["@",H]})})]}),id:"account-statuses",instance:f,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:x,useItemID:!0,boostsCarousel:t.settings.boostsCarousel,timelineStart:F,refresh:[l,d,h,u,s+(p==null?void 0:p.acct)].toString(),headerEnd:e(rt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(te,{disabled:!Ae,onClick:()=>{(async()=>{try{const{masto:G}=B({instance:J}),oe=await G.v1.accounts.lookup({acct:p.acct}),{id:V}=oe;location.hash=`/${J}/a/${V}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:J}),")"]})]})})},n)}function fi(t){const{class:n,disabled:a,value:o,min:i,max:s,onInput:l=()=>{}}=t,[d,h]=(o==null?void 0:o.split("-"))||[],u=E(),r=E(),f=(b,c)=>{const[m,p]=(i==null?void 0:i.split("-"))||[],[y,g]=(s==null?void 0:s.split("-"))||[];return!(c<m||c>y||c===m&&b<p||c===y&&b>g)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:u,disabled:a,value:h||"",onInput:b=>{const{value:c}=b.currentTarget,m=r.current.value;if(!f(c,m))return{value:"",validity:{valid:!1}};l({value:c?`${m}-${c}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(b,c)=>e("option",{value:(c+1).toString().padStart(2,"0"),children:new Date(0,c).toLocaleString("default",{month:"long"})},c))]})," ",e("input",{ref:r,type:"number",disabled:a,value:d||new Date().getFullYear(),min:(i==null?void 0:i.slice(0,4))||Vt,max:(s==null?void 0:s.slice(0,4))||new Date().getFullYear(),onInput:b=>{const{value:c,validity:m}=b.currentTarget,p=u.current.value;if(!m.valid||!f(p,c))return{value:"",validity:{valid:!1}};l({value:c?`${c}-${p}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const pi=20;function Bn(){$e("Bookmarks","/b");const{masto:t,instance:n}=B(),a=E();async function o(i){return(i||!a.current)&&(a.current=t.v1.bookmarks.list({limit:pi})),await a.current.next()}return e(Oe,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:o})}const mi=20;function On(){$e("Favourites","/f");const{masto:t,instance:n}=B(),a=E();async function o(i){return(i||!a.current)&&(a.current=t.v1.favourites.list({limit:mi})),await a.current.next()}return e(Oe,{title:"Favourites",id:"favourites",emptyText:"No favourites yet. Go favourite something!",errorText:"Unable to load favourites",instance:n,fetchItems:o})}const gi=200;function bi(){const{masto:t,instance:n}=B();$e("Followed Hashtags","/ft");const[a,o]=C("default"),[i,s]=C([]);return N(()=>{o("loading"),(async()=>{try{const l=t.v1.followedTags.list({limit:gi}),d=[];do{const{value:h,done:u}=await l.next();if(u||(h==null?void 0:h.length)===0)break;d.push(...h)}while(!0);d.sort((h,u)=>h.name.localeCompare(u.name)),s(d),o("default")}catch{o("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(lt,{}),e(W,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:i.length>0?e("ul",{class:"link-list",children:i.map(l=>e("li",{children:e(W,{to:n?`/${n}/t/${l.name}`:`/t/${l.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:l.name})]})}))}):a==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):a==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function yi(t,n,a){var h;const{filtered:o}=t;if(!(o!=null&&o.length)||a&&((h=t.account)==null?void 0:h.id)===a)return!0;const s=o.filter(u=>{const{filter:r}=u,f=r.context.includes(n);return f?r.expiresAt?new Date(r.expiresAt)>new Date:f:!1});if(!s.length)return!0;if(s.some(u=>u.filter.filterAction==="hide"))return!1;const d=s.some(u=>u.filter.filterAction==="warn");if(d){const u=s.map(r=>r.filter.title);t._filtered={titles:u,titlesStr:u.join(" • ")}}return d}function He(t,n){if(!(t!=null&&t.length))return[];if(!n)return t;const a=Z.session.get("currentAccount");return t.filter(o=>yi(o,n,a))}const wi=20;function jt({title:t,path:n,id:a,...o}){$e(t||"Following",n||"/following");const{masto:i,streaming:s,instance:l}=B(),d=ue(v),h=E(),u=E();async function r(b){(b||!h.current)&&(h.current=i.v1.timelines.home.list({limit:wi}));const c=await h.current.next();let{value:m}=c;return m!=null&&m.length&&(b&&(u.current=m[0].id),m=He(m,"home"),m.forEach(p=>{Ie(p,l)}),m=dn(m,l),m.sort((p,y)=>{const g=new Date(p.createdAt);return new Date(y.createdAt)-g})),{...c,value:m}}async function f(){try{const b=await i.v1.timelines.home.list({limit:5,since_id:u.current}).next();let{value:c}=b;return!!(c!=null&&c.length&&(u.current=c[0].id,c=dn(c,l),c=He(c,"home"),c.some(m=>!m.reblog)))}catch{return!1}}return N(()=>{let b;return(async()=>{if(s){b=s.user.subscribe();for await(const c of b){if(!b)break;if(c.event==="status.update"){const m=c.payload;Ie(m,l)}else if(c.event==="delete"){const m=c.payload,p=In(m,l);p&&(p._deleted=!0)}}}})(),()=>{var c;(c=b==null?void 0:b.unsubscribe)==null||c.call(b),b=null}},[s]),e(Oe,{title:t||"Following",id:a||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:l,fetchItems:r,checkForUpdates:f,useItemID:!0,boostsCarousel:d.settings.boostsCarousel,...o,allowFilters:!0})}const vi=20,Si=4,hn=Si+1;function qn({columnMode:t,...n}){let{hashtag:a,...o}=t?{}:Ye();n.hashtag&&(a=n.hashtag);let i=a.trim().split(/[\s+]+/);i.sort(),a=i[0];const{masto:s,instance:l,authenticated:d}=B({instance:(n==null?void 0:n.instance)||o.instance}),{authenticated:h}=B(),u=i.map(I=>`#${I}`).join(" "),r=l?`${u} on ${l}`:u;$e(r,"/:instance?/t/:hashtag");const f=E(),b=E(void 0);async function c(I){const x=await s.v1.timelines.tag.$select(a).list({limit:vi,any:i.slice(1),maxId:I?void 0:b.current}).next(),{value:_}=x;return _!=null&&_.length&&(I&&(f.current=_[0].id),_.forEach(D=>{Ie(D,l)}),b.current=_[_.length-1].id),{...x,value:_}}async function m(){try{const I=await s.v1.timelines.tag.$select(a).list({limit:1,any:i.slice(1),since_id:f.current}).next(),{value:x}=I;return!!(x!=null&&x.length)}catch{return!1}}const[p,y]=C("default"),[g,S]=C();N(()=>{(async()=>{try{const I=await s.v1.tags.$select(a).fetch();S(I)}catch{}})()},[a]);const k=i.length>=hn;return e(Oe,{title:r,titleComponent:!!l&&e("h1",{class:"header-account",children:[e("b",{children:u}),e("div",{children:l})]}),id:"hashtag",instance:l,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:c,checkForUpdates:m,useItemID:!0,headerEnd:e(rt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!g&&i.length===1&&e($,{children:[e(Ne,{subMenu:!0,confirm:g.following,confirmLabel:`Unfollow #${a}?`,disabled:p==="loading"||!d,onClick:()=>{y("loading"),g.following?s.v1.tags.$select(a).unfollow().then(()=>{S({...g,following:!1}),de(`Unfollowed #${a}`)}).catch(I=>{alert(I)}).finally(()=>{y("default")}):s.v1.tags.$select(a).follow().then(()=>{S({...g,following:!0}),de(`Followed #${a}`)}).catch(I=>{alert(I)}).finally(()=>{y("default")})},children:g.following?e($,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e($,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(De,{})]}),e(ps,{className:"menu-field",disabled:k,children:({ref:I})=>e("form",{onSubmit:x=>{var D,M;x.preventDefault();const _=(M=(D=x.target[0].value)==null?void 0:D.trim)==null?void 0:M.call(D);_&&!i.some(H=>H.toLowerCase()===_.toLowerCase())&&(i.push(_),i.sort(),location.hash=l?`/${l}/t/${i.join("+")}`:`/t/${i.join("+")}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:I,type:"text",placeholder:k?`Max ${hn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:k})]})}),e(ms,{takeOverflow:!0,children:i.map((I,x)=>e(te,{disabled:i.length===1,onClick:_=>{i.splice(x,1),i.sort(),location.hash=l?`/${l}/t/${i.join("+")}`:`/t/${i.join("+")}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),I]})]},I))}),e(De,{}),e(te,{disabled:!h,onClick:()=>{const I={type:"hashtag",hashtag:i.join(" "),instance:l};v.shortcuts.some(_=>_.type===I.type&&_.hashtag.split(/[\s+]+/).sort().join(" ")===I.hashtag.split(/[\s+]+/).sort().join(" ")&&(_.instance?_.instance===I.instance:!0))?alert("This shortcut already exists"):(v.shortcuts.push(I),de("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(te,{onClick:()=>{let I=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(I)){I&&alert("Invalid instance");return}I&&(I=I.toLowerCase().trim(),location.hash=`/${I}/t/${i.join("+")}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},l+u)}const ki=20;function Hn(t){var p;const n=ue(v),{masto:a,instance:o}=B(),i=(t==null?void 0:t.id)||((p=Ye())==null?void 0:p.id),s=E(),l=E();async function d(y){(y||!l.current)&&(l.current=a.v1.timelines.list.$select(i).list({limit:ki}));const g=await l.current.next();let{value:S}=g;return S!=null&&S.length&&(y&&(s.current=S[0].id),S=He(S,"home"),S.forEach(k=>{Ie(k,o)})),{...g,value:S}}async function h(){try{const y=await a.v1.timelines.list.$select(i).list({limit:1,since_id:s.current});let{value:g}=y;return g=He(g,"home"),!!(g!=null&&g.length)}catch{return!1}}const[u,r]=C({title:"List"});$e(u.title,"/l/:id"),N(()=>{(async()=>{try{const y=await a.v1.lists.$select(i).fetch();r(y)}catch{}})()},[i]);const[f,b]=C(!1),[c,m]=C(!1);return e($,{children:[e(Oe,{title:u.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:o,fetchItems:d,checkForUpdates:h,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:e(W,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(rt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(te,{onClick:()=>b({list:u}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(te,{onClick:()=>m(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},i),f&&e(ge,{class:"light",onClick:y=>{y.target===y.currentTarget&&b(!1)},children:e(qt,{list:f==null?void 0:f.list,onClose:y=>{y.state==="success"&&y.list?r(y.list):y.state==="deleted"&&(location.hash="/l"),b(!1)}})}),c&&e(ge,{class:"light",onClick:y=>{y.target===y.currentTarget&&m(!1)},children:e(Ti,{listID:i,onClose:()=>m(!1)})})]})}const Ii=40;function Ti({listID:t,onClose:n}){const{masto:a,instance:o}=B(),[i,s]=C([]),[l,d]=C("default"),[h,u]=C(!1),r=E();async function f(b){u(!1),d("loading"),(async()=>{try{(b||!r.current)&&(r.current=a.v1.lists.$select(t).accounts.list({limit:Ii}));const c=await r.current.next();let{done:m,value:p}=c;p!=null&&p.length?(s(b?p:i.concat(p)),u(!m)):u(!1),d("default")}catch{d("error")}})()}return N(()=>{f(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[i.map(b=>e("li",{children:[e(Fe,{account:b,instance:o}),e(Ci,{account:b,listID:t})]},b.id)),h&&l==="default"&&e(it,{as:"li",onChange:b=>b&&f(),children:e("button",{type:"button",class:"light block",onClick:f,children:"Show more…"})})]})})]})}function Ci({account:t,listID:n}){const{masto:a}=B(),[o,i]=C("default"),[s,l]=C(!1);return e(Ne,{confirm:!s,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(i("loading"),(async()=>{try{await a.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),i("default"),l(!1)}catch{i("error")}})()):(i("loading"),(async()=>{try{await a.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),i("default"),l(!0)}catch{i("error")}})())},children:e("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:o==="loading",children:s?"Add":"Remove…"})})}const fn=20,$i=new URLSearchParams;function Vn({columnMode:t,...n}){$e("Mentions","/mentions");const{masto:a,instance:o}=B(),[i]=t?[$i]:Be(),[s,l]=C(null),d=(n==null?void 0:n.type)||i.get("type")||s,h=E(),u=E();async function r(g){(g||!h.current)&&(h.current=a.v1.notifications.list({limit:fn,types:["mention"]}));const S=await h.current.next();let{value:k}=S;return k!=null&&k.length&&(g&&(u.current=k[0].id),k.forEach(({status:I})=>{Ie(I,o)})),{...S,value:k==null?void 0:k.map(I=>I.status)}}const f=E(),b=E();async function c(g){(g||!f.current)&&(f.current=a.v1.conversations.list({limit:fn}));const S=await f.current.next();let{value:k}=S;return k=k==null?void 0:k.filter(I=>I.lastStatus),k!=null&&k.length&&(g&&(b.current=k[0].lastStatus.id),k.forEach(({lastStatus:I})=>{Ie(I,o)})),{...S,value:k==null?void 0:k.map(I=>I.lastStatus)}}function m(...g){return d==="private"?c(...g):r(...g)}async function p(){if(d==="private")try{const g=await a.v1.conversations.list({limit:1,since_id:b.current}).next();let{value:S}=g;return S!=null&&S.length?(b.current=S[0].lastStatus.id,!0):!1}catch{return!1}else try{const g=await a.v1.notifications.list({limit:1,types:["mention"],since_id:u.current}).next();let{value:S}=g;return S!=null&&S.length?(u.current=S[0].id,!0):!1}catch{return!1}}const y=me(()=>e("div",{class:"filter-bar centered",children:[e(W,{to:"/mentions",class:d?"":"is-active",onClick:g=>{t&&(g.preventDefault(),l(null))},children:"All"}),e(W,{to:"/mentions?type=private",class:d==="private"?"is-active":"",onClick:g=>{t&&(g.preventDefault(),l("private"))},children:"Private"})]}),[d]);return e(Oe,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:o,fetchItems:m,checkForUpdates:p,useItemID:!0,timelineStart:y,refresh:d})}function jn(t){const n={},a=[];for(let s=0,l=0;s<t.length;s++){const d=t[s],{status:h,account:u,type:r,createdAt:f}=d,b=new Date(f).toLocaleDateString();let c=r;(r==="favourite"||r==="reblog")&&(c="favourite+reblog");const m=`${h==null?void 0:h.id}-${c}-${b}`,p=n[m];if(c==="follow_request")a[l++]=d;else if(p!=null&&p.account){const y=p._accounts.find(g=>g.id===u.id);y?(y._types.push(r),y._types.sort().reverse()):(u._types=[r],p._accounts.push(u))}else{u._types=[r];let y=n[m]={...d,type:c,_accounts:[u]};a[l++]=y}}const o={},i=[];for(let s=0,l=0;s<a.length;s++){const d=a[s],{account:h,_accounts:u,type:r,createdAt:f}=d,b=new Date(f).toLocaleDateString();if(r==="favourite+reblog"&&h&&u.length===1){const c=`${h==null?void 0:h.id}-${r}-${b}`,m=o[c];if(m)m._statuses.push(d.status);else{let p=o[c]={...d,type:r,_statuses:[d.status]};i[l++]=p}}else i[l++]=d}return i}const xi=30,Li=new URLSearchParams;function Ri({columnMode:t}){$e("Notifications","/notifications");const{masto:n,instance:a}=B(),o=ue(v),[i,s]=C("default"),[l]=t?[Li]:Be(),d=l.get("id"),h=l.get("access_token"),[u,r]=C(!1),[f,b]=C(!1),c=E(),{nearReachEnd:m,scrollDirection:p,reachStart:y,nearReachStart:g}=xt({scrollableRef:c}),S=p==="end"&&!g,[k,I]=C([]),[x,_]=C([]),D=E();async function M(A){(A||!D.current)&&(D.current=n.v1.notifications.list({limit:xi,excludeTypes:["follow_request"]}));const O=await D.current.next(),K=O.value;if(K!=null&&K.length){K.forEach(Se=>{Ie(Se.status,a,{skipThreading:!0})});const ae=jn(K);A?(v.notificationsLast=K[0],v.notifications=ae,n.v1.markers.create({notifications:{lastReadId:K[0].id}}).catch(()=>{})):v.notifications.push(...ae)}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),O}async function H(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const ne=()=>{s("loading"),(async()=>{try{const A=await H();I(A),s("default")}catch{s("error")}})()};async function L(){try{return await n.v1.announcements.list()}catch{return[]}}const F=A=>{s("loading"),(async()=>{try{const O=M(A),K=H(),ae=L();if(A){const Le=await ae;Le.sort((z,X)=>{const Y=new Date(z.updatedAt||z.createdAt);return new Date(X.updatedAt||X.createdAt)-Y}),_(Le);const re=await K;I(re)}const{done:Se}=await O;r(!Se),s("default")}catch{s("error")}})()};N(()=>{F(!0)},[]),N(()=>{y&&F(!0)},[y]),N(()=>{m&&u&&F()},[m,u]);const J=We(()=>{var A;o.settings.autoRefresh&&((A=c.current)==null?void 0:A.scrollTop)===0&&window.__IDLE__&&!Ai()&&o.notificationsShowNew&&i!=="loading"&&F(!0)},[o.notificationsShowNew,o.settings.autoRefresh,i]);N(J,[o.notificationsShowNew]);const ie=new Date,Ae=new Date(ie-24*60*60*1e3);let G=new Date;const oe=!o.notifications.some(A=>new Date(A.createdAt).toDateString()===ie.toDateString()),V=E();return N(()=>{d&&(v.routeNotification={id:d,accessToken:atob(h)})},[d,h]),N(()=>{i==="default"&&(async()=>{try{const A=await Mn();if(A!=null&&A.getNotifications){const O=await A.getNotifications()}}catch{}})()},[i]),e("div",{id:"notifications-page",class:"deck-container",ref:c,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${f?"only-mentions":""}`,children:[e("header",{hidden:S,onClick:A=>{var O;A.target.closest("a, button")||(O=c.current)==null||O.scrollTo({top:0,behavior:"smooth"})},class:i==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(lt,{}),e(W,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),o.notificationsShowNew&&i!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var A;F(!0),(A=c.current)==null||A.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),x.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",x.length>1?"s":""]})," ",e("small",{class:"insignificant",children:a})]}),x.length>1&&e("span",{class:"announcements-nav-buttons",children:x.map((A,O)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var K;(K=V.current)==null||K.children[O].scrollIntoView({behavior:"smooth",block:"nearest"})},children:O+1}))})]}),e("ul",{class:`announcements-list-${x.length>1?"multiple":"single"}`,ref:V,children:x.map(A=>e("li",{children:e(Mi,{announcement:A})}))})]})})}),k.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),k.length>5?e("details",{children:[e("summary",{children:[k.length," follow requests"]}),e("ul",{children:k.map(A=>e("li",{children:[e(Fe,{account:A}),e(_t,{accountID:A.id,onChange:()=>{}})]},A.id))})]}):e("ul",{children:k.map(A=>e("li",{children:[e(Fe,{account:A}),e(_t,{accountID:A.id,onChange:()=>{}})]},A.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:f,onChange:A=>{b(A.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),oe&&!!o.notifications.length&&e("p",{class:"ui-state insignificant",children:i==="default"?"You're all caught up.":e($,{children:"…"})}),o.notifications.length?e($,{children:o.notifications.filter(A=>A.type!=="follow_request").map(A=>{if(f&&A.type!=="mention")return null;const O=new Date(A.createdAt),K=O.toDateString()!==G.toDateString();K&&(G=O);const ae=O.toDateString()===Ae.toDateString()?"Yesterday":qe(G,{hideTime:!0});return e($,{children:[K&&e("h2",{class:"timeline-header",children:ae}),e(Ht,{instance:a,notification:A,reload:()=>{F(!0),ne()}},A.id)]})})}):e($,{children:[i==="loading"&&e($,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((A,O)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),i==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>F(!0),children:"Try again"})]})]}),u&&e(it,{onChange:A=>{A&&F()},children:e("button",{type:"button",class:"plain block",disabled:i==="loading",onClick:()=>F(),style:{marginBlockEnd:"6em"},children:i==="loading"?e(ve,{abrupt:!0}):e($,{children:"Show more…"})})})]})})}function Ai(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Mi({announcement:t}){const{instance:n}=B(),{contact:a}=is(),o=a==null?void 0:a.account,{id:i,content:s,startsAt:l,endsAt:d,published:h,allDay:u,publishedAt:r,updatedAt:f,read:b,mentions:c,statuses:m,tags:p,emojis:y,reactions:g}=t,S=new Date(r),k=qe(S),I=new Date(f),x=qe(I);return e("div",{class:"announcement-block",children:[e(Fe,{account:o}),e("div",{class:"announcement-content",onClick:bn({mentions:c,instance:n}),dangerouslySetInnerHTML:{__html:Mt(s,{emojis:y})}}),e("p",{class:"insignificant",children:[e("time",{datetime:S.toISOString(),children:qe(S)}),f&&x!==k&&e($,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:I.toISOString(),children:qe(I)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:g.map(_=>{const{name:D,count:M,me:H,staticUrl:ne,url:L}=_;return e("button",{type:"button",class:`plain4 small ${H?"reacted":""}`,children:[L||ne?e("img",{src:L||ne,alt:D,width:"16",height:"16"}):e("span",{children:D})," ",e("span",{class:"count",children:Pe(M)})]})})})]})}const Gn=Ve(Ri),Di=20;function Pt({local:t,columnMode:n,...a}){const o=ue(v),i=!!t,s=n?{}:Ye(),{masto:l,instance:d}=B({instance:(a==null?void 0:a.instance)||s.instance}),h=`${i?"Local":"Federated"} timeline (${d})`;$e(h,i?"/:instance?/p/l":"/:instance?/p");const u=E(),r=E();async function f(c){(c||!r.current)&&(r.current=l.v1.timelines.public.list({limit:Di,local:i}));const m=await r.current.next();let{value:p}=m;return p!=null&&p.length&&(c&&(u.current=p[0].id),p=He(p,"public"),p.forEach(y=>{Ie(y,d)})),{...m,value:p}}async function b(){try{const c=await l.v1.timelines.public.list({limit:1,local:i,since_id:u.current}).next();let{value:m}=c;return m=He(m,"public"),!!(m!=null&&m.length)}catch{return!1}}return e(Oe,{title:h,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:i?"Local timeline":"Federated timeline"}),e("div",{children:d})]}),id:"public",instance:d,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:b,useItemID:!0,headerStart:e($,{}),boostsCarousel:o.settings.boostsCarousel,allowFilters:!0,headerEnd:e(rt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(te,{href:i?`/#/${d}/p`:`/#/${d}/p/l`,children:i?e($,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e($,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(De,{}),e(te,{onClick:()=>{let c=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(c)){c&&alert("Invalid instance");return}c&&(c=c.toLowerCase().trim(),location.hash=i?`/${c}/p/l`:`/${c}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},d+i)}const Ei=20,_i=nt(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Wn({columnMode:t,...n}){const a=ue(v),o=t?{}:Ye(),{masto:i,instance:s}=B({instance:(n==null?void 0:n.instance)||o.instance}),l=`Trending (${s})`;$e(l,"/:instance?/trending");const d=E(),[h,u]=C([]),[r,f]=C([]),b=E();async function c(y){var k;if(y||!b.current){b.current=i.v1.trends.statuses.list({limit:Ei});try{const I=i.v1.trends.tags.list(),{value:x}=await I.next();x!=null&&x.length&&u(x)}catch{}try{const{value:I}=await _i(i),x=(k=I==null?void 0:I.filter)==null?void 0:k.call(I,_=>_.type==="link");x!=null&&x.length&&f(x)}catch{}}const g=await b.current.next();let{value:S}=g;return S!=null&&S.length&&(y&&(d.current=S[0].id),S=He(S,"public"),S.forEach(I=>{Ie(I,s)})),{...g,value:S}}async function m(){try{const y=await i.v1.trends.statuses.list({limit:1}).next();let{value:g}=y;return g=He(g,"public"),g!=null&&g.length&&g[0].id!==d.current?(d.current=g[0].id,!0):!1}catch{return!1}}const p=me(()=>e($,{children:[!!h.length&&e("div",{class:"filter-bar",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),h.map((y,g)=>{const{name:S,history:k}=y,I=k.reduce((x,_)=>x+ +_.uses,0);return e(W,{to:`/${s}/t/${S}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),S]}),e("span",{class:"filter-count",children:I.toLocaleString()})]},S)})]}),!!r.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),r.map(y=>{const{authorName:g,authorUrl:S,blurhash:k,description:I,height:x,image:_,imageDescription:D,language:M,providerName:H,providerUrl:ne,publishedAt:L,title:F,url:J,width:ie}=y,Ae=new URL(J).hostname.replace(/^www\./,"").replace(/\/$/,""),G=Cn(k),oe=Pi(G),V=oe.map((K,ae)=>ae===0?.65:K),A=oe.map((K,ae)=>ae===0?.9:K),O=oe.map((K,ae)=>ae===0?.4:K);return e("a",{href:J,target:"_blank",rel:"noopener noreferrer",style:{"--average-color":`rgb(${G==null?void 0:G.join(",")})`,"--accent-color":`oklab(${V==null?void 0:V.join(" ")})`,"--light-color":`oklab(${A==null?void 0:A.join(" ")})`,"--dark-color":`oklab(${O==null?void 0:O.join(" ")})`},children:e("article",{children:[e("figure",{children:e("img",{src:_,alt:D,width:ie,height:x,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:Ae})," ",!!L&&e($,{children:"· "}),!!L&&e($,{children:e(Tt,{datetime:L,format:"micro"})})]}),!!F&&e("h1",{class:"title",children:F})]}),!!I&&e("p",{class:"description",children:I})]})]})},J)})]})]}),[h,r]);return e(Oe,{title:l,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:"Trending"}),e("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:c,checkForUpdates:m,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e($,{}),boostsCarousel:a.settings.boostsCarousel,allowFilters:!0,timelineStart:p,headerEnd:e(rt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(te,{onClick:()=>{let y=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(y)){y&&alert("Invalid instance");return}y&&(y=y.toLowerCase().trim(),location.hash=`/${y}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})})},s)}const Rt=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92;function Pi([t,n,a]){t=Rt(t/255),n=Rt(n/255),a=Rt(a/255);var o=.4122214708*t+.5363325363*n+.0514459929*a,i=.2119034982*t+.6806995451*n+.1073969566*a,s=.0883024619*t+.2817188376*n+.6299787005*a;return o=Math.cbrt(o),i=Math.cbrt(i),s=Math.cbrt(s),[o*.2104542553+i*.793617785+s*-.0040720468,o*1.9779984951+i*-2.428592205+s*.4505937099,o*.0259040371+i*.7827717662+s*-.808675766]}function Ni(){$e("Home","/");const t=ue(v),{shortcuts:n}=t,a=n.map(o=>{if(!o)return null;const{type:i,...s}=o,l={following:jt,notifications:Gn,list:Hn,public:Pt,bookmarks:Bn,favourites:On,hashtag:qn,mentions:Vn,trending:Wn}[i];return l?e(l,{...s,columnMode:!0},i+JSON.stringify(s)):null});return Ce(["1","2","3","4","5","6","7","8","9"],(o,i)=>{try{const s=parseInt(i.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),e("div",{id:"columns",children:a})}function Ui(){var n;const t=ue(v);return N(()=>{(async()=>{const a=await ot.drafts.keys();if(a.length){const o=vn();a.filter(s=>s.startsWith(o)).length&&(v.showDrafts=!0)}})()},[]),e($,{children:(t.settings.shortcutsColumnsMode||t.settings.shortcutsViewMode==="multi-column")&&((n=t.shortcuts)!=null&&n.length)?e(Ni,{}):e(jt,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(Fi,{})})})}function Fi(){const t=ue(v),n=E(),[a,o]=C(void 0);return e($,{children:[e(W,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${a||""}`,onClick:i=>{i.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(i.preventDefault(),o(s=>s?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(Oi,{state:a,anchorRef:n,onClose:()=>o(void 0)})]})}const zi=30,Bi=5;function Oi({anchorRef:t,state:n,onClose:a}){const{masto:o,instance:i}=B(),s=ue(v),[l,d]=C("default"),h=o.v1.notifications.list({limit:zi});async function u(){const m=await h.next(),p=m.value;if(p!=null&&p.length){p.forEach(g=>{Ie(g.status,i,{skipThreading:!0})});const y=jn(p);v.notificationsLast=p[0],v.notifications=y,o.v1.markers.create({notifications:{lastReadId:p[0].id}}).catch(()=>{})}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),m}const[r,f]=C(!1);function b(){return o.v1.followRequests.list({limit:1})}function c(){d("loading"),(async()=>{try{await u();const m=await b();f(!!(m!=null&&m.length)),d("default")}catch{d("error")}})()}return N(()=>{n==="open"&&c()},[n]),e(Ln,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:a,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:s.notifications.length?e($,{children:s.notifications.slice(0,Bi).map(m=>e(Ht,{instance:i,notification:m},m.id))}):l==="loading"?e("div",{class:"ui-state",children:e(ve,{abrupt:!0})}):l==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:c,children:"Try again"})})]})}),e("footer",{children:[e(W,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(W,{to:"/notifications",class:"button plain2",children:[r?e($,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const qi=Ve(Ui),Hi=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,Vi=/\/notes\/([^\/]+)\/?$/i;function Kn(t){const{hostname:n,pathname:a}=new URL(t),[,o,i,s]=a.match(Hi)||[];if(s)return`/${n}/s/${s}`;const[,l]=a.match(Vi)||[];if(l)return`/${n}/s/${l}`}function ji(){const n=st().pathname.replace(/^\//,""),a=Kn(n);return ze(()=>{a&&setTimeout(()=>{window.location.hash=a+"?view=full"},300)},[a]),e("div",{class:"ui-state",tabIndex:"-1",children:[a?e($,{children:[e("h2",{children:"Redirecting…"}),e("p",{children:e("a",{href:`#${a}?view=full`,children:a})})]}):e($,{children:[e("h2",{children:"Unable to process URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(W,{to:"/",children:"Go home"})})]})}function Gi(){const{masto:t}=B();$e("Lists","/l");const[n,a]=C("default"),[o,i]=Ct(u=>u+1,0),[s,l]=C([]);N(()=>{a("loading"),(async()=>{try{const u=await t.v1.lists.list();u.sort((r,f)=>r.title.localeCompare(f.title)),l(u),a("default")}catch{a("error")}})()},[o]);const[d,h]=C(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(lt,{}),e(W,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>h(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(u=>e("li",{children:e(W,{to:`/l/${u.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:u.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(ve,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),d&&e(ge,{class:"light",onClick:u=>{u.target===u.currentTarget&&h(!1)},children:e(qt,{list:d==null?void 0:d.list,onClose:u=>{u.state==="success"&&i(),h(!1)}})})]})}const Wi=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:Ki,VITE_WEBSITE:Yi}={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Gt="read write follow push";async function Ji({instanceURL:t}){const n=new URLSearchParams({client_name:Ki,redirect_uris:location.origin+location.pathname,scopes:Gt,website:Yi});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Xi({instanceURL:t,client_id:n}){const a=new URLSearchParams({client_id:n,scope:Gt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${a.toString()}`}async function Zi({instanceURL:t,client_id:n,client_secret:a,code:o}){const i=new URLSearchParams({client_id:n,client_secret:a,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:o,scope:Gt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()})).json()}function Qi(){$e("Log in");const t=E(),n=Z.local.get("instanceURL"),[a,o]=C("default"),[i]=Be(),s=i.get("instance"),[l,d]=C(s||(n==null?void 0:n.toLowerCase())||""),[h,u]=C([]);N(()=>{(async()=>{try{const m=await(await fetch(Wi)).json();u(m)}catch{}})()},[]);const r=c=>{Z.local.set("instanceURL",c),(async()=>{o("loading");try{const{client_id:m,client_secret:p,vapid_key:y}=await Ji({instanceURL:c});m&&p?(Z.session.set("clientID",m),Z.session.set("clientSecret",p),Z.session.set("vapidKey",y),location.href=await Xi({instanceURL:c,client_id:m})):alert("Failed to register application"),o("default")}catch{o("error")}})()},f=c=>{c.preventDefault();const{elements:m}=c.target;let p=m.instanceURL.value.toLowerCase();p=p.replace(/^https?:\/\//,"").replace(/\/+$/,""),p=p.replace(/^@?[^@]+@/,""),/\./.test(p)||(p=h.find(y=>y.includes(p))),r(p)},b=l?h.filter(c=>c.includes(l)).sort((c,m)=>{const p=c.toLowerCase().startsWith(l.toLowerCase()),y=m.toLowerCase().startsWith(l.toLowerCase());return p&&!y?-1:!p&&y?1:0}).slice(0,10):[];return e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:f,children:[e("h1",{children:"Log in"}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:l,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:a==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:c=>{d(c.target.value)}}),(b==null?void 0:b.length)>0?e("ul",{id:"instances-suggestions",children:b.map(c=>e("li",{children:e("button",{type:"button",class:"plain4",onClick:()=>{r(c)},children:c})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),a==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{class:"large",disabled:a==="loading",children:"Log in"})," "]}),e(ve,{hidden:a!=="loading"}),e("hr",{}),e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(W,{to:"/",children:"Go home"})})]})})}const pt=5,At=40;function eo(t){const n=Ye(),{masto:a,instance:o,authenticated:i}=B({instance:n.instance}),[s,l]=C("default"),[d]=Be(),h=E(),u=(t==null?void 0:t.query)||d.get("q"),r=(t==null?void 0:t.type)||d.get("type");$e(u?`Search: ${u}${r?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[r]})`:""}`:"Search","/search");const[f,b]=C(!1),c=E(0);N(()=>{c.current=0},[u,r]);const m=E();ze(()=>{var D,M;(M=(D=m.current)==null?void 0:D.scrollTo)==null||M.call(D,0,0)},[u,r]);const[p,y]=C([]),[g,S]=C([]),[k,I]=C([]);N(()=>{y([]),S([]),I([])},[u]);const x={statuses:y,accounts:S,hashtags:I};function _(D){l("loading"),D&&!r&&(y(p.slice(0,pt)),S(g.slice(0,pt)),I(k.slice(0,pt))),(async()=>{var H,ne;const M={q:u,resolve:i,limit:pt};r&&(M.limit=At,M.type=r,i&&(M.offset=c.current));try{const L=await a.v2.search.fetch(M);if(r)if(D){x[r](L[r]);const F=(H=L[r])==null?void 0:H.length;c.current=At,b(!!F)}else{x[r](J=>[...J,...L[r]]);const F=(ne=L[r])==null?void 0:ne.length;c.current=c.current+At,b(!!F)}else y(L.statuses),S(L.accounts),I(L.hashtags),c.current=0,b(!1);l("default")}catch{l("error")}})()}return N(()=>{var D,M,H,ne;u?((M=(D=h.current)==null?void 0:D.setValue)==null||M.call(D,u),_(!0)):(ne=(H=h.current)==null?void 0:H.focus)==null||ne.call(H)},[u,r,o]),Ce("/",D=>{var M,H;(H=(M=h.current)==null?void 0:M.focus)==null||H.call(M)},{preventDefault:!0}),e("div",{id:"search-page",class:"deck-container",ref:m,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:s==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(lt,{})}),e(zn,{ref:h}),e("div",{class:"header-side",children:" "})]})}),e("main",{children:[!!u&&e("div",{class:`filter-bar ${s==="loading"?"loading":""}`,children:[!!r&&e(W,{to:`/search${u?`?q=${encodeURIComponent(u)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(u)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(u)}&type=statuses`}].sort((D,M)=>D.type===r?-1:M.type===r?1:0).map(D=>e(W,{to:D.to,children:D.label},D.type))]}),u?e($,{children:[(!r||r==="accounts")&&e($,{children:[r!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),g.length>0?e($,{children:[e("ul",{class:"timeline flat accounts-list",children:g.map(D=>e("li",{children:e(Fe,{account:D,instance:o,showStats:!0})},D.id))}),r!=="accounts"&&e("div",{class:"ui-state",children:e(W,{class:"plain button",to:`/search?q=${u}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!r&&(s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!r||r==="hashtags")&&e($,{children:[r!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),k.length>0?e($,{children:[e("ul",{class:"link-list hashtag-list",children:k.map(D=>e("li",{children:e(W,{to:o?`/${o}/t/${D.name}`:`/t/${D.name}`,children:[e(w,{icon:"hashtag"}),e("span",{children:D.name})]})},D.name))}),r!=="hashtags"&&e("div",{class:"ui-state",children:e(W,{class:"plain button",to:`/search?q=${u}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!r&&(s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!r||r==="statuses")&&e($,{children:[r!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),p.length>0?e($,{children:[e("ul",{class:"timeline",children:p.map(D=>e("li",{children:e(W,{class:"status-link",to:o?`/${o}/s/${D.id}`:`/s/${D.id}`,children:e(Te,{status:D})})},D.id))}),r!=="statuses"&&e("div",{class:"ui-state",children:e(W,{class:"plain button",to:`/search?q=${u}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!r&&(s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!r&&(s==="default"?f?e(it,{onChange:D=>{D&&_()},children:e("button",{type:"button",class:"plain block",onClick:()=>_(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}))]}):s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const mt=40,to=10,no=5;let Nt={},yt={},wt={};function Ut(t){delete yt[t],delete wt[t]}const gt={block:"nearest",inline:"center",behavior:"smooth"};function so(t){const{id:n}=t,{masto:a,instance:o}=B({instance:t.instance}),i=ue(v),[s,l]=Be(),d=s.get("media"),h=s.get("media-only"),u=parseInt(d||h,10);let r=u>0;const f=s.get("mediaStatusID"),b=In(f,o);f&&!b&&(r=!1);const c=r&&!!h,m=zt(n,o),[p,y]=C(v.statuses[m]);N(()=>{v.statuses[m]&&y(v.statuses[m])},[m]);const g=me(()=>{const{prevLocation:I}=v,x=((I==null?void 0:I.pathname)||"")+((I==null?void 0:I.search)||""),_=at("/:instance/s/:id",x)||at("/s/:id",x);return!x||_?"/":x},[]);N(()=>{!p&&r&&(async()=>{try{const I=await a.v1.statuses.$select(n).fetch();Ie(I,o),y(I)}catch{alert("Unable to load post."),location.hash=g}})()},[r]);const S=f?b==null?void 0:b.mediaAttachments:p==null?void 0:p.mediaAttachments,k=We(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&i.prevLocation?history.back():c?location.hash=g:(s.delete("media"),s.delete("mediaStatusID"),l(s))},[c,g,i.prevLocation]);return e("div",{class:"deck-backdrop",children:[r?S!=null&&S.length?e(Un,{mediaAttachments:S,statusID:f||n,instance:o,lang:p==null?void 0:p.language,index:u-1,onClose:k}):e("div",{class:"media-modal-container loading",children:e(ve,{abrupt:!0})}):e(W,{to:g}),!c&&e(io,{id:n,instance:t.instance,closeLink:g})]})}function io({id:t,closeLink:n="/",instance:a}){var Q;const[o,i]=Be(),s=o.get("media"),l=parseInt(s,10)>0,[d,h]=C(o.get("view")),u=!!parseInt(o.get("translate")),{masto:r,instance:f}=B({instance:a}),{masto:b,instance:c,authenticated:m}=B(),p=f===c,y=ue(v),[g,S]=C([]),[k,I]=C("default"),x=E(),_=zt(t,f),D=E(0),M=E();N(()=>{var T;(T=M.current)==null||T.focus()},[]),N(()=>{var R;const T=Rn(()=>{if(!M.current)return;const{scrollTop:q}=M.current;k!=="loading"&&(wt[t]=q)},50);return(R=M.current)==null||R.addEventListener("scroll",T,{passive:!0}),T(),()=>{var q;T.cancel(),(q=M.current)==null||q.removeEventListener("scroll",T)}},[t,k!=="loading"]);const H=E(),ne=({reloadHero:T}={})=>{I("loading");let R;const q=yt[t];if(q){const P=q.filter(ee=>v.statuses[_]);S(P)}else S([{id:t}]);return(async()=>{var he,Re;const P=()=>en(()=>r.v1.statuses.$select(t).fetch(),{retries:4}),ee=en(()=>r.v1.statuses.$select(t).context.fetch(),{retries:8}),ke=!!y.statuses[_];let se=y.statuses[_];if(!(ke&&!T))try{se=await P(),Ie(se,f),await new Promise(fe=>{setTimeout(fe,100)})}catch{I("error");return}try{let fe=function(j){return j==null?void 0:j.map(pe=>({id:pe.id,account:pe.account,repliesCount:pe.repliesCount,content:pe.content,weight:ct(pe),replies:fe(pe.__replies)}))};const Ee=await ee,{ancestors:U,descendants:le}=Ee;D.current=(le==null?void 0:le.length)||0;const be=new Set;U.forEach(j=>{Ie(j,f,{skipThreading:!0}),j.inReplyToId&&!U.find(pe=>pe.id===j.inReplyToId)&&be.add(j.inReplyToId)});const ye=U.every(j=>j.account.id===se.account.id),_e=[];le.forEach(j=>{if(Ie(j,f,{skipThreading:!0}),j.inReplyToId&&!le.find(pe=>pe.id===j.inReplyToId)&&j.inReplyToId!==se.id&&be.add(j.inReplyToId),j.inReplyToAccountId===j.account.id)_e.push(j);else if(j.inReplyToId===se.id)_e.push(j);else if(!j.inReplyToAccountId&&_e.find(pe=>pe.id===j.inReplyToId)&&j.account.id===se.account.id)_e.push(j);else{const pe=le.find(Je=>Je.id===j.inReplyToId);pe&&(pe.__replies||(pe.__replies=[]),pe.__replies.push(j))}}),be.size;const Ue=[...U.map(j=>({id:j.id,ancestor:!0,isThread:ye,accountID:j.account.id,account:j.account,repliesCount:j.repliesCount,weight:ct(j)})),{id:t,accountID:se.account.id,weight:ct(se)},..._e.map(j=>({id:j.id,account:j.account,accountID:j.account.id,descendant:!0,thread:j.account.id===se.account.id,weight:ct(j),replies:fe(j.__replies)}))];I("default"),H.current={offsetTop:(he=x.current)==null?void 0:he.offsetTop,scrollTop:(Re=M.current)==null?void 0:Re.scrollTop};const Me=Ue.findIndex(j=>j.id===t);Me>=G&&oe(Me+1),S(Ue),yt[t]=Ue,os(se,f)}catch{I("error")}})(),()=>{clearTimeout(R)}};N(ne,[t,r]),N(()=>{var R,q;if(!g.length)return;const T=wt[t];if(T)M.current.scrollTop=T;else if(H.current){const P={offsetTop:(R=x.current)==null?void 0:R.offsetTop,scrollTop:(q=M.current)==null?void 0:q.scrollTop},ee=P.offsetTop-H.current.offsetTop+P.scrollTop;M.current.scrollTop=ee}else g.length===1&&(M.current.scrollTop=0);H.current=null},[g]),N(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:T}=tt(),R=`https://${T}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(R,{ignoreVary:!0}),ne({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),N(()=>()=>{wt={},v.reloadStatusPage=0,yt={},Nt={},Ft.clear()},[]);const L=y.statuses[_]||y.statuses[t],F=me(()=>{if(!L)return"";const{account:T}=L,R=document.createElement("div");return R.innerHTML=T.displayName,R.innerText.trim()},[L]),J=me(()=>{if(!L)return"";let T=kn(L);return T.length>64&&(T=T.slice(0,64)+"…"),T},[L]);$e(F&&J?`${F}: "${J}"`:"Status","/:instance?/s/:id");const ie=me(()=>{if(!L)return;const{url:T}=L;if(T)return new URL(T).hostname},[L]),Ae=me(()=>{if(ie)return ie===f},[ie,f]),[G,oe]=C(mt),V=me(()=>g.length-G,[g.length,G]),A=g.some(T=>T.descendant),O=g.filter(T=>T.ancestor),[K,ae]=C(!0),Se=St(ae,100),Le=me(()=>{if(!x.current||K)return null;const{top:T}=x.current.getBoundingClientRect();return T>0?"down":"up"},[K]);Ce("esc",()=>{location.hash=n},{enabled:!l}),Ce("backspace",()=>{location.hash=n}),Ce("j",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),R=T==null?void 0:T.getBoundingClientRect(),q=Array.from(M.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(T&&R.top<M.current.clientHeight&&R.bottom>0){const P=q.indexOf(T);let ee=q[P+1];ee&&(ee.focus(),ee.scrollIntoView(gt))}else{const P=q.find(ee=>{const ke=ee.getBoundingClientRect();return ke.top>=44&&ke.left>=0});P&&(P.focus(),P.scrollIntoView(gt))}}),Ce("k",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),R=T==null?void 0:T.getBoundingClientRect(),q=Array.from(M.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(T&&R.top<M.current.clientHeight&&R.bottom>0){const P=q.indexOf(T);let ee=q[P-1];ee&&(ee.focus(),ee.scrollIntoView(gt))}else{const P=q.find(ee=>{const ke=ee.getBoundingClientRect();return ke.top>=44&&ke.left>=0});P&&(P.focus(),P.scrollIntoView(gt))}}),Ce("x",()=>{const T=document.activeElement.closest(".status-link, .status-focus");if(T){const R=T.nextElementSibling;R&&R.tagName.toLowerCase()==="details"&&(R.open=!R.open)}});const{nearReachStart:re}=xt({scrollableRef:M,distanceFromStartPx:16}),z=E(l?"media+status":"status"),X=We((T,R,q,P)=>{T.preventDefault(),T.stopPropagation(),i({media:R+1,mediaStatusID:P.id})},[t]),Y=We((T,R)=>{Ut(R.id)},[]),ce=T=>{const{id:R,ancestor:q,isThread:P,descendant:ee,thread:ke,replies:se,repliesCount:he,weight:Re}=T,fe=R===t;return e("li",{ref:fe?x:null,class:`${q?"ancestor":""} ${ee?"descendant":""} ${ke?"thread":""} ${fe?"hero":""}`,children:[fe?e($,{children:[e(it,{threshold:.1,onChange:Se,class:"status-focus",tabIndex:0,children:e(Te,{statusID:R,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:u})}),k!=="loading"&&!m?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(W,{to:"/login",class:"button",children:"Log in"})]}):!p&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:k==="loading",onClick:()=>{I("loading"),(async()=>{try{const Ee=await b.v2.search.fetch({q:L.url,type:"statuses",resolve:!0,limit:1});if(Ee.statuses.length){const U=Ee.statuses[0];location.hash=c?`/${c}/s/${U.id}`:`/s/${U.id}`}else throw new Error("No results")}catch(Ee){I("default"),alert("Error: "+Ee)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(W,{class:"status-link",to:f?`/${f}/s/${R}`:`/s/${R}`,onClick:()=>{Ut(R)},children:[e(Te,{statusID:R,instance:f,withinContext:!0,size:ke||q?"m":"s",enableTranslate:!0,onMediaClick:X,onStatusLinkClick:Y}),q&&P&&he>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:he,children:Pe(he)})]})," "]}),ee&&(se==null?void 0:se.length)>0&&e(Yn,{instance:f,replies:se,hasParentThread:ke,level:1,accWeight:Re,openAll:D.current<to}),k==="loading"&&fe&&!!(L!=null&&L.repliesCount)&&!A&&e("div",{class:"status-loading",children:e(ve,{})}),k==="error"&&fe&&!!(L!=null&&L.repliesCount)&&!A&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]},R)};return e("div",{tabIndex:"-1",ref:M,class:`status-deck deck contained ${g.length>1?"padded-bottom":""} ${z.current==="status"?"slide-in":""} ${d?`deck-view-${d}`:""}`,onAnimationEnd:T=>{z.current==="status"&&(z.current=null)},children:[e("header",{class:`${K?"inview":""} ${k==="loading"?"loading":""}`,onDblClick:T=>{v.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[!!/\/s\//i.test((Q=y.prevLocation)==null?void 0:Q.pathname)&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!K&&L&&k!=="loading"?e($,{children:[e("span",{class:"hero-heading",children:[e(vt,{account:L.account,instance:f,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(Tt,{datetime:L.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),x.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:Le==="down"?"arrow-down":"arrow-up"})})]}):e($,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),M.current.scrollTo({top:0,behavior:"smooth"})},hidden:!O.length||re,title:`${O.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),O.filter((T,R,q)=>q.findIndex(P=>P.accountID===T.accountID)===R).slice(0,3).map(T=>e(Ge,{url:T.account.avatar,alt:T.account.displayName},T.account.id)),O.length>3&&e($,{children:[" ",e("span",{class:"insignificant",children:Pe(O.length)})]})]})]})]}),e("div",{class:"header-side",children:[e(Ke,{align:"end",portal:{target:M.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(te,{disabled:k==="loading",onClick:()=>{v.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(te,{className:"menu-switch-view",onClick:()=>{h(d==="full"?null:"full"),o.delete("media"),o.delete("media-only"),d==="full"?o.delete("view"):o.set("view","full"),i(o)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[d||""]}),e("span",{children:["Switch to ",d==="full"?"Side Peek":"Full"," view"]})]}),e(te,{onClick:()=>{Array.from(M.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(R=>{R.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(De,{}),e(gs,{className:"plain",children:"Experimental"}),e(te,{disabled:Ae,onClick:()=>{const T=Kn(L.url);T?location.hash=T:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance (",e("b",{children:ie}),")"]})]})]}),e(W,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),g.length&&L?e("ul",{class:`timeline flat contextual grow ${k==="loading"?"loading":""}`,children:[g.slice(0,G).map(ce),V>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:k==="loading",onClick:()=>oe(T=>T+mt),style:{marginBlockEnd:"6em"},children:[e("div",{class:"ib avatars-bunch",children:g.slice(G,G+5).map(T=>e(Ge,{url:T.account.avatarStatic},T.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:V>mt?`${mt}+`:V})]})]})})]}):e($,{children:[k==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Te,{skeleton:!0,size:"l"})})}),k==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]})]})}function Yn({replies:t,instance:n,hasParentThread:a,level:o,accWeight:i,openAll:s}){const[l,d]=Be(),h=g=>g.reduce((S,k)=>{const{repliesCount:I,replies:x}=k,_=(x==null?void 0:x.length)||I;return S+_+h(x||[])},0),u=t.length+h(t),r=t.length===u,f=t.map(g=>g.account).filter((g,S,k)=>k.findIndex(I=>I.id===g.id)===S).slice(0,3),b=me(()=>t==null?void 0:t.reduce((g,S)=>g+(S==null?void 0:S.weight),i),[i,t==null?void 0:t.length]);let c=!1;(s||b<=no||!a&&u===1&&ct(t[0])<2)&&(c=!0);const m=Nt[t[0].id],p=We((g,S,k,I)=>{g.preventDefault(),g.stopPropagation(),d({media:S+1,mediaStatusID:I.id})},[]),y=E();return ze(()=>{var S;function g(k){k.target.dataset.scrollLeft=k.target.scrollLeft}return(S=y.current)==null||S.addEventListener("scroll",g,{passive:!0}),()=>{var k;(k=y.current)==null||k.removeEventListener("scroll",g)}},[]),e("details",{ref:y,class:"replies",open:m||c,onToggle:g=>{const{open:S}=g.target;Nt[t[0].id]=S},style:{"--comments-level":o},"data-comments-level":o,"data-comments-level-overflow":o>4,children:[e("summary",{class:"replies-summary",hidden:c,children:[e("span",{class:"avatars",children:f.map(g=>e(Ge,{url:g.avatarStatic,title:`${g.displayName} @${g.username}`,squircle:g==null?void 0:g.bot},g.id))}),e("span",{children:[e("span",{title:t.length,children:Pe(t.length)})," ","repl",t.length===1?"y":"ies"]}),!r&&u>1&&e($,{children:[" ","·"," ",e("span",{children:[e("span",{title:u,children:Pe(u)})," ","comment",u===1?"":"s"]})]})]}),e("ul",{children:t.map(g=>{var S,k;return e("li",{children:[e(W,{class:"status-link",to:n?`/${n}/s/${g.id}`:`/s/${g.id}`,onClick:()=>{Ut(g.id)},children:[e(Te,{statusID:g.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:p}),!((S=g.replies)!=null&&S.length)&&g.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:g.repliesCount,children:Pe(g.repliesCount)})]})]}),((k=g.replies)==null?void 0:k.length)&&e(Yn,{instance:n,replies:g.replies,level:o+1,accWeight:c?b:g.weight,openAll:s})]},g.id)})})]})}const oo=140,co=35,ao=70,ro=140,Ft=new Map;function ct(t){var c,m;const n=Ft.get(t.id);if(n)return n;const{spoilerText:a,content:o,mediaAttachments:i,poll:s,card:l}=t,d=cs(a+o),h=i!=null&&i.length?oo:0,u=(((c=s==null?void 0:s.options)==null?void 0:c.length)||0)*co,r=l&&(i!=null&&i.length||(m=s==null?void 0:s.options)!=null&&m.length)?0:ao,b=(d+h+u+r)/ro;return Ft.set(t.id,b),b}const lo=Ve(so);function uo(){const t=Ye(),{id:n,instance:a}=t;return e(lo,{id:n,instance:a})}const ho=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,fo=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,po=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,mo=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,go=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,bo=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function pn(){return $e(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("h1",{children:[e("img",{src:An,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:bo,alt:"Phanpy",width:"250"})]}),e("p",{children:e("big",{children:e("b",{children:e(W,{to:"/login",class:"button",children:"Log in"})})})}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:ho,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:go,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:fo,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:po,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:mo,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),e("hr",{}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const yo=window.alert;window.__nativeAlert||(window.__nativeAlert=yo);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=bs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=v;setTimeout(()=>{var t,n,a,o;for(const i in ht)Array.isArray(ht[i])?(n=(t=ht[i])[0])==null||n.call(t):(o=(a=ht)[i])==null||o.call(a)},5e3);(()=>{window.__IDLE__=!1;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],a=Rn(()=>{window.__IDLE__=!0},5e3),o=()=>{window.__IDLE__=!1,a()};t.forEach(i=>{window.addEventListener(i,o,{passive:!0,capture:!0})})})();$n(v,t=>{var n;for(const[a,o,i,s]of t){if(o.join(".")==="settings.shortcutsViewMode"){const l=document.getElementById("app");l&&(l.dataset.shortcutsViewMode=(n=v.shortcuts)!=null&&n.length?i:"")}o.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",i)}});function wo(){const[t,n]=C(!1),[a,o]=C("loading");ze(()=>{const s=Z.local.get("theme");s&&(document.documentElement.classList.add(`is-${s}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",s==="auto"?"dark light":s));const l=Z.local.get("textSize");l&&document.documentElement.style.setProperty("--text-size",`${l}px`)},[]),N(()=>{const s=Z.local.get("instanceURL"),l=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(l){window.history.replaceState({},document.title,i.pathname||"/");const d=Z.session.get("clientID"),h=Z.session.get("clientSecret"),u=Z.session.get("vapidKey");(async()=>{o("loading");const{access_token:r}=await Zi({instanceURL:s,client_id:d,client_secret:h,code:l}),f=as({instance:s,accessToken:r});await Promise.allSettled([Jt(f,s),rs(f,s,r,u)]),Xt(),Zt(f),n(!0),o("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const d=tt();if(d){Z.session.set("currentAccount",d.info.id);const{client:h}=B({account:d}),{instance:u}=h;Xt(),Zt(h),o("loading"),(async()=>{try{await Jt(h,u)}catch{}finally{n(!0),o("default")}})()}else o("default")}},[]);let i=st();return v.currentLocation=i.pathname,N(Dt,[i,t]),/\/https?:/.test(i.pathname)?e(ji,{}):e($,{children:[e(vo,{isLoggedIn:t,loading:a==="loading"}),e(So,{isLoggedIn:t}),a==="default"&&e(Bt,{children:e(we,{path:"/:instance?/s/:id",element:e(uo,{})})}),t&&e(Ss,{}),t&&e(si,{}),e(Qs,{}),t&&e(ei,{}),e(vs,{isLoggedIn:t}),a!=="loading"&&e(ti,{onClose:Dt}),e(ks,{})]})}function vo({isLoggedIn:t,loading:n}){const a=st(),o=me(()=>{const{pathname:i}=a;return!/^\/(login|welcome)/.test(i)},[a]);return e(Bt,{location:o||a,children:[e(we,{path:"/",element:t?e(qi,{}):n?e(ve,{id:"loader-root"}):e(pn,{})}),e(we,{path:"/login",element:e(Qi,{})}),e(we,{path:"/welcome",element:e(pn,{})})]})}function So({isLoggedIn:t}){const n=ue(v),a=st(),o=n.prevLocation,i=E(o||null);return me(()=>at("/:instance/s/:id",a.pathname)||at("/s/:id",a.pathname),[a.pathname,at])?i.current||(i.current=o):i.current=null,e(Bt,{location:i.current||a,children:[t&&e($,{children:[e(we,{path:"/notifications",element:e(Gn,{})}),e(we,{path:"/mentions",element:e(Vn,{})}),e(we,{path:"/following",element:e(jt,{})}),e(we,{path:"/b",element:e(Bn,{})}),e(we,{path:"/f",element:e(On,{})}),e(we,{path:"/l",children:[e(we,{index:!0,element:e(Gi,{})}),e(we,{path:":id",element:e(Hn,{})})]}),e(we,{path:"/ft",element:e(bi,{})})]}),e(we,{path:"/:instance?/t/:hashtag",element:e(qn,{})}),e(we,{path:"/:instance?/a/:id",element:e(hi,{})}),e(we,{path:"/:instance?/p",children:[e(we,{index:!0,element:e(Pt,{})}),e(we,{path:"l",element:e(Pt,{local:!0})})]}),e(we,{path:"/:instance?/trending",element:e(Wn,{})}),e(we,{path:"/:instance?/search",element:e(eo,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));ys(e(ws,{children:e(wo,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-36064a78.js.map
