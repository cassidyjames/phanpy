{"version":3,"mappings":"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","names":["functionDebounce","debounce","fn","wait","callFirst","timeout","debouncedFn","clear","flush","call","debounceWrapper","context","args","callNow","window","document","event","params","evt","handleTouchStart","handleTouchMove","handleTouchEnd","xDown","yDown","xDiff","yDiff","timeDown","startEl","touchCount","e","swipeThreshold","getNearestAttribute","swipeUnit","swipeTimeout","timeDiff","eventType","changedTouches","eventData","xUp","yUp","el","attributeName","defaultValue","attributeValue","usePageVisibility","deps","savedCallback","useRef","useEffect","current","handleVisibilityChange","hidden","visibilityState","console","addEventListener","STREAMING_TIMEOUT","POLL_INTERVAL","BackgroundService","memo","isLoggedIn","t","_useLingui","visible","setVisible","useState","visibleTimeout","clearTimeout","setTimeout","checkLatestNotification","masto","instance","skipCheckMarkers","states","notificationsLast","notificationsIterator","v1","notifications","list","limit","sinceId","id","values","value","next","length","notificationsShowNew","lastReadId","markers","fetch","timeline","sub","streamTimeout","pollNotifications","streaming","api","hasStreaming","user","notification","subscribe","entry","skipThreading","unsubscribe","clearInterval","r","info","useInterval","checkForUpdates","lastCheckDate","now","appVersion","currentCloakMode","_t","useHotkeys","showToast","fetchLatestPostsMemoized","pmem","currentAccountID","statusesIterator","accounts","$select","statuses","exclude_replies","exclude_reblogs","expires","ComposeButton","snapStates","useSnapshot","menuOpen","setMenuOpen","latestPosts","setLatestPosts","loadingPosts","setLoadingPosts","buttonRef","menuRef","columnMode","settings","shortcutsViewMode","handleButton","key","toLowerCase","composerState","minimized","openOSK","composeDataElements","querySelectorAll","opts","JSON","parse","undefined","shiftKey","openCompose","showCompose","useKey","ignoreEventWhen","querySelector","metaKey","ctrlKey","altKey","bindLongPress","useLongPress","threshold","fetchLatestPosts","useCallback","getCurrentAccountID","posts","handleReplyToPost","post","replyToStatus","_jsxs","_Fragment","children","_jsx","ref","type","onClick","onContextMenu","preventDefault","class","publishing","publishingError","Icon","icon","size","alt","ControlledMenu","state","anchorRef","onClose","direction","gap","unmountOnClose","portal","target","body","boundingBoxPadding","safeBoundingBoxPadding","containerProps","style","zIndex","closeMenu","submenuOpenDelay","MenuLink","to","_Trans","MenuDivider","SubMenu2","align","shift","disabled","label","className","map","createdDate","Date","createdAt","isWithinDay","getTime","MenuItem","statusPeek","RelativeTime","datetime","format","dateTime","toISOString","title","toLocaleString","niceDateTime","SequentialKeys","key1","key2","components","0","1","KeyboardShortcutsHelp","showKeyboardShortcutsHelp","test","hash","Modal","tabindex","keys","action","2","parents","coords","siblings","animations","intersections","mutationObservers","intervals","options","debounces","enabled","root","scrollX","scrollY","TGT","DEL","NEW","handleMutations","mutations","elements","getElements","animate","handleResizes","entries","updateAllPos","updatePos","isOffscreen","rect","vw","vh","observePosition","oldObserver","invocations","buffer","getCoords","offsetWidth","offsetHeight","rootMargin","px","observer","optionsOrPlugin","getOptions","delay","isPlugin","currentAnimation","parent","forEach","lowPriority","poll","callback","resize","supportedBrowser","nodes","mutation","node","i","child","_a","_b","isMounted","preExisting","add","remain","remove","raw","str","getScrollOffset","p","x","y","getTransitionSizes","oldCoords","newCoords","widthFrom","heightFrom","widthTo","heightTo","styles","paddingY","paddingX","getTarget","isEnabled","callbacks","getPluginTuple","pluginReturn","config","animation","pluginOrOptions","deltaLeft","deltaTop","deltaRight","start","end","keyframes","cleanUp","prev","finalX","finalY","top","left","width","height","deletePosition","adjustScroll","styleReset","scrollDeltaX","scrollDeltaY","scrollBefore","lastHeight","lastWidth","startScroll","smoothScroll","deltaY","deltaX","offsetParent","parentStyles","parentCoords","autoAnimate","element","mo","d","a","io","useAutoAnimate","controller","setController","setEnabled","dec2hex","dec","toString","slice","verifier","array","Uint32Array","crypto","getRandomValues","Array","from","join","sha256","plain","data","TextEncoder","encode","subtle","digest","base64urlencode","bytes","Uint8Array","len","byteLength","String","fromCharCode","btoa","replace","generateCodeChallenge","v","hashed","supportsPKCE","instanceURL","res","ok","status","json","code_challenge_methods_supported","includes","__generateCodeChallenge","DEV","PHANPY_CLIENT_NAME","CLIENT_NAME","PHANPY_WEBSITE","WEBSITE","import","SCOPES","sameSite","location","hostname","currentLocation","origin","pathname","REDIRECT_URI","registerApplication","registrationParams","URLSearchParams","client_name","redirect_uris","scopes","website","method","headers","getPKCEAuthorizationURL","client_id","forceLogin","codeVerifier","codeChallenge","code_challenge_method","code_challenge","redirect_uri","response_type","append","getAuthorizationURL","authorizationParams","scope","getAccessToken","client_secret","code","code_verifier","grant_type","tokenResponse","tokenJSON","token","revokeResponse","isStandalone","matchMedia","matches","Accounts","getAccounts","currentAccount","moreThanOneAccount","_","reload","useReducer","accountsListParent","tabIndex","account","isCurrent","isDefault","isLoggedOut","accessToken","Avatar","url","avatarStatic","onDblClick","log","saveAccounts","NameText","showAcct","setCurrentAccountID","Menu2","menuButton","href","splice","MenuConfirm","subMenu","confirmLabel","menuItemClassName","revokeAccessToken","clientId","clientSecret","store","session","get","Link","showImportExportAccounts","logo","ButtonInstall","HTMLElement","connectedCallback","button","navigator","install","ev","customElements","define","regionMaps","LangSelector","i18n","useLingui","populatedLocales","useMemo","LOCALES","lang","regionlessCode","native","localeCode2Text","locale","fallback","CATALOGS","find","c","nativeName","_common","name","sort","b","order","localeCompare","DEFAULT_LANG","onChange","local","set","activateLang","common","createBackendPushSubscription","subscription","push","create","fetchBackendPushSubscription","updateBackendPushSubscription","update","removeBackendPushSubscription","isPushSupported","getRegistration","serviceWorker","getSubscription","registration","pushManager","urlBase64ToUint8Array","base64String","padding","repeat","base64","rawData","atob","outputArray","charCodeAt","initSubscription","backendSubscription","err","message","sameEndpoint","sameKey","vapidKey","applicationServerKey","vapidKeyStr","applicationServerKeyStr","policy","DEFAULT_TEXT_SIZE","TEXT_SIZES","PHANPY_PRIVACY_POLICY_URL","PRIVACY_POLICY_URL","PHANPY_TRANSLANG_INSTANCES","TRANSLANG_INSTANCES","PHANPY_IMG_ALT_API_URL","IMG_ALT_API_URL","PHANPY_GIPHY_API_KEY","GIPHY_API_KEY","targetLanguages","Object","languages","tl","TRANSLATION_API_NAME","Settings","currentTheme","themeFormRef","targetLanguage","contentTranslationTargetLanguage","systemTargetLanguage","getTranslateTargetLanguage","systemTargetLanguageText","currentTextSize","prefs","setPrefs","getPreferences","authenticated","expTabBarV2","setExpTabBarV2","disableQuotePolicy","onInput","formData","FormData","theme","documentElement","html","classList","$manualMeta","$autoMetas","m","toggle","defaultChecked","min","max","step","parseInt","setProperty","rel","for","source","newPrefs","setPreferences","supportsNativeQuote","alert","checked","autoRefresh","boostsCarousel","contentTranslation","showCommon","contentTranslationHideLanguages","contentTranslationAutoInline","composerGIFPicker","mediaAltGenerator","shortcutSettingsCloudImportExport","cloakMode","showDrafts","PushNotificationsSection","display","flexWrap","alignItems","marginTop","src","aspectRatio","background","borderRadius","showAccount","readOnly","select","warn","_t2","pushFormRef","setNeedRelogin","previousPolicyRef","allowNotifications","setUIState","needRelogin","alerts","setAllowNotifications","alert2","policyEl","fromEntries","mention","favourite","reblog","follow","followRequest","alertsCount","policyChanged","allowNotifications2","updateSubscription","removeSubscription","catch","isLoading","permission","Notification","focusDeck","timer","columns","getElementById","focusedColumn","focus","firstVisibleColumn","column","getBoundingClientRect","modals","modal","modalFocusElement","pages","page","useLocationChange","useLocation","currentLocationRef","AccountHandleInfo","acct","username","server","split","encodedAcct","punycode","toASCII","SUPPORTED_IMAGE_FORMATS","SUPPORTED_IMAGE_FORMATS_STR","FieldsAttributesRow","index","hasValue","setHasValue","maxLength","required","dir","enterKeyHint","currentTarget","EditProfileSheet","uiState","setAccount","headerPreview","setHeaderPreview","avatarPreview","setAvatarPreview","acc","verifyCredentials","displayName","avatar","header","note","fields","fieldsAttributesRef","avatarMediaAttachments","headerMediaAttachments","abrupt","fieldsAttributesFields","field","fieldsAttributes","newAccount","header2","error","file","accept","blob","mediaAttachments","mediaIndex","Math","ENDORSEMENTS_LIMIT","Endorsements","accountID","open","onlyOpenIfHasEndorsements","endorsementsContainer","endorsementsUIState","setEndorsementsUIState","endorsements","setEndorsements","relationshipsMap","setRelationshipsMap","supports","behavior","block","fetchRelationships","relationships","reallyOpen","Loader","AccountBlock","avatarSize","relationship","_isSearchEnabled","v2","search","q","isSearchEnabled","FETCH_MAX_AGE","MAX_AGE","fetchLists","lists","updatedAt","getLists","fetchList","getList","theList","getListTitle","addListStore","updateListStore","deleteListStore","listID","findIndex","ListExclusiveBadge","insignificant","ListAddEdit","editMode","nameFieldRef","repliesPolicyFieldRef","exclusiveFieldRef","repliesPolicy","exclusive","supportsExclusive","onSubmit","listResult","replies_policy","AddRemoveListsSheet","setLists","listsContainingAccount","setListsContainingAccount","reloadCount","listsContainingAccount2","setShowListAddEditModal","showListAddEditModal","inList","l","accountIds","PrivateNoteSheet","initialNote","onRelationshipChange","textareaRef","trim","newRelationship","comment","TranslatedBioSheet","fieldsText","getHTMLText","text","whiteSpace","TranslationBlock","forceTranslate","MUTE_DURATIONS","MUTE_DURATIONS_LABELS","i18nDuration","RelatedActions","standalone","setShowEditProfile","showEndorsements","renderEndorsements","setRenderEndorsements","currentMasto","currentInstance","currentAuthenticated","sameInstance","relationshipUIState","setRelationshipUIState","setRelationship","locked","lastStatusAt","moved","following","showingReblogs","notifying","followedBy","blocking","blockedBy","muting","mutingNotifications","requested","domainBlocking","endorsed","privateNote","currentInfo","setCurrentInfo","isSelf","setIsSelf","acctWithInstance","supportsEndorsements","currentID","acctHasInstance","results","resolve","updateAccount","setShowTranslatedBio","setShowAddRemoveLists","showPrivateNoteModal","setShowPrivateNoteModal","loading","showTranslatedBio","showAddRemoveLists","setSearchEnabled","searchEnabled","headerStatic","hideTime","showQrCodeModal","backgroundMask","caption","onScannerClick","position","overflow","lists2","onMenuChange","draftStatus","query","handle","openTrigger","duration","textOverflow","reloadGenericAccounts","counter","confirm","showReportModal","relationship2","urlObj","host","LIMIT","ACCOUNT_INFO_MAX_AGE","fetchFamiliarFollowers","familiarFollowers","memFetchFamiliarFollowers","fetchPostingStats","fetchStatuses","stats","total","originals","replies","boosts","memFetchPostingStats","isValidUrl","string","handleScannerClick","actionableText","hideAllModals","AccountInfo","fetchAccount","isString","setInfo","sameCurrentInstance","info2","bot","emojis","group","statusesCount","memorial","roles","hideCollections","headerIsAvatar","infoHasEssentials","account2","updated","headerCornerColors","setHeaderCornerColors","followersIterator","accountInstance","firstLoad","familiarFollowersCache","newValue","familiarFollowers2","familiar","followingIterator","LinkOrDiv","accountLink","postingStats","setPostingStats","renderFamiliarFollowers","setFamiliarFollowers","postingStatsUIState","setPostingStatsUIState","followers","renderPostingStats","onProfileUpdate","isStringURL","skeleton","stopPropagation","onError","ctx","canvas","crossOrigin","onLoad","pixelDimension","rgbColors","OffscreenCanvas","createElement","willReadFrequently","imageSmoothingEnabled","drawImage","colors","g","dataLength","lightenRGB","color","handleWithInstance","arena","showMediaModal","internal","handleContentLinks","dangerouslySetInnerHTML","verifiedAt","__html","EmojiText","fetchFollowers","showGenericAccounts","heading","fetchAccounts","excludeRelationshipAttrs","blankCopy","follower","followersCount","shortenNumber","fetchFollowing","followingCount","hasPostingStats","3","_i18n","daysSinceLastPost","luminence","alpha","AccountSheet","propInstance","lookup","skip_webfinger","result","accountWithSameString","startsWith","accountURL","URL","Drafts","drafts","setDrafts","db","ns","getCurrentAccountNS","ownKeys","filter","getMany","hasDrafts","draft","replyTo","quote","updatedAtDate","quoteStatus","MiniDraft","spoilerText","hasPoll","hasMedia","hasQuote","hasPollOrMedia","firstImageMedia","image","objectURL","createObjectURL","EmbedModal","GenericAccounts","postID","isCurrentInstance","showMore","setShowMore","staticAccounts","showReactions","setAccounts","loadRelationships","loadAccounts","done","isArray","theAccount","j","_types","newAccounts","Status","showStats","InView","ImportAccountsSelection","importedAccounts","existingAccounts","accountsToImport","statusOrder","duplicate","new","__status","selectedAccounts","setSelectedAccounts","initialSelection","handleImportSelection","showAccounts","selectedCount","Boolean","every","newSelection","shouldSelect","isSelected","ImportExportAccounts","setImportedAccounts","dragOver","setDragOver","handleExport","exportData","rest","stringify","Blob","date","getFullYear","getMonth","padStart","getDate","getHours","getMinutes","download","click","revokeObjectURL","processFile","handleImport","onDragOver","onDragLeave","onDrop","FORCE_TRANSLATE_LIMIT","MediaAltModal","setForceTranslate","differentLanguage","localeMatch","isShortAlt","supportsTTS","speak","textWrap","sourceLanguage","classToType","obj","unpack","keyOrder","k","PI","TWOPI","PITHIRD","DEG2RAD","RAD2DEG","multiplyMatrices","A","B","B_cols","product","row","col","labConstants","compand","linear","sign","xyz2rgb","z","MtxAdaptMa","MtxAdaptMaI","MtxXYZ2RGB","RefWhiteRGB","Xn","Yn","Zn","LAB_CONSTANTS","As","Bs","Cs","Ad","Bd","Cd","X1","Y1","Z1","X2","Y2","Z2","oklab2rgb","L","X","Y","Z","OKLab_to_XYZ","b_","OKLab","LMStoXYZ","OKLabtoLMS","LMSnl","gammaAdjustSRGB","companded","rgb2xyz","MtxRGB2XYZ","rgb2oklab","xyz","XYZ_to_OKLab","XYZ","XYZtoLMS","LMStoOKLab","LMS","sin","cos","lch2lab","h","oklch2rgb","sqrt","atan2","round","lab2lch","rgb2oklch","MediaModal","statusID","carouselRef","currentIndex","setCurrentIndex","carouselFocusItem","useLayoutEffect","scrollIntoView","prevStatusID","scrollLeft","clientWidth","differentStatusID","scrollTo","isRTL","showControls","setShowControls","handleSwipe","removeEventListener","handleScroll","abs","passive","mediaOkColors","media","blurhash","averageColor","getBlurHashAverageColor","mediaAccentColors","okColor","light","dark","default","mediaAccentGradients","range","lightGradient","darkGradient","toastRef","hideToast","currentColor","$meta","metaColor","mediaColor","content","colorScheme","contains","backgroundAttachment","accentColor","showMediaAlt","description","showOriginal","menuClassName","OpenLinkSheet","linkText","displayUrl","protocol","handleCopy","clipboard","writeText","handleShare","R1_RUN_LENGTH_THRESHOLD","R2_BLOCK_PENALTY","R3_FINDER_PATTERN_LENGTH","R3_FINDER_PENALTY","R4_BALANCE_STEP_PERCENT","R4_BALANCE_STEP_POINTS","chCodes","assertNumber","validateVersion","ver","bin","pad","mod","fillArr","val","interleaveBytes","blocks","maxLen","totalLen","idx","best","bestScore","score","alphabet","char","input","letter","digits","Bitmap","s","lines","line","offset","yPos","xPos","cur","border","bm","factor","out","first","second","cc","reset","whiteBG","darkBG","optimize","pathData","prevPoint","point","relM","bH","u16le","dims","N","fullChunks","isRGB","ECMode","Encoding","BYTES","WORDS_PER_BLOCK","ECC_BLOCKS","last","distance","count","interval","ecc","maskIdx","words","numBlocks","blockLen","shortBlocks","PATTERNS","_x","_y","GF","p_poly","exp","poly","degree","coefficient","coefficients","scalar","smaller","larger","sumDiff","lengthDiff","divisor","elm","R","rLast","tLast","rLastLast","tLastLast","dltInverse","degreeDiff","scale","sigmaTildeAtZero","inverse","RS","eccWords","pol","syndrome","hasError","evl","monomial","errorLocator","errorEvaluator","locations","pos","xiInverse","denominator","interleave","rs","eccBlocks","isShort","resBlocks","resECC","drawTemplate","finder","alignPos","bits","getBit","bit","zigzag","tpl","pattern","xOffset","detectType","utf8ToBytes","encoder","encoded","dataLen","n","utf8","capacity","drawQR","need","mask","calculateRowRunPenalty","rowBits","moduleCount","penalty","runLength","previousColor","calculateColumnRunPenalty","bitmap","columnIndex","columnHeight","calculateRowFinderPenalty","rowLength","lastStart","light4ThenFinder7","finder7ThenLight4","calculateColumnFinderPenalty","matrix","rowIndex","runPenalty","blockPenalty","lastCol","lastRow","nextCol","cell","finderPenalty","darkCount","darkPercent","deviation","balancePenalty","drawQRBest","bestMask","validateECC","ec","validateEncoding","enc","validateMask","encodeQR","output","encoding","utils","getContext","QrCode","arenaCircle","captionRef","captionHeight","setCaptionHeight","arenaLoaded","setArenaLoaded","arenaHasAlpha","setArenaHasAlpha","effectiveArenaCircle","img","Image","onload","getImageData","totalPixels","lowAlphaCount","hasAlpha","onerror","qrData","gridSize","centerExcludeSize","centerStart","centerEnd","isFilled","centerX","centerY","radius","dx","isFilledInGrid","isInPositionMarker","cx","cy","hasTop","hasRight","hasBottom","hasLeft","markerOuterRadius","markerInnerRadius","centerImagePadding","centerImageSize","centerImageX","centerImageY","captionSpacing","viewBoxWidth","viewBoxHeight","viewBox","xmlns","fill","stroke","rx","ry","in","stdDeviation","slope","intercept","markerPositions","bleed","preserveAspectRatio","opacity","mediaDevicesSupported","mediaDevices","getUserMedia","QrCodeModal","hasBarcodeDetector","__vitePreload","QRCamera","constructor","stream","player","setStream","setAttribute","srcObject","listDevices","enumerateDevices","Error","device","kind","deviceId","setDevice","stop","video","exact","readFrame","fullSize","videoHeight","videoWidth","getSize","track","getTracks","createQRCamera","permissions","ideal","facingMode","checkValidity","containerRef","videoRef","setIsScanning","overlayRef","decodedText","setDecodedText","handleScreenOrientationChange","screenOrientation","screen","orientation","cam","qrCanvas","detector","cancelMainLoop","qrDom","BarcodeDetector","formats","QRCanvas","cropToSquare","overlayMainColor","overlayFinderColor","animationId","mainLoop","rafLoop","isScanning","startCamera","showActionableButton","playsInline","muted","disablepictureinpicture","CATEGORIES","CATEGORIES_INFO","spam","legal","violation","stampLabel","other","excludeStamp","findMatchingLanguage","rule","currentLang","translations","availableLanguages","matchedLang","normalizedLanguages","part","region","charAt","toUpperCase","translateRules","rules","_translatedText","ReportModal","domain","translatedRules","currentDomain","getCurrentInstance","selectedCategory","setSelectedCategory","showRules","setShowRules","rulesRef","hasRules","setHasRules","previewMode","useAvatarStatic","showActivity","category","forward","ruleIds","reports","accountId","statusIds","Fragment","maxlength","rows","switch","LZString","f","keyStrBase64","keyStrUriSafe","baseReverseDic","getBaseValue","character","compressed","uncompressed","buf","TotalLen","current_value","bitsPerChar","getCharFromInt","context_dictionary","context_dictionaryToCreate","context_c","context_wc","context_w","context_enlargeIn","context_dictSize","context_numBits","context_data","context_data_val","context_data_position","ii","resetValue","getNextValue","dictionary","enlargeIn","dictSize","numBits","w","resb","maxpower","power","module","floatingButtonUrl","multiColumnUrl$1","tabMenuBarUrl","MAX_FETCH","fetchFollowedTags","iterator","followedTags","tags","fetchCount","getFollowedTags","fauxDiv","extractTagsFromStatus","hashtagLinks","AsyncText","setText","Promise","then","SHORTCUTS_LIMIT","TYPES","TYPE_TEXT","public","bookmarks","favourites","hashtag","trending","mentions","TYPE_PARAMS","notRequired","placeholder","fetchAccountTitle","SHORTCUTS_META","path","excludeViewMode","subtitle","encodeURIComponent","ShortcutsSettings","shortcuts","showForm","setShowForm","showImportExport","setShowImportExport","shortcutsListParent","fontSize","textTransform","imgURL","multiColumnUrl","shortcut","excludedViewMode","shortcutsArr","temp","shortcutIndex","justifyContent","ShortcutForm","mode","ImportExport","FORM_NOTES","currentType","setCurrentType","followedHashtags","setFollowedHashtags","form","formRef","autocorrect","autocapitalize","tag","spellCheck","shortcutsStr","compressToEncodedURIComponent","setImportShortcutStr","parsedImportShortcutStr","setImportUIState","importShortcutStr","parsed","decompressFromEncodedURIComponent","hasCurrentSettings","shortcutsImportFieldRef","importUIState","dt","match","some","nonUniqueShortcuts","exceededLimit","newShortcuts","newNote","settingsJSON","changes","prevValue","Modals","navigate","useNavigate","preload","ComposeSuspense","__COMPOSE__","replyMode","editStatus","newStatus","scheduledAt","reloadStatusPage","reloadScheduledPosts","reply","edit","toast","prevLocation","showSettings","destination","showOpenLink","showShortcutsSettings","showEmbedModal","showQrScannerModal","QrScannerModal","exportDisabled","NavigationCommand","hotkeyOptions","FollowRequestButtons","requestState","setRequestState","hasRelationship","followRequests","authorize","NOTIFICATION_ICONS","follow_request","severed_relationships","moderation_warning","emoji_reaction","annual_report","quoted_update","emojiText","emoji","emoji_url","staticUrl","emojiObject","CustomEmoji","contentText","postsCount","postType","Subject","clickable","poll-self","poll-voted","favourite+reblog","admin.sign_up","admin.report","targetAccount","year","SEVERED_RELATIONSHIPS_TEXT","account_suspension","targetName","domain_block","user_domain_block","MODERATION_WARNING_TEXT","none","disable","mark_statuses_as_sensitive","delete_statuses","sensitive","silence","suspend","AVATARS_LIMIT","isStatic","disableContextMenu","report","annualReport","_ids","_accounts","_statuses","_groupKeys","sampleAccounts","notificationsCount","groupKey","_notificationsCount","_sampleAccountsCount","actualStatus","actualStatusID","isVoted","voted","isReplyToOthers","inReplyToAccountId","favsCount","reblogsCount","props","handleOpenGenericAccounts","diffCount","expandAccounts","showAvatar","emojiURL","shortcode","formattedCreatedAt","genericAccountsHeading","statusKey","filtered","isOwnPost","filterInfo","isFiltered","type2","gKey","keyAccounts","keyAccount","_accounts2","status2","allowContextMenu","TruncatedLink","dispatchEvent","clientX","clientY","allowFilters","useTruncated","Notification$2","oldProps","newProps","NotificationService","routeNotification","showNotificationSheet","notificationAccount","hasModal","hasStatus","clearAppBadge","id2","setShowNotificationSheet","getSearchHistory","history","MAX_HISTORY_LENGTH","addToSearchHistory","queryType","existingIndex","item","unshift","timestamp","limitedHistory","removeFromSearchHistory","filteredHistory","clearAllSearchHistory","generateSearchItemData","hashSymbol","hashtagText","SearchForm","forwardRef","searchParams","setSearchParams","useSearchParams","searchMenuOpen","setSearchMenuOpen","setQuery","searchFieldRef","useImperativeHandle","setValue","blur","searchHistory","searchSuggestionsData","recentSearchItems","historyItem","isRecentSearch","autocomplete","onSearch","onFocus","firstItem","onBlur","onKeyDown","focusItem","nextItem","nextElementSibling","parentElement","prevItem","previousElementSibling","items","lastItem","SearchCommand","showSearch","setShowSearch","searchFormRef","showSearchCommand","isSearchPage","isYearInPostsPage","closeSearch","enableOnFormTags","Shortcuts","isMultiColumnMode","shortcutsColumnsMode","tabBarRef","hasLists","formattedShortcuts","pin","timeoutId","activeTab","inline","scrollTop","updatesButton","instanceRef","viewScroll","getComputedStyle","Shortcuts$1","groupBoosts","newValues","boostStash","serialBoosts","boostStashID","half","floor","dedupeBoosts","boostedStatusIDs","filteredItems","boosterID","groupContext","contextIndex","contexts","repliedItem","self","inReplyToId","firstItemAccountID","newItems","appliedContextIndices","inReplyToIds","contextItems","it","sKey","statusReply","queueMicrotask","fallbackFetch","fetchStatus","saveStatus","ids","replyToStatuses","assignFollowedTags","statusFollowedTags","statusWithFollowedTags","extractedTags","itemFollowedTags","useScroll","scrollableRef","distanceFromStart","distanceFromEnd","scrollThresholdStart","scrollThresholdEnd","distanceFromStartPx","_distanceFromStartPx","distanceFromEndPx","_distanceFromEndPx","scrollDirection","setScrollDirection","reachStart","setReachStart","reachEnd","setReachEnd","nearReachStart","setNearReachStart","nearReachEnd","setNearReachEnd","isVertical","scrollableElement","previousScrollStart","onScroll","scrollHeight","scrollWidth","clientHeight","scrollStart","scrollDimension","clientDimension","scrollDistance","init","Event","useScrollFn","useThrottledCallback","scrollDelta","isScrollingForward","leading","resetScrollDirection","MediaPost","onMediaClick","accountEmojis","repliesCount","reblogged","favourited","favouritesCount","bookmarked","visibility","language","editedAt","card","uri","_deleted","_pinned","debugHover","filterContext","useContext","FilterContext","showSpoilerMedia","hasSpoiler","readingExpandMedia","filterTitleStr","Media","MediaPost$1","NavMenu","showFollowing","detect","cancelOnMovement","menuState","setMenuState","mutesIterator","fetchMutes","mutes","blocksIterator","fetchBlocks","buttonClickTS","squircle","commitHash","__COMMIT_HASH__","ListMenu","supportsLists","NavMenu$1","scrollIntoViewOptions","Timeline","titleComponent","emptyText","errorText","useItemID","fetchItems","checkForUpdatesInterval","headerStart","headerEnd","timelineStart","refresh","view","showFollowedTags","showReplyParent","clearWhenRefresh","setItems","showNew","setShowNew","debug","__BENCHMARK","isMediaFirstInstance","mediaFirst","allowGrouping","loadItemsTS","firstLoad2","loadItems","useDebouncedCallback","ts","otherPosts","pinnedPosts","items2","jRef","handler","itemsSelector","activeItem","activeElement","activeItemRect","allItems","activeItemIndex","indexOf","itemRect","topmostItem","kRef","showNewPostsIndicator","handleLoadNewPosts","scrollFnCallback","headerRef","hiddenUI","cancel","prevView","disableIdleCheck","loadOrCheckUpdates","inBackground","noPointers","__IDLE__","visible2","lastHiddenTime","dotRef","Provider","oRef","TimelineItem","inView","marginBlockEnd","fItems","aFiltered","bFiltered","filteredItemsIDs","isCarousel","unfiltered","filteredItems2","StatusCarousel","_grouped","_pinned2","item2","_pinned3","actualStatusID3","reblog3","statusID3","statusID2","actualStatusID2","reblog2","url2","contentTextWeight","manyItems","enableCommentHint","isMiddle","showCompact","_differentAuthor","isSpoiler","isStart","isEnd","TimelineStatusCompact","itemKey","oldID","newID","setRender","render","startButtonRef","_t3","endButtonRef","_t4","statusPeekText","ThreadBadge","titlesStr","MIN_YEAR","MIN_YEAR_MONTH","supportsInputMonth","mem","AccountStatuses","useParams","month","excludeReplies","excludeBoosts","tagged","accountStatusesIterator","allSearchParams","searchOffsetRef","isValidMonth","_month","monthIndex","after","_year","afterStr","before","beforeStr","searchResults","done2","value2","pinnedStatuses","pinned","pinnedStatusesIds","postId","featuredTags","setFeaturedTags","acctDisplay","accountDisplay","monthYear","fetchAccount2","featuredTags2","useTitle","TimelineStart","cachedAccount","filterBarRef","validity","MonthPicker","active","allowSwitch","offsetLeft","fetchAccountStatuses","masto2","minYear","maxYear","minMonth","maxMonth","yearFieldRef","monthFieldRef","AnnualReport","setResults","annualReports","report2","datePlaceholder","totals","textAlign","Bookmarks","bookmarksIterator","fetchBookmarks","catchupUrl","FILTER_CONTEXT","CATCHUP_NS","RANGES","beyond","FILTER_KEYS","original","quotes","groups","FILTER_SORTS","FILTER_GROUPS","DTF","Intl","DateTimeFormat","day","hour","minute","quotedStatus","Catchup","dtf","showTopLinks","setShowTopLinks","supportsPixelfed","fetchHome","maxCreatedAt","allResults","homeIterable","homeIterator","mainloop","addedResults","createdAtTime","selfPost","_filtered","_followedTags","catchupRangeRef","catchupLastRef","handleCatchupClick","maxCreatedAtHuman","catchupID","startAt","endAt","catchup","setPosts","setPrevCatchups","catchupIds","prevCatchups","pc","catchupId","reloadCatchups","sessionStorage","catchups","ownCatchups","lastCatchups","restCatchups","trimmedCatchups","setLastCatchupEndAt","filterCounts","links","links2","reloadCatchupsCount","__FILTER","thePost","link","topLinks","linksLoop","shared","selectedFilterCategory","selectedAuthor","setSelectedAuthor","setRange","sortBy","setSortBy","sortOrder","setSortOrder","setSelectedFilterCategory","groupBy","setGroupBy","savedState","filteredPosts","authors","authorCounts","authorsHash","filteredPosts2","boostedPosts","setJSON","authorCountsMap","postFilterMatches","__BOOSTERS","filteredPostsMap","__HIDDEN","authorCountsList","sortedFilteredPosts","authorIndices","authorID","bIndex","bAccountID","aIndex","bDensity","aDensity","prevGroup","authorsListParent","autoAnimated","postsBarType","isFiltered2","postsBins","postsBar","binByTime","bins","getJSON","scrollElement","lastCatchupRange","lastCatchupEndAt","authorUsername","sortOrderIndex","groupByText","authorRect","scrollableRect","authorElement","right","setShowHelp","hlRef","_2","escRef","isRadio","handleArrowKeys","isArrowKeys","closest","beyondRange","untilLastCatchup","st","formatRange","likes","transform","imageDescription","sharers","publishedAt","author","paddingInline","density","showSeparator","IntersectionPostLineItem","showHelp","PostLine","isFollowedTags","isReplyTo","onMouseEnter","PostPeek","setShow","show","MEDIA_DENSITY","CARD_DENSITY","pollContent","htmlContentLength","MEDIA_SIZE","_thread","isThread","theQuote","readingExpandSpoilers","postText","showPostContent","emojifyText","o","mediaURL","remoteMediaURL","multiple","showMedia","previewUrl","meta","gifv","PostStats","quotesCount","numBins","maxDate","minDate","Favourites","favouritesIterator","fetchFavourites","FILTER_CONTEXT_UNIMPLEMENTED","FILTER_CONTEXT_LABELS","home","thread","EXPIRY_DURATIONS","EXPIRY_DURATIONS_LABELS","Filters","showFiltersAddEditModal","setShowFiltersAddEditModal","filters","setFilters","keywords","expiresAt","keyword","ExpiryStatus","FiltersAddEdit","_id","incID","filterAction","hasExpiry","expiresAtDate","editKeywords","setEditKeywords","keywordsRef","setRemovedKeyword_IDs","filteredEditKeywords","setRemovedKeywordIDs","removedKeyword_IDs","keywordIDs","getAll","keywordKeywords","keywordWholeWords","keywordsAttributes","wholeWord","removedKeywordIDs","context2","expiresIn","wholeWords","filterResult","filterAction2","_id2","getAPIVersions","showNeverExpires","expired","rerender","FollowedHashtags","Following","client","streamingClient","setStreamingClient","latestItem","onStreamingReady","latestItemChanged","clearFollowedTagsState","include_reblogs","valueContainsLatestItem","getStatus","TAGS_LIMIT_PER_MODE","TOTAL_TAGS_LIMIT","Hashtags","mediaView","hashtags","linkParams","hashtagTitle","maxID","fetchHashtags","timelines","any","maxId","onlyMedia","since_id","followUIState","setFollowUIState","reachLimit","featuredUIState","setFeaturedUIState","isFeaturedTag","setIsFeaturedTag","setDownOverflow","finally","featuredTagID","delete","FocusableItem","newHashtag","MenuGroup","exists","newInstance","List","listIterator","setList","showManageMembersModal","setShowManageMembersModal","list2","MenuHeader","ListManageMembers","MEMBERS_LIMIT","members","setMembers","membersIterator","fetchMembers","member","as","RemoveAddButton","setRemoved","removed","notificationTypeKeys","GROUP_TYPES","groupable","fixNotifications","massageNotifications2","notificationGroups","sampleAccountIds","statusId","groupNotifications2","groupNotifications","newGroupNotifications","gn","latestPageNotificationAt","mostRecentNotificationId","newGroupNotifications1","notificationsMap","virtualType","sampleCountDiffNotificationsCount","mappedNotification","ma","mappedAccount","newGroupNotifications2","notificationsMap2","toLocaleDateString","hasOneAccount","cleanNotifications","reverse","cleanNotifications2","emptySearchParams","Mentions","stateType","setStateType","mentionsIterator","fetchMentions","types","conversationsIterator","latestConversationItem","lastStatus","fetchConversations","NOTIFICATIONS_LIMIT","NOTIFICATIONS_GROUPED_LIMIT","memSupportsGroupedNotifications","mastodon","mastoFetchNotificationsIterable","mastoFetchNotifications","getGroupedNotifications","NOTIFICATIONS_POLICIES","NOTIFICATIONS_POLICIES_TEXT","forNotFollowing","forNotFollowers","forNewAccounts","forPrivateMentions","forLimitedAccounts","Notifications","notificationID","notificationAccessToken","onlyMentions","setOnlyMentions","setFollowRequests","announcements","setAnnouncements","notificationsIterable","allNotifications","groupedNotifications","notificationsLastFetchTime","fetchFollowRequests","loadFollowRequests","requests","fetchAnnouncements","supportsFilteredNotifications","showNotificationsSettings","setShowNotificationsSettings","notificationsPolicy","setNotificationsPolicy","fetchNotificationsPolicy","loadNotificationsPolicy","notificationsRequests","setNotificationsRequests","fetchNotificationsRequest","loadNotifications","fetchNotificationsPromise","fetchNotifications","loadUpdates","unsub","subscribeKey","yesterdayDate","todayDate","currentDay","showTodayEmpty","announcementsListRef","annualReportNotification2","annualReportNotification","setAnnualReportNotification","dateYear","annualReportYear","statusLink","todaySubHeading","today","forceOpts","announcement","onToggle","request","summary","pendingRequestsCount","NotificationRequestModalButton","differentDay","notificationDay","subHeading","newPolicy","AnnouncementBlock","contact","contactAccount","startsAt","endsAt","published","allDay","reactions","read","publishedDateText","updatedAtText","publishedAtDate","reaction","me","fetchNotficationsByAccount","showModal","setShowModal","notifs","setNotifications","NotificationRequestButtons","hasRequestState","Notifications$1","Public","isLocal","publicIterator","fetchPublic","remote","prompt","RecentSearches","onItemClick","handleClearAll","handleRemoveItem","listRef","SHORT_LIMIT","Search","offsetRef","statusResults","setStatusResults","accountResults","setAccountResults","hashtagResults","setHashtagResults","typeResults","setTypeResultsFunc","loadResults","filterBarParent","reduce","TREND_CACHE_TIME","fetchLinks","trends","fetchTrendsStatuses","pixelfed","discover","fetchLinkList","Trending","setHashtags","setLinks","trendIterator","fetchTrends","currentLinkMentionsLoading","setCurrentLinkMentionsLoading","currentLinkMentionsIterator","currentLink","setCurrentLink","hasCurrentLink","supportsTrendingLinkPosts","currentLinkRef","prevCurrentLink","authorUrl","authorName","providerName","providerUrl","isShortTitle","labAverageColor","title2","hasAuthor","flexShrink","fetchLinkMentions","Columns","Component","Hashtag","$column","currentFocusedColumn","prevColKey","nextColKey","Home","NotificationsLink","notificationLinkRef","NotificationsMenu","NOTIFICATIONS_DISPLAY_LIMIT","hasFollowRequests","setHasFollowRequests","skipFollowRequests","headerHeight","Home$1","statusPostRegexes","getInstanceStatusObject","theURL","regex","getInstanceStatusURL","HttpRoute","statusObject","statusURL","Lists","hasExclusiveLists","instancesListURL","openAuthPopup","features","popup","closed","closeAuthPopup","close","watchAuthPopup","onSuccess","resolved","messageHandler","cleanup","pollInterval","PHANPY_DEFAULT_INSTANCE","DEFAULT_INSTANCE","Login","instanceURLRef","cachedInstanceURL","submit","instanceText","setInstanceText","instancesList","setInstancesList","searcher","Fuse","submitInstance","xmlDoc","DOMParser","parseFromString","getElementsByTagName","template","getCredentialApplication","credentialApplication","storeCredentialApplication","authPKCE","authUrl","callbackUrl","cleanInstanceText","instanceTextLooksLikeDomain","instancesSuggestions","instance2","selectedInstanceText","ScheduledPosts","scheduledPosts","setScheduledPosts","showScheduledPostModal","setShowScheduledPostModal","postsIterator","scheduledStatuses","allPosts","quotedStatusId","quoteApprovalPolicy","option","votesCount","ScheduledPostPreview","ScheduledPostEdit","hours","formatOpts","weekday","differentScheduledAt","setNewScheduledAt","newScheduledAt","localTZ","getLocalTimezoneName","pastSchedule","ScheduledAtField","setScheduledAt","EditHistoryControls","prevEditedAt","nextEditedAt","editedAtIndex","editHistoryMode","editHistoryRef","exitEditHistory","useEditHistory","SUBCOMMENTS_OPEN_ALL_LIMIT","MAX_WEIGHT","cachedRepliesToggle","cachedStatusesMap","scrollPositions","resetScrollPosition","STATUSES_SELECTOR","STATUS_URL_REGEX","StatusPage","mediaParam","mediaOnlyParam","mediaStatusID","mediaStatus","showMediaOnly","heroStatus","setHeroStatus","existingCanonical","originalHref","canonicalLink","head","appendChild","removeChild","closeLink","matchStatusPath","matchPath","postViewState","mediaClose","mediaAttachments2","handleMediaClose","mediaVTN","getSafeViewTransitionName","els","foundEls","el2","elBounds","innerHeight","transition","startViewTransition","viewTransitionName","viewTransitioned","$carousel","$deckContainer","$deckContainers","linkable","restProps","createdAtSort","MONTH_IN_MS","StatusThread","setViewMode","totalDescendants","setStatuses","heroStatusRef","scrollOffsets","fullContext","initEditHistory","threadsCount","currentEditedAtStatus","nextEditedAtStatus","descendants","sCreatedAt","currentEditedAtStatusCreatedAt","nextEditedAtStatusCreatedAt","ancestors2","ancestors","heroStatus2","missingAncestorIds","missingId","referencingStatus","ghostStatus","insertIndex","missingStatuses","ghost","nestedDescendants","ancestorsIsThread","heroAccountID","descendantLevelsCount","__replies","level","nextLevel","_replies","_r","expandReplies","calcStatusWeight","descendant","mappedNestedDescendants","weight","initContext","reloadHero","ancestor","reallyCachedStatuses","allStatuses","contextFetch","pRetry","heroTimer","cachedStatuses","retries","restructureContext","descendantsThread","threadsCount2","heroFetch","heroLimit","threadifyStatus","setThreadsCount","setShowRefresh","offsetTop","lastInitContextTS","setLimit","scrollPosition","newScrollOffsets","newScrollTop","showRefresh","contextURL","statusWeightCache","heroContentText","heroDisplayName","postInstance","apiCache","ignoreVary","postSameInstance","heroInView","setHeroInView","activeStatusRect","activeStatus","allStatusLinks","activeStatusIndex","nextStatus","statusLinkRect","topmostStatusLink","heroPointer","prevStatus","details","initialPageState","handleMediaClick","handleStatusLinkClick","renderStatus","isHero","reachTopPost","isLinkable","requestAnimationFrame","withinContext","enableTranslate","translate","StatusParent","hasDescendants","setReachTopPost","showActionsBar","prevEntry","moreStatusesKeys","getIDs","hasParentThread","accWeight","months","slicedStatuses","prevLocationIsStatusPage","currentDate","prevDate","prevID","monthsDiff","years","spoilerButton","ThreadCountContext","statusesList","viewMode","isFinite","onAnimationEnd","back","short","arr","buttons","SubComments","openAll","parentLink","diveDeep","replies3","sameCount","totalComments","totalWeight","openBefore","detailsRef","setRenderReplies","Container","isDetails","shortReply","dataset","renderReplies","cachedWeight","POLL_VIRTUAL_LENGTH","cardLength","CARD_VIRTUAL_LENGTH","mediaLength","pollLength","StatusRoute","boostsCarouselUrl","multiHashtagTimelineUrl","nestedCommentsThreadUrl","logoText","PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL","DEFAULT_INSTANCE_REGISTRATION_URL","appSite","__COMMIT_TIME__","Welcome","nativeAlert","__nativeAlert","Toastify","gravity","YearInPosts","lazy","__STATES__","__STATES_STATS__","counts","unmountedPosts","setInterval","unfurledLinks","postInNotifications","$post","unfurled","keysCount","ICONS","nonIdleEvents","setIdle","debouncedSetIdle","onNonIdle","capture","relatedTarget","isIOS","showingMediaModal","textSize","$app","$body","BENCHES","__BENCH_RESULTS","isPWA","PATH_RESTORE_TIME_LIMIT","setIsLoggedIn","App","isPopup","getVapidKey","vapid_key","access_token","clientID","initClient","allSettled","initStates","getAccount","searchAccount","initPreferences","initInstance","hasPreferences","location2","restoredRef","lastPathKey","sessionCookie","isRootPath","lastAccessed","lastPath","SecondaryRoutes","Route","PrimaryRoutes","Routes","Root","nonRootLocation","getPrevLocation","Sandbox","backgroundLocation","isModalPage","Suspense","initActivateLang","initPWAViewport","I18nProvider","HashRouter","IconSpriteProvider","localStorage","removeItem","caches","IGNORE_CACHE_KEYS","clearRanOnce","FAST_INTERVAL","SLOW_INTERVAL","clearCaches","cache","_keys","MAX_SW_CACHE_SIZE","deleteKeys"],"ignoreList":[0,1,6,7,37,38,39,40,41,42,43,44,45,46,47,48,49,50,53,58],"sources":["../../node_modules/just-debounce-it/index.mjs","../../node_modules/swiped-events/src/swiped-events.js","../../src/utils/usePageVisibility.js","../../src/components/background-service.jsx","../../src/components/compose-button.jsx","../../src/components/keyboard-shortcuts-help.jsx","../../node_modules/@formkit/auto-animate/index.mjs","../../node_modules/@formkit/auto-animate/preact/index.mjs","../../src/utils/oauth-pkce.js","../../src/utils/auth.js","../../src/pages/accounts.jsx","../../src/assets/logo.svg","../../src/components/button-install.js","../../src/components/lang-selector.jsx","../../src/utils/push-notifications.js","../../src/pages/settings.jsx","../../src/utils/focus-deck.js","../../src/utils/useLocationChange.js","../../src/components/account-handle-info.jsx","../../src/components/edit-profile-sheet.jsx","../../src/components/endorsements.jsx","../../src/utils/is-search-enabled.js","../../src/utils/lists.js","../../src/components/list-exclusive-badge.jsx","../../src/components/list-add-edit.jsx","../../src/components/add-remove-lists-sheet.jsx","../../src/components/private-note-sheet.jsx","../../src/components/translated-bio-sheet.jsx","../../src/components/related-actions.jsx","../../src/components/account-info.jsx","../../src/components/account-sheet.jsx","../../src/components/drafts.jsx","../../src/components/embed-modal.jsx","../../src/components/generic-accounts.jsx","../../src/components/import-accounts-selection.jsx","../../src/components/import-export-accounts.jsx","../../src/components/media-alt-modal.jsx","../../node_modules/chroma-js/src/utils/limit.js","../../node_modules/chroma-js/src/utils/type.js","../../node_modules/chroma-js/src/utils/unpack.js","../../node_modules/chroma-js/src/utils/index.js","../../node_modules/chroma-js/src/utils/multiply-matrices.js","../../node_modules/chroma-js/src/io/lab/lab-constants.js","../../node_modules/chroma-js/src/io/lab/lab2rgb.js","../../node_modules/chroma-js/src/io/oklab/oklab2rgb.js","../../node_modules/chroma-js/src/io/lab/rgb2lab.js","../../node_modules/chroma-js/src/io/oklab/rgb2oklab.js","../../node_modules/chroma-js/src/io/lch/lch2lab.js","../../node_modules/chroma-js/src/io/oklch/oklch2rgb.js","../../node_modules/chroma-js/src/io/lch/lab2lch.js","../../node_modules/chroma-js/src/io/oklch/rgb2oklch.js","../../src/components/media-modal.jsx","../../src/components/open-link-sheet.jsx","../../node_modules/qr/index.js","../../src/components/qr-code.jsx","../../src/components/qr-code-modal.jsx","../../src/components/qr-scanner-modal.jsx","../../src/components/report-modal.jsx","../../node_modules/lz-string/libs/lz-string.js","../../src/assets/floating-button.svg","../../src/assets/multi-column.svg","../../src/assets/tab-menu-bar.svg","../../src/utils/followed-tags.js","../../src/components/AsyncText.jsx","../../src/components/shortcuts-settings.jsx","../../src/components/modals.jsx","../../src/components/navigation-command.jsx","../../src/components/follow-request-buttons.jsx","../../src/components/notification.jsx","../../src/components/notification-service.jsx","../../src/utils/search-history.js","../../src/components/search-form.jsx","../../src/components/search-command.jsx","../../src/components/shortcuts.jsx","../../src/utils/timeline-utils.js","../../src/utils/useScroll.js","../../src/utils/useScrollFn.js","../../src/components/media-post.jsx","../../src/components/nav-menu.jsx","../../src/components/timeline.jsx","../../src/pages/account-statuses.jsx","../../src/pages/annual-report.jsx","../../src/pages/bookmarks.jsx","../../src/assets/features/catch-up.png","../../src/pages/catchup.jsx","../../src/pages/favourites.jsx","../../src/pages/filters.jsx","../../src/pages/followed-hashtags.jsx","../../src/pages/following.jsx","../../src/pages/hashtag.jsx","../../src/pages/list.jsx","../../src/utils/group-notifications.js","../../src/pages/mentions.jsx","../../src/pages/notifications.jsx","../../src/pages/public.jsx","../../src/components/recent-searches.jsx","../../src/pages/search.jsx","../../src/pages/trending.jsx","../../src/components/columns.jsx","../../src/pages/home.jsx","../../src/utils/get-instance-status-url.js","../../src/pages/http-route.jsx","../../src/pages/lists.jsx","../../src/data/instances.json?url","../../src/utils/auth-popup.js","../../src/pages/login.jsx","../../src/pages/scheduled-posts.jsx","../../src/components/edit-history-controls.jsx","../../src/pages/status.jsx","../../src/pages/status-route.jsx","../../src/assets/features/boosts-carousel.jpg","../../src/assets/features/multi-column.jpg","../../src/assets/features/multi-hashtag-timeline.jpg","../../src/assets/features/nested-comments-thread.jpg","../../src/assets/logo-text.svg","../../src/pages/welcome.jsx","../../src/utils/toast-alert.js","../../src/app.jsx","../../src/main.jsx"],"sourcesContent":["var functionDebounce = debounce;\n\nfunction debounce(fn, wait, callFirst) {\n  var timeout = null;\n  var debouncedFn = null;\n\n  var clear = function() {\n    if (timeout) {\n      clearTimeout(timeout);\n\n      debouncedFn = null;\n      timeout = null;\n    }\n  };\n\n  var flush = function() {\n    var call = debouncedFn;\n    clear();\n\n    if (call) {\n      call();\n    }\n  };\n\n  var debounceWrapper = function() {\n    if (!wait) {\n      return fn.apply(this, arguments);\n    }\n\n    var context = this;\n    var args = arguments;\n    var callNow = callFirst && !timeout;\n    clear();\n\n    debouncedFn = function() {\n      fn.apply(context, args);\n    };\n\n    timeout = setTimeout(function() {\n      timeout = null;\n\n      if (!callNow) {\n        var call = debouncedFn;\n        debouncedFn = null;\n\n        return call();\n      }\n    }, wait);\n\n    if (callNow) {\n      return debouncedFn();\n    }\n  };\n\n  debounceWrapper.cancel = clear;\n  debounceWrapper.flush = flush;\n\n  return debounceWrapper;\n}\n\nexport {functionDebounce as default};\n","/*!\n * swiped-events.js - v@version@\n * Pure JavaScript swipe events\n * https://github.com/john-doherty/swiped-events\n * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element\n * @author John Doherty <www.johndoherty.info>\n * @license MIT\n */\n(function (window, document) {\n\n    'use strict';\n\n    // patch CustomEvent to allow constructor creation (IE/Chrome)\n    if (typeof window.CustomEvent !== 'function') {\n\n        window.CustomEvent = function (event, params) {\n\n            params = params || { bubbles: false, cancelable: false, detail: undefined };\n\n            var evt = document.createEvent('CustomEvent');\n            evt.initCustomEvent(event, params.bubbles, params.cancelable, params.detail);\n            return evt;\n        };\n\n        window.CustomEvent.prototype = window.Event.prototype;\n    }\n\n    document.addEventListener('touchstart', handleTouchStart, false);\n    document.addEventListener('touchmove', handleTouchMove, false);\n    document.addEventListener('touchend', handleTouchEnd, false);\n\n    var xDown = null;\n    var yDown = null;\n    var xDiff = null;\n    var yDiff = null;\n    var timeDown = null;\n    var startEl = null;\n    var touchCount = 0;\n\n    /**\n     * Fires swiped event if swipe detected on touchend\n     * @param {object} e - browser event object\n     * @returns {void}\n     */\n    function handleTouchEnd(e) {\n\n        // if the user released on a different target, cancel!\n        if (startEl !== e.target) return;\n\n        var swipeThreshold = parseInt(getNearestAttribute(startEl, 'data-swipe-threshold', '20'), 10); // default 20 units\n        var swipeUnit = getNearestAttribute(startEl, 'data-swipe-unit', 'px'); // default px\n        var swipeTimeout = parseInt(getNearestAttribute(startEl, 'data-swipe-timeout', '500'), 10);    // default 500ms\n        var timeDiff = Date.now() - timeDown;\n        var eventType = '';\n        var changedTouches = e.changedTouches || e.touches || [];\n\n        if (swipeUnit === 'vh') {\n            swipeThreshold = Math.round((swipeThreshold / 100) * document.documentElement.clientHeight); // get percentage of viewport height in pixels\n        }\n        if (swipeUnit === 'vw') {\n            swipeThreshold = Math.round((swipeThreshold / 100) * document.documentElement.clientWidth); // get percentage of viewport height in pixels\n        }\n\n        if (Math.abs(xDiff) > Math.abs(yDiff)) { // most significant\n            if (Math.abs(xDiff) > swipeThreshold && timeDiff < swipeTimeout) {\n                if (xDiff > 0) {\n                    eventType = 'swiped-left';\n                }\n                else {\n                    eventType = 'swiped-right';\n                }\n            }\n        }\n        else if (Math.abs(yDiff) > swipeThreshold && timeDiff < swipeTimeout) {\n            if (yDiff > 0) {\n                eventType = 'swiped-up';\n            }\n            else {\n                eventType = 'swiped-down';\n            }\n        }\n\n        if (eventType !== '') {\n\n            var eventData = {\n                dir: eventType.replace(/swiped-/, ''),\n                touchType: (changedTouches[0] || {}).touchType || 'direct',\n                fingers: touchCount, // Number of fingers used\n                xStart: parseInt(xDown, 10),\n                xEnd: parseInt((changedTouches[0] || {}).clientX || -1, 10),\n                yStart: parseInt(yDown, 10),\n                yEnd: parseInt((changedTouches[0] || {}).clientY || -1, 10)\n            };\n\n            // fire `swiped` event event on the element that started the swipe\n            startEl.dispatchEvent(new CustomEvent('swiped', { bubbles: true, cancelable: true, detail: eventData }));\n\n            // fire `swiped-dir` event on the element that started the swipe\n            startEl.dispatchEvent(new CustomEvent(eventType, { bubbles: true, cancelable: true, detail: eventData }));\n        }\n\n        // reset values\n        xDown = null;\n        yDown = null;\n        timeDown = null;\n    }\n    /**\n     * Records current location on touchstart event\n     * @param {object} e - browser event object\n     * @returns {void}\n     */\n    function handleTouchStart(e) {\n\n        // if the element has data-swipe-ignore=\"true\" we stop listening for swipe events\n        if (e.target.getAttribute('data-swipe-ignore') === 'true') return;\n\n        startEl = e.target;\n\n        timeDown = Date.now();\n        xDown = e.touches[0].clientX;\n        yDown = e.touches[0].clientY;\n        xDiff = 0;\n        yDiff = 0;\n        touchCount = e.touches.length;\n    }\n\n    /**\n     * Records location diff in px on touchmove event\n     * @param {object} e - browser event object\n     * @returns {void}\n     */\n    function handleTouchMove(e) {\n\n        if (!xDown || !yDown) return;\n\n        var xUp = e.touches[0].clientX;\n        var yUp = e.touches[0].clientY;\n\n        xDiff = xDown - xUp;\n        yDiff = yDown - yUp;\n    }\n\n    /**\n     * Gets attribute off HTML element or nearest parent\n     * @param {object} el - HTML element to retrieve attribute from\n     * @param {string} attributeName - name of the attribute\n     * @param {any} defaultValue - default value to return if no match found\n     * @returns {any} attribute value or defaultValue\n     */\n    function getNearestAttribute(el, attributeName, defaultValue) {\n\n        // walk up the dom tree looking for attributeName\n        while (el && el !== document.documentElement) {\n\n            var attributeValue = el.getAttribute(attributeName);\n\n            if (attributeValue) {\n                return attributeValue;\n            }\n\n            el = el.parentNode;\n        }\n\n        return defaultValue;\n    }\n\n}(window, document));\n","import { useEffect, useRef } from 'preact/hooks';\n\nexport default function usePageVisibility(fn = () => {}, deps = []) {\n  const savedCallback = useRef(fn);\n  useEffect(() => {\n    savedCallback.current = fn;\n  }, [deps]);\n\n  useEffect(() => {\n    const handleVisibilityChange = () => {\n      const hidden = document.hidden || document.visibilityState === 'hidden';\n      console.log(' Page visibility changed', hidden ? 'hidden' : 'visible');\n      savedCallback.current(!hidden);\n    };\n\n    document.addEventListener('visibilitychange', handleVisibilityChange);\n    return () =>\n      document.removeEventListener('visibilitychange', handleVisibilityChange);\n  }, []);\n}\n","import { useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\nimport { api } from '../utils/api';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport useInterval from '../utils/useInterval';\nimport usePageVisibility from '../utils/usePageVisibility';\n\nconst STREAMING_TIMEOUT = 1000 * 3; // 3 seconds\nconst POLL_INTERVAL = 20_000; // 20 seconds\n\nexport default memo(function BackgroundService({ isLoggedIn }) {\n  const { t } = useLingui();\n\n  // Notifications service\n  // - WebSocket to receive notifications when page is visible\n  const [visible, setVisible] = useState(true);\n  const visibleTimeout = useRef();\n  usePageVisibility((visible) => {\n    clearTimeout(visibleTimeout.current);\n    if (visible) {\n      setVisible(true);\n    } else {\n      visibleTimeout.current = setTimeout(() => {\n        setVisible(false);\n      }, POLL_INTERVAL);\n    }\n  });\n\n  const checkLatestNotification = async (masto, instance, skipCheckMarkers) => {\n    if (states.notificationsLast) {\n      const notificationsIterator = masto.v1.notifications\n        .list({\n          limit: 1,\n          sinceId: states.notificationsLast.id,\n        })\n        .values();\n      const { value: notifications } = await notificationsIterator.next();\n      if (notifications?.length) {\n        if (skipCheckMarkers) {\n          states.notificationsShowNew = true;\n        } else {\n          let lastReadId;\n          try {\n            const markers = await masto.v1.markers.fetch({\n              timeline: 'notifications',\n            });\n            lastReadId = markers?.notifications?.lastReadId;\n          } catch (e) {}\n          if (lastReadId) {\n            states.notificationsShowNew = notifications[0].id !== lastReadId;\n          } else {\n            states.notificationsShowNew = true;\n          }\n        }\n      }\n    }\n  };\n\n  useEffect(() => {\n    let sub;\n    let streamTimeout;\n    let pollNotifications;\n    if (isLoggedIn && visible) {\n      const { masto, streaming, instance } = api();\n      (async () => {\n        // 1. Get the latest notification\n        await checkLatestNotification(masto, instance);\n\n        let hasStreaming = false;\n        // 2. Start streaming\n        if (streaming) {\n          streamTimeout = setTimeout(() => {\n            (async () => {\n              try {\n                hasStreaming = true;\n                sub = streaming.user.notification.subscribe();\n                console.log(' Streaming notification', sub);\n                for await (const entry of sub) {\n                  if (!sub) break;\n                  if (!visible) break;\n                  console.log(' Notification entry', entry);\n                  if (entry.event === 'notification') {\n                    console.log(' Notification', entry);\n                    saveStatus(entry.payload, instance, {\n                      skipThreading: true,\n                    });\n                  }\n                  states.notificationsShowNew = true;\n                }\n                console.log(' Streaming notification loop STOPPED');\n              } catch (e) {\n                hasStreaming = false;\n                console.error(e);\n              }\n\n              if (!hasStreaming) {\n                console.log(' Streaming failed, fallback to polling');\n                pollNotifications = setInterval(() => {\n                  checkLatestNotification(masto, instance, true);\n                }, POLL_INTERVAL);\n              }\n            })();\n          }, STREAMING_TIMEOUT);\n        }\n      })();\n    }\n    return () => {\n      sub?.unsubscribe?.();\n      sub = null;\n      clearTimeout(streamTimeout);\n      clearInterval(pollNotifications);\n    };\n  }, [visible, isLoggedIn]);\n\n  // Check for updates service\n  const lastCheckDate = useRef();\n  const checkForUpdates = () => {\n    lastCheckDate.current = Date.now();\n    console.log(' Check app update');\n    fetch('./version.json')\n      .then((r) => r.json())\n      .then((info) => {\n        if (info) states.appVersion = info;\n      })\n      .catch((e) => {\n        console.error(e);\n      });\n  };\n  useInterval(checkForUpdates, visible && 1000 * 60 * 30); // 30 minutes\n  usePageVisibility((visible) => {\n    if (visible) {\n      if (!lastCheckDate.current) {\n        checkForUpdates();\n      } else {\n        const diff = Date.now() - lastCheckDate.current;\n        if (diff > 1000 * 60 * 60) {\n          // 1 hour\n          checkForUpdates();\n        }\n      }\n    }\n  });\n\n  // Global keyboard shortcuts \"service\"\n  useHotkeys(\n    'shift+alt+k',\n    (e) => {\n      // Need modifers check due to useKey: true\n      if (!e.shiftKey || !e.altKey) return;\n\n      const currentCloakMode = states.settings.cloakMode;\n      states.settings.cloakMode = !currentCloakMode;\n      showToast({\n        text: currentCloakMode ? t`Cloak mode disabled` : t`Cloak mode enabled`,\n      });\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey,\n    },\n  );\n\n  return null;\n});\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { ControlledMenu, MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useCallback, useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useLongPress } from 'use-long-press';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport niceDateTime from '../utils/nice-date-time';\nimport openCompose from '../utils/open-compose';\nimport openOSK from '../utils/open-osk';\nimport pmem from '../utils/pmem';\nimport safeBoundingBoxPadding from '../utils/safe-bounding-box-padding';\nimport showCompose from '../utils/show-compose';\nimport states from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport { getCurrentAccountID } from '../utils/store-utils';\n\nimport Icon from './icon';\nimport Loader from './loader';\nimport MenuLink from './menu-link';\nimport RelativeTime from './relative-time';\nimport SubMenu2 from './submenu2';\n\n// Function to fetch the latest posts from the current user\n// Use pmem to memoize fetch results for 1 minute\nconst fetchLatestPostsMemoized = pmem(\n  async (masto, currentAccountID) => {\n    const statusesIterator = masto.v1.accounts\n      .$select(currentAccountID)\n      .statuses.list({\n        limit: 3,\n        exclude_replies: true,\n        exclude_reblogs: true,\n      })\n      .values();\n    const { value } = await statusesIterator.next();\n    return value || [];\n  },\n  { expires: 60000 },\n); // 1 minute cache\n\nexport default function ComposeButton() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { masto } = api();\n\n  // Context menu state\n  const [menuOpen, setMenuOpen] = useState(false);\n  const [latestPosts, setLatestPosts] = useState([]);\n  const [loadingPosts, setLoadingPosts] = useState(false);\n  const buttonRef = useRef(null);\n  const menuRef = useRef(null);\n\n  const columnMode = snapStates.settings.shortcutsViewMode === 'multi-column';\n\n  function handleButton(e) {\n    // useKey will even listen to Shift\n    // e.g. press Shift (without c) will trigger this \n    if (e.key && e.key.toLowerCase() !== 'c') return;\n\n    if (snapStates.composerState.minimized) {\n      states.composerState.minimized = false;\n      openOSK();\n      return;\n    }\n\n    const composeDataElements = document.querySelectorAll('data.compose-data');\n    // If there's a lot of them, ignore\n    const opts =\n      !columnMode && composeDataElements.length === 1\n        ? JSON.parse(composeDataElements[0].value)\n        : undefined;\n\n    if (e.shiftKey) {\n      const newWin = openCompose(opts);\n\n      if (!newWin) {\n        states.showCompose = opts || true;\n      }\n    } else {\n      openOSK();\n      states.showCompose = opts || true;\n    }\n  }\n\n  useHotkeys('c, shift+c', handleButton, {\n    useKey: true,\n    ignoreEventWhen: (e) => {\n      const hasModal = !!document.querySelector('#modal-container > *');\n      return hasModal || e.metaKey || e.ctrlKey || e.altKey;\n    },\n  });\n\n  // Setup longpress handler to open context menu\n  const bindLongPress = useLongPress(\n    () => {\n      setMenuOpen(true);\n    },\n    {\n      threshold: 600,\n    },\n  );\n\n  const fetchLatestPosts = useCallback(async () => {\n    try {\n      setLoadingPosts(true);\n      const currentAccountID = getCurrentAccountID();\n      if (!currentAccountID) {\n        return;\n      }\n      const posts = await fetchLatestPostsMemoized(masto, currentAccountID);\n      setLatestPosts(posts);\n    } catch (error) {\n    } finally {\n      setLoadingPosts(false);\n    }\n  }, [masto]);\n\n  // Function to handle opening the compose window to reply to a post\n  const handleReplyToPost = useCallback((post) => {\n    showCompose({\n      replyToStatus: post,\n    });\n    setMenuOpen(false);\n  }, []);\n\n  useEffect(() => {\n    if (menuOpen) {\n      fetchLatestPosts();\n    }\n  }, [fetchLatestPosts, menuOpen]);\n\n  return (\n    <>\n      <button\n        ref={buttonRef}\n        type=\"button\"\n        id=\"compose-button\"\n        onClick={handleButton}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          setMenuOpen(true);\n        }}\n        {...bindLongPress()}\n        class={`${snapStates.composerState.minimized ? 'min' : ''} ${\n          snapStates.composerState.publishing ? 'loading' : ''\n        } ${snapStates.composerState.publishingError ? 'error' : ''}`}\n      >\n        <Icon icon=\"quill\" size=\"xl\" alt={t`Compose`} />\n      </button>\n      <ControlledMenu\n        ref={menuRef}\n        state={menuOpen ? 'open' : undefined}\n        anchorRef={buttonRef}\n        onClose={() => setMenuOpen(false)}\n        direction=\"top\"\n        gap={8} // Add gap between menu and button\n        unmountOnClose\n        portal={{\n          target: document.body,\n        }}\n        boundingBoxPadding={safeBoundingBoxPadding()}\n        containerProps={{\n          style: {\n            zIndex: 19,\n          },\n          onClick: () => {\n            menuRef.current?.closeMenu?.();\n          },\n        }}\n        submenuOpenDelay={600}\n      >\n        <MenuLink to=\"/sp\">\n          <Icon icon=\"schedule\" />{' '}\n          <span>\n            <Trans>Scheduled Posts</Trans>\n          </span>\n        </MenuLink>\n        <MenuDivider />\n        <SubMenu2\n          align=\"end\"\n          direction=\"top\"\n          shift={-8}\n          disabled={loadingPosts || latestPosts.length === 0}\n          label={\n            <>\n              <Icon icon=\"comment\" />{' '}\n              <span className=\"menu-grow\">\n                <Trans>Add to thread</Trans>\n              </span>\n              {loadingPosts ? '' : <Icon icon=\"chevron-right\" />}\n            </>\n          }\n        >\n          {latestPosts.length > 0 &&\n            latestPosts.map((post) => {\n              const createdDate = new Date(post.createdAt);\n              const isWithinDay = Date.now() - createdDate.getTime() < 86400000;\n\n              return (\n                <MenuItem key={post.id} onClick={() => handleReplyToPost(post)}>\n                  <small>\n                    <div class=\"menu-post-text\">{statusPeek(post)}</div>\n                    <span className=\"more-insignificant\">\n                      {/* Show relative time if within a day */}\n                      {isWithinDay && (\n                        <>\n                          <RelativeTime datetime={createdDate} format=\"micro\" />{' '}\n                          {' '}\n                        </>\n                      )}\n                      <time\n                        className=\"created\"\n                        dateTime={createdDate.toISOString()}\n                        title={createdDate.toLocaleString()}\n                      >\n                        {niceDateTime(post.createdAt)}\n                      </time>\n                    </span>\n                  </small>\n                </MenuItem>\n              );\n            })}\n        </SubMenu2>\n      </ControlledMenu>\n    </>\n  );\n}\n","import './keyboard-shortcuts-help.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSnapshot } from 'valtio';\n\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Modal from './modal';\n\n// Helper component for sequential key shortcuts\nfunction SequentialKeys({ key1, key2 }) {\n  return (\n    <Trans>\n      <kbd>{key1}</kbd> then <kbd>{key2}</kbd>\n    </Trans>\n  );\n}\n\nexport default memo(function KeyboardShortcutsHelp() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n\n  function onClose() {\n    states.showKeyboardShortcutsHelp = false;\n  }\n\n  useHotkeys(\n    '?',\n    () => {\n      console.log('help');\n      states.showKeyboardShortcutsHelp = true;\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => {\n        const isCatchUpPage = /\\/catchup/i.test(location.hash);\n        return isCatchUpPage || e.metaKey || e.ctrlKey || e.altKey;\n        // const hasModal = !!document.querySelector('#modal-container > *');\n        // return hasModal;\n      },\n    },\n  );\n\n  return (\n    !!snapStates.showKeyboardShortcutsHelp && (\n      <Modal onClose={onClose}>\n        <div id=\"keyboard-shortcuts-help-container\" class=\"sheet\" tabindex=\"-1\">\n          <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n          <header>\n            <h2>\n              <Trans>Keyboard shortcuts</Trans>\n            </h2>\n          </header>\n          <main>\n            <table>\n              <tbody>\n                {[\n                  {\n                    action: t`Keyboard shortcuts help`,\n                    keys: <kbd>?</kbd>,\n                  },\n                  {\n                    action: t`Next post`,\n                    keys: <kbd>j</kbd>,\n                  },\n                  {\n                    action: t`Previous post`,\n                    keys: <kbd>k</kbd>,\n                  },\n                  {\n                    action: t`Skip carousel to next post`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>j</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Skip carousel to previous post`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>k</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Load new posts`,\n                    keys: <kbd>.</kbd>,\n                  },\n                  {\n                    action: t`Open post details`,\n                    keys: (\n                      <Trans>\n                        <kbd>Enter</kbd> or <kbd>o</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: (\n                      <Trans>\n                        Expand content warning or\n                        <br />\n                        toggle expanded/collapsed thread\n                      </Trans>\n                    ),\n                    keys: <kbd>x</kbd>,\n                  },\n                  {\n                    action: t`Close post or dialogs`,\n                    keys: (\n                      <Trans>\n                        <kbd>Esc</kbd> or <kbd>Backspace</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Focus column in multi-column mode`,\n                    keys: (\n                      <Trans>\n                        <kbd>1</kbd> to <kbd>9</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Focus next column in multi-column mode`,\n                    keys: <kbd>]</kbd>,\n                  },\n                  {\n                    action: t`Focus previous column in multi-column mode`,\n                    keys: <kbd>[</kbd>,\n                  },\n                  {\n                    action: t`Compose new post`,\n                    keys: <kbd>c</kbd>,\n                  },\n                  {\n                    action: t`Compose new post (new window)`,\n                    className: 'insignificant',\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>c</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Send post`,\n                    keys: (\n                      <Trans>\n                        <kbd>Ctrl</kbd> + <kbd>Enter</kbd> or <kbd></kbd> +{' '}\n                        <kbd>Enter</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Search`,\n                    keys: <kbd>/</kbd>,\n                  },\n                  {\n                    action: t`Reply`,\n                    keys: <kbd>r</kbd>,\n                  },\n                  {\n                    action: t`Reply (new window)`,\n                    className: 'insignificant',\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>r</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Like (favourite)`,\n                    keys: (\n                      <Trans>\n                        <kbd>l</kbd> or <kbd>f</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Boost`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>b</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Quote`,\n                    keys: <kbd>q</kbd>,\n                  },\n                  {\n                    action: t`Bookmark`,\n                    keys: <kbd>d</kbd>,\n                  },\n                  {\n                    action: t`Toggle Cloak mode`,\n                    keys: (\n                      <Trans>\n                        <kbd>Shift</kbd> + <kbd>Alt</kbd> + <kbd>k</kbd>\n                      </Trans>\n                    ),\n                  },\n                  {\n                    action: t`Go to Home`,\n                    keys: <SequentialKeys key1=\"g\" key2=\"h\" />,\n                  },\n                  {\n                    action: t`Go to Notifications`,\n                    keys: <SequentialKeys key1=\"g\" key2=\"n\" />,\n                  },\n                ].map(({ action, className, keys }) => (\n                  <tr key={action}>\n                    <th class={className}>{action}</th>\n                    <td>{keys}</td>\n                  </tr>\n                ))}\n              </tbody>\n            </table>\n          </main>\n        </div>\n      </Modal>\n    )\n  );\n});\n","/**\n * A set of all the parents currently being observe. This is the only non weak\n * registry.\n */\nconst parents = new Set();\n/**\n * Element coordinates that is constantly kept up to date.\n */\nconst coords = new WeakMap();\n/**\n * Siblings of elements that have been removed from the dom.\n */\nconst siblings = new WeakMap();\n/**\n * Animations that are currently running.\n */\nconst animations = new WeakMap();\n/**\n * A map of existing intersection observers used to track element movements.\n */\nconst intersections = new WeakMap();\n/**\n * A map of existing mutation observers used to track element movements.\n */\nconst mutationObservers = new WeakMap();\n/**\n * Intervals for automatically checking the position of elements occasionally.\n */\nconst intervals = new WeakMap();\n/**\n * The configuration options for each group of elements.\n */\nconst options = new WeakMap();\n/**\n * Debounce counters by id, used to debounce calls to update positions.\n */\nconst debounces = new WeakMap();\n/**\n * All parents that are currently enabled are tracked here.\n */\nconst enabled = new WeakSet();\n/**\n * The document used to calculate transitions.\n */\nlet root;\n/**\n * The roots XY scroll positions.\n */\nlet scrollX = 0;\nlet scrollY = 0;\n/**\n * Used to sign an element as the target.\n */\nconst TGT = \"__aa_tgt\";\n/**\n * Used to sign an element as being part of a removal.\n */\nconst DEL = \"__aa_del\";\n/**\n * Used to sign an element as being \"new\". When an element is removed from the\n * dom, but may cycle back in we can sign it with new to ensure the next time\n * it is recognized we consider it new.\n */\nconst NEW = \"__aa_new\";\n/**\n * Callback for handling all mutations.\n * @param mutations - A mutation list\n */\nconst handleMutations = (mutations) => {\n    const elements = getElements(mutations);\n    // If elements is \"false\" that means this mutation that should be ignored.\n    if (elements) {\n        elements.forEach((el) => animate(el));\n    }\n};\n/**\n *\n * @param entries - Elements that have been resized.\n */\nconst handleResizes = (entries) => {\n    entries.forEach((entry) => {\n        if (entry.target === root)\n            updateAllPos();\n        if (coords.has(entry.target))\n            updatePos(entry.target);\n    });\n};\n/**\n * Determine if an element is fully outside of the current viewport.\n * @param el - Element to test\n */\nfunction isOffscreen(el) {\n    const rect = el.getBoundingClientRect();\n    const vw = (root === null || root === void 0 ? void 0 : root.clientWidth) || 0;\n    const vh = (root === null || root === void 0 ? void 0 : root.clientHeight) || 0;\n    return rect.bottom < 0 || rect.top > vh || rect.right < 0 || rect.left > vw;\n}\n/**\n * Observe this elements position.\n * @param el - The element to observe the position of.\n */\nfunction observePosition(el) {\n    const oldObserver = intersections.get(el);\n    oldObserver === null || oldObserver === void 0 ? void 0 : oldObserver.disconnect();\n    let rect = coords.get(el);\n    let invocations = 0;\n    const buffer = 5;\n    if (!rect) {\n        rect = getCoords(el);\n        coords.set(el, rect);\n    }\n    const { offsetWidth, offsetHeight } = root;\n    const rootMargins = [\n        rect.top - buffer,\n        offsetWidth - (rect.left + buffer + rect.width),\n        offsetHeight - (rect.top + buffer + rect.height),\n        rect.left - buffer,\n    ];\n    const rootMargin = rootMargins\n        .map((px) => `${ -1 * Math.floor(px)}px`)\n        .join(\" \");\n    const observer = new IntersectionObserver(() => {\n        ++invocations > 1 && updatePos(el);\n    }, {\n        root,\n        threshold: 1,\n        rootMargin,\n    });\n    observer.observe(el);\n    intersections.set(el, observer);\n}\n/**\n * Update the exact position of a given element.\n * @param el - An element to update the position of.\n * @param debounce - Whether or not to debounce the update. After an animation is finished, it should update as soon as possible to prevent flickering on quick toggles.\n */\nfunction updatePos(el, debounce = true) {\n    clearTimeout(debounces.get(el));\n    const optionsOrPlugin = getOptions(el);\n    const delay = debounce\n        ? isPlugin(optionsOrPlugin)\n            ? 500\n            : optionsOrPlugin.duration\n        : 0;\n    debounces.set(el, setTimeout(async () => {\n        const currentAnimation = animations.get(el);\n        try {\n            await (currentAnimation === null || currentAnimation === void 0 ? void 0 : currentAnimation.finished);\n            coords.set(el, getCoords(el));\n            observePosition(el);\n        }\n        catch {\n            // ignore errors as the `.finished` promise is rejected when animations were cancelled\n        }\n    }, delay));\n}\n/**\n * Updates all positions that are currently being tracked.\n */\nfunction updateAllPos() {\n    clearTimeout(debounces.get(root));\n    debounces.set(root, setTimeout(() => {\n        parents.forEach((parent) => forEach(parent, (el) => lowPriority(() => updatePos(el))));\n    }, 100));\n}\n/**\n * Its possible for a quick scroll or other fast events to get past the\n * intersection observer, so occasionally we need want \"cold-poll\" for the\n * latests and greatest position. We try to do this in the most non-disruptive\n * fashion possible. First we only do this ever couple seconds, staggard by a\n * random offset.\n * @param el - Element\n */\nfunction poll(el) {\n    setTimeout(() => {\n        intervals.set(el, setInterval(() => lowPriority(updatePos.bind(null, el)), 2000));\n    }, Math.round(2000 * Math.random()));\n}\n/**\n * Perform some operation that is non critical at some point.\n * @param callback\n */\nfunction lowPriority(callback) {\n    if (typeof requestIdleCallback === \"function\") {\n        requestIdleCallback(() => callback());\n    }\n    else {\n        requestAnimationFrame(() => callback());\n    }\n}\n/**\n * A resize observer, responsible for recalculating elements on resize.\n */\nlet resize;\n/**\n * Ensure the browser is supported.\n */\nconst supportedBrowser = typeof window !== \"undefined\" && \"ResizeObserver\" in window;\n/**\n * If this is in a browser, initialize our Web APIs\n */\nif (supportedBrowser) {\n    root = document.documentElement;\n    new MutationObserver(handleMutations);\n    resize = new ResizeObserver(handleResizes);\n    window.addEventListener(\"scroll\", () => {\n        scrollY = window.scrollY;\n        scrollX = window.scrollX;\n    });\n    resize.observe(root);\n}\n/**\n * Retrieves all the elements that may have been affected by the last mutation\n * including ones that have been removed and are no longer in the DOM.\n * @param mutations - A mutation list.\n * @returns\n */\nfunction getElements(mutations) {\n    const observedNodes = mutations.reduce((nodes, mutation) => {\n        return [\n            ...nodes,\n            ...Array.from(mutation.addedNodes),\n            ...Array.from(mutation.removedNodes),\n        ];\n    }, []);\n    // Short circuit if _only_ comment nodes are observed\n    const onlyCommentNodesObserved = observedNodes.every((node) => node.nodeName === \"#comment\");\n    if (onlyCommentNodesObserved)\n        return false;\n    return mutations.reduce((elements, mutation) => {\n        // Short circuit if we find a purposefully deleted node.\n        if (elements === false)\n            return false;\n        if (mutation.target instanceof Element) {\n            target(mutation.target);\n            if (!elements.has(mutation.target)) {\n                elements.add(mutation.target);\n                for (let i = 0; i < mutation.target.children.length; i++) {\n                    const child = mutation.target.children.item(i);\n                    if (!child)\n                        continue;\n                    if (DEL in child) {\n                        return false;\n                    }\n                    target(mutation.target, child);\n                    elements.add(child);\n                }\n            }\n            if (mutation.removedNodes.length) {\n                for (let i = 0; i < mutation.removedNodes.length; i++) {\n                    const child = mutation.removedNodes[i];\n                    if (DEL in child) {\n                        return false;\n                    }\n                    if (child instanceof Element) {\n                        elements.add(child);\n                        target(mutation.target, child);\n                        siblings.set(child, [\n                            mutation.previousSibling,\n                            mutation.nextSibling,\n                        ]);\n                    }\n                }\n            }\n        }\n        return elements;\n    }, new Set());\n}\n/**\n * Assign the target to an element.\n * @param el - The root element\n * @param child\n */\nfunction target(el, child) {\n    if (!child && !(TGT in el))\n        Object.defineProperty(el, TGT, { value: el });\n    else if (child && !(TGT in child))\n        Object.defineProperty(child, TGT, { value: el });\n}\n/**\n * Determines what kind of change took place on the given element and then\n * performs the proper animation based on that.\n * @param el - The specific element to animate.\n */\nfunction animate(el) {\n    var _a, _b;\n    const isMounted = el.isConnected;\n    const preExisting = coords.has(el);\n    if (isMounted && siblings.has(el))\n        siblings.delete(el);\n    if (((_a = animations.get(el)) === null || _a === void 0 ? void 0 : _a.playState) !== \"finished\") {\n        (_b = animations.get(el)) === null || _b === void 0 ? void 0 : _b.cancel();\n    }\n    if (NEW in el) {\n        add(el);\n    }\n    else if (preExisting && isMounted) {\n        remain(el);\n    }\n    else if (preExisting && !isMounted) {\n        remove(el);\n    }\n    else {\n        add(el);\n    }\n}\n/**\n * Removes all non-digits from a string and casts to a number.\n * @param str - A string containing a pixel value.\n * @returns\n */\nfunction raw(str) {\n    return Number(str.replace(/[^0-9.\\-]/g, \"\"));\n}\n/**\n * Get the scroll offset of elements\n * @param el - Element\n * @returns\n */\nfunction getScrollOffset(el) {\n    let p = el.parentElement;\n    while (p) {\n        if (p.scrollLeft || p.scrollTop) {\n            return { x: p.scrollLeft, y: p.scrollTop };\n        }\n        p = p.parentElement;\n    }\n    return { x: 0, y: 0 };\n}\n/**\n * Get the coordinates of elements adjusted for scroll position.\n * @param el - Element\n * @returns\n */\nfunction getCoords(el) {\n    const rect = el.getBoundingClientRect();\n    const { x, y } = getScrollOffset(el);\n    return {\n        top: rect.top + y,\n        left: rect.left + x,\n        width: rect.width,\n        height: rect.height,\n    };\n}\n/**\n * Returns the width/height that the element should be transitioned between.\n * This takes into account box-sizing.\n * @param el - Element being animated\n * @param oldCoords - Old set of Coordinates coordinates\n * @param newCoords - New set of Coordinates coordinates\n * @returns\n */\nfunction getTransitionSizes(el, oldCoords, newCoords) {\n    let widthFrom = oldCoords.width;\n    let heightFrom = oldCoords.height;\n    let widthTo = newCoords.width;\n    let heightTo = newCoords.height;\n    const styles = getComputedStyle(el);\n    const sizing = styles.getPropertyValue(\"box-sizing\");\n    if (sizing === \"content-box\") {\n        const paddingY = raw(styles.paddingTop) +\n            raw(styles.paddingBottom) +\n            raw(styles.borderTopWidth) +\n            raw(styles.borderBottomWidth);\n        const paddingX = raw(styles.paddingLeft) +\n            raw(styles.paddingRight) +\n            raw(styles.borderRightWidth) +\n            raw(styles.borderLeftWidth);\n        widthFrom -= paddingX;\n        widthTo -= paddingX;\n        heightFrom -= paddingY;\n        heightTo -= paddingY;\n    }\n    return [widthFrom, widthTo, heightFrom, heightTo].map(Math.round);\n}\n/**\n * Retrieves animation options for the current element.\n * @param el - Element to retrieve options for.\n * @returns\n */\nfunction getOptions(el) {\n    return TGT in el && options.has(el[TGT])\n        ? options.get(el[TGT])\n        : { duration: 250, easing: \"ease-in-out\" };\n}\n/**\n * Returns the target of a given animation (generally the parent).\n * @param el - An element to check for a target\n * @returns\n */\nfunction getTarget(el) {\n    if (TGT in el)\n        return el[TGT];\n    return undefined;\n}\n/**\n * Checks if animations are enabled or disabled for a given element.\n * @param el - Any element\n * @returns\n */\nfunction isEnabled(el) {\n    const target = getTarget(el);\n    return target ? enabled.has(target) : false;\n}\n/**\n * Iterate over the children of a given parent.\n * @param parent - A parent element\n * @param callback - A callback\n */\nfunction forEach(parent, ...callbacks) {\n    callbacks.forEach((callback) => callback(parent, options.has(parent)));\n    for (let i = 0; i < parent.children.length; i++) {\n        const child = parent.children.item(i);\n        if (child) {\n            callbacks.forEach((callback) => callback(child, options.has(child)));\n        }\n    }\n}\n/**\n * Always return tuple to provide consistent interface\n */\nfunction getPluginTuple(pluginReturn) {\n    if (Array.isArray(pluginReturn))\n        return pluginReturn;\n    return [pluginReturn];\n}\n/**\n * Determine if config is plugin\n */\nfunction isPlugin(config) {\n    return typeof config === \"function\";\n}\n/**\n * The element in question is remaining in the DOM.\n * @param el - Element to flip\n * @returns\n */\nfunction remain(el) {\n    const oldCoords = coords.get(el);\n    const newCoords = getCoords(el);\n    if (!isEnabled(el))\n        return coords.set(el, newCoords);\n    if (isOffscreen(el)) {\n        // When element is offscreen, skip FLIP to avoid broken transforms\n        coords.set(el, newCoords);\n        observePosition(el);\n        return;\n    }\n    let animation;\n    if (!oldCoords)\n        return;\n    const pluginOrOptions = getOptions(el);\n    if (typeof pluginOrOptions !== \"function\") {\n        let deltaLeft = oldCoords.left - newCoords.left;\n        let deltaTop = oldCoords.top - newCoords.top;\n        const deltaRight = oldCoords.left + oldCoords.width - (newCoords.left + newCoords.width);\n        const deltaBottom = oldCoords.top + oldCoords.height - (newCoords.top + newCoords.height);\n        // element is probably anchored and doesn't need to be offset\n        if (deltaBottom == 0)\n            deltaTop = 0;\n        if (deltaRight == 0)\n            deltaLeft = 0;\n        const [widthFrom, widthTo, heightFrom, heightTo] = getTransitionSizes(el, oldCoords, newCoords);\n        const start = {\n            transform: `translate(${deltaLeft}px, ${deltaTop}px)`,\n        };\n        const end = {\n            transform: `translate(0, 0)`,\n        };\n        if (widthFrom !== widthTo) {\n            start.width = `${widthFrom}px`;\n            end.width = `${widthTo}px`;\n        }\n        if (heightFrom !== heightTo) {\n            start.height = `${heightFrom}px`;\n            end.height = `${heightTo}px`;\n        }\n        animation = el.animate([start, end], {\n            duration: pluginOrOptions.duration,\n            easing: pluginOrOptions.easing,\n        });\n    }\n    else {\n        const [keyframes] = getPluginTuple(pluginOrOptions(el, \"remain\", oldCoords, newCoords));\n        animation = new Animation(keyframes);\n        animation.play();\n    }\n    animations.set(el, animation);\n    coords.set(el, newCoords);\n    animation.addEventListener(\"finish\", updatePos.bind(null, el, false), {\n        once: true,\n    });\n}\n/**\n * Adds the element with a transition.\n * @param el - Animates the element being added.\n */\nfunction add(el) {\n    if (NEW in el)\n        delete el[NEW];\n    const newCoords = getCoords(el);\n    coords.set(el, newCoords);\n    const pluginOrOptions = getOptions(el);\n    if (!isEnabled(el))\n        return;\n    if (isOffscreen(el)) {\n        // Skip entry animation if element is not visible in viewport\n        observePosition(el);\n        return;\n    }\n    let animation;\n    if (typeof pluginOrOptions !== \"function\") {\n        animation = el.animate([\n            { transform: \"scale(.98)\", opacity: 0 },\n            { transform: \"scale(0.98)\", opacity: 0, offset: 0.5 },\n            { transform: \"scale(1)\", opacity: 1 },\n        ], {\n            duration: pluginOrOptions.duration * 1.5,\n            easing: \"ease-in\",\n        });\n    }\n    else {\n        const [keyframes] = getPluginTuple(pluginOrOptions(el, \"add\", newCoords));\n        animation = new Animation(keyframes);\n        animation.play();\n    }\n    animations.set(el, animation);\n    animation.addEventListener(\"finish\", updatePos.bind(null, el, false), {\n        once: true,\n    });\n}\n/**\n * Clean up after removing an element from the dom.\n * @param el - Element being removed\n * @param styles - Optional styles that should be removed from the element.\n */\nfunction cleanUp(el, styles) {\n    var _a;\n    el.remove();\n    coords.delete(el);\n    siblings.delete(el);\n    animations.delete(el);\n    (_a = intersections.get(el)) === null || _a === void 0 ? void 0 : _a.disconnect();\n    setTimeout(() => {\n        if (DEL in el)\n            delete el[DEL];\n        Object.defineProperty(el, NEW, { value: true, configurable: true });\n        if (styles && el instanceof HTMLElement) {\n            for (const style in styles) {\n                el.style[style] = \"\";\n            }\n        }\n    }, 0);\n}\n/**\n * Animates the removal of an element.\n * @param el - Element to remove\n */\nfunction remove(el) {\n    var _a;\n    if (!siblings.has(el) || !coords.has(el))\n        return;\n    const [prev, next] = siblings.get(el);\n    Object.defineProperty(el, DEL, { value: true, configurable: true });\n    const finalX = window.scrollX;\n    const finalY = window.scrollY;\n    if (next &&\n        next.parentNode &&\n        next.parentNode instanceof Element) {\n        next.parentNode.insertBefore(el, next);\n    }\n    else if (prev && prev.parentNode) {\n        prev.parentNode.appendChild(el);\n    }\n    else {\n        (_a = getTarget(el)) === null || _a === void 0 ? void 0 : _a.appendChild(el);\n    }\n    if (!isEnabled(el))\n        return cleanUp(el);\n    const [top, left, width, height] = deletePosition(el);\n    const optionsOrPlugin = getOptions(el);\n    const oldCoords = coords.get(el);\n    if (finalX !== scrollX || finalY !== scrollY) {\n        adjustScroll(el, finalX, finalY, optionsOrPlugin);\n    }\n    let animation;\n    let styleReset = {\n        position: \"absolute\",\n        top: `${top}px`,\n        left: `${left}px`,\n        width: `${width}px`,\n        height: `${height}px`,\n        margin: \"0\",\n        pointerEvents: \"none\",\n        transformOrigin: \"center\",\n        zIndex: \"100\",\n    };\n    if (!isPlugin(optionsOrPlugin)) {\n        Object.assign(el.style, styleReset);\n        animation = el.animate([\n            {\n                transform: \"scale(1)\",\n                opacity: 1,\n            },\n            {\n                transform: \"scale(.98)\",\n                opacity: 0,\n            },\n        ], {\n            duration: optionsOrPlugin.duration,\n            easing: \"ease-out\",\n        });\n    }\n    else {\n        const [keyframes, options] = getPluginTuple(optionsOrPlugin(el, \"remove\", oldCoords));\n        if ((options === null || options === void 0 ? void 0 : options.styleReset) !== false) {\n            styleReset =\n                (options === null || options === void 0 ? void 0 : options.styleReset) ||\n                    styleReset;\n            Object.assign(el.style, styleReset);\n        }\n        animation = new Animation(keyframes);\n        animation.play();\n    }\n    animations.set(el, animation);\n    animation.addEventListener(\"finish\", () => cleanUp(el, styleReset), {\n        once: true,\n    });\n}\n/**\n * If the element being removed is at the very bottom of the page, and the\n * the page was scrolled into a space being \"made available\" by the element\n * that was removed, the page scroll will have jumped up some amount. We need\n * to offset the jump by the amount that the page was \"automatically\" scrolled\n * up. We can do this by comparing the scroll position before and after the\n * element was removed, and then offsetting by that amount.\n *\n * @param el - The element being deleted\n * @param finalX - The final X scroll position\n * @param finalY - The final Y scroll position\n * @param optionsOrPlugin - The options or plugin\n * @returns\n */\nfunction adjustScroll(el, finalX, finalY, optionsOrPlugin) {\n    const scrollDeltaX = scrollX - finalX;\n    const scrollDeltaY = scrollY - finalY;\n    const scrollBefore = document.documentElement.style.scrollBehavior;\n    const scrollBehavior = getComputedStyle(root).scrollBehavior;\n    if (scrollBehavior === \"smooth\") {\n        document.documentElement.style.scrollBehavior = \"auto\";\n    }\n    window.scrollTo(window.scrollX + scrollDeltaX, window.scrollY + scrollDeltaY);\n    if (!el.parentElement)\n        return;\n    const parent = el.parentElement;\n    let lastHeight = parent.clientHeight;\n    let lastWidth = parent.clientWidth;\n    const startScroll = performance.now();\n    // Here we use a manual scroll animation to keep the element using the same\n    // easing and timing as the parents scroll animation.\n    function smoothScroll() {\n        requestAnimationFrame(() => {\n            if (!isPlugin(optionsOrPlugin)) {\n                const deltaY = lastHeight - parent.clientHeight;\n                const deltaX = lastWidth - parent.clientWidth;\n                if (startScroll + optionsOrPlugin.duration >\n                    performance.now()) {\n                    window.scrollTo({\n                        left: window.scrollX - deltaX,\n                        top: window.scrollY - deltaY,\n                    });\n                    lastHeight = parent.clientHeight;\n                    lastWidth = parent.clientWidth;\n                    smoothScroll();\n                }\n                else {\n                    document.documentElement.style.scrollBehavior = scrollBefore;\n                }\n            }\n        });\n    }\n    smoothScroll();\n}\n/**\n * Determines the position of the element being removed.\n * @param el - The element being deleted\n * @returns\n */\nfunction deletePosition(el) {\n    var _a;\n    const oldCoords = coords.get(el);\n    const [width, , height] = getTransitionSizes(el, oldCoords, getCoords(el));\n    let offsetParent = el.parentElement;\n    while (offsetParent &&\n        (getComputedStyle(offsetParent).position === \"static\" ||\n            offsetParent instanceof HTMLBodyElement)) {\n        offsetParent = offsetParent.parentElement;\n    }\n    if (!offsetParent)\n        offsetParent = document.body;\n    const parentStyles = getComputedStyle(offsetParent);\n    const parentCoords = !animations.has(el) || ((_a = animations.get(el)) === null || _a === void 0 ? void 0 : _a.playState) === \"finished\"\n        ? getCoords(offsetParent)\n        : coords.get(offsetParent);\n    const top = Math.round(oldCoords.top - parentCoords.top) -\n        raw(parentStyles.borderTopWidth);\n    const left = Math.round(oldCoords.left - parentCoords.left) -\n        raw(parentStyles.borderLeftWidth);\n    return [top, left, width, height];\n}\n/**\n * A function that automatically adds animation effects to itself and its\n * immediate children. Specifically it adds effects for adding, moving, and\n * removing DOM elements.\n * @param el - A parent element to add animations to.\n * @param options - An optional object of options.\n */\nfunction autoAnimate(el, config = {}) {\n    if (supportedBrowser && resize) {\n        const mediaQuery = window.matchMedia(\"(prefers-reduced-motion: reduce)\");\n        const isDisabledDueToReduceMotion = mediaQuery.matches &&\n            !isPlugin(config) &&\n            !config.disrespectUserMotionPreference;\n        if (!isDisabledDueToReduceMotion) {\n            enabled.add(el);\n            if (getComputedStyle(el).position === \"static\") {\n                Object.assign(el.style, { position: \"relative\" });\n            }\n            forEach(el, updatePos, poll, (element) => resize === null || resize === void 0 ? void 0 : resize.observe(element));\n            if (isPlugin(config)) {\n                options.set(el, config);\n            }\n            else {\n                options.set(el, {\n                    duration: 250,\n                    easing: \"ease-in-out\",\n                    ...config,\n                });\n            }\n            const mo = new MutationObserver(handleMutations);\n            mo.observe(el, { childList: true });\n            mutationObservers.set(el, mo);\n            parents.add(el);\n        }\n    }\n    const controller = Object.freeze({\n        parent: el,\n        enable: () => {\n            enabled.add(el);\n        },\n        disable: () => {\n            enabled.delete(el);\n            // Cancel any in-flight animations and pending timers for immediate effect\n            forEach(el, (node) => {\n                const a = animations.get(node);\n                try {\n                    a === null || a === void 0 ? void 0 : a.cancel();\n                }\n                catch { }\n                animations.delete(node);\n                const d = debounces.get(node);\n                if (d)\n                    clearTimeout(d);\n                debounces.delete(node);\n                const i = intervals.get(node);\n                if (i)\n                    clearInterval(i);\n                intervals.delete(node);\n            });\n        },\n        isEnabled: () => enabled.has(el),\n        destroy: () => {\n            enabled.delete(el);\n            parents.delete(el);\n            options.delete(el);\n            const mo = mutationObservers.get(el);\n            mo === null || mo === void 0 ? void 0 : mo.disconnect();\n            mutationObservers.delete(el);\n            forEach(el, (node) => {\n                // unobserve resize\n                resize === null || resize === void 0 ? void 0 : resize.unobserve(node);\n                // cancel animations\n                const a = animations.get(node);\n                try {\n                    a === null || a === void 0 ? void 0 : a.cancel();\n                }\n                catch { }\n                animations.delete(node);\n                // disconnect observers\n                const io = intersections.get(node);\n                io === null || io === void 0 ? void 0 : io.disconnect();\n                intersections.delete(node);\n                // clear intervals and debounces\n                const i = intervals.get(node);\n                if (i)\n                    clearInterval(i);\n                intervals.delete(node);\n                const d = debounces.get(node);\n                if (d)\n                    clearTimeout(d);\n                debounces.delete(node);\n                // clear state\n                coords.delete(node);\n                siblings.delete(node);\n            });\n        },\n    });\n    return controller;\n}\n/**\n * The vue directive.\n */\nconst vAutoAnimate = {\n    mounted: (el, binding) => {\n        const ctl = autoAnimate(el, binding.value || {});\n        Object.defineProperty(el, \"__aa_ctl\", { value: ctl, configurable: true });\n    },\n    unmounted: (el) => {\n        var _a;\n        const ctl = el[\"__aa_ctl\"];\n        (_a = ctl === null || ctl === void 0 ? void 0 : ctl.destroy) === null || _a === void 0 ? void 0 : _a.call(ctl);\n        try {\n            delete el[\"__aa_ctl\"];\n        }\n        catch { }\n    },\n    getSSRProps: () => ({}),\n};\n\nexport { autoAnimate, autoAnimate as default, getTransitionSizes, vAutoAnimate };\n","import { useRef, useState, useEffect } from 'preact/hooks';\nimport autoAnimate from '../index.mjs';\n\n/**\n * AutoAnimate hook for adding dead-simple transitions and animations to preact.\n * @param options - Auto animate options or a plugin\n * @returns\n */\nfunction useAutoAnimate(options) {\n    const element = useRef(null);\n    const [controller, setController] = useState();\n    const setEnabled = (enabled) => {\n        if (controller) {\n            enabled ? controller.enable() : controller.disable();\n        }\n    };\n    useEffect(() => {\n        if (element.current instanceof HTMLElement)\n            setController(autoAnimate(element.current, options || {}));\n    }, []);\n    useEffect(() => {\n        return () => {\n            var _a;\n            (_a = controller === null || controller === void 0 ? void 0 : controller.destroy) === null || _a === void 0 ? void 0 : _a.call(controller);\n        };\n    }, [controller]);\n    return [element, setEnabled];\n}\n\nexport { useAutoAnimate };\n","function dec2hex(dec) {\n  return ('0' + dec.toString(16)).slice(-2);\n}\nexport function verifier() {\n  var array = new Uint32Array(56 / 2);\n  window.crypto.getRandomValues(array);\n  return Array.from(array, dec2hex).join('');\n}\nfunction sha256(plain) {\n  // returns promise ArrayBuffer\n  const encoder = new TextEncoder();\n  const data = encoder.encode(plain);\n  return window.crypto.subtle.digest('SHA-256', data);\n}\nfunction base64urlencode(a) {\n  let str = '';\n  const bytes = new Uint8Array(a);\n  const len = bytes.byteLength;\n  for (var i = 0; i < len; i++) {\n    str += String.fromCharCode(bytes[i]);\n  }\n  return btoa(str).replace(/\\+/g, '-').replace(/\\//g, '_').replace(/=+$/, '');\n}\nexport async function generateCodeChallenge(v) {\n  const hashed = await sha256(v);\n  return base64urlencode(hashed);\n}\n\n// If /.well-known/oauth-authorization-server exists and code_challenge_methods_supported includes \"S256\", means support PKCE\nexport async function supportsPKCE({ instanceURL }) {\n  if (!instanceURL) return false;\n  try {\n    const res = await fetch(\n      `https://${instanceURL}/.well-known/oauth-authorization-server`,\n    );\n    if (!res.ok || res.status !== 200) return false;\n    const json = await res.json();\n    if (json.code_challenge_methods_supported?.includes('S256')) return true;\n    return false;\n  } catch (e) {\n    return false;\n  }\n}\n\n// For debugging\nwindow.__generateCodeChallenge = generateCodeChallenge;\n","import { generateCodeChallenge, verifier } from './oauth-pkce';\n\nconst {\n  DEV,\n  PHANPY_CLIENT_NAME: CLIENT_NAME,\n  PHANPY_WEBSITE: WEBSITE,\n} = import.meta.env;\n\nconst SCOPES = 'read write follow push';\n\n/*\n  PHANPY_WEBSITE is set to the default official site.\n  It's used in pre-built releases, so there's no way to change it dynamically\n  without rebuilding.\n  Therefore, we can't use it as redirect_uri.\n  We only use PHANPY_WEBSITE if it's \"same\" as current location URL.\n  \n  Very basic check based on location.hostname for now\n*/\nconst sameSite = WEBSITE\n  ? WEBSITE.toLowerCase().includes(location.hostname)\n  : false;\nconst currentLocation = location.origin + location.pathname;\nconst REDIRECT_URI = DEV || !sameSite ? currentLocation : WEBSITE;\n\nexport async function registerApplication({ instanceURL }) {\n  const registrationParams = new URLSearchParams({\n    client_name: CLIENT_NAME,\n    redirect_uris: REDIRECT_URI,\n    scopes: SCOPES,\n    website: WEBSITE || REDIRECT_URI,\n  });\n  const registrationResponse = await fetch(\n    `https://${instanceURL}/api/v1/apps`,\n    {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: registrationParams.toString(),\n    },\n  );\n  const registrationJSON = await registrationResponse.json();\n  if (DEV) console.log({ registrationJSON });\n  return registrationJSON;\n}\n\nexport async function getPKCEAuthorizationURL({\n  instanceURL,\n  client_id,\n  forceLogin = false,\n}) {\n  const codeVerifier = verifier();\n  const codeChallenge = await generateCodeChallenge(codeVerifier);\n  const params = new URLSearchParams({\n    client_id,\n    code_challenge_method: 'S256',\n    code_challenge: codeChallenge,\n    redirect_uri: REDIRECT_URI,\n    response_type: 'code',\n    scope: SCOPES,\n  });\n  if (forceLogin) params.append('force_login', true);\n  const authorizationURL = `https://${instanceURL}/oauth/authorize?${params.toString()}`;\n  return [authorizationURL, codeVerifier];\n}\n\nexport async function getAuthorizationURL({\n  instanceURL,\n  client_id,\n  forceLogin = false,\n}) {\n  const authorizationParams = new URLSearchParams({\n    client_id,\n    scope: SCOPES,\n    redirect_uri: REDIRECT_URI,\n    // redirect_uri: 'urn:ietf:wg:oauth:2.0:oob',\n    response_type: 'code',\n  });\n  if (forceLogin) authorizationParams.append('force_login', true);\n  const authorizationURL = `https://${instanceURL}/oauth/authorize?${authorizationParams.toString()}`;\n  return authorizationURL;\n}\n\nexport async function getAccessToken({\n  instanceURL,\n  client_id,\n  client_secret,\n  code,\n  code_verifier,\n}) {\n  const params = new URLSearchParams({\n    client_id,\n    redirect_uri: REDIRECT_URI,\n    grant_type: 'authorization_code',\n    code,\n    // scope: SCOPES, // Not needed\n    // client_secret,\n    // code_verifier,\n  });\n  if (client_secret) {\n    params.append('client_secret', client_secret);\n  }\n  if (code_verifier) {\n    params.append('code_verifier', code_verifier);\n  }\n  const tokenResponse = await fetch(`https://${instanceURL}/oauth/token`, {\n    method: 'POST',\n    headers: {\n      'Content-Type': 'application/x-www-form-urlencoded',\n    },\n    body: params.toString(),\n  });\n  const tokenJSON = await tokenResponse.json();\n  if (DEV) console.log({ tokenJSON });\n  return tokenJSON;\n}\n\nexport async function revokeAccessToken({\n  instanceURL,\n  client_id,\n  client_secret,\n  token,\n}) {\n  try {\n    const params = new URLSearchParams({\n      client_id,\n      client_secret,\n      token,\n    });\n\n    const revokeResponse = await fetch(`https://${instanceURL}/oauth/revoke`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded',\n      },\n      body: params.toString(),\n      keepalive: true,\n    });\n\n    return revokeResponse.ok;\n  } catch (error) {\n    console.error('Error revoking token', error);\n    return false;\n  }\n}\n","import './accounts.css';\n\nimport { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useReducer } from 'preact/hooks';\n\nimport Avatar from '../components/avatar';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport MenuConfirm from '../components/menu-confirm';\nimport MenuLink from '../components/menu-link';\nimport Menu2 from '../components/menu2';\nimport NameText from '../components/name-text';\nimport RelativeTime from '../components/relative-time';\nimport { api } from '../utils/api';\nimport { revokeAccessToken } from '../utils/auth';\nimport niceDateTime from '../utils/nice-date-time';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport {\n  getAccounts,\n  getCurrentAccountID,\n  saveAccounts,\n  setCurrentAccountID,\n} from '../utils/store-utils';\n\nconst isStandalone = window.matchMedia('(display-mode: standalone)').matches;\n\nfunction Accounts({ onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  // Accounts\n  const accounts = getAccounts();\n  const currentAccount = getCurrentAccountID();\n  const moreThanOneAccount = accounts.length > 1;\n\n  const [_, reload] = useReducer((x) => x + 1, 0);\n  const [accountsListParent] = useAutoAnimate();\n\n  return (\n    <div id=\"accounts-container\" class=\"sheet\" tabIndex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header class=\"header-grid\">\n        <h2>\n          <Trans>Accounts</Trans>\n        </h2>\n      </header>\n      <main>\n        <section>\n          <ul class=\"accounts-list\" ref={accountsListParent}>\n            {accounts.map((account, i) => {\n              const isCurrent = account.info.id === currentAccount;\n              const isDefault = i === 0; // first account is always default\n              const isLoggedOut = !account.accessToken;\n              return (\n                <li key={account.info.id}>\n                  <div>\n                    {moreThanOneAccount && (\n                      <span class={`current ${isCurrent ? 'is-current' : ''}`}>\n                        <Icon icon=\"check-circle\" alt={t`Current`} />\n                      </span>\n                    )}\n                    <Avatar\n                      url={account.info.avatarStatic}\n                      size=\"xxl\"\n                      onDblClick={async () => {\n                        if (isCurrent) {\n                          try {\n                            const info = await masto.v1.accounts\n                              .$select(account.info.id)\n                              .fetch();\n                            console.log('fetched account info', info);\n                            account.info = info;\n                            saveAccounts(accounts);\n                            reload();\n                          } catch (e) {}\n                        }\n                      }}\n                    />\n                    <NameText\n                      account={\n                        moreThanOneAccount\n                          ? {\n                              ...account.info,\n                              acct: /@/.test(account.info.acct)\n                                ? account.info.acct\n                                : `${account.info.acct}@${account.instanceURL}`,\n                            }\n                          : account.info\n                      }\n                      showAcct\n                      onClick={() => {\n                        if (isLoggedOut) {\n                          location.href = `/#/login?instance=${account.instanceURL}`;\n                          onClose();\n                        } else if (isCurrent) {\n                          states.showAccount = `${account.info.username}@${account.instanceURL}`;\n                        } else {\n                          setCurrentAccountID(account.info.id);\n                          location.reload();\n                        }\n                      }}\n                    />\n                  </div>\n                  <div class=\"actions\">\n                    {isLoggedOut && (\n                      <span class=\"tag\">\n                        <Trans>Logged out</Trans>\n                      </span>\n                    )}\n                    {isDefault && moreThanOneAccount && (\n                      <>\n                        <span class=\"tag\">\n                          <Trans>Default</Trans>\n                        </span>{' '}\n                      </>\n                    )}\n                    <Menu2\n                      align=\"end\"\n                      menuButton={\n                        <button type=\"button\" class=\"plain more-button\">\n                          <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n                        </button>\n                      }\n                    >\n                      {moreThanOneAccount && (\n                        <>\n                          <MenuItem\n                            disabled={isCurrent || isLoggedOut}\n                            onClick={() => {\n                              setCurrentAccountID(account.info.id);\n                              location.reload();\n                            }}\n                          >\n                            <Icon icon=\"transfer\" />{' '}\n                            <Trans>Switch to this account</Trans>\n                          </MenuItem>\n                          {!isStandalone && !isCurrent && !isLoggedOut && (\n                            <MenuLink\n                              href={`./?account=${account.info.id}`}\n                              target=\"_blank\"\n                            >\n                              <Icon icon=\"external\" />\n                              <span>\n                                <Trans>Switch in new tab/window</Trans>\n                              </span>\n                            </MenuLink>\n                          )}\n                          <MenuDivider />\n                        </>\n                      )}\n                      <MenuItem\n                        onClick={() => {\n                          states.showAccount = `${account.info.username}@${account.instanceURL}`;\n                        }}\n                      >\n                        <Icon icon=\"user\" />\n                        <span>\n                          <Trans>View profile</Trans>\n                        </span>\n                      </MenuItem>\n                      <MenuDivider />\n                      {moreThanOneAccount && (\n                        <>\n                          <MenuItem\n                            disabled={isDefault || isLoggedOut}\n                            onClick={() => {\n                              // Move account to the top of the list\n                              accounts.splice(i, 1);\n                              accounts.unshift(account);\n                              saveAccounts(accounts);\n                              reload();\n                            }}\n                          >\n                            <Icon icon=\"check-circle\" />\n                            <span>\n                              <Trans>Set as default</Trans>\n                            </span>\n                          </MenuItem>\n                          <MenuItem\n                            disabled={i <= 1}\n                            onClick={() => {\n                              // Move account one position up\n                              accounts.splice(i, 1);\n                              accounts.splice(i - 1, 0, account);\n                              saveAccounts(accounts);\n                              reload();\n                            }}\n                          >\n                            <Icon icon=\"arrow-up\" />\n                            <span>\n                              <Trans>Move up</Trans>\n                            </span>\n                          </MenuItem>\n                          <MenuItem\n                            disabled={i === 0 || i === accounts.length - 1}\n                            onClick={() => {\n                              // Move account one position down\n                              accounts.splice(i, 1);\n                              accounts.splice(i + 1, 0, account);\n                              saveAccounts(accounts);\n                              reload();\n                            }}\n                          >\n                            <Icon icon=\"arrow-down\" />\n                            <span>\n                              <Trans>Move down</Trans>\n                            </span>\n                          </MenuItem>\n                          <MenuDivider />\n                        </>\n                      )}\n                      <MenuConfirm\n                        subMenu\n                        confirmLabel={\n                          <>\n                            <Icon icon=\"exit\" />\n                            <span>\n                              <Trans>\n                                Log out{' '}\n                                <span class=\"bidi-isolate\">\n                                  @{account.info.acct}\n                                </span>\n                                ?\n                              </Trans>\n                            </span>\n                          </>\n                        }\n                        disabled={!isCurrent || isLoggedOut}\n                        menuItemClassName=\"danger\"\n                        onClick={async () => {\n                          // const yes = confirm('Log out?');\n                          // if (!yes) return;\n                          await revokeAccessToken({\n                            instanceURL: account.instanceURL,\n                            client_id: account.clientId,\n                            client_secret: account.clientSecret,\n                            token: account.accessToken,\n                          });\n                          accounts.splice(i, 1);\n                          saveAccounts(accounts);\n                          // location.reload();\n                          try {\n                            // Clean up session currentAccount if same as deleted\n                            if (\n                              store.session.get('currentAccount') ===\n                              account.info.id\n                            ) {\n                              store.session.del('currentAccount');\n                            }\n                          } catch (e) {}\n                          location.href = location.pathname || '/';\n                        }}\n                      >\n                        <Icon icon=\"exit\" />\n                        <span>\n                          <Trans>Log out</Trans>\n                        </span>\n                      </MenuConfirm>\n                      {!!account?.createdAt && (\n                        <div class=\"footer\">\n                          <Icon icon=\"account-add\" />\n                          <span>\n                            <Trans>\n                              Connected on {niceDateTime(account.createdAt)} (\n                              <RelativeTime datetime={account.createdAt} />)\n                            </Trans>\n                          </span>\n                        </div>\n                      )}\n                    </Menu2>\n                  </div>\n                </li>\n              );\n            })}\n          </ul>\n          <p>\n            <Link to=\"/login\" class=\"button plain2\" onClick={onClose}>\n              <Icon icon=\"plus\" />{' '}\n              <span>\n                <Trans>Add an existing account</Trans>\n              </span>\n            </Link>\n          </p>\n          {moreThanOneAccount && (\n            <p>\n              <small>\n                <Trans>\n                  Note: <i>Default</i> account will always be used for first\n                  load. Switched accounts will persist during the session.\n                </Trans>\n              </small>\n            </p>\n          )}\n          <p>\n            <button\n              type=\"button\"\n              class=\"light\"\n              onClick={() => (states.showImportExportAccounts = true)}\n            >\n              <Trans>Import/export</Trans>\n            </button>\n          </p>\n        </section>\n      </main>\n    </div>\n  );\n}\n\nexport default Accounts;\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e\"","// https://adactio.com/journal/22278\n// https://gist.github.com/adactio/a445544723363d37b9c31a74a03ef928\n\nclass ButtonInstall extends HTMLElement {\n  connectedCallback() {\n    this.button = this.querySelector('button');\n    if (window.matchMedia('(display-mode: standalone)').matches) {\n      this.button.remove();\n      return;\n    }\n    if (!navigator.install) {\n      this.button.remove();\n      return;\n    }\n    this.button.addEventListener('click', async (ev) => {\n      await navigator.install();\n    });\n  }\n}\n\ncustomElements.define('button-install', ButtonInstall);\n","import { useLingui } from '@lingui/react';\nimport { useMemo } from 'preact/hooks';\n\nimport { CATALOGS, DEFAULT_LANG, DEV_LOCALES, LOCALES } from '../locales';\nimport { activateLang } from '../utils/lang';\nimport localeCode2Text from '../utils/localeCode2Text';\nimport store from '../utils/store';\n\nconst regionMaps = {\n  'zh-CN': 'zh-Hans',\n  'zh-TW': 'zh-Hant',\n  'pt-BR': 'pt-BR',\n};\n\nexport default function LangSelector() {\n  const { i18n } = useLingui();\n\n  // Sorted on render, so the order won't suddenly change based on current locale\n  const populatedLocales = useMemo(() => {\n    return LOCALES.map((lang) => {\n      // Don't need regions for now, it makes text too noisy\n      // Wait till there's too many languages and there are regional clashes\n      const regionlessCode = regionMaps[lang] || lang.replace(/-[a-z]+$/i, '');\n\n      const native = localeCode2Text({\n        code: regionlessCode,\n        locale: lang,\n        fallback: CATALOGS.find((c) => c.code === lang)?.nativeName,\n      });\n\n      // Not used when rendering because it'll change based on current locale\n      // Only used for sorting on render\n      const _common = localeCode2Text({\n        code: regionlessCode,\n        locale: i18n.locale,\n        fallback: CATALOGS.find((c) => c.code === lang)?.name,\n      });\n\n      return {\n        code: lang,\n        regionlessCode,\n        _common,\n        native,\n      };\n    }).sort((a, b) => {\n      // Sort by common name\n      const order = a._common.localeCompare(b._common, i18n.locale);\n      if (order !== 0) return order;\n      // Sort by code (fallback)\n      if (a.code < b.code) return -1;\n      if (a.code > b.code) return 1;\n      return 0;\n    });\n  }, []);\n\n  return (\n    <label class=\"lang-selector\">\n      {' '}\n      <select\n        class=\"small\"\n        value={i18n.locale || DEFAULT_LANG}\n        onChange={(e) => {\n          store.local.set('lang', e.target.value);\n          activateLang(e.target.value);\n        }}\n      >\n        {populatedLocales.map(({ code, regionlessCode, native }) => {\n          // Common name changes based on current locale\n          const common = localeCode2Text({\n            code: regionlessCode,\n            locale: i18n.locale,\n            fallback: CATALOGS.find((c) => c.code === code)?.name,\n          });\n          const showCommon = !!common && common !== native;\n          return (\n            <option\n              value={code}\n              data-regionless-code={regionlessCode}\n              key={code}\n            >\n              {showCommon ? `${native} - ${common}` : native}\n            </option>\n          );\n        })}\n        {(import.meta.env.DEV || import.meta.env.PHANPY_SHOW_DEV_LOCALES) && (\n          <optgroup label=\" Development (<50% translated)\">\n            {DEV_LOCALES.map((code) => {\n              if (code === 'pseudo-LOCALE') {\n                return (\n                  <>\n                    <hr />\n                    <option value={code} key={code}>\n                      Pseudolocalization (test)\n                    </option>\n                  </>\n                );\n              }\n              const nativeName = CATALOGS.find(\n                (c) => c.code === code,\n              )?.nativeName;\n              const completion = CATALOGS.find(\n                (c) => c.code === code,\n              )?.completion;\n              return (\n                <option value={code} key={code}>\n                  {nativeName || code} &lrm;[{completion}%]\n                </option>\n              );\n            })}\n          </optgroup>\n        )}\n      </select>\n    </label>\n  );\n}\n","// Utils for push notifications\nimport { api } from './api';\nimport { getVapidKey } from './store-utils';\n\n// Subscription is an object with the following structure:\n// {\n//   data: {\n//     alerts: {\n//       admin: {\n//         report: boolean,\n//         signUp: boolean,\n//       },\n//       favourite: boolean,\n//       follow: boolean,\n//       mention: boolean,\n//       poll: boolean,\n//       reblog: boolean,\n//       status: boolean,\n//       update: boolean,\n//     }\n//   },\n//   policy: \"all\" | \"followed\" | \"follower\" | \"none\",\n//   subscription: {\n//     endpoint: string,\n//     keys: {\n//       auth: string,\n//       p256dh: string,\n//     },\n//   },\n// }\n\n// Back-end CRUD\n// =============\n\nfunction createBackendPushSubscription(subscription) {\n  const { masto } = api();\n  return masto.v1.push.subscription.create(subscription);\n}\n\nfunction fetchBackendPushSubscription() {\n  const { masto } = api();\n  return masto.v1.push.subscription.fetch();\n}\n\nfunction updateBackendPushSubscription(subscription) {\n  const { masto } = api();\n  return masto.v1.push.subscription.update(subscription);\n}\n\nfunction removeBackendPushSubscription() {\n  const { masto } = api();\n  return masto.v1.push.subscription.remove();\n}\n\n// Front-end\n// =========\n\nexport function isPushSupported() {\n  return 'serviceWorker' in navigator && 'PushManager' in window;\n}\n\nexport function getRegistration() {\n  // return navigator.serviceWorker.ready;\n  return navigator.serviceWorker.getRegistration();\n}\n\nasync function getSubscription() {\n  const registration = await getRegistration();\n  const subscription = registration\n    ? await registration.pushManager.getSubscription()\n    : undefined;\n  return { registration, subscription };\n}\n\nfunction urlBase64ToUint8Array(base64String) {\n  const padding = '='.repeat((4 - (base64String.length % 4)) % 4);\n  const base64 = `${base64String}${padding}`\n    .replace(/-/g, '+')\n    .replace(/_/g, '/');\n\n  const rawData = window.atob(base64);\n  const outputArray = new Uint8Array(rawData.length);\n\n  for (let i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}\n\n// Front-end <-> back-end\n// ======================\n\nexport async function initSubscription() {\n  if (!isPushSupported()) return;\n  const { subscription } = await getSubscription();\n  let backendSubscription = null;\n  try {\n    backendSubscription = await fetchBackendPushSubscription();\n  } catch (err) {\n    if (/(not found|unknown)/i.test(err.message)) {\n      // No subscription found\n    } else {\n      // Other error\n      throw err;\n    }\n  }\n  console.log('INIT subscription', {\n    subscription,\n    backendSubscription,\n  });\n\n  // Check if the subscription changed\n  if (backendSubscription && subscription) {\n    const sameEndpoint = backendSubscription.endpoint === subscription.endpoint;\n    const vapidKey = getVapidKey();\n    const sameKey = backendSubscription.serverKey === vapidKey;\n    if (!sameEndpoint) {\n      throw new Error('Backend subscription endpoint changed');\n    }\n    if (sameKey) {\n      // Subscription didn't change\n    } else {\n      // Subscription changed\n      console.error(' Subscription changed', {\n        sameEndpoint,\n        serverKey: backendSubscription.serverKey,\n        vapIdKey: vapidKey,\n        endpoint1: backendSubscription.endpoint,\n        endpoint2: subscription.endpoint,\n        sameKey,\n        key1: backendSubscription.serverKey,\n        key2: vapidKey,\n      });\n      throw new Error('Backend subscription key and vapid key changed');\n      // Only unsubscribe from backend, not from browser\n      // await removeBackendPushSubscription();\n      // // Now let's resubscribe\n      // // NOTE: I have no idea if this works\n      // return await updateSubscription({\n      //   data: backendSubscription.data,\n      //   policy: backendSubscription.policy,\n      // });\n    }\n  }\n\n  if (subscription && !backendSubscription) {\n    // check if account's vapidKey is same as subscription's applicationServerKey\n    const vapidKey = getVapidKey();\n    if (vapidKey) {\n      const { applicationServerKey } = subscription.options;\n      const vapidKeyStr = urlBase64ToUint8Array(vapidKey).toString();\n      const applicationServerKeyStr = new Uint8Array(\n        applicationServerKey,\n      ).toString();\n      const sameKey = vapidKeyStr === applicationServerKeyStr;\n      if (sameKey) {\n        // Subscription didn't change\n      } else {\n        // Subscription changed\n        console.error(' Subscription changed', {\n          vapidKeyStr,\n          applicationServerKeyStr,\n          sameKey,\n        });\n        // Unsubscribe since backend doesn't have a subscription\n        await subscription.unsubscribe();\n        throw new Error('Subscription key and vapid key changed');\n      }\n    } else {\n      console.warn('No vapidKey found');\n    }\n  }\n\n  // Check if backend subscription returns 404\n  // if (subscription && !backendSubscription) {\n  //   // Re-subscribe to backend\n  //   backendSubscription = await createBackendPushSubscription({\n  //     subscription,\n  //     data: {},\n  //     policy: 'all',\n  //   });\n  // }\n\n  return { subscription, backendSubscription };\n}\n\nexport async function updateSubscription({ data, policy }) {\n  console.log(' Updating subscription', { data, policy });\n  if (!isPushSupported()) return;\n  let { registration, subscription } = await getSubscription();\n  let backendSubscription = null;\n\n  if (subscription) {\n    try {\n      backendSubscription = await updateBackendPushSubscription({\n        data,\n        policy,\n      });\n      // TODO: save subscription in user settings\n    } catch (error) {\n      // Backend doesn't have a subscription for this user\n      // Create a new one\n      backendSubscription = await createBackendPushSubscription({\n        subscription,\n        data,\n        policy,\n      });\n      // TODO: save subscription in user settings\n    }\n  } else {\n    // User is not subscribed\n    const vapidKey = getVapidKey();\n    if (!vapidKey) throw new Error('No server key found');\n    subscription = await registration.pushManager.subscribe({\n      userVisibleOnly: true,\n      applicationServerKey: urlBase64ToUint8Array(vapidKey),\n    });\n    backendSubscription = await createBackendPushSubscription({\n      subscription,\n      data,\n      policy,\n    });\n    // TODO: save subscription in user settings\n  }\n\n  return { subscription, backendSubscription };\n}\n\nexport async function removeSubscription() {\n  if (!isPushSupported()) return;\n  const { subscription } = await getSubscription();\n  if (subscription) {\n    await removeBackendPushSubscription();\n    await subscription.unsubscribe();\n  }\n}\n","import './settings.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport logo from '../assets/logo.svg';\n\nimport '../components/button-install';\n\nimport Icon from '../components/icon';\nimport LangSelector from '../components/lang-selector';\nimport Link from '../components/link';\nimport RelativeTime from '../components/relative-time';\nimport languages from '../data/translang-languages';\nimport { api, getPreferences, setPreferences } from '../utils/api';\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport localeCode2Text from '../utils/localeCode2Text';\nimport prettyBytes from '../utils/pretty-bytes';\nimport {\n  initSubscription,\n  isPushSupported,\n  removeSubscription,\n  updateSubscription,\n} from '../utils/push-notifications';\nimport { supportsNativeQuote } from '../utils/quote-utils';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport { getAPIVersions, getVapidKey } from '../utils/store-utils';\n\nconst DEFAULT_TEXT_SIZE = 16;\nconst TEXT_SIZES = [14, 15, 16, 17, 18, 19, 20];\nconst {\n  PHANPY_WEBSITE: WEBSITE,\n  PHANPY_PRIVACY_POLICY_URL: PRIVACY_POLICY_URL,\n  PHANPY_TRANSLANG_INSTANCES: TRANSLANG_INSTANCES,\n  PHANPY_IMG_ALT_API_URL: IMG_ALT_API_URL,\n  PHANPY_GIPHY_API_KEY: GIPHY_API_KEY,\n  PHANPY_CLIENT_NAME: CLIENT_NAME,\n} = import.meta.env;\n\nconst targetLanguages = Object.entries(languages.tl).map(([code, name]) => ({\n  code,\n  name,\n}));\n\nconst TRANSLATION_API_NAME = 'TransLang API';\n\nfunction Settings({ onClose }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const currentTheme = store.local.get('theme') || 'auto';\n  const themeFormRef = useRef();\n  const targetLanguage =\n    snapStates.settings.contentTranslationTargetLanguage || null;\n  const systemTargetLanguage = getTranslateTargetLanguage();\n  const systemTargetLanguageText = localeCode2Text(systemTargetLanguage);\n  const currentTextSize = store.local.get('textSize') || DEFAULT_TEXT_SIZE;\n\n  const [prefs, setPrefs] = useState(getPreferences());\n  const { masto, authenticated, instance } = api();\n\n  // Get preferences every time Settings is opened\n  // NOTE: Disabled for now because I don't expect this to change often. Also for some reason, the /api/v1/preferences endpoint is cached for a while and return old prefs if refresh immediately after changing them.\n  // useEffect(() => {\n  //   const { masto } = api();\n  //   (async () => {\n  //     try {\n  //       const preferences = await masto.v1.preferences.fetch();\n  //       setPrefs(preferences);\n  //       store.account.set('preferences', preferences);\n  //     } catch (e) {\n  //       // Silently fail\n  //       console.error(e);\n  //     }\n  //   })();\n  // }, []);\n\n  const [expTabBarV2, setExpTabBarV2] = useState(\n    store.local.get('experiments-tabBarV2') ?? false,\n  );\n\n  const disableQuotePolicy = prefs['posting:default:visibility'] === 'private';\n\n  return (\n    <div\n      id=\"settings-container\"\n      class=\"sheet\"\n      tabIndex=\"-1\"\n      style={{\n        '--current-text-size': `${currentTextSize}px`,\n      }}\n    >\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Settings</Trans>\n        </h2>\n      </header>\n      <main>\n        <section>\n          <ul>\n            <li>\n              <div>\n                <label>\n                  <Trans>Appearance</Trans>\n                </label>\n              </div>\n              <div>\n                <form\n                  ref={themeFormRef}\n                  onInput={(e) => {\n                    console.log(e);\n                    e.preventDefault();\n                    const formData = new FormData(themeFormRef.current);\n                    const theme = formData.get('theme');\n                    const html = document.documentElement;\n\n                    if (theme === 'auto') {\n                      html.classList.remove('is-light', 'is-dark');\n\n                      // Disable manual theme <meta>\n                      const $manualMeta = document.querySelector(\n                        'meta[data-theme-setting=\"manual\"]',\n                      );\n                      if ($manualMeta) {\n                        $manualMeta.name = '';\n                      }\n                      // Enable auto theme <meta>s\n                      const $autoMetas = document.querySelectorAll(\n                        'meta[data-theme-setting=\"auto\"]',\n                      );\n                      $autoMetas.forEach((m) => {\n                        m.name = 'theme-color';\n                      });\n                    } else {\n                      html.classList.toggle('is-light', theme === 'light');\n                      html.classList.toggle('is-dark', theme === 'dark');\n\n                      // Enable manual theme <meta>\n                      const $manualMeta = document.querySelector(\n                        'meta[data-theme-setting=\"manual\"]',\n                      );\n                      if ($manualMeta) {\n                        $manualMeta.name = 'theme-color';\n                        $manualMeta.content =\n                          theme === 'light'\n                            ? $manualMeta.dataset.themeLightColor\n                            : $manualMeta.dataset.themeDarkColor;\n                      }\n                      // Disable auto theme <meta>s\n                      const $autoMetas = document.querySelectorAll(\n                        'meta[data-theme-setting=\"auto\"]',\n                      );\n                      $autoMetas.forEach((m) => {\n                        m.name = '';\n                      });\n                    }\n                    document\n                      .querySelector('meta[name=\"color-scheme\"]')\n                      .setAttribute(\n                        'content',\n                        theme === 'auto' ? 'light dark' : theme,\n                      );\n\n                    if (theme === 'auto') {\n                      store.local.del('theme');\n                    } else {\n                      store.local.set('theme', theme);\n                    }\n                  }}\n                >\n                  <div class=\"radio-group\">\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"theme\"\n                        value=\"light\"\n                        defaultChecked={currentTheme === 'light'}\n                      />\n                      <span>\n                        <Trans>Light</Trans>\n                      </span>\n                    </label>\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"theme\"\n                        value=\"dark\"\n                        defaultChecked={currentTheme === 'dark'}\n                      />\n                      <span>\n                        <Trans>Dark</Trans>\n                      </span>\n                    </label>\n                    <label>\n                      <input\n                        type=\"radio\"\n                        name=\"theme\"\n                        value=\"auto\"\n                        defaultChecked={\n                          currentTheme !== 'light' && currentTheme !== 'dark'\n                        }\n                      />\n                      <span>\n                        <Trans>Auto</Trans>\n                      </span>\n                    </label>\n                  </div>\n                </form>\n              </div>\n            </li>\n            <li>\n              <div>\n                <label>\n                  <Trans>Text size</Trans>\n                </label>\n              </div>\n              <div class=\"range-group\">\n                <span style={{ fontSize: TEXT_SIZES[0] }}>\n                  <Trans comment=\"Preview of one character, in smallest size\">\n                    A\n                  </Trans>\n                </span>{' '}\n                <input\n                  type=\"range\"\n                  min={TEXT_SIZES[0]}\n                  max={TEXT_SIZES[TEXT_SIZES.length - 1]}\n                  step=\"1\"\n                  value={currentTextSize}\n                  list=\"sizes\"\n                  onChange={(e) => {\n                    const value = parseInt(e.target.value, 10);\n                    const html = document.documentElement;\n                    // set CSS variable\n                    html.style.setProperty('--text-size', `${value}px`);\n                    // save to local storage\n                    if (value === DEFAULT_TEXT_SIZE) {\n                      store.local.del('textSize');\n                    } else {\n                      store.local.set('textSize', e.target.value);\n                    }\n                  }}\n                />{' '}\n                <span style={{ fontSize: TEXT_SIZES[TEXT_SIZES.length - 1] }}>\n                  <Trans comment=\"Preview of one character, in largest size\">\n                    A\n                  </Trans>\n                </span>\n                <datalist id=\"sizes\">\n                  {TEXT_SIZES.map((size) => (\n                    <option value={size} />\n                  ))}\n                </datalist>\n              </div>\n            </li>\n            <li>\n              <span>\n                <label>\n                  <Trans>Display language</Trans>\n                </label>{' '}\n                <small>\n                  <a\n                    href=\"https://crowdin.com/project/phanpy\"\n                    target=\"_blank\"\n                    rel=\"noopener\"\n                  >\n                    <Trans>Volunteer translations</Trans>\n                  </a>\n                </small>\n              </span>\n              <LangSelector />\n            </li>\n          </ul>\n        </section>\n        {authenticated && (\n          <>\n            <h3>\n              <Trans>Posting</Trans>\n            </h3>\n            <section>\n              <ul>\n                <li>\n                  <label for=\"posting-privacy-field\">\n                    <Trans>Default visibility</Trans>{' '}\n                    <Icon icon=\"cloud\" alt={t`Synced`} class=\"synced-icon\" />\n                  </label>\n                  <select\n                    id=\"posting-privacy-field\"\n                    value={prefs['posting:default:visibility'] || 'public'}\n                    onChange={(e) => {\n                      const { value } = e.target;\n                      (async () => {\n                        try {\n                          await masto.v1.accounts.updateCredentials({\n                            source: {\n                              privacy: value,\n                            },\n                          });\n                          const newPrefs = {\n                            ...prefs,\n                            'posting:default:visibility': value,\n                          };\n                          if (value === 'private') {\n                            newPrefs['posting:default:quote_policy'] = 'nobody';\n                          }\n                          setPrefs(newPrefs);\n                          setPreferences(newPrefs);\n                          showToast(t`Default visibility updated`);\n                        } catch (e) {\n                          alert(t`Failed to update default visibility`);\n                          console.error(e);\n                        }\n                      })();\n                    }}\n                  >\n                    <option value=\"public\">\n                      <Trans>Public</Trans>\n                    </option>\n                    <option value=\"unlisted\">\n                      <Trans>Quiet public</Trans>\n                    </option>\n                    <option value=\"private\">\n                      <Trans>Followers</Trans>\n                    </option>\n                  </select>\n                </li>\n                {supportsNativeQuote() && (\n                  <li>\n                    <label for=\"posting-quote-policy-field\">\n                      <Trans>Quote settings</Trans>{' '}\n                      <Icon icon=\"cloud\" alt={t`Synced`} class=\"synced-icon\" />\n                    </label>\n                    <select\n                      id=\"posting-quote-policy-field\"\n                      value={\n                        disableQuotePolicy\n                          ? 'nobody'\n                          : prefs['posting:default:quote_policy'] || 'public'\n                      }\n                      disabled={disableQuotePolicy}\n                      onChange={(e) => {\n                        const { value } = e.target;\n                        (async () => {\n                          try {\n                            await masto.v1.accounts.updateCredentials({\n                              source: {\n                                quote_policy: value,\n                              },\n                            });\n                            const newPrefs = {\n                              ...prefs,\n                              'posting:default:quote_policy': value,\n                            };\n                            setPrefs(newPrefs);\n                            setPreferences(newPrefs);\n                            showToast(t`Quote settings updated`);\n                          } catch (e) {\n                            alert(t`Failed to update quote settings`);\n                            console.error(e);\n                          }\n                        })();\n                      }}\n                    >\n                      <option value=\"public\" disabled={disableQuotePolicy}>\n                        <Trans>Anyone can quote</Trans>\n                      </option>\n                      <option value=\"followers\" disabled={disableQuotePolicy}>\n                        <Trans>Your followers can quote</Trans>\n                      </option>\n                      <option value=\"nobody\">\n                        <Trans>Only you can quote</Trans>\n                      </option>\n                    </select>\n                  </li>\n                )}\n              </ul>\n            </section>\n            <p class=\"section-postnote\">\n              <Icon icon=\"cloud\" alt={t`Synced`} class=\"synced-icon\" />{' '}\n              <small>\n                <Trans>\n                  Synced to your instance server's settings.{' '}\n                  <a\n                    href={`https://${instance}/`}\n                    target=\"_blank\"\n                    rel=\"noopener\"\n                  >\n                    Go to your instance ({instance}) for more settings.\n                  </a>\n                </Trans>\n              </small>\n            </p>\n          </>\n        )}\n        <h3>\n          <Trans>Experiments</Trans>\n        </h3>\n        <section>\n          <ul>\n            <li class=\"block\">\n              <label>\n                <input\n                  type=\"checkbox\"\n                  checked={snapStates.settings.autoRefresh}\n                  onChange={(e) => {\n                    states.settings.autoRefresh = e.target.checked;\n                  }}\n                />{' '}\n                <Trans>Auto refresh timeline posts</Trans>\n              </label>\n            </li>\n            <li class=\"block\">\n              <label>\n                <input\n                  type=\"checkbox\"\n                  checked={snapStates.settings.boostsCarousel}\n                  onChange={(e) => {\n                    states.settings.boostsCarousel = e.target.checked;\n                  }}\n                />{' '}\n                <Trans>Boosts carousel</Trans>\n              </label>\n            </li>\n            {!!TRANSLANG_INSTANCES && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={snapStates.settings.contentTranslation}\n                    onChange={(e) => {\n                      const { checked } = e.target;\n                      states.settings.contentTranslation = checked;\n                      if (!checked) {\n                        states.settings.contentTranslationTargetLanguage = null;\n                      }\n                    }}\n                  />{' '}\n                  <Trans>Post translation</Trans>\n                </label>\n                <div\n                  class={`sub-section ${\n                    !snapStates.settings.contentTranslation\n                      ? 'more-insignificant'\n                      : ''\n                  }`}\n                >\n                  <div>\n                    <label>\n                      <Trans>Translate to </Trans>{' '}\n                      <select\n                        value={targetLanguage || ''}\n                        disabled={!snapStates.settings.contentTranslation}\n                        style={{ width: '10em' }}\n                        onChange={(e) => {\n                          states.settings.contentTranslationTargetLanguage =\n                            e.target.value || null;\n                        }}\n                      >\n                        <option value=\"\">\n                          <Trans>\n                            System language ({systemTargetLanguageText})\n                          </Trans>\n                        </option>\n                        <option disabled></option>\n                        {targetLanguages.map((lang) => {\n                          const common = localeCode2Text({\n                            code: lang.code,\n                            fallback: lang.name,\n                          });\n                          const native = localeCode2Text({\n                            code: lang.code,\n                            locale: lang.code,\n                          });\n                          const showCommon = native && common !== native;\n                          return (\n                            <option value={lang.code}>\n                              {showCommon ? `${native} - ${common}` : common}\n                            </option>\n                          );\n                        })}\n                      </select>\n                    </label>\n                  </div>\n                  <hr />\n                  <div class=\"checkbox-fieldset\">\n                    <Plural\n                      value={\n                        snapStates.settings.contentTranslationHideLanguages\n                          .length\n                      }\n                      _0={`Hide \"Translate\" button for:`}\n                      other={`Hide \"Translate\" button for (#):`}\n                    />\n                    <div class=\"checkbox-fields\">\n                      {targetLanguages.map((lang) => {\n                        const common = localeCode2Text({\n                          code: lang.code,\n                          fallback: lang.name,\n                        });\n                        const native = localeCode2Text({\n                          code: lang.code,\n                          locale: lang.code,\n                        });\n                        const showCommon = native && common !== native;\n                        return (\n                          <label>\n                            <input\n                              type=\"checkbox\"\n                              checked={snapStates.settings.contentTranslationHideLanguages.includes(\n                                lang.code,\n                              )}\n                              onChange={(e) => {\n                                const { checked } = e.target;\n                                if (checked) {\n                                  states.settings.contentTranslationHideLanguages.push(\n                                    lang.code,\n                                  );\n                                } else {\n                                  states.settings.contentTranslationHideLanguages =\n                                    snapStates.settings.contentTranslationHideLanguages.filter(\n                                      (code) => code !== lang.code,\n                                    );\n                                }\n                              }}\n                            />{' '}\n                            {showCommon ? (\n                              <span>\n                                {native}{' '}\n                                <span class=\"insignificant ib\">- {common}</span>\n                              </span>\n                            ) : (\n                              common\n                            )}\n                          </label>\n                        );\n                      })}\n                    </div>\n                  </div>\n                  <p class=\"insignificant\">\n                    <small>\n                      <Trans>\n                        Note: This feature uses external translation services,\n                        powered by{' '}\n                        <a\n                          href=\"https://github.com/cheeaun/translang-api\"\n                          target=\"_blank\"\n                          rel=\"noopener\"\n                        >\n                          {TRANSLATION_API_NAME}\n                        </a>\n                        .\n                      </Trans>\n                    </small>\n                  </p>\n                  <hr />\n                  <div>\n                    <label>\n                      <input\n                        type=\"checkbox\"\n                        checked={\n                          snapStates.settings.contentTranslationAutoInline\n                        }\n                        disabled={!snapStates.settings.contentTranslation}\n                        onChange={(e) => {\n                          states.settings.contentTranslationAutoInline =\n                            e.target.checked;\n                        }}\n                      />{' '}\n                      <Trans>Auto inline translation</Trans>\n                    </label>\n                    <p class=\"insignificant\">\n                      <small>\n                        <Trans>\n                          Automatically show translation for posts in timeline.\n                          Only works for <b>short</b> posts without content\n                          warning, media and poll.\n                        </Trans>\n                      </small>\n                    </p>\n                  </div>\n                </div>\n              </li>\n            )}\n            {!!GIPHY_API_KEY && authenticated && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={snapStates.settings.composerGIFPicker}\n                    onChange={(e) => {\n                      states.settings.composerGIFPicker = e.target.checked;\n                    }}\n                  />{' '}\n                  <Trans>GIF Picker for composer</Trans>\n                </label>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Note: This feature uses external GIF search service,\n                      powered by{' '}\n                      <a\n                        href=\"https://developers.giphy.com/\"\n                        target=\"_blank\"\n                        rel=\"noopener\"\n                      >\n                        GIPHY\n                      </a>\n                      . G-rated (suitable for viewing by all ages), tracking\n                      parameters are stripped, referrer information is omitted\n                      from requests, but search queries and IP address\n                      information will still reach their servers.\n                    </Trans>\n                  </small>\n                </div>\n              </li>\n            )}\n            {!!IMG_ALT_API_URL && authenticated && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={snapStates.settings.mediaAltGenerator}\n                    onChange={(e) => {\n                      states.settings.mediaAltGenerator = e.target.checked;\n                    }}\n                  />{' '}\n                  <Trans>Image description generator</Trans>{' '}\n                  <Icon icon=\"sparkles2\" class=\"more-insignificant\" />\n                </label>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Only for new images while composing new posts.\n                    </Trans>\n                  </small>\n                </div>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Note: This feature uses external AI service, powered by{' '}\n                      <a\n                        href=\"https://github.com/cheeaun/img-alt-api\"\n                        target=\"_blank\"\n                        rel=\"noopener\"\n                      >\n                        img-alt-api\n                      </a>\n                      . May not work well. Only for images and in English.\n                    </Trans>\n                  </small>\n                </div>\n              </li>\n            )}\n            {authenticated && (\n              <li class=\"block\">\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    checked={\n                      snapStates.settings.shortcutSettingsCloudImportExport\n                    }\n                    onChange={(e) => {\n                      states.settings.shortcutSettingsCloudImportExport =\n                        e.target.checked;\n                    }}\n                  />{' '}\n                  <Trans>\"Cloud\" import/export for shortcuts settings</Trans>{' '}\n                  <Icon icon=\"cloud\" class=\"more-insignificant\" />\n                </label>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                       Very experimental.\n                      <br />\n                      Stored in your own profiles notes. Profile (private)\n                      notes are mainly used for other profiles, and hidden for\n                      own profile.\n                    </Trans>\n                  </small>\n                </div>\n                <div class=\"sub-section insignificant\">\n                  <small>\n                    <Trans>\n                      Note: This feature uses currently-logged-in instance\n                      server API.\n                    </Trans>\n                  </small>\n                </div>\n              </li>\n            )}\n            <li class=\"block\">\n              <label>\n                <input\n                  type=\"checkbox\"\n                  checked={snapStates.settings.cloakMode}\n                  onChange={(e) => {\n                    states.settings.cloakMode = e.target.checked;\n                  }}\n                />{' '}\n                <Trans>\n                  Cloak mode{' '}\n                  <span class=\"insignificant\">\n                    (<samp>Text</samp>  <samp></samp>)\n                  </span>\n                </Trans>\n              </label>\n              <div class=\"sub-section insignificant\">\n                <small>\n                  <Trans>\n                    Replace text as blocks, useful when taking screenshots, for\n                    privacy reasons.\n                  </Trans>\n                </small>\n              </div>\n            </li>\n            {authenticated && (\n              <li>\n                <button\n                  type=\"button\"\n                  class=\"light\"\n                  onClick={() => {\n                    states.showDrafts = true;\n                    states.showSettings = false;\n                  }}\n                >\n                  <Trans>Unsent drafts</Trans>\n                </button>\n              </li>\n            )}\n            <li>\n              <Link to=\"/yip\" onClick={onClose} class=\"button light\">\n                Year in Posts\n              </Link>\n            </li>\n            <li>\n              <button-install>\n                <button type=\"button\" class=\"light\">\n                  <Trans>Install {CLIENT_NAME}</Trans>\n                </button>\n              </button-install>\n            </li>\n          </ul>\n        </section>\n        {authenticated && <PushNotificationsSection onClose={onClose} />}\n        <h3>\n          <Trans>About</Trans>\n        </h3>\n        <section>\n          <div\n            style={{\n              display: 'flex',\n              flexWrap: 'wrap',\n              gap: 8,\n              lineHeight: 1.25,\n              alignItems: 'center',\n              marginTop: 8,\n            }}\n          >\n            <img\n              src={logo}\n              alt=\"\"\n              width=\"64\"\n              height=\"64\"\n              style={{\n                aspectRatio: '1/1',\n                verticalAlign: 'middle',\n                background: '#b7cdf9',\n                borderRadius: 12,\n              }}\n            />\n            <div>\n              <b>Phanpy</b>{' '}\n              <a\n                href=\"https://hachyderm.io/@phanpy\"\n                // target=\"_blank\"\n                rel=\"noopener\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  states.showAccount = 'phanpy@hachyderm.io';\n                }}\n              >\n                @phanpy\n              </a>\n              <br />\n              <Trans>\n                <a\n                  href=\"https://github.com/cheeaun/phanpy\"\n                  target=\"_blank\"\n                  rel=\"noopener\"\n                >\n                  Built\n                </a>{' '}\n                by{' '}\n                <a\n                  href=\"https://mastodon.social/@cheeaun\"\n                  // target=\"_blank\"\n                  rel=\"noopener\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.showAccount = 'cheeaun@mastodon.social';\n                  }}\n                >\n                  @cheeaun\n                </a>\n              </Trans>\n            </div>\n          </div>\n          <p>\n            <a\n              href=\"https://github.com/sponsors/cheeaun\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              <Trans>Sponsor</Trans>\n            </a>{' '}\n            &middot;{' '}\n            <a\n              href=\"https://www.buymeacoffee.com/cheeaun\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              <Trans>Donate</Trans>\n            </a>{' '}\n            &middot;{' '}\n            <a\n              href=\"https://patreon.com/cheeaun\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              Patreon\n            </a>{' '}\n            &middot;{' '}\n            <a\n              href=\"https://github.com/cheeaun/phanpy/blob/main/CHANGELOG.md\"\n              target=\"_blank\"\n              rel=\"noopener\"\n            >\n              <Trans>What's new</Trans>\n            </a>{' '}\n            &middot;{' '}\n            <a href={PRIVACY_POLICY_URL} target=\"_blank\" rel=\"noopener\">\n              <Trans>Privacy Policy</Trans>\n            </a>\n          </p>\n          {__COMMIT_TIME__ && (\n            <p>\n              {WEBSITE && (\n                <>\n                  <Trans>\n                    <span class=\"insignificant\">Site:</span>{' '}\n                    {WEBSITE.replace(/https?:\\/\\//g, '').replace(/\\/$/, '')}\n                  </Trans>\n                  <br />\n                </>\n              )}\n              <Trans>\n                <span class=\"insignificant\">Version:</span>{' '}\n                <input\n                  type=\"text\"\n                  class=\"version-string\"\n                  readOnly\n                  size=\"18\" // Manually calculated here\n                  value={`${__COMMIT_TIME__.slice(0, 10).replace(/-/g, '.')}${\n                    __COMMIT_HASH__ ? `.${__COMMIT_HASH__}` : ''\n                  }`}\n                  onClick={(e) => {\n                    e.target.select();\n                    // Copy to clipboard\n                    try {\n                      navigator.clipboard.writeText(e.target.value);\n                      showToast(t`Version string copied`);\n                    } catch (e) {\n                      console.warn(e);\n                      showToast(t`Unable to copy version string`);\n                    }\n                  }}\n                />{' '}\n                {!__FAKE_COMMIT_HASH__ && (\n                  <span class=\"ib insignificant\">\n                    (\n                    <a\n                      href={`https://github.com/cheeaun/phanpy/commit/${__COMMIT_HASH__}`}\n                      target=\"_blank\"\n                      rel=\"noopener\"\n                    >\n                      <RelativeTime datetime={new Date(__BUILD_TIME__)} />\n                    </a>\n                    )\n                  </span>\n                )}\n              </Trans>\n            </p>\n          )}\n        </section>\n        {(import.meta.env.DEV || import.meta.env.PHANPY_DEV) && (\n          <details class=\"debug-info\">\n            <summary></summary>\n            <p class=\"side\">\n              <Link\n                to=\"/_sandbox\"\n                onClick={onClose}\n                class=\"button plain6 small\"\n              >\n                Sandbox\n              </Link>\n            </p>\n            <p>Debugging</p>\n            <p>\n              <b>Vapid key</b>: {getVapidKey()}\n            </p>\n            {__BENCH_RESULTS?.size > 0 && (\n              <ul>\n                {Array.from(__BENCH_RESULTS.entries()).map(\n                  ([name, duration]) => (\n                    <li>\n                      <b>{name}</b>: {duration}ms\n                    </li>\n                  ),\n                )}\n              </ul>\n            )}\n            <p>Service Worker Cache</p>\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={async () => alert(await getCachesKeys())}\n            >\n              Show keys count\n            </button>{' '}\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={async () => alert(await getCachesSize())}\n            >\n              Show cache size\n            </button>{' '}\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={() => {\n                const key = prompt('Enter cache key');\n                if (!key) return;\n                try {\n                  clearCacheKey(key);\n                } catch (e) {\n                  alert(e);\n                }\n              }}\n            >\n              Clear cache key\n            </button>{' '}\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              onClick={() => {\n                try {\n                  clearCaches();\n                } catch (e) {\n                  alert(e);\n                }\n              }}\n            >\n              Clear all caches\n            </button>\n            <p>Temporary Experiments</p>\n            <label>\n              <input\n                type=\"checkbox\"\n                checked={expTabBarV2}\n                onChange={(e) => {\n                  const { checked } = e.target;\n                  document.body.classList.toggle('exp-tab-bar-v2', checked);\n                  setExpTabBarV2(checked);\n                  if (checked) {\n                    store.local.set('experiments-tabBarV2', true);\n                  } else {\n                    store.local.del('experiments-tabBarV2');\n                  }\n                }}\n              />{' '}\n              Tab bar v2\n            </label>\n          </details>\n        )}\n      </main>\n    </div>\n  );\n}\n\nasync function getCachesKeys() {\n  const keys = await caches.keys();\n  const total = {};\n  for (const key of keys) {\n    const cache = await caches.open(key);\n    const k = await cache.keys();\n    total[key] = k.length;\n  }\n  return total;\n}\n\nasync function getCachesSize() {\n  const keys = await caches.keys();\n  let total = {};\n  let TOTAL = 0;\n  for (const key of keys) {\n    const cache = await caches.open(key);\n    const k = await cache.keys();\n    for (const item of k) {\n      try {\n        const response = await cache.match(item);\n        const blob = await response.blob();\n        total[key] = (total[key] || 0) + blob.size;\n        TOTAL += blob.size;\n      } catch (e) {\n        alert('Failed to get cache size for ' + item);\n        alert(e);\n      }\n    }\n  }\n  return {\n    ...Object.fromEntries(\n      Object.entries(total).map(([k, v]) => [k, prettyBytes(v)]),\n    ),\n    TOTAL: prettyBytes(TOTAL),\n  };\n}\n\nfunction clearCacheKey(key) {\n  return caches.delete(key);\n}\n\nasync function clearCaches() {\n  const keys = await caches.keys();\n  for (const key of keys) {\n    await caches.delete(key);\n  }\n}\n\nfunction PushNotificationsSection({ onClose }) {\n  const { t } = useLingui();\n  if (!isPushSupported()) return null;\n\n  const { instance } = api();\n  const [uiState, setUIState] = useState('default');\n  const pushFormRef = useRef();\n  const [allowNotifications, setAllowNotifications] = useState(false);\n  const [needRelogin, setNeedRelogin] = useState(false);\n  const previousPolicyRef = useRef();\n  useEffect(() => {\n    (async () => {\n      setUIState('loading');\n      try {\n        const { subscription, backendSubscription } = await initSubscription();\n        if (\n          backendSubscription?.policy &&\n          backendSubscription.policy !== 'none'\n        ) {\n          setAllowNotifications(true);\n          const { alerts, policy } = backendSubscription;\n          console.log('backendSubscription', backendSubscription);\n          previousPolicyRef.current = policy;\n          const { elements } = pushFormRef.current;\n          const policyEl = elements.namedItem('policy');\n          if (policyEl) policyEl.value = policy;\n          // alerts is {}, iterate it\n          Object.entries(alerts).forEach(([alert, value]) => {\n            const el = elements.namedItem(alert);\n            if (el?.type === 'checkbox') {\n              el.checked = !!value;\n            }\n          });\n        }\n        setUIState('default');\n      } catch (err) {\n        console.warn(err);\n        if (/outside.*authorized/i.test(err.message)) {\n          setNeedRelogin(true);\n        } else {\n          alert(err?.message || err);\n        }\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  const isLoading = uiState === 'loading';\n\n  return (\n    <form\n      ref={pushFormRef}\n      onChange={() => {\n        setTimeout(() => {\n          const values = Object.fromEntries(new FormData(pushFormRef.current));\n          const allowNotifications = !!values['policy-allow'];\n          const params = {\n            data: {\n              policy: values.policy,\n              alerts: {\n                mention: !!values.mention,\n                favourite: !!values.favourite,\n                reblog: !!values.reblog,\n                follow: !!values.follow,\n                follow_request: !!values.followRequest,\n                poll: !!values.poll,\n                update: !!values.update,\n                status: !!values.status,\n              },\n            },\n          };\n\n          let alertsCount = 0;\n          // Remove false values from data.alerts\n          // API defaults to false anyway\n          Object.keys(params.data.alerts).forEach((key) => {\n            if (!params.data.alerts[key]) {\n              delete params.data.alerts[key];\n            } else {\n              alertsCount++;\n            }\n          });\n          const policyChanged =\n            previousPolicyRef.current !== params.data.policy;\n\n          console.log('PN Form', {\n            values,\n            allowNotifications: allowNotifications,\n            params,\n          });\n\n          if (allowNotifications && alertsCount > 0) {\n            if (policyChanged) {\n              console.debug('Policy changed.');\n              removeSubscription()\n                .then(() => {\n                  updateSubscription(params);\n                })\n                .catch((err) => {\n                  console.warn(err);\n                  alert(t`Failed to update subscription. Please try again.`);\n                });\n            } else {\n              updateSubscription(params).catch((err) => {\n                console.warn(err);\n                alert(t`Failed to update subscription. Please try again.`);\n              });\n            }\n          } else {\n            removeSubscription().catch((err) => {\n              console.warn(err);\n              alert(t`Failed to remove subscription. Please try again.`);\n            });\n          }\n        }, 100);\n      }}\n    >\n      <h3>\n        <Trans>Push Notifications (beta)</Trans>\n      </h3>\n      <section>\n        <ul>\n          <li>\n            <label>\n              <input\n                type=\"checkbox\"\n                disabled={isLoading || needRelogin}\n                name=\"policy-allow\"\n                checked={allowNotifications}\n                onChange={async (e) => {\n                  const { checked } = e.target;\n                  if (checked) {\n                    // Request permission\n                    const permission = await Notification.requestPermission();\n                    if (permission === 'granted') {\n                      setAllowNotifications(true);\n                    } else {\n                      setAllowNotifications(false);\n                      if (permission === 'denied') {\n                        alert(\n                          t`Push notifications are blocked. Please enable them in your browser settings.`,\n                        );\n                      }\n                    }\n                  } else {\n                    setAllowNotifications(false);\n                  }\n                }}\n              />{' '}\n              <Trans>\n                Allow from{' '}\n                <select\n                  name=\"policy\"\n                  disabled={isLoading || needRelogin || !allowNotifications}\n                >\n                  {[\n                    {\n                      value: 'all',\n                      label: t`anyone`,\n                    },\n                    {\n                      value: 'followed',\n                      label: t`people I follow`,\n                    },\n                    {\n                      value: 'follower',\n                      label: t`followers`,\n                    },\n                  ].map((type) => (\n                    <option value={type.value}>{type.label}</option>\n                  ))}\n                </select>\n              </Trans>\n            </label>\n            <div\n              class=\"shazam-container no-animation\"\n              style={{\n                width: '100%',\n              }}\n              hidden={!allowNotifications}\n            >\n              <div class=\"shazam-container-inner\">\n                <div class=\"sub-section\">\n                  <ul>\n                    {[\n                      {\n                        value: 'mention',\n                        label: t`Mentions`,\n                      },\n                      {\n                        value: 'favourite',\n                        label: t`Likes`,\n                      },\n                      {\n                        value: 'reblog',\n                        label: t`Boosts`,\n                      },\n                      {\n                        value: 'follow',\n                        label: t`Follows`,\n                      },\n                      {\n                        value: 'followRequest',\n                        label: t`Follow requests`,\n                      },\n                      {\n                        value: 'poll',\n                        label: t`Polls`,\n                      },\n                      {\n                        value: 'update',\n                        label: t`Post edits`,\n                      },\n                      {\n                        value: 'status',\n                        label: t`New posts`,\n                      },\n                    ].map((alert) => (\n                      <li>\n                        <label>\n                          <input type=\"checkbox\" name={alert.value} />{' '}\n                          {alert.label}\n                        </label>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              </div>\n            </div>\n            {needRelogin && (\n              <div class=\"sub-section\">\n                <p>\n                  <Trans>\n                    Push permission was not granted since your last login.\n                    You'll need to{' '}\n                    <Link to={`/login?instance=${instance}`} onClick={onClose}>\n                      <b>log in</b> again to grant push permission\n                    </Link>\n                    .\n                  </Trans>\n                </p>\n              </div>\n            )}\n          </li>\n        </ul>\n      </section>\n      <p class=\"section-postnote\">\n        <small>\n          <Trans>\n            NOTE: Push notifications only work for <b>one account</b>.\n          </Trans>\n        </small>\n      </p>\n    </form>\n  );\n}\n\nexport default Settings;\n","const focusDeck = () => {\n  let timer = setTimeout(() => {\n    const columns = document.getElementById('columns');\n    if (columns) {\n      // Focus focused column\n      const focusedColumn = columns.querySelector('.deck-container.focus');\n      if (focusedColumn) {\n        focusedColumn.focus();\n      } else {\n        // Focus first column within viewport\n        const firstVisibleColumn = Array.from(\n          columns.querySelectorAll('.deck-container'),\n        ).find((column) => {\n          const columnRect = column.getBoundingClientRect();\n          return columnRect.left >= 0;\n        });\n        if (firstVisibleColumn) {\n          firstVisibleColumn.focus();\n        } else {\n          // Focus first column\n          columns.querySelector('.deck-container')?.focus?.();\n        }\n      }\n    } else {\n      const modals = document.querySelectorAll('#modal-container > *');\n      if (modals?.length) {\n        // Focus last modal\n        const modal = modals[modals.length - 1]; // last one\n        const modalFocusElement =\n          modal.querySelector('[tabindex=\"-1\"]') || modal;\n        if (modalFocusElement) {\n          modalFocusElement.focus();\n          return;\n        }\n      }\n      const backDrop = document.querySelector('.deck-backdrop');\n      if (backDrop) return;\n      // Focus last deck\n      const pages = document.querySelectorAll('.deck-container');\n      const page = pages[pages.length - 1]; // last one\n      if (page && page.tabIndex === -1) {\n        console.log('FOCUS', page);\n        page.focus();\n      }\n    }\n  }, 100);\n  return () => clearTimeout(timer);\n};\n\nexport default focusDeck;\n","import { useEffect, useRef } from 'preact/hooks';\nimport { useLocation } from 'react-router-dom';\n\n// Hook that runs a callback when the location changes\n// Won't run on the first render\n\nexport default function useLocationChange(fn) {\n  if (!fn) return;\n  const location = useLocation();\n  const currentLocationRef = useRef(location.pathname);\n  useEffect(() => {\n    // console.log('location', {\n    //   current: currentLocationRef.current,\n    //   next: location.pathname,\n    // });\n    if (\n      currentLocationRef.current &&\n      location.pathname !== currentLocationRef.current\n    ) {\n      fn?.();\n    }\n  }, [location.pathname, fn]);\n}\n","import { Trans } from '@lingui/react/macro';\nimport punycode from 'punycode/';\n\nfunction AccountHandleInfo({ acct, instance }) {\n  // acct = username or username@server\n  let [username, server] = acct.split('@');\n  if (!server) server = instance;\n  const encodedAcct = punycode.toASCII(acct);\n  return (\n    <div class=\"handle-info\">\n      <span class=\"handle-handle\" title={encodedAcct}>\n        <b class=\"handle-username\">{username}</b>\n        <span class=\"handle-at\">@</span>\n        <b class=\"handle-server\">{server}</b>\n      </span>\n      <div class=\"handle-legend\">\n        <span class=\"ib\">\n          <span class=\"handle-legend-icon username\" /> <Trans>username</Trans>\n        </span>{' '}\n        <span class=\"ib\">\n          <span class=\"handle-legend-icon server\" />{' '}\n          <Trans>server domain name</Trans>\n        </span>\n      </div>\n    </div>\n  );\n}\n\nexport default AccountHandleInfo;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nconst SUPPORTED_IMAGE_FORMATS = [\n  'image/jpeg',\n  'image/png',\n  'image/gif',\n  'image/webp',\n];\nconst SUPPORTED_IMAGE_FORMATS_STR = SUPPORTED_IMAGE_FORMATS.join(',');\n\nfunction FieldsAttributesRow({ name, value, disabled, index: i }) {\n  const [hasValue, setHasValue] = useState(!!value);\n  return (\n    <tr>\n      <td>\n        <input\n          type=\"text\"\n          name={`fields_attributes[${i}][name]`}\n          defaultValue={name}\n          disabled={disabled}\n          maxLength={255}\n          required={hasValue}\n          dir=\"auto\"\n          enterKeyHint=\"done\"\n        />\n      </td>\n      <td>\n        <input\n          type=\"text\"\n          name={`fields_attributes[${i}][value]`}\n          defaultValue={value}\n          disabled={disabled}\n          maxLength={255}\n          onChange={(e) => setHasValue(!!e.currentTarget.value)}\n          dir=\"auto\"\n          enterKeyHint=\"done\"\n        />\n      </td>\n    </tr>\n  );\n}\n\nfunction EditProfileSheet({ onClose = () => {} }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('loading');\n  const [account, setAccount] = useState(null);\n  const [headerPreview, setHeaderPreview] = useState(null);\n  const [avatarPreview, setAvatarPreview] = useState(null);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const acc = await masto.v1.accounts.verifyCredentials();\n        setAccount(acc);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  console.log('EditProfileSheet', account);\n  const { displayName, source, avatar, header } = account || {};\n  const { note, fields } = source || {};\n  const fieldsAttributesRef = useRef(null);\n\n  const avatarMediaAttachments = [\n    ...(avatar ? [{ type: 'image', url: avatar }] : []),\n    ...(avatarPreview ? [{ type: 'image', url: avatarPreview }] : []),\n  ];\n  const headerMediaAttachments = [\n    ...(header ? [{ type: 'image', url: header }] : []),\n    ...(headerPreview ? [{ type: 'image', url: headerPreview }] : []),\n  ];\n\n  return (\n    <div class=\"sheet\" id=\"edit-profile-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <b>\n          <Trans>Edit profile</Trans>\n        </b>\n      </header>\n      <main>\n        {uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : (\n          <form\n            onSubmit={(e) => {\n              e.preventDefault();\n              const formData = new FormData(e.target);\n              const header = formData.get('header');\n              const avatar = formData.get('avatar');\n              const displayName = formData.get('display_name');\n              const note = formData.get('note');\n              const fieldsAttributesFields =\n                fieldsAttributesRef.current.querySelectorAll(\n                  'input[name^=\"fields_attributes\"]',\n                );\n              const fieldsAttributes = [];\n              fieldsAttributesFields.forEach((field) => {\n                const name = field.name;\n                const [_, index, key] =\n                  name.match(/fields_attributes\\[(\\d+)\\]\\[(.+)\\]/) || [];\n                const value = field.value ? field.value.trim() : '';\n                if (index && key && value) {\n                  if (!fieldsAttributes[index]) fieldsAttributes[index] = {};\n                  fieldsAttributes[index][key] = value;\n                }\n              });\n              // Fill in the blanks\n              fieldsAttributes.forEach((field) => {\n                if (field.name && !field.value) {\n                  field.value = '';\n                }\n              });\n\n              (async () => {\n                try {\n                  const newAccount = await masto.v1.accounts.updateCredentials({\n                    header,\n                    avatar,\n                    displayName,\n                    note,\n                    fieldsAttributes,\n                  });\n                  console.log('updated account', newAccount);\n                  onClose?.({\n                    state: 'success',\n                    account: newAccount,\n                  });\n                } catch (e) {\n                  console.error(e);\n                  alert(e?.message || t`Unable to update profile.`);\n                }\n              })();\n            }}\n          >\n            <div class=\"edit-profile-media-container\">\n              <label>\n                <Trans>Header picture</Trans>{' '}\n                <input\n                  type=\"file\"\n                  name=\"header\"\n                  accept={SUPPORTED_IMAGE_FORMATS_STR}\n                  onChange={(e) => {\n                    const file = e.target.files[0];\n                    if (file) {\n                      const blob = URL.createObjectURL(file);\n                      setHeaderPreview(blob);\n                    }\n                  }}\n                />\n              </label>\n              <div class=\"edit-profile-media-field\">\n                {header ? (\n                  <div\n                    class=\"edit-media\"\n                    tabIndex=\"0\"\n                    onClick={() => {\n                      states.showMediaModal = {\n                        mediaAttachments: headerMediaAttachments,\n                        mediaIndex: 0,\n                      };\n                    }}\n                  >\n                    <img src={header} alt=\"\" />\n                  </div>\n                ) : (\n                  <div class=\"edit-media\"></div>\n                )}\n                {headerPreview && (\n                  <>\n                    <Icon icon=\"arrow-right\" />\n                    <div\n                      class=\"edit-media\"\n                      tabIndex=\"0\"\n                      onClick={() => {\n                        states.showMediaModal = {\n                          mediaAttachments: headerMediaAttachments,\n                          mediaIndex: 1,\n                        };\n                      }}\n                    >\n                      <img src={headerPreview} alt=\"\" />\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n            <div class=\"edit-profile-media-container\">\n              <label>\n                <Trans>Profile picture</Trans>{' '}\n                <input\n                  type=\"file\"\n                  name=\"avatar\"\n                  accept={SUPPORTED_IMAGE_FORMATS_STR}\n                  onChange={(e) => {\n                    const file = e.target.files[0];\n                    if (file) {\n                      const blob = URL.createObjectURL(file);\n                      setAvatarPreview(blob);\n                    }\n                  }}\n                />\n              </label>\n              <div class=\"edit-profile-media-field\">\n                {avatar ? (\n                  <div\n                    class=\"edit-media\"\n                    tabIndex=\"0\"\n                    onClick={() => {\n                      states.showMediaModal = {\n                        mediaAttachments: avatarMediaAttachments,\n                        mediaIndex: 0,\n                      };\n                    }}\n                  >\n                    <img src={avatar} alt=\"\" />\n                  </div>\n                ) : (\n                  <div class=\"edit-media\"></div>\n                )}\n                {avatarPreview && (\n                  <>\n                    <Icon icon=\"arrow-right\" />\n                    <div\n                      class=\"edit-media\"\n                      tabIndex=\"0\"\n                      onClick={() => {\n                        states.showMediaModal = {\n                          mediaAttachments: avatarMediaAttachments,\n                          mediaIndex: 1,\n                        };\n                      }}\n                    >\n                      <img src={avatarPreview} alt=\"\" />\n                    </div>\n                  </>\n                )}\n              </div>\n            </div>\n            <p>\n              <label>\n                <Trans>Name</Trans>{' '}\n                <input\n                  type=\"text\"\n                  name=\"display_name\"\n                  defaultValue={displayName}\n                  maxLength={30}\n                  disabled={uiState === 'loading'}\n                  dir=\"auto\"\n                  enterKeyHint=\"done\"\n                />\n              </label>\n            </p>\n            <p>\n              <label>\n                <Trans>Bio</Trans>\n                <textarea\n                  defaultValue={note}\n                  name=\"note\"\n                  maxLength={500}\n                  rows=\"5\"\n                  disabled={uiState === 'loading'}\n                  dir=\"auto\"\n                />\n              </label>\n            </p>\n            {/* Table for fields; name and values are in fields, min 4 rows */}\n            <p>\n              <Trans>Extra fields</Trans>\n            </p>\n            <table ref={fieldsAttributesRef}>\n              <thead>\n                <tr>\n                  <th>\n                    <Trans>Label</Trans>\n                  </th>\n                  <th>\n                    <Trans>Content</Trans>\n                  </th>\n                </tr>\n              </thead>\n              <tbody>\n                {Array.from({ length: Math.max(4, fields.length) }).map(\n                  (_, i) => {\n                    const { name = '', value = '' } = fields[i] || {};\n                    return (\n                      <FieldsAttributesRow\n                        key={i}\n                        name={name}\n                        value={value}\n                        index={i}\n                        disabled={uiState === 'loading'}\n                      />\n                    );\n                  },\n                )}\n              </tbody>\n            </table>\n            <footer>\n              <button\n                type=\"button\"\n                class=\"light\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  onClose?.();\n                }}\n              >\n                <Trans>Cancel</Trans>\n              </button>\n              <button type=\"submit\" disabled={uiState === 'loading'}>\n                <Trans>Save</Trans>\n              </button>\n            </footer>\n          </form>\n        )}\n      </main>\n    </div>\n  );\n}\n\nexport default EditProfileSheet;\n","import { Trans } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport { fetchRelationships } from '../utils/relationships';\nimport supports from '../utils/supports';\n\nimport AccountBlock from './account-block';\nimport Loader from './loader';\n\nconst ENDORSEMENTS_LIMIT = 80;\n\nfunction Endorsements({\n  accountID: id,\n  info,\n  open = false,\n  onlyOpenIfHasEndorsements = false,\n}) {\n  const { masto } = api();\n  const endorsementsContainer = useRef();\n  const [endorsementsUIState, setEndorsementsUIState] = useState('default');\n  const [endorsements, setEndorsements] = useState([]);\n  const [relationshipsMap, setRelationshipsMap] = useState({});\n  useEffect(() => {\n    if (!supports('@mastodon/endorsements')) return;\n    if (!open) return;\n    (async () => {\n      setEndorsementsUIState('loading');\n      try {\n        const accounts = await masto.v1.accounts.$select(id).endorsements.list({\n          limit: ENDORSEMENTS_LIMIT,\n        });\n        console.log({ endorsements: accounts });\n        if (!accounts.length) {\n          setEndorsementsUIState('default');\n          return;\n        }\n        setEndorsements(accounts);\n        setEndorsementsUIState('default');\n        setTimeout(() => {\n          endorsementsContainer.current.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n          });\n        }, 300);\n\n        const relationships = await fetchRelationships(\n          accounts,\n          relationshipsMap,\n        );\n        if (relationships) {\n          setRelationshipsMap(relationships);\n        }\n      } catch (e) {\n        console.error(e);\n        setEndorsementsUIState('error');\n      }\n    })();\n  }, [open, id]);\n\n  const reallyOpen = onlyOpenIfHasEndorsements\n    ? open && endorsements.length > 0\n    : open;\n\n  if (!reallyOpen) return null;\n\n  return (\n    <div class=\"shazam-container\">\n      <div class=\"shazam-container-inner\">\n        <div class=\"endorsements-container\" ref={endorsementsContainer}>\n          <h3>\n            <Trans>Profiles featured by @{info.username}</Trans>\n          </h3>\n          {endorsementsUIState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader abrupt />\n            </p>\n          ) : endorsements.length > 0 ? (\n            <ul\n              class={`endorsements ${\n                endorsements.length > 10 ? 'expanded' : ''\n              }`}\n            >\n              {endorsements.map((account) => (\n                <li>\n                  <AccountBlock\n                    key={account.id}\n                    account={account}\n                    showStats\n                    avatarSize=\"xxl\"\n                    relationship={relationshipsMap[account.id]}\n                  />\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <p class=\"ui-state insignificant\">\n              <Trans>No featured profiles.</Trans>\n            </p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default Endorsements;\n","import { api } from './api';\nimport pmem from './pmem';\n\nasync function _isSearchEnabled(instance) {\n  const { masto } = api({ instance });\n  const results = await masto.v2.search.list({\n    q: 'from:me',\n    type: 'statuses',\n    limit: 1,\n  });\n  return !!results?.statuses?.length;\n}\n\nexport default pmem(_isSearchEnabled);\n","import { api } from './api';\nimport pmem from './pmem';\nimport store from './store';\n\nconst FETCH_MAX_AGE = 1000 * 60; // 1 minute\nconst MAX_AGE = 24 * 60 * 60 * 1000; // 1 day\n\nexport const fetchLists = pmem(\n  async () => {\n    const { masto } = api();\n    const lists = await masto.v1.lists.list();\n    lists.sort((a, b) => a.title.localeCompare(b.title));\n\n    if (lists.length) {\n      setTimeout(() => {\n        // Save to local storage, with saved timestamp\n        store.account.set('lists', {\n          lists,\n          updatedAt: Date.now(),\n        });\n      }, 1);\n    }\n\n    return lists;\n  },\n  {\n    expires: FETCH_MAX_AGE,\n  },\n);\n\nexport async function getLists() {\n  try {\n    const { lists, updatedAt } = store.account.get('lists') || {};\n    if (!lists?.length) return await fetchLists();\n    if (Date.now() - updatedAt > MAX_AGE) {\n      // Stale-while-revalidate\n      fetchLists();\n      return lists;\n    }\n    return lists;\n  } catch (e) {\n    return [];\n  }\n}\n\nexport const fetchList = pmem(\n  (id) => {\n    const { masto } = api();\n    return masto.v1.lists.$select(id).fetch();\n  },\n  {\n    expires: FETCH_MAX_AGE,\n  },\n);\n\nexport async function getList(id) {\n  const { lists } = store.account.get('lists') || {};\n  console.log({ lists });\n  if (lists?.length) {\n    const theList = lists.find((l) => l.id === id);\n    if (theList) return theList;\n  }\n  try {\n    return fetchList(id);\n  } catch (e) {\n    return null;\n  }\n}\n\nexport async function getListTitle(id) {\n  const list = await getList(id);\n  return list?.title || '';\n}\n\nexport function addListStore(list) {\n  const { lists } = store.account.get('lists') || {};\n  if (lists?.length) {\n    lists.push(list);\n    lists.sort((a, b) => a.title.localeCompare(b.title));\n    store.account.set('lists', {\n      lists,\n      updatedAt: Date.now(),\n    });\n  }\n}\n\nexport function updateListStore(list) {\n  const { lists } = store.account.get('lists') || {};\n  if (lists?.length) {\n    const index = lists.findIndex((l) => l.id === list.id);\n    if (index !== -1) {\n      lists[index] = list;\n      lists.sort((a, b) => a.title.localeCompare(b.title));\n      store.account.set('lists', {\n        lists,\n        updatedAt: Date.now(),\n      });\n    }\n  }\n}\n\nexport function deleteListStore(listID) {\n  const { lists } = store.account.get('lists') || {};\n  if (lists?.length) {\n    const index = lists.findIndex((l) => l.id === listID);\n    if (index !== -1) {\n      lists.splice(index, 1);\n      store.account.set('lists', {\n        lists,\n        updatedAt: Date.now(),\n      });\n    }\n  }\n}\n","import './list-exclusive-badge.css';\n\nimport { useLingui } from '@lingui/react/macro';\n\nimport Icon from './icon';\n\nfunction ListExclusiveBadge({ insignificant }) {\n  const { t } = useLingui();\n  return (\n    <Icon\n      icon=\"filter\"\n      size=\"xs\"\n      class={`list-exclusive-badge ${insignificant ? 'insignificant' : ''}`}\n      title={t`Posts on this list are hidden from Home/Following`}\n    />\n  );\n}\n\nexport default ListExclusiveBadge;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport { addListStore, deleteListStore, updateListStore } from '../utils/lists';\nimport supports from '../utils/supports';\n\nimport Icon from './icon';\nimport ListExclusiveBadge from './list-exclusive-badge';\nimport MenuConfirm from './menu-confirm';\n\nfunction ListAddEdit({ list, onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const editMode = !!list;\n  const nameFieldRef = useRef();\n  const repliesPolicyFieldRef = useRef();\n  const exclusiveFieldRef = useRef();\n  useEffect(() => {\n    if (editMode) {\n      nameFieldRef.current.value = list.title;\n      repliesPolicyFieldRef.current.value = list.repliesPolicy;\n      if (exclusiveFieldRef.current) {\n        exclusiveFieldRef.current.checked = list.exclusive;\n      }\n    }\n  }, [editMode]);\n  const supportsExclusive =\n    supports('@mastodon/list-exclusive') ||\n    supports('@gotosocial/list-exclusive');\n\n  return (\n    <div class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}{' '}\n      <header>\n        <h2>{editMode ? t`Edit list` : t`New list`}</h2>\n      </header>\n      <main>\n        <form\n          class=\"list-form\"\n          onSubmit={(e) => {\n            e.preventDefault(); // Get form values\n\n            const formData = new FormData(e.target);\n            const title = formData.get('title');\n            const repliesPolicy = formData.get('replies_policy');\n            const exclusive = formData.get('exclusive') === 'on';\n            console.log({\n              title,\n              repliesPolicy,\n              exclusive,\n            });\n            setUIState('loading');\n\n            (async () => {\n              try {\n                let listResult;\n\n                if (editMode) {\n                  listResult = await masto.v1.lists.$select(list.id).update({\n                    title,\n                    replies_policy: repliesPolicy,\n                    exclusive,\n                  });\n                } else {\n                  listResult = await masto.v1.lists.create({\n                    title,\n                    replies_policy: repliesPolicy,\n                    exclusive,\n                  });\n                }\n\n                console.log(listResult);\n                setUIState('default');\n                onClose?.({\n                  state: 'success',\n                  list: listResult,\n                });\n\n                setTimeout(() => {\n                  if (editMode) {\n                    updateListStore(listResult);\n                  } else {\n                    addListStore(listResult);\n                  }\n                }, 1);\n              } catch (e) {\n                console.error(e);\n                setUIState('error');\n                alert(\n                  editMode\n                    ? t`Unable to edit list.`\n                    : t`Unable to create list.`,\n                );\n              }\n            })();\n          }}\n        >\n          <div class=\"list-form-row\">\n            <label for=\"list-title\">\n              <Trans>Name</Trans>{' '}\n              <input\n                ref={nameFieldRef}\n                type=\"text\"\n                id=\"list-title\"\n                name=\"title\"\n                required\n                disabled={uiState === 'loading'}\n                dir=\"auto\"\n              />\n            </label>\n          </div>\n          <div class=\"list-form-row\">\n            <select\n              ref={repliesPolicyFieldRef}\n              name=\"replies_policy\"\n              required\n              disabled={uiState === 'loading'}\n            >\n              <option value=\"list\">\n                <Trans>Show replies to list members</Trans>\n              </option>\n              <option value=\"followed\">\n                <Trans>Show replies to people I follow</Trans>\n              </option>\n              <option value=\"none\">\n                <Trans>Don't show replies</Trans>\n              </option>\n            </select>\n          </div>\n          {supportsExclusive && (\n            <div class=\"list-form-row\">\n              <label class=\"label-block\">\n                <input\n                  ref={exclusiveFieldRef}\n                  type=\"checkbox\"\n                  name=\"exclusive\"\n                  disabled={uiState === 'loading'}\n                />{' '}\n                <ListExclusiveBadge insignificant />{' '}\n                <Trans>Hide posts on this list from Home/Following</Trans>\n              </label>\n            </div>\n          )}\n          <div class=\"list-form-footer\">\n            <button type=\"submit\" disabled={uiState === 'loading'}>\n              {editMode ? t`Save` : t`Create`}\n            </button>\n            {editMode && (\n              <MenuConfirm\n                disabled={uiState === 'loading'}\n                align=\"end\"\n                menuItemClassName=\"danger\"\n                confirmLabel={t`Delete this list?`}\n                onClick={() => {\n                  // const yes = confirm('Delete this list?');\n                  // if (!yes) return;\n                  setUIState('loading');\n\n                  (async () => {\n                    try {\n                      await masto.v1.lists.$select(list.id).remove();\n                      setUIState('default');\n                      onClose?.({\n                        state: 'deleted',\n                      });\n                      setTimeout(() => {\n                        deleteListStore(list.id);\n                      }, 1);\n                    } catch (e) {\n                      console.error(e);\n                      setUIState('error');\n                      alert(t`Unable to delete list.`);\n                    }\n                  })();\n                }}\n              >\n                <button\n                  type=\"button\"\n                  class=\"light danger\"\n                  disabled={uiState === 'loading'}\n                >\n                  <Trans>Delete</Trans>\n                </button>\n              </MenuConfirm>\n            )}\n          </div>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nexport default ListAddEdit;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useReducer, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport { getLists } from '../utils/lists';\n\nimport Icon from './icon';\nimport ListAddEdit from './list-add-edit';\nimport Loader from './loader';\nimport Modal from './modal';\n\nfunction AddRemoveListsSheet({ accountID, onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [lists, setLists] = useState([]);\n  const [listsContainingAccount, setListsContainingAccount] = useState([]);\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const lists = await getLists();\n        setLists(lists);\n        const listsContainingAccount = await masto.v1.accounts\n          .$select(accountID)\n          .lists.list();\n        console.log({ lists, listsContainingAccount });\n        setListsContainingAccount(listsContainingAccount);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  const [showListAddEditModal, setShowListAddEditModal] = useState(false);\n\n  return (\n    <div class=\"sheet\" id=\"list-add-remove-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Add/Remove from Lists</Trans>\n        </h2>\n      </header>\n      <main>\n        {lists.length > 0 ? (\n          <ul class=\"list-add-remove\">\n            {lists.map((list) => {\n              const inList = listsContainingAccount.some(\n                (l) => l.id === list.id,\n              );\n              return (\n                <li>\n                  <button\n                    type=\"button\"\n                    class={`light ${inList ? 'checked' : ''}`}\n                    disabled={uiState === 'loading'}\n                    onClick={() => {\n                      setUIState('loading');\n                      (async () => {\n                        try {\n                          if (inList) {\n                            await masto.v1.lists\n                              .$select(list.id)\n                              .accounts.remove({\n                                accountIds: [accountID],\n                              });\n                          } else {\n                            await masto.v1.lists\n                              .$select(list.id)\n                              .accounts.create({\n                                accountIds: [accountID],\n                              });\n                          }\n                          // setUIState('default');\n                          reload();\n                        } catch (e) {\n                          console.error(e);\n                          setUIState('error');\n                          alert(\n                            inList\n                              ? t`Unable to remove from list.`\n                              : t`Unable to add to list.`,\n                          );\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"check-circle\" alt=\"\" />\n                    <span>{list.title}</span>\n                  </button>\n                </li>\n              );\n            })}\n          </ul>\n        ) : uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : uiState === 'error' ? (\n          <p class=\"ui-state\">\n            <Trans>Unable to load lists.</Trans>\n          </p>\n        ) : (\n          <p class=\"ui-state\">\n            <Trans>No lists.</Trans>\n          </p>\n        )}\n        <button\n          type=\"button\"\n          class=\"plain2\"\n          onClick={() => setShowListAddEditModal(true)}\n          disabled={uiState !== 'default'}\n        >\n          <Icon icon=\"plus\" size=\"l\" />{' '}\n          <span>\n            <Trans>New list</Trans>\n          </span>\n        </button>\n      </main>\n      {showListAddEditModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowListAddEditModal(false);\n            }\n          }}\n        >\n          <ListAddEdit\n            list={showListAddEditModal?.list}\n            onClose={(result) => {\n              if (result.state === 'success') {\n                reload();\n              }\n              setShowListAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nexport default AddRemoveListsSheet;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nfunction PrivateNoteSheet({\n  account,\n  note: initialNote,\n  onRelationshipChange = () => {},\n  onClose = () => {},\n}) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const textareaRef = useRef(null);\n\n  useEffect(() => {\n    let timer;\n    if (textareaRef.current && !initialNote) {\n      timer = setTimeout(() => {\n        textareaRef.current.focus?.();\n      }, 100);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, []);\n\n  return (\n    <div class=\"sheet\" id=\"private-note-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <b>\n          <Trans>Notes</Trans>\n        </b>{' '}\n        <small class=\"insignificant\">\n          <Trans>Only visible to you</Trans>\n        </small>\n      </header>\n      <main>\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            const formData = new FormData(e.target);\n            const note = formData.get('note');\n            if (note?.trim() !== initialNote?.trim()) {\n              setUIState('loading');\n              (async () => {\n                try {\n                  const newRelationship = await masto.v1.accounts\n                    .$select(account?.id)\n                    .note.create({\n                      comment: note,\n                    });\n                  console.log('updated relationship', newRelationship);\n                  setUIState('default');\n                  onRelationshipChange(newRelationship);\n                  onClose();\n                } catch (e) {\n                  console.error(e);\n                  setUIState('error');\n                  alert(e?.message || t`Unable to update private note.`);\n                }\n              })();\n            }\n          }}\n        >\n          <textarea\n            ref={textareaRef}\n            name=\"note\"\n            disabled={uiState === 'loading'}\n            dir=\"auto\"\n          >\n            {initialNote}\n          </textarea>\n          <footer>\n            <button\n              type=\"button\"\n              class=\"light\"\n              disabled={uiState === 'loading'}\n              onClick={() => {\n                onClose?.();\n              }}\n            >\n              <Trans>Cancel</Trans>\n            </button>\n            <span>\n              <Loader abrupt hidden={uiState !== 'loading'} />\n              <button disabled={uiState === 'loading'} type=\"submit\">\n                <Trans>Save &amp; close</Trans>\n              </button>\n            </span>\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nexport default PrivateNoteSheet;\n","import { Trans, useLingui } from '@lingui/react/macro';\n\nimport getHTMLText from '../utils/getHTMLText';\n\nimport Icon from './icon';\nimport TranslationBlock from './translation-block';\n\nfunction TranslatedBioSheet({ note, fields, onClose }) {\n  const { t } = useLingui();\n  const fieldsText =\n    fields\n      ?.map(({ name, value }) => `${name}\\n${getHTMLText(value)}`)\n      .join('\\n\\n') || '';\n\n  const text = getHTMLText(note) + (fieldsText ? `\\n\\n${fieldsText}` : '');\n\n  return (\n    <div class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Translated Bio</Trans>\n        </h2>\n      </header>\n      <main>\n        <p\n          style={{\n            whiteSpace: 'pre-wrap',\n          }}\n        >\n          {text}\n        </p>\n        <TranslationBlock forceTranslate text={text} />\n      </main>\n    </div>\n  );\n}\n\nexport default TranslatedBioSheet;\n","import { msg } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport punycode from 'punycode/';\n\nimport { api } from '../utils/api';\nimport i18nDuration from '../utils/i18n-duration';\nimport isSearchEnabled from '../utils/is-search-enabled';\nimport niceDateTime from '../utils/nice-date-time';\nimport showCompose from '../utils/show-compose';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport { getCurrentAccountID, updateAccount } from '../utils/store-utils';\nimport supports from '../utils/supports';\n\nimport { handleScannerClick } from './account-info';\nimport AddRemoveListsSheet from './add-remove-lists-sheet';\nimport Icon from './icon';\nimport Loader from './loader';\nimport MenuConfirm from './menu-confirm';\nimport Menu2 from './menu2';\nimport Modal from './modal';\nimport PrivateNoteSheet from './private-note-sheet';\nimport SubMenu2 from './submenu2';\nimport TranslatedBioSheet from './translated-bio-sheet';\n\nconst MUTE_DURATIONS = [\n  60 * 5, // 5 minutes\n  60 * 30, // 30 minutes\n  60 * 60, // 1 hour\n  60 * 60 * 6, // 6 hours\n  60 * 60 * 24, // 1 day\n  60 * 60 * 24 * 3, // 3 days\n  60 * 60 * 24 * 7, // 1 week\n  60 * 60 * 24 * 30, // 30 days\n  0, // forever\n];\nconst MUTE_DURATIONS_LABELS = {\n  0: msg`Forever`,\n  300: i18nDuration(5, 'minute'),\n  1_800: i18nDuration(30, 'minute'),\n  3_600: i18nDuration(1, 'hour'),\n  21_600: i18nDuration(6, 'hour'),\n  86_400: i18nDuration(1, 'day'),\n  259_200: i18nDuration(3, 'day'),\n  604_800: i18nDuration(1, 'week'),\n  2592_000: i18nDuration(30, 'day'),\n};\n\nfunction RelatedActions({\n  info,\n  instance,\n  standalone,\n  authenticated,\n  onRelationshipChange = () => {},\n  setShowEditProfile = () => {},\n  showEndorsements = false,\n  renderEndorsements = false,\n  setRenderEndorsements = () => {},\n}) {\n  if (!info) return null;\n  const { _, t } = useLingui();\n  const {\n    masto: currentMasto,\n    instance: currentInstance,\n    authenticated: currentAuthenticated,\n  } = api();\n  const sameInstance = instance === currentInstance;\n\n  const [relationshipUIState, setRelationshipUIState] = useState('default');\n  const [relationship, setRelationship] = useState(null);\n\n  const { id, acct, url, username, locked, lastStatusAt, note, fields, moved } =\n    info;\n  const accountID = useRef(id);\n\n  const {\n    following,\n    showingReblogs,\n    notifying,\n    followedBy,\n    blocking,\n    blockedBy,\n    muting,\n    mutingNotifications,\n    requested,\n    domainBlocking,\n    endorsed,\n    note: privateNote,\n  } = relationship || {};\n\n  const [currentInfo, setCurrentInfo] = useState(null);\n  const [isSelf, setIsSelf] = useState(false);\n\n  const acctWithInstance = acct.includes('@') ? acct : `${acct}@${instance}`;\n\n  const supportsEndorsements = supports('@mastodon/endorsements');\n\n  useEffect(() => {\n    if (info) {\n      const currentAccount = getCurrentAccountID();\n      let currentID;\n      (async () => {\n        if (sameInstance && authenticated) {\n          currentID = id;\n        } else if (!sameInstance && currentAuthenticated) {\n          // Grab this account from my logged-in instance\n          const acctHasInstance = info.acct.includes('@');\n          try {\n            const results = await currentMasto.v2.search.list({\n              q: acctHasInstance ? info.acct : `${info.username}@${instance}`,\n              type: 'accounts',\n              limit: 1,\n              resolve: true,\n            });\n            console.log(' Fetched account from logged-in instance', results);\n            if (results.accounts.length) {\n              currentID = results.accounts[0].id;\n              setCurrentInfo(results.accounts[0]);\n            }\n          } catch (e) {\n            console.error(e);\n          }\n        }\n\n        if (!currentID) return;\n\n        if (currentAccount === currentID) {\n          // It's myself!\n          setIsSelf(true);\n          return;\n        }\n\n        accountID.current = currentID;\n\n        // if (moved) return;\n\n        setRelationshipUIState('loading');\n\n        const fetchRelationships = currentMasto.v1.accounts.relationships.fetch(\n          {\n            id: [currentID],\n          },\n        );\n\n        try {\n          const relationships = await fetchRelationships;\n          console.log('fetched relationship', relationships);\n          setRelationshipUIState('default');\n\n          if (relationships.length) {\n            const relationship = relationships[0];\n            setRelationship(relationship);\n            onRelationshipChange({ relationship, currentID });\n          }\n        } catch (e) {\n          console.error(e);\n          setRelationshipUIState('error');\n        }\n      })();\n    }\n  }, [info, authenticated]);\n\n  useEffect(() => {\n    if (info && isSelf) {\n      updateAccount(info);\n    }\n  }, [info, isSelf]);\n\n  const loading = relationshipUIState === 'loading';\n\n  const [showTranslatedBio, setShowTranslatedBio] = useState(false);\n  const [showAddRemoveLists, setShowAddRemoveLists] = useState(false);\n  const [showPrivateNoteModal, setShowPrivateNoteModal] = useState(false);\n  const [lists, setLists] = useState([]);\n  const [searchEnabled, setSearchEnabled] = useState(false);\n\n  useEffect(() => {\n    if (!currentAuthenticated) return;\n    (async () => {\n      const enabled = await isSearchEnabled(currentInstance);\n      setSearchEnabled(enabled);\n    })();\n  }, [currentInstance, currentAuthenticated]);\n\n  let { headerStatic, avatarStatic } = info;\n  if (!headerStatic || /missing\\.png$/.test(headerStatic)) {\n    if (avatarStatic && !/missing\\.png$/.test(avatarStatic)) {\n      headerStatic = avatarStatic;\n    }\n  }\n\n  return (\n    <>\n      <div class=\"actions\">\n        <span>\n          {followedBy ? (\n            <span class=\"tag\">\n              <Trans>Follows you</Trans>\n            </span>\n          ) : !!lastStatusAt ? (\n            <small class=\"insignificant\">\n              <Trans>\n                Last post:{' '}\n                <span class=\"ib\">\n                  {niceDateTime(lastStatusAt, {\n                    hideTime: true,\n                  })}\n                </span>\n              </Trans>\n            </small>\n          ) : (\n            <span />\n          )}\n          {muting && (\n            <span class=\"tag danger\">\n              <Trans>Muted</Trans>\n            </span>\n          )}\n          {blocking && (\n            <span class=\"tag danger\">\n              <Trans>Blocked</Trans>\n            </span>\n          )}\n        </span>{' '}\n        <span class=\"buttons\">\n          {!!privateNote && (\n            <button\n              type=\"button\"\n              class=\"private-note-tag\"\n              title={t`Notes`}\n              onClick={() => {\n                setShowPrivateNoteModal(true);\n              }}\n              dir=\"auto\"\n            >\n              <span>{privateNote}</span>\n            </button>\n          )}\n          {currentAuthenticated && isSelf && (\n            <button\n              type=\"button\"\n              class=\"plain\"\n              onClick={() => {\n                states.showQrCodeModal = {\n                  text: url,\n                  arena: avatarStatic,\n                  backgroundMask: headerStatic,\n                  caption: acct.includes('@') ? acct : `${acct}@${instance}`,\n                  onScannerClick: handleScannerClick,\n                };\n              }}\n            >\n              <Icon icon=\"qrcode\" alt={t`QR code`} />\n            </button>\n          )}\n          <Menu2\n            portal={{\n              target: document.body,\n            }}\n            containerProps={{\n              style: {\n                // Higher than the backdrop\n                zIndex: 1001,\n              },\n            }}\n            align=\"center\"\n            position=\"anchor\"\n            overflow=\"auto\"\n            menuButton={\n              <button type=\"button\" class=\"plain4\" disabled={loading}>\n                <Icon icon=\"more2\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n            onMenuChange={(e) => {\n              if (following && e.open) {\n                // Fetch lists that have this account\n                (async () => {\n                  try {\n                    const lists = await currentMasto.v1.accounts\n                      .$select(accountID.current)\n                      .lists.list();\n                    console.log('fetched account lists', lists);\n                    setLists(lists);\n                  } catch (e) {\n                    console.error(e);\n                  }\n                })();\n              }\n            }}\n          >\n            {currentAuthenticated && !isSelf ? (\n              <>\n                <MenuItem\n                  onClick={() => {\n                    showCompose({\n                      draftStatus: {\n                        status: `@${currentInfo?.acct || acct} `,\n                      },\n                    });\n                  }}\n                >\n                  <Icon icon=\"at\" />\n                  <span>\n                    <Trans>\n                      Mention <span class=\"bidi-isolate\">@{username}</span>\n                    </Trans>\n                  </span>\n                </MenuItem>\n                {searchEnabled && (\n                  <MenuItem\n                    onClick={() => {\n                      states.showSearchCommand = { query: `from:${acct} ` };\n                    }}\n                  >\n                    <Icon icon=\"search\" />\n                    <span>\n                      <Trans>\n                        Search <span class=\"bidi-isolate\">@{username}</span>'s\n                        posts\n                      </Trans>\n                    </span>\n                  </MenuItem>\n                )}\n                <MenuItem\n                  onClick={() => {\n                    setShowTranslatedBio(true);\n                  }}\n                >\n                  <Icon icon=\"translate\" />\n                  <span>\n                    <Trans>Translate bio</Trans>\n                  </span>\n                </MenuItem>\n                {supports('@mastodon/profile-private-note') && (\n                  <MenuItem\n                    onClick={() => {\n                      setShowPrivateNoteModal(true);\n                    }}\n                  >\n                    <Icon icon=\"note\" />\n                    <span>{privateNote ? t`Edit notes` : t`Add notes`}</span>\n                  </MenuItem>\n                )}\n                {following && !!relationship && (\n                  <>\n                    <MenuItem\n                      onClick={() => {\n                        setRelationshipUIState('loading');\n                        (async () => {\n                          try {\n                            const rel = await currentMasto.v1.accounts\n                              .$select(accountID.current)\n                              .follow({\n                                notify: !notifying,\n                              });\n                            if (rel) setRelationship(rel);\n                            setRelationshipUIState('default');\n                            showToast(\n                              rel.notifying\n                                ? t`Notifications enabled for @${username}'s posts.`\n                                : t` Notifications disabled for @${username}'s posts.`,\n                            );\n                          } catch (e) {\n                            alert(e);\n                            setRelationshipUIState('error');\n                          }\n                        })();\n                      }}\n                    >\n                      <Icon icon=\"notification\" />\n                      <span>\n                        {notifying\n                          ? t`Disable notifications`\n                          : t`Enable notifications`}\n                      </span>\n                    </MenuItem>\n                    <MenuItem\n                      onClick={() => {\n                        setRelationshipUIState('loading');\n                        (async () => {\n                          try {\n                            const rel = await currentMasto.v1.accounts\n                              .$select(accountID.current)\n                              .follow({\n                                reblogs: !showingReblogs,\n                              });\n                            if (rel) setRelationship(rel);\n                            setRelationshipUIState('default');\n                            showToast(\n                              rel.showingReblogs\n                                ? t`Boosts from @${username} enabled.`\n                                : t`Boosts from @${username} disabled.`,\n                            );\n                          } catch (e) {\n                            alert(e);\n                            setRelationshipUIState('error');\n                          }\n                        })();\n                      }}\n                    >\n                      <Icon icon=\"rocket\" />\n                      <span>\n                        {showingReblogs ? t`Disable boosts` : t`Enable boosts`}\n                      </span>\n                    </MenuItem>\n                  </>\n                )}\n                {supportsEndorsements && following && (\n                  <MenuItem\n                    onClick={() => {\n                      setRelationshipUIState('loading');\n                      (async () => {\n                        try {\n                          if (endorsed) {\n                            const newRelationship =\n                              await currentMasto.v1.accounts\n                                .$select(currentInfo?.id || id)\n                                .unpin();\n                            setRelationship(newRelationship);\n                            setRelationshipUIState('default');\n                            showToast(\n                              t`@${username} is no longer featured on your profile.`,\n                            );\n                          } else {\n                            const newRelationship =\n                              await currentMasto.v1.accounts\n                                .$select(currentInfo?.id || id)\n                                .pin();\n                            setRelationship(newRelationship);\n                            setRelationshipUIState('default');\n                            showToast(\n                              t`@${username} is now featured on your profile.`,\n                            );\n                          }\n                        } catch (e) {\n                          console.error(e);\n                          setRelationshipUIState('error');\n                          if (endorsed) {\n                            showToast(\n                              t`Unable to unfeature @${username} on your profile.`,\n                            );\n                          } else {\n                            showToast(\n                              t`Unable to feature @${username} on your profile.`,\n                            );\n                          }\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"endorsement\" />\n                    {endorsed\n                      ? t`Don't feature on profile`\n                      : t`Feature on profile`}\n                  </MenuItem>\n                )}\n                {showEndorsements &&\n                  supportsEndorsements &&\n                  !renderEndorsements && (\n                    <MenuItem onClick={() => setRenderEndorsements(true)}>\n                      <Icon icon=\"endorsement\" />\n                      <span>\n                        <Trans>Show featured profiles</Trans>\n                      </span>\n                    </MenuItem>\n                  )}\n                {/* Add/remove from lists is only possible if following the account */}\n                {following && (\n                  <MenuItem\n                    onClick={() => {\n                      setShowAddRemoveLists(true);\n                    }}\n                  >\n                    <Icon icon=\"list\" />\n                    {lists.length ? (\n                      <>\n                        <small class=\"menu-grow\">\n                          <Trans>Add/Remove from Lists</Trans>\n                          <br />\n                          <span class=\"more-insignificant\">\n                            {lists.map((list) => list.title).join(', ')}\n                          </span>\n                        </small>\n                        <small class=\"more-insignificant\">{lists.length}</small>\n                      </>\n                    ) : (\n                      <span>\n                        <Trans>Add/Remove from Lists</Trans>\n                      </span>\n                    )}\n                  </MenuItem>\n                )}\n                <MenuDivider />\n              </>\n            ) : (\n              <>\n                {searchEnabled && isSelf && (\n                  <MenuItem\n                    onClick={() => {\n                      states.showSearchCommand = { query: 'from:me ' };\n                    }}\n                  >\n                    <Icon icon=\"search\" />\n                    <span>\n                      <Trans>Search my posts</Trans>\n                    </span>\n                  </MenuItem>\n                )}\n                {supportsEndorsements && !renderEndorsements && (\n                  <>\n                    <MenuItem onClick={() => setRenderEndorsements(true)}>\n                      <Icon icon=\"endorsement\" />\n                      <Trans>Show featured profiles</Trans>\n                    </MenuItem>\n                  </>\n                )}\n                {((searchEnabled && isSelf) ||\n                  (supportsEndorsements && !renderEndorsements)) && (\n                  <MenuDivider />\n                )}\n              </>\n            )}\n            <MenuItem\n              onClick={() => {\n                const handle = `@${currentInfo?.acct || acctWithInstance}`;\n                try {\n                  navigator.clipboard.writeText(handle);\n                  showToast(t`Handle copied`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to copy handle`);\n                }\n              }}\n            >\n              <Icon icon=\"copy\" />\n              <small>\n                <Trans>Copy handle</Trans>\n                <br />\n                <span class=\"more-insignificant bidi-isolate\">\n                  @{currentInfo?.acct || acctWithInstance}\n                </span>\n              </small>\n            </MenuItem>\n            <MenuItem href={url} target=\"_blank\">\n              <Icon icon=\"external\" />\n              <small class=\"menu-double-lines\">{niceAccountURL(url)}</small>\n            </MenuItem>\n            <div class=\"menu-horizontal\">\n              <MenuItem\n                onClick={() => {\n                  // Copy url to clipboard\n                  try {\n                    navigator.clipboard.writeText(url);\n                    showToast(t`Link copied`);\n                  } catch (e) {\n                    console.error(e);\n                    showToast(t`Unable to copy link`);\n                  }\n                }}\n              >\n                <Icon icon=\"link\" />\n                <span>\n                  <Trans>Copy</Trans>\n                </span>\n              </MenuItem>\n              {navigator?.share &&\n                navigator?.canShare?.({\n                  url,\n                }) && (\n                  <MenuItem\n                    onClick={() => {\n                      try {\n                        navigator.share({\n                          url,\n                        });\n                      } catch (e) {\n                        console.error(e);\n                        alert(t`Sharing doesn't seem to work.`);\n                      }\n                    }}\n                  >\n                    <Icon icon=\"share\" />\n                    <span>\n                      <Trans>Share</Trans>\n                    </span>\n                  </MenuItem>\n                )}\n            </div>\n            <MenuItem\n              onClick={() => {\n                states.showQrCodeModal = {\n                  text: url,\n                  arena: avatarStatic,\n                  backgroundMask: headerStatic,\n                  caption: acct.includes('@') ? acct : `${acct}@${instance}`,\n                  onScannerClick: handleScannerClick,\n                };\n              }}\n            >\n              <Icon icon=\"qrcode\" />\n              <span>\n                <Trans>QR code</Trans>\n              </span>\n            </MenuItem>\n            {!!relationship && (\n              <>\n                <MenuDivider />\n                {muting ? (\n                  <MenuItem\n                    onClick={() => {\n                      setRelationshipUIState('loading');\n                      (async () => {\n                        try {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .unmute();\n                          console.log('unmuting', newRelationship);\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`Unmuted @${username}`);\n                          states.reloadGenericAccounts.id = 'mute';\n                          states.reloadGenericAccounts.counter++;\n                        } catch (e) {\n                          console.error(e);\n                          setRelationshipUIState('error');\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"unmute\" />\n                    <span>\n                      <Trans>\n                        Unmute <span class=\"bidi-isolate\">@{username}</span>\n                      </Trans>\n                    </span>\n                  </MenuItem>\n                ) : (\n                  <SubMenu2\n                    menuClassName=\"menu-blur\"\n                    openTrigger=\"clickOnly\"\n                    direction=\"bottom\"\n                    overflow=\"auto\"\n                    shift={16}\n                    label={\n                      <>\n                        <Icon icon=\"mute\" />\n                        <span class=\"menu-grow\">\n                          <Trans>\n                            Mute <span class=\"bidi-isolate\">@{username}</span>\n                          </Trans>\n                        </span>\n                        <span\n                          style={{\n                            textOverflow: 'clip',\n                          }}\n                        >\n                          <Icon icon=\"time\" />\n                          <Icon icon=\"chevron-right\" />\n                        </span>\n                      </>\n                    }\n                  >\n                    <div class=\"menu-wrap\">\n                      {MUTE_DURATIONS.map((duration) => (\n                        <MenuItem\n                          onClick={() => {\n                            setRelationshipUIState('loading');\n                            (async () => {\n                              try {\n                                const newRelationship =\n                                  await currentMasto.v1.accounts\n                                    .$select(currentInfo?.id || id)\n                                    .mute({\n                                      duration,\n                                    });\n                                console.log('muting', newRelationship);\n                                setRelationship(newRelationship);\n                                setRelationshipUIState('default');\n                                showToast(\n                                  t`Muted @${username} for ${\n                                    typeof MUTE_DURATIONS_LABELS[duration] ===\n                                    'function'\n                                      ? MUTE_DURATIONS_LABELS[duration]()\n                                      : _(MUTE_DURATIONS_LABELS[duration])\n                                  }`,\n                                );\n                                states.reloadGenericAccounts.id = 'mute';\n                                states.reloadGenericAccounts.counter++;\n                              } catch (e) {\n                                console.error(e);\n                                setRelationshipUIState('error');\n                                showToast(t`Unable to mute @${username}`);\n                              }\n                            })();\n                          }}\n                        >\n                          {typeof MUTE_DURATIONS_LABELS[duration] === 'function'\n                            ? MUTE_DURATIONS_LABELS[duration]()\n                            : _(MUTE_DURATIONS_LABELS[duration])}\n                        </MenuItem>\n                      ))}\n                    </div>\n                  </SubMenu2>\n                )}\n                {followedBy && (\n                  <MenuConfirm\n                    subMenu\n                    menuItemClassName=\"danger\"\n                    confirmLabel={\n                      <>\n                        <Icon icon=\"user-x\" />\n                        <span>\n                          <Trans>\n                            Remove <span class=\"bidi-isolate\">@{username}</span>{' '}\n                            from followers?\n                          </Trans>\n                        </span>\n                      </>\n                    }\n                    onClick={() => {\n                      setRelationshipUIState('loading');\n                      (async () => {\n                        try {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .removeFromFollowers();\n                          console.log(\n                            'removing from followers',\n                            newRelationship,\n                          );\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`@${username} removed from followers`);\n                          states.reloadGenericAccounts.id = 'followers';\n                          states.reloadGenericAccounts.counter++;\n                        } catch (e) {\n                          console.error(e);\n                          setRelationshipUIState('error');\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"user-x\" />\n                    <span>\n                      <Trans>Remove follower</Trans>\n                    </span>\n                  </MenuConfirm>\n                )}\n                <MenuConfirm\n                  subMenu\n                  confirm={!blocking}\n                  confirmLabel={\n                    <>\n                      <Icon icon=\"block\" />\n                      <span>\n                        <Trans>\n                          Block <span class=\"bidi-isolate\">@{username}</span>?\n                        </Trans>\n                      </span>\n                    </>\n                  }\n                  itemProps={{\n                    className: 'danger',\n                  }}\n                  menuItemClassName=\"danger\"\n                  onClick={() => {\n                    // if (!blocking && !confirm(`Block @${username}?`)) {\n                    //   return;\n                    // }\n                    setRelationshipUIState('loading');\n                    (async () => {\n                      try {\n                        if (blocking) {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .unblock();\n                          console.log('unblocking', newRelationship);\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`Unblocked @${username}`);\n                        } else {\n                          const newRelationship = await currentMasto.v1.accounts\n                            .$select(currentInfo?.id || id)\n                            .block();\n                          console.log('blocking', newRelationship);\n                          setRelationship(newRelationship);\n                          setRelationshipUIState('default');\n                          showToast(t`Blocked @${username}`);\n                        }\n                        states.reloadGenericAccounts.id = 'block';\n                        states.reloadGenericAccounts.counter++;\n                      } catch (e) {\n                        console.error(e);\n                        setRelationshipUIState('error');\n                        if (blocking) {\n                          showToast(t`Unable to unblock @${username}`);\n                        } else {\n                          showToast(t`Unable to block @${username}`);\n                        }\n                      }\n                    })();\n                  }}\n                >\n                  {blocking ? (\n                    <>\n                      <Icon icon=\"unblock\" />\n                      <span>\n                        <Trans>\n                          Unblock <span class=\"bidi-isolate\">@{username}</span>\n                        </Trans>\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <Icon icon=\"block\" />\n                      <span>\n                        <Trans>\n                          Block <span class=\"bidi-isolate\">@{username}</span>\n                        </Trans>\n                      </span>\n                    </>\n                  )}\n                </MenuConfirm>\n                <MenuItem\n                  className=\"danger\"\n                  onClick={() => {\n                    states.showReportModal = {\n                      account: currentInfo || info,\n                    };\n                  }}\n                >\n                  <Icon icon=\"flag\" />\n                  <span>\n                    <Trans>\n                      Report <span class=\"bidi-isolate\">@{username}</span>\n                    </Trans>\n                  </span>\n                </MenuItem>\n              </>\n            )}\n            {currentAuthenticated &&\n              isSelf &&\n              standalone &&\n              supports('@mastodon/profile-edit') && (\n                <>\n                  <MenuDivider />\n                  <MenuItem\n                    onClick={() => {\n                      setShowEditProfile(true);\n                    }}\n                  >\n                    <Icon icon=\"pencil\" />\n                    <span>\n                      <Trans>Edit profile</Trans>\n                    </span>\n                  </MenuItem>\n                </>\n              )}\n            {import.meta.env.DEV && currentAuthenticated && isSelf && (\n              <>\n                <MenuDivider />\n                <MenuItem\n                  onClick={async () => {\n                    const relationships =\n                      await currentMasto.v1.accounts.relationships.fetch({\n                        id: [accountID.current],\n                      });\n                    const { note } = relationships[0] || {};\n                    if (note) {\n                      alert(note);\n                      console.log(note);\n                    }\n                  }}\n                >\n                  <Icon icon=\"pencil\" />\n                  <span>See note</span>\n                </MenuItem>\n              </>\n            )}\n          </Menu2>\n          {!relationship && relationshipUIState === 'loading' && (\n            <Loader abrupt />\n          )}\n          {!!relationship && !moved && (\n            <MenuConfirm\n              confirm={following || requested}\n              confirmLabel={\n                <span>\n                  {requested\n                    ? t`Withdraw follow request?`\n                    : t`Unfollow @${info.acct || info.username}?`}\n                </span>\n              }\n              menuItemClassName=\"danger\"\n              align=\"end\"\n              disabled={loading}\n              onClick={() => {\n                setRelationshipUIState('loading');\n                (async () => {\n                  try {\n                    let newRelationship;\n\n                    if (following || requested) {\n                      // const yes = confirm(\n                      //   requested\n                      //     ? 'Withdraw follow request?'\n                      //     : `Unfollow @${info.acct || info.username}?`,\n                      // );\n\n                      // if (yes) {\n                      newRelationship = await currentMasto.v1.accounts\n                        .$select(accountID.current)\n                        .unfollow();\n                      // }\n                    } else {\n                      newRelationship = await currentMasto.v1.accounts\n                        .$select(accountID.current)\n                        .follow();\n                    }\n\n                    if (newRelationship) {\n                      setRelationship(newRelationship);\n\n                      // Show endorsements if start following\n                      if (\n                        showEndorsements &&\n                        supportsEndorsements &&\n                        !renderEndorsements &&\n                        newRelationship.following\n                      ) {\n                        setRenderEndorsements('onlyOpenIfHasEndorsements');\n                      }\n                    }\n                    setRelationshipUIState('default');\n                  } catch (e) {\n                    alert(e);\n                    setRelationshipUIState('error');\n                  }\n                })();\n              }}\n            >\n              <button\n                type=\"button\"\n                class={`${following || requested ? 'light swap' : ''}`}\n                data-swap-state={following || requested ? 'danger' : ''}\n                disabled={loading}\n              >\n                {following ? (\n                  <>\n                    <span>\n                      <Trans>Following</Trans>\n                    </span>\n                    <span>\n                      <Trans>Unfollow</Trans>\n                    </span>\n                  </>\n                ) : requested ? (\n                  <>\n                    <span>\n                      <Trans>Requested</Trans>\n                    </span>\n                    <span>\n                      <Trans>Withdraw</Trans>\n                    </span>\n                  </>\n                ) : locked ? (\n                  <>\n                    <Icon icon=\"lock\" />{' '}\n                    <span>\n                      <Trans>Follow</Trans>\n                    </span>\n                  </>\n                ) : (\n                  t`Follow`\n                )}\n              </button>\n            </MenuConfirm>\n          )}\n        </span>\n      </div>\n      {!!showTranslatedBio && (\n        <Modal\n          onClose={() => {\n            setShowTranslatedBio(false);\n          }}\n        >\n          <TranslatedBioSheet\n            note={note}\n            fields={fields}\n            onClose={() => setShowTranslatedBio(false)}\n          />\n        </Modal>\n      )}\n      {!!showAddRemoveLists && (\n        <Modal\n          onClose={() => {\n            setShowAddRemoveLists(false);\n          }}\n        >\n          <AddRemoveListsSheet\n            accountID={accountID.current}\n            onClose={() => setShowAddRemoveLists(false)}\n          />\n        </Modal>\n      )}\n      {!!showPrivateNoteModal && (\n        <Modal\n          onClose={() => {\n            setShowPrivateNoteModal(false);\n          }}\n        >\n          <PrivateNoteSheet\n            account={info}\n            note={privateNote}\n            onRelationshipChange={(relationship) => {\n              setRelationship(relationship);\n              // onRelationshipChange({ relationship, currentID: accountID.current });\n            }}\n            onClose={() => setShowPrivateNoteModal(false)}\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n\nfunction niceAccountURL(url) {\n  if (!url) return;\n  const urlObj = URL.parse(url);\n  if (!urlObj) return;\n  const { host, pathname } = urlObj;\n  const path = pathname.replace(/\\/$/, '').replace(/^\\//, '');\n  return (\n    <>\n      <span class=\"more-insignificant\">{punycode.toUnicode(host)}/</span>\n      <wbr />\n      <span>{path}</span>\n    </>\n  );\n}\n\nexport default RelatedActions;\n","import './account-info.css';\n\nimport { msg, plural } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport enhanceContent from '../utils/enhance-content';\nimport getDomain from '../utils/get-domain';\nimport handleContentLinks from '../utils/handle-content-links';\nimport niceDateTime from '../utils/nice-date-time';\nimport pmem from '../utils/pmem';\nimport { supportsNativeQuote } from '../utils/quote-utils';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { hideAllModals } from '../utils/states';\nimport {\n  getAccounts,\n  getCurrentAccountID,\n  saveAccounts,\n} from '../utils/store-utils';\nimport supports from '../utils/supports';\n\nimport AccountBlock from './account-block';\nimport AccountHandleInfo from './account-handle-info';\nimport Avatar from './avatar';\nimport EditProfileSheet from './edit-profile-sheet';\nimport EmojiText from './emoji-text';\nimport Endorsements from './endorsements';\nimport Icon from './icon';\nimport Link from './link';\nimport Menu2 from './menu2';\nimport Modal from './modal';\nimport RelatedActions from './related-actions';\n\nconst LIMIT = 80;\n\nconst ACCOUNT_INFO_MAX_AGE = 1000 * 60 * 10; // 10 mins\n\nfunction fetchFamiliarFollowers(currentID, masto) {\n  return masto.v1.accounts.familiarFollowers.fetch({\n    id: [currentID],\n  });\n}\nconst memFetchFamiliarFollowers = pmem(fetchFamiliarFollowers, {\n  expires: ACCOUNT_INFO_MAX_AGE,\n});\n\nasync function fetchPostingStats(accountID, masto) {\n  const fetchStatuses = masto.v1.accounts\n    .$select(accountID)\n    .statuses.list({\n      limit: 20,\n    })\n    .values()\n    .next();\n\n  const { value: statuses } = await fetchStatuses;\n  console.log('fetched statuses', statuses);\n  const stats = {\n    total: statuses.length,\n    originals: 0,\n    replies: 0,\n    boosts: 0,\n    quotes: 0,\n  };\n  // Categories statuses by type\n  // - Original posts (not replies to others)\n  // - Threads (self-replies + 1st original post)\n  // - Boosts (reblogs)\n  // - Replies (not-self replies)\n  // - Quotes\n  statuses.forEach((status) => {\n    if (status.reblog) {\n      stats.boosts++;\n    } else if (\n      !!status.inReplyToId &&\n      status.inReplyToAccountId !== status.account.id // Not self-reply\n    ) {\n      stats.replies++;\n    } else if (\n      supportsNativeQuote() &&\n      (status.quote?.id || status.quote?.quotedStatus?.id)\n    ) {\n      stats.quotes++;\n    } else {\n      stats.originals++;\n    }\n  });\n\n  // Count days since last post\n  if (statuses.length) {\n    stats.daysSinceLastPost = Math.ceil(\n      (Date.now() - Date.parse(statuses[statuses.length - 1].createdAt)) /\n        86400000,\n    );\n  }\n\n  console.log('posting stats', stats);\n  return stats;\n}\nconst memFetchPostingStats = pmem(fetchPostingStats, {\n  expires: ACCOUNT_INFO_MAX_AGE,\n});\n\nconst isValidUrl = (string) => {\n  try {\n    new URL(string);\n    return true;\n  } catch (_) {\n    return false;\n  }\n};\nexport const handleScannerClick = () => {\n  states.showQrScannerModal = {\n    checkValidity: isValidUrl,\n    actionableText: msg`View profile`,\n    onClose: ({ text } = {}) => {\n      if (text) {\n        hideAllModals();\n        location.hash = `/${text}`;\n      }\n    },\n  };\n};\n\nfunction AccountInfo({\n  account,\n  fetchAccount = () => {},\n  standalone,\n  instance,\n  authenticated,\n  showEndorsements = false,\n}) {\n  const { i18n, t } = useLingui();\n  const { masto, authenticated: currentAuthenticated } = api({\n    instance,\n  });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const [uiState, setUIState] = useState('default');\n  const isString = typeof account === 'string';\n  const [info, setInfo] = useState(isString ? null : account);\n\n  const sameCurrentInstance = useMemo(\n    () => instance === currentInstance,\n    [instance, currentInstance],\n  );\n\n  useEffect(() => {\n    if (!isString) {\n      setInfo(account);\n      return;\n    }\n    setUIState('loading');\n    (async () => {\n      try {\n        const info = await fetchAccount();\n        states.accounts[`${info.id}@${instance}`] = info;\n        setInfo(info);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setInfo(null);\n        setUIState('error');\n      }\n    })();\n  }, [isString, account, fetchAccount]);\n\n  const {\n    acct,\n    avatar,\n    avatarStatic,\n    bot,\n    createdAt,\n    displayName,\n    emojis,\n    fields,\n    followersCount,\n    followingCount,\n    group,\n    // header,\n    // headerStatic,\n    id,\n    lastStatusAt,\n    locked,\n    note,\n    statusesCount,\n    url,\n    username,\n    memorial,\n    moved,\n    roles,\n    hideCollections,\n  } = info || {};\n  let headerIsAvatar = false;\n  let { header, headerStatic } = info || {};\n  if (!header || /missing\\.png$/.test(header)) {\n    if (avatar && !/missing\\.png$/.test(avatar)) {\n      header = avatar;\n      headerIsAvatar = true;\n      if (avatarStatic && !/missing\\.png$/.test(avatarStatic)) {\n        headerStatic = avatarStatic;\n      }\n    }\n  }\n\n  const isSelf = useMemo(() => id === getCurrentAccountID(), [id]);\n\n  useEffect(() => {\n    const infoHasEssentials = !!(\n      info?.id &&\n      info?.username &&\n      info?.acct &&\n      info?.avatar &&\n      info?.avatarStatic &&\n      info?.displayName &&\n      info?.url\n    );\n    if (isSelf && instance && infoHasEssentials) {\n      const accounts = getAccounts();\n      let updated = false;\n      accounts.forEach((account) => {\n        if (account.info.id === info.id && account.instanceURL === instance) {\n          account.info = info;\n          updated = true;\n        }\n      });\n      if (updated) {\n        console.log('Updated account info', info);\n        saveAccounts(accounts);\n      }\n    }\n  }, [isSelf, info, instance]);\n\n  const accountInstance = getDomain(url);\n\n  const [headerCornerColors, setHeaderCornerColors] = useState([]);\n\n  const followersIterator = useRef();\n  const familiarFollowersCache = useRef([]);\n  async function fetchFollowers(firstLoad) {\n    if (firstLoad || !followersIterator.current) {\n      followersIterator.current = masto.v1.accounts\n        .$select(id)\n        .followers.list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await followersIterator.current.next();\n    if (isSelf) return results;\n    if (!sameCurrentInstance) return results;\n\n    const { value } = results;\n    let newValue = [];\n    // On first load, fetch familiar followers, merge to top of results' `value`\n    // Remove dups on every fetch\n    if (firstLoad) {\n      let familiarFollowers = [];\n      try {\n        familiarFollowers = await masto.v1.accounts.familiarFollowers.fetch({\n          id: [id],\n        });\n      } catch (e) {}\n      familiarFollowersCache.current = familiarFollowers?.[0]?.accounts || [];\n      newValue = [\n        ...familiarFollowersCache.current,\n        ...value.filter(\n          (account) =>\n            !familiarFollowersCache.current.some(\n              (familiar) => familiar.id === account.id,\n            ),\n        ),\n      ];\n    } else if (value?.length) {\n      newValue = value.filter(\n        (account) =>\n          !familiarFollowersCache.current.some(\n            (familiar) => familiar.id === account.id,\n          ),\n      );\n    }\n\n    return {\n      ...results,\n      value: newValue,\n    };\n  }\n\n  const followingIterator = useRef();\n  async function fetchFollowing(firstLoad) {\n    if (firstLoad || !followingIterator.current) {\n      followingIterator.current = masto.v1.accounts\n        .$select(id)\n        .following.list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await followingIterator.current.next();\n    return results;\n  }\n\n  const LinkOrDiv = standalone ? 'div' : Link;\n  const accountLink = instance ? `/${instance}/a/${id}` : `/a/${id}`;\n\n  const [familiarFollowers, setFamiliarFollowers] = useState([]);\n  const [postingStats, setPostingStats] = useState();\n  const [postingStatsUIState, setPostingStatsUIState] = useState('default');\n  const hasPostingStats = !!postingStats?.total;\n\n  const renderFamiliarFollowers = async (currentID) => {\n    try {\n      const followers = await memFetchFamiliarFollowers(\n        currentID,\n        currentMasto,\n      );\n      console.log('fetched familiar followers', followers);\n      setFamiliarFollowers(\n        followers[0].accounts.slice(0, FAMILIAR_FOLLOWERS_LIMIT),\n      );\n    } catch (e) {\n      console.error(e);\n    }\n  };\n\n  const renderPostingStats = async () => {\n    if (!id) return;\n    setPostingStatsUIState('loading');\n    try {\n      const stats = await memFetchPostingStats(id, masto);\n      setPostingStats(stats);\n      setPostingStatsUIState('default');\n    } catch (e) {\n      console.error(e);\n      setPostingStatsUIState('error');\n    }\n  };\n\n  const onRelationshipChange = useCallback(\n    ({ relationship, currentID }) => {\n      if (!relationship.following) {\n        renderFamiliarFollowers(currentID);\n        if (!standalone && statusesCount > 0) {\n          // Only render posting stats if not standalone and has posts\n          renderPostingStats();\n        }\n      }\n    },\n    [standalone, id, statusesCount],\n  );\n\n  const onProfileUpdate = useCallback(\n    (newAccount) => {\n      if (newAccount.id === id) {\n        console.log('Updated account info', newAccount);\n        setInfo(newAccount);\n        states.accounts[`${newAccount.id}@${instance}`] = newAccount;\n      }\n    },\n    [id, instance],\n  );\n\n  const isStringURL = isString && account && /^https?:\\/\\//.test(account);\n\n  const [showEditProfile, setShowEditProfile] = useState(false);\n\n  const [renderEndorsements, setRenderEndorsements] = useState(false);\n\n  return (\n    <>\n      <div\n        tabIndex=\"-1\"\n        class={`account-container ${uiState === 'loading' ? 'skeleton' : ''}`}\n        style={{\n          '--header-color-1': headerCornerColors[0],\n          '--header-color-2': headerCornerColors[1],\n          '--header-color-3': headerCornerColors[2],\n          '--header-color-4': headerCornerColors[3],\n        }}\n      >\n        {uiState === 'error' && (\n          <div class=\"ui-state\">\n            <p>\n              <Trans>Unable to load account.</Trans>\n            </p>\n            {isString ? (\n              <p>\n                {isStringURL ? (\n                  <a href={account} target=\"_blank\" rel=\"noopener\">\n                    {account}\n                  </a>\n                ) : (\n                  <code class=\"insignificant\">{account}</code>\n                )}\n              </p>\n            ) : (\n              <p>\n                <a href={url} target=\"_blank\" rel=\"noopener\">\n                  <Trans>Go to account page</Trans> <Icon icon=\"external\" />\n                </a>\n              </p>\n            )}\n          </div>\n        )}\n        {uiState === 'loading' ? (\n          <>\n            <header>\n              <AccountBlock avatarSize=\"xxxl\" skeleton />\n            </header>\n            <main>\n              <div class=\"note\">\n                <p>  </p>\n                <p>     </p>\n              </div>\n              <div class=\"account-metadata-box\">\n                <div class=\"profile-metadata\">\n                  <div class=\"profile-field\">\n                    <b class=\"more-insignificant\"></b>\n                    <p></p>\n                  </div>\n                  <div class=\"profile-field\">\n                    <b class=\"more-insignificant\"></b>\n                    <p></p>\n                  </div>\n                </div>\n                <div class=\"stats\">\n                  <div>\n                    <span></span> \n                  </div>\n                  <div>\n                    <span></span> \n                  </div>\n                  <div>\n                    <span></span> \n                  </div>\n                </div>\n              </div>\n              <div class=\"actions\">\n                <span />\n                <span class=\"buttons\">\n                  <button type=\"button\" class=\"plain4\" disabled>\n                    <Icon icon=\"more2\" size=\"l\" />\n                  </button>\n                </span>\n              </div>\n            </main>\n          </>\n        ) : (\n          info && (\n            <>\n              {!!moved && (\n                <div class=\"account-moved\">\n                  <p>\n                    <Trans>\n                      <b>{displayName}</b> has indicated that their new account\n                      is now:\n                    </Trans>\n                  </p>\n                  <AccountBlock\n                    account={moved}\n                    instance={instance}\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      states.showAccount = moved;\n                    }}\n                  />\n                </div>\n              )}\n              {!!header && !/missing\\.png$/.test(header) && (\n                <img\n                  src={header}\n                  alt=\"\"\n                  class={`header-banner ${\n                    headerIsAvatar ? 'header-is-avatar' : ''\n                  }`}\n                  onError={(e) => {\n                    if (e.target.crossOrigin) {\n                      if (e.target.src !== headerStatic) {\n                        e.target.src = headerStatic;\n                      } else {\n                        e.target.removeAttribute('crossorigin');\n                        e.target.src = header;\n                      }\n                    } else if (e.target.src !== headerStatic) {\n                      e.target.src = headerStatic;\n                    } else {\n                      e.target.remove();\n                    }\n                  }}\n                  crossOrigin=\"anonymous\"\n                  onLoad={(e) => {\n                    e.target.classList.add('loaded');\n                    try {\n                      // Get color from four corners of image\n                      const canvas = window.OffscreenCanvas\n                        ? new OffscreenCanvas(1, 1)\n                        : document.createElement('canvas');\n                      const ctx = canvas.getContext('2d', {\n                        willReadFrequently: true,\n                      });\n                      canvas.width = e.target.width;\n                      canvas.height = e.target.height;\n                      ctx.imageSmoothingEnabled = false;\n                      ctx.drawImage(e.target, 0, 0);\n                      // const colors = [\n                      //   ctx.getImageData(0, 0, 1, 1).data,\n                      //   ctx.getImageData(e.target.width - 1, 0, 1, 1).data,\n                      //   ctx.getImageData(0, e.target.height - 1, 1, 1).data,\n                      //   ctx.getImageData(\n                      //     e.target.width - 1,\n                      //     e.target.height - 1,\n                      //     1,\n                      //     1,\n                      //   ).data,\n                      // ];\n                      // Get 10x10 pixels from corners, get average color from each\n                      const pixelDimension = 10;\n                      const colors = [\n                        ctx.getImageData(0, 0, pixelDimension, pixelDimension)\n                          .data,\n                        ctx.getImageData(\n                          e.target.width - pixelDimension,\n                          0,\n                          pixelDimension,\n                          pixelDimension,\n                        ).data,\n                        ctx.getImageData(\n                          0,\n                          e.target.height - pixelDimension,\n                          pixelDimension,\n                          pixelDimension,\n                        ).data,\n                        ctx.getImageData(\n                          e.target.width - pixelDimension,\n                          e.target.height - pixelDimension,\n                          pixelDimension,\n                          pixelDimension,\n                        ).data,\n                      ].map((data) => {\n                        let r = 0;\n                        let g = 0;\n                        let b = 0;\n                        let a = 0;\n                        for (let i = 0; i < data.length; i += 4) {\n                          r += data[i];\n                          g += data[i + 1];\n                          b += data[i + 2];\n                          a += data[i + 3];\n                        }\n                        const dataLength = data.length / 4;\n                        return [\n                          r / dataLength,\n                          g / dataLength,\n                          b / dataLength,\n                          a / dataLength,\n                        ];\n                      });\n                      const rgbColors = colors.map((color) => {\n                        const [r, g, b, a] = lightenRGB(color);\n                        return `rgba(${r}, ${g}, ${b}, ${a})`;\n                      });\n                      setHeaderCornerColors(rgbColors);\n                      console.log({ colors, rgbColors });\n                    } catch (e) {\n                      // Silently fail\n                    }\n                  }}\n                />\n              )}\n              <header>\n                {standalone ? (\n                  <Menu2\n                    shift={\n                      window.matchMedia('(min-width: calc(40em))').matches\n                        ? 114\n                        : 64\n                    }\n                    menuButton={\n                      <div>\n                        <AccountBlock\n                          account={info}\n                          instance={instance}\n                          avatarSize=\"xxxl\"\n                          onClick={() => {}}\n                        />\n                      </div>\n                    }\n                  >\n                    <div class=\"szh-menu__header\">\n                      <AccountHandleInfo acct={acct} instance={instance} />\n                    </div>\n                    <MenuItem\n                      onClick={() => {\n                        const handleWithInstance = acct.includes('@')\n                          ? `@${acct}`\n                          : `@${acct}@${instance}`;\n                        try {\n                          navigator.clipboard.writeText(handleWithInstance);\n                          showToast(t`Handle copied`);\n                        } catch (e) {\n                          console.error(e);\n                          showToast(t`Unable to copy handle`);\n                        }\n                      }}\n                    >\n                      <Icon icon=\"link\" />\n                      <span>\n                        <Trans>Copy handle</Trans>\n                      </span>\n                    </MenuItem>\n                    <MenuItem\n                      onClick={() => {\n                        states.showQrCodeModal = {\n                          text: url,\n                          arena: avatarStatic,\n                          backgroundMask: headerStatic,\n                          caption: acct.includes('@')\n                            ? acct\n                            : `${acct}@${instance}`,\n                          onScannerClick: handleScannerClick,\n                        };\n                      }}\n                    >\n                      <Icon icon=\"qrcode\" />\n                      <span>\n                        <Trans>QR code</Trans>\n                      </span>\n                    </MenuItem>\n                    <MenuItem href={url} target=\"_blank\">\n                      <Icon icon=\"external\" />\n                      <span>\n                        <Trans>Go to original profile page</Trans>\n                      </span>\n                    </MenuItem>\n                    <MenuDivider />\n                    <MenuItem\n                      onClick={() => {\n                        states.showMediaModal = {\n                          mediaAttachments: [\n                            {\n                              type: 'image',\n                              url: avatarStatic,\n                            },\n                          ],\n                        };\n                      }}\n                    >\n                      <Icon icon=\"user\" />\n                      <span>\n                        <Trans>View profile image</Trans>\n                      </span>\n                    </MenuItem>\n                    {!!headerStatic && !headerIsAvatar && (\n                      <MenuItem\n                        onClick={() => {\n                          states.showMediaModal = {\n                            mediaAttachments: [\n                              {\n                                type: 'image',\n                                url: headerStatic,\n                              },\n                            ],\n                          };\n                        }}\n                      >\n                        <Icon icon=\"media\" />\n                        <span>\n                          <Trans>View profile header</Trans>\n                        </span>\n                      </MenuItem>\n                    )}\n                    {currentAuthenticated &&\n                      isSelf &&\n                      supports('@mastodon/profile-edit') && (\n                        <>\n                          <MenuDivider />\n                          <MenuItem\n                            onClick={() => {\n                              setShowEditProfile(true);\n                            }}\n                          >\n                            <Icon icon=\"pencil\" />\n                            <span>\n                              <Trans>Edit profile</Trans>\n                            </span>\n                          </MenuItem>\n                        </>\n                      )}\n                  </Menu2>\n                ) : (\n                  <AccountBlock\n                    account={info}\n                    instance={instance}\n                    avatarSize=\"xxxl\"\n                    internal\n                  />\n                )}\n              </header>\n              <div class=\"faux-header-bg\" aria-hidden=\"true\" />\n              <main>\n                {!!memorial && (\n                  <span class=\"tag\">\n                    <Trans>In Memoriam</Trans>\n                  </span>\n                )}\n                {!!bot && (\n                  <span class=\"tag\">\n                    <Icon icon=\"bot\" /> <Trans>Automated</Trans>\n                  </span>\n                )}\n                {!!group && (\n                  <span class=\"tag\">\n                    <Icon icon=\"group\" /> <Trans>Group</Trans>\n                  </span>\n                )}\n                {/* {roles?.map((role) => (\n                  <span class=\"tag\">\n                    {role.name}\n                    {!!accountInstance && (\n                      <>\n                        {' '}\n                        <span class=\"more-insignificant\">\n                          {accountInstance}\n                        </span>\n                      </>\n                    )}\n                  </span>\n                ))} */}\n                <div\n                  class=\"note\"\n                  dir=\"auto\"\n                  onClick={handleContentLinks({\n                    instance: currentInstance,\n                  })}\n                  dangerouslySetInnerHTML={{\n                    __html: enhanceContent(note, { emojis }),\n                  }}\n                />\n                <div class=\"account-metadata-box\">\n                  {fields?.length > 0 && (\n                    <div class=\"profile-metadata\">\n                      {fields.map(({ name, value, verifiedAt }, i) => (\n                        <div\n                          class={`profile-field ${\n                            verifiedAt ? 'profile-verified' : ''\n                          }`}\n                          key={name + i}\n                          dir=\"auto\"\n                        >\n                          <b>\n                            <EmojiText text={name} emojis={emojis} />{' '}\n                            {!!verifiedAt && (\n                              <Icon\n                                icon=\"check-circle\"\n                                size=\"s\"\n                                alt={t`Verified`}\n                              />\n                            )}\n                          </b>\n                          <p\n                            dangerouslySetInnerHTML={{\n                              __html: enhanceContent(value, { emojis }),\n                            }}\n                          />\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                  <div class=\"stats\">\n                    <LinkOrDiv\n                      tabIndex={0}\n                      to={accountLink}\n                      onClick={() => {\n                        // states.showAccount = false;\n                        setTimeout(() => {\n                          states.showGenericAccounts = {\n                            id: 'followers',\n                            heading: t`Followers`,\n                            fetchAccounts: fetchFollowers,\n                            instance,\n                            excludeRelationshipAttrs: isSelf\n                              ? ['followedBy']\n                              : [],\n                            blankCopy: hideCollections\n                              ? t`This user has chosen to not make this information available.`\n                              : undefined,\n                          };\n                        }, 0);\n                      }}\n                    >\n                      {!!familiarFollowers.length && (\n                        <span class=\"shazam-container-horizontal\">\n                          <span class=\"shazam-container-inner stats-avatars-bunch\">\n                            {familiarFollowers.map((follower) => (\n                              <Avatar\n                                url={follower.avatarStatic}\n                                size=\"s\"\n                                alt={`${follower.displayName} @${follower.acct}`}\n                                squircle={follower?.bot}\n                              />\n                            ))}\n                          </span>\n                        </span>\n                      )}\n                      <Plural\n                        value={followersCount}\n                        one={\n                          <Trans>\n                            <span title={followersCount}>\n                              {shortenNumber(followersCount)}\n                            </span>{' '}\n                            Follower\n                          </Trans>\n                        }\n                        other={\n                          <Trans>\n                            <span title={followersCount}>\n                              {shortenNumber(followersCount)}\n                            </span>{' '}\n                            Followers\n                          </Trans>\n                        }\n                      />\n                    </LinkOrDiv>\n                    <LinkOrDiv\n                      class=\"insignificant\"\n                      tabIndex={0}\n                      to={accountLink}\n                      onClick={() => {\n                        // states.showAccount = false;\n                        setTimeout(() => {\n                          states.showGenericAccounts = {\n                            heading: t({\n                              id: 'following.stats',\n                              message: 'Following',\n                            }),\n                            fetchAccounts: fetchFollowing,\n                            instance,\n                            excludeRelationshipAttrs: isSelf\n                              ? ['following']\n                              : [],\n                            blankCopy: hideCollections\n                              ? t`This user has chosen to not make this information available.`\n                              : undefined,\n                          };\n                        }, 0);\n                      }}\n                    >\n                      <Plural\n                        value={followingCount}\n                        other={\n                          <Trans>\n                            <span title={followingCount}>\n                              {shortenNumber(followingCount)}\n                            </span>{' '}\n                            Following\n                          </Trans>\n                        }\n                      />\n                      <br />\n                    </LinkOrDiv>\n                    <LinkOrDiv\n                      class=\"insignificant\"\n                      to={accountLink}\n                      // onClick={\n                      //   standalone\n                      //     ? undefined\n                      //     : () => {\n                      //         hideAllModals();\n                      //       }\n                      // }\n                    >\n                      <Plural\n                        value={statusesCount}\n                        one={\n                          <Trans>\n                            <span title={statusesCount}>\n                              {shortenNumber(statusesCount)}\n                            </span>{' '}\n                            Post\n                          </Trans>\n                        }\n                        other={\n                          <Trans>\n                            <span title={statusesCount}>\n                              {shortenNumber(statusesCount)}\n                            </span>{' '}\n                            Posts\n                          </Trans>\n                        }\n                      />\n                    </LinkOrDiv>\n                    {!!createdAt && (\n                      <div class=\"insignificant\">\n                        <Trans>\n                          Joined{' '}\n                          <time datetime={createdAt}>\n                            {niceDateTime(createdAt, {\n                              hideTime: true,\n                            })}\n                          </time>\n                        </Trans>\n                      </div>\n                    )}\n                  </div>\n                </div>\n                {!!postingStats && (\n                  <LinkOrDiv\n                    to={accountLink}\n                    class=\"account-metadata-box\"\n                    // onClick={() => {\n                    //   states.showAccount = false;\n                    // }}\n                    onClick={\n                      import.meta.env.DEV && standalone\n                        ? () => {\n                            // Debug: undo back\n                            setPostingStats(null);\n                          }\n                        : undefined\n                    }\n                  >\n                    <div class=\"shazam-container\">\n                      <div class=\"shazam-container-inner\">\n                        {hasPostingStats ? (\n                          <div\n                            class=\"posting-stats\"\n                            title={\n                              supportsNativeQuote()\n                                ? t`${(\n                                    postingStats.originals / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} original posts, ${(\n                                    postingStats.replies / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} replies, ${(\n                                    postingStats.quotes / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} quotes, ${(\n                                    postingStats.boosts / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} boosts`\n                                : t`${(\n                                    postingStats.originals / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} original posts, ${(\n                                    postingStats.replies / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} replies, ${(\n                                    postingStats.boosts / postingStats.total\n                                  ).toLocaleString(i18n.locale || undefined, {\n                                    style: 'percent',\n                                  })} boosts`\n                            }\n                          >\n                            <div>\n                              {postingStats.daysSinceLastPost < 365\n                                ? plural(postingStats.total, {\n                                    one: plural(\n                                      postingStats.daysSinceLastPost,\n                                      {\n                                        one: `Last 1 post in the past 1 day`,\n                                        other: `Last 1 post in the past ${postingStats.daysSinceLastPost} days`,\n                                      },\n                                    ),\n                                    other: plural(\n                                      postingStats.daysSinceLastPost,\n                                      {\n                                        one: `Last ${postingStats.total} posts in the past 1 day`,\n                                        other: `Last ${postingStats.total} posts in the past ${postingStats.daysSinceLastPost} days`,\n                                      },\n                                    ),\n                                  })\n                                : plural(postingStats.total, {\n                                    one: 'Last 1 post in the past year(s)',\n                                    other: `Last ${postingStats.total} posts in the past year(s)`,\n                                  })}\n                            </div>\n                            <div class=\"posting-stats-bar\">\n                              {postingStats.originals > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-originals\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.originals /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                              {postingStats.replies > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-replies\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.replies /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                              {postingStats.quotes > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-quotes\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.quotes /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                              {postingStats.boosts > 0 && (\n                                <div\n                                  class=\"posting-stats-bar-section posting-stats-bar-boosts\"\n                                  style={{\n                                    '--percentage': `${\n                                      (postingStats.boosts /\n                                        postingStats.total) *\n                                      100\n                                    }%`,\n                                  }}\n                                />\n                              )}\n                            </div>\n                            <div class=\"posting-stats-legends\">\n                              <span class=\"ib\">\n                                <span class=\"posting-stats-legend-item posting-stats-bar-originals\" />{' '}\n                                <Trans>Original</Trans>\n                              </span>{' '}\n                              <span class=\"ib\">\n                                <span class=\"posting-stats-legend-item posting-stats-bar-replies\" />{' '}\n                                <Trans>Replies</Trans>\n                              </span>{' '}\n                              {supportsNativeQuote() && (\n                                <span class=\"ib\">\n                                  <span class=\"posting-stats-legend-item posting-stats-bar-quotes\" />{' '}\n                                  <Trans>Quotes</Trans>\n                                </span>\n                              )}\n                              <span class=\"ib\">\n                                <span class=\"posting-stats-legend-item posting-stats-bar-boosts\" />{' '}\n                                <Trans>Boosts</Trans>\n                              </span>\n                            </div>\n                          </div>\n                        ) : (\n                          <div class=\"posting-stats\">\n                            <Trans>Post stats unavailable.</Trans>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  </LinkOrDiv>\n                )}\n                {!moved && (\n                  <div class=\"account-metadata-box\">\n                    <div\n                      class=\"shazam-container no-animation\"\n                      hidden={!!postingStats}\n                    >\n                      <div class=\"shazam-container-inner\">\n                        <button\n                          type=\"button\"\n                          class=\"posting-stats-button\"\n                          disabled={postingStatsUIState === 'loading'}\n                          onClick={() => {\n                            renderPostingStats();\n                          }}\n                        >\n                          <div\n                            class={`posting-stats-icon ${\n                              postingStatsUIState === 'loading' ? 'loading' : ''\n                            }`}\n                          />\n                          <Trans>View post stats</Trans>{' '}\n                          {/* <Loader\n                        abrupt\n                        hidden={postingStatsUIState !== 'loading'}\n                      /> */}\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </main>\n              <footer>\n                <RelatedActions\n                  info={info}\n                  instance={instance}\n                  standalone={standalone}\n                  authenticated={authenticated}\n                  onRelationshipChange={onRelationshipChange}\n                  onProfileUpdate={onProfileUpdate}\n                  setShowEditProfile={setShowEditProfile}\n                  showEndorsements={showEndorsements}\n                  renderEndorsements={renderEndorsements}\n                  setRenderEndorsements={setRenderEndorsements}\n                />\n              </footer>\n              <Endorsements\n                accountID={id}\n                info={info}\n                open={renderEndorsements}\n                onlyOpenIfHasEndorsements={\n                  renderEndorsements === 'onlyOpenIfHasEndorsements'\n                }\n              />\n            </>\n          )\n        )}\n      </div>\n      {!!showEditProfile && (\n        <Modal\n          onClose={() => {\n            setShowEditProfile(false);\n          }}\n        >\n          <EditProfileSheet\n            onClose={({ state, account } = {}) => {\n              setShowEditProfile(false);\n              if (state === 'success' && account) {\n                onProfileUpdate(account);\n              }\n            }}\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n\nconst FAMILIAR_FOLLOWERS_LIMIT = 3;\n\nfunction lightenRGB([r, g, b]) {\n  const luminence = 0.2126 * r + 0.7152 * g + 0.0722 * b;\n  console.log('luminence', luminence);\n  let alpha;\n  if (luminence >= 220) {\n    alpha = 1;\n  } else if (luminence <= 50) {\n    alpha = 0.1;\n  } else {\n    alpha = luminence / 255;\n  }\n  alpha = Math.min(1, alpha);\n  return [r, g, b, alpha];\n}\n\nexport default AccountInfo;\n","import { useLingui } from '@lingui/react/macro';\nimport { useEffect } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport states from '../utils/states';\nimport useLocationChange from '../utils/useLocationChange';\n\nimport AccountInfo from './account-info';\nimport Icon from './icon';\n\nfunction AccountSheet({ account, instance: propInstance, onClose }) {\n  const { t } = useLingui();\n  const { masto, instance, authenticated } = api({ instance: propInstance });\n  const isString = typeof account === 'string';\n\n  useEffect(() => {\n    if (!isString) {\n      states.accounts[`${account.id}@${instance}`] = account;\n    }\n  }, [account]);\n\n  useLocationChange(onClose);\n\n  return (\n    <div\n      class=\"sheet\"\n      // onClick={(e) => {\n      //   const accountBlock = e.target.closest('.account-block');\n      //   if (accountBlock) {\n      //     onClose({\n      //       destination: 'account-statuses',\n      //     });\n      //   }\n      // }}\n    >\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close outer\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <AccountInfo\n        instance={instance}\n        authenticated={authenticated}\n        account={account}\n        fetchAccount={async () => {\n          if (isString) {\n            try {\n              const info = await masto.v1.accounts.lookup({\n                acct: account,\n                skip_webfinger: false,\n              });\n              return info;\n            } catch (e) {\n              const result = await masto.v2.search.list({\n                q: account,\n                type: 'accounts',\n                limit: authenticated ? 1 : 11, // Magic number\n                resolve: authenticated,\n              });\n              if (result.accounts.length) {\n                const accountWithSameString = result.accounts.find(\n                  (a) => a.url === account || account.startsWith(a.url),\n                );\n                if (accountWithSameString) {\n                  return accountWithSameString;\n                }\n              }\n              if (/^https?:\\/\\/[^/]+\\/@[^/]+$/.test(account)) {\n                const accountURL = URL.parse(account);\n                if (accountURL) {\n                  const { hostname, pathname } = accountURL;\n                  const acct =\n                    pathname.replace(/^\\//, '').replace(/\\/$/, '') +\n                    '@' +\n                    hostname;\n                  const result = await masto.v2.search.list({\n                    q: acct,\n                    type: 'accounts',\n                    limit: 1,\n                    resolve: authenticated,\n                  });\n                  if (result.accounts.length) {\n                    return result.accounts[0];\n                  }\n                }\n              }\n            }\n          } else {\n            return account;\n          }\n        }}\n      />\n    </div>\n  );\n}\n\nexport default AccountSheet;\n","import './drafts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useMemo, useReducer, useState } from 'react';\n\nimport { api } from '../utils/api';\nimport db from '../utils/db';\nimport niceDateTime from '../utils/nice-date-time';\nimport states from '../utils/states';\nimport { getCurrentAccountNS } from '../utils/store-utils';\n\nimport Icon from './icon';\nimport Loader from './loader';\nimport MenuConfirm from './menu-confirm';\n\nfunction Drafts({ onClose }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [drafts, setDrafts] = useState([]);\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const keys = await db.drafts.keys();\n        if (keys.length) {\n          const ns = getCurrentAccountNS();\n          const ownKeys = keys.filter((key) => key.startsWith(ns));\n          if (ownKeys.length) {\n            const drafts = await db.drafts.getMany(ownKeys);\n            drafts.sort(\n              (a, b) => Date.parse(b.updatedAt) - Date.parse(a.updatedAt),\n            );\n            setDrafts(drafts);\n          } else {\n            setDrafts([]);\n          }\n        } else {\n          setDrafts([]);\n        }\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  const hasDrafts = drafts?.length > 0;\n\n  return (\n    <div class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Unsent drafts</Trans>{' '}\n          <Loader abrupt hidden={uiState !== 'loading'} />\n        </h2>\n        {hasDrafts && (\n          <div class=\"insignificant\">\n            <Trans>\n              Looks like you have unsent drafts. Let's continue where you left\n              off.\n            </Trans>\n          </div>\n        )}\n      </header>\n      <main>\n        {hasDrafts ? (\n          <>\n            <ul class=\"drafts-list\">\n              {drafts.map((draft) => {\n                const { updatedAt, key, draftStatus, replyTo, quote } = draft;\n                const updatedAtDate = new Date(updatedAt);\n                return (\n                  <li key={updatedAt}>\n                    <div class=\"mini-draft-meta\">\n                      <b>\n                        <Icon icon={replyTo ? 'reply' : 'quill'} size=\"s\" />{' '}\n                        <time>\n                          {!!replyTo && (\n                            <>\n                              <span class=\"bidi-isolate\">\n                                @{replyTo.account.acct}\n                              </span>\n                              <br />\n                            </>\n                          )}\n                          {niceDateTime(updatedAtDate)}\n                        </time>\n                      </b>\n                      <MenuConfirm\n                        confirmLabel={\n                          <span>\n                            <Trans>Delete this draft?</Trans>\n                          </span>\n                        }\n                        menuItemClassName=\"danger\"\n                        align=\"end\"\n                        disabled={uiState === 'loading'}\n                        onClick={() => {\n                          (async () => {\n                            try {\n                              // const yes = confirm('Delete this draft?');\n                              // if (yes) {\n                              await db.drafts.del(key);\n                              reload();\n                              // }\n                            } catch (e) {\n                              alert(t`Error deleting draft! Please try again.`);\n                            }\n                          })();\n                        }}\n                      >\n                        <button\n                          type=\"button\"\n                          class=\"small light\"\n                          disabled={uiState === 'loading'}\n                        >\n                          <Trans>Delete</Trans>\n                        </button>\n                      </MenuConfirm>\n                    </div>\n                    <button\n                      type=\"button\"\n                      disabled={uiState === 'loading'}\n                      class=\"draft-item\"\n                      onClick={async () => {\n                        // console.log({ draftStatus });\n                        let replyToStatus;\n                        let quoteStatus;\n                        if (replyTo?.id || quote?.id) {\n                          setUIState('loading');\n                          if (replyTo) {\n                            try {\n                              replyToStatus = await masto.v1.statuses\n                                .$select(replyTo.id)\n                                .fetch();\n                            } catch (e) {\n                              console.error(e);\n                              alert(t`Error fetching reply-to status!`);\n                              setUIState('default');\n                              return;\n                            }\n                          }\n                          if (quote) {\n                            try {\n                              quoteStatus = await masto.v1.statuses\n                                .$select(quote.id)\n                                .fetch();\n                            } catch (e) {\n                              console.error(e);\n                              alert(t`Error fetching quoted status!`);\n                              setUIState('default');\n                              // Don't return. Fail and still allow draft without quote\n                              // return;\n                            }\n                          }\n                          setUIState('default');\n                        }\n                        window.__COMPOSE__ = {\n                          draftStatus,\n                          replyToStatus,\n                          quoteStatus,\n                        };\n                        states.showCompose = true;\n                        states.showDrafts = false;\n                      }}\n                    >\n                      <MiniDraft draft={draft} />\n                    </button>\n                  </li>\n                );\n              })}\n            </ul>\n            {drafts.length > 1 && (\n              <p>\n                <MenuConfirm\n                  confirmLabel={\n                    <span>\n                      <Trans>Delete all drafts?</Trans>\n                    </span>\n                  }\n                  menuItemClassName=\"danger\"\n                  disabled={uiState === 'loading'}\n                  onClick={() => {\n                    (async () => {\n                      // const yes = confirm('Delete all drafts?');\n                      // if (yes) {\n                      setUIState('loading');\n                      try {\n                        await db.drafts.delMany(\n                          drafts.map((draft) => draft.key),\n                        );\n                        setUIState('default');\n                        reload();\n                      } catch (e) {\n                        console.error(e);\n                        alert(t`Error deleting drafts! Please try again.`);\n                        setUIState('error');\n                      }\n                      // }\n                    })();\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"light danger\"\n                    disabled={uiState === 'loading'}\n                  >\n                    <Trans>Delete all</Trans>\n                  </button>\n                </MenuConfirm>\n              </p>\n            )}\n          </>\n        ) : (\n          <p>\n            <Trans>No drafts found.</Trans>\n          </p>\n        )}\n      </main>\n    </div>\n  );\n}\n\nfunction MiniDraft({ draft }) {\n  const { t } = useLingui();\n  const { draftStatus, replyTo, quote } = draft;\n  const { status, spoilerText, poll, mediaAttachments } = draftStatus;\n  const hasPoll = poll?.options?.length > 0;\n  const hasMedia = mediaAttachments?.length > 0;\n  const hasQuote = !!quote?.id;\n  const hasPollOrMedia = hasPoll || hasMedia || hasQuote;\n  const firstImageMedia = useMemo(() => {\n    if (!hasMedia) return;\n    const image = mediaAttachments.find((media) => /image/.test(media.type));\n    if (!image) return;\n    const { file } = image;\n    const objectURL = URL.createObjectURL(file);\n    return objectURL;\n  }, [hasMedia, mediaAttachments]);\n  return (\n    <>\n      <div class=\"mini-draft\">\n        {hasPollOrMedia && (\n          <div\n            class={`mini-draft-aside ${firstImageMedia ? 'has-image' : ''}`}\n            style={\n              firstImageMedia\n                ? {\n                    '--bg-image': `url(${firstImageMedia})`,\n                  }\n                : {}\n            }\n          >\n            {hasPoll && <Icon icon=\"poll\" alt={t`Poll`} />}\n            {hasMedia && (\n              <span>\n                <Icon icon=\"attachment\" alt={t`Media`} />{' '}\n                <small>{mediaAttachments?.length}</small>\n              </span>\n            )}\n            {hasQuote && <Icon icon=\"quote\" alt={t`Quote`} />}\n          </div>\n        )}\n        <div class=\"mini-draft-main\">\n          {!!spoilerText && <div class=\"mini-draft-spoiler\">{spoilerText}</div>}\n          {!!status && <div class=\"mini-draft-status\">{status}</div>}\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default Drafts;\n","import './embed-modal.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\n\nimport Icon from './icon';\n\nfunction EmbedModal({ html, url, width, height, onClose = () => {} }) {\n  const { t } = useLingui();\n  return (\n    <div class=\"embed-modal-container\">\n      <div class=\"top-controls\">\n        <button type=\"button\" class=\"light\" onClick={() => onClose()}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n        {url && (\n          <a href={url} target=\"_blank\" rel=\"noopener\" class=\"button plain\">\n            <span>\n              <Trans>Open in new window</Trans>\n            </span>{' '}\n            <Icon icon=\"external\" />\n          </a>\n        )}\n      </div>\n      <div\n        class=\"embed-content\"\n        dangerouslySetInnerHTML={{ __html: html }}\n        style={{\n          '--width': width + 'px',\n          '--height': height + 'px',\n          '--aspect-ratio': `${width}/${height}`,\n        }}\n      />\n    </div>\n  );\n}\n\nexport default EmbedModal;\n","import './generic-accounts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { InView } from 'react-intersection-observer';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport { fetchRelationships } from '../utils/relationships';\nimport states from '../utils/states';\nimport useLocationChange from '../utils/useLocationChange';\n\nimport AccountBlock from './account-block';\nimport Icon from './icon';\nimport Link from './link';\nimport Loader from './loader';\nimport Status from './status';\n\nexport default function GenericAccounts({\n  instance,\n  excludeRelationshipAttrs = [],\n  postID,\n  onClose = () => {},\n  blankCopy,\n}) {\n  const { t } = useLingui();\n  const { masto, instance: currentInstance } = api();\n  const isCurrentInstance = instance ? instance === currentInstance : true;\n  const snapStates = useSnapshot(states);\n  ``;\n  const [uiState, setUIState] = useState('default');\n  const [showMore, setShowMore] = useState(false);\n\n  useLocationChange(onClose);\n\n  if (!snapStates.showGenericAccounts) {\n    return null;\n  }\n\n  const {\n    id,\n    heading,\n    fetchAccounts,\n    accounts: staticAccounts,\n    showReactions,\n  } = snapStates.showGenericAccounts;\n\n  const [accounts, setAccounts] = useState(\n    staticAccounts?.length ? staticAccounts : [],\n  );\n\n  const [relationshipsMap, setRelationshipsMap] = useState({});\n\n  const loadRelationships = async (accounts) => {\n    if (!accounts?.length) return;\n    if (!isCurrentInstance) return;\n    const relationships = await fetchRelationships(accounts, relationshipsMap);\n    if (relationships) {\n      setRelationshipsMap({\n        ...relationshipsMap,\n        ...relationships,\n      });\n    }\n  };\n\n  const loadAccounts = (firstLoad) => {\n    if (!fetchAccounts) return;\n    if (firstLoad && !accounts?.length) setAccounts([]);\n    setUIState('loading');\n    (async () => {\n      try {\n        const { done, value } = await fetchAccounts(firstLoad);\n        if (Array.isArray(value)) {\n          if (firstLoad) {\n            const accounts = [];\n            for (let i = 0; i < value.length; i++) {\n              const account = value[i];\n              const theAccount = accounts.find(\n                (a, j) => a.id === account.id && i !== j,\n              );\n              if (!theAccount) {\n                accounts.push({\n                  _types: [],\n                  ...account,\n                });\n              } else {\n                theAccount._types.push(...account._types);\n              }\n            }\n            setAccounts(accounts);\n          } else {\n            // setAccounts((prev) => [...prev, ...value]);\n            // Merge accounts by id and _types\n            setAccounts((prev) => {\n              const newAccounts = prev;\n              for (const account of value) {\n                const theAccount = newAccounts.find((a) => a.id === account.id);\n                if (!theAccount) {\n                  newAccounts.push(account);\n                } else {\n                  theAccount._types.push(...account._types);\n                }\n              }\n              return newAccounts;\n            });\n          }\n          setShowMore(!done);\n\n          loadRelationships(value);\n        } else {\n          setShowMore(false);\n        }\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  };\n\n  const firstLoad = useRef(true);\n  useEffect(() => {\n    if (accounts?.length > 0) {\n      // setAccounts(staticAccounts);\n      if (fetchAccounts) {\n        loadAccounts(true);\n        firstLoad.current = false;\n      } else {\n        loadRelationships(accounts);\n      }\n    } else {\n      loadAccounts(true);\n      firstLoad.current = false;\n    }\n  }, [fetchAccounts]);\n\n  useEffect(() => {\n    if (firstLoad.current) return;\n    // reloadGenericAccounts contains value like {id: 'mute', counter: 1}\n    // We only need to reload if the id matches\n    if (snapStates.reloadGenericAccounts?.id === id) {\n      loadAccounts(true);\n    }\n  }, [snapStates.reloadGenericAccounts.counter]);\n\n  const post = states.statuses[postID];\n\n  return (\n    <div id=\"generic-accounts-container\" class=\"sheet\" tabindex=\"-1\">\n      <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n        <Icon icon=\"x\" alt={t`Close`} />\n      </button>\n      <header>\n        <h2>{heading || t`Accounts`}</h2>\n      </header>\n      <main>\n        {post && (\n          <Link\n            to={`/${instance || currentInstance}/s/${post.id}`}\n            class=\"post-preview\"\n          >\n            <Status status={post} size=\"s\" readOnly />\n          </Link>\n        )}\n        {accounts.length > 0 ? (\n          <>\n            <ul class=\"accounts-list\">\n              {accounts.map((account) => {\n                const relationship = relationshipsMap[account.id];\n                const key = `${account.id}-${account._types?.length || ''}`;\n                return (\n                  <li key={key}>\n                    {showReactions && account._types?.length > 0 && (\n                      <div class=\"reactions-block\">\n                        {account._types.map((type) => (\n                          <Icon\n                            icon={\n                              {\n                                reblog: 'rocket',\n                                favourite: 'heart',\n                              }[type]\n                            }\n                            class={`${type}-icon`}\n                          />\n                        ))}\n                      </div>\n                    )}\n                    <div class=\"account-relationships\">\n                      <AccountBlock\n                        account={account}\n                        showStats\n                        relationship={relationship}\n                        excludeRelationshipAttrs={excludeRelationshipAttrs}\n                      />\n                    </div>\n                  </li>\n                );\n              })}\n            </ul>\n            {uiState === 'default' ? (\n              showMore ? (\n                <InView\n                  onChange={(inView) => {\n                    if (inView) {\n                      loadAccounts();\n                    }\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"plain block\"\n                    onClick={() => loadAccounts()}\n                  >\n                    <Trans>Show more</Trans>\n                  </button>\n                </InView>\n              ) : (\n                <p class=\"ui-state insignificant\">\n                  <Trans>The end.</Trans>\n                </p>\n              )\n            ) : (\n              uiState === 'loading' && (\n                <p class=\"ui-state\">\n                  <Loader abrupt />\n                </p>\n              )\n            )}\n          </>\n        ) : uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : uiState === 'error' ? (\n          <p class=\"ui-state\">\n            <Trans>Error loading accounts</Trans>\n          </p>\n        ) : (\n          <p class=\"ui-state insignificant\">\n            {blankCopy || t`Nothing to show`}\n          </p>\n        )}\n      </main>\n    </div>\n  );\n}\n","import './import-accounts-selection.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useMemo, useState } from 'preact/hooks';\n\nimport states from '../utils/states';\nimport { getAccounts, saveAccounts } from '../utils/store-utils';\n\nimport Avatar from './avatar';\nimport Icon from './icon';\nimport Loader from './loader';\nimport NameText from './name-text';\n\nfunction ImportAccountsSelection({ accounts: importedAccounts, onClose }) {\n  const { t } = useLingui();\n  const existingAccounts = getAccounts();\n\n  const { accountsToImport } = useMemo(() => {\n    if (!importedAccounts) return { accountsToImport: [] };\n\n    const statusOrder = { duplicate: 0, new: 1 };\n    const accountsToImport = importedAccounts\n      .map((account) => {\n        const existing = existingAccounts.find(\n          (a) =>\n            a.info.id === account.info.id &&\n            a.instanceURL === account.instanceURL,\n        );\n        const status = existing ? 'duplicate' : 'new';\n        return {\n          ...account,\n          __status: status,\n        };\n      })\n      .sort((a, b) => {\n        return statusOrder[a.__status] - statusOrder[b.__status];\n      });\n\n    return { accountsToImport };\n  }, [importedAccounts, existingAccounts]);\n\n  const [selectedAccounts, setSelectedAccounts] = useState(() => {\n    const initialSelection = {};\n    accountsToImport.forEach((a) => {\n      if (a.__status === 'duplicate') {\n        initialSelection[a.info.id + a.instanceURL] = false;\n      } else {\n        initialSelection[a.info.id + a.instanceURL] = true;\n      }\n    });\n    return initialSelection;\n  });\n\n  const [uiState, setUIState] = useState('default');\n\n  const handleImportSelection = () => {\n    setUIState('importing');\n    const newAccounts = [\n      ...existingAccounts,\n      ...importedAccounts.filter(\n        (account) => selectedAccounts[account.info.id + account.instanceURL],\n      ),\n    ];\n    saveAccounts(newAccounts);\n    onClose();\n    states.showImportExportAccounts = false;\n    states.showAccounts = true;\n  };\n\n  const selectedCount = Object.values(selectedAccounts).filter(Boolean).length;\n\n  return (\n    <div id=\"import-accounts-selection-container\" class=\"sheet\">\n      {!!onClose && (\n        <button\n          type=\"button\"\n          class=\"sheet-close\"\n          onClick={onClose}\n          disabled={uiState === 'importing'}\n        >\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <b>\n          <Trans>Select accounts to import</Trans>\n        </b>\n      </header>\n      <main>\n        <div class=\"import-selection\">\n          {accountsToImport.filter((a) => a.__status !== 'duplicate').length >\n            3 && (\n            <div class=\"accounts-list-header\">\n              <label class=\"account-item\">\n                <input\n                  type=\"checkbox\"\n                  checked={\n                    accountsToImport.filter((a) => a.__status !== 'duplicate')\n                      .length > 0 &&\n                    accountsToImport\n                      .filter((a) => a.__status !== 'duplicate')\n                      .every((a) => selectedAccounts[a.info.id + a.instanceURL])\n                  }\n                  onChange={(e) => {\n                    const newSelection = { ...selectedAccounts };\n                    const shouldSelect = e.target.checked;\n                    accountsToImport.forEach((a) => {\n                      if (a.__status !== 'duplicate') {\n                        newSelection[a.info.id + a.instanceURL] = shouldSelect;\n                      }\n                    });\n                    setSelectedAccounts(newSelection);\n                  }}\n                  disabled={uiState === 'importing'}\n                />\n                <span class=\"account-info\">\n                  <Trans>Select all</Trans>\n                </span>\n              </label>\n            </div>\n          )}\n          <ul class=\"accounts-list\">\n            {accountsToImport.map((account) => {\n              const key = account.info.id + account.instanceURL;\n              const isSelected = selectedAccounts[key];\n              const { __status: status } = account;\n              return (\n                <li key={key}>\n                  <label class=\"account-item\">\n                    <input\n                      type=\"checkbox\"\n                      checked={isSelected}\n                      onChange={(e) => {\n                        setSelectedAccounts({\n                          ...selectedAccounts,\n                          [key]: e.target.checked,\n                        });\n                      }}\n                      disabled={\n                        uiState === 'importing' || status === 'duplicate'\n                      }\n                    />\n                    <Avatar url={account.info.avatarStatic} size=\"xl\" />\n                    <div class=\"account-info\">\n                      <NameText\n                        account={{\n                          ...account.info,\n                          acct: /@/.test(account.info.acct)\n                            ? account.info.acct\n                            : `${account.info.acct}@${account.instanceURL}`,\n                        }}\n                        showAcct\n                      />\n                    </div>\n                    <div class=\"account-meta\">\n                      {status === 'duplicate' && (\n                        <span class=\"tag collapsed\">\n                          <Trans>Existing</Trans>\n                        </span>\n                      )}\n                    </div>\n                  </label>\n                </li>\n              );\n            })}\n          </ul>\n\n          <footer>\n            <button\n              type=\"button\"\n              class=\"light\"\n              onClick={onClose}\n              disabled={uiState === 'importing'}\n            >\n              <Trans>Cancel</Trans>\n            </button>\n            <Loader hidden={uiState !== 'importing'} />\n            <button\n              type=\"button\"\n              disabled={selectedCount === 0 || uiState === 'importing'}\n              onClick={handleImportSelection}\n            >\n              <Plural\n                value={selectedCount}\n                one=\"Import # account\"\n                other=\"Import # accounts\"\n              />\n            </button>\n          </footer>\n        </div>\n      </main>\n    </div>\n  );\n}\n\nexport default ImportAccountsSelection;\n","import './import-export-accounts.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useState } from 'preact/hooks';\n\nimport showToast from '../utils/show-toast';\nimport { getAccounts } from '../utils/store-utils';\n\nimport Icon from './icon';\nimport ImportAccountsSelection from './import-accounts-selection';\nimport Modal from './modal';\n\nexport default function ImportExportAccounts({ onClose }) {\n  const { t } = useLingui();\n  const accounts = getAccounts();\n  const [uiState, setUIState] = useState('default');\n  const [importedAccounts, setImportedAccounts] = useState(null);\n  const [dragOver, setDragOver] = useState(false);\n\n  const handleExport = async () => {\n    setUIState('exporting');\n    try {\n      const accounts = getAccounts();\n      const accountsToExport = accounts.map((account) => {\n        const { accessToken, ...rest } = account;\n        return rest;\n      });\n\n      const exportData = {\n        accounts: accountsToExport,\n        createdAt: Date.now(),\n      };\n      const json = JSON.stringify(exportData);\n\n      const blob = new Blob([json], { type: 'application/json' });\n      const url = URL.createObjectURL(blob);\n      const a = document.createElement('a');\n      a.href = url;\n      const now = new Date();\n      const date = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(\n        2,\n        '0',\n      )}-${String(now.getDate()).padStart(2, '0')}_${String(\n        now.getHours(),\n      ).padStart(2, '0')}-${String(now.getMinutes()).padStart(2, '0')}`;\n      a.download = `accounts-${date}.phanpy.json`;\n      a.click();\n      URL.revokeObjectURL(url);\n      onClose();\n    } catch (e) {\n      console.error(e);\n      showToast(t`Export failed`);\n      setUIState('error');\n    }\n  };\n\n  const processFile = async (file) => {\n    if (!file) return;\n\n    setUIState('importing');\n    try {\n      const text = await file.text();\n      const json = JSON.parse(text);\n\n      const accounts = json?.accounts;\n      if (!Array.isArray(accounts)) throw new Error('Invalid backup file');\n\n      setImportedAccounts(accounts);\n      setUIState('default');\n    } catch (e) {\n      console.error(e);\n      showToast(t`Import failed`);\n      setUIState('error');\n    }\n  };\n\n  const handleImport = (e) => {\n    const file = e.target.files[0];\n    processFile(file);\n  };\n\n  const onDragOver = (e) => {\n    e.preventDefault();\n    setDragOver(true);\n  };\n\n  const onDragLeave = () => {\n    setDragOver(false);\n  };\n\n  const onDrop = (e) => {\n    e.preventDefault();\n    setDragOver(false);\n    const file = e.dataTransfer.files[0];\n    processFile(file);\n  };\n\n  return (\n    <div\n      id=\"import-export-accounts-container\"\n      class=\"sheet\"\n      onDragOver={onDragOver}\n      onDragLeave={onDragLeave}\n      onDrop={onDrop}\n    >\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>\n            Import/Export <small class=\"ib insignificant\">Accounts</small>\n          </Trans>\n        </h2>\n      </header>\n      <main>\n        <section>\n          <label\n            class={`section-button button-import button plain4 ${\n              dragOver ? 'drag-over' : ''\n            }`}\n            tabindex=\"0\"\n          >\n            <Icon icon=\"arrow-down-circle\" size=\"xxl\" />\n            <b>\n              <Trans>Import</Trans>\n            </b>\n            <input\n              type=\"file\"\n              accept=\".json\"\n              onChange={handleImport}\n              disabled={uiState === 'importing'}\n              style={{ display: 'none' }}\n            />\n            <div>\n              <small class=\"insignificant\">\n                <Trans>Select file</Trans>\n              </small>\n            </div>\n          </label>{' '}\n          <button\n            type=\"button\"\n            class=\"section-button button-export plain4\"\n            onClick={handleExport}\n            disabled={uiState === 'exporting' || accounts.length === 0}\n          >\n            <Icon icon=\"arrow-up-circle\" size=\"xxl\" />\n            <b>\n              <Trans>Export</Trans>\n            </b>\n            <div>\n              <small class=\"insignificant\">\n                <Plural\n                  value={accounts.length}\n                  one=\"# account\"\n                  other=\"# accounts\"\n                />\n              </small>\n            </div>\n          </button>\n        </section>\n\n        <p class=\"insignificant\">\n          <small>\n            <Trans>\n              No login information or account access details are stored in the\n              exported files. You will need to log in again for each account\n              after importing.\n            </Trans>\n          </small>\n        </p>\n      </main>\n      {importedAccounts && (\n        <Modal\n          onClose={() => {\n            setImportedAccounts(null);\n          }}\n        >\n          <ImportAccountsSelection\n            accounts={importedAccounts}\n            onClose={() => {\n              setImportedAccounts(null);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { Menu, MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport localeMatch from '../utils/locale-match';\nimport { speak, supportsTTS } from '../utils/speech';\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Menu2 from './menu2';\nimport TranslationBlock from './translation-block';\n\nconst FORCE_TRANSLATE_LIMIT = 140;\n\nexport default function MediaAltModal({ alt, lang, onClose }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const [forceTranslate, setForceTranslate] = useState(false);\n  const targetLanguage = getTranslateTargetLanguage(true);\n  const contentTranslationHideLanguages =\n    snapStates.settings.contentTranslationHideLanguages || [];\n  const differentLanguage =\n    !!lang &&\n    lang !== targetLanguage &&\n    !localeMatch([lang], [targetLanguage]) &&\n    !contentTranslationHideLanguages.find(\n      (l) => lang === l || localeMatch([lang], [l]),\n    );\n\n  useEffect(() => {\n    const isShortAlt = alt?.length > 0 && alt?.length <= FORCE_TRANSLATE_LIMIT;\n    if (differentLanguage && isShortAlt) {\n      setForceTranslate(true);\n    }\n  }, [differentLanguage, alt]);\n\n  return (\n    <div class=\"sheet\" tabindex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close outer\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header class=\"header-grid\">\n        <h2>\n          <Trans>Media description</Trans>\n        </h2>\n        <div class=\"header-side\">\n          <Menu2\n            align=\"end\"\n            menuButton={\n              <button type=\"button\" class=\"plain4\">\n                <Icon icon=\"more\" alt={t`More`} size=\"xl\" />\n              </button>\n            }\n          >\n            <MenuItem\n              disabled={forceTranslate}\n              onClick={() => {\n                setForceTranslate(true);\n              }}\n            >\n              <Icon icon=\"translate\" />\n              <span>\n                <Trans>Translate</Trans>\n              </span>\n            </MenuItem>\n            {supportsTTS && (\n              <MenuItem\n                onClick={() => {\n                  speak(alt, lang);\n                }}\n              >\n                <Icon icon=\"speak\" />\n                <span>\n                  <Trans>Speak</Trans>\n                </span>\n              </MenuItem>\n            )}\n          </Menu2>\n        </div>\n      </header>\n      <main lang={lang} dir=\"auto\">\n        <p\n          style={{\n            whiteSpace: 'pre-wrap',\n            textWrap: 'pretty',\n          }}\n        >\n          {alt}\n        </p>\n        {(differentLanguage || forceTranslate) && (\n          <TranslationBlock\n            forceTranslate={forceTranslate}\n            sourceLanguage={lang}\n            text={alt}\n          />\n        )}\n      </main>\n    </div>\n  );\n}\n","const { min, max } = Math;\n\nexport default (x, low = 0, high = 1) => {\n    return min(max(low, x), high);\n};\n","// ported from jQuery's $.type\nconst classToType = {};\nfor (let name of [\n    'Boolean',\n    'Number',\n    'String',\n    'Function',\n    'Array',\n    'Date',\n    'RegExp',\n    'Undefined',\n    'Null'\n]) {\n    classToType[`[object ${name}]`] = name.toLowerCase();\n}\nexport default function (obj) {\n    return classToType[Object.prototype.toString.call(obj)] || 'object';\n}\n","import type from './type.js';\n\nexport default (args, keyOrder = null) => {\n    // if called with more than 3 arguments, we return the arguments\n    if (args.length >= 3) return Array.prototype.slice.call(args);\n    // with less than 3 args we check if first arg is object\n    // and use the keyOrder string to extract and sort properties\n    if (type(args[0]) == 'object' && keyOrder) {\n        return keyOrder\n            .split('')\n            .filter((k) => args[0][k] !== undefined)\n            .map((k) => args[0][k]);\n    }\n    // otherwise we just return the first argument\n    // (which we suppose is an array of args)\n    return args[0].slice(0);\n};\n","const { PI, min, max } = Math;\n\nconst rnd2 = (a) => Math.round(a * 100) / 100;\nconst rnd3 = (a) => Math.round(a * 100) / 100;\n\nexport { default as clip_rgb } from './clip_rgb.js';\nexport { default as limit } from './limit.js';\nexport { default as type } from './type.js';\nexport { default as unpack } from './unpack.js';\nexport { default as last } from './last.js';\n\nconst TWOPI = PI * 2;\nconst PITHIRD = PI / 3;\nconst DEG2RAD = PI / 180;\nconst RAD2DEG = 180 / PI;\n\n/**\n * Reverse the first three elements of an array\n *\n * @param {any[]} arr\n * @returns {any[]}\n */\nfunction reverse3(arr) {\n    return [...arr.slice(0, 3).reverse(), ...arr.slice(3)];\n}\n\nexport { PI, TWOPI, PITHIRD, DEG2RAD, RAD2DEG, min, max, rnd2, rnd3, reverse3 };\n","// from https://www.w3.org/TR/css-color-4/multiply-matrices.js\nexport default function multiplyMatrices(A, B) {\n    let m = A.length;\n\n    if (!Array.isArray(A[0])) {\n        // A is vector, convert to [[a, b, c, ...]]\n        A = [A];\n    }\n\n    if (!Array.isArray(B[0])) {\n        // B is vector, convert to [[a], [b], [c], ...]]\n        B = B.map((x) => [x]);\n    }\n\n    let p = B[0].length;\n    let B_cols = B[0].map((_, i) => B.map((x) => x[i])); // transpose B\n    let product = A.map((row) =>\n        B_cols.map((col) => {\n            if (!Array.isArray(row)) {\n                return col.reduce((a, c) => a + c * row, 0);\n            }\n\n            return row.reduce((a, c, i) => a + c * (col[i] || 0), 0);\n        })\n    );\n\n    if (m === 1) {\n        product = product[0]; // Avoid [[a, b, c, ...]]\n    }\n\n    if (p === 1) {\n        return product.map((x) => x[0]); // Avoid [[a], [b], [c], ...]]\n    }\n\n    return product;\n}\n","const labConstants = {\n    // Corresponds roughly to RGB brighter/darker\n    Kn: 18,\n\n    // D65 standard referent\n    labWhitePoint: 'd65',\n    Xn: 0.95047,\n    Yn: 1,\n    Zn: 1.08883,\n\n    t0: 0.137931034, // 4 / 29\n    t1: 0.206896552, // 6 / 29\n    t2: 0.12841855, // 3 * t1 * t1\n    t3: 0.008856452, // t1 * t1 * t1,\n\n    kE: 216.0 / 24389.0,\n    kKE: 8.0,\n    kK: 24389.0 / 27.0,\n\n    RefWhiteRGB: {\n        // sRGB\n        X: 0.95047,\n        Y: 1,\n        Z: 1.08883\n    },\n\n    MtxRGB2XYZ: {\n        m00: 0.4124564390896922,\n        m01: 0.21267285140562253,\n        m02: 0.0193338955823293,\n        m10: 0.357576077643909,\n        m11: 0.715152155287818,\n        m12: 0.11919202588130297,\n        m20: 0.18043748326639894,\n        m21: 0.07217499330655958,\n        m22: 0.9503040785363679\n    },\n\n    MtxXYZ2RGB: {\n        m00: 3.2404541621141045,\n        m01: -0.9692660305051868,\n        m02: 0.055643430959114726,\n        m10: -1.5371385127977166,\n        m11: 1.8760108454466942,\n        m12: -0.2040259135167538,\n        m20: -0.498531409556016,\n        m21: 0.041556017530349834,\n        m22: 1.0572251882231791\n    },\n\n    // used in rgb2xyz\n    As: 0.9414285350000001,\n    Bs: 1.040417467,\n    Cs: 1.089532651,\n\n    MtxAdaptMa: {\n        m00: 0.8951,\n        m01: -0.7502,\n        m02: 0.0389,\n        m10: 0.2664,\n        m11: 1.7135,\n        m12: -0.0685,\n        m20: -0.1614,\n        m21: 0.0367,\n        m22: 1.0296\n    },\n\n    MtxAdaptMaI: {\n        m00: 0.9869929054667123,\n        m01: 0.43230526972339456,\n        m02: -0.008528664575177328,\n        m10: -0.14705425642099013,\n        m11: 0.5183602715367776,\n        m12: 0.04004282165408487,\n        m20: 0.15996265166373125,\n        m21: 0.0492912282128556,\n        m22: 0.9684866957875502\n    }\n};\n\nexport default labConstants;\n\n// taken from https://de.mathworks.com/help/images/ref/whitepoint.html\nconst ILLUMINANTS = new Map([\n    // ASTM E308-01\n    ['a', [1.0985, 0.35585]],\n    // Wyszecki & Stiles, p. 769\n    ['b', [1.0985, 0.35585]],\n    // C ASTM E308-01\n    ['c', [0.98074, 1.18232]],\n    // D50 (ASTM E308-01)\n    ['d50', [0.96422, 0.82521]],\n    // D55 (ASTM E308-01)\n    ['d55', [0.95682, 0.92149]],\n    // D65 (ASTM E308-01)\n    ['d65', [0.95047, 1.08883]],\n    // E (ASTM E308-01)\n    ['e', [1, 1, 1]],\n    // F2 (ASTM E308-01)\n    ['f2', [0.99186, 0.67393]],\n    // F7 (ASTM E308-01)\n    ['f7', [0.95041, 1.08747]],\n    // F11 (ASTM E308-01)\n    ['f11', [1.00962, 0.6435]],\n    ['icc', [0.96422, 0.82521]]\n]);\n\nexport function setLabWhitePoint(name) {\n    const ill = ILLUMINANTS.get(String(name).toLowerCase());\n    if (!ill) {\n        throw new Error('unknown Lab illuminant ' + name);\n    }\n    labConstants.labWhitePoint = name;\n    labConstants.Xn = ill[0];\n    labConstants.Zn = ill[1];\n}\n\nexport function getLabWhitePoint() {\n    return labConstants.labWhitePoint;\n}\n","import LAB_CONSTANTS from './lab-constants.js';\nimport { unpack } from '../../utils/index.js';\n\n/*\n * L* [0..100]\n * a [-100..100]\n * b [-100..100]\n */\nconst lab2rgb = (...args) => {\n    args = unpack(args, 'lab');\n    const [L, a, b] = args;\n    const [x, y, z] = lab2xyz(L, a, b);\n    const [r, g, b_] = xyz2rgb(x, y, z);\n    return [r, g, b_, args.length > 3 ? args[3] : 1];\n};\n\nconst lab2xyz = (L, a, b) => {\n    const { kE, kK, kKE, Xn, Yn, Zn } = LAB_CONSTANTS;\n\n    const fy = (L + 16.0) / 116.0;\n    const fx = 0.002 * a + fy;\n    const fz = fy - 0.005 * b;\n\n    const fx3 = fx * fx * fx;\n    const fz3 = fz * fz * fz;\n\n    const xr = fx3 > kE ? fx3 : (116.0 * fx - 16.0) / kK;\n    const yr = L > kKE ? Math.pow((L + 16.0) / 116.0, 3.0) : L / kK;\n    const zr = fz3 > kE ? fz3 : (116.0 * fz - 16.0) / kK;\n\n    const x = xr * Xn;\n    const y = yr * Yn;\n    const z = zr * Zn;\n\n    return [x, y, z];\n};\n\nconst compand = (linear) => {\n    /* sRGB */\n    const sign = Math.sign(linear);\n    linear = Math.abs(linear);\n    return (\n        (linear <= 0.0031308\n            ? linear * 12.92\n            : 1.055 * Math.pow(linear, 1.0 / 2.4) - 0.055) * sign\n    );\n};\n\nconst xyz2rgb = (x, y, z) => {\n    const { MtxAdaptMa, MtxAdaptMaI, MtxXYZ2RGB, RefWhiteRGB, Xn, Yn, Zn } =\n        LAB_CONSTANTS;\n\n    const As = Xn * MtxAdaptMa.m00 + Yn * MtxAdaptMa.m10 + Zn * MtxAdaptMa.m20;\n    const Bs = Xn * MtxAdaptMa.m01 + Yn * MtxAdaptMa.m11 + Zn * MtxAdaptMa.m21;\n    const Cs = Xn * MtxAdaptMa.m02 + Yn * MtxAdaptMa.m12 + Zn * MtxAdaptMa.m22;\n\n    const Ad =\n        RefWhiteRGB.X * MtxAdaptMa.m00 +\n        RefWhiteRGB.Y * MtxAdaptMa.m10 +\n        RefWhiteRGB.Z * MtxAdaptMa.m20;\n    const Bd =\n        RefWhiteRGB.X * MtxAdaptMa.m01 +\n        RefWhiteRGB.Y * MtxAdaptMa.m11 +\n        RefWhiteRGB.Z * MtxAdaptMa.m21;\n    const Cd =\n        RefWhiteRGB.X * MtxAdaptMa.m02 +\n        RefWhiteRGB.Y * MtxAdaptMa.m12 +\n        RefWhiteRGB.Z * MtxAdaptMa.m22;\n\n    const X1 =\n        (x * MtxAdaptMa.m00 + y * MtxAdaptMa.m10 + z * MtxAdaptMa.m20) *\n        (Ad / As);\n    const Y1 =\n        (x * MtxAdaptMa.m01 + y * MtxAdaptMa.m11 + z * MtxAdaptMa.m21) *\n        (Bd / Bs);\n    const Z1 =\n        (x * MtxAdaptMa.m02 + y * MtxAdaptMa.m12 + z * MtxAdaptMa.m22) *\n        (Cd / Cs);\n\n    const X2 =\n        X1 * MtxAdaptMaI.m00 + Y1 * MtxAdaptMaI.m10 + Z1 * MtxAdaptMaI.m20;\n    const Y2 =\n        X1 * MtxAdaptMaI.m01 + Y1 * MtxAdaptMaI.m11 + Z1 * MtxAdaptMaI.m21;\n    const Z2 =\n        X1 * MtxAdaptMaI.m02 + Y1 * MtxAdaptMaI.m12 + Z1 * MtxAdaptMaI.m22;\n\n    const r = compand(\n        X2 * MtxXYZ2RGB.m00 + Y2 * MtxXYZ2RGB.m10 + Z2 * MtxXYZ2RGB.m20\n    );\n    const g = compand(\n        X2 * MtxXYZ2RGB.m01 + Y2 * MtxXYZ2RGB.m11 + Z2 * MtxXYZ2RGB.m21\n    );\n    const b = compand(\n        X2 * MtxXYZ2RGB.m02 + Y2 * MtxXYZ2RGB.m12 + Z2 * MtxXYZ2RGB.m22\n    );\n\n    return [r * 255, g * 255, b * 255];\n};\n\nexport default lab2rgb;\nexport { xyz2rgb };\n","import { unpack } from '../../utils/index.js';\nimport multiplyMatrices from '../../utils/multiply-matrices.js';\nimport { xyz2rgb } from '../lab/lab2rgb.js';\n\nconst oklab2rgb = (...args) => {\n    args = unpack(args, 'lab');\n    const [L, a, b, ...rest] = args;\n    const [X, Y, Z] = OKLab_to_XYZ([L, a, b]);\n    const [r, g, b_] = xyz2rgb(X, Y, Z);\n    return [r, g, b_, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\n// from https://www.w3.org/TR/css-color-4/#color-conversion-code\nfunction OKLab_to_XYZ(OKLab) {\n    // Given OKLab, convert to XYZ relative to D65\n    var LMStoXYZ = [\n        [1.2268798758459243, -0.5578149944602171, 0.2813910456659647],\n        [-0.0405757452148008, 1.112286803280317, -0.0717110580655164],\n        [-0.0763729366746601, -0.4214933324022432, 1.5869240198367816]\n    ];\n    var OKLabtoLMS = [\n        [1.0, 0.3963377773761749, 0.2158037573099136],\n        [1.0, -0.1055613458156586, -0.0638541728258133],\n        [1.0, -0.0894841775298119, -1.2914855480194092]\n    ];\n\n    var LMSnl = multiplyMatrices(OKLabtoLMS, OKLab);\n    return multiplyMatrices(\n        LMStoXYZ,\n        LMSnl.map((c) => c ** 3)\n    );\n}\n\nexport default oklab2rgb;\n","import LAB_CONSTANTS from './lab-constants.js';\nimport { unpack } from '../../utils/index.js';\n\nconst rgb2lab = (...args) => {\n    const [r, g, b, ...rest] = unpack(args, 'rgb');\n    const [x, y, z] = rgb2xyz(r, g, b);\n    const [L, a, b_] = xyz2lab(x, y, z);\n    return [L, a, b_, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\nfunction xyz2lab(x, y, z) {\n    const { Xn, Yn, Zn, kE, kK } = LAB_CONSTANTS;\n    const xr = x / Xn;\n    const yr = y / Yn;\n    const zr = z / Zn;\n\n    const fx = xr > kE ? Math.pow(xr, 1.0 / 3.0) : (kK * xr + 16.0) / 116.0;\n    const fy = yr > kE ? Math.pow(yr, 1.0 / 3.0) : (kK * yr + 16.0) / 116.0;\n    const fz = zr > kE ? Math.pow(zr, 1.0 / 3.0) : (kK * zr + 16.0) / 116.0;\n\n    return [116.0 * fy - 16.0, 500.0 * (fx - fy), 200.0 * (fy - fz)];\n}\n\nfunction gammaAdjustSRGB(companded) {\n    const sign = Math.sign(companded);\n    companded = Math.abs(companded);\n    const linear =\n        companded <= 0.04045\n            ? companded / 12.92\n            : Math.pow((companded + 0.055) / 1.055, 2.4);\n    return linear * sign;\n}\n\nconst rgb2xyz = (r, g, b) => {\n    // normalize and gamma adjust\n    r = gammaAdjustSRGB(r / 255);\n    g = gammaAdjustSRGB(g / 255);\n    b = gammaAdjustSRGB(b / 255);\n\n    const { MtxRGB2XYZ, MtxAdaptMa, MtxAdaptMaI, Xn, Yn, Zn, As, Bs, Cs } =\n        LAB_CONSTANTS;\n\n    let x = r * MtxRGB2XYZ.m00 + g * MtxRGB2XYZ.m10 + b * MtxRGB2XYZ.m20;\n    let y = r * MtxRGB2XYZ.m01 + g * MtxRGB2XYZ.m11 + b * MtxRGB2XYZ.m21;\n    let z = r * MtxRGB2XYZ.m02 + g * MtxRGB2XYZ.m12 + b * MtxRGB2XYZ.m22;\n\n    const Ad = Xn * MtxAdaptMa.m00 + Yn * MtxAdaptMa.m10 + Zn * MtxAdaptMa.m20;\n    const Bd = Xn * MtxAdaptMa.m01 + Yn * MtxAdaptMa.m11 + Zn * MtxAdaptMa.m21;\n    const Cd = Xn * MtxAdaptMa.m02 + Yn * MtxAdaptMa.m12 + Zn * MtxAdaptMa.m22;\n\n    let X = x * MtxAdaptMa.m00 + y * MtxAdaptMa.m10 + z * MtxAdaptMa.m20;\n    let Y = x * MtxAdaptMa.m01 + y * MtxAdaptMa.m11 + z * MtxAdaptMa.m21;\n    let Z = x * MtxAdaptMa.m02 + y * MtxAdaptMa.m12 + z * MtxAdaptMa.m22;\n\n    X *= Ad / As;\n    Y *= Bd / Bs;\n    Z *= Cd / Cs;\n\n    x = X * MtxAdaptMaI.m00 + Y * MtxAdaptMaI.m10 + Z * MtxAdaptMaI.m20;\n    y = X * MtxAdaptMaI.m01 + Y * MtxAdaptMaI.m11 + Z * MtxAdaptMaI.m21;\n    z = X * MtxAdaptMaI.m02 + Y * MtxAdaptMaI.m12 + Z * MtxAdaptMaI.m22;\n\n    return [x, y, z];\n};\n\nexport default rgb2lab;\nexport { rgb2xyz };\n","import { unpack } from '../../utils/index.js';\nimport multiplyMatrices from '../../utils/multiply-matrices.js';\nimport { rgb2xyz } from '../lab/rgb2lab.js';\n\nconst rgb2oklab = (...args) => {\n    const [r, g, b, ...rest] = unpack(args, 'rgb');\n    const xyz = rgb2xyz(r, g, b);\n    const oklab = XYZ_to_OKLab(xyz);\n    return [...oklab, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\n// from https://www.w3.org/TR/css-color-4/#color-conversion-code\nfunction XYZ_to_OKLab(XYZ) {\n    // Given XYZ relative to D65, convert to OKLab\n    const XYZtoLMS = [\n        [0.819022437996703, 0.3619062600528904, -0.1288737815209879],\n        [0.0329836539323885, 0.9292868615863434, 0.0361446663506424],\n        [0.0481771893596242, 0.2642395317527308, 0.6335478284694309]\n    ];\n    const LMStoOKLab = [\n        [0.210454268309314, 0.7936177747023054, -0.0040720430116193],\n        [1.9779985324311684, -2.4285922420485799, 0.450593709617411],\n        [0.0259040424655478, 0.7827717124575296, -0.8086757549230774]\n    ];\n\n    const LMS = multiplyMatrices(XYZtoLMS, XYZ);\n    // JavaScript Math.cbrt returns a sign-matched cube root\n    // beware if porting to other languages\n    // especially if tempted to use a general power function\n    return multiplyMatrices(\n        LMStoOKLab,\n        LMS.map((c) => Math.cbrt(c))\n    );\n    // L in range [0,1]. For use in CSS, multiply by 100 and add a percent\n}\n\nexport default rgb2oklab;\n","import { unpack, DEG2RAD } from '../../utils/index.js';\nconst { sin, cos } = Math;\n\nconst lch2lab = (...args) => {\n    /*\n    Convert from a qualitative parameter h and a quantitative parameter l to a 24-bit pixel.\n    These formulas were invented by David Dalrymple to obtain maximum contrast without going\n    out of gamut if the parameters are in the range 0-1.\n\n    A saturation multiplier was added by Gregor Aisch\n    */\n    let [l, c, h] = unpack(args, 'lch');\n    if (isNaN(h)) h = 0;\n    h = h * DEG2RAD;\n    return [l, cos(h) * c, sin(h) * c];\n};\n\nexport default lch2lab;\n","import { unpack } from '../../utils/index.js';\nimport lch2lab from '../lch/lch2lab.js';\nimport oklab2rgb from '../oklab/oklab2rgb.js';\n\nconst oklch2rgb = (...args) => {\n    args = unpack(args, 'lch');\n    const [l, c, h, ...rest] = args;\n    const [L, a, b_] = lch2lab(l, c, h);\n    const [r, g, b] = oklab2rgb(L, a, b_);\n    return [r, g, b, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\nexport default oklch2rgb;\n","import { unpack, RAD2DEG } from '../../utils/index.js';\nconst { sqrt, atan2, round } = Math;\n\nconst lab2lch = (...args) => {\n    const [l, a, b] = unpack(args, 'lab');\n    const c = sqrt(a * a + b * b);\n    let h = (atan2(b, a) * RAD2DEG + 360) % 360;\n    if (round(c * 10000) === 0) h = Number.NaN;\n    return [l, c, h];\n};\n\nexport default lab2lch;\n","import { unpack } from '../../utils/index.js';\nimport rgb2oklab from '../oklab/rgb2oklab.js';\nimport lab2lch from '../lch/lab2lch.js';\n\nconst rgb2oklch = (...args) => {\n    const [r, g, b, ...rest] = unpack(args, 'rgb');\n    const [l, a, b_] = rgb2oklab(r, g, b);\n    const [L, c, h] = lab2lch(l, a, b_);\n    return [L, c, h, ...(rest.length > 0 && rest[0] < 1 ? [rest[0]] : [])];\n};\n\nexport default rgb2oklch;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { getBlurHashAverageColor } from 'fast-blurhash';\nimport {\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\nimport { oklch2rgb, rgb2oklch } from '../utils/color-utils';\nimport isRTL from '../utils/is-rtl';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport store from '../utils/store';\n\nimport Icon from './icon';\nimport Link from './link';\nimport Media from './media';\nimport MenuLink from './menu-link';\nimport Menu2 from './menu2';\n\nconst { PHANPY_IMG_ALT_API_URL: IMG_ALT_API_URL } = import.meta.env;\n\nfunction MediaModal({\n  mediaAttachments,\n  statusID,\n  instance,\n  lang,\n  index = 0,\n  onClose = () => {},\n}) {\n  const { t } = useLingui();\n  const [uiState, setUIState] = useState('default');\n  const carouselRef = useRef(null);\n\n  const [currentIndex, setCurrentIndex] = useState(index);\n  const carouselFocusItem = useRef(null);\n  useLayoutEffect(() => {\n    carouselFocusItem.current?.scrollIntoView();\n\n    // history.pushState({ mediaModal: true }, '');\n    // const handlePopState = (e) => {\n    //   if (e.state?.mediaModal) {\n    //     onClose();\n    //   }\n    // };\n    // window.addEventListener('popstate', handlePopState);\n    // return () => {\n    //   window.removeEventListener('popstate', handlePopState);\n    // };\n  }, []);\n  const prevStatusID = useRef(statusID);\n  useEffect(() => {\n    const scrollLeft = index * carouselRef.current.clientWidth;\n    const differentStatusID = prevStatusID.current !== statusID;\n    if (differentStatusID) prevStatusID.current = statusID;\n    carouselRef.current.focus();\n    carouselRef.current.scrollTo({\n      left: scrollLeft * (isRTL() ? -1 : 1),\n      behavior: differentStatusID ? 'auto' : 'smooth',\n    });\n  }, [index, statusID]);\n\n  const [showControls, setShowControls] = useState(true);\n\n  useEffect(() => {\n    let handleSwipe = (e) => {\n      onClose(e, currentIndex, mediaAttachments, carouselRef);\n    };\n    if (carouselRef.current) {\n      carouselRef.current.addEventListener('swiped-down', handleSwipe);\n    }\n    return () => {\n      if (carouselRef.current) {\n        carouselRef.current.removeEventListener('swiped-down', handleSwipe);\n      }\n    };\n  }, [currentIndex, mediaAttachments]);\n\n  useHotkeys(\n    'esc',\n    (e) => {\n      onClose(e, currentIndex, mediaAttachments, carouselRef);\n    },\n    {\n      ignoreEventWhen: (e) => {\n        const hasModal = !!document.querySelector('#modal-container > *');\n        return hasModal || e.metaKey || e.ctrlKey || e.altKey || e.shiftKey;\n      },\n      useKey: true,\n    },\n    [onClose, currentIndex, mediaAttachments],\n  );\n\n  useEffect(() => {\n    let handleScroll = () => {\n      const { clientWidth, scrollLeft } = carouselRef.current;\n      const index = Math.round(Math.abs(scrollLeft) / clientWidth);\n      setCurrentIndex(index);\n    };\n    if (carouselRef.current) {\n      carouselRef.current.addEventListener('scroll', handleScroll, {\n        passive: true,\n      });\n    }\n    return () => {\n      if (carouselRef.current) {\n        carouselRef.current.removeEventListener('scroll', handleScroll);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      carouselRef.current?.focus?.();\n    }, 100);\n    return () => clearTimeout(timer);\n  }, []);\n\n  const mediaOkColors = useMemo(() => {\n    return mediaAttachments?.map((media) => {\n      const { blurhash } = media;\n      if (blurhash) {\n        const averageColor = getBlurHashAverageColor(blurhash);\n        return rgb2oklch(averageColor);\n      }\n      return null;\n    });\n  }, [mediaAttachments]);\n  const mediaAccentColors = useMemo(() => {\n    return mediaOkColors?.map((okColor) => {\n      if (okColor) {\n        return {\n          light: oklch2rgb([0.95, 0.01, okColor[2]]),\n          dark: oklch2rgb([0.35, 0.01, okColor[2]]),\n          default: oklch2rgb([0.6, okColor[1], okColor[2]]),\n        };\n      }\n      return null;\n    });\n  });\n  const mediaAccentGradients = useMemo(() => {\n    const gap = 5;\n    const range = 100 / mediaAccentColors.length;\n    const colors = mediaAccentColors.map((color, i) => {\n      const start = i * range + gap;\n      const end = (i + 1) * range - gap;\n      if (color?.light && color?.dark) {\n        return {\n          light: `\n                rgb(${color.light?.join(',')}) ${start}%, \n                rgb(${color.light?.join(',')}) ${end}%\n              `,\n          dark: `\n                rgb(${color.dark?.join(',')}) ${start}%, \n                rgb(${color.dark?.join(',')}) ${end}%\n              `,\n        };\n      }\n\n      return {\n        light: `\n              transparent ${start}%, \n              transparent ${end}%\n            `,\n        dark: `\n              transparent ${start}%, \n              transparent ${end}%\n            `,\n      };\n    });\n    const lightGradient = colors.map((color) => color.light).join(', ');\n    const darkGradient = colors.map((color) => color.dark).join(', ');\n    return {\n      light: lightGradient,\n      dark: darkGradient,\n    };\n  }, [mediaAccentColors]);\n\n  let toastRef = useRef(null);\n  useEffect(() => {\n    return () => {\n      toastRef.current?.hideToast?.();\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    const currentColor = mediaAccentColors[currentIndex];\n    let $meta;\n    let metaColor;\n    if (currentColor) {\n      const theme = store.local.get('theme');\n      if (theme) {\n        const mediaColor = `rgb(${currentColor[theme].join(',')})`;\n        console.log({ mediaColor });\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][data-theme-setting=\"manual\"]`,\n        );\n        if ($meta) {\n          metaColor = $meta.content;\n          $meta.content = mediaColor;\n        }\n        document.documentElement.style.setProperty(\n          '--meta-theme-color',\n          mediaColor,\n        );\n      } else {\n        const colorScheme = window.matchMedia('(prefers-color-scheme: dark)')\n          .matches\n          ? 'dark'\n          : 'light';\n        const mediaColor = `rgb(${currentColor[colorScheme].join(',')})`;\n        console.log({ mediaColor });\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][media*=\"${colorScheme}\"]`,\n        );\n        if ($meta) {\n          metaColor = $meta.content;\n          $meta.content = mediaColor;\n        }\n        document.documentElement.style.setProperty(\n          '--meta-theme-color',\n          mediaColor,\n        );\n      }\n    }\n    return () => {\n      // Reset meta color\n      if ($meta && metaColor) {\n        $meta.content = metaColor;\n      }\n      document.documentElement.style.removeProperty('--meta-theme-color');\n    };\n  }, [currentIndex, mediaAccentColors]);\n\n  return (\n    <div\n      class={`media-modal-container media-modal-count-${mediaAttachments?.length}`}\n    >\n      <div\n        ref={carouselRef}\n        tabIndex=\"0\"\n        data-swipe-threshold=\"44\"\n        class=\"carousel\"\n        onClick={(e) => {\n          if (\n            e.target.classList.contains('carousel-item') ||\n            e.target.classList.contains('media') ||\n            e.target.classList.contains('media-zoom')\n          ) {\n            onClose(e, currentIndex, mediaAttachments, carouselRef);\n          }\n        }}\n        style={\n          mediaAttachments.length > 1\n            ? {\n                backgroundAttachment: 'local',\n                '--accent-gradient-light': mediaAccentGradients?.light,\n                '--accent-gradient-dark': mediaAccentGradients?.dark,\n                //     backgroundImage: `linear-gradient(\n                // to ${isRTL() ? 'left' : 'right'}, ${mediaAccentGradient})`,\n              }\n            : {}\n        }\n      >\n        {mediaAttachments?.map((media, i) => {\n          const accentColor =\n            mediaAttachments.length === 1 ? mediaAccentColors[i] : null;\n          return (\n            <div\n              class=\"carousel-item\"\n              style={\n                accentColor\n                  ? {\n                      '--accent-color': `rgb(${accentColor.default.join(',')})`,\n                      '--accent-light-color': `rgb(${accentColor.light?.join(\n                        ',',\n                      )})`,\n                      '--accent-dark-color': `rgb(${accentColor.dark?.join(\n                        ',',\n                      )})`,\n                      '--accent-alpha-color': `rgba(${accentColor.default.join(\n                        ',',\n                      )}, 0.4)`,\n                    }\n                  : {}\n              }\n              tabindex=\"0\"\n              key={media.id}\n              ref={i === currentIndex ? carouselFocusItem : null}\n              onClick={(e) => {\n                // console.log(e);\n                // if (e.target !== e.currentTarget) {\n                //   setShowControls(!showControls);\n                // }\n                if (!e.target.classList.contains('media')) {\n                  setShowControls(!showControls);\n                }\n              }}\n            >\n              {!!media.description && (\n                <button\n                  type=\"button\"\n                  class=\"media-alt\"\n                  hidden={!showControls}\n                  onClick={() => {\n                    states.showMediaAlt = {\n                      alt: media.description,\n                      lang,\n                    };\n                  }}\n                >\n                  <span class=\"alt-badge\">ALT</span>\n                  <span class=\"media-alt-desc\" lang={lang} dir=\"auto\">\n                    {media.description}\n                  </span>\n                </button>\n              )}\n              <Media media={media} showOriginal lang={lang} />\n            </div>\n          );\n        })}\n      </div>\n      <div class=\"carousel-top-controls\" hidden={!showControls}>\n        <span>\n          <button\n            type=\"button\"\n            class=\"carousel-button\"\n            onClick={(e) =>\n              onClose(e, currentIndex, mediaAttachments, carouselRef)\n            }\n          >\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n        </span>\n        {mediaAttachments?.length > 1 ? (\n          <span class=\"carousel-dots\">\n            {mediaAttachments?.map((media, i) => (\n              <button\n                key={media.id}\n                type=\"button\"\n                disabled={i === currentIndex}\n                class={`carousel-dot ${i === currentIndex ? 'active' : ''}`}\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  const left =\n                    carouselRef.current.clientWidth * i * (isRTL() ? -1 : 1);\n                  carouselRef.current.focus();\n                  carouselRef.current.scrollTo({ left, behavior: 'smooth' });\n                }}\n              >\n                <Icon icon=\"round\" size=\"s\" alt=\"\" />\n              </button>\n            ))}\n          </span>\n        ) : (\n          <span />\n        )}\n        <span>\n          <Menu2\n            overflow=\"auto\"\n            align=\"end\"\n            position=\"anchor\"\n            gap={4}\n            menuClassName=\"glass-menu\"\n            menuButton={\n              <button type=\"button\" class=\"carousel-button\">\n                <Icon icon=\"more2\" alt={t`More`} />\n              </button>\n            }\n          >\n            <MenuLink\n              href={\n                mediaAttachments[currentIndex]?.remoteUrl ||\n                mediaAttachments[currentIndex]?.url\n              }\n              class=\"carousel-button\"\n              target=\"_blank\"\n              title={t`Open original media in new window`}\n            >\n              <Icon icon=\"popout\" />\n              <span>\n                <Trans>Open original media</Trans>\n              </span>\n            </MenuLink>\n            {import.meta.env.DEV && // Only dev for now\n              !!states.settings.mediaAltGenerator &&\n              !!IMG_ALT_API_URL &&\n              !!mediaAttachments[currentIndex]?.url &&\n              !mediaAttachments[currentIndex]?.description &&\n              mediaAttachments[currentIndex]?.type === 'image' && (\n                <>\n                  <MenuDivider />\n                  <MenuItem\n                    disabled={uiState === 'loading'}\n                    onClick={() => {\n                      setUIState('loading');\n                      toastRef.current = showToast({\n                        text: t`Attempting to describe image. Please wait`,\n                        duration: -1,\n                      });\n                      (async function () {\n                        try {\n                          const response = await fetch(\n                            `${IMG_ALT_API_URL}?image=${encodeURIComponent(\n                              mediaAttachments[currentIndex]?.url,\n                            )}`,\n                          ).then((r) => r.json());\n                          states.showMediaAlt = {\n                            alt: response.description,\n                          };\n                        } catch (e) {\n                          console.error(e);\n                          showToast(t`Failed to describe image`);\n                        } finally {\n                          setUIState('default');\n                          toastRef.current?.hideToast?.();\n                        }\n                      })();\n                    }}\n                  >\n                    <Icon icon=\"sparkles2\" />\n                    <span>\n                      <Trans>Describe image</Trans>\n                    </span>\n                  </MenuItem>\n                </>\n              )}\n          </Menu2>{' '}\n          {!!statusID && (\n            <Link\n              to={`${instance ? `/${instance}` : ''}/s/${statusID}${\n                window.matchMedia('(min-width: calc(40em + 350px))').matches\n                  ? `?media=${currentIndex + 1}`\n                  : ''\n              }`}\n              class=\"button carousel-button media-post-link\"\n              // onClick={() => {\n              //   // if small screen (not media query min-width 40em + 350px), run onClose\n              //   if (\n              //     !window.matchMedia('(min-width: calc(40em + 350px))').matches\n              //   ) {\n              //     onClose();\n              //   }\n              // }}\n            >\n              <span class=\"button-label\">\n                <Trans>View post</Trans>{' '}\n              </span>\n              &raquo;\n            </Link>\n          )}\n        </span>\n      </div>\n      {mediaAttachments?.length > 1 && (\n        <div class=\"carousel-controls\" hidden={!showControls}>\n          <button\n            type=\"button\"\n            class=\"carousel-button\"\n            hidden={currentIndex === 0}\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              carouselRef.current.focus();\n              carouselRef.current.scrollTo({\n                left:\n                  carouselRef.current.clientWidth *\n                  (currentIndex - 1) *\n                  (isRTL() ? -1 : 1),\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"arrow-left\" alt={t`Previous`} />\n          </button>\n          <button\n            type=\"button\"\n            class=\"carousel-button\"\n            hidden={currentIndex === mediaAttachments.length - 1}\n            onClick={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              carouselRef.current.focus();\n              carouselRef.current.scrollTo({\n                left:\n                  carouselRef.current.clientWidth *\n                  (currentIndex + 1) *\n                  (isRTL() ? -1 : 1),\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"arrow-right\" alt={t`Next`} />\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default MediaModal;\n","import './open-link-sheet.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\n\nimport showToast from '../utils/show-toast';\n\nimport Icon from './icon';\n\nexport default function OpenLinkSheet({ url, linkText, onClose }) {\n  const { t } = useLingui();\n  if (!url) return null;\n\n  let displayUrl = url;\n  try {\n    const urlObj = URL.parse(url);\n    const protocol = urlObj.protocol;\n    const hostname = urlObj.hostname;\n    const rest = url.slice(urlObj.origin.length);\n    displayUrl = (\n      <>\n        {protocol}//<strong>{hostname}</strong>\n        {rest}\n      </>\n    );\n  } catch (e) {}\n\n  const handleCopy = () => {\n    try {\n      navigator.clipboard.writeText(url);\n      showToast(t`Link copied`);\n    } catch (e) {\n      console.error(e);\n      showToast(t`Unable to copy link`);\n    }\n  };\n\n  const handleShare = () => {\n    if (navigator.share && navigator.canShare({ url })) {\n      try {\n        navigator.share({ url });\n      } catch (e) {\n        console.error(e);\n      }\n    }\n  };\n\n  return (\n    <div class=\"sheet sheet-modal\" id=\"open-link-sheet\" tabindex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header class=\"header-grid\">\n        <h2>\n          <Trans>Open link?</Trans>\n        </h2>\n      </header>\n      <main>\n        {!!linkText && (\n          <>\n            <p class=\"link-text\">\n              <Icon icon=\"cursor-hand\" size=\"xl\" /> {linkText}\n            </p>\n            <div class=\"arrow\">\n              <Icon icon=\"arrow-down\" />\n            </div>\n          </>\n        )}\n        <p class=\"full-url\">{displayUrl}</p>\n      </main>\n      <footer>\n        <button type=\"button\" class=\"light\" onClick={onClose}>\n          <Trans>Cancel</Trans>\n        </button>\n        <span class=\"spacer\" />\n        <button type=\"button\" class=\"plain6\" onClick={handleCopy}>\n          <Icon icon=\"copy\" alt={t`Copy`} />\n        </button>\n        {navigator.canShare && navigator.canShare({ url }) && (\n          <button type=\"button\" class=\"plain6\" onClick={handleShare}>\n            <Icon icon=\"share\" alt={t`Share`} />\n          </button>\n        )}\n        <a\n          class=\"button\"\n          href={url}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          onClick={onClose}\n        >\n          <Trans>Open</Trans>\n        </a>\n      </footer>\n    </div>\n  );\n}\n","/*!\nCopyright (c) 2023 Paul Miller (paulmillr.com)\nThe library paulmillr-qr is dual-licensed under the Apache 2.0 OR MIT license.\nYou can select a license of your choice.\nLicensed under the Apache License, Version 2.0 (the \"License\");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\n    http://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an \"AS IS\" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n/**\n * Methods for encoding (generating) QR code patterns.\n * Check out decode.ts for decoding (reading).\n * @module\n * @example\n```js\nimport encodeQR from 'qr';\nconst txt = 'Hello world';\nconst ascii = encodeQR(txt, 'ascii'); // Not all fonts are supported\nconst terminalFriendly = encodeQR(txt, 'term'); // 2x larger, all fonts are OK\nconst gifBytes = encodeQR(txt, 'gif'); // Uncompressed GIF\nconst svgElement = encodeQR(txt, 'svg'); // SVG vector image element\nconst array = encodeQR(txt, 'raw'); // 2d array for canvas or other libs\n// import decodeQR from 'qr/decode.js';\n```\n */\nconst R1_RUN_LENGTH_THRESHOLD = 5;\nconst R2_BLOCK_PENALTY = 3;\nconst R3_FINDER_PATTERN_LENGTH = 11;\nconst R3_FINDER_PENALTY = 40;\nconst R4_BALANCE_STEP_PERCENT = 5;\nconst R4_BALANCE_STEP_POINTS = 10;\n// We do not use newline escape code directly in strings because it's not parser-friendly\nconst chCodes = { newline: 10, reset: 27 };\nfunction assertNumber(n) {\n    if (!Number.isSafeInteger(n))\n        throw new Error(`integer expected: ${n}`);\n}\nfunction validateVersion(ver) {\n    if (!Number.isSafeInteger(ver) || ver < 1 || ver > 40)\n        throw new Error(`Invalid version=${ver}. Expected number [1..40]`);\n}\nfunction bin(dec, pad) {\n    return dec.toString(2).padStart(pad, '0');\n}\nfunction mod(a, b) {\n    const result = a % b;\n    return result >= 0 ? result : b + result;\n}\nfunction fillArr(length, val) {\n    return new Array(length).fill(val);\n}\n/**\n * Interleaves byte blocks.\n * @param blocks [[1, 2, 3], [4, 5, 6]]\n * @returns [1, 4, 2, 5, 3, 6]\n */\nfunction interleaveBytes(blocks) {\n    let maxLen = 0;\n    let totalLen = 0;\n    for (const block of blocks) {\n        maxLen = Math.max(maxLen, block.length);\n        totalLen += block.length;\n    }\n    const result = new Uint8Array(totalLen);\n    let idx = 0;\n    for (let i = 0; i < maxLen; i++) {\n        for (const block of blocks) {\n            if (i < block.length)\n                result[idx++] = block[i];\n        }\n    }\n    return result;\n}\n// Optimize for minimal score/penalty\nfunction best() {\n    let best;\n    let bestScore = Infinity;\n    return {\n        add(score, value) {\n            if (score >= bestScore)\n                return;\n            best = value;\n            bestScore = score;\n        },\n        get: () => best,\n        score: () => bestScore,\n    };\n}\n// Based on https://github.com/paulmillr/scure-base/blob/main/index.ts\nfunction alphabet(alphabet) {\n    return {\n        has: (char) => alphabet.includes(char),\n        decode: (input) => {\n            if (!Array.isArray(input) || (input.length && typeof input[0] !== 'string'))\n                throw new Error('alphabet.decode input should be array of strings');\n            return input.map((letter) => {\n                if (typeof letter !== 'string')\n                    throw new Error(`alphabet.decode: not string element=${letter}`);\n                const index = alphabet.indexOf(letter);\n                if (index === -1)\n                    throw new Error(`Unknown letter: \"${letter}\". Allowed: ${alphabet}`);\n                return index;\n            });\n        },\n        encode: (digits) => {\n            if (!Array.isArray(digits) || (digits.length && typeof digits[0] !== 'number'))\n                throw new Error('alphabet.encode input should be an array of numbers');\n            return digits.map((i) => {\n                assertNumber(i);\n                if (i < 0 || i >= alphabet.length)\n                    throw new Error(`Digit index outside alphabet: ${i} (alphabet: ${alphabet.length})`);\n                return alphabet[i];\n            });\n        },\n    };\n}\nexport class Bitmap {\n    static size(size, limit) {\n        if (typeof size === 'number')\n            size = { height: size, width: size };\n        if (!Number.isSafeInteger(size.height) && size.height !== Infinity)\n            throw new Error(`Bitmap: invalid height=${size.height} (${typeof size.height})`);\n        if (!Number.isSafeInteger(size.width) && size.width !== Infinity)\n            throw new Error(`Bitmap: invalid width=${size.width} (${typeof size.width})`);\n        if (limit !== undefined) {\n            // Clamp length, so it won't overflow, also allows to use Infinity, so we draw until end\n            size = {\n                width: Math.min(size.width, limit.width),\n                height: Math.min(size.height, limit.height),\n            };\n        }\n        return size;\n    }\n    static fromString(s) {\n        // Remove linebreaks on start and end, so we draw in `` section\n        s = s.replace(/^\\n+/g, '').replace(/\\n+$/g, '');\n        const lines = s.split(String.fromCharCode(chCodes.newline));\n        const height = lines.length;\n        const data = new Array(height);\n        let width;\n        for (const line of lines) {\n            const row = line.split('').map((i) => {\n                if (i === 'X')\n                    return true;\n                if (i === ' ')\n                    return false;\n                if (i === '?')\n                    return undefined;\n                throw new Error(`Bitmap.fromString: unknown symbol=${i}`);\n            });\n            if (width && row.length !== width)\n                throw new Error(`Bitmap.fromString different row sizes: width=${width} cur=${row.length}`);\n            width = row.length;\n            data.push(row);\n        }\n        if (!width)\n            width = 0;\n        return new Bitmap({ height, width }, data);\n    }\n    data;\n    height;\n    width;\n    constructor(size, data) {\n        const { height, width } = Bitmap.size(size);\n        this.data = data || Array.from({ length: height }, () => fillArr(width, undefined));\n        this.height = height;\n        this.width = width;\n    }\n    point(p) {\n        return this.data[p.y][p.x];\n    }\n    isInside(p) {\n        return 0 <= p.x && p.x < this.width && 0 <= p.y && p.y < this.height;\n    }\n    size(offset) {\n        if (!offset)\n            return { height: this.height, width: this.width };\n        const { x, y } = this.xy(offset);\n        return { height: this.height - y, width: this.width - x };\n    }\n    xy(c) {\n        if (typeof c === 'number')\n            c = { x: c, y: c };\n        if (!Number.isSafeInteger(c.x))\n            throw new Error(`Bitmap: invalid x=${c.x}`);\n        if (!Number.isSafeInteger(c.y))\n            throw new Error(`Bitmap: invalid y=${c.y}`);\n        // Do modulo, so we can use negative positions\n        c.x = mod(c.x, this.width);\n        c.y = mod(c.y, this.height);\n        return c;\n    }\n    // Basically every operation can be represented as rect\n    rect(c, size, value) {\n        const { x, y } = this.xy(c);\n        const { height, width } = Bitmap.size(size, this.size({ x, y }));\n        for (let yPos = 0; yPos < height; yPos++) {\n            for (let xPos = 0; xPos < width; xPos++) {\n                // NOTE: we use give function relative coordinates inside box\n                this.data[y + yPos][x + xPos] =\n                    typeof value === 'function'\n                        ? value({ x: xPos, y: yPos }, this.data[y + yPos][x + xPos])\n                        : value;\n            }\n        }\n        return this;\n    }\n    // returns rectangular part of bitmap\n    rectRead(c, size, fn) {\n        return this.rect(c, size, (c, cur) => {\n            fn(c, cur);\n            return cur;\n        });\n    }\n    // Horizontal & vertical lines\n    hLine(c, len, value) {\n        return this.rect(c, { width: len, height: 1 }, value);\n    }\n    vLine(c, len, value) {\n        return this.rect(c, { width: 1, height: len }, value);\n    }\n    // add border\n    border(border = 2, value) {\n        const height = this.height + 2 * border;\n        const width = this.width + 2 * border;\n        const v = fillArr(border, value);\n        const h = Array.from({ length: border }, () => fillArr(width, value));\n        return new Bitmap({ height, width }, [...h, ...this.data.map((i) => [...v, ...i, ...v]), ...h]);\n    }\n    // Embed another bitmap on coordinates\n    embed(c, bm) {\n        return this.rect(c, bm.size(), ({ x, y }) => bm.data[y][x]);\n    }\n    // returns rectangular part of bitmap\n    rectSlice(c, size = this.size()) {\n        const rect = new Bitmap(Bitmap.size(size, this.size(this.xy(c))));\n        this.rect(c, size, ({ x, y }, cur) => (rect.data[y][x] = cur));\n        return rect;\n    }\n    // Change shape, replace rows with columns (data[y][x] -> data[x][y])\n    inverse() {\n        const { height, width } = this;\n        const res = new Bitmap({ height: width, width: height });\n        return res.rect({ x: 0, y: 0 }, Infinity, ({ x, y }) => this.data[x][y]);\n    }\n    // Each pixel size is multiplied by factor\n    scale(factor) {\n        if (!Number.isSafeInteger(factor) || factor > 1024)\n            throw new Error(`invalid scale factor: ${factor}`);\n        const { height, width } = this;\n        const res = new Bitmap({ height: factor * height, width: factor * width });\n        return res.rect({ x: 0, y: 0 }, Infinity, ({ x, y }) => this.data[Math.floor(y / factor)][Math.floor(x / factor)]);\n    }\n    clone() {\n        const res = new Bitmap(this.size());\n        return res.rect({ x: 0, y: 0 }, this.size(), ({ x, y }) => this.data[y][x]);\n    }\n    // Ensure that there is no undefined values left\n    assertDrawn() {\n        this.rectRead(0, Infinity, (_, cur) => {\n            if (typeof cur !== 'boolean')\n                throw new Error(`Invalid color type=${typeof cur}`);\n        });\n    }\n    // Simple string representation for debugging\n    toString() {\n        return this.data\n            .map((i) => i.map((j) => (j === undefined ? '?' : j ? 'X' : ' ')).join(''))\n            .join(String.fromCharCode(chCodes.newline));\n    }\n    toASCII() {\n        const { height, width, data } = this;\n        let out = '';\n        // Terminal character height is x2 of character width, so we process two rows of bitmap\n        // to produce one row of ASCII\n        for (let y = 0; y < height; y += 2) {\n            for (let x = 0; x < width; x++) {\n                const first = data[y][x];\n                const second = y + 1 >= height ? true : data[y + 1][x]; // if last row outside bitmap, make it black\n                if (!first && !second)\n                    out += ''; // both rows white (empty)\n                else if (!first && second)\n                    out += ''; // top row white\n                else if (first && !second)\n                    out += ''; // down row white\n                else if (first && second)\n                    out += ' '; // both rows black\n            }\n            out += String.fromCharCode(chCodes.newline);\n        }\n        return out;\n    }\n    toTerm() {\n        const cc = String.fromCharCode(chCodes.reset);\n        const reset = cc + '[0m';\n        const whiteBG = cc + '[1;47m  ' + reset;\n        const darkBG = cc + `[40m  ` + reset;\n        return this.data\n            .map((i) => i.map((j) => (j ? darkBG : whiteBG)).join(''))\n            .join(String.fromCharCode(chCodes.newline));\n    }\n    toSVG(optimize = true) {\n        let out = `<svg viewBox=\"0 0 ${this.width} ${this.height}\" xmlns=\"http://www.w3.org/2000/svg\">`;\n        // Construct optimized SVG path data.\n        let pathData = '';\n        let prevPoint;\n        this.rectRead(0, Infinity, (point, val) => {\n            if (!val)\n                return;\n            const { x, y } = point;\n            if (!optimize) {\n                out += `<rect x=\"${x}\" y=\"${y}\" width=\"1\" height=\"1\" />`;\n                return;\n            }\n            // https://developer.mozilla.org/en-US/docs/Web/SVG/Reference/Attribute/d#path_commands\n            // Determine the shortest way to represent the initial cursor movement.\n            // M - Move cursor (without drawing) to absolute coordinate pair.\n            let m = `M${x} ${y}`;\n            // Only allow using the relative cursor move command if previous points\n            // were drawn.\n            if (prevPoint) {\n                // m - Move cursor (without drawing) to relative coordinate pair.\n                const relM = `m${x - prevPoint.x} ${y - prevPoint.y}`;\n                if (relM.length <= m.length)\n                    m = relM;\n            }\n            // Determine the shortest way to represent the cell's bottom line draw.\n            // H - Draw line from cursor position to absolute x coordinate.\n            // h - Draw line from cursor position to relative x coordinate.\n            const bH = x < 10 ? `H${x}` : 'h-1';\n            // v - Draw line from cursor position to relative y coordinate.\n            // Z - Close path (draws line from cursor position to M coordinate).\n            pathData += `${m}h1v1${bH}Z`;\n            prevPoint = point;\n        });\n        if (optimize)\n            out += `<path d=\"${pathData}\"/>`;\n        out += `</svg>`;\n        return out;\n    }\n    toGIF() {\n        // NOTE: Small, but inefficient implementation.\n        // Uses 1 byte per pixel.\n        const u16le = (i) => [i & 0xff, (i >>> 8) & 0xff];\n        const dims = [...u16le(this.width), ...u16le(this.height)];\n        const data = [];\n        this.rectRead(0, Infinity, (_, cur) => data.push(+(cur === true)));\n        const N = 126; // Block size\n        // prettier-ignore\n        const bytes = [\n            0x47, 0x49, 0x46, 0x38, 0x37, 0x61, ...dims, 0xf6, 0x00, 0x00, 0xff, 0xff, 0xff,\n            ...fillArr(3 * 127, 0x00), 0x2c, 0x00, 0x00, 0x00, 0x00, ...dims, 0x00, 0x07\n        ];\n        const fullChunks = Math.floor(data.length / N);\n        // Full blocks\n        for (let i = 0; i < fullChunks; i++)\n            bytes.push(N + 1, 0x80, ...data.slice(N * i, N * (i + 1)).map((i) => +i));\n        // Remaining bytes\n        bytes.push((data.length % N) + 1, 0x80, ...data.slice(fullChunks * N).map((i) => +i));\n        bytes.push(0x01, 0x81, 0x00, 0x3b);\n        return new Uint8Array(bytes);\n    }\n    toImage(isRGB = false) {\n        const { height, width } = this.size();\n        const data = new Uint8Array(height * width * (isRGB ? 3 : 4));\n        let i = 0;\n        for (let y = 0; y < height; y++) {\n            for (let x = 0; x < width; x++) {\n                const value = !!this.data[y][x] ? 0 : 255;\n                data[i++] = value;\n                data[i++] = value;\n                data[i++] = value;\n                if (!isRGB)\n                    data[i++] = 255; // alpha channel\n            }\n        }\n        return { height, width, data };\n    }\n}\n// End of utils\n// Runtime type-checking\n/** Error correction mode. low: 7%, medium: 15%, quartile: 25%, high: 30% */\nexport const ECMode = ['low', 'medium', 'quartile', 'high'];\n/** QR Code encoding */\nexport const Encoding = ['numeric', 'alphanumeric', 'byte', 'kanji', 'eci'];\n// Various constants & tables\n// prettier-ignore\nconst BYTES = [\n    // 1,  2,  3,   4,   5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,  16,  17,  18,  19,   20,\n    26, 44, 70, 100, 134, 172, 196, 242, 292, 346, 404, 466, 532, 581, 655, 733, 815, 901, 991, 1085,\n    //  21,   22,   23,   24,   25,   26,   27,   28,   29,   30,   31,   32,   33,   34,   35,   36,   37,   38,   39,   40\n    1156, 1258, 1364, 1474, 1588, 1706, 1828, 1921, 2051, 2185, 2323, 2465, 2611, 2761, 2876, 3034, 3196, 3362, 3532, 3706,\n];\n// prettier-ignore\nconst WORDS_PER_BLOCK = {\n    // Version 1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40\n    low: [7, 10, 15, 20, 26, 18, 20, 24, 30, 18, 20, 24, 26, 30, 22, 24, 28, 30, 28, 28, 28, 28, 30, 30, 26, 28, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n    medium: [10, 16, 26, 18, 24, 16, 18, 22, 22, 26, 30, 22, 22, 24, 24, 28, 28, 26, 26, 26, 26, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28, 28],\n    quartile: [13, 22, 18, 26, 18, 24, 18, 22, 20, 24, 28, 26, 24, 20, 30, 24, 28, 28, 26, 30, 28, 30, 30, 30, 30, 28, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n    high: [17, 28, 22, 16, 22, 28, 26, 26, 24, 28, 24, 28, 22, 24, 24, 30, 28, 28, 26, 28, 30, 24, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30, 30],\n};\n// prettier-ignore\nconst ECC_BLOCKS = {\n    // Version   1, 2, 3, 4, 5, 6, 7, 8, 9,10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40\n    low: [1, 1, 1, 1, 1, 2, 2, 2, 2, 4, 4, 4, 4, 4, 6, 6, 6, 6, 7, 8, 8, 9, 9, 10, 12, 12, 12, 13, 14, 15, 16, 17, 18, 19, 19, 20, 21, 22, 24, 25],\n    medium: [1, 1, 1, 2, 2, 4, 4, 4, 5, 5, 5, 8, 9, 9, 10, 10, 11, 13, 14, 16, 17, 17, 18, 20, 21, 23, 25, 26, 28, 29, 31, 33, 35, 37, 38, 40, 43, 45, 47, 49],\n    quartile: [1, 1, 2, 2, 4, 4, 6, 6, 8, 8, 8, 10, 12, 16, 12, 17, 16, 18, 21, 20, 23, 23, 25, 27, 29, 34, 34, 35, 38, 40, 43, 45, 48, 51, 53, 56, 59, 62, 65, 68],\n    high: [1, 1, 2, 4, 4, 4, 5, 6, 8, 8, 11, 11, 16, 16, 18, 16, 19, 21, 25, 25, 25, 34, 30, 32, 35, 37, 40, 42, 45, 48, 51, 54, 57, 60, 63, 66, 70, 74, 77, 81],\n};\nconst info = {\n    size: {\n        encode: (ver) => 21 + 4 * (ver - 1), // ver1 = 21, ver40=177 blocks\n        decode: (size) => (size - 17) / 4,\n    },\n    sizeType: (ver) => Math.floor((ver + 7) / 17),\n    // Based on https://codereview.stackexchange.com/questions/74925/algorithm-to-generate-this-alignment-pattern-locations-table-for-qr-codes\n    alignmentPatterns(ver) {\n        if (ver === 1)\n            return [];\n        const first = 6;\n        const last = info.size.encode(ver) - first - 1;\n        const distance = last - first;\n        const count = Math.ceil(distance / 28);\n        let interval = Math.floor(distance / count);\n        if (interval % 2)\n            interval += 1;\n        else if ((distance % count) * 2 >= count)\n            interval += 2;\n        const res = [first];\n        for (let m = 1; m < count; m++)\n            res.push(last - (count - m) * interval);\n        res.push(last);\n        return res;\n    },\n    ECCode: {\n        low: 0b01,\n        medium: 0b00,\n        quartile: 0b11,\n        high: 0b10,\n    },\n    formatMask: 0b101010000010010,\n    formatBits(ecc, maskIdx) {\n        const data = (info.ECCode[ecc] << 3) | maskIdx;\n        let d = data;\n        for (let i = 0; i < 10; i++)\n            d = (d << 1) ^ ((d >> 9) * 0b10100110111);\n        return ((data << 10) | d) ^ info.formatMask;\n    },\n    versionBits(ver) {\n        let d = ver;\n        for (let i = 0; i < 12; i++)\n            d = (d << 1) ^ ((d >> 11) * 0b1111100100101);\n        return (ver << 12) | d;\n    },\n    alphabet: {\n        numeric: alphabet('0123456789'),\n        alphanumerc: alphabet('0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:'),\n    }, // as Record<EncodingType, ReturnType<typeof alphabet>>,\n    lengthBits(ver, type) {\n        const table = {\n            numeric: [10, 12, 14],\n            alphanumeric: [9, 11, 13],\n            byte: [8, 16, 16],\n            kanji: [8, 10, 12],\n            eci: [0, 0, 0],\n        };\n        return table[type][info.sizeType(ver)];\n    },\n    modeBits: {\n        numeric: '0001',\n        alphanumeric: '0010',\n        byte: '0100',\n        kanji: '1000',\n        eci: '0111',\n    },\n    capacity(ver, ecc) {\n        const bytes = BYTES[ver - 1];\n        const words = WORDS_PER_BLOCK[ecc][ver - 1];\n        const numBlocks = ECC_BLOCKS[ecc][ver - 1];\n        const blockLen = Math.floor(bytes / numBlocks) - words;\n        const shortBlocks = numBlocks - (bytes % numBlocks);\n        return {\n            words,\n            numBlocks,\n            shortBlocks,\n            blockLen,\n            capacity: (bytes - words * numBlocks) * 8,\n            total: (words + blockLen) * numBlocks + numBlocks - shortBlocks,\n        };\n    },\n};\nconst PATTERNS = [\n    (x, y) => (x + y) % 2 == 0,\n    (_x, y) => y % 2 == 0,\n    (x, _y) => x % 3 == 0,\n    (x, y) => (x + y) % 3 == 0,\n    (x, y) => (Math.floor(y / 2) + Math.floor(x / 3)) % 2 == 0,\n    (x, y) => ((x * y) % 2) + ((x * y) % 3) == 0,\n    (x, y) => (((x * y) % 2) + ((x * y) % 3)) % 2 == 0,\n    (x, y) => (((x + y) % 2) + ((x * y) % 3)) % 2 == 0,\n];\n// Galois field && reed-solomon encoding\nconst GF = {\n    tables: ((p_poly) => {\n        const exp = fillArr(256, 0);\n        const log = fillArr(256, 0);\n        for (let i = 0, x = 1; i < 256; i++) {\n            exp[i] = x;\n            log[x] = i;\n            x <<= 1;\n            if (x & 0x100)\n                x ^= p_poly;\n        }\n        return { exp, log };\n    })(0x11d),\n    exp: (x) => GF.tables.exp[x],\n    log(x) {\n        if (x === 0)\n            throw new Error(`GF.log: invalid arg=${x}`);\n        return GF.tables.log[x] % 255;\n    },\n    mul(x, y) {\n        if (x === 0 || y === 0)\n            return 0;\n        return GF.tables.exp[(GF.tables.log[x] + GF.tables.log[y]) % 255];\n    },\n    add: (x, y) => x ^ y,\n    pow: (x, e) => GF.tables.exp[(GF.tables.log[x] * e) % 255],\n    inv(x) {\n        if (x === 0)\n            throw new Error(`GF.inverse: invalid arg=${x}`);\n        return GF.tables.exp[255 - GF.tables.log[x]];\n    },\n    polynomial(poly) {\n        if (poly.length == 0)\n            throw new Error('GF.polymomial: invalid length');\n        if (poly[0] !== 0)\n            return poly;\n        // Strip leading zeros\n        let i = 0;\n        for (; i < poly.length - 1 && poly[i] == 0; i++)\n            ;\n        return poly.slice(i);\n    },\n    monomial(degree, coefficient) {\n        if (degree < 0)\n            throw new Error(`GF.monomial: invalid degree=${degree}`);\n        if (coefficient == 0)\n            return [0];\n        let coefficients = fillArr(degree + 1, 0);\n        coefficients[0] = coefficient;\n        return GF.polynomial(coefficients);\n    },\n    degree: (a) => a.length - 1,\n    coefficient: (a, degree) => a[GF.degree(a) - degree],\n    mulPoly(a, b) {\n        if (a[0] === 0 || b[0] === 0)\n            return [0];\n        const res = fillArr(a.length + b.length - 1, 0);\n        for (let i = 0; i < a.length; i++) {\n            for (let j = 0; j < b.length; j++) {\n                res[i + j] = GF.add(res[i + j], GF.mul(a[i], b[j]));\n            }\n        }\n        return GF.polynomial(res);\n    },\n    mulPolyScalar(a, scalar) {\n        if (scalar == 0)\n            return [0];\n        if (scalar == 1)\n            return a;\n        const res = fillArr(a.length, 0);\n        for (let i = 0; i < a.length; i++)\n            res[i] = GF.mul(a[i], scalar);\n        return GF.polynomial(res);\n    },\n    mulPolyMonomial(a, degree, coefficient) {\n        if (degree < 0)\n            throw new Error('GF.mulPolyMonomial: invalid degree');\n        if (coefficient == 0)\n            return [0];\n        const res = fillArr(a.length + degree, 0);\n        for (let i = 0; i < a.length; i++)\n            res[i] = GF.mul(a[i], coefficient);\n        return GF.polynomial(res);\n    },\n    addPoly(a, b) {\n        if (a[0] === 0)\n            return b;\n        if (b[0] === 0)\n            return a;\n        let smaller = a;\n        let larger = b;\n        if (smaller.length > larger.length)\n            [smaller, larger] = [larger, smaller];\n        let sumDiff = fillArr(larger.length, 0);\n        let lengthDiff = larger.length - smaller.length;\n        let s = larger.slice(0, lengthDiff);\n        for (let i = 0; i < s.length; i++)\n            sumDiff[i] = s[i];\n        for (let i = lengthDiff; i < larger.length; i++)\n            sumDiff[i] = GF.add(smaller[i - lengthDiff], larger[i]);\n        return GF.polynomial(sumDiff);\n    },\n    remainderPoly(data, divisor) {\n        const out = Array.from(data);\n        for (let i = 0; i < data.length - divisor.length + 1; i++) {\n            const elm = out[i];\n            if (elm === 0)\n                continue;\n            for (let j = 1; j < divisor.length; j++) {\n                if (divisor[j] !== 0)\n                    out[i + j] = GF.add(out[i + j], GF.mul(divisor[j], elm));\n            }\n        }\n        return out.slice(data.length - divisor.length + 1, out.length);\n    },\n    divisorPoly(degree) {\n        let g = [1];\n        for (let i = 0; i < degree; i++)\n            g = GF.mulPoly(g, [1, GF.pow(2, i)]);\n        return g;\n    },\n    evalPoly(poly, a) {\n        if (a == 0)\n            return GF.coefficient(poly, 0); // Just return the x^0 coefficient\n        let res = poly[0];\n        for (let i = 1; i < poly.length; i++)\n            res = GF.add(GF.mul(a, res), poly[i]);\n        return res;\n    },\n    // TODO: cleanup\n    euclidian(a, b, R) {\n        // Force degree(a) >= degree(b)\n        if (GF.degree(a) < GF.degree(b))\n            [a, b] = [b, a];\n        let rLast = a;\n        let r = b;\n        let tLast = [0];\n        let t = [1];\n        // while degree of Ri  t/2\n        while (2 * GF.degree(r) >= R) {\n            let rLastLast = rLast;\n            let tLastLast = tLast;\n            rLast = r;\n            tLast = t;\n            if (rLast[0] === 0)\n                throw new Error('rLast[0] === 0');\n            r = rLastLast;\n            let q = [0];\n            const dltInverse = GF.inv(rLast[0]);\n            while (GF.degree(r) >= GF.degree(rLast) && r[0] !== 0) {\n                const degreeDiff = GF.degree(r) - GF.degree(rLast);\n                const scale = GF.mul(r[0], dltInverse);\n                q = GF.addPoly(q, GF.monomial(degreeDiff, scale));\n                r = GF.addPoly(r, GF.mulPolyMonomial(rLast, degreeDiff, scale));\n            }\n            q = GF.mulPoly(q, tLast);\n            t = GF.addPoly(q, tLastLast);\n            if (GF.degree(r) >= GF.degree(rLast))\n                throw new Error(`Division failed r: ${r}, rLast: ${rLast}`);\n        }\n        const sigmaTildeAtZero = GF.coefficient(t, 0);\n        if (sigmaTildeAtZero == 0)\n            throw new Error('sigmaTilde(0) was zero');\n        const inverse = GF.inv(sigmaTildeAtZero);\n        return [GF.mulPolyScalar(t, inverse), GF.mulPolyScalar(r, inverse)];\n    },\n};\nfunction RS(eccWords) {\n    return {\n        encode(from) {\n            const d = GF.divisorPoly(eccWords);\n            const pol = Array.from(from);\n            pol.push(...d.slice(0, -1).fill(0));\n            return Uint8Array.from(GF.remainderPoly(pol, d));\n        },\n        decode(to) {\n            const res = to.slice();\n            const poly = GF.polynomial(Array.from(to));\n            // Find errors\n            let syndrome = fillArr(eccWords, 0);\n            let hasError = false;\n            for (let i = 0; i < eccWords; i++) {\n                const evl = GF.evalPoly(poly, GF.exp(i));\n                syndrome[syndrome.length - 1 - i] = evl;\n                if (evl !== 0)\n                    hasError = true;\n            }\n            if (!hasError)\n                return res;\n            syndrome = GF.polynomial(syndrome);\n            const monomial = GF.monomial(eccWords, 1);\n            const [errorLocator, errorEvaluator] = GF.euclidian(monomial, syndrome, eccWords);\n            // Error locations\n            const locations = fillArr(GF.degree(errorLocator), 0);\n            let e = 0;\n            for (let i = 1; i < 256 && e < locations.length; i++) {\n                if (GF.evalPoly(errorLocator, i) === 0)\n                    locations[e++] = GF.inv(i);\n            }\n            if (e !== locations.length)\n                throw new Error('RS.decode: invalid errors number');\n            for (let i = 0; i < locations.length; i++) {\n                const pos = res.length - 1 - GF.log(locations[i]);\n                if (pos < 0)\n                    throw new Error('RS.decode: invalid error location');\n                const xiInverse = GF.inv(locations[i]);\n                let denominator = 1;\n                for (let j = 0; j < locations.length; j++) {\n                    if (i === j)\n                        continue;\n                    denominator = GF.mul(denominator, GF.add(1, GF.mul(locations[j], xiInverse)));\n                }\n                res[pos] = GF.add(res[pos], GF.mul(GF.evalPoly(errorEvaluator, xiInverse), GF.inv(denominator)));\n            }\n            return res;\n        },\n    };\n}\n// Interleaves blocks\nfunction interleave(ver, ecc) {\n    const { words, shortBlocks, numBlocks, blockLen, total } = info.capacity(ver, ecc);\n    const rs = RS(words);\n    return {\n        encode(bytes) {\n            // Add error correction to bytes\n            const blocks = [];\n            const eccBlocks = [];\n            for (let i = 0; i < numBlocks; i++) {\n                const isShort = i < shortBlocks;\n                const len = blockLen + (isShort ? 0 : 1);\n                blocks.push(bytes.subarray(0, len));\n                eccBlocks.push(rs.encode(bytes.subarray(0, len)));\n                bytes = bytes.subarray(len);\n            }\n            const resBlocks = interleaveBytes(blocks);\n            const resECC = interleaveBytes(eccBlocks);\n            const res = new Uint8Array(resBlocks.length + resECC.length);\n            res.set(resBlocks);\n            res.set(resECC, resBlocks.length);\n            return res;\n        },\n        decode(data) {\n            if (data.length !== total)\n                throw new Error(`interleave.decode: len(data)=${data.length}, total=${total}`);\n            const blocks = [];\n            for (let i = 0; i < numBlocks; i++) {\n                const isShort = i < shortBlocks;\n                blocks.push(new Uint8Array(words + blockLen + (isShort ? 0 : 1)));\n            }\n            // Short blocks\n            let pos = 0;\n            for (let i = 0; i < blockLen; i++) {\n                for (let j = 0; j < numBlocks; j++)\n                    blocks[j][i] = data[pos++];\n            }\n            // Long blocks\n            for (let j = shortBlocks; j < numBlocks; j++)\n                blocks[j][blockLen] = data[pos++];\n            // ECC\n            for (let i = blockLen; i < blockLen + words; i++) {\n                for (let j = 0; j < numBlocks; j++) {\n                    const isShort = j < shortBlocks;\n                    blocks[j][i + (isShort ? 0 : 1)] = data[pos++];\n                }\n            }\n            // Decode\n            // Error-correct and copy data blocks together into a stream of bytes\n            const res = [];\n            for (const block of blocks)\n                res.push(...Array.from(rs.decode(block)).slice(0, -words));\n            return Uint8Array.from(res);\n        },\n    };\n}\n// Draw\n// Generic template per version+ecc+mask. Can be cached, to speedup calculations.\nfunction drawTemplate(ver, ecc, maskIdx, test = false) {\n    const size = info.size.encode(ver);\n    let b = new Bitmap(size + 2);\n    // Finder patterns\n    // We draw full pattern and later slice, since before addition of borders finder is truncated by one pixel on sides\n    const finder = new Bitmap(3).rect(0, 3, true).border(1, false).border(1, true).border(1, false);\n    b = b\n        .embed(0, finder) // top left\n        .embed({ x: -finder.width, y: 0 }, finder) // top right\n        .embed({ x: 0, y: -finder.height }, finder); // bottom left\n    b = b.rectSlice(1, size);\n    // Alignment patterns\n    const align = new Bitmap(1).rect(0, 1, true).border(1, false).border(1, true);\n    const alignPos = info.alignmentPatterns(ver);\n    for (const y of alignPos) {\n        for (const x of alignPos) {\n            if (b.data[y][x] !== undefined)\n                continue;\n            b.embed({ x: x - 2, y: y - 2 }, align); // center of pattern should be at position\n        }\n    }\n    // Timing patterns\n    b = b\n        .hLine({ x: 0, y: 6 }, Infinity, ({ x }, cur) => (cur === undefined ? x % 2 == 0 : cur))\n        .vLine({ x: 6, y: 0 }, Infinity, ({ y }, cur) => (cur === undefined ? y % 2 == 0 : cur));\n    // Format information\n    {\n        const bits = info.formatBits(ecc, maskIdx);\n        const getBit = (i) => !test && ((bits >> i) & 1) == 1;\n        // vertical\n        for (let i = 0; i < 6; i++)\n            b.data[i][8] = getBit(i); // right of top-left finder\n        // TODO: re-write as lines, like:\n        // b.vLine({ x: 8, y: 0 }, 6, ({ x, y }) => getBit(y));\n        for (let i = 6; i < 8; i++)\n            b.data[i + 1][8] = getBit(i); // after timing pattern\n        for (let i = 8; i < 15; i++)\n            b.data[size - 15 + i][8] = getBit(i); // right of bottom-left finder\n        // horizontal\n        for (let i = 0; i < 8; i++)\n            b.data[8][size - i - 1] = getBit(i); // under top-right finder\n        for (let i = 8; i < 9; i++)\n            b.data[8][15 - i - 1 + 1] = getBit(i); // VVV, after timing\n        for (let i = 9; i < 15; i++)\n            b.data[8][15 - i - 1] = getBit(i); // under top-left finder\n        b.data[size - 8][8] = !test; // bottom-left finder, right\n    }\n    // Version information\n    if (ver >= 7) {\n        const bits = info.versionBits(ver);\n        for (let i = 0; i < 18; i += 1) {\n            const bit = !test && ((bits >> i) & 1) == 1;\n            const x = Math.floor(i / 3);\n            const y = (i % 3) + size - 8 - 3;\n            // two copies\n            b.data[x][y] = bit;\n            b.data[y][x] = bit;\n        }\n    }\n    return b;\n}\n// zigzag: bottom->top && top->bottom\nfunction zigzag(tpl, maskIdx, fn) {\n    const size = tpl.height;\n    const pattern = PATTERNS[maskIdx];\n    // zig-zag pattern\n    let dir = -1;\n    let y = size - 1;\n    // two columns at time\n    for (let xOffset = size - 1; xOffset > 0; xOffset -= 2) {\n        if (xOffset == 6)\n            xOffset = 5; // skip vertical timing pattern\n        for (;; y += dir) {\n            for (let j = 0; j < 2; j += 1) {\n                const x = xOffset - j;\n                if (tpl.data[y][x] !== undefined)\n                    continue; // skip already written elements\n                fn(x, y, pattern(x, y));\n            }\n            if (y + dir < 0 || y + dir >= size)\n                break;\n        }\n        dir = -dir; // change direction\n    }\n}\n// NOTE: byte encoding is just representation, QR works with strings only. Most decoders will fail on raw byte array,\n// since they expect unicode or other text encoding inside bytes\nfunction detectType(str) {\n    let type = 'numeric';\n    for (let x of str) {\n        if (info.alphabet.numeric.has(x))\n            continue;\n        type = 'alphanumeric';\n        if (!info.alphabet.alphanumerc.has(x))\n            return 'byte';\n    }\n    return type;\n}\n/**\n * @example utf8ToBytes('abc') // new Uint8Array([97, 98, 99])\n */\nexport function utf8ToBytes(str) {\n    if (typeof str !== 'string')\n        throw new Error(`utf8ToBytes expected string, got ${typeof str}`);\n    return new Uint8Array(new TextEncoder().encode(str)); // https://bugzil.la/1681809\n}\nfunction encode(ver, ecc, data, type, encoder = utf8ToBytes) {\n    let encoded = '';\n    let dataLen = data.length;\n    if (type === 'numeric') {\n        const t = info.alphabet.numeric.decode(data.split(''));\n        const n = t.length;\n        for (let i = 0; i < n - 2; i += 3)\n            encoded += bin(t[i] * 100 + t[i + 1] * 10 + t[i + 2], 10);\n        if (n % 3 === 1) {\n            encoded += bin(t[n - 1], 4);\n        }\n        else if (n % 3 === 2) {\n            encoded += bin(t[n - 2] * 10 + t[n - 1], 7);\n        }\n    }\n    else if (type === 'alphanumeric') {\n        const t = info.alphabet.alphanumerc.decode(data.split(''));\n        const n = t.length;\n        for (let i = 0; i < n - 1; i += 2)\n            encoded += bin(t[i] * 45 + t[i + 1], 11);\n        if (n % 2 == 1)\n            encoded += bin(t[n - 1], 6); // pad if odd number of chars\n    }\n    else if (type === 'byte') {\n        const utf8 = encoder(data);\n        dataLen = utf8.length;\n        encoded = Array.from(utf8)\n            .map((i) => bin(i, 8))\n            .join('');\n    }\n    else {\n        throw new Error('encode: unsupported type');\n    }\n    const { capacity } = info.capacity(ver, ecc);\n    const len = bin(dataLen, info.lengthBits(ver, type));\n    let bits = info.modeBits[type] + len + encoded;\n    if (bits.length > capacity)\n        throw new Error('Capacity overflow');\n    // Terminator\n    bits += '0'.repeat(Math.min(4, Math.max(0, capacity - bits.length)));\n    // Pad bits string untill full byte\n    if (bits.length % 8)\n        bits += '0'.repeat(8 - (bits.length % 8));\n    // Add padding until capacity is full\n    const padding = '1110110000010001';\n    for (let idx = 0; bits.length !== capacity; idx++)\n        bits += padding[idx % padding.length];\n    // Convert a bitstring to array of bytes\n    const bytes = Uint8Array.from(bits.match(/(.{8})/g).map((i) => Number(`0b${i}`)));\n    return interleave(ver, ecc).encode(bytes);\n}\n// DRAW\nfunction drawQR(ver, ecc, data, maskIdx, test = false) {\n    const b = drawTemplate(ver, ecc, maskIdx, test);\n    let i = 0;\n    const need = 8 * data.length;\n    zigzag(b, maskIdx, (x, y, mask) => {\n        let value = false;\n        if (i < need) {\n            value = ((data[i >>> 3] >> ((7 - i) & 7)) & 1) !== 0;\n            i++;\n        }\n        b.data[y][x] = value !== mask; // !== as xor\n    });\n    if (i !== need)\n        throw new Error('QR: bytes left after draw');\n    return b;\n}\nfunction calculateRowRunPenalty(rowBits) {\n    const moduleCount = rowBits.length;\n    if (moduleCount <= 1)\n        return 0;\n    let penalty = 0;\n    let runLength = 1;\n    let previousColor = rowBits[0];\n    for (let i = 1; i < moduleCount; i++) {\n        const currentColor = rowBits[i];\n        if (currentColor === previousColor) {\n            runLength++;\n        }\n        else {\n            if (runLength >= R1_RUN_LENGTH_THRESHOLD)\n                penalty += runLength - 2;\n            runLength = 1;\n            previousColor = currentColor;\n        }\n    }\n    if (runLength >= R1_RUN_LENGTH_THRESHOLD)\n        penalty += runLength - 2;\n    return penalty;\n}\nfunction calculateColumnRunPenalty(bitmap, columnIndex, columnHeight) {\n    if (columnHeight <= 1)\n        return 0;\n    let penalty = 0;\n    let runLength = 1;\n    let previousColor = bitmap[0][columnIndex];\n    for (let y = 1; y < columnHeight; y++) {\n        const currentColor = bitmap[y][columnIndex];\n        if (currentColor === previousColor) {\n            runLength++;\n        }\n        else {\n            if (runLength >= R1_RUN_LENGTH_THRESHOLD)\n                penalty += runLength - 2;\n            runLength = 1;\n            previousColor = currentColor;\n        }\n    }\n    if (runLength >= R1_RUN_LENGTH_THRESHOLD)\n        penalty += runLength - 2;\n    return penalty;\n}\nfunction calculateRowFinderPenalty(rowBits) {\n    const rowLength = rowBits.length;\n    if (rowLength < R3_FINDER_PATTERN_LENGTH)\n        return 0;\n    let penalty = 0;\n    const lastStart = rowLength - R3_FINDER_PATTERN_LENGTH;\n    for (let i = 0; i <= lastStart; i++) {\n        // Case A: L L L L + 1 0 1 1 1 0 1\n        const light4ThenFinder7 = !rowBits[i] &&\n            !rowBits[i + 1] &&\n            !rowBits[i + 2] &&\n            !rowBits[i + 3] &&\n            rowBits[i + 4] &&\n            !rowBits[i + 5] &&\n            rowBits[i + 6] &&\n            rowBits[i + 7] &&\n            rowBits[i + 8] &&\n            !rowBits[i + 9] &&\n            rowBits[i + 10];\n        // Case B: 1 0 1 1 1 0 1 + L L L L\n        const finder7ThenLight4 = rowBits[i] &&\n            !rowBits[i + 1] &&\n            rowBits[i + 2] &&\n            rowBits[i + 3] &&\n            rowBits[i + 4] &&\n            !rowBits[i + 5] &&\n            rowBits[i + 6] &&\n            !rowBits[i + 7] &&\n            !rowBits[i + 8] &&\n            !rowBits[i + 9] &&\n            !rowBits[i + 10];\n        if (light4ThenFinder7 || finder7ThenLight4)\n            penalty += R3_FINDER_PENALTY;\n    }\n    return penalty;\n}\nfunction calculateColumnFinderPenalty(matrix, rowIndex, width) {\n    if (width < R3_FINDER_PATTERN_LENGTH)\n        return 0;\n    let penalty = 0;\n    const y = rowIndex;\n    const lastStart = width - R3_FINDER_PATTERN_LENGTH;\n    for (let x = 0; x <= lastStart; x++) {\n        // Case A: L L L L + 1 0 1 1 1 0 1\n        const light4ThenFinder7 = !matrix[x][y] &&\n            !matrix[x + 1][y] &&\n            !matrix[x + 2][y] &&\n            !matrix[x + 3][y] &&\n            matrix[x + 4][y] &&\n            !matrix[x + 5][y] &&\n            matrix[x + 6][y] &&\n            matrix[x + 7][y] &&\n            matrix[x + 8][y] &&\n            !matrix[x + 9][y] &&\n            matrix[x + 10][y];\n        // Case B: 1 0 1 1 1 0 1 + L L L L\n        const finder7ThenLight4 = matrix[x][y] &&\n            !matrix[x + 1][y] &&\n            matrix[x + 2][y] &&\n            matrix[x + 3][y] &&\n            matrix[x + 4][y] &&\n            !matrix[x + 5][y] &&\n            matrix[x + 6][y] &&\n            !matrix[x + 7][y] &&\n            !matrix[x + 8][y] &&\n            !matrix[x + 9][y] &&\n            !matrix[x + 10][y];\n        if (light4ThenFinder7 || finder7ThenLight4)\n            penalty += R3_FINDER_PENALTY;\n    }\n    return penalty;\n}\nfunction penalty(bitmap) {\n    const matrix = bitmap.data;\n    const width = bitmap.width | 0;\n    const height = bitmap.height | 0;\n    if (width === 0 || height === 0)\n        return 0;\n    // Rule 1: same-color runs\n    let runPenalty = 0;\n    for (let x = 0; x < width; x++)\n        runPenalty += calculateRowRunPenalty(matrix[x]);\n    for (let y = 0; y < height; y++)\n        runPenalty += calculateColumnRunPenalty(matrix, y, width);\n    // Rule 2: 22 blocks of the same color\n    let blockPenalty = 0;\n    const lastCol = width - 1;\n    const lastRow = height - 1;\n    for (let x = 0; x < lastCol; x++) {\n        const col = matrix[x];\n        const nextCol = matrix[x + 1];\n        for (let y = 0; y < lastRow; y++) {\n            const cell = col[y];\n            if (cell === nextCol[y] && cell === col[y + 1] && cell === nextCol[y + 1]) {\n                blockPenalty += R2_BLOCK_PENALTY;\n            }\n        }\n    }\n    // Rule 3: finder-like 1:1:3:1:1 with 4-light padding\n    let finderPenalty = 0;\n    for (let x = 0; x < width; x++)\n        finderPenalty += calculateRowFinderPenalty(matrix[x]);\n    for (let y = 0; y < height; y++)\n        finderPenalty += calculateColumnFinderPenalty(matrix, y, width);\n    // Rule 4: dark-module balance vs 50%\n    let darkCount = 0;\n    for (let x = 0; x < width; x++) {\n        const col = matrix[x];\n        for (let y = 0; y < height; y++)\n            if (col[y])\n                darkCount++;\n    }\n    const moduleCount = width * height;\n    const darkPercent = (darkCount * 100) / moduleCount;\n    const deviation = Math.abs(darkPercent - 50);\n    const balancePenalty = R4_BALANCE_STEP_POINTS * Math.floor(deviation / R4_BALANCE_STEP_PERCENT);\n    return runPenalty + blockPenalty + finderPenalty + balancePenalty;\n}\n// Selects best mask according to penalty, if no mask is provided\nfunction drawQRBest(ver, ecc, data, maskIdx) {\n    if (maskIdx === undefined) {\n        const bestMask = best();\n        for (let mask = 0; mask < PATTERNS.length; mask++)\n            bestMask.add(penalty(drawQR(ver, ecc, data, mask, true)), mask);\n        maskIdx = bestMask.get();\n    }\n    if (maskIdx === undefined)\n        throw new Error('Cannot find mask'); // Should never happen\n    return drawQR(ver, ecc, data, maskIdx);\n}\nfunction validateECC(ec) {\n    if (!ECMode.includes(ec))\n        throw new Error(`Invalid error correction mode=${ec}. Expected: ${ECMode}`);\n}\nfunction validateEncoding(enc) {\n    if (!Encoding.includes(enc))\n        throw new Error(`Encoding: invalid mode=${enc}. Expected: ${Encoding}`);\n    if (enc === 'kanji' || enc === 'eci')\n        throw new Error(`Encoding: ${enc} is not supported (yet?).`);\n}\nfunction validateMask(mask) {\n    if (![0, 1, 2, 3, 4, 5, 6, 7].includes(mask) || !PATTERNS[mask])\n        throw new Error(`Invalid mask=${mask}. Expected number [0..7]`);\n}\nexport function encodeQR(text, output = 'raw', opts = {}) {\n    const ecc = opts.ecc !== undefined ? opts.ecc : 'medium';\n    validateECC(ecc);\n    const encoding = opts.encoding !== undefined ? opts.encoding : detectType(text);\n    validateEncoding(encoding);\n    if (opts.mask !== undefined)\n        validateMask(opts.mask);\n    let ver = opts.version;\n    let data, err = new Error('Unknown error');\n    if (ver !== undefined) {\n        validateVersion(ver);\n        data = encode(ver, ecc, text, encoding, opts.textEncoder);\n    }\n    else {\n        // If no version is provided, try to find smallest one which fits\n        // Currently just scans all version, can be significantly speedup if needed\n        for (let i = 1; i <= 40; i++) {\n            try {\n                data = encode(i, ecc, text, encoding, opts.textEncoder);\n                ver = i;\n                break;\n            }\n            catch (e) {\n                err = e;\n            }\n        }\n    }\n    if (!ver || !data)\n        throw err;\n    let res = drawQRBest(ver, ecc, data, opts.mask);\n    res.assertDrawn();\n    const border = opts.border === undefined ? 2 : opts.border;\n    if (!Number.isSafeInteger(border))\n        throw new Error(`invalid border type=${typeof border}`);\n    res = res.border(border, false); // Add border\n    if (opts.scale !== undefined)\n        res = res.scale(opts.scale); // Scale image\n    if (output === 'raw')\n        return res.data;\n    else if (output === 'ascii')\n        return res.toASCII();\n    else if (output === 'svg')\n        return res.toSVG(opts.optimize);\n    else if (output === 'gif')\n        return res.toGIF();\n    else if (output === 'term')\n        return res.toTerm();\n    else\n        throw new Error(`Unknown output: ${output}`);\n}\nexport default encodeQR;\nexport const utils = {\n    best,\n    bin,\n    drawTemplate,\n    fillArr,\n    info,\n    interleave,\n    validateVersion,\n    zigzag,\n};\n// Unsafe API utils, exported only for tests\nexport const _tests = {\n    Bitmap,\n    info,\n    detectType,\n    encode,\n    drawQR,\n    penalty,\n    PATTERNS,\n};\n// Type tests\n// const o1 = qr('test', 'ascii');\n// const o2 = qr('test', 'raw');\n// const o3 = qr('test', 'gif');\n// const o4 = qr('test', 'svg');\n// const o5 = qr('test', 'term');\n//# sourceMappingURL=index.js.map","import './qr-code.css';\n\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport encodeQR from 'qr';\n\nconst canvas = window.OffscreenCanvas\n  ? new OffscreenCanvas(1, 1)\n  : document.createElement('canvas');\nconst ctx = canvas.getContext('2d', {\n  willReadFrequently: true,\n});\nctx.imageSmoothingEnabled = false;\n\nexport default function QrCode({\n  text,\n  arena,\n  backgroundMask,\n  arenaCircle = true,\n  caption,\n}) {\n  const captionRef = useRef(null);\n  const [captionHeight, setCaptionHeight] = useState(0);\n  const [arenaLoaded, setArenaLoaded] = useState(false);\n  const [arenaHasAlpha, setArenaHasAlpha] = useState(false);\n\n  const effectiveArenaCircle = arenaHasAlpha ? false : arenaCircle;\n\n  useEffect(() => {\n    if (caption && captionRef.current) {\n      const height = captionRef.current.offsetHeight;\n      setCaptionHeight(height);\n    }\n  }, [caption]);\n\n  useEffect(() => {\n    if (arena) {\n      const img = new Image();\n      img.crossOrigin = 'anonymous';\n      img.onload = () => {\n        setArenaLoaded(true);\n        try {\n          const { width, height } = img;\n          canvas.width = width;\n          canvas.height = height;\n          ctx.drawImage(img, 0, 0);\n          const allPixels = ctx.getImageData(0, 0, width, height);\n          const data = allPixels.data;\n          const totalPixels = data.length / 4;\n          let lowAlphaCount = 0;\n          let hasAlpha = false;\n          for (let i = 3; i < data.length; i += 4) {\n            if (data[i] <= 128) lowAlphaCount++;\n            if (lowAlphaCount / totalPixels > 0.1) {\n              hasAlpha = true;\n              break;\n            }\n          }\n          setArenaHasAlpha(hasAlpha);\n        } catch (e) {\n          setArenaHasAlpha(false);\n        }\n      };\n      img.onerror = (error) => {\n        console.error('Failed to load arena image:', error);\n        setArenaLoaded(true); // Still show the image even on CORS error\n      };\n      img.src = arena;\n    } else {\n      setArenaLoaded(false);\n    }\n  }, [arena]);\n\n  if (!text) return null;\n\n  const qrData = useMemo(\n    () =>\n      encodeQR(text, 'raw', {\n        ecc: 'high',\n        border: 0,\n        scale: 1,\n      }),\n    [text],\n  );\n  const gridSize = qrData.length;\n\n  const centerExcludeSize = arenaLoaded ? Math.ceil(gridSize * 0.3) : 0;\n  const centerStart = Math.floor((gridSize - centerExcludeSize) / 2);\n  const centerEnd = centerStart + centerExcludeSize;\n\n  const isFilled = (x, y) => {\n    if (x < 0 || x >= gridSize || y < 0 || y >= gridSize) return false;\n\n    if (\n      arenaLoaded &&\n      x >= centerStart &&\n      x < centerEnd &&\n      y >= centerStart &&\n      y < centerEnd\n    ) {\n      if (arenaCircle) {\n        const centerX = (centerStart + centerEnd) / 2;\n        const centerY = (centerStart + centerEnd) / 2;\n        const radius = centerExcludeSize / 2;\n        const dx = x + 0.5 - centerX;\n        const dy = y + 0.5 - centerY;\n        const distance = Math.sqrt(dx * dx + dy * dy);\n        if (distance < radius) return false;\n      } else {\n        return false;\n      }\n    }\n\n    return qrData[y][x];\n  };\n\n  const isFilledInGrid = (x, y) => {\n    if (x < 0 || x >= gridSize || y < 0 || y >= gridSize) return false;\n    return isFilled(x, y);\n  };\n\n  const isInPositionMarker = (x, y) => {\n    if (x < 7 && y < 7) return true;\n    if (x >= gridSize - 7 && y < 7) return true;\n    if (x < 7 && y >= gridSize - 7) return true;\n    return false;\n  };\n\n  const pathData = useMemo(() => {\n    let data = '';\n\n    for (let y = 0; y < gridSize; y++) {\n      for (let x = 0; x < gridSize; x++) {\n        if (!isFilledInGrid(x, y)) continue;\n        if (isInPositionMarker(x, y)) continue;\n\n        const cx = x + 0.5;\n        const cy = y + 0.5;\n        const hasTop =\n          isFilledInGrid(x, y - 1) && !isInPositionMarker(x, y - 1);\n        const hasRight =\n          isFilledInGrid(x + 1, y) && !isInPositionMarker(x + 1, y);\n        const hasBottom =\n          isFilledInGrid(x, y + 1) && !isInPositionMarker(x, y + 1);\n        const hasLeft =\n          isFilledInGrid(x - 1, y) && !isInPositionMarker(x - 1, y);\n\n        if (hasRight) {\n          data += `M ${cx} ${cy} L ${cx + 1} ${cy} `;\n        }\n        if (hasBottom) {\n          data += `M ${cx} ${cy} L ${cx} ${cy + 1} `;\n        }\n        if (!hasTop && !hasRight && !hasBottom && !hasLeft) {\n          data += `M ${cx} ${cy} L ${cx} ${cy} `;\n        }\n      }\n    }\n\n    return data;\n  }, [\n    gridSize,\n    qrData,\n    arenaLoaded,\n    centerStart,\n    centerEnd,\n    centerExcludeSize,\n    effectiveArenaCircle,\n  ]);\n\n  const markerPositions = [\n    { x: 0, y: 0 }, // Top-left\n    { x: gridSize - 7, y: 0 }, // Top-right\n    { x: 0, y: gridSize - 7 }, // Bottom-left\n  ];\n\n  const markerOuterRadius = 1.1; // Outer 7x7 square corner radius\n  const markerInnerRadius = 0.6; // Inner 3x3 square corner radius\n\n  const centerImagePadding = 1; // 1 cell width padding around the image\n  const centerImageSize = centerExcludeSize - centerImagePadding * 2;\n  const centerImageX = centerStart + centerImagePadding;\n  const centerImageY = centerStart + centerImagePadding;\n  const padding = 2;\n  const captionSpacing = 2; // Space between QR code and caption\n\n  const viewBoxWidth = gridSize + padding * 2;\n  const viewBoxHeight =\n    gridSize + padding * 2 + (caption ? captionSpacing + captionHeight : 0);\n  const bleed = viewBoxWidth * 0.25;\n\n  return (\n    <svg\n      class=\"qr-code\"\n      viewBox={`${-padding} ${-padding} ${viewBoxWidth} ${viewBoxHeight}`}\n      xmlns=\"http://www.w3.org/2000/svg\"\n      shape-rendering=\"geometricPrecision\"\n    >\n      <defs>\n        <g id=\"position-marker\">\n          <rect\n            x=\"0.5\"\n            y=\"0.5\"\n            width=\"6\"\n            height=\"6\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            stroke-width=\"1\"\n            rx={markerOuterRadius}\n            ry={markerOuterRadius}\n          />\n          <rect\n            x=\"2\"\n            y=\"2\"\n            width=\"3\"\n            height=\"3\"\n            fill=\"currentColor\"\n            rx={markerInnerRadius}\n            ry={markerInnerRadius}\n          />\n        </g>\n        <g id=\"position-marker-mask\">\n          <rect\n            x=\"0.5\"\n            y=\"0.5\"\n            width=\"6\"\n            height=\"6\"\n            fill=\"none\"\n            stroke=\"white\"\n            stroke-width=\"1\"\n            rx={markerOuterRadius}\n            ry={markerOuterRadius}\n          />\n          <rect\n            x=\"2\"\n            y=\"2\"\n            width=\"3\"\n            height=\"3\"\n            fill=\"white\"\n            rx={markerInnerRadius}\n            ry={markerInnerRadius}\n          />\n        </g>\n        {backgroundMask && (\n          <filter id=\"blur-mask\">\n            <feGaussianBlur in=\"SourceGraphic\" stdDeviation=\"2\" />\n            <feColorMatrix type=\"saturate\" values=\"2\" />\n            <feComponentTransfer>\n              <feFuncR type=\"linear\" slope=\"1.2\" intercept=\"0.3\" />\n              <feFuncG type=\"linear\" slope=\"1.2\" intercept=\"0.3\" />\n              <feFuncB type=\"linear\" slope=\"1.2\" intercept=\"0.3\" />\n            </feComponentTransfer>\n          </filter>\n        )}\n        {backgroundMask && (\n          <mask id=\"qr-pattern-mask\">\n            <path\n              fill=\"white\"\n              stroke=\"white\"\n              stroke-width=\"1\"\n              stroke-linejoin=\"round\"\n              stroke-linecap=\"round\"\n              d={pathData}\n            />\n            <g id=\"position-markers-mask\">\n              {markerPositions.map((pos) => (\n                <use\n                  key={`${pos.x}-${pos.y}`}\n                  href=\"#position-marker-mask\"\n                  x={pos.x}\n                  y={pos.y}\n                />\n              ))}\n            </g>\n            {arenaLoaded && effectiveArenaCircle && (\n              <circle\n                cx={centerImageX + centerImageSize / 2}\n                cy={centerImageY + centerImageSize / 2}\n                r={centerImageSize / 2}\n                fill=\"black\"\n              />\n            )}\n            {arenaLoaded && !arenaCircle && (\n              <rect\n                x={centerImageX}\n                y={centerImageY}\n                width={centerImageSize}\n                height={centerImageSize}\n                fill=\"black\"\n              />\n            )}\n          </mask>\n        )}\n        <path\n          id=\"qr-pattern\"\n          fill=\"currentColor\"\n          stroke=\"currentColor\"\n          stroke-width=\"1\"\n          stroke-linejoin=\"round\"\n          stroke-linecap=\"round\"\n          d={pathData}\n        />\n      </defs>\n      <use href=\"#qr-pattern\" />\n      <g id=\"position-markers\">\n        {markerPositions.map((pos) => (\n          <use\n            key={`${pos.x}-${pos.y}`}\n            href=\"#position-marker\"\n            x={pos.x}\n            y={pos.y}\n          />\n        ))}\n      </g>\n      {backgroundMask && (\n        <g mask=\"url(#qr-pattern-mask)\">\n          <image\n            href={backgroundMask}\n            x={-padding - bleed}\n            y={-padding - bleed}\n            width={viewBoxWidth + bleed * 2}\n            height={viewBoxWidth + bleed * 2}\n            preserveAspectRatio=\"none\"\n            opacity=\"0.5\"\n            filter=\"url(#blur-mask)\"\n          />\n        </g>\n      )}\n      {arena && arenaLoaded && (\n        <image\n          href={arena}\n          x={centerImageX}\n          y={centerImageY}\n          width={centerImageSize}\n          height={centerImageSize}\n          preserveAspectRatio=\"xMidYMid slice\"\n          clip-path={\n            effectiveArenaCircle\n              ? `circle(${centerImageSize / 2}px at ${centerImageSize / 2}px ${centerImageSize / 2}px)`\n              : undefined\n          }\n        />\n      )}\n      {caption && (\n        <foreignObject\n          x={0}\n          y={gridSize + captionSpacing}\n          width={gridSize}\n          height={captionHeight}\n        >\n          <div\n            ref={captionRef}\n            xmlns=\"http://www.w3.org/1999/xhtml\"\n            class=\"qr-code-caption\"\n            dangerouslySetInnerHTML={{ __html: caption }}\n          />\n        </foreignObject>\n      )}\n    </svg>\n  );\n}\n","import './qr-code-modal.css';\n\nimport { useLingui } from '@lingui/react/macro';\n\nimport Icon from './icon';\nimport QrCode from './qr-code';\n\nexport const mediaDevicesSupported = !!navigator.mediaDevices?.getUserMedia;\n\nfunction QrCodeModal({\n  text,\n  arena,\n  backgroundMask,\n  caption,\n  onClose,\n  onScannerClick,\n}) {\n  const { t } = useLingui();\n  console.log('onScannerClick', onScannerClick);\n\n  return (\n    <div class=\"qr-code-modal-container\">\n      <div class=\"qr-code-modal-controls\">\n        {mediaDevicesSupported && typeof onScannerClick === 'function' ? (\n          <button type=\"button\" class=\"plain4\" onClick={onScannerClick}>\n            <Icon icon=\"scan\" alt={t`Scan QR code`} />\n          </button>\n        ) : (\n          <span />\n        )}\n        {!!onClose && (\n          <button type=\"button\" class=\"plain4\" onClick={onClose}>\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n        )}\n      </div>\n      <QrCode\n        text={text}\n        arena={arena}\n        backgroundMask={backgroundMask}\n        caption={caption}\n      />\n      <div class=\"qr-code-text\">{text}</div>\n    </div>\n  );\n}\n\nexport default QrCodeModal;\n","import './qr-scanner-modal.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nconst hasBarcodeDetector = 'BarcodeDetector' in window;\n\nif (!hasBarcodeDetector) {\n  // Prefetch qr/dom.js for caching\n  setTimeout(() => {\n    import('qr/dom.js').catch(() => {});\n  }, 1000);\n}\n\nimport Icon from './icon';\nimport Loader from './loader';\n\n// Copied from qr/dom.js because it's not exported\nclass QRCamera {\n  constructor(stream, player) {\n    this.stream = stream;\n    this.player = player;\n    this.setStream(stream);\n  }\n  setStream(stream) {\n    this.stream = stream;\n    const { player } = this;\n    player.setAttribute('autoplay', '');\n    player.setAttribute('muted', '');\n    player.setAttribute('playsinline', '');\n    player.srcObject = stream;\n  }\n  async listDevices() {\n    if (!navigator.mediaDevices || !navigator.mediaDevices.enumerateDevices)\n      throw new Error('Media Devices not supported');\n    const devices = await navigator.mediaDevices.enumerateDevices();\n    return devices\n      .filter((device) => device.kind === 'videoinput')\n      .map((i) => ({\n        deviceId: i.deviceId,\n        label: i.label || `Camera ${i.deviceId}`,\n      }));\n  }\n  async setDevice(deviceId) {\n    this.stop();\n    const stream = await navigator.mediaDevices.getUserMedia({\n      video: { deviceId: { exact: deviceId } },\n    });\n    this.setStream(stream);\n  }\n  readFrame(canvas, fullSize = false) {\n    const { player } = this;\n    if (fullSize)\n      return canvas.drawImage(player, player.videoHeight, player.videoWidth);\n    const size = getSize(player);\n    return canvas.drawImage(player, size.height, size.width);\n  }\n  stop() {\n    for (const track of this.stream.getTracks()) track.stop();\n  }\n}\n\n// Copy of frontalCamera from qr/dom.js, but with custom constraints\nconst createQRCamera = async (player) => {\n  if (navigator.permissions?.query) {\n    try {\n      const permission = await navigator.permissions.query({\n        name: 'camera',\n      });\n      console.log('Camera permission status:', permission.state);\n\n      permission.addEventListener('change', () => {\n        console.log('Camera permission changed to:', permission.state);\n      });\n    } catch (err) {\n      console.warn('Permissions API camera query not supported:', err);\n    }\n  }\n\n  const stream = await navigator.mediaDevices.getUserMedia({\n    video: {\n      height: { ideal: 720 },\n      width: { ideal: 1280 },\n      facingMode: 'environment',\n    },\n  });\n  return new QRCamera(stream, player);\n};\n\nfunction QrScannerModal({ onClose, checkValidity, actionableText }) {\n  const { t, _ } = useLingui();\n  const containerRef = useRef(null);\n  const videoRef = useRef(null);\n  const overlayRef = useRef(null);\n  const [decodedText, setDecodedText] = useState('');\n  const [isScanning, setIsScanning] = useState(true);\n  const [uiState, setUIState] = useState('loading');\n\n  // Based on screen, not viewport or window\n  useEffect(() => {\n    // portrait as default\n    let handleScreenOrientationChange;\n    if (screen?.orientation?.type && containerRef.current) {\n      handleScreenOrientationChange = () => {\n        const screenOrientation = /landscape/.test(\n          window.screen.orientation.type,\n        )\n          ? 'landscape'\n          : 'portrait';\n        containerRef.current.classList.toggle(\n          'landscape',\n          screenOrientation === 'landscape',\n        );\n      };\n\n      screen.orientation.addEventListener(\n        'change',\n        handleScreenOrientationChange,\n      );\n      handleScreenOrientationChange();\n    }\n    return () => {\n      if (\n        handleScreenOrientationChange &&\n        screen?.orientation?.removeEventListener\n      ) {\n        screen.orientation.removeEventListener(\n          'change',\n          handleScreenOrientationChange,\n        );\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    let cancelMainLoop;\n    let cam;\n    let qrCanvas;\n    let detector;\n    let qrDom;\n\n    const startCamera = async () => {\n      try {\n        cam = await createQRCamera(videoRef.current);\n\n        if (hasBarcodeDetector) {\n          detector = new BarcodeDetector({ formats: ['qr_code'] });\n        } else {\n          qrDom = await import('qr/dom.js');\n          qrCanvas = new qrDom.QRCanvas(\n            {\n              overlay: overlayRef.current,\n            },\n            {\n              cropToSquare: false,\n              overlayMainColor: 'transparent',\n              overlayFinderColor: 'rgba(255, 0, 255, 0.5)',\n            },\n          );\n        }\n\n        // Start scanning loop when video plays (following demo pattern)\n        const video = videoRef.current;\n        if (video) {\n          video.addEventListener('loadedmetadata', () => {\n            setUIState('default');\n          });\n          video.addEventListener('play', () => {\n            // We won't have correct size until video starts playing\n            console.log('Video started playing, beginning scan loop');\n\n            // Get width, height from video\n            const { videoWidth: width, videoHeight: height } = video;\n\n            console.log('', { cam, video });\n\n            if (width && height) {\n              containerRef.current.style.setProperty(\n                '--long-dimension',\n                Math.max(width, height),\n              );\n              containerRef.current.style.setProperty(\n                '--short-dimension',\n                Math.min(width, height),\n              );\n            }\n\n            if (hasBarcodeDetector) {\n              const mainLoop = async () => {\n                try {\n                  const results = await detector.detect(videoRef.current);\n                  if (results.length > 0) {\n                    console.log('Scan result:', results[0].rawValue);\n                    setDecodedText(results[0].rawValue);\n                  }\n                } catch (e) {\n                  console.error('Error in barcode detection:', e);\n                }\n              };\n\n              let animationId;\n              const rafLoop = () => {\n                mainLoop();\n                animationId = requestAnimationFrame(rafLoop);\n              };\n              rafLoop();\n              cancelMainLoop = () => cancelAnimationFrame(animationId);\n            } else {\n              const mainLoop = () => {\n                try {\n                  const result = cam.readFrame(qrCanvas, true);\n                  if (result !== undefined && result !== null) {\n                    console.log('Scan result:', result);\n                    setDecodedText(result);\n                  }\n                } catch (e) {\n                  console.error('Error in scan loop:', e);\n                }\n              };\n\n              cancelMainLoop = qrDom.frameLoop(mainLoop);\n            }\n          });\n        }\n      } catch (err) {\n        console.error('Error accessing camera:', err);\n        setUIState('error');\n        setIsScanning(false);\n      }\n    };\n\n    if (isScanning) {\n      startCamera();\n    }\n\n    return () => {\n      if (cancelMainLoop) cancelMainLoop();\n      if (cam) {\n        cam.stop();\n      }\n      if (qrCanvas) {\n        qrCanvas.clear();\n      }\n    };\n  }, [isScanning]);\n\n  const showActionableButton =\n    typeof checkValidity === 'function'\n      ? checkValidity(decodedText)\n      : !!decodedText;\n\n  return (\n    <div class=\"qr-scanner-modal\">\n      <div class=\"qr-scanner-header\">\n        <Loader abrupt hidden={uiState !== 'loading'} />\n        <button type=\"button\" class=\"plain4\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      </div>\n      {uiState === 'error' ? (\n        <div class=\"ui-state\">\n          <p>\n            <Trans>Unable to access camera. Please check permissions.</Trans>\n          </p>\n        </div>\n      ) : (\n        <>\n          <div ref={containerRef} class=\"qr-scanner-video-container\">\n            <video ref={videoRef} playsInline muted disablepictureinpicture />\n            {!hasBarcodeDetector && (\n              <canvas ref={overlayRef} class=\"qr-scanner-canvas\" />\n            )}\n            <svg\n              class=\"qr-scanner-corner-hint\"\n              viewBox=\"0 0 100 100\"\n              preserveAspectRatio=\"xMidYMid meet\"\n            >\n              <path\n                d=\"M 25 10 L 15 10 Q 10 10 10 15 L 10 25\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n              <path\n                d=\"M 75 10 L 85 10 Q 90 10 90 15 L 90 25\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n              <path\n                d=\"M 25 90 L 15 90 Q 10 90 10 85 L 10 75\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n              <path\n                d=\"M 75 90 L 85 90 Q 90 90 90 85 L 90 75\"\n                stroke=\"currentColor\"\n                stroke-width=\"2\"\n                fill=\"none\"\n                stroke-linecap=\"round\"\n              />\n            </svg>\n          </div>\n          <div class=\"qr-scanner-result\">\n            {!!decodedText && (\n              <>\n                <p class=\"qr-scanner-text\">{decodedText}</p>\n                {showActionableButton && (\n                  <button\n                    type=\"button\"\n                    class=\"button plain6\"\n                    onClick={() => {\n                      onClose({ text: decodedText });\n                    }}\n                  >\n                    {actionableText ? (\n                      _(actionableText)\n                    ) : (\n                      <Icon icon=\"arrow-right\" />\n                    )}\n                  </button>\n                )}\n              </>\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default QrScannerModal;\n","import './report-modal.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { Fragment } from 'preact';\nimport { useMemo, useRef, useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport localeMatch from '../utils/locale-match';\nimport showToast from '../utils/show-toast';\nimport { getCurrentInstance } from '../utils/store-utils';\n\nimport AccountBlock from './account-block';\nimport Icon from './icon';\nimport Loader from './loader';\nimport Status from './status';\n\n// NOTE: `dislike` hidden for now, it's actually not used for reporting\n// Mastodon shows another screen for unfollowing, muting or blocking instead of reporting\n\nconst CATEGORIES = [/*'dislike' ,*/ 'spam', 'legal', 'violation', 'other'];\n// `violation` will be set if there are `rule_ids[]`\n\nconst CATEGORIES_INFO = {\n  // dislike: {\n  //   label: 'Dislike',\n  //   description: 'Not something you want to see',\n  // },\n  spam: {\n    label: msg`Spam`,\n    description: msg`Malicious links, fake engagement, or repetitive replies`,\n  },\n  legal: {\n    label: msg`Illegal`,\n    description: msg`Violates the law of your or the server's country`,\n  },\n  violation: {\n    label: msg`Server rule violation`,\n    description: msg`Breaks specific server rules`,\n    stampLabel: msg`Violation`,\n  },\n  other: {\n    label: msg`Other`,\n    description: msg`Issue doesn't fit other categories`,\n    excludeStamp: true,\n  },\n};\n\nfunction findMatchingLanguage(rule, currentLang) {\n  if (!rule.translations || !currentLang) return null;\n  const availableLanguages = Object.keys(rule.translations);\n  if (!availableLanguages?.length) return null;\n\n  let matchedLang = localeMatch([currentLang], availableLanguages, null);\n  if (!matchedLang) {\n    // localeMatch fails if there are keys like zhCn, zhTw\n    // Convert them something like zh-CN first, try again\n    // Detect uppercase, then split by dash\n    const normalizedLanguages = availableLanguages.map((lang) => {\n      const parts = lang.split(/(?=[A-Z])/);\n      return parts\n        .map((part, i) => (i === 0 ? part : part.toLowerCase()))\n        .join('-');\n    });\n    matchedLang = localeMatch([currentLang], normalizedLanguages, null);\n  }\n\n  // If matchedLang has dash, convert back to original format\n  // E.g. zh-cn to zhCn\n  if (matchedLang && matchedLang.includes('-')) {\n    const [lang, region] = matchedLang.split('-');\n    matchedLang = lang + region.charAt(0).toUpperCase() + region.slice(1);\n  }\n\n  return matchedLang;\n}\n\nfunction translateRules(rules, currentLang) {\n  if (!rules?.length) return [];\n  if (!currentLang) return rules;\n  return rules.map((rule) => {\n    const matchedLang = findMatchingLanguage(rule, currentLang);\n    return {\n      ...rule,\n      _translatedText: rule.translations?.[matchedLang]?.text || null,\n    };\n  });\n}\n\nfunction ReportModal({ account, post, onClose }) {\n  const { _, t, i18n } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [username, domain] = account.acct.split('@');\n\n  const [translatedRules, currentDomain] = useMemo(() => {\n    const { rules, domain } = getCurrentInstance();\n    const rawRules = rules || [];\n    return [translateRules(rawRules, i18n.locale), domain];\n  }, [i18n.locale]);\n\n  const [selectedCategory, setSelectedCategory] = useState(null);\n  const [showRules, setShowRules] = useState(false);\n\n  const rulesRef = useRef(null);\n  const [hasRules, setHasRules] = useState(false);\n\n  return (\n    <div class=\"report-modal-container\">\n      <div class=\"top-controls\">\n        <h1>{post ? t`Report Post` : t`Report @${username}`}</h1>\n        <button\n          type=\"button\"\n          class=\"plain4 small\"\n          disabled={uiState === 'loading'}\n          onClick={() => onClose()}\n        >\n          <Icon icon=\"x\" size=\"xl\" alt={t`Close`} />\n        </button>\n      </div>\n      <main>\n        <div class=\"report-preview\">\n          {post ? (\n            <Status status={post} size=\"s\" previewMode />\n          ) : (\n            <AccountBlock\n              account={account}\n              avatarSize=\"xxl\"\n              useAvatarStatic\n              showStats\n              showActivity\n            />\n          )}\n        </div>\n        {!!selectedCategory &&\n          !CATEGORIES_INFO[selectedCategory].excludeStamp && (\n            <span\n              class=\"rubber-stamp\"\n              key={selectedCategory}\n              aria-hidden=\"true\"\n            >\n              {_(\n                CATEGORIES_INFO[selectedCategory].stampLabel ||\n                  _(CATEGORIES_INFO[selectedCategory].label),\n              )}\n              <small>\n                <Trans>Pending review</Trans>\n              </small>\n            </span>\n          )}\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n\n            const formData = new FormData(e.target);\n            const entries = Object.fromEntries(formData.entries());\n            console.log('ENTRIES', entries);\n\n            let { category, comment, forward } = entries;\n            if (!comment) comment = undefined;\n            if (forward === 'on') forward = true;\n            const ruleIds =\n              category === 'violation'\n                ? Object.entries(entries)\n                    .filter(([key]) => key.startsWith('rule_ids'))\n                    .map(([key, value]) => value)\n                : undefined;\n\n            const params = {\n              category,\n              comment,\n              forward,\n              ruleIds,\n            };\n            console.log('PARAMS', params);\n\n            setUIState('loading');\n            (async () => {\n              try {\n                await masto.v1.reports.create({\n                  accountId: account.id,\n                  statusIds: post?.id ? [post.id] : undefined,\n                  category,\n                  comment,\n                  ruleIds,\n                  forward,\n                });\n                setUIState('success');\n                showToast(post ? t`Post reported` : t`Profile reported`);\n                onClose();\n              } catch (error) {\n                console.error(error);\n                setUIState('error');\n                showToast(\n                  error?.message ||\n                    (post\n                      ? t`Unable to report post`\n                      : t`Unable to report profile`),\n                );\n              }\n            })();\n          }}\n        >\n          <p>\n            {post\n              ? t`What's the issue with this post?`\n              : t`What's the issue with this profile?`}\n          </p>\n          <section class=\"report-categories\">\n            {CATEGORIES.map((category) =>\n              category === 'violation' && !translatedRules?.length ? null : (\n                <Fragment key={category}>\n                  <label class=\"report-category\">\n                    <input\n                      type=\"radio\"\n                      name=\"category\"\n                      value={category}\n                      required\n                      disabled={uiState === 'loading'}\n                      onChange={(e) => {\n                        setSelectedCategory(e.target.value);\n                        setShowRules(e.target.value === 'violation');\n                      }}\n                    />\n                    <span>\n                      {_(CATEGORIES_INFO[category].label)} &nbsp;\n                      <small class=\"ib insignificant\">\n                        {_(CATEGORIES_INFO[category].description)}\n                      </small>\n                    </span>\n                  </label>\n                  {category === 'violation' && !!translatedRules?.length && (\n                    <div\n                      class=\"shazam-container no-animation\"\n                      hidden={!showRules}\n                    >\n                      <div class=\"shazam-container-inner\">\n                        <div class=\"report-rules\" ref={rulesRef}>\n                          {translatedRules.map((rule, i) => (\n                            <label class=\"report-rule\" key={rule.id}>\n                              <input\n                                type=\"checkbox\"\n                                name={`rule_ids[${i}]`}\n                                value={rule.id}\n                                required={showRules && !hasRules}\n                                disabled={uiState === 'loading'}\n                                onChange={(e) => {\n                                  const { checked } = e.target;\n                                  if (checked) {\n                                    setHasRules(true);\n                                  } else {\n                                    const checkedInputs =\n                                      rulesRef.current.querySelectorAll(\n                                        'input:checked',\n                                      );\n                                    if (!checkedInputs.length) {\n                                      setHasRules(false);\n                                    }\n                                  }\n                                }}\n                              />\n                              <span>{rule._translatedText || rule.text}</span>\n                            </label>\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  )}\n                </Fragment>\n              ),\n            )}\n          </section>\n          <section class=\"report-comment\">\n            <p>\n              <label for=\"report-comment\">\n                <Trans>Additional info</Trans>\n              </label>\n            </p>\n            <textarea\n              maxlength=\"1000\"\n              rows=\"1\"\n              name=\"comment\"\n              id=\"report-comment\"\n              disabled={uiState === 'loading'}\n              required={!post} // Required if not reporting a post\n            />\n          </section>\n          {!!domain && domain !== currentDomain && (\n            <section>\n              <p>\n                <label>\n                  <input\n                    type=\"checkbox\"\n                    switch\n                    name=\"forward\"\n                    disabled={uiState === 'loading'}\n                  />{' '}\n                  <span>\n                    <Trans>\n                      Forward to <i>{domain}</i>\n                    </Trans>\n                  </span>\n                </label>\n              </p>\n            </section>\n          )}\n          <footer>\n            <button type=\"submit\" disabled={uiState === 'loading'}>\n              <Trans>Send Report</Trans>\n            </button>{' '}\n            <button\n              type=\"submit\"\n              class=\"plain2\"\n              disabled={uiState === 'loading'}\n              onClick={async () => {\n                try {\n                  await masto.v1.accounts.$select(account.id).mute(); // Infinite duration\n                  showToast(t`Muted ${username}`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to mute ${username}`);\n                }\n                // onSubmit will still run\n              }}\n            >\n              <Trans>\n                Send Report <small class=\"ib\">+ Mute profile</small>\n              </Trans>\n            </button>{' '}\n            <button\n              type=\"submit\"\n              class=\"plain2\"\n              disabled={uiState === 'loading'}\n              onClick={async () => {\n                try {\n                  await masto.v1.accounts.$select(account.id).block();\n                  showToast(t`Blocked ${username}`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to block ${username}`);\n                }\n                // onSubmit will still run\n              }}\n            >\n              <Trans>\n                Send Report <small class=\"ib\">+ Block profile</small>\n              </Trans>\n            </button>\n            <Loader hidden={uiState !== 'loading'} />\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nexport default ReportModal;\n","// Copyright (c) 2013 Pieroxy <pieroxy@pieroxy.net>\n// This work is free. You can redistribute it and/or modify it\n// under the terms of the WTFPL, Version 2\n// For more information see LICENSE.txt or http://www.wtfpl.net/\n//\n// For more information, the home page:\n// http://pieroxy.net/blog/pages/lz-string/testing.html\n//\n// LZ-based compression algorithm, version 1.4.5\nvar LZString = (function() {\n\n// private property\nvar f = String.fromCharCode;\nvar keyStrBase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\nvar keyStrUriSafe = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\";\nvar baseReverseDic = {};\n\nfunction getBaseValue(alphabet, character) {\n  if (!baseReverseDic[alphabet]) {\n    baseReverseDic[alphabet] = {};\n    for (var i=0 ; i<alphabet.length ; i++) {\n      baseReverseDic[alphabet][alphabet.charAt(i)] = i;\n    }\n  }\n  return baseReverseDic[alphabet][character];\n}\n\nvar LZString = {\n  compressToBase64 : function (input) {\n    if (input == null) return \"\";\n    var res = LZString._compress(input, 6, function(a){return keyStrBase64.charAt(a);});\n    switch (res.length % 4) { // To produce valid Base64\n    default: // When could this happen ?\n    case 0 : return res;\n    case 1 : return res+\"===\";\n    case 2 : return res+\"==\";\n    case 3 : return res+\"=\";\n    }\n  },\n\n  decompressFromBase64 : function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrBase64, input.charAt(index)); });\n  },\n\n  compressToUTF16 : function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 15, function(a){return f(a+32);}) + \" \";\n  },\n\n  decompressFromUTF16: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 16384, function(index) { return compressed.charCodeAt(index) - 32; });\n  },\n\n  //compress into uint8array (UCS-2 big endian format)\n  compressToUint8Array: function (uncompressed) {\n    var compressed = LZString.compress(uncompressed);\n    var buf=new Uint8Array(compressed.length*2); // 2 bytes per character\n\n    for (var i=0, TotalLen=compressed.length; i<TotalLen; i++) {\n      var current_value = compressed.charCodeAt(i);\n      buf[i*2] = current_value >>> 8;\n      buf[i*2+1] = current_value % 256;\n    }\n    return buf;\n  },\n\n  //decompress from uint8array (UCS-2 big endian format)\n  decompressFromUint8Array:function (compressed) {\n    if (compressed===null || compressed===undefined){\n        return LZString.decompress(compressed);\n    } else {\n        var buf=new Array(compressed.length/2); // 2 bytes per character\n        for (var i=0, TotalLen=buf.length; i<TotalLen; i++) {\n          buf[i]=compressed[i*2]*256+compressed[i*2+1];\n        }\n\n        var result = [];\n        buf.forEach(function (c) {\n          result.push(f(c));\n        });\n        return LZString.decompress(result.join(''));\n\n    }\n\n  },\n\n\n  //compress into a string that is already URI encoded\n  compressToEncodedURIComponent: function (input) {\n    if (input == null) return \"\";\n    return LZString._compress(input, 6, function(a){return keyStrUriSafe.charAt(a);});\n  },\n\n  //decompress from an output of compressToEncodedURIComponent\n  decompressFromEncodedURIComponent:function (input) {\n    if (input == null) return \"\";\n    if (input == \"\") return null;\n    input = input.replace(/ /g, \"+\");\n    return LZString._decompress(input.length, 32, function(index) { return getBaseValue(keyStrUriSafe, input.charAt(index)); });\n  },\n\n  compress: function (uncompressed) {\n    return LZString._compress(uncompressed, 16, function(a){return f(a);});\n  },\n  _compress: function (uncompressed, bitsPerChar, getCharFromInt) {\n    if (uncompressed == null) return \"\";\n    var i, value,\n        context_dictionary= {},\n        context_dictionaryToCreate= {},\n        context_c=\"\",\n        context_wc=\"\",\n        context_w=\"\",\n        context_enlargeIn= 2, // Compensate for the first entry which should not count\n        context_dictSize= 3,\n        context_numBits= 2,\n        context_data=[],\n        context_data_val=0,\n        context_data_position=0,\n        ii;\n\n    for (ii = 0; ii < uncompressed.length; ii += 1) {\n      context_c = uncompressed.charAt(ii);\n      if (!Object.prototype.hasOwnProperty.call(context_dictionary,context_c)) {\n        context_dictionary[context_c] = context_dictSize++;\n        context_dictionaryToCreate[context_c] = true;\n      }\n\n      context_wc = context_w + context_c;\n      if (Object.prototype.hasOwnProperty.call(context_dictionary,context_wc)) {\n        context_w = context_wc;\n      } else {\n        if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n          if (context_w.charCodeAt(0)<256) {\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<8 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          } else {\n            value = 1;\n            for (i=0 ; i<context_numBits ; i++) {\n              context_data_val = (context_data_val << 1) | value;\n              if (context_data_position ==bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = 0;\n            }\n            value = context_w.charCodeAt(0);\n            for (i=0 ; i<16 ; i++) {\n              context_data_val = (context_data_val << 1) | (value&1);\n              if (context_data_position == bitsPerChar-1) {\n                context_data_position = 0;\n                context_data.push(getCharFromInt(context_data_val));\n                context_data_val = 0;\n              } else {\n                context_data_position++;\n              }\n              value = value >> 1;\n            }\n          }\n          context_enlargeIn--;\n          if (context_enlargeIn == 0) {\n            context_enlargeIn = Math.pow(2, context_numBits);\n            context_numBits++;\n          }\n          delete context_dictionaryToCreate[context_w];\n        } else {\n          value = context_dictionary[context_w];\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n\n\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        // Add wc to the dictionary.\n        context_dictionary[context_wc] = context_dictSize++;\n        context_w = String(context_c);\n      }\n    }\n\n    // Output the code for w.\n    if (context_w !== \"\") {\n      if (Object.prototype.hasOwnProperty.call(context_dictionaryToCreate,context_w)) {\n        if (context_w.charCodeAt(0)<256) {\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<8 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        } else {\n          value = 1;\n          for (i=0 ; i<context_numBits ; i++) {\n            context_data_val = (context_data_val << 1) | value;\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = 0;\n          }\n          value = context_w.charCodeAt(0);\n          for (i=0 ; i<16 ; i++) {\n            context_data_val = (context_data_val << 1) | (value&1);\n            if (context_data_position == bitsPerChar-1) {\n              context_data_position = 0;\n              context_data.push(getCharFromInt(context_data_val));\n              context_data_val = 0;\n            } else {\n              context_data_position++;\n            }\n            value = value >> 1;\n          }\n        }\n        context_enlargeIn--;\n        if (context_enlargeIn == 0) {\n          context_enlargeIn = Math.pow(2, context_numBits);\n          context_numBits++;\n        }\n        delete context_dictionaryToCreate[context_w];\n      } else {\n        value = context_dictionary[context_w];\n        for (i=0 ; i<context_numBits ; i++) {\n          context_data_val = (context_data_val << 1) | (value&1);\n          if (context_data_position == bitsPerChar-1) {\n            context_data_position = 0;\n            context_data.push(getCharFromInt(context_data_val));\n            context_data_val = 0;\n          } else {\n            context_data_position++;\n          }\n          value = value >> 1;\n        }\n\n\n      }\n      context_enlargeIn--;\n      if (context_enlargeIn == 0) {\n        context_enlargeIn = Math.pow(2, context_numBits);\n        context_numBits++;\n      }\n    }\n\n    // Mark the end of the stream\n    value = 2;\n    for (i=0 ; i<context_numBits ; i++) {\n      context_data_val = (context_data_val << 1) | (value&1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data_position = 0;\n        context_data.push(getCharFromInt(context_data_val));\n        context_data_val = 0;\n      } else {\n        context_data_position++;\n      }\n      value = value >> 1;\n    }\n\n    // Flush the last char\n    while (true) {\n      context_data_val = (context_data_val << 1);\n      if (context_data_position == bitsPerChar-1) {\n        context_data.push(getCharFromInt(context_data_val));\n        break;\n      }\n      else context_data_position++;\n    }\n    return context_data.join('');\n  },\n\n  decompress: function (compressed) {\n    if (compressed == null) return \"\";\n    if (compressed == \"\") return null;\n    return LZString._decompress(compressed.length, 32768, function(index) { return compressed.charCodeAt(index); });\n  },\n\n  _decompress: function (length, resetValue, getNextValue) {\n    var dictionary = [],\n        next,\n        enlargeIn = 4,\n        dictSize = 4,\n        numBits = 3,\n        entry = \"\",\n        result = [],\n        i,\n        w,\n        bits, resb, maxpower, power,\n        c,\n        data = {val:getNextValue(0), position:resetValue, index:1};\n\n    for (i = 0; i < 3; i += 1) {\n      dictionary[i] = i;\n    }\n\n    bits = 0;\n    maxpower = Math.pow(2,2);\n    power=1;\n    while (power!=maxpower) {\n      resb = data.val & data.position;\n      data.position >>= 1;\n      if (data.position == 0) {\n        data.position = resetValue;\n        data.val = getNextValue(data.index++);\n      }\n      bits |= (resb>0 ? 1 : 0) * power;\n      power <<= 1;\n    }\n\n    switch (next = bits) {\n      case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n        c = f(bits);\n        break;\n      case 2:\n        return \"\";\n    }\n    dictionary[3] = c;\n    w = c;\n    result.push(c);\n    while (true) {\n      if (data.index > length) {\n        return \"\";\n      }\n\n      bits = 0;\n      maxpower = Math.pow(2,numBits);\n      power=1;\n      while (power!=maxpower) {\n        resb = data.val & data.position;\n        data.position >>= 1;\n        if (data.position == 0) {\n          data.position = resetValue;\n          data.val = getNextValue(data.index++);\n        }\n        bits |= (resb>0 ? 1 : 0) * power;\n        power <<= 1;\n      }\n\n      switch (c = bits) {\n        case 0:\n          bits = 0;\n          maxpower = Math.pow(2,8);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 1:\n          bits = 0;\n          maxpower = Math.pow(2,16);\n          power=1;\n          while (power!=maxpower) {\n            resb = data.val & data.position;\n            data.position >>= 1;\n            if (data.position == 0) {\n              data.position = resetValue;\n              data.val = getNextValue(data.index++);\n            }\n            bits |= (resb>0 ? 1 : 0) * power;\n            power <<= 1;\n          }\n          dictionary[dictSize++] = f(bits);\n          c = dictSize-1;\n          enlargeIn--;\n          break;\n        case 2:\n          return result.join('');\n      }\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n      if (dictionary[c]) {\n        entry = dictionary[c];\n      } else {\n        if (c === dictSize) {\n          entry = w + w.charAt(0);\n        } else {\n          return null;\n        }\n      }\n      result.push(entry);\n\n      // Add w+entry[0] to the dictionary.\n      dictionary[dictSize++] = w + entry.charAt(0);\n      enlargeIn--;\n\n      w = entry;\n\n      if (enlargeIn == 0) {\n        enlargeIn = Math.pow(2, numBits);\n        numBits++;\n      }\n\n    }\n  }\n};\n  return LZString;\n})();\n\nif (typeof define === 'function' && define.amd) {\n  define(function () { return LZString; });\n} else if( typeof module !== 'undefined' && module != null ) {\n  module.exports = LZString\n} else if( typeof angular !== 'undefined' && angular != null ) {\n  angular.module('LZString', [])\n  .factory('LZString', function () {\n    return LZString;\n  });\n}\n","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e\"","import { api } from '../utils/api';\nimport store from '../utils/store';\n\nconst LIMIT = 200;\nconst MAX_FETCH = 10;\n\nexport async function fetchFollowedTags() {\n  const { masto } = api();\n  const iterator = masto.v1.followedTags\n    .list({\n      limit: LIMIT,\n    })\n    .values();\n  const tags = [];\n  let fetchCount = 0;\n  do {\n    const { value, done } = await iterator.next();\n    if (done || value?.length === 0) break;\n    tags.push(...value);\n    fetchCount++;\n  } while (fetchCount < MAX_FETCH);\n  tags.sort((a, b) => a.name.localeCompare(b.name));\n  console.log(tags);\n\n  if (tags.length) {\n    setTimeout(() => {\n      // Save to local storage, with saved timestamp\n      store.account.set('followedTags', {\n        tags,\n        updatedAt: Date.now(),\n      });\n    }, 1);\n  }\n\n  return tags;\n}\n\nconst MAX_AGE = 24 * 60 * 60 * 1000; // 1 day\nexport async function getFollowedTags() {\n  try {\n    const { tags, updatedAt } = store.account.get('followedTags') || {};\n    if (!tags?.length) return await fetchFollowedTags();\n    if (Date.now() - updatedAt > MAX_AGE) {\n      // Stale-while-revalidate\n      fetchFollowedTags();\n      return tags;\n    }\n    return tags;\n  } catch (e) {\n    return [];\n  }\n}\n\nconst fauxDiv = document.createElement('div');\nexport const extractTagsFromStatus = (content) => {\n  if (!content) return [];\n  if (content.indexOf('#') === -1) return [];\n  fauxDiv.innerHTML = content;\n  const hashtagLinks = fauxDiv.querySelectorAll('a.hashtag');\n  if (!hashtagLinks.length) return [];\n  return Array.from(hashtagLinks).map((a) =>\n    a.innerText.trim().replace(/^[^#]*#+/, ''),\n  );\n};\n","import { useEffect, useState } from 'preact/hooks';\n\nfunction AsyncText({ children }) {\n  if (typeof children === 'string') return children;\n  const [text, setText] = useState('');\n  useEffect(() => {\n    Promise.resolve(children).then(setText);\n  }, [children]);\n  return text;\n}\n\nexport default AsyncText;\n","import './shortcuts-settings.css';\n\nimport { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { msg, t } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport {\n  compressToEncodedURIComponent,\n  decompressFromEncodedURIComponent,\n} from 'lz-string';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport floatingButtonUrl from '../assets/floating-button.svg';\nimport multiColumnUrl from '../assets/multi-column.svg';\nimport tabMenuBarUrl from '../assets/tab-menu-bar.svg';\n\nimport { api } from '../utils/api';\nimport { fetchFollowedTags } from '../utils/followed-tags';\nimport { getLists, getListTitle } from '../utils/lists';\nimport pmem from '../utils/pmem';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport { getCurrentAccountID } from '../utils/store-utils';\n\nimport AsyncText from './AsyncText';\nimport Icon from './icon';\nimport MenuConfirm from './menu-confirm';\nimport Modal from './modal';\nimport { mediaDevicesSupported } from './qr-code-modal';\n\nexport const SHORTCUTS_LIMIT = 9;\n\nconst TYPES = [\n  'following',\n  'mentions',\n  'notifications',\n  'list',\n  'public',\n  'trending',\n  'search',\n  'hashtag',\n  'bookmarks',\n  'favourites',\n  // NOTE: Hide for now\n  // 'account-statuses', // Need @acct search first\n];\nconst TYPE_TEXT = {\n  following: msg`Home / Following`,\n  notifications: msg`Notifications`,\n  list: msg`Lists`,\n  public: msg`Public (Local / Federated)`,\n  search: msg`Search`,\n  'account-statuses': msg`Account`,\n  bookmarks: msg`Bookmarks`,\n  favourites: msg`Likes`,\n  hashtag: msg`Hashtag`,\n  trending: msg`Trending`,\n  mentions: msg`Mentions`,\n};\nconst TYPE_PARAMS = {\n  list: [\n    {\n      text: msg`List ID`,\n      name: 'id',\n      notRequired: true,\n    },\n  ],\n  public: [\n    {\n      text: msg`Local only`,\n      name: 'local',\n      type: 'checkbox',\n    },\n    {\n      text: msg`Instance`,\n      name: 'instance',\n      type: 'text',\n      placeholder: msg`Optional, e.g. mastodon.social`,\n      notRequired: true,\n    },\n  ],\n  trending: [\n    {\n      text: msg`Instance`,\n      name: 'instance',\n      type: 'text',\n      placeholder: msg`Optional, e.g. mastodon.social`,\n      notRequired: true,\n    },\n  ],\n  search: [\n    {\n      text: msg`Search term`,\n      name: 'query',\n      type: 'text',\n      placeholder: msg`Optional, unless for multi-column mode`,\n      notRequired: true,\n    },\n  ],\n  'account-statuses': [\n    {\n      text: '@',\n      name: 'id',\n      type: 'text',\n      placeholder: 'cheeaun@mastodon.social',\n    },\n  ],\n  hashtag: [\n    {\n      text: '#',\n      name: 'hashtag',\n      type: 'text',\n      placeholder: msg`e.g. PixelArt (Max 5, space-separated)`,\n      pattern: '[^#]+',\n    },\n    {\n      text: msg`Media only`,\n      name: 'media',\n      type: 'checkbox',\n    },\n    {\n      text: msg`Instance`,\n      name: 'instance',\n      type: 'text',\n      placeholder: msg`Optional, e.g. mastodon.social`,\n      notRequired: true,\n    },\n  ],\n};\nconst fetchAccountTitle = pmem(async ({ id }) => {\n  const account = await api().masto.v1.accounts.$select(id).fetch();\n  return account.username || account.acct || account.displayName;\n});\nexport const SHORTCUTS_META = {\n  following: {\n    id: 'home',\n    title: (_, index) =>\n      index === 0\n        ? t`Home`\n        : t({ id: 'following.title', message: 'Following' }),\n    path: '/',\n    icon: 'home',\n  },\n  mentions: {\n    id: 'mentions',\n    title: msg`Mentions`,\n    path: '/mentions',\n    icon: 'at',\n  },\n  notifications: {\n    id: 'notifications',\n    title: msg`Notifications`,\n    path: '/notifications',\n    icon: 'notification',\n  },\n  list: {\n    id: ({ id }) => (id ? 'list' : 'lists'),\n    title: ({ id }) => (id ? getListTitle(id) : t`Lists`),\n    path: ({ id }) => (id ? `/l/${id}` : '/l'),\n    icon: 'list',\n    excludeViewMode: ({ id }) => (!id ? ['multi-column'] : []),\n  },\n  public: {\n    id: 'public',\n    title: ({ local }) => (local ? t`Local` : t`Federated`),\n    subtitle: ({ instance }) => instance || api().instance,\n    path: ({ local, instance }) => `/${instance}/p${local ? '/l' : ''}`,\n    icon: ({ local }) => (local ? 'building' : 'earth'),\n  },\n  trending: {\n    id: 'trending',\n    title: msg`Trending`,\n    subtitle: ({ instance }) => instance || api().instance,\n    path: ({ instance }) => `/${instance}/trending`,\n    icon: 'chart',\n  },\n  search: {\n    id: 'search',\n    title: ({ query }) => (query ? `${query}` : t`Search`),\n    path: ({ query }) =>\n      query\n        ? `/search?q=${encodeURIComponent(query)}&type=statuses`\n        : '/search',\n    icon: 'search',\n    excludeViewMode: ({ query }) => (!query ? ['multi-column'] : []),\n  },\n  'account-statuses': {\n    id: 'account-statuses',\n    title: fetchAccountTitle,\n    path: ({ id }) => `/a/${id}`,\n    icon: 'user',\n  },\n  bookmarks: {\n    id: 'bookmarks',\n    title: msg`Bookmarks`,\n    path: '/b',\n    icon: 'bookmark',\n  },\n  favourites: {\n    id: 'favourites',\n    title: msg`Likes`,\n    path: '/f',\n    icon: 'heart',\n  },\n  hashtag: {\n    id: 'hashtag',\n    title: ({ hashtag }) => hashtag,\n    subtitle: ({ instance }) => instance || api().instance,\n    path: ({ hashtag, instance, media }) =>\n      `${instance ? `/${instance}` : ''}/t/${hashtag.split(/\\s+/).join('+')}${\n        media ? '?media=1' : ''\n      }`,\n    icon: 'hashtag',\n  },\n};\n\nfunction ShortcutsSettings({ onClose }) {\n  const { _ } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { shortcuts } = snapStates;\n  const [showForm, setShowForm] = useState(false);\n  const [showImportExport, setShowImportExport] = useState(false);\n\n  const [shortcutsListParent] = useAutoAnimate();\n\n  return (\n    <div id=\"shortcuts-settings-container\" class=\"sheet\" tabindex=\"-1\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Icon icon=\"shortcut\" /> <Trans>Shortcuts</Trans>{' '}\n          <sup\n            style={{\n              fontSize: 12,\n              opacity: 0.5,\n              textTransform: 'uppercase',\n            }}\n          >\n            <Trans>beta</Trans>\n          </sup>\n        </h2>\n      </header>\n      <main>\n        <p>\n          <Trans>Specify a list of shortcuts that'll appear&nbsp;as:</Trans>\n        </p>\n        <div class=\"shortcuts-view-mode\">\n          {[\n            {\n              value: 'float-button',\n              label: t`Floating button`,\n              imgURL: floatingButtonUrl,\n            },\n            {\n              value: 'tab-menu-bar',\n              label: t`Tab/Menu bar`,\n              imgURL: tabMenuBarUrl,\n            },\n            {\n              value: 'multi-column',\n              label: t`Multi-column`,\n              imgURL: multiColumnUrl,\n            },\n          ].map(({ value, label, imgURL }) => {\n            const checked =\n              snapStates.settings.shortcutsViewMode === value ||\n              (value === 'float-button' &&\n                !snapStates.settings.shortcutsViewMode);\n            return (\n              <label key={value} class={checked ? 'checked' : ''}>\n                <input\n                  type=\"radio\"\n                  name=\"shortcuts-view-mode\"\n                  value={value}\n                  checked={checked}\n                  onChange={(e) => {\n                    states.settings.shortcutsViewMode = e.target.value;\n                  }}\n                />{' '}\n                <img src={imgURL} alt=\"\" width=\"80\" height=\"58\" />{' '}\n                <span>{label}</span>\n              </label>\n            );\n          })}\n        </div>\n        {shortcuts.length > 0 ? (\n          <>\n            <ol class=\"shortcuts-list\" ref={shortcutsListParent}>\n              {shortcuts.filter(Boolean).map((shortcut, i) => {\n                // const key = i + Object.values(shortcut);\n                const key = Object.values(shortcut).join('-');\n                const { type } = shortcut;\n                if (!SHORTCUTS_META[type]) return null;\n                let { icon, title, subtitle, excludeViewMode } =\n                  SHORTCUTS_META[type];\n                if (typeof title === 'function') {\n                  title = title(shortcut, i);\n                } else {\n                  title = _(title);\n                }\n                if (typeof subtitle === 'function') {\n                  subtitle = subtitle(shortcut, i);\n                } else {\n                  subtitle = _(subtitle);\n                }\n                if (typeof icon === 'function') {\n                  icon = icon(shortcut, i);\n                }\n                if (typeof excludeViewMode === 'function') {\n                  excludeViewMode = excludeViewMode(shortcut, i);\n                }\n                const excludedViewMode = excludeViewMode?.includes(\n                  snapStates.settings.shortcutsViewMode,\n                );\n                return (\n                  <li key={key}>\n                    <Icon icon={icon} />\n                    <span class=\"shortcut-text\">\n                      <AsyncText>{title}</AsyncText>\n                      {subtitle && (\n                        <>\n                          {' '}\n                          <small class=\"ib insignificant\">{subtitle}</small>\n                        </>\n                      )}\n                      {excludedViewMode && (\n                        <span class=\"tag\">\n                          <Trans>Not available in current view mode</Trans>\n                        </span>\n                      )}\n                    </span>\n                    <span class=\"shortcut-actions\">\n                      <button\n                        type=\"button\"\n                        class=\"plain small\"\n                        disabled={i === 0}\n                        onClick={() => {\n                          const shortcutsArr = Array.from(states.shortcuts);\n                          if (i > 0) {\n                            const temp = states.shortcuts[i - 1];\n                            shortcutsArr[i - 1] = shortcut;\n                            shortcutsArr[i] = temp;\n                            states.shortcuts = shortcutsArr;\n                          }\n                        }}\n                      >\n                        <Icon icon=\"arrow-up\" alt={t`Move up`} />\n                      </button>\n                      <button\n                        type=\"button\"\n                        class=\"plain small\"\n                        disabled={i === shortcuts.length - 1}\n                        onClick={() => {\n                          const shortcutsArr = Array.from(states.shortcuts);\n                          if (i < states.shortcuts.length - 1) {\n                            const temp = states.shortcuts[i + 1];\n                            shortcutsArr[i + 1] = shortcut;\n                            shortcutsArr[i] = temp;\n                            states.shortcuts = shortcutsArr;\n                          }\n                        }}\n                      >\n                        <Icon icon=\"arrow-down\" alt={t`Move down`} />\n                      </button>\n                      <button\n                        type=\"button\"\n                        class=\"plain small\"\n                        onClick={() => {\n                          setShowForm({\n                            shortcut,\n                            shortcutIndex: i,\n                          });\n                        }}\n                      >\n                        <Icon icon=\"pencil\" alt={t`Edit`} />\n                      </button>\n                      {/* <button\n                      type=\"button\"\n                      class=\"plain small\"\n                      onClick={() => {\n                        states.shortcuts.splice(i, 1);\n                      }}\n                    >\n                      <Icon icon=\"x\" alt=\"Remove\" />\n                    </button> */}\n                    </span>\n                  </li>\n                );\n              })}\n            </ol>\n            {shortcuts.length === 1 &&\n              snapStates.settings.shortcutsViewMode !== 'float-button' && (\n                <div class=\"ui-state insignificant\">\n                  <Icon icon=\"info\" />{' '}\n                  <small>\n                    <Trans>\n                      Add more than one shortcut/column to make this work.\n                    </Trans>\n                  </small>\n                </div>\n              )}\n          </>\n        ) : (\n          <div class=\"ui-state insignificant\">\n            <p>\n              {snapStates.settings.shortcutsViewMode === 'multi-column'\n                ? t`No columns yet. Tap on the Add column button.`\n                : t`No shortcuts yet. Tap on the Add shortcut button.`}\n            </p>\n            <p>\n              <Trans>\n                Not sure what to add?\n                <br />\n                Try adding{' '}\n                <a\n                  href=\"#\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.shortcuts = [\n                      {\n                        type: 'following',\n                      },\n                      {\n                        type: 'notifications',\n                      },\n                    ];\n                  }}\n                >\n                  Home / Following and Notifications\n                </a>{' '}\n                first.\n              </Trans>\n            </p>\n          </div>\n        )}\n        <p class=\"insignificant\">\n          {shortcuts.length >= SHORTCUTS_LIMIT &&\n            (snapStates.settings.shortcutsViewMode === 'multi-column'\n              ? t`Max ${SHORTCUTS_LIMIT} columns`\n              : t`Max ${SHORTCUTS_LIMIT} shortcuts`)}\n        </p>\n        <p\n          style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n          }}\n        >\n          <button\n            type=\"button\"\n            class=\"light\"\n            onClick={() => setShowImportExport(true)}\n          >\n            <Trans>Import/export</Trans>\n          </button>\n          <button\n            type=\"button\"\n            disabled={shortcuts.length >= SHORTCUTS_LIMIT}\n            onClick={() => setShowForm(true)}\n          >\n            <Icon icon=\"plus\" />{' '}\n            <span>\n              {snapStates.settings.shortcutsViewMode === 'multi-column'\n                ? t`Add column`\n                : t`Add shortcut`}\n            </span>\n          </button>\n        </p>\n      </main>\n      {showForm && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowForm(false);\n            }\n          }}\n        >\n          <ShortcutForm\n            shortcut={showForm.shortcut}\n            shortcutIndex={showForm.shortcutIndex}\n            onSubmit={({ result, mode }) => {\n              console.log('onSubmit', result);\n              if (mode === 'edit') {\n                states.shortcuts[showForm.shortcutIndex] = result;\n              } else {\n                states.shortcuts.push(result);\n              }\n            }}\n            onClose={() => setShowForm(false)}\n          />\n        </Modal>\n      )}\n      {showImportExport && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowImportExport(false);\n            }\n          }}\n        >\n          <ImportExport\n            shortcuts={shortcuts}\n            onClose={() => setShowImportExport(false)}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nconst FORM_NOTES = {\n  list: msg`Specific list is optional. For multi-column mode, list is required, else the column will not be shown.`,\n  search: msg`For multi-column mode, search term is required, else the column will not be shown.`,\n  hashtag: msg`Multiple hashtags are supported. Space-separated.`,\n};\n\nfunction ShortcutForm({\n  onSubmit,\n  disabled,\n  shortcut,\n  shortcutIndex,\n  onClose,\n}) {\n  const { _ } = useLingui();\n  console.log('shortcut', shortcut);\n  const editMode = !!shortcut;\n  const [currentType, setCurrentType] = useState(shortcut?.type || null);\n\n  const [uiState, setUIState] = useState('default');\n  const [lists, setLists] = useState([]);\n  const [followedHashtags, setFollowedHashtags] = useState([]);\n  useEffect(() => {\n    (async () => {\n      if (currentType !== 'list') return;\n      try {\n        setUIState('loading');\n        const lists = await getLists();\n        setLists(lists);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n\n    (async () => {\n      if (currentType !== 'hashtag') return;\n      try {\n        const tags = await fetchFollowedTags();\n        setFollowedHashtags(tags);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [currentType]);\n\n  const formRef = useRef();\n  useEffect(() => {\n    if (editMode && currentType && TYPE_PARAMS[currentType]) {\n      // Populate form\n      const form = formRef.current;\n      TYPE_PARAMS[currentType].forEach(({ name, type }) => {\n        const input = form.querySelector(`[name=\"${name}\"]`);\n        if (input && shortcut[name]) {\n          if (type === 'checkbox') {\n            input.checked = shortcut[name] === 'on' ? true : false;\n          } else {\n            input.value = shortcut[name];\n          }\n        }\n      });\n    }\n  }, [editMode, currentType]);\n\n  return (\n    <div id=\"shortcut-settings-form\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>{editMode ? t`Edit shortcut` : t`Add shortcut`}</h2>\n      </header>\n      <main tabindex=\"-1\">\n        <form\n          ref={formRef}\n          onSubmit={(e) => {\n            // Construct a nice object from form\n            e.preventDefault();\n            const data = new FormData(e.target);\n            const result = {};\n            data.forEach((value, key) => {\n              result[key] = value?.trim();\n              if (key === 'instance') {\n                // Remove protocol and trailing slash\n                result[key] = result[key]\n                  .replace(/^https?:\\/\\//, '')\n                  .replace(/\\/+$/, '');\n                // Remove @acct@ or acct@ from instance URL\n                result[key] = result[key].replace(/^@?[^@]+@/, '');\n              }\n            });\n            console.log('result', result);\n            if (!result.type) return;\n            onSubmit({\n              result,\n              mode: editMode ? 'edit' : 'add',\n            });\n            // Reset\n            e.target.reset();\n            setCurrentType(null);\n            onClose?.();\n          }}\n        >\n          <p>\n            <label>\n              <span>\n                <Trans>Timeline</Trans>\n              </span>\n              <select\n                required\n                disabled={disabled}\n                onChange={(e) => {\n                  setCurrentType(e.target.value);\n                }}\n                defaultValue={editMode ? shortcut.type : undefined}\n                name=\"type\"\n                dir=\"auto\"\n              >\n                <option></option>\n                {TYPES.map((type) => (\n                  <option value={type}>{_(TYPE_TEXT[type])}</option>\n                ))}\n              </select>\n            </label>\n          </p>\n          {TYPE_PARAMS[currentType]?.map?.(\n            ({ text, name, type, placeholder, pattern, notRequired }) => {\n              if (currentType === 'list') {\n                return (\n                  <p>\n                    <label>\n                      <span>\n                        <Trans>List</Trans>\n                      </span>\n                      <select\n                        name=\"id\"\n                        required={!notRequired}\n                        disabled={disabled || uiState === 'loading'}\n                        defaultValue={editMode ? shortcut.id : undefined}\n                        dir=\"auto\"\n                      >\n                        <option value=\"\"></option>\n                        {lists.map((list) => (\n                          <option value={list.id}>{list.title}</option>\n                        ))}\n                      </select>\n                    </label>\n                  </p>\n                );\n              }\n\n              return (\n                <p>\n                  <label>\n                    <span>{_(text)}</span>{' '}\n                    <input\n                      type={type}\n                      switch={type === 'checkbox' || undefined}\n                      name={name}\n                      placeholder={_(placeholder)}\n                      required={type === 'text' && !notRequired}\n                      disabled={disabled}\n                      list={\n                        currentType === 'hashtag'\n                          ? 'followed-hashtags-datalist'\n                          : null\n                      }\n                      autocorrect=\"off\"\n                      autocapitalize=\"off\"\n                      spellCheck={false}\n                      pattern={pattern}\n                      dir=\"auto\"\n                    />\n                    {currentType === 'hashtag' &&\n                      followedHashtags.length > 0 && (\n                        <datalist id=\"followed-hashtags-datalist\">\n                          {followedHashtags.map((tag) => (\n                            <option value={tag.name} />\n                          ))}\n                        </datalist>\n                      )}\n                  </label>\n                </p>\n              );\n            },\n          )}\n          {!!FORM_NOTES[currentType] && (\n            <p class=\"form-note insignificant\">\n              <Icon icon=\"info\" />\n              {_(FORM_NOTES[currentType])}\n            </p>\n          )}\n          <footer>\n            <button\n              type=\"submit\"\n              class=\"block\"\n              disabled={disabled || uiState === 'loading'}\n            >\n              {editMode ? t`Save` : t`Add`}\n            </button>\n            {editMode && (\n              <button\n                type=\"button\"\n                class=\"light danger\"\n                onClick={() => {\n                  states.shortcuts.splice(shortcutIndex, 1);\n                  onClose?.();\n                }}\n              >\n                <Trans>Remove</Trans>\n              </button>\n            )}\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nfunction ImportExport({ shortcuts, onClose }) {\n  const { _ } = useLingui();\n  const { masto } = api();\n  const shortcutsStr = useMemo(() => {\n    if (!shortcuts) return '';\n    if (!shortcuts.filter(Boolean).length) return '';\n    return compressToEncodedURIComponent(\n      JSON.stringify(shortcuts.filter(Boolean)),\n    );\n  }, [shortcuts]);\n  const [importShortcutStr, setImportShortcutStr] = useState('');\n  const [importUIState, setImportUIState] = useState('default');\n  const parsedImportShortcutStr = useMemo(() => {\n    if (!importShortcutStr) {\n      setImportUIState('default');\n      return null;\n    }\n    try {\n      const parsed = JSON.parse(\n        decompressFromEncodedURIComponent(importShortcutStr),\n      );\n      // Very basic validation, I know\n      if (!Array.isArray(parsed)) throw new Error('Not an array');\n      setImportUIState('default');\n      console.log(' Parsed imported shortcuts', parsed);\n      return parsed;\n    } catch (err) {\n      // Fallback to JSON string parsing\n      // There's a chance that someone might want to import a JSON string instead of the compressed version\n      try {\n        const parsed = JSON.parse(importShortcutStr);\n        if (!Array.isArray(parsed)) throw new Error('Not an array');\n        setImportUIState('default');\n        return parsed;\n      } catch (err) {\n        setImportUIState('error');\n        return null;\n      }\n    }\n  }, [importShortcutStr]);\n  const hasCurrentSettings = states.shortcuts.length > 0;\n\n  const shortcutsImportFieldRef = useRef();\n\n  return (\n    <div id=\"import-export-container\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>\n            Import/Export <small class=\"ib insignificant\">Shortcuts</small>\n          </Trans>\n        </h2>\n      </header>\n      <main tabindex=\"-1\">\n        <section>\n          <h3>\n            <Icon icon=\"arrow-down-circle\" size=\"l\" class=\"insignificant\" />{' '}\n            <span>\n              <Trans>Import</Trans>\n            </span>\n          </h3>\n          <p class=\"field-button\">\n            <input\n              ref={shortcutsImportFieldRef}\n              type=\"text\"\n              name=\"import\"\n              placeholder={t`Paste shortcuts here`}\n              class=\"block\"\n              onInput={(e) => {\n                setImportShortcutStr(e.target.value);\n              }}\n              dir=\"auto\"\n            />\n            {mediaDevicesSupported && (\n              <button\n                type=\"button\"\n                class=\"plain2 small\"\n                onClick={() => {\n                  states.showQrScannerModal = {\n                    onClose: ({ text } = {}) => {\n                      if (text) {\n                        setImportShortcutStr(text);\n                        shortcutsImportFieldRef.current.value = text;\n                        shortcutsImportFieldRef.current.dispatchEvent(\n                          new Event('input'),\n                        );\n                      }\n                    },\n                  };\n                }}\n              >\n                <Icon icon=\"scan\" alt={t`Scan QR code`} />\n              </button>\n            )}\n            {states.settings.shortcutSettingsCloudImportExport && (\n              <button\n                type=\"button\"\n                class=\"plain2 small\"\n                disabled={importUIState === 'cloud-downloading'}\n                onClick={async () => {\n                  setImportUIState('cloud-downloading');\n                  const currentAccount = getCurrentAccountID();\n                  showToast(\n                    t`Downloading saved shortcuts from instance server`,\n                  );\n                  try {\n                    const relationships =\n                      await masto.v1.accounts.relationships.fetch({\n                        id: [currentAccount],\n                      });\n                    const relationship = relationships[0];\n                    if (relationship) {\n                      const { note = '' } = relationship;\n                      if (\n                        /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/.test(\n                          note,\n                        )\n                      ) {\n                        const settings = note.match(\n                          /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/,\n                        )[1];\n                        const { v, dt, data } = JSON.parse(settings);\n                        shortcutsImportFieldRef.current.value = data;\n                        shortcutsImportFieldRef.current.dispatchEvent(\n                          new Event('input'),\n                        );\n                      }\n                    }\n                    setImportUIState('default');\n                  } catch (e) {\n                    console.error(e);\n                    setImportUIState('error');\n                    showToast(t`Unable to download shortcuts`);\n                  }\n                }}\n                title={t`Download shortcuts from instance server`}\n              >\n                <Icon icon=\"cloud\" />\n                <Icon icon=\"arrow-down\" size=\"s\" />\n              </button>\n            )}\n          </p>\n          {!!parsedImportShortcutStr &&\n            Array.isArray(parsedImportShortcutStr) && (\n              <>\n                <p>\n                  <b>{parsedImportShortcutStr.length}</b> shortcut\n                  {parsedImportShortcutStr.length > 1 ? 's' : ''}{' '}\n                  <small class=\"insignificant\">\n                    ({importShortcutStr.length} characters)\n                  </small>\n                </p>\n                <ol class=\"import-settings-list\">\n                  {parsedImportShortcutStr.map((shortcut) => (\n                    <li>\n                      <span\n                        style={{\n                          opacity: shortcuts.some((s) =>\n                            // Compare all properties\n                            Object.keys(s).every((key) => {\n                              if (!(key in shortcut)) return true;\n                              const val = shortcut[key];\n                              if (\n                                val === '' ||\n                                val === null ||\n                                val === undefined\n                              ) {\n                                return true;\n                              }\n                              return s[key] === val;\n                            }),\n                          )\n                            ? 1\n                            : 0,\n                        }}\n                      >\n                        *\n                      </span>\n                      <span>\n                        {_(TYPE_TEXT[shortcut.type])}\n                        {shortcut.type === 'list' && !!shortcut.id && ' '}{' '}\n                        {TYPE_PARAMS[shortcut.type]?.map?.(\n                          ({ text, name, type }) =>\n                            shortcut[name] ? (\n                              <>\n                                <span class=\"tag collapsed insignificant\">\n                                  {_(text)}:{' '}\n                                  {type === 'checkbox'\n                                    ? shortcut[name] === 'on'\n                                      ? ''\n                                      : ''\n                                    : shortcut[name]}\n                                </span>{' '}\n                              </>\n                            ) : null,\n                        )}\n                      </span>\n                    </li>\n                  ))}\n                </ol>\n                <p>\n                  <small>\n                    <Trans>* Exists in current shortcuts</Trans>\n                  </small>\n                  <br />\n                  <small>\n                    {' '}\n                    <Trans>\n                      List may not work if it's from a different account.\n                    </Trans>\n                  </small>\n                </p>\n              </>\n            )}\n          {importUIState === 'error' && (\n            <p class=\"error\">\n              <small>\n                 <Trans>Invalid settings format</Trans>\n              </small>\n            </p>\n          )}\n          <p>\n            {hasCurrentSettings && (\n              <>\n                <MenuConfirm\n                  confirmLabel={t`Append to current shortcuts?`}\n                  menuFooter={\n                    <div class=\"footer\">\n                      <Trans>\n                        Only shortcuts that dont exist in current shortcuts\n                        will be appended.\n                      </Trans>\n                    </div>\n                  }\n                  onClick={() => {\n                    // states.shortcuts = [\n                    //   ...states.shortcuts,\n                    //   ...parsedImportShortcutStr,\n                    // ];\n                    // Append non-unique shortcuts only\n                    const nonUniqueShortcuts = parsedImportShortcutStr.filter(\n                      (shortcut) =>\n                        !states.shortcuts.some((s) =>\n                          // Compare all properties\n                          Object.keys(s).every(\n                            (key) => s[key] === shortcut[key],\n                          ),\n                        ),\n                    );\n                    if (!nonUniqueShortcuts.length) {\n                      showToast(t`No new shortcuts to import`);\n                      return;\n                    }\n                    let newShortcuts = [\n                      ...states.shortcuts,\n                      ...nonUniqueShortcuts,\n                    ];\n                    const exceededLimit = newShortcuts.length > SHORTCUTS_LIMIT;\n                    if (exceededLimit) {\n                      // If exceeded, trim it\n                      newShortcuts = newShortcuts.slice(0, SHORTCUTS_LIMIT);\n                    }\n                    states.shortcuts = newShortcuts;\n                    showToast(\n                      exceededLimit\n                        ? t`Shortcuts imported. Exceeded max ${SHORTCUTS_LIMIT}, so the rest are not imported.`\n                        : t`Shortcuts imported`,\n                    );\n                    onClose?.();\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"plain2\"\n                    disabled={!parsedImportShortcutStr}\n                  >\n                    <Trans>Import & append</Trans>\n                  </button>\n                </MenuConfirm>{' '}\n              </>\n            )}\n            <MenuConfirm\n              confirmLabel={\n                hasCurrentSettings\n                  ? t`Override current shortcuts?`\n                  : t`Import shortcuts?`\n              }\n              menuItemClassName={hasCurrentSettings ? 'danger' : undefined}\n              onClick={() => {\n                states.shortcuts = parsedImportShortcutStr;\n                showToast(t`Shortcuts imported`);\n                onClose?.();\n              }}\n            >\n              <button\n                type=\"button\"\n                class=\"plain2\"\n                disabled={!parsedImportShortcutStr}\n              >\n                {hasCurrentSettings ? t`or override` : t`Import`}\n              </button>\n            </MenuConfirm>\n          </p>\n        </section>\n        <section>\n          <h3>\n            <Icon icon=\"arrow-up-circle\" size=\"l\" class=\"insignificant\" />{' '}\n            <span>\n              <Trans>Export</Trans>\n            </span>\n          </h3>\n          <p class=\"field-button\">\n            <input\n              style={{ width: '100%' }}\n              type=\"text\"\n              value={shortcutsStr}\n              readOnly\n              onClick={(e) => {\n                if (!e.target.value) return;\n                e.target.select();\n                // Copy url to clipboard\n                try {\n                  navigator.clipboard.writeText(e.target.value);\n                  showToast(t`Shortcuts copied`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to copy shortcuts`);\n                }\n              }}\n              dir=\"auto\"\n            />\n            <button\n              type=\"button\"\n              class=\"plain2 small\"\n              disabled={!shortcutsStr}\n              onClick={() => {\n                states.showQrCodeModal = {\n                  text: shortcutsStr,\n                };\n              }}\n            >\n              <Icon icon=\"qrcode\" alt={t`QR code`} />\n            </button>\n            {states.settings.shortcutSettingsCloudImportExport && (\n              <button\n                type=\"button\"\n                class=\"plain2 small\"\n                disabled={importUIState === 'cloud-uploading'}\n                onClick={async () => {\n                  setImportUIState('cloud-uploading');\n                  const currentAccount = getCurrentAccountID();\n                  try {\n                    const relationships =\n                      await masto.v1.accounts.relationships.fetch({\n                        id: [currentAccount],\n                      });\n                    const relationship = relationships[0];\n                    if (relationship) {\n                      const { note = '' } = relationship;\n                      // const newNote = `${note}\\n\\n\\n$<phanpy-shortcuts-settings>{shortcutsStr}</phanpy-shortcuts-settings>`;\n                      let newNote = '';\n                      const settingsJSON = JSON.stringify({\n                        v: '1', // version\n                        dt: Date.now(), // datetime stamp\n                        data: shortcutsStr, // shortcuts settings string\n                      });\n                      if (\n                        /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/.test(\n                          note,\n                        )\n                      ) {\n                        newNote = note.replace(\n                          /<phanpy-shortcuts-settings>(.*)<\\/phanpy-shortcuts-settings>/,\n                          `<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`,\n                        );\n                      } else {\n                        newNote = `${note}\\n\\n\\n<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;\n                      }\n                      showToast(t`Saving shortcuts to instance server`);\n                      await masto.v1.accounts\n                        .$select(currentAccount)\n                        .note.create({\n                          comment: newNote,\n                        });\n                      setImportUIState('default');\n                      showToast(t`Shortcuts saved`);\n                    }\n                  } catch (e) {\n                    console.error(e);\n                    setImportUIState('error');\n                    showToast(t`Unable to save shortcuts`);\n                  }\n                }}\n                title={t`Sync to instance server`}\n              >\n                <Icon icon=\"cloud\" />\n                <Icon icon=\"arrow-up\" size=\"s\" />\n              </button>\n            )}\n          </p>\n          <p>\n            <button\n              type=\"button\"\n              class=\"plain2\"\n              disabled={!shortcutsStr}\n              onClick={() => {\n                try {\n                  navigator.clipboard.writeText(shortcutsStr);\n                  showToast(t`Shortcut settings copied`);\n                } catch (e) {\n                  console.error(e);\n                  showToast(t`Unable to copy shortcut settings`);\n                }\n              }}\n            >\n              <Icon icon=\"clipboard\" />{' '}\n              <span>\n                <Trans>Copy</Trans>\n              </span>\n            </button>{' '}\n            {navigator?.share &&\n              navigator?.canShare?.({\n                text: shortcutsStr,\n              }) && (\n                <button\n                  type=\"button\"\n                  class=\"plain2\"\n                  disabled={!shortcutsStr}\n                  onClick={() => {\n                    try {\n                      navigator.share({\n                        text: shortcutsStr,\n                      });\n                    } catch (e) {\n                      console.error(e);\n                      alert(t`Sharing doesn't seem to work.`);\n                    }\n                  }}\n                >\n                  <Icon icon=\"share\" />{' '}\n                  <span>\n                    <Trans>Share</Trans>\n                  </span>\n                </button>\n              )}{' '}\n            {shortcutsStr.length > 0 && (\n              <small class=\"insignificant ib\">\n                <Plural\n                  value={shortcutsStr.length}\n                  one=\"# character\"\n                  other=\"# characters\"\n                />\n              </small>\n            )}\n          </p>\n          {!!shortcutsStr && (\n            <details>\n              <summary class=\"insignificant\">\n                <small>\n                  <Trans>Raw Shortcuts JSON</Trans>\n                </small>\n              </summary>\n              <textarea style={{ width: '100%' }} rows={10} readOnly>\n                {JSON.stringify(shortcuts.filter(Boolean), null, 2)}\n              </textarea>\n            </details>\n          )}\n        </section>\n        {states.settings.shortcutSettingsCloudImportExport && (\n          <footer>\n            <p>\n              <Icon icon=\"cloud\" />{' '}\n              <Trans>\n                Import/export settings from/to instance server (Very\n                experimental)\n              </Trans>\n            </p>\n          </footer>\n        )}\n      </main>\n    </div>\n  );\n}\n\nexport default ShortcutsSettings;\n","import { useLingui } from '@lingui/react/macro';\nimport { useEffect } from 'preact/hooks';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport { subscribe, useSnapshot } from 'valtio';\n\nimport Accounts from '../pages/accounts';\nimport Settings from '../pages/settings';\nimport focusDeck from '../utils/focus-deck';\nimport showToast from '../utils/show-toast';\nimport states from '../utils/states';\n\nimport AccountSheet from './account-sheet';\nimport ComposeSuspense, { preload } from './compose-suspense';\nimport Drafts from './drafts';\nimport EmbedModal from './embed-modal';\nimport GenericAccounts from './generic-accounts';\nimport ImportExportAccounts from './import-export-accounts';\nimport MediaAltModal from './media-alt-modal';\nimport MediaModal from './media-modal';\nimport Modal from './modal';\nimport OpenLinkSheet from './open-link-sheet';\nimport QrCodeModal from './qr-code-modal';\nimport QrScannerModal from './qr-scanner-modal';\nimport ReportModal from './report-modal';\nimport ShortcutsSettings from './shortcuts-settings';\n\nsubscribe(states, (changes) => {\n  for (const [action, path, value, prevValue] of changes) {\n    // When closing modal, focus on deck\n    if (/^show/i.test(path) && !value) {\n      focusDeck();\n    }\n  }\n});\n\nexport default function Modals() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  useEffect(() => {\n    setTimeout(preload, 1000);\n  }, []);\n\n  return (\n    <>\n      {!!snapStates.showCompose && (\n        <Modal\n          class={`solid ${snapStates.composerState.minimized ? 'min' : ''}`}\n          minimized={!!snapStates.composerState.minimized}\n        >\n          <ComposeSuspense\n            replyToStatus={\n              typeof snapStates.showCompose !== 'boolean'\n                ? snapStates.showCompose.replyToStatus\n                : window.__COMPOSE__?.replyToStatus || null\n            }\n            replyMode={\n              states.showCompose?.replyMode ||\n              window.__COMPOSE__?.replyMode ||\n              'all'\n            }\n            editStatus={\n              states.showCompose?.editStatus ||\n              window.__COMPOSE__?.editStatus ||\n              null\n            }\n            draftStatus={\n              states.showCompose?.draftStatus ||\n              window.__COMPOSE__?.draftStatus ||\n              null\n            }\n            quoteStatus={\n              states.showCompose?.quoteStatus ||\n              window.__COMPOSE__?.quoteStatus ||\n              null\n            }\n            onClose={(results) => {\n              const { newStatus, instance, type, scheduledAt } = results || {};\n              states.showCompose = false;\n              window.__COMPOSE__ = null;\n              if (newStatus) {\n                states.reloadStatusPage++;\n                if (scheduledAt) states.reloadScheduledPosts++;\n                showToast({\n                  text: {\n                    post: scheduledAt\n                      ? t`Post scheduled`\n                      : t`Post published. Check it out.`,\n                    reply: scheduledAt\n                      ? t`Reply scheduled`\n                      : t`Reply posted. Check it out.`,\n                    edit: t`Post updated. Check it out.`,\n                  }[type || 'post'],\n                  delay: 1000,\n                  duration: 10_000, // 10 seconds\n                  onClick: (toast) => {\n                    toast.hideToast();\n                    states.prevLocation = location;\n                    if (scheduledAt) {\n                      navigate('/sp');\n                    } else {\n                      navigate(\n                        instance\n                          ? `/${instance}/s/${newStatus.id}`\n                          : `/s/${newStatus.id}`,\n                      );\n                    }\n                  },\n                });\n              }\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showSettings && (\n        <Modal\n          onClose={() => {\n            states.showSettings = false;\n          }}\n        >\n          <Settings\n            onClose={() => {\n              states.showSettings = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showAccounts && (\n        <Modal\n          onClose={() => {\n            states.showAccounts = false;\n          }}\n        >\n          <Accounts\n            onClose={() => {\n              states.showAccounts = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showAccount && (\n        <Modal\n          onClose={() => {\n            states.showAccount = false;\n          }}\n        >\n          <AccountSheet\n            account={snapStates.showAccount?.account || snapStates.showAccount}\n            instance={snapStates.showAccount?.instance}\n            onClose={({ destination } = {}) => {\n              states.showAccount = false;\n              // states.showGenericAccounts = false;\n              // if (destination) {\n              //   states.showAccounts = false;\n              // }\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showOpenLink && (\n        <Modal\n          onClose={() => {\n            states.showOpenLink = false;\n          }}\n        >\n          <OpenLinkSheet\n            url={snapStates.showOpenLink.url}\n            linkText={snapStates.showOpenLink.linkText}\n            onClose={() => {\n              states.showOpenLink = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showDrafts && (\n        <Modal\n          onClose={() => {\n            states.showDrafts = false;\n          }}\n        >\n          <Drafts onClose={() => (states.showDrafts = false)} />\n        </Modal>\n      )}\n      {!!snapStates.showMediaModal && (\n        <Modal\n          onClick={(e) => {\n            if (\n              e.target === e.currentTarget ||\n              e.target.classList.contains('media')\n            ) {\n              states.showMediaModal = false;\n            }\n          }}\n        >\n          <MediaModal\n            mediaAttachments={snapStates.showMediaModal.mediaAttachments}\n            instance={snapStates.showMediaModal.instance}\n            index={snapStates.showMediaModal.mediaIndex}\n            statusID={snapStates.showMediaModal.statusID}\n            onClose={() => {\n              states.showMediaModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showShortcutsSettings && (\n        <Modal\n          onClose={() => {\n            states.showShortcutsSettings = false;\n          }}\n        >\n          <ShortcutsSettings\n            onClose={() => (states.showShortcutsSettings = false)}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showGenericAccounts && (\n        <Modal\n          onClose={() => {\n            states.showGenericAccounts = false;\n          }}\n        >\n          <GenericAccounts\n            instance={snapStates.showGenericAccounts.instance}\n            excludeRelationshipAttrs={\n              snapStates.showGenericAccounts.excludeRelationshipAttrs\n            }\n            postID={snapStates.showGenericAccounts.postID}\n            onClose={() => (states.showGenericAccounts = false)}\n            blankCopy={snapStates.showGenericAccounts.blankCopy}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showMediaAlt && (\n        <Modal\n          onClose={(e) => {\n            states.showMediaAlt = false;\n          }}\n        >\n          <MediaAltModal\n            alt={snapStates.showMediaAlt.alt || snapStates.showMediaAlt}\n            lang={snapStates.showMediaAlt?.lang}\n            onClose={() => {\n              states.showMediaAlt = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showEmbedModal && (\n        <Modal\n          class=\"solid\"\n          onClose={() => {\n            states.showEmbedModal = false;\n          }}\n        >\n          <EmbedModal\n            html={snapStates.showEmbedModal.html}\n            url={snapStates.showEmbedModal.url}\n            width={snapStates.showEmbedModal.width}\n            height={snapStates.showEmbedModal.height}\n            onClose={() => {\n              states.showEmbedModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showReportModal && (\n        <Modal\n          onClose={() => {\n            states.showReportModal = false;\n          }}\n        >\n          <ReportModal\n            account={snapStates.showReportModal.account}\n            post={snapStates.showReportModal.post}\n            onClose={() => {\n              states.showReportModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showQrCodeModal && (\n        <Modal\n          class=\"solid\"\n          onClose={() => {\n            states.showQrCodeModal = false;\n          }}\n        >\n          <QrCodeModal\n            text={snapStates.showQrCodeModal.text}\n            arena={snapStates.showQrCodeModal.arena}\n            backgroundMask={snapStates.showQrCodeModal.backgroundMask}\n            caption={snapStates.showQrCodeModal.caption}\n            onClose={() => {\n              states.showQrCodeModal = false;\n            }}\n            onScannerClick={snapStates.showQrCodeModal.onScannerClick}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showQrScannerModal && (\n        <Modal\n          class=\"solid\"\n          onClose={() => {\n            states.showQrScannerModal = false;\n          }}\n        >\n          <QrScannerModal\n            checkValidity={snapStates.showQrScannerModal.checkValidity}\n            actionableText={snapStates.showQrScannerModal.actionableText}\n            onClose={(...args) => {\n              if (snapStates.showQrScannerModal.onClose) {\n                snapStates.showQrScannerModal.onClose(...args);\n              }\n              states.showQrScannerModal = false;\n            }}\n          />\n        </Modal>\n      )}\n      {!!snapStates.showImportExportAccounts && (\n        <Modal\n          onClose={() => {\n            states.showImportExportAccounts = false;\n          }}\n        >\n          <ImportExportAccounts\n            onClose={() => {\n              states.showImportExportAccounts = false;\n            }}\n            exportDisabled={\n              typeof snapStates.showImportExportAccounts === 'object'\n                ? snapStates.showImportExportAccounts.exportDisabled\n                : false\n            }\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n","import { memo } from 'preact/compat';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useNavigate } from 'react-router-dom';\n\nexport default memo(function NavigationCommand() {\n  const navigate = useNavigate();\n\n  const hotkeyOptions = {\n    useKey: true,\n    ignoreEventWhen: (e) => {\n      const hasModal = !!document.querySelector('#modal-container > *');\n      return hasModal || e.metaKey || e.ctrlKey || e.altKey;\n    },\n  };\n\n  useHotkeys('g>h', () => navigate('/'), hotkeyOptions);\n  useHotkeys('g>n', () => navigate('/notifications'), hotkeyOptions);\n\n  return null;\n});\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useState } from 'preact/hooks';\n\nimport { api } from '../utils/api';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nfunction FollowRequestButtons({ accountID, onChange }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [requestState, setRequestState] = useState(null); // accept, reject\n  const [relationship, setRelationship] = useState(null);\n\n  const hasRelationship = relationship !== null;\n\n  return (\n    <p class=\"follow-request-buttons\">\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRelationship}\n        onClick={() => {\n          setUIState('loading');\n          setRequestState('accept');\n          (async () => {\n            try {\n              const rel = await masto.v1.followRequests\n                .$select(accountID)\n                .authorize();\n              if (!rel?.followedBy) {\n                throw new Error('Follow request not accepted');\n              }\n              setRelationship(rel);\n              onChange();\n            } catch (e) {\n              console.error(e);\n            }\n            setUIState('default');\n          })();\n        }}\n      >\n        <Trans>Accept</Trans>\n      </button>{' '}\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRelationship}\n        class=\"light danger\"\n        onClick={() => {\n          setUIState('loading');\n          setRequestState('reject');\n          (async () => {\n            try {\n              const rel = await masto.v1.followRequests\n                .$select(accountID)\n                .reject();\n              if (rel?.followedBy) {\n                throw new Error('Follow request not rejected');\n              }\n              setRelationship(rel);\n              onChange();\n            } catch (e) {\n              console.error(e);\n              setUIState('default');\n            }\n          })();\n        }}\n      >\n        <Trans>Reject</Trans>\n      </button>\n      <span class=\"follow-request-states\">\n        {hasRelationship && requestState ? (\n          requestState === 'accept' ? (\n            <Icon\n              icon=\"check-circle\"\n              alt={t`Accepted`}\n              class=\"follow-accepted\"\n            />\n          ) : (\n            <Icon icon=\"x-circle\" alt={t`Rejected`} class=\"follow-rejected\" />\n          )\n        ) : (\n          <Loader hidden={uiState !== 'loading'} />\n        )}\n      </span>\n    </p>\n  );\n}\n\nexport default FollowRequestButtons;\n","import { msg, t } from '@lingui/core/macro';\nimport { Plural, Select, Trans, useLingui } from '@lingui/react/macro';\nimport { Fragment } from 'preact';\nimport { memo } from 'preact/compat';\n\nimport { api } from '../utils/api';\nimport { isFiltered } from '../utils/filters';\nimport shortenNumber from '../utils/shorten-number';\nimport states, { statusKey } from '../utils/states';\nimport { getCurrentAccountID } from '../utils/store-utils';\nimport useTruncated from '../utils/useTruncated';\n\nimport Avatar from './avatar';\nimport CustomEmoji from './custom-emoji';\nimport FollowRequestButtons from './follow-request-buttons';\nimport Icon from './icon';\nimport Link from './link';\nimport NameText from './name-text';\nimport Status from './status';\n\nconst NOTIFICATION_ICONS = {\n  mention: 'comment',\n  status: 'notification',\n  reblog: 'rocket',\n  follow: 'follow',\n  follow_request: 'follow-add',\n  favourite: 'heart',\n  poll: 'poll',\n  update: 'pencil',\n  'admin.signup': 'account-edit',\n  'admin.report': 'account-warning',\n  severed_relationships: 'heart-break',\n  moderation_warning: 'alert',\n  emoji_reaction: 'emoji2',\n  'pleroma:emoji_reaction': 'emoji2',\n  annual_report: 'celebrate',\n  quote: 'quote',\n  quoted_update: 'pencil',\n};\n\n/*\nNotification types\n==================\nmention = Someone mentioned you in their status\nstatus = Someone you enabled notifications for has posted a status\nreblog = Someone boosted one of your statuses\nfollow = Someone followed you\nfollow_request = Someone requested to follow you\nfavourite = Someone favourited one of your statuses\npoll = A poll you have voted in or created has ended\nupdate = A status you interacted with has been edited\nadmin.sign_up = Someone signed up (optionally sent to admins)\nadmin.report = A new report has been filed\nsevered_relationships = Severed relationships\nmoderation_warning = Moderation warning\nquote = Someone quoted one of your statuses\nquoted_update = A status you have quoted has been edited\n*/\n\nfunction emojiText({ account, emoji, emoji_url }) {\n  let url;\n  let staticUrl;\n  if (typeof emoji_url === 'string') {\n    url = emoji_url;\n  } else {\n    url = emoji_url?.url;\n    staticUrl = emoji_url?.staticUrl;\n  }\n  const emojiObject = url ? (\n    <CustomEmoji url={url} staticUrl={staticUrl} alt={emoji} />\n  ) : (\n    emoji\n  );\n  return (\n    <Trans>\n      {account} reacted to your post with {emojiObject}\n    </Trans>\n  );\n}\n\nconst contentText = {\n  status: ({ account }) => <Trans>{account} published a post.</Trans>,\n  reblog: ({\n    count,\n    account,\n    postsCount,\n    postType,\n    components: { Subject },\n  }) => (\n    <Plural\n      value={count}\n      _1={\n        <Plural\n          value={postsCount}\n          _1={\n            <Select\n              value={postType}\n              _reply={<Trans>{account} boosted your reply.</Trans>}\n              other={<Trans>{account} boosted your post.</Trans>}\n            />\n          }\n          other={\n            <Trans>\n              {account} boosted {postsCount} of your posts.\n            </Trans>\n          }\n        />\n      }\n      other={\n        <Select\n          value={postType}\n          _reply={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted your reply.\n            </Trans>\n          }\n          other={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted your post.\n            </Trans>\n          }\n        />\n      }\n    />\n  ),\n  follow: ({ account, count, components: { Subject } }) => (\n    <Plural\n      value={count}\n      _1={<Trans>{account} followed you.</Trans>}\n      other={\n        <Trans>\n          <Subject clickable={count > 1}>\n            <span title={count}>{shortenNumber(count)}</span> people\n          </Subject>{' '}\n          followed you.\n        </Trans>\n      }\n    />\n  ),\n  follow_request: ({ account }) => (\n    <Trans>{account} requested to follow you.</Trans>\n  ),\n  favourite: ({\n    account,\n    count,\n    postsCount,\n    postType,\n    components: { Subject },\n  }) => (\n    <Plural\n      value={count}\n      _1={\n        <Plural\n          value={postsCount}\n          _1={\n            <Select\n              value={postType}\n              _reply={<Trans>{account} liked your reply.</Trans>}\n              other={<Trans>{account} liked your post.</Trans>}\n            />\n          }\n          other={\n            <Trans>\n              {account} liked {postsCount} of your posts.\n            </Trans>\n          }\n        />\n      }\n      other={\n        <Select\n          value={postType}\n          _reply={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              liked your reply.\n            </Trans>\n          }\n          other={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              liked your post.\n            </Trans>\n          }\n        />\n      }\n    />\n  ),\n  poll: () => t`A poll you have voted in or created has ended.`,\n  'poll-self': () => t`A poll you have created has ended.`,\n  'poll-voted': () => t`A poll you have voted in has ended.`,\n  update: ({ account }) =>\n    account ? (\n      <Trans>{account} edited a post.</Trans>\n    ) : (\n      t`A post you interacted with has been edited.`\n    ),\n  'favourite+reblog': ({\n    count,\n    account,\n    postsCount,\n    postType,\n    components: { Subject },\n  }) => (\n    <Plural\n      value={count}\n      _1={\n        <Plural\n          value={postsCount}\n          _1={\n            <Select\n              value={postType}\n              _reply={<Trans>{account} boosted & liked your reply.</Trans>}\n              other={<Trans>{account} boosted & liked your post.</Trans>}\n            />\n          }\n          other={\n            <Trans>\n              {account} boosted & liked {postsCount} of your posts.\n            </Trans>\n          }\n        />\n      }\n      other={\n        <Select\n          value={postType}\n          _reply={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted & liked your reply.\n            </Trans>\n          }\n          other={\n            <Trans>\n              <Subject clickable={count > 1}>\n                <span title={count}>{shortenNumber(count)}</span> people\n              </Subject>{' '}\n              boosted & liked your post.\n            </Trans>\n          }\n        />\n      }\n    />\n  ),\n  quoted_update: ({ account }) => (\n    <Trans>{account} edited a post you have quoted.</Trans>\n  ),\n  'admin.sign_up': ({ account }) => <Trans>{account} signed up.</Trans>,\n  'admin.report': ({ account, targetAccount }) => (\n    <Trans>\n      {account} reported {targetAccount}\n    </Trans>\n  ),\n  severed_relationships: ({ name }) => (\n    <Trans>\n      Lost connections with <i>{name}</i>.\n    </Trans>\n  ),\n  moderation_warning: () => (\n    <b>\n      <Trans>Moderation warning</Trans>\n    </b>\n  ),\n  emoji_reaction: emojiText,\n  'pleroma:emoji_reaction': emojiText,\n  annual_report: ({ year }) => <Trans>Your {year} #Wrapstodon is here!</Trans>,\n};\n\n// account_suspension, domain_block, user_domain_block\nconst SEVERED_RELATIONSHIPS_TEXT = {\n  account_suspension: ({ from, targetName }) => (\n    <Trans>\n      An admin from <i>{from}</i> has suspended <i>{targetName}</i>, which means\n      you can no longer receive updates from them or interact with them.\n    </Trans>\n  ),\n  domain_block: ({ from, targetName, followersCount, followingCount }) => (\n    <Trans>\n      An admin from <i>{from}</i> has blocked <i>{targetName}</i>. Affected\n      followers: {followersCount}, followings: {followingCount}.\n    </Trans>\n  ),\n  user_domain_block: ({ targetName, followersCount, followingCount }) => (\n    <Trans>\n      You have blocked <i>{targetName}</i>. Removed followers: {followersCount},\n      followings: {followingCount}.\n    </Trans>\n  ),\n};\n\nconst MODERATION_WARNING_TEXT = {\n  none: msg`Your account has received a moderation warning.`,\n  disable: msg`Your account has been disabled.`,\n  mark_statuses_as_sensitive: msg`Some of your posts have been marked as sensitive.`,\n  delete_statuses: msg`Some of your posts have been deleted.`,\n  sensitive: msg`Your posts will be marked as sensitive from now on.`,\n  silence: msg`Your account has been limited.`,\n  suspend: msg`Your account has been suspended.`,\n};\n\nconst AVATARS_LIMIT = 30;\n\nfunction Notification({\n  notification,\n  instance,\n  isStatic,\n  disableContextMenu,\n}) {\n  const { _ } = useLingui();\n  const { masto } = api();\n  const {\n    id,\n    status,\n    account,\n    report,\n    event,\n    moderation_warning,\n    annualReport,\n    // Client-side grouped notification\n    _ids,\n    _accounts,\n    _statuses,\n    _groupKeys,\n    // Server-side grouped notification\n    sampleAccounts,\n    notificationsCount,\n    groupKey,\n    _notificationsCount,\n    _sampleAccountsCount,\n  } = notification;\n  let { type } = notification;\n\n  if ((type === 'mention' || type === 'quote') && !status) {\n    // Could be deleted\n    return null;\n  }\n\n  // status = Attached when type of the notification is favourite, reblog, status, mention, poll, or update\n  const actualStatus = status?.reblog || status;\n  const actualStatusID = actualStatus?.id;\n\n  const currentAccount = getCurrentAccountID();\n  const isSelf = currentAccount === account?.id;\n  const isVoted = status?.poll?.voted;\n  const isReplyToOthers =\n    !!status?.inReplyToAccountId &&\n    status?.inReplyToAccountId !== currentAccount &&\n    status?.account?.id === currentAccount;\n\n  let favsCount = 0;\n  let reblogsCount = 0;\n  if (type === 'favourite+reblog') {\n    if (_accounts) {\n      for (const account of _accounts) {\n        if (account._types?.includes('favourite')) {\n          favsCount++;\n        }\n        if (account._types?.includes('reblog')) {\n          reblogsCount++;\n        }\n      }\n    }\n    if (!reblogsCount && favsCount) type = 'favourite';\n    if (!favsCount && reblogsCount) type = 'reblog';\n  }\n\n  let text;\n  if (type === 'poll') {\n    text = contentText[isSelf ? 'poll-self' : isVoted ? 'poll-voted' : 'poll'];\n  } else if (contentText[type]) {\n    text = contentText[type];\n  } else {\n    // Anticipate unhandled notification types, possibly from Mastodon forks or non-Mastodon instances\n    // This surfaces the error to the user, hoping that users will report it\n    text = t`[Unknown notification type: ${type}]`;\n  }\n\n  const Subject = ({ clickable, ...props }) =>\n    clickable ? (\n      <b tabIndex=\"0\" onClick={handleOpenGenericAccounts} {...props} />\n    ) : (\n      <b {...props} />\n    );\n\n  const diffCount =\n    notificationsCount > 0 && notificationsCount > sampleAccounts?.length;\n  const expandAccounts = diffCount ? 'remote' : 'local';\n\n  if (typeof text === 'function') {\n    const count =\n      (type === 'favourite' || type === 'reblog') && notificationsCount\n        ? diffCount\n          ? notificationsCount\n          : sampleAccounts?.length\n        : _accounts?.length || sampleAccounts?.length || (account ? 1 : 0);\n    const postsCount = _statuses?.length || (status ? 1 : 0);\n    if (type === 'admin.report') {\n      const targetAccount = report?.targetAccount;\n      if (targetAccount) {\n        text = text({\n          account: <NameText account={account} showAvatar />,\n          targetAccount: <NameText account={targetAccount} showAvatar />,\n        });\n      }\n    } else if (type === 'severed_relationships') {\n      const targetName = event?.targetName;\n      if (targetName) {\n        text = text({ name: targetName });\n      }\n    } else if (\n      (type === 'emoji_reaction' || type === 'pleroma:emoji_reaction') &&\n      notification.emoji\n    ) {\n      const emojiURL =\n        notification.emoji_url || // This is string\n        status?.emojis?.find?.(\n          (emoji) =>\n            emoji?.shortcode ===\n            notification.emoji.replace(/^:/, '').replace(/:$/, ''),\n        ); // Emoji object instead of string\n      text = text({\n        account: <NameText account={account} showAvatar />,\n        emoji: notification.emoji,\n        emojiURL,\n      });\n    } else if (type === 'annual_report') {\n      text = text({\n        ...notification.annualReport,\n      });\n    } else {\n      text = text({\n        account: account ? (\n          <NameText account={account} showAvatar />\n        ) : (\n          sampleAccounts?.[0] && (\n            <NameText account={sampleAccounts[0]} showAvatar />\n          )\n        ),\n        count,\n        postsCount,\n        postType: isReplyToOthers ? 'reply' : 'post',\n        components: { Subject },\n      });\n    }\n  }\n\n  const formattedCreatedAt =\n    notification.createdAt && new Date(notification.createdAt).toLocaleString();\n\n  const genericAccountsHeading =\n    {\n      'favourite+reblog': t`Boosted/Liked by`,\n      favourite: t`Liked by`,\n      reblog: t`Boosted by`,\n      follow: t`Followed by`,\n    }[type] || t`Accounts`;\n  const handleOpenGenericAccounts = () => {\n    states.showGenericAccounts = {\n      heading: genericAccountsHeading,\n      accounts: _accounts,\n      showReactions: type === 'favourite+reblog',\n      excludeRelationshipAttrs: type === 'follow' ? ['followedBy'] : [],\n      postID: statusKey(actualStatusID, instance),\n    };\n  };\n\n  console.debug('RENDER Notification', notification.id);\n\n  // If there's a status and filter action is 'hide', then the notification is hidden\n  if (!!status?.filtered) {\n    const isOwnPost = status?.account?.id === currentAccount;\n    const filterInfo = isFiltered(status.filtered, 'notifications');\n    if (!isSelf && !isOwnPost && filterInfo?.action === 'hide') {\n      return null;\n    }\n  }\n\n  return (\n    <div\n      class={`notification notification-${type}`}\n      data-notification-id={_ids || id}\n      data-group-key={_groupKeys?.join(' ') || groupKey}\n      tabIndex=\"0\"\n    >\n      <div\n        class={`notification-type notification-${type}`}\n        title={formattedCreatedAt}\n      >\n        {type === 'favourite+reblog' ? (\n          <>\n            <Icon icon=\"rocket\" size=\"xl\" alt={type} class=\"reblog-icon\" />\n            <Icon icon=\"heart\" size=\"xl\" alt={type} class=\"favourite-icon\" />\n          </>\n        ) : (\n          <Icon\n            icon={NOTIFICATION_ICONS[type] || 'notification'}\n            size=\"xl\"\n            alt={type}\n          />\n        )}\n      </div>\n      <div class=\"notification-content\">\n        {/* {(type === 'favourite+reblog' ||\n          type === 'favourite' ||\n          type === 'reblog') && (\n          <>\n             {type} {expandAccounts}{' '}\n            <mark>\n              N{_notificationsCount?.join(',')} + A\n              {_sampleAccountsCount?.join(',')}\n            </mark>{' '}\n            {' '}\n            <mark>\n              N{notificationsCount} + A{sampleAccounts?.length}\n            </mark>\n          </>\n        )} */}\n        {type !== 'mention' && type !== 'quote' && (\n          <>\n            <p>{text}</p>\n            {type === 'follow_request' && (\n              <FollowRequestButtons accountID={account.id} />\n            )}\n            {type === 'severed_relationships' && (\n              <div>\n                {SEVERED_RELATIONSHIPS_TEXT[event.type]({\n                  from: instance,\n                  ...event,\n                })}\n                <br />\n                <a\n                  href={`https://${instance}/severed_relationships`}\n                  target=\"_blank\"\n                  rel=\"noopener\"\n                >\n                  <Trans>\n                    Learn more <Icon icon=\"external\" size=\"s\" />\n                  </Trans>\n                </a>\n                .\n              </div>\n            )}\n            {type === 'moderation_warning' && !!moderation_warning && (\n              <div>\n                {_(MODERATION_WARNING_TEXT[moderation_warning.action]())}\n                <br />\n                <a\n                  href={`/disputes/strikes/${moderation_warning.id}`}\n                  target=\"_blank\"\n                  rel=\"noopener\"\n                >\n                  <Trans>\n                    Learn more <Icon icon=\"external\" size=\"s\" />\n                  </Trans>\n                </a>\n              </div>\n            )}\n            {type === 'annual_report' && (\n              <div>\n                <Link to={`/annual_report/${annualReport?.year}`}>\n                  <Trans>View #Wrapstodon</Trans>\n                </Link>\n              </div>\n            )}\n          </>\n        )}\n        {_accounts?.length > 1 && (\n          <p class=\"avatars-stack\">\n            {_accounts.slice(0, AVATARS_LIMIT).map((account) => (\n              <Fragment key={account.id}>\n                <a\n                  key={account.id}\n                  href={account.url}\n                  rel=\"noopener\"\n                  class=\"account-avatar-stack\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.showAccount = account;\n                  }}\n                >\n                  <Avatar\n                    url={account.avatarStatic}\n                    size={\n                      _accounts.length <= 10\n                        ? 'xxl'\n                        : _accounts.length < 20\n                          ? 'xl'\n                          : 'l'\n                    }\n                    key={account.id}\n                    alt={`${account.displayName} @${account.acct}`}\n                    squircle={account?.bot}\n                  />\n                  {type === 'favourite+reblog' && (\n                    <div class=\"account-sub-icons\">\n                      {account._types.map((type) => (\n                        <Icon\n                          icon={NOTIFICATION_ICONS[type]}\n                          size=\"s\"\n                          class={`${type}-icon`}\n                        />\n                      ))}\n                    </div>\n                  )}\n                </a>{' '}\n              </Fragment>\n            ))}\n            {(type === 'favourite+reblog' ||\n              type === 'favourite' ||\n              type === 'reblog') &&\n            expandAccounts === 'remote' ? (\n              <button\n                type=\"button\"\n                class=\"small plain\"\n                data-group-keys={_groupKeys?.join(' ')}\n                onClick={() => {\n                  states.showGenericAccounts = {\n                    heading: genericAccountsHeading,\n                    accounts: _accounts,\n                    fetchAccounts: async () => {\n                      const keyAccounts = await Promise.allSettled(\n                        _groupKeys.map(async (gKey) => {\n                          const iterator = masto.v2.notifications\n                            .$select(gKey)\n                            .accounts.list()\n                            .values();\n                          return [gKey, (await iterator.next()).value];\n                        }),\n                      );\n                      const accounts = [];\n                      for (const keyAccount of keyAccounts) {\n                        const [key, _accounts] = keyAccount.value;\n                        const type = /^favourite/.test(key)\n                          ? 'favourite'\n                          : /^reblog/.test(key)\n                            ? 'reblog'\n                            : null;\n                        if (!type) continue;\n                        for (const account of _accounts) {\n                          const theAccount = accounts.find(\n                            (a) => a.id === account.id,\n                          );\n                          if (theAccount) {\n                            theAccount._types.push(type);\n                          } else {\n                            account._types = [type];\n                            accounts.push(account);\n                          }\n                        }\n                      }\n                      return {\n                        done: true,\n                        value: accounts,\n                      };\n                    },\n                    showReactions: type === 'favourite+reblog',\n                    postID: statusKey(actualStatusID, instance),\n                  };\n                }}\n              >\n                +\n                {(type === 'favourite' || type === 'reblog') &&\n                  notificationsCount - _accounts.length}\n                <Icon icon=\"chevron-down\" />\n              </button>\n            ) : (\n              <button\n                type=\"button\"\n                class=\"small plain\"\n                onClick={handleOpenGenericAccounts}\n              >\n                {_accounts.length > AVATARS_LIMIT &&\n                  `+${_accounts.length - AVATARS_LIMIT}`}\n                <Icon icon=\"chevron-down\" />\n              </button>\n            )}\n          </p>\n        )}\n        {!_accounts?.length && sampleAccounts?.length > 1 && (\n          <p class=\"avatars-stack\">\n            {sampleAccounts.map((account) => (\n              <Fragment key={account.id}>\n                <a\n                  key={account.id}\n                  href={account.url}\n                  rel=\"noopener\"\n                  class=\"account-avatar-stack\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    states.showAccount = account;\n                  }}\n                >\n                  <Avatar\n                    url={account.avatarStatic}\n                    size=\"xxl\"\n                    key={account.id}\n                    alt={`${account.displayName} @${account.acct}`}\n                    squircle={account?.bot}\n                  />\n                  {/* {type === 'favourite+reblog' && (\n                    <div class=\"account-sub-icons\">\n                      {account._types.map((type) => (\n                        <Icon\n                          icon={NOTIFICATION_ICONS[type]}\n                          size=\"s\"\n                          class={`${type}-icon`}\n                        />\n                      ))}\n                    </div>\n                  )} */}\n                </a>{' '}\n              </Fragment>\n            ))}\n            {notificationsCount > sampleAccounts.length && (\n              <Link\n                to={\n                  instance ? `/${instance}/s/${status.id}` : `/s/${status.id}`\n                }\n                class=\"button small plain centered\"\n              >\n                +{notificationsCount - sampleAccounts.length}\n                <Icon icon=\"chevron-right\" />\n              </Link>\n            )}\n          </p>\n        )}\n        {_statuses?.length > 1 && (\n          <ul class=\"notification-group-statuses\">\n            {_statuses.map((status) => (\n              <li key={status.id}>\n                <TruncatedLink\n                  class={`status-link status-type-${type}`}\n                  to={\n                    instance ? `/${instance}/s/${status.id}` : `/s/${status.id}`\n                  }\n                >\n                  <Status\n                    status={status}\n                    size=\"s\"\n                    previewMode\n                    allowContextMenu\n                    allowFilters\n                  />\n                </TruncatedLink>\n              </li>\n            ))}\n          </ul>\n        )}\n        {status && (!_statuses?.length || _statuses?.length <= 1) && (\n          <TruncatedLink\n            class={`status-link status-type-${type}`}\n            to={\n              instance\n                ? `/${instance}/s/${actualStatusID}`\n                : `/s/${actualStatusID}`\n            }\n            onContextMenu={\n              !disableContextMenu\n                ? (e) => {\n                    const post = e.target.querySelector('.status');\n                    if (post) {\n                      // Fire a custom event to open the context menu\n                      if (e.metaKey) return;\n                      e.preventDefault();\n                      post.dispatchEvent(\n                        new MouseEvent('contextmenu', {\n                          clientX: e.clientX,\n                          clientY: e.clientY,\n                        }),\n                      );\n                    }\n                  }\n                : undefined\n            }\n          >\n            {isStatic ? (\n              <Status\n                status={actualStatus}\n                size=\"s\"\n                readOnly\n                allowContextMenu\n                allowFilters\n              />\n            ) : (\n              <Status\n                statusID={actualStatusID}\n                size=\"s\"\n                readOnly\n                allowContextMenu\n                allowFilters\n              />\n            )}\n          </TruncatedLink>\n        )}\n      </div>\n    </div>\n  );\n}\n\nfunction TruncatedLink(props) {\n  const { t } = useLingui();\n  const ref = useTruncated();\n  return <Link {...props} data-read-more={t`Read more `} ref={ref} />;\n}\n\nexport default memo(Notification, (oldProps, newProps) => {\n  return oldProps.notification?.id === newProps.notification?.id;\n});\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useLayoutEffect, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport states from '../utils/states';\nimport {\n  getAccountByAccessToken,\n  getCurrentAccount,\n} from '../utils/store-utils';\nimport usePageVisibility from '../utils/usePageVisibility';\n\nimport Icon from './icon';\nimport Link from './link';\nimport Modal from './modal';\nimport Notification from './notification';\n\n{\n  if ('serviceWorker' in navigator) {\n    console.log(' Listen to message');\n    navigator.serviceWorker.addEventListener('message', (event) => {\n      console.log(' Message event', event);\n      const { type, id, accessToken } = event?.data || {};\n      if (type === 'notification') {\n        states.routeNotification = {\n          id,\n          accessToken,\n        };\n      }\n    });\n  }\n}\n\nexport default memo(function NotificationService() {\n  const { t } = useLingui();\n  if (!('serviceWorker' in navigator)) return null;\n\n  const snapStates = useSnapshot(states);\n  const { routeNotification } = snapStates;\n\n  console.log(' Notification service', routeNotification);\n\n  const { id, accessToken } = routeNotification || {};\n  const [showNotificationSheet, setShowNotificationSheet] = useState(false);\n\n  useLayoutEffect(() => {\n    if (!id || !accessToken) return;\n    const { instance: currentInstance } = api();\n    const { masto, instance } = api({\n      accessToken,\n    });\n    console.log('API', { accessToken, currentInstance, instance });\n    const sameInstance = currentInstance === instance;\n    const account = accessToken\n      ? getAccountByAccessToken(accessToken)\n      : getCurrentAccount();\n    (async () => {\n      const notification = await masto.v1.notifications.$select(id).fetch();\n      if (notification && account) {\n        console.log(' Notification', { id, notification, account });\n        const accountInstance = account.instanceURL;\n        const { type, status, account: notificationAccount } = notification;\n        const hasModal = !!document.querySelector('#modal-container > *');\n        const isFollow = type === 'follow' && !!notificationAccount?.id;\n        const hasAccount = !!notificationAccount?.id;\n        const hasStatus = !!status?.id;\n        if (isFollow && sameInstance) {\n          // Show account sheet, can handle different instances\n          states.showAccount = {\n            account: notificationAccount,\n            instance: accountInstance,\n          };\n        } else if (hasModal || !sameInstance || (hasAccount && hasStatus)) {\n          // Show sheet of notification, if\n          // - there is a modal open\n          // - the notification is from another instance\n          // - the notification has both account and status, gives choice for users to go to account or status\n          setShowNotificationSheet({\n            id,\n            account,\n            notification,\n            sameInstance,\n          });\n        } else {\n          if (hasStatus) {\n            // Go to status page\n            location.hash = `/${currentInstance}/s/${status.id}`;\n          } else if (isFollow) {\n            // Go to profile page\n            location.hash = `/${currentInstance}/a/${notificationAccount.id}`;\n          } else {\n            // Go to notifications page\n            location.hash = '/notifications';\n          }\n        }\n      } else {\n        console.warn(' Notification not found', id);\n      }\n    })();\n  }, [id, accessToken]);\n\n  // useLayoutEffect(() => {\n  //   // Listen to message from service worker\n  //   const handleMessage = (event) => {\n  //     console.log(' Message event', event);\n  //     const { type, id, accessToken } = event?.data || {};\n  //     if (type === 'notification') {\n  //       states.routeNotification = {\n  //         id,\n  //         accessToken,\n  //       };\n  //     }\n  //   };\n  //   console.log(' Listen to message');\n  //   navigator.serviceWorker.addEventListener('message', handleMessage);\n  //   return () => {\n  //     console.log(' Remove listen to message');\n  //     navigator.serviceWorker.removeEventListener('message', handleMessage);\n  //   };\n  // }, []);\n\n  useLayoutEffect(() => {\n    if (navigator?.clearAppBadge) {\n      navigator.clearAppBadge();\n    }\n  }, []);\n  usePageVisibility((visible) => {\n    if (visible && navigator?.clearAppBadge) {\n      console.log(' Clear app badge');\n      navigator.clearAppBadge();\n    }\n  });\n\n  const onClose = () => {\n    setShowNotificationSheet(false);\n    states.routeNotification = null;\n\n    // If url is #/notifications?id=123, go to #/notifications\n    if (/\\/notifications\\?id=/i.test(location.hash)) {\n      location.hash = '/notifications';\n    }\n  };\n\n  if (showNotificationSheet) {\n    const { id, account, notification, sameInstance } = showNotificationSheet;\n    return (\n      <Modal\n        onClick={(e) => {\n          if (e.target === e.currentTarget) {\n            onClose();\n          }\n        }}\n      >\n        <div class=\"sheet\" tabIndex=\"-1\">\n          <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n            <Icon icon=\"x\" alt={t`Close`} />\n          </button>\n          <header>\n            <b>\n              <Trans>Notification</Trans>\n            </b>\n          </header>\n          <main>\n            {!sameInstance && (\n              <p>\n                <Trans>This notification is from your other account.</Trans>\n              </p>\n            )}\n            <div\n              class=\"notification-peek\"\n              // style={{\n              //   pointerEvents: sameInstance ? '' : 'none',\n              // }}\n              onClick={(e) => {\n                const { target } = e;\n                // If button or links\n                if (e.target.tagName === 'BUTTON' || e.target.tagName === 'A') {\n                  onClose();\n                }\n              }}\n            >\n              <Notification\n                instance={account.instanceURL}\n                notification={notification}\n                isStatic\n              />\n            </div>\n            <div\n              style={{\n                textAlign: 'end',\n              }}\n            >\n              <Link to=\"/notifications\" class=\"button light\" onClick={onClose}>\n                <span>\n                  <Trans>View all notifications</Trans>\n                </span>{' '}\n                <Icon icon=\"arrow-right\" />\n              </Link>\n            </div>\n          </main>\n        </div>\n      </Modal>\n    );\n  }\n\n  return null;\n});\n","import store from './store';\n\nexport const getSearchHistory = ({ limit } = {}) => {\n  const history = store.account.get('searchHistory') || [];\n  return limit ? history.slice(0, limit) : history;\n};\n\nconst MAX_HISTORY_LENGTH = 10;\nexport const addToSearchHistory = (query, queryType = null) => {\n  if (!query?.trim?.()) return;\n\n  const history = getSearchHistory();\n  const existingIndex = history.findIndex(\n    (item) => item.query === query && item.queryType === queryType,\n  );\n\n  // LRU\n  // Remove existing entry if found\n  if (existingIndex !== -1) {\n    history.splice(existingIndex, 1);\n  }\n  // Add to beginning (most recent)\n  history.unshift({\n    query: query.trim(),\n    queryType,\n    timestamp: Date.now(),\n  });\n  const limitedHistory = history.slice(0, MAX_HISTORY_LENGTH);\n\n  store.account.set('searchHistory', limitedHistory);\n};\n\nexport const removeFromSearchHistory = (query, queryType = null) => {\n  const history = getSearchHistory();\n  const filteredHistory = history.filter(\n    (item) => !(item.query === query && item.queryType === queryType),\n  );\n  store.account.set('searchHistory', filteredHistory);\n};\n\nexport const clearAllSearchHistory = () => {\n  store.account.set('searchHistory', []);\n};\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { forwardRef } from 'preact/compat';\nimport { useImperativeHandle, useMemo, useRef, useState } from 'preact/hooks';\nimport { useSearchParams } from 'react-router-dom';\n\nimport { api } from '../utils/api';\nimport { addToSearchHistory, getSearchHistory } from '../utils/search-history';\n\nimport Icon from './icon';\nimport Link from './link';\n\n// Helper function to generate search item data (label and URL)\nexport const generateSearchItemData = (query, queryType, instance) => {\n  let label, to, icon;\n\n  if (queryType === 'statuses') {\n    label = (\n      <Trans>\n        Posts with <q>{query}</q>\n      </Trans>\n    );\n    to = `/search?q=${encodeURIComponent(query)}&type=statuses`;\n    icon = 'document';\n  } else if (queryType === 'accounts') {\n    label = (\n      <Trans>\n        Accounts with <q>{query}</q>\n      </Trans>\n    );\n    to = `/search?q=${encodeURIComponent(query)}&type=accounts`;\n    icon = 'group';\n  } else if (queryType === 'hashtags') {\n    const [, hashSymbol = '#', hashtagText = query] =\n      query.match(/^([#])?(.*)$/);\n    const hashtag = `${hashSymbol}${hashtagText}`;\n    label = (\n      <Trans>\n        Posts tagged with <mark>{hashtag}</mark>\n      </Trans>\n    );\n    to = `/${instance}/t/${hashtagText}`;\n    icon = 'hashtag';\n  } else {\n    // Default/general search\n    label = (\n      <Trans>\n        {query}{' '}\n        <small class=\"insignificant\"> accounts, hashtags &amp; posts</small>\n      </Trans>\n    );\n    to = `/search?q=${encodeURIComponent(query)}`;\n    icon = 'search';\n  }\n\n  return { label, to, icon };\n};\n\nconst SearchForm = forwardRef((props, ref) => {\n  const { t } = useLingui();\n  const { instance } = api();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const [searchMenuOpen, setSearchMenuOpen] = useState(false);\n  const [query, setQuery] = useState(searchParams.get('q') || '');\n  const type = searchParams.get('type');\n  const formRef = useRef(null);\n\n  const searchFieldRef = useRef(null);\n  useImperativeHandle(ref, () => ({\n    setValue: (value) => {\n      setQuery(value);\n    },\n    focus: () => {\n      searchFieldRef.current.focus();\n    },\n    select: () => {\n      searchFieldRef.current.select();\n    },\n    blur: () => {\n      searchFieldRef.current.blur();\n    },\n  }));\n\n  const searchHistory = useMemo(\n    () => getSearchHistory({ limit: 5 }),\n    [props?.hidden],\n  );\n\n  const searchSuggestionsData = useMemo(() => {\n    if (!query) return [];\n\n    const matchingHistory = searchHistory\n      .filter((historyItem) => {\n        // Filter out exact matches with current query\n        if (historyItem.query === query) return false;\n        // Check if history item contains the current query (case insensitive)\n        return historyItem.query.toLowerCase().includes(query.toLowerCase());\n      })\n      .slice(0, 2); // Max 2 recent searches\n\n    const recentSearchItems = matchingHistory.map((historyItem) => ({\n      ...generateSearchItemData(\n        historyItem.query,\n        historyItem.queryType,\n        instance,\n      ),\n      queryType: historyItem.queryType,\n      isRecentSearch: true,\n      historyItem,\n    }));\n\n    const allItems = [\n      // General search\n      {\n        ...generateSearchItemData(query, null, instance),\n        top: !type && !/\\s/.test(query),\n        hidden: !!type,\n      },\n      // Recent searches\n      ...recentSearchItems,\n      // Posts search\n      {\n        ...generateSearchItemData(query, 'statuses', instance),\n        hidden: /^https?:/.test(query),\n        top: /\\s/.test(query),\n        queryType: 'statuses',\n      },\n      // Hashtag search\n      {\n        ...generateSearchItemData(query, 'hashtags', instance),\n        hidden:\n          /^[@]/.test(query) || /^https?:/.test(query) || /\\s/.test(query),\n        top: /^[#]/.test(query),\n        type: 'link',\n        queryType: 'hashtags',\n      },\n      // URL lookup (unique case)\n      {\n        label: (\n          <Trans>\n            Look up <mark>{query}</mark>\n          </Trans>\n        ),\n        to: `/${query}`,\n        hidden: !/^https?:/.test(query),\n        top: /^https?:/.test(query),\n        type: 'link',\n        icon: 'arrow-right',\n      },\n      // Accounts search\n      {\n        ...generateSearchItemData(query, 'accounts', instance),\n        queryType: 'accounts',\n      },\n    ];\n\n    return allItems\n      .sort((a, b) => {\n        if (type) {\n          if (a.queryType === type) return -1;\n          if (b.queryType === type) return 1;\n        }\n        if (a.top && !b.top) return -1;\n        if (!a.top && b.top) return 1;\n        return 0;\n      })\n      .filter(({ hidden }) => !hidden);\n  }, [query, type, instance]);\n\n  return (\n    <form\n      ref={formRef}\n      class=\"search-popover-container\"\n      onSubmit={(e) => {\n        e.preventDefault();\n\n        const isSearchPage = /\\/search/.test(location.hash);\n        if (isSearchPage) {\n          if (query) {\n            const params = {\n              q: query,\n            };\n            if (type) params.type = type; // Preserve type\n            setSearchParams(params);\n          } else {\n            setSearchParams({});\n          }\n        } else {\n          if (query) {\n            location.hash = `/search?q=${encodeURIComponent(query)}${\n              type ? `&type=${type}` : ''\n            }`;\n          } else {\n            location.hash = `/search`;\n          }\n        }\n\n        addToSearchHistory(query, type);\n\n        props?.onSubmit?.(e);\n      }}\n    >\n      <input\n        ref={searchFieldRef}\n        value={query}\n        name=\"q\"\n        type=\"search\"\n        // autofocus\n        placeholder={t`Search`}\n        dir=\"auto\"\n        autocomplete=\"off\"\n        autocorrect=\"off\"\n        autocapitalize=\"off\"\n        spellCheck=\"false\"\n        enterKeyHint=\"search\"\n        onSearch={(e) => {\n          if (!e.target.value) {\n            setSearchParams({});\n          }\n        }}\n        onInput={(e) => {\n          setQuery(e.target.value);\n          setSearchMenuOpen(true);\n        }}\n        onFocus={() => {\n          setSearchMenuOpen(true);\n          // Focus first item\n          const firstItem = formRef.current?.querySelector(\n            '.search-popover-item',\n          );\n          if (firstItem) {\n            firstItem.classList.add('focus');\n          }\n        }}\n        onBlur={() => {\n          setTimeout(() => {\n            setSearchMenuOpen(false);\n          }, 100);\n          formRef.current\n            ?.querySelector('.search-popover-item.focus')\n            ?.classList.remove('focus');\n        }}\n        onKeyDown={(e) => {\n          const { key } = e;\n          switch (key) {\n            case 'Escape':\n              setSearchMenuOpen(false);\n              break;\n            case 'Down':\n            case 'ArrowDown':\n              e.preventDefault();\n              if (searchMenuOpen) {\n                const focusItem = formRef.current.querySelector(\n                  '.search-popover-item.focus',\n                );\n                if (focusItem) {\n                  let nextItem = focusItem.nextElementSibling;\n                  while (nextItem && nextItem.hidden) {\n                    nextItem = nextItem.nextElementSibling;\n                  }\n                  if (nextItem) {\n                    nextItem.classList.add('focus');\n                    const siblings = Array.from(\n                      nextItem.parentElement.children,\n                    ).filter((el) => el !== nextItem);\n                    siblings.forEach((el) => {\n                      el.classList.remove('focus');\n                    });\n                  }\n                } else {\n                  const firstItem = formRef.current.querySelector(\n                    '.search-popover-item',\n                  );\n                  if (firstItem) {\n                    firstItem.classList.add('focus');\n                  }\n                }\n              }\n              break;\n            case 'Up':\n            case 'ArrowUp':\n              e.preventDefault();\n              if (searchMenuOpen) {\n                const focusItem = document.querySelector(\n                  '.search-popover-item.focus',\n                );\n                if (focusItem) {\n                  let prevItem = focusItem.previousElementSibling;\n                  while (prevItem && prevItem.hidden) {\n                    prevItem = prevItem.previousElementSibling;\n                  }\n                  if (prevItem) {\n                    prevItem.classList.add('focus');\n                    const siblings = Array.from(\n                      prevItem.parentElement.children,\n                    ).filter((el) => el !== prevItem);\n                    siblings.forEach((el) => {\n                      el.classList.remove('focus');\n                    });\n                  }\n                } else {\n                  const items = document.querySelectorAll(\n                    '.search-popover-item',\n                  );\n                  const lastItem = items[items.length - 1];\n                  if (lastItem) {\n                    lastItem.classList.add('focus');\n                  }\n                }\n              }\n              break;\n            case 'Enter':\n              if (searchMenuOpen) {\n                const focusItem = document.querySelector(\n                  '.search-popover-item.focus',\n                );\n                if (focusItem) {\n                  e.preventDefault();\n                  focusItem.click();\n                }\n                setSearchMenuOpen(false);\n                props?.onSubmit?.(e);\n              }\n              break;\n          }\n        }}\n      />\n      <div class=\"search-popover\" hidden={!searchMenuOpen}>\n        {/* Search History - show when no query */}\n        {!query && searchHistory.length > 0 && (\n          <div class=\"search-popover-recent-searches\">\n            <div class=\"search-popover-header\">\n              <Icon icon=\"history\" size=\"s\" />\n              <Trans>Recent searches</Trans>\n            </div>\n            {searchHistory.map((historyItem, i) => {\n              const { label, to, icon } = generateSearchItemData(\n                historyItem.query,\n                historyItem.queryType,\n                instance,\n              );\n\n              return (\n                <Link\n                  key={`${historyItem.query}-${historyItem.queryType}-${historyItem.timestamp}`}\n                  to={to}\n                  class={`search-popover-item ${i === 0 ? 'focus' : ''}`}\n                  onClick={(e) => {\n                    addToSearchHistory(\n                      historyItem.query,\n                      historyItem.queryType,\n                    );\n                    props?.onSubmit?.(e);\n                  }}\n                >\n                  <Icon icon={icon} class=\"more-insignificant\" />\n                  <span>{label}</span>\n                </Link>\n              );\n            })}\n            <Link\n              to=\"/search\"\n              class=\"search-popover-item search-history-see-all\"\n            >\n              <Icon icon=\"more2\" class=\"more-insignificant\" />\n              <span>\n                <Trans>See all</Trans>\n              </span>\n            </Link>\n          </div>\n        )}\n\n        {/* Search Suggestions - show when there's a query */}\n        {searchSuggestionsData.map(\n          ({ label, to, icon, queryType, isRecentSearch, historyItem }, i) => (\n            <Link\n              key={\n                isRecentSearch\n                  ? `recent-${historyItem.query}-${historyItem.queryType}-${historyItem.timestamp}`\n                  : `suggestion-${queryType || 'general'}-${i}`\n              }\n              to={to}\n              class={`search-popover-item ${isRecentSearch ? 'search-popover-item-recent' : ''} ${i === 0 ? 'focus' : ''}`}\n              onClick={(e) => {\n                if (!isRecentSearch) {\n                  addToSearchHistory(query, queryType);\n                }\n                props?.onSubmit?.(e);\n              }}\n            >\n              <Icon icon={icon} class=\"more-insignificant\" />\n              <span>{label}</span>\n            </Link>\n          ),\n        )}\n      </div>\n    </form>\n  );\n});\n\nexport default SearchForm;\n","import './search-command.css';\n\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSnapshot } from 'valtio';\n\nimport states from '../utils/states';\n\nimport SearchForm from './search-form';\n\nexport default memo(function SearchCommand({ onClose = () => {} }) {\n  const snapStates = useSnapshot(states);\n  const [showSearch, setShowSearch] = useState(false);\n  const searchFormRef = useRef(null);\n\n  useEffect(() => {\n    if (snapStates.showSearchCommand) {\n      const { query } = snapStates.showSearchCommand;\n      setShowSearch(true);\n      setTimeout(() => {\n        if (query) {\n          searchFormRef.current?.setValue?.(query);\n        }\n        searchFormRef.current?.focus?.();\n      }, 150);\n      states.showSearchCommand = false;\n    }\n  }, [snapStates.showSearchCommand]);\n\n  useHotkeys(\n    ['Slash', '/'],\n    (e) => {\n      setShowSearch(true);\n      setTimeout(() => {\n        searchFormRef.current?.focus?.();\n        searchFormRef.current?.select?.();\n      }, 0);\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => {\n        const isSearchPage = /\\/search/.test(location.hash);\n        const isYearInPostsPage = /\\/yip/.test(location.hash);\n        const hasModal = !!document.querySelector('#modal-container > *');\n        return (\n          isSearchPage ||\n          isYearInPostsPage ||\n          hasModal ||\n          e.metaKey ||\n          e.ctrlKey ||\n          e.altKey ||\n          e.shiftKey\n        );\n      },\n    },\n  );\n\n  const closeSearch = () => {\n    setShowSearch(false);\n    onClose();\n  };\n\n  useHotkeys(\n    'esc',\n    (e) => {\n      searchFormRef.current?.blur?.();\n      closeSearch();\n    },\n    {\n      enabled: showSearch,\n      enableOnFormTags: true,\n      preventDefault: true,\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const hidden = !showSearch;\n\n  return (\n    <div\n      id=\"search-command-container\"\n      hidden={hidden}\n      onClick={(e) => {\n        console.log(e);\n        if (e.target === e.currentTarget) {\n          closeSearch();\n        }\n      }}\n    >\n      <SearchForm\n        ref={searchFormRef}\n        hidden={hidden}\n        onSubmit={() => {\n          closeSearch();\n        }}\n      />\n    </div>\n  );\n});\n","import './shortcuts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider } from '@szhsin/react-menu';\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useNavigate } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport { SHORTCUTS_META } from '../components/shortcuts-settings';\nimport { api } from '../utils/api';\nimport { getLists } from '../utils/lists';\nimport states from '../utils/states';\n\nimport AsyncText from './AsyncText';\nimport Icon from './icon';\nimport Link from './link';\nimport ListExclusiveBadge from './list-exclusive-badge';\nimport MenuLink from './menu-link';\nimport Menu2 from './menu2';\nimport SubMenu2 from './submenu2';\n\nfunction Shortcuts() {\n  const { t, _ } = useLingui();\n  const { instance } = api();\n  const snapStates = useSnapshot(states);\n  const { shortcuts, settings } = snapStates;\n\n  if (!shortcuts.length) {\n    return null;\n  }\n  const isMultiColumnMode =\n    settings.shortcutsViewMode === 'multi-column' ||\n    (!settings.shortcutsViewMode && settings.shortcutsColumnsMode);\n\n  const menuRef = useRef();\n  const tabBarRef = useRef();\n\n  const hasLists = useRef(false);\n  const formattedShortcuts = shortcuts\n    .map((pin, i) => {\n      const { type, ...data } = pin;\n      if (!SHORTCUTS_META[type]) return null;\n      let { id, path, title, subtitle, icon } = SHORTCUTS_META[type];\n\n      if (typeof id === 'function') {\n        id = id(data, i);\n      }\n      if (typeof path === 'function') {\n        path = path(\n          {\n            ...data,\n            instance: data.instance || instance,\n          },\n          i,\n        );\n      }\n      if (typeof title === 'function') {\n        title = title(data, i);\n      } else if (title?.id) {\n        // Check if it's MessageDescriptor\n        title = _(title);\n      }\n      if (typeof subtitle === 'function') {\n        subtitle = subtitle(data, i);\n      } else if (subtitle?.id) {\n        // Check if it's MessageDescriptor\n        subtitle = _(subtitle);\n      }\n      if (typeof icon === 'function') {\n        icon = icon(data, i);\n      }\n\n      if (id === 'lists') {\n        hasLists.current = true;\n      }\n\n      return {\n        id,\n        path,\n        title,\n        subtitle,\n        icon,\n      };\n    })\n    .filter(Boolean);\n\n  // Auto-scroll to active tab on first render\n  useEffect(() => {\n    if (\n      snapStates.settings.shortcutsViewMode === 'tab-menu-bar' &&\n      tabBarRef.current\n    ) {\n      const timeoutId = setTimeout(() => {\n        const activeTab = tabBarRef.current?.querySelector('.is-active');\n        if (activeTab) {\n          activeTab.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n            inline: 'center',\n          });\n        }\n      }, 100);\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, []);\n\n  const navigate = useNavigate();\n  useHotkeys(\n    ['1', '2', '3', '4', '5', '6', '7', '8', '9'],\n    (e) => {\n      const index = parseInt(e.key, 10) - 1;\n      if (index < formattedShortcuts.length) {\n        const { path } = formattedShortcuts[index];\n        if (path) {\n          navigate(path);\n          menuRef.current?.closeMenu?.();\n        }\n      }\n    },\n    {\n      enabled: !isMultiColumnMode,\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const [lists, setLists] = useState([]);\n\n  if (isMultiColumnMode) {\n    return null;\n  }\n\n  return (\n    <div id=\"shortcuts\">\n      {snapStates.settings.shortcutsViewMode === 'tab-menu-bar' ? (\n        <nav\n          ref={tabBarRef}\n          class=\"tab-bar\"\n          onContextMenu={(e) => {\n            e.preventDefault();\n            states.showShortcutsSettings = true;\n          }}\n        >\n          <ul>\n            {formattedShortcuts.map(\n              ({ id, path, title, subtitle, icon }, i) => {\n                return (\n                  <li key={`${i}-${id}-${title}-${subtitle}-${path}`}>\n                    <Link\n                      class={subtitle ? 'has-subtitle' : ''}\n                      to={path}\n                      onClick={(e) => {\n                        if (e.target.classList.contains('is-active')) {\n                          e.preventDefault();\n                          const page = document.getElementById(`${id}-page`);\n                          console.log(id, page);\n                          if (page) {\n                            page.scrollTop = 0;\n                            const updatesButton =\n                              page.querySelector('.updates-button');\n                            if (updatesButton) {\n                              updatesButton.click();\n                            }\n                          }\n                        }\n                      }}\n                    >\n                      <Icon icon={icon} size=\"xl\" />\n                      <span>\n                        <AsyncText>{title}</AsyncText>\n                        {subtitle && (\n                          <>\n                            <br />\n                            <small>{subtitle}</small>\n                          </>\n                        )}\n                      </span>\n                    </Link>\n                  </li>\n                );\n              },\n            )}\n          </ul>\n        </nav>\n      ) : (\n        <Menu2\n          instanceRef={menuRef}\n          overflow=\"auto\"\n          viewScroll=\"close\"\n          menuClassName=\"glass-menu shortcuts-menu\"\n          gap={8}\n          position=\"anchor\"\n          onMenuChange={(e) => {\n            if (e.open && hasLists.current) {\n              getLists().then(setLists);\n            }\n          }}\n          menuButton={\n            <button\n              type=\"button\"\n              id=\"shortcuts-button\"\n              class=\"plain\"\n              onContextMenu={(e) => {\n                e.preventDefault();\n                states.showShortcutsSettings = true;\n              }}\n              onTransitionStart={(e) => {\n                // Close menu if the button disappears\n                try {\n                  const { target } = e;\n                  if (getComputedStyle(target).pointerEvents === 'none') {\n                    menuRef.current?.closeMenu?.();\n                  }\n                } catch (e) {}\n              }}\n            >\n              <Icon icon=\"shortcut\" size=\"xl\" alt={t`Shortcuts`} />\n            </button>\n          }\n        >\n          {formattedShortcuts.map(({ id, path, title, subtitle, icon }, i) => {\n            if (id === 'lists') {\n              return (\n                <SubMenu2\n                  menuClassName=\"glass-menu\"\n                  overflow=\"auto\"\n                  gap={-8}\n                  label={\n                    <>\n                      <Icon icon={icon} size=\"l\" />\n                      <span class=\"menu-grow\">\n                        <AsyncText>{title}</AsyncText>\n                      </span>\n                      <Icon icon=\"chevron-right\" />\n                    </>\n                  }\n                >\n                  <MenuLink to=\"/l\">\n                    <span>\n                      <Trans>All Lists</Trans>\n                    </span>\n                  </MenuLink>\n                  <MenuDivider />\n                  {lists?.map((list) => (\n                    <MenuLink key={list.id} to={`/l/${list.id}`}>\n                      <span>\n                        {list.title}\n                        {list.exclusive && (\n                          <>\n                            {' '}\n                            <ListExclusiveBadge />\n                          </>\n                        )}\n                      </span>\n                    </MenuLink>\n                  ))}\n                </SubMenu2>\n              );\n            }\n\n            return (\n              <MenuLink\n                to={path}\n                key={`${i}-${id}-${title}-${subtitle}-${path}`}\n                class=\"glass-menu-item\"\n              >\n                <Icon icon={icon} size=\"l\" />{' '}\n                <span class=\"menu-grow\">\n                  <span>\n                    <AsyncText>{title}</AsyncText>\n                  </span>\n                  {subtitle && (\n                    <>\n                      {' '}\n                      <small class=\"more-insignificant\">{subtitle}</small>\n                    </>\n                  )}\n                </span>\n                <span class=\"menu-shortcut hide-until-focus-visible\">\n                  {i + 1}\n                </span>\n              </MenuLink>\n            );\n          })}\n        </Menu2>\n      )}\n    </div>\n  );\n}\n\nexport default memo(Shortcuts);\n","import { api } from './api';\nimport { extractTagsFromStatus, getFollowedTags } from './followed-tags';\nimport pmem from './pmem';\nimport { fetchRelationships } from './relationships';\nimport states, { saveStatus, statusKey } from './states';\nimport store from './store';\nimport supports from './supports';\n\nexport function groupBoosts(values) {\n  let newValues = [];\n  let boostStash = [];\n  let serialBoosts = 0;\n  for (let i = 0; i < values.length; i++) {\n    const item = values[i];\n    if (item.reblog && !item.account?.group) {\n      boostStash.push(item);\n      serialBoosts++;\n    } else {\n      newValues.push(item);\n      if (serialBoosts < 3) {\n        serialBoosts = 0;\n      }\n    }\n  }\n  // if boostStash is more than quarter of values\n  // or if there are 3 or more boosts in a row\n  if (\n    values.length > 10 &&\n    (boostStash.length > values.length / 4 || serialBoosts >= 3)\n  ) {\n    // if boostStash is more than 3 quarter of values\n    const boostStashID = boostStash.map((status) => status.id);\n    if (boostStash.length > (values.length * 3) / 4) {\n      // insert boost array at the end of specialHome list\n      newValues = [\n        ...newValues,\n        { id: boostStashID, items: boostStash, type: 'boosts' },\n      ];\n    } else {\n      // insert boosts array in the middle of specialHome list\n      const half = Math.floor(newValues.length / 2);\n      newValues = [\n        ...newValues.slice(0, half),\n        {\n          id: boostStashID,\n          items: boostStash,\n          type: 'boosts',\n        },\n        ...newValues.slice(half),\n      ];\n    }\n    return newValues;\n  } else {\n    return values;\n  }\n}\n\nexport function dedupeBoosts(items, instance) {\n  const boostedStatusIDs = store.account.get('boostedStatusIDs') || {};\n  const filteredItems = items.filter((item) => {\n    if (!item.reblog) return true;\n    const statusKey = `${instance}-${item.reblog.id}`;\n    const boosterID = boostedStatusIDs[statusKey];\n    if (boosterID && boosterID !== item.id) {\n      console.warn(\n        ` Duplicate boost by ${item.account.displayName}`,\n        item,\n        item.reblog,\n      );\n      return false;\n    } else {\n      boostedStatusIDs[statusKey] = item.id;\n    }\n    return true;\n  });\n  // Limit to 50\n  const keys = Object.keys(boostedStatusIDs);\n  if (keys.length > 50) {\n    keys.slice(0, keys.length - 50).forEach((key) => {\n      delete boostedStatusIDs[key];\n    });\n  }\n  store.account.set('boostedStatusIDs', boostedStatusIDs);\n  return filteredItems;\n}\n\nexport function groupContext(items, instance) {\n  const contexts = [];\n  let contextIndex = 0;\n  items.forEach((item) => {\n    for (let i = 0; i < contexts.length; i++) {\n      if (contexts[i].find((t) => t.id === item.id)) return;\n      if (\n        contexts[i].find((t) => t.id === item.inReplyToId) ||\n        contexts[i].find((t) => t.inReplyToId === item.id)\n      ) {\n        contexts[i].push(item);\n        return;\n      }\n    }\n    const repliedItem = items.find((i) => i.id === item.inReplyToId);\n    if (repliedItem) {\n      contexts[contextIndex++] = [item, repliedItem];\n    }\n  });\n\n  // Check for cross-item contexts\n  // Merge contexts into one if they have a common item (same id)\n  for (let i = 0; i < contexts.length; i++) {\n    for (let j = i + 1; j < contexts.length; j++) {\n      const commonItem = contexts[i].find((t) => contexts[j].includes(t));\n      if (commonItem) {\n        contexts[i] = [...contexts[i], ...contexts[j]];\n        // Remove duplicate items\n        contexts[i] = contexts[i].filter(\n          (item, index, self) =>\n            self.findIndex((t) => t.id === item.id) === index,\n        );\n        contexts.splice(j, 1);\n        j--;\n      }\n    }\n  }\n\n  // Sort items by checking inReplyToId\n  contexts.forEach((context) => {\n    context.sort((a, b) => {\n      if (!a.inReplyToId && !b.inReplyToId) {\n        return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n      }\n      if (a.inReplyToId === b.id) return 1;\n      if (b.inReplyToId === a.id) return -1;\n      if (!a.inReplyToId) return -1;\n      if (!b.inReplyToId) return 1;\n      return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n    });\n  });\n\n  // Tag items that has different author than first post's author\n  contexts.forEach((context) => {\n    const firstItemAccountID = context[0].account.id;\n    context.forEach((item) => {\n      if (item.account.id !== firstItemAccountID) {\n        item._differentAuthor = true;\n      }\n    });\n  });\n\n  if (contexts.length) console.log(' Contexts', contexts);\n\n  const newItems = [];\n  const appliedContextIndices = [];\n  const inReplyToIds = [];\n  items.forEach((item) => {\n    if (item.reblog) {\n      newItems.push(item);\n      return;\n    }\n    for (let i = 0; i < contexts.length; i++) {\n      if (contexts[i].find((t) => t.id === item.id)) {\n        if (appliedContextIndices.includes(i)) return;\n        const contextItems = contexts[i];\n        contextItems.sort((a, b) => {\n          return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n        });\n        const firstItemAccountID = contextItems[0].account.id;\n        newItems.push({\n          id: contextItems.map((i) => i.id),\n          items: contextItems,\n          type: contextItems.every((it) => it.account.id === firstItemAccountID)\n            ? 'thread'\n            : 'conversation',\n        });\n        appliedContextIndices.push(i);\n        return;\n      }\n    }\n\n    // PREPARE FOR REPLY HINTS\n    if (item.inReplyToId && item.inReplyToAccountId !== item.account.id) {\n      const sKey = statusKey(item.id, instance);\n      if (!states.statusReply[sKey]) {\n        // If it's a reply and not a thread\n        inReplyToIds.push({\n          sKey,\n          inReplyToId: item.inReplyToId,\n        });\n        // queueMicrotask(async () => {\n        //   try {\n        //     const { masto } = api({ instance });\n        //     // const replyToStatus = await masto.v1.statuses\n        //     //   .$select(item.inReplyToId)\n        //     //   .fetch();\n        //     const replyToStatus = await fetchStatus(item.inReplyToId, masto);\n        //     saveStatus(replyToStatus, instance, {\n        //       skipThreading: true,\n        //       skipUnfurling: true,\n        //     });\n        //     states.statusReply[sKey] = {\n        //       id: replyToStatus.id,\n        //       instance,\n        //     };\n        //   } catch (e) {\n        //     // Silently fail\n        //     console.error(e);\n        //   }\n        // });\n      }\n    }\n\n    newItems.push(item);\n  });\n\n  // FETCH AND SHOW REPLY HINTS\n  if (inReplyToIds?.length) {\n    queueMicrotask(() => {\n      const { masto } = api({ instance });\n      console.log('REPLYHINT', inReplyToIds);\n\n      // Fallback if batch fetch fails or returns nothing or not supported\n      async function fallbackFetch() {\n        for (let i = 0; i < inReplyToIds.length; i++) {\n          const { sKey, inReplyToId } = inReplyToIds[i];\n          try {\n            const replyToStatus = await fetchStatus(inReplyToId, masto);\n            saveStatus(replyToStatus, instance, {\n              skipThreading: true,\n            });\n            states.statusReply[sKey] = {\n              id: replyToStatus.id,\n              instance,\n            };\n            // Pause 1s\n            await new Promise((resolve) => setTimeout(resolve, 1000));\n          } catch (e) {\n            // Silently fail\n            console.error(e);\n          }\n        }\n      }\n\n      if (supports('@mastodon/fetch-multiple-statuses')) {\n        // This is batch fetching yooo, woot\n        // Limit 20, returns 422 if exceeded https://github.com/mastodon/mastodon/pull/27871\n        const ids = inReplyToIds.map(({ inReplyToId }) => inReplyToId);\n        (async () => {\n          try {\n            const replyToStatuses = await masto.v1.statuses.list({ id: ids });\n            if (replyToStatuses?.length) {\n              for (const replyToStatus of replyToStatuses) {\n                saveStatus(replyToStatus, instance, {\n                  skipThreading: true,\n                });\n                const sKey = inReplyToIds.find(\n                  ({ inReplyToId }) => inReplyToId === replyToStatus.id,\n                )?.sKey;\n                if (sKey) {\n                  states.statusReply[sKey] = {\n                    id: replyToStatus.id,\n                    instance,\n                  };\n                }\n              }\n            } else {\n              fallbackFetch();\n            }\n          } catch (e) {\n            // Silently fail\n            console.error(e);\n            fallbackFetch();\n          }\n        })();\n      } else {\n        fallbackFetch();\n      }\n    });\n  }\n\n  return newItems;\n}\n\nconst fetchStatus = pmem((statusID, masto) => {\n  return masto.v1.statuses.$select(statusID).fetch();\n});\n\nexport async function assignFollowedTags(items, instance) {\n  const followedTags = await getFollowedTags(); // [{name: 'tag'}, {...}]\n  if (!followedTags.length) return;\n  const { statusFollowedTags } = states;\n  console.log('statusFollowedTags', statusFollowedTags);\n  const statusWithFollowedTags = [];\n  items.forEach((item) => {\n    if (item.reblog) return;\n    const { id, content, tags = [] } = item;\n    const sKey = statusKey(id, instance);\n    if (statusFollowedTags[sKey]?.length) return;\n    const extractedTags = extractTagsFromStatus(content);\n    if (!extractedTags.length && !tags.length) return;\n    const itemFollowedTags = followedTags.reduce((acc, tag) => {\n      if (\n        extractedTags.some((t) => t.toLowerCase() === tag.name.toLowerCase()) ||\n        tags.some((t) => t.name.toLowerCase() === tag.name.toLowerCase())\n      ) {\n        acc.push(tag.name);\n      }\n      return acc;\n    }, []);\n    if (itemFollowedTags.length) {\n      // statusFollowedTags[sKey] = itemFollowedTags;\n      statusWithFollowedTags.push({\n        item,\n        sKey,\n        followedTags: itemFollowedTags,\n      });\n    }\n  });\n\n  if (statusWithFollowedTags.length) {\n    const accounts = statusWithFollowedTags.map((s) => s.item.account);\n    const relationships = await fetchRelationships(accounts);\n    if (!relationships) return;\n\n    statusWithFollowedTags.forEach((s) => {\n      const { item, sKey, followedTags } = s;\n      const r = relationships[item.account.id];\n      if (r && !r.following) {\n        statusFollowedTags[sKey] = followedTags;\n      }\n    });\n  }\n}\n\nexport function clearFollowedTagsState() {\n  states.statusFollowedTags = {};\n}\n","import { useLayoutEffect, useState } from 'preact/hooks';\n\nexport default function useScroll({\n  scrollableRef,\n  distanceFromStart = 1, // ratio of clientHeight/clientWidth\n  distanceFromEnd = 1, // ratio of clientHeight/clientWidth\n  scrollThresholdStart = 10,\n  scrollThresholdEnd = 10,\n  direction = 'vertical',\n  distanceFromStartPx: _distanceFromStartPx,\n  distanceFromEndPx: _distanceFromEndPx,\n} = {}) {\n  const [scrollDirection, setScrollDirection] = useState(null);\n  const [reachStart, setReachStart] = useState(false);\n  const [reachEnd, setReachEnd] = useState(false);\n  const [nearReachStart, setNearReachStart] = useState(false);\n  const [nearReachEnd, setNearReachEnd] = useState(false);\n  const isVertical = direction === 'vertical';\n\n  useLayoutEffect(() => {\n    const scrollableElement = scrollableRef.current;\n    if (!scrollableElement) return {};\n    let previousScrollStart = isVertical\n      ? scrollableElement.scrollTop\n      : scrollableElement.scrollLeft;\n\n    function onScroll() {\n      const {\n        scrollTop,\n        scrollLeft,\n        scrollHeight,\n        scrollWidth,\n        clientHeight,\n        clientWidth,\n      } = scrollableElement;\n      const scrollStart = isVertical ? scrollTop : scrollLeft;\n      const scrollDimension = isVertical ? scrollHeight : scrollWidth;\n      const clientDimension = isVertical ? clientHeight : clientWidth;\n      const scrollDistance = Math.abs(scrollStart - previousScrollStart);\n      const distanceFromStartPx =\n        _distanceFromStartPx ||\n        Math.min(\n          clientDimension * distanceFromStart,\n          scrollDimension,\n          scrollStart,\n        );\n      const distanceFromEndPx =\n        _distanceFromEndPx ||\n        Math.min(\n          clientDimension * distanceFromEnd,\n          scrollDimension,\n          scrollDimension - scrollStart - clientDimension,\n        );\n\n      if (\n        scrollDistance >=\n        (previousScrollStart < scrollStart\n          ? scrollThresholdEnd\n          : scrollThresholdStart)\n      ) {\n        setScrollDirection(previousScrollStart < scrollStart ? 'end' : 'start');\n        previousScrollStart = scrollStart;\n      }\n\n      setReachStart(scrollStart <= 0);\n      setReachEnd(scrollStart + clientDimension >= scrollDimension);\n      setNearReachStart(scrollStart <= distanceFromStartPx);\n      setNearReachEnd(\n        scrollStart + clientDimension >= scrollDimension - distanceFromEndPx,\n      );\n    }\n\n    scrollableElement.addEventListener('scroll', onScroll, { passive: true });\n\n    return () => scrollableElement.removeEventListener('scroll', onScroll);\n  }, [\n    distanceFromStart,\n    distanceFromEnd,\n    scrollThresholdStart,\n    scrollThresholdEnd,\n  ]);\n\n  return {\n    scrollDirection,\n    reachStart,\n    reachEnd,\n    nearReachStart,\n    nearReachEnd,\n    init: () => {\n      if (scrollableRef.current) {\n        scrollableRef.current.dispatchEvent(new Event('scroll'));\n      }\n    },\n  };\n}\n","import { useEffect, useLayoutEffect, useRef, useState } from 'preact/hooks';\nimport { useThrottledCallback } from 'use-debounce';\n\nexport default function useScrollFn(\n  {\n    scrollableRef,\n    distanceFromStart = 1, // ratio of clientHeight/clientWidth\n    distanceFromEnd = 1, // ratio of clientHeight/clientWidth\n    scrollThresholdStart = 10,\n    scrollThresholdEnd = 10,\n    direction = 'vertical',\n    distanceFromStartPx: _distanceFromStartPx,\n    distanceFromEndPx: _distanceFromEndPx,\n    init,\n  } = {},\n  callback,\n) {\n  if (!callback) return;\n  const isVertical = direction === 'vertical';\n  const previousScrollStart = useRef(null);\n  const scrollDirection = useRef(null);\n\n  const onScroll = useThrottledCallback(\n    () => {\n      let reachStart = false;\n      let reachEnd = false;\n      let nearReachStart = false;\n      let nearReachEnd = false;\n\n      const scrollableElement = scrollableRef.current;\n      const {\n        scrollTop,\n        scrollLeft,\n        scrollHeight,\n        scrollWidth,\n        clientHeight,\n        clientWidth,\n      } = scrollableElement;\n      const scrollStart = isVertical ? scrollTop : scrollLeft;\n      const scrollDimension = isVertical ? scrollHeight : scrollWidth;\n      const clientDimension = isVertical ? clientHeight : clientWidth;\n      const scrollDelta = scrollStart - previousScrollStart.current;\n      const isScrollingForward = scrollDelta > 0;\n      const threshold = isScrollingForward\n        ? scrollThresholdEnd\n        : scrollThresholdStart;\n      const distanceFromStartPx =\n        _distanceFromStartPx ||\n        Math.min(\n          clientDimension * distanceFromStart,\n          scrollDimension,\n          scrollStart,\n        );\n      const distanceFromEndPx =\n        _distanceFromEndPx ||\n        Math.min(\n          clientDimension * distanceFromEnd,\n          scrollDimension,\n          scrollDimension - scrollStart - clientDimension,\n        );\n\n      if (Math.abs(scrollDelta) >= threshold) {\n        scrollDirection.current = isScrollingForward ? 'end' : 'start';\n        previousScrollStart.current = scrollStart;\n      }\n\n      reachStart = scrollStart <= 0;\n      reachEnd = scrollStart + clientDimension >= scrollDimension;\n      nearReachStart = scrollStart <= distanceFromStartPx;\n      nearReachEnd =\n        scrollStart + clientDimension >= scrollDimension - distanceFromEndPx;\n\n      callback({\n        scrollDirection: scrollDirection.current,\n        reachStart,\n        reachEnd,\n        nearReachStart,\n        nearReachEnd,\n      });\n    },\n    500,\n    {\n      leading: false,\n    },\n  );\n\n  useLayoutEffect(() => {\n    const scrollableElement = scrollableRef.current;\n    if (scrollableElement) {\n      previousScrollStart.current =\n        scrollableElement[isVertical ? 'scrollTop' : 'scrollLeft'];\n      scrollableElement.addEventListener('scroll', onScroll, { passive: true });\n    }\n    return () => {\n      if (scrollableElement) {\n        scrollableElement.removeEventListener('scroll', onScroll);\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    if (init && scrollableRef.current) {\n      queueMicrotask(() => {\n        scrollableRef.current.dispatchEvent(new Event('scroll'));\n      });\n    }\n  }, [init]);\n\n  return {\n    resetScrollDirection: () => {\n      scrollDirection.current = null;\n    },\n  };\n}\n","import './media-post.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport { useContext, useMemo } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport { getPreferences } from '../utils/api';\nimport FilterContext from '../utils/filter-context';\nimport { isFiltered } from '../utils/filters';\nimport states, { statusKey } from '../utils/states';\nimport store from '../utils/store';\nimport { getCurrentAccountID } from '../utils/store-utils';\n\nimport Media from './media';\n\nfunction MediaPost({\n  class: className,\n  statusID,\n  status,\n  instance,\n  parent,\n  // allowFilters,\n  onMediaClick,\n}) {\n  const { t } = useLingui();\n  let sKey = statusKey(statusID, instance);\n  const snapStates = useSnapshot(states);\n  if (!status) {\n    status = snapStates.statuses[sKey] || snapStates.statuses[statusID];\n    sKey = statusKey(status?.id, instance);\n  }\n  if (!status) {\n    return null;\n  }\n\n  const {\n    account: {\n      acct,\n      avatar,\n      avatarStatic,\n      id: accountId,\n      url: accountURL,\n      displayName,\n      username,\n      emojis: accountEmojis,\n      bot,\n      group,\n    },\n    id,\n    repliesCount,\n    reblogged,\n    reblogsCount,\n    favourited,\n    favouritesCount,\n    bookmarked,\n    poll,\n    muted,\n    sensitive,\n    spoilerText,\n    visibility, // public, unlisted, private, direct\n    language,\n    editedAt,\n    filtered,\n    card,\n    createdAt,\n    inReplyToId,\n    inReplyToAccountId,\n    content,\n    mentions,\n    mediaAttachments,\n    reblog,\n    uri,\n    url,\n    emojis,\n    // Non-API props\n    _deleted,\n    _pinned,\n    // _filtered,\n  } = status;\n\n  if (!mediaAttachments?.length) {\n    return null;\n  }\n\n  const debugHover = (e) => {\n    if (e.shiftKey) {\n      console.log({\n        ...status,\n      });\n    }\n  };\n\n  const currentAccount = useMemo(() => {\n    return getCurrentAccountID();\n  }, []);\n  const isSelf = useMemo(() => {\n    return currentAccount && currentAccount === accountId;\n  }, [accountId, currentAccount]);\n\n  const filterContext = useContext(FilterContext);\n  const filterInfo = !isSelf && isFiltered(filtered, filterContext);\n\n  if (filterInfo?.action === 'hide') {\n    return null;\n  }\n\n  console.debug('RENDER Media post', id, status?.account.displayName);\n\n  const hasSpoiler = sensitive;\n  const prefs = getPreferences();\n  const readingExpandMedia =\n    prefs['reading:expand:media']?.toLowerCase() || 'default';\n  const showSpoilerMedia = readingExpandMedia === 'show_all';\n\n  const Parent = parent || 'div';\n\n  return mediaAttachments.map((media, i) => {\n    const mediaKey = `${sKey}-${media.id}`;\n    const filterTitleStr = filterInfo?.titlesStr;\n    return (\n      <Parent\n        data-state-post-id={sKey}\n        onMouseEnter={debugHover}\n        key={mediaKey}\n        data-spoiler-text={\n          spoilerText || (sensitive ? t`Sensitive media` : undefined)\n        }\n        data-filtered-text={\n          filterInfo\n            ? filterTitleStr\n              ? t`Filtered: ${filterTitleStr}`\n              : t`Filtered`\n            : undefined\n        }\n        class={`\n          media-post\n          ${filterInfo ? 'filtered' : ''}\n          ${hasSpoiler ? 'has-spoiler' : ''}\n          ${showSpoilerMedia ? 'show-media' : ''}\n        `}\n      >\n        <Media\n          class={className}\n          media={media}\n          lang={language}\n          to={`/${instance}/s/${id}?media-only=${i + 1}`}\n          onClick={\n            onMediaClick ? (e) => onMediaClick(e, i, media, status) : undefined\n          }\n        />\n      </Parent>\n    );\n  });\n}\n\nexport default memo(MediaPost);\n","import './nav-menu.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { ControlledMenu, MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { memo } from 'preact/compat';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useLongPress } from 'use-long-press';\nimport { useSnapshot } from 'valtio';\n\nimport { api } from '../utils/api';\nimport { getLists } from '../utils/lists';\nimport safeBoundingBoxPadding from '../utils/safe-bounding-box-padding';\nimport states from '../utils/states';\nimport store from '../utils/store';\nimport { getAccounts, getCurrentAccountID } from '../utils/store-utils';\nimport supports from '../utils/supports';\n\nimport Avatar from './avatar';\nimport Icon from './icon';\nimport ListExclusiveBadge from './list-exclusive-badge';\nimport MenuLink from './menu-link';\nimport SubMenu2 from './submenu2';\n\nfunction NavMenu(props) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { masto, instance, authenticated } = api();\n\n  const [currentAccount, moreThanOneAccount] = useMemo(() => {\n    const accounts = getAccounts();\n    const acc =\n      accounts.find((account) => account.info.id === getCurrentAccountID()) ||\n      accounts[0];\n    return [acc, accounts.length > 1];\n  }, []);\n\n  // Home = Following\n  // But when in multi-column mode, Home becomes columns of anything\n  // User may choose pin or not to pin Following\n  // If user doesn't pin Following, we show it in the menu\n  const showFollowing =\n    (snapStates.settings.shortcutsViewMode === 'multi-column' ||\n      (!snapStates.settings.shortcutsViewMode &&\n        snapStates.settings.shortcutsColumnsMode)) &&\n    !snapStates.shortcuts.find((pin) => pin.type === 'following');\n\n  const bindLongPress = useLongPress(\n    () => {\n      states.showAccounts = true;\n    },\n    {\n      threshold: 600,\n      detect: 'touch',\n      cancelOnMovement: true,\n    },\n  );\n\n  const buttonRef = useRef();\n  const [menuState, setMenuState] = useState(undefined);\n\n  const boundingBoxPadding = safeBoundingBoxPadding([\n    0,\n    0,\n    snapStates.settings.shortcutsViewMode === 'tab-menu-bar' ? 50 : 0,\n    0,\n  ]);\n\n  const mutesIterator = useRef();\n  async function fetchMutes(firstLoad) {\n    if (firstLoad || !mutesIterator.current) {\n      mutesIterator.current = masto.v1.mutes\n        .list({\n          limit: 80,\n        })\n        .values();\n    }\n    const results = await mutesIterator.current.next();\n    return results;\n  }\n\n  const blocksIterator = useRef();\n  async function fetchBlocks(firstLoad) {\n    if (firstLoad || !blocksIterator.current) {\n      blocksIterator.current = masto.v1.blocks\n        .list({\n          limit: 80,\n        })\n        .values();\n    }\n    const results = await blocksIterator.current.next();\n    return results;\n  }\n\n  const buttonClickTS = useRef();\n  return (\n    <>\n      <button\n        ref={buttonRef}\n        type=\"button\"\n        class={`button plain nav-menu-button ${\n          moreThanOneAccount ? 'with-avatar' : ''\n        } ${menuState === 'open' ? 'active' : ''}`}\n        style={{ position: 'relative' }}\n        onClick={() => {\n          buttonClickTS.current = Date.now();\n          setMenuState((state) => (!state ? 'open' : undefined));\n        }}\n        onContextMenu={(e) => {\n          e.preventDefault();\n          states.showAccounts = true;\n        }}\n        {...bindLongPress()}\n      >\n        {moreThanOneAccount && (\n          <Avatar\n            url={\n              currentAccount?.info?.avatar || currentAccount?.info?.avatarStatic\n            }\n            size=\"l\"\n            squircle={currentAccount?.info?.bot}\n          />\n        )}\n        <Icon icon=\"menu\" size={moreThanOneAccount ? 's' : 'l'} alt={t`Menu`} />\n      </button>\n      <ControlledMenu\n        menuClassName=\"nav-menu\"\n        state={menuState}\n        anchorRef={buttonRef}\n        onClose={() => {\n          setMenuState(undefined);\n        }}\n        containerProps={{\n          style: {\n            zIndex: 10,\n          },\n          onClick: () => {\n            if (Date.now() - buttonClickTS.current < 300) {\n              return;\n            }\n            // setMenuState(undefined);\n          },\n        }}\n        portal={{\n          target: document.body,\n        }}\n        {...props}\n        overflow=\"auto\"\n        viewScroll=\"close\"\n        position=\"anchor\"\n        align=\"center\"\n        boundingBoxPadding={boundingBoxPadding}\n        unmountOnClose\n      >\n        {!!snapStates.appVersion?.commitHash &&\n          __COMMIT_HASH__ !== snapStates.appVersion.commitHash && (\n            <div class=\"top-menu\">\n              <MenuItem\n                onClick={() => {\n                  const yes = confirm(t`Reload page now to update?`);\n                  if (yes) {\n                    (async () => {\n                      try {\n                        location.reload();\n                      } catch (e) {}\n                    })();\n                  }\n                }}\n              >\n                <Icon icon=\"sparkles\" class=\"sparkle-icon\" size=\"l\" />{' '}\n                <span>\n                  <Trans>New update available</Trans>\n                </span>\n              </MenuItem>\n              <MenuDivider />\n            </div>\n          )}\n        <section>\n          <MenuLink to=\"/\">\n            <Icon icon=\"home\" size=\"l\" />{' '}\n            <span>\n              <Trans>Home</Trans>\n            </span>\n          </MenuLink>\n          {authenticated ? (\n            <>\n              {showFollowing && (\n                <MenuLink to=\"/following\">\n                  <Icon icon=\"following\" size=\"l\" />{' '}\n                  <span>\n                    <Trans id=\"following.title\">Following</Trans>\n                  </span>\n                </MenuLink>\n              )}\n              <MenuLink to=\"/catchup\">\n                <Icon icon=\"history2\" size=\"l\" />\n                <span>\n                  <Trans>Catch-up</Trans>\n                </span>\n              </MenuLink>\n              {supports('@mastodon/mentions') && (\n                <MenuLink to=\"/mentions\">\n                  <Icon icon=\"at\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Mentions</Trans>\n                  </span>\n                </MenuLink>\n              )}\n              <MenuLink to=\"/notifications\">\n                <Icon icon=\"notification\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Notifications</Trans>\n                </span>\n                {snapStates.notificationsShowNew && (\n                  <sup title={t`New`} style={{ opacity: 0.5 }}>\n                    {' '}\n                    &bull;\n                  </sup>\n                )}\n              </MenuLink>\n              <MenuDivider />\n              {currentAccount?.info?.id && (\n                <MenuLink to={`/${instance}/a/${currentAccount.info.id}`}>\n                  <Icon icon=\"user\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Profile</Trans>\n                  </span>\n                </MenuLink>\n              )}\n              <ListMenu menuState={menuState} />\n              <MenuLink to=\"/b\">\n                <Icon icon=\"bookmark\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Bookmarks</Trans>\n                </span>\n              </MenuLink>\n              <SubMenu2\n                menuClassName=\"nav-submenu\"\n                overflow=\"auto\"\n                gap={-8}\n                label={\n                  <>\n                    <Icon icon=\"more\" size=\"l\" />\n                    <span class=\"menu-grow\">\n                      <Trans>More</Trans>\n                    </span>\n                    <Icon icon=\"chevron-right\" />\n                  </>\n                }\n              >\n                <MenuLink to=\"/f\">\n                  <Icon icon=\"heart\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Likes</Trans>\n                  </span>\n                </MenuLink>\n                <MenuLink to=\"/fh\">\n                  <Icon icon=\"hashtag\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Followed Hashtags</Trans>\n                  </span>\n                </MenuLink>\n                <MenuLink to=\"/sp\">\n                  <Icon icon=\"schedule\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Scheduled Posts</Trans>\n                  </span>\n                </MenuLink>\n                <MenuDivider />\n                {supports('@mastodon/filters') && (\n                  <MenuLink to=\"/ft\">\n                    <Icon icon=\"filters\" size=\"l\" />{' '}\n                    <span>\n                      <Trans>Filters</Trans>\n                    </span>\n                  </MenuLink>\n                )}\n                <MenuItem\n                  onClick={() => {\n                    states.showGenericAccounts = {\n                      id: 'mute',\n                      heading: t`Muted users`,\n                      fetchAccounts: fetchMutes,\n                      excludeRelationshipAttrs: ['muting'],\n                    };\n                  }}\n                >\n                  <Icon icon=\"mute\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Muted users</Trans>\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  onClick={() => {\n                    states.showGenericAccounts = {\n                      id: 'block',\n                      heading: t`Blocked users`,\n                      fetchAccounts: fetchBlocks,\n                      excludeRelationshipAttrs: ['blocking'],\n                    };\n                  }}\n                >\n                  <Icon icon=\"block\" size=\"l\" />{' '}\n                  <span>\n                    <Trans>Blocked users</Trans>\n                  </span>\n                </MenuItem>{' '}\n              </SubMenu2>\n              <MenuDivider />\n              <MenuItem\n                onClick={() => {\n                  states.showAccounts = true;\n                }}\n              >\n                <Icon icon=\"group\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Accounts</Trans>\n                </span>\n              </MenuItem>\n            </>\n          ) : (\n            <>\n              <MenuDivider />\n              <MenuLink to=\"/login\">\n                <Icon icon=\"user\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Log in</Trans>\n                </span>\n              </MenuLink>\n            </>\n          )}\n        </section>\n        <section>\n          <MenuDivider />\n          <MenuLink to={`/search`}>\n            <Icon icon=\"search\" size=\"l\" />{' '}\n            <span>\n              <Trans>Search</Trans>\n            </span>\n          </MenuLink>\n          <MenuLink to={`/${instance}/trending`}>\n            <Icon icon=\"chart\" size=\"l\" />{' '}\n            <span>\n              <Trans>Trending</Trans>\n            </span>\n          </MenuLink>\n          <MenuLink to={`/${instance}/p/l`}>\n            <Icon icon=\"building\" size=\"l\" />{' '}\n            <span>\n              <Trans>Local</Trans>\n            </span>\n          </MenuLink>\n          <MenuLink to={`/${instance}/p`}>\n            <Icon icon=\"earth\" size=\"l\" />{' '}\n            <span>\n              <Trans>Federated</Trans>\n            </span>\n          </MenuLink>\n          {authenticated ? (\n            <>\n              <MenuDivider className=\"divider-grow\" />\n              <MenuItem\n                onClick={() => {\n                  states.showKeyboardShortcutsHelp = true;\n                }}\n              >\n                <Icon icon=\"keyboard\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Keyboard shortcuts</Trans>\n                </span>\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  states.showShortcutsSettings = true;\n                }}\n              >\n                <Icon icon=\"shortcut\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Shortcuts / Columns</Trans>\n                </span>\n              </MenuItem>\n              <MenuItem\n                onClick={() => {\n                  states.showSettings = true;\n                }}\n              >\n                <Icon icon=\"gear\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Settings</Trans>\n                </span>\n              </MenuItem>\n            </>\n          ) : (\n            <>\n              <MenuDivider />\n              <MenuItem\n                onClick={() => {\n                  states.showSettings = true;\n                }}\n              >\n                <Icon icon=\"gear\" size=\"l\" />{' '}\n                <span>\n                  <Trans>Settings</Trans>\n                </span>\n              </MenuItem>\n            </>\n          )}\n        </section>\n      </ControlledMenu>\n    </>\n  );\n}\n\nfunction ListMenu({ menuState }) {\n  const supportsLists = supports('@mastodon/lists');\n  const [lists, setLists] = useState([]);\n  useEffect(() => {\n    if (!supportsLists) return;\n    if (menuState === 'open') {\n      getLists().then(setLists);\n    }\n  }, [menuState, supportsLists]);\n\n  return lists.length > 0 ? (\n    <SubMenu2\n      menuClassName=\"nav-submenu\"\n      overflow=\"auto\"\n      gap={-8}\n      label={\n        <>\n          <Icon icon=\"list\" size=\"l\" />\n          <span class=\"menu-grow\">\n            <Trans>Lists</Trans>\n          </span>\n          <Icon icon=\"chevron-right\" />\n        </>\n      }\n    >\n      <MenuLink to=\"/l\">\n        <span>\n          <Trans>All Lists</Trans>\n        </span>\n      </MenuLink>\n      {lists?.length > 0 && (\n        <>\n          <MenuDivider />\n          {lists.map((list) => (\n            <MenuLink key={list.id} to={`/l/${list.id}`}>\n              <span>\n                {list.title}\n                {list.exclusive && (\n                  <>\n                    {' '}\n                    <ListExclusiveBadge />\n                  </>\n                )}\n              </span>\n            </MenuLink>\n          ))}\n        </>\n      )}\n    </SubMenu2>\n  ) : (\n    supportsLists && (\n      <MenuLink to=\"/l\">\n        <Icon icon=\"list\" size=\"l\" />\n        <span>\n          <Trans>Lists</Trans>\n        </span>\n      </MenuLink>\n    )\n  );\n}\n\nexport default memo(NavMenu);\n","import { plural } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useDebouncedCallback } from 'use-debounce';\nimport { useSnapshot } from 'valtio';\n\nimport FilterContext from '../utils/filter-context';\nimport { filteredItems, isFiltered } from '../utils/filters';\nimport isRTL from '../utils/is-rtl';\nimport showToast from '../utils/show-toast';\nimport states, { statusKey } from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport { isMediaFirstInstance } from '../utils/store-utils';\nimport { groupBoosts, groupContext } from '../utils/timeline-utils';\nimport useInterval from '../utils/useInterval';\nimport usePageVisibility from '../utils/usePageVisibility';\nimport useScroll from '../utils/useScroll';\nimport useScrollFn from '../utils/useScrollFn';\n\nimport Icon from './icon';\nimport Link from './link';\nimport MediaPost from './media-post';\nimport NavMenu from './nav-menu';\nimport Status from './status';\nimport ThreadBadge from './thread-badge';\n\nconst scrollIntoViewOptions = {\n  block: 'start',\n  inline: 'center',\n  behavior: 'instant',\n};\n\nfunction Timeline({\n  title,\n  titleComponent,\n  id,\n  instance,\n  emptyText,\n  errorText,\n  useItemID, // use statusID instead of status object, assuming it's already in states\n  boostsCarousel,\n  fetchItems = () => {},\n  checkForUpdates = () => {},\n  checkForUpdatesInterval = 15_000, // 15 seconds\n  headerStart,\n  headerEnd,\n  timelineStart,\n  // allowFilters,\n  refresh,\n  view,\n  filterContext,\n  showFollowedTags,\n  showReplyParent,\n  clearWhenRefresh,\n}) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const [items, setItems] = useState([]);\n  const [uiState, setUIState] = useState('start');\n  const [showMore, setShowMore] = useState(false);\n  const [showNew, setShowNew] = useState(false);\n  const [visible, setVisible] = useState(true);\n  const scrollableRef = useRef();\n\n  console.debug('RENDER Timeline', id, refresh);\n  __BENCHMARK.start(`timeline-${id}-load`);\n\n  const mediaFirst = useMemo(() => isMediaFirstInstance(), []);\n\n  const allowGrouping = view !== 'media';\n  const loadItemsTS = useRef(0); // Ensures only one loadItems at a time\n  const loadItems = useDebouncedCallback(\n    (firstLoad) => {\n      setShowNew(false);\n      // if (uiState === 'loading') return;\n      setUIState('loading');\n      (async () => {\n        try {\n          const ts = (loadItemsTS.current = Date.now());\n          let { done, value } = await fetchItems(firstLoad);\n          if (ts !== loadItemsTS.current) return;\n          if (Array.isArray(value)) {\n            // Avoid grouping for pinned posts\n            const [pinnedPosts, otherPosts] = value.reduce(\n              (acc, item) => {\n                if (item._pinned) {\n                  acc[0].push(item);\n                } else {\n                  acc[1].push(item);\n                }\n                return acc;\n              },\n              [[], []],\n            );\n            value = otherPosts;\n            if (allowGrouping) {\n              if (boostsCarousel) {\n                value = groupBoosts(value);\n              }\n              value = groupContext(value, instance);\n            }\n            if (pinnedPosts.length) {\n              value = pinnedPosts.concat(value);\n            }\n            console.log(value);\n            if (firstLoad) {\n              setItems(value);\n            } else {\n              setItems((items) => [...items, ...value]);\n            }\n            if (!value.length) done = true;\n            setShowMore(!done);\n          } else {\n            setShowMore(false);\n          }\n          setUIState('default');\n          __BENCHMARK.end(`timeline-${id}-load`);\n        } catch (e) {\n          console.error(e);\n          setUIState('error');\n          if (firstLoad && !items.length && errorText) {\n            showToast(errorText);\n          }\n        } finally {\n          loadItems.cancel();\n        }\n      })();\n    },\n    1_000,\n    {\n      leading: true,\n      // trailing: false,\n    },\n  );\n\n  const itemsSelector = '.timeline-item, .timeline-item-alt';\n\n  const jRef = useHotkeys(\n    'j, shift+j',\n    (e, handler) => {\n      // Fix bug: shift+j is fired even when j is pressed due to useKey: true\n      if (e.shiftKey !== handler.shift) return;\n\n      // focus on next status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      ).filter((item) => !!item.offsetHeight);\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let nextItem = allItems[activeItemIndex + 1];\n        if (handler.shift) {\n          // get next status that's not .timeline-item-alt\n          nextItem = allItems.find(\n            (item, index) =>\n              index > activeItemIndex &&\n              !item.classList.contains('timeline-item-alt'),\n          );\n        }\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k, shift+k',\n    (e, handler) => {\n      // Fix bug: shift+k is fired even when k is pressed due to useKey: true\n      if (e.shiftKey !== handler.shift) return;\n\n      // focus on previous status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      ).filter((item) => !!item.offsetHeight);\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (handler.shift) {\n          // get prev status that's not .timeline-item-alt\n          prevItem = allItems.findLast(\n            (item, index) =>\n              index < activeItemIndex &&\n              !item.classList.contains('timeline-item-alt'),\n          );\n        }\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey,\n    },\n  );\n\n  const oRef = useHotkeys(\n    ['enter', 'o'],\n    () => {\n      // open active status\n      const activeItem = document.activeElement;\n      if (activeItem?.matches(itemsSelector)) {\n        activeItem.click();\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const showNewPostsIndicator =\n    items.length > 0 && uiState !== 'loading' && showNew;\n  const handleLoadNewPosts = useCallback(() => {\n    if (showNewPostsIndicator) loadItems(true);\n    scrollableRef.current?.scrollTo({\n      top: 0,\n      behavior: 'smooth',\n    });\n  }, [loadItems, showNewPostsIndicator]);\n  const dotRef = useHotkeys('.', handleLoadNewPosts, {\n    useKey: true,\n    ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n  });\n\n  // const {\n  //   scrollDirection,\n  //   nearReachStart,\n  //   nearReachEnd,\n  //   reachStart,\n  //   reachEnd,\n  // } = useScroll({\n  //   scrollableRef,\n  //   distanceFromEnd: 2,\n  //   scrollThresholdStart: 44,\n  // });\n  const headerRef = useRef();\n  // const [hiddenUI, setHiddenUI] = useState(false);\n  const [nearReachStart, setNearReachStart] = useState(false);\n  const scrollFnCallback = useCallback(\n    ({ scrollDirection, nearReachStart, reachStart }) => {\n      if (headerRef.current) {\n        const hiddenUI = scrollDirection === 'end' && !nearReachStart;\n        headerRef.current.hidden = hiddenUI;\n      }\n      setNearReachStart(nearReachStart);\n      if (reachStart) {\n        loadItems(true);\n      }\n    },\n    [setNearReachStart, loadItems],\n  );\n  const { resetScrollDirection } = useScrollFn(\n    {\n      scrollableRef,\n      distanceFromEnd: 2,\n      scrollThresholdStart: 44,\n    },\n    scrollFnCallback,\n  );\n\n  useEffect(() => {\n    scrollableRef.current?.scrollTo({ top: 0 });\n    loadItems(true);\n  }, []);\n  const firstLoad = useRef(true);\n  useEffect(() => {\n    if (firstLoad.current) {\n      firstLoad.current = false;\n      return;\n    }\n    if (clearWhenRefresh && items?.length) {\n      loadItems.cancel?.();\n      setItems([]);\n    }\n    loadItems(true);\n  }, [clearWhenRefresh, refresh]);\n\n  // useEffect(() => {\n  //   if (reachStart) {\n  //     loadItems(true);\n  //   }\n  // }, [reachStart]);\n\n  // useEffect(() => {\n  //   if (nearReachEnd || (reachEnd && showMore)) {\n  //     loadItems();\n  //   }\n  // }, [nearReachEnd, showMore]);\n\n  const prevView = useRef(view);\n  useEffect(() => {\n    if (prevView.current !== view) {\n      prevView.current = view;\n      setItems([]);\n    }\n  }, [view]);\n\n  const loadOrCheckUpdates = useCallback(\n    async ({ disableIdleCheck = false } = {}) => {\n      const noPointers = scrollableRef.current\n        ? getComputedStyle(scrollableRef.current).pointerEvents === 'none'\n        : false;\n      console.log(' Load or check updates', id, {\n        autoRefresh: snapStates.settings.autoRefresh,\n        scrollTop: scrollableRef.current.scrollTop,\n        disableIdleCheck,\n        idle: window.__IDLE__,\n        inBackground: inBackground(),\n        noPointers,\n      });\n      if (\n        snapStates.settings.autoRefresh &&\n        scrollableRef.current.scrollTop < 16 &&\n        (disableIdleCheck || window.__IDLE__) &&\n        !inBackground() &&\n        !noPointers\n      ) {\n        console.log(' Load updates', id, snapStates.settings.autoRefresh);\n        loadItems(true);\n      } else {\n        console.log(' Check updates', id, snapStates.settings.autoRefresh);\n        const hasUpdate = await checkForUpdates();\n        if (hasUpdate) {\n          console.log(' Has new updates', id);\n          setShowNew(true);\n        }\n      }\n    },\n    [id, loadItems, checkForUpdates, snapStates.settings.autoRefresh],\n  );\n\n  const lastHiddenTime = useRef();\n  usePageVisibility(\n    (visible) => {\n      if (visible) {\n        const timeDiff = Date.now() - lastHiddenTime.current;\n        if (!lastHiddenTime.current || timeDiff > 1000 * 3) {\n          // 3 seconds\n          loadOrCheckUpdates({\n            disableIdleCheck: true,\n          });\n        }\n      } else {\n        lastHiddenTime.current = Date.now();\n      }\n      setVisible(visible);\n    },\n    [checkForUpdates, loadOrCheckUpdates, snapStates.settings.autoRefresh],\n  );\n\n  // checkForUpdates interval\n  useInterval(\n    loadOrCheckUpdates,\n    visible && !showNew\n      ? checkForUpdatesInterval * (nearReachStart ? 1 : 2)\n      : null,\n  );\n\n  // const hiddenUI = scrollDirection === 'end' && !nearReachStart;\n\n  return (\n    <FilterContext.Provider value={filterContext}>\n      <div\n        id={`${id}-page`}\n        class={`deck-container ${\n          mediaFirst ? 'deck-container-media-first' : ''\n        }`}\n        ref={(node) => {\n          scrollableRef.current = node;\n          jRef.current = node;\n          kRef.current = node;\n          oRef.current = node;\n          dotRef.current = node;\n        }}\n        tabIndex=\"-1\"\n        onClick={(e) => {\n          // If click on timeline item, unhide header\n          if (\n            headerRef.current &&\n            e.target.closest('.timeline-item, .timeline-item-alt')\n          ) {\n            setTimeout(() => {\n              headerRef.current.hidden = false;\n              resetScrollDirection();\n            }, 250);\n          }\n        }}\n      >\n        <div class=\"timeline-deck deck\">\n          <header\n            ref={headerRef}\n            // hidden={hiddenUI}\n            onClick={(e) => {\n              if (!e.target.closest('a, button')) {\n                scrollableRef.current?.scrollTo({\n                  top: 0,\n                  behavior: 'smooth',\n                });\n              }\n            }}\n            onDblClick={(e) => {\n              if (!e.target.closest('a, button')) {\n                loadItems(true);\n              }\n            }}\n            class={uiState === 'loading' ? 'loading' : ''}\n          >\n            <div class=\"header-grid\">\n              <div class=\"header-side\">\n                <NavMenu />\n                {headerStart !== null && headerStart !== undefined ? (\n                  headerStart\n                ) : (\n                  <Link to=\"/\" class=\"button plain home-button\">\n                    <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n                  </Link>\n                )}\n              </div>\n              {title && (titleComponent ? titleComponent : <h1>{title}</h1>)}\n              <div class=\"header-side\">\n                {/* <Loader hidden={uiState !== 'loading'} /> */}\n                {!!headerEnd && headerEnd}\n              </div>\n            </div>\n            {showNewPostsIndicator && (\n              <button\n                class=\"updates-button shiny-pill\"\n                type=\"button\"\n                onClick={handleLoadNewPosts}\n              >\n                <Icon icon=\"arrow-up\" /> <Trans>New posts</Trans>\n              </button>\n            )}\n          </header>\n          {!!timelineStart && (\n            <div\n              class={`timeline-start ${uiState === 'loading' ? 'loading' : ''}`}\n            >\n              {timelineStart}\n            </div>\n          )}\n          {!!items.length ? (\n            <>\n              <ul class={`timeline ${view ? `timeline-${view}` : ''}`}>\n                {items.map((status) => (\n                  <TimelineItem\n                    status={status}\n                    instance={instance}\n                    useItemID={useItemID}\n                    // allowFilters={allowFilters}\n                    filterContext={filterContext}\n                    key={status.id + status?._pinned + view}\n                    view={view}\n                    showFollowedTags={showFollowedTags}\n                    showReplyParent={showReplyParent}\n                    mediaFirst={mediaFirst}\n                  />\n                ))}\n                {showMore &&\n                  uiState === 'loading' &&\n                  (view === 'media' ? null : (\n                    <>\n                      <li\n                        style={{\n                          height: '20vh',\n                        }}\n                      >\n                        <Status skeleton mediaFirst={mediaFirst} />\n                      </li>\n                      <li\n                        style={{\n                          height: '25vh',\n                        }}\n                      >\n                        <Status skeleton mediaFirst={mediaFirst} />\n                      </li>\n                    </>\n                  ))}\n              </ul>\n              {uiState === 'default' &&\n                (showMore ? (\n                  <InView\n                    root={scrollableRef.current}\n                    rootMargin={`0px 0px ${screen.height * 1.5}px 0px`}\n                    onChange={(inView) => {\n                      if (inView) {\n                        loadItems();\n                      }\n                    }}\n                  >\n                    <button\n                      type=\"button\"\n                      class=\"plain block\"\n                      onClick={() => loadItems()}\n                      style={{ marginBlockEnd: '6em' }}\n                    >\n                      <Trans>Show more</Trans>\n                    </button>\n                  </InView>\n                ) : (\n                  <p class=\"ui-state insignificant\">\n                    <Trans>The end.</Trans>\n                  </p>\n                ))}\n            </>\n          ) : uiState === 'loading' ? (\n            <ul class=\"timeline\">\n              {Array.from({ length: 5 }).map((_, i) =>\n                view === 'media' ? (\n                  <div\n                    style={{\n                      height: '50vh',\n                    }}\n                  />\n                ) : (\n                  <li key={i}>\n                    <Status skeleton mediaFirst={mediaFirst} />\n                  </li>\n                ),\n              )}\n            </ul>\n          ) : (\n            uiState !== 'error' &&\n            uiState !== 'start' && <p class=\"ui-state\">{emptyText}</p>\n          )}\n          {uiState === 'error' && (\n            <p class=\"ui-state\">\n              {errorText}\n              <br />\n              <br />\n              <button type=\"button\" onClick={() => loadItems(!items.length)}>\n                <Trans>Try again</Trans>\n              </button>\n            </p>\n          )}\n        </div>\n      </div>\n    </FilterContext.Provider>\n  );\n}\n\nconst TimelineItem = memo(\n  ({\n    status,\n    instance,\n    useItemID,\n    // allowFilters,\n    filterContext,\n    view,\n    showFollowedTags,\n    showReplyParent,\n    mediaFirst,\n  }) => {\n    const { t } = useLingui();\n    console.debug('RENDER TimelineItem', status.id);\n    const { id: statusID, reblog, items, type, _pinned } = status;\n    if (_pinned) useItemID = false;\n    const actualStatusID = reblog?.id || statusID;\n    const url = instance\n      ? `/${instance}/s/${actualStatusID}`\n      : `/s/${actualStatusID}`;\n\n    if (items) {\n      let fItems = filteredItems(items, filterContext);\n      let title = '';\n      if (type === 'boosts') {\n        title = plural(fItems.length, {\n          one: '# Boost',\n          other: '# Boosts',\n        });\n      } else if (type === 'pinned') {\n        title = t`Pinned posts`;\n      }\n      const isCarousel = type === 'boosts' || type === 'pinned';\n      if (isCarousel) {\n        const filteredItemsIDs = new Set();\n        // Here, we don't hide filtered posts, but we sort them last\n        fItems.sort((a, b) => {\n          // if (a._filtered && !b._filtered) {\n          //   return 1;\n          // }\n          // if (!a._filtered && b._filtered) {\n          //   return -1;\n          // }\n          const aFiltered = isFiltered(a.filtered, filterContext);\n          const bFiltered = isFiltered(b.filtered, filterContext);\n          if (aFiltered && aFiltered?.action !== 'blur') {\n            filteredItemsIDs.add(a.id);\n          }\n          if (bFiltered && bFiltered?.action !== 'blur') {\n            filteredItemsIDs.add(b.id);\n          }\n          if (aFiltered && !bFiltered) {\n            return 1;\n          }\n          if (!aFiltered && bFiltered) {\n            return -1;\n          }\n          return 0;\n        });\n\n        if (filteredItemsIDs.size >= 2) {\n          const GROUP_SIZE = 5;\n          // If 2 or more, group filtered items into one, limit to GROUP_SIZE in a group\n          const unfiltered = [];\n          const filtered = [];\n          fItems.forEach((item) => {\n            if (filteredItemsIDs.has(item.id)) {\n              filtered.push(item);\n            } else {\n              unfiltered.push(item);\n            }\n          });\n          const filteredItems = [];\n          for (let i = 0; i < filtered.length; i += GROUP_SIZE) {\n            filteredItems.push({\n              _grouped: true,\n              posts: filtered.slice(i, i + GROUP_SIZE),\n            });\n          }\n          fItems = unfiltered.concat(filteredItems);\n        }\n\n        return (\n          <li key={`timeline-${statusID}`} class=\"timeline-item-carousel\">\n            <StatusCarousel title={title} class={`${type}-carousel`}>\n              {fItems.map((item) => {\n                const { id: statusID, reblog, _pinned, _grouped } = item;\n                if (_grouped) {\n                  return (\n                    <li key={statusID} class=\"timeline-item-carousel-group\">\n                      {item.posts.map((item) => {\n                        const { id: statusID, reblog, _pinned } = item;\n                        const actualStatusID = reblog?.id || statusID;\n                        const url = instance\n                          ? `/${instance}/s/${actualStatusID}`\n                          : `/s/${actualStatusID}`;\n                        if (_pinned) useItemID = false;\n                        return (\n                          <Link\n                            class=\"status-carousel-link timeline-item-alt\"\n                            to={url}\n                          >\n                            {useItemID ? (\n                              <Status\n                                statusID={statusID}\n                                instance={instance}\n                                size=\"s\"\n                              />\n                            ) : (\n                              <Status\n                                status={item}\n                                instance={instance}\n                                size=\"s\"\n                              />\n                            )}\n                          </Link>\n                        );\n                      })}\n                    </li>\n                  );\n                }\n\n                const actualStatusID = reblog?.id || statusID;\n                const url = instance\n                  ? `/${instance}/s/${actualStatusID}`\n                  : `/s/${actualStatusID}`;\n                if (_pinned) useItemID = false;\n                return (\n                  <li key={statusID}>\n                    <Link\n                      class=\"status-carousel-link timeline-item-alt\"\n                      to={url}\n                    >\n                      {useItemID ? (\n                        <Status\n                          statusID={statusID}\n                          instance={instance}\n                          size=\"s\"\n                          contentTextWeight\n                          enableCommentHint\n                          // allowFilters={allowFilters}\n                          mediaFirst={mediaFirst}\n                        />\n                      ) : (\n                        <Status\n                          status={item}\n                          instance={instance}\n                          size=\"s\"\n                          contentTextWeight\n                          enableCommentHint\n                          // allowFilters={allowFilters}\n                          mediaFirst={mediaFirst}\n                        />\n                      )}\n                    </Link>\n                  </li>\n                );\n              })}\n            </StatusCarousel>\n          </li>\n        );\n      }\n      const manyItems = fItems.length > 3;\n      return fItems.map((item, i) => {\n        const { id: statusID, _differentAuthor } = item;\n        const url = instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`;\n        const isMiddle = i > 0 && i < fItems.length - 1;\n        const isSpoiler = item.sensitive && !!item.spoilerText;\n        const showCompact =\n          (!_differentAuthor && isSpoiler && i > 0) ||\n          (manyItems &&\n            isMiddle &&\n            (type === 'thread' ||\n              (type === 'conversation' &&\n                !_differentAuthor &&\n                !fItems[i - 1]._differentAuthor &&\n                !fItems[i + 1]._differentAuthor)));\n        const isStart = i === 0;\n        const isEnd = i === fItems.length - 1;\n        return (\n          <li\n            key={`timeline-${statusID}`}\n            class={`timeline-item-container timeline-item-container-type-${type} timeline-item-container-${\n              isStart ? 'start' : isEnd ? 'end' : 'middle'\n            } ${_differentAuthor ? 'timeline-item-diff-author' : ''}`}\n          >\n            <Link class=\"status-link timeline-item\" to={url}>\n              {showCompact ? (\n                <TimelineStatusCompact\n                  status={item}\n                  instance={instance}\n                  filterContext={filterContext}\n                />\n              ) : useItemID ? (\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  enableCommentHint={isEnd}\n                  showFollowedTags={showFollowedTags}\n                  // allowFilters={allowFilters}\n                />\n              ) : (\n                <Status\n                  status={item}\n                  instance={instance}\n                  enableCommentHint={isEnd}\n                  showFollowedTags={showFollowedTags}\n                  // allowFilters={allowFilters}\n                />\n              )}\n            </Link>\n          </li>\n        );\n      });\n    }\n\n    const itemKey = `timeline-${statusID + _pinned}`;\n\n    if (view === 'media') {\n      return useItemID ? (\n        <MediaPost\n          class=\"timeline-item\"\n          parent=\"li\"\n          key={itemKey}\n          statusID={statusID}\n          instance={instance}\n          // allowFilters={allowFilters}\n        />\n      ) : (\n        <MediaPost\n          class=\"timeline-item\"\n          parent=\"li\"\n          key={itemKey}\n          status={status}\n          instance={instance}\n          // allowFilters={allowFilters}\n        />\n      );\n    }\n\n    return (\n      <li key={itemKey}>\n        <Link class=\"status-link timeline-item\" to={url}>\n          {useItemID ? (\n            <Status\n              statusID={statusID}\n              instance={instance}\n              enableCommentHint\n              showFollowedTags={showFollowedTags}\n              showReplyParent={showReplyParent}\n              // allowFilters={allowFilters}\n              mediaFirst={mediaFirst}\n            />\n          ) : (\n            <Status\n              status={status}\n              instance={instance}\n              enableCommentHint\n              showFollowedTags={showFollowedTags}\n              showReplyParent={showReplyParent}\n              // allowFilters={allowFilters}\n              mediaFirst={mediaFirst}\n            />\n          )}\n        </Link>\n      </li>\n    );\n  },\n  (oldProps, newProps) => {\n    const oldID = (oldProps.status?.id || '').toString();\n    const newID = (newProps.status?.id || '').toString();\n    return (\n      oldID === newID &&\n      oldProps.instance === newProps.instance &&\n      oldProps.view === newProps.view\n    );\n  },\n);\n\nfunction StatusCarousel({ title, class: className, children }) {\n  const { t } = useLingui();\n  const carouselRef = useRef();\n  const startButtonRef = useRef();\n  const endButtonRef = useRef();\n\n  const [render, setRender] = useState(false);\n  useEffect(() => {\n    setTimeout(() => {\n      setRender(true);\n    }, 1);\n  }, []);\n\n  return (\n    <div class={`status-carousel ${className}`}>\n      <header>\n        <h3>{title}</h3>\n        <span>\n          <button\n            ref={startButtonRef}\n            type=\"button\"\n            class=\"small plain2\"\n            // disabled={reachStart}\n            onClick={() => {\n              const left =\n                Math.min(320, carouselRef.current?.offsetWidth) *\n                (isRTL() ? 1 : -1);\n              carouselRef.current?.scrollBy({\n                left,\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"chevron-left\" alt={t`Previous`} />\n          </button>{' '}\n          <button\n            ref={endButtonRef}\n            type=\"button\"\n            class=\"small plain2\"\n            // disabled={reachEnd}\n            onClick={() => {\n              const left =\n                Math.min(320, carouselRef.current?.offsetWidth) *\n                (isRTL() ? -1 : 1);\n              carouselRef.current?.scrollBy({\n                left,\n                behavior: 'smooth',\n              });\n            }}\n          >\n            <Icon icon=\"chevron-right\" alt={t`Next`} />\n          </button>\n        </span>\n      </header>\n      <ul ref={carouselRef}>\n        <InView\n          class=\"status-carousel-beacon\"\n          onChange={(inView) => {\n            if (startButtonRef.current)\n              startButtonRef.current.disabled = inView;\n          }}\n        />\n        {children[0]}\n        {render && children.slice(1)}\n        <InView\n          class=\"status-carousel-beacon\"\n          onChange={(inView) => {\n            if (endButtonRef.current) endButtonRef.current.disabled = inView;\n          }}\n        />\n      </ul>\n    </div>\n  );\n}\n\nfunction TimelineStatusCompact({ status, instance, filterContext }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { id, visibility, language } = status;\n  const statusPeekText = statusPeek(status);\n  const sKey = statusKey(id, instance);\n  const filterInfo = isFiltered(status.filtered, filterContext);\n  return (\n    <article\n      class={`status compact-thread ${\n        visibility === 'direct' ? 'visibility-direct' : ''\n      }`}\n      tabindex=\"-1\"\n    >\n      <div class=\"status-thread-badge-container\">\n        <ThreadBadge index={snapStates.statusThreadNumber[sKey]} />\n      </div>\n      <div\n        class=\"content-compact\"\n        title={statusPeekText}\n        lang={language}\n        dir=\"auto\"\n      >\n        {!!filterInfo && filterInfo?.action !== 'blur' ? (\n          <b\n            class=\"status-filtered-badge badge-meta horizontal\"\n            title={filterInfo?.titlesStr || ''}\n          >\n            {filterInfo?.titlesStr ? (\n              <Trans>\n                <span>Filtered</span>: <span>{filterInfo.titlesStr}</span>\n              </Trans>\n            ) : (\n              <span>\n                <Trans>Filtered</Trans>\n              </span>\n            )}\n          </b>\n        ) : (\n          <>\n            {statusPeekText}\n            {status.sensitive && status.spoilerText && (\n              <>\n                {' '}\n                <span class=\"spoiler-badge\">\n                  <Icon icon=\"eye-close\" size=\"s\" alt={t`Content warning`} />\n                </span>\n              </>\n            )}\n          </>\n        )}\n      </div>\n    </article>\n  );\n}\n\nfunction inBackground() {\n  return !!document.querySelector('.deck-backdrop, #modal-container > *');\n}\n\nexport default Timeline;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuItem } from '@szhsin/react-menu';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport punycode from 'punycode/';\nimport { useParams, useSearchParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport AccountInfo from '../components/account-info';\nimport EmojiText from '../components/emoji-text';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Menu2 from '../components/menu2';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport isSearchEnabled from '../utils/is-search-enabled';\nimport mem from '../utils/mem';\nimport pmem from '../utils/pmem';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport {\n  getCurrentAccountID,\n  isMediaFirstInstance,\n} from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\nconst MIN_YEAR = 1983;\nconst MIN_YEAR_MONTH = `${MIN_YEAR}-01`; // Birth of the Internet\n\nconst supportsInputMonth = mem(() => {\n  try {\n    const input = document.createElement('input');\n    input.setAttribute('type', 'month');\n    return input.type === 'month';\n  } catch (e) {\n    return false;\n  }\n});\n\nfunction AccountStatuses() {\n  const { i18n, t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { id, ...params } = useParams();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const month = searchParams.get('month');\n  const excludeReplies = !searchParams.get('replies');\n  const excludeBoosts = !!searchParams.get('boosts');\n  const tagged = searchParams.get('tagged');\n  const media = !!searchParams.get('media');\n  const { masto, instance, authenticated } = api({ instance: params.instance });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const accountStatusesIterator = useRef();\n\n  const allSearchParams = [month, excludeReplies, excludeBoosts, tagged, media];\n  const [account, setAccount] = useState();\n  const searchOffsetRef = useRef(0);\n  useEffect(() => {\n    searchOffsetRef.current = 0;\n  }, allSearchParams);\n\n  const mediaFirst = useMemo(() => isMediaFirstInstance(), []);\n\n  const sameCurrentInstance = useMemo(\n    () => instance === currentInstance,\n    [instance, currentInstance],\n  );\n  const [searchEnabled, setSearchEnabled] = useState(false);\n  useEffect(() => {\n    // Only enable for current logged-in instance\n    // Most remote instances don't allow unauthenticated searches\n    if (!sameCurrentInstance) return;\n    if (!account?.acct) return;\n    (async () => {\n      const enabled = await isSearchEnabled(instance);\n      console.log({ enabled });\n      setSearchEnabled(enabled);\n    })();\n  }, [instance, sameCurrentInstance, account?.acct]);\n\n  async function fetchAccountStatuses(firstLoad) {\n    const isValidMonth = /^\\d{4}-[01]\\d$/.test(month);\n    const isValidYear = month?.split?.('-')?.[0] >= MIN_YEAR;\n    if (isValidMonth && isValidYear) {\n      if (!account) {\n        return {\n          value: [],\n          done: true,\n        };\n      }\n      const [_year, _month] = month.split('-');\n      const monthIndex = parseInt(_month, 10) - 1;\n      // YYYY-MM (no day)\n      // Search options:\n      // - from:account\n      // - after:YYYY-MM-DD (non-inclusive)\n      // - before:YYYY-MM-DD (non-inclusive)\n\n      // Last day of previous month\n      const after = new Date(_year, monthIndex, 0);\n      const afterStr = `${after.getFullYear()}-${(after.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${after.getDate().toString().padStart(2, '0')}`;\n      // First day of next month\n      const before = new Date(_year, monthIndex + 1, 1);\n      const beforeStr = `${before.getFullYear()}-${(before.getMonth() + 1)\n        .toString()\n        .padStart(2, '0')}-${before.getDate().toString().padStart(2, '0')}`;\n      console.log({\n        month,\n        _year,\n        _month,\n        monthIndex,\n        after,\n        before,\n        afterStr,\n        beforeStr,\n      });\n\n      let limit;\n      if (firstLoad) {\n        limit = LIMIT + 1;\n        searchOffsetRef.current = 0;\n      } else {\n        limit = LIMIT + searchOffsetRef.current + 1;\n        searchOffsetRef.current += LIMIT;\n      }\n\n      const searchResults = await masto.v2.search.list({\n        q: `from:${account.acct} after:${afterStr} before:${beforeStr}`,\n        type: 'statuses',\n        limit,\n        offset: searchOffsetRef.current,\n      });\n      if (searchResults?.statuses?.length) {\n        const value = searchResults.statuses.slice(0, LIMIT);\n        value.forEach((item) => {\n          saveStatus(item, instance);\n        });\n        const done = searchResults.statuses.length <= LIMIT;\n        return { value, done };\n      } else {\n        return { value: [], done: true };\n      }\n    }\n\n    let results = [];\n    if (firstLoad) {\n      const { value } = await masto.v1.accounts\n        .$select(id)\n        .statuses.list({\n          pinned: true,\n        })\n        .values()\n        .next();\n      if (value?.length && !tagged && !media) {\n        const pinnedStatuses = value.map((status) => {\n          saveStatus(status, instance);\n          return {\n            ...status,\n            _pinned: true,\n          };\n        });\n        if (pinnedStatuses.length >= 3) {\n          const pinnedStatusesIds = pinnedStatuses.map((status) => status.id);\n          results.push({\n            id: pinnedStatusesIds,\n            items: pinnedStatuses,\n            type: 'pinned',\n          });\n        } else {\n          results.push(...pinnedStatuses);\n        }\n      }\n    }\n    if (firstLoad || !accountStatusesIterator.current) {\n      accountStatusesIterator.current = masto.v1.accounts\n        .$select(id)\n        .statuses.list({\n          limit: LIMIT,\n          exclude_replies: excludeReplies,\n          exclude_reblogs: excludeBoosts,\n          only_media: media || undefined,\n          tagged,\n        })\n        .values();\n    }\n    const { value, done } = await accountStatusesIterator.current.next();\n    if (value?.length) {\n      if (!supports('@mastodon/pinned-posts')) {\n        // Check if value is same as pinned post (results)\n        // If the index for every post is the same, means API might not support pinned posts\n        // TODO: This is a really weird check, fix this at some point\n        if (results.length) {\n          let pinnedStatusesIds = [];\n          if (results[0]?.type === 'pinned') {\n            pinnedStatusesIds = results[0].id;\n          } else {\n            pinnedStatusesIds = results\n              .filter((status) => status._pinned)\n              .map((status) => status.id);\n          }\n          const containsAllPinned = pinnedStatusesIds.every((postId) =>\n            value.some((status) => status.id === postId),\n          );\n          if (containsAllPinned) {\n            // Remove pinned posts\n            results = [];\n          }\n        }\n      }\n\n      results.push(...value);\n\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      value: results,\n      done,\n    };\n  }\n\n  const [featuredTags, setFeaturedTags] = useState([]);\n  let title = t`Account posts`;\n  if (account?.acct) {\n    const acctDisplay = (/@/.test(account.acct) ? '' : '@') + account.acct;\n    const accountDisplay = account?.displayName\n      ? `${account.displayName} (${acctDisplay})`\n      : `${acctDisplay}`;\n    if (!excludeReplies) {\n      title = t`${accountDisplay} (+ Replies)`;\n    } else if (excludeBoosts) {\n      title = t`${accountDisplay} (- Boosts)`;\n    } else if (tagged) {\n      title = t`${accountDisplay} (#${tagged})`;\n    } else if (media) {\n      title = t`${accountDisplay} (Media)`;\n    } else if (month) {\n      const monthYear = new Date(month).toLocaleString(i18n.locale, {\n        month: 'long',\n        year: 'numeric',\n      });\n      title = t`${accountDisplay} (${monthYear})`;\n    } else {\n      title = accountDisplay;\n    }\n  }\n  useTitle(title, '/:instance?/a/:id');\n\n  const fetchAccount = useCallback(() => {\n    return memFetchAccount(id, masto);\n  }, [id, masto]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const acc = await fetchAccount();\n        console.log(acc);\n        setAccount(acc);\n      } catch (e) {\n        console.error(e);\n      }\n      // No need, because the whole filter bar is hidden\n      // TODO: Revisit this\n      if (!mediaFirst) {\n        try {\n          const featuredTags = await masto.v1.accounts\n            .$select(id)\n            .featuredTags.list();\n          console.log({ featuredTags });\n          setFeaturedTags(featuredTags);\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    })();\n  }, [id, mediaFirst]);\n\n  const { displayName, acct, emojis } = account || {};\n\n  const isSelf = useMemo(\n    () => account?.id === getCurrentAccountID(),\n    [account?.id],\n  );\n\n  const filterBarRef = useRef();\n  const TimelineStart = useMemo(() => {\n    const filtered =\n      !excludeReplies || excludeBoosts || tagged || media || !!month;\n    const cachedAccount = snapStates.accounts[`${id}@${instance}`];\n\n    return (\n      <>\n        <AccountInfo\n          instance={instance}\n          account={cachedAccount || id}\n          fetchAccount={fetchAccount}\n          authenticated={authenticated}\n          standalone\n          showEndorsements\n        />\n        {!mediaFirst && (\n          <div\n            class=\"filter-bar\"\n            ref={filterBarRef}\n            style={{\n              position: 'relative',\n            }}\n          >\n            {filtered ? (\n              <Link\n                to={`/${instance}/a/${id}`}\n                class=\"insignificant filter-clear\"\n                title={t`Clear filters`}\n                key=\"clear-filters\"\n              >\n                <Icon icon=\"x\" size=\"l\" alt={t`Clear`} />\n              </Link>\n            ) : (\n              <Icon\n                icon=\"filter\"\n                class=\"insignificant\"\n                size=\"l\"\n                alt={t`Filters`}\n              />\n            )}\n            <Link\n              to={`/${instance}/a/${id}${excludeReplies ? '?replies=1' : ''}`}\n              onClick={() => {\n                if (excludeReplies) {\n                  showToast(t`Showing post with replies`);\n                }\n              }}\n              class={excludeReplies ? '' : 'is-active'}\n            >\n              <Trans>+ Replies</Trans>\n            </Link>\n            <Link\n              to={`/${instance}/a/${id}${excludeBoosts ? '' : '?boosts=0'}`}\n              onClick={() => {\n                if (!excludeBoosts) {\n                  showToast(t`Showing posts without boosts`);\n                }\n              }}\n              class={!excludeBoosts ? '' : 'is-active'}\n            >\n              <Trans>- Boosts</Trans>\n            </Link>\n            <Link\n              to={`/${instance}/a/${id}${media ? '' : '?media=1'}`}\n              onClick={() => {\n                if (!media) {\n                  showToast(t`Showing posts with media`);\n                }\n              }}\n              class={media ? 'is-active' : ''}\n            >\n              <Trans>Media</Trans>\n            </Link>\n            {featuredTags.map((tag) => (\n              <Link\n                key={tag.id}\n                to={`/${instance}/a/${id}${\n                  tagged === tag.name\n                    ? ''\n                    : `?tagged=${encodeURIComponent(tag.name)}`\n                }`}\n                onClick={() => {\n                  if (tagged !== tag.name) {\n                    showToast(t`Showing posts tagged with #${tag.name}`);\n                  }\n                }}\n                class={tagged === tag.name ? 'is-active' : ''}\n              >\n                <span>\n                  <span class=\"more-insignificant\">#</span>\n                  {tag.name}\n                </span>\n                {\n                  // The count differs based on instance \n                }\n                {/* <span class=\"filter-count\">{tag.statusesCount}</span> */}\n              </Link>\n            ))}\n            {searchEnabled && (\n              <>\n                {supportsInputMonth() ? (\n                  <label class={`filter-field ${month ? 'is-active' : ''}`}>\n                    <Icon icon=\"month\" size=\"l\" />\n                    <input\n                      type=\"month\"\n                      disabled={!account?.acct}\n                      value={month || ''}\n                      min={MIN_YEAR_MONTH}\n                      max={new Date().toISOString().slice(0, 7)}\n                      onInput={(e) => {\n                        const { value, validity } = e.currentTarget;\n                        if (!validity.valid) return;\n                        setSearchParams(\n                          value\n                            ? {\n                                month: value,\n                              }\n                            : {},\n                        );\n                        const [year, month] = value.split('-');\n                        const monthIndex = parseInt(month, 10) - 1;\n                        const date = new Date(year, monthIndex);\n                        showToast(\n                          t`Showing posts in ${date.toLocaleString(\n                            i18n.locale,\n                            {\n                              month: 'long',\n                              year: 'numeric',\n                            },\n                          )}`,\n                        );\n                      }}\n                    />\n                  </label>\n                ) : (\n                  // Fallback to <select> for month and <input type=\"number\"> for year\n                  <MonthPicker\n                    class={`filter-field ${month ? 'is-active' : ''}`}\n                    disabled={!account?.acct}\n                    value={month || ''}\n                    min={MIN_YEAR_MONTH}\n                    max={new Date().toISOString().slice(0, 7)}\n                    onInput={(e) => {\n                      const { value, validity } = e;\n                      if (!validity.valid) return;\n                      setSearchParams(\n                        value\n                          ? {\n                              month: value,\n                            }\n                          : {},\n                      );\n                    }}\n                  />\n                )}\n                <button\n                  type=\"button\"\n                  class=\"filter-field\"\n                  onClick={() => {\n                    states.showSearchCommand = {\n                      query: isSelf ? 'from:me ' : `from:${account?.acct} `,\n                    };\n                  }}\n                >\n                  <Icon\n                    icon=\"search\"\n                    size=\"l\"\n                    alt={\n                      isSelf\n                        ? t`Search my posts`\n                        : t`Search @${account?.username}'s posts`\n                    }\n                  />\n                </button>\n              </>\n            )}\n          </div>\n        )}\n      </>\n    );\n  }, [\n    id,\n    instance,\n    authenticated,\n    featuredTags,\n    fetchAccount,\n    searchEnabled,\n    ...allSearchParams,\n  ]);\n\n  useEffect(() => {\n    // Focus on .is-active\n    const active = filterBarRef.current?.querySelector('.is-active');\n    if (active) {\n      console.log('active', active, active.offsetLeft);\n      filterBarRef.current.scrollTo({\n        behavior: 'smooth',\n        left:\n          active.offsetLeft -\n          (filterBarRef.current.offsetWidth - active.offsetWidth) / 2,\n      });\n    }\n  }, [featuredTags, searchEnabled, ...allSearchParams]);\n\n  const accountInstance = useMemo(() => {\n    if (!account?.url) return null;\n    const domain = URL.parse(account.url)?.hostname;\n    return domain;\n  }, [account]);\n  const sameInstance = instance === accountInstance;\n  const allowSwitch = !!account && !sameInstance;\n\n  return (\n    <>\n      <Timeline\n        key={id}\n        title={`${account?.acct ? '@' + account.acct : t`Posts`}`}\n        titleComponent={\n          <h1\n            class=\"header-double-lines header-account\"\n            // onClick={() => {\n            //   states.showAccount = {\n            //     account,\n            //     instance,\n            //   };\n            // }}\n          >\n            <b>\n              <EmojiText\n                text={displayName}\n                emojis={emojis}\n                resolverURL={account?.url}\n              />\n            </b>\n            <div>\n              <span class=\"bidi-isolate\">@{acct}</span>\n            </div>\n          </h1>\n        }\n        id=\"account-statuses\"\n        instance={instance}\n        emptyText={t`Nothing to see here yet.`}\n        errorText={t`Unable to load posts`}\n        fetchItems={fetchAccountStatuses}\n        useItemID\n        view={media || mediaFirst ? 'media' : undefined}\n        boostsCarousel={snapStates.settings.boostsCarousel}\n        timelineStart={TimelineStart}\n        refresh={[\n          excludeReplies,\n          excludeBoosts,\n          tagged,\n          media,\n          month + account?.acct,\n        ].toString()}\n        headerEnd={\n          <Menu2\n            portal\n            // setDownOverflow\n            overflow=\"auto\"\n            viewScroll=\"close\"\n            position=\"anchor\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n          >\n            <MenuItem\n              disabled={!allowSwitch}\n              onClick={() => {\n                (async () => {\n                  try {\n                    const { masto } = api({\n                      instance: accountInstance,\n                    });\n                    const acc = await masto.v1.accounts.lookup({\n                      acct: account.acct,\n                    });\n                    const { id } = acc;\n                    location.hash = `/${accountInstance}/a/${id}`;\n                  } catch (e) {\n                    console.error(e);\n                    alert(t`Unable to fetch account info`);\n                  }\n                })();\n              }}\n            >\n              <Icon icon=\"transfer\" />{' '}\n              <small class=\"menu-double-lines\">\n                <Trans>\n                  Switch to account's instance{' '}\n                  {accountInstance ? (\n                    <>\n                      {' '}\n                      (<b>{punycode.toUnicode(accountInstance)}</b>)\n                    </>\n                  ) : null}\n                </Trans>\n              </small>\n            </MenuItem>\n            {!sameCurrentInstance && (\n              <MenuItem\n                onClick={() => {\n                  (async () => {\n                    try {\n                      const acc = await currentMasto.v1.accounts.lookup({\n                        acct: account.acct + '@' + instance,\n                      });\n                      const { id } = acc;\n                      location.hash = `/${currentInstance}/a/${id}`;\n                    } catch (e) {\n                      console.error(e);\n                      alert(t`Unable to fetch account info`);\n                    }\n                  })();\n                }}\n              >\n                <Icon icon=\"transfer\" />{' '}\n                <small class=\"menu-double-lines\">\n                  <Trans>\n                    Switch to my instance (<b>{currentInstance}</b>)\n                  </Trans>\n                </small>\n              </MenuItem>\n            )}\n          </Menu2>\n        }\n      />\n      {acct && !isSelf && (\n        <data\n          class=\"compose-data\"\n          value={JSON.stringify({\n            draftStatus: {\n              status: `@${acct} `,\n            },\n          })}\n        />\n      )}\n    </>\n  );\n}\n\nfunction MonthPicker(props) {\n  const { i18n } = useLingui();\n  const {\n    class: className,\n    disabled,\n    value,\n    min,\n    max,\n    onInput = () => {},\n  } = props;\n  const [_year, _month] = value?.split('-') || [];\n  const monthFieldRef = useRef();\n  const yearFieldRef = useRef();\n\n  const checkValidity = (month, year) => {\n    const [minYear, minMonth] = min?.split('-') || [];\n    const [maxYear, maxMonth] = max?.split('-') || [];\n    if (year < minYear) return false;\n    if (year > maxYear) return false;\n    if (year === minYear && month < minMonth) return false;\n    if (year === maxYear && month > maxMonth) return false;\n    return true;\n  };\n\n  return (\n    <div class={className}>\n      <Icon icon=\"month\" size=\"l\" />\n      <select\n        ref={monthFieldRef}\n        disabled={disabled}\n        value={_month || ''}\n        onInput={(e) => {\n          const { value: month } = e.currentTarget;\n          const year = yearFieldRef.current.value;\n          if (!checkValidity(month, year))\n            return {\n              value: '',\n              validity: {\n                valid: false,\n              },\n            };\n          onInput({\n            value: month ? `${year}-${month}` : '',\n            validity: {\n              valid: true,\n            },\n          });\n        }}\n      >\n        <option value=\"\">\n          <Trans>Month</Trans>\n        </option>\n        <option disabled>-----</option>\n        {Array.from({ length: 12 }, (_, i) => (\n          <option\n            value={\n              // Month is 1-indexed\n              (i + 1)\n                .toString()\n                .padStart(2, '0')\n            }\n            key={i}\n          >\n            {new Date(0, i).toLocaleString(i18n.locale, {\n              month: 'long',\n            })}\n          </option>\n        ))}\n      </select>{' '}\n      <input\n        ref={yearFieldRef}\n        type=\"number\"\n        disabled={disabled}\n        value={_year || new Date().getFullYear()}\n        min={min?.slice(0, 4) || MIN_YEAR}\n        max={max?.slice(0, 4) || new Date().getFullYear()}\n        onInput={(e) => {\n          const { value: year, validity } = e.currentTarget;\n          const month = monthFieldRef.current.value;\n          if (!validity.valid || !checkValidity(month, year))\n            return {\n              value: '',\n              validity: {\n                valid: false,\n              },\n            };\n          onInput({\n            value: year ? `${year}-${month}` : '',\n            validity: {\n              valid: true,\n            },\n          });\n        }}\n        style={{\n          width: '4.5em',\n        }}\n      />\n    </div>\n  );\n}\n\nfunction fetchAccount(id, masto) {\n  return masto.v1.accounts.$select(id).fetch();\n}\nconst memFetchAccount = pmem(fetchAccount, {\n  expires: 30 * 60 * 1000, // 30 minutes\n});\n\nexport default AccountStatuses;\n","import './annual-report.css';\n\nimport { Trans } from '@lingui/react/macro';\nimport { useEffect, useState } from 'preact/hooks';\nimport { useParams } from 'react-router-dom';\n\nimport Link from '../components/link';\nimport NameText from '../components/name-text';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport useTitle from '../utils/useTitle';\n\nexport default function AnnualReport() {\n  const params = useParams();\n  const { year } = params;\n  useTitle(\n    year ? `${year} #Wrapstodon` : '#Wrapstodon',\n    '/annual_report/:year',\n  );\n  const { masto, instance } = api();\n  const [results, setResults] = useState(null);\n  const [uiState, setUIState] = useState('default');\n\n  useEffect(() => {\n    if (year) {\n      (async () => {\n        setUIState('loading');\n        const results = await masto.v1.annualReports.$select(year).fetch();\n        console.log('REPORT', results);\n        setResults(results);\n        setUIState('default');\n      })();\n    }\n  }, [year]);\n\n  const { accounts, annualReports, statuses } = results || {};\n  const report = annualReports?.find((report) => report.year == year)?.data;\n\n  const datePlaceholder = new Date();\n\n  return (\n    <div id=\"annual-report-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class={`report ${uiState === 'loading' ? 'loading-mask' : ''}`}>\n        <h1>{year} #Wrapstodon</h1>\n        {!!report && (\n          <dl>\n            {Object.entries(report).map(([key, value]) => {\n              console.log('value', value);\n              const totals = {};\n              if (Array.isArray(value)) {\n                value.forEach((item) => {\n                  Object.entries(item).forEach(([k, v]) => {\n                    if (typeof v === 'number') {\n                      totals[k] = (totals[k] || 0) + v;\n                    }\n                  });\n                });\n              }\n\n              return (\n                <>\n                  <dt>{key}</dt>\n                  <dd class={`report-${key}`}>\n                    {Array.isArray(value) ? (\n                      <table>\n                        <thead>\n                          <tr>\n                            {Object.entries(value[0]).map(([key, value]) => (\n                              <th\n                                class={\n                                  key !== 'month' && typeof value === 'number'\n                                    ? 'number'\n                                    : ''\n                                }\n                              >\n                                {key}\n                              </th>\n                            ))}\n                          </tr>\n                        </thead>\n                        <tbody>\n                          {value.map((item) => (\n                            <tr>\n                              {Object.entries(item).map(([k, value]) => (\n                                <td\n                                  class={\n                                    k !== 'month' && typeof value === 'number'\n                                      ? 'number'\n                                      : ''\n                                  }\n                                  style={{\n                                    '--percentage':\n                                      typeof value === 'number'\n                                        ? `${(value / totals[k]) * 100}%`\n                                        : 0,\n                                  }}\n                                >\n                                  {value &&\n                                  /(accountId)/i.test(k) &&\n                                  /^(mostRebloggedAccounts|commonlyInteractedWithAccounts)$/i.test(\n                                    key,\n                                  ) ? (\n                                    accounts?.find((a) => a.id === value) ? (\n                                      <NameText\n                                        account={accounts?.find(\n                                          (a) => a.id === value,\n                                        )}\n                                        showAvatar\n                                      />\n                                    ) : (\n                                      ''\n                                    )\n                                  ) : k === 'month' ? (\n                                    datePlaceholder.setMonth(value - 1) &&\n                                    datePlaceholder.toLocaleString(undefined, {\n                                      month: 'long',\n                                    })\n                                  ) : typeof value === 'number' ? (\n                                    value.toLocaleString()\n                                  ) : (\n                                    value\n                                  )}\n                                </td>\n                              ))}\n                            </tr>\n                          ))}\n                        </tbody>\n                      </table>\n                    ) : typeof value === 'object' ? (\n                      /^(topStatuses)$/i.test(key) ? (\n                        <dl>\n                          {Object.entries(value).map(([k, value]) => (\n                            <>\n                              <dt>{k}</dt>\n                              <dd>\n                                {value && (\n                                  <Link to={`/${instance}/s/${value}`}>\n                                    <Status\n                                      status={statuses?.find(\n                                        (s) => s.id === value,\n                                      )}\n                                      size=\"s\"\n                                      readOnly\n                                      showCommentCount\n                                    />\n                                  </Link>\n                                )}\n                              </dd>\n                            </>\n                          ))}\n                        </dl>\n                      ) : (\n                        <table>\n                          <tbody>\n                            {Object.entries(value).map(([k, value]) => (\n                              <tr>\n                                <th>{k}</th>\n                                <td\n                                  class={\n                                    typeof value === 'number' ? 'number' : ''\n                                  }\n                                >\n                                  {value}\n                                </td>\n                              </tr>\n                            ))}\n                          </tbody>\n                        </table>\n                      )\n                    ) : typeof value === 'string' ? (\n                      value\n                    ) : (\n                      // Last resort\n                      JSON.stringify(value, null, 2)\n                    )}\n                  </dd>\n                </>\n              );\n            })}\n          </dl>\n        )}\n      </div>\n      <hr />\n      <p style={{ textAlign: 'center' }}>\n        <Link to=\"/\">\n          <Trans>Go home</Trans>\n        </Link>\n      </p>\n    </div>\n  );\n}\n","import { useLingui } from '@lingui/react/macro';\nimport { useRef } from 'preact/hooks';\n\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Bookmarks() {\n  const { t } = useLingui();\n  useTitle(t`Bookmarks`, '/b');\n  const { masto, instance } = api();\n  const bookmarksIterator = useRef();\n  async function fetchBookmarks(firstLoad) {\n    if (firstLoad || !bookmarksIterator.current) {\n      bookmarksIterator.current = masto.v1.bookmarks\n        .list({ limit: LIMIT })\n        .values();\n    }\n    return await bookmarksIterator.current.next();\n  }\n\n  return (\n    <Timeline\n      title={t`Bookmarks`}\n      id=\"bookmarks\"\n      emptyText={t`No bookmarks yet. Go bookmark something!`}\n      errorText={t`Unable to load bookmarks.`}\n      instance={instance}\n      fetchItems={fetchBookmarks}\n    />\n  );\n}\n\nexport default Bookmarks;\n","export default \"__VITE_ASSET__BL_1JinT__\"","import '../components/links-bar.css';\nimport './catchup.css';\n\nimport autoAnimate from '@formkit/auto-animate';\nimport { msg, select } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { getBlurHashAverageColor } from 'fast-blurhash';\nimport { Fragment } from 'preact';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useReducer,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSearchParams } from 'react-router-dom';\nimport { uid } from 'uid/single';\n\nimport catchupUrl from '../assets/features/catch-up.png';\n\nimport Avatar from '../components/avatar';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Modal from '../components/modal';\nimport NameText from '../components/name-text';\nimport NavMenu from '../components/nav-menu';\nimport RelativeTime from '../components/relative-time';\nimport { api, getPreferences } from '../utils/api';\nimport { oklab2rgb, rgb2oklab } from '../utils/color-utils';\nimport db from '../utils/db';\nimport emojifyText from '../utils/emojify-text';\nimport { isFiltered } from '../utils/filters';\nimport getDomain from '../utils/get-domain';\nimport htmlContentLength from '../utils/html-content-length';\nimport mem from '../utils/mem';\nimport niceDateTime from '../utils/nice-date-time';\nimport { supportsNativeQuote } from '../utils/quote-utils';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { statusKey } from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport store from '../utils/store';\nimport { getCurrentAccountID, getCurrentAccountNS } from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport { assignFollowedTags } from '../utils/timeline-utils';\nimport useTitle from '../utils/useTitle';\n\nconst FILTER_CONTEXT = 'home';\nconst CATCHUP_NS = 'catchup';\n\nconst RANGES = [\n  { label: msg`last 1 hour`, value: 1 },\n  { label: msg`last 2 hours`, value: 2 },\n  { label: msg`last 3 hours`, value: 3 },\n  { label: msg`last 4 hours`, value: 4 },\n  { label: msg`last 5 hours`, value: 5 },\n  { label: msg`last 6 hours`, value: 6 },\n  { label: msg`last 7 hours`, value: 7 },\n  { label: msg`last 8 hours`, value: 8 },\n  { label: msg`last 9 hours`, value: 9 },\n  { label: msg`last 10 hours`, value: 10 },\n  { label: msg`last 11 hours`, value: 11 },\n  { label: msg`last 12 hours`, value: 12 },\n  { label: msg`beyond 12 hours`, value: 13, beyond: true },\n];\n\nconst FILTER_KEYS = {\n  original: msg`Original`,\n  replies: msg`Replies`,\n  quotes: msg`Quotes`,\n  boosts: msg`Boosts`,\n  followedTags: msg`Followed tags`,\n  groups: msg`Groups`,\n  filtered: msg`Filtered`,\n};\nconst FILTER_SORTS = [\n  'createdAt',\n  'repliesCount',\n  'favouritesCount',\n  'reblogsCount',\n  // TODO: Add this later when there's enough usage\n  // Sorting by quotes count seems not useful yet?\n  // And we're combining it with boosts count, so that's even weirder\n  // 'quotesCount',\n  'density',\n];\nconst FILTER_GROUPS = [null, 'account'];\n\nconst DTF = mem(\n  (locale) =>\n    new Intl.DateTimeFormat(locale || undefined, {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n    }),\n);\n\nfunction hasQuote(quote) {\n  return quote?.id || quote?.quotedStatus?.id;\n}\n\nfunction Catchup() {\n  const { i18n, _, t } = useLingui();\n  const dtf = DTF(i18n.locale);\n\n  useTitle(`Catch-up`, '/catchup');\n  const { masto, instance } = api();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const id = searchParams.get('id');\n  const [uiState, setUIState] = useState('start');\n  const [showTopLinks, setShowTopLinks] = useState(false);\n\n  const currentAccount = useMemo(() => {\n    return getCurrentAccountID();\n  }, []);\n  const isSelf = (accountID) => accountID === currentAccount;\n\n  const supportsPixelfed = supports('@pixelfed/home-include-reblogs');\n\n  async function fetchHome({ maxCreatedAt }) {\n    console.debug('fetchHome', maxCreatedAt);\n    const allResults = [];\n    const homeIterable = masto.v1.timelines.home.list({ limit: 40 });\n    const homeIterator = homeIterable.values();\n    mainloop: while (true) {\n      try {\n        if (supportsPixelfed && homeIterable.params) {\n          if (typeof homeIterable.params === 'string') {\n            homeIterable.params += '&include_reblogs=true';\n          } else {\n            homeIterable.params.include_reblogs = true;\n          }\n        }\n        const results = await homeIterator.next();\n        const { value } = results;\n        if (value?.length) {\n          // This ignores maxCreatedAt filter, but it's ok for now\n          await assignFollowedTags(value, instance);\n          let addedResults = false;\n          for (let i = 0; i < value.length; i++) {\n            const item = value[i];\n            const createdAtTime = Date.parse(item.createdAt);\n            if (!maxCreatedAt || createdAtTime >= maxCreatedAt) {\n              // Filtered\n              const selfPost = isSelf(\n                item.reblog?.account?.id || item.account.id,\n              );\n              const filterInfo =\n                !selfPost &&\n                isFiltered(\n                  item.reblog?.filtered || item.filtered,\n                  FILTER_CONTEXT,\n                );\n              if (filterInfo?.action === 'hide') continue;\n              item._filtered = filterInfo;\n\n              // Followed tags\n              const sKey = statusKey(item.id, instance);\n              item._followedTags = states.statusFollowedTags[sKey]\n                ? [...states.statusFollowedTags[sKey]]\n                : [];\n\n              allResults.push(item);\n              addedResults = true;\n            } else {\n              // Don't immediately stop, still add the other items that might still be within range\n              // break mainloop;\n            }\n            // Only stop when ALL items are outside of range\n            if (!addedResults) {\n              break mainloop;\n            }\n          }\n        } else {\n          break mainloop;\n        }\n        // Pause 1s\n        await new Promise((resolve) => setTimeout(resolve, 1000));\n      } catch (e) {\n        console.error(e);\n        break mainloop;\n      }\n    }\n\n    // Post-process all results\n    // 1. Threadify - tag 1st-post in a thread\n    allResults.forEach((status) => {\n      if (status?.inReplyToId) {\n        const replyToStatus = allResults.find(\n          (s) => s.id === status.inReplyToId,\n        );\n        if (replyToStatus && !replyToStatus.inReplyToId) {\n          replyToStatus._thread = true;\n        }\n      }\n    });\n\n    return allResults;\n  }\n\n  const [posts, setPosts] = useState([]);\n  const catchupRangeRef = useRef();\n  const catchupLastRef = useRef();\n  const NS = useMemo(() => getCurrentAccountNS(), []);\n  const handleCatchupClick = useCallback(async ({ duration } = {}) => {\n    const now = Date.now();\n    const maxCreatedAt = duration ? now - duration : null;\n    console.log('CATCHUP', {\n      duration,\n      durationHuman: duration ? `${duration / 1000 / 60 / 60}h` : null,\n      maxCreatedAt,\n      maxCreatedAtHuman: maxCreatedAt\n        ? dtf.format(new Date(maxCreatedAt))\n        : null,\n    });\n    setUIState('loading');\n    const results = await fetchHome({ maxCreatedAt });\n    // Namespaced by account ID\n    // Possible conflict if ID matches between different accounts from different instances\n    const catchupID = `${NS}-${uid()}`;\n    try {\n      await db.catchup.set(catchupID, {\n        id: catchupID,\n        posts: results,\n        count: results.length,\n        startAt: maxCreatedAt,\n        endAt: now,\n      });\n      setSearchParams({ id: catchupID });\n    } catch (e) {\n      console.error(e, results);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (id) {\n      (async () => {\n        const catchup = await db.catchup.get(id);\n        if (catchup) {\n          catchup.posts.sort((a, b) => (a.createdAt > b.createdAt ? 1 : -1));\n          setPosts(catchup.posts);\n          setUIState('results');\n        }\n      })();\n    } else if (uiState === 'results') {\n      setPosts([]);\n      setUIState('start');\n    }\n  }, [id]);\n\n  const [reloadCatchupsCount, reloadCatchups] = useReducer((c) => c + 1, 0);\n  const [lastCatchupEndAt, setLastCatchupEndAt] = useState(null);\n  const [prevCatchups, setPrevCatchups] = useState([]);\n\n  useEffect(() => {\n    const catchupIds = new Set(prevCatchups.map((pc) => pc.id));\n    for (let i = sessionStorage.length - 1; i >= 0; i--) {\n      const key = sessionStorage.key(i);\n      if (key?.startsWith(`${CATCHUP_NS}-`)) {\n        const catchupId = key.replace(`${CATCHUP_NS}-`, '');\n        if (!catchupIds.has(catchupId)) {\n          store.session.del(key);\n        }\n      }\n    }\n  }, [prevCatchups]);\n\n  useEffect(() => {\n    (async () => {\n      try {\n        const catchups = await db.catchup.keys();\n        if (catchups.length) {\n          const ns = getCurrentAccountNS();\n          const ownKeys = catchups.filter((key) => key.startsWith(`${ns}-`));\n          if (ownKeys.length) {\n            let ownCatchups = await db.catchup.getMany(ownKeys);\n            ownCatchups.sort((a, b) => b.endAt - a.endAt);\n\n            // Split to 1st 3 last catchups, and the rest\n            let lastCatchups = ownCatchups.slice(0, 3);\n            let restCatchups = ownCatchups.slice(3);\n\n            const trimmedCatchups = lastCatchups.map((c) => {\n              const { id, count, startAt, endAt } = c;\n              return {\n                id,\n                count,\n                startAt,\n                endAt,\n              };\n            });\n            setPrevCatchups(trimmedCatchups);\n            setLastCatchupEndAt(lastCatchups[0].endAt);\n\n            // GC time\n            ownCatchups = null;\n            lastCatchups = null;\n\n            queueMicrotask(() => {\n              if (restCatchups.length) {\n                // delete them\n                db.catchup\n                  .delMany(restCatchups.map((c) => c.id))\n                  .then(() => {\n                    // GC time\n                    restCatchups = null;\n                  })\n                  .catch((e) => {\n                    console.error(e);\n                  });\n              }\n            });\n\n            return;\n          }\n        }\n      } catch (e) {\n        console.error(e);\n      }\n      setPrevCatchups([]);\n    })();\n  }, [reloadCatchupsCount]);\n  useEffect(() => {\n    if (uiState === 'start') {\n      reloadCatchups();\n    }\n  }, [uiState === 'start']);\n\n  const [filterCounts, links] = useMemo(() => {\n    let filtered = 0,\n      groups = 0,\n      boosts = 0,\n      quotes = 0,\n      replies = 0,\n      followedTags = 0,\n      original = 0;\n    const links = {};\n    for (const post of posts) {\n      if (post._filtered && post._filtered?.action !== 'blur') {\n        filtered++;\n        post.__FILTER = 'filtered';\n      } else if (post.group) {\n        groups++;\n        post.__FILTER = 'groups';\n      } else if (post.reblog) {\n        boosts++;\n        post.__FILTER = 'boosts';\n      } else if (supportsNativeQuote() && hasQuote(post.quote)) {\n        quotes++;\n        post.__FILTER = 'quotes';\n      } else if (post._followedTags?.length) {\n        followedTags++;\n        post.__FILTER = 'followedTags';\n      } else if (\n        post.inReplyToId &&\n        post.inReplyToAccountId !== post.account?.id\n      ) {\n        replies++;\n        post.__FILTER = 'replies';\n      } else {\n        original++;\n        post.__FILTER = 'original';\n      }\n\n      const thePost = post.reblog || post;\n      if (\n        post.__FILTER !== 'filtered' &&\n        thePost.card?.url &&\n        thePost.card?.image &&\n        thePost.card?.type === 'link'\n      ) {\n        const { card, favouritesCount, reblogsCount } = thePost;\n        let { url } = card;\n        url = url.replace(/\\/$/, '');\n        if (!links[url]) {\n          links[url] = {\n            postID: thePost.id,\n            card,\n            shared: 1,\n            sharers: [post.account],\n            likes: favouritesCount,\n            boosts: reblogsCount,\n          };\n        } else {\n          if (links[url].sharers.find((a) => a.id === post.account.id)) {\n            continue;\n          }\n          links[url].shared++;\n          links[url].sharers.push(post.account);\n          if (links[url].postID !== thePost.id) {\n            links[url].likes += favouritesCount;\n            links[url].boosts += reblogsCount;\n          }\n        }\n      }\n    }\n\n    let topLinks = [];\n    for (const link in links) {\n      topLinks.push({\n        url: link,\n        ...links[link],\n      });\n    }\n    topLinks.sort((a, b) => {\n      if (a.shared > b.shared) return -1;\n      if (a.shared < b.shared) return 1;\n      if (a.boosts > b.boosts) return -1;\n      if (a.boosts < b.boosts) return 1;\n      if (a.likes > b.likes) return -1;\n      if (a.likes < b.likes) return 1;\n      if (a.quotes > b.quotes) return -1;\n      if (a.quotes < b.quotes) return 1;\n      return 0;\n    });\n\n    // Slice links to shared > 1 but min 10 links\n    if (topLinks.length > 10) {\n      linksLoop: for (let i = 10; i < topLinks.length; i++) {\n        const { shared } = topLinks[i];\n        if (shared <= 1) {\n          topLinks = topLinks.slice(0, i);\n          break linksLoop;\n        }\n      }\n    }\n\n    return [\n      {\n        filtered,\n        groups,\n        boosts,\n        quotes,\n        replies,\n        followedTags,\n        original,\n      },\n      topLinks,\n    ];\n  }, [posts]);\n\n  const [selectedFilterCategory, setSelectedFilterCategory] = useState('all');\n  const [selectedAuthor, setSelectedAuthor] = useState(null);\n\n  const [range, setRange] = useState(1);\n\n  const [sortBy, setSortBy] = useState('createdAt');\n  const [sortOrder, setSortOrder] = useState('asc');\n  const [groupBy, setGroupBy] = useState(null);\n\n  useEffect(() => {\n    if (!id) return;\n    const savedState = store.session.getJSON(`${CATCHUP_NS}-${id}`);\n    if (savedState) {\n      if (savedState.selectedFilterCategory !== undefined) {\n        setSelectedFilterCategory(savedState.selectedFilterCategory);\n      }\n      if (savedState.selectedAuthor !== undefined) {\n        setSelectedAuthor(savedState.selectedAuthor);\n      }\n      if (savedState.sortBy !== undefined) {\n        setSortBy(savedState.sortBy);\n      }\n      if (savedState.sortOrder !== undefined) {\n        setSortOrder(savedState.sortOrder);\n      }\n      if (savedState.groupBy !== undefined) {\n        setGroupBy(savedState.groupBy);\n      }\n      if (savedState.showTopLinks !== undefined) {\n        setShowTopLinks(savedState.showTopLinks);\n      }\n    }\n  }, [id]);\n\n  useEffect(() => {\n    if (!id || uiState !== 'results') return;\n    const state = {\n      selectedFilterCategory,\n      selectedAuthor,\n      sortBy,\n      sortOrder,\n      groupBy,\n      showTopLinks,\n    };\n    store.session.setJSON(`${CATCHUP_NS}-${id}`, state);\n  }, [\n    id,\n    uiState,\n    selectedFilterCategory,\n    selectedAuthor,\n    sortBy,\n    sortOrder,\n    groupBy,\n    showTopLinks,\n  ]);\n\n  const [filteredPosts, authors, authorCounts] = useMemo(() => {\n    const authorsHash = {};\n    const authorCountsMap = new Map();\n\n    let filteredPosts = posts.filter((post) => {\n      const postFilterMatches =\n        selectedFilterCategory === 'all' ||\n        post.__FILTER === selectedFilterCategory;\n\n      if (postFilterMatches) {\n        authorsHash[post.account.id] = post.account;\n        authorCountsMap.set(\n          post.account.id,\n          (authorCountsMap.get(post.account.id) || 0) + 1,\n        );\n      }\n\n      return postFilterMatches;\n    });\n\n    // Deduplicate boosts\n    const boostedPosts = {};\n    filteredPosts.forEach((post) => {\n      if (post.reblog) {\n        if (boostedPosts[post.reblog.id]) {\n          if (boostedPosts[post.reblog.id].__BOOSTERS) {\n            boostedPosts[post.reblog.id].__BOOSTERS.add(post.account);\n          } else {\n            boostedPosts[post.reblog.id].__BOOSTERS = new Set([post.account]);\n          }\n          post.__HIDDEN = true;\n        } else {\n          boostedPosts[post.reblog.id] = post;\n        }\n      }\n    });\n\n    if (selectedAuthor && authorCountsMap.has(selectedAuthor)) {\n      filteredPosts = filteredPosts.filter(\n        (post) =>\n          post.account.id === selectedAuthor ||\n          [...(post.__BOOSTERS || [])].find((a) => a.id === selectedAuthor),\n      );\n    }\n\n    return [filteredPosts, authorsHash, Object.fromEntries(authorCountsMap)];\n  }, [selectedFilterCategory, selectedAuthor, posts]);\n\n  const filteredPostsMap = useMemo(() => {\n    const map = {};\n    filteredPosts.forEach((post) => {\n      map[post.id] = post;\n    });\n    return map;\n  }, [filteredPosts]);\n\n  const authorCountsList = useMemo(\n    () =>\n      Object.keys(authorCounts).sort(\n        (a, b) => authorCounts[b] - authorCounts[a],\n      ),\n    [authorCounts],\n  );\n\n  const sortedFilteredPosts = useMemo(() => {\n    const authorIndices = {};\n    authorCountsList.forEach((authorID, index) => {\n      authorIndices[authorID] = index;\n    });\n    return filteredPosts\n      .filter((post) => !post.__HIDDEN)\n      .sort((a, b) => {\n        if (groupBy === 'account') {\n          const aAccountID = a.account.id;\n          const bAccountID = b.account.id;\n          const aIndex = authorIndices[aAccountID];\n          const bIndex = authorIndices[bAccountID];\n          const order = aIndex - bIndex;\n          if (order !== 0) {\n            return order;\n          }\n        }\n        if (sortBy !== 'createdAt') {\n          a = a.reblog || a;\n          b = b.reblog || b;\n          if (sortBy !== 'density' && a[sortBy] === b[sortBy]) {\n            return a.createdAt > b.createdAt ? 1 : -1;\n          }\n        }\n        if (sortBy === 'density') {\n          const aDensity = postDensity(a);\n          const bDensity = postDensity(b);\n          if (sortOrder === 'asc') {\n            return aDensity > bDensity ? 1 : -1;\n          } else {\n            return bDensity > aDensity ? 1 : -1;\n          }\n        }\n        if (sortOrder === 'asc') {\n          return a[sortBy] > b[sortBy] ? 1 : -1;\n        } else {\n          return b[sortBy] > a[sortBy] ? 1 : -1;\n        }\n      });\n  }, [filteredPosts, sortBy, sortOrder, groupBy, authorCountsList]);\n\n  const prevGroup = useRef(null);\n\n  const authorsListParent = useRef(null);\n  const autoAnimated = useRef(false);\n  useEffect(() => {\n    if (posts.length > 100 || autoAnimated.current) return;\n    if (authorsListParent.current) {\n      autoAnimate(authorsListParent.current, {\n        duration: 200,\n      });\n      autoAnimated.current = true;\n    }\n  }, [posts, authorsListParent]);\n\n  const postsBarType = posts.length > 160 ? '3d' : '2d';\n\n  const postsBar = useMemo(() => {\n    if (postsBarType !== '2d') return null;\n    return posts.map((post) => {\n      // If part of filteredPosts\n      const isFiltered = filteredPostsMap[post.id];\n      return (\n        <span\n          key={post.id}\n          class={`post-dot ${isFiltered ? 'post-dot-highlight' : ''}`}\n        />\n      );\n    });\n  }, [filteredPostsMap]);\n\n  const postsBins = useMemo(() => {\n    if (postsBarType !== '3d') return null;\n    if (!posts?.length) return null;\n    const bins = binByTime(posts, 'createdAt', 320);\n    return bins.map((posts, i) => {\n      return (\n        <div class=\"posts-bin\" key={i}>\n          {posts.map((post) => {\n            const isFiltered = filteredPostsMap[post.id];\n            return (\n              <span\n                key={post.id}\n                class={`post-dot ${isFiltered ? 'post-dot-highlight' : ''}`}\n              />\n            );\n          })}\n        </div>\n      );\n    });\n  }, [filteredPostsMap]);\n\n  const scrollableRef = useRef(null);\n\n  useLayoutEffect(() => {\n    if (!id || uiState !== 'results' || !scrollableRef.current) return;\n    if (!sortedFilteredPosts.length) return;\n\n    const savedState = store.session.getJSON(`${CATCHUP_NS}-${id}`);\n    if (savedState?.scrollTop !== undefined && savedState.scrollTop > 0) {\n      const timeoutId = setTimeout(() => {\n        if (scrollableRef.current) {\n          scrollableRef.current.scrollTo({\n            top: savedState.scrollTop,\n            behavior: 'instant',\n          });\n        }\n      }, 100);\n\n      return () => clearTimeout(timeoutId);\n    }\n  }, [id, uiState, sortedFilteredPosts.length]);\n\n  useEffect(() => {\n    if (!id || uiState !== 'results' || !scrollableRef.current) return;\n\n    const handleScroll = () => {\n      if (!scrollableRef.current) return;\n      const savedState = store.session.getJSON(`${CATCHUP_NS}-${id}`) || {};\n      savedState.scrollTop = scrollableRef.current.scrollTop;\n      store.session.setJSON(`${CATCHUP_NS}-${id}`, savedState);\n    };\n\n    const scrollElement = scrollableRef.current;\n    scrollElement.addEventListener('scroll', handleScroll, { passive: true });\n\n    return () => {\n      scrollElement.removeEventListener('scroll', handleScroll);\n    };\n  }, [id, uiState]);\n\n  // if range value exceeded lastCatchupEndAt, show error\n  const lastCatchupRange = useMemo(() => {\n    // return hour, not ms\n    if (!lastCatchupEndAt) return null;\n    return (Date.now() - lastCatchupEndAt) / 1000 / 60 / 60;\n  }, [lastCatchupEndAt, range]);\n\n  useEffect(() => {\n    if (uiState !== 'results') return;\n    const authorUsername =\n      selectedAuthor && authors[selectedAuthor]\n        ? authors[selectedAuthor].username\n        : '';\n    const sortOrderIndex = sortOrder === 'asc' ? 0 : 1;\n    const groupByText = {\n      account: 'authors',\n    };\n    let toast = showToast({\n      duration: 5_000, // 5 seconds\n      // Note: I'm sorry, translators\n      text: t`Showing ${select(selectedFilterCategory, {\n        all: 'all posts',\n        original: 'original posts',\n        replies: 'replies',\n        boosts: 'boosts',\n        quotes: 'quotes',\n        followedTags: 'followed tags',\n        groups: 'groups',\n        filtered: 'filtered posts',\n      })}, ${select(sortBy, {\n        createdAt: select(sortOrder, {\n          asc: 'oldest',\n          desc: 'latest',\n        }),\n        reblogsCount: select(sortOrder, {\n          asc: 'fewest boosts',\n          desc: 'most boosts',\n        }),\n        favouritesCount: select(sortOrder, {\n          asc: 'fewest likes',\n          desc: 'most likes',\n        }),\n        repliesCount: select(sortOrder, {\n          asc: 'fewest replies',\n          desc: 'most replies',\n        }),\n        density: select(sortOrder, { asc: 'least dense', desc: 'most dense' }),\n      })} first${select(groupBy, {\n        account: ', grouped by authors',\n        other: '',\n      })}`,\n    });\n    return () => {\n      toast?.hideToast?.();\n    };\n  }, [\n    uiState,\n    selectedFilterCategory,\n    selectedAuthor,\n    sortBy,\n    sortOrder,\n    groupBy,\n    authors,\n  ]);\n\n  useEffect(() => {\n    if (selectedAuthor) {\n      if (authors[selectedAuthor]) {\n        // Check if author is visible and within the scrollable area viewport\n        const authorElement = authorsListParent.current.querySelector(\n          `[data-author=\"${selectedAuthor}\"]`,\n        );\n        const scrollableRect =\n          authorsListParent.current?.getBoundingClientRect();\n        const authorRect = authorElement?.getBoundingClientRect();\n        console.log({\n          sLeft: scrollableRect.left,\n          sRight: scrollableRect.right,\n          aLeft: authorRect.left,\n          aRight: authorRect.right,\n        });\n        if (\n          authorRect.left < scrollableRect.left ||\n          authorRect.right > scrollableRect.right\n        ) {\n          authorElement.scrollIntoView({\n            block: 'nearest',\n            inline: 'center',\n            behavior: 'smooth',\n          });\n        } else if (authorRect.top < 0) {\n          authorElement.scrollIntoView({\n            block: 'nearest',\n            inline: 'nearest',\n            behavior: 'smooth',\n          });\n        }\n      }\n    }\n  }, [selectedAuthor, authors]);\n\n  const [showHelp, setShowHelp] = useState(false);\n\n  const itemsSelector = '.catchup-list > li > a';\n  const jRef = useHotkeys(\n    'j',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        const nextItem = allItems[activeItemIndex + 1];\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView({\n            block: 'center',\n            inline: 'center',\n            behavior: 'instant',\n          });\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView({\n            block: 'nearest',\n            inline: 'center',\n            behavior: 'instant',\n          });\n        }\n      }\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView({\n            block: 'center',\n            inline: 'center',\n            behavior: 'instant',\n          });\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView({\n            block: 'nearest',\n            inline: 'center',\n            behavior: 'instant',\n          });\n        }\n      }\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const hlRef = useHotkeys(\n    'h, l',\n    (_, handler) => {\n      // Go next/prev selectedAuthor in authorCountsList list\n      const key = handler.keys[0];\n      if (selectedAuthor) {\n        const index = authorCountsList.indexOf(selectedAuthor);\n        if (key === 'h') {\n          if (index > 0 && index < authorCountsList.length) {\n            setSelectedAuthor(authorCountsList[index - 1]);\n            scrollableRef.current?.focus();\n          }\n        } else if (key === 'l') {\n          if (index < authorCountsList.length - 1 && index >= 0) {\n            setSelectedAuthor(authorCountsList[index + 1]);\n            scrollableRef.current?.focus();\n          }\n        }\n      } else if (key === 'l') {\n        setSelectedAuthor(authorCountsList[0]);\n        scrollableRef.current?.focus();\n      }\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n      enableOnFormTags: ['input'],\n    },\n  );\n\n  const escRef = useHotkeys(\n    'esc',\n    () => {\n      setSelectedAuthor(null);\n      scrollableRef.current?.focus();\n    },\n    {\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n      enableOnFormTags: ['input'],\n      useKey: true,\n    },\n  );\n\n  const dotRef = useHotkeys(\n    '.',\n    () => {\n      scrollableRef.current?.scrollTo({\n        top: 0,\n        behavior: 'smooth',\n      });\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n      enableOnFormTags: ['input'],\n    },\n  );\n\n  const handleArrowKeys = useCallback((e) => {\n    const activeElement = document.activeElement;\n    const isRadio =\n      activeElement?.tagName === 'INPUT' && activeElement.type === 'radio';\n    const isArrowKeys =\n      e.key === 'ArrowDown' ||\n      e.key === 'ArrowUp' ||\n      e.key === 'ArrowLeft' ||\n      e.key === 'ArrowRight';\n    if (isArrowKeys && isRadio) {\n      // Note: page scroll won't trigger on first arrow key press due to this. Subsequent presses will.\n      activeElement.blur();\n      return;\n    }\n  }, []);\n\n  return (\n    <div\n      ref={(node) => {\n        scrollableRef.current = node;\n        jRef.current = node;\n        kRef.current = node;\n        hlRef.current = node;\n        escRef.current = node;\n        dotRef.current = node;\n      }}\n      id=\"catchup-page\"\n      class=\"deck-container\"\n      tabIndex=\"-1\"\n    >\n      <div class=\"timeline-deck deck wide\">\n        <header\n          class={`${uiState === 'loading' ? 'loading' : ''}`}\n          onClick={(e) => {\n            if (!e.target.closest('a, button')) {\n              scrollableRef.current?.scrollTo({\n                top: 0,\n                behavior: 'smooth',\n              });\n            }\n          }}\n        >\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              {uiState === 'results' && (\n                <Link to=\"/catchup\" class=\"button plain\">\n                  <Icon icon=\"history2\" size=\"l\" alt={t`Catch-up`} />\n                </Link>\n              )}\n              {uiState === 'start' && (\n                <Link to=\"/\" class=\"button plain\">\n                  <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n                </Link>\n              )}\n            </div>\n            <h1>\n              {uiState !== 'start' && (\n                <Trans>\n                  Catch-up <sup>beta</sup>\n                </Trans>\n              )}\n            </h1>\n            <div class=\"header-side\">\n              {uiState !== 'start' && uiState !== 'loading' && (\n                <button\n                  type=\"button\"\n                  class=\"plain\"\n                  onClick={() => {\n                    setShowHelp(true);\n                  }}\n                >\n                  <Trans>Help</Trans>\n                </button>\n              )}\n            </div>\n          </div>\n        </header>\n        <main onKeyDown={handleArrowKeys}>\n          {uiState === 'start' && (\n            <div class=\"catchup-start\">\n              <h1>\n                <Trans>\n                  Catch-up <sup>beta</sup>\n                </Trans>\n              </h1>\n              <details>\n                <summary>\n                  <Trans>What is this?</Trans>\n                </summary>\n                <p>\n                  <Trans>\n                    Catch-up is a separate timeline for your followings,\n                    offering a high-level view at a glance, with a simple,\n                    email-inspired interface to effortlessly sort and filter\n                    through posts.\n                  </Trans>\n                </p>\n                <img\n                  src={catchupUrl}\n                  width=\"1200\"\n                  height=\"900\"\n                  alt={t`Preview of Catch-up UI`}\n                />\n                <p>\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.target.closest('details').open = false;\n                    }}\n                  >\n                    <Trans>Let's catch up</Trans>\n                  </button>\n                </p>\n              </details>\n              <p>\n                <Trans>Let's catch up on the posts from your followings.</Trans>\n              </p>\n              <p>\n                <b>\n                  <Trans>Show me all posts from</Trans>\n                </b>\n              </p>\n              <div class=\"catchup-form\">\n                <input\n                  ref={catchupRangeRef}\n                  type=\"range\"\n                  value={range}\n                  min={RANGES[0].value}\n                  max={RANGES[RANGES.length - 1].value}\n                  step=\"1\"\n                  list=\"catchup-ranges\"\n                  onChange={(e) => setRange(+e.target.value)}\n                />{' '}\n                <span\n                  style={{\n                    width: '8em',\n                  }}\n                >\n                  {_(RANGES[range - 1].label)}\n                  <br />\n                  <small class=\"insignificant\">\n                    {range == RANGES[RANGES.length - 1].value\n                      ? t`until the max`\n                      : niceDateTime(\n                          new Date(Date.now() - range * 60 * 60 * 1000),\n                        )}\n                  </small>\n                </span>\n                <datalist id=\"catchup-ranges\">\n                  {RANGES.map(({ label, value }) => (\n                    <option value={value} label={_(label)} />\n                  ))}\n                </datalist>{' '}\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    let duration;\n                    const beyondRange = RANGES.find((r) => r.beyond);\n                    if (range < beyondRange.value) {\n                      // Within range\n                      duration = range * 60 * 60 * 1000;\n                    } else {\n                      // Beyond range\n                      const untilLastCatchup = catchupLastRef.current?.checked;\n                      if (untilLastCatchup) {\n                        // Until last catch-up's end time\n                        duration = Date.now() - lastCatchupEndAt;\n                      } else {\n                        // Go beyond range until max, even after last catch-up's end time\n                        // Don't need to set duration\n                      }\n                    }\n                    handleCatchupClick({ duration });\n                  }}\n                >\n                  <Trans>Catch up</Trans>\n                </button>\n              </div>\n              {lastCatchupRange && range > lastCatchupRange ? (\n                <p class=\"catchup-info\">\n                  <Icon icon=\"info\" />{' '}\n                  <Trans>Overlaps with your last catch-up</Trans>\n                </p>\n              ) : range === RANGES[RANGES.length - 1].value &&\n                lastCatchupEndAt ? (\n                <p class=\"catchup-info\">\n                  <label>\n                    <input\n                      type=\"checkbox\"\n                      switch\n                      checked\n                      ref={catchupLastRef}\n                    />{' '}\n                    <Trans>\n                      Until the last catch-up (\n                      {dtf.format(new Date(lastCatchupEndAt))})\n                    </Trans>\n                  </label>\n                </p>\n              ) : null}\n              <p class=\"insignificant\">\n                <small>\n                  <Trans>\n                    Note: your instance might only show a maximum of 800 posts\n                    in the Home timeline regardless of the time range. Could be\n                    less or more.\n                  </Trans>\n                </small>\n              </p>\n              {!!prevCatchups?.length && (\n                <div class=\"catchup-prev\">\n                  <p>\n                    <Trans>Previously</Trans>\n                  </p>\n                  <ul>\n                    {prevCatchups.map((pc) => (\n                      <li key={pc.id}>\n                        <Link to={`/catchup?id=${pc.id}`}>\n                          <Icon icon=\"history2\" />{' '}\n                          <span>\n                            {pc.startAt\n                              ? dtf.formatRange(\n                                  new Date(pc.startAt),\n                                  new Date(pc.endAt),\n                                )\n                              : `${dtf.format(new Date(pc.endAt))}`}\n                          </span>\n                        </Link>{' '}\n                        <span>\n                          <small class=\"ib insignificant\">\n                            <Plural\n                              value={pc.count}\n                              one=\"# post\"\n                              other=\"# posts\"\n                            />\n                          </small>{' '}\n                          <button\n                            type=\"button\"\n                            class=\"light danger small\"\n                            onClick={async () => {\n                              const yes = confirm(t`Remove this catch-up?`);\n                              if (yes) {\n                                let st = showToast(\n                                  t`Removing Catch-up ${pc.id}`,\n                                );\n                                await db.catchup.del(pc.id);\n                                st?.hideToast?.();\n                                showToast(t`Catch-up ${pc.id} removed`);\n                                reloadCatchups();\n                              }\n                            }}\n                          >\n                            <Icon icon=\"x\" alt={t`Remove`} />\n                          </button>\n                        </span>\n                      </li>\n                    ))}\n                  </ul>\n                  {prevCatchups.length >= 3 && (\n                    <p>\n                      <small>\n                        <Trans>\n                          Note: Only max 3 will be stored. The rest will be\n                          automatically removed.\n                        </Trans>\n                      </small>\n                    </p>\n                  )}\n                </div>\n              )}\n            </div>\n          )}\n          {uiState === 'loading' && (\n            <div class=\"ui-state catchup-start\">\n              <Loader abrupt />\n              <p class=\"insignificant\">\n                <Trans>Fetching posts</Trans>\n              </p>\n              <p class=\"insignificant\">\n                <Trans>This might take a while.</Trans>\n              </p>\n            </div>\n          )}\n          {uiState === 'results' && (\n            <>\n              <div class=\"catchup-header\">\n                {posts.length > 0 && (\n                  <p>\n                    <b class=\"ib\">\n                      {dtf.formatRange(\n                        new Date(posts[0].createdAt),\n                        new Date(posts[posts.length - 1].createdAt),\n                      )}\n                    </b>\n                  </p>\n                )}\n                <aside>\n                  <button\n                    hidden={\n                      selectedFilterCategory === 'all' &&\n                      !selectedAuthor &&\n                      sortBy === 'createdAt' &&\n                      sortOrder === 'asc'\n                    }\n                    type=\"button\"\n                    class=\"plain4 small\"\n                    onClick={() => {\n                      setSelectedFilterCategory('all');\n                      setSelectedAuthor(null);\n                      setSortBy('createdAt');\n                      setGroupBy(null);\n                      setSortOrder('asc');\n                    }}\n                  >\n                    <Trans>Reset filters</Trans>\n                  </button>\n                  {links?.length > 0 && (\n                    <button\n                      type=\"button\"\n                      class=\"plain small\"\n                      onClick={() => setShowTopLinks(!showTopLinks)}\n                    >\n                      <Trans>Top links</Trans>{' '}\n                      <Icon\n                        icon=\"chevron-down\"\n                        style={{\n                          transform: showTopLinks\n                            ? 'rotate(180deg)'\n                            : 'rotate(0deg)',\n                        }}\n                      />\n                    </button>\n                  )}\n                </aside>\n              </div>\n              <div class=\"shazam-container no-animation\" hidden={!showTopLinks}>\n                <div class=\"shazam-container-inner\">\n                  <div class=\"catchup-top-links links-bar\">\n                    {links.map((link) => {\n                      const { card, shared, sharers, likes, boosts } = link;\n                      const {\n                        blurhash,\n                        title,\n                        description,\n                        url,\n                        image,\n                        imageDescription,\n                        language,\n                        width,\n                        height,\n                        publishedAt,\n                      } = card;\n                      const domain = getDomain(url);\n                      let accentColor;\n                      if (blurhash) {\n                        const averageColor = getBlurHashAverageColor(blurhash);\n                        const labAverageColor = rgb2oklab(averageColor);\n                        accentColor = oklab2rgb([\n                          0.6,\n                          labAverageColor[1],\n                          labAverageColor[2],\n                        ]);\n                      }\n\n                      return (\n                        <a\n                          key={url}\n                          href={url}\n                          target=\"_blank\"\n                          rel=\"noopener\"\n                          class=\"link-block\"\n                          style={\n                            accentColor\n                              ? {\n                                  '--accent-color': `rgb(${accentColor.join(\n                                    ',',\n                                  )})`,\n                                  '--accent-alpha-color': `rgba(${accentColor.join(\n                                    ',',\n                                  )}, 0.4)`,\n                                }\n                              : {}\n                          }\n                        >\n                          <article>\n                            <figure>\n                              <img\n                                src={image}\n                                alt={imageDescription}\n                                width={width}\n                                height={height}\n                                loading=\"lazy\"\n                              />\n                            </figure>\n                            <div class=\"article-body\">\n                              <header>\n                                <div class=\"article-meta\">\n                                  <span class=\"domain\">{domain}</span>{' '}\n                                  {!!publishedAt && <>&middot; </>}\n                                  {!!publishedAt && (\n                                    <>\n                                      <RelativeTime\n                                        datetime={publishedAt}\n                                        format=\"micro\"\n                                      />\n                                    </>\n                                  )}\n                                </div>\n                                {!!title && (\n                                  <h1\n                                    class=\"title\"\n                                    lang={language}\n                                    dir=\"auto\"\n                                    title={title}\n                                  >\n                                    {title}\n                                  </h1>\n                                )}\n                              </header>\n                              {!!description && (\n                                <p\n                                  class=\"description\"\n                                  lang={language}\n                                  dir=\"auto\"\n                                  title={description}\n                                >\n                                  {description}\n                                </p>\n                              )}\n                              <hr />\n                              <p\n                                style={{\n                                  whiteSpace: 'nowrap',\n                                }}\n                              >\n                                <Trans>\n                                  Shared by{' '}\n                                  {sharers.map((s) => {\n                                    const { avatarStatic, displayName } = s;\n                                    return (\n                                      <button\n                                        type=\"button\"\n                                        class=\"plain\"\n                                        style={{\n                                          padding: 0,\n                                        }}\n                                        onClick={(e) => {\n                                          e.preventDefault();\n                                          e.stopPropagation();\n                                          // Reset and filter to author\n                                          const { id } = s;\n                                          setSelectedAuthor(id);\n                                          setSelectedFilterCategory('all');\n                                        }}\n                                      >\n                                        <Avatar\n                                          url={avatarStatic}\n                                          size=\"s\"\n                                          alt={displayName}\n                                        />\n                                      </button>\n                                    );\n                                  })}\n                                </Trans>\n                              </p>\n                            </div>\n                          </article>\n                        </a>\n                      );\n                    })}\n                  </div>\n                </div>\n              </div>\n              {posts.length >= 5 &&\n                (postsBarType === '3d' ? (\n                  <div class=\"catchup-posts-viz-time-bar\">{postsBins}</div>\n                ) : (\n                  <div class=\"catchup-posts-viz-bar\">{postsBar}</div>\n                ))}\n              {posts.length >= 2 && (\n                <div class=\"catchup-filters\">\n                  <label class=\"filter-cat\">\n                    <input\n                      type=\"radio\"\n                      name=\"filter-cat\"\n                      checked={selectedFilterCategory.toLowerCase() === 'all'}\n                      onChange={() => {\n                        setSelectedFilterCategory('all');\n                      }}\n                    />\n                    <Trans>All</Trans> <span class=\"count\">{posts.length}</span>\n                  </label>\n                  {Object.entries(FILTER_KEYS).map(\n                    ([key, label]) =>\n                      !!filterCounts[key] && (\n                        <label\n                          class=\"filter-cat\"\n                          key={_(label)}\n                          title={\n                            ((filterCounts[key] / posts.length) * 100).toFixed(\n                              2,\n                            ) + '%'\n                          }\n                        >\n                          <input\n                            type=\"radio\"\n                            name=\"filter-cat\"\n                            checked={\n                              selectedFilterCategory.toLowerCase() ===\n                              key.toLowerCase()\n                            }\n                            onChange={() => {\n                              setSelectedFilterCategory(key);\n                              if (key === 'boosts') {\n                                setSortBy('reblogsCount');\n                                setSortOrder('desc');\n                                setGroupBy(null);\n                              }\n                              // setSelectedAuthor(null);\n                            }}\n                          />\n                          {_(label)}{' '}\n                          <span class=\"count\">{filterCounts[key]}</span>\n                        </label>\n                      ),\n                  )}\n                </div>\n              )}\n              {posts.length >= 2 && !!authorCounts && (\n                <div\n                  class=\"catchup-filters authors-filters\"\n                  ref={authorsListParent}\n                >\n                  {authorCountsList.map((author) => (\n                    <label\n                      class=\"filter-author\"\n                      data-author={author}\n                      key={`${author}-${authorCounts[author]}`}\n                      // Preact messed up the order sometimes, need additional key besides just `author`\n                      // https://github.com/preactjs/preact/issues/2849\n                    >\n                      <input\n                        type=\"radio\"\n                        name=\"filter-author\"\n                        checked={selectedAuthor === author}\n                        onChange={() => {\n                          setSelectedAuthor(author);\n                          // setGroupBy(null);\n                        }}\n                        onClick={() => {\n                          if (selectedAuthor === author) {\n                            setSelectedAuthor(null);\n                          }\n                        }}\n                      />\n                      <Avatar\n                        url={\n                          authors[author].avatarStatic || authors[author].avatar\n                        }\n                        size=\"xxl\"\n                        alt={`${authors[author].displayName} (@${authors[author].acct})`}\n                      />{' '}\n                      <span class=\"count\">{authorCounts[author]}</span>\n                      <span class=\"username\">{authors[author].username}</span>\n                    </label>\n                  ))}\n                  {authorCountsList.length > 5 && (\n                    <small\n                      key=\"authors-count\"\n                      style={{\n                        whiteSpace: 'nowrap',\n                        paddingInline: '1em',\n                        opacity: 0.33,\n                      }}\n                    >\n                      <Plural\n                        value={authorCountsList.length}\n                        one=\"# author\"\n                        other=\"# authors\"\n                      />\n                    </small>\n                  )}\n                </div>\n              )}\n              {posts.length >= 2 && (\n                <div class=\"catchup-filters\">\n                  <span class=\"filter-label\">\n                    <Trans>Sort</Trans>\n                  </span>{' '}\n                  <fieldset class=\"radio-field-group\">\n                    {FILTER_SORTS.map((key) => (\n                      <label\n                        class=\"filter-sort\"\n                        key={key}\n                        onClick={(e) => {\n                          if (sortBy === key) {\n                            e.preventDefault();\n                            e.stopPropagation();\n                            setSortOrder(sortOrder === 'asc' ? 'desc' : 'asc');\n                          }\n                        }}\n                      >\n                        <input\n                          type=\"radio\"\n                          name=\"filter-sort-cat\"\n                          checked={sortBy === key}\n                          onChange={() => {\n                            setSortBy(key);\n                            const order =\n                              /(replies|favourites|reblogs|quotes)/.test(key)\n                                ? 'desc'\n                                : 'asc';\n                            setSortOrder(order);\n                          }}\n                        />\n                        {\n                          {\n                            createdAt: t`Date`,\n                            repliesCount: t`Replies`,\n                            favouritesCount: t`Likes`,\n                            reblogsCount: t`Boosts`,\n                            quotesCount: t`Quotes`,\n                            density: t`Density`,\n                          }[key]\n                        }\n                        {sortBy === key && (sortOrder === 'asc' ? ' ' : ' ')}\n                      </label>\n                    ))}\n                  </fieldset>\n                  {/* <fieldset class=\"radio-field-group\">\n                    {['asc', 'desc'].map((key) => (\n                      <label class=\"filter-sort\" key={key}>\n                        <input\n                          type=\"radio\"\n                          name=\"filter-sort-dir\"\n                          checked={sortOrder === key}\n                          onChange={() => {\n                            setSortOrder(key);\n                          }}\n                        />\n                        {key === 'asc' ? '' : ''}\n                      </label>\n                    ))}\n                  </fieldset> */}\n                  <span class=\"filter-label\">\n                    <Trans id=\"group.filter\">Group</Trans>\n                  </span>{' '}\n                  <fieldset class=\"radio-field-group\">\n                    {FILTER_GROUPS.map((key) => (\n                      <label class=\"filter-group\" key={key || 'none'}>\n                        <input\n                          type=\"radio\"\n                          name=\"filter-group\"\n                          checked={groupBy === key}\n                          onChange={() => {\n                            setGroupBy(key);\n                          }}\n                          disabled={key === 'account' && selectedAuthor}\n                        />\n                        {{\n                          account: t`Authors`,\n                        }[key] || t`None`}\n                      </label>\n                    ))}\n                  </fieldset>\n                  {\n                    selectedAuthor && authorCountsList.length > 1 ? (\n                      <button\n                        type=\"button\"\n                        class=\"plain6 small\"\n                        onClick={() => {\n                          setSelectedAuthor(null);\n                        }}\n                        style={{\n                          whiteSpace: 'nowrap',\n                        }}\n                      >\n                        <Trans>Show all authors</Trans>\n                      </button>\n                    ) : null\n                    // <button\n                    //   type=\"button\"\n                    //   class=\"plain4 small\"\n                    //   onClick={() => {}}\n                    // >\n                    //   Group by authors\n                    // </button>\n                  }\n                </div>\n              )}\n              <ul\n                class={`catchup-list catchup-filter-${\n                  selectedFilterCategory || ''\n                } ${sortBy ? `catchup-sort-${sortBy}` : ''} ${\n                  selectedAuthor && authors[selectedAuthor]\n                    ? `catchup-selected-author`\n                    : ''\n                } ${groupBy ? `catchup-group-${groupBy}` : ''}`}\n              >\n                {sortedFilteredPosts.map((post, i) => {\n                  const id = post.reblog?.id || post.id;\n                  let showSeparator = false;\n                  if (groupBy === 'account') {\n                    if (\n                      prevGroup.current &&\n                      post.account.id !== prevGroup.current &&\n                      i > 0\n                    ) {\n                      showSeparator = true;\n                    }\n                    prevGroup.current = post.account.id;\n                  }\n                  return (\n                    <Fragment key={`${post.id}-${showSeparator}`}>\n                      {showSeparator && <li class=\"separator\" />}\n                      <IntersectionPostLineItem\n                        to={`/${instance}/s/${id}`}\n                        post={post}\n                        root={scrollableRef.current}\n                      />\n                    </Fragment>\n                  );\n                })}\n              </ul>\n              <footer>\n                {filteredPosts.length > 5 && (\n                  <p>\n                    {selectedFilterCategory === 'boosts'\n                      ? t`You don't have to read everything.`\n                      : t`That's all.`}{' '}\n                    <button\n                      type=\"button\"\n                      class=\"textual\"\n                      onClick={() => {\n                        scrollableRef.current.scrollTop = 0;\n                      }}\n                    >\n                      <Trans>Back to top</Trans>\n                    </button>\n                    .\n                  </p>\n                )}\n              </footer>\n            </>\n          )}\n        </main>\n      </div>\n      {showHelp && (\n        <Modal onClose={() => setShowHelp(false)}>\n          <div class=\"sheet\" id=\"catchup-help-sheet\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => setShowHelp(false)}\n            >\n              <Icon icon=\"x\" alt={t`Close`} />\n            </button>\n            <header>\n              <h2>\n                <Trans>Help</Trans>\n              </h2>\n            </header>\n            <main>\n              <dl>\n                <dt>\n                  <Trans>Top links</Trans>\n                </dt>\n                <dd>\n                  <Trans>\n                    Links shared by followings, sorted by shared counts, boosts\n                    and likes.\n                  </Trans>\n                </dd>\n                <dt>\n                  <Trans>Sort: Density</Trans>\n                </dt>\n                <dd>\n                  <Trans>\n                    Posts are sorted by information density or depth. Shorter\n                    posts are \"lighter\" while longer posts are \"heavier\". Posts\n                    with photos are \"heavier\" than posts without photos.\n                  </Trans>\n                </dd>\n                <dt>\n                  <Trans>Group: Authors</Trans>\n                </dt>\n                <dd>\n                  <Trans>\n                    Posts are grouped by authors, sorted by posts count per\n                    author.\n                  </Trans>\n                </dd>\n                <dt>\n                  <Trans>Keyboard shortcuts</Trans>\n                </dt>\n                {/* <dd>\n                  <kbd>j</kbd>: <Trans>Next post</Trans>\n                </dd>\n                <dd>\n                  <kbd>k</kbd>: <Trans>Previous post</Trans>\n                </dd>\n                <dd>\n                  <kbd>l</kbd>: <Trans>Next author</Trans>\n                </dd>\n                <dd>\n                  <kbd>h</kbd>: <Trans>Previous author</Trans>\n                </dd>\n                <dd>\n                  <kbd>Enter</kbd>: <Trans>Open post details</Trans>\n                </dd>\n                <dd>\n                  <kbd>.</kbd>: <Trans>Scroll to top</Trans>\n                </dd> */}\n                <dd>\n                  <table>\n                    <tbody>\n                      <tr>\n                        <td>\n                          <Trans>Next post</Trans>\n                        </td>\n                        <td>\n                          <kbd>j</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Previous post</Trans>\n                        </td>\n                        <td>\n                          <kbd>k</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Next author</Trans>\n                        </td>\n                        <td>\n                          <kbd>l</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Previous author</Trans>\n                        </td>\n                        <td>\n                          <kbd>h</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Open post details</Trans>\n                        </td>\n                        <td>\n                          <kbd>Enter</kbd>\n                        </td>\n                      </tr>\n                      <tr>\n                        <td>\n                          <Trans>Scroll to top</Trans>\n                        </td>\n                        <td>\n                          <kbd>.</kbd>\n                        </td>\n                      </tr>\n                    </tbody>\n                  </table>\n                </dd>\n              </dl>\n            </main>\n          </div>\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nconst PostLine = memo(\n  function ({ post }) {\n    const {\n      id,\n      account,\n      group,\n      reblog,\n      quote,\n      inReplyToId,\n      inReplyToAccountId,\n      _followedTags: isFollowedTags,\n      _filtered: filterInfo,\n      visibility,\n      __BOOSTERS,\n    } = post;\n    const isReplyTo = inReplyToId && inReplyToAccountId !== account.id;\n    const isFiltered = !!filterInfo && filterInfo?.action !== 'blur';\n\n    const debugHover = (e) => {\n      if (e.shiftKey) {\n        console.log({\n          ...post,\n        });\n      }\n    };\n\n    return (\n      <article\n        class={`post-line ${\n          group\n            ? 'group'\n            : reblog\n              ? 'reblog'\n              : supportsNativeQuote() && hasQuote(quote)\n                ? 'quote'\n                : isFollowedTags?.length\n                  ? 'followed-tags'\n                  : ''\n        } ${isReplyTo ? 'reply-to' : ''} ${\n          isFiltered ? 'filtered' : ''\n        } visibility-${visibility}`}\n        onMouseEnter={debugHover}\n      >\n        <span class=\"post-author\">\n          {reblog ? (\n            <span class=\"post-reblog-avatar\">\n              <Avatar\n                url={account.avatarStatic || account.avatar}\n                squircle={account.bot}\n              />\n              {__BOOSTERS?.size > 0\n                ? [...__BOOSTERS].map((b) => (\n                    <Avatar url={b.avatarStatic || b.avatar} squircle={b.bot} />\n                  ))\n                : ''}{' '}\n              <Icon icon=\"rocket\" />{' '}\n              {/* <Avatar\n              url={reblog.account.avatarStatic || reblog.account.avatar}\n              squircle={reblog.account.bot}\n            /> */}\n              <NameText account={reblog.account} showAvatar />\n            </span>\n          ) : hasQuote(quote) ? (\n            <span class=\"post-quote-avatar\">\n              <Avatar\n                url={account.avatarStatic || account.avatar}\n                squircle={account.bot}\n              />{' '}\n              <Icon icon=\"quote\" />{' '}\n              <NameText\n                account={quote.quotedStatus?.account || quote.account}\n                showAvatar\n              />\n            </span>\n          ) : (\n            <NameText account={account} showAvatar />\n          )}\n        </span>\n        <PostPeek post={reblog || post} filterInfo={filterInfo} />\n        <span class=\"post-meta\">\n          <PostStats post={reblog || post} />{' '}\n          <RelativeTime\n            datetime={new Date(reblog?.createdAt || post.createdAt)}\n            format=\"micro\"\n          />\n        </span>\n      </article>\n    );\n  },\n  (oldProps, newProps) => {\n    return oldProps?.post?.id === newProps?.post?.id;\n  },\n);\n\nconst IntersectionPostLineItem = ({ root, to, ...props }) => {\n  const ref = useRef();\n  const [show, setShow] = useState(false);\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      (entries) => {\n        const entry = entries[0];\n        if (entry.isIntersecting) {\n          queueMicrotask(() => setShow(true));\n          observer.unobserve(ref.current);\n        }\n      },\n      {\n        root,\n        rootMargin: `${Math.max(320, screen.height * 0.75)}px`,\n      },\n    );\n    if (ref.current) observer.observe(ref.current);\n    return () => {\n      if (ref.current) observer.unobserve(ref.current);\n    };\n  }, []);\n\n  return show ? (\n    <li>\n      <Link to={to}>\n        <PostLine {...props} />\n      </Link>\n    </li>\n  ) : (\n    <li ref={ref} style={{ height: '4em' }} />\n  );\n};\n\n// A media speak a thousand words\nconst MEDIA_DENSITY = 8;\nconst CARD_DENSITY = 8;\nfunction postDensity(post) {\n  const { spoilerText, content, poll, mediaAttachments, card } = post;\n  const pollContent = poll?.options?.length\n    ? poll.options.reduce((acc, cur) => acc + cur.title, '')\n    : '';\n  const density =\n    (spoilerText.length + htmlContentLength(content) + pollContent.length) /\n      140 +\n    (mediaAttachments?.length\n      ? MEDIA_DENSITY * mediaAttachments.length\n      : card?.image\n        ? CARD_DENSITY\n        : 0);\n  return density;\n}\n\nconst MEDIA_SIZE = 48;\n\nfunction PostPeek({ post, filterInfo }) {\n  const { t } = useLingui();\n  let {\n    spoilerText,\n    sensitive,\n    content,\n    emojis,\n    poll,\n    mediaAttachments,\n    card,\n    inReplyToId,\n    inReplyToAccountId,\n    account,\n    _thread,\n    quote,\n  } = post;\n  const isThread =\n    (inReplyToId && inReplyToAccountId === account.id) || !!_thread;\n  let theQuote =\n    supportsNativeQuote() && hasQuote(quote)\n      ? quote.quotedStatus || quote\n      : null;\n  if (theQuote?.spoilerText || theQuote?.sensitive) theQuote = null;\n  if (theQuote?.emojis) emojis.push(...theQuote.emojis);\n  if (!mediaAttachments?.length && theQuote?.mediaAttachments?.length) {\n    mediaAttachments = theQuote.mediaAttachments;\n  }\n\n  const prefs = getPreferences();\n  const readingExpandSpoilers = !!prefs['reading:expand:spoilers'];\n  // const readingExpandSpoilers = true;\n  const showMedia =\n    readingExpandSpoilers ||\n    (!spoilerText && !sensitive && filterInfo?.action !== 'blur');\n  const postText = content ? statusPeek(post) : '';\n\n  const showPostContent = !spoilerText || readingExpandSpoilers;\n\n  return (\n    <div class=\"post-peek\" title={!spoilerText ? postText : ''}>\n      <span class=\"post-peek-content\">\n        {isThread && !showPostContent && (\n          <>\n            <span class=\"post-peek-tag post-peek-thread\">Thread</span>{' '}\n          </>\n        )}\n        {!!filterInfo && filterInfo?.action !== 'blur' ? (\n          <span class=\"post-peek-filtered\">\n            {/* Filtered{filterInfo?.titlesStr ? `: ${filterInfo.titlesStr}` : ''} */}\n            {filterInfo?.titlesStr\n              ? t`Filtered: ${filterInfo.titlesStr}`\n              : t`Filtered`}\n          </span>\n        ) : (\n          <>\n            {!!spoilerText && (\n              <span class=\"post-peek-spoiler\">\n                <Icon\n                  icon={`${readingExpandSpoilers ? 'eye-open' : 'eye-close'}`}\n                />{' '}\n                {spoilerText}\n              </span>\n            )}\n            {showPostContent && (\n              <div class=\"post-peek-html\">\n                {isThread && (\n                  <>\n                    <span class=\"post-peek-tag post-peek-thread\">\n                      <Trans>Thread</Trans>\n                    </span>{' '}\n                  </>\n                )}\n                {!!content && (\n                  <div\n                    dangerouslySetInnerHTML={{\n                      __html:\n                        emojifyText(content, emojis) +\n                        (!!theQuote?.content\n                          ? `<blockquote class=\"post-peek-quote\">${theQuote.content}</blockquote>`\n                          : ''),\n                    }}\n                  />\n                )}\n                {!!poll?.options?.length &&\n                  poll.options.map((o) => (\n                    <div>\n                      {poll.multiple ? '' : ''} {o.title}\n                    </div>\n                  ))}\n                {!content &&\n                  mediaAttachments?.length === 1 &&\n                  mediaAttachments[0].description && (\n                    <>\n                      <span class=\"post-peek-tag post-peek-alt\">ALT</span>{' '}\n                      <div>{mediaAttachments[0].description}</div>\n                    </>\n                  )}\n              </div>\n            )}\n          </>\n        )}\n      </span>\n      {(!filterInfo || filterInfo?.action === 'blur') && (\n        <span class=\"post-peek-post-content\">\n          {!!poll && (\n            <span class=\"post-peek-tag post-peek-poll\">\n              <Icon icon=\"poll\" size=\"s\" />\n              <Trans>Poll</Trans>\n            </span>\n          )}\n          {!!mediaAttachments?.length\n            ? mediaAttachments.map((m) => {\n                const mediaURL = m.previewUrl || m.url;\n                const remoteMediaURL = m.previewRemoteUrl || m.remoteUrl;\n                const width = m.meta?.original\n                  ? m.meta.original.width\n                  : m.meta?.small?.width || m.meta?.original?.width;\n                const height = m.meta?.original\n                  ? m.meta.original.height\n                  : m.meta?.small?.height || m.meta?.original?.height;\n                return (\n                  <span key={m.id} class=\"post-peek-media\">\n                    {{\n                      image:\n                        (mediaURL || remoteMediaURL) && showMedia ? (\n                          <img\n                            src={mediaURL}\n                            width={MEDIA_SIZE}\n                            height={MEDIA_SIZE}\n                            alt={m.description}\n                            loading=\"lazy\"\n                            onError={(e) => {\n                              const { src } = e.target;\n                              if (\n                                src === mediaURL &&\n                                remoteMediaURL &&\n                                mediaURL !== remoteMediaURL\n                              ) {\n                                e.target.src = remoteMediaURL;\n                              }\n                            }}\n                            style={{\n                              '--anim-duration': `${Math.min(\n                                Math.max(Math.max(width, height) / 100, 5),\n                                120,\n                              )}s`,\n                            }}\n                          />\n                        ) : (\n                          <span class=\"post-peek-faux-media\"></span>\n                        ),\n                      gifv:\n                        (mediaURL || remoteMediaURL) && showMedia ? (\n                          <img\n                            src={mediaURL}\n                            width={MEDIA_SIZE}\n                            height={MEDIA_SIZE}\n                            alt={m.description}\n                            loading=\"lazy\"\n                            onError={(e) => {\n                              const { src } = e.target;\n                              if (\n                                src === mediaURL &&\n                                remoteMediaURL &&\n                                mediaURL !== remoteMediaURL\n                              ) {\n                                e.target.src = remoteMediaURL;\n                              }\n                            }}\n                          />\n                        ) : (\n                          <span class=\"post-peek-faux-media\"></span>\n                        ),\n                      video:\n                        (mediaURL || remoteMediaURL) && showMedia ? (\n                          <img\n                            src={mediaURL}\n                            width={MEDIA_SIZE}\n                            height={MEDIA_SIZE}\n                            alt={m.description}\n                            loading=\"lazy\"\n                            onError={(e) => {\n                              const { src } = e.target;\n                              if (\n                                src === mediaURL &&\n                                remoteMediaURL &&\n                                mediaURL !== remoteMediaURL\n                              ) {\n                                e.target.src = remoteMediaURL;\n                              }\n                            }}\n                          />\n                        ) : (\n                          <span class=\"post-peek-faux-media\"></span>\n                        ),\n                      audio: <span class=\"post-peek-faux-media\"></span>,\n                    }[m.type] || null}\n                  </span>\n                );\n              })\n            : !!card &&\n              card.image &&\n              showMedia && (\n                <span\n                  class={`post-peek-media post-peek-card card-${\n                    card.type || ''\n                  }`}\n                >\n                  {card.image ? (\n                    <img\n                      src={card.image}\n                      width={MEDIA_SIZE}\n                      height={MEDIA_SIZE}\n                      alt={\n                        card.title || card.description || card.imageDescription\n                      }\n                      loading=\"lazy\"\n                      style={{\n                        '--anim-duration':\n                          card.width &&\n                          card.height &&\n                          `${Math.min(\n                            Math.max(\n                              Math.max(card.width, card.height) / 100,\n                              5,\n                            ),\n                            120,\n                          )}s`,\n                      }}\n                    />\n                  ) : (\n                    <span class=\"post-peek-faux-media\"></span>\n                  )}\n                </span>\n              )}\n        </span>\n      )}\n    </div>\n  );\n}\n\nfunction PostStats({ post }) {\n  const { t } = useLingui();\n  const { reblogsCount, repliesCount, favouritesCount, quotesCount } = post;\n  return (\n    <span class=\"post-stats\">\n      {repliesCount > 0 && (\n        <span class=\"post-stat-replies\">\n          <Icon icon=\"comment2\" size=\"s\" alt={t`Replies`} />{' '}\n          {shortenNumber(repliesCount)}\n        </span>\n      )}\n      {favouritesCount > 0 && (\n        <span class=\"post-stat-likes\">\n          <Icon icon=\"heart\" size=\"s\" alt={t`Likes`} />{' '}\n          {shortenNumber(favouritesCount)}\n        </span>\n      )}\n      {reblogsCount > 0 || quotesCount > 0 ? (\n        <span class=\"post-stat-boosts\">\n          <Icon icon=\"rocket\" size=\"s\" alt={t`Boosts`} />{' '}\n          {reblogsCount > 0 || quotesCount > 0\n            ? `${reblogsCount > 0 ? shortenNumber(reblogsCount) : ''}${\n                reblogsCount > 0 && quotesCount > 0 ? '+' : ''\n              }${quotesCount > 0 ? shortenNumber(quotesCount) : ''}`\n            : shortenNumber(reblogsCount)}\n        </span>\n      ) : null}\n    </span>\n  );\n}\n\nfunction binByTime(data, key, numBins) {\n  // Extract dates from data objects\n  const dates = data.map((item) => new Date(item[key]));\n\n  // Find minimum and maximum dates directly (avoiding Math.min/max)\n  const minDate = dates.reduce(\n    (acc, date) => (date < acc ? date : acc),\n    dates[0],\n  );\n  const maxDate = dates.reduce(\n    (acc, date) => (date > acc ? date : acc),\n    dates[0],\n  );\n\n  // Calculate the time span in milliseconds\n  const range = Math.min(maxDate.getTime(), Date.now()) - minDate.getTime();\n\n  // Create empty bins and loop through data\n  const bins = Array.from({ length: numBins }, () => []);\n  data.forEach((item) => {\n    const dateTime = Date.parse(item[key]);\n    if (dateTime > Date.now()) {\n      // Future dates go into the last bin\n      bins[bins.length - 1].push(item);\n    } else {\n      const normalized = (dateTime - minDate.getTime()) / range;\n      const binIndex = Math.floor(normalized * (numBins - 1));\n      bins[binIndex].push(item);\n    }\n  });\n\n  return bins;\n}\n\nexport default Catchup;\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useRef } from 'preact/hooks';\n\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Favourites() {\n  const { t } = useLingui();\n  useTitle(t`Likes`, '/favourites');\n  const { masto, instance } = api();\n  const favouritesIterator = useRef();\n  async function fetchFavourites(firstLoad) {\n    if (firstLoad || !favouritesIterator.current) {\n      favouritesIterator.current = masto.v1.favourites\n        .list({ limit: LIMIT })\n        .values();\n    }\n    return await favouritesIterator.current.next();\n  }\n\n  return (\n    <Timeline\n      title={t`Likes`}\n      id=\"favourites\"\n      emptyText={t`No likes yet. Go like something!`}\n      errorText={t`Unable to load likes.`}\n      instance={instance}\n      fetchItems={fetchFavourites}\n    />\n  );\n}\n\nexport default Favourites;\n","import './filters.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useReducer, useRef, useState } from 'preact/hooks';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport MenuConfirm from '../components/menu-confirm';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport RelativeTime from '../components/relative-time';\nimport { api } from '../utils/api';\nimport i18nDuration from '../utils/i18n-duration';\nimport { getAPIVersions } from '../utils/store-utils';\nimport useInterval from '../utils/useInterval';\nimport useTitle from '../utils/useTitle';\n\nconst FILTER_CONTEXT = ['home', 'public', 'notifications', 'thread', 'account'];\nconst FILTER_CONTEXT_UNIMPLEMENTED = ['thread', 'account'];\nconst FILTER_CONTEXT_LABELS = {\n  home: msg`Home and lists`,\n  notifications: msg`Notifications`,\n  public: msg`Public timelines`,\n  thread: msg`Conversations`,\n  account: msg`Profiles`,\n};\n\nconst EXPIRY_DURATIONS = [\n  0, // forever\n  30 * 60, // 30 minutes\n  60 * 60, // 1 hour\n  6 * 60 * 60, // 6 hours\n  12 * 60 * 60, // 12 hours\n  60 * 60 * 24, // 24 hours\n  60 * 60 * 24 * 7, // 7 days\n  60 * 60 * 24 * 30, // 30 days\n];\n\nconst EXPIRY_DURATIONS_LABELS = {\n  0: msg`Never`,\n  1800: i18nDuration(30, 'minute'),\n  3600: i18nDuration(1, 'hour'),\n  21600: i18nDuration(6, 'hour'),\n  43200: i18nDuration(12, 'hour'),\n  86_400: i18nDuration(24, 'hour'),\n  604_800: i18nDuration(7, 'day'),\n  2_592_000: i18nDuration(30, 'day'),\n};\n\nfunction Filters() {\n  const { t } = useLingui();\n  const { masto } = api();\n  useTitle(t`Filters`, `/ft`);\n  const [uiState, setUIState] = useState('default');\n  const [showFiltersAddEditModal, setShowFiltersAddEditModal] = useState(false);\n\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n  const [filters, setFilters] = useState([]);\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const filters = await masto.v2.filters.list();\n        filters.sort((a, b) => a.title.localeCompare(b.title));\n        filters.forEach((filter) => {\n          if (filter.keywords?.length) {\n            filter.keywords.sort((a, b) => a.id - b.id);\n          }\n        });\n        console.log(filters);\n        setFilters(filters);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  return (\n    <div id=\"filters-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Filters</Trans>\n            </h1>\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain\"\n                onClick={() => {\n                  setShowFiltersAddEditModal(true);\n                }}\n              >\n                <Icon icon=\"plus\" size=\"l\" alt={t`New filter`} />\n              </button>\n            </div>\n          </div>\n        </header>\n        <main>\n          {filters.length > 0 ? (\n            <>\n              <ul class=\"filters-list\">\n                {filters.map((filter) => {\n                  const { id, title, expiresAt, keywords } = filter;\n                  return (\n                    <li key={id}>\n                      <div>\n                        <h2>{title}</h2>\n                        {keywords?.length > 0 && (\n                          <div>\n                            {keywords.map((k) => (\n                              <>\n                                <span class=\"tag collapsed insignificant\">\n                                  {k.wholeWord ? `${k.keyword}` : k.keyword}\n                                </span>{' '}\n                              </>\n                            ))}\n                          </div>\n                        )}\n                        <small class=\"insignificant\">\n                          <ExpiryStatus expiresAt={expiresAt} />\n                        </small>\n                      </div>\n                      <button\n                        type=\"button\"\n                        class=\"plain\"\n                        onClick={() => {\n                          setShowFiltersAddEditModal({\n                            filter,\n                          });\n                        }}\n                      >\n                        <Icon icon=\"pencil\" size=\"l\" alt=\"Edit filter\" />\n                      </button>\n                    </li>\n                  );\n                })}\n              </ul>\n              {filters.length > 1 && (\n                <footer class=\"ui-state\">\n                  <small class=\"insignificant\">\n                    <Plural\n                      value={filters.length}\n                      one=\"# filter\"\n                      other=\"# filters\"\n                    />\n                  </small>\n                </footer>\n              )}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader />\n            </p>\n          ) : uiState === 'error' ? (\n            <p class=\"ui-state\">\n              <Trans>Unable to load filters.</Trans>\n            </p>\n          ) : (\n            <p class=\"ui-state\">\n              <Trans>No filters yet.</Trans>\n            </p>\n          )}\n        </main>\n      </div>\n      {!!showFiltersAddEditModal && (\n        <Modal\n          title={t`Add filter`}\n          onClose={() => {\n            setShowFiltersAddEditModal(false);\n          }}\n        >\n          <FiltersAddEdit\n            filter={showFiltersAddEditModal?.filter}\n            onClose={(result) => {\n              if (result.state === 'success') {\n                reload();\n              }\n              setShowFiltersAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nlet _id = 1;\nconst incID = () => _id++;\nfunction FiltersAddEdit({ filter, onClose }) {\n  const { _, t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const editMode = !!filter;\n  const { context, expiresAt, id, keywords, title, filterAction } =\n    filter || {};\n  const hasExpiry = !!expiresAt;\n  const expiresAtDate = hasExpiry && new Date(expiresAt);\n  const [editKeywords, setEditKeywords] = useState(keywords || []);\n  const keywordsRef = useRef();\n\n  // Hacky way of handling removed keywords for both existing and new ones\n  const [removedKeywordIDs, setRemovedKeywordIDs] = useState([]);\n  const [removedKeyword_IDs, setRemovedKeyword_IDs] = useState([]);\n\n  const filteredEditKeywords = editKeywords.filter(\n    (k) =>\n      !removedKeywordIDs.includes(k.id) && !removedKeyword_IDs.includes(k._id),\n  );\n\n  return (\n    <div class=\"sheet\" id=\"filters-add-edit-modal\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>{editMode ? t`Edit filter` : t`New filter`}</h2>\n      </header>\n      <main>\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            const formData = new FormData(e.target);\n            const title = formData.get('title');\n            const keywordIDs = formData.getAll('keyword_attributes[][id]');\n            const keywordKeywords = formData.getAll(\n              'keyword_attributes[][keyword]',\n            );\n            // const keywordWholeWords = formData.getAll(\n            //   'keyword_attributes[][whole_word]',\n            // );\n            // Not using getAll because it skips the empty checkboxes\n            const keywordWholeWords = [\n              ...keywordsRef.current.querySelectorAll(\n                'input[name=\"keyword_attributes[][whole_word]\"]',\n              ),\n            ].map((i) => i.checked);\n            const keywordsAttributes = keywordKeywords.map((k, i) => ({\n              id: keywordIDs[i] || undefined,\n              keyword: k,\n              wholeWord: keywordWholeWords[i],\n            }));\n            // if (editMode && keywords?.length) {\n            //   // Find which one got deleted and add to keywordsAttributes\n            //   keywords.forEach((k) => {\n            //     if (!keywordsAttributes.find((ka) => ka.id === k.id)) {\n            //       keywordsAttributes.push({\n            //         ...k,\n            //         _destroy: true,\n            //       });\n            //     }\n            //   });\n            // }\n            if (editMode && removedKeywordIDs?.length) {\n              removedKeywordIDs.forEach((id) => {\n                keywordsAttributes.push({\n                  id,\n                  _destroy: true,\n                });\n              });\n            }\n            const context = formData.getAll('context');\n            let expiresIn = formData.get('expires_in');\n            const filterAction = formData.get('filter_action');\n            console.log({\n              title,\n              keywordIDs,\n              keywords: keywordKeywords,\n              wholeWords: keywordWholeWords,\n              keywordsAttributes,\n              context,\n              expiresIn,\n              filterAction,\n            });\n\n            // Required fields\n            if (!title || !context?.length) {\n              return;\n            }\n\n            setUIState('loading');\n\n            (async () => {\n              try {\n                let filterResult;\n\n                if (editMode) {\n                  if (expiresIn === '' || expiresIn === null) {\n                    // No value\n                    // Preserve existing expiry if not specified\n                    // Seconds from now to expiresAtDate\n                    // Other clients don't do this\n                    if (hasExpiry) {\n                      expiresIn = Math.floor(\n                        (expiresAtDate - Date.now()) / 1000,\n                      );\n                    } else {\n                      expiresIn = null;\n                    }\n                  } else if (expiresIn === '0' || expiresIn === 0) {\n                    // 0 = Never\n                    expiresIn = null;\n                  } else {\n                    expiresIn = +expiresIn;\n                  }\n                  filterResult = await masto.v2.filters.$select(id).update({\n                    title,\n                    context,\n                    expiresIn,\n                    keywordsAttributes,\n                    filterAction,\n                  });\n                } else {\n                  expiresIn = +expiresIn || null;\n                  filterResult = await masto.v2.filters.create({\n                    title,\n                    context,\n                    expiresIn,\n                    keywordsAttributes,\n                    filterAction,\n                  });\n                }\n                console.log({ filterResult });\n                setUIState('default');\n                onClose?.({\n                  state: 'success',\n                  filter: filterResult,\n                });\n              } catch (error) {\n                console.error(error);\n                setUIState('error');\n                alert(\n                  editMode\n                    ? t`Unable to edit filter`\n                    : t`Unable to create filter`,\n                );\n              }\n            })();\n          }}\n        >\n          <div class=\"filter-form-row\">\n            <label>\n              <b>\n                <Trans>Title</Trans>\n              </b>\n              <input\n                type=\"text\"\n                name=\"title\"\n                defaultValue={title}\n                disabled={uiState === 'loading'}\n                dir=\"auto\"\n                enterKeyHint=\"done\"\n                required\n              />\n            </label>\n          </div>\n          <div class=\"filter-form-keywords\" ref={keywordsRef}>\n            {filteredEditKeywords.length ? (\n              <ul class=\"filter-keywords\">\n                {filteredEditKeywords.map((k) => {\n                  const { id, keyword, wholeWord, _id } = k;\n                  return (\n                    <li key={`${id}-${_id}`}>\n                      <input\n                        type=\"hidden\"\n                        name=\"keyword_attributes[][id]\"\n                        value={id}\n                      />\n                      <input\n                        name=\"keyword_attributes[][keyword]\"\n                        type=\"text\"\n                        defaultValue={keyword}\n                        disabled={uiState === 'loading'}\n                        required\n                        dir=\"auto\"\n                        enterKeyHint=\"done\"\n                      />\n                      <div class=\"filter-keyword-actions\">\n                        <label>\n                          <input\n                            name=\"keyword_attributes[][whole_word]\"\n                            type=\"checkbox\"\n                            value={id} // Hacky way to map checkbox boolean to the keyword id\n                            defaultChecked={wholeWord}\n                            disabled={uiState === 'loading'}\n                          />{' '}\n                          <Trans>Whole word</Trans>\n                        </label>\n                        <button\n                          type=\"button\"\n                          class=\"light danger small\"\n                          disabled={uiState === 'loading'}\n                          onClick={() => {\n                            if (id) {\n                              removedKeywordIDs.push(id);\n                              setRemovedKeywordIDs([...removedKeywordIDs]);\n                            } else if (_id) {\n                              removedKeyword_IDs.push(_id);\n                              setRemovedKeyword_IDs([...removedKeyword_IDs]);\n                            }\n                          }}\n                        >\n                          <Icon icon=\"x\" alt={t`Remove`} />\n                        </button>\n                      </div>\n                    </li>\n                  );\n                })}\n              </ul>\n            ) : (\n              <div class=\"filter-keywords\">\n                <div class=\"insignificant\">\n                  <Trans>No keywords. Add one.</Trans>\n                </div>\n              </div>\n            )}\n            <footer class=\"filter-keywords-footer\">\n              <button\n                type=\"button\"\n                class=\"light\"\n                onClick={() => {\n                  setEditKeywords([\n                    ...editKeywords,\n                    {\n                      _id: incID(),\n                      keyword: '',\n                      wholeWord: true,\n                    },\n                  ]);\n                  setTimeout(() => {\n                    // Focus last input\n                    const fields =\n                      keywordsRef.current.querySelectorAll(\n                        'input[type=\"text\"]',\n                      );\n                    fields[fields.length - 1]?.focus?.();\n                  }, 10);\n                }}\n              >\n                <Trans>Add keyword</Trans>\n              </button>{' '}\n              {filteredEditKeywords?.length > 1 && (\n                <small class=\"insignificant\">\n                  <Plural\n                    value={filteredEditKeywords.length}\n                    one=\"# keyword\"\n                    other=\"# keywords\"\n                  />\n                </small>\n              )}\n            </footer>\n          </div>\n          <div class=\"filter-form-cols\">\n            <div class=\"filter-form-col\">\n              <div>\n                <b>\n                  <Trans>Filter from</Trans>\n                </b>\n              </div>\n              {FILTER_CONTEXT.map((ctx) => (\n                <div>\n                  <label\n                    class={\n                      FILTER_CONTEXT_UNIMPLEMENTED.includes(ctx)\n                        ? 'insignificant'\n                        : ''\n                    }\n                  >\n                    <input\n                      type=\"checkbox\"\n                      name=\"context\"\n                      value={ctx}\n                      defaultChecked={!!context ? context.includes(ctx) : true}\n                      disabled={uiState === 'loading'}\n                    />{' '}\n                    {_(FILTER_CONTEXT_LABELS[ctx])}\n                    {FILTER_CONTEXT_UNIMPLEMENTED.includes(ctx) ? '*' : ''}\n                  </label>{' '}\n                </div>\n              ))}\n              <p>\n                <small class=\"insignificant\">\n                  <Trans>* Not implemented yet</Trans>\n                </small>\n              </p>\n            </div>\n            <div class=\"filter-form-col\">\n              {editMode && (\n                <Trans>\n                  Status:{' '}\n                  <b>\n                    <ExpiryStatus expiresAt={expiresAt} showNeverExpires />\n                  </b>\n                </Trans>\n              )}\n              <div>\n                <label for=\"filters-expires_in\">\n                  {editMode ? t`Change expiry` : t`Expiry`}\n                </label>\n                <select\n                  id=\"filters-expires_in\"\n                  name=\"expires_in\"\n                  disabled={uiState === 'loading'}\n                  defaultValue={editMode ? undefined : 0}\n                >\n                  {editMode && <option></option>}\n                  {EXPIRY_DURATIONS.map((v) => (\n                    <option value={v}>\n                      {typeof EXPIRY_DURATIONS_LABELS[v] === 'function'\n                        ? EXPIRY_DURATIONS_LABELS[v]()\n                        : _(EXPIRY_DURATIONS_LABELS[v])}\n                    </option>\n                  ))}\n                </select>\n              </div>\n              <p>\n                <Trans>Filtered post will be</Trans>\n                <br />\n                {getAPIVersions()?.mastodon >= 5 && (\n                  <label class=\"ib\">\n                    <input\n                      type=\"radio\"\n                      name=\"filter_action\"\n                      value=\"blur\"\n                      defaultChecked={filterAction === 'blur'}\n                      disabled={uiState === 'loading'}\n                    />{' '}\n                    <Trans>obscured (media only)</Trans>\n                  </label>\n                )}{' '}\n                <label class=\"ib\">\n                  <input\n                    type=\"radio\"\n                    name=\"filter_action\"\n                    value=\"warn\"\n                    defaultChecked={\n                      (filterAction !== 'hide' && filterAction !== 'blur') ||\n                      !editMode\n                    }\n                    disabled={uiState === 'loading'}\n                  />{' '}\n                  <Trans>minimized</Trans>\n                </label>{' '}\n                <label class=\"ib\">\n                  <input\n                    type=\"radio\"\n                    name=\"filter_action\"\n                    value=\"hide\"\n                    defaultChecked={filterAction === 'hide'}\n                    disabled={uiState === 'loading'}\n                  />{' '}\n                  <Trans>hidden</Trans>\n                </label>\n              </p>\n            </div>\n          </div>\n          <footer class=\"filter-form-footer\">\n            <span>\n              <button type=\"submit\" disabled={uiState === 'loading'}>\n                {editMode ? t`Save` : t`Create`}\n              </button>{' '}\n              <Loader abrupt hidden={uiState !== 'loading'} />\n            </span>\n            {editMode && (\n              <MenuConfirm\n                disabled={uiState === 'loading'}\n                align=\"end\"\n                menuItemClassName=\"danger\"\n                confirmLabel={t`Delete this filter?`}\n                onClick={() => {\n                  setUIState('loading');\n                  (async () => {\n                    try {\n                      await masto.v2.filters.$select(id).remove();\n                      setUIState('default');\n                      onClose?.({\n                        state: 'success',\n                      });\n                    } catch (e) {\n                      console.error(e);\n                      setUIState('error');\n                      alert(t`Unable to delete filter.`);\n                    }\n                  })();\n                }}\n              >\n                <button\n                  type=\"button\"\n                  class=\"light danger\"\n                  onClick={() => {}}\n                  disabled={uiState === 'loading'}\n                >\n                  <Trans>Delete</Trans>\n                </button>\n              </MenuConfirm>\n            )}\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n\nfunction ExpiryStatus({ expiresAt, showNeverExpires }) {\n  const { t } = useLingui();\n  const hasExpiry = !!expiresAt;\n  const expiresAtDate = hasExpiry && new Date(expiresAt);\n  const expired = hasExpiry && Date.parse(expiresAt) <= Date.now();\n\n  // If less than a minute left, re-render interval every second, else every minute\n  const [_, rerender] = useReducer((c) => c + 1, 0);\n  useInterval(rerender, expired || 30_000);\n\n  return expired ? (\n    t`Expired`\n  ) : hasExpiry ? (\n    <Trans>\n      Expiring <RelativeTime datetime={expiresAtDate} />\n    </Trans>\n  ) : (\n    showNeverExpires && t`Never expires`\n  );\n}\n\nexport default Filters;\n","import { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useState } from 'preact/hooks';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport NavMenu from '../components/nav-menu';\nimport { api } from '../utils/api';\nimport { fetchFollowedTags } from '../utils/followed-tags';\nimport useTitle from '../utils/useTitle';\n\nfunction FollowedHashtags() {\n  const { t } = useLingui();\n  const { masto, instance } = api();\n  useTitle(t`Followed Hashtags`, `/fh`);\n  const [uiState, setUIState] = useState('default');\n\n  const [followedHashtags, setFollowedHashtags] = useState([]);\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const tags = await fetchFollowedTags();\n        setFollowedHashtags(tags);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  return (\n    <div id=\"followed-hashtags-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Followed Hashtags</Trans>\n            </h1>\n            <div class=\"header-side\" />\n          </div>\n        </header>\n        <main>\n          {followedHashtags.length > 0 ? (\n            <>\n              <ul class=\"link-list\">\n                {followedHashtags.map((tag) => (\n                  <li>\n                    <Link\n                      to={\n                        instance\n                          ? `/${instance}/t/${tag.name}`\n                          : `/t/${tag.name}`\n                      }\n                    >\n                      <Icon icon=\"hashtag\" alt=\"#\" /> <span>{tag.name}</span>\n                    </Link>\n                  </li>\n                ))}\n              </ul>\n              {followedHashtags.length > 1 && (\n                <footer class=\"ui-state\">\n                  <small class=\"insignificant\">\n                    <Plural\n                      value={followedHashtags.length}\n                      one=\"# hashtag\"\n                      other=\"# hashtags\"\n                    />\n                  </small>\n                </footer>\n              )}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader abrupt />\n            </p>\n          ) : uiState === 'error' ? (\n            <p class=\"ui-state\">\n              <Trans>Unable to load followed hashtags.</Trans>\n            </p>\n          ) : (\n            <p class=\"ui-state\">\n              <Trans>No hashtags followed yet.</Trans>\n            </p>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}\n\nexport default FollowedHashtags;\n","import { useLingui } from '@lingui/react/macro';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport states, { getStatus, saveStatus } from '../utils/states';\nimport supports from '../utils/supports';\nimport {\n  assignFollowedTags,\n  clearFollowedTagsState,\n  dedupeBoosts,\n} from '../utils/timeline-utils';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Following({ title, path, id, ...props }) {\n  const { t } = useLingui();\n  useTitle(\n    title ||\n      t({\n        id: 'following.title',\n        message: 'Following',\n      }),\n    path || '/following',\n  );\n  const { masto, streaming, instance, client } = api();\n  const [streamingClient, setStreamingClient] = useState(streaming);\n\n  const snapStates = useSnapshot(states);\n  const homeIterable = useRef();\n  const homeIterator = useRef();\n  const latestItem = useRef();\n\n  // Streaming only happens after instance is initialized\n  useEffect(() => {\n    if (!streaming && client?.onStreamingReady) {\n      client.onStreamingReady((streamingClient) => {\n        setStreamingClient(streamingClient);\n      });\n    }\n  }, [client]);\n  __BENCHMARK.end('time-to-following');\n\n  console.debug('RENDER Following', title, id);\n  const supportsPixelfed = supports('@pixelfed/home-include-reblogs');\n\n  async function fetchHome(firstLoad) {\n    if (firstLoad || !homeIterator.current) {\n      __BENCHMARK.start('fetch-home-first');\n      homeIterable.current = masto.v1.timelines.home.list({ limit: LIMIT });\n      homeIterator.current = homeIterable.current.values();\n    }\n    if (supportsPixelfed && homeIterable.current?.params) {\n      if (typeof homeIterable.current.params === 'string') {\n        homeIterable.current.params += '&include_reblogs=true';\n      } else {\n        homeIterable.current.params.include_reblogs = true;\n      }\n    }\n    const results = await homeIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      let latestItemChanged = false;\n      if (firstLoad) {\n        if (value[0].id !== latestItem.current) {\n          latestItemChanged = true;\n        }\n        latestItem.current = value[0].id;\n        console.log('First load', latestItem.current);\n      }\n\n      // value = filteredItems(value, 'home');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n      value = dedupeBoosts(value, instance);\n      if (firstLoad && latestItemChanged) clearFollowedTagsState();\n      setTimeout(() => {\n        assignFollowedTags(value, instance);\n      }, 100);\n\n      // ENFORCE sort by datetime (Latest first)\n      value.sort((a, b) => {\n        return Date.parse(b.createdAt) - Date.parse(a.createdAt);\n      });\n    }\n    __BENCHMARK.end('fetch-home-first');\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const opts = {\n        limit: 5,\n        since_id: latestItem.current,\n      };\n      if (supports('@pixelfed/home-include-reblogs')) {\n        opts.include_reblogs = true;\n      }\n      const results = await masto.v1.timelines.home.list(opts).values().next();\n      let { value } = results;\n      console.log('checkForUpdates', latestItem.current, value);\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        latestItem.current = value[0].id;\n        value = dedupeBoosts(value, instance);\n        value = filteredItems(value, 'home');\n        if (value.some((item) => !item.reblog)) {\n          return true;\n        }\n      }\n      return false;\n    } catch (e) {\n      console.error(e);\n      return false;\n    }\n  }\n\n  useEffect(() => {\n    let sub;\n    (async () => {\n      if (streamingClient) {\n        sub = streamingClient.user.subscribe();\n        console.log(' Streaming user', sub);\n        for await (const entry of sub) {\n          if (!sub) break;\n          if (entry.event === 'status.update') {\n            const status = entry.payload;\n            console.log(` Status ${status.id} updated`);\n            saveStatus(status, instance);\n          } else if (entry.event === 'delete') {\n            const statusID = entry.payload;\n            console.log(` Status ${statusID} deleted`);\n            // delete states.statuses[statusID];\n            const s = getStatus(statusID, instance);\n            if (s) s._deleted = true;\n          }\n        }\n        console.log(' Streaming user loop STOPPED');\n      }\n    })();\n    return () => {\n      sub?.unsubscribe?.();\n      sub = null;\n    };\n  }, [streamingClient]);\n\n  return (\n    <Timeline\n      title={title || t({ id: 'following.title', message: 'Following' })}\n      id={id || 'following'}\n      emptyText={t`Nothing to see here.`}\n      errorText={t`Unable to load posts.`}\n      instance={instance}\n      fetchItems={fetchHome}\n      checkForUpdates={checkForUpdates}\n      useItemID\n      boostsCarousel={snapStates.settings.boostsCarousel}\n      {...props}\n      // allowFilters\n      filterContext=\"home\"\n      showFollowedTags\n      showReplyParent\n    />\n  );\n}\n\nexport default Following;\n","import { plural } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport {\n  FocusableItem,\n  MenuDivider,\n  MenuGroup,\n  MenuHeader,\n  MenuItem,\n} from '@szhsin/react-menu';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useNavigate, useParams, useSearchParams } from 'react-router-dom';\n\nimport Icon from '../components/icon';\nimport MenuConfirm from '../components/menu-confirm';\nimport Menu2 from '../components/menu2';\nimport { SHORTCUTS_LIMIT } from '../components/shortcuts-settings';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport { isMediaFirstInstance } from '../utils/store-utils';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\n// Limit is 4 per \"mode\"\n// https://github.com/mastodon/mastodon/issues/15194\n// Hard-coded https://github.com/mastodon/mastodon/blob/19614ba2477f3d12468f5ec251ce1cc5f8c6210c/app/models/tag_feed.rb#L4\nconst TAGS_LIMIT_PER_MODE = 4;\nconst TOTAL_TAGS_LIMIT = TAGS_LIMIT_PER_MODE + 1;\n\nfunction Hashtags({ media: mediaView, columnMode, ...props }) {\n  const { t } = useLingui();\n  // const navigate = useNavigate();\n  let { hashtag, ...params } = columnMode ? {} : useParams();\n  if (props.hashtag) hashtag = props.hashtag;\n  let hashtags = hashtag.trim().split(/[\\s+]+/);\n  hashtags.sort();\n  hashtag = hashtags[0];\n  const [searchParams, setSearchParams] = useSearchParams();\n  const media = mediaView || !!searchParams.get('media');\n  const linkParams = media ? '?media=1' : '';\n\n  const { masto, instance, authenticated } = api({\n    instance: props?.instance || params.instance,\n  });\n  const {\n    masto: currentMasto,\n    instance: currentInstance,\n    authenticated: currentAuthenticated,\n  } = api();\n  const hashtagTitle = hashtags.map((t) => `#${t}`).join(' ');\n  const title = instance\n    ? media\n      ? t`${hashtagTitle} (Media only) on ${instance}`\n      : t`${hashtagTitle} on ${instance}`\n    : media\n      ? t`${hashtagTitle} (Media only)`\n      : t`${hashtagTitle}`;\n  useTitle(title, `/:instance?/t/:hashtag`);\n  const latestItem = useRef();\n\n  const mediaFirst = useMemo(() => isMediaFirstInstance(), []);\n\n  // const hashtagsIterator = useRef();\n  const maxID = useRef(undefined);\n  async function fetchHashtags(firstLoad) {\n    // if (firstLoad || !hashtagsIterator.current) {\n    //   hashtagsIterator.current = masto.v1.timelines.tag.$select(hashtag).list({\n    //     limit: LIMIT,\n    //     any: hashtags.slice(1),\n    //   }).values();\n    // }\n    // const results = await hashtagsIterator.current.next();\n\n    // NOTE: Temporary fix for listHashtag not persisting `any` in subsequent calls.\n    const results = await masto.v1.timelines.tag\n      .$select(hashtag)\n      .list({\n        limit: LIMIT,\n        any: hashtags.slice(1),\n        maxId: firstLoad ? undefined : maxID.current,\n        onlyMedia: media ? true : undefined,\n      })\n      .values()\n      .next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'public');\n      value.forEach((item) => {\n        saveStatus(item, instance, {\n          skipThreading: media || mediaFirst, // If media view, no need to form threads\n        });\n      });\n\n      maxID.current = value[value.length - 1].id;\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.timelines.tag\n        .$select(hashtag)\n        .list({\n          limit: 1,\n          any: hashtags.slice(1),\n          since_id: latestItem.current,\n          onlyMedia: media,\n        })\n        .values()\n        .next();\n      let { value } = results;\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        value = filteredItems(value, 'public');\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  const [followUIState, setFollowUIState] = useState('default');\n  const [info, setInfo] = useState();\n  // Get hashtag info\n  useEffect(() => {\n    (async () => {\n      try {\n        const info = await masto.v1.tags.$select(hashtag).fetch();\n        console.log(info);\n        setInfo(info);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [hashtag]);\n\n  const reachLimit = hashtags.length >= TOTAL_TAGS_LIMIT;\n\n  const [featuredUIState, setFeaturedUIState] = useState('default');\n  const [featuredTags, setFeaturedTags] = useState([]);\n  const [isFeaturedTag, setIsFeaturedTag] = useState(false);\n  useEffect(() => {\n    if (!authenticated) return;\n    (async () => {\n      try {\n        const featuredTags = await masto.v1.featuredTags.list();\n        setFeaturedTags(featuredTags);\n        setIsFeaturedTag(\n          featuredTags.some(\n            (tag) => tag.name.toLowerCase() === hashtag.toLowerCase(),\n          ),\n        );\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  return (\n    <>\n      <Timeline\n        key={instance + hashtagTitle}\n        title={title}\n        titleComponent={\n          !!instance && (\n            <h1 class=\"header-double-lines\">\n              <b dir=\"auto\">{hashtagTitle}</b>\n              <div>{instance}</div>\n            </h1>\n          )\n        }\n        id=\"hashtag\"\n        instance={instance}\n        emptyText={t`No one has posted anything with this tag yet.`}\n        errorText={t`Unable to load posts with this tag`}\n        fetchItems={fetchHashtags}\n        checkForUpdates={checkForUpdates}\n        useItemID\n        view={media || mediaFirst ? 'media' : undefined}\n        refresh={media}\n        // allowFilters\n        filterContext=\"public\"\n        headerEnd={\n          <Menu2\n            portal\n            setDownOverflow\n            overflow=\"auto\"\n            // viewScroll=\"close\"\n            position=\"anchor\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n          >\n            {!!info && hashtags.length === 1 && (\n              <>\n                <MenuConfirm\n                  subMenu\n                  confirm={info.following}\n                  confirmLabel={t`Unfollow #${hashtag}?`}\n                  disabled={followUIState === 'loading' || !authenticated}\n                  onClick={() => {\n                    setFollowUIState('loading');\n                    if (info.following) {\n                      // const yes = confirm(`Unfollow #${hashtag}?`);\n                      // if (!yes) {\n                      //   setFollowUIState('default');\n                      //   return;\n                      // }\n                      masto.v1.tags\n                        .$select(hashtag)\n                        .unfollow()\n                        .then(() => {\n                          setInfo({ ...info, following: false });\n                          showToast(t`Unfollowed #${hashtag}`);\n                        })\n                        .catch((e) => {\n                          alert(e);\n                          console.error(e);\n                        })\n                        .finally(() => {\n                          setFollowUIState('default');\n                        });\n                    } else {\n                      masto.v1.tags\n                        .$select(hashtag)\n                        .follow()\n                        .then(() => {\n                          setInfo({ ...info, following: true });\n                          showToast(t`Followed #${hashtag}`);\n                        })\n                        .catch((e) => {\n                          alert(e);\n                          console.error(e);\n                        })\n                        .finally(() => {\n                          setFollowUIState('default');\n                        });\n                    }\n                  }}\n                >\n                  {info.following ? (\n                    <>\n                      <Icon icon=\"check-circle\" />{' '}\n                      <span>\n                        <Trans>Following</Trans>\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <Icon icon=\"plus\" />{' '}\n                      <span>\n                        <Trans>Follow</Trans>\n                      </span>\n                    </>\n                  )}\n                </MenuConfirm>\n                <MenuItem\n                  type=\"checkbox\"\n                  checked={isFeaturedTag}\n                  disabled={featuredUIState === 'loading' || !authenticated}\n                  onClick={() => {\n                    setFeaturedUIState('loading');\n                    if (isFeaturedTag) {\n                      const featuredTagID = featuredTags.find(\n                        (tag) =>\n                          tag.name.toLowerCase() === hashtag.toLowerCase(),\n                      ).id;\n                      if (featuredTagID) {\n                        masto.v1.featuredTags\n                          .$select(featuredTagID)\n                          .remove()\n                          .then(() => {\n                            setIsFeaturedTag(false);\n                            showToast(t`Unfeatured on profile`);\n                            setFeaturedTags(\n                              featuredTags.filter(\n                                (tag) => tag.id !== featuredTagID,\n                              ),\n                            );\n                          })\n                          .catch((e) => {\n                            console.error(e);\n                          })\n                          .finally(() => {\n                            setFeaturedUIState('default');\n                          });\n                      } else {\n                        showToast(t`Unable to unfeature on profile`);\n                      }\n                    } else {\n                      masto.v1.featuredTags\n                        .create({\n                          name: hashtag,\n                        })\n                        .then((value) => {\n                          setIsFeaturedTag(true);\n                          showToast(t`Featured on profile`);\n                          setFeaturedTags(featuredTags.concat(value));\n                        })\n                        .catch((e) => {\n                          console.error(e);\n                        })\n                        .finally(() => {\n                          setFeaturedUIState('default');\n                        });\n                    }\n                  }}\n                >\n                  {isFeaturedTag ? (\n                    <>\n                      <Icon icon=\"check-circle\" />\n                      <span>\n                        <Trans>Featured on profile</Trans>\n                      </span>\n                    </>\n                  ) : (\n                    <>\n                      <Icon icon=\"check-circle\" />\n                      <span>\n                        <Trans>Feature on profile</Trans>\n                      </span>\n                    </>\n                  )}\n                </MenuItem>\n                <MenuDivider />\n              </>\n            )}\n            {!mediaFirst && (\n              <>\n                <MenuHeader className=\"plain\">\n                  <Trans>Filters</Trans>\n                </MenuHeader>\n                <MenuItem\n                  type=\"checkbox\"\n                  checked={!!media}\n                  onClick={() => {\n                    if (media) {\n                      searchParams.delete('media');\n                    } else {\n                      searchParams.set('media', '1');\n                    }\n                    setSearchParams(searchParams);\n                  }}\n                >\n                  <Icon icon=\"check-circle\" alt=\"\" />{' '}\n                  <span class=\"menu-grow\">\n                    <Trans>Media only</Trans>\n                  </span>\n                </MenuItem>\n                <MenuDivider />\n              </>\n            )}\n            <FocusableItem className=\"menu-field\" disabled={reachLimit}>\n              {({ ref }) => (\n                <form\n                  onSubmit={(e) => {\n                    e.preventDefault();\n                    const newHashtag = e.target[0].value?.trim?.();\n                    // Use includes but need to be case insensitive\n                    if (\n                      newHashtag &&\n                      !hashtags.some(\n                        (t) => t.toLowerCase() === newHashtag.toLowerCase(),\n                      )\n                    ) {\n                      hashtags.push(newHashtag);\n                      hashtags.sort();\n                      // navigate(\n                      //   instance\n                      //     ? `/${instance}/t/${hashtags.join('+')}`\n                      //     : `/t/${hashtags.join('+')}`,\n                      // );\n                      location.hash = instance\n                        ? `/${instance}/t/${hashtags.join('+')}${linkParams}`\n                        : `/t/${hashtags.join('+')}${linkParams}`;\n                    }\n                  }}\n                >\n                  <Icon icon=\"hashtag\" />\n                  <input\n                    ref={ref}\n                    type=\"text\"\n                    placeholder={\n                      reachLimit\n                        ? plural(TOTAL_TAGS_LIMIT, {\n                            other: 'Max # tags',\n                          })\n                        : t`Add hashtag`\n                    }\n                    required\n                    autocorrect=\"off\"\n                    autocapitalize=\"off\"\n                    spellCheck={false}\n                    // no spaces, no hashtags\n                    pattern=\"[^#][^\\s#]+[^#]\"\n                    disabled={reachLimit}\n                    dir=\"auto\"\n                    enterKeyHint=\"go\"\n                  />\n                </form>\n              )}\n            </FocusableItem>\n            <MenuGroup takeOverflow>\n              {hashtags.map((tag, i) => (\n                <MenuItem\n                  key={tag}\n                  disabled={hashtags.length === 1}\n                  onClick={(e) => {\n                    hashtags.splice(i, 1);\n                    hashtags.sort();\n                    // navigate(\n                    //   instance\n                    //     ? `/${instance}/t/${hashtags.join('+')}`\n                    //     : `/t/${hashtags.join('+')}`,\n                    // );\n                    location.hash = instance\n                      ? `/${instance}/t/${hashtags.join('+')}${linkParams}`\n                      : `/t/${hashtags.join('+')}${linkParams}`;\n                  }}\n                >\n                  <Icon icon=\"x\" alt={t`Remove hashtag`} class=\"danger-icon\" />\n                  <span class=\"bidi-isolate\">\n                    <span class=\"more-insignificant\">#</span>\n                    {tag}\n                  </span>\n                </MenuItem>\n              ))}\n            </MenuGroup>\n            <MenuDivider />\n            <MenuItem\n              disabled={!currentAuthenticated}\n              onClick={() => {\n                if (states.shortcuts.length >= SHORTCUTS_LIMIT) {\n                  alert(\n                    plural(SHORTCUTS_LIMIT, {\n                      one: 'Max # shortcut reached. Unable to add shortcut.',\n                      other: 'Max # shortcuts reached. Unable to add shortcut.',\n                    }),\n                  );\n                  return;\n                }\n                const shortcut = {\n                  type: 'hashtag',\n                  hashtag: hashtags.join(' '),\n                  instance,\n                  media: media ? 'on' : undefined,\n                };\n                // Check if already exists\n                const exists = states.shortcuts.some(\n                  (s) =>\n                    s.type === shortcut.type &&\n                    s.hashtag\n                      .split(/[\\s+]+/)\n                      .sort()\n                      .join(' ') ===\n                      shortcut.hashtag\n                        .split(/[\\s+]+/)\n                        .sort()\n                        .join(' ') &&\n                    (s.instance ? s.instance === shortcut.instance : true) &&\n                    (s.media ? !!s.media === !!shortcut.media : true),\n                );\n                if (exists) {\n                  alert(t`This shortcut already exists`);\n                } else {\n                  states.shortcuts.push(shortcut);\n                  showToast(t`Hashtag shortcut added`);\n                }\n              }}\n            >\n              <Icon icon=\"shortcut\" />{' '}\n              <span>\n                <Trans>Add to Shortcuts</Trans>\n              </span>\n            </MenuItem>\n            <MenuItem\n              onClick={() => {\n                let newInstance = prompt(\n                  t`Enter a new instance e.g. \"mastodon.social\"`,\n                );\n                if (!/\\./.test(newInstance)) {\n                  if (newInstance) alert(t`Invalid instance`);\n                  return;\n                }\n                if (newInstance) {\n                  newInstance = newInstance.toLowerCase().trim();\n                  // navigate(`/${newInstance}/t/${hashtags.join('+')}`);\n                  location.hash = `/${newInstance}/t/${hashtags.join(\n                    '+',\n                  )}${linkParams}`;\n                }\n              }}\n            >\n              <Icon icon=\"bus\" />{' '}\n              <span>\n                <Trans>Go to another instance</Trans>\n              </span>\n            </MenuItem>\n            {currentInstance !== instance && (\n              <MenuItem\n                onClick={() => {\n                  location.hash = `/${currentInstance}/t/${hashtags.join(\n                    '+',\n                  )}${linkParams}`;\n                }}\n              >\n                <Icon icon=\"bus\" />{' '}\n                <small class=\"menu-double-lines\">\n                  <Trans>\n                    Go to my instance (<b>{currentInstance}</b>)\n                  </Trans>\n                </small>\n              </MenuItem>\n            )}\n          </Menu2>\n        }\n      />\n      {!columnMode && !!hashtags?.length && (\n        <data\n          class=\"compose-data\"\n          value={JSON.stringify({\n            draftStatus: {\n              status: `${hashtags.length > 1 ? '\\n\\n' : ' '}${hashtagTitle}`,\n            },\n          })}\n        />\n      )}\n    </>\n  );\n}\n\nexport default Hashtags;\n","import './lists.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { Menu, MenuDivider, MenuHeader, MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { InView } from 'react-intersection-observer';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport AccountBlock from '../components/account-block';\nimport Icon from '../components/icon';\nimport ListAddEdit from '../components/list-add-edit';\nimport ListExclusiveBadge from '../components/list-exclusive-badge';\nimport MenuConfirm from '../components/menu-confirm';\nimport MenuLink from '../components/menu-link';\nimport Menu2 from '../components/menu2';\nimport Modal from '../components/modal';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport { getList, getLists } from '../utils/lists';\nimport states, { saveStatus } from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction List(props) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const { masto, instance } = api();\n  const id = props?.id || useParams()?.id;\n  // const navigate = useNavigate();\n  const latestItem = useRef();\n  // const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n\n  const listIterator = useRef();\n  async function fetchList(firstLoad) {\n    if (firstLoad || !listIterator.current) {\n      listIterator.current = masto.v1.timelines.list\n        .$select(id)\n        .list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await listIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'home');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.timelines.list.$select(id).list({\n        limit: 1,\n        since_id: latestItem.current,\n      });\n      let { value } = results;\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        value = filteredItems(value, 'home');\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  const [lists, setLists] = useState([]);\n\n  const [list, setList] = useState({ title: 'List' });\n  // const [title, setTitle] = useState(`List`);\n  useTitle(list.title, `/l/:id`);\n  useEffect(() => {\n    (async () => {\n      try {\n        const list = await getList(id);\n        setList(list);\n        // setTitle(list.title);\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [id]);\n\n  const [showListAddEditModal, setShowListAddEditModal] = useState(false);\n  const [showManageMembersModal, setShowManageMembersModal] = useState(false);\n\n  return (\n    <>\n      <Timeline\n        key={id}\n        title={list.title}\n        id=\"list\"\n        emptyText={t`Nothing yet.`}\n        errorText={t`Unable to load posts.`}\n        instance={instance}\n        fetchItems={fetchList}\n        checkForUpdates={checkForUpdates}\n        useItemID\n        boostsCarousel={snapStates.settings.boostsCarousel}\n        // allowFilters\n        filterContext=\"home\"\n        showReplyParent\n        // refresh={reloadCount}\n        headerStart={\n          // <Link to=\"/l\" class=\"button plain\">\n          //   <Icon icon=\"list\" size=\"l\" />\n          // </Link>\n          <Menu2\n            overflow=\"auto\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"list\" size=\"l\" alt={t`Lists`} />\n                <Icon icon=\"chevron-down\" size=\"s\" />\n              </button>\n            }\n            onMenuChange={(e) => {\n              if (e.open) {\n                getLists().then(setLists);\n              }\n            }}\n          >\n            <MenuLink to=\"/l\">\n              <span>\n                <Trans>All Lists</Trans>\n              </span>\n            </MenuLink>\n            {lists?.length > 0 && (\n              <>\n                <MenuDivider />\n                {lists.map((list) => (\n                  <MenuLink key={list.id} to={`/l/${list.id}`}>\n                    <span>\n                      {list.title}\n                      {list.exclusive && (\n                        <>\n                          {' '}\n                          <ListExclusiveBadge />\n                        </>\n                      )}\n                    </span>\n                  </MenuLink>\n                ))}\n              </>\n            )}\n          </Menu2>\n        }\n        headerEnd={\n          <Menu2\n            portal\n            setDownOverflow\n            overflow=\"auto\"\n            viewScroll=\"close\"\n            position=\"anchor\"\n            menuButton={\n              <button type=\"button\" class=\"plain\">\n                <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n              </button>\n            }\n          >\n            {list?.exclusive && (\n              <>\n                <MenuHeader className=\"plain\">\n                  <ListExclusiveBadge />{' '}\n                  <Trans>\n                    Posts on this list are hidden from Home/Following\n                  </Trans>\n                </MenuHeader>\n                <MenuDivider />\n              </>\n            )}\n            <MenuItem\n              onClick={() =>\n                setShowListAddEditModal({\n                  list,\n                })\n              }\n            >\n              <Icon icon=\"pencil\" size=\"l\" />\n              <span>\n                <Trans>Edit</Trans>\n              </span>\n            </MenuItem>\n            <MenuItem onClick={() => setShowManageMembersModal(true)}>\n              <Icon icon=\"group\" size=\"l\" />\n              <span>\n                <Trans>Manage members</Trans>\n              </span>\n            </MenuItem>\n          </Menu2>\n        }\n      />\n      {showListAddEditModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowListAddEditModal(false);\n            }\n          }}\n        >\n          <ListAddEdit\n            list={showListAddEditModal?.list}\n            onClose={(result) => {\n              if (result.state === 'success' && result.list) {\n                setList(result.list);\n                // reload();\n              } else if (result.state === 'deleted') {\n                // navigate('/l');\n                location.hash = '/l';\n              }\n              setShowListAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n      {showManageMembersModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowManageMembersModal(false);\n            }\n          }}\n        >\n          <ListManageMembers\n            listID={id}\n            onClose={() => setShowManageMembersModal(false)}\n          />\n        </Modal>\n      )}\n    </>\n  );\n}\n\nconst MEMBERS_LIMIT = 40;\n\nfunction ListManageMembers({ listID, onClose }) {\n  const { t } = useLingui();\n  // Show list of members with [Remove] button\n  // API only returns 40 members at a time, so this need to be paginated with infinite scroll\n  // Show [Add] button after removing a member\n  const { masto, instance } = api();\n  const [members, setMembers] = useState([]);\n  const [uiState, setUIState] = useState('default');\n  const [showMore, setShowMore] = useState(false);\n\n  const membersIterator = useRef();\n\n  async function fetchMembers(firstLoad) {\n    setShowMore(false);\n    setUIState('loading');\n    (async () => {\n      try {\n        if (firstLoad || !membersIterator.current) {\n          membersIterator.current = masto.v1.lists\n            .$select(listID)\n            .accounts.list({\n              limit: MEMBERS_LIMIT,\n            })\n            .values();\n        }\n        const results = await membersIterator.current.next();\n        let { done, value } = results;\n        if (value?.length) {\n          if (firstLoad) {\n            setMembers(value);\n          } else {\n            setMembers(members.concat(value));\n          }\n          setShowMore(!done);\n        } else {\n          setShowMore(false);\n        }\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n      }\n    })();\n  }\n\n  useEffect(() => {\n    fetchMembers(true);\n  }, []);\n\n  return (\n    <div class=\"sheet\" id=\"list-manage-members-container\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" alt={t`Close`} />\n        </button>\n      )}\n      <header>\n        <h2>\n          <Trans>Manage members</Trans>\n        </h2>\n      </header>\n      <main>\n        <ul>\n          {members.map((member) => (\n            <li key={member.id}>\n              <AccountBlock account={member} instance={instance} />\n              <RemoveAddButton account={member} listID={listID} />\n            </li>\n          ))}\n          {showMore && uiState === 'default' && (\n            <InView as=\"li\" onChange={(inView) => inView && fetchMembers()}>\n              <button type=\"button\" class=\"light block\" onClick={fetchMembers}>\n                <Trans>Show more</Trans>\n              </button>\n            </InView>\n          )}\n        </ul>\n      </main>\n    </div>\n  );\n}\n\nfunction RemoveAddButton({ account, listID }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [removed, setRemoved] = useState(false);\n\n  return (\n    <MenuConfirm\n      confirm={!removed}\n      confirmLabel={\n        <span>\n          <Trans>\n            Remove <span class=\"bidi-isolate\">@{account.username}</span> from\n            list?\n          </Trans>\n        </span>\n      }\n      align=\"end\"\n      menuItemClassName=\"danger\"\n      onClick={() => {\n        if (removed) {\n          setUIState('loading');\n          (async () => {\n            try {\n              await masto.v1.lists.$select(listID).accounts.create({\n                accountIds: [account.id],\n              });\n              setUIState('default');\n              setRemoved(false);\n            } catch (e) {\n              setUIState('error');\n            }\n          })();\n        } else {\n          // const yes = confirm(`Remove ${account.username} from this list?`);\n          // if (!yes) return;\n          setUIState('loading');\n\n          (async () => {\n            try {\n              await masto.v1.lists.$select(listID).accounts.remove({\n                accountIds: [account.id],\n              });\n              setUIState('default');\n              setRemoved(true);\n            } catch (e) {\n              setUIState('error');\n            }\n          })();\n        }\n      }}\n    >\n      <button\n        type=\"button\"\n        class={`light ${removed ? '' : 'danger'}`}\n        disabled={uiState === 'loading'}\n      >\n        {removed ? t`Add` : t`Remove`}\n      </button>\n    </MenuConfirm>\n  );\n}\n\nexport default List;\n","// This is like very lame \"type-checking\" lol\nconst notificationTypeKeys = {\n  mention: ['account', 'status'],\n  quote: ['account', 'status'],\n  status: ['account', 'status'],\n  reblog: ['account', 'status'],\n  follow: ['account'],\n  follow_request: ['account'],\n  favourite: ['account', 'status'],\n  poll: ['status'],\n  update: ['status'],\n};\n\nconst GROUP_TYPES = ['favourite', 'reblog', 'follow'];\nconst groupable = (type) => GROUP_TYPES.includes(type);\n\nexport function fixNotifications(notifications) {\n  return notifications.filter((notification) => {\n    const { type, id, createdAt } = notification;\n    if (!type) {\n      console.warn('Notification missing type', notification);\n      return false;\n    }\n    if (!id || !createdAt) {\n      console.warn('Notification missing id or createdAt', notification);\n      // Continue processing this despite missing id or createdAt\n    }\n    const keys = notificationTypeKeys[type];\n    if (keys?.length) {\n      return keys.every((key) => !!notification[key]);\n    }\n    return true; // skip other types\n  });\n}\n\nexport function massageNotifications2(notifications) {\n  if (notifications?.notificationGroups) {\n    const {\n      accounts = [],\n      notificationGroups = [],\n      statuses = [],\n    } = notifications;\n    return notificationGroups.map((group) => {\n      const { sampleAccountIds, statusId } = group;\n      const sampleAccounts =\n        sampleAccountIds?.map((id) => accounts.find((a) => a.id === id)) || [];\n      const status = statuses?.find((s) => s.id === statusId) || null;\n      return {\n        ...group,\n        sampleAccounts,\n        status,\n      };\n    });\n  }\n  return notifications;\n}\n\nexport function groupNotifications2(groupNotifications) {\n  // Make grouped notifications to look like faux grouped notifications\n  const newGroupNotifications = groupNotifications.map((gn) => {\n    const {\n      latestPageNotificationAt,\n      mostRecentNotificationId,\n      sampleAccounts,\n      notificationsCount,\n    } = gn;\n\n    return {\n      id: '' + mostRecentNotificationId,\n      createdAt: latestPageNotificationAt,\n      account: sampleAccounts[0],\n      ...gn,\n    };\n  });\n\n  // Merge favourited and reblogged of same status into a single notification\n  // - new type: \"favourite+reblog\"\n  // - sum numbers for `notificationsCount` and `sampleAccounts`\n  const notificationsMap = {};\n  const newGroupNotifications1 = [];\n  for (let i = 0; i < newGroupNotifications.length; i++) {\n    const gn = newGroupNotifications[i];\n    const {\n      type,\n      status,\n      createdAt,\n      notificationsCount,\n      sampleAccounts,\n      groupKey,\n    } = gn;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    let virtualType = type;\n    // const sameCount = notificationsCount > 0 && notificationsCount === sampleAccounts?.length;\n    // if (sameCount && (type === 'favourite' || type === 'reblog')) {\n    const sampleCountDiffNotificationsCount =\n      notificationsCount > 0 &&\n      sampleAccounts?.length > 0 &&\n      notificationsCount > sampleAccounts?.length;\n    if (\n      !sampleCountDiffNotificationsCount &&\n      (type === 'favourite' || type === 'reblog')\n    ) {\n      virtualType = 'favourite+reblog';\n    }\n    // const key = `${status?.id}-${virtualType}-${date}-${sameCount ? 1 : 0}`;\n    const key = `${status?.id}-${virtualType}-${date}`;\n    const mappedNotification = notificationsMap[key];\n    if (!groupable(type)) {\n      newGroupNotifications1.push(gn);\n    } else if (mappedNotification) {\n      // Merge sampleAccounts + merge _types\n      sampleAccounts.forEach((a) => {\n        const mappedAccount = mappedNotification.sampleAccounts.find(\n          (ma) => ma.id === a.id,\n        );\n        if (!mappedAccount) {\n          mappedNotification.sampleAccounts.push({\n            ...a,\n            _types: [type],\n          });\n        } else {\n          mappedAccount._types.push(type);\n          mappedAccount._types.sort().reverse();\n        }\n      });\n      // mappedNotification.notificationsCount =\n      //   mappedNotification.sampleAccounts.length;\n      mappedNotification.notificationsCount = Math.min(\n        mappedNotification.notificationsCount,\n        notificationsCount,\n      );\n      mappedNotification._notificationsCount.push(notificationsCount);\n      mappedNotification._sampleAccountsCount.push(sampleAccounts?.length);\n      mappedNotification._accounts = mappedNotification.sampleAccounts;\n      mappedNotification._groupKeys.push(groupKey);\n    } else {\n      const accounts = sampleAccounts.map((a) => ({\n        ...a,\n        _types: [type],\n      }));\n      notificationsMap[key] = {\n        ...gn,\n        sampleAccounts: accounts,\n        type: virtualType,\n        _accounts: accounts,\n        _groupKeys: groupKey ? [groupKey] : [],\n        _notificationsCount: [notificationsCount],\n        _sampleAccountsCount: [sampleAccounts?.length],\n      };\n      newGroupNotifications1.push(notificationsMap[key]);\n    }\n  }\n\n  // 2nd pass.\n  // - Group 1 account favourte/reblog multiple posts\n  // - _statuses: [status, status, ...]\n  const notificationsMap2 = {};\n  const newGroupNotifications2 = [];\n  for (let i = 0; i < newGroupNotifications1.length; i++) {\n    const gn = newGroupNotifications1[i];\n    const { type, account, _accounts, sampleAccounts, createdAt, groupKey } =\n      gn;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    const hasOneAccount =\n      sampleAccounts?.length === 1 || _accounts?.length === 1;\n    if (\n      (type === 'favourite' ||\n        type === 'reblog' ||\n        type === 'favourite+reblog') &&\n      hasOneAccount\n    ) {\n      const key = `${account?.id}-${type}-${date}`;\n      const mappedNotification = notificationsMap2[key];\n      if (mappedNotification) {\n        mappedNotification._statuses.push(gn.status);\n        mappedNotification._ids += `-${gn.id}`;\n        mappedNotification._groupKeys.push(groupKey);\n      } else {\n        let n = (notificationsMap2[key] = {\n          ...gn,\n          type,\n          _ids: gn.id,\n          _statuses: [gn.status],\n          _groupKeys: groupKey ? [groupKey] : [],\n        });\n        newGroupNotifications2.push(n);\n      }\n    } else {\n      newGroupNotifications2.push(gn);\n    }\n  }\n\n  console.log('newGroupNotifications2', newGroupNotifications2);\n\n  return newGroupNotifications2;\n}\n\nexport default function groupNotifications(notifications) {\n  // Filter out invalid notifications\n  notifications = fixNotifications(notifications);\n\n  // Create new flat list of notifications\n  // Combine sibling notifications based on type and status id\n  // Concat all notification.account into an array of _accounts\n  const notificationsMap = {};\n  const cleanNotifications = [];\n  for (let i = 0, j = 0; i < notifications.length; i++) {\n    const notification = notifications[i];\n    const { id, status, account, type, createdAt } = notification;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    let virtualType = type;\n    if (type === 'favourite' || type === 'reblog') {\n      virtualType = 'favourite+reblog';\n    }\n    const key = `${status?.id}-${virtualType}-${date}`;\n    const mappedNotification = notificationsMap[key];\n    if (!groupable(type)) {\n      cleanNotifications[j++] = notification;\n    } else if (mappedNotification?.account) {\n      const mappedAccount = mappedNotification._accounts.find(\n        (a) => a.id === account.id,\n      );\n      if (mappedAccount) {\n        mappedAccount._types.push(type);\n        mappedAccount._types.sort().reverse();\n        mappedNotification._ids += `-${id}`;\n      } else {\n        account._types = [type];\n        mappedNotification._accounts.push(account);\n        mappedNotification._ids += `-${id}`;\n      }\n    } else {\n      if (account) account._types = [type];\n      let n = (notificationsMap[key] = {\n        ...notification,\n        type: virtualType,\n        _ids: id,\n        _accounts: account ? [account] : [],\n      });\n      cleanNotifications[j++] = n;\n    }\n  }\n\n  // 2nd pass to group \"favourite+reblog\"-type notifications by account if _accounts.length <= 1\n  // This means one acount has favourited and reblogged the multiple statuses\n  // The grouped notification\n  // - type: \"favourite+reblog+account\"\n  // - _statuses: [status, status, ...]\n  const notificationsMap2 = {};\n  const cleanNotifications2 = [];\n  for (let i = 0, j = 0; i < cleanNotifications.length; i++) {\n    const notification = cleanNotifications[i];\n    const { id, account, _accounts, type, createdAt } = notification;\n    const date = createdAt ? new Date(createdAt).toLocaleDateString() : '';\n    if (type === 'favourite+reblog' && account && _accounts.length === 1) {\n      const key = `${account?.id}-${type}-${date}`;\n      const mappedNotification = notificationsMap2[key];\n      if (mappedNotification) {\n        mappedNotification._statuses.push(notification.status);\n        mappedNotification._ids += `-${id}`;\n      } else {\n        let n = (notificationsMap2[key] = {\n          ...notification,\n          type,\n          _ids: id,\n          _statuses: [notification.status],\n        });\n        cleanNotifications2[j++] = n;\n      }\n    } else {\n      cleanNotifications2[j++] = notification;\n    }\n  }\n\n  console.log({ notifications, cleanNotifications, cleanNotifications2 });\n\n  // return cleanNotifications;\n  return cleanNotifications2;\n}\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { useMemo, useRef, useState } from 'preact/hooks';\nimport { useSearchParams } from 'react-router-dom';\n\nimport Link from '../components/link';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { fixNotifications } from '../utils/group-notifications';\nimport { saveStatus } from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\nconst emptySearchParams = new URLSearchParams();\n\nfunction Mentions({ columnMode, ...props }) {\n  const { t } = useLingui();\n  const { masto, instance } = api();\n  const [searchParams] = columnMode ? [emptySearchParams] : useSearchParams();\n  const [stateType, setStateType] = useState(null);\n  const type = props?.type || searchParams.get('type') || stateType;\n  useTitle(type === 'private' ? t`Private mentions` : t`Mentions`, '/mentions');\n\n  const mentionsIterator = useRef();\n  const latestItem = useRef();\n\n  async function fetchMentions(firstLoad) {\n    if (firstLoad || !mentionsIterator.current) {\n      mentionsIterator.current = masto.v1.notifications\n        .list({\n          limit: LIMIT,\n          types: ['mention'],\n        })\n        .values();\n    }\n    const results = await mentionsIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      value = fixNotifications(value);\n\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n        console.log('First load', latestItem.current);\n      }\n\n      value.forEach(({ status: item }) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value: value?.map((item) => item.status),\n    };\n  }\n\n  const conversationsIterator = useRef();\n  const latestConversationItem = useRef();\n  async function fetchConversations(firstLoad) {\n    if (firstLoad || !conversationsIterator.current) {\n      conversationsIterator.current = masto.v1.conversations\n        .list({\n          limit: LIMIT,\n        })\n        .values();\n    }\n    const results = await conversationsIterator.current.next();\n    let { value } = results;\n    value = value?.filter((item) => item.lastStatus);\n    if (value?.length) {\n      if (firstLoad) {\n        latestConversationItem.current = value[0].lastStatus.id;\n        console.log('First load', latestConversationItem.current);\n      }\n\n      value.forEach(({ lastStatus: item }) => {\n        saveStatus(item, instance);\n      });\n    }\n    console.log('results', results);\n    return {\n      ...results,\n      value: value?.map((item) => item.lastStatus),\n    };\n  }\n\n  function fetchItems(...args) {\n    if (type === 'private') {\n      return fetchConversations(...args);\n    }\n    return fetchMentions(...args);\n  }\n\n  async function checkForUpdates() {\n    if (type === 'private') {\n      try {\n        const results = await masto.v1.conversations\n          .list({\n            limit: 1,\n            since_id: latestConversationItem.current,\n          })\n          .values()\n          .next();\n        let { value } = results;\n        console.log(\n          'checkForUpdates PRIVATE',\n          latestConversationItem.current,\n          value,\n        );\n        const valueContainsLatestItem =\n          value[0]?.id === latestConversationItem.current; // since_id might not be supported\n        if (value?.length && !valueContainsLatestItem) {\n          latestConversationItem.current = value[0].lastStatus.id;\n          return true;\n        }\n        return false;\n      } catch (e) {\n        return false;\n      }\n    } else {\n      try {\n        const results = await masto.v1.notifications\n          .list({\n            limit: 1,\n            types: ['mention'],\n            since_id: latestItem.current,\n          })\n          .values()\n          .next();\n        let { value } = results;\n        console.log('checkForUpdates ALL', latestItem.current, value);\n        if (value?.length) {\n          latestItem.current = value[0].id;\n          return true;\n        }\n        return false;\n      } catch (e) {\n        return false;\n      }\n    }\n  }\n\n  const TimelineStart = useMemo(() => {\n    return (\n      <div class=\"filter-bar centered\">\n        <Link\n          to=\"/mentions\"\n          class={!type ? 'is-active' : ''}\n          onClick={(e) => {\n            if (columnMode) {\n              e.preventDefault();\n              setStateType(null);\n            }\n          }}\n        >\n          <Trans>All</Trans>\n        </Link>\n        <Link\n          to=\"/mentions?type=private\"\n          class={type === 'private' ? 'is-active' : ''}\n          onClick={(e) => {\n            if (columnMode) {\n              e.preventDefault();\n              setStateType('private');\n            }\n          }}\n        >\n          <Trans>Private</Trans>\n        </Link>\n      </div>\n    );\n  }, [type]);\n\n  return (\n    <Timeline\n      title={t`Mentions`}\n      id=\"mentions\"\n      emptyText={t`No one mentioned you :(`}\n      errorText={t`Unable to load mentions.`}\n      instance={instance}\n      fetchItems={fetchItems}\n      checkForUpdates={checkForUpdates}\n      useItemID\n      timelineStart={TimelineStart}\n      refresh={type}\n      filterContext=\"notifications\"\n    />\n  );\n}\n\nexport default Mentions;\n","import './notifications.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { Fragment } from 'preact';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useSearchParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\nimport { subscribeKey } from 'valtio/utils';\n\nimport AccountBlock from '../components/account-block';\nimport FollowRequestButtons from '../components/follow-request-buttons';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport Notification from '../components/notification';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport enhanceContent from '../utils/enhance-content';\nimport FilterContext from '../utils/filter-context';\nimport groupNotifications, {\n  groupNotifications2,\n  massageNotifications2,\n} from '../utils/group-notifications';\nimport handleContentLinks from '../utils/handle-content-links';\nimport mem from '../utils/mem';\nimport niceDateTime from '../utils/nice-date-time';\nimport { getRegistration } from '../utils/push-notifications';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus } from '../utils/states';\nimport store from '../utils/store';\nimport { getAPIVersions, getCurrentInstance } from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport usePageVisibility from '../utils/usePageVisibility';\nimport useScroll from '../utils/useScroll';\nimport useTitle from '../utils/useTitle';\n\nconst NOTIFICATIONS_LIMIT = 80;\nconst NOTIFICATIONS_GROUPED_LIMIT = 20;\nconst emptySearchParams = new URLSearchParams();\n\nconst scrollIntoViewOptions = {\n  block: 'start',\n  inline: 'center',\n  behavior: 'instant',\n};\n\nconst memSupportsGroupedNotifications = mem(\n  () => getAPIVersions()?.mastodon >= 2,\n  {\n    expires: 1000 * 60 * 5, // 5 minutes\n  },\n);\n\nfunction mastoFetchNotificationsIterable(opts = {}) {\n  const { masto } = api();\n  if (memSupportsGroupedNotifications()) {\n    // https://github.com/mastodon/mastodon/pull/29889\n    return masto.v2.notifications.list({\n      limit: NOTIFICATIONS_GROUPED_LIMIT,\n      ...opts,\n    });\n  } else {\n    return masto.v1.notifications.list({\n      limit: NOTIFICATIONS_LIMIT,\n      ...opts,\n    });\n  }\n}\nexport function mastoFetchNotifications(opts = {}) {\n  return mastoFetchNotificationsIterable(opts).values();\n}\n\nexport function getGroupedNotifications(notifications) {\n  if (memSupportsGroupedNotifications()) {\n    return groupNotifications2(notifications);\n  } else {\n    return groupNotifications(notifications);\n  }\n}\n\nconst NOTIFICATIONS_POLICIES = [\n  'forNotFollowing',\n  'forNotFollowers',\n  'forNewAccounts',\n  'forPrivateMentions',\n  'forLimitedAccounts',\n];\nconst NOTIFICATIONS_POLICIES_TEXT = {\n  forNotFollowing: msg`You don't follow`,\n  forNotFollowers: msg`Who don't follow you`,\n  forNewAccounts: msg`With a new account`,\n  forPrivateMentions: msg`Who unsolicitedly private mention you`,\n  forLimitedAccounts: msg`Who are limited by server moderators`,\n};\n\nfunction Notifications({ columnMode }) {\n  const { _, t } = useLingui();\n  useTitle(t`Notifications`, '/notifications');\n  const { masto, instance } = api();\n  const snapStates = useSnapshot(states);\n  const [uiState, setUIState] = useState('default');\n  const [searchParams] = columnMode ? [emptySearchParams] : useSearchParams();\n  const notificationID = searchParams.get('id');\n  const notificationAccessToken = searchParams.get('access_token');\n  const [showMore, setShowMore] = useState(false);\n  const [onlyMentions, setOnlyMentions] = useState(false);\n  const scrollableRef = useRef();\n  const { nearReachEnd, scrollDirection, reachStart, nearReachStart } =\n    useScroll({\n      scrollableRef,\n    });\n  const hiddenUI = scrollDirection === 'end' && !nearReachStart;\n  const [followRequests, setFollowRequests] = useState([]);\n  const [announcements, setAnnouncements] = useState([]);\n\n  console.debug('RENDER Notifications');\n\n  const notificationsIterable = useRef();\n  const notificationsIterator = useRef();\n  async function fetchNotifications(firstLoad) {\n    if (firstLoad || !notificationsIterator.current) {\n      // Reset iterator\n      notificationsIterable.current = mastoFetchNotificationsIterable({\n        excludeTypes: ['follow_request'],\n      });\n      notificationsIterator.current = notificationsIterable.current.values();\n    }\n    if (/max_id=($|&)/i.test(notificationsIterator.current?.nextParams)) {\n      // Pixelfed returns next paginationed link with empty max_id\n      // I assume, it's done (end of list)\n      return {\n        done: true,\n      };\n    }\n    const allNotifications = await notificationsIterator.current.next();\n    const notifications = massageNotifications2(allNotifications.value);\n\n    if (notifications?.length) {\n      notifications.forEach((notification) => {\n        saveStatus(notification.status, instance, {\n          skipThreading: true,\n        });\n      });\n\n      // TEST: Slot in a fake notification to test 'severed_relationships'\n      // notifications.unshift({\n      //   id: '123123',\n      //   type: 'severed_relationships',\n      //   createdAt: '2024-03-22T19:20:08.316Z',\n      //   event: {\n      //     type: 'account_suspension',\n      //     targetName: 'mastodon.dev',\n      //     followersCount: 0,\n      //     followingCount: 0,\n      //   },\n      // });\n\n      // TEST: Slot in a fake notification to test 'moderation_warning'\n      // notifications.unshift({\n      //   id: '123123',\n      //   type: 'moderation_warning',\n      //   createdAt: new Date().toISOString(),\n      //   moderation_warning: {\n      //     id: '1231234',\n      //     action: 'mark_statuses_as_sensitive',\n      //   },\n      // });\n\n      // console.log({ notifications });\n\n      const groupedNotifications = getGroupedNotifications(notifications);\n\n      if (firstLoad) {\n        states.notificationsLast = groupedNotifications[0];\n        states.notifications = groupedNotifications;\n\n        // Update last read marker\n        masto.v1.markers\n          .create({\n            notifications: {\n              lastReadId: groupedNotifications[0].id,\n            },\n          })\n          .catch(() => {});\n      } else {\n        states.notifications.push(...groupedNotifications);\n      }\n    }\n\n    states.notificationsShowNew = false;\n    states.notificationsLastFetchTime = Date.now();\n    return allNotifications;\n  }\n\n  async function fetchFollowRequests() {\n    // Note: no pagination here yet because this better be on a separate page. Should be rare use-case???\n    try {\n      return await masto.v1.followRequests.list({\n        limit: 80,\n      });\n    } catch (e) {\n      // Silently fail\n      return [];\n    }\n  }\n\n  const loadFollowRequests = () => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const requests = await fetchFollowRequests();\n        setFollowRequests(requests);\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n      }\n    })();\n  };\n\n  async function fetchAnnouncements() {\n    try {\n      return await masto.v1.announcements.list();\n    } catch (e) {\n      // Silently fail\n      return [];\n    }\n  }\n\n  const supportsFilteredNotifications = supports(\n    '@mastodon/filtered-notifications',\n  );\n  const [showNotificationsSettings, setShowNotificationsSettings] =\n    useState(false);\n  const [notificationsPolicy, setNotificationsPolicy] = useState({});\n  function fetchNotificationsPolicy() {\n    return masto.v2.notifications.policy.fetch().catch(() => {});\n  }\n  function loadNotificationsPolicy() {\n    fetchNotificationsPolicy()\n      .then((policy) => {\n        console.log(' Notifications policy', policy);\n        setNotificationsPolicy(policy);\n      })\n      .catch(() => {});\n  }\n  const [notificationsRequests, setNotificationsRequests] = useState(null);\n  function fetchNotificationsRequest() {\n    return masto.v1.notifications.requests.list();\n  }\n\n  const loadNotifications = (firstLoad) => {\n    setShowNew(false);\n    setUIState('loading');\n    (async () => {\n      try {\n        const fetchNotificationsPromise = fetchNotifications(firstLoad);\n\n        if (firstLoad) {\n          fetchAnnouncements()\n            .then((announcements) => {\n              announcements.sort((a, b) => {\n                // Sort by updatedAt first, then createdAt\n                return (\n                  Date.parse(b.updatedAt || b.createdAt) -\n                  Date.parse(a.updatedAt || a.createdAt)\n                );\n              });\n              setAnnouncements(announcements);\n            })\n            .catch(() => {});\n\n          fetchFollowRequests()\n            .then((requests) => {\n              setFollowRequests(requests);\n            })\n            .catch(() => {});\n\n          if (supportsFilteredNotifications) {\n            loadNotificationsPolicy();\n          }\n        }\n\n        const { done } = await fetchNotificationsPromise;\n        setShowMore(!done);\n\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  };\n\n  useEffect(() => {\n    loadNotifications(true);\n  }, []);\n  useEffect(() => {\n    if (reachStart) {\n      loadNotifications(true);\n    }\n  }, [reachStart]);\n\n  // useEffect(() => {\n  //   if (nearReachEnd && showMore) {\n  //     loadNotifications();\n  //   }\n  // }, [nearReachEnd, showMore]);\n\n  const [showNew, setShowNew] = useState(false);\n\n  const loadUpdates = useCallback(\n    ({ disableIdleCheck = false } = {}) => {\n      if (uiState === 'loading') {\n        return;\n      }\n      console.log(' Load updates', {\n        autoRefresh: snapStates.settings.autoRefresh,\n        scrollTop: scrollableRef.current?.scrollTop,\n        inBackground: inBackground(),\n        disableIdleCheck,\n      });\n      if (\n        snapStates.settings.autoRefresh &&\n        scrollableRef.current?.scrollTop < 16 &&\n        (disableIdleCheck || window.__IDLE__) &&\n        !inBackground()\n      ) {\n        loadNotifications(true);\n      }\n    },\n    [snapStates.notificationsShowNew, snapStates.settings.autoRefresh, uiState],\n  );\n  // useEffect(loadUpdates, [snapStates.notificationsShowNew]);\n\n  const lastHiddenTime = useRef();\n  usePageVisibility((visible) => {\n    if (visible) {\n      const timeDiff = Date.now() - lastHiddenTime.current;\n      if (!lastHiddenTime.current || timeDiff > 1000 * 3) {\n        // 3 seconds\n        loadUpdates({\n          disableIdleCheck: true,\n        });\n      } else {\n        lastHiddenTime.current = Date.now();\n      }\n    }\n  });\n  const firstLoad = useRef(true);\n  useEffect(() => {\n    let unsub = subscribeKey(states, 'notificationsShowNew', (v) => {\n      if (firstLoad.current) {\n        firstLoad.current = false;\n        return;\n      }\n      if (uiState === 'loading') return;\n      if (v) loadUpdates();\n      setShowNew(v);\n    });\n    return () => unsub?.();\n  }, []);\n\n  const todayDate = new Date();\n  const yesterdayDate = new Date(todayDate - 24 * 60 * 60 * 1000);\n  let currentDay = new Date();\n  const showTodayEmpty = !snapStates.notifications.some(\n    (notification) =>\n      new Date(notification.createdAt).toDateString() ===\n      todayDate.toDateString(),\n  );\n\n  const announcementsListRef = useRef();\n\n  useEffect(() => {\n    if (notificationID) {\n      states.routeNotification = {\n        id: notificationID,\n        accessToken: atob(notificationAccessToken),\n      };\n    }\n  }, [notificationID, notificationAccessToken]);\n\n  // useEffect(() => {\n  //   if (uiState === 'default') {\n  //     (async () => {\n  //       try {\n  //         const registration = await getRegistration();\n  //         if (registration?.getNotifications) {\n  //           const notifications = await registration.getNotifications();\n  //           console.log(' Push notifications', notifications);\n  //           // Close all notifications?\n  //           // notifications.forEach((notification) => {\n  //           //   notification.close();\n  //           // });\n  //         }\n  //       } catch (e) {}\n  //     })();\n  //   }\n  // }, [uiState]);\n\n  const [annualReportNotification, setAnnualReportNotification] =\n    useState(null);\n  useEffect(async () => {\n    // Skip this if not in December\n    const date = new Date();\n    if (date.getMonth() !== 11) return;\n    const dateYear = date.getFullYear();\n\n    // Skip if doesn't support annual report\n    if (!supports('@mastodon/annual-report')) return;\n\n    let annualReportNotification = store.account.get(\n      'annualReportNotification',\n    );\n    if (annualReportNotification) {\n      const annualReportYear = annualReportNotification?.annualReport?.year;\n      if (annualReportYear == dateYear) {\n        setAnnualReportNotification(annualReportNotification);\n        return;\n      }\n    }\n    const notificationIterator = mastoFetchNotifications({\n      types: ['annual_report'],\n    });\n    try {\n      const notification = await notificationIterator.next();\n      annualReportNotification = notification?.value?.notificationGroups?.[0];\n      const annualReportYear = annualReportNotification?.annualReport?.year;\n      // If same year, show the annual report\n      if (annualReportYear == dateYear) {\n        console.log(\n          'ANNUAL REPORT',\n          annualReportYear,\n          annualReportNotification,\n        );\n        setAnnualReportNotification(annualReportNotification);\n        store.account.set('annualReportNotification', annualReportNotification);\n      }\n    } catch (e) {\n      console.warn(e);\n    }\n  }, []);\n\n  const itemsSelector = '.notification';\n  const jRef = useHotkeys(\n    'j',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let nextItem = allItems[activeItemIndex + 1];\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k',\n    () => {\n      // focus on previous status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const oRef = useHotkeys(\n    ['enter', 'o'],\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const statusLink = activeItem?.querySelector('.status-link');\n      if (statusLink) {\n        statusLink.click();\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const today = new Date();\n  const todaySubHeading = useMemo(() => {\n    return niceDateTime(today, {\n      forceOpts: {\n        weekday: 'long',\n      },\n    });\n  }, [today]);\n\n  return (\n    <div\n      id=\"notifications-page\"\n      class=\"deck-container\"\n      ref={(node) => {\n        scrollableRef.current = node;\n        jRef.current = node;\n        kRef.current = node;\n        oRef.current = node;\n      }}\n      tabIndex=\"-1\"\n    >\n      <div class={`timeline-deck deck ${onlyMentions ? 'only-mentions' : ''}`}>\n        <header\n          hidden={hiddenUI}\n          onClick={(e) => {\n            if (!e.target.closest('a, button')) {\n              scrollableRef.current?.scrollTo({ top: 0, behavior: 'smooth' });\n            }\n          }}\n          onDblClick={(e) => {\n            if (!e.target.closest('a, button')) {\n              loadNotifications(true);\n            }\n          }}\n          class={uiState === 'loading' ? 'loading' : ''}\n        >\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Notifications</Trans>\n            </h1>\n            <div class=\"header-side\">\n              {supportsFilteredNotifications && (\n                <button\n                  type=\"button\"\n                  class=\"button plain4\"\n                  onClick={() => {\n                    setShowNotificationsSettings(true);\n                  }}\n                >\n                  <Icon\n                    icon=\"settings\"\n                    size=\"l\"\n                    alt={t`Notifications settings`}\n                  />\n                </button>\n              )}\n            </div>\n          </div>\n          {showNew && uiState !== 'loading' && (\n            <button\n              class=\"updates-button shiny-pill\"\n              type=\"button\"\n              onClick={() => {\n                loadNotifications(true);\n                scrollableRef.current?.scrollTo({\n                  top: 0,\n                  behavior: 'smooth',\n                });\n              }}\n            >\n              <Icon icon=\"arrow-up\" /> <Trans>New notifications</Trans>\n            </button>\n          )}\n        </header>\n        {announcements.length > 0 && (\n          <div class=\"shazam-container\">\n            <div class=\"shazam-container-inner\">\n              <details class=\"announcements\">\n                <summary>\n                  <span>\n                    <Icon icon=\"announce\" class=\"announcement-icon\" size=\"l\" />{' '}\n                    <Plural\n                      value={announcements.length}\n                      one=\"Announcement\"\n                      other=\"Announcements\"\n                    />{' '}\n                    <small class=\"insignificant\">{instance}</small>\n                  </span>\n                  {announcements.length > 1 && (\n                    <span class=\"announcements-nav-buttons\">\n                      {announcements.map((announcement, index) => (\n                        <button\n                          type=\"button\"\n                          class=\"plain2 small\"\n                          onClick={() => {\n                            announcementsListRef.current?.children[\n                              index\n                            ].scrollIntoView({\n                              behavior: 'smooth',\n                              block: 'nearest',\n                            });\n                          }}\n                        >\n                          {index + 1}\n                        </button>\n                      ))}\n                    </span>\n                  )}\n                </summary>\n                <ul\n                  class={`announcements-list-${\n                    announcements.length > 1 ? 'multiple' : 'single'\n                  }`}\n                  ref={announcementsListRef}\n                >\n                  {announcements.map((announcement) => (\n                    <li>\n                      <AnnouncementBlock announcement={announcement} />\n                    </li>\n                  ))}\n                </ul>\n              </details>\n            </div>\n          </div>\n        )}\n        {followRequests.length > 0 && (\n          <div class=\"follow-requests\">\n            <h2 class=\"timeline-header\">\n              <Trans>Follow requests</Trans>\n            </h2>\n            {followRequests.length > 5 ? (\n              <details>\n                <summary>\n                  <Plural\n                    value={followRequests.length}\n                    one=\"# follow request\"\n                    other=\"# follow requests\"\n                  />\n                </summary>\n                <ul>\n                  {followRequests.map((account) => (\n                    <li key={account.id}>\n                      <AccountBlock account={account} />\n                      <FollowRequestButtons\n                        accountID={account.id}\n                        onChange={() => {\n                          // loadFollowRequests();\n                          // loadNotifications(true);\n                        }}\n                      />\n                    </li>\n                  ))}\n                </ul>\n              </details>\n            ) : (\n              <ul>\n                {followRequests.map((account) => (\n                  <li key={account.id}>\n                    <AccountBlock account={account} />\n                    <FollowRequestButtons\n                      accountID={account.id}\n                      onChange={() => {\n                        // loadFollowRequests();\n                        // loadNotifications(true);\n                      }}\n                    />\n                  </li>\n                ))}\n              </ul>\n            )}\n          </div>\n        )}\n        {supportsFilteredNotifications &&\n          notificationsPolicy?.summary?.pendingRequestsCount > 0 && (\n            <div class=\"shazam-container\">\n              <div class=\"shazam-container-inner\">\n                <div class=\"filtered-notifications\">\n                  <details\n                    onToggle={async (e) => {\n                      const { open } = e.target;\n                      if (open) {\n                        const requests = await fetchNotificationsRequest();\n                        setNotificationsRequests(requests);\n                        console.log({ open, requests });\n                      }\n                    }}\n                  >\n                    <summary>\n                      <Plural\n                        value={notificationsPolicy.summary.pendingRequestsCount}\n                        one=\"Filtered notifications from # person\"\n                        other=\"Filtered notifications from # people\"\n                      />\n                    </summary>\n                    {!notificationsRequests ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      notificationsRequests?.length > 0 && (\n                        <ul>\n                          {notificationsRequests.map((request) => (\n                            <li key={request.id}>\n                              <div class=\"request-notifcations\">\n                                {!request.lastStatus?.id && (\n                                  <AccountBlock\n                                    useAvatarStatic\n                                    showStats\n                                    account={request.account}\n                                  />\n                                )}\n                                {request.lastStatus?.id && (\n                                  <div class=\"last-post\">\n                                    <Link\n                                      class=\"status-link\"\n                                      to={`/${instance}/s/${request.lastStatus.id}`}\n                                    >\n                                      <Status\n                                        status={request.lastStatus}\n                                        size=\"s\"\n                                        readOnly\n                                      />\n                                    </Link>\n                                  </div>\n                                )}\n                                <NotificationRequestModalButton\n                                  request={request}\n                                />\n                              </div>\n                              <NotificationRequestButtons\n                                request={request}\n                                onChange={() => {\n                                  loadNotifications(true);\n                                }}\n                              />\n                            </li>\n                          ))}\n                        </ul>\n                      )\n                    )}\n                  </details>\n                </div>\n              </div>\n            </div>\n          )}\n        {annualReportNotification && (\n          <div class=\"shazam-container\">\n            <div class=\"shazam-container-inner\">\n              <Notification notification={annualReportNotification} />\n            </div>\n          </div>\n        )}\n        <div id=\"mentions-option\">\n          <label>\n            <input\n              type=\"checkbox\"\n              checked={onlyMentions}\n              onChange={(e) => {\n                setOnlyMentions(e.target.checked);\n              }}\n            />{' '}\n            <Trans>Only mentions</Trans>\n          </label>\n        </div>\n        <h2 class=\"timeline-header\">\n          <Trans>Today</Trans>{' '}\n          <small class=\"insignificant bidi-isolate\">{todaySubHeading}</small>\n        </h2>\n        {showTodayEmpty && (\n          <p class=\"ui-state insignificant\">\n            {uiState === 'default' ? t`You're all caught up.` : <>&hellip;</>}\n          </p>\n        )}\n        {snapStates.notifications.length ? (\n          <FilterContext.Provider value=\"notifications\">\n            {snapStates.notifications\n              // This is leaked from Notifications popover\n              .filter((n) => n.type !== 'follow_request')\n              .map((notification) => {\n                if (onlyMentions && notification.type !== 'mention') {\n                  return null;\n                }\n                const notificationDay = new Date(notification.createdAt);\n                const differentDay =\n                  notificationDay.toDateString() !== currentDay.toDateString();\n                if (differentDay) {\n                  currentDay = notificationDay;\n                }\n                // if notificationDay is yesterday, show \"Yesterday\"\n                // if notificationDay is before yesterday, show date\n                const heading =\n                  notificationDay.toDateString() ===\n                  yesterdayDate.toDateString()\n                    ? t`Yesterday`\n                    : niceDateTime(currentDay, {\n                        hideTime: true,\n                      });\n                const subHeading = niceDateTime(currentDay, {\n                  forceOpts: {\n                    weekday: 'long',\n                  },\n                });\n                return (\n                  <Fragment key={notification._ids || notification.id}>\n                    {differentDay && (\n                      <h2 class=\"timeline-header\">\n                        <span>{heading}</span>{' '}\n                        <small class=\"insignificant bidi-isolate\">\n                          {subHeading}\n                        </small>\n                      </h2>\n                    )}\n                    <Notification\n                      instance={instance}\n                      notification={notification}\n                      key={notification._ids || notification.id}\n                    />\n                  </Fragment>\n                );\n              })}\n          </FilterContext.Provider>\n        ) : (\n          <>\n            {uiState === 'loading' && (\n              <>\n                <ul class=\"timeline flat\">\n                  {Array.from({ length: 5 }).map((_, i) => (\n                    <li class=\"notification skeleton\">\n                      <div class=\"notification-type\">\n                        <Icon icon=\"notification\" size=\"xl\" />\n                      </div>\n                      <div class=\"notification-content\">\n                        <p> </p>\n                      </div>\n                    </li>\n                  ))}\n                </ul>\n              </>\n            )}\n            {uiState === 'error' && (\n              <p class=\"ui-state\">\n                <Trans>Unable to load notifications</Trans>\n                <br />\n                <br />\n                <button type=\"button\" onClick={() => loadNotifications(true)}>\n                  <Trans>Try again</Trans>\n                </button>\n              </p>\n            )}\n          </>\n        )}\n        {showMore && (\n          <InView\n            onChange={(inView) => {\n              if (inView) {\n                loadNotifications();\n              }\n            }}\n          >\n            <button\n              type=\"button\"\n              class=\"plain block\"\n              disabled={uiState === 'loading'}\n              onClick={() => loadNotifications()}\n              style={{ marginBlockEnd: '6em' }}\n            >\n              {uiState === 'loading' ? (\n                <Loader abrupt />\n              ) : (\n                <Trans>Show more</Trans>\n              )}\n            </button>\n          </InView>\n        )}\n      </div>\n      {supportsFilteredNotifications && showNotificationsSettings && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowNotificationsSettings(false);\n            }\n          }}\n        >\n          <div class=\"sheet\" id=\"notifications-settings\" tabIndex=\"-1\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => setShowNotificationsSettings(false)}\n            >\n              <Icon icon=\"x\" alt={t`Close`} />\n            </button>\n            <header>\n              <h2>\n                <Trans>Notifications settings</Trans>\n              </h2>\n            </header>\n            <main>\n              <form\n                onSubmit={(e) => {\n                  e.preventDefault();\n                  const {\n                    forNotFollowing,\n                    forNotFollowers,\n                    forNewAccounts,\n                    forPrivateMentions,\n                    forLimitedAccounts,\n                  } = e.target;\n                  const newPolicy = {\n                    ...notificationsPolicy,\n                    forNotFollowing: forNotFollowing.value,\n                    forNotFollowers: forNotFollowers.value,\n                    forNewAccounts: forNewAccounts.value,\n                    forPrivateMentions: forPrivateMentions.value,\n                    forLimitedAccounts: forLimitedAccounts.value,\n                  };\n                  setNotificationsPolicy(newPolicy);\n                  setShowNotificationsSettings(false);\n                  (async () => {\n                    try {\n                      await masto.v2.notifications.policy.update(newPolicy);\n                      showToast(t`Notifications settings updated`);\n                    } catch (e) {\n                      console.error(e);\n                    }\n                  })();\n                }}\n              >\n                <p>\n                  <Trans>Filter out notifications from people:</Trans>\n                </p>\n                <div class=\"notification-policy-fields\">\n                  {NOTIFICATIONS_POLICIES.map((key) => {\n                    const value = notificationsPolicy[key];\n                    return (\n                      <div key={key}>\n                        <label>\n                          {_(NOTIFICATIONS_POLICIES_TEXT[key])}\n                          <select name={key} defaultValue={value} class=\"small\">\n                            <option value=\"accept\">\n                              <Trans>Accept</Trans>\n                            </option>\n                            <option value=\"filter\">\n                              <Trans>Filter</Trans>\n                            </option>\n                            <option value=\"drop\">\n                              <Trans>Ignore</Trans>\n                            </option>\n                          </select>\n                        </label>\n                      </div>\n                    );\n                  })}\n                </div>\n                <p>\n                  <button type=\"submit\">\n                    <Trans>Save</Trans>\n                  </button>\n                </p>\n              </form>\n            </main>\n          </div>\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nfunction inBackground() {\n  return !!document.querySelector('.deck-backdrop, #modal-container > *');\n}\n\nfunction AnnouncementBlock({ announcement }) {\n  const { instance } = api();\n  const { contact } = getCurrentInstance();\n  const contactAccount = contact?.account;\n  const {\n    id,\n    content,\n    startsAt,\n    endsAt,\n    published,\n    allDay,\n    publishedAt,\n    updatedAt,\n    read,\n    mentions,\n    statuses,\n    tags,\n    emojis,\n    reactions,\n  } = announcement;\n\n  const publishedAtDate = new Date(publishedAt);\n  const publishedDateText = niceDateTime(publishedAtDate);\n  const updatedAtDate = new Date(updatedAt);\n  const updatedAtText = niceDateTime(updatedAtDate);\n\n  return (\n    <div class=\"announcement-block\">\n      <AccountBlock account={contactAccount} />\n      <div\n        class=\"announcement-content\"\n        onClick={handleContentLinks({ mentions, instance })}\n        dangerouslySetInnerHTML={{\n          __html: enhanceContent(content, {\n            emojis,\n          }),\n        }}\n      />\n      <p class=\"insignificant\">\n        <time datetime={publishedAtDate.toISOString()}>\n          {niceDateTime(publishedAtDate)}\n        </time>\n        {updatedAt && updatedAtText !== publishedDateText && (\n          <>\n            {' '}\n            &bull;{' '}\n            <span class=\"ib\">\n              <Trans>\n                Updated{' '}\n                <time datetime={updatedAtDate.toISOString()}>\n                  {niceDateTime(updatedAtDate)}\n                </time>\n              </Trans>\n            </span>\n          </>\n        )}\n      </p>\n      <div class=\"announcement-reactions\" hidden>\n        {reactions.map((reaction) => {\n          const { name, count, me, staticUrl, url } = reaction;\n          return (\n            <button type=\"button\" class={`plain4 small ${me ? 'reacted' : ''}`}>\n              {url || staticUrl ? (\n                <img src={url || staticUrl} alt={name} width=\"16\" height=\"16\" />\n              ) : (\n                <span>{name}</span>\n              )}{' '}\n              <span class=\"count\">{shortenNumber(count)}</span>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nfunction fetchNotficationsByAccount(accountID) {\n  const { masto } = api();\n  return masto.v1.notifications.list({\n    accountID,\n  });\n}\nfunction NotificationRequestModalButton({ request }) {\n  const { instance } = api();\n  const [uiState, setUIState] = useState('loading');\n  const { account, lastStatus } = request;\n  const [showModal, setShowModal] = useState(false);\n  const [notifications, setNotifications] = useState([]);\n\n  function onClose() {\n    setShowModal(false);\n  }\n\n  useEffect(() => {\n    if (!request?.account?.id) return;\n    if (!showModal) return;\n    setUIState('loading');\n    (async () => {\n      const notifs = await fetchNotficationsByAccount(request.account.id);\n      setNotifications(notifs || []);\n      setUIState('default');\n    })();\n  }, [showModal, request?.account?.id]);\n\n  return (\n    <>\n      <button\n        type=\"button\"\n        class=\"plain4 request-notifications-account\"\n        onClick={() => {\n          setShowModal(true);\n        }}\n      >\n        <Icon icon=\"notification\" class=\"more-insignificant\" />{' '}\n        <small>\n          <Trans>\n            View notifications from{' '}\n            <span class=\"bidi-isolate\">@{account.username}</span>\n          </Trans>\n        </small>{' '}\n        <Icon icon=\"chevron-down\" />\n      </button>\n      {showModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              onClose();\n            }\n          }}\n        >\n          <div class=\"sheet\" tabIndex=\"-1\">\n            <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n              <Icon icon=\"x\" alt={t`Close`} />\n            </button>\n            <header>\n              <b>\n                <Trans>\n                  Notifications from{' '}\n                  <span class=\"bidi-isolate\">@{account.username}</span>\n                </Trans>\n              </b>\n            </header>\n            <main>\n              {uiState === 'loading' ? (\n                <p class=\"ui-state\">\n                  <Loader abrupt />\n                </p>\n              ) : (\n                notifications.map((notification) => (\n                  <div\n                    class=\"notification-peek\"\n                    onClick={(e) => {\n                      const { target } = e;\n                      // If button or links\n                      if (\n                        e.target.tagName === 'BUTTON' ||\n                        e.target.tagName === 'A'\n                      ) {\n                        onClose();\n                      }\n                    }}\n                  >\n                    <Notification\n                      instance={instance}\n                      notification={notification}\n                      isStatic\n                    />\n                  </div>\n                ))\n              )}\n            </main>\n          </div>\n        </Modal>\n      )}\n    </>\n  );\n}\n\nfunction NotificationRequestButtons({ request, onChange }) {\n  const { t } = useLingui();\n  const { masto } = api();\n  const [uiState, setUIState] = useState('default');\n  const [requestState, setRequestState] = useState(null); // accept, dismiss\n  const hasRequestState = requestState !== null;\n\n  return (\n    <p class=\"notification-request-buttons\">\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRequestState}\n        onClick={() => {\n          setUIState('loading');\n          (async () => {\n            try {\n              await masto.v1.notifications.requests\n                .$select(request.id)\n                .accept();\n              setRequestState('accept');\n              setUIState('default');\n              onChange({\n                request,\n                state: 'accept',\n              });\n              showToast(\n                t`Notifications from @${request.account.username} will not be filtered from now on.`,\n              );\n            } catch (error) {\n              setUIState('error');\n              console.error(error);\n              showToast(t`Unable to accept notification request`);\n            }\n          })();\n        }}\n      >\n        <Trans>Allow</Trans>\n      </button>{' '}\n      <button\n        type=\"button\"\n        disabled={uiState === 'loading' || hasRequestState}\n        class=\"light danger\"\n        onClick={() => {\n          setUIState('loading');\n          (async () => {\n            try {\n              await masto.v1.notifications.requests\n                .$select(request.id)\n                .dismiss();\n              setRequestState('dismiss');\n              setUIState('default');\n              onChange({\n                request,\n                state: 'dismiss',\n              });\n              showToast(\n                t`Notifications from @${request.account.username} will not show up in Filtered notifications from now on.`,\n              );\n            } catch (error) {\n              setUIState('error');\n              console.error(error);\n              showToast(t`Unable to dismiss notification request`);\n            }\n          })();\n        }}\n      >\n        <Trans>Dismiss</Trans>\n      </button>\n      <span class=\"notification-request-states\">\n        {uiState === 'loading' ? (\n          <Loader abrupt />\n        ) : requestState === 'accept' ? (\n          <Icon\n            icon=\"check-circle\"\n            alt={t`Accepted`}\n            class=\"notification-accepted\"\n          />\n        ) : (\n          requestState === 'dismiss' && (\n            <Icon\n              icon=\"x-circle\"\n              alt={t`Dismissed`}\n              class=\"notification-dismissed\"\n            />\n          )\n        )}\n      </span>\n    </p>\n  );\n}\n\nexport default memo(Notifications);\n","import { Trans, useLingui } from '@lingui/react/macro';\nimport { Menu, MenuDivider, MenuItem } from '@szhsin/react-menu';\nimport { useRef } from 'preact/hooks';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport Icon from '../components/icon';\nimport Menu2 from '../components/menu2';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { filteredItems } from '../utils/filters';\nimport states, { saveStatus } from '../utils/states';\nimport supports from '../utils/supports';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\n\nfunction Public({ local, columnMode, ...props }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const isLocal = !!local;\n  const params = columnMode ? {} : useParams();\n  const { masto, instance } = api({\n    instance: props?.instance || params.instance,\n  });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const title = isLocal\n    ? t`Local timeline (${instance})`\n    : t`Federated timeline (${instance})`;\n  useTitle(title, isLocal ? `/:instance?/p/l` : `/:instance?/p`);\n  // const navigate = useNavigate();\n  const latestItem = useRef();\n\n  const publicIterator = useRef();\n  async function fetchPublic(firstLoad) {\n    if (firstLoad || !publicIterator.current) {\n      const opts = {\n        limit: LIMIT,\n        local: isLocal || undefined,\n      };\n      if (!isLocal && supports('@pixelfed/global-feed')) {\n        opts.remote = true;\n      }\n      publicIterator.current = masto.v1.timelines.public.list(opts).values();\n    }\n    const results = await publicIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'public');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.timelines.public\n        .list({\n          limit: 1,\n          local: isLocal,\n          since_id: latestItem.current,\n        })\n        .values()\n        .next();\n      let { value } = results;\n      const valueContainsLatestItem = value[0]?.id === latestItem.current; // since_id might not be supported\n      if (value?.length && !valueContainsLatestItem) {\n        value = filteredItems(value, 'public');\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  return (\n    <Timeline\n      key={instance + isLocal}\n      title={title}\n      titleComponent={\n        <h1 class=\"header-double-lines\">\n          <b>{isLocal ? t`Local timeline` : t`Federated timeline`}</b>\n          <div>{instance}</div>\n        </h1>\n      }\n      id=\"public\"\n      instance={instance}\n      emptyText={t`No one has posted anything yet.`}\n      errorText={t`Unable to load posts`}\n      fetchItems={fetchPublic}\n      checkForUpdates={checkForUpdates}\n      useItemID\n      headerStart={<></>}\n      boostsCarousel={snapStates.settings.boostsCarousel}\n      // allowFilters\n      filterContext=\"public\"\n      headerEnd={\n        <Menu2\n          portal\n          // setDownOverflow\n          overflow=\"auto\"\n          viewScroll=\"close\"\n          position=\"anchor\"\n          menuButton={\n            <button type=\"button\" class=\"plain\">\n              <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n            </button>\n          }\n        >\n          <MenuItem href={isLocal ? `/#/${instance}/p` : `/#/${instance}/p/l`}>\n            {isLocal ? (\n              <>\n                <Icon icon=\"transfer\" />{' '}\n                <span>\n                  <Trans>Switch to Federated</Trans>\n                </span>\n              </>\n            ) : (\n              <>\n                <Icon icon=\"transfer\" />{' '}\n                <span>\n                  <Trans>Switch to Local</Trans>\n                </span>\n              </>\n            )}\n          </MenuItem>\n          <MenuDivider />\n          <MenuItem\n            onClick={() => {\n              let newInstance = prompt(\n                t`Enter a new instance e.g. \"mastodon.social\"`,\n              );\n              if (!/\\./.test(newInstance)) {\n                if (newInstance) alert(t`Invalid instance`);\n                return;\n              }\n              if (newInstance) {\n                newInstance = newInstance.toLowerCase().trim();\n                // navigate(isLocal ? `/${newInstance}/p/l` : `/${newInstance}/p`);\n                location.hash = isLocal\n                  ? `/${newInstance}/p/l`\n                  : `/${newInstance}/p`;\n              }\n            }}\n          >\n            <Icon icon=\"bus\" />{' '}\n            <span>\n              <Trans>Go to another instance</Trans>\n            </span>\n          </MenuItem>\n          {currentInstance !== instance && (\n            <MenuItem\n              onClick={() => {\n                location.hash = isLocal\n                  ? `/${currentInstance}/p/l`\n                  : `/${currentInstance}/p`;\n              }}\n            >\n              <Icon icon=\"bus\" />{' '}\n              <small class=\"menu-double-lines\">\n                <Trans>\n                  Go to my instance (<b>{currentInstance}</b>)\n                </Trans>\n              </small>\n            </MenuItem>\n          )}\n        </Menu2>\n      }\n    />\n  );\n}\n\nexport default Public;\n","import { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useReducer } from 'preact/hooks';\n\nimport { api } from '../utils/api';\nimport {\n  addToSearchHistory,\n  clearAllSearchHistory,\n  getSearchHistory,\n  removeFromSearchHistory,\n} from '../utils/search-history';\nimport showToast from '../utils/show-toast';\n\nimport Icon from './icon';\nimport Link from './link';\nimport { generateSearchItemData } from './search-form';\n\nexport default function RecentSearches({ onItemClick }) {\n  const { t } = useLingui();\n  const { instance } = api();\n  const [, reload] = useReducer((c) => c + 1, 0);\n  const history = getSearchHistory();\n\n  const handleClearAll = () => {\n    clearAllSearchHistory();\n    showToast({\n      text: t`Cleared recent searches`,\n      delay: 1000,\n    });\n    reload();\n  };\n\n  const handleRemoveItem = (query, queryType) => {\n    removeFromSearchHistory(query, queryType);\n    reload();\n  };\n\n  const [listRef] = useAutoAnimate();\n\n  if (history.length === 0) {\n    return null;\n  }\n\n  return (\n    <div class=\"recent-searches\">\n      <div class=\"recent-searches-header\">\n        <Icon icon=\"history\" />{' '}\n        <span>\n          <Trans>Recent searches</Trans>\n        </span>\n        <span class=\"spacer\" />\n        <button\n          type=\"button\"\n          class=\"plain4 small\"\n          onClick={handleClearAll}\n          disabled={history.length <= 0}\n        >\n          <span>\n            <Trans>Clear all</Trans>\n          </span>\n        </button>\n      </div>\n      <ul class=\"link-list recent-searches-list\" ref={listRef}>\n        {history.map((historyItem) => {\n          const { label, to, icon } = generateSearchItemData(\n            historyItem.query,\n            historyItem.queryType,\n            instance,\n          );\n\n          return (\n            <li\n              key={`${historyItem.query}-${historyItem.queryType}-${historyItem.timestamp}`}\n              class=\"recent-searches-item\"\n            >\n              <Link\n                to={to}\n                class=\"recent-searches-link\"\n                onClick={(e) => {\n                  addToSearchHistory(historyItem.query, historyItem.queryType);\n                  onItemClick?.(e);\n                }}\n              >\n                <Icon icon={icon} class=\"more-insignificant\" />\n                <span class=\"recent-searches-label\">{label}</span>\n              </Link>\n              <button\n                type=\"button\"\n                class=\"plain4 small\"\n                onClick={() =>\n                  handleRemoveItem(historyItem.query, historyItem.queryType)\n                }\n              >\n                <Icon icon=\"trash\" alt={t`Clear`} />\n              </button>\n            </li>\n          );\n        })}\n      </ul>\n    </div>\n  );\n}\n","import './search.css';\n\nimport { useAutoAnimate } from '@formkit/auto-animate/preact';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useLayoutEffect, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useParams, useSearchParams } from 'react-router-dom';\n\nimport AccountBlock from '../components/account-block';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport NavMenu from '../components/nav-menu';\nimport RecentSearches from '../components/recent-searches';\nimport SearchForm from '../components/search-form';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport { fetchRelationships } from '../utils/relationships';\nimport shortenNumber from '../utils/shorten-number';\nimport usePageVisibility from '../utils/usePageVisibility';\nimport useTitle from '../utils/useTitle';\n\nconst SHORT_LIMIT = 5;\nconst LIMIT = 40;\nconst emptySearchParams = new URLSearchParams();\n\nconst scrollIntoViewOptions = {\n  block: 'start',\n  inline: 'center',\n  behavior: 'instant',\n};\n\nfunction Search({ columnMode, ...props }) {\n  const { t } = useLingui();\n  const params = columnMode ? {} : useParams();\n  const { masto, instance, authenticated } = api({\n    instance: params.instance,\n  });\n  const [uiState, setUIState] = useState('default');\n  const [searchParams] = columnMode ? [emptySearchParams] : useSearchParams();\n  const searchFormRef = useRef();\n  const q = props?.query || searchParams.get('q');\n  const type = columnMode\n    ? 'statuses'\n    : props?.type || searchParams.get('type');\n  let title = t`Search`;\n  if (q) {\n    switch (type) {\n      case 'statuses':\n        title = t`Search: ${q} (Posts)`;\n        break;\n      case 'accounts':\n        title = t`Search: ${q} (Accounts)`;\n        break;\n      case 'hashtags':\n        title = t`Search: ${q} (Hashtags)`;\n        break;\n      default:\n        title = t`Search: ${q}`;\n    }\n  }\n  useTitle(title, `/search`);\n\n  const [showMore, setShowMore] = useState(false);\n  const offsetRef = useRef(0);\n  useEffect(() => {\n    offsetRef.current = 0;\n  }, [q, type]);\n\n  const scrollableRef = useRef();\n  useLayoutEffect(() => {\n    scrollableRef.current?.scrollTo?.(0, 0);\n  }, [q, type]);\n\n  const [statusResults, setStatusResults] = useState([]);\n  const [accountResults, setAccountResults] = useState([]);\n  const [hashtagResults, setHashtagResults] = useState([]);\n  useEffect(() => {\n    setStatusResults([]);\n    setAccountResults([]);\n    setHashtagResults([]);\n  }, [q]);\n  const typeResults = {\n    statuses: statusResults,\n    accounts: accountResults,\n    hashtags: hashtagResults,\n  };\n  const setTypeResultsFunc = {\n    statuses: setStatusResults,\n    accounts: setAccountResults,\n    hashtags: setHashtagResults,\n  };\n\n  const [relationshipsMap, setRelationshipsMap] = useState({});\n  const loadRelationships = async (accounts) => {\n    if (!accounts?.length) return;\n    const relationships = await fetchRelationships(accounts, relationshipsMap);\n    if (relationships) {\n      setRelationshipsMap({\n        ...relationshipsMap,\n        ...relationships,\n      });\n    }\n  };\n\n  function loadResults(firstLoad) {\n    if (firstLoad) {\n      offsetRef.current = 0;\n    }\n\n    if (!firstLoad && !authenticated) {\n      // Search results pagination is only available to authenticated users\n      return;\n    }\n\n    setUIState('loading');\n    if (firstLoad && !type) {\n      setStatusResults(statusResults.slice(0, SHORT_LIMIT));\n      setAccountResults(accountResults.slice(0, SHORT_LIMIT));\n      setHashtagResults(hashtagResults.slice(0, SHORT_LIMIT));\n    }\n\n    (async () => {\n      const params = {\n        q,\n        resolve: authenticated,\n        limit: SHORT_LIMIT,\n      };\n      if (type) {\n        params.limit = LIMIT;\n        params.type = type;\n        if (authenticated) params.offset = offsetRef.current;\n      }\n\n      try {\n        const results = await masto.v2.search.list(params);\n        console.log(results);\n        if (type) {\n          if (firstLoad) {\n            setTypeResultsFunc[type](results[type]);\n            const length = results[type]?.length;\n            offsetRef.current = LIMIT;\n            setShowMore(!!length);\n          } else {\n            // If first item is the same, it means API doesn't support offset\n            // I know this is a very basic check, but it works for now\n            if (results[type]?.[0]?.id === typeResults[type]?.[0]?.id) {\n              setShowMore(false);\n            } else {\n              setTypeResultsFunc[type]((prev) => [...prev, ...results[type]]);\n              const length = results[type]?.length;\n              offsetRef.current = offsetRef.current + LIMIT;\n              setShowMore(!!length);\n            }\n          }\n        } else {\n          setStatusResults(results.statuses || []);\n          setAccountResults(results.accounts || []);\n          setHashtagResults(results.hashtags || []);\n          offsetRef.current = 0;\n          setShowMore(false);\n        }\n        loadRelationships(results.accounts);\n\n        setUIState('default');\n      } catch (err) {\n        console.error(err);\n        setUIState('error');\n      }\n    })();\n  }\n\n  const lastHiddenTime = useRef();\n  usePageVisibility((visible) => {\n    const reachStart = scrollableRef.current?.scrollTop === 0;\n    if (visible && reachStart) {\n      const timeDiff = Date.now() - lastHiddenTime.current;\n      if (!lastHiddenTime.current || timeDiff > 1000 * 3) {\n        // 3 seconds\n        loadResults(true);\n      } else {\n        lastHiddenTime.current = Date.now();\n      }\n    }\n  });\n\n  useEffect(() => {\n    let timer;\n    searchFormRef.current?.setValue?.(q || '');\n    if (q) {\n      loadResults(true);\n    } else {\n      timer = setTimeout(() => {\n        searchFormRef.current?.focus?.();\n      }, 150); // Right after focusDeck runs\n    }\n    return () => clearTimeout(timer);\n  }, [q, type, instance]);\n\n  useHotkeys(\n    ['Slash', '/'],\n    (e) => {\n      searchFormRef.current?.focus?.();\n      searchFormRef.current?.select?.();\n    },\n    {\n      useKey: true,\n      preventDefault: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const itemsSelector = '.timeline > li > a, .hashtag-list > li > a';\n  const jRef = useHotkeys(\n    'j',\n    () => {\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let nextItem = allItems[activeItemIndex + 1];\n        if (nextItem) {\n          nextItem.focus();\n          nextItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const kRef = useHotkeys(\n    'k',\n    () => {\n      // focus on previous status after active item\n      const activeItem = document.activeElement.closest(itemsSelector);\n      const activeItemRect = activeItem?.getBoundingClientRect();\n      const allItems = Array.from(\n        scrollableRef.current.querySelectorAll(itemsSelector),\n      );\n      if (\n        activeItem &&\n        activeItemRect.top < scrollableRef.current.clientHeight &&\n        activeItemRect.bottom > 0\n      ) {\n        const activeItemIndex = allItems.indexOf(activeItem);\n        let prevItem = allItems[activeItemIndex - 1];\n        if (prevItem) {\n          prevItem.focus();\n          prevItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        const topmostItem = allItems.find((item) => {\n          const itemRect = item.getBoundingClientRect();\n          return itemRect.top >= 44 && itemRect.left >= 0;\n        });\n        if (topmostItem) {\n          topmostItem.focus();\n          topmostItem.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const [filterBarParent] = useAutoAnimate();\n\n  return (\n    <div\n      id=\"search-page\"\n      class=\"deck-container\"\n      tabIndex=\"-1\"\n      ref={(node) => {\n        scrollableRef.current = node;\n        jRef.current = node;\n        kRef.current = node;\n      }}\n    >\n      <div class=\"timeline-deck deck\">\n        <header class={uiState === 'loading' ? 'loading' : ''}>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n            </div>\n            <SearchForm ref={searchFormRef} />\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain\"\n                onClick={() => {\n                  loadResults(true);\n                }}\n                disabled={uiState === 'loading'}\n              >\n                <Icon icon=\"search\" size=\"l\" alt={t`Search`} />\n              </button>\n            </div>\n          </div>\n        </header>\n        <main>\n          {!!q && !columnMode && (\n            <div\n              ref={filterBarParent}\n              class={`filter-bar ${uiState === 'loading' ? 'loading' : ''}`}\n            >\n              {!!type && (\n                <Link to={`/search${q ? `?q=${encodeURIComponent(q)}` : ''}`}>\n                  <Icon icon=\"chevron-left\" /> <Trans>All</Trans>\n                </Link>\n              )}\n              {[\n                {\n                  label: t`Accounts`,\n                  type: 'accounts',\n                  to: `/search?q=${encodeURIComponent(q)}&type=accounts`,\n                },\n                {\n                  label: t`Hashtags`,\n                  type: 'hashtags',\n                  to: `/search?q=${encodeURIComponent(q)}&type=hashtags`,\n                },\n                {\n                  label: t`Posts`,\n                  type: 'statuses',\n                  to: `/search?q=${encodeURIComponent(q)}&type=statuses`,\n                },\n              ]\n                .sort((a, b) => {\n                  if (a.type === type) return -1;\n                  if (b.type === type) return 1;\n                  return 0;\n                })\n                .map((link) => (\n                  <Link to={link.to} key={link.type}>\n                    {link.label}\n                  </Link>\n                ))}\n            </div>\n          )}\n          {!!q ? (\n            <>\n              {(!type || type === 'accounts') && (\n                <>\n                  {type !== 'accounts' && (\n                    <h2 class=\"timeline-header\">\n                      <Trans>Accounts</Trans>{' '}\n                      <Link\n                        to={`/search?q=${encodeURIComponent(q)}&type=accounts`}\n                      >\n                        <Icon icon=\"arrow-right\" size=\"l\" alt={t`See more`} />\n                      </Link>\n                    </h2>\n                  )}\n                  {accountResults.length > 0 ? (\n                    <>\n                      <ul class=\"timeline flat accounts-list\">\n                        {accountResults.map((account) => (\n                          <li key={account.id}>\n                            <AccountBlock\n                              account={account}\n                              instance={instance}\n                              showStats\n                              relationship={relationshipsMap[account.id]}\n                            />\n                          </li>\n                        ))}\n                      </ul>\n                      {type !== 'accounts' && (\n                        <div class=\"ui-state\">\n                          <Link\n                            class=\"plain button\"\n                            to={`/search?q=${encodeURIComponent(\n                              q,\n                            )}&type=accounts`}\n                          >\n                            <Trans>See more accounts</Trans>{' '}\n                            <Icon icon=\"arrow-right\" />\n                          </Link>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    !type &&\n                    (uiState === 'loading' ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      <p class=\"ui-state\">\n                        <Trans>No accounts found.</Trans>\n                      </p>\n                    ))\n                  )}\n                </>\n              )}\n              {(!type || type === 'hashtags') && (\n                <>\n                  {type !== 'hashtags' && (\n                    <h2 class=\"timeline-header\">\n                      <Trans>Hashtags</Trans>{' '}\n                      <Link\n                        to={`/search?q=${encodeURIComponent(q)}&type=hashtags`}\n                      >\n                        <Icon icon=\"arrow-right\" size=\"l\" alt={t`See more`} />\n                      </Link>\n                    </h2>\n                  )}\n                  {hashtagResults.length > 0 ? (\n                    <>\n                      <ul class=\"link-list hashtag-list\">\n                        {hashtagResults.map((hashtag) => {\n                          const { name, history } = hashtag;\n                          const total = history?.reduce?.(\n                            (acc, cur) => acc + +cur.uses,\n                            0,\n                          );\n                          return (\n                            <li key={`${name}-${total}`}>\n                              <Link\n                                to={\n                                  instance\n                                    ? `/${instance}/t/${name}`\n                                    : `/t/${name}`\n                                }\n                              >\n                                <Icon icon=\"hashtag\" alt=\"#\" />\n                                <span>{name}</span>\n                                {!!total && (\n                                  <span class=\"count\">\n                                    {shortenNumber(total)}\n                                  </span>\n                                )}\n                              </Link>\n                            </li>\n                          );\n                        })}\n                      </ul>\n                      {type !== 'hashtags' && (\n                        <div class=\"ui-state\">\n                          <Link\n                            class=\"plain button\"\n                            to={`/search?q=${encodeURIComponent(\n                              q,\n                            )}&type=hashtags`}\n                          >\n                            <Trans>See more hashtags</Trans>{' '}\n                            <Icon icon=\"arrow-right\" />\n                          </Link>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    !type &&\n                    (uiState === 'loading' ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      <p class=\"ui-state\">\n                        <Trans>No hashtags found.</Trans>\n                      </p>\n                    ))\n                  )}\n                </>\n              )}\n              {(!type || type === 'statuses') && (\n                <>\n                  {type !== 'statuses' && (\n                    <h2 class=\"timeline-header\">\n                      <Trans>Posts</Trans>{' '}\n                      <Link\n                        to={`/search?q=${encodeURIComponent(q)}&type=statuses`}\n                      >\n                        <Icon icon=\"arrow-right\" size=\"l\" alt={t`See more`} />\n                      </Link>\n                    </h2>\n                  )}\n                  {statusResults.length > 0 ? (\n                    <>\n                      <ul class=\"timeline\">\n                        {statusResults.map((status) => (\n                          <li key={status.id}>\n                            <Link\n                              class=\"status-link\"\n                              to={\n                                instance\n                                  ? `/${instance}/s/${status.id}`\n                                  : `/s/${status.id}`\n                              }\n                            >\n                              <Status status={status} />\n                            </Link>\n                          </li>\n                        ))}\n                      </ul>\n                      {type !== 'statuses' && (\n                        <div class=\"ui-state\">\n                          <Link\n                            class=\"plain button\"\n                            to={`/search?q=${encodeURIComponent(\n                              q,\n                            )}&type=statuses`}\n                          >\n                            <Trans>See more posts</Trans>{' '}\n                            <Icon icon=\"arrow-right\" />\n                          </Link>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    !type &&\n                    (uiState === 'loading' ? (\n                      <p class=\"ui-state\">\n                        <Loader abrupt />\n                      </p>\n                    ) : (\n                      <p class=\"ui-state\">\n                        <Trans>No posts found.</Trans>\n                      </p>\n                    ))\n                  )}\n                </>\n              )}\n              {!!type &&\n                (uiState === 'default' ? (\n                  showMore ? (\n                    <InView\n                      onChange={(inView) => {\n                        if (inView) {\n                          loadResults();\n                        }\n                      }}\n                    >\n                      <button\n                        type=\"button\"\n                        class=\"plain block\"\n                        onClick={() => loadResults()}\n                        style={{ marginBlockEnd: '6em' }}\n                      >\n                        <Trans>Show more</Trans>\n                      </button>\n                    </InView>\n                  ) : (\n                    <p class=\"ui-state insignificant\">\n                      <Trans>The end.</Trans>\n                    </p>\n                  )\n                ) : (\n                  uiState === 'loading' && (\n                    <p class=\"ui-state\">\n                      <Loader abrupt />\n                    </p>\n                  )\n                ))}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader abrupt />\n            </p>\n          ) : (\n            <>\n              <p class=\"ui-state insignificant\">\n                <Trans>\n                  Enter your search term or paste a URL above to get started.\n                </Trans>\n              </p>\n              <RecentSearches />\n            </>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}\n\nexport default Search;\n","import '../components/links-bar.css';\nimport './trending.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuItem } from '@szhsin/react-menu';\nimport { getBlurHashAverageColor } from 'fast-blurhash';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport punycode from 'punycode/';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Menu2 from '../components/menu2';\nimport NameText from '../components/name-text';\nimport RelativeTime from '../components/relative-time';\nimport Timeline from '../components/timeline';\nimport { api } from '../utils/api';\nimport { oklab2rgb, rgb2oklab } from '../utils/color-utils';\nimport { filteredItems } from '../utils/filters';\nimport getDomain from '../utils/get-domain';\nimport pmem from '../utils/pmem';\nimport shortenNumber from '../utils/shorten-number';\nimport states, { saveStatus } from '../utils/states';\nimport supports from '../utils/supports';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 20;\nconst TREND_CACHE_TIME = 10 * 60 * 1000; // 10 minutes\n\nconst fetchLinks = pmem(\n  (masto) => {\n    return masto.v1.trends.links.list().values().next();\n  },\n  {\n    expires: TREND_CACHE_TIME,\n  },\n);\n\nconst fetchHashtags = pmem(\n  (masto) => {\n    return masto.v1.trends.tags.list().values().next();\n  },\n  {\n    expires: TREND_CACHE_TIME,\n  },\n);\n\nfunction fetchTrendsStatuses(masto) {\n  if (supports('@pixelfed/trending')) {\n    return masto.pixelfed.v2.discover.posts.trending\n      .list({\n        range: 'daily',\n      })\n      .values();\n  }\n  return masto.v1.trends.statuses\n    .list({\n      limit: LIMIT,\n    })\n    .values();\n}\n\nfunction fetchLinkList(masto, params) {\n  return masto.v1.timelines.link.list(params).values();\n}\n\nfunction Trending({ columnMode, ...props }) {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const params = columnMode ? {} : useParams();\n  const { masto, instance } = api({\n    instance: props?.instance || params.instance,\n  });\n  const { masto: currentMasto, instance: currentInstance } = api();\n  const title = t`Trending (${instance})`;\n  useTitle(title, `/:instance?/trending`);\n  // const navigate = useNavigate();\n  const latestItem = useRef();\n\n  const sameCurrentInstance = instance === currentInstance;\n\n  const [hashtags, setHashtags] = useState([]);\n  const [links, setLinks] = useState([]);\n  const trendIterator = useRef();\n\n  async function fetchTrends(firstLoad) {\n    console.log('fetchTrend', firstLoad);\n    if (firstLoad || !trendIterator.current) {\n      trendIterator.current = fetchTrendsStatuses(masto);\n\n      // Get hashtags\n      if (supports('@mastodon/trending-hashtags')) {\n        try {\n          // const iterator = masto.v1.trends.tags.list();\n          const { value: tags } = await fetchHashtags(masto);\n          console.log('tags', tags);\n          if (tags?.length) {\n            setHashtags(tags);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      }\n\n      // Get links\n      if (supports('@mastodon/trending-links')) {\n        try {\n          const { value } = await fetchLinks(masto, instance);\n          // 4 types available: link, photo, video, rich\n          // Only want links for now\n          const links = value?.filter?.((link) => link.type === 'link');\n          console.log('links', links);\n          if (links?.length) {\n            setLinks(links);\n          }\n        } catch (e) {\n          console.error(e);\n        }\n      }\n    }\n    const results = await trendIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      if (firstLoad) {\n        latestItem.current = value[0].id;\n      }\n\n      // value = filteredItems(value, 'public'); // Might not work here\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  // Link mentions\n  // https://github.com/mastodon/mastodon/pull/30381\n  const [currentLinkMentionsLoading, setCurrentLinkMentionsLoading] =\n    useState(false);\n  const currentLinkMentionsIterator = useRef();\n  const [currentLink, setCurrentLink] = useState(null);\n  const hasCurrentLink = !!currentLink;\n  const currentLinkRef = useRef();\n  const supportsTrendingLinkPosts =\n    sameCurrentInstance && supports('@mastodon/trending-link-posts');\n\n  useEffect(() => {\n    if (currentLink && currentLinkRef.current) {\n      currentLinkRef.current.scrollIntoView({\n        behavior: 'smooth',\n        block: 'nearest',\n        inline: 'center',\n      });\n    }\n  }, [currentLink]);\n\n  const prevCurrentLink = useRef();\n  async function fetchLinkMentions(firstLoad) {\n    if (firstLoad || !currentLinkMentionsIterator.current) {\n      setCurrentLinkMentionsLoading(true);\n      currentLinkMentionsIterator.current = fetchLinkList(masto, {\n        url: currentLink,\n      });\n    }\n    prevCurrentLink.current = currentLink;\n    const results = await currentLinkMentionsIterator.current.next();\n    let { value } = results;\n    if (value?.length) {\n      value = filteredItems(value, 'public');\n      value.forEach((item) => {\n        saveStatus(item, instance);\n      });\n    }\n    if (prevCurrentLink.current === currentLink) {\n      setCurrentLinkMentionsLoading(false);\n    }\n    return {\n      ...results,\n      value,\n    };\n  }\n\n  async function checkForUpdates() {\n    try {\n      const results = await masto.v1.trends.statuses\n        .list({\n          limit: 1,\n          // NOT SUPPORTED\n          // since_id: latestItem.current,\n        })\n        .values()\n        .next();\n      let { value } = results;\n      value = filteredItems(value, 'public');\n      if (value?.length && value[0].id !== latestItem.current) {\n        latestItem.current = value[0].id;\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  }\n\n  const TimelineStart = useMemo(() => {\n    return (\n      <>\n        {!!hashtags.length && (\n          <div class=\"filter-bar expandable\">\n            <Icon icon=\"chart\" class=\"insignificant\" size=\"l\" />\n            {hashtags.map((tag, i) => {\n              const { name, history } = tag;\n              const total = history.reduce((acc, cur) => acc + +cur.uses, 0);\n              return (\n                <Link to={`/${instance}/t/${name}`} key={name}>\n                  <span dir=\"auto\">\n                    <span class=\"more-insignificant\">#</span>\n                    {name}\n                  </span>\n                  <span class=\"filter-count\">{shortenNumber(total)}</span>\n                </Link>\n              );\n            })}\n          </div>\n        )}\n        {!!links.length && (\n          <div class=\"links-bar\">\n            <header>\n              <h3>\n                <Trans>Trending News</Trans>\n              </h3>\n            </header>\n            {links.map((link) => {\n              const {\n                authors,\n                authorName,\n                authorUrl,\n                blurhash,\n                description,\n                height,\n                image,\n                imageDescription,\n                language,\n                providerName,\n                providerUrl,\n                publishedAt,\n                title,\n                url,\n                width,\n              } = link;\n              const author = authors?.[0]?.account?.id\n                ? authors[0].account\n                : null;\n              const isShortTitle = title.length < 30;\n              const hasAuthor = !!(authorName || author);\n              const domain = getDomain(url);\n              let accentColor;\n              if (blurhash) {\n                const averageColor = getBlurHashAverageColor(blurhash);\n                const labAverageColor = rgb2oklab(averageColor);\n                accentColor = oklab2rgb([\n                  0.6,\n                  labAverageColor[1],\n                  labAverageColor[2],\n                ]);\n              }\n\n              return (\n                <div key={url}>\n                  <a\n                    ref={currentLink === url ? currentLinkRef : null}\n                    href={url}\n                    target=\"_blank\"\n                    rel=\"noopener\"\n                    class={`link-block ${\n                      hasCurrentLink\n                        ? currentLink === url\n                          ? 'active'\n                          : 'inactive'\n                        : ''\n                    }`}\n                    style={\n                      accentColor\n                        ? {\n                            '--accent-color': `rgb(${accentColor.join(',')})`,\n                            '--accent-alpha-color': `rgba(${accentColor.join(\n                              ',',\n                            )}, 0.4)`,\n                          }\n                        : {}\n                    }\n                  >\n                    <article>\n                      <figure>\n                        <img\n                          src={image}\n                          alt={imageDescription}\n                          width={width}\n                          height={height}\n                          loading=\"lazy\"\n                        />\n                      </figure>\n                      <div class=\"article-body\">\n                        <header>\n                          <div class=\"article-meta\">\n                            <span class=\"domain\">{domain}</span>{' '}\n                            {!!publishedAt && <>&middot; </>}\n                            {!!publishedAt && (\n                              <>\n                                <RelativeTime\n                                  datetime={publishedAt}\n                                  format=\"micro\"\n                                />\n                              </>\n                            )}\n                          </div>\n                          {!!title && (\n                            <h1\n                              class=\"title\"\n                              lang={language}\n                              dir=\"auto\"\n                              title={title}\n                            >\n                              {title}\n                            </h1>\n                          )}\n                        </header>\n                        {!!description && (\n                          <p\n                            class={`description ${\n                              hasAuthor && !isShortTitle ? '' : 'more-lines'\n                            }`}\n                            lang={language}\n                            dir=\"auto\"\n                            title={description}\n                          >\n                            {description}\n                          </p>\n                        )}\n                        {hasAuthor && (\n                          <>\n                            <hr />\n                            <p class=\"byline\">\n                              <small>\n                                <Trans comment=\"By [Author]\">\n                                  By{' '}\n                                  {author ? (\n                                    <NameText account={author} showAvatar />\n                                  ) : authorUrl ? (\n                                    <a\n                                      href={authorUrl}\n                                      target=\"_blank\"\n                                      rel=\"noopener\"\n                                    >\n                                      {authorName}\n                                    </a>\n                                  ) : (\n                                    authorName\n                                  )}\n                                </Trans>\n                              </small>\n                            </p>\n                          </>\n                        )}\n                      </div>\n                    </article>\n                  </a>\n                  {supportsTrendingLinkPosts && (\n                    <button\n                      type=\"button\"\n                      class=\"small plain4 block\"\n                      onClick={() => {\n                        setCurrentLink(url);\n                      }}\n                      disabled={url === currentLink}\n                    >\n                      <Icon icon=\"comment2\" />{' '}\n                      <span>\n                        <Trans>Mentions</Trans>\n                      </span>{' '}\n                      <Icon icon=\"chevron-down\" />\n                    </button>\n                  )}\n                </div>\n              );\n            })}\n          </div>\n        )}\n        {supportsTrendingLinkPosts && !!links.length && (\n          <div\n            class={`timeline-header-block ${hasCurrentLink ? 'blended' : ''}`}\n          >\n            {hasCurrentLink ? (\n              <>\n                <div style={{ width: 50, flexShrink: 0, textAlign: 'center' }}>\n                  {currentLinkMentionsLoading ? (\n                    <Loader abrupt />\n                  ) : (\n                    <button\n                      type=\"button\"\n                      class=\"light\"\n                      onClick={() => {\n                        setCurrentLink(null);\n                      }}\n                    >\n                      <Icon icon=\"x\" alt={t`Back to showing trending posts`} />\n                    </button>\n                  )}\n                </div>\n                <p>\n                  <Trans>\n                    Showing posts mentioning{' '}\n                    <span class=\"link-text\">\n                      {currentLink\n                        .replace(/^https?:\\/\\/(www\\.)?/i, '')\n                        .replace(/\\/$/, '')}\n                    </span>\n                  </Trans>\n                </p>\n              </>\n            ) : (\n              <p class=\"insignificant\">\n                <Trans>Trending posts</Trans>\n              </p>\n            )}\n          </div>\n        )}\n      </>\n    );\n  }, [hashtags, links, currentLink, currentLinkMentionsLoading]);\n\n  return (\n    <Timeline\n      key={instance}\n      title={title}\n      titleComponent={\n        <h1 class=\"header-double-lines\">\n          <b>\n            <Trans>Trending</Trans>\n          </b>\n          <div>{instance}</div>\n        </h1>\n      }\n      id=\"trending\"\n      instance={instance}\n      emptyText={t`No trending posts.`}\n      errorText={t`Unable to load posts`}\n      fetchItems={hasCurrentLink ? fetchLinkMentions : fetchTrends}\n      checkForUpdates={hasCurrentLink ? undefined : checkForUpdates}\n      checkForUpdatesInterval={5 * 60 * 1000} // 5 minutes\n      useItemID\n      headerStart={<></>}\n      boostsCarousel={snapStates.settings.boostsCarousel}\n      // allowFilters\n      filterContext=\"public\"\n      timelineStart={TimelineStart}\n      refresh={currentLink}\n      clearWhenRefresh\n      view={hasCurrentLink ? 'link-mentions' : undefined}\n      headerEnd={\n        <Menu2\n          portal\n          // setDownOverflow\n          overflow=\"auto\"\n          viewScroll=\"close\"\n          position=\"anchor\"\n          menuButton={\n            <button type=\"button\" class=\"plain\">\n              <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n            </button>\n          }\n        >\n          <MenuItem\n            onClick={() => {\n              let newInstance = prompt(\n                t`Enter a new instance e.g. \"mastodon.social\"`,\n              );\n              if (!/\\./.test(newInstance)) {\n                if (newInstance) alert(t`Invalid instance`);\n                return;\n              }\n              if (newInstance) {\n                newInstance = newInstance.toLowerCase().trim();\n                // navigate(`/${newInstance}/trending`);\n                location.hash = `/${newInstance}/trending`;\n              }\n            }}\n          >\n            <Icon icon=\"bus\" />{' '}\n            <span>\n              <Trans>Go to another instance</Trans>\n            </span>\n          </MenuItem>\n          {currentInstance !== instance && (\n            <MenuItem\n              onClick={() => {\n                location.hash = `/${currentInstance}/trending`;\n              }}\n            >\n              <Icon icon=\"bus\" />{' '}\n              <small class=\"menu-double-lines\">\n                <Trans>\n                  Go to my instance (<b>{currentInstance}</b>)\n                </Trans>\n              </small>\n            </MenuItem>\n          )}\n        </Menu2>\n      }\n    />\n  );\n}\n\nexport default Trending;\n","import { useLingui } from '@lingui/react/macro';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { useSnapshot } from 'valtio';\n\nimport Bookmarks from '../pages/bookmarks';\nimport Favourites from '../pages/favourites';\nimport Following from '../pages/following';\nimport Hashtag from '../pages/hashtag';\nimport List from '../pages/list';\nimport Mentions from '../pages/mentions';\nimport Notifications from '../pages/notifications';\nimport Public from '../pages/public';\nimport Search from '../pages/search';\nimport Trending from '../pages/trending';\nimport isRTL from '../utils/is-rtl';\nimport states from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst scrollIntoViewOptions = {\n  block: 'nearest',\n  inline: 'nearest',\n  behavior: 'instant',\n};\n\nfunction Columns() {\n  const { t } = useLingui();\n  useTitle(t`Home`, '/');\n  const snapStates = useSnapshot(states);\n  const { shortcuts } = snapStates;\n\n  console.debug('RENDER Columns', shortcuts);\n\n  const components = shortcuts.map((shortcut) => {\n    if (!shortcut) return null;\n    const { type, ...params } = shortcut;\n    const Component = {\n      following: Following,\n      notifications: Notifications,\n      list: List,\n      public: Public,\n      bookmarks: Bookmarks,\n      favourites: Favourites,\n      hashtag: Hashtag,\n      mentions: Mentions,\n      trending: Trending,\n      search: Search,\n    }[type];\n    if (!Component) return null;\n    // Don't show Search column with no query, for now\n    if (type === 'search' && !params.query) return null;\n    // Don't show List column with no list, for now\n    if (type === 'list' && !params.id) return null;\n    return (\n      <Component key={type + JSON.stringify(params)} {...params} columnMode />\n    );\n  });\n\n  useHotkeys(\n    ['1', '2', '3', '4', '5', '6', '7', '8', '9'],\n    (e) => {\n      try {\n        const index = parseInt(e.key, 10) - 1;\n        const $column = document.querySelectorAll('#columns > *')[index];\n        if ($column) {\n          $column.focus();\n          $column.scrollIntoView(scrollIntoViewOptions);\n        }\n      } catch (e) {\n        console.error(e);\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  useHotkeys(\n    ['[', ']'],\n    (e, handler) => {\n      const key = handler.keys[0];\n      const currentFocusedColumn =\n        document.activeElement.closest('#columns > *');\n\n      const rtl = isRTL();\n      const prevColKey = rtl ? ']' : '[';\n      const nextColKey = rtl ? '[' : ']';\n      let $column;\n\n      if (key === prevColKey) {\n        // If [, focus on left of focused column, else first column\n        $column = currentFocusedColumn\n          ? currentFocusedColumn.previousElementSibling\n          : document.querySelectorAll('#columns > *')[0];\n      } else if (key === nextColKey) {\n        // If ], focus on right of focused column, else 2nd column\n        $column = currentFocusedColumn\n          ? currentFocusedColumn.nextElementSibling\n          : document.querySelectorAll('#columns > *')[1];\n      }\n      if ($column) {\n        $column.focus();\n        $column.scrollIntoView(scrollIntoViewOptions);\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  return (\n    <div\n      id=\"columns\"\n      onContextMenu={(e) => {\n        // If right-click on header, but not links or buttons\n        if (\n          e.target.closest('.deck > header') &&\n          !e.target.closest('a') &&\n          !e.target.closest('button')\n        ) {\n          e.preventDefault();\n          states.showShortcutsSettings = true;\n        }\n      }}\n      onFocus={() => {\n        // Get current focused column\n        const currentFocusedColumn =\n          document.activeElement.closest('#columns > *');\n        if (currentFocusedColumn) {\n          // Remove focus classes from all columns\n          // Add focus class to current focused column\n          document.querySelectorAll('#columns > *').forEach((column) => {\n            column.classList.toggle('focus', column === currentFocusedColumn);\n          });\n        }\n      }}\n    >\n      {components}\n    </div>\n  );\n}\n\nexport default Columns;\n","import './notifications-menu.css';\n\nimport { msg } from '@lingui/core/macro';\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { ControlledMenu } from '@szhsin/react-menu';\nimport { memo } from 'preact/compat';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport Columns from '../components/columns';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport Notification from '../components/notification';\nimport { api } from '../utils/api';\nimport db from '../utils/db';\nimport FilterContext from '../utils/filter-context';\nimport { massageNotifications2 } from '../utils/group-notifications';\nimport states, { saveStatus } from '../utils/states';\nimport { getCurrentAccountNS } from '../utils/store-utils';\n\nimport Following from './following';\nimport {\n  getGroupedNotifications,\n  mastoFetchNotifications,\n} from './notifications';\n\nfunction Home() {\n  const { _ } = useLingui();\n  const snapStates = useSnapshot(states);\n  __BENCHMARK.end('time-to-home');\n  useEffect(() => {\n    (async () => {\n      const keys = await db.drafts.keys();\n      if (keys.length) {\n        const ns = getCurrentAccountNS();\n        const ownKeys = keys.filter((key) => key.startsWith(ns));\n        if (ownKeys.length) {\n          states.showDrafts = true;\n        }\n      }\n    })();\n  }, []);\n\n  return (\n    <>\n      {(snapStates.settings.shortcutsViewMode === 'multi-column' ||\n        (!snapStates.settings.shortcutsViewMode &&\n          snapStates.settings.shortcutsColumnsMode)) &&\n      !!snapStates.shortcuts?.length ? (\n        <Columns />\n      ) : (\n        <Following\n          title={_(msg`Home`)}\n          path=\"/\"\n          id=\"home\"\n          headerStart={false}\n          headerEnd={<NotificationsLink />}\n        />\n      )}\n    </>\n  );\n}\n\nfunction NotificationsLink() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  const notificationLinkRef = useRef();\n  const [menuState, setMenuState] = useState(undefined);\n  return (\n    <>\n      <Link\n        ref={notificationLinkRef}\n        to=\"/notifications\"\n        class={`button plain notifications-button ${\n          snapStates.notificationsShowNew ? 'has-badge' : ''\n        } ${menuState || ''}`}\n        onClick={(e) => {\n          e.stopPropagation();\n          if (window.matchMedia('(min-width: calc(40em))').matches) {\n            e.preventDefault();\n            setMenuState((state) => (!state ? 'open' : undefined));\n          }\n        }}\n      >\n        <Icon icon=\"notification\" size=\"l\" alt={t`Notifications`} />\n      </Link>\n      <NotificationsMenu\n        state={menuState}\n        anchorRef={notificationLinkRef}\n        onClose={() => setMenuState(undefined)}\n      />\n    </>\n  );\n}\n\nconst NOTIFICATIONS_DISPLAY_LIMIT = 5;\nfunction NotificationsMenu({ anchorRef, state, onClose }) {\n  const { masto, instance } = api();\n  const snapStates = useSnapshot(states);\n  const [uiState, setUIState] = useState('default');\n\n  const notificationsIterator = mastoFetchNotifications();\n\n  async function fetchNotifications() {\n    const allNotifications = await notificationsIterator.next();\n    const notifications = massageNotifications2(allNotifications.value);\n\n    if (notifications?.length) {\n      notifications.forEach((notification) => {\n        saveStatus(notification.status, instance, {\n          skipThreading: true,\n        });\n      });\n\n      const groupedNotifications = getGroupedNotifications(notifications);\n\n      states.notificationsLast = groupedNotifications[0];\n      states.notifications = groupedNotifications;\n\n      // Update last read marker\n      masto.v1.markers\n        .create({\n          notifications: {\n            lastReadId: groupedNotifications[0].id,\n          },\n        })\n        .catch(() => {});\n    }\n\n    states.notificationsShowNew = false;\n    states.notificationsLastFetchTime = Date.now();\n    return allNotifications;\n  }\n\n  const [hasFollowRequests, setHasFollowRequests] = useState(false);\n  function fetchFollowRequests() {\n    return masto.v1.followRequests.list({\n      limit: 1,\n    });\n  }\n\n  function loadNotifications({ skipFollowRequests = false } = {}) {\n    setUIState('loading');\n    (async () => {\n      try {\n        await fetchNotifications();\n        if (!skipFollowRequests) {\n          const followRequests = await fetchFollowRequests();\n          setHasFollowRequests(!!followRequests?.length);\n        }\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n      }\n    })();\n  }\n\n  const menuRef = useRef();\n  const headerHeight = 52;\n  useEffect(() => {\n    if (state !== 'open') return;\n    if (snapStates.notificationsShowNew) {\n      const menuElement = menuRef.current;\n      if (menuElement?.scrollTop <= headerHeight) {\n        loadNotifications({\n          skipFollowRequests: true,\n        });\n      }\n    } else {\n      loadNotifications();\n    }\n  }, [state, snapStates.notificationsShowNew]);\n\n  return (\n    <ControlledMenu\n      ref={menuRef}\n      menuClassName=\"notifications-menu\"\n      state={state}\n      anchorRef={anchorRef}\n      onClose={onClose}\n      portal={{\n        target: document.body,\n      }}\n      containerProps={{\n        onClick: () => {\n          menuRef.current?.closeMenu?.();\n        },\n      }}\n      overflow=\"auto\"\n      viewScroll=\"close\"\n      position=\"anchor\"\n      align=\"center\"\n      boundingBoxPadding=\"8 8 8 8\"\n    >\n      <header>\n        <h2>\n          <Trans>Notifications</Trans>\n        </h2>\n      </header>\n      <FilterContext.Provider value=\"notifications\">\n        <main>\n          {snapStates.notifications.length ? (\n            <>\n              {snapStates.notifications\n                .slice(0, NOTIFICATIONS_DISPLAY_LIMIT)\n                .map((notification) => (\n                  <Notification\n                    key={notification._ids || notification.id}\n                    instance={instance}\n                    notification={notification}\n                    disableContextMenu\n                  />\n                ))}\n            </>\n          ) : uiState === 'loading' ? (\n            <div class=\"ui-state\">\n              <Loader abrupt />\n            </div>\n          ) : (\n            uiState === 'error' && (\n              <div class=\"ui-state\">\n                <p>\n                  <Trans>Unable to fetch notifications.</Trans>\n                </p>\n                <p>\n                  <button type=\"button\" onClick={loadNotifications}>\n                    <Trans>Try again</Trans>\n                  </button>\n                </p>\n              </div>\n            )\n          )}\n        </main>\n      </FilterContext.Provider>\n      <footer>\n        <Link to=\"/mentions\" class=\"button plain\">\n          <Icon icon=\"at\" />{' '}\n          <span>\n            <Trans>Mentions</Trans>\n          </span>\n        </Link>\n        <Link to=\"/notifications\" class=\"button plain2\">\n          {hasFollowRequests ? (\n            <Trans>\n              <span class=\"tag collapsed\">New</span>{' '}\n              <span>Follow Requests</span>\n            </Trans>\n          ) : (\n            <b>\n              <Trans>See all</Trans>\n            </b>\n          )}{' '}\n          <Icon icon=\"arrow-right\" />\n        </Link>\n      </footer>\n    </ControlledMenu>\n  );\n}\n\nexport default memo(Home);\n","// export const statusRegex = /\\/@([^@\\/]+)@?([^\\/]+)?\\/([^\\/]+)\\/?$/i;\n// export const statusNoteRegex = /\\/notes\\/([^\\/]+)\\/?$/i;\n\nconst statusPostRegexes = [\n  /^\\/@[^@\\/]+\\/(?:statuses|posts)\\/([^\\/]+)/i, // GoToSocial, Takahe\n  /\\/notes\\/([^\\/]+)/i, // Misskey, Firefish\n  /^\\/(?:notice|objects)\\/([a-z0-9-]+)/i, // Pleroma\n  /\\/@[^@\\/]+\\/post\\/([^\\/]+)/i, // Threads\n  /\\/@[^@\\/]+@?[^\\/]+?\\/([^\\/]+)/i, // Mastodon\n  /^\\/p\\/[^\\/]+\\/([^\\/]+)/i, // Pixelfed\n];\n\nexport function getInstanceStatusObject(url) {\n  // Regex /:username/:id, where username = @username or @username@domain, id = anything\n  const theURL = URL.parse(url);\n  if (!theURL) return {};\n  const { hostname, pathname } = theURL;\n  // const [, username, domain, id] = pathname.match(statusRegex) || [];\n  for (const regex of statusPostRegexes) {\n    const [, id] = pathname.match(regex) || [];\n    console.log(pathname, regex, id);\n    if (id) {\n      return {\n        instance: hostname,\n        id,\n      };\n    }\n  }\n  return {};\n}\n\nfunction getInstanceStatusURL(url) {\n  const { instance, id } = getInstanceStatusObject(url);\n  if (instance && id) {\n    return `/${instance}/s/${id}`;\n  }\n  return null;\n}\n\nexport default getInstanceStatusURL;\n","import { Trans } from '@lingui/react/macro';\nimport { useLayoutEffect, useState } from 'preact/hooks';\nimport { useLocation } from 'react-router-dom';\n\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport { api } from '../utils/api';\nimport getInstanceStatusURL, {\n  getInstanceStatusObject,\n} from '../utils/get-instance-status-url';\n\nexport default function HttpRoute() {\n  const location = useLocation();\n  const url = location.pathname.replace(/^\\//, '');\n  const statusObject = getInstanceStatusObject(url);\n  // const statusURL = getInstanceStatusURL(url);\n  const statusURL = statusObject?.instance\n    ? `/${statusObject.instance}/s/${statusObject.id}`\n    : null;\n  const [uiState, setUIState] = useState('loading');\n\n  useLayoutEffect(() => {\n    setUIState('loading');\n    (async () => {\n      // Check if status returns 200\n      try {\n        const { instance, id } = statusObject;\n        if (id) {\n          const { masto } = api({ instance });\n          const status = await masto.v1.statuses.$select(id).fetch();\n          if (status) {\n            window.location.hash = statusURL + '?view=full';\n            return;\n          }\n        }\n      } catch (e) {}\n\n      // Fallback to search\n      {\n        const { masto: currentMasto, instance: currentInstance } = api();\n        const result = await currentMasto.v2.search.list({\n          q: url,\n          limit: 1,\n          resolve: true,\n        });\n        if (result.statuses.length) {\n          const status = result.statuses[0];\n          window.location.hash = `/${currentInstance}/s/${status.id}?view=full`;\n        } else if (result.accounts.length) {\n          const account = result.accounts[0];\n          window.location.hash = `/${currentInstance}/a/${account.id}`;\n        } else if (statusURL) {\n          // Fallback to original URL, which will probably show error\n          window.location.hash = statusURL + '?view=full';\n        } else {\n          setUIState('error');\n        }\n      }\n    })();\n  }, [statusURL]);\n\n  return (\n    <div class=\"ui-state\" tabIndex=\"-1\">\n      {uiState === 'loading' ? (\n        <>\n          <Loader abrupt />\n          <h2>\n            <Trans>Resolving</Trans>\n          </h2>\n          <p>\n            <a href={url} target=\"_blank\" rel=\"noopener\">\n              {url}\n            </a>\n          </p>\n        </>\n      ) : (\n        <>\n          <h2>\n            <Trans>Unable to resolve URL</Trans>\n          </h2>\n          <p>\n            <a href={url} target=\"_blank\" rel=\"noopener\">\n              {url}\n            </a>\n          </p>\n        </>\n      )}\n      <hr />\n      <p>\n        <Link to=\"/\">\n          <Trans>Go home</Trans>\n        </Link>\n      </p>\n    </div>\n  );\n}\n","import './lists.css';\n\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { useEffect, useReducer, useState } from 'preact/hooks';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport ListAddEdit from '../components/list-add-edit';\nimport ListExclusiveBadge from '../components/list-exclusive-badge';\nimport Loader from '../components/loader';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport { fetchLists } from '../utils/lists';\nimport useTitle from '../utils/useTitle';\n\nfunction Lists() {\n  const { t } = useLingui();\n  useTitle(t`Lists`, `/l`);\n  const [uiState, setUIState] = useState('default');\n\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n  const [lists, setLists] = useState([]);\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const lists = await fetchLists();\n        console.log(lists);\n        setLists(lists);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, [reloadCount]);\n\n  const [showListAddEditModal, setShowListAddEditModal] = useState(false);\n\n  const hasExclusiveLists = lists.some((list) => list.exclusive);\n\n  return (\n    <div id=\"lists-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Lists</Trans>\n            </h1>\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain\"\n                onClick={() => setShowListAddEditModal(true)}\n              >\n                <Icon icon=\"plus\" size=\"l\" alt={t`New list`} />\n              </button>\n            </div>\n          </div>\n        </header>\n        <main>\n          {lists.length > 0 ? (\n            <>\n              <ul class=\"link-list\">\n                {lists.map((list) => (\n                  <li>\n                    <Link to={`/l/${list.id}`}>\n                      <Icon icon=\"list\" />{' '}\n                      <span>\n                        {list.title}\n                        {list.exclusive && (\n                          <>\n                            {' '}\n                            <ListExclusiveBadge insignificant />\n                          </>\n                        )}\n                      </span>\n                      {/* <button\n                      type=\"button\"\n                      class=\"plain\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        setShowListAddEditModal({\n                          list,\n                        });\n                      }}\n                    >\n                      <Icon icon=\"pencil\" />\n                    </button> */}\n                    </Link>\n                  </li>\n                ))}\n              </ul>\n              {lists.length > 1 && (\n                <footer class=\"ui-state\">\n                  {hasExclusiveLists && (\n                    <p>\n                      <small class=\"insignificant\">\n                        <ListExclusiveBadge />{' '}\n                        <Trans>\n                          Posts on this list are hidden from Home/Following\n                        </Trans>\n                      </small>\n                    </p>\n                  )}\n                  <p>\n                    <small class=\"insignificant\">\n                      <Plural\n                        value={lists.length}\n                        one=\"# list\"\n                        other=\"# lists\"\n                      />\n                    </small>\n                  </p>\n                </footer>\n              )}\n            </>\n          ) : uiState === 'loading' ? (\n            <p class=\"ui-state\">\n              <Loader />\n            </p>\n          ) : uiState === 'error' ? (\n            <p class=\"ui-state\">\n              <Trans>Unable to load lists.</Trans>\n            </p>\n          ) : (\n            <p class=\"ui-state\">\n              <Trans>No lists yet.</Trans>\n            </p>\n          )}\n        </main>\n      </div>\n      {showListAddEditModal && (\n        <Modal\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowListAddEditModal(false);\n            }\n          }}\n        >\n          <ListAddEdit\n            list={showListAddEditModal?.list}\n            onClose={(result) => {\n              if (result.state === 'success') {\n                reload();\n              }\n              setShowListAddEditModal(false);\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nexport default Lists;\n","export default \"__VITE_ASSET__Bj_CmqRM__\"","export function openAuthPopup(url) {\n  const width = Math.min(500, Math.floor(window.screen.width * 0.9));\n  const height = Math.min(600, Math.floor(window.screen.height * 0.8));\n\n  const features = `popup,width=${width},height=${height}`;\n\n  try {\n    const popup = window.open(url, 'auth-popup', features);\n    if (!popup || popup.closed || typeof popup.closed === 'undefined') {\n      return null;\n    }\n    return popup;\n  } catch (e) {\n    console.error('Failed to open popup:', e);\n    return null;\n  }\n}\n\nexport function closeAuthPopup(popup) {\n  if (popup && !popup.closed) {\n    try {\n      popup.close();\n    } catch (e) {\n      console.error('Failed to close popup:', e);\n    }\n  }\n}\n\nexport function watchAuthPopup(popup, onSuccess, onError) {\n  let resolved = false;\n\n  const messageHandler = (event) => {\n    // Security: verify event origin matches current origin\n    if (event.origin !== window.location.origin) {\n      return;\n    }\n\n    if (event.data && event.data.type === 'oauth-callback') {\n      resolved = true;\n      cleanup();\n\n      if (event.data.code) {\n        onSuccess(event.data.code);\n      } else {\n        onError(new Error('No authorization code received'));\n      }\n    }\n  };\n\n  window.addEventListener('message', messageHandler);\n\n  const pollInterval = setInterval(() => {\n    if (!popup || popup.closed) {\n      clearInterval(pollInterval);\n      if (!resolved) {\n        resolved = true;\n        cleanup();\n        onError(new Error('Popup was closed before authentication completed'));\n      }\n    }\n  }, 500);\n\n  const cleanup = () => {\n    window.removeEventListener('message', messageHandler);\n    clearInterval(pollInterval);\n    closeAuthPopup(popup);\n  };\n\n  return cleanup;\n}\n","import './login.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport Fuse from 'fuse.js';\nimport { useEffect, useRef, useState } from 'preact/hooks';\nimport { useSearchParams } from 'react-router-dom';\n\nimport logo from '../assets/logo.svg';\n\nimport LangSelector from '../components/lang-selector';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport instancesListURL from '../data/instances.json?url';\nimport {\n  getAuthorizationURL,\n  getPKCEAuthorizationURL,\n  registerApplication,\n} from '../utils/auth';\nimport { openAuthPopup, watchAuthPopup } from '../utils/auth-popup';\nimport { supportsPKCE } from '../utils/oauth-pkce';\nimport store from '../utils/store';\nimport {\n  getCredentialApplication,\n  hasAccountInInstance,\n  storeCredentialApplication,\n} from '../utils/store-utils';\nimport useTitle from '../utils/useTitle';\n\nconst { PHANPY_DEFAULT_INSTANCE: DEFAULT_INSTANCE } = import.meta.env;\n\nfunction Login() {\n  const { t } = useLingui();\n  useTitle(t`Log in`, '/login');\n  const instanceURLRef = useRef();\n  const cachedInstanceURL = store.local.get('instanceURL');\n  const [uiState, setUIState] = useState('default');\n  const [searchParams] = useSearchParams();\n  const instance = searchParams.get('instance');\n  const submit = searchParams.get('submit');\n  const [instanceText, setInstanceText] = useState(\n    instance || cachedInstanceURL?.toLowerCase() || '',\n  );\n\n  const [instancesList, setInstancesList] = useState([]);\n  const searcher = useRef();\n  useEffect(() => {\n    (async () => {\n      try {\n        const res = await fetch(instancesListURL);\n        const data = await res.json();\n        setInstancesList(data);\n        searcher.current = new Fuse(data);\n      } catch (e) {\n        // Silently fail\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  // useEffect(() => {\n  //   if (cachedInstanceURL) {\n  //     instanceURLRef.current.value = cachedInstanceURL.toLowerCase();\n  //   }\n  // }, []);\n\n  const submitInstance = (instanceURL) => {\n    if (!instanceURL) return;\n\n    (async () => {\n      // WEB_DOMAIN vs LOCAL_DOMAIN negotiation time\n      // https://docs.joinmastodon.org/admin/config/#web_domain\n      try {\n        const res = await fetch(`https://${instanceURL}/.well-known/host-meta`); // returns XML\n        const text = await res.text();\n        // Parse XML\n        const parser = new DOMParser();\n        const xmlDoc = parser.parseFromString(text, 'text/xml');\n        // Get Link[template]\n        const link = xmlDoc.getElementsByTagName('Link')[0];\n        const template = link.getAttribute('template');\n        const url = URL.parse(template);\n        const { host } = url; // host includes the port\n        if (instanceURL !== host) {\n          console.log(` ${instanceURL} -> ${host}`);\n          instanceURL = host;\n        }\n      } catch (e) {\n        // Silently fail\n        console.error(e);\n      }\n\n      store.local.set('instanceURL', instanceURL);\n\n      setUIState('loading');\n      try {\n        let credentialApplication = getCredentialApplication(instanceURL);\n        if (\n          !credentialApplication ||\n          !credentialApplication.client_id ||\n          !credentialApplication.client_secret\n        ) {\n          credentialApplication = await registerApplication({\n            instanceURL,\n          });\n          storeCredentialApplication(instanceURL, credentialApplication);\n        }\n\n        const { client_id, client_secret } = credentialApplication;\n\n        const authPKCE = await supportsPKCE({ instanceURL });\n        console.log({ authPKCE });\n        const forceLogin = hasAccountInInstance(instanceURL);\n\n        let authUrl;\n        if (authPKCE && window.isSecureContext) {\n          if (client_id && client_secret) {\n            const [url, verifier] = await getPKCEAuthorizationURL({\n              instanceURL,\n              client_id,\n              forceLogin,\n            });\n            store.sessionCookie.set('codeVerifier', verifier);\n            authUrl = url;\n          } else {\n            alert(t`Failed to register application`);\n            setUIState('default');\n            return;\n          }\n        } else {\n          if (client_id && client_secret) {\n            authUrl = await getAuthorizationURL({\n              instanceURL,\n              client_id,\n              forceLogin,\n            });\n          } else {\n            alert(t`Failed to register application`);\n            setUIState('default');\n            return;\n          }\n        }\n\n        const popup = openAuthPopup(authUrl);\n\n        if (popup) {\n          watchAuthPopup(\n            popup,\n            (code) => {\n              const callbackUrl = `${window.location.origin}${window.location.pathname}?code=${encodeURIComponent(code)}`;\n              window.location.href = callbackUrl;\n            },\n            (error) => {\n              console.error('Popup auth error:', error);\n              setUIState('error');\n            },\n          );\n        } else {\n          // Popup blocked, fallback to redirect\n          console.log('Popup blocked, falling back to redirect');\n          location.href = authUrl;\n        }\n\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  };\n\n  const cleanInstanceText = instanceText\n    ? instanceText\n        .replace(/^https?:\\/\\//, '') // Remove protocol from instance URL\n        .replace(/\\/+$/, '') // Remove trailing slash\n        .replace(/^@?[^@]+@/, '') // Remove @?acct@\n        .trim()\n    : null;\n  const instanceTextLooksLikeDomain =\n    /[^\\s\\r\\n\\t\\/\\\\]+\\.[^\\s\\r\\n\\t\\/\\\\]+/.test(cleanInstanceText) &&\n    !/[\\s\\/\\\\@]/.test(cleanInstanceText);\n\n  const instancesSuggestions = cleanInstanceText\n    ? searcher.current\n        ?.search(cleanInstanceText, {\n          limit: 10,\n        })\n        ?.map((match) => match.item)\n    : [];\n\n  const selectedInstanceText = instanceTextLooksLikeDomain\n    ? cleanInstanceText\n    : instancesSuggestions?.length\n      ? instancesSuggestions[0]\n      : instanceText\n        ? instancesList.find((instance) => instance.includes(instanceText))\n        : null;\n\n  const onSubmit = (e) => {\n    e.preventDefault();\n    // const { elements } = e.target;\n    // let instanceURL = elements.instanceURL.value.toLowerCase();\n    // // Remove protocol from instance URL\n    // instanceURL = instanceURL.replace(/^https?:\\/\\//, '').replace(/\\/+$/, '');\n    // // Remove @acct@ or acct@ from instance URL\n    // instanceURL = instanceURL.replace(/^@?[^@]+@/, '');\n    // if (!/\\./.test(instanceURL)) {\n    //   instanceURL = instancesList.find((instance) =>\n    //     instance.includes(instanceURL),\n    //   );\n    // }\n    // submitInstance(instanceURL);\n    submitInstance(selectedInstanceText);\n  };\n\n  if (submit) {\n    useEffect(() => {\n      submitInstance(instance || selectedInstanceText);\n    }, []);\n  }\n\n  return (\n    <main id=\"login\" style={{ textAlign: 'center' }}>\n      <form onSubmit={onSubmit}>\n        <h1>\n          <img src={logo} alt=\"\" width=\"80\" height=\"80\" />\n          <br />\n          <Trans>Log in</Trans>\n        </h1>\n        <label>\n          <p>\n            <Trans>Instance</Trans>\n          </p>\n          <input\n            value={instanceText}\n            required\n            type=\"text\"\n            class=\"large\"\n            id=\"instanceURL\"\n            ref={instanceURLRef}\n            disabled={uiState === 'loading'}\n            // list=\"instances-list\"\n            autocorrect=\"off\"\n            autocapitalize=\"off\"\n            autocomplete=\"off\"\n            spellCheck={false}\n            placeholder={t`instance domain`}\n            enterKeyHint=\"go\"\n            onInput={(e) => {\n              setInstanceText(e.target.value);\n            }}\n            dir=\"auto\"\n          />\n          {instancesSuggestions?.length > 0 ? (\n            <ul id=\"instances-suggestions\">\n              {instancesSuggestions.map((instance, i) => (\n                <li>\n                  <button\n                    type=\"button\"\n                    class=\"plain5\"\n                    onClick={() => {\n                      submitInstance(instance);\n                    }}\n                  >\n                    {instance}\n                  </button>\n                </li>\n              ))}\n            </ul>\n          ) : (\n            <div id=\"instances-eg\">\n              <Trans>e.g. &ldquo;mastodon.social&rdquo;</Trans>\n            </div>\n          )}\n          {/* <datalist id=\"instances-list\">\n            {instancesList.map((instance) => (\n              <option value={instance} />\n            ))}\n          </datalist> */}\n        </label>\n        {uiState === 'error' && (\n          <p class=\"error\">\n            <Trans>\n              Failed to log in. Please try again or try another instance.\n            </Trans>\n          </p>\n        )}\n        <div>\n          <button\n            disabled={\n              uiState === 'loading' || !instanceText || !selectedInstanceText\n            }\n          >\n            {selectedInstanceText\n              ? t`Continue with ${selectedInstanceText}`\n              : t`Continue`}\n          </button>{' '}\n        </div>\n        <Loader hidden={uiState !== 'loading'} />\n        <hr />\n        {!DEFAULT_INSTANCE && (\n          <p>\n            <a href=\"https://joinmastodon.org/servers\" target=\"_blank\">\n              <Trans>Don't have an account? Create one!</Trans>\n            </a>\n          </p>\n        )}\n        <p>\n          <Link to=\"/\">\n            <Trans>Go home</Trans>\n          </Link>\n        </p>\n        <LangSelector />\n      </form>\n    </main>\n  );\n}\n\nexport default Login;\n","import './scheduled-posts.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\nimport { MenuItem } from '@szhsin/react-menu';\nimport { useEffect, useMemo, useReducer, useState } from 'preact/hooks';\nimport { useSnapshot } from 'valtio';\n\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport MenuConfirm from '../components/menu-confirm';\nimport Menu2 from '../components/menu2';\nimport Modal from '../components/modal';\nimport NavMenu from '../components/nav-menu';\nimport RelativeTime from '../components/relative-time';\nimport ScheduledAtField, {\n  getLocalTimezoneName,\n} from '../components/ScheduledAtField';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport niceDateTime from '../utils/nice-date-time';\nimport showToast from '../utils/show-toast';\nimport states, { saveStatus, statusKey } from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst LIMIT = 40;\n\nexport default function ScheduledPosts() {\n  const { t } = useLingui();\n  const snapStates = useSnapshot(states);\n  useTitle(t`Scheduled Posts`, '/sp');\n  const { masto } = api();\n  const [scheduledPosts, setScheduledPosts] = useState([]);\n  const [uiState, setUIState] = useState('default');\n  const [reloadCount, reload] = useReducer((c) => c + 1, 0);\n  const [showScheduledPostModal, setShowScheduledPostModal] = useState(false);\n\n  useEffect(reload, [snapStates.reloadScheduledPosts]);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const postsIterator = masto.v1.scheduledStatuses\n          .list({ limit: LIMIT })\n          .values();\n        const allPosts = [];\n        let posts;\n        do {\n          const result = await postsIterator.next();\n          posts = result.value;\n          if (posts?.length) {\n            allPosts.push(...posts);\n          }\n        } while (posts?.length);\n        setScheduledPosts(allPosts);\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      } finally {\n        setUIState('default');\n      }\n    })();\n  }, [reloadCount]);\n\n  return (\n    <div id=\"scheduled-posts-page\" class=\"deck-container\" tabIndex=\"-1\">\n      <div class=\"timeline-deck deck\">\n        <header>\n          <div class=\"header-grid\">\n            <div class=\"header-side\">\n              <NavMenu />\n              <Link to=\"/\" class=\"button plain\">\n                <Icon icon=\"home\" size=\"l\" alt={t`Home`} />\n              </Link>\n            </div>\n            <h1>\n              <Trans>Scheduled Posts</Trans>\n            </h1>\n            <div class=\"header-side\">\n              <Menu2\n                portal\n                setDownOverflow\n                overflow=\"auto\"\n                viewScroll=\"close\"\n                position=\"anchor\"\n                menuButton={\n                  <button type=\"button\" class=\"plain\">\n                    <Icon icon=\"more\" size=\"l\" alt={t`More`} />\n                  </button>\n                }\n              >\n                <MenuItem\n                  onClick={() => {\n                    reload();\n                  }}\n                >\n                  <Icon icon=\"refresh\" size=\"l\" />\n                  <span>\n                    <Trans>Refresh</Trans>\n                  </span>\n                </MenuItem>\n              </Menu2>\n            </div>\n          </div>\n        </header>\n        <main>\n          {!scheduledPosts.length ? (\n            <p class=\"ui-state\">\n              {uiState === 'loading' ? <Loader /> : t`No scheduled posts.`}\n            </p>\n          ) : (\n            <ul class=\"posts-list\">\n              {scheduledPosts.map((post) => {\n                const { id, params, scheduledAt, mediaAttachments } = post;\n                const {\n                  inReplyToId,\n                  language,\n                  poll,\n                  sensitive,\n                  spoilerText,\n                  text,\n                  visibility,\n                  quotedStatusId,\n                  quoteApprovalPolicy,\n                } = params;\n                const status = {\n                  // account: account.info,\n                  id,\n                  inReplyToId,\n                  language,\n                  mediaAttachments,\n                  poll: poll\n                    ? {\n                        ...poll,\n                        expiresAt: new Date(Date.now() + poll.expiresIn * 1000),\n                        options: poll.options.map((option) => ({\n                          title: option,\n                          votesCount: 0,\n                        })),\n                      }\n                    : undefined,\n                  sensitive,\n                  spoilerText,\n                  text,\n                  visibility,\n                  content: `<p>${text}</p>`,\n                  // createdAt: scheduledAt,\n                  quotedStatusId,\n                  quoteApprovalPolicy,\n                };\n\n                return (\n                  <li key={id}>\n                    <ScheduledPostPreview\n                      status={status}\n                      scheduledAt={scheduledAt}\n                      onClick={() => {\n                        setShowScheduledPostModal({\n                          post: status,\n                          scheduledAt: new Date(scheduledAt),\n                        });\n                      }}\n                    />\n                  </li>\n                );\n              })}\n            </ul>\n          )}\n          {showScheduledPostModal && (\n            <Modal\n              onClick={(e) => {\n                if (e.target === e.currentTarget) {\n                  setShowScheduledPostModal(false);\n                }\n              }}\n            >\n              <ScheduledPostEdit\n                post={showScheduledPostModal.post}\n                scheduledAt={showScheduledPostModal.scheduledAt}\n                onClose={() => setShowScheduledPostModal(false)}\n              />\n            </Modal>\n          )}\n        </main>\n      </div>\n    </div>\n  );\n}\n\nfunction ScheduledPostPreview({ status, scheduledAt, onClick }) {\n  // Look at scheduledAt, if it's months away, ICON = 'month'. If it's days away, ICON = 'day', else ICON = 'time'\n  const icon = useMemo(() => {\n    const hours = (Date.parse(scheduledAt) - Date.now()) / (1000 * 60 * 60);\n    if (hours < 24) {\n      return 'time';\n    } else if (hours < 720) {\n      // 30 days\n      return 'day';\n    } else {\n      return 'month';\n    }\n  }, [scheduledAt]);\n\n  return (\n    <button type=\"button\" class=\"textual block\" onClick={onClick}>\n      <div class={`post-schedule-meta post-schedule-${icon}`}>\n        <Icon icon={icon} class=\"insignificant\" />{' '}\n        <span>\n          <Trans comment=\"Scheduled [in 1 day] ([Thu, Feb 27, 6:30:00 PM])\">\n            Scheduled{' '}\n            <b>\n              <RelativeTime datetime={scheduledAt} />\n            </b>{' '}\n            <small>\n              (\n              {niceDateTime(scheduledAt, {\n                formatOpts: {\n                  weekday: 'short',\n                  second: 'numeric',\n                },\n              })}\n              )\n            </small>\n          </Trans>\n        </span>\n      </div>\n      <Status status={status} size=\"s\" previewMode readOnly />\n    </button>\n  );\n}\n\nfunction ScheduledPostEdit({ post, scheduledAt, onClose }) {\n  const { masto, instance } = api();\n  const { t } = useLingui();\n  const [uiState, setUIState] = useState('default');\n  const [newScheduledAt, setNewScheduledAt] = useState();\n  const differentScheduledAt =\n    newScheduledAt && newScheduledAt.getTime() !== scheduledAt.getTime();\n  const localTZ = getLocalTimezoneName();\n  const pastSchedule = scheduledAt && scheduledAt <= Date.now();\n\n  const { inReplyToId } = post;\n  const [replyToStatus, setReplyToStatus] = useState(null);\n  // TODO: Uncomment this once https://github.com/mastodon/mastodon/issues/34000 is fixed\n  // useEffect(() => {\n  //   if (inReplyToId) {\n  //     (async () => {\n  //       try {\n  //         const status = await masto.v1.statuses.$select(inReplyToId).fetch();\n  //         setReplyToStatus(status);\n  //       } catch (e) {\n  //         console.error(e);\n  //       }\n  //     })();\n  //   }\n  // }, [inReplyToId]);\n\n  const { quotedStatusId } = post;\n  // TODO: Uncomment this once https://github.com/mastodon/mastodon/issues/36536 is fixed\n  // useEffect(() => {\n  //   if (post.id && quotedStatusId) {\n  //     (async () => {\n  //       try {\n  //         const quotedStatus = await masto.v1.statuses\n  //           .$select(quotedStatusId)\n  //           .fetch();\n  //         saveStatus(quotedStatus, instance);\n  //         const sKey = statusKey(post.id, instance);\n  //         states.statusQuotes[sKey] = [\n  //           {\n  //             id: quotedStatus.id,\n  //             instance,\n  //             url: `/${instance}/s/${quotedStatus.id}`,\n  //             native: true,\n  //           },\n  //         ];\n  //       } catch (e) {\n  //         console.error('Failed to fetch quoted status:', e);\n  //       }\n  //     })();\n  //   }\n  // }, [post.id, quotedStatusId]);\n\n  return (\n    <div id=\"scheduled-post-sheet\" class=\"sheet\">\n      <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n        <Icon icon=\"x\" size=\"l\" alt={t`Close`} />\n      </button>\n      <header>\n        <h2>\n          <Trans comment=\"Scheduled [in 1 day]\">\n            Scheduled{' '}\n            <b>\n              <RelativeTime datetime={scheduledAt} />\n            </b>\n          </Trans>\n          <br />\n          <small>\n            {niceDateTime(scheduledAt, {\n              formatOpts: {\n                weekday: 'short',\n                second: 'numeric',\n              },\n            })}\n          </small>\n        </h2>\n      </header>\n      <main tabIndex=\"-1\">\n        {!!replyToStatus && (\n          <div class=\"status-reply\">\n            <Status status={replyToStatus} size=\"s\" previewMode readOnly />\n          </div>\n        )}\n        <Status\n          status={post}\n          size=\"s\"\n          previewMode\n          readOnly\n          onMediaClick={(e, i, media, status) => {\n            e.preventDefault();\n            states.showMediaModal = {\n              mediaAttachments: post.mediaAttachments,\n              mediaIndex: i,\n            };\n          }}\n        />\n        <form\n          onSubmit={(e) => {\n            e.preventDefault();\n            setUIState('loading');\n            (async () => {\n              try {\n                await masto.v1.scheduledStatuses.$select(post.id).update({\n                  scheduledAt: newScheduledAt.toISOString(),\n                });\n                showToast(t`Scheduled post rescheduled`);\n                onClose();\n                setUIState('default');\n                states.reloadScheduledPosts++;\n              } catch (e) {\n                setUIState('error');\n                console.error(e);\n                showToast(t`Failed to reschedule post`);\n              }\n            })();\n          }}\n        >\n          <footer>\n            <div class=\"row\">\n              <span>\n                <ScheduledAtField\n                  scheduledAt={scheduledAt}\n                  setScheduledAt={(date) => {\n                    setNewScheduledAt(date);\n                  }}\n                />{' '}\n                <small class=\"ib\">{localTZ}</small>\n              </span>\n            </div>\n            <div class=\"row\">\n              <button\n                disabled={\n                  !differentScheduledAt || uiState === 'loading' || pastSchedule\n                }\n              >\n                <Trans>Reschedule</Trans>\n              </button>\n              <span class=\"grow\" />\n              <MenuConfirm\n                align=\"end\"\n                menuItemClassName=\"danger\"\n                confirmLabel={t`Delete scheduled post?`}\n                onClick={() => {\n                  setUIState('loading');\n                  (async () => {\n                    try {\n                      await api()\n                        .masto.v1.scheduledStatuses.$select(post.id)\n                        .remove();\n                      showToast(t`Scheduled post deleted`);\n                      onClose();\n                      setUIState('default');\n                      states.reloadScheduledPosts++;\n                    } catch (e) {\n                      setUIState('error');\n                      console.error(e);\n                      showToast(t`Failed to delete scheduled post`);\n                    }\n                  })();\n                }}\n              >\n                <button\n                  type=\"button\"\n                  class=\"light danger\"\n                  disabled={uiState === 'loading' || pastSchedule}\n                >\n                  <Trans>Delete</Trans>\n                </button>\n              </MenuConfirm>\n            </div>\n          </footer>\n        </form>\n      </main>\n    </div>\n  );\n}\n","import { useLingui } from '@lingui/react/macro';\n\nimport { useEditHistory } from '../utils/edit-history-context';\n\nimport Icon from './icon';\n\nexport default function EditHistoryControls() {\n  const { t } = useLingui();\n  const {\n    prevEditedAt,\n    nextEditedAt,\n    editedAtIndex,\n    editHistoryMode,\n    editHistoryRef,\n    exitEditHistory,\n  } = useEditHistory();\n  if (!editHistoryMode) return null;\n  return (\n    <div class=\"edit-history-controls\">\n      <Icon icon=\"edit\" />\n      <b class=\"edit-history-heading\">{t`Edit History Snapshots`}</b>\n      <span class=\"spacer\" />\n      <span class=\"edit-history-pagination\">\n        <button\n          type=\"button\"\n          class=\"plain4\"\n          onClick={() => {\n            prevEditedAt();\n          }}\n          disabled={\n            !editHistoryMode ||\n            editedAtIndex + 1 >= editHistoryRef.current.length\n          }\n        >\n          <Icon icon=\"chevron-left\" alt={t`Previous`} />\n        </button>{' '}\n        {editHistoryRef.current.length - editedAtIndex} /{' '}\n        {editHistoryRef.current.length}{' '}\n        <button\n          type=\"button\"\n          class=\"plain4\"\n          onClick={() => {\n            nextEditedAt();\n          }}\n          disabled={!editHistoryMode || editedAtIndex <= 0}\n        >\n          <Icon icon=\"chevron-right\" alt={t`Next`} />\n        </button>\n      </span>\n      <button\n        type=\"button\"\n        class=\"plain3\"\n        onClick={() => {\n          exitEditHistory();\n        }}\n      >\n        <Icon icon=\"exit\" alt={t`Exit`} />\n      </button>\n    </div>\n  );\n}\n","import './status.css';\n\nimport { plural } from '@lingui/core/macro';\nimport { Plural, Trans, useLingui } from '@lingui/react/macro';\nimport { MenuDivider, MenuHeader, MenuItem } from '@szhsin/react-menu';\nimport debounce from 'just-debounce-it';\nimport pRetry from 'p-retry';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport punycode from 'punycode/';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { matchPath, useSearchParams } from 'react-router-dom';\nimport { useSnapshot } from 'valtio';\n\nimport Avatar from '../components/avatar';\nimport EditHistoryControls from '../components/edit-history-controls';\nimport Icon from '../components/icon';\nimport Link from '../components/link';\nimport Loader from '../components/loader';\nimport { getSafeViewTransitionName } from '../components/media';\nimport MediaModal from '../components/media-modal';\nimport Menu2 from '../components/menu2';\nimport NameText from '../components/name-text';\nimport RelativeTime from '../components/relative-time';\nimport Status from '../components/status';\nimport { api } from '../utils/api';\nimport {\n  EditHistoryProvider,\n  useEditHistory,\n} from '../utils/edit-history-context';\nimport htmlContentLength from '../utils/html-content-length';\nimport shortenNumber from '../utils/shorten-number';\nimport states, {\n  getStatus,\n  saveStatus,\n  statusKey,\n  threadifyStatus,\n} from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport { getCurrentAccount } from '../utils/store-utils';\nimport useTitle from '../utils/useTitle';\n\nimport getInstanceStatusURL from './../utils/get-instance-status-url';\n\nconst { PHANPY_DEFAULT_INSTANCE: DEFAULT_INSTANCE } = import.meta.env;\n\nconst LIMIT = 40;\nconst SUBCOMMENTS_OPEN_ALL_LIMIT = 10;\nconst MAX_WEIGHT = 5;\n\nlet cachedRepliesToggle = {};\nlet cachedStatusesMap = {};\nlet scrollPositions = {};\nfunction resetScrollPosition(id) {\n  delete cachedStatusesMap[id];\n  delete scrollPositions[id];\n}\n\nconst scrollIntoViewOptions = {\n  block: 'nearest',\n  inline: 'center',\n  behavior: 'instant',\n};\n\n// Select all statuses except those inside collapsed details/summary\n// Hat-tip to @AmeliaBR@front-end.social\n// https://front-end.social/@AmeliaBR/109784776146144471\nconst STATUSES_SELECTOR =\n  '.status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)';\n\nconst STATUS_URL_REGEX = /\\/s\\//i;\n\nimport { ThreadCountContext } from '../utils/thread-count-context';\n\nfunction StatusPage(params) {\n  const { id } = params;\n  const { masto, instance } = api({ instance: params.instance });\n  const snapStates = useSnapshot(states);\n  const [searchParams, setSearchParams] = useSearchParams();\n  const mediaParam = searchParams.get('media');\n  const mediaOnlyParam = searchParams.get('media-only');\n  const mediaIndex = parseInt(mediaParam || mediaOnlyParam, 10);\n  let showMedia = mediaIndex > 0;\n  const mediaStatusID = searchParams.get('mediaStatusID');\n  const mediaStatus = getStatus(mediaStatusID, instance);\n  if (mediaStatusID && !mediaStatus) {\n    showMedia = false;\n  }\n  const showMediaOnly = showMedia && !!mediaOnlyParam;\n\n  const sKey = statusKey(id, instance);\n  const [heroStatus, setHeroStatus] = useState(states.statuses[sKey]);\n  useEffect(() => {\n    if (states.statuses[sKey]) {\n      setHeroStatus(states.statuses[sKey]);\n    }\n  }, [sKey]);\n\n  // Set canonical link, not for SEO, but for sharing\n  useEffect(() => {\n    if (!heroStatus || !heroStatus.url) return;\n\n    const existingCanonical = document.querySelector('link[rel=\"canonical\"]');\n    let originalHref = null;\n    let canonicalLink;\n\n    if (existingCanonical) {\n      originalHref = existingCanonical.href;\n      existingCanonical.href = heroStatus.url;\n    } else {\n      canonicalLink = document.createElement('link');\n      canonicalLink.rel = 'canonical';\n      canonicalLink.href = heroStatus.url;\n      document.head.appendChild(canonicalLink);\n    }\n\n    return () => {\n      if (existingCanonical && originalHref) {\n        existingCanonical.href = originalHref;\n      } else if (canonicalLink) {\n        document.head.removeChild(canonicalLink);\n      }\n    };\n  }, [heroStatus?.url]);\n\n  const closeLink = useMemo(() => {\n    const { prevLocation } = states;\n    const pathname =\n      (prevLocation?.pathname || '') + (prevLocation?.search || '');\n    const matchStatusPath =\n      matchPath('/:instance/s/:id', pathname) || matchPath('/s/:id', pathname);\n    if (!pathname || matchStatusPath) {\n      return '/';\n    }\n    return pathname;\n  }, []);\n\n  useEffect(() => {\n    if (!heroStatus && showMedia) {\n      (async () => {\n        try {\n          const status = await masto.v1.statuses.$select(id).fetch();\n          saveStatus(status, instance);\n          setHeroStatus(status);\n        } catch (err) {\n          console.error(err);\n          alert('Unable to load post.');\n          location.hash = closeLink;\n        }\n      })();\n    }\n  }, [showMedia]);\n\n  const mediaAttachments = mediaStatusID\n    ? snapStates.statuses[statusKey(mediaStatusID, instance)]?.mediaAttachments\n    : heroStatus?.mediaAttachments;\n\n  const postViewState = () =>\n    window.matchMedia('(min-width: calc(40em + 350px))').matches\n      ? 'large'\n      : 'small';\n  const mediaClose = useCallback(() => {\n    console.log('xxx', {\n      postViewState: postViewState(),\n      showMediaOnly,\n    });\n    if (postViewState() === 'small' && snapStates.prevLocation) {\n      history.back();\n    } else {\n      if (showMediaOnly) {\n        location.hash = closeLink;\n      } else {\n        searchParams.delete('media');\n        searchParams.delete('mediaStatusID');\n        setSearchParams(searchParams);\n      }\n    }\n  }, [showMediaOnly, closeLink, snapStates.prevLocation]);\n  const handleMediaClose = useCallback(\n    (e, currentIndex, mediaAttachments, carouselRef) => {\n      if (postViewState() === 'large' && !showMediaOnly) {\n        mediaClose();\n        return;\n      }\n      if (showMedia && document.startViewTransition) {\n        const media = mediaAttachments[currentIndex];\n        const { id, blurhash, url } = media;\n        const mediaVTN = getSafeViewTransitionName(id || blurhash || url);\n        const els = document.querySelectorAll(\n          `.status .media [data-view-transition-name=\"${mediaVTN}\"]`,\n        );\n        const foundEls = [...els]?.filter?.((el) => {\n          const elBounds = el.getBoundingClientRect();\n          return (\n            elBounds.top < window.innerHeight &&\n            elBounds.bottom > 0 &&\n            elBounds.left < window.innerWidth &&\n            elBounds.right > 0\n          );\n        });\n        // If more than one, get the one in status page\n        const el =\n          foundEls.length === 1\n            ? foundEls[0]\n            : foundEls.find((el) => !!el.closest('.status-deck'));\n\n        console.log('xxx', { media, id, els, el });\n        if (el) {\n          const transition = document.startViewTransition(() => {\n            el.style.viewTransitionName = mediaVTN;\n            if (carouselRef?.current) {\n              carouselRef.current\n                .querySelectorAll('.media img, .media video')\n                ?.forEach((el) => {\n                  el.style.viewTransitionName = '';\n                });\n            }\n            mediaClose();\n          });\n          transition.ready.finally(() => {\n            el.style.viewTransitionName = '';\n            el.dataset.viewTransitioned = mediaVTN;\n          });\n        } else {\n          mediaClose();\n        }\n      } else {\n        mediaClose();\n      }\n    },\n    [showMedia, showMediaOnly],\n  );\n\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      // carouselRef.current?.focus?.();\n      const $carousel = document.querySelector('.carousel');\n      if ($carousel) {\n        $carousel.focus();\n      }\n    }, 100);\n    return () => clearTimeout(timer);\n  }, [showMediaOnly]);\n\n  useEffect(() => {\n    const $deckContainers = document.querySelectorAll('.deck-container');\n    $deckContainers.forEach(($deckContainer) => {\n      $deckContainer.setAttribute('inert', '');\n    });\n    return () => {\n      $deckContainers.forEach(($deckContainer) => {\n        $deckContainer.removeAttribute('inert');\n      });\n    };\n  }, []);\n\n  return (\n    <div class=\"deck-backdrop\">\n      {showMedia ? (\n        mediaAttachments?.length ? (\n          <MediaModal\n            mediaAttachments={mediaAttachments}\n            statusID={mediaStatusID || id}\n            instance={instance}\n            lang={heroStatus?.language}\n            index={mediaIndex - 1}\n            onClose={handleMediaClose}\n          />\n        ) : (\n          <div class=\"media-modal-container loading\">\n            <Loader abrupt />\n          </div>\n        )\n      ) : (\n        <Link to={closeLink} />\n      )}\n      {!showMediaOnly && (\n        <EditHistoryProvider statusID={id}>\n          <StatusThread\n            id={id}\n            instance={params.instance}\n            closeLink={closeLink}\n          />\n        </EditHistoryProvider>\n      )}\n    </div>\n  );\n}\n\nfunction StatusParent(props) {\n  const { linkable, to, onClick, ...restProps } = props;\n  return linkable ? (\n    <Link class=\"status-link\" to={to} onClick={onClick} {...restProps} />\n  ) : (\n    <div class=\"status-focus\" tabIndex={0} {...restProps} />\n  );\n}\n\n// oldest first\nfunction createdAtSort(a, b) {\n  return Date.parse(a.createdAt) - Date.parse(b.createdAt);\n}\n\nconst MONTH_IN_MS = 1000 * 60 * 60 * 24 * 30;\n\nfunction StatusThread({ id, closeLink = '/', instance: propInstance }) {\n  const { t } = useLingui();\n  const [searchParams, setSearchParams] = useSearchParams();\n  const mediaParam = searchParams.get('media');\n  const mediaStatusID = searchParams.get('mediaStatusID');\n  const showMedia = parseInt(mediaParam, 10) > 0;\n  const firstLoad = useRef(\n    !states.prevLocation &&\n      (history.length === 1 ||\n        ('navigation' in window && navigation?.entries?.()?.length === 1)),\n  );\n  const [viewMode, setViewMode] = useState(\n    searchParams.get('view') || firstLoad.current ? 'full' : null,\n  );\n  const translate = !!parseInt(searchParams.get('translate'));\n  const { masto, instance } = api({ instance: propInstance });\n  const {\n    masto: currentMasto,\n    instance: currentInstance,\n    authenticated,\n  } = api();\n  const sameInstance = instance === currentInstance;\n  const snapStates = useSnapshot(states);\n  const [statuses, setStatuses] = useState([]);\n  const [uiState, setUIState] = useState('default');\n  const heroStatusRef = useRef();\n  const sKey = statusKey(id, instance);\n  const totalDescendants = useRef(0);\n\n  const scrollableRef = useRef();\n  useEffect(() => {\n    scrollableRef.current?.focus();\n  }, []);\n  useEffect(() => {\n    const onScroll = debounce(() => {\n      // console.log('onScroll');\n      if (!scrollableRef.current) return;\n      const { scrollTop } = scrollableRef.current;\n      if (uiState !== 'loading') {\n        scrollPositions[id] = scrollTop;\n      }\n    }, 50);\n    scrollableRef.current?.addEventListener('scroll', onScroll, {\n      passive: true,\n    });\n    onScroll();\n    return () => {\n      onScroll.cancel();\n      scrollableRef.current?.removeEventListener('scroll', onScroll);\n    };\n  }, [id, uiState !== 'loading']);\n\n  const { editHistoryMode, initEditHistory, editedAtIndex, editHistoryRef } =\n    useEditHistory();\n\n  const scrollOffsets = useRef();\n  const lastInitContextTS = useRef();\n  const [threadsCount, setThreadsCount] = useState(0);\n  const fullContext = useRef(null);\n  const restructureContext = () => {\n    console.log({ fullContext: fullContext.current });\n    if (!fullContext.current) return;\n    let { ancestors, descendants, heroStatus } = fullContext.current;\n\n    if (editHistoryMode && descendants?.length) {\n      // Filter descendants based on createdAt/editedAt dates\n      // - editHistory items only has createdAt\n      // - descendants items has createdAt and optional editedAt\n      const currentEditedAtStatus = editHistoryRef.current[editedAtIndex];\n      const currentEditedAtStatusCreatedAt = Date.parse(\n        currentEditedAtStatus.createdAt,\n      );\n      const nextEditedAtStatus = editHistoryRef.current[editedAtIndex - 1];\n      const nextEditedAtStatusCreatedAt = nextEditedAtStatus\n        ? Date.parse(nextEditedAtStatus.createdAt)\n        : null;\n      descendants = descendants.filter((s) => {\n        // Show descendants created between current and next editedAt dates\n        const sCreatedAt = Date.parse(s.editedAt || s.createdAt);\n        return (\n          sCreatedAt >= currentEditedAtStatusCreatedAt &&\n          (!nextEditedAtStatusCreatedAt ||\n            sCreatedAt <= nextEditedAtStatusCreatedAt)\n        );\n      });\n    }\n\n    ancestors.sort(createdAtSort);\n    descendants.sort(createdAtSort);\n\n    totalDescendants.current = descendants?.length || 0;\n\n    // Ghost posts - detect missing ancestors\n    const missingAncestorIds = new Set();\n    ancestors.forEach((status) => {\n      saveStatus(status, instance, {\n        skipThreading: true,\n      });\n      if (\n        status.inReplyToId &&\n        !ancestors.find((s) => s.id === status.inReplyToId)\n      ) {\n        missingAncestorIds.add(status.inReplyToId);\n      }\n    });\n    if (\n      heroStatus.inReplyToId &&\n      !ancestors.find((s) => s.id === heroStatus.inReplyToId)\n    ) {\n      missingAncestorIds.add(heroStatus.inReplyToId);\n    }\n\n    // Insert ghost statuses\n    missingAncestorIds.forEach((missingId) => {\n      const referencingStatus =\n        ancestors.find((s) => s.inReplyToId === missingId) ||\n        (heroStatus.inReplyToId === missingId ? heroStatus : null);\n      if (referencingStatus) {\n        const ghostStatus = {\n          id: missingId,\n          ghost: {\n            inReplyToAccountId: referencingStatus.inReplyToAccountId,\n          },\n        };\n        if (referencingStatus === heroStatus) {\n          ancestors.push(ghostStatus);\n        } else {\n          const insertIndex = ancestors.indexOf(referencingStatus);\n          ancestors.splice(insertIndex, 0, ghostStatus);\n        }\n      }\n    });\n\n    const missingStatuses = new Set();\n    const ancestorsIsThread = ancestors.every(\n      (s) => s.ghost || s.account.id === heroStatus.account.id,\n    );\n    const nestedDescendants = [];\n    descendants.forEach((status) => {\n      saveStatus(status, instance, {\n        // skipThreading: true,\n      });\n\n      if (\n        status.inReplyToId &&\n        !descendants.find((s) => s.id === status.inReplyToId) &&\n        status.inReplyToId !== heroStatus.id\n      ) {\n        missingStatuses.add(status.inReplyToId);\n      }\n\n      if (status.inReplyToAccountId === status.account.id) {\n        // If replying to self, it's part of the thread, level 1\n        nestedDescendants.push(status);\n      } else if (status.inReplyToId === heroStatus.id) {\n        // If replying to the hero status, it's a reply, level 1\n        nestedDescendants.push(status);\n      } else if (\n        !status.inReplyToAccountId &&\n        nestedDescendants.find(\n          (s) =>\n            s.id === status.inReplyToId &&\n            s.account.id === heroStatus.account.id,\n        ) &&\n        status.account.id === heroStatus.account.id\n      ) {\n        // If replying to hero's own statuses, it's part of the thread, level 1\n        nestedDescendants.push(status);\n      } else {\n        // If replying to someone else, it's a reply to a reply, level 2\n        const parent = descendants.find((s) => s.id === status.inReplyToId);\n        if (parent) {\n          if (!parent.__replies) {\n            parent.__replies = [];\n          }\n          parent.__replies.push(status);\n        } else {\n          // If no parent, something is wrong\n          console.warn('No parent found for', status);\n        }\n      }\n    });\n\n    // sort hero author to top\n    nestedDescendants.sort((a, b) => {\n      const heroAccountID = heroStatus.account.id;\n      if (a.account.id === heroAccountID && b.account.id !== heroAccountID)\n        return -1;\n      if (b.account.id === heroAccountID && a.account.id !== heroAccountID)\n        return 1;\n      return 0;\n    });\n\n    console.log({ ancestors, descendants, nestedDescendants });\n    if (missingStatuses.size) {\n      console.error('Missing statuses', [...missingStatuses]);\n    }\n\n    let descendantLevelsCount = 1;\n    function expandReplies(_replies, level) {\n      const nextLevel = level + 1;\n      if (nextLevel > descendantLevelsCount) {\n        descendantLevelsCount = level;\n      }\n      return _replies?.map((_r) => ({\n        id: _r.id,\n        account: _r.account,\n        repliesCount: _r.repliesCount,\n        content: _r.content,\n        weight: calcStatusWeight(_r),\n        level: nextLevel,\n        replies: expandReplies(_r.__replies, nextLevel),\n      }));\n    }\n\n    const mappedNestedDescendants = nestedDescendants.map((s) => ({\n      id: s.id,\n      account: s.account,\n      accountID: s.account.id,\n      descendant: true,\n      thread: s.account.id === heroStatus.account.id,\n      weight: calcStatusWeight(s),\n      level: 1,\n      replies: expandReplies(s.__replies, 1),\n      createdAt: s.createdAt,\n    }));\n    const allStatuses = [\n      ...ancestors.map((s) => ({\n        id: s.id,\n        ancestor: true,\n        ghost: s.ghost,\n        isThread: ancestorsIsThread && !s.ghost,\n        accountID: s.account?.id,\n        account: s.account,\n        repliesCount: s.repliesCount,\n        weight: s.ghost ? 0 : calcStatusWeight(s),\n        createdAt: s.createdAt,\n      })),\n      {\n        id,\n        accountID: heroStatus.account.id,\n        weight: calcStatusWeight(heroStatus),\n        createdAt: heroStatus.createdAt,\n      },\n      ...mappedNestedDescendants,\n    ];\n\n    console.log({ allStatuses, descendantLevelsCount });\n    return { allStatuses, ancestorsIsThread, mappedNestedDescendants };\n  };\n\n  const initContext = ({ reloadHero } = {}) => {\n    console.debug('initContext', id);\n    setUIState('loading');\n    let heroTimer;\n\n    const cachedStatuses = cachedStatusesMap[id];\n    if (cachedStatuses) {\n      // Case 1: It's cached, let's restore them to make it snappy\n      const reallyCachedStatuses = cachedStatuses.filter(\n        (s) => states.statuses[sKey],\n        // Some are not cached in the global state, so we need to filter them out\n      );\n      setStatuses(reallyCachedStatuses);\n    } else {\n      // const heroIndex = statuses.findIndex((s) => s.id === id);\n      // if (heroIndex !== -1) {\n      //   // Case 2: It's in current statuses. Slice off all descendant statuses after the hero status to be safe\n      //   const slicedStatuses = statuses.slice(0, heroIndex + 1);\n      //   setStatuses(slicedStatuses);\n      // } else {\n      // Case 3: Not cached and not in statuses, let's start from scratch\n      setStatuses([{ id }]);\n      // }\n    }\n\n    (async () => {\n      const heroFetch = () =>\n        pRetry(() => masto.v1.statuses.$select(id).fetch(), {\n          retries: 4,\n        });\n      const contextFetch = pRetry(\n        () => masto.v1.statuses.$select(id).context.fetch(),\n        {\n          retries: 8,\n        },\n      );\n\n      const hasStatus = !!snapStates.statuses[sKey];\n      let heroStatus = snapStates.statuses[sKey];\n      if (hasStatus && !reloadHero) {\n        console.debug('Hero status is cached');\n      } else {\n        try {\n          heroStatus = await heroFetch();\n          saveStatus(heroStatus, instance);\n          // Give time for context to appear\n          await new Promise((resolve) => {\n            setTimeout(resolve, 100);\n          });\n        } catch (e) {\n          console.error(e);\n          setUIState('error');\n          return;\n        }\n      }\n\n      try {\n        const context = await contextFetch;\n        const { ancestors } = context;\n        fullContext.current = { ...context, heroStatus };\n        const { allStatuses, ancestorsIsThread, mappedNestedDescendants } =\n          restructureContext();\n\n        const descendantsThread =\n          ancestors.length && !ancestorsIsThread\n            ? []\n            : mappedNestedDescendants.filter((s) => s.thread);\n        const threadsCount =\n          (ancestorsIsThread ? ancestors.length : 0) + descendantsThread.length;\n        if (threadsCount > 0 && threadsCount < 100) {\n          // Cap at 100 because there's no point showing 100+\n          // Include hero as part of thread count\n          setThreadsCount(threadsCount + 1);\n        }\n\n        setUIState('default');\n        scrollOffsets.current = {\n          offsetTop: heroStatusRef.current?.offsetTop,\n          scrollTop: scrollableRef.current?.scrollTop,\n        };\n\n        // Set limit to hero's index\n        // const heroLimit = allStatuses.findIndex((s) => s.id === id);\n        const heroLimit = ancestors.length || 0; // 0-indexed\n        if (heroLimit >= limit) {\n          setLimit(heroLimit + 1);\n        }\n\n        setStatuses(allStatuses);\n        cachedStatusesMap[id] = allStatuses;\n\n        // Let's threadify this one\n        // Note that all non-hero statuses will trigger saveStatus which will threadify them too\n        // By right, at this point, all descendant statuses should be cached\n        threadifyStatus(heroStatus, instance);\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n\n    lastInitContextTS.current = Date.now();\n\n    return () => {\n      clearTimeout(heroTimer);\n    };\n  };\n\n  useEffect(initContext, [id, masto]);\n\n  useEffect(() => {\n    try {\n      const { allStatuses } = restructureContext();\n      setStatuses(allStatuses);\n    } catch (e) {}\n    // Only run this when editHistoryMode changes\n    // If id changes, initContext will run instead, so don't worry\n  }, [editHistoryMode, editedAtIndex]);\n\n  const [showRefresh, setShowRefresh] = useState(false);\n  useEffect(() => {\n    let interval = setInterval(() => {\n      const now = Date.now();\n      if (\n        lastInitContextTS.current &&\n        now - lastInitContextTS.current >= 60_000\n      ) {\n        setShowRefresh(true);\n      }\n    }, 60_000); // 1 minute\n    return () => {\n      clearInterval(interval);\n    };\n  }, []);\n\n  useLayoutEffect(() => {\n    if (!statuses.length) return;\n    console.debug('STATUSES', statuses);\n    const scrollPosition = scrollPositions[id];\n    console.debug('scrollPosition', scrollPosition);\n    if (!!scrollPosition) {\n      console.debug('Case 1', {\n        id,\n        scrollPosition,\n      });\n      scrollableRef.current.scrollTop = scrollPosition;\n    } else if (scrollOffsets.current) {\n      const newScrollOffsets = {\n        offsetTop: heroStatusRef.current?.offsetTop,\n        scrollTop: scrollableRef.current?.scrollTop,\n      };\n      const newScrollTop =\n        newScrollOffsets.offsetTop -\n        scrollOffsets.current.offsetTop +\n        newScrollOffsets.scrollTop;\n      console.debug('Case 2', {\n        scrollOffsets: scrollOffsets.current,\n        newScrollOffsets,\n        newScrollTop,\n        statuses: [...statuses],\n      });\n      scrollableRef.current.scrollTop = newScrollTop;\n    } else if (statuses.length === 1) {\n      console.debug('Case 3', {\n        id,\n      });\n      scrollableRef.current.scrollTop = 0;\n    }\n\n    // RESET\n    scrollOffsets.current = null;\n  }, [statuses]);\n\n  useEffect(() => {\n    if (snapStates.reloadStatusPage <= 0) return;\n    // Delete the cache for the context\n    (async () => {\n      try {\n        const { instanceURL } = getCurrentAccount();\n        const contextURL = `https://${instanceURL}/api/v1/statuses/${id}/context`;\n        console.log('Clear cache', contextURL);\n        const apiCache = await caches.open('api');\n        await apiCache.delete(contextURL, { ignoreVary: true });\n\n        return initContext({\n          reloadHero: true,\n        });\n      } catch (e) {\n        console.error(e);\n      }\n    })();\n  }, [snapStates.reloadStatusPage]);\n\n  useEffect(() => {\n    return () => {\n      // RESET\n      scrollPositions = {};\n      states.reloadStatusPage = 0;\n      cachedStatusesMap = {};\n      cachedRepliesToggle = {};\n      statusWeightCache.clear();\n    };\n  }, []);\n\n  const heroStatus = snapStates.statuses[sKey] || snapStates.statuses[id];\n  const heroDisplayName = useMemo(() => {\n    // Remove shortcodes from display name\n    if (!heroStatus) return '';\n    const { account } = heroStatus;\n    const div = document.createElement('div');\n    div.innerHTML = account.displayName;\n    return div.innerText.trim();\n  }, [heroStatus]);\n  const heroContentText = useMemo(() => {\n    if (!heroStatus) return '';\n    let text = statusPeek(heroStatus);\n    if (text.length > 64) {\n      // \"The title should ideally be less than 64 characters in length\"\n      // https://www.w3.org/Provider/Style/TITLE.html\n      text = text.slice(0, 64) + '';\n    }\n    return text;\n  }, [heroStatus]);\n  useTitle(\n    heroDisplayName && heroContentText\n      ? `${heroDisplayName}: \"${heroContentText}\"`\n      : t({\n          id: 'post.title',\n          message: 'Post',\n        }),\n    '/:instance?/s/:id',\n  );\n\n  const postInstance = useMemo(() => {\n    if (!heroStatus) return;\n    const { url } = heroStatus;\n    if (!url) return;\n    return URL.parse(url)?.hostname;\n  }, [heroStatus]);\n  const postSameInstance = useMemo(() => {\n    if (!postInstance) return;\n    return postInstance === instance;\n  }, [postInstance, instance]);\n\n  const [limit, setLimit] = useState(LIMIT);\n  const showMore = useMemo(() => {\n    // return number of statuses to show\n    return statuses.length - limit;\n  }, [statuses.length, limit]);\n\n  const hasDescendants = statuses.some((s) => s.descendant);\n  const ancestors = statuses.filter((s) => s.ancestor);\n\n  const [heroInView, setHeroInView] = useState(true);\n  const heroPointer = useMemo(() => {\n    // get top offset of heroStatus\n    if (!heroStatusRef.current || heroInView) return null;\n    const { top } = heroStatusRef.current.getBoundingClientRect();\n    return top > 0 ? 'down' : 'up';\n  }, [heroInView]);\n\n  useHotkeys(\n    'esc',\n    () => {\n      location.hash = closeLink;\n    },\n    {\n      // If media is open, esc to close media first\n      // Else close the status page\n      enabled: !showMedia,\n      ignoreEventWhen: (e) => {\n        const hasModal = !!document.querySelector('#modal-container > *');\n        return hasModal || e.metaKey || e.ctrlKey || e.altKey || e.shiftKey;\n      },\n      useKey: true,\n    },\n  );\n  // For backspace, will always close both media and status page\n  useHotkeys(\n    'backspace',\n    () => {\n      location.hash = closeLink;\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  useHotkeys(\n    'j',\n    () => {\n      const activeStatus = document.activeElement.closest(\n        '.status-link, .status-focus',\n      );\n      const activeStatusRect = activeStatus?.getBoundingClientRect();\n      const allStatusLinks = Array.from(\n        scrollableRef.current.querySelectorAll(STATUSES_SELECTOR),\n      );\n      console.log({ allStatusLinks });\n      if (\n        activeStatus &&\n        activeStatusRect.top < scrollableRef.current.clientHeight &&\n        activeStatusRect.bottom > 0\n      ) {\n        const activeStatusIndex = allStatusLinks.indexOf(activeStatus);\n        let nextStatus = allStatusLinks[activeStatusIndex + 1];\n        if (nextStatus) {\n          nextStatus.focus();\n          nextStatus.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostStatusLink = allStatusLinks.find((statusLink) => {\n          const statusLinkRect = statusLink.getBoundingClientRect();\n          return statusLinkRect.top >= 44 && statusLinkRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostStatusLink) {\n          topmostStatusLink.focus();\n          topmostStatusLink.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  useHotkeys(\n    'k',\n    () => {\n      const activeStatus = document.activeElement.closest(\n        '.status-link, .status-focus',\n      );\n      const activeStatusRect = activeStatus?.getBoundingClientRect();\n      const allStatusLinks = Array.from(\n        scrollableRef.current.querySelectorAll(STATUSES_SELECTOR),\n      );\n      if (\n        activeStatus &&\n        activeStatusRect.top < scrollableRef.current.clientHeight &&\n        activeStatusRect.bottom > 0\n      ) {\n        const activeStatusIndex = allStatusLinks.indexOf(activeStatus);\n        let prevStatus = allStatusLinks[activeStatusIndex - 1];\n        if (prevStatus) {\n          prevStatus.focus();\n          prevStatus.scrollIntoView(scrollIntoViewOptions);\n        }\n      } else {\n        // If active status is not in viewport, get the topmost status-link in viewport\n        const topmostStatusLink = allStatusLinks.find((statusLink) => {\n          const statusLinkRect = statusLink.getBoundingClientRect();\n          return statusLinkRect.top >= 44 && statusLinkRect.left >= 0; // 44 is the magic number for header height, not real\n        });\n        if (topmostStatusLink) {\n          topmostStatusLink.focus();\n          topmostStatusLink.scrollIntoView(scrollIntoViewOptions);\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  // NOTE: I'm not sure if 'x' is the best shortcut for this, might change it later\n  // IDEA: x is for expand\n  useHotkeys(\n    'x',\n    () => {\n      const activeStatus = document.activeElement.closest(\n        '.status-link, .status-focus',\n      );\n      if (activeStatus) {\n        const details = activeStatus.nextElementSibling;\n        if (details && details.tagName.toLowerCase() === 'details') {\n          details.open = !details.open;\n        }\n      }\n    },\n    {\n      useKey: true,\n      ignoreEventWhen: (e) => e.metaKey || e.ctrlKey || e.altKey || e.shiftKey,\n    },\n  );\n\n  const [reachTopPost, setReachTopPost] = useState(false);\n  // const { nearReachStart } = useScroll({\n  //   scrollableRef,\n  //   distanceFromStartPx: 16,\n  // });\n\n  const initialPageState = useRef(showMedia ? 'media+status' : 'status');\n\n  const handleMediaClick = useCallback(\n    (e, i, media, status) => {\n      e.preventDefault();\n      e.stopPropagation();\n      setSearchParams({\n        media: i + 1,\n        mediaStatusID: status.id,\n      });\n    },\n    [id],\n  );\n\n  const handleStatusLinkClick = useCallback((e, status) => {\n    resetScrollPosition(status.id);\n  }, []);\n\n  useEffect(() => {\n    let timer;\n    if (mediaStatusID && showMedia) {\n      timer = setTimeout(() => {\n        const status = scrollableRef.current?.querySelector(\n          `.status-link[href*=\"/${mediaStatusID}\"]`,\n        );\n        if (status) {\n          status.scrollIntoView(scrollIntoViewOptions);\n        }\n      }, 400); // After CSS transition\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [mediaStatusID, showMedia]);\n\n  const renderStatus = useCallback(\n    (status, i) => {\n      const {\n        id: statusID,\n        ancestor,\n        ghost,\n        isThread,\n        descendant,\n        thread,\n        replies,\n        repliesCount,\n        weight,\n        level,\n      } = status;\n      const isHero = statusID === id;\n      const isLinkable = !ghost && (isThread || ancestor);\n\n      return (\n        <li\n          key={statusID}\n          ref={isHero ? heroStatusRef : null}\n          class={`${ancestor ? 'ancestor' : ''} ${\n            descendant ? 'descendant' : ''\n          } ${thread ? 'thread' : ''} ${isHero ? 'hero' : ''}`}\n        >\n          {isHero ? (\n            <>\n              <InView\n                threshold={0.1}\n                onChange={(inView) => {\n                  queueMicrotask(() => {\n                    requestAnimationFrame(() => {\n                      setHeroInView(inView);\n                    });\n                  });\n                }}\n                class=\"status-focus\"\n                tabIndex={0}\n              >\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  withinContext\n                  size=\"l\"\n                  enableTranslate\n                  forceTranslate={translate}\n                />\n              </InView>\n              {uiState !== 'loading' && !authenticated ? (\n                <div class=\"post-status-banner\">\n                  <p>\n                    <Trans>\n                      You're not logged in. Interactions (reply, boost, etc) are\n                      not possible.\n                    </Trans>\n                  </p>\n                  <Link\n                    to={\n                      DEFAULT_INSTANCE\n                        ? `/login?instance=${DEFAULT_INSTANCE}&submit=1`\n                        : '/login'\n                    }\n                    class=\"button\"\n                  >\n                    <Trans>Log in</Trans>\n                  </Link>\n                </div>\n              ) : (\n                !sameInstance && (\n                  <div class=\"post-status-banner\">\n                    <p>\n                      <Trans>\n                        This post is from another instance (<b>{instance}</b>).\n                        Interactions (reply, boost, etc) are not possible.\n                      </Trans>\n                    </p>\n                    <button\n                      type=\"button\"\n                      disabled={uiState === 'loading'}\n                      onClick={() => {\n                        setUIState('loading');\n                        (async () => {\n                          try {\n                            const results = await currentMasto.v2.search.list({\n                              q: heroStatus.url,\n                              type: 'statuses',\n                              resolve: true,\n                              limit: 1,\n                            });\n                            if (results.statuses.length) {\n                              const status = results.statuses[0];\n                              location.hash = currentInstance\n                                ? `/${currentInstance}/s/${status.id}`\n                                : `/s/${status.id}`;\n                            } else {\n                              throw new Error('No results');\n                            }\n                          } catch (e) {\n                            setUIState('default');\n                            alert(t`Error: ${e}`);\n                            console.error(e);\n                          }\n                        })();\n                      }}\n                    >\n                      <Icon icon=\"transfer\" />{' '}\n                      <Trans>\n                        Switch to my instance to enable interactions\n                      </Trans>\n                    </button>\n                  </div>\n                )\n              )}\n            </>\n          ) : (\n            <StatusParent\n              linkable={isLinkable}\n              to={instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`}\n              onClick={() => {\n                resetScrollPosition(statusID);\n              }}\n            >\n              {/* <Link\n              class=\"status-link\"\n              to={instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`}\n              onClick={() => {\n                resetScrollPosition(statusID);\n              }}\n            > */}\n              {ghost ? (\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  withinContext\n                  size=\"m\"\n                  ghost={ghost}\n                />\n              ) : i === 0 && ancestor ? (\n                <InView\n                  threshold={0.5}\n                  onChange={(inView) => {\n                    queueMicrotask(() => {\n                      requestAnimationFrame(() => {\n                        setReachTopPost(inView);\n                      });\n                    });\n                  }}\n                >\n                  <Status\n                    statusID={statusID}\n                    instance={instance}\n                    withinContext\n                    size={thread || ancestor ? 'm' : 's'}\n                    enableTranslate\n                    onMediaClick={handleMediaClick}\n                    onStatusLinkClick={handleStatusLinkClick}\n                  />\n                </InView>\n              ) : (\n                <Status\n                  statusID={statusID}\n                  instance={instance}\n                  withinContext\n                  size={thread || ancestor ? 'm' : 's'}\n                  enableTranslate\n                  onMediaClick={handleMediaClick}\n                  onStatusLinkClick={handleStatusLinkClick}\n                  showActionsBar={!!descendant}\n                />\n              )}\n              {ancestor && repliesCount > 1 && (\n                <div class=\"replies-link\">\n                  <Icon icon=\"comment2\" alt={t`Replies`} />{' '}\n                  <span title={repliesCount}>\n                    {shortenNumber(repliesCount)}\n                  </span>\n                </div>\n              )}{' '}\n              {/* {replies?.length > LIMIT && (\n                        <div class=\"replies-link\">\n                          <Icon icon=\"comment\" />{' '}\n                          <span title={replies.length}>\n                            {shortenNumber(replies.length)}\n                          </span>\n                        </div>\n                      )} */}\n            </StatusParent>\n            // </Link>\n          )}\n          {descendant && replies?.length > 0 && (\n            <SubComments\n              instance={instance}\n              replies={replies}\n              hasParentThread={thread}\n              level={level}\n              accWeight={weight}\n              openAll={totalDescendants.current < SUBCOMMENTS_OPEN_ALL_LIMIT}\n              parentLink={{\n                to: instance ? `/${instance}/s/${statusID}` : `/s/${statusID}`,\n                onClick: () => resetScrollPosition(statusID),\n              }}\n            />\n          )}\n          {uiState === 'loading' &&\n            isHero &&\n            !!heroStatus?.repliesCount &&\n            !hasDescendants && (\n              <div class=\"status-loading\">\n                <Loader abrupt={heroStatus.repliesCount >= 3} />\n              </div>\n            )}\n          {uiState === 'error' &&\n            isHero &&\n            !!heroStatus?.repliesCount &&\n            !hasDescendants && (\n              <div class=\"status-error\">\n                <Trans>Unable to load replies.</Trans>\n                <br />\n                <button\n                  type=\"button\"\n                  class=\"plain\"\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                  }}\n                >\n                  <Trans>Try again</Trans>\n                </button>\n              </div>\n            )}\n        </li>\n      );\n    },\n    [\n      id,\n      instance,\n      uiState,\n      authenticated,\n      sameInstance,\n      translate,\n      handleMediaClick,\n      handleStatusLinkClick,\n      hasDescendants,\n    ],\n  );\n\n  const prevLocationIsStatusPage = useMemo(() => {\n    // Navigation API\n    if ('navigation' in window && navigation?.entries) {\n      const prevEntry = navigation.entries()[navigation.currentEntry.index - 1];\n      if (prevEntry?.url) {\n        return STATUS_URL_REGEX.test(prevEntry.url);\n      }\n    }\n    return STATUS_URL_REGEX.test(states.prevLocation?.pathname);\n  }, [sKey]);\n\n  const moreStatusesKeys = useMemo(() => {\n    if (!showMore) return [];\n    const ids = [];\n    function getIDs(status) {\n      ids.push(status.id);\n      if (status.replies) {\n        status.replies.forEach(getIDs);\n      }\n    }\n    statuses.slice(limit).forEach(getIDs);\n    return ids.map((id) => statusKey(id, instance));\n  }, [showMore, statuses, limit, instance]);\n\n  // Helper function to format time differences between two dates\n  function formatTimeGap(months) {\n    if (months < 12) {\n      return plural(months, {\n        one: '# month later',\n        other: '# months later',\n      });\n    } else {\n      const years = Math.floor(months / 12);\n      return plural(years, {\n        one: '# year later',\n        other: '# years later',\n      });\n    }\n  }\n\n  const statusesList = useMemo(() => {\n    const result = [];\n    const slicedStatuses = statuses.slice(0, limit);\n\n    for (let i = 0; i < slicedStatuses.length; i++) {\n      const status = slicedStatuses[i];\n\n      // Add time gap indicator if needed\n      if (i > 0) {\n        const prevStatus = slicedStatuses[i - 1];\n\n        const { createdAt, descendant, thread, id } = status;\n\n        if (prevStatus?.createdAt && createdAt) {\n          const currentDate = Date.parse(createdAt);\n          if (isFinite(currentDate) && currentDate > MONTH_IN_MS) {\n            const prevDate = Date.parse(prevStatus.createdAt);\n\n            if (prevDate && isFinite(prevDate)) {\n              const { ancestor, id: prevID } = prevStatus;\n              const timeDiff = currentDate - prevDate;\n              const monthsDiff = ~~(timeDiff / MONTH_IN_MS);\n\n              if (monthsDiff > 0) {\n                result.push(\n                  <li\n                    key={`time-gap-${id}-${prevID}`}\n                    style={{\n                      '--time-gap-range': Math.min(12, monthsDiff),\n                    }}\n                    class={`time-gap ${ancestor ? 'ancestor' : ''} ${descendant ? 'descendant' : ''} ${\n                      thread ? 'thread' : ''\n                    }`}\n                  >\n                    {formatTimeGap(monthsDiff)}\n                  </li>,\n                );\n              } else {\n                // NOTE: For testing purposes\n                // result.push(\n                //   <li\n                //     key={`time-gap-${id}`}\n                //     class={`time-gap ${ancestor ? 'ancestor' : ''} ${descendant ? 'descendant' : ''} ${\n                //       thread ? 'thread' : ''\n                //     }`}\n                //   >\n                //     One eternity later\n                //   </li>,\n                // );\n              }\n            }\n          }\n        }\n      }\n\n      result.push(renderStatus(status, i));\n    }\n\n    return result;\n  }, [statuses, limit, renderStatus, editHistoryMode, editedAtIndex]);\n\n  // If there's spoiler in hero status, auto-expand it\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      if (!heroStatusRef.current) return;\n      const spoilerButton = heroStatusRef.current.querySelector(\n        '.spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)',\n      );\n      if (spoilerButton) spoilerButton.click();\n    }, 1000);\n    return () => clearTimeout(timer);\n  }, [id]);\n\n  return (\n    <ThreadCountContext.Provider value={threadsCount}>\n      <div\n        tabIndex=\"-1\"\n        ref={scrollableRef}\n        class={`status-deck deck contained ${\n          statuses.length > 1 ? 'padded-bottom' : ''\n        } ${\n          initialPageState.current === 'status' && !firstLoad.current\n            ? 'slide-in'\n            : ''\n        } ${viewMode ? `deck-view-${viewMode}` : ''} ${\n          editHistoryMode ? 'edit-history-mode' : ''\n        }`}\n        style={\n          editHistoryMode\n            ? {\n                '--edit-history-percentage': `${editedAtIndex / (editHistoryRef.current.length - 1)}`,\n              }\n            : undefined\n        }\n        onAnimationEnd={(e) => {\n          // Fix the bounce effect when switching viewMode\n          // `slide-in` animation kicks in when switching viewMode\n          if (initialPageState.current === 'status') {\n            // e.target.classList.remove('slide-in');\n            initialPageState.current = null;\n          }\n        }}\n      >\n        <header\n          class={`${uiState === 'loading' ? 'loading' : ''}`}\n          onDblClick={(e) => {\n            // reload statuses\n            states.reloadStatusPage++;\n          }}\n        >\n          {/* <div>\n            <Link class=\"button plain deck-close\" href={closeLink}>\n              <Icon icon=\"chevron-left\" size=\"xl\" />\n            </Link>\n          </div> */}\n          <div class=\"header-grid header-grid-2\">\n            <h1>\n              {prevLocationIsStatusPage && (\n                <button\n                  type=\"button\"\n                  class=\"plain deck-back\"\n                  onClick={() => {\n                    history.back();\n                  }}\n                >\n                  <Icon icon=\"chevron-left\" size=\"xl\" alt={t`Back`} />\n                </button>\n              )}\n              {!heroInView && heroStatus && uiState !== 'loading' ? (\n                <>\n                  <span class=\"hero-heading\">\n                    <NameText\n                      account={heroStatus.account}\n                      instance={instance}\n                      showAvatar\n                      short\n                    />{' '}\n                    <span class=\"insignificant\">\n                      &bull;{' '}\n                      <RelativeTime\n                        datetime={heroStatus.createdAt}\n                        format=\"micro\"\n                      />\n                    </span>\n                  </span>{' '}\n                  <button\n                    type=\"button\"\n                    class=\"ancestors-indicator light small\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      heroStatusRef.current.scrollIntoView({\n                        behavior: 'smooth',\n                        block: 'start',\n                      });\n                    }}\n                    title={t`Go to main post`}\n                  >\n                    <Icon\n                      icon={heroPointer === 'down' ? 'arrow-down' : 'arrow-up'}\n                    />\n                  </button>\n                </>\n              ) : (\n                <>\n                  <Trans id=\"post.title\">Post</Trans>{' '}\n                  <button\n                    type=\"button\"\n                    class=\"ancestors-indicator light small\"\n                    onClick={(e) => {\n                      // Scroll to top\n                      e.preventDefault();\n                      e.stopPropagation();\n                      scrollableRef.current.scrollTo({\n                        top: 0,\n                        behavior: 'smooth',\n                      });\n                    }}\n                    hidden={!ancestors.length || reachTopPost}\n                    title={t`${ancestors.length} posts above  Go to top`}\n                  >\n                    <Icon icon=\"arrow-up\" />\n                    {ancestors\n                      .filter((a) => !a.ghost)\n                      .filter(\n                        (a, i, arr) =>\n                          arr.findIndex((b) => b.accountID === a.accountID) ===\n                          i,\n                      )\n                      .slice(0, 3)\n                      .map((ancestor) => (\n                        <Avatar\n                          key={ancestor.account.id}\n                          url={\n                            ancestor.account.avatarStatic ||\n                            ancestor.account.avatar\n                          }\n                          alt={ancestor.account.displayName}\n                          squircle={ancestor.account?.bot}\n                        />\n                      ))}\n                    {/* <Icon icon=\"comment\" />{' '} */}\n                    {ancestors.length > 3 && (\n                      <>\n                        {' '}\n                        <span class=\"insignificant\">\n                          {shortenNumber(ancestors.length)}\n                        </span>\n                      </>\n                    )}\n                  </button>\n                </>\n              )}\n            </h1>\n            <div class=\"header-side\">\n              <button\n                type=\"button\"\n                class=\"plain4 button-switch-view\"\n                style={{\n                  display: viewMode === 'full' ? '' : 'none',\n                }}\n                onClick={() => {\n                  setViewMode(null);\n                  searchParams.delete('media');\n                  searchParams.delete('media-only');\n                  searchParams.delete('view');\n                  setSearchParams(searchParams);\n                }}\n                title={t`Switch to Side Peek view`}\n              >\n                <Icon icon=\"layout4\" size=\"l\" />\n              </button>\n              {showRefresh && (\n                <button\n                  type=\"button\"\n                  class=\"plain button-refresh\"\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                    setShowRefresh(false);\n                  }}\n                >\n                  <Icon icon=\"refresh\" size=\"l\" alt={t`Refresh`} />\n                </button>\n              )}\n              <Menu2\n                align=\"end\"\n                portal={{\n                  // Need this, else the menu click will cause scroll jump\n                  target: scrollableRef.current,\n                }}\n                menuButton={\n                  <button type=\"button\" class=\"button plain4\">\n                    <Icon icon=\"more\" alt={t`More`} size=\"xl\" />\n                  </button>\n                }\n              >\n                <MenuItem\n                  disabled={uiState === 'loading'}\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                  }}\n                >\n                  <Icon icon=\"refresh\" />\n                  <span>\n                    <Trans>Refresh</Trans>\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  className=\"menu-switch-view\"\n                  onClick={() => {\n                    setViewMode(viewMode === 'full' ? null : 'full');\n                    searchParams.delete('media');\n                    searchParams.delete('media-only');\n                    if (viewMode === 'full') {\n                      searchParams.delete('view');\n                    } else {\n                      searchParams.set('view', 'full');\n                    }\n                    setSearchParams(searchParams);\n                  }}\n                >\n                  <Icon\n                    icon={\n                      {\n                        '': 'layout5',\n                        full: 'layout4',\n                      }[viewMode || '']\n                    }\n                  />\n                  <span>\n                    {viewMode === 'full'\n                      ? t`Switch to Side Peek view`\n                      : t`Switch to Full view`}\n                  </span>\n                </MenuItem>\n                <MenuItem\n                  onClick={() => {\n                    // Click all buttons with class .spoiler but not .spoiling\n                    const buttons = Array.from(\n                      scrollableRef.current.querySelectorAll(\n                        '.spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)',\n                      ),\n                    );\n                    buttons.forEach((button) => {\n                      button.click();\n                    });\n                  }}\n                >\n                  <Icon icon=\"eye-open\" />{' '}\n                  <span>\n                    <Trans>Show all sensitive content</Trans>\n                  </span>\n                </MenuItem>\n                <MenuDivider />\n                <MenuHeader className=\"plain\">\n                  <Trans>Experimental</Trans>\n                </MenuHeader>\n                <MenuItem\n                  disabled={!postInstance || postSameInstance}\n                  onClick={() => {\n                    const statusURL = getInstanceStatusURL(heroStatus.url);\n                    if (statusURL) {\n                      location.hash = statusURL;\n                    } else {\n                      alert(t`Unable to switch`);\n                    }\n                  }}\n                >\n                  <Icon icon=\"transfer\" />\n                  <small class=\"menu-double-lines\">\n                    {postInstance\n                      ? t`Switch to post's instance (${punycode.toUnicode(\n                          postInstance,\n                        )})`\n                      : t`Switch to post's instance`}\n                  </small>\n                </MenuItem>\n                <MenuItem\n                  disabled={\n                    !sameInstance ||\n                    uiState === 'loading' ||\n                    !heroStatus?.editedAt ||\n                    !totalDescendants.current\n                  }\n                  onClick={initEditHistory}\n                >\n                  <Icon icon=\"edit\" />\n                  <span>{t`View Edit History Snapshots`}</span>\n                </MenuItem>\n              </Menu2>\n              <Link class=\"button plain deck-close\" to={closeLink}>\n                <Icon icon=\"x\" size=\"xl\" alt={t`Close`} />\n              </Link>\n            </div>\n          </div>\n        </header>\n        <EditHistoryControls />\n        {!!statuses.length && heroStatus ? (\n          <ul\n            class={`timeline flat contextual grow ${\n              uiState === 'loading' ? 'loading' : ''\n            }`}\n          >\n            {statusesList}\n            {showMore > 0 && (\n              <li class=\"descendant descendant-more\">\n                <button\n                  type=\"button\"\n                  class=\"plain block show-more\"\n                  disabled={uiState === 'loading'}\n                  onClick={() => setLimit((l) => l + LIMIT)}\n                  style={{ marginBlockEnd: '6em' }}\n                  data-state-post-ids={moreStatusesKeys.join(' ')}\n                >\n                  <div class=\"ib avatars-bunch\">\n                    {/* show avatars for first 5 statuses */}\n                    {statuses.slice(limit, limit + 5).map((status) => (\n                      <Avatar\n                        key={status.id}\n                        url={status.account.avatarStatic}\n                        // title={`${status.avatar.displayName} (@${status.avatar.acct})`}\n                      />\n                    ))}\n                  </div>{' '}\n                  <div class=\"ib\">\n                    <Trans>Show more</Trans>{' '}\n                    <span class=\"tag\">\n                      {showMore > LIMIT ? `${LIMIT}+` : showMore}\n                    </span>\n                  </div>\n                </button>\n              </li>\n            )}\n          </ul>\n        ) : (\n          <>\n            {uiState === 'loading' && (\n              <ul class=\"timeline flat contextual grow loading\">\n                <li>\n                  <Status skeleton size=\"l\" />\n                </li>\n              </ul>\n            )}\n            {uiState === 'error' && (\n              <p class=\"ui-state\">\n                <Trans>Unable to load post</Trans>\n                <br />\n                <br />\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    states.reloadStatusPage++;\n                  }}\n                >\n                  <Trans>Try again</Trans>\n                </button>\n              </p>\n            )}\n          </>\n        )}\n      </div>\n    </ThreadCountContext.Provider>\n  );\n}\n\nfunction SubComments({\n  replies,\n  instance,\n  hasParentThread,\n  level,\n  accWeight,\n  openAll,\n  parentLink,\n}) {\n  const { t } = useLingui();\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  // Total comments count, including sub-replies\n  const diveDeep = (replies) => {\n    return replies.reduce((acc, reply) => {\n      const { repliesCount, replies } = reply;\n      const count = replies?.length || repliesCount;\n      return acc + count + diveDeep(replies || []);\n    }, 0);\n  };\n  const totalComments = replies.length + diveDeep(replies);\n  const sameCount = replies.length === totalComments;\n\n  // Get the first 3 accounts, unique by id\n  const accounts = replies\n    .map((r) => r.account)\n    .filter((a, i, arr) => arr.findIndex((b) => b.id === a.id) === i)\n    .slice(0, 3);\n\n  const totalWeight = useMemo(() => {\n    return replies?.reduce((acc, reply) => {\n      return acc + reply?.weight;\n    }, accWeight);\n  }, [accWeight, replies?.length]);\n\n  let open = false;\n  if (openAll) {\n    open = true;\n  } else if (totalWeight <= MAX_WEIGHT) {\n    open = true;\n  } else if (!hasParentThread && totalComments === 1) {\n    const shortReply = calcStatusWeight(replies[0]) < 2;\n    if (shortReply) open = true;\n  }\n  const openBefore = cachedRepliesToggle[replies[0].id];\n\n  const handleMediaClick = useCallback((e, i, media, status) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setSearchParams({\n      media: i + 1,\n      mediaStatusID: status.id,\n    });\n  }, []);\n\n  const detailsRef = useRef();\n  useLayoutEffect(() => {\n    function handleScroll(e) {\n      // NOTE: this scrollLeft works for RTL too\n      // Browsers do the magic for us\n      e.target.dataset.scrollLeft = e.target.scrollLeft;\n    }\n    detailsRef.current?.addEventListener('scroll', handleScroll, {\n      passive: true,\n    });\n    return () => {\n      detailsRef.current?.removeEventListener('scroll', handleScroll);\n    };\n  }, []);\n\n  // If not open, delay render replies\n  const [renderReplies, setRenderReplies] = useState(openBefore || open);\n  useEffect(() => {\n    let timer;\n    if (!openBefore && !open) {\n      timer = setTimeout(() => setRenderReplies(true), 100);\n    }\n    return () => clearTimeout(timer);\n  }, [openBefore, open]);\n\n  const Container = open ? 'div' : 'details';\n  const isDetails = Container === 'details';\n\n  return (\n    <Container\n      ref={detailsRef}\n      class=\"replies\"\n      open={isDetails ? openBefore || open : undefined}\n      onToggle={\n        isDetails\n          ? (e) => {\n              const { open } = e.target;\n              // use first reply as ID\n              cachedRepliesToggle[replies[0].id] = open;\n            }\n          : undefined\n      }\n      style={{\n        '--comments-level': level,\n      }}\n      data-comments-level={level}\n      data-comments-level-overflow={level > 4}\n    >\n      {!open && (\n        <summary class=\"replies-summary\" hidden={open}>\n          <span class=\"avatars\">\n            {accounts.map((a) => (\n              <Avatar\n                key={a.id}\n                url={a.avatarStatic}\n                title={`${a.displayName} @${a.username}`}\n                squircle={a?.bot}\n              />\n            ))}\n          </span>\n          <span class=\"replies-counts\">\n            <b>\n              <Plural\n                value={replies.length}\n                one=\"# reply\"\n                other={\n                  <Trans>\n                    <span title={replies.length}>\n                      {shortenNumber(replies.length)}\n                    </span>{' '}\n                    replies\n                  </Trans>\n                }\n              />\n            </b>\n            {!sameCount && totalComments > 1 && (\n              <>\n                {' '}\n                &middot;{' '}\n                <span>\n                  <Plural\n                    value={totalComments}\n                    one=\"# comment\"\n                    other={\n                      <Trans>\n                        <span title={totalComments}>\n                          {shortenNumber(totalComments)}\n                        </span>{' '}\n                        comments\n                      </Trans>\n                    }\n                  />\n                </span>\n              </>\n            )}\n          </span>\n          <Icon icon=\"chevron-down\" class=\"replies-summary-chevron\" />\n          {!!parentLink && (\n            <Link\n              class=\"replies-parent-link\"\n              to={parentLink.to}\n              onClick={parentLink.onClick}\n              title={t`View post with its replies`}\n            >\n              &raquo;\n            </Link>\n          )}\n        </summary>\n      )}\n      {renderReplies && (\n        <ul>\n          {replies.map((r) => (\n            <li key={r.id}>\n              {/* <Link\n              class=\"status-link\"\n              to={instance ? `/${instance}/s/${r.id}` : `/s/${r.id}`}\n              onClick={() => {\n                resetScrollPosition(r.id);\n              }}\n            > */}\n              <div class=\"status-focus\" tabIndex={0}>\n                <Status\n                  statusID={r.id}\n                  instance={instance}\n                  withinContext\n                  size=\"s\"\n                  enableTranslate\n                  onMediaClick={handleMediaClick}\n                  showActionsBar\n                />\n                {!r.replies?.length && r.repliesCount > 0 && (\n                  <div class=\"replies-link\">\n                    <Icon icon=\"comment2\" alt={t`Replies`} />{' '}\n                    <span title={r.repliesCount}>\n                      {shortenNumber(r.repliesCount)}\n                    </span>\n                  </div>\n                )}\n              </div>\n              {/* </Link> */}\n              {r.replies?.length && (\n                <SubComments\n                  instance={instance}\n                  replies={r.replies}\n                  level={r.level}\n                  accWeight={!open ? r.weight : totalWeight}\n                  openAll={openAll}\n                  parentLink={{\n                    to: instance ? `/${instance}/s/${r.id}` : `/s/${r.id}`,\n                    onClick: () => {\n                      resetScrollPosition(r.id);\n                    },\n                  }}\n                />\n              )}\n            </li>\n          ))}\n        </ul>\n      )}\n    </Container>\n  );\n}\n\nconst MEDIA_VIRTUAL_LENGTH = 140;\nconst POLL_VIRTUAL_LENGTH = 35;\nconst CARD_VIRTUAL_LENGTH = 70;\nconst WEIGHT_SEGMENT = 140;\nconst statusWeightCache = new Map();\nfunction calcStatusWeight(status) {\n  const cachedWeight = statusWeightCache.get(status.id);\n  if (cachedWeight) return cachedWeight;\n  const { spoilerText, content, mediaAttachments, poll, card } = status;\n  const length = htmlContentLength(spoilerText + content);\n  const mediaLength = mediaAttachments?.length ? MEDIA_VIRTUAL_LENGTH : 0;\n  const pollLength = (poll?.options?.length || 0) * POLL_VIRTUAL_LENGTH;\n  const cardLength =\n    card && (mediaAttachments?.length || poll?.options?.length)\n      ? 0\n      : CARD_VIRTUAL_LENGTH;\n  const totalLength = length + mediaLength + pollLength + cardLength;\n  const weight = totalLength / WEIGHT_SEGMENT;\n  statusWeightCache.set(status.id, weight);\n  return weight;\n}\n\nexport default memo(StatusPage);\n","import { useParams } from 'react-router-dom';\n\nimport Status from './status';\n\nexport default function StatusRoute() {\n  const params = useParams();\n  const { id, instance } = params;\n  return <Status id={id} instance={instance} />;\n}\n","export default \"__VITE_ASSET__BbkKeAoc__\"","export default \"__VITE_ASSET__MUCjVR2Z__\"","export default \"__VITE_ASSET__Pb$jWfr9__\"","export default \"__VITE_ASSET__DJIucEyS__\"","export default \"data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e\"","import './welcome.css';\n\nimport { Trans, useLingui } from '@lingui/react/macro';\n\nimport boostsCarouselUrl from '../assets/features/boosts-carousel.jpg';\nimport catchupUrl from '../assets/features/catch-up.png';\nimport multiColumnUrl from '../assets/features/multi-column.jpg';\nimport multiHashtagTimelineUrl from '../assets/features/multi-hashtag-timeline.jpg';\nimport nestedCommentsThreadUrl from '../assets/features/nested-comments-thread.jpg';\nimport logo from '../assets/logo.svg';\nimport logoText from '../assets/logo-text.svg';\n\nimport LangSelector from '../components/lang-selector';\nimport Link from '../components/link';\nimport states from '../utils/states';\nimport useTitle from '../utils/useTitle';\n\nconst {\n  PHANPY_DEFAULT_INSTANCE: DEFAULT_INSTANCE,\n  PHANPY_WEBSITE: WEBSITE,\n  PHANPY_PRIVACY_POLICY_URL: PRIVACY_POLICY_URL,\n  PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL: DEFAULT_INSTANCE_REGISTRATION_URL,\n} = import.meta.env;\nconst appSite = WEBSITE\n  ? WEBSITE.replace(/https?:\\/\\//g, '').replace(/\\/$/, '')\n  : null;\nconst sameSite = WEBSITE\n  ? WEBSITE.toLowerCase().includes(location.hostname)\n  : false;\nconst appVersion = __COMMIT_TIME__\n  ? `${__COMMIT_TIME__.slice(0, 10).replace(/-/g, '.')}${\n      __COMMIT_HASH__ ? `.${__COMMIT_HASH__}` : ''\n    }`\n  : null;\n\nfunction Welcome() {\n  const { t } = useLingui();\n  useTitle(null, ['/', '/welcome']);\n  return (\n    <main id=\"welcome\">\n      <div class=\"hero-container\">\n        <div class=\"hero-content\">\n          <h1>\n            <img\n              src={logo}\n              alt=\"\"\n              width=\"160\"\n              height=\"160\"\n              style={{\n                aspectRatio: '1/1',\n                marginBlockEnd: -16,\n              }}\n            />\n            <img src={logoText} alt=\"Phanpy\" width=\"200\" />\n          </h1>\n          <p class=\"desc\">\n            <Trans>A minimalistic opinionated Mastodon web client.</Trans>\n          </p>\n          <p>\n            <Link\n              to={\n                DEFAULT_INSTANCE\n                  ? `/login?instance=${DEFAULT_INSTANCE}&submit=1`\n                  : '/login'\n              }\n              class=\"button\"\n            >\n              {DEFAULT_INSTANCE ? t`Log in` : t`Log in with Mastodon`}\n            </Link>\n          </p>\n          {DEFAULT_INSTANCE && DEFAULT_INSTANCE_REGISTRATION_URL && (\n            <p>\n              <a href={DEFAULT_INSTANCE_REGISTRATION_URL} class=\"button plain5\">\n                <Trans>Sign up</Trans>\n              </a>\n            </p>\n          )}\n          {!DEFAULT_INSTANCE && (\n            <p class=\"insignificant\">\n              <small>\n                <Trans>\n                  Connect your existing Mastodon/Fediverse account.\n                  <br />\n                  Your credentials are not stored on this server.\n                </Trans>\n              </small>\n            </p>\n          )}\n        </div>\n        {(appSite || appVersion) && (\n          <p class=\"app-site-version\">\n            <small>\n              {sameSite ? appSite : ''} {appVersion}\n            </small>\n          </p>\n        )}\n        <p>\n          <Trans>\n            <a href=\"https://github.com/cheeaun/phanpy\" target=\"_blank\">\n              Built\n            </a>{' '}\n            by{' '}\n            <a\n              href=\"https://mastodon.social/@cheeaun\"\n              target=\"_blank\"\n              onClick={(e) => {\n                e.preventDefault();\n                states.showAccount = 'cheeaun@mastodon.social';\n              }}\n            >\n              @cheeaun\n            </a>\n            .{' '}\n            <a href={PRIVACY_POLICY_URL} target=\"_blank\">\n              Privacy Policy\n            </a>\n            .\n          </Trans>\n        </p>\n        <div>\n          <LangSelector />\n        </div>\n      </div>\n      <div id=\"why-container\">\n        <div class=\"sections\">\n          <section>\n            <img\n              src={boostsCarouselUrl}\n              alt={t`Screenshot of Boosts Carousel`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Boosts Carousel</Trans>\n            </h4>\n            <p>\n              <Trans>\n                Visually separate original posts and re-shared posts (boosted\n                posts).\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={catchupUrl}\n              alt={t`Screenshot of Catch-up`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Catch-up</Trans>\n            </h4>\n            <p>\n              <Trans>\n                A separate timeline for followings. Email-inspired interface to\n                sort and filter posts.\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={nestedCommentsThreadUrl}\n              alt={t`Screenshot of nested comments thread`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Nested comments thread</Trans>\n            </h4>\n            <p>\n              <Trans>\n                Effortlessly follow conversations. Semi-collapsible replies.\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={multiColumnUrl}\n              alt={t`Screenshot of multi-column UI`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Single or multi-column</Trans>\n            </h4>\n            <p>\n              <Trans>\n                By default, single column for zen-mode seekers. Configurable\n                multi-column for power users.\n              </Trans>\n            </p>\n          </section>\n          <section>\n            <img\n              src={multiHashtagTimelineUrl}\n              alt={t`Screenshot of multi-hashtag timeline with a form to add more hashtags`}\n              loading=\"lazy\"\n            />\n            <h4>\n              <Trans>Multi-hashtag timeline</Trans>\n            </h4>\n            <p>\n              <Trans>Up to 5 hashtags combined into a single timeline.</Trans>\n            </p>\n          </section>\n        </div>\n      </div>\n    </main>\n  );\n}\n\nexport default Welcome;\n","// Replace alert() with toastify-js\nimport Toastify from 'toastify-js';\n\nconst nativeAlert = window.alert;\nif (!window.__nativeAlert) window.__nativeAlert = nativeAlert;\n\nwindow.alert = function (message) {\n  console.debug(\n    'ALERT: This is a custom alert() function. Native alert() is still available as window.__nativeAlert()',\n  );\n  // If Error object, show the message\n  if (message instanceof Error && message?.message) {\n    message = message.message;\n  }\n  // If not string, stringify it\n  if (typeof message !== 'string') {\n    message = JSON.stringify(message);\n  }\n\n  const toast = Toastify({\n    text: message,\n    className: 'alert',\n    gravity: 'top',\n    position: 'center',\n    duration: 10_000,\n    offset: {\n      y: 48,\n    },\n    onClick: () => {\n      toast.hideToast();\n    },\n  });\n  toast.showToast();\n};\n","import './app.css';\n\nimport { useLingui } from '@lingui/react';\nimport debounce from 'just-debounce-it';\nimport { lazy, memo, Suspense } from 'preact/compat';\nimport {\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { matchPath, Route, Routes, useLocation } from 'react-router-dom';\n\nimport 'swiped-events';\n\nimport { subscribe } from 'valtio';\n\nimport BackgroundService from './components/background-service';\nimport ComposeButton from './components/compose-button';\nimport { ICONS } from './components/ICONS';\nimport KeyboardShortcutsHelp from './components/keyboard-shortcuts-help';\nimport Loader from './components/loader';\nimport Modals from './components/modals';\nimport NavigationCommand from './components/navigation-command';\nimport NotificationService from './components/notification-service';\nimport SearchCommand from './components/search-command';\nimport Shortcuts from './components/shortcuts';\nimport NotFound from './pages/404';\nimport AccountStatuses from './pages/account-statuses';\nimport AnnualReport from './pages/annual-report';\nimport Bookmarks from './pages/bookmarks';\nimport Catchup from './pages/catchup';\nimport Favourites from './pages/favourites';\nimport Filters from './pages/filters';\nimport FollowedHashtags from './pages/followed-hashtags';\nimport Following from './pages/following';\nimport Hashtag from './pages/hashtag';\nimport Home from './pages/home';\nimport HttpRoute from './pages/http-route';\nimport List from './pages/list';\nimport Lists from './pages/lists';\nimport Login from './pages/login';\nimport Mentions from './pages/mentions';\nimport Notifications from './pages/notifications';\nimport Public from './pages/public';\nimport ScheduledPosts from './pages/scheduled-posts';\nimport Search from './pages/search';\nimport StatusRoute from './pages/status-route';\nimport Trending from './pages/trending';\nimport Welcome from './pages/welcome';\nimport {\n  api,\n  hasInstance,\n  hasPreferences,\n  initAccount,\n  initClient,\n  initInstance,\n  initPreferences,\n} from './utils/api';\nimport { getAccessToken } from './utils/auth';\nimport focusDeck from './utils/focus-deck';\nimport states, { hideAllModals, initStates, statusKey } from './utils/states';\nimport store from './utils/store';\nimport {\n  getAccount,\n  getCredentialApplication,\n  getCurrentAccount,\n  getVapidKey,\n  setCurrentAccountID,\n} from './utils/store-utils';\n\nimport './utils/toast-alert';\n\n// Lazy load Sandbox component only in development\nconst Sandbox =\n  import.meta.env.DEV || import.meta.env.PHANPY_DEV\n    ? lazy(() => import('./pages/sandbox'))\n    : () => null;\n\n// Lazy load YearInPosts component\nconst YearInPosts = lazy(() => import('./pages/year-in-posts'));\n\n// QR Scan Test component for development\nfunction QrScanTest() {\n  useEffect(() => {\n    states.showQrScannerModal = {\n      onClose: ({ text } = {}) => {\n        hideAllModals();\n        location.hash = text ? `/${text}` : '/';\n      },\n    };\n  }, []);\n\n  return null;\n}\n\nwindow.__STATES__ = states;\nwindow.__STATES_STATS__ = () => {\n  const keys = [\n    'statuses',\n    'accounts',\n    'spoilers',\n    'unfurledLinks',\n    'statusQuotes',\n  ];\n  const counts = {};\n  keys.forEach((key) => {\n    counts[key] = Object.keys(states[key]).length;\n  });\n  console.warn('STATE stats', counts);\n\n  const { statuses } = states;\n  const unmountedPosts = [];\n  for (const key in statuses) {\n    const $post = document.querySelector(\n      `[data-state-post-id~=\"${key}\"], [data-state-post-ids~=\"${key}\"]`,\n    );\n    if (!$post) {\n      unmountedPosts.push(key);\n    }\n  }\n  console.warn('Unmounted posts', unmountedPosts.length, unmountedPosts);\n};\n\n// Experimental \"garbage collection\" for states\n// Every 15 minutes\n// Only posts for now\nsetInterval(\n  () => {\n    if (!window.__IDLE__) return;\n    const { statuses, unfurledLinks, notifications } = states;\n    let keysCount = 0;\n    const { instance } = api();\n    for (const key in statuses) {\n      if (!window.__IDLE__) break;\n      try {\n        const $post = document.querySelector(\n          `[data-state-post-id~=\"${key}\"], [data-state-post-ids~=\"${key}\"]`,\n        );\n        const postInNotifications = notifications.some(\n          (n) => key === statusKey(n.status?.id, instance),\n        );\n        if (!$post && !postInNotifications) {\n          delete states.statuses[key];\n          delete states.statusQuotes[key];\n          for (const link in unfurledLinks) {\n            const unfurled = unfurledLinks[link];\n            const sKey = statusKey(unfurled.id, unfurled.instance);\n            if (sKey === key) {\n              delete states.unfurledLinks[link];\n              break;\n            }\n          }\n          keysCount++;\n        }\n      } catch (e) {}\n    }\n    if (keysCount) {\n      console.info(`GC: Removed ${keysCount} keys`);\n    }\n  },\n  15 * 60 * 1000,\n);\n\n// Preload icons\n// There's probably a better way to do this\n// Related: https://github.com/vitejs/vite/issues/10600\nsetTimeout(() => {\n  for (const icon in ICONS) {\n    setTimeout(() => {\n      if (Array.isArray(ICONS[icon])) {\n        ICONS[icon][0]?.();\n      } else if (typeof ICONS[icon] === 'object') {\n        ICONS[icon].module?.();\n      } else {\n        ICONS[icon]?.();\n      }\n    }, 1);\n  }\n}, 5000);\n\n(() => {\n  window.__IDLE__ = true;\n  const nonIdleEvents = [\n    'mousemove',\n    'mousedown',\n    'resize',\n    'keydown',\n    'touchstart',\n    'pointerdown',\n    'pointermove',\n    'wheel',\n  ];\n  const setIdle = () => {\n    window.__IDLE__ = true;\n  };\n  const IDLE_TIME = 3_000; // 3 seconds\n  const debouncedSetIdle = debounce(setIdle, IDLE_TIME);\n  const onNonIdle = () => {\n    window.__IDLE__ = false;\n    debouncedSetIdle();\n  };\n  nonIdleEvents.forEach((event) => {\n    window.addEventListener(event, onNonIdle, {\n      passive: true,\n      capture: true,\n    });\n  });\n  window.addEventListener('blur', setIdle, {\n    passive: true,\n  });\n  // When cursor leaves the window, set idle\n  document.documentElement.addEventListener(\n    'mouseleave',\n    (e) => {\n      if (!e.relatedTarget && !e.toElement) {\n        setIdle();\n      }\n    },\n    {\n      passive: true,\n    },\n  );\n  // document.addEventListener(\n  //   'visibilitychange',\n  //   () => {\n  //     if (document.visibilityState === 'visible') {\n  //       onNonIdle();\n  //     }\n  //   },\n  //   {\n  //     passive: true,\n  //   },\n  // );\n})();\n\n// Possible fix for iOS PWA theme-color bug\n// It changes when loading web pages in \"webview\"\nconst isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);\nif (isIOS) {\n  document.addEventListener('visibilitychange', () => {\n    if (document.visibilityState === 'visible') {\n      // Don't reset theme color if media modal is showing\n      // Media modal will set its own theme color based on the media's color\n      const showingMediaModal =\n        document.getElementsByClassName('media-modal-container').length > 0;\n      if (showingMediaModal) return;\n\n      const theme = store.local.get('theme');\n      let $meta;\n      if (theme) {\n        // Get current meta\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][data-theme-setting=\"manual\"]`,\n        );\n        if ($meta) {\n          const color = $meta.content;\n          const tempColor =\n            theme === 'light'\n              ? $meta.dataset.themeLightColorTemp\n              : $meta.dataset.themeDarkColorTemp;\n          $meta.content = tempColor || '';\n          setTimeout(() => {\n            $meta.content = color;\n          }, 10);\n        }\n      } else {\n        // Get current color scheme\n        const colorScheme = window.matchMedia('(prefers-color-scheme: dark)')\n          .matches\n          ? 'dark'\n          : 'light';\n        // Get current theme-color\n        $meta = document.querySelector(\n          `meta[name=\"theme-color\"][media*=\"${colorScheme}\"]`,\n        );\n        if ($meta) {\n          const color = $meta.dataset.content;\n          const tempColor = $meta.dataset.contentTemp;\n          $meta.content = tempColor || '';\n          setTimeout(() => {\n            $meta.content = color;\n          }, 10);\n        }\n      }\n    }\n  });\n}\n\n{\n  const theme = store.local.get('theme');\n  // If there's a theme, it's NOT auto\n  if (theme) {\n    // dark | light\n    document.documentElement.classList.add(`is-${theme}`);\n    document\n      .querySelector('meta[name=\"color-scheme\"]')\n      .setAttribute('content', theme || 'light dark');\n\n    // Enable manual theme <meta>\n    const $manualMeta = document.querySelector(\n      'meta[data-theme-setting=\"manual\"]',\n    );\n    if ($manualMeta) {\n      $manualMeta.name = 'theme-color';\n      $manualMeta.content =\n        theme === 'light'\n          ? $manualMeta.dataset.themeLightColor\n          : $manualMeta.dataset.themeDarkColor;\n    }\n    // Disable auto theme <meta>s\n    const $autoMetas = document.querySelectorAll(\n      'meta[data-theme-setting=\"auto\"]',\n    );\n    $autoMetas.forEach((m) => {\n      m.name = '';\n    });\n  }\n  const textSize = store.local.get('textSize');\n  if (textSize) {\n    document.documentElement.style.setProperty('--text-size', `${textSize}px`);\n  }\n}\n\nsubscribe(states, (changes) => {\n  for (const [action, path, value, prevValue] of changes) {\n    // Change #app dataset based on settings.shortcutsViewMode\n    if (path.join('.') === 'settings.shortcutsViewMode') {\n      const $app = document.getElementById('app');\n      if ($app) {\n        $app.dataset.shortcutsViewMode = states.shortcuts?.length ? value : '';\n      }\n    }\n\n    // Add/Remove cloak class to body\n    if (path.join('.') === 'settings.cloakMode') {\n      const $body = document.body;\n      $body.classList.toggle('cloak', value);\n    }\n  }\n});\n\nconst BENCHES = new Map();\nwindow.__BENCH_RESULTS = new Map();\nwindow.__BENCHMARK = {\n  start(name) {\n    if (!import.meta.env.DEV && !import.meta.env.PHANPY_DEV) return;\n    // If already started, ignore\n    if (BENCHES.has(name)) return;\n    const start = performance.now();\n    BENCHES.set(name, start);\n  },\n  end(name) {\n    if (!import.meta.env.DEV && !import.meta.env.PHANPY_DEV) return;\n    const start = BENCHES.get(name);\n    if (start) {\n      const end = performance.now();\n      const duration = end - start;\n      __BENCH_RESULTS.set(name, duration);\n      BENCHES.delete(name);\n    }\n  },\n};\n\nif (import.meta.env.DEV) {\n  // If press shift down, set --time-scale to 10 in root\n  document.addEventListener('keydown', (e) => {\n    if (e.key === 'Shift') {\n      document.documentElement.classList.add('slow-mo');\n    }\n  });\n  document.addEventListener('keyup', (e) => {\n    if (e.key === 'Shift') {\n      document.documentElement.classList.remove('slow-mo');\n    }\n  });\n}\n\n{\n  // Temporary Experiments\n  // May be removed in the future\n  document.body.classList.toggle(\n    'exp-tab-bar-v2',\n    store.local.get('experiments-tabBarV2') ?? false,\n  );\n}\n\n// const isPWA = true; // testing\nconst isPWA =\n  window.matchMedia('(display-mode: standalone)').matches ||\n  window.navigator.standalone === true;\nconst PATH_RESTORE_TIME_LIMIT = 1 * 60 * 60 * 1000; // 1 hour, should be good enough\n\nfunction App() {\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [uiState, setUIState] = useState('loading');\n  __BENCHMARK.start('app-init');\n  __BENCHMARK.start('time-to-following');\n  __BENCHMARK.start('time-to-home');\n  __BENCHMARK.start('time-to-isLoggedIn');\n  useLingui();\n\n  useEffect(() => {\n    const instanceURL = store.local.get('instanceURL');\n    const code = decodeURIComponent(\n      (window.location.search.match(/code=([^&]+)/) || [, ''])[1],\n    );\n\n    if (code) {\n      console.log({ code });\n\n      const isPopup = window.opener && !window.opener.closed;\n\n      if (isPopup) {\n        try {\n          window.opener.postMessage(\n            {\n              type: 'oauth-callback',\n              code: code,\n            },\n            window.location.origin,\n          );\n          setTimeout(() => {\n            window.close();\n          }, 100);\n        } catch (e) {\n          console.error('Failed to send message to parent window:', e);\n          window.close();\n        }\n        return;\n      }\n\n      // Clear the code from the URL\n      window.history.replaceState(\n        {},\n        document.title,\n        window.location.pathname || '/',\n      );\n\n      const {\n        client_id: clientID,\n        client_secret: clientSecret,\n        vapid_key,\n      } = getCredentialApplication(instanceURL) || {};\n      const vapidKey = getVapidKey(instanceURL) || vapid_key;\n      const verifier = store.sessionCookie.get('codeVerifier');\n\n      (async () => {\n        setUIState('loading');\n        const { access_token: accessToken } = await getAccessToken({\n          instanceURL,\n          client_id: clientID,\n          client_secret: clientSecret,\n          code,\n          code_verifier: verifier || undefined,\n        });\n\n        if (accessToken) {\n          const client = initClient({ instance: instanceURL, accessToken });\n          await Promise.allSettled([\n            initPreferences(client),\n            initInstance(client, instanceURL),\n            initAccount(client, instanceURL, accessToken, vapidKey),\n          ]);\n          initStates();\n          window.__IGNORE_GET_ACCOUNT_ERROR__ = true;\n\n          setIsLoggedIn(true);\n          setUIState('default');\n        } else {\n          setUIState('error');\n        }\n        __BENCHMARK.end('app-init');\n      })();\n    } else {\n      window.__IGNORE_GET_ACCOUNT_ERROR__ = true;\n      const searchAccount = decodeURIComponent(\n        (window.location.search.match(/account=([^&]+)/) || [, ''])[1],\n      );\n      let account;\n      if (searchAccount) {\n        account = getAccount(searchAccount);\n        console.log('searchAccount', searchAccount, account);\n        if (account) {\n          setCurrentAccountID(account.info.id);\n          window.history.replaceState(\n            {},\n            document.title,\n            window.location.pathname || '/',\n          );\n        }\n      }\n      if (!account) {\n        account = getCurrentAccount();\n      }\n      if (account) {\n        setCurrentAccountID(account.info.id);\n        const { client } = api({ account });\n        const { instance } = client;\n        // console.log('masto', masto);\n        initStates();\n        setUIState('loading');\n        (async () => {\n          try {\n            if (hasPreferences() && hasInstance(instance)) {\n              // Non-blocking\n              initPreferences(client);\n              initInstance(client, instance);\n            } else {\n              await Promise.allSettled([\n                initPreferences(client),\n                initInstance(client, instance),\n              ]);\n            }\n          } catch (e) {\n          } finally {\n            setIsLoggedIn(true);\n            setUIState('default');\n            __BENCHMARK.end('app-init');\n          }\n        })();\n      } else {\n        setUIState('default');\n        __BENCHMARK.end('app-init');\n      }\n    }\n\n    // Cleanup\n    store.sessionCookie.del('clientID');\n    store.sessionCookie.del('clientSecret');\n    store.sessionCookie.del('codeVerifier');\n  }, []);\n\n  let location = useLocation();\n  states.currentLocation = location.pathname;\n  // useLayoutEffect(() => {\n  //   states.currentLocation = location.pathname;\n  // }, [location.pathname]);\n\n  useEffect(focusDeck, [location, isLoggedIn]);\n\n  // Save last page for PWA restoration\n  const restoredRef = useRef(false);\n  const lastPathKey = 'pwaLastPath';\n  useEffect(() => {\n    if (!restoredRef.current) return;\n    // console.log('location.pathname', location.pathname);\n    if (isPWA && isLoggedIn) {\n      if (isRootPath(location.pathname)) {\n        store.local.del(lastPathKey);\n      } else {\n        store.local.setJSON(lastPathKey, {\n          path: location.pathname + location.search,\n          lastAccessed: Date.now(),\n        });\n      }\n    }\n  }, [location.pathname, location.search, isLoggedIn]);\n\n  // Restore last page on PWA reopen\n  useEffect(() => {\n    if (restoredRef.current) return;\n    const isRootPath = !location.pathname || location.pathname === '/';\n    if (!isRootPath) return;\n    if (isPWA && isLoggedIn && uiState === 'default') {\n      const lastPath = store.local.getJSON(lastPathKey);\n      if (lastPath) {\n        setTimeout(() => {\n          if (lastPath?.path) {\n            const timeSinceLastAccess =\n              Date.now() - (lastPath.lastAccessed || 0);\n            if (timeSinceLastAccess < PATH_RESTORE_TIME_LIMIT) {\n              window.location.hash = lastPath.path;\n            }\n          }\n          store.local.del(lastPathKey);\n        }, 300);\n      }\n      restoredRef.current = true;\n    }\n  }, [uiState, isLoggedIn]);\n\n  if (/\\/https?:/.test(location.pathname)) {\n    return <HttpRoute />;\n  }\n\n  if (uiState === 'loading') {\n    return <Loader id=\"loader-root\" />;\n  }\n\n  return (\n    <>\n      <PrimaryRoutes isLoggedIn={isLoggedIn} />\n      <SecondaryRoutes isLoggedIn={isLoggedIn} />\n      <Routes>\n        <Route path=\"/:instance?/s/:id\" element={<StatusRoute />} />\n      </Routes>\n      {isLoggedIn && <ComposeButton />}\n      {isLoggedIn && <Shortcuts />}\n      <Modals />\n      {isLoggedIn && <NotificationService />}\n      <BackgroundService isLoggedIn={isLoggedIn} />\n      {isLoggedIn && <NavigationCommand />}\n      <SearchCommand onClose={focusDeck} />\n      <KeyboardShortcutsHelp />\n    </>\n  );\n}\n\nfunction Root({ isLoggedIn }) {\n  if (isLoggedIn) {\n    __BENCHMARK.end('time-to-isLoggedIn');\n  }\n  return isLoggedIn ? <Home /> : <Welcome />;\n}\n\nfunction isRootPath(pathname) {\n  return /^\\/(login|welcome|_sandbox|_qr-scan)/i.test(pathname);\n}\n\nconst PrimaryRoutes = memo(({ isLoggedIn }) => {\n  const location = useLocation();\n  const nonRootLocation = useMemo(() => {\n    const { pathname } = location;\n    return !isRootPath(pathname);\n  }, [location]);\n\n  return (\n    <Routes location={nonRootLocation || location}>\n      <Route path=\"/\" element={<Root isLoggedIn={isLoggedIn} />} />\n      <Route path=\"/login\" element={<Login />} />\n      <Route path=\"/welcome\" element={<Welcome />} />\n      {(import.meta.env.DEV || import.meta.env.PHANPY_DEV) && (\n        <>\n          <Route\n            path=\"/_sandbox\"\n            element={\n              <Suspense fallback={<Loader id=\"loader-sandbox\" />}>\n                <Sandbox />\n              </Suspense>\n            }\n          />\n          <Route path=\"/_qr-scan\" element={<QrScanTest />} />\n        </>\n      )}\n    </Routes>\n  );\n});\n\nfunction getPrevLocation() {\n  return states.prevLocation || null;\n}\nfunction SecondaryRoutes({ isLoggedIn }) {\n  // const snapStates = useSnapshot(states);\n  const location = useLocation();\n  // const prevLocation = snapStates.prevLocation;\n  const backgroundLocation = useRef(getPrevLocation());\n\n  const isModalPage = useMemo(() => {\n    return (\n      matchPath('/:instance/s/:id', location.pathname) ||\n      matchPath('/s/:id', location.pathname)\n    );\n  }, [location.pathname, matchPath]);\n  if (isModalPage) {\n    if (!backgroundLocation.current)\n      backgroundLocation.current = getPrevLocation();\n  } else {\n    backgroundLocation.current = null;\n  }\n  console.debug({\n    backgroundLocation: backgroundLocation.current,\n    location,\n  });\n\n  return (\n    <Routes location={backgroundLocation.current || location}>\n      {isLoggedIn && (\n        <>\n          <Route path=\"/notifications\" element={<Notifications />} />\n          <Route path=\"/mentions\" element={<Mentions />} />\n          <Route path=\"/following\" element={<Following />} />\n          <Route path=\"/b\" element={<Bookmarks />} />\n          <Route path=\"/f\" element={<Favourites />} />\n          <Route path=\"/l\">\n            <Route index element={<Lists />} />\n            <Route path=\":id\" element={<List />} />\n          </Route>\n          <Route path=\"/fh\" element={<FollowedHashtags />} />\n          <Route path=\"/sp\" element={<ScheduledPosts />} />\n          <Route path=\"/ft\" element={<Filters />} />\n          <Route path=\"/catchup\" element={<Catchup />} />\n          <Route\n            path=\"/yip\"\n            element={\n              <Suspense\n                fallback={\n                  <div\n                    id=\"year-in-posts-page\"\n                    class=\"deck-container\"\n                    tabIndex=\"-1\"\n                  >\n                    {/* Prevent flash of no background as this is lazy-loaded */}\n                    <Loader />\n                  </div>\n                }\n              >\n                <YearInPosts />\n              </Suspense>\n            }\n          />\n          <Route path=\"/annual_report/:year\" element={<AnnualReport />} />\n        </>\n      )}\n      <Route path=\"/:instance?/t/:hashtag\" element={<Hashtag />} />\n      <Route path=\"/:instance?/a/:id\" element={<AccountStatuses />} />\n      <Route path=\"/:instance?/p\">\n        <Route index element={<Public />} />\n        <Route path=\"l\" element={<Public local />} />\n      </Route>\n      <Route path=\"/:instance?/trending\" element={<Trending />} />\n      <Route path=\"/:instance?/search\" element={<Search />} />\n      {/* <Route path=\"/:anything\" element={<NotFound />} /> */}\n    </Routes>\n  );\n}\n\nexport { App };\n","import './index.css';\nimport './cloak-mode.css';\nimport './polyfills';\n\nimport { i18n } from '@lingui/core';\nimport { I18nProvider } from '@lingui/react';\n// Polyfill needed for Firefox < 122\n// https://bugzilla.mozilla.org/show_bug.cgi?id=1423593\n// import '@formatjs/intl-segmenter/polyfill';\nimport { render } from 'preact';\nimport { HashRouter } from 'react-router-dom';\n\nimport { App } from './app';\nimport { IconSpriteProvider } from './components/icon-sprite-manager';\nimport { initActivateLang } from './utils/lang';\nimport { initPWAViewport } from './utils/pwa-viewport';\n\ninitActivateLang();\ninitPWAViewport();\n\nif (import.meta.env.DEV) {\n  import('preact/debug');\n}\n\nrender(\n  <I18nProvider i18n={i18n}>\n    <HashRouter>\n      <IconSpriteProvider>\n        <App />\n      </IconSpriteProvider>\n    </HashRouter>\n  </I18nProvider>,\n  document.getElementById('app'),\n);\n\n// Storage cleanup\nsetTimeout(() => {\n  try {\n    // Clean up old settings key\n    localStorage.removeItem('settings-groupedNotificationsAlpha');\n  } catch (e) {}\n}, 5000);\n\n// Service worker cache cleanup\nif ('serviceWorker' in navigator && typeof caches !== 'undefined') {\n  const MAX_SW_CACHE_SIZE = 50;\n  const IGNORE_CACHE_KEYS = ['icons'];\n  let clearRanOnce = false;\n  const FAST_INTERVAL = 10_000; // 10 seconds\n  const SLOW_INTERVAL = 60 * 60 * 1000; // 1 hour\n  async function clearCaches() {\n    if (window.__IDLE__) {\n      try {\n        const keys = await caches.keys();\n        for (const key of keys) {\n          if (IGNORE_CACHE_KEYS.includes(key)) continue;\n          const cache = await caches.open(key);\n          const _keys = await cache.keys();\n          if (_keys.length > MAX_SW_CACHE_SIZE) {\n            console.warn('Cleaning cache', key, _keys.length);\n            const deleteKeys = _keys.slice(MAX_SW_CACHE_SIZE);\n            for (const deleteKey of deleteKeys) {\n              await cache.delete(deleteKey);\n            }\n          }\n        }\n        clearRanOnce = true;\n      } catch (e) {} // Silent fail\n    }\n    // Once cleared, clear again at slower interval\n    setTimeout(clearCaches, clearRanOnce ? SLOW_INTERVAL : FAST_INTERVAL);\n  }\n  setTimeout(clearCaches, FAST_INTERVAL);\n}\n\nwindow.__CLOAK__ = () => {\n  document.body.classList.toggle('cloak');\n};\n"],"file":"main-BDyCjkB8.js"}