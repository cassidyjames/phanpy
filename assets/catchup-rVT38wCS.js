import{a as Ye,N as We,r as Xe,o as Ze}from"./main-3DmBYrhd.js";import{c as Qe,p as L,q as j,F as se,x as Je,_ as ne,y as et,Z as tt,a as e,u as ce,g as N,o as st,w as nt}from"./vendor-YNBWu-Mz.js";import{u as rt}from"./index-_Y-Lyw2n.js";import{k as lt,r as ie,s as Ae,L as be,I as $,n as it,R as Me,A as ve,M as ot,N as Le,t as at,q as ct,w as dt,a as Ie}from"./db-VHhRFCXL.js";import{f as ht,a as ut,c as pt,d as ft,s as $e,j as Fe,L as gt}from"./useTitle-3DvqVLcR.js";const mt=""+new URL("catch-up-DuauQu-W.png",import.meta.url).href,bt="home",E=[{label:"last 1 hour",value:1},{label:"last 2 hours",value:2},{label:"last 3 hours",value:3},{label:"last 4 hours",value:4},{label:"last 5 hours",value:5},{label:"last 6 hours",value:6},{label:"last 7 hours",value:7},{label:"last 8 hours",value:8},{label:"last 9 hours",value:9},{label:"last 10 hours",value:10},{label:"last 11 hours",value:11},{label:"last 12 hours",value:12},{label:"beyond 12 hours",value:13}],vt=["Original","Replies","Boosts","Followed tags","Groups","Filtered"],yt=["createdAt","repliesCount","favouritesCount","reblogsCount","density"],wt=[null,"account"],Oe={Filtered:"filtered",Groups:"group",Boosts:"boost",Replies:"reply","Followed tags":"followedTags",Original:"original"},kt={Filtered:"filtered posts",Groups:"group posts",Boosts:"boosts",Replies:"replies","Followed tags":"followed-tag posts",Original:"original posts"},Tt={createdAt:["oldest","latest"],repliesCount:["fewest replies","most replies"],favouritesCount:["fewest likes","most likes"],reblogsCount:["fewest boosts","most boosts"],density:["least dense","most dense"]};function Mt(){ht("Catch-up","/catchup");const{masto:v,instance:p}=ut(),[f,a]=Qe(),d=f.get("id"),[g,T]=L("start"),[b,c]=L(!1),S=j(()=>pt.session.get("currentAccount"),[]),F=t=>t===S;async function Z({maxCreatedAt:t}){var r,m,h;const s=t?new Date(t):null,l=[],n=v.v1.timelines.home.list({limit:40});e:for(;;)try{const o=await n.next(),{value:k}=o;if(k!=null&&k.length){await Ye(k,p);let I=!1;for(let G=0;G<k.length;G++){const R=k[G],ee=new Date(R.createdAt);if(!s||ee>=s){const w=!F(((m=(r=R.reblog)==null?void 0:r.account)==null?void 0:m.id)||R.account.id)&&lt(((h=R.reblog)==null?void 0:h.filtered)||R.filtered,bt);if((w==null?void 0:w.action)==="hide")continue;R._filtered=w;const V=ft(R.id,p);R._followedTags=$e.statusFollowedTags[V]?[...$e.statusFollowedTags[V]]:[],l.push(R),I=!0}if(!I)break e}}else break e;await new Promise(I=>setTimeout(I,1e3))}catch{break e}return l.forEach(o=>{if(o!=null&&o.inReplyToId){const k=l.find(I=>I.id===o.inReplyToId);k&&!k.inReplyToId&&(k._thread=!0)}}),l}const[u,K]=L([]),O=se(),de=se(),he=j(()=>Fe(),[]),D=Je(async({duration:t}={})=>{const s=Date.now(),l=t?s-t:null;T("loading");const n=await Z({maxCreatedAt:l}),r=`${he}-${rt()}`;try{await ie.catchup.set(r,{id:r,posts:n,count:n.length,startAt:l,endAt:s}),a({id:r})}catch{}},[]);ne(()=>{d?(async()=>{const t=await ie.catchup.get(d);t&&(t.posts.sort((s,l)=>s.createdAt>l.createdAt?1:-1),K(t.posts),T("results"))})():g==="results"&&(K([]),T("start"))},[d]);const[M,q]=et(t=>t+1,0),[A,Q]=L(null),[oe,Se]=L([]);ne(()=>{(async()=>{try{const t=await ie.catchup.keys();if(t.length){const s=Fe(),l=t.filter(n=>n.startsWith(`${s}-`));if(l.length){let n=await ie.catchup.getMany(l);n.sort((o,k)=>k.endAt-o.endAt);let r=n.slice(0,3),m=n.slice(3);const h=r.map(o=>{const{id:k,count:I,startAt:G,endAt:R}=o;return{id:k,count:I,startAt:G,endAt:R}});Se(h),Q(r[0].endAt),n=null,r=null,queueMicrotask(()=>{m.length&&ie.catchup.delMany(m.map(o=>o.id)).then(()=>{m=null}).catch(o=>{})});return}}}catch{}Se([])})()},[M]),ne(()=>{g==="start"&&q()},[g==="start"]);const[ye,ue]=j(()=>{var k,I,G,R,ee;let t=0,s=0,l=0,n=0,r=0,m=0;const h={};for(const i of u){i._filtered?(t++,i.__FILTER="filtered"):i.group?(s++,i.__FILTER="group"):i.reblog?(l++,i.__FILTER="boost"):(k=i._followedTags)!=null&&k.length?(r++,i.__FILTER="followedTags"):i.inReplyToId&&i.inReplyToAccountId!==((I=i.account)==null?void 0:I.id)?(n++,i.__FILTER="reply"):(m++,i.__FILTER="original");const w=i.reblog||i;if(i.__FILTER!=="filtered"&&((G=w.card)!=null&&G.url)&&((R=w.card)!=null&&R.image)&&((ee=w.card)==null?void 0:ee.type)==="link"){const{card:V,favouritesCount:ge,reblogsCount:te}=w;let{url:_}=V;if(_=_.replace(/\/$/,""),!h[_])h[_]={postID:w.id,card:V,shared:1,sharers:[i.account],likes:ge,boosts:te};else{if(h[_].sharers.find(le=>le.id===i.account.id))continue;h[_].shared++,h[_].sharers.push(i.account),h[_].postID!==w.id&&(h[_].likes+=ge,h[_].boosts+=te)}}}let o=[];for(const i in h)o.push({url:i,...h[i]});if(o.sort((i,w)=>i.shared>w.shared?-1:i.shared<w.shared?1:i.boosts>w.boosts?-1:i.boosts<w.boosts?1:i.likes>w.likes?-1:i.likes<w.likes?1:0),o.length>10)e:for(let i=10;i<o.length;i++){const{shared:w}=o[i];if(w<=1){o=o.slice(0,i);break e}}return[{Filtered:t,Groups:s,Boosts:l,Replies:n,"Followed tags":r,Original:m},o]},[u]),[z,we]=L("All"),[y,Y]=L(null),[H,Pe]=L(1),[C,De]=L("createdAt"),[W,ke]=L("asc"),[U,_e]=L(null),[ae,P,J]=j(()=>{const t={},s=new Map;let l=u.filter(r=>{const m=z==="All"||r.__FILTER===Oe[z];return m&&(t[r.account.id]=r.account,s.set(r.account.id,(s.get(r.account.id)||0)+1)),m});const n={};return l.forEach(r=>{r.reblog&&(n[r.reblog.id]?(n[r.reblog.id].__BOOSTERS?n[r.reblog.id].__BOOSTERS.add(r.account):n[r.reblog.id].__BOOSTERS=new Set([r.account]),r.__HIDDEN=!0):n[r.reblog.id]=r)}),y&&s.has(y)&&(l=l.filter(r=>r.account.id===y||[...r.__BOOSTERS||[]].find(m=>m.id===y))),[l,t,Object.fromEntries(s)]},[z,y,u]),pe=j(()=>{const t={};return ae.forEach(s=>{t[s.id]=s}),t},[ae]),B=j(()=>Object.keys(J).sort((t,s)=>J[s]-J[t]),[J]),Ne=j(()=>{const t={};return B.forEach((s,l)=>{t[s]=l}),ae.filter(s=>!s.__HIDDEN).sort((s,l)=>{if(U==="account"){const n=s.account.id,r=l.account.id,m=t[n],h=t[r],o=m-h;if(o!==0)return o}if(C!=="createdAt"&&(s=s.reblog||s,l=l.reblog||l,C!=="density"&&s[C]===l[C]))return s.createdAt>l.createdAt?1:-1;if(C==="density"){const n=Be(s),r=Be(l);return W==="asc"?n>r?1:-1:r>n?1:-1}return W==="asc"?s[C]>l[C]?1:-1:l[C]>s[C]?1:-1})},[ae,C,W,U,B]),Te=se(null),re=se(null),xe=se(!1);ne(()=>{u.length>100||xe.current||re.current&&(tt(re.current,{duration:200}),xe.current=!0)},[u,re]);const Ce=u.length>160?"3d":"2d",ze=j(()=>Ce!=="2d"?null:u.map(t=>{const s=pe[t.id];return e("span",{class:`post-dot ${s?"post-dot-highlight":""}`},t.id)}),[pe]),He=j(()=>Ce!=="3d"||!(u!=null&&u.length)?null:xt(u,"createdAt",320).map((s,l)=>e("div",{class:"posts-bin",children:s.map(n=>{const r=pe[n.id];return e("span",{class:`post-dot ${r?"post-dot-highlight":""}`},n.id)})},l)),[pe]),x=se(null),Ee=j(()=>A?(Date.now()-A)/1e3/60/60:null,[A,H]);ne(()=>{if(g!=="results")return;const t=y&&P[y]?P[y].username:"",s=W==="asc"?0:1,l={account:"authors"};let n=Ae({duration:5e3,text:`Showing ${kt[z]||"all posts"}${t?` by @${t}`:""}, ${Tt[C][s]} first${U?`, grouped by ${U==="account"?l[U]:""}`:""}`});return()=>{var r;(r=n==null?void 0:n.hideToast)==null||r.call(n)}},[g,z,y,C,W,U,P]),ne(()=>{var t;if(y&&P[y]){const s=re.current.querySelector(`[data-author="${y}"]`),l=(t=re.current)==null?void 0:t.getBoundingClientRect(),n=s==null?void 0:s.getBoundingClientRect();n.left<l.left||n.right>l.right?s.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}):n.top<0&&s.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}},[y,P]);const[Ue,Re]=L(!1),fe=".catchup-list > li > a",Ge=ce("j",()=>{const t=document.activeElement.closest(fe),s=t==null?void 0:t.getBoundingClientRect(),l=Array.from(x.current.querySelectorAll(fe));if(t&&s.top<x.current.clientHeight&&s.bottom>0){const n=l.indexOf(t),r=l[n+1];r&&(r.focus(),r.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const n=l.find(r=>r.getBoundingClientRect().top>=0);n&&(n.focus(),n.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),je=ce("k",()=>{const t=document.activeElement.closest(fe),s=t==null?void 0:t.getBoundingClientRect(),l=Array.from(x.current.querySelectorAll(fe));if(t&&s.top<x.current.clientHeight&&s.bottom>0){const n=l.indexOf(t);let r=l[n-1];r&&(r.focus(),r.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const n=l.find(r=>{const m=r.getBoundingClientRect();return m.top>=44&&m.left>=0});n&&(n.focus(),n.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),qe=ce("h, l",(t,s)=>{var n,r,m;const l=s.keys[0];if(y){const h=B.indexOf(y);l==="h"?h>0&&h<B.length&&(Y(B[h-1]),(n=x.current)==null||n.focus()):l==="l"&&h<B.length-1&&h>=0&&(Y(B[h+1]),(r=x.current)==null||r.focus())}else l==="l"&&(Y(B[0]),(m=x.current)==null||m.focus())},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]}),Ve=ce("esc",()=>{var t;Y(null),(t=x.current)==null||t.focus()},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]}),Et=ce(".",()=>{var t;(t=x.current)==null||t.scrollTo({top:0,behavior:"smooth"})},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]});return e("div",{ref:t=>{x.current=t,Ge.current=t,je.current=t,qe.current=t,Ve.current=t},id:"catchup-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck wide",children:[e("header",{class:`${g==="loading"?"loading":""}`,onClick:t=>{var s;t.target.closest("a, button")||(s=x.current)==null||s.scrollTo({top:0,behavior:"smooth"})},children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(We,{}),g==="results"&&e(be,{to:"/catchup",class:"button plain",children:e($,{icon:"history2",size:"l"})}),g==="start"&&e(be,{to:"/",class:"button plain",children:e($,{icon:"home",size:"l"})})]}),e("h1",{children:g!=="start"&&e(N,{children:["Catch-up ",e("sup",{children:"beta"})]})}),e("div",{class:"header-side",children:g!=="start"&&g!=="loading"&&e("button",{type:"button",class:"plain",onClick:()=>{Re(!0)},children:"Help"})})]})}),e("main",{children:[g==="start"&&e("div",{class:"catchup-start",children:[e("h1",{children:["Catch-up ",e("sup",{children:"beta"})]}),e("details",{children:[e("summary",{children:"What is this?"}),e("p",{children:"Catch-up is a separate timeline for your followings, offering a high-level view at a glance, with a simple, email-inspired interface to effortlessly sort and filter through posts."}),e("img",{src:mt,width:"1200",height:"900",alt:"Preview of Catch-up UI"}),e("p",{children:e("button",{type:"button",onClick:t=>{t.target.closest("details").open=!1},children:"Let's catch up"})})]}),e("p",{children:"Let's catch up on the posts from your followings."}),e("p",{children:e("b",{children:"Show me all posts from…"})}),e("div",{class:"catchup-form",children:[e("input",{ref:O,type:"range",value:H,min:E[0].value,max:E[E.length-1].value,step:"1",list:"catchup-ranges",onChange:t=>Pe(+t.target.value)})," ",e("span",{style:{width:"8em"},children:[E[H-1].label,e("br",{}),e("small",{class:"insignificant",children:H==E[E.length-1].value?"until the max":it(new Date(Date.now()-H*60*60*1e3))})]}),e("datalist",{id:"catchup-ranges",children:E.map(({label:t,value:s})=>e("option",{value:s,label:t}))})," ",e("button",{type:"button",onClick:()=>{var t;if(H<E[E.length-1].value){let s;H===E[E.length-1].value&&((t=de.current)!=null&&t.checked)?s=Date.now()-A:s=H*60*60*1e3,D({duration:s})}else D()},children:"Catch up"})]}),Ee&&H>Ee?e("p",{class:"catchup-info",children:[e($,{icon:"info"})," Overlaps with your last catch-up"]}):H===E[E.length-1].value&&A?e("p",{class:"catchup-info",children:e("label",{children:[e("input",{type:"checkbox",switch:!0,checked:!0,ref:de})," ","Until the last catch-up (",me.format(new Date(A)),")"]})}):null,e("p",{class:"insignificant",children:e("small",{children:"Note: your instance might only show a maximum of 800 posts in the Home timeline regardless of the time range. Could be less or more."})}),!!(oe!=null&&oe.length)&&e("div",{class:"catchup-prev",children:[e("p",{children:"Previously…"}),e("ul",{children:oe.map(t=>e("li",{children:[e(be,{to:`/catchup?id=${t.id}`,children:[e($,{icon:"history2"})," ",e("span",{children:t.startAt?me.formatRange(new Date(t.startAt),new Date(t.endAt)):`… – ${me.format(new Date(t.endAt))}`})]})," ",e("span",{children:[e("small",{class:"ib insignificant",children:[t.count," posts"]})," ",e("button",{type:"button",class:"light danger small",onClick:async()=>{var l;if(confirm("Remove this catch-up?")){let n=Ae(`Removing Catch-up ${t.id}`);await ie.catchup.del(t.id),(l=n==null?void 0:n.hideToast)==null||l.call(n),Ae(`Catch-up ${t.id} removed`),q()}},children:e($,{icon:"x"})})]})]},t.id))}),oe.length>=3&&e("p",{children:e("small",{children:"Note: Only max 3 will be stored. The rest will be automatically removed."})})]})]}),g==="loading"&&e("div",{class:"ui-state catchup-start",children:[e(gt,{abrupt:!0}),e("p",{class:"insignificant",children:"Fetching posts…"}),e("p",{class:"insignificant",children:"This might take a while."})]}),g==="results"&&e(N,{children:[e("div",{class:"catchup-header",children:[u.length>0&&e("p",{children:e("b",{class:"ib",children:me.formatRange(new Date(u[0].createdAt),new Date(u[u.length-1].createdAt))})}),e("aside",{children:[e("button",{hidden:z==="All"&&!y&&C==="createdAt"&&W==="asc",type:"button",class:"plain4 small",onClick:()=>{we("All"),Y(null),De("createdAt"),_e(null),ke("asc")},children:"Reset filters"}),(ue==null?void 0:ue.length)>0&&e("button",{type:"button",class:"plain small",onClick:()=>c(!b),children:["Top links"," ",e($,{icon:"chevron-down",style:{transform:b?"rotate(180deg)":"rotate(0deg)"}})]})]})]}),e("div",{class:"shazam-container no-animation",hidden:!b,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"catchup-top-links links-bar",children:ue.map(t=>{const{card:s,shared:l,sharers:n,likes:r,boosts:m}=t,{blurhash:h,title:o,description:k,url:I,image:G,imageDescription:R,language:ee,width:i,height:w,publishedAt:V}=s,ge=new URL(I).hostname.replace(/^www\./,"").replace(/\/$/,"");let te;if(h){const _=st(h),le=Xe(_);te=Ze([.6,le[1],le[2]])}return e("a",{href:I,target:"_blank",rel:"noopener noreferrer",style:te?{"--accent-color":`rgb(${te.join(",")})`,"--accent-alpha-color":`rgba(${te.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:G,alt:R,width:i,height:w,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:ge})," ",!!V&&e(N,{children:"· "}),!!V&&e(N,{children:e(Me,{datetime:V,format:"micro"})})]}),!!o&&e("h1",{class:"title",lang:ee,dir:"auto",title:o,children:o})]}),!!k&&e("p",{class:"description",lang:ee,dir:"auto",title:k,children:k}),e("hr",{}),e("p",{style:{whiteSpace:"nowrap"},children:["Shared by"," ",n.map(_=>{const{avatarStatic:le,displayName:Ke}=_;return e(ve,{url:le,size:"s",alt:Ke})})]})]})]})},I)})})})}),u.length>=5&&(Ce==="3d"?e("div",{class:"catchup-posts-viz-time-bar",children:He}):e("div",{class:"catchup-posts-viz-bar",children:ze})),u.length>=2&&e("div",{class:"catchup-filters",children:[e("label",{class:"filter-cat",children:[e("input",{type:"radio",name:"filter-cat",checked:z.toLowerCase()==="all",onChange:()=>{we("All")}}),"All ",e("span",{class:"count",children:u.length})]}),vt.map(t=>!!ye[t]&&e("label",{class:"filter-cat",title:(ye[t]/u.length*100).toFixed(2)+"%",children:[e("input",{type:"radio",name:"filter-cat",checked:z.toLowerCase()===t.toLowerCase(),onChange:()=>{we(t)}}),t," ",e("span",{class:"count",children:ye[t]})]},t))]}),u.length>=2&&!!J&&e("div",{class:"catchup-filters authors-filters",ref:re,children:[B.map(t=>e("label",{class:"filter-author","data-author":t,children:[e("input",{type:"radio",name:"filter-author",checked:y===t,onChange:()=>{Y(t)},onClick:()=>{y===t&&Y(null)}}),e(ve,{url:P[t].avatarStatic||P[t].avatar,size:"xxl",alt:`${P[t].displayName} (@${P[t].acct})`})," ",e("span",{class:"count",children:J[t]}),e("span",{class:"username",children:P[t].username})]},`${t}-${J[t]}`)),B.length>5&&e("small",{style:{whiteSpace:"nowrap",paddingInline:"1em",opacity:.33},children:[B.length," authors"]},"authors-count")]}),u.length>=2&&e("div",{class:"catchup-filters",children:[e("span",{class:"filter-label",children:"Sort"})," ",e("fieldset",{class:"radio-field-group",children:yt.map(t=>e("label",{class:"filter-sort",onClick:s=>{C===t&&(s.preventDefault(),s.stopPropagation(),ke(W==="asc"?"desc":"asc"))},children:[e("input",{type:"radio",name:"filter-sort-cat",checked:C===t,onChange:()=>{De(t);const s=/(replies|favourites|reblogs)/.test(t)?"desc":"asc";ke(s)}}),{createdAt:"Date",repliesCount:"Replies",favouritesCount:"Likes",reblogsCount:"Boosts",density:"Density"}[t],C===t&&(W==="asc"?" ↑":" ↓")]},t))}),e("span",{class:"filter-label",children:"Group"})," ",e("fieldset",{class:"radio-field-group",children:wt.map(t=>e("label",{class:"filter-group",children:[e("input",{type:"radio",name:"filter-group",checked:U===t,onChange:()=>{_e(t)},disabled:t==="account"&&y}),{account:"Authors"}[t]||"None"]},t||"none"))}),y&&B.length>1?e("button",{type:"button",class:"plain6 small",onClick:()=>{Y(null)},style:{whiteSpace:"nowrap"},children:"Show all authors"}):null]}),e("ul",{class:`catchup-list catchup-filter-${Oe[z]||""} ${C?`catchup-sort-${C}`:""} ${y&&P[y]?"catchup-selected-author":""} ${U?`catchup-group-${U}`:""}`,children:Ne.map((t,s)=>{var r;const l=((r=t.reblog)==null?void 0:r.id)||t.id;let n=!1;return U==="account"&&(Te.current&&t.account.id!==Te.current&&s>0&&(n=!0),Te.current=t.account.id),e(N,{children:[n&&e("li",{class:"separator"}),e(Rt,{to:`/${p}/s/${l}`,post:t,root:x.current})]},`${t.id}-${n}`)})}),e("footer",{children:ae.length>5&&e("p",{children:[z==="Boosts"?"You don't have to read everything.":"That's all."," ",e("button",{type:"button",class:"textual",onClick:()=>{x.current.scrollTop=0},children:"Back to top"}),"."]})})]})]})]}),Ue&&e(ot,{onClose:()=>Re(!1),children:e("div",{class:"sheet",id:"catchup-help-sheet",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>Re(!1),children:e($,{icon:"x"})}),e("header",{children:e("h2",{children:"Help"})}),e("main",{children:e("dl",{children:[e("dt",{children:"Top links"}),e("dd",{children:"Links shared by followings, sorted by shared counts, boosts and likes."}),e("dt",{children:"Sort: Density"}),e("dd",{children:'Posts are sorted by information density or depth. Shorter posts are "lighter" while longer posts are "heavier". Posts with photos are "heavier" than posts without photos.'}),e("dt",{children:"Group: Authors"}),e("dd",{children:"Posts are grouped by authors, sorted by posts count per author."}),e("dt",{children:"Keyboard shortcuts"}),e("dd",{children:[e("kbd",{children:"j"}),": Next post"]}),e("dd",{children:[e("kbd",{children:"k"}),": Previous post"]}),e("dd",{children:[e("kbd",{children:"l"}),": Next author"]}),e("dd",{children:[e("kbd",{children:"h"}),": Previous author"]}),e("dd",{children:[e("kbd",{children:"Enter"}),": Open post details"]}),e("dd",{children:[e("kbd",{children:"."}),": Scroll to top"]})]})})]})})]})}const Ct=nt(function({post:v}){const{id:p,account:f,group:a,reblog:d,inReplyToId:g,inReplyToAccountId:T,_followedTags:b,_filtered:c,visibility:S,__BOOSTERS:F}=v,Z=g&&T!==f.id,u=!!c,K=O=>{O.shiftKey};return e("article",{class:`post-line ${a?"group":d?"reblog":b!=null&&b.length?"followed-tags":""} ${Z?"reply-to":""} ${u?"filtered":""} visibility-${S}`,onMouseEnter:K,children:[e("span",{class:"post-author",children:d?e("span",{class:"post-reblog-avatar",children:[e(ve,{url:f.avatarStatic||f.avatar,squircle:f.bot}),(F==null?void 0:F.size)>0?[...F].map(O=>e(ve,{url:O.avatarStatic||O.avatar,squircle:O.bot})):""," ",e($,{icon:"rocket"})," ",e(Le,{account:d.account,showAvatar:!0})]}):e(Le,{account:f,showAvatar:!0})}),e(St,{post:d||v,filterInfo:c}),e("span",{class:"post-meta",children:[e(Dt,{post:d||v})," ",e(Me,{datetime:new Date((d==null?void 0:d.createdAt)||v.createdAt),format:"micro"})]})]})},(v,p)=>{var f,a;return((f=v==null?void 0:v.post)==null?void 0:f.id)===((a=p==null?void 0:p.post)==null?void 0:a.id)}),Rt=({root:v,to:p,...f})=>{const a=se(),[d,g]=L(!1);return ne(()=>{const T=new IntersectionObserver(b=>{b[0].isIntersecting&&(queueMicrotask(()=>g(!0)),T.unobserve(a.current))},{root:v,rootMargin:`${Math.max(320,screen.height*.75)}px`});return a.current&&T.observe(a.current),()=>{a.current&&T.unobserve(a.current)}},[]),d?e("li",{children:e(be,{to:p,children:e(Ct,{...f})})}):e("li",{ref:a,style:{height:"4em"}})},At=8,It=8;function Be(v){var c;const{spoilerText:p,content:f,poll:a,mediaAttachments:d,card:g}=v,T=(c=a==null?void 0:a.options)!=null&&c.length?a.options.reduce((S,F)=>S+F.title,""):"";return(p.length+at(f)+T.length)/140+(d!=null&&d.length?At*d.length:g!=null&&g.image?It:0)}const X=48;function St({post:v,filterInfo:p}){var he;const{spoilerText:f,sensitive:a,content:d,emojis:g,poll:T,mediaAttachments:b,card:c,inReplyToId:S,inReplyToAccountId:F,account:Z,_thread:u}=v,K=S&&F===Z.id||!!u,O=!f&&!a,de=d?ct(v):"";return e("div",{class:"post-peek",title:f?"":de,children:[e("span",{class:"post-peek-content",children:p?e(N,{children:[K&&e(N,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-filtered",children:["Filtered",p!=null&&p.titlesStr?`: ${p.titlesStr}`:""]})]}):f?e(N,{children:[K&&e(N,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-spoiler",children:[e($,{icon:"eye-close"})," ",f]})]}):e("div",{class:"post-peek-html",children:[K&&e(N,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),!!d&&e("div",{dangerouslySetInnerHTML:{__html:dt(d,g)}}),!!((he=T==null?void 0:T.options)!=null&&he.length)&&T.options.map(D=>e("div",{children:[T.multiple?"▪️":"•"," ",D.title]})),!d&&(b==null?void 0:b.length)===1&&b[0].description&&e(N,{children:[e("span",{class:"post-peek-tag post-peek-alt",children:"ALT"})," ",e("div",{children:b[0].description})]})]})}),!p&&e("span",{class:"post-peek-post-content",children:[!!T&&e("span",{class:"post-peek-tag post-peek-poll",children:[e($,{icon:"poll",size:"s"}),"Poll"]}),b!=null&&b.length?b.map(D=>{const M=D.previewUrl||D.url,q=D.previewRemoteUrl||D.remoteUrl;return e("span",{class:"post-peek-media",children:{image:(M||q)&&O?e("img",{src:M,width:X,height:X,alt:D.description,loading:"lazy",onError:A=>{const{src:Q}=A.target;Q===M&&(A.target.src=q)}}):e("span",{class:"post-peek-faux-media",children:"🖼"}),gifv:(M||q)&&O?e("img",{src:M,width:X,height:X,alt:D.description,loading:"lazy",onError:A=>{const{src:Q}=A.target;Q===M&&(A.target.src=q)}}):e("span",{class:"post-peek-faux-media",children:"🎞️"}),video:(M||q)&&O?e("img",{src:M,width:X,height:X,alt:D.description,loading:"lazy",onError:A=>{const{src:Q}=A.target;Q===M&&(A.target.src=q)}}):e("span",{class:"post-peek-faux-media",children:"📹"}),audio:e("span",{class:"post-peek-faux-media",children:"🎵"})}[D.type]||null},D.id)}):!!c&&c.image&&O&&e("span",{class:`post-peek-media post-peek-card card-${c.type||""}`,children:c.image?e("img",{src:c.image,width:X,height:X,alt:c.title||c.description||c.imageDescription,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"🔗"})})]})]})}function Dt({post:v}){const{reblogsCount:p,repliesCount:f,favouritesCount:a}=v;return e("span",{class:"post-stats",children:[f>0&&e("span",{class:"post-stat-replies",children:[e($,{icon:"comment2",size:"s"})," ",Ie(f)]}),a>0&&e("span",{class:"post-stat-likes",children:[e($,{icon:"heart",size:"s"})," ",Ie(a)]}),p>0&&e("span",{class:"post-stat-boosts",children:[e($,{icon:"rocket",size:"s"})," ",Ie(p)]})]})}const{locale:_t}=new Intl.DateTimeFormat().resolvedOptions(),me=new Intl.DateTimeFormat(_t,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"});function xt(v,p,f){const a=v.map(c=>new Date(c[p])),d=a.reduce((c,S)=>S<c?S:c,a[0]),T=a.reduce((c,S)=>S>c?S:c,a[0]).getTime()-d.getTime(),b=Array.from({length:f},()=>[]);return v.forEach(c=>{const F=(new Date(c[p]).getTime()-d.getTime())/T,Z=Math.floor(F*(f-1));b[Z].push(c)}),b}export{Mt as default};
//# sourceMappingURL=catchup-rVT38wCS.js.map
