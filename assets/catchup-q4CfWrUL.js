import{a as He,b as je,N as qe,r as Ke,o as Ye}from"./main-k4SbjvMq.js";import{ac as Ve,a as Xe,q as We,p as L,h as Qe,v as N,a3 as Ze,$ as Je,s as $e,F as Z,al as _e,ak as re,D as et,_ as J,X as tt,e,c as Te,d as st,k as ue,I as $,g as F,K as nt,L as rt,aj as at,R as Be,A as Ce,M as lt,N as xe,w as it,aq as ot,aa as ct,aG as dt,i as ke}from"./db-5YOT5fo8.js";import{u as ht}from"./index-_Y-Lyw2n.js";import"./intl-segmenter-polyfill-XHDQHdV5.js";const ut=""+new URL("catch-up-DuauQu-W.png",import.meta.url).href,pt="home",H=[{label:"last 1 hour",value:1},{label:"last 2 hours",value:2},{label:"last 3 hours",value:3},{label:"last 4 hours",value:4},{label:"last 5 hours",value:5},{label:"last 6 hours",value:6},{label:"last 7 hours",value:7},{label:"last 8 hours",value:8},{label:"last 9 hours",value:9},{label:"last 10 hours",value:10},{label:"last 11 hours",value:11},{label:"last 12 hours",value:12},{label:"beyond 12 hours",value:13}],gt=["Original","Replies","Boosts","Followed tags","Groups","Filtered"],ft=["createdAt","repliesCount","favouritesCount","reblogsCount","density"],mt=[null,"account"],Ee={Filtered:"filtered",Groups:"group",Boosts:"boost",Replies:"reply","Followed tags":"followedTags",Original:"original"},bt={Filtered:"filtered posts",Groups:"group posts",Boosts:"boosts",Replies:"replies","Followed tags":"followed-tag posts",Original:"original posts"},yt={createdAt:["oldest","latest"],repliesCount:["fewest replies","most replies"],favouritesCount:["fewest likes","most likes"],reblogsCount:["fewest boosts","most boosts"],density:["least dense","most dense"]};function xt(){Ve("Catch-up","/catchup");const{masto:f,instance:d}=Xe(),[p,o]=We(),h=p.get("id"),[g,y]=L("start"),[m,c]=L(!1),R=N(()=>Qe.session.get("currentAccount"),[]),U=t=>t===R;async function V({maxCreatedAt:t}){var l,I,v;const s=t?new Date(t):null,r=[],n=f.v1.timelines.home.list({limit:40});e:for(;;)try{const i=await n.next(),{value:w}=i;if(w!=null&&w.length){await He(w,d);let A=!1;for(let z=0;z<w.length;z++){const C=w[z],W=new Date(C.createdAt);if(!s||W>=s){const b=!U(((I=(l=C.reblog)==null?void 0:l.account)==null?void 0:I.id)||C.account.id)&&Ze(((v=C.reblog)==null?void 0:v.filtered)||C.filtered,pt);if((b==null?void 0:b.action)==="hide")continue;C._filtered=b;const G=Je(C.id,d);C._followedTags=$e.statusFollowedTags[G]?[...$e.statusFollowedTags[G]]:[],r.push(C),A=!0}if(!A)break e}}else break e;await new Promise(A=>setTimeout(A,1e3))}catch{break e}return r.forEach(i=>{if(i!=null&&i.inReplyToId){const w=r.find(A=>A.id===i.inReplyToId);w&&!w.inReplyToId&&(w._thread=!0)}}),r}const[u,j]=L([]),ee=Z(),pe=N(()=>_e(),[]),ae=et(async({duration:t}={})=>{const s=Date.now(),r=t?s-t:null;y("loading");const n=await V({maxCreatedAt:r}),l=`${pe}-${ht()}`;try{await re.catchup.set(l,{id:l,posts:n,count:n.length,startAt:r,endAt:s}),o({id:l})}catch{}},[]);J(()=>{h?(async()=>{const t=await re.catchup.get(h);t&&(t.posts.sort((s,r)=>s.createdAt>r.createdAt?1:-1),j(t.posts),y("results"))})():g==="results"&&(j([]),y("start"))},[h]);const[D,_]=tt(t=>t+1,0),[M,B]=L(null),[x,Ae]=L([]);J(()=>{(async()=>{try{const t=await re.catchup.keys();if(t.length){const s=_e(),r=t.filter(n=>n.startsWith(`${s}-`));if(r.length){let n=await re.catchup.getMany(r);n.sort((i,w)=>w.endAt-i.endAt);let l=n.slice(0,3),I=n.slice(3);const v=l.map(i=>{const{id:w,count:A,startAt:z,endAt:C}=i;return{id:w,count:A,startAt:z,endAt:C}});Ae(v),B(l[0].endAt),n=null,l=null,queueMicrotask(()=>{I.length&&re.catchup.delMany(I.map(i=>i.id)).then(()=>{I=null}).catch(i=>{})});return}}}catch{}Ae([])})()},[D]),J(()=>{g==="start"&&_()},[g==="start"]);const[ge,oe]=N(()=>{var w,A,z,C,W;let t=0,s=0,r=0,n=0,l=0,I=0;const v={};for(const a of u){a._filtered?(t++,a.__FILTER="filtered"):a.group?(s++,a.__FILTER="group"):a.reblog?(r++,a.__FILTER="boost"):(w=a._followedTags)!=null&&w.length?(l++,a.__FILTER="followedTags"):a.inReplyToId&&a.inReplyToAccountId!==((A=a.account)==null?void 0:A.id)?(n++,a.__FILTER="reply"):(I++,a.__FILTER="original");const b=a.reblog||a;if(a.__FILTER!=="filtered"&&((z=b.card)!=null&&z.url)&&((C=b.card)!=null&&C.image)&&((W=b.card)==null?void 0:W.type)==="link"){const{card:G,favouritesCount:he,reblogsCount:Q}=b;let{url:S}=G;if(S=S.replace(/\/$/,""),!v[S])v[S]={postID:b.id,card:G,shared:1,sharers:[a.account],likes:he,boosts:Q};else{if(v[S].sharers.find(ne=>ne.id===a.account.id))continue;v[S].shared++,v[S].sharers.push(a.account),v[S].postID!==b.id&&(v[S].likes+=he,v[S].boosts+=Q)}}}let i=[];for(const a in v)i.push({url:a,...v[a]});if(i.sort((a,b)=>a.shared>b.shared?-1:a.shared<b.shared?1:a.boosts>b.boosts?-1:a.boosts<b.boosts?1:a.likes>b.likes?-1:a.likes<b.likes?1:0),i.length>10)e:for(let a=10;a<i.length;a++){const{shared:b}=i[a];if(b<=1){i=i.slice(0,a);break e}}return[{Filtered:t,Groups:s,Boosts:r,Replies:n,"Followed tags":l,Original:I},i]},[u]),[P,fe]=L("All"),[T,ce]=L(null),[q,Pe]=L(1),[k,Re]=L("createdAt"),[K,me]=L("asc"),[O,Ie]=L(null),[le,E,X]=N(()=>{const t={},s=new Map;let r=u.filter(n=>{const l=P==="All"||n.__FILTER===Ee[P];return l&&(t[n.account.id]=n.account,s.set(n.account.id,(s.get(n.account.id)||0)+1)),l});return T&&s.has(T)&&(r=r.filter(n=>n.account.id===T)),[r,t,Object.fromEntries(s)]},[P,T,u]),de=N(()=>{const t={};return le.forEach(s=>{t[s.id]=s}),t},[le]),te=N(()=>Object.keys(X).sort((t,s)=>X[s]-X[t]),[X]),Oe=N(()=>{const t={};return te.forEach((s,r)=>{t[s]=r}),le.sort((s,r)=>{if(O==="account"){const n=s.account.id,l=r.account.id,I=t[n],v=t[l],i=I-v;if(i!==0)return i}if(k!=="createdAt"&&(s=s.reblog||s,r=r.reblog||r,k!=="density"&&s[k]===r[k]))return s.createdAt>r.createdAt?1:-1;if(k==="density"){const n=Fe(s),l=Fe(r);return K==="asc"?n>l?1:-1:l>n?1:-1}return K==="asc"?s[k]>r[k]?1:-1:r[k]>s[k]?1:-1})},[le,k,K,O,te]),be=Z(null),ie=Z(null),Se=Z(!1);J(()=>{u.length>100||Se.current||ie.current&&(je(ie.current,{duration:200}),Se.current=!0)},[u,ie]);const ye=u.length>160?"3d":"2d",ze=N(()=>ye!=="2d"?null:u.map(t=>{const s=de[t.id];return e("span",{class:`post-dot ${s?"post-dot-highlight":""}`},t.id)}),[de]),Ne=N(()=>ye!=="3d"||!(u!=null&&u.length)?null:St(u,"createdAt",320).map((s,r)=>e("div",{class:"posts-bin",children:s.map(n=>{const l=de[n.id];return e("span",{class:`post-dot ${l?"post-dot-highlight":""}`},n.id)})},r)),[de]),se=Z(null),De=N(()=>M?(Date.now()-M)/1e3/60/60:null,[M,q]);J(()=>{if(g!=="results")return;const t=T&&E[T]?E[T].username:"",s=K==="asc"?0:1,r={account:"authors"};let n=Te({duration:5e3,text:`Showing ${bt[P]||"all posts"}${t?` by @${t}`:""}, ${yt[k][s]} first${O?`, grouped by ${O==="account"?r[O]:""}`:""}`});return()=>{var l;(l=n==null?void 0:n.hideToast)==null||l.call(n)}},[g,P,T,k,K,O,E]);const ve=Z(!1);J(()=>{let t;return T&&(E[T]?ve.current&&(t=setTimeout(()=>{var s;(s=ie.current.querySelector(`[data-author="${T}"]`))==null||s.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},500),ve.current=!1):ve.current=!0),()=>{clearTimeout(t)}},[T,E]);const[Ue,we]=L(!1),Le=".catchup-list > li > a";return st("j",()=>{const t=document.activeElement.closest(Le),s=t==null?void 0:t.getBoundingClientRect(),r=Array.from(se.current.querySelectorAll(Le));if(t&&s.top<se.current.clientHeight&&s.bottom>0){const n=r.indexOf(t),l=r[n+1];l&&(l.focus(),l.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const n=r.find(l=>l.getBoundingClientRect().top>=0);n&&(n.focus(),n.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0}),e("div",{ref:se,id:"catchup-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck wide",children:[e("header",{class:`${g==="loading"?"loading":""}`,onClick:t=>{var s;t.target.closest("a, button")||(s=se.current)==null||s.scrollTo({top:0,behavior:"smooth"})},children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(qe,{}),g==="results"&&e(ue,{to:"/catchup",class:"button plain",children:e($,{icon:"history2",size:"l"})}),g==="start"&&e(ue,{to:"/",class:"button plain",children:e($,{icon:"home",size:"l"})})]}),e("h1",{children:g!=="start"&&e(F,{children:["Catch-up ",e("sup",{children:"beta"})]})}),e("div",{class:"header-side",children:g!=="start"&&g!=="loading"&&e("button",{type:"button",class:"plain",onClick:()=>{we(!0)},children:"Help"})})]})}),e("main",{children:[g==="start"&&e("div",{class:"catchup-start",children:[e("h1",{children:["Catch-up ",e("sup",{children:"beta"})]}),e("details",{children:[e("summary",{children:"What is this?"}),e("p",{children:"Catch-up is a separate timeline for your followings, offering a high-level view at a glance, with a simple, email-inspired interface to effortlessly sort and filter through posts."}),e("img",{src:ut,width:"1200",height:"900",alt:"Preview of Catch-up UI"}),e("p",{children:e("button",{type:"button",onClick:t=>{t.target.closest("details").open=!1},children:"Let's catch up"})})]}),e("p",{children:"Let's catch up on the posts from your followings."}),e("p",{children:e("b",{children:"Show me all posts from…"})}),e("div",{class:"catchup-form",children:[e("input",{ref:ee,type:"range",value:q,min:H[0].value,max:H[H.length-1].value,step:"1",list:"catchup-ranges",onChange:t=>Pe(+t.target.value)})," ",e("span",{style:{width:"8em"},children:[H[q-1].label,e("br",{}),e("small",{class:"insignificant",children:q==H[H.length-1].value?"until the max":nt(new Date(Date.now()-q*60*60*1e3))})]}),e("datalist",{id:"catchup-ranges",children:H.map(({label:t,value:s})=>e("option",{value:s,label:t}))})," ",e("button",{type:"button",onClick:()=>{if(q<H[H.length-1].value){const t=q*60*60*1e3;ae({duration:t})}else ae()},children:"Catch up"})]}),De&&q>De&&e("p",{class:"catchup-info",children:[e($,{icon:"info"})," Overlaps with your last catch-up"]}),e("p",{class:"insignificant",children:e("small",{children:"Note: your instance might only show a maximum of 800 posts in the Home timeline regardless of the time range. Could be less or more."})}),!!(x!=null&&x.length)&&e("div",{class:"catchup-prev",children:[e("p",{children:"Previously…"}),e("ul",{children:x.map(t=>e("li",{children:[e(ue,{to:`/catchup?id=${t.id}`,children:[e($,{icon:"history2"})," ",e("span",{children:Me(new Date(t.startAt),new Date(t.endAt))})]})," ",e("span",{children:[e("small",{class:"ib insignificant",children:[t.count," posts"]})," ",e("button",{type:"button",class:"light danger small",onClick:async()=>{var r;if(confirm("Remove this catch-up?")){let n=Te(`Removing Catch-up ${t.id}`);await re.catchup.del(t.id),(r=n==null?void 0:n.hideToast)==null||r.call(n),Te(`Catch-up ${t.id} removed`),_()}},children:e($,{icon:"x"})})]})]},t.id))}),x.length>=3&&e("p",{children:e("small",{children:"Note: Only max 3 will be stored. The rest will be automatically removed."})})]})]}),g==="loading"&&e("div",{class:"ui-state catchup-start",children:[e(rt,{abrupt:!0}),e("p",{class:"insignificant",children:"Fetching posts…"}),e("p",{class:"insignificant",children:"This might take a while."})]}),g==="results"&&e(F,{children:[e("div",{class:"catchup-header",children:[u.length>0&&e("p",{children:e("b",{class:"ib",children:Me(new Date(u[0].createdAt),new Date(u[u.length-1].createdAt))})}),e("aside",{children:[e("button",{hidden:P==="All"&&!T&&k==="createdAt"&&K==="asc",type:"button",class:"plain4 small",onClick:()=>{fe("All"),ce(null),Re("createdAt"),Ie(null),me("asc")},children:"Reset filters"}),(oe==null?void 0:oe.length)>0&&e("button",{type:"button",class:"plain small",onClick:()=>c(!m),children:["Top links"," ",e($,{icon:"chevron-down",style:{transform:m?"rotate(180deg)":"rotate(0deg)"}})]})]})]}),e("div",{class:"shazam-container no-animation",hidden:!m,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"catchup-top-links links-bar",children:oe.map(t=>{const{card:s,shared:r,sharers:n,likes:l,boosts:I}=t,{blurhash:v,title:i,description:w,url:A,image:z,imageDescription:C,language:W,width:a,height:b,publishedAt:G}=s,he=new URL(A).hostname.replace(/^www\./,"").replace(/\/$/,"");let Q;if(v){const S=at(v),ne=Ke(S);Q=Ye([.6,ne[1],ne[2]])}return e("a",{href:A,target:"_blank",rel:"noopener noreferrer",style:Q?{"--accent-color":`rgb(${Q.join(",")})`,"--accent-alpha-color":`rgba(${Q.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:z,alt:C,width:a,height:b,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:he})," ",!!G&&e(F,{children:"· "}),!!G&&e(F,{children:e(Be,{datetime:G,format:"micro"})})]}),!!i&&e("h1",{class:"title",lang:W,dir:"auto",children:i})]}),!!w&&e("p",{class:"description",lang:W,dir:"auto",children:w}),e("hr",{}),e("p",{style:{whiteSpace:"nowrap"},children:["Shared by"," ",n.map(S=>{const{avatarStatic:ne,displayName:Ge}=S;return e(Ce,{url:ne,size:"s",alt:Ge})})]})]})]})},A)})})})}),u.length>=5&&(ye==="3d"?e("div",{class:"catchup-posts-viz-time-bar",children:Ne}):e("div",{class:"catchup-posts-viz-bar",children:ze})),u.length>=2&&e("div",{class:"catchup-filters",children:[e("label",{class:"filter-cat",children:[e("input",{type:"radio",name:"filter-cat",checked:P.toLowerCase()==="all",onChange:()=>{fe("All")}}),"All ",e("span",{class:"count",children:u.length})]}),gt.map(t=>!!ge[t]&&e("label",{class:"filter-cat",title:(ge[t]/u.length*100).toFixed(2)+"%",children:[e("input",{type:"radio",name:"filter-cat",checked:P.toLowerCase()===t.toLowerCase(),onChange:()=>{fe(t)}}),t," ",e("span",{class:"count",children:ge[t]})]},t))]}),u.length>=2&&!!X&&e("div",{class:"catchup-filters authors-filters",ref:ie,children:[te.map(t=>e("label",{class:"filter-author","data-author":t,children:[e("input",{type:"radio",name:"filter-author",checked:T===t,onChange:()=>{ce(t)},onClick:()=>{T===t&&ce(null)}}),e(Ce,{url:E[t].avatarStatic||E[t].avatar,size:"xxl",alt:`${E[t].displayName} (@${E[t].username})`})," ",e("span",{class:"count",children:X[t]}),e("span",{class:"username",children:E[t].username})]},`${t}-${X[t]}`)),te.length>5&&e("small",{style:{whiteSpace:"nowrap",paddingInline:"1em",opacity:.33},children:[te.length," authors"]},"authors-count")]}),u.length>=2&&e("div",{class:"catchup-filters",children:[e("span",{class:"filter-label",children:"Sort"})," ",e("fieldset",{class:"radio-field-group",children:ft.map(t=>e("label",{class:"filter-sort",onClick:s=>{k===t&&(s.preventDefault(),s.stopPropagation(),me(K==="asc"?"desc":"asc"))},children:[e("input",{type:"radio",name:"filter-sort-cat",checked:k===t,onChange:()=>{Re(t);const s=/(replies|favourites|reblogs)/.test(t)?"desc":"asc";me(s)}}),{createdAt:"Date",repliesCount:"Replies",favouritesCount:"Likes",reblogsCount:"Boosts",density:"Density"}[t],k===t&&(K==="asc"?" ↑":" ↓")]},t))}),e("span",{class:"filter-label",children:"Group"})," ",e("fieldset",{class:"radio-field-group",children:mt.map(t=>e("label",{class:"filter-group",children:[e("input",{type:"radio",name:"filter-group",checked:O===t,onChange:()=>{Ie(t)},disabled:t==="account"&&T}),{account:"Authors"}[t]||"None"]},t||"none"))}),T&&te.length>1?e("button",{type:"button",class:"plain6 small",onClick:()=>{ce(null)},style:{whiteSpace:"nowrap"},children:"Show all authors"}):null]}),e("ul",{class:`catchup-list catchup-filter-${Ee[P]||""} ${k?`catchup-sort-${k}`:""} ${T&&E[T]?"catchup-selected-author":""} ${O?`catchup-group-${O}`:""}`,children:Oe.map((t,s)=>{var l;const r=((l=t.reblog)==null?void 0:l.id)||t.id;let n=!1;return O==="account"&&(be.current&&t.account.id!==be.current&&s>0&&(n=!0),be.current=t.account.id),e(F,{children:[n&&e("li",{class:"separator"}),e(wt,{to:`/${d}/s/${r}`,post:t,root:se.current})]},`${t.id}-${n}`)})}),e("footer",{children:le.length>5&&e("p",{children:[P==="Boosts"?"You don't have to read everything.":"That's all."," ",e("button",{type:"button",class:"textual",onClick:()=>{se.current.scrollTop=0},children:"Back to top"}),"."]})})]})]})]}),Ue&&e(lt,{onClose:()=>we(!1),children:e("div",{class:"sheet",id:"catchup-help-sheet",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>we(!1),children:e($,{icon:"x"})}),e("header",{children:e("h2",{children:"Help"})}),e("main",{children:e("dl",{children:[e("dt",{children:"Top links"}),e("dd",{children:"Links shared by followings, sorted by shared counts, boosts and likes."}),e("dt",{children:"Sort: Density"}),e("dd",{children:'Posts are sorted by information density or depth. Shorter posts are "lighter" while longer posts are "heavier". Posts with photos are "heavier" than posts without photos.'}),e("dt",{children:"Group: Authors"}),e("dd",{children:"Posts are grouped by authors, sorted by posts count per author."})]})})]})})]})}const vt=it(function({post:f}){const{id:d,account:p,group:o,reblog:h,inReplyToId:g,inReplyToAccountId:y,_followedTags:m,_filtered:c,visibility:R}=f,U=g&&y!==p.id,V=!!c,u=j=>{j.shiftKey};return e("article",{class:`post-line ${o?"group":h?"reblog":m!=null&&m.length?"followed-tags":""} ${U?"reply-to":""} ${V?"filtered":""} visibility-${R}`,onMouseEnter:u,children:[e("span",{class:"post-author",children:h?e("span",{class:"post-reblog-avatar",children:[e(Ce,{url:p.avatarStatic||p.avatar,squircle:p.bot})," ",e($,{icon:"rocket"})," ",e(xe,{account:h.account,showAvatar:!0})]}):e(xe,{account:p,showAvatar:!0})}),e(Ct,{post:h||f,filterInfo:c}),e("span",{class:"post-meta",children:[e(At,{post:h||f})," ",e(Be,{datetime:new Date((h==null?void 0:h.createdAt)||f.createdAt),format:"micro"})]})]})},(f,d)=>{var p,o;return((p=f==null?void 0:f.post)==null?void 0:p.id)===((o=d==null?void 0:d.post)==null?void 0:o.id)}),wt=({root:f,to:d,...p})=>{const o=Z(),[h,g]=L(!1);return J(()=>{const y=new IntersectionObserver(m=>{m[0].isIntersecting&&(queueMicrotask(()=>g(!0)),y.unobserve(o.current))},{root:f,rootMargin:`${Math.max(320,screen.height*.75)}px`});return o.current&&y.observe(o.current),()=>{o.current&&y.unobserve(o.current)}},[]),h?e("li",{children:e(ue,{to:d,children:e(vt,{...p})})}):e("li",{ref:o,style:{height:"4em"}})},Tt=8,kt=8;function Fe(f){var c;const{spoilerText:d,content:p,poll:o,mediaAttachments:h,card:g}=f,y=(c=o==null?void 0:o.options)!=null&&c.length?o.options.reduce((R,U)=>R+U.title,""):"";return(d.length+ot(p)+y.length)/140+(h!=null&&h.length?Tt*h.length:g!=null&&g.image?kt:0)}const Y=48;function Ct({post:f,filterInfo:d}){var ae;const{spoilerText:p,sensitive:o,content:h,emojis:g,poll:y,mediaAttachments:m,card:c,inReplyToId:R,inReplyToAccountId:U,account:V,_thread:u}=f,j=R&&U===V.id||!!u,ee=!p&&!o,pe=h?ct(f):"";return e("div",{class:"post-peek",title:p?"":pe,children:[e("span",{class:"post-peek-content",children:d?e(F,{children:[j&&e(F,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-filtered",children:["Filtered",d!=null&&d.titlesStr?`: ${d.titlesStr}`:""]})]}):p?e(F,{children:[j&&e(F,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-spoiler",children:[e($,{icon:"eye-close"})," ",p]})]}):e("div",{class:"post-peek-html",children:[j&&e(F,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),!!h&&e("div",{dangerouslySetInnerHTML:{__html:dt(h,g)}}),!!((ae=y==null?void 0:y.options)!=null&&ae.length)&&y.options.map(D=>e("div",{children:[y.multiple?"▪️":"•"," ",D.title]})),!h&&(m==null?void 0:m.length)===1&&m[0].description&&e(F,{children:[e("span",{class:"post-peek-tag post-peek-alt",children:"ALT"})," ",e("div",{children:m[0].description})]})]})}),!d&&e("span",{class:"post-peek-post-content",children:[!!y&&e("span",{class:"post-peek-tag post-peek-poll",children:[e($,{icon:"poll",size:"s"}),"Poll"]}),m!=null&&m.length?m.map(D=>{const _=D.previewUrl||D.url,M=D.previewRemoteUrl||D.remoteUrl;return e("span",{class:"post-peek-media",children:{image:(_||M)&&ee?e("img",{src:_,width:Y,height:Y,alt:D.description,loading:"lazy",onError:B=>{const{src:x}=B.target;x===_&&(B.target.src=M)}}):e("span",{class:"post-peek-faux-media",children:"🖼"}),gifv:(_||M)&&ee?e("img",{src:_,width:Y,height:Y,alt:D.description,loading:"lazy",onError:B=>{const{src:x}=B.target;x===_&&(B.target.src=M)}}):e("span",{class:"post-peek-faux-media",children:"🎞️"}),video:(_||M)&&ee?e("img",{src:_,width:Y,height:Y,alt:D.description,loading:"lazy",onError:B=>{const{src:x}=B.target;x===_&&(B.target.src=M)}}):e("span",{class:"post-peek-faux-media",children:"📹"}),audio:e("span",{class:"post-peek-faux-media",children:"🎵"})}[D.type]||null},D.id)}):!!c&&c.image&&ee&&e("span",{class:`post-peek-media post-peek-card card-${c.type||""}`,children:c.image?e("img",{src:c.image,width:Y,height:Y,alt:c.title||c.description||c.imageDescription,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"🔗"})})]})]})}function At({post:f}){const{reblogsCount:d,repliesCount:p,favouritesCount:o}=f;return e("span",{class:"post-stats",children:[p>0&&e("span",{class:"post-stat-replies",children:[e($,{icon:"comment2",size:"s"})," ",ke(p)]}),o>0&&e("span",{class:"post-stat-likes",children:[e($,{icon:"heart",size:"s"})," ",ke(o)]}),d>0&&e("span",{class:"post-stat-boosts",children:[e($,{icon:"rocket",size:"s"})," ",ke(d)]})]})}const{locale:Rt}=new Intl.DateTimeFormat().resolvedOptions(),It=new Intl.DateTimeFormat(Rt,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"});function Me(f,d){return It.formatRange(f,d)}function St(f,d,p){const o=f.map(c=>new Date(c[d])),h=o.reduce((c,R)=>R<c?R:c,o[0]),y=o.reduce((c,R)=>R>c?R:c,o[0]).getTime()-h.getTime(),m=Array.from({length:p},()=>[]);return f.forEach(c=>{const U=(new Date(c[d]).getTime()-h.getTime())/y,V=Math.floor(U*(p-1));m[V].push(c)}),m}export{xt as default};
//# sourceMappingURL=catchup-q4CfWrUL.js.map
