import{s as T,a as Q,b as He,c as be,g as ct,d as ds,e as St,p as ht,u as Ks,L as Ae,f as jt,h as us,i as Js,C as Xs,j as Ke,k as Zs,l as hn,m as qe,n as hs,t as Qs,o as ei,q as An,r as ti,v as $n,w as _n}from"./useTitle-G76IQb4q.js";import{F as z,_ as G,p as A,u as Re,x as Xe,a as Me,b as e,k as R,y as mt,c as pn,M as de,d as ze,e as Tt,q as pe,f as xt,g as Qe,I as rt,A as lt,h as fn,l as Rn,s as ps,i as fs,j as it,T as ni,m as si,n as ii,P as oi,J as ai,C as ms,o as ci,r as gt,t as ri,v as li,w as gs,z as di,B as ui,D as hi,E as pi,G as Lt,H as bs,K as En,L as fi,R as mn,N as Ue,O as mi,Q as gi}from"./vendor-xjYnst4X.js";import{u as gn,s as se,o as Ln,a as bi,I as w,M as $e,A as st,N as It,b as Je,c as et,L as oe,g as ys,l as yi,t as Mn,R as bt,d as We,e as Ze,f as _e,h as ws,i as on,E as vs,j as Ge,n as ot,k as wi,S as Wt,m as Pn,T as ks,p as nt,q as bn,r as Be,v as Nn,w as vi,x as ki,y as Ss,C as Si,z as Ii,F as Is,B as Mt,D as Ci,G as At,H as yn,J as Cs,K as Ti,O as Dt}from"./status-ZnvYi558.js";function Ct(t=()=>{},n=[]){const i=z(t);G(()=>{i.current=t},[n]),G(()=>{const s=()=>{const o=document.hidden||document.visibilityState==="hidden";i.current(!o)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[])}const xi=1e3*3,Ai=15e3,$i=Xe(function({isLoggedIn:n}){const[i,s]=A(!0);Ct(s);const o=async(u,c,p)=>{var f;if(T.notificationsLast){const r=u.v1.notifications.list({limit:1,sinceId:T.notificationsLast.id}),{value:h}=await r.next();if(h!=null&&h.length)if(p)T.notificationsShowNew=!0;else{let l;try{const y=await u.v1.markers.fetch({timeline:"notifications"});l=(f=y==null?void 0:y.notifications)==null?void 0:f.lastReadId}catch{}l?T.notificationsShowNew=h[0].id!==l:T.notificationsShowNew=!0}}};G(()=>{let u,c;if(n&&i){const{masto:p,streaming:f,instance:r}=Q();(async()=>{await o(p,r);let h=!1;f&&(c=setTimeout(()=>{(async()=>{try{h=!0,u=f.user.notification.subscribe();for await(const l of u){if(!u||!i)break;l.event==="notification"&&He(l.payload,r,{skipThreading:!0}),T.notificationsShowNew=!0}}catch{h=!1}h||(c=setInterval(()=>{o(p,r,!0)},Ai))})()},xi))})()}return()=>{var p;(p=u==null?void 0:u.unsubscribe)==null||p.call(u),u=null,clearTimeout(c),clearInterval(c)}},[i,n]);const a=z(),d=()=>{a.current=Date.now(),fetch("./version.json").then(u=>u.json()).then(u=>{u&&(T.appVersion=u)}).catch(u=>{})};return gn(d,i&&1e3*60*30),Ct(u=>{u&&(a.current?Date.now()-a.current>1e3*60*60&&d():d())}),Re("shift+alt+k",()=>{const u=T.settings.cloakMode;T.settings.cloakMode=!u,se({text:`Cloak mode ${u?"disabled":"enabled"}`})}),null});function _i(){const t=Me(T);function n(i){if(t.composerState.minimized){T.composerState.minimized=!1,Ln();return}i.shiftKey?bi()||(T.showCompose=!0):(Ln(),T.showCompose=!0)}return Re("c, shift+c",n,{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:n,class:`${t.composerState.minimized?"min":""} ${t.composerState.publishing?"loading":""} ${t.composerState.publishingError?"error":""}`,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const Ri=Xe(function(){const n=Me(T);function i(){T.showKeyboardShortcutsHelp=!1}return Re("?, shift+?, shift+slash",s=>{T.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:s=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&e($e,{onClose:i,children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Load new posts",keys:e("kbd",{children:"."})},{action:"Open post details",keys:e(R,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:e(R,{children:["Expand content warning or",e("br",{}),"toggle expanded/collapsed thread"]}),keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(R,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(R,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"c"})]})},{action:"Send post",keys:e(R,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:e(R,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:e(R,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"Alt"})," + ",e("kbd",{children:"k"})]})}].map(({action:s,className:o,keys:a})=>e("tr",{children:[e("th",{class:o,children:s}),e("td",{children:a})]},s))})})]})})});function Ei({onClose:t}){const{masto:n}=Q(),i=be.local.getJSON("accounts"),s=ct(),o=i.length>1,[a,d]=mt(c=>c+1,0),[u]=pn();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:u,children:i.map((c,p)=>{const f=c.info.id===s,r=p===0;return e("li",{children:[e("div",{children:[o&&e("span",{class:`current ${f?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(st,{url:c.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const h=await n.v1.accounts.$select(c.info.id).fetch();c.info=h,be.local.setJSON("accounts",i),d()}catch{}}}),e(It,{account:o?{...c.info,acct:/@/.test(c.info.acct)?c.info.acct:`${c.info.acct}@${c.instanceURL}`}:c.info,showAcct:!0,onClick:()=>{f?T.showAccount=`${c.info.username}@${c.instanceURL}`:(ds(c.info.id),location.reload())}})]}),e("div",{class:"actions",children:[r&&o&&e(R,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Je,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(de,{onClick:()=>{T.showAccount=`${c.info.username}@${c.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(ze,{}),o&&e(de,{disabled:r,onClick:()=>{i.splice(p,1),i.unshift(c),be.local.setJSON("accounts",i),d()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(et,{subMenu:!0,confirmLabel:e(R,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",c.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{i.splice(p,1),be.local.setJSON("accounts",i),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},c.info.id)})}),e("p",{children:e(oe,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),o&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const wn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e";function Dn(t){const{masto:n}=Q();return n.v1.push.subscription.create(t)}function Li(){const{masto:t}=Q();return t.v1.push.subscription.fetch()}function Mi(t){const{masto:n}=Q();return n.v1.push.subscription.update(t)}function Pi(){const{masto:t}=Q();return t.v1.push.subscription.remove()}function Xt(){return"serviceWorker"in navigator&&"PushManager"in window}function Ni(){return navigator.serviceWorker.getRegistration()}async function vn(){const t=await Ni(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Ts(t){const n="=".repeat((4-t.length%4)%4),i=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),s=window.atob(i),o=new Uint8Array(s.length);for(let a=0;a<s.length;++a)o[a]=s.charCodeAt(a);return o}async function Di(){if(!Xt())return;const{subscription:t}=await vn();let n=null;try{n=await Li()}catch(i){if(!/(not found|unknown)/i.test(i.message))throw i}if(n&&t){const i=n.endpoint===t.endpoint,{vapidKey:s}=St(),o=n.serverKey===s;if(!i)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:i}=St(),{applicationServerKey:s}=t.options,o=Ts(i).toString(),a=new Uint8Array(s).toString();if(!(o===a))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function Un({data:t,policy:n}){if(!Xt())return;let{registration:i,subscription:s}=await vn(),o=null;if(s)try{o=await Mi({data:t,policy:n})}catch{o=await Dn({subscription:s,data:t,policy:n})}else{const{vapidKey:a}=St();if(!a)throw new Error("No server key found");s=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ts(a)}),o=await Dn({subscription:s,data:t,policy:n})}return{subscription:s,backendSubscription:o}}async function Fn(){if(!Xt())return;const{subscription:t}=await vn();t&&(await Pi(),await t.unsubscribe())}var Ui={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const On=16,ft=[14,15,16,17,18,19,20],{PHANPY_WEBSITE:zn,PHANPY_PRIVACY_POLICY_URL:Fi,PHANPY_IMG_ALT_API_URL:Oi,PHANPY_GIPHY_API_KEY:zi}=Ui;function Bi({onClose:t}){const n=Me(T),i=be.local.get("theme")||"auto",s=z(),o=n.settings.contentTranslationTargetLanguage||null,a=ys(),d=yi(a),u=be.local.get("textSize")||On,[c,p]=A(be.account.get("preferences")||{}),{masto:f,authenticated:r,instance:h}=Q();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:s,onInput:l=>{l.preventDefault();const m=new FormData(s.current).get("theme"),k=document.documentElement;if(m==="auto"){k.classList.remove("is-light","is-dark");const g=document.querySelector('meta[data-theme-setting="manual"]');g&&(g.name=""),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(C=>{C.name="theme-color"})}else{k.classList.toggle("is-light",m==="light"),k.classList.toggle("is-dark",m==="dark");const g=document.querySelector('meta[data-theme-setting="manual"]');g&&(g.name="theme-color",g.content=m==="light"?g.dataset.themeLightColor:g.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(C=>{C.name=""})}document.querySelector('meta[name="color-scheme"]').setAttribute("content",m==="auto"?"dark light":m),m==="auto"?be.local.del("theme"):be.local.set("theme",m)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:i==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:i==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:i!=="light"&&i!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:ft[0]},children:"A"})," ",e("input",{type:"range",min:ft[0],max:ft[ft.length-1],step:"1",value:u,list:"sizes",onChange:l=>{const y=parseInt(l.target.value,10);document.documentElement.style.setProperty("--text-size",`${y}px`),y===On?be.local.del("textSize"):be.local.set("textSize",l.target.value)}})," ",e("span",{style:{fontSize:ft[ft.length-1]},children:"A"}),e("datalist",{id:"sizes",children:ft.map(l=>e("option",{value:l}))})]})]})]})}),r&&e(R,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:c["posting:default:visibility"]||"public",onChange:l=>{const{value:y}=l.target;(async()=>{try{await f.v1.accounts.updateCredentials({source:{privacy:y}}),p({...c,"posting:default:visibility":y}),be.account.set("preferences",{...c,"posting:default:visibility":y})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${h}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",h,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:l=>{T.settings.autoRefresh=l.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:l=>{T.settings.boostsCarousel=l.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:l=>{const{checked:y}=l.target;T.settings.contentTranslation=y,y||(T.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:o||"",disabled:!n.settings.contentTranslation,onChange:l=>{T.settings.contentTranslationTargetLanguage=l.target.value||null},children:[e("option",{value:"",children:["System language (",d,")"]}),e("option",{disabled:!0,children:"──────────"}),Mn.map(l=>e("option",{value:l.code,children:l.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(R,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Mn.map(l=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(l.code),onChange:y=>{const{checked:m}=y.target;m?T.settings.contentTranslationHideLanguages.push(l.code):T.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(k=>k!==l.code)}})," ",l.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses external translation services, powered by"," ",e("a",{href:"https://github.com/cheeaun/lingva-api",target:"_blank",rel:"noopener noreferrer",children:"Lingva API"})," ","&"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:l=>{T.settings.contentTranslationAutoInline=l.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),!!zi&&r&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.composerGIFPicker,onChange:l=>{T.settings.composerGIFPicker=l.target.checked}})," ","GIF Picker for composer"]}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external GIF search service, powered by"," ",e("a",{href:"https://developers.giphy.com/",target:"_blank",rel:"noopener noreferrer",children:"GIPHY"}),". G-rated (suitable for viewing by all ages), tracking parameters are stripped, referrer information is omitted from requests, but search queries and IP address information will still reach their servers."]})})]}),!!Oi&&r&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.mediaAltGenerator,onChange:l=>{T.settings.mediaAltGenerator=l.target.checked}})," ","Image description generator"," ",e(w,{icon:"sparkles2",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Only for new images while composing new posts."})}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external AI service, powered by"," ",e("a",{href:"https://github.com/cheeaun/img-alt-api",target:"_blank",rel:"noopener noreferrer",children:"img-alt-api"}),". May not work well. Only for images and in English."]})})]}),r&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.shortcutSettingsCloudImportExport,onChange:l=>{T.settings.shortcutSettingsCloudImportExport=l.target.checked}})," ",'"Cloud" import/export for shortcuts settings'," ",e(w,{icon:"cloud",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:["⚠️⚠️⚠️ Very experimental.",e("br",{}),"Stored in your own profile’s notes. Profile (private) notes are mainly used for other profiles, and hidden for own profile."]})}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Note: This feature uses currently-logged-in instance server API."})})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:l=>{T.settings.cloakMode=l.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),r&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{T.showDrafts=!0,T.showSettings=!1},children:"Unsent drafts"})})]})}),r&&e(Hi,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:wn,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:l=>{l.preventDefault(),T.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:l=>{l.preventDefault(),T.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:Fi,target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[zn&&e(R,{children:[e("span",{class:"insignificant",children:"Site:"})," ",zn.replace(/https?:\/\//g,"").replace(/\/$/,""),e("br",{})]}),e("span",{class:"insignificant",children:"Version:"})," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2024-05-29T18:54:06.357Z".slice(0,10).replace(/-/g,".")}.314075d`,onClick:l=>{l.target.select();try{navigator.clipboard.writeText(l.target.value),se("Version string copied")}catch{se("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/314075d",target:"_blank",rel:"noopener noreferrer",children:e(bt,{datetime:new Date("2024-05-29T18:54:06.357Z")})}),")"]})]})]})]})]})}function Hi({onClose:t}){if(!Xt())return null;const{instance:n}=Q(),[i,s]=A("default"),o=z(),[a,d]=A(!1),[u,c]=A(!1),p=z();G(()=>{(async()=>{s("loading");try{const{subscription:r,backendSubscription:h}=await Di();if(h!=null&&h.policy&&h.policy!=="none"){d(!0);const{alerts:l,policy:y}=h;p.current=y;const{elements:m}=o.current,k=m.namedItem("policy");k&&(k.value=y),Object.keys(l).forEach(g=>{const b=m.namedItem(g);(b==null?void 0:b.type)==="checkbox"&&(b.checked=!0)})}s("default")}catch(r){/outside.*authorized/i.test(r.message)?c(!0):alert((r==null?void 0:r.message)||r),s("error")}})()},[]);const f=i==="loading";return e("form",{ref:o,onChange:()=>{setTimeout(()=>{const r=Object.fromEntries(new FormData(o.current)),h=!!r["policy-allow"],l={data:{policy:r.policy,alerts:{mention:!!r.mention,favourite:!!r.favourite,reblog:!!r.reblog,follow:!!r.follow,follow_request:!!r.followRequest,poll:!!r.poll,update:!!r.update,status:!!r.status}}};let y=0;Object.keys(l.data.alerts).forEach(k=>{l.data.alerts[k]?y++:delete l.data.alerts[k]});const m=p.current!==l.data.policy;h&&y>0?m?Fn().then(()=>{Un(l)}).catch(k=>{alert("Failed to update subscription. Please try again.")}):Un(l).catch(k=>{alert("Failed to update subscription. Please try again.")}):Fn().catch(k=>{alert("Failed to remove subscription. Please try again.")})},100)},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:f||u,name:"policy-allow",checked:a,onChange:async r=>{const{checked:h}=r.target;if(h){const l=await Notification.requestPermission();l==="granted"?d(!0):(d(!1),l==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else d(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:f||u||!a,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(r=>e("option",{value:r.value,children:r.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!a,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(r=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:r.value})," ",r.label]})}))})})})}),u&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(oe,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const an=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const i=document.querySelectorAll("#modal-container > *");if(i!=null&&i.length){const d=i[i.length-1],u=d.querySelector('[tabindex="-1"]')||d;if(u){u.focus();return}}if(document.querySelector(".deck-backdrop"))return;const o=document.querySelectorAll(".deck-container"),a=o[o.length-1];a&&a.tabIndex===-1&&a.focus()}},100);return()=>clearTimeout(t)};function xs(t){if(!t)return;const n=Tt(),i=z(n.pathname);G(()=>{i.current&&n.pathname!==i.current&&(t==null||t())},[n.pathname,t])}const As=1e3*60,qi=24*60*60*1e3,cn=ht(async()=>{const{masto:t}=Q(),n=await t.v1.lists.list();return n.sort((i,s)=>i.title.localeCompare(s.title)),n.length&&setTimeout(()=>{be.account.set("lists",{lists:n,updatedAt:Date.now()})},1),n},{maxAge:As});async function Pt(){try{const{lists:t,updatedAt:n}=be.account.get("lists")||{};return t!=null&&t.length?(Date.now()-n>qi&&cn(),t):await cn()}catch{return[]}}const Vi=ht(t=>{const{masto:n}=Q();return n.v1.lists.$select(t).fetch()},{maxAge:As});async function $s(t){const{lists:n}=be.account.get("lists")||{};if(n!=null&&n.length){const i=n.find(s=>s.id===t);if(i)return i}try{return Vi(t)}catch{return null}}async function Gi(t){const n=await $s(t);return(n==null?void 0:n.title)||""}function Yi(t){const{lists:n}=be.account.get("lists")||{};n!=null&&n.length&&(n.push(t),n.sort((i,s)=>i.title.localeCompare(s.title)),be.account.set("lists",{lists:n,updatedAt:Date.now()}))}function ji(t){const{lists:n}=be.account.get("lists")||{};if(n!=null&&n.length){const i=n.findIndex(s=>s.id===t.id);i!==-1&&(n[i]=t,n.sort((s,o)=>s.title.localeCompare(o.title)),be.account.set("lists",{lists:n,updatedAt:Date.now()}))}}function Wi(t){const{lists:n}=be.account.get("lists")||{};if(n!=null&&n.length){const i=n.findIndex(s=>s.id===t);i!==-1&&(n.splice(i,1),be.account.set("lists",{lists:n,updatedAt:Date.now()}))}}function kn({list:t,onClose:n}){const{masto:i}=Q(),[s,o]=A("default"),a=!!t,d=z(),u=z(),c=z();G(()=>{a&&(d.current.value=t.title,u.current.value=t.repliesPolicy,c.current&&(c.current.checked=t.exclusive))},[a]);const p=We("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:a?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:f=>{f.preventDefault();const r=new FormData(f.target),h=r.get("title"),l=r.get("replies_policy"),y=r.get("exclusive")==="on";o("loading"),(async()=>{try{let m;a?m=await i.v1.lists.$select(t.id).update({title:h,replies_policy:l,exclusive:y}):m=await i.v1.lists.create({title:h,replies_policy:l,exclusive:y}),o("default"),n==null||n({state:"success",list:m}),setTimeout(()=>{a?ji(m):Yi(m)},1)}catch{o("error"),alert(a?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:d,type:"text",id:"list-title",name:"title",required:!0,disabled:s==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:u,name:"replies_policy",required:!0,disabled:s==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),p&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:c,type:"checkbox",name:"exclusive",disabled:s==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:s==="loading",children:a?"Save":"Create"}),a&&e(et,{disabled:s==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await i.v1.lists.$select(t.id).remove(),o("default"),n==null||n({state:"deleted"}),setTimeout(()=>{Wi(t.id)},1)}catch{o("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:s==="loading",children:"Delete…"})})]})]})})]})}const Ki=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],Bn={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},Hn=80,_s=1e3*60*10;function Ji(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Xi=ht(Ji,{maxAge:_s});async function Zi(t,n){const i=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:s}=await i,o={total:s.length,originals:0,replies:0,boosts:0};return s.forEach(a=>{a.reblog?o.boosts++:a.inReplyToId&&a.inReplyToAccountId!==a.account.id?o.replies++:o.originals++}),s.length&&(o.daysSinceLastPost=Math.ceil((Date.now()-new Date(s[s.length-1].createdAt))/864e5)),o}const Qi=ht(Zi,{maxAge:_s});function Rs({account:t,fetchAccount:n=()=>{},standalone:i,instance:s,authenticated:o}){const{masto:a}=Q({instance:s}),{masto:d,instance:u}=Q(),[c,p]=A("default"),f=typeof t=="string",[r,h]=A(f?null:t),l=pe(()=>s===u,[s,u]);G(()=>{if(!f){h(t);return}p("loading"),(async()=>{try{const S=await n();T.accounts[`${S.id}@${s}`]=S,h(S),p("default")}catch{h(null),p("error")}})()},[f,t,n]);const{acct:y,avatar:m,avatarStatic:k,bot:g,createdAt:b,displayName:C,emojis:v,fields:I,followersCount:x,followingCount:E,group:Y,id:j,lastStatusAt:M,locked:ee,note:Z,statusesCount:$,url:P,username:L,memorial:U,moved:V,roles:ye,hideCollections:ve}=r||{};let fe=!1,{header:ne,headerStatic:me}=r||{};(!ne||/missing\.png$/.test(ne))&&m&&!/missing\.png$/.test(m)&&(ne=m,fe=!0,k&&!/missing\.png$/.test(k)&&(me=k));const ue=pe(()=>j===ct(),[j]);G(()=>{const S=!!(r!=null&&r.id&&(r!=null&&r.username)&&(r!=null&&r.acct)&&(r!=null&&r.avatar)&&(r!=null&&r.avatarStatic)&&(r!=null&&r.displayName)&&(r!=null&&r.url));if(ue&&s&&S){const D=be.local.getJSON("accounts");let B=!1;D.forEach(O=>{O.info.id===r.id&&O.instanceURL===s&&(O.info=r,B=!0)}),B&&be.local.setJSON("accounts",D)}},[ue,r,s]);const he=pe(()=>P?xt.toUnicode(new URL(P).hostname):null,[P]),[ke,Ee]=A([]),Te=z(),Pe=z([]);async function Fe(S){var K;(S||!Te.current)&&(Te.current=a.v1.accounts.$select(j).followers.list({limit:Hn}));const D=await Te.current.next();if(ue||!l)return D;const{value:B}=D;let O=[];if(S){let ge=[];try{ge=await a.v1.accounts.familiarFollowers.fetch({id:[j]})}catch{}Pe.current=((K=ge==null?void 0:ge[0])==null?void 0:K.accounts)||[],O=[...Pe.current,...B.filter(le=>!Pe.current.some(ie=>ie.id===le.id))]}else B!=null&&B.length&&(O=B.filter(ge=>!Pe.current.some(le=>le.id===ge.id)));return{...D,value:O}}const xe=z();async function X(S){return(S||!xe.current)&&(xe.current=a.v1.accounts.$select(j).following.list({limit:Hn})),await xe.current.next()}const ae=i?"div":oe,te=s?`/${s}/a/${j}`:`/a/${j}`,[Se,Ie]=A([]),[F,re]=A(),[N,W]=A("default"),_=!!(F!=null&&F.total),H=async S=>{try{const D=await Xi(S,d);Ie(D[0].accounts.slice(0,eo))}catch{}},J=async()=>{if(j){W("loading");try{const S=await Qi(j,a);re(S),W("default")}catch{W("error")}}},ce=Qe(({relationship:S,currentID:D})=>{S.following||(H(D),!i&&$>0&&J())},[i,j,$]),Ne=Qe(S=>{S.id===j&&(h(S),T.accounts[`${S.id}@${s}`]=S)},[j,s]);return e("div",{tabIndex:"-1",class:`account-container ${c==="loading"?"skeleton":""}`,style:{"--header-color-1":ke[0],"--header-color-2":ke[1],"--header-color-3":ke[2],"--header-color-4":ke[3]},children:[c==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:f?t:P,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),c==="loading"?e(R,{children:[e("header",{children:e(Ze,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):r&&e(R,{children:[!!V&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:C})," has indicated that their new account is now:"]}),e(Ze,{account:V,instance:s,onClick:S=>{S.stopPropagation(),T.showAccount=V}})]}),!!ne&&!/missing\.png$/.test(ne)&&e("img",{src:ne,alt:"",class:`header-banner ${fe?"header-is-avatar":""}`,onError:S=>{S.target.crossOrigin?S.target.src!==me?S.target.src=me:(S.target.removeAttribute("crossorigin"),S.target.src=ne):S.target.src!==me?S.target.src=me:S.target.remove()},crossOrigin:"anonymous",onLoad:S=>{S.target.classList.add("loaded");try{const D=window.OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas"),B=D.getContext("2d",{willReadFrequently:!0});D.width=S.target.width,D.height=S.target.height,B.imageSmoothingEnabled=!1,B.drawImage(S.target,0,0);const O=10,ge=[B.getImageData(0,0,O,O).data,B.getImageData(S.target.width-O,0,O,O).data,B.getImageData(0,S.target.height-O,O,O).data,B.getImageData(S.target.width-O,S.target.height-O,O,O).data].map(le=>{let ie=0,Ce=0,De=0,Oe=0;for(let Ve=0;Ve<le.length;Ve+=4)ie+=le[Ve],Ce+=le[Ve+1],De+=le[Ve+2],Oe+=le[Ve+3];const Le=le.length/4;return[ie/Le,Ce/Le,De/Le,Oe/Le]}).map(le=>{const[ie,Ce,De,Oe]=no(le);return`rgba(${ie}, ${Ce}, ${De}, ${Oe})`});Ee(ge)}catch{}}}),e("header",{children:i?e(Je,{shift:window.matchMedia("(min-width: calc(40em))").matches?114:64,menuButton:e("div",{children:e(Ze,{account:r,instance:s,avatarSize:"xxxl",onClick:()=>{}})}),children:[e("div",{class:"szh-menu__header",children:e(lo,{acct:y,instance:s})}),e(de,{onClick:()=>{const S=`@${y}`;try{navigator.clipboard.writeText(S),se("Handle copied")}catch{se("Unable to copy handle")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy handle"})]}),e(de,{href:P,target:"_blank",children:[e(w,{icon:"external"}),e("span",{children:"Go to original profile page"})]}),e(ze,{}),e(_e,{href:r.avatar,target:"_blank",children:[e(w,{icon:"user"}),e("span",{children:"View profile image"})]}),e(_e,{href:r.header,target:"_blank",children:[e(w,{icon:"media"}),e("span",{children:"View profile header"})]})]}):e(Ze,{account:r,instance:s,avatarSize:"xxxl",internal:!0})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!U&&e("span",{class:"tag",children:"In Memoriam"}),!!g&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!Y&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),ye==null?void 0:ye.map(S=>e("span",{class:"tag",children:[S.name,!!he&&e(R,{children:[" ",e("span",{class:"more-insignificant",children:he})]})]})),e("div",{class:"note",dir:"auto",onClick:ws({instance:u}),dangerouslySetInnerHTML:{__html:on(Z,{emojis:v})}}),e("div",{class:"account-metadata-box",children:[(I==null?void 0:I.length)>0&&e("div",{class:"profile-metadata",children:I.map(({name:S,value:D,verifiedAt:B},O)=>e("div",{class:`profile-field ${B?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(vs,{text:S,emojis:v})," ",!!B&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:on(D,{emojis:v})}})]},S+O))}),e("div",{class:"stats",children:[e(ae,{tabIndex:0,to:te,onClick:()=>{setTimeout(()=>{T.showGenericAccounts={id:"followers",heading:"Followers",fetchAccounts:Fe,instance:s,excludeRelationshipAttrs:ue?["followedBy"]:[],blankCopy:ve?"This user has chosen to not make this information available.":void 0}},0)},children:[!!Se.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:Se.map(S=>e(st,{url:S.avatarStatic,size:"s",alt:`${S.displayName} @${S.acct}`,squircle:S==null?void 0:S.bot}))})}),e("span",{title:x,children:Ge(x)})," ","Followers"]}),e(ae,{class:"insignificant",tabIndex:0,to:te,onClick:()=>{setTimeout(()=>{T.showGenericAccounts={heading:"Following",fetchAccounts:X,instance:s,excludeRelationshipAttrs:ue?["following"]:[],blankCopy:ve?"This user has chosen to not make this information available.":void 0}},0)},children:[e("span",{title:E,children:Ge(E)})," ","Following",e("br",{})]}),e(ae,{class:"insignificant",to:te,children:[e("span",{title:$,children:Ge($)})," ","Posts"]}),!!b&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:b,children:ot(b,{hideTime:!0})})]})]})]}),!!F&&e(ae,{to:te,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:_?e("div",{class:"posting-stats",title:`${Math.round(F.originals/F.total*100)}% original posts, ${Math.round(F.replies/F.total*100)}% replies, ${Math.round(F.boosts/F.total*100)}% boosts`,children:[e("div",{children:F.daysSinceLastPost<365?`Last ${F.total} post${F.total>1?"s":""} in the past 
                      ${F.daysSinceLastPost} day${F.daysSinceLastPost>1?"s":""}`:`
                      Last ${F.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${F.originals/F.total*100}%`,"--replies-percentage":`${(F.originals+F.replies)/F.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),!V&&e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!F,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:N==="loading",onClick:()=>{J()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${N==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(to,{info:r,instance:s,standalone:i,authenticated:o,onRelationshipChange:ce,onProfileUpdate:Ne})})]})]})}const eo=3;function to({info:t,instance:n,standalone:i,authenticated:s,onRelationshipChange:o=()=>{},onProfileUpdate:a=()=>{}}){var Ie;if(!t)return null;const{masto:d,instance:u,authenticated:c}=Q(),p=n===u,[f,r]=A("default"),[h,l]=A(null),{id:y,acct:m,url:k,username:g,locked:b,lastStatusAt:C,note:v,fields:I,moved:x}=t,E=z(y),{following:Y,showingReblogs:j,notifying:M,followedBy:ee,blocking:Z,blockedBy:$,muting:P,mutingNotifications:L,requested:U,domainBlocking:V,endorsed:ye,note:ve}=h||{},[fe,ne]=A(null),[me,ue]=A(!1);G(()=>{if(t){const F=ct();let re;(async()=>{if(p&&s)re=y;else if(!p&&c){const W=t.acct.includes("@");try{const _=await d.v2.search.fetch({q:W?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});_.accounts.length&&(re=_.accounts[0].id,ne(_.accounts[0]))}catch{}}if(!re)return;if(F===re){ue(!0);return}E.current=re,r("loading");const N=d.v1.accounts.relationships.fetch({id:[re]});try{const W=await N;if(r("default"),W.length){const _=W[0];l(_),o({relationship:_,currentID:re})}}catch{r("error")}})()}},[t,s]),G(()=>{t&&me&&Ks(t)},[t,me]);const he=f==="loading",[ke,Ee]=A(!1),[Te,Pe]=A(!1),[Fe,xe]=A(!1),[X,ae]=A(!1),[te,Se]=A([]);return e(R,{children:[e("div",{class:"actions",children:[e("span",{children:[ee?e("span",{class:"tag",children:"Follows you"}):C?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:ot(C,{hideTime:!0})})]}):e("span",{}),P&&e("span",{class:"tag danger",children:"Muted"}),Z&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!ve&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{xe(!0)},dir:"auto",children:e("span",{children:ve})}),e(Je,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:he,children:e(w,{icon:"more",size:"l",alt:"More"})}),onMenuChange:F=>{Y&&F.open&&(async()=>{try{const re=await d.v1.accounts.$select(E.current).lists.list();Se(re)}catch{}})()},children:[c&&!me&&e(R,{children:[e(de,{onClick:()=>{wi({draftStatus:{status:`@${(fe==null?void 0:fe.acct)||m} `}})},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",g]})]}),e(de,{onClick:()=>{Ee(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),We("@mastodon/profile-private-note")&&e(de,{onClick:()=>{xe(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:ve?"Edit private note":"Add private note"})]}),Y&&!!h&&e(R,{children:[e(de,{onClick:()=>{r("loading"),(async()=>{try{const F=await d.v1.accounts.$select(E.current).follow({notify:!M});F&&l(F),r("default"),se(F.notifying?`Notifications enabled for @${g}'s posts.`:` Notifications disabled for @${g}'s posts.`)}catch(F){alert(F),r("error")}})()},children:[e(w,{icon:"notification"}),e("span",{children:M?"Disable notifications":"Enable notifications"})]}),e(de,{onClick:()=>{r("loading"),(async()=>{try{const F=await d.v1.accounts.$select(E.current).follow({reblogs:!j});F&&l(F),r("default"),se(F.showingReblogs?`Boosts from @${g} disabled.`:`Boosts from @${g} enabled.`)}catch(F){alert(F),r("error")}})()},children:[e(w,{icon:"rocket"}),e("span",{children:j?"Disable boosts":"Enable boosts"})]})]}),Y&&e(de,{onClick:()=>{Pe(!0)},children:[e(w,{icon:"list"}),te.length?e(R,{children:[e("small",{class:"menu-grow",children:["Add/Remove from Lists",e("br",{}),e("span",{class:"more-insignificant",children:te.map(F=>F.title).join(", ")})]}),e("small",{class:"more-insignificant",children:te.length})]}):e("span",{children:"Add/Remove from Lists"})]}),e(ze,{})]}),e(de,{onClick:()=>{const F=`@${(fe==null?void 0:fe.acct)||m}`;try{navigator.clipboard.writeText(F),se("Handle copied")}catch{se("Unable to copy handle")}},children:[e(w,{icon:"copy"}),e("small",{children:["Copy handle",e("br",{}),e("span",{class:"more-insignificant",children:["@",(fe==null?void 0:fe.acct)||m]})]})]}),e(de,{href:k,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:so(k)})]}),e("div",{class:"menu-horizontal",children:[e(de,{onClick:()=>{try{navigator.clipboard.writeText(k),se("Link copied")}catch{se("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((Ie=navigator==null?void 0:navigator.canShare)==null?void 0:Ie.call(navigator,{url:k}))&&e(de,{onClick:()=>{try{navigator.share({url:k})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!h&&e(R,{children:[e(ze,{}),P?e(de,{onClick:()=>{r("loading"),(async()=>{try{const F=await d.v1.accounts.$select((fe==null?void 0:fe.id)||y).unmute();l(F),r("default"),se(`Unmuted @${g}`),T.reloadGenericAccounts.id="mute",T.reloadGenericAccounts.counter++}catch{r("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",g]})]}):e(Wt,{menuClassName:"menu-blur",openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(R,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",g,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:Ki.map(F=>e(de,{onClick:()=>{r("loading"),(async()=>{try{const re=await d.v1.accounts.$select((fe==null?void 0:fe.id)||y).mute({duration:F});l(re),r("default"),se(`Muted @${g} for ${Bn[F]}`),T.reloadGenericAccounts.id="mute",T.reloadGenericAccounts.counter++}catch{r("error"),se(`Unable to mute @${g}`)}})()},children:Bn[F]}))})}),ee&&e(et,{subMenu:!0,menuItemClassName:"danger",confirmLabel:e(R,{children:[e(w,{icon:"user-x"}),e("span",{children:["Remove @",g," from followers?"]})]}),onClick:()=>{r("loading"),(async()=>{try{const F=await d.v1.accounts.$select((fe==null?void 0:fe.id)||y).removeFromFollowers();l(F),r("default"),se(`@${g} removed from followers`),T.reloadGenericAccounts.id="followers",T.reloadGenericAccounts.counter++}catch{r("error")}})()},children:[e(w,{icon:"user-x"}),e("span",{children:"Remove follower…"})]}),e(et,{subMenu:!0,confirm:!Z,confirmLabel:e(R,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",g,"?"]})]}),menuItemClassName:"danger",onClick:()=>{r("loading"),(async()=>{try{if(Z){const F=await d.v1.accounts.$select((fe==null?void 0:fe.id)||y).unblock();l(F),r("default"),se(`Unblocked @${g}`)}else{const F=await d.v1.accounts.$select((fe==null?void 0:fe.id)||y).block();l(F),r("default"),se(`Blocked @${g}`)}T.reloadGenericAccounts.id="block",T.reloadGenericAccounts.counter++}catch{r("error"),Z?se(`Unable to unblock @${g}`):se(`Unable to block @${g}`)}})()},children:Z?e(R,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",g]})]}):e(R,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",g,"…"]})]})}),e(de,{className:"danger",onClick:()=>{T.showReportModal={account:fe||t}},children:[e(w,{icon:"flag"}),e("span",{children:["Report @",g,"…"]})]})]}),c&&me&&i&&We("@mastodon/profile-edit")&&e(R,{children:[e(ze,{}),e(de,{onClick:()=>{ae(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:"Edit profile"})]})]}),!1]}),!h&&f==="loading"&&e(Ae,{abrupt:!0}),!!h&&!x&&e(et,{confirm:Y||U,confirmLabel:e("span",{children:U?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:he,onClick:()=>{r("loading"),(async()=>{try{let F;Y||U?F=await d.v1.accounts.$select(E.current).unfollow():F=await d.v1.accounts.$select(E.current).follow(),F&&l(F),r("default")}catch(F){alert(F),r("error")}})()},children:e("button",{type:"button",class:`${Y||U?"light swap":""}`,"data-swap-state":Y||U?"danger":"",disabled:he,children:Y?e(R,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):U?e(R,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):b?e(R,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!ke&&e($e,{onClose:()=>{Ee(!1)},children:e(io,{note:v,fields:I,onClose:()=>Ee(!1)})}),!!Te&&e($e,{onClose:()=>{Pe(!1)},children:e(oo,{accountID:E.current,onClose:()=>Pe(!1)})}),!!Fe&&e($e,{onClose:()=>{xe(!1)},children:e(ao,{account:t,note:ve,onRelationshipChange:F=>{l(F)},onClose:()=>xe(!1)})}),!!X&&e($e,{onClose:()=>{ae(!1)},children:e(co,{onClose:({state:F,account:re}={})=>{ae(!1),F==="success"&&re&&a(re)}})})]})}function no([t,n,i]){const s=.2126*t+.7152*n+.0722*i;let o;return s>=220?o=1:s<=50?o=.1:o=s/255,o=Math.min(1,o),[t,n,i,o]}function so(t){if(!t)return;const n=new URL(t),{host:i,pathname:s}=n,o=s.replace(/\/$/,"").replace(/^\//,"");return e(R,{children:[e("span",{class:"more-insignificant",children:[xt.toUnicode(i),"/"]}),e("wbr",{}),e("span",{children:o})]})}function io({note:t,fields:n,onClose:i}){const s=(n==null?void 0:n.map(({name:a,value:d})=>`${a}
${Pn(d)}`).join(`

`))||"",o=Pn(t)+(s?`

${s}`:"");return e("div",{class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:o}),e(ks,{forceTranslate:!0,text:o})]})]})}function oo({accountID:t,onClose:n}){const{masto:i}=Q(),[s,o]=A("default"),[a,d]=A([]),[u,c]=A([]),[p,f]=mt(l=>l+1,0);G(()=>{o("loading"),(async()=>{try{const l=await Pt();d(l);const y=await i.v1.accounts.$select(t).lists.list();c(y),o("default")}catch{o("error")}})()},[p]);const[r,h]=A(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[a.length>0?e("ul",{class:"list-add-remove",children:a.map(l=>{const y=u.some(m=>m.id===l.id);return e("li",{children:e("button",{type:"button",class:`light ${y?"checked":""}`,disabled:s==="loading",onClick:()=>{o("loading"),(async()=>{try{y?await i.v1.lists.$select(l.id).accounts.remove({accountIds:[t]}):await i.v1.lists.$select(l.id).accounts.create({accountIds:[t]}),f()}catch{o("error"),alert(y?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:l.title})]})})})}):s==="loading"?e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}):s==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>h(!0),disabled:s!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),r&&e($e,{onClick:l=>{l.target===l.currentTarget&&h(!1)},children:e(kn,{list:r==null?void 0:r.list,onClose:l=>{l.state==="success"&&f(),h(!1)}})})]})}function ao({account:t,note:n,onRelationshipChange:i=()=>{},onClose:s=()=>{}}){const{masto:o}=Q(),[a,d]=A("default"),u=z(null);return G(()=>{let c;return u.current&&!n&&(c=setTimeout(()=>{var p,f;(f=(p=u.current).focus)==null||f.call(p)},100)),()=>{clearTimeout(c)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!s&&e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:c=>{c.preventDefault();const f=new FormData(c.target).get("note");(f==null?void 0:f.trim())!==(n==null?void 0:n.trim())&&(d("loading"),(async()=>{try{const r=await o.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:f});d("default"),i(r),s()}catch(r){d("error"),alert((r==null?void 0:r.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:u,name:"note",disabled:a==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:a==="loading",onClick:()=>{s==null||s()},children:"Cancel"}),e("span",{children:[e(Ae,{abrupt:!0,hidden:a!=="loading"}),e("button",{disabled:a==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function co({onClose:t=()=>{}}){const{masto:n}=Q(),[i,s]=A("loading"),[o,a]=A(null);G(()=>{(async()=>{try{const r=await n.v1.accounts.verifyCredentials();a(r),s("default")}catch{s("error")}})()},[]);const{displayName:d,source:u}=o||{},{note:c,fields:p}=u||{},f=z(null);return e("div",{class:"sheet",id:"edit-profile-container",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Edit profile"})}),e("main",{children:i==="loading"?e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}):e("form",{onSubmit:r=>{r.preventDefault();const h=new FormData(r.target),l=h.get("display_name"),y=h.get("note"),m=f.current.querySelectorAll('input[name^="fields_attributes"]'),k=[];m.forEach(g=>{const b=g.name,[C,v,I]=b.match(/fields_attributes\[(\d+)\]\[(.+)\]/)||[],x=g.value?g.value.trim():"";v&&I&&x&&(k[v]||(k[v]={}),k[v][I]=x)}),k.forEach(g=>{g.name&&!g.value&&(g.value="")}),(async()=>{try{const g=await n.v1.accounts.updateCredentials({displayName:l,note:y,fieldsAttributes:k});t==null||t({state:"success",account:g})}catch(g){alert((g==null?void 0:g.message)||"Unable to update profile.")}})()},children:[e("p",{children:e("label",{children:["Name"," ",e("input",{type:"text",name:"display_name",defaultValue:d,maxLength:30,disabled:i==="loading"})]})}),e("p",{children:e("label",{children:["Bio",e("textarea",{defaultValue:c,name:"note",maxLength:500,rows:"5",disabled:i==="loading"})]})}),e("p",{children:"Extra fields"}),e("table",{ref:f,children:[e("thead",{children:e("tr",{children:[e("th",{children:"Label"}),e("th",{children:"Content"})]})}),e("tbody",{children:Array.from({length:Math.max(4,p.length)}).map((r,h)=>{const{name:l="",value:y=""}=p[h]||{};return e(ro,{name:l,value:y,index:h,disabled:i==="loading"},h)})})]}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:i==="loading",onClick:()=>{t==null||t()},children:"Cancel"}),e("button",{type:"submit",disabled:i==="loading",children:"Save"})]})]})})]})}function ro({name:t,value:n,disabled:i,index:s}){const[o,a]=A(!!n);return e("tr",{children:[e("td",{children:e("input",{type:"text",name:`fields_attributes[${s}][name]`,defaultValue:t,disabled:i,maxLength:255,required:o})}),e("td",{children:e("input",{type:"text",name:`fields_attributes[${s}][value]`,defaultValue:n,disabled:i,maxLength:255,onChange:d=>a(!!d.currentTarget.value)})})]})}function lo({acct:t,instance:n}){let[i,s]=t.split("@");return s||(s=n),e("div",{class:"handle-info",children:[e("span",{class:"handle-handle",children:[e("b",{class:"handle-username",children:i}),e("span",{class:"handle-at",children:"@"}),e("b",{class:"handle-server",children:s})]}),e("div",{class:"handle-legend",children:[e("span",{class:"ib",children:[e("span",{class:"handle-legend-icon username"})," username"]})," ",e("span",{class:"ib",children:[e("span",{class:"handle-legend-icon server"})," server domain name"]})]})]})}function uo({account:t,instance:n,onClose:i}){const{masto:s,instance:o,authenticated:a}=Q({instance:n}),d=typeof t=="string";return G(()=>{d||(T.accounts[`${t.id}@${o}`]=t)},[t]),xs(i),e("div",{class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close outer",onClick:i,children:e(w,{icon:"x"})}),e(Rs,{instance:o,authenticated:a,account:t,fetchAccount:async()=>{if(d)try{return await s.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const c=await s.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:a});if(c.accounts.length)return c.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const p=new URL(t),{hostname:f,pathname:r}=p,h=r.replace(/^\//,"").replace(/\/$/,"")+"@"+f,l=await s.v2.search.fetch({q:h,type:"accounts",limit:1,resolve:a});if(l.accounts.length)return l.accounts[0]}}else return t}})]})}function ho({onClose:t}){const{masto:n}=Q(),[i,s]=A("default"),[o,a]=A([]),[d,u]=mt(p=>p+1,0);G(()=>{s("loading"),(async()=>{try{const p=await nt.drafts.keys();if(p.length){const f=jt(),r=p.filter(h=>h.startsWith(f));if(r.length){const h=await nt.drafts.getMany(r);h.sort((l,y)=>new Date(y.updatedAt).getTime()-new Date(l.updatedAt).getTime()),a(h)}else a([])}else a([]);s("default")}catch{s("error")}})()},[d]);const c=(o==null?void 0:o.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(Ae,{abrupt:!0,hidden:i!=="loading"})]}),c&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:c?e(R,{children:[e("ul",{class:"drafts-list",children:o.map(p=>{const{updatedAt:f,key:r,draftStatus:h,replyTo:l}=p,y=new Date(f);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:l?"reply":"quill",size:"s"})," ",e("time",{children:[!!l&&e(R,{children:["@",l.account.acct,e("br",{})]}),ot(y)]})]}),e(et,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:i==="loading",onClick:()=>{(async()=>{try{await nt.drafts.del(r),u()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:i==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:i==="loading",class:"draft-item",onClick:async()=>{let m;if(l){s("loading");try{m=await n.v1.statuses.$select(l.id).fetch()}catch{alert("Error fetching reply-to status!"),s("default");return}s("default")}window.__COMPOSE__={draftStatus:h,replyToStatus:m},T.showCompose=!0,T.showDrafts=!1},children:e(po,{draft:p})})]},f)})}),o.length>1&&e("p",{children:e(et,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:i==="loading",onClick:()=>{(async()=>{s("loading");try{await nt.drafts.delMany(o.map(p=>p.key)),s("default"),u()}catch{alert("Error deleting drafts! Please try again."),s("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function po({draft:t}){var r;const{draftStatus:n,replyTo:i}=t,{status:s,spoilerText:o,poll:a,mediaAttachments:d}=n,u=((r=a==null?void 0:a.options)==null?void 0:r.length)>0,c=(d==null?void 0:d.length)>0,p=u||c,f=pe(()=>{if(!c)return;const h=d.find(m=>/image/.test(m.type));if(!h)return;const{file:l}=h;return URL.createObjectURL(l)},[c,d]);return e(R,{children:e("div",{class:"mini-draft",children:[p&&e("div",{class:`mini-draft-aside ${f?"has-image":""}`,style:f?{"--bg-image":`url(${f})`}:{},children:[u&&e(w,{icon:"poll"}),c&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:d==null?void 0:d.length})]})]}),e("div",{class:"mini-draft-main",children:[!!o&&e("div",{class:"mini-draft-spoiler",children:o}),!!s&&e("div",{class:"mini-draft-status",children:s})]})]})})}function fo({html:t,url:n,width:i,height:s,onClose:o=()=>{}}){return e("div",{class:"embed-modal-container",children:[e("div",{class:"top-controls",children:[e("button",{type:"button",class:"light",onClick:()=>o(),children:e(w,{icon:"x"})}),n&&e("a",{href:n,target:"_blank",rel:"noopener noreferrer",class:"button plain",children:[e("span",{children:"Open link"})," ",e(w,{icon:"external"})]})]}),e("div",{class:"embed-content",dangerouslySetInnerHTML:{__html:t},style:{"--width":i+"px","--height":s+"px","--aspect-ratio":`${i}/${s}`}})]})}function mo({instance:t,excludeRelationshipAttrs:n=[],postID:i,onClose:s=()=>{},blankCopy:o="Nothing to show"}){const{masto:a,instance:d}=Q(),u=t?t===d:!0,c=Me(T),[p,f]=A("default"),[r,h]=A([]),[l,y]=A(!1);if(xs(s),!c.showGenericAccounts)return null;const{id:m,heading:k,fetchAccounts:g,accounts:b,showReactions:C}=c.showGenericAccounts,[v,I]=A({}),x=async M=>{if(!(M!=null&&M.length)||!u)return;const ee=await bn(M,v);ee&&I({...v,...ee})},E=M=>{g&&(M&&h([]),f("loading"),(async()=>{try{const{done:ee,value:Z}=await g(M);if(Array.isArray(Z)){if(M){const $=[];for(let P=0;P<Z.length;P++){const L=Z[P],U=$.find((V,ye)=>V.id===L.id&&P!==ye);U?U._types.push(...L._types):$.push({_types:[],...L})}h($)}else h($=>{const P=$;for(const L of Z){const U=P.find(V=>V.id===L.id);U?U._types.push(...L._types):P.push(L)}return P});y(!ee),x(Z)}else y(!1);f("default")}catch{f("error")}})())},Y=z(!0);G(()=>{(b==null?void 0:b.length)>0?(h(b),x(b)):(E(!0),Y.current=!1)},[b,g]),G(()=>{var M;Y.current||((M=c.reloadGenericAccounts)==null?void 0:M.id)===m&&E(!0)},[c.reloadGenericAccounts.counter]);const j=T.statuses[i];return e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:k||"Accounts"})}),e("main",{children:[j&&e(oe,{to:`/${t||d}/s/${j.id}`,class:"post-preview",children:e(Be,{status:j,size:"s",readOnly:!0})}),r.length>0?e(R,{children:[e("ul",{class:"accounts-list",children:r.map(M=>{var $,P;const ee=v[M.id],Z=`${M.id}-${(($=M._types)==null?void 0:$.length)||""}`;return e("li",{children:[C&&((P=M._types)==null?void 0:P.length)>0&&e("div",{class:"reactions-block",children:M._types.map(L=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[L],class:`${L}-icon`}))}),e("div",{class:"account-relationships",children:e(Ze,{account:M,showStats:!0,relationship:ee,excludeRelationshipAttrs:n})})]},Z)})}),p==="default"?l?e(rt,{onChange:M=>{M&&E()},children:e("button",{type:"button",class:"plain block",onClick:()=>E(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):p==="loading"&&e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})})]}):p==="loading"?e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}):p==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:o})]})]})}function go({alt:t,lang:n,onClose:i}){const s=Me(T),[o,a]=A(!1),d=ys(!0),u=s.settings.contentTranslationHideLanguages||[],c=!!n&&n!==d&&!Nn([n],[d])&&!u.find(p=>n===p||Nn([n],[p]));return e("div",{class:"sheet",tabindex:"-1",children:[!!i&&e("button",{type:"button",class:"sheet-close outer",onClick:i,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Je,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:[e(de,{disabled:o,onClick:()=>{a(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]}),vi&&e(de,{onClick:()=>{ki(t,n)},children:[e(w,{icon:"speak"}),e("span",{children:"Speak"})]})]})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(c||o)&&e(ks,{forceTranslate:o,sourceLanguage:n,text:t})]})]})}function Qt(t,n,i){return Math.max(Math.min(t,i),n)}const en=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,tn=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function Sn([t,n,i]){t=en(t/255),n=en(n/255),i=en(i/255);var s=.4122214708*t+.5363325363*n+.0514459929*i,o=.2119034982*t+.6806995451*n+.1073969566*i,a=.0883024619*t+.2817188376*n+.6299787005*i;return s=Math.cbrt(s),o=Math.cbrt(o),a=Math.cbrt(a),[s*.2104542553+o*.793617785+a*-.0040720468,s*1.9779984951+o*-2.428592205+a*.4505937099,s*.0259040371+o*.7827717662+a*-.808675766]}function In([t,n,c]){var s=t+n*.3963377774+c*.2158037573,o=t+n*-.1055613458+c*-.0638541728,a=t+n*-.0894841775+c*-1.291485548;s=s**3,o=o**3,a=a**3;var d=s*4.0767416621+o*-3.3077115913+a*.2309699292,u=s*-1.2684380046+o*2.6097574011+a*-.3413193965,c=s*-.0041960863+o*-.7034186147+a*1.707614701;return d=255*tn(d),u=255*tn(u),c=255*tn(c),d=Qt(d,0,255),u=Qt(u,0,255),c=Qt(c,0,255),d=Math.round(d),u=Math.round(u),c=Math.round(c),[d,u,c]}var bo={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:jc}=bo;function Es({mediaAttachments:t,statusID:n,instance:i,lang:s,index:o=0,onClose:a=()=>{}}){var b,C;const[d,u]=A("default"),c=z(null),[p,f]=A(o),r=z(null);lt(()=>{var v;(v=r.current)==null||v.scrollIntoView()},[]);const h=z(n);G(()=>{const v=o*c.current.clientWidth,I=h.current!==n;I&&(h.current=n),c.current.scrollTo({left:v,behavior:I?"auto":"smooth"}),c.current.focus()},[o,n]);const[l,y]=A(!0);G(()=>{let v=()=>{a()};return c.current&&c.current.addEventListener("swiped-down",v),()=>{c.current&&c.current.removeEventListener("swiped-down",v)}},[]),Re("esc",a,{ignoreEventWhen:v=>!!document.querySelector("#modal-container > *")},[a]),G(()=>{let v=()=>{const{clientWidth:I,scrollLeft:x}=c.current,E=Math.round(x/I);f(E)};return c.current&&c.current.addEventListener("scroll",v,{passive:!0}),()=>{c.current&&c.current.removeEventListener("scroll",v)}},[]),G(()=>{let v=setTimeout(()=>{var I,x;(x=(I=c.current)==null?void 0:I.focus)==null||x.call(I)},100);return()=>clearTimeout(v)},[]);const m=pe(()=>t==null?void 0:t.map(v=>{const{blurhash:I}=v;if(I){const x=fn(I),E=Sn(x);return In([.6,E[1],E[2]])}return null}),[t]),k=pe(()=>{var x;const I=100/m.length;return((x=m==null?void 0:m.map((E,Y)=>{const j=Y*I+5,M=(Y+1)*I-5;return E?`
            rgba(${E==null?void 0:E.join(",")}, 0.4) ${j}%,
            rgba(${E==null?void 0:E.join(",")}, 0.4) ${M}%
          `:`
            transparent ${j}%,
            transparent ${M}%
          `}))==null?void 0:x.join(", "))||"transparent"},[m]);let g=z(null);return G(()=>()=>{var v,I;(I=(v=g.current)==null?void 0:v.hideToast)==null||I.call(v)},[]),e("div",{class:`media-modal-container media-modal-count-${t==null?void 0:t.length}`,children:[e("div",{ref:c,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:v=>{(v.target.classList.contains("carousel-item")||v.target.classList.contains("media")||v.target.classList.contains("media-zoom"))&&a()},style:t.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${k})`}:{},children:t==null?void 0:t.map((v,I)=>{const x=t.length===1?m[I]:null;return e("div",{class:"carousel-item",style:x?{"--accent-color":`rgb(${x==null?void 0:x.join(",")})`,"--accent-alpha-color":`rgba(${x==null?void 0:x.join(",")}, 0.4)`}:{},tabindex:"0",ref:I===p?r:null,onClick:E=>{E.target.classList.contains("media")||y(!l)},children:[!!v.description&&e("button",{type:"button",class:"media-alt",hidden:!l,onClick:()=>{T.showMediaAlt={alt:v.description,lang:s}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:s,dir:"auto",children:v.description})]}),e(Ss,{media:v,showOriginal:!0,lang:s})]},v.id)})}),e("div",{class:"carousel-top-controls",hidden:!l,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>a(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((v,I)=>e("button",{type:"button",disabled:I===p,class:`carousel-dot ${I===p?"active":""}`,onClick:x=>{x.preventDefault(),x.stopPropagation(),c.current.scrollTo({left:c.current.clientWidth*I,behavior:"smooth"}),c.current.focus()},children:e(w,{icon:"round",size:"s"})},v.id))}):e("span",{}),e("span",{children:[e(Je,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:[e(_e,{href:((b=t[p])==null?void 0:b.remoteUrl)||((C=t[p])==null?void 0:C.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]}),!1]})," ",e(oe,{to:`${i?`/${i}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${p+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!l,children:[e("button",{type:"button",class:"carousel-button",hidden:p===0,onClick:v=>{v.preventDefault(),v.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(p-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:p===t.length-1,onClick:v=>{v.preventDefault(),v.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(p+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]})]})}const yo=[,"spam","legal","violation","other"],$t={spam:{label:"Spam",description:"Malicious links, fake engagement, or repetitive replies"},legal:{label:"Illegal",description:"Violates the law of your or the server's country"},violation:{label:"Server rule violation",description:"Breaks specific server rules",stampLabel:"Violation"},other:{label:"Other",description:"Issue doesn't fit other categories",excludeStamp:!0}};function wo({account:t,post:n,onClose:i}){const{masto:s}=Q(),[o,a]=A("default"),[d,u]=t.acct.split("@"),[c,p]=pe(()=>{const{rules:g,domain:b}=us();return[g||[],b]}),[f,r]=A(null),[h,l]=A(!1),y=z(null),[m,k]=A(!1);return e("div",{class:"report-modal-container",children:[e("div",{class:"top-controls",children:[e("h1",{children:n?"Report Post":`Report @${d}`}),e("button",{type:"button",class:"plain4 small",disabled:o==="loading",onClick:()=>i(),children:e(w,{icon:"x",size:"xl"})})]}),e("main",{children:[e("div",{class:"report-preview",children:n?e(Be,{status:n,size:"s",previewMode:!0}):e(Ze,{account:t,avatarSize:"xxl",useAvatarStatic:!0,showStats:!0,showActivity:!0})}),!!f&&!$t[f].excludeStamp&&e("span",{class:"rubber-stamp","aria-hidden":"true",children:[$t[f].stampLabel||$t[f].label,e("small",{children:"Pending review"})]},f),e("form",{onSubmit:g=>{g.preventDefault();const b=new FormData(g.target),C=Object.fromEntries(b.entries());let{category:v,comment:I,forward:x}=C;I||(I=void 0),x==="on"&&(x=!0);const E=v==="violation"?Object.entries(C).filter(([j])=>j.startsWith("rule_ids")).map(([j,M])=>M):void 0,Y={category:v,comment:I,forward:x,ruleIds:E};a("loading"),(async()=>{try{await s.v1.reports.create({accountId:t.id,statusIds:n!=null&&n.id?[n.id]:void 0,category:v,comment:I,ruleIds:E,forward:x}),a("success"),se(n?"Post reported":"Profile reported"),i()}catch(j){a("error"),se((j==null?void 0:j.message)||(n?"Unable to report post":"Unable to report profile"))}})()},children:[e("p",{children:n?"What's the issue with this post?":"What's the issue with this profile?"}),e("section",{class:"report-categories",children:yo.map(g=>g==="violation"&&!(c!=null&&c.length)?null:e(R,{children:[e("label",{class:"report-category",children:[e("input",{type:"radio",name:"category",value:g,required:!0,disabled:o==="loading",onChange:b=>{r(b.target.value),l(b.target.value==="violation")}}),e("span",{children:[$t[g].label,"  ",e("small",{class:"ib insignificant",children:$t[g].description})]})]}),g==="violation"&&!!(c!=null&&c.length)&&e("div",{class:"shazam-container no-animation",hidden:!h,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"report-rules",ref:y,children:c.map((b,C)=>e("label",{class:"report-rule",children:[e("input",{type:"checkbox",name:`rule_ids[${C}]`,value:b.id,required:h&&!m,disabled:o==="loading",onChange:v=>{const{checked:I}=v.target;I?k(!0):y.current.querySelectorAll("input:checked").length||k(!1)}}),e("span",{children:b.text})]},b.id))})})})]},g))}),e("section",{class:"report-comment",children:[e("p",{children:e("label",{for:"report-comment",children:"Additional info"})}),e("textarea",{maxlength:"1000",rows:"1",name:"comment",id:"report-comment",disabled:o==="loading"})]}),!!u&&u!==p&&e("section",{children:e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,name:"forward",disabled:o==="loading"})," ",e("span",{children:["Forward to ",e("i",{children:u})]})]})})}),e("footer",{children:[e("button",{type:"submit",disabled:o==="loading",children:"Send Report"})," ",e("button",{type:"submit",class:"plain2",disabled:o==="loading",onClick:async()=>{try{await s.v1.accounts.$select(t.id).mute(),se(`Muted ${d}`)}catch{se(`Unable to mute ${d}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Mute profile"})]})," ",e("button",{type:"submit",class:"plain2",disabled:o==="loading",onClick:async()=>{try{await s.v1.accounts.$select(t.id).block(),se(`Blocked ${d}`)}catch{se(`Unable to block ${d}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Block profile"})]}),e(Ae,{hidden:o!=="loading"})]})]})]})]})}const vo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",ko="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",So="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",Io=200,Co=10;async function Kt(){const{masto:t}=Q(),n=t.v1.followedTags.list({limit:Io}),i=[];let s=0;do{const{value:o,done:a}=await n.next();if(a||(o==null?void 0:o.length)===0)break;i.push(...o),s++}while(s<Co);return i.sort((o,a)=>o.name.localeCompare(a.name)),i.length&&setTimeout(()=>{be.account.set("followedTags",{tags:i,updatedAt:Date.now()})},1),i}const To=24*60*60*1e3;async function xo(){try{const{tags:t,updatedAt:n}=be.account.get("followedTags")||{};return t!=null&&t.length?(Date.now()-n>To&&Kt(),t):await Kt()}catch{return[]}}const qn=document.createElement("div"),Ao=t=>{if(!t)return[];if(t.indexOf("#")===-1)return[];qn.innerHTML=t;const n=qn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(i=>i.innerText.trim().replace(/^[^#]*#+/,"")):[]};function Ht({children:t}){if(typeof t=="string")return t;const[n,i]=A("");return G(()=>{Promise.resolve(t).then(i)},[t]),n}const at=9,$o=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],Ls={following:"Home / Following",notifications:"Notifications",list:"Lists",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},qt={list:[{text:"List ID",name:"id",notRequired:!0}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},_o=ht(async({id:t})=>{const n=await Q().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),Jt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:({id:t})=>t?"list":"lists",title:({id:t})=>t?Gi(t):"Lists",path:({id:t})=>t?`/l/${t}`:"/l",icon:"list",excludeViewMode:({id:t})=>t?[]:["multi-column"]},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||Q().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||Q().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t?`“${t}”`:"Search",path:({query:t})=>t?`/search?q=${encodeURIComponent(t)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:t})=>t?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:_o,path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||Q().instance,path:({hashtag:t,instance:n,media:i})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}${i?"?media=1":""}`,icon:"hashtag"}};function Ro({onClose:t}){const n=Me(T),{shortcuts:i}=n,[s,o]=A(!1),[a,d]=A(!1),[u]=pn();return e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:vo},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:So},{value:"multi-column",label:"Multi-column",imgURL:ko}].map(({value:c,label:p,imgURL:f})=>{const r=n.settings.shortcutsViewMode===c||c==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:r?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:c,checked:r,onChange:h=>{T.settings.shortcutsViewMode=h.target.value}})," ",e("img",{src:f,alt:"",width:"80",height:"58"})," ",e("span",{children:p})]},c)})}),i.length>0?e(R,{children:[e("ol",{class:"shortcuts-list",ref:u,children:i.filter(Boolean).map((c,p)=>{const f=Object.values(c).join("-"),{type:r}=c;if(!Jt[r])return null;let{icon:h,title:l,subtitle:y,excludeViewMode:m}=Jt[r];typeof l=="function"&&(l=l(c,p)),typeof y=="function"&&(y=y(c,p)),typeof h=="function"&&(h=h(c,p)),typeof m=="function"&&(m=m(c,p));const k=m==null?void 0:m.includes(n.settings.shortcutsViewMode);return e("li",{children:[e(w,{icon:h}),e("span",{class:"shortcut-text",children:[e(Ht,{children:l}),y&&e(R,{children:[" ",e("small",{class:"ib insignificant",children:y})]}),k&&e("span",{class:"tag",children:"Not available in current view mode"})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:p===0,onClick:()=>{const g=Array.from(T.shortcuts);if(p>0){const b=T.shortcuts[p-1];g[p-1]=c,g[p]=b,T.shortcuts=g}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:p===i.length-1,onClick:()=>{const g=Array.from(T.shortcuts);if(p<T.shortcuts.length-1){const b=T.shortcuts[p+1];g[p+1]=c,g[p]=b,T.shortcuts=g}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{o({shortcut:c,shortcutIndex:p})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},f)})}),i.length===1&&n.settings.shortcutsViewMode!=="float-button"&&e("div",{class:"ui-state insignificant",children:[e(w,{icon:"info"})," ",e("small",{children:"Add more than one shortcut/column to make this work."})]})]}):e("div",{class:"ui-state insignificant",children:[e("p",{children:n.settings.shortcutsViewMode==="multi-column"?"No columns yet. Tap on the Add column button.":"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:c=>{c.preventDefault(),T.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:i.length>=at&&(n.settings.shortcutsViewMode==="multi-column"?`Max ${at} columns`:`Max ${at} shortcuts`)}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>d(!0),children:"Import/export"}),e("button",{type:"button",disabled:i.length>=at,onClick:()=>o(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:n.settings.shortcutsViewMode==="multi-column"?"Add column…":"Add shortcut…"})]})]})]}),s&&e($e,{onClick:c=>{c.target===c.currentTarget&&o(!1)},children:e(Eo,{shortcut:s.shortcut,shortcutIndex:s.shortcutIndex,onSubmit:({result:c,mode:p})=>{p==="edit"?T.shortcuts[s.shortcutIndex]=c:T.shortcuts.push(c)},onClose:()=>o(!1)})}),a&&e($e,{onClick:c=>{c.target===c.currentTarget&&d(!1)},children:e(Lo,{shortcuts:i,onClose:()=>d(!1)})})]})}const Vn={list:"Specific list is optional. For multi-column mode, list is required, else the column will not be shown.",search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function Eo({onSubmit:t,disabled:n,shortcut:i,shortcutIndex:s,onClose:o}){var k,g;const a=!!i,[d,u]=A((i==null?void 0:i.type)||null),{masto:c}=Q(),[p,f]=A("default"),[r,h]=A([]),[l,y]=A([]);G(()=>{(async()=>{if(d==="list")try{f("loading");const b=await Pt();h(b),f("default")}catch{f("error")}})(),(async()=>{if(d==="hashtag")try{const b=await Kt();y(b)}catch{}})()},[d]);const m=z();return G(()=>{if(a&&d&&qt[d]){const b=m.current;qt[d].forEach(({name:C,type:v})=>{const I=b.querySelector(`[name="${C}"]`);I&&i[C]&&(v==="checkbox"?I.checked=i[C]==="on":I.value=i[C])})}},[a,d]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[a?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:m,onSubmit:b=>{b.preventDefault();const C=new FormData(b.target),v={};C.forEach((I,x)=>{v[x]=I==null?void 0:I.trim(),x==="instance"&&(v[x]=v[x].replace(/^https?:\/\//,"").replace(/\/+$/,""),v[x]=v[x].replace(/^@?[^@]+@/,""))}),v.type&&(t({result:v,mode:a?"edit":"add"}),b.target.reset(),u(null),o==null||o())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:n,onChange:b=>{u(b.target.value)},defaultValue:a?i.type:void 0,name:"type",children:[e("option",{}),$o.map(b=>e("option",{value:b,children:Ls[b]}))]})]})}),(g=(k=qt[d])==null?void 0:k.map)==null?void 0:g.call(k,({text:b,name:C,type:v,placeholder:I,pattern:x,notRequired:E})=>d==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!E,disabled:n||p==="loading",defaultValue:a?i.id:void 0,children:[e("option",{value:""}),r.map(Y=>e("option",{value:Y.id,children:Y.title}))]})]})}):e("p",{children:e("label",{children:[e("span",{children:b})," ",e("input",{type:v,switch:v==="checkbox"||void 0,name:C,placeholder:I,required:v==="text"&&!E,disabled:n,list:d==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:x}),d==="hashtag"&&l.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:l.map(Y=>e("option",{value:Y.name}))})]})})),!!Vn[d]&&e("p",{class:"form-note insignificant",children:[e(w,{icon:"info"}),Vn[d]]}),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:n||p==="loading",children:a?"Save":"Add"}),a&&e("button",{type:"button",class:"light danger",onClick:()=>{T.shortcuts.splice(s,1),o==null||o()},children:"Remove"})]})]})})]})}function Lo({shortcuts:t,onClose:n}){var r;const{masto:i}=Q(),s=pe(()=>!t||!t.filter(Boolean).length?"":Rn.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,a]=A(""),[d,u]=A("default"),c=pe(()=>{if(!o)return u("default"),null;try{const h=JSON.parse(Rn.decompressFromEncodedURIComponent(o));if(!Array.isArray(h))throw new Error("Not an array");return u("default"),h}catch{try{const l=JSON.parse(o);if(!Array.isArray(l))throw new Error("Not an array");return u("default"),l}catch{return u("error"),null}}},[o]),p=T.shortcuts.length>0,f=z();return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{class:"field-button",children:[e("input",{ref:f,type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:h=>{a(h.target.value)}}),T.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2 small",disabled:d==="cloud-downloading",onClick:async()=>{u("cloud-downloading");const h=ct();se("Downloading saved shortcuts from instance server…");try{const y=(await i.v1.accounts.relationships.fetch({id:[h]}))[0];if(y){const{note:m=""}=y;if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const k=m.match(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/)[1],{v:g,dt:b,data:C}=JSON.parse(k);f.current.value=C,f.current.dispatchEvent(new Event("input"))}}u("default")}catch{u("error"),se("Unable to download shortcuts")}},title:"Download shortcuts from instance server",children:[e(w,{icon:"cloud"}),e(w,{icon:"arrow-down"})]})]}),!!c&&Array.isArray(c)&&e(R,{children:[e("p",{children:[e("b",{children:c.length})," shortcut",c.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:c.map(h=>{var l,y;return e("li",{children:[e("span",{style:{opacity:t.some(m=>Object.keys(m).every(k=>m[k]===h[k]))?1:0},children:"*"}),e("span",{children:[Ls[h.type],h.type==="list"&&" ⚠️"," ",(y=(l=qt[h.type])==null?void 0:l.map)==null?void 0:y.call(l,({text:m,name:k,type:g})=>h[k]?e(R,{children:[e("span",{class:"tag collapsed insignificant",children:[m,":"," ",g==="checkbox"?h[k]==="on"?"✅":"❌":h[k]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),d==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[p&&e(R,{children:[e(et,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const h=c.filter(m=>!T.shortcuts.some(k=>Object.keys(k).every(g=>k[g]===m[g])));if(!h.length){se("No new shortcuts to import");return}let l=[...T.shortcuts,...h];const y=l.length>at;y&&(l=l.slice(0,at)),T.shortcuts=l,se(y?`Shortcuts imported. Exceeded max ${at}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!c,children:"Import & append…"})})," "]}),e(et,{confirmLabel:p?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:p?"danger":void 0,onClick:()=>{T.shortcuts=c,se("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!c,children:p?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:s,readOnly:!0,onClick:h=>{if(h.target.value){h.target.select();try{navigator.clipboard.writeText(h.target.value),se("Shortcuts copied")}catch{se("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.clipboard.writeText(s),se("Shortcut settings copied")}catch{se("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((r=navigator==null?void 0:navigator.canShare)==null?void 0:r.call(navigator,{text:s}))&&e("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.share({text:s})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",T.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2",disabled:d==="cloud-uploading",onClick:async()=>{u("cloud-uploading");const h=ct();try{const y=(await i.v1.accounts.relationships.fetch({id:[h]}))[0];if(y){const{note:m=""}=y;let k="";if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const g=JSON.stringify({v:"1",dt:Date.now(),data:s});k=m.replace(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/,`<phanpy-shortcuts-settings>${g}</phanpy-shortcuts-settings>`)}else k=`${m}


<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;se("Saving shortcuts to instance server…"),await i.v1.accounts.$select(h).note.create({comment:k}),u("default"),se("Shortcuts saved")}}catch{u("error"),se("Unable to save shortcuts")}},title:"Sync to instance server",children:[e(w,{icon:"cloud"}),e(w,{icon:"arrow-up"})]})," ",s.length>0&&e("small",{class:"insignificant ib",children:[s.length," characters"]})]}),!!s&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]}),T.settings.shortcutSettingsCloudImportExport&&e("footer",{children:e("p",{children:[e(w,{icon:"cloud"})," Import/export settings from/to instance server (Very experimental)"]})})]})]})}ps(T,t=>{for(const[n,i,s,o]of t)/^show/i.test(i)&&!s&&an()});function Mo(){var s,o,a,d,u,c,p,f;const t=Me(T),n=fs(),i=Tt();return G(()=>{setTimeout(Js,1e3)},[]),e(R,{children:[!!t.showCompose&&e($e,{class:`solid ${t.composerState.minimized?"min":""}`,minimized:!!t.composerState.minimized,children:e(Xs,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((s=window.__COMPOSE__)==null?void 0:s.replyToStatus)||null,editStatus:((o=T.showCompose)==null?void 0:o.editStatus)||((a=window.__COMPOSE__)==null?void 0:a.editStatus)||null,draftStatus:((d=T.showCompose)==null?void 0:d.draftStatus)||((u=window.__COMPOSE__)==null?void 0:u.draftStatus)||null,onClose:r=>{const{newStatus:h,instance:l,type:y}=r||{};T.showCompose=!1,window.__COMPOSE__=null,h&&(T.reloadStatusPage++,se({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[y||"post"],delay:1e3,duration:1e4,onClick:m=>{m.hideToast(),T.prevLocation=i,n(l?`/${l}/s/${h.id}`:`/s/${h.id}`)}}))}})}),!!t.showSettings&&e($e,{onClose:()=>{T.showSettings=!1},children:e(Bi,{onClose:()=>{T.showSettings=!1}})}),!!t.showAccounts&&e($e,{onClose:()=>{T.showAccounts=!1},children:e(Ei,{onClose:()=>{T.showAccounts=!1}})}),!!t.showAccount&&e($e,{onClose:()=>{T.showAccount=!1},children:e(uo,{account:((c=t.showAccount)==null?void 0:c.account)||t.showAccount,instance:(p=t.showAccount)==null?void 0:p.instance,onClose:({destination:r}={})=>{T.showAccount=!1}})}),!!t.showDrafts&&e($e,{onClose:()=>{T.showDrafts=!1},children:e(ho,{onClose:()=>T.showDrafts=!1})}),!!t.showMediaModal&&e($e,{onClick:r=>{(r.target===r.currentTarget||r.target.classList.contains("media"))&&(T.showMediaModal=!1)},children:e(Es,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{T.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e($e,{onClose:()=>{T.showShortcutsSettings=!1},children:e(Ro,{onClose:()=>T.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e($e,{onClose:()=>{T.showGenericAccounts=!1},children:e(mo,{instance:t.showGenericAccounts.instance,excludeRelationshipAttrs:t.showGenericAccounts.excludeRelationshipAttrs,postID:t.showGenericAccounts.postID,onClose:()=>T.showGenericAccounts=!1,blankCopy:t.showGenericAccounts.blankCopy})}),!!t.showMediaAlt&&e($e,{onClose:r=>{T.showMediaAlt=!1},children:e(go,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(f=t.showMediaAlt)==null?void 0:f.lang,onClose:()=>{T.showMediaAlt=!1}})}),!!t.showEmbedModal&&e($e,{class:"solid",onClose:()=>{T.showEmbedModal=!1},children:e(fo,{html:t.showEmbedModal.html,url:t.showEmbedModal.url,width:t.showEmbedModal.width,height:t.showEmbedModal.height,onClose:()=>{T.showEmbedModal=!1}})}),!!t.showReportModal&&e($e,{onClose:()=>{T.showReportModal=!1},children:e(wo,{account:t.showReportModal.account,post:t.showReportModal.post,onClose:()=>{T.showReportModal=!1}})})]})}function rn({accountID:t,onChange:n}){const{masto:i}=Q(),[s,o]=A("default"),[a,d]=A(null),[u,c]=A(null),p=u!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:s==="loading"||p,onClick:()=>{o("loading"),d("accept"),(async()=>{try{const f=await i.v1.followRequests.$select(t).authorize();if(!(f!=null&&f.followedBy))throw new Error("Follow request not accepted");c(f),n()}catch{}o("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:s==="loading"||p,class:"light danger",onClick:()=>{o("loading"),d("reject"),(async()=>{try{const f=await i.v1.followRequests.$select(t).reject();if(f!=null&&f.followedBy)throw new Error("Follow request not rejected");c(f),n()}catch{o("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:p&&a?a==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(Ae,{hidden:s!=="loading"})})]})}const Gn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning",severed_relationships:"heart-break",moderation_warning:"alert",emoji_reaction:"emoji2","pleroma:emoji_reaction":"emoji2"};function Yn(t,n){let i,s;return typeof n=="string"?i=n:(i=n==null?void 0:n.url,s=n==null?void 0:n.staticUrl),i?e(R,{children:["reacted to your post with"," ",e(Si,{url:i,staticUrl:s,alt:t})]}):`reacted to your post with ${t}.`}const vt={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(R,{children:["reported ",t]}),severed_relationships:t=>e(R,{children:["Lost connections with ",e("i",{children:t}),"."]}),moderation_warning:e("b",{children:"Moderation warning"}),emoji_reaction:Yn,"pleroma:emoji_reaction":Yn},Po={account_suspension:({from:t,targetName:n})=>e(R,{children:["An admin from ",e("i",{children:t})," has suspended ",e("i",{children:n}),", which means you can no longer receive updates from them or interact with them."]}),domain_block:({from:t,targetName:n,followersCount:i,followingCount:s})=>e(R,{children:["An admin from ",e("i",{children:t})," has blocked ",e("i",{children:n}),". Affected followers: ",i,", followings: ",s,"."]}),user_domain_block:({targetName:t,followersCount:n,followingCount:i})=>e(R,{children:["You have blocked ",e("i",{children:t}),". Removed followers: ",n,", followings: ",i,"."]})},No={none:"Your account has received a moderation warning.",disable:"Your account has been disabled.",mark_statuses_as_sensitive:"Some of your posts have been marked as sensitive.",delete_statuses:"Some of your posts have been deleted.",sensitive:"Your posts will be marked as sensitive from now on.",silence:"Your account has been limited.",suspend:"Your account has been suspended."},nn=50;function Do({notification:t,instance:n,isStatic:i,disableContextMenu:s}){var j,M,ee,Z,$,P;const{id:o,status:a,account:d,report:u,event:c,moderation_warning:p,_accounts:f,_statuses:r}=t;let{type:h}=t;const l=(a==null?void 0:a.reblog)||a,y=l==null?void 0:l.id,m=ct(),k=m===(d==null?void 0:d.id),g=(j=a==null?void 0:a.poll)==null?void 0:j.voted,b=!!(a!=null&&a.inReplyToAccountId)&&(a==null?void 0:a.inReplyToAccountId)!==m&&((M=a==null?void 0:a.account)==null?void 0:M.id)===m;let C=0,v=0;if(h==="favourite+reblog"){for(const L of f)(ee=L._types)!=null&&ee.includes("favourite")&&C++,(Z=L._types)!=null&&Z.includes("reblog")&&v++;!v&&C&&(h="favourite"),!C&&v&&(h="reblog")}let I;if(h==="poll"?I=vt[k?"poll-self":g?"poll-voted":"poll"]:h==="reblog"||h==="favourite"||h==="favourite+reblog"?(r==null?void 0:r.length)>1?I=vt[`${h}+account`]:b?I=vt[`${h}_reply`]:I=vt[h]:vt[h]?I=vt[h]:I=`[Unknown notification type: ${h}]`,typeof I=="function"){const L=(r==null?void 0:r.length)||(f==null?void 0:f.length);if(h==="admin.report"){const U=u==null?void 0:u.targetAccount;U&&(I=I(e(It,{account:U,showAvatar:!0})))}else if(h==="severed_relationships"){const U=c==null?void 0:c.targetName;U&&(I=I(U))}else if((h==="emoji_reaction"||h==="pleroma:emoji_reaction")&&t.emoji){const U=t.emoji_url||((P=($=a==null?void 0:a.emojis)==null?void 0:$.find)==null?void 0:P.call($,V=>(V==null?void 0:V.shortcode)===t.emoji.replace(/^:/,"").replace(/:$/,"")));I=I(t.emoji,U)}else L&&(I=I(L))}if(h==="mention"&&!a)return null;const x=t.createdAt&&new Date(t.createdAt).toLocaleString(),E={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[h]||"Accounts",Y=()=>{T.showGenericAccounts={heading:E,accounts:f,showReactions:h==="favourite+reblog",excludeRelationshipAttrs:h==="follow"?["followedBy"]:[],postID:Ke(y,n)}};return e("div",{class:`notification notification-${h}`,"data-notification-id":o,tabIndex:"0",children:[e("div",{class:`notification-type notification-${h}`,title:x,children:h==="favourite+reblog"?e(R,{children:[e(w,{icon:"rocket",size:"xl",alt:h,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:h,class:"favourite-icon"})]}):e(w,{icon:Gn[h]||"notification",size:"xl",alt:h})}),e("div",{class:"notification-content",children:[h!=="mention"&&e(R,{children:[e("p",{children:[!/poll|update/i.test(h)&&e(R,{children:(f==null?void 0:f.length)>1?e(R,{children:[e("b",{tabIndex:"0",onClick:Y,children:[e("span",{title:f.length,children:Ge(f.length)})," ","people"]})," "]}):d&&e(R,{children:[e(It,{account:d,showAvatar:!0})," "]})}),I,h==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(bt,{datetime:t.createdAt,format:"micro"})]})]}),h==="follow_request"&&e(rn,{accountID:d.id}),h==="severed_relationships"&&e("div",{children:[Po[c.type]({from:n,...c}),e("br",{}),e("a",{href:`https://${n}/severed_relationships`,target:"_blank",rel:"noopener noreferrer",children:["Learn more ",e(w,{icon:"external",size:"s"})]}),"."]}),h==="moderation_warning"&&!!p&&e("div",{children:[No[p.action],e("br",{}),e("a",{href:`/disputes/strikes/${p.id}`,target:"_blank",rel:"noopener noreferrer",children:["Learn more ",e(w,{icon:"external",size:"s"})]}),"."]})]}),(f==null?void 0:f.length)>1&&e("p",{class:"avatars-stack",children:[f.slice(0,nn).map(L=>e(R,{children:[e("a",{href:L.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:U=>{U.preventDefault(),T.showAccount=L},children:[e(st,{url:L.avatarStatic,size:f.length<=10?"xxl":f.length<20?"xl":f.length<30?"l":f.length<40?"m":"s",alt:`${L.displayName} @${L.acct}`,squircle:L==null?void 0:L.bot},L.id),h==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:L._types.map(U=>e(w,{icon:Gn[U],size:"s",class:`${U}-icon`}))})]},L.id)," "]},L.id)),e("button",{type:"button",class:"small plain",onClick:Y,children:[f.length>nn&&`+${f.length-nn}`,e(w,{icon:"chevron-down"})]})]}),(r==null?void 0:r.length)>1&&e("ul",{class:"notification-group-statuses",children:r.map(L=>e("li",{children:e(jn,{class:`status-link status-type-${h}`,to:n?`/${n}/s/${L.id}`:`/s/${L.id}`,children:e(Be,{status:L,size:"s",previewMode:!0,allowContextMenu:!0})})},L.id))}),a&&(!(r!=null&&r.length)||(r==null?void 0:r.length)<=1)&&e(jn,{class:`status-link status-type-${h}`,to:n?`/${n}/s/${y}`:`/s/${y}`,onContextMenu:s?void 0:L=>{const U=L.target.querySelector(".status");if(U){if(L.metaKey)return;L.preventDefault(),U.dispatchEvent(new MouseEvent("contextmenu",{clientX:L.clientX,clientY:L.clientY}))}},children:i?e(Be,{status:l,size:"s",readOnly:!0,allowContextMenu:!0}):e(Be,{statusID:y,size:"s",readOnly:!0,allowContextMenu:!0})})]})]})}function jn(t){const n=Ii();return e(oe,{...t,"data-read-more":"Read more →",ref:n})}const Zt=Xe(Do,(t,n)=>{var i,s;return((i=t.notification)==null?void 0:i.id)===((s=n.notification)==null?void 0:s.id)});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",t=>{const{type:n,id:i,accessToken:s}=(t==null?void 0:t.data)||{};n==="notification"&&(T.routeNotification={id:i,accessToken:s})});const Uo=Xe(function(){if(!("serviceWorker"in navigator))return null;const n=Me(T),{routeNotification:i}=n,{id:s,accessToken:o}=i||{},[a,d]=A(!1);lt(()=>{if(!s||!o)return;const{instance:c}=Q(),{masto:p,instance:f}=Q({accessToken:o}),r=c===f,h=o?Zs(o):St();(async()=>{const l=await p.v1.notifications.$select(s).fetch();if(l&&h){const y=h.instanceURL,{type:m,status:k,account:g}=l,b=!!document.querySelector("#modal-container > *"),C=m==="follow"&&!!(g!=null&&g.id),v=!!(g!=null&&g.id),I=!!(k!=null&&k.id);C&&r?T.showAccount={account:g,instance:y}:b||!r||v&&I?d({id:s,account:h,notification:l,sameInstance:r}):I?location.hash=`/${c}/s/${k.id}`:C?location.hash=`/${c}/a/${g.id}`:location.hash="/notifications"}})()},[s,o]),lt(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),Ct(c=>{c&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const u=()=>{d(!1),T.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(a){const{id:c,account:p,notification:f,sameInstance:r}=a;return e($e,{onClick:h=>{h.target===h.currentTarget&&u()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:u,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!r&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:h=>{const{target:l}=h;(h.target.tagName==="BUTTON"||h.target.tagName==="A")&&u()},children:e(Zt,{instance:p.instanceURL,notification:f,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(oe,{to:"/notifications",class:"button light",onClick:u,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null}),Ms=si((t,n)=>{const{instance:i}=Q(),[s,o]=it(),[a,d]=A(!1),[u,c]=A(s.get("q")||""),p=s.get("type"),f=z(null),r=z(null);return ni(n,()=>({setValue:h=>{c(h)},focus:()=>{r.current.focus()},select:()=>{r.current.select()},blur:()=>{r.current.blur()}})),e("form",{ref:f,class:"search-popover-container",onSubmit:h=>{var y;if(h.preventDefault(),/\/search/.test(location.hash))if(u){const m={q:u};p&&(m.type=p),o(m)}else o({});else u?location.hash=`/search?q=${encodeURIComponent(u)}${p?`&type=${p}`:""}`:location.hash="/search";(y=t==null?void 0:t.onSubmit)==null||y.call(t,h)},children:[e("input",{ref:r,value:u,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellCheck:"false",onSearch:h=>{h.target.value||o({})},onInput:h=>{c(h.target.value),d(!0)},onFocus:()=>{var h,l;d(!0),(l=(h=f.current)==null?void 0:h.querySelector(".search-popover-item"))==null||l.classList.add("focus")},onBlur:()=>{var h,l;setTimeout(()=>{d(!1)},100),(l=(h=f.current)==null?void 0:h.querySelector(".search-popover-item.focus"))==null||l.classList.remove("focus")},onKeyDown:h=>{var y;const{key:l}=h;switch(l){case"Escape":d(!1);break;case"Down":case"ArrowDown":if(h.preventDefault(),a){const m=f.current.querySelector(".search-popover-item.focus");if(m){let k=m.nextElementSibling;for(;k&&k.hidden;)k=k.nextElementSibling;k&&(k.classList.add("focus"),Array.from(k.parentElement.children).filter(b=>b!==k).forEach(b=>{b.classList.remove("focus")}))}else{const k=f.current.querySelector(".search-popover-item");k&&k.classList.add("focus")}}break;case"Up":case"ArrowUp":if(h.preventDefault(),a){const m=document.querySelector(".search-popover-item.focus");if(m){let k=m.previousElementSibling;for(;k&&k.hidden;)k=k.previousElementSibling;k&&(k.classList.add("focus"),Array.from(k.parentElement.children).filter(b=>b!==k).forEach(b=>{b.classList.remove("focus")}))}else{const k=document.querySelector(".search-popover-item:last-child");k&&k.classList.add("focus")}}break;case"Enter":if(a){const m=document.querySelector(".search-popover-item.focus");m&&(h.preventDefault(),m.click()),d(!1),(y=t==null?void 0:t.onSubmit)==null||y.call(t,h)}break}}}),e("div",{class:"search-popover",hidden:!a||!u,children:!!u&&[{label:e(R,{children:[u," ",e("small",{class:"insignificant",children:"‒ accounts, hashtags & posts"})]}),to:`/search?q=${encodeURIComponent(u)}`,top:!p&&!/\s/.test(u),hidden:!!p},{label:e(R,{children:["Posts with ",e("q",{children:u})]}),to:`/search?q=${encodeURIComponent(u)}&type=statuses`,hidden:/^https?:/.test(u),top:/\s/.test(u),icon:"document",queryType:"statuses"},{label:e(R,{children:["Posts tagged with ",e("mark",{children:["#",u.replace(/^#/,"")]})]}),to:`/${i}/t/${u.replace(/^#/,"")}`,hidden:/^@/.test(u)||/^https?:/.test(u)||/\s/.test(u),top:/^#/.test(u),type:"link",icon:"hashtag",queryType:"hashtags"},{label:e(R,{children:["Look up ",e("mark",{children:u})]}),to:`/${u}`,hidden:!/^https?:/.test(u),top:/^https?:/.test(u),type:"link"},{label:e(R,{children:["Accounts with ",e("q",{children:u})]}),to:`/search?q=${encodeURIComponent(u)}&type=accounts`,icon:"group",queryType:"accounts"}].sort((h,l)=>{if(p){if(h.queryType===p)return-1;if(l.queryType===p)return 1}return h.top&&!l.top?-1:!h.top&&l.top?1:0}).filter(({hidden:h})=>!h).map(({label:h,to:l,icon:y,type:m},k)=>e(oe,{to:l,class:`search-popover-item ${k===0?"focus":""}`,onClick:g=>{var b;(b=t==null?void 0:t.onSubmit)==null||b.call(t,g)},children:[e(w,{icon:y||(m==="link"?"arrow-right":"search"),class:"more-insignificant"}),e("span",{children:h})," "]}))})]})}),Fo=Xe(function({onClose:n=()=>{}}){const[i,s]=A(!1),o=z(null);Re(["Slash","/"],d=>{s(!0),setTimeout(()=>{var u,c,p,f;(c=(u=o.current)==null?void 0:u.focus)==null||c.call(u),(f=(p=o.current)==null?void 0:p.select)==null||f.call(p)},0)},{preventDefault:!0,ignoreEventWhen:d=>{const u=/\/search/.test(location.hash),c=!!document.querySelector("#modal-container > *");return u||c}});const a=()=>{s(!1),n()};return Re("esc",d=>{var u,c;(c=(u=o.current)==null?void 0:u.blur)==null||c.call(u),a()},{enabled:i,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!i,onClick:d=>{d.target===d.currentTarget&&a()},children:e(Ms,{ref:o,onSubmit:()=>{a()}})})});function Oo(){const{instance:t}=Q(),n=Me(T),{shortcuts:i,settings:s}=n;if(!i.length||s.shortcutsViewMode==="multi-column"||!s.shortcutsViewMode&&s.shortcutsColumnsMode)return null;const o=z(),a=z(!1),d=i.map((f,r)=>{const{type:h,...l}=f;if(!Jt[h])return null;let{id:y,path:m,title:k,subtitle:g,icon:b}=Jt[h];return typeof y=="function"&&(y=y(l,r)),typeof m=="function"&&(m=m({...l,instance:l.instance||t},r)),typeof k=="function"&&(k=k(l,r)),typeof g=="function"&&(g=g(l,r)),typeof b=="function"&&(b=b(l,r)),y==="lists"&&(a.current=!0),{id:y,path:m,title:k,subtitle:g,icon:b}}).filter(Boolean),u=fs();Re(["1","2","3","4","5","6","7","8","9"],(f,r)=>{var l,y;const h=parseInt(r.keys[0],10)-1;if(h<d.length){const{path:m}=d[h];m&&(u(m),(y=(l=o.current)==null?void 0:l.closeMenu)==null||y.call(l))}});const[c,p]=A([]);return e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",onContextMenu:f=>{f.preventDefault(),T.showShortcutsSettings=!0},children:e("ul",{children:d.map(({id:f,path:r,title:h,subtitle:l,icon:y},m)=>e("li",{children:e(oe,{class:l?"has-subtitle":"",to:r,onClick:k=>{if(k.target.classList.contains("is-active")){k.preventDefault();const g=document.getElementById(`${f}-page`);if(g){g.scrollTop=0;const b=g.querySelector(".updates-button");b&&b.click()}}},children:[e(w,{icon:y,size:"xl",alt:h}),e("span",{children:[e(Ht,{children:h}),l&&e(R,{children:[e("br",{}),e("small",{children:l})]})]})]})},`${m}-${f}-${h}-${l}-${r}`))})}):e(Je,{instanceRef:o,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",onMenuChange:f=>{f.open&&a.current&&Pt().then(p)},menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:f=>{f.preventDefault(),T.showShortcutsSettings=!0},onTransitionStart:f=>{var r,h;try{const{target:l}=f;getComputedStyle(l).pointerEvents==="none"&&((h=(r=o.current)==null?void 0:r.closeMenu)==null||h.call(r))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:d.map(({id:f,path:r,title:h,subtitle:l,icon:y},m)=>f==="lists"?e(Wt,{menuClassName:"glass-menu",overflow:"auto",gap:-8,label:e(R,{children:[e(w,{icon:y,size:"l"}),e("span",{class:"menu-grow",children:e(Ht,{children:h})}),e(w,{icon:"chevron-right"})]}),children:[e(_e,{to:"/l",children:e("span",{children:"All Lists"})}),e(ze,{}),c==null?void 0:c.map(k=>e(_e,{to:`/l/${k.id}`,children:e("span",{children:k.title})},k.id))]}):e(_e,{to:r,class:"glass-menu-item",children:[e(w,{icon:y,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Ht,{children:h})}),l&&e(R,{children:[" ",e("small",{class:"more-insignificant",children:l})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:m+1})]},`${m}-${f}-${h}-${l}-${r}`))})})}const zo=Xe(Oo);function Bo(t){var o;let n=[],i=[],s=0;for(let a=0;a<t.length;a++){const d=t[a];d.reblog&&!((o=d.account)!=null&&o.group)?(i.push(d),s++):(n.push(d),s<3&&(s=0))}if(t.length>10&&(i.length>t.length/4||s>=3)){const a=i.map(d=>d.id);if(i.length>t.length*3/4)n=[...n,{id:a,items:i,type:"boosts"}];else{const d=Math.floor(n.length/2);n=[...n.slice(0,d),{id:a,items:i,type:"boosts"},...n.slice(d)]}return n}else return t}function Wn(t,n){const i=be.account.get("boostedStatusIDs")||{},s=t.filter(a=>{if(!a.reblog)return!0;const d=`${n}-${a.reblog.id}`,u=i[d];return u&&u!==a.id?!1:(i[d]=a.id,!0)}),o=Object.keys(i);return o.length>50&&o.slice(0,o.length-50).forEach(a=>{delete i[a]}),be.account.set("boostedStatusIDs",i),s}function Ho(t,n){const i=[];let s=0;t.forEach(d=>{for(let c=0;c<i.length;c++){if(i[c].find(p=>p.id===d.id))return;if(i[c].find(p=>p.id===d.inReplyToId)||i[c].find(p=>p.inReplyToId===d.id)){i[c].push(d);return}}const u=t.find(c=>c.id===d.inReplyToId);u&&(i[s++]=[d,u])});for(let d=0;d<i.length;d++)for(let u=d+1;u<i.length;u++)i[d].find(p=>i[u].includes(p))&&(i[d]=[...i[d],...i[u]],i[d]=i[d].filter((p,f,r)=>r.findIndex(h=>h.id===p.id)===f),i.splice(u,1),u--);i.forEach(d=>{d.sort((u,c)=>!u.inReplyToId&&!c.inReplyToId?new Date(u.createdAt)-new Date(c.createdAt):u.inReplyToId===c.id?1:c.inReplyToId===u.id||!u.inReplyToId?-1:c.inReplyToId?new Date(u.createdAt)-new Date(c.createdAt):1)}),i.forEach(d=>{const u=d[0].account.id;d.forEach(c=>{c.account.id!==u&&(c._differentAuthor=!0)})}),i.length;const o=[],a=[];return t.forEach(d=>{if(d.reblog){o.push(d);return}for(let u=0;u<i.length;u++)if(i[u].find(c=>c.id===d.id)){if(a.includes(u))return;const c=i[u];c.sort((f,r)=>{const h=new Date(f.createdAt),l=new Date(r.createdAt);return h-l});const p=c[0].account.id;o.push({id:c.map(f=>f.id),items:c,type:c.every(f=>f.account.id===p)?"thread":"conversation"}),a.push(u);return}if(d.inReplyToId&&d.inReplyToAccountId!==d.account.id){const u=Ke(d.id,n);T.statusReply[u]||queueMicrotask(async()=>{try{const{masto:c}=Q({instance:n}),p=await qo(d.inReplyToId,c);He(p,n,{skipThreading:!0,skipUnfurling:!0}),T.statusReply[u]={id:p.id,instance:n}}catch{}})}o.push(d)}),o}const qo=ht((t,n)=>n.v1.statuses.$select(t).fetch());async function Ps(t,n){const i=await xo();if(!i.length)return;const{statusFollowedTags:s}=T,o=[];if(t.forEach(a=>{var h;if(a.reblog)return;const{id:d,content:u,tags:c=[]}=a,p=Ke(d,n);if((h=s[p])!=null&&h.length)return;const f=Ao(u);if(!f.length&&!c.length)return;const r=i.reduce((l,y)=>((f.some(m=>m.toLowerCase()===y.name.toLowerCase())||c.some(m=>m.name.toLowerCase()===y.name.toLowerCase()))&&l.push(y.name),l),[]);r.length&&o.push({item:a,sKey:p,followedTags:r})}),o.length){const a=o.map(u=>u.item.account),d=await bn(a);if(!d)return;o.forEach(u=>{const{item:c,sKey:p,followedTags:f}=u,r=d[c.account.id];r&&!r.following&&(s[p]=f)})}}function Vo(){T.statusFollowedTags={}}function Go({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:s=10,scrollThresholdEnd:o=10,direction:a="vertical",distanceFromStartPx:d,distanceFromEndPx:u}={}){const[c,p]=A(null),[f,r]=A(!1),[h,l]=A(!1),[y,m]=A(!1),[k,g]=A(!1),b=a==="vertical";return lt(()=>{const C=t.current;if(!C)return{};let v=b?C.scrollTop:C.scrollLeft;function I(){const{scrollTop:x,scrollLeft:E,scrollHeight:Y,scrollWidth:j,clientHeight:M,clientWidth:ee}=C,Z=b?x:E,$=b?Y:j,P=b?M:ee,L=Math.abs(Z-v),U=d||Math.min(P*n,$,Z),V=u||Math.min(P*i,$,$-Z-P);L>=(v<Z?o:s)&&(p(v<Z?"end":"start"),v=Z),r(Z<=0),l(Z+P>=$),m(Z<=U),g(Z+P>=$-V)}return C.addEventListener("scroll",I,{passive:!0}),()=>C.removeEventListener("scroll",I)},[n,i,s,o]),{scrollDirection:c,reachStart:f,reachEnd:h,nearReachStart:y,nearReachEnd:k,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function Yo({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:s=10,scrollThresholdEnd:o=10,direction:a="vertical",distanceFromStartPx:d,distanceFromEndPx:u,init:c}={},p,f){if(!p)return;const r=a==="vertical",h=z(null),l=z(null),y=ii(()=>{let m=!1,k=!1,g=!1,b=!1;const C=t.current,{scrollTop:v,scrollLeft:I,scrollHeight:x,scrollWidth:E,clientHeight:Y,clientWidth:j}=C,M=r?v:I,ee=r?x:E,Z=r?Y:j,$=Math.abs(M-h.current),P=d||Math.min(Z*n,ee,M),L=u||Math.min(Z*i,ee,ee-M-Z);$>=(h.current<M?o:s)&&(l.current=h.current<M?"end":"start",h.current=M),m=M<=0,k=M+Z>=ee,g=M<=P,b=M+Z>=ee-L,p({scrollDirection:l.current,reachStart:m,reachEnd:k,nearReachStart:g,nearReachEnd:b})},500);lt(()=>{const m=t.current;return m?(h.current=m[r?"scrollTop":"scrollLeft"],m.addEventListener("scroll",y,{passive:!0}),()=>m.removeEventListener("scroll",y)):{}},[n,i,s,o,...f]),G(()=>{c&&t.current&&queueMicrotask(()=>{t.current.dispatchEvent(new Event("scroll"))})},[c])}function jo({class:t,statusID:n,status:i,instance:s,parent:o,onMediaClick:a}){let d=Ke(n,s);const u=Me(T);if(i||(i=u.statuses[d]||u.statuses[n],d=Ke(i==null?void 0:i.id,s)),!i)return null;const{account:{acct:c,avatar:p,avatarStatic:f,id:r,url:h,displayName:l,username:y,emojis:m,bot:k,group:g},id:b,repliesCount:C,reblogged:v,reblogsCount:I,favourited:x,favouritesCount:E,bookmarked:Y,poll:j,muted:M,sensitive:ee,spoilerText:Z,visibility:$,language:P,editedAt:L,filtered:U,card:V,createdAt:ye,inReplyToId:ve,inReplyToAccountId:fe,content:ne,mentions:me,mediaAttachments:ue,reblog:he,uri:ke,url:Ee,emojis:Te,_deleted:Pe,_pinned:Fe}=i;if(!(ue!=null&&ue.length))return null;const xe=W=>{W.shiftKey},X=pe(()=>ct(),[]),ae=pe(()=>X&&X===r,[r,X]),te=oi(Is),Se=!ae&&Mt(U,te);if((Se==null?void 0:Se.action)==="hide")return null;const Ie=ee,re=pe(()=>(be.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",N=o||"div";return ue.map((W,_)=>{const H=`${d}-${W.id}`,J=Se==null?void 0:Se.titlesStr;return e(N,{"data-state-post-id":d,onMouseEnter:xe,"data-spoiler-text":Z||(ee?"Sensitive media":void 0),"data-filtered-text":Se?`Filtered${J?`: ${J}`:""}`:void 0,class:`
          media-post
          ${Se?"filtered":""}
          ${Ie?"has-spoiler":""}
          ${re?"show-media":""}
        `,children:e(Ss,{class:t,media:W,lang:P,to:`/${s}/s/${b}?media-only=${_+1}`,onClick:a?ce=>a(ce,_,W,i):void 0})},H)})}const Kn=Xe(jo);function Wo(t){var I,x,E,Y,j;const n=Me(T),{masto:i,instance:s,authenticated:o}=Q(),[a,d]=pe(()=>{const M=be.local.getJSON("accounts")||[];return[M.find(Z=>Z.info.id===ct())||M[0],M.length>1]},[]),u=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(M=>M.type==="following"),c=ai(()=>{T.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),p=z(),[f,r]=A(void 0),h=Ci([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),l=z();async function y(M){return(M||!l.current)&&(l.current=i.v1.mutes.list({limit:80})),await l.current.next()}const m=z();async function k(M){return(M||!m.current)&&(m.current=i.v1.blocks.list({limit:80})),await m.current.next()}const g=We("@mastodon/lists"),[b,C]=A([]);G(()=>{g&&f==="open"&&Pt().then(C)},[f==="open"]);const v=z();return e(R,{children:[e("button",{ref:p,type:"button",class:`button plain nav-menu-button ${d?"with-avatar":""} ${f==="open"?"active":""}`,style:{position:"relative"},onClick:()=>{v.current=Date.now(),r(M=>M?void 0:"open")},onContextMenu:M=>{M.preventDefault(),T.showAccounts=!0},...c(),children:[d&&e(st,{url:((I=a==null?void 0:a.info)==null?void 0:I.avatar)||((x=a==null?void 0:a.info)==null?void 0:x.avatarStatic),size:"l",squircle:(E=a==null?void 0:a.info)==null?void 0:E.bot}),e(w,{icon:"menu",size:d?"s":"l"})]}),e(ms,{menuClassName:"nav-menu",state:f,anchorRef:p,onClose:()=>{r(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-v.current<300}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:h,unmountOnClose:!0,children:[!!((Y=n.appVersion)!=null&&Y.commitHash)&&n.appVersion.commitHash!=="314075d"&&e("div",{class:"top-menu",children:[e(de,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(ze,{})]}),e("section",{children:[e(_e,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),o?e(R,{children:[u&&e(_e,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(_e,{to:"/catchup",children:[e(w,{icon:"history2",size:"l"}),e("span",{children:"Catch-up"})]}),We("@mastodon/mentions")&&e(_e,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(_e,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(ze,{}),((j=a==null?void 0:a.info)==null?void 0:j.id)&&e(_e,{to:`/${s}/a/${a.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),(b==null?void 0:b.length)>0?e(Wt,{menuClassName:"nav-submenu",overflow:"auto",gap:-8,label:e(R,{children:[e(w,{icon:"list",size:"l"}),e("span",{class:"menu-grow",children:"Lists"}),e(w,{icon:"chevron-right"})]}),children:[e(_e,{to:"/l",children:e("span",{children:"All Lists"})}),(b==null?void 0:b.length)>0&&e(R,{children:[e(ze,{}),b.map(M=>e(_e,{to:`/l/${M.id}`,children:e("span",{children:M.title})},M.id))]})]}):g&&e(_e,{to:"/l",children:[e(w,{icon:"list",size:"l"}),e("span",{children:"Lists"})]}),e(_e,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Wt,{menuClassName:"nav-submenu",overflow:"auto",gap:-8,label:e(R,{children:[e(w,{icon:"more",size:"l"}),e("span",{class:"menu-grow",children:"More…"}),e(w,{icon:"chevron-right"})]}),children:[e(_e,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]}),e(_e,{to:"/fh",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(ze,{}),We("@mastodon/filters")&&e(_e,{to:"/ft",children:[e(w,{icon:"filters",size:"l"}),"Filters"]}),e(de,{onClick:()=>{T.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:y,excludeRelationshipAttrs:["muting"]}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(de,{onClick:()=>{T.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:k,excludeRelationshipAttrs:["blocking"]}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]})," "]}),e(ze,{}),e(de,{onClick:()=>{T.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]})]}):e(R,{children:[e(ze,{}),e(_e,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]})]})]}),e("section",{children:[e(ze,{}),e(_e,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(_e,{to:`/${s}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]}),e(_e,{to:`/${s}/p/l`,children:[e(w,{icon:"building",size:"l"})," ",e("span",{children:"Local"})]}),e(_e,{to:`/${s}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),o?e(R,{children:[e(ze,{className:"divider-grow"}),e(de,{onClick:()=>{T.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(de,{onClick:()=>{T.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(de,{onClick:()=>{T.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(R,{children:[e(ze,{}),e(de,{onClick:()=>{T.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})]})]})]})}const yt=Xe(Wo),Ut={block:"nearest",inline:"center",behavior:"smooth"};function dt({title:t,titleComponent:n,id:i,instance:s,emptyText:o,errorText:a,useItemID:d,boostsCarousel:u,fetchItems:c=()=>{},checkForUpdates:p=()=>{},checkForUpdatesInterval:f=15e3,headerStart:r,headerEnd:h,timelineStart:l,refresh:y,view:m,filterContext:k,showFollowedTags:g,showReplyParent:b}){const C=Me(T),[v,I]=A([]),[x,E]=A("start"),[Y,j]=A(!1),[M,ee]=A(!1),[Z,$]=A(!0),P=z(),L=pe(()=>hn(),[]),U=m!=="media",V=ci(X=>{ee(!1),x!=="loading"&&(E("loading"),(async()=>{try{let{done:ae,value:te}=await c(X);if(Array.isArray(te)){const[Se,Ie]=te.reduce((F,re)=>(re._pinned?F[0].push(re):F[1].push(re),F),[[],[]]);te=Ie,U&&(u&&(te=Bo(te)),te=Ho(te,s)),Se.length&&(te=Se.concat(te)),I(X?te:F=>[...F,...te]),te.length||(ae=!0),j(!ae)}else j(!1);E("default")}catch{E("error")}finally{V.cancel()}})())},1500,{leading:!0,trailing:!1}),ye=".timeline-item, .timeline-item-alt",ve=Re("j, shift+j",(X,ae)=>{const te=document.activeElement.closest(ye),Se=te==null?void 0:te.getBoundingClientRect(),Ie=Array.from(P.current.querySelectorAll(ye));if(te&&Se.top<P.current.clientHeight&&Se.bottom>0){const F=Ie.indexOf(te);let re=Ie[F+1];ae.shift&&(re=Ie.find((N,W)=>W>F&&!N.classList.contains("timeline-item-alt"))),re&&(re.focus(),re.scrollIntoView(Ut))}else{const F=Ie.find(re=>{const N=re.getBoundingClientRect();return N.top>=44&&N.left>=0});F&&(F.focus(),F.scrollIntoView(Ut))}}),fe=Re("k, shift+k",(X,ae)=>{const te=document.activeElement.closest(ye),Se=te==null?void 0:te.getBoundingClientRect(),Ie=Array.from(P.current.querySelectorAll(ye));if(te&&Se.top<P.current.clientHeight&&Se.bottom>0){const F=Ie.indexOf(te);let re=Ie[F-1];ae.shift&&(re=Ie.findLast((N,W)=>W<F&&!N.classList.contains("timeline-item-alt"))),re&&(re.focus(),re.scrollIntoView(Ut))}else{const F=Ie.find(re=>{const N=re.getBoundingClientRect();return N.top>=44&&N.left>=0});F&&(F.focus(),F.scrollIntoView(Ut))}}),ne=Re(["enter","o"],()=>{const X=document.activeElement;X!=null&&X.matches(ye)&&X.click()}),me=v.length>0&&x!=="loading"&&M,ue=Qe(()=>{var X;me&&V(!0),(X=P.current)==null||X.scrollTo({top:0,behavior:"smooth"})},[V,me]),he=Re(".",ue),ke=z(),[Ee,Te]=A(!1);Yo({scrollableRef:P,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:X,nearReachStart:ae,reachStart:te})=>{if(ke.current){const Se=X==="end"&&!ae;ke.current.hidden=Se}Te(ae),te&&V(!0)},[]),G(()=>{var X;(X=P.current)==null||X.scrollTo({top:0}),V(!0)},[]),G(()=>{V(!0)},[y]);const Pe=z(m);G(()=>{Pe.current!==m&&(Pe.current=m,I([]))},[m]);const Fe=Qe(async({disableIdleCheck:X=!1}={})=>{const ae=P.current?getComputedStyle(P.current).pointerEvents==="none":!1;C.settings.autoRefresh&&P.current.scrollTop<16&&(X||window.__IDLE__)&&!Zo()&&!ae?V(!0):await p()&&ee(!0)},[i,V,p,C.settings.autoRefresh]),xe=z();return Ct(X=>{if(X){const ae=Date.now()-xe.current;(!xe.current||ae>1e3*3)&&Fe({disableIdleCheck:!0})}else xe.current=Date.now();$(X)},[p,Fe,C.settings.autoRefresh]),gn(Fe,Z&&!M?f*(Ee?1:2):null),e(Is.Provider,{value:k,children:e("div",{id:`${i}-page`,class:`deck-container ${L?"deck-container-media-first":""}`,ref:X=>{P.current=X,ve.current=X,fe.current=X,ne.current=X,he.current=X},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{ref:ke,onClick:X=>{var ae;X.target.closest("a, button")||(ae=P.current)==null||ae.scrollTo({top:0,behavior:"smooth"})},onDblClick:X=>{X.target.closest("a, button")||V(!0)},class:x==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(yt,{}),r??e(oe,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!h&&h})]}),me&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:ue,children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!l&&e("div",{class:`timeline-start ${x==="loading"?"loading":""}`,children:l}),v.length?e(R,{children:[e("ul",{class:`timeline ${m?`timeline-${m}`:""}`,children:[v.map(X=>e(Ko,{status:X,instance:s,useItemID:d,filterContext:k,view:m,showFollowedTags:g,showReplyParent:b,mediaFirst:L},X.id+(X==null?void 0:X._pinned)+m)),Y&&x==="loading"&&(m==="media"?null:e(R,{children:[e("li",{style:{height:"20vh"},children:e(Be,{skeleton:!0,mediaFirst:L})}),e("li",{style:{height:"25vh"},children:e(Be,{skeleton:!0,mediaFirst:L})})]}))]}),x==="default"&&(Y?e(rt,{root:P.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:X=>{X&&V()},children:e("button",{type:"button",class:"plain block",onClick:()=>V(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):x==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((X,ae)=>m==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e(Be,{skeleton:!0,mediaFirst:L})},ae))}):x!=="error"&&x!=="start"&&e("p",{class:"ui-state",children:o}),x==="error"&&e("p",{class:"ui-state",children:[a,e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>V(!v.length),children:"Try again"})]})]})})})}const Ko=Xe(({status:t,instance:n,useItemID:i,filterContext:s,view:o,showFollowedTags:a,showReplyParent:d,mediaFirst:u})=>{const{id:c,reblog:p,items:f,type:r,_pinned:h}=t;h&&(i=!1);const l=(p==null?void 0:p.id)||c,y=n?`/${n}/s/${l}`:`/s/${l}`;if(f){const k=At(f,s);let g="";if(r==="boosts"?g=`${k.length} Boosts`:r==="pinned"&&(g="Pinned posts"),r==="boosts"||r==="pinned")return k.sort((v,I)=>{const x=Mt(v.filtered,s),E=Mt(I.filtered,s);return x&&!E?1:!x&&E?-1:0}),e("li",{class:"timeline-item-carousel",children:e(Jo,{title:g,class:`${r}-carousel`,children:k.map(v=>{const{id:I,reblog:x,_pinned:E}=v,Y=(x==null?void 0:x.id)||I,j=n?`/${n}/s/${Y}`:`/s/${Y}`;return E&&(i=!1),e("li",{children:e(oe,{class:"status-carousel-link timeline-item-alt",to:j,children:i?e(Be,{statusID:I,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0,mediaFirst:u}):e(Be,{status:v,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0,mediaFirst:u})})},I)})})},`timeline-${c}`);const C=k.length>3;return k.map((v,I)=>{const{id:x,_differentAuthor:E}=v,Y=n?`/${n}/s/${x}`:`/s/${x}`,j=I>0&&I<k.length-1,M=v.sensitive&&!!v.spoilerText,ee=!E&&M&&I>0||C&&j&&(r==="thread"||r==="conversation"&&!E&&!k[I-1]._differentAuthor&&!k[I+1]._differentAuthor),Z=I===0,$=I===k.length-1;return e("li",{class:`timeline-item-container timeline-item-container-type-${r} timeline-item-container-${Z?"start":$?"end":"middle"} ${E?"timeline-item-diff-author":""}`,children:e(oe,{class:"status-link timeline-item",to:Y,children:ee?e(Xo,{status:v,instance:n,filterContext:s}):i?e(Be,{statusID:x,instance:n,enableCommentHint:$,showFollowedTags:a}):e(Be,{status:v,instance:n,enableCommentHint:$,showFollowedTags:a})})},`timeline-${x}`)})}const m=`timeline-${c+h}`;return o==="media"?i?e(Kn,{class:"timeline-item",parent:"li",statusID:c,instance:n},m):e(Kn,{class:"timeline-item",parent:"li",status:t,instance:n},m):e("li",{children:e(oe,{class:"status-link timeline-item",to:y,children:i?e(Be,{statusID:c,instance:n,enableCommentHint:!0,showFollowedTags:a,showReplyParent:d,mediaFirst:u}):e(Be,{status:t,instance:n,enableCommentHint:!0,showFollowedTags:a,showReplyParent:d,mediaFirst:u})})},m)},(t,n)=>{var o,a;const i=(((o=t.status)==null?void 0:o.id)||"").toString(),s=(((a=n.status)==null?void 0:a.id)||"").toString();return i===s&&t.instance===n.instance&&t.view===n.view});function Jo({title:t,class:n,children:i}){const s=z(),o=z(),a=z(),[d,u]=A(!1);return G(()=>{setTimeout(()=>{u(!0)},1)},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{ref:o,type:"button",class:"small plain2",onClick:()=>{var c,p;(p=s.current)==null||p.scrollBy({left:-Math.min(320,(c=s.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{ref:a,type:"button",class:"small plain2",onClick:()=>{var c,p;(p=s.current)==null||p.scrollBy({left:Math.min(320,(c=s.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:s,children:[e(rt,{class:"status-carousel-beacon",onChange:c=>{o.current&&(o.current.disabled=c)}}),i[0],d&&i.slice(1),e(rt,{class:"status-carousel-beacon",onChange:c=>{a.current&&(a.current.disabled=c)}})]})]})}function Xo({status:t,instance:n,filterContext:i}){const s=Me(T),{id:o,visibility:a,language:d}=t,u=yn(t),c=Ke(o,n),p=Mt(t.filtered,i);return e("article",{class:`status compact-thread ${a==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[s.statusThreadNumber[c]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),s.statusThreadNumber[c]?` ${s.statusThreadNumber[c]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:u,lang:d,dir:"auto",children:p?e("b",{class:"status-filtered-badge badge-meta horizontal",title:(p==null?void 0:p.titlesStr)||"",children:[e("span",{children:"Filtered"}),": ",e("span",{children:(p==null?void 0:p.titlesStr)||""})]}):e(R,{children:[u,t.sensitive&&t.spoilerText&&e(R,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})})]})}function Zo(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const kt=20,Cn=1983,Jn=`${Cn}-01`,Qo=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function ea(t){var s;const{masto:n}=Q({instance:t}),i=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((s=i==null?void 0:i.statuses)!=null&&s.length)}const ta=ht(ea);function na(){const t=Me(T),{id:n,...i}=gt(),[s,o]=it(),a=s.get("month"),d=!s.get("replies"),u=!!s.get("boosts"),c=s.get("tagged"),p=!!s.get("media"),{masto:f,instance:r,authenticated:h}=Q({instance:i.instance}),{masto:l,instance:y}=Q(),m=z(),k=[a,d,u,c,p],[g,b]=A(),C=z(0);G(()=>{C.current=0},k);const v=pe(()=>hn(),[]),I=pe(()=>r===y,[r,y]),[x,E]=A(!1);G(()=>{I&&g!=null&&g.acct&&(async()=>{const ne=await ta(r);E(ne)})()},[r,I,g==null?void 0:g.acct]);async function Y(ne){var Te,Pe,Fe,xe;const me=/^\d{4}-[01]\d$/.test(a),ue=((Pe=(Te=a==null?void 0:a.split)==null?void 0:Te.call(a,"-"))==null?void 0:Pe[0])>=Cn;if(me&&ue){if(!g)return{value:[],done:!0};const[X,ae]=a.split("-"),te=parseInt(ae,10)-1,Se=new Date(X,te,0),Ie=`${Se.getFullYear()}-${(Se.getMonth()+1).toString().padStart(2,"0")}-${Se.getDate().toString().padStart(2,"0")}`,F=new Date(X,te+1,1),re=`${F.getFullYear()}-${(F.getMonth()+1).toString().padStart(2,"0")}-${F.getDate().toString().padStart(2,"0")}`;let N;ne?(N=kt+1,C.current=0):(N=kt+C.current+1,C.current+=kt);const W=await f.v2.search.fetch({q:`from:${g.acct} after:${Ie} before:${re}`,type:"statuses",limit:N,offset:C.current});if((Fe=W==null?void 0:W.statuses)!=null&&Fe.length){const _=W.statuses.slice(0,kt);_.forEach(J=>{He(J,r)});const H=W.statuses.length<=kt;return{value:_,done:H}}else return{value:[],done:!0}}let he=[];if(ne){const{value:X}=await f.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(X!=null&&X.length&&!c&&!p){const ae=X.map(te=>(He(te,r),{...te,_pinned:!0}));if(ae.length>=3){const te=ae.map(Se=>Se.id);he.push({id:te,items:ae,type:"pinned"})}else he.push(...ae)}}(ne||!m.current)&&(m.current=f.v1.accounts.$select(n).statuses.list({limit:kt,exclude_replies:d,exclude_reblogs:u,only_media:p||void 0,tagged:c}));const{value:ke,done:Ee}=await m.current.next();if(ke!=null&&ke.length){if(he.length){let X=[];((xe=he[0])==null?void 0:xe.type)==="pinned"?X=he[0].id:X=he.filter(te=>te._pinned).map(te=>te.id),X.every(te=>ke.some(Se=>Se.id===te))&&(he=[])}he.push(...ke),ke.forEach(X=>{He(X,r)})}return{value:he,done:Ee}}const[j,M]=A([]);qe(g!=null&&g.acct?`${g!=null&&g.displayName?`${g.displayName} (${/@/.test(g.acct)?"":"@"}${g.acct})`:`${/@/.test(g.acct)?"":"@"}${g.acct}`}${d?u?" (- Boosts)":c?` (#${c})`:p?" (Media)":a?` (${new Date(a).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const ee=z(),Z=Qe(()=>{const ne=ee.current||f.v1.accounts.$select(n).fetch();return ee.current=ne,ne},[n,f]);G(()=>{(async()=>{try{const ne=await Z();b(ne)}catch{}if(!v)try{const ne=await f.v1.accounts.$select(n).featuredTags.list();M(ne)}catch{}})()},[n,v]);const{displayName:$,acct:P,emojis:L}=g||{},U=z(),V=pe(()=>{const ne=!d||u||c||p||!!a,me=t.accounts[`${n}@${r}`];return e(R,{children:[e(Rs,{instance:r,account:me||n,fetchAccount:Z,authenticated:h,standalone:!0}),!v&&e("div",{class:"filter-bar",ref:U,style:{position:"relative"},children:[ne?e(oe,{to:`/${r}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(oe,{to:`/${r}/a/${n}${d?"?replies=1":""}`,onClick:()=>{d&&se("Showing post with replies")},class:d?"":"is-active",children:"+ Replies"}),e(oe,{to:`/${r}/a/${n}${u?"":"?boosts=0"}`,onClick:()=>{u||se("Showing posts without boosts")},class:u?"is-active":"",children:"- Boosts"}),e(oe,{to:`/${r}/a/${n}${p?"":"?media=1"}`,onClick:()=>{p||se("Showing posts with media")},class:p?"is-active":"",children:"Media"}),j.map(ue=>e(oe,{to:`/${r}/a/${n}${c===ue.name?"":`?tagged=${encodeURIComponent(ue.name)}`}`,onClick:()=>{c!==ue.name&&se(`Showing posts tagged with #${ue.name}`)},class:c===ue.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),ue.name]})},ue.id)),x&&(Qo?e("label",{class:`filter-field ${a?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(g!=null&&g.acct),value:a||"",min:Jn,max:new Date().toISOString().slice(0,7),onInput:ue=>{const{value:he,validity:ke}=ue.currentTarget;if(!ke.valid)return;o(he?{month:he}:{});const[Ee,Te]=he.split("-"),Pe=parseInt(Te,10)-1,Fe=new Date(Ee,Pe);se(`Showing posts in ${Fe.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):e(sa,{class:`filter-field ${a?"is-active":""}`,disabled:!(g!=null&&g.acct),value:a||"",min:Jn,max:new Date().toISOString().slice(0,7),onInput:ue=>{const{value:he,validity:ke}=ue;ke.valid&&o(he?{month:he}:{})}}))]})]})},[n,r,h,j,Z,x,...k]);G(()=>{var me;const ne=(me=U.current)==null?void 0:me.querySelector(".is-active");ne&&U.current.scrollTo({behavior:"smooth",left:ne.offsetLeft-(U.current.offsetWidth-ne.offsetWidth)/2})},[j,x,...k]);const ye=pe(()=>g!=null&&g.url?new URL(g.url).hostname:null,[g]),fe=!!g&&!(r===ye);return e(dt,{title:`${g!=null&&g.acct?"@"+g.acct:"Posts"}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(vs,{text:$,emojis:L})}),e("div",{children:e("span",{children:["@",P]})})]}),id:"account-statuses",instance:r,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:Y,useItemID:!0,view:p||v?"media":void 0,boostsCarousel:t.settings.boostsCarousel,timelineStart:V,refresh:[d,u,c,p,a+(g==null?void 0:g.acct)].toString(),headerEnd:e(Je,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(de,{disabled:!fe,onClick:()=>{(async()=>{try{const{masto:ne}=Q({instance:ye}),me=await ne.v1.accounts.lookup({acct:g.acct}),{id:ue}=me;location.hash=`/${ye}/a/${ue}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance"," ",ye?e(R,{children:[" ","(",e("b",{children:xt.toUnicode(ye)}),")"]}):null]})]}),!I&&e(de,{onClick:()=>{(async()=>{try{const ne=await l.v1.accounts.lookup({acct:g.acct+"@"+r}),{id:me}=ne;location.hash=`/${y}/a/${me}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to my instance (",e("b",{children:y}),")"]})]})]})},n)}function sa(t){const{class:n,disabled:i,value:s,min:o,max:a,onInput:d=()=>{}}=t,[u,c]=(s==null?void 0:s.split("-"))||[],p=z(),f=z(),r=(h,l)=>{const[y,m]=(o==null?void 0:o.split("-"))||[],[k,g]=(a==null?void 0:a.split("-"))||[];return!(l<y||l>k||l===y&&h<m||l===k&&h>g)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:p,disabled:i,value:c||"",onInput:h=>{const{value:l}=h.currentTarget,y=f.current.value;if(!r(l,y))return{value:"",validity:{valid:!1}};d({value:l?`${y}-${l}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(h,l)=>e("option",{value:(l+1).toString().padStart(2,"0"),children:new Date(0,l).toLocaleString("default",{month:"long"})},l))]})," ",e("input",{ref:f,type:"number",disabled:i,value:u||new Date().getFullYear(),min:(o==null?void 0:o.slice(0,4))||Cn,max:(a==null?void 0:a.slice(0,4))||new Date().getFullYear(),onInput:h=>{const{value:l,validity:y}=h.currentTarget,m=p.current.value;if(!y.valid||!r(m,l))return{value:"",validity:{valid:!1}};d({value:l?`${l}-${m}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const ia=20;function Ns(){qe("Bookmarks","/b");const{masto:t,instance:n}=Q(),i=z();async function s(o){return(o||!i.current)&&(i.current=t.v1.bookmarks.list({limit:ia})),await i.current.next()}return e(dt,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:s})}const oa=""+new URL("catch-up-DuauQu-W.png",import.meta.url).href,aa="home",je=[{label:"last 1 hour",value:1},{label:"last 2 hours",value:2},{label:"last 3 hours",value:3},{label:"last 4 hours",value:4},{label:"last 5 hours",value:5},{label:"last 6 hours",value:6},{label:"last 7 hours",value:7},{label:"last 8 hours",value:8},{label:"last 9 hours",value:9},{label:"last 10 hours",value:10},{label:"last 11 hours",value:11},{label:"last 12 hours",value:12},{label:"beyond 12 hours",value:13}],ca=["Original","Replies","Boosts","Followed tags","Groups","Filtered"],ra=["createdAt","repliesCount","favouritesCount","reblogsCount","density"],la=[null,"account"],Xn={Filtered:"filtered",Groups:"group",Boosts:"boost",Replies:"reply","Followed tags":"followedTags",Original:"original"},da={Filtered:"filtered posts",Groups:"group posts",Boosts:"boosts",Replies:"replies","Followed tags":"followed-tag posts",Original:"original posts"},ua={createdAt:["oldest","latest"],repliesCount:["fewest replies","most replies"],favouritesCount:["fewest likes","most likes"],reblogsCount:["fewest boosts","most boosts"],density:["least dense","most dense"]};function ha(){qe("Catch-up","/catchup");const{masto:t,instance:n}=Q(),[i,s]=it(),o=i.get("id"),[a,d]=A("start"),[u,c]=A(!1),p=pe(()=>ct(),[]),f=S=>S===p,r=We("@pixelfed/home-include-reblogs");async function h({maxCreatedAt:S}){var K,ge,le;const D=S?new Date(S):null,B=[],O=t.v1.timelines.home.list({limit:40});e:for(;;)try{r&&O.nextParams&&(typeof O.nextParams=="string"?O.nextParams+="&include_reblogs=true":O.nextParams.include_reblogs=!0);const ie=await O.next(),{value:Ce}=ie;if(Ce!=null&&Ce.length){await Ps(Ce,n);let De=!1;for(let Oe=0;Oe<Ce.length;Oe++){const Le=Ce[Oe],Ve=new Date(Le.createdAt);if(!D||Ve>=D){const we=!f(((ge=(K=Le.reblog)==null?void 0:K.account)==null?void 0:ge.id)||Le.account.id)&&Mt(((le=Le.reblog)==null?void 0:le.filtered)||Le.filtered,aa);if((we==null?void 0:we.action)==="hide")continue;Le._filtered=we;const tt=Ke(Le.id,n);Le._followedTags=T.statusFollowedTags[tt]?[...T.statusFollowedTags[tt]]:[],B.push(Le),De=!0}if(!De)break e}}else break e;await new Promise(De=>setTimeout(De,1e3))}catch{break e}return B.forEach(ie=>{if(ie!=null&&ie.inReplyToId){const Ce=B.find(De=>De.id===ie.inReplyToId);Ce&&!Ce.inReplyToId&&(Ce._thread=!0)}}),B}const[l,y]=A([]),m=z(),k=z(),g=pe(()=>jt(),[]),b=Qe(async({duration:S}={})=>{const D=Date.now(),B=S?D-S:null;d("loading");const O=await h({maxCreatedAt:B}),K=`${g}-${ri()}`;try{await nt.catchup.set(K,{id:K,posts:O,count:O.length,startAt:B,endAt:D}),s({id:K})}catch{}},[]);G(()=>{o?(async()=>{const S=await nt.catchup.get(o);S&&(S.posts.sort((D,B)=>D.createdAt>B.createdAt?1:-1),y(S.posts),d("results"))})():a==="results"&&(y([]),d("start"))},[o]);const[C,v]=mt(S=>S+1,0),[I,x]=A(null),[E,Y]=A([]);G(()=>{(async()=>{try{const S=await nt.catchup.keys();if(S.length){const D=jt(),B=S.filter(O=>O.startsWith(`${D}-`));if(B.length){let O=await nt.catchup.getMany(B);O.sort((ie,Ce)=>Ce.endAt-ie.endAt);let K=O.slice(0,3),ge=O.slice(3);const le=K.map(ie=>{const{id:Ce,count:De,startAt:Oe,endAt:Le}=ie;return{id:Ce,count:De,startAt:Oe,endAt:Le}});Y(le),x(K[0].endAt),O=null,K=null,queueMicrotask(()=>{ge.length&&nt.catchup.delMany(ge.map(ie=>ie.id)).then(()=>{ge=null}).catch(ie=>{})});return}}}catch{}Y([])})()},[C]),G(()=>{a==="start"&&v()},[a==="start"]);const[j,M]=pe(()=>{var Ce,De,Oe,Le,Ve;let S=0,D=0,B=0,O=0,K=0,ge=0;const le={};for(const q of l){q._filtered?(S++,q.__FILTER="filtered"):q.group?(D++,q.__FILTER="group"):q.reblog?(B++,q.__FILTER="boost"):(Ce=q._followedTags)!=null&&Ce.length?(K++,q.__FILTER="followedTags"):q.inReplyToId&&q.inReplyToAccountId!==((De=q.account)==null?void 0:De.id)?(O++,q.__FILTER="reply"):(ge++,q.__FILTER="original");const we=q.reblog||q;if(q.__FILTER!=="filtered"&&((Oe=we.card)!=null&&Oe.url)&&((Le=we.card)!=null&&Le.image)&&((Ve=we.card)==null?void 0:Ve.type)==="link"){const{card:tt,favouritesCount:Nt,reblogsCount:pt}=we;let{url:Ye}=tt;if(Ye=Ye.replace(/\/$/,""),!le[Ye])le[Ye]={postID:we.id,card:tt,shared:1,sharers:[q.account],likes:Nt,boosts:pt};else{if(le[Ye].sharers.find(wt=>wt.id===q.account.id))continue;le[Ye].shared++,le[Ye].sharers.push(q.account),le[Ye].postID!==we.id&&(le[Ye].likes+=Nt,le[Ye].boosts+=pt)}}}let ie=[];for(const q in le)ie.push({url:q,...le[q]});if(ie.sort((q,we)=>q.shared>we.shared?-1:q.shared<we.shared?1:q.boosts>we.boosts?-1:q.boosts<we.boosts?1:q.likes>we.likes?-1:q.likes<we.likes?1:0),ie.length>10)e:for(let q=10;q<ie.length;q++){const{shared:we}=ie[q];if(we<=1){ie=ie.slice(0,q);break e}}return[{Filtered:S,Groups:D,Boosts:B,Replies:O,"Followed tags":K,Original:ge},ie]},[l]),[ee,Z]=A("All"),[$,P]=A(null),[L,U]=A(1),[V,ye]=A("createdAt"),[ve,fe]=A("asc"),[ne,me]=A(null),[ue,he,ke]=pe(()=>{const S={},D=new Map;let B=l.filter(K=>{const ge=ee==="All"||K.__FILTER===Xn[ee];return ge&&(S[K.account.id]=K.account,D.set(K.account.id,(D.get(K.account.id)||0)+1)),ge});const O={};return B.forEach(K=>{K.reblog&&(O[K.reblog.id]?(O[K.reblog.id].__BOOSTERS?O[K.reblog.id].__BOOSTERS.add(K.account):O[K.reblog.id].__BOOSTERS=new Set([K.account]),K.__HIDDEN=!0):O[K.reblog.id]=K)}),$&&D.has($)&&(B=B.filter(K=>K.account.id===$||[...K.__BOOSTERS||[]].find(ge=>ge.id===$))),[B,S,Object.fromEntries(D)]},[ee,$,l]),Ee=pe(()=>{const S={};return ue.forEach(D=>{S[D.id]=D}),S},[ue]),Te=pe(()=>Object.keys(ke).sort((S,D)=>ke[D]-ke[S]),[ke]),Pe=pe(()=>{const S={};return Te.forEach((D,B)=>{S[D]=B}),ue.filter(D=>!D.__HIDDEN).sort((D,B)=>{if(ne==="account"){const O=D.account.id,K=B.account.id,ge=S[O],le=S[K],ie=ge-le;if(ie!==0)return ie}if(V!=="createdAt"&&(D=D.reblog||D,B=B.reblog||B,V!=="density"&&D[V]===B[V]))return D.createdAt>B.createdAt?1:-1;if(V==="density"){const O=Zn(D),K=Zn(B);return ve==="asc"?O>K?1:-1:K>O?1:-1}return ve==="asc"?D[V]>B[V]?1:-1:B[V]>D[V]?1:-1})},[ue,V,ve,ne,Te]),Fe=z(null),xe=z(null),X=z(!1);G(()=>{l.length>100||X.current||xe.current&&(li(xe.current,{duration:200}),X.current=!0)},[l,xe]);const ae=l.length>160?"3d":"2d",te=pe(()=>ae!=="2d"?null:l.map(S=>{const D=Ee[S.id];return e("span",{class:`post-dot ${D?"post-dot-highlight":""}`},S.id)}),[Ee]),Se=pe(()=>ae!=="3d"||!(l!=null&&l.length)?null:va(l,"createdAt",320).map((D,B)=>e("div",{class:"posts-bin",children:D.map(O=>{const K=Ee[O.id];return e("span",{class:`post-dot ${K?"post-dot-highlight":""}`},O.id)})},B)),[Ee]),Ie=z(null),F=pe(()=>I?(Date.now()-I)/1e3/60/60:null,[I,L]);G(()=>{if(a!=="results")return;const S=$&&he[$]?he[$].username:"",D=ve==="asc"?0:1,B={account:"authors"};let O=se({duration:5e3,text:`Showing ${da[ee]||"all posts"}${S?` by @${S}`:""}, ${ua[V][D]} first${ne?`, grouped by ${ne==="account"?B[ne]:""}`:""}`});return()=>{var K;(K=O==null?void 0:O.hideToast)==null||K.call(O)}},[a,ee,$,V,ve,ne,he]),G(()=>{var S;if($&&he[$]){const D=xe.current.querySelector(`[data-author="${$}"]`),B=(S=xe.current)==null?void 0:S.getBoundingClientRect(),O=D==null?void 0:D.getBoundingClientRect();O.left<B.left||O.right>B.right?D.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}):O.top<0&&D.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}},[$,he]);const[re,N]=A(!1),W=".catchup-list > li > a",_=Re("j",()=>{const S=document.activeElement.closest(W),D=S==null?void 0:S.getBoundingClientRect(),B=Array.from(Ie.current.querySelectorAll(W));if(S&&D.top<Ie.current.clientHeight&&D.bottom>0){const O=B.indexOf(S),K=B[O+1];K&&(K.focus(),K.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const O=B.find(K=>K.getBoundingClientRect().top>=0);O&&(O.focus(),O.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),H=Re("k",()=>{const S=document.activeElement.closest(W),D=S==null?void 0:S.getBoundingClientRect(),B=Array.from(Ie.current.querySelectorAll(W));if(S&&D.top<Ie.current.clientHeight&&D.bottom>0){const O=B.indexOf(S);let K=B[O-1];K&&(K.focus(),K.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const O=B.find(K=>{const ge=K.getBoundingClientRect();return ge.top>=44&&ge.left>=0});O&&(O.focus(),O.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),J=Re("h, l",(S,D)=>{var O,K,ge;const B=D.keys[0];if($){const le=Te.indexOf($);B==="h"?le>0&&le<Te.length&&(P(Te[le-1]),(O=Ie.current)==null||O.focus()):B==="l"&&le<Te.length-1&&le>=0&&(P(Te[le+1]),(K=Ie.current)==null||K.focus())}else B==="l"&&(P(Te[0]),(ge=Ie.current)==null||ge.focus())},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]}),ce=Re("esc",()=>{var S;P(null),(S=Ie.current)==null||S.focus()},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]}),Ne=Re(".",()=>{var S;(S=Ie.current)==null||S.scrollTo({top:0,behavior:"smooth"})},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]});return e("div",{ref:S=>{Ie.current=S,_.current=S,H.current=S,J.current=S,ce.current=S},id:"catchup-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck wide",children:[e("header",{class:`${a==="loading"?"loading":""}`,onClick:S=>{var D;S.target.closest("a, button")||(D=Ie.current)==null||D.scrollTo({top:0,behavior:"smooth"})},children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(yt,{}),a==="results"&&e(oe,{to:"/catchup",class:"button plain",children:e(w,{icon:"history2",size:"l"})}),a==="start"&&e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:a!=="start"&&e(R,{children:["Catch-up ",e("sup",{children:"beta"})]})}),e("div",{class:"header-side",children:a!=="start"&&a!=="loading"&&e("button",{type:"button",class:"plain",onClick:()=>{N(!0)},children:"Help"})})]})}),e("main",{children:[a==="start"&&e("div",{class:"catchup-start",children:[e("h1",{children:["Catch-up ",e("sup",{children:"beta"})]}),e("details",{children:[e("summary",{children:"What is this?"}),e("p",{children:"Catch-up is a separate timeline for your followings, offering a high-level view at a glance, with a simple, email-inspired interface to effortlessly sort and filter through posts."}),e("img",{src:oa,width:"1200",height:"900",alt:"Preview of Catch-up UI"}),e("p",{children:e("button",{type:"button",onClick:S=>{S.target.closest("details").open=!1},children:"Let's catch up"})})]}),e("p",{children:"Let's catch up on the posts from your followings."}),e("p",{children:e("b",{children:"Show me all posts from…"})}),e("div",{class:"catchup-form",children:[e("input",{ref:m,type:"range",value:L,min:je[0].value,max:je[je.length-1].value,step:"1",list:"catchup-ranges",onChange:S=>U(+S.target.value)})," ",e("span",{style:{width:"8em"},children:[je[L-1].label,e("br",{}),e("small",{class:"insignificant",children:L==je[je.length-1].value?"until the max":ot(new Date(Date.now()-L*60*60*1e3))})]}),e("datalist",{id:"catchup-ranges",children:je.map(({label:S,value:D})=>e("option",{value:D,label:S}))})," ",e("button",{type:"button",onClick:()=>{var S;if(L<je[je.length-1].value){let D;L===je[je.length-1].value&&((S=k.current)!=null&&S.checked)?D=Date.now()-I:D=L*60*60*1e3,b({duration:D})}else b()},children:"Catch up"})]}),F&&L>F?e("p",{class:"catchup-info",children:[e(w,{icon:"info"})," Overlaps with your last catch-up"]}):L===je[je.length-1].value&&I?e("p",{class:"catchup-info",children:e("label",{children:[e("input",{type:"checkbox",switch:!0,checked:!0,ref:k})," ","Until the last catch-up (",Ft.format(new Date(I)),")"]})}):null,e("p",{class:"insignificant",children:e("small",{children:"Note: your instance might only show a maximum of 800 posts in the Home timeline regardless of the time range. Could be less or more."})}),!!(E!=null&&E.length)&&e("div",{class:"catchup-prev",children:[e("p",{children:"Previously…"}),e("ul",{children:E.map(S=>e("li",{children:[e(oe,{to:`/catchup?id=${S.id}`,children:[e(w,{icon:"history2"})," ",e("span",{children:S.startAt?Ft.formatRange(new Date(S.startAt),new Date(S.endAt)):`… – ${Ft.format(new Date(S.endAt))}`})]})," ",e("span",{children:[e("small",{class:"ib insignificant",children:[S.count," posts"]})," ",e("button",{type:"button",class:"light danger small",onClick:async()=>{var B;if(confirm("Remove this catch-up?")){let O=se(`Removing Catch-up ${S.id}`);await nt.catchup.del(S.id),(B=O==null?void 0:O.hideToast)==null||B.call(O),se(`Catch-up ${S.id} removed`),v()}},children:e(w,{icon:"x"})})]})]},S.id))}),E.length>=3&&e("p",{children:e("small",{children:"Note: Only max 3 will be stored. The rest will be automatically removed."})})]})]}),a==="loading"&&e("div",{class:"ui-state catchup-start",children:[e(Ae,{abrupt:!0}),e("p",{class:"insignificant",children:"Fetching posts…"}),e("p",{class:"insignificant",children:"This might take a while."})]}),a==="results"&&e(R,{children:[e("div",{class:"catchup-header",children:[l.length>0&&e("p",{children:e("b",{class:"ib",children:Ft.formatRange(new Date(l[0].createdAt),new Date(l[l.length-1].createdAt))})}),e("aside",{children:[e("button",{hidden:ee==="All"&&!$&&V==="createdAt"&&ve==="asc",type:"button",class:"plain4 small",onClick:()=>{Z("All"),P(null),ye("createdAt"),me(null),fe("asc")},children:"Reset filters"}),(M==null?void 0:M.length)>0&&e("button",{type:"button",class:"plain small",onClick:()=>c(!u),children:["Top links"," ",e(w,{icon:"chevron-down",style:{transform:u?"rotate(180deg)":"rotate(0deg)"}})]})]})]}),e("div",{class:"shazam-container no-animation",hidden:!u,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"catchup-top-links links-bar",children:M.map(S=>{const{card:D,shared:B,sharers:O,likes:K,boosts:ge}=S,{blurhash:le,title:ie,description:Ce,url:De,image:Oe,imageDescription:Le,language:Ve,width:q,height:we,publishedAt:tt}=D,Nt=xt.toUnicode(new URL(De).hostname.replace(/^www\./,"").replace(/\/$/,""));let pt;if(le){const Ye=fn(le),wt=Sn(Ye);pt=In([.6,wt[1],wt[2]])}return e("a",{href:De,target:"_blank",rel:"noopener noreferrer",style:pt?{"--accent-color":`rgb(${pt.join(",")})`,"--accent-alpha-color":`rgba(${pt.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:Oe,alt:Le,width:q,height:we,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:Nt})," ",!!tt&&e(R,{children:"· "}),!!tt&&e(R,{children:e(bt,{datetime:tt,format:"micro"})})]}),!!ie&&e("h1",{class:"title",lang:Ve,dir:"auto",title:ie,children:ie})]}),!!Ce&&e("p",{class:"description",lang:Ve,dir:"auto",title:Ce,children:Ce}),e("hr",{}),e("p",{style:{whiteSpace:"nowrap"},children:["Shared by"," ",O.map(Ye=>{const{avatarStatic:wt,displayName:Ws}=Ye;return e(st,{url:wt,size:"s",alt:Ws})})]})]})]})},De)})})})}),l.length>=5&&(ae==="3d"?e("div",{class:"catchup-posts-viz-time-bar",children:Se}):e("div",{class:"catchup-posts-viz-bar",children:te})),l.length>=2&&e("div",{class:"catchup-filters",children:[e("label",{class:"filter-cat",children:[e("input",{type:"radio",name:"filter-cat",checked:ee.toLowerCase()==="all",onChange:()=>{Z("All")}}),"All ",e("span",{class:"count",children:l.length})]}),ca.map(S=>!!j[S]&&e("label",{class:"filter-cat",title:(j[S]/l.length*100).toFixed(2)+"%",children:[e("input",{type:"radio",name:"filter-cat",checked:ee.toLowerCase()===S.toLowerCase(),onChange:()=>{Z(S)}}),S," ",e("span",{class:"count",children:j[S]})]},S))]}),l.length>=2&&!!ke&&e("div",{class:"catchup-filters authors-filters",ref:xe,children:[Te.map(S=>e("label",{class:"filter-author","data-author":S,children:[e("input",{type:"radio",name:"filter-author",checked:$===S,onChange:()=>{P(S)},onClick:()=>{$===S&&P(null)}}),e(st,{url:he[S].avatarStatic||he[S].avatar,size:"xxl",alt:`${he[S].displayName} (@${he[S].acct})`})," ",e("span",{class:"count",children:ke[S]}),e("span",{class:"username",children:he[S].username})]},`${S}-${ke[S]}`)),Te.length>5&&e("small",{style:{whiteSpace:"nowrap",paddingInline:"1em",opacity:.33},children:[Te.length," authors"]},"authors-count")]}),l.length>=2&&e("div",{class:"catchup-filters",children:[e("span",{class:"filter-label",children:"Sort"})," ",e("fieldset",{class:"radio-field-group",children:ra.map(S=>e("label",{class:"filter-sort",onClick:D=>{V===S&&(D.preventDefault(),D.stopPropagation(),fe(ve==="asc"?"desc":"asc"))},children:[e("input",{type:"radio",name:"filter-sort-cat",checked:V===S,onChange:()=>{ye(S);const D=/(replies|favourites|reblogs)/.test(S)?"desc":"asc";fe(D)}}),{createdAt:"Date",repliesCount:"Replies",favouritesCount:"Likes",reblogsCount:"Boosts",density:"Density"}[S],V===S&&(ve==="asc"?" ↑":" ↓")]},S))}),e("span",{class:"filter-label",children:"Group"})," ",e("fieldset",{class:"radio-field-group",children:la.map(S=>e("label",{class:"filter-group",children:[e("input",{type:"radio",name:"filter-group",checked:ne===S,onChange:()=>{me(S)},disabled:S==="account"&&$}),{account:"Authors"}[S]||"None"]},S||"none"))}),$&&Te.length>1?e("button",{type:"button",class:"plain6 small",onClick:()=>{P(null)},style:{whiteSpace:"nowrap"},children:"Show all authors"}):null]}),e("ul",{class:`catchup-list catchup-filter-${Xn[ee]||""} ${V?`catchup-sort-${V}`:""} ${$&&he[$]?"catchup-selected-author":""} ${ne?`catchup-group-${ne}`:""}`,children:Pe.map((S,D)=>{var K;const B=((K=S.reblog)==null?void 0:K.id)||S.id;let O=!1;return ne==="account"&&(Fe.current&&S.account.id!==Fe.current&&D>0&&(O=!0),Fe.current=S.account.id),e(R,{children:[O&&e("li",{class:"separator"}),e(fa,{to:`/${n}/s/${B}`,post:S,root:Ie.current})]},`${S.id}-${O}`)})}),e("footer",{children:ue.length>5&&e("p",{children:[ee==="Boosts"?"You don't have to read everything.":"That's all."," ",e("button",{type:"button",class:"textual",onClick:()=>{Ie.current.scrollTop=0},children:"Back to top"}),"."]})})]})]})]}),re&&e($e,{onClose:()=>N(!1),children:e("div",{class:"sheet",id:"catchup-help-sheet",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>N(!1),children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Help"})}),e("main",{children:e("dl",{children:[e("dt",{children:"Top links"}),e("dd",{children:"Links shared by followings, sorted by shared counts, boosts and likes."}),e("dt",{children:"Sort: Density"}),e("dd",{children:'Posts are sorted by information density or depth. Shorter posts are "lighter" while longer posts are "heavier". Posts with photos are "heavier" than posts without photos.'}),e("dt",{children:"Group: Authors"}),e("dd",{children:"Posts are grouped by authors, sorted by posts count per author."}),e("dt",{children:"Keyboard shortcuts"}),e("dd",{children:[e("kbd",{children:"j"}),": Next post"]}),e("dd",{children:[e("kbd",{children:"k"}),": Previous post"]}),e("dd",{children:[e("kbd",{children:"l"}),": Next author"]}),e("dd",{children:[e("kbd",{children:"h"}),": Previous author"]}),e("dd",{children:[e("kbd",{children:"Enter"}),": Open post details"]}),e("dd",{children:[e("kbd",{children:"."}),": Scroll to top"]})]})})]})})]})}const pa=Xe(function({post:t}){const{id:n,account:i,group:s,reblog:o,inReplyToId:a,inReplyToAccountId:d,_followedTags:u,_filtered:c,visibility:p,__BOOSTERS:f}=t,r=a&&d!==i.id,h=!!c,l=y=>{y.shiftKey};return e("article",{class:`post-line ${s?"group":o?"reblog":u!=null&&u.length?"followed-tags":""} ${r?"reply-to":""} ${h?"filtered":""} visibility-${p}`,onMouseEnter:l,children:[e("span",{class:"post-author",children:o?e("span",{class:"post-reblog-avatar",children:[e(st,{url:i.avatarStatic||i.avatar,squircle:i.bot}),(f==null?void 0:f.size)>0?[...f].map(y=>e(st,{url:y.avatarStatic||y.avatar,squircle:y.bot})):""," ",e(w,{icon:"rocket"})," ",e(It,{account:o.account,showAvatar:!0})]}):e(It,{account:i,showAvatar:!0})}),e(ba,{post:o||t,filterInfo:c}),e("span",{class:"post-meta",children:[e(ya,{post:o||t})," ",e(bt,{datetime:new Date((o==null?void 0:o.createdAt)||t.createdAt),format:"micro"})]})]})},(t,n)=>{var i,s;return((i=t==null?void 0:t.post)==null?void 0:i.id)===((s=n==null?void 0:n.post)==null?void 0:s.id)}),fa=({root:t,to:n,...i})=>{const s=z(),[o,a]=A(!1);return G(()=>{const d=new IntersectionObserver(u=>{u[0].isIntersecting&&(queueMicrotask(()=>a(!0)),d.unobserve(s.current))},{root:t,rootMargin:`${Math.max(320,screen.height*.75)}px`});return s.current&&d.observe(s.current),()=>{s.current&&d.unobserve(s.current)}},[]),o?e("li",{children:e(oe,{to:n,children:e(pa,{...i})})}):e("li",{ref:s,style:{height:"4em"}})},ma=8,ga=8;function Zn(t){var c;const{spoilerText:n,content:i,poll:s,mediaAttachments:o,card:a}=t,d=(c=s==null?void 0:s.options)!=null&&c.length?s.options.reduce((p,f)=>p+f.title,""):"";return(n.length+Cs(i)+d.length)/140+(o!=null&&o.length?ma*o.length:a!=null&&a.image?ga:0)}const ut=48;function ba({post:t,filterInfo:n}){var b;const{spoilerText:i,sensitive:s,content:o,emojis:a,poll:d,mediaAttachments:u,card:c,inReplyToId:p,inReplyToAccountId:f,account:r,_thread:h}=t,l=p&&f===r.id||!!h,y=pe(()=>!!(be.account.get("preferences")||{})["reading:expand:spoilers"],[]),m=y||!i&&!s,k=o?yn(t):"",g=!i||y;return e("div",{class:"post-peek",title:i?"":k,children:[e("span",{class:"post-peek-content",children:[l&&!g&&e(R,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),n?e("span",{class:"post-peek-filtered",children:["Filtered",n!=null&&n.titlesStr?`: ${n.titlesStr}`:""]}):e(R,{children:[!!i&&e("span",{class:"post-peek-spoiler",children:[e(w,{icon:`${y?"eye-open":"eye-close"}`})," ",i]}),g&&e("div",{class:"post-peek-html",children:[l&&e(R,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),!!o&&e("div",{dangerouslySetInnerHTML:{__html:Ti(o,a)}}),!!((b=d==null?void 0:d.options)!=null&&b.length)&&d.options.map(C=>e("div",{children:[d.multiple?"▪️":"•"," ",C.title]})),!o&&(u==null?void 0:u.length)===1&&u[0].description&&e(R,{children:[e("span",{class:"post-peek-tag post-peek-alt",children:"ALT"})," ",e("div",{children:u[0].description})]})]})]})]}),!n&&e("span",{class:"post-peek-post-content",children:[!!d&&e("span",{class:"post-peek-tag post-peek-poll",children:[e(w,{icon:"poll",size:"s"}),"Poll"]}),u!=null&&u.length?u.map(C=>{const v=C.previewUrl||C.url,I=C.previewRemoteUrl||C.remoteUrl;return e("span",{class:"post-peek-media",children:{image:(v||I)&&m?e("img",{src:v,width:ut,height:ut,alt:C.description,loading:"lazy",onError:x=>{const{src:E}=x.target;E===v&&(x.target.src=I)}}):e("span",{class:"post-peek-faux-media",children:"🖼"}),gifv:(v||I)&&m?e("img",{src:v,width:ut,height:ut,alt:C.description,loading:"lazy",onError:x=>{const{src:E}=x.target;E===v&&(x.target.src=I)}}):e("span",{class:"post-peek-faux-media",children:"🎞️"}),video:(v||I)&&m?e("img",{src:v,width:ut,height:ut,alt:C.description,loading:"lazy",onError:x=>{const{src:E}=x.target;E===v&&(x.target.src=I)}}):e("span",{class:"post-peek-faux-media",children:"📹"}),audio:e("span",{class:"post-peek-faux-media",children:"🎵"})}[C.type]||null},C.id)}):!!c&&c.image&&m&&e("span",{class:`post-peek-media post-peek-card card-${c.type||""}`,children:c.image?e("img",{src:c.image,width:ut,height:ut,alt:c.title||c.description||c.imageDescription,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"🔗"})})]})]})}function ya({post:t}){const{reblogsCount:n,repliesCount:i,favouritesCount:s}=t;return e("span",{class:"post-stats",children:[i>0&&e("span",{class:"post-stat-replies",children:[e(w,{icon:"comment2",size:"s"})," ",Ge(i)]}),s>0&&e("span",{class:"post-stat-likes",children:[e(w,{icon:"heart",size:"s"})," ",Ge(s)]}),n>0&&e("span",{class:"post-stat-boosts",children:[e(w,{icon:"rocket",size:"s"})," ",Ge(n)]})]})}const{locale:wa}=new Intl.DateTimeFormat().resolvedOptions(),Ft=new Intl.DateTimeFormat(wa,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"});function va(t,n,i){const s=t.map(c=>new Date(c[n])),o=s.reduce((c,p)=>p<c?p:c,s[0]),d=s.reduce((c,p)=>p>c?p:c,s[0]).getTime()-o.getTime(),u=Array.from({length:i},()=>[]);return t.forEach(c=>{const f=(new Date(c[n]).getTime()-o.getTime())/d,r=Math.floor(f*(i-1));u[r].push(c)}),u}const ka=20;function Ds(){qe("Likes","/f");const{masto:t,instance:n}=Q(),i=z();async function s(o){return(o||!i.current)&&(i.current=t.v1.favourites.list({limit:ka})),await i.current.next()}return e(dt,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:s})}const Sa=["home","public","notifications","thread","account"],Qn=["notifications","thread","account"],Ia={home:"Home and lists",notifications:"Notifications",public:"Public timelines",thread:"Conversations",account:"Profiles"},Ca=[0,30*60,60*60,6*60*60,12*60*60,60*60*24,60*60*24*7,60*60*24*30],Ta={0:"Never",1800:"30 minutes",3600:"1 hour",21600:"6 hours",43200:"12 hours",86400:"24 hours",604800:"7 days",2592e3:"30 days"};function xa(){const{masto:t}=Q();qe("Filters","/ft");const[n,i]=A("default"),[s,o]=A(!1),[a,d]=mt(p=>p+1,0),[u,c]=A([]);return G(()=>{i("loading"),(async()=>{try{const p=await t.v2.filters.list();p.sort((f,r)=>f.title.localeCompare(r.title)),p.forEach(f=>{var r;(r=f.keywords)!=null&&r.length&&f.keywords.sort((h,l)=>h.id-l.id)}),c(p),i("default")}catch{i("error")}})()},[a]),e("div",{id:"filters-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(yt,{}),e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Filters"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{o(!0)},children:e(w,{icon:"plus",size:"l",alt:"New filter"})})})]})}),e("main",{children:u.length>0?e(R,{children:[e("ul",{class:"filters-list",children:u.map(p=>{const{id:f,title:r,expiresAt:h,keywords:l}=p;return e("li",{children:[e("div",{children:[e("h2",{children:r}),(l==null?void 0:l.length)>0&&e("div",{children:l.map(y=>e(R,{children:[e("span",{class:"tag collapsed insignificant",children:y.wholeWord?`“${y.keyword}”`:y.keyword})," "]}))}),e("small",{class:"insignificant",children:e(Us,{expiresAt:h})})]}),e("button",{type:"button",class:"plain",onClick:()=>{o({filter:p})},children:e(w,{icon:"pencil",size:"l",alt:"Edit filter"})})]},f)})}),u.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[u.length," filter",u.length===1?"":"s"]})})]}):n==="loading"?e("p",{class:"ui-state",children:e(Ae,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load filters."}):e("p",{class:"ui-state",children:"No filters yet."})})]}),!!s&&e($e,{title:"Add filter",onClose:()=>{o(!1)},children:e(_a,{filter:s==null?void 0:s.filter,onClose:p=>{p.state==="success"&&d(),o(!1)}})})]})}let Aa=1;const $a=()=>Aa++;function _a({filter:t,onClose:n}){const{masto:i}=Q(),[s,o]=A("default"),a=!!t,{context:d,expiresAt:u,id:c,keywords:p,title:f,filterAction:r}=t||{},h=!!u,l=h&&new Date(u),[y,m]=A(p||[]),k=z(),[g,b]=A([]),[C,v]=A([]),I=y.filter(x=>!g.includes(x.id)&&!C.includes(x._id));return e("div",{class:"sheet",id:"filters-add-edit-modal",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:a?"Edit filter":"New filter"})}),e("main",{children:e("form",{onSubmit:x=>{x.preventDefault();const E=new FormData(x.target),Y=E.get("title"),j=E.getAll("keyword_attributes[][id]"),M=E.getAll("keyword_attributes[][keyword]"),ee=[...k.current.querySelectorAll('input[name="keyword_attributes[][whole_word]"]')].map(U=>U.checked),Z=M.map((U,V)=>({id:j[V]||void 0,keyword:U,wholeWord:ee[V]}));a&&(g!=null&&g.length)&&g.forEach(U=>{Z.push({id:U,_destroy:!0})});const $=E.getAll("context");let P=E.get("expires_in");const L=E.get("filter_action");!Y||!($!=null&&$.length)||(o("loading"),(async()=>{try{let U;a?(P===""||P===null?h?P=Math.floor((l-new Date)/1e3):P=null:P==="0"||P===0?P=null:P=+P,U=await i.v2.filters.$select(c).update({title:Y,context:$,expiresIn:P,keywordsAttributes:Z,filterAction:L})):(P=+P||null,U=await i.v2.filters.create({title:Y,context:$,expiresIn:P,keywordsAttributes:Z,filterAction:L})),o("default"),n==null||n({state:"success",filter:U})}catch{o("error"),alert(a?"Unable to edit filter":"Unable to create filter")}})())},children:[e("div",{class:"filter-form-row",children:e("label",{children:[e("b",{children:"Title"}),e("input",{type:"text",name:"title",defaultValue:f,disabled:s==="loading",dir:"auto",required:!0})]})}),e("div",{class:"filter-form-keywords",ref:k,children:[I.length?e("ul",{class:"filter-keywords",children:I.map(x=>{const{id:E,keyword:Y,wholeWord:j,_id:M}=x;return e("li",{children:[e("input",{type:"hidden",name:"keyword_attributes[][id]",value:E}),e("input",{name:"keyword_attributes[][keyword]",type:"text",defaultValue:Y,disabled:s==="loading",required:!0}),e("div",{class:"filter-keyword-actions",children:[e("label",{children:[e("input",{name:"keyword_attributes[][whole_word]",type:"checkbox",value:E,defaultChecked:j,disabled:s==="loading"})," ","Whole word"]}),e("button",{type:"button",class:"light danger small",disabled:s==="loading",onClick:()=>{E?(g.push(E),b([...g])):M&&(C.push(M),v([...C]))},children:e(w,{icon:"x"})})]})]},`${E}-${M}`)})}):e("div",{class:"filter-keywords",children:e("div",{class:"insignificant",children:"No keywords. Add one."})}),e("footer",{class:"filter-keywords-footer",children:[e("button",{type:"button",class:"light",onClick:()=>{m([...y,{_id:$a(),keyword:"",wholeWord:!0}]),setTimeout(()=>{var E,Y;const x=k.current.querySelectorAll('input[type="text"]');(Y=(E=x[x.length-1])==null?void 0:E.focus)==null||Y.call(E)},10)},children:"Add keyword"})," ",(I==null?void 0:I.length)>1&&e("small",{class:"insignificant",children:[I.length," keyword",I.length===1?"":"s"]})]})]}),e("div",{class:"filter-form-cols",children:[e("div",{class:"filter-form-col",children:[e("div",{children:e("b",{children:"Filter from…"})}),Sa.map(x=>e("div",{children:[e("label",{class:Qn.includes(x)?"insignificant":"",children:[e("input",{type:"checkbox",name:"context",value:x,defaultChecked:d?d.includes(x):!0,disabled:s==="loading"})," ",Ia[x],Qn.includes(x)?"*":""]})," "]})),e("p",{children:e("small",{class:"insignificant",children:"* Not implemented yet"})})]}),e("div",{class:"filter-form-col",children:[a&&e(R,{children:["Status:"," ",e("b",{children:e(Us,{expiresAt:u,showNeverExpires:!0})})]}),e("div",{children:[e("label",{for:"filters-expires_in",children:a?"Change expiry":"Expiry"}),e("select",{id:"filters-expires_in",name:"expires_in",disabled:s==="loading",defaultValue:a?void 0:0,children:[a&&e("option",{}),Ca.map(x=>e("option",{value:x,children:Ta[x]}))]})]}),e("p",{children:["Filtered post will be…",e("br",{}),e("label",{class:"ib",children:[e("input",{type:"radio",name:"filter_action",value:"warn",defaultChecked:r==="warn"||!a,disabled:s==="loading"})," ","minimized"]})," ",e("label",{class:"ib",children:[e("input",{type:"radio",name:"filter_action",value:"hide",defaultChecked:r==="hide",disabled:s==="loading"})," ","hidden"]})]})]})]}),e("footer",{class:"filter-form-footer",children:[e("span",{children:[e("button",{type:"submit",disabled:s==="loading",children:a?"Save":"Create"})," ",e(Ae,{abrupt:!0,hidden:s!=="loading"})]}),a&&e(et,{disabled:s==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this filter?",onClick:()=>{o("loading"),(async()=>{try{await i.v2.filters.$select(c).remove(),o("default"),n==null||n({state:"success"})}catch{o("error"),alert("Unable to delete filter.")}})()},children:e("button",{type:"button",class:"light danger",onClick:()=>{},disabled:s==="loading",children:"Delete…"})})]})]})})]})}function Us({expiresAt:t,showNeverExpires:n}){const i=!!t,s=i&&new Date(t),o=i&&s<=new Date,[a,d]=mt(u=>u+1,0);return gn(d,o||3e4),o?"Expired":i?e(R,{children:["Expiring ",e(bt,{datetime:s})]}):n&&"Never expires"}function Ra(){const{masto:t,instance:n}=Q();qe("Followed Hashtags","/fh");const[i,s]=A("default"),[o,a]=A([]);return G(()=>{s("loading"),(async()=>{try{const d=await Kt();a(d),s("default")}catch{s("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(yt,{}),e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:o.length>0?e(R,{children:[e("ul",{class:"link-list",children:o.map(d=>e("li",{children:e(oe,{to:n?`/${n}/t/${d.name}`:`/t/${d.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:d.name})]})}))}),o.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[o.length," hashtag",o.length===1?"":"s"]})})]}):i==="loading"?e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}):i==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const Ea=20;function Tn({title:t,path:n,id:i,...s}){qe(t||"Following",n||"/following");const{masto:o,streaming:a,instance:d}=Q(),u=Me(T),c=z(),p=z(),f=We("@pixelfed/home-include-reblogs");async function r(l){var k;(l||!c.current)&&(c.current=o.v1.timelines.home.list({limit:Ea})),f&&((k=c.current)!=null&&k.nextParams)&&(typeof c.current.nextParams=="string"?c.current.nextParams+="&include_reblogs=true":c.current.nextParams.include_reblogs=!0);const y=await c.current.next();let{value:m}=y;if(m!=null&&m.length){let g=!1;l&&(m[0].id!==p.current&&(g=!0),p.current=m[0].id),m.forEach(b=>{He(b,d)}),m=Wn(m,d),l&&g&&Vo(),Ps(m,d),m.sort((b,C)=>{const v=new Date(b.createdAt);return new Date(C.createdAt)-v})}return{...y,value:m}}async function h(){var l;try{const y={limit:5,since_id:p.current};We("@pixelfed/home-include-reblogs")&&(y.include_reblogs=!0);const m=await o.v1.timelines.home.list(y).next();let{value:k}=m;const g=((l=k[0])==null?void 0:l.id)===p.current;return!!(k!=null&&k.length&&!g&&(p.current=k[0].id,k=Wn(k,d),k=At(k,"home"),k.some(b=>!b.reblog)))}catch{return!1}}return G(()=>{let l;return(async()=>{if(a){l=a.user.subscribe();for await(const y of l){if(!l)break;if(y.event==="status.update"){const m=y.payload;He(m,d)}else if(y.event==="delete"){const m=y.payload,k=hs(m,d);k&&(k._deleted=!0)}}}})(),()=>{var y;(y=l==null?void 0:l.unsubscribe)==null||y.call(l),l=null}},[a]),e(dt,{title:t||"Following",id:i||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:d,fetchItems:r,checkForUpdates:h,useItemID:!0,boostsCarousel:u.settings.boostsCarousel,...s,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const La=20,Ma=4,es=Ma+1;function Fs({media:t,columnMode:n,...i}){let{hashtag:s,...o}=n?{}:gt();i.hashtag&&(s=i.hashtag);let a=s.trim().split(/[\s+]+/);a.sort(),s=a[0];const[d,u]=it(),c=t||!!d.get("media"),p=c?"?media=1":"",{masto:f,instance:r,authenticated:h}=Q({instance:(i==null?void 0:i.instance)||o.instance}),{masto:l,instance:y,authenticated:m}=Q(),k=a.map($=>`#${$}`).join(" "),g=c?" (Media only)":"",b=r?`${k}${g} on ${r}`:`${k}${g}`;qe(b,"/:instance?/t/:hashtag");const C=z(),v=pe(()=>hn(),[]),I=z(void 0);async function x($){const P=await f.v1.timelines.tag.$select(s).list({limit:La,any:a.slice(1),maxId:$?void 0:I.current,onlyMedia:c?!0:void 0}).next();let{value:L}=P;return L!=null&&L.length&&($&&(C.current=L[0].id),L.forEach(U=>{He(U,r,{skipThreading:c||v})}),I.current=L[L.length-1].id),{...P,value:L}}async function E(){var $;try{const P=await f.v1.timelines.tag.$select(s).list({limit:1,any:a.slice(1),since_id:C.current,onlyMedia:c}).next();let{value:L}=P;const U=(($=L[0])==null?void 0:$.id)===C.current;return L!=null&&L.length&&!U?(L=At(L,"public"),!0):!1}catch{return!1}}const[Y,j]=A("default"),[M,ee]=A();G(()=>{(async()=>{try{const $=await f.v1.tags.$select(s).fetch();ee($)}catch{}})()},[s]);const Z=a.length>=es;return e(dt,{title:b,titleComponent:!!r&&e("h1",{class:"header-double-lines",children:[e("b",{children:k}),e("div",{children:r})]}),id:"hashtag",instance:r,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:x,checkForUpdates:E,useItemID:!0,view:c||v?"media":void 0,refresh:c,filterContext:"public",headerEnd:e(Je,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!M&&a.length===1&&e(R,{children:[e(et,{subMenu:!0,confirm:M.following,confirmLabel:`Unfollow #${s}?`,disabled:Y==="loading"||!h,onClick:()=>{j("loading"),M.following?f.v1.tags.$select(s).unfollow().then(()=>{ee({...M,following:!1}),se(`Unfollowed #${s}`)}).catch($=>{alert($)}).finally(()=>{j("default")}):f.v1.tags.$select(s).follow().then(()=>{ee({...M,following:!0}),se(`Followed #${s}`)}).catch($=>{alert($)}).finally(()=>{j("default")})},children:M.following?e(R,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(R,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(ze,{})]}),!v&&e(R,{children:[e(gs,{className:"plain",children:"Filters"}),e(de,{type:"checkbox",checked:!!c,onClick:()=>{c?d.delete("media"):d.set("media","1"),u(d)},children:[e(w,{icon:"check-circle"})," ",e("span",{class:"menu-grow",children:"Media only"})]}),e(ze,{})]}),e(di,{className:"menu-field",disabled:Z,children:({ref:$})=>e("form",{onSubmit:P=>{var U,V;P.preventDefault();const L=(V=(U=P.target[0].value)==null?void 0:U.trim)==null?void 0:V.call(U);L&&!a.some(ye=>ye.toLowerCase()===L.toLowerCase())&&(a.push(L),a.sort(),location.hash=r?`/${r}/t/${a.join("+")}`:`/t/${a.join("+")}${p}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:$,type:"text",placeholder:Z?`Max ${es} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:Z})]})}),e(ui,{takeOverflow:!0,children:a.map(($,P)=>e(de,{disabled:a.length===1,onClick:L=>{a.splice(P,1),a.sort(),location.hash=r?`/${r}/t/${a.join("+")}${p}`:`/t/${a.join("+")}${p}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),$]})]},$))}),e(ze,{}),e(de,{disabled:!m,onClick:()=>{if(T.shortcuts.length>=at){alert(`Max ${at} shortcuts reached. Unable to add shortcut.`);return}const $={type:"hashtag",hashtag:a.join(" "),instance:r,media:c?"on":void 0};T.shortcuts.some(L=>L.type===$.type&&L.hashtag.split(/[\s+]+/).sort().join(" ")===$.hashtag.split(/[\s+]+/).sort().join(" ")&&(L.instance?L.instance===$.instance:!0)&&(L.media?!!L.media==!!$.media:!0))?alert("This shortcut already exists"):(T.shortcuts.push($),se("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(de,{onClick:()=>{let $=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test($)){$&&alert("Invalid instance");return}$&&($=$.toLowerCase().trim(),location.hash=`/${$}/t/${a.join("+")}${p}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),y!==r&&e(de,{onClick:()=>{location.hash=`/${y}/t/${a.join("+")}${p}`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:y}),")"]})]})]})},r+k)}const Pa=20;function Os(t){var g;const n=Me(T),{masto:i,instance:s}=Q(),o=(t==null?void 0:t.id)||((g=gt())==null?void 0:g.id),a=z(),d=z();async function u(b){(b||!d.current)&&(d.current=i.v1.timelines.list.$select(o).list({limit:Pa}));const C=await d.current.next();let{value:v}=C;return v!=null&&v.length&&(b&&(a.current=v[0].id),v.forEach(I=>{He(I,s)})),{...C,value:v}}async function c(){var b;try{const C=await i.v1.timelines.list.$select(o).list({limit:1,since_id:a.current});let{value:v}=C;const I=((b=v[0])==null?void 0:b.id)===a.current;return v!=null&&v.length&&!I?(v=At(v,"home"),!0):!1}catch{return!1}}const[p,f]=A([]);G(()=>{Pt().then(f)},[]);const[r,h]=A({title:"List"});qe(r.title,"/l/:id"),G(()=>{(async()=>{try{const b=await $s(o);h(b)}catch{}})()},[o]);const[l,y]=A(!1),[m,k]=A(!1);return e(R,{children:[e(dt,{title:r.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:s,fetchItems:u,checkForUpdates:c,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:e(Je,{overflow:"auto",menuButton:e("button",{type:"button",class:"plain",children:[e(w,{icon:"list",size:"l",alt:"Lists"}),e(w,{icon:"chevron-down",size:"s"})]}),children:[e(_e,{to:"/l",children:e("span",{children:"All Lists"})}),(p==null?void 0:p.length)>0&&e(R,{children:[e(ze,{}),p.map(b=>e(_e,{to:`/l/${b.id}`,children:e("span",{children:b.title})},b.id))]})]}),headerEnd:e(Je,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(de,{onClick:()=>y({list:r}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(de,{onClick:()=>k(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},o),l&&e($e,{onClick:b=>{b.target===b.currentTarget&&y(!1)},children:e(kn,{list:l==null?void 0:l.list,onClose:b=>{b.state==="success"&&b.list?h(b.list):b.state==="deleted"&&(location.hash="/l"),y(!1)}})}),m&&e($e,{onClick:b=>{b.target===b.currentTarget&&k(!1)},children:e(Da,{listID:o,onClose:()=>k(!1)})})]})}const Na=40;function Da({listID:t,onClose:n}){const{masto:i,instance:s}=Q(),[o,a]=A([]),[d,u]=A("default"),[c,p]=A(!1),f=z();async function r(h){p(!1),u("loading"),(async()=>{try{(h||!f.current)&&(f.current=i.v1.lists.$select(t).accounts.list({limit:Na}));const l=await f.current.next();let{done:y,value:m}=l;m!=null&&m.length?(a(h?m:o.concat(m)),p(!y)):p(!1),u("default")}catch{u("error")}})()}return G(()=>{r(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[o.map(h=>e("li",{children:[e(Ze,{account:h,instance:s}),e(Ua,{account:h,listID:t})]},h.id)),c&&d==="default"&&e(rt,{as:"li",onChange:h=>h&&r(),children:e("button",{type:"button",class:"light block",onClick:r,children:"Show more…"})})]})})]})}function Ua({account:t,listID:n}){const{masto:i}=Q(),[s,o]=A("default"),[a,d]=A(!1);return e(et,{confirm:!a,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{a?(o("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),o("default"),d(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),o("default"),d(!0)}catch{o("error")}})())},children:e("button",{type:"button",class:`light ${a?"":"danger"}`,disabled:s==="loading",children:a?"Add":"Remove…"})})}const Fa={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function zs(t){return t.filter(n=>{const{type:i,id:s,createdAt:o}=n;if(!i)return!1;const a=Fa[i];return a!=null&&a.length?a.every(d=>!!n[d]):!0})}function Bs(t){t=zs(t);const n={},i=[];for(let a=0,d=0;a<t.length;a++){const u=t[a],{id:c,status:p,account:f,type:r,createdAt:h}=u,l=h?new Date(h).toLocaleDateString():"";let y=r;(r==="favourite"||r==="reblog")&&(y="favourite+reblog");const m=`${p==null?void 0:p.id}-${y}-${l}`,k=n[m];if(y==="follow_request")i[d++]=u;else if(k!=null&&k.account){const g=k._accounts.find(b=>b.id===f.id);g?(g._types.push(r),g._types.sort().reverse(),k.id+=`-${c}`):(f._types=[r],k._accounts.push(f),k.id+=`-${c}`)}else{f&&(f._types=[r]);let g=n[m]={...u,type:y,_accounts:f?[f]:[]};i[d++]=g}}const s={},o=[];for(let a=0,d=0;a<i.length;a++){const u=i[a],{id:c,account:p,_accounts:f,type:r,createdAt:h}=u,l=h?new Date(h).toLocaleDateString():"";if(r==="favourite+reblog"&&p&&f.length===1){const y=`${p==null?void 0:p.id}-${r}-${l}`,m=s[y];if(m)m._statuses.push(u.status),m.id+=`-${c}`;else{let k=s[y]={...u,type:r,_statuses:[u.status]};o[d++]=k}}else o[d++]=u}return o}const ts=20,Oa=new URLSearchParams;function Hs({columnMode:t,...n}){const{masto:i,instance:s}=Q(),[o]=t?[Oa]:it(),[a,d]=A(null),u=(n==null?void 0:n.type)||o.get("type")||a;qe(`Mentions${u==="private"?" (Private)":""}`,"/mentions");const c=z(),p=z();async function f(g){(g||!c.current)&&(c.current=i.v1.notifications.list({limit:ts,types:["mention"]}));const b=await c.current.next();let{value:C}=b;return C!=null&&C.length&&(C=zs(C),g&&(p.current=C[0].id),C.forEach(({status:v})=>{He(v,s)})),{...b,value:C==null?void 0:C.map(v=>v.status)}}const r=z(),h=z();async function l(g){(g||!r.current)&&(r.current=i.v1.conversations.list({limit:ts}));const b=await r.current.next();let{value:C}=b;return C=C==null?void 0:C.filter(v=>v.lastStatus),C!=null&&C.length&&(g&&(h.current=C[0].lastStatus.id),C.forEach(({lastStatus:v})=>{He(v,s)})),{...b,value:C==null?void 0:C.map(v=>v.lastStatus)}}function y(...g){return u==="private"?l(...g):f(...g)}async function m(){var g;if(u==="private")try{const b=await i.v1.conversations.list({limit:1,since_id:h.current}).next();let{value:C}=b;const v=((g=C[0])==null?void 0:g.id)===h.current;return C!=null&&C.length&&!v?(h.current=C[0].lastStatus.id,!0):!1}catch{return!1}else try{const b=await i.v1.notifications.list({limit:1,types:["mention"],since_id:p.current}).next();let{value:C}=b;return C!=null&&C.length?(p.current=C[0].id,!0):!1}catch{return!1}}const k=pe(()=>e("div",{class:"filter-bar centered",children:[e(oe,{to:"/mentions",class:u?"":"is-active",onClick:g=>{t&&(g.preventDefault(),d(null))},children:"All"}),e(oe,{to:"/mentions?type=private",class:u==="private"?"is-active":"",onClick:g=>{t&&(g.preventDefault(),d("private"))},children:"Private"})]}),[u]);return e(dt,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:s,fetchItems:y,checkForUpdates:m,useItemID:!0,timelineStart:k,refresh:u})}const za=80,Ba=new URLSearchParams,Ot={block:"center",inline:"center",behavior:"smooth"};function Ha({columnMode:t}){var re;qe("Notifications","/notifications");const{masto:n,instance:i}=Q(),s=Me(T),[o,a]=A("default"),[d]=t?[Ba]:it(),u=d.get("id"),c=d.get("access_token"),[p,f]=A(!1),[r,h]=A(!1),l=z(),{nearReachEnd:y,scrollDirection:m,reachStart:k,nearReachStart:g}=Go({scrollableRef:l}),b=m==="end"&&!g,[C,v]=A([]),[I,x]=A([]),E=z();async function Y(N){var H;if((N||!E.current)&&(E.current=n.v1.notifications.list({limit:za,excludeTypes:["follow_request"]})),/max_id=($|&)/i.test((H=E.current)==null?void 0:H.nextParams))return{done:!0};const W=await E.current.next(),_=W.value;if(_!=null&&_.length){_.forEach(ce=>{He(ce.status,i,{skipThreading:!0})});const J=Bs(_);N?(T.notificationsLast=_[0],T.notifications=J,n.v1.markers.create({notifications:{lastReadId:_[0].id}}).catch(()=>{})):T.notifications.push(...J)}return T.notificationsShowNew=!1,T.notificationsLastFetchTime=Date.now(),W}async function j(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const M=()=>{a("loading"),(async()=>{try{const N=await j();v(N),a("default")}catch{a("error")}})()};async function ee(){try{return await n.v1.announcements.list()}catch{return[]}}const Z=We("@mastodon/filtered-notifications"),[$,P]=A(!1),[L,U]=A({});function V(){return n.v1.notifications.policy.fetch().catch(()=>{})}function ye(){V().then(N=>{U(N)}).catch(()=>{})}const[ve,fe]=A(null);function ne(){return n.v1.notifications.requests.list()}const me=N=>{he(!1),a("loading"),(async()=>{try{const W=Y(N);N&&(ee().then(H=>{H.sort((J,ce)=>{const Ne=new Date(J.updatedAt||J.createdAt);return new Date(ce.updatedAt||ce.createdAt)-Ne}),x(H)}).catch(()=>{}),j().then(H=>{v(H)}).catch(()=>{}),Z&&ye());const{done:_}=await W;f(!_),a("default")}catch{a("error")}})()};G(()=>{me(!0)},[]),G(()=>{k&&me(!0)},[k]);const[ue,he]=A(!1),ke=Qe(({disableIdleCheck:N=!1}={})=>{var W;o!=="loading"&&s.settings.autoRefresh&&((W=l.current)==null?void 0:W.scrollTop)<16&&(N||window.__IDLE__)&&!qa()&&me(!0)},[s.notificationsShowNew,s.settings.autoRefresh,o]),Ee=z();Ct(N=>{if(N){const W=Date.now()-Ee.current;!Ee.current||W>1e3*3?ke({disableIdleCheck:!0}):Ee.current=Date.now()}});const Te=z(!0);G(()=>{let N=hi(T,"notificationsShowNew",W=>{if(Te.current){Te.current=!1;return}o!=="loading"&&(W&&ke(),he(W))});return()=>N==null?void 0:N()},[]);const Pe=new Date,Fe=new Date(Pe-24*60*60*1e3);let xe=new Date;const X=!s.notifications.some(N=>new Date(N.createdAt).toDateString()===Pe.toDateString()),ae=z();G(()=>{u&&(T.routeNotification={id:u,accessToken:atob(c)})},[u,c]);const te=".notification",Se=Re("j",()=>{const N=document.activeElement.closest(te),W=N==null?void 0:N.getBoundingClientRect(),_=Array.from(l.current.querySelectorAll(te));if(N&&W.top<l.current.clientHeight&&W.bottom>0){const H=_.indexOf(N);let J=_[H+1];J&&(J.focus(),J.scrollIntoView(Ot))}else{const H=_.find(J=>{const ce=J.getBoundingClientRect();return ce.top>=44&&ce.left>=0});H&&(H.focus(),H.scrollIntoView(Ot))}}),Ie=Re("k",()=>{const N=document.activeElement.closest(te),W=N==null?void 0:N.getBoundingClientRect(),_=Array.from(l.current.querySelectorAll(te));if(N&&W.top<l.current.clientHeight&&W.bottom>0){const H=_.indexOf(N);let J=_[H-1];J&&(J.focus(),J.scrollIntoView(Ot))}else{const H=_.find(J=>{const ce=J.getBoundingClientRect();return ce.top>=44&&ce.left>=0});H&&(H.focus(),H.scrollIntoView(Ot))}}),F=Re(["enter","o"],()=>{const N=document.activeElement.closest(te),W=N==null?void 0:N.querySelector(".status-link");W&&W.click()});return e("div",{id:"notifications-page",class:"deck-container",ref:N=>{l.current=N,Se.current=N,Ie.current=N,F.current=N},tabIndex:"-1",children:[e("div",{class:`timeline-deck deck ${r?"only-mentions":""}`,children:[e("header",{hidden:b,onClick:N=>{var W;N.target.closest("a, button")||(W=l.current)==null||W.scrollTo({top:0,behavior:"smooth"})},onDblClick:N=>{N.target.closest("a, button")||me(!0)},class:o==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(yt,{}),e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side",children:Z&&e("button",{type:"button",class:"button plain4",onClick:()=>{P(!0)},children:e(w,{icon:"settings",size:"l",alt:"Notifications settings"})})})]}),ue&&o!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var N;me(!0),(N=l.current)==null||N.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),I.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",I.length>1?"s":""]})," ",e("small",{class:"insignificant",children:i})]}),I.length>1&&e("span",{class:"announcements-nav-buttons",children:I.map((N,W)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var _;(_=ae.current)==null||_.children[W].scrollIntoView({behavior:"smooth",block:"nearest"})},children:W+1}))})]}),e("ul",{class:`announcements-list-${I.length>1?"multiple":"single"}`,ref:ae,children:I.map(N=>e("li",{children:e(Va,{announcement:N})}))})]})})}),C.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),C.length>5?e("details",{children:[e("summary",{children:[C.length," follow requests"]}),e("ul",{children:C.map(N=>e("li",{children:[e(Ze,{account:N}),e(rn,{accountID:N.id,onChange:()=>{}})]},N.id))})]}):e("ul",{children:C.map(N=>e("li",{children:[e(Ze,{account:N}),e(rn,{accountID:N.id,onChange:()=>{}})]},N.id))})]}),Z&&((re=L==null?void 0:L.summary)==null?void 0:re.pendingRequestsCount)>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("div",{class:"filtered-notifications",children:e("details",{onToggle:async N=>{const{open:W}=N.target;if(W){const _=await ne();fe(_)}},children:[e("summary",{children:["Filtered notifications from"," ",L.summary.pendingRequestsCount," people"]}),ve?(ve==null?void 0:ve.length)>0&&e("ul",{children:ve.map(N=>{var W,_;return e("li",{children:[e("div",{class:"request-notifcations",children:[!((W=N.lastStatus)!=null&&W.id)&&e(Ze,{useAvatarStatic:!0,showStats:!0,account:N.account}),((_=N.lastStatus)==null?void 0:_.id)&&e("div",{class:"last-post",children:e(oe,{class:"status-link",to:`/${i}/s/${N.lastStatus.id}`,children:e(Be,{status:N.lastStatus,size:"s",readOnly:!0})})}),e(Ya,{request:N})]}),e(ja,{request:N,onChange:()=>{me(!0)}})]},N.id)})}):e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})})]})})})}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:r,onChange:N=>{h(N.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),X&&e("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":e(R,{children:"…"})}),s.notifications.length?e(R,{children:s.notifications.filter(N=>N.type!=="follow_request").map(N=>{if(r&&N.type!=="mention")return null;const W=new Date(N.createdAt),_=W.toDateString()!==xe.toDateString();_&&(xe=W);const H=W.toDateString()===Fe.toDateString()?"Yesterday":ot(xe,{hideTime:!0});return e(R,{children:[_&&e("h2",{class:"timeline-header",children:H}),e(Zt,{instance:i,notification:N},N.id)]},N.id)})}):e(R,{children:[o==="loading"&&e(R,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((N,W)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),o==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>me(!0),children:"Try again"})]})]}),p&&e(rt,{onChange:N=>{N&&me()},children:e("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>me(),style:{marginBlockEnd:"6em"},children:o==="loading"?e(Ae,{abrupt:!0}):e(R,{children:"Show more…"})})})]}),Z&&$&&e($e,{onClick:N=>{N.target===N.currentTarget&&P(!1)},children:e("div",{class:"sheet",id:"notifications-settings",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>P(!1),children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Notifications settings"})}),e("main",{children:e("form",{onSubmit:N=>{N.preventDefault();const{filterNotFollowing:W,filterNotFollowers:_,filterNewAccounts:H,filterPrivateMentions:J}=N.target,ce={filterNotFollowing:W.checked,filterNotFollowers:_.checked,filterNewAccounts:H.checked,filterPrivateMentions:J.checked};U({...L,...ce}),P(!1),(async()=>{try{await n.v1.notifications.policy.update(ce),se("Notifications settings updated")}catch{}})()},children:[e("p",{children:"Filter out notifications from people:"}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:L.filterNotFollowing,name:"filterNotFollowing"})," ","You don't follow"]})}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:L.filterNotFollowers,name:"filterNotFollowers"})," ","Who don't follow you"]})}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:L.filterNewAccounts,name:"filterNewAccounts"})," ","With a new account"]})}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:L.filterPrivateMentions,name:"filterPrivateMentions"})," ","Who unsolicitedly private mention you"]})}),e("p",{children:e("button",{type:"submit",children:"Save"})})]})})]})})]})}function qa(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Va({announcement:t}){const{instance:n}=Q(),{contact:i}=us(),s=i==null?void 0:i.account,{id:o,content:a,startsAt:d,endsAt:u,published:c,allDay:p,publishedAt:f,updatedAt:r,read:h,mentions:l,statuses:y,tags:m,emojis:k,reactions:g}=t,b=new Date(f),C=ot(b),v=new Date(r),I=ot(v);return e("div",{class:"announcement-block",children:[e(Ze,{account:s}),e("div",{class:"announcement-content",onClick:ws({mentions:l,instance:n}),dangerouslySetInnerHTML:{__html:on(a,{emojis:k})}}),e("p",{class:"insignificant",children:[e("time",{datetime:b.toISOString(),children:ot(b)}),r&&I!==C&&e(R,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:v.toISOString(),children:ot(v)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:g.map(x=>{const{name:E,count:Y,me:j,staticUrl:M,url:ee}=x;return e("button",{type:"button",class:`plain4 small ${j?"reacted":""}`,children:[ee||M?e("img",{src:ee||M,alt:E,width:"16",height:"16"}):e("span",{children:E})," ",e("span",{class:"count",children:Ge(Y)})]})})})]})}function Ga(t){const{masto:n}=Q();return n.v1.notifications.list({accountID:t})}function Ya({request:t}){var r;const{instance:n}=Q(),[i,s]=A("loading"),{account:o,lastStatus:a}=t,[d,u]=A(!1),[c,p]=A([]);function f(){u(!1)}return G(()=>{var h;(h=t==null?void 0:t.account)!=null&&h.id&&d&&(s("loading"),(async()=>{const l=await Ga(t.account.id);p(l||[]),s("default")})())},[d,(r=t==null?void 0:t.account)==null?void 0:r.id]),e(R,{children:[e("button",{type:"button",class:"plain4 request-notifications-account",onClick:()=>{u(!0)},children:[e(w,{icon:"notification",class:"more-insignificant"})," ",e("small",{children:["View notifications from @",o.username]})," ",e(w,{icon:"chevron-down"})]}),d&&e($e,{onClick:h=>{h.target===h.currentTarget&&f()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:f,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Notifications from @",o.username]})}),e("main",{children:i==="loading"?e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}):c.map(h=>e("div",{class:"notification-peek",onClick:l=>{const{target:y}=l;(l.target.tagName==="BUTTON"||l.target.tagName==="A")&&f()},children:e(Zt,{instance:n,notification:h,isStatic:!0})}))})]})})]})}function ja({request:t,onChange:n}){const{masto:i}=Q(),[s,o]=A("default"),[a,d]=A(null),u=a!==null;return e("p",{class:"notification-request-buttons",children:[e("button",{type:"button",disabled:s==="loading"||u,onClick:()=>{o("loading"),(async()=>{try{await i.v1.notifications.requests.$select(t.id).accept(),d("accept"),o("default"),n({request:t,state:"accept"}),se(`Notifications from @${t.account.username} will not be filtered from now on.`)}catch{o("error"),se("Unable to accept notification request")}})()},children:"Allow"})," ",e("button",{type:"button",disabled:s==="loading"||u,class:"light danger",onClick:()=>{o("loading"),(async()=>{try{await i.v1.notifications.requests.$select(t.id).dismiss(),d("dismiss"),o("default"),n({request:t,state:"dismiss"}),se(`Notifications from @${t.account.username} will not show up in Filtered notifications from now on.`)}catch{o("error"),se("Unable to dismiss notification request")}})()},children:"Dismiss"}),e("span",{class:"notification-request-states",children:s==="loading"?e(Ae,{abrupt:!0}):a==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"notification-accepted"}):a==="dismiss"&&e(w,{icon:"x-circle",alt:"Dismissed",class:"notification-dismissed"})})]})}const qs=Xe(Ha),Wa=20;function ln({local:t,columnMode:n,...i}){const s=Me(T),o=!!t,a=n?{}:gt(),{masto:d,instance:u}=Q({instance:(i==null?void 0:i.instance)||a.instance}),{masto:c,instance:p}=Q(),f=`${o?"Local":"Federated"} timeline (${u})`;qe(f,o?"/:instance?/p/l":"/:instance?/p");const r=z(),h=z();async function l(m){(m||!h.current)&&(h.current=d.v1.timelines.public.list({limit:Wa,local:o,remote:!o}));const k=await h.current.next();let{value:g}=k;return g!=null&&g.length&&(m&&(r.current=g[0].id),g.forEach(b=>{He(b,u)})),{...k,value:g}}async function y(){var m;try{const k=await d.v1.timelines.public.list({limit:1,local:o,since_id:r.current}).next();let{value:g}=k;const b=((m=g[0])==null?void 0:m.id)===r.current;return g!=null&&g.length&&!b?(g=At(g,"public"),!0):!1}catch{return!1}}return e(dt,{title:f,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:o?"Local timeline":"Federated timeline"}),e("div",{children:u})]}),id:"public",instance:u,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:l,checkForUpdates:y,useItemID:!0,headerStart:e(R,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",headerEnd:e(Je,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(de,{href:o?`/#/${u}/p`:`/#/${u}/p/l`,children:o?e(R,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(R,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(ze,{}),e(de,{onClick:()=>{let m=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(m)){m&&alert("Invalid instance");return}m&&(m=m.toLowerCase().trim(),location.hash=o?`/${m}/p/l`:`/${m}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),p!==u&&e(de,{onClick:()=>{location.hash=o?`/${p}/p/l`:`/${p}/p`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:p}),")"]})]})]})},u+o)}const zt=5,sn=40,Ka=new URLSearchParams;function Vs({columnMode:t,...n}){const i=t?{}:gt(),{masto:s,instance:o,authenticated:a}=Q({instance:i.instance}),[d,u]=A("default"),[c]=t?[Ka]:it(),p=z(),f=(n==null?void 0:n.query)||c.get("q"),r=t?"statuses":(n==null?void 0:n.type)||c.get("type");qe(f?`Search: ${f}${r?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[r]})`:""}`:"Search","/search");const[h,l]=A(!1),y=z(0);G(()=>{y.current=0},[f,r]);const m=z();lt(()=>{var $,P;(P=($=m.current)==null?void 0:$.scrollTo)==null||P.call($,0,0)},[f,r]);const[k,g]=A([]),[b,C]=A([]),[v,I]=A([]);G(()=>{g([]),C([]),I([])},[f]);const x={statuses:g,accounts:C,hashtags:I},[E,Y]=A({}),j=async $=>{if(!($!=null&&$.length))return;const P=await bn($,E);P&&Y({...E,...P})};function M($){$&&(y.current=0),!(!$&&!a)&&(u("loading"),$&&!r&&(g(k.slice(0,zt)),C(b.slice(0,zt)),I(v.slice(0,zt))),(async()=>{var L,U;const P={q:f,resolve:a,limit:zt};r&&(P.limit=sn,P.type=r,a&&(P.offset=y.current));try{const V=await s.v2.search.fetch(P);if(r)if($){x[r](V[r]);const ye=(L=V[r])==null?void 0:L.length;y.current=sn,l(!!ye)}else{x[r](ve=>[...ve,...V[r]]);const ye=(U=V[r])==null?void 0:U.length;y.current=y.current+sn,l(!!ye)}else g(V.statuses||[]),C(V.accounts||[]),I(V.hashtags||[]),y.current=0,l(!1);j(V.accounts),u("default")}catch{u("error")}})())}const ee=z();Ct($=>{var L;const P=((L=m.current)==null?void 0:L.scrollTop)===0;if($&&P){const U=Date.now()-ee.current;!ee.current||U>1e3*3?M(!0):ee.current=Date.now()}}),G(()=>{var $,P,L,U;(P=($=p.current)==null?void 0:$.setValue)==null||P.call($,f||""),f?M(!0):(U=(L=p.current)==null?void 0:L.focus)==null||U.call(L)},[f,r,o]),Re(["/","Slash"],$=>{var P,L,U,V;(L=(P=p.current)==null?void 0:P.focus)==null||L.call(P),(V=(U=p.current)==null?void 0:U.select)==null||V.call(U)},{preventDefault:!0});const[Z]=pn();return e("div",{id:"search-page",class:"deck-container",ref:m,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:d==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(yt,{})}),e(Ms,{ref:p}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{M(!0)},disabled:d==="loading",children:e(w,{icon:"search",size:"l"})})})]})}),e("main",{children:[!!f&&!t&&e("div",{ref:Z,class:`filter-bar ${d==="loading"?"loading":""}`,children:[!!r&&e(oe,{to:`/search${f?`?q=${encodeURIComponent(f)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(f)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(f)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(f)}&type=statuses`}].sort(($,P)=>$.type===r?-1:P.type===r?1:0).map($=>e(oe,{to:$.to,children:$.label},$.type))]}),f?e(R,{children:[(!r||r==="accounts")&&e(R,{children:[r!=="accounts"&&e("h2",{class:"timeline-header",children:["Accounts"," ",e(oe,{to:`/search?q=${encodeURIComponent(f)}&type=accounts`,children:e(w,{icon:"arrow-right",size:"l"})})]}),b.length>0?e(R,{children:[e("ul",{class:"timeline flat accounts-list",children:b.map($=>e("li",{children:e(Ze,{account:$,instance:o,showStats:!0,relationship:E[$.id]})},$.id))}),r!=="accounts"&&e("div",{class:"ui-state",children:e(oe,{class:"plain button",to:`/search?q=${encodeURIComponent(f)}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!r&&(d==="loading"?e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!r||r==="hashtags")&&e(R,{children:[r!=="hashtags"&&e("h2",{class:"timeline-header",children:["Hashtags"," ",e(oe,{to:`/search?q=${encodeURIComponent(f)}&type=hashtags`,children:e(w,{icon:"arrow-right",size:"l"})})]}),v.length>0?e(R,{children:[e("ul",{class:"link-list hashtag-list",children:v.map($=>{var V;const{name:P,history:L}=$,U=(V=L==null?void 0:L.reduce)==null?void 0:V.call(L,(ye,ve)=>ye+ +ve.uses,0);return e("li",{children:e(oe,{to:o?`/${o}/t/${P}`:`/t/${P}`,children:[e(w,{icon:"hashtag"}),e("span",{children:P}),!!U&&e("span",{class:"count",children:Ge(U)})]})},`${P}-${U}`)})}),r!=="hashtags"&&e("div",{class:"ui-state",children:e(oe,{class:"plain button",to:`/search?q=${encodeURIComponent(f)}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!r&&(d==="loading"?e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!r||r==="statuses")&&e(R,{children:[r!=="statuses"&&e("h2",{class:"timeline-header",children:["Posts"," ",e(oe,{to:`/search?q=${encodeURIComponent(f)}&type=statuses`,children:e(w,{icon:"arrow-right",size:"l"})})]}),k.length>0?e(R,{children:[e("ul",{class:"timeline",children:k.map($=>e("li",{children:e(oe,{class:"status-link",to:o?`/${o}/s/${$.id}`:`/s/${$.id}`,children:e(Be,{status:$})})},$.id))}),r!=="statuses"&&e("div",{class:"ui-state",children:e(oe,{class:"plain button",to:`/search?q=${encodeURIComponent(f)}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!r&&(d==="loading"?e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!r&&(d==="default"?h?e(rt,{onChange:$=>{$&&M()},children:e("button",{type:"button",class:"plain block",onClick:()=>M(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):d==="loading"&&e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}))]}):d==="loading"?e("p",{class:"ui-state",children:e(Ae,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const Ja=20,Xa=ht(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Za(t){return We("@pixelfed/trending")?t.pixelfed.v2.discover.posts.trending.list({range:"daily"}):t.v1.trends.statuses.list({limit:Ja})}function Gs({columnMode:t,...n}){const i=Me(T),s=t?{}:gt(),{masto:o,instance:a}=Q({instance:(n==null?void 0:n.instance)||s.instance}),{masto:d,instance:u}=Q(),c=`Trending (${a})`;qe(c,"/:instance?/trending");const p=z(),[f,r]=A([]),[h,l]=A([]),y=z();async function m(b){var I;if(b||!y.current){if(y.current=Za(o),We("@mastodon/trending-hashtags"))try{const x=o.v1.trends.tags.list(),{value:E}=await x.next();E!=null&&E.length&&r(E)}catch{}if(We("@mastodon/trending-links"))try{const{value:x}=await Xa(o,a),E=(I=x==null?void 0:x.filter)==null?void 0:I.call(x,Y=>Y.type==="link");E!=null&&E.length&&l(E)}catch{}}const C=await y.current.next();let{value:v}=C;return v!=null&&v.length&&(b&&(p.current=v[0].id),v.forEach(x=>{He(x,a)})),{...C,value:v}}async function k(){try{const b=await o.v1.trends.statuses.list({limit:1}).next();let{value:C}=b;return C=At(C,"public"),C!=null&&C.length&&C[0].id!==p.current?(p.current=C[0].id,!0):!1}catch{return!1}}const g=pe(()=>e(R,{children:[!!f.length&&e("div",{class:"filter-bar expandable",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),f.map((b,C)=>{const{name:v,history:I}=b,x=I.reduce((E,Y)=>E+ +Y.uses,0);return e(oe,{to:`/${a}/t/${v}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),v]}),e("span",{class:"filter-count",children:Ge(x)})]},v)})]}),!!h.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),h.map(b=>{const{authorName:C,authorUrl:v,blurhash:I,description:x,height:E,image:Y,imageDescription:j,language:M,providerName:ee,providerUrl:Z,publishedAt:$,title:P,url:L,width:U}=b,V=xt.toUnicode(new URL(L).hostname.replace(/^www\./,"").replace(/\/$/,""));let ye;if(I){const ve=fn(I),fe=Sn(ve);ye=In([.6,fe[1],fe[2]])}return e("a",{href:L,target:"_blank",rel:"noopener noreferrer",style:ye?{"--accent-color":`rgb(${ye.join(",")})`,"--accent-alpha-color":`rgba(${ye.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:Y,alt:j,width:U,height:E,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:V})," ",!!$&&e(R,{children:"· "}),!!$&&e(R,{children:e(bt,{datetime:$,format:"micro"})})]}),!!P&&e("h1",{class:"title",lang:M,dir:"auto",title:P,children:P})]}),!!x&&e("p",{class:"description",lang:M,dir:"auto",title:x,children:x})]})]})},L)})]})]}),[f,h]);return e(dt,{title:c,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:"Trending"}),e("div",{children:a})]}),id:"trending",instance:a,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:m,checkForUpdates:k,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(R,{}),boostsCarousel:i.settings.boostsCarousel,filterContext:"public",timelineStart:g,headerEnd:e(Je,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(de,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),u!==a&&e(de,{onClick:()=>{location.hash=`/${u}/trending`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:u}),")"]})]})]})},a)}function Qa(){qe("Home","/");const t=Me(T),{shortcuts:n}=t,i=n.map(s=>{if(!s)return null;const{type:o,...a}=s,d={following:Tn,notifications:qs,list:Os,public:ln,bookmarks:Ns,favourites:Ds,hashtag:Fs,mentions:Hs,trending:Gs,search:Vs}[o];return!d||o==="search"&&!a.query||o==="list"&&!a.id?null:e(d,{...a,columnMode:!0},o+JSON.stringify(a))});return Re(["1","2","3","4","5","6","7","8","9"],(s,o)=>{try{const a=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[a].focus()}catch{}}),e("div",{id:"columns",onContextMenu:s=>{s.target.closest(".deck > header")&&!s.target.closest("a")&&!s.target.closest("button")&&(s.preventDefault(),T.showShortcutsSettings=!0)},children:i})}function ec(){var n;const t=Me(T);return G(()=>{(async()=>{const i=await nt.drafts.keys();if(i.length){const s=jt();i.filter(a=>a.startsWith(s)).length&&(T.showDrafts=!0)}})()},[]),e(R,{children:(t.settings.shortcutsViewMode==="multi-column"||!t.settings.shortcutsViewMode&&t.settings.shortcutsColumnsMode)&&((n=t.shortcuts)!=null&&n.length)?e(Qa,{}):e(Tn,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(tc,{})})})}function tc(){const t=Me(T),n=z(),[i,s]=A(void 0);return e(R,{children:[e(oe,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${i||""}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),s(a=>a?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(ic,{state:i,anchorRef:n,onClose:()=>s(void 0)})]})}const nc=80,sc=5;function ic({anchorRef:t,state:n,onClose:i}){const{masto:s,instance:o}=Q(),a=Me(T),[d,u]=A("default"),c=s.v1.notifications.list({limit:nc});async function p(){const y=await c.next(),m=y.value;if(m!=null&&m.length){m.forEach(g=>{He(g.status,o,{skipThreading:!0})});const k=Bs(m);T.notificationsLast=m[0],T.notifications=k,s.v1.markers.create({notifications:{lastReadId:m[0].id}}).catch(()=>{})}return T.notificationsShowNew=!1,T.notificationsLastFetchTime=Date.now(),y}const[f,r]=A(!1);function h(){return s.v1.followRequests.list({limit:1})}function l(){u("loading"),(async()=>{try{await p();const y=await h();r(!!(y!=null&&y.length)),u("default")}catch{u("error")}})()}return G(()=>{n==="open"&&l()},[n]),e(ms,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:i,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:a.notifications.length?e(R,{children:a.notifications.slice(0,sc).map(y=>e(Zt,{instance:o,notification:y,disableContextMenu:!0},y.id))}):d==="loading"?e("div",{class:"ui-state",children:e(Ae,{abrupt:!0})}):d==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:l,children:"Try again"})})]})}),e("footer",{children:[e(oe,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(oe,{to:"/notifications",class:"button plain2",children:[f?e(R,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const oc=Xe(ec),ac=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i,/^\/p\/[^\/]+\/([^\/]+)/i];function Ys(t){const{hostname:n,pathname:i}=new URL(t);for(const s of ac){const[,o]=i.match(s)||[];if(o)return{instance:n,id:o}}return{}}function cc(t){const{instance:n,id:i}=Ys(t);return n&&i?`/${n}/s/${i}`:null}function rc(){const n=Tt().pathname.replace(/^\//,""),i=Ys(n),s=i!=null&&i.instance?`/${i.instance}/s/${i.id}`:null,[o,a]=A("loading");return lt(()=>{a("loading"),(async()=>{try{const{instance:d,id:u}=i,{masto:c}=Q({instance:d});if(await c.v1.statuses.$select(u).fetch()){window.location.hash=s+"?view=full";return}}catch{}{const{masto:d,instance:u}=Q(),c=await d.v2.search.fetch({q:n,limit:1,resolve:!0});if(c.statuses.length){const p=c.statuses[0];window.location.hash=`/${u}/s/${p.id}?view=full`}else if(c.accounts.length){const p=c.accounts[0];window.location.hash=`/${u}/a/${p.id}`}else s?window.location.hash=s+"?view=full":a("error")}})()},[s]),e("div",{class:"ui-state",tabIndex:"-1",children:[o==="loading"?e(R,{children:[e(Ae,{abrupt:!0}),e("h2",{children:"Resolving…"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):e(R,{children:[e("h2",{children:"Unable to resolve URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(oe,{to:"/",children:"Go home"})})]})}function lc(){qe("Lists","/l");const[t,n]=A("default"),[i,s]=mt(c=>c+1,0),[o,a]=A([]);G(()=>{n("loading"),(async()=>{try{const c=await cn();a(c),n("default")}catch{n("error")}})()},[i]);const[d,u]=A(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(yt,{}),e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>u(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:o.length>0?e(R,{children:[e("ul",{class:"link-list",children:o.map(c=>e("li",{children:e(oe,{to:`/l/${c.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:c.title})]})})}))}),o.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[o.length," list",o.length===1?"":"s"]})})]}):t==="loading"?e("p",{class:"ui-state",children:e(Ae,{})}):t==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),d&&e($e,{onClick:c=>{c.target===c.currentTarget&&u(!1)},children:e(kn,{list:d==null?void 0:d.list,onClose:c=>{c.state==="success"&&s(),u(!1)}})})]})}const dc=""+new URL("instances-MzK7fGXv.json",import.meta.url).href;var uc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:hc,PHANPY_WEBSITE:pc}=uc,xn="read write follow push";async function fc({instanceURL:t}){const n=new URLSearchParams({client_name:hc,redirect_uris:location.origin+location.pathname,scopes:xn,website:pc});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function mc({instanceURL:t,client_id:n}){const i=new URLSearchParams({client_id:n,scope:xn,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${i.toString()}`}async function gc({instanceURL:t,client_id:n,client_secret:i,code:s}){const o=new URLSearchParams({client_id:n,client_secret:i,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:s,scope:xn});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}var bc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:yc}=bc;function wc(){var b,C;qe("Log in");const t=z(),n=be.local.get("instanceURL"),[i,s]=A("default"),[o]=it(),a=o.get("instance"),d=o.get("submit"),[u,c]=A(a||(n==null?void 0:n.toLowerCase())||""),[p,f]=A([]),r=z();G(()=>{(async()=>{try{const I=await(await fetch(dc)).json();f(I),r.current=new pi(I)}catch{}})()},[]);const h=v=>{v&&(be.local.set("instanceURL",v),(async()=>{s("loading");try{const{client_id:I,client_secret:x,vapid_key:E}=await fc({instanceURL:v});I&&x?(be.session.set("clientID",I),be.session.set("clientSecret",x),be.session.set("vapidKey",E),location.href=await mc({instanceURL:v,client_id:I})):alert("Failed to register application"),s("default")}catch{s("error")}})())},l=u?u.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,y=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(l)&&!/[\s\/\\@]/.test(l),m=l?(C=(b=r.current)==null?void 0:b.search(l,{limit:10}))==null?void 0:C.map(v=>v.item):[],k=y?l:m!=null&&m.length?m[0]:u?p.find(v=>v.includes(u)):null,g=v=>{v.preventDefault(),h(k)};return d&&G(()=>{h(a||k)},[]),e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:g,children:[e("h1",{children:[e("img",{src:wn,alt:"",width:"80",height:"80"}),e("br",{}),"Log in"]}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:u,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:i==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellCheck:!1,placeholder:"instance domain",onInput:v=>{c(v.target.value)}}),(m==null?void 0:m.length)>0?e("ul",{id:"instances-suggestions",children:m.map((v,I)=>e("li",{children:e("button",{type:"button",class:"plain5",onClick:()=>{h(v)},children:v})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),i==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{disabled:i==="loading"||!u||!k,children:k?`Continue with ${k}`:"Continue"})," "]}),e(Ae,{hidden:i!=="loading"}),e("hr",{}),!yc&&e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(oe,{to:"/",children:"Go home"})})]})})}const Bt=40,vc=10,kc=5;let dn={},Vt={},Gt={};function Yt(t){delete Vt[t],delete Gt[t]}const _t={block:"nearest",inline:"center",behavior:"smooth"},ns=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",ss=/\/s\//i;function Sc(t){var v;const{id:n}=t,{masto:i,instance:s}=Q({instance:t.instance}),o=Me(T),[a,d]=it(),u=a.get("media"),c=a.get("media-only"),p=parseInt(u||c,10);let f=p>0;const r=a.get("mediaStatusID"),h=hs(r,s);r&&!h&&(f=!1);const l=f&&!!c,y=Ke(n,s),[m,k]=A(T.statuses[y]);G(()=>{T.statuses[y]&&k(T.statuses[y])},[y]);const g=pe(()=>{const{prevLocation:I}=T,x=((I==null?void 0:I.pathname)||"")+((I==null?void 0:I.search)||""),E=Lt("/:instance/s/:id",x)||Lt("/s/:id",x);return!x||E?"/":x},[]);G(()=>{!m&&f&&(async()=>{try{const I=await i.v1.statuses.$select(n).fetch();He(I,s),k(I)}catch{alert("Unable to load post."),location.hash=g}})()},[f]);const b=r?(v=o.statuses[Ke(r,s)])==null?void 0:v.mediaAttachments:m==null?void 0:m.mediaAttachments,C=Qe(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():l?location.hash=g:(a.delete("media"),a.delete("mediaStatusID"),d(a))},[l,g,o.prevLocation]);return G(()=>{let I=setTimeout(()=>{const x=document.querySelector(".carousel");x&&x.focus()},100);return()=>clearTimeout(I)},[l]),G(()=>{const I=document.querySelectorAll(".deck-container");return I.forEach(x=>{x.setAttribute("inert","")}),()=>{I.forEach(x=>{x.removeAttribute("inert")})}},[]),e("div",{class:"deck-backdrop",children:[f?b!=null&&b.length?e(Es,{mediaAttachments:b,statusID:r||n,instance:s,lang:m==null?void 0:m.language,index:p-1,onClose:C}):e("div",{class:"media-modal-container loading",children:e(Ae,{abrupt:!0})}):e(oe,{to:g}),!l&&e(Cc,{id:n,instance:t.instance,closeLink:g})]})}function Ic(t){const{linkable:n,to:i,onClick:s,...o}=t;return n?e(oe,{class:"status-link",to:i,onClick:s,...o}):e("div",{class:"status-focus",tabIndex:0,...o})}function Cc({id:t,closeLink:n="/",instance:i}){var N,W;const[s,o]=it(),a=s.get("media"),d=s.get("mediaStatusID"),u=parseInt(a,10)>0,c=z(!T.prevLocation&&(history.length===1||"navigation"in window&&((W=(N=navigation==null?void 0:navigation.entries)==null?void 0:N.call(navigation))==null?void 0:W.length)===1)),[p,f]=A(s.get("view")||c.current?"full":null),r=!!parseInt(s.get("translate")),{masto:h,instance:l}=Q({instance:i}),{masto:y,instance:m,authenticated:k}=Q(),g=l===m,b=Me(T),[C,v]=A([]),[I,x]=A("default"),E=z(),Y=Ke(t,l),j=z(0),M=z();G(()=>{var _;(_=M.current)==null||_.focus()},[]),G(()=>{var H;const _=bs(()=>{if(!M.current)return;const{scrollTop:J}=M.current;I!=="loading"&&(Gt[t]=J)},50);return(H=M.current)==null||H.addEventListener("scroll",_,{passive:!0}),_(),()=>{var J;_.cancel(),(J=M.current)==null||J.removeEventListener("scroll",_)}},[t,I!=="loading"]);const ee=z(),Z=z(),$=({reloadHero:_}={})=>{x("loading");let H;const J=Vt[t];if(J){const ce=J.filter(Ne=>T.statuses[Y]);v(ce)}else v([{id:t}]);return(async()=>{var B,O;const ce=()=>En(()=>h.v1.statuses.$select(t).fetch(),{retries:4}),Ne=En(()=>h.v1.statuses.$select(t).context.fetch(),{retries:8}),S=!!b.statuses[Y];let D=b.statuses[Y];if(!(S&&!_))try{D=await ce(),He(D,l),await new Promise(K=>{setTimeout(K,100)})}catch{x("error");return}try{let K=function(q){return q==null?void 0:q.map(we=>({id:we.id,account:we.account,repliesCount:we.repliesCount,content:we.content,weight:Et(we),replies:K(we.__replies)}))};const ge=await Ne,{ancestors:le,descendants:ie}=ge;j.current=(ie==null?void 0:ie.length)||0;const Ce=new Set;le.forEach(q=>{He(q,l,{skipThreading:!0}),q.inReplyToId&&!le.find(we=>we.id===q.inReplyToId)&&Ce.add(q.inReplyToId)});const De=le.every(q=>q.account.id===D.account.id),Oe=[];ie.forEach(q=>{if(He(q,l,{skipThreading:!0}),q.inReplyToId&&!ie.find(we=>we.id===q.inReplyToId)&&q.inReplyToId!==D.id&&Ce.add(q.inReplyToId),q.inReplyToAccountId===q.account.id)Oe.push(q);else if(q.inReplyToId===D.id)Oe.push(q);else if(!q.inReplyToAccountId&&Oe.find(we=>we.id===q.inReplyToId)&&q.account.id===D.account.id)Oe.push(q);else{const we=ie.find(tt=>tt.id===q.inReplyToId);we&&(we.__replies||(we.__replies=[]),we.__replies.push(q))}}),Ce.size;const Le=[...le.map(q=>({id:q.id,ancestor:!0,isThread:De,accountID:q.account.id,account:q.account,repliesCount:q.repliesCount,weight:Et(q)})),{id:t,accountID:D.account.id,weight:Et(D)},...Oe.map(q=>({id:q.id,account:q.account,accountID:q.account.id,descendant:!0,thread:q.account.id===D.account.id,weight:Et(q),replies:K(q.__replies)}))];x("default"),ee.current={offsetTop:(B=E.current)==null?void 0:B.offsetTop,scrollTop:(O=M.current)==null?void 0:O.scrollTop};const Ve=Le.findIndex(q=>q.id===t);Ve>=ne&&me(Ve+1),v(Le),Vt[t]=Le,Qs(D,l)}catch{x("error")}})(),Z.current=Date.now(),()=>{clearTimeout(H)}};G($,[t,h]);const[P,L]=A(!1);G(()=>{let _=setInterval(()=>{const H=Date.now();Z.current&&H-Z.current>=6e4&&L(!0)},6e4);return()=>{clearInterval(_)}},[]),lt(()=>{var H,J;if(!C.length)return;const _=Gt[t];if(_)M.current.scrollTop=_;else if(ee.current){const ce={offsetTop:(H=E.current)==null?void 0:H.offsetTop,scrollTop:(J=M.current)==null?void 0:J.scrollTop},Ne=ce.offsetTop-ee.current.offsetTop+ce.scrollTop;M.current.scrollTop=Ne}else C.length===1&&(M.current.scrollTop=0);ee.current=null},[C]),G(()=>{b.reloadStatusPage<=0||(async()=>{try{const{instanceURL:_}=St(),H=`https://${_}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(H,{ignoreVary:!0}),$({reloadHero:!0})}catch{}})()},[b.reloadStatusPage]),G(()=>()=>{Gt={},T.reloadStatusPage=0,Vt={},dn={},un.clear()},[]);const U=b.statuses[Y]||b.statuses[t],V=pe(()=>{if(!U)return"";const{account:_}=U,H=document.createElement("div");return H.innerHTML=_.displayName,H.innerText.trim()},[U]),ye=pe(()=>{if(!U)return"";let _=yn(U);return _.length>64&&(_=_.slice(0,64)+"…"),_},[U]);qe(V&&ye?`${V}: "${ye}"`:"Status","/:instance?/s/:id");const ve=pe(()=>{if(!U)return;const{url:_}=U;if(_)return new URL(_).hostname},[U]),fe=pe(()=>{if(ve)return ve===l},[ve,l]),[ne,me]=A(Bt),ue=pe(()=>C.length-ne,[C.length,ne]),he=C.some(_=>_.descendant),ke=C.filter(_=>_.ancestor),[Ee,Te]=A(!0),Pe=pe(()=>{if(!E.current||Ee)return null;const{top:_}=E.current.getBoundingClientRect();return _>0?"down":"up"},[Ee]);Re("esc",()=>{location.hash=n},{enabled:!u,ignoreEventWhen:_=>!!document.querySelector("#modal-container > *")}),Re("backspace",()=>{location.hash=n}),Re("j",()=>{const _=document.activeElement.closest(".status-link, .status-focus"),H=_==null?void 0:_.getBoundingClientRect(),J=Array.from(M.current.querySelectorAll(ns));if(_&&H.top<M.current.clientHeight&&H.bottom>0){const ce=J.indexOf(_);let Ne=J[ce+1];Ne&&(Ne.focus(),Ne.scrollIntoView(_t))}else{const ce=J.find(Ne=>{const S=Ne.getBoundingClientRect();return S.top>=44&&S.left>=0});ce&&(ce.focus(),ce.scrollIntoView(_t))}}),Re("k",()=>{const _=document.activeElement.closest(".status-link, .status-focus"),H=_==null?void 0:_.getBoundingClientRect(),J=Array.from(M.current.querySelectorAll(ns));if(_&&H.top<M.current.clientHeight&&H.bottom>0){const ce=J.indexOf(_);let Ne=J[ce-1];Ne&&(Ne.focus(),Ne.scrollIntoView(_t))}else{const ce=J.find(Ne=>{const S=Ne.getBoundingClientRect();return S.top>=44&&S.left>=0});ce&&(ce.focus(),ce.scrollIntoView(_t))}}),Re("x",()=>{const _=document.activeElement.closest(".status-link, .status-focus");if(_){const H=_.nextElementSibling;H&&H.tagName.toLowerCase()==="details"&&(H.open=!H.open)}});const[Fe,xe]=A(!1),X=z(u?"media+status":"status"),ae=Qe((_,H,J,ce)=>{_.preventDefault(),_.stopPropagation(),o({media:H+1,mediaStatusID:ce.id})},[t]),te=Qe((_,H)=>{Yt(H.id)},[]);G(()=>{let _;return d&&u&&(_=setTimeout(()=>{var J;const H=(J=M.current)==null?void 0:J.querySelector(`.status-link[href*="/${d}"]`);H&&H.scrollIntoView(_t)},400)),()=>{clearTimeout(_)}},[d,u]);const Se=Qe((_,H)=>{const{id:J,ancestor:ce,isThread:Ne,descendant:S,thread:D,replies:B,repliesCount:O,weight:K}=_,ge=J===t;return e("li",{ref:ge?E:null,class:`${ce?"ancestor":""} ${S?"descendant":""} ${D?"thread":""} ${ge?"hero":""}`,children:[ge?e(R,{children:[e(rt,{threshold:.1,onChange:ie=>{queueMicrotask(()=>{requestAnimationFrame(()=>{Te(ie)})})},class:"status-focus",tabIndex:0,children:e(Be,{statusID:J,instance:l,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:r})}),I!=="loading"&&!k?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(oe,{to:"/login",class:"button",children:"Log in"})]}):!g&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:l}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:I==="loading",onClick:()=>{x("loading"),(async()=>{try{const ie=await y.v2.search.fetch({q:U.url,type:"statuses",resolve:!0,limit:1});if(ie.statuses.length){const Ce=ie.statuses[0];location.hash=m?`/${m}/s/${Ce.id}`:`/s/${Ce.id}`}else throw new Error("No results")}catch(ie){x("default"),alert("Error: "+ie)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(Ic,{linkable:Ne||ce,to:l?`/${l}/s/${J}`:`/s/${J}`,onClick:()=>{Yt(J)},children:[H===0&&ce?e(rt,{threshold:.5,onChange:ie=>{queueMicrotask(()=>{requestAnimationFrame(()=>{xe(ie)})})},children:e(Be,{statusID:J,instance:l,withinContext:!0,size:D||ce?"m":"s",enableTranslate:!0,onMediaClick:ae,onStatusLinkClick:te})}):e(Be,{statusID:J,instance:l,withinContext:!0,size:D||ce?"m":"s",enableTranslate:!0,onMediaClick:ae,onStatusLinkClick:te,showActionsBar:!!S}),ce&&O>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:O,children:Ge(O)})]})," "]}),S&&(B==null?void 0:B.length)>0&&e(js,{instance:l,replies:B,hasParentThread:D,level:1,accWeight:K,openAll:j.current<vc,parentLink:{to:l?`/${l}/s/${J}`:`/s/${J}`,onClick:()=>Yt(J)}}),I==="loading"&&ge&&!!(U!=null&&U.repliesCount)&&!he&&e("div",{class:"status-loading",children:e(Ae,{abrupt:U.repliesCount>=3})}),I==="error"&&ge&&!!(U!=null&&U.repliesCount)&&!he&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{T.reloadStatusPage++},children:"Try again"})]})]},J)},[t,l,I,k,g,r,ae,te,he]),Ie=pe(()=>{var _;if("navigation"in window&&(navigation!=null&&navigation.entries)){const H=navigation.entries()[navigation.currentEntry.index-1];if(H!=null&&H.url)return ss.test(H.url)}return ss.test((_=T.prevLocation)==null?void 0:_.pathname)},[Y]),F=pe(()=>{if(!ue)return[];const _=[];function H(J){_.push(J.id),J.replies&&J.replies.forEach(H)}return C.slice(ne).forEach(H),_.map(J=>Ke(J,l))},[ue,C,ne,l]),re=pe(()=>C.slice(0,ne).map(Se),[C,ne,Se]);return G(()=>{let _=setTimeout(()=>{if(!E.current)return;const H=E.current.querySelector(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)");H&&H.click()},1e3);return()=>clearTimeout(_)},[t]),e("div",{tabIndex:"-1",ref:M,class:`status-deck deck contained ${C.length>1?"padded-bottom":""} ${X.current==="status"&&!c.current?"slide-in":""} ${p?`deck-view-${p}`:""}`,onAnimationEnd:_=>{X.current==="status"&&(X.current=null)},children:[e("header",{class:`${I==="loading"?"loading":""}`,onDblClick:_=>{T.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[Ie&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!Ee&&U&&I!=="loading"?e(R,{children:[e("span",{class:"hero-heading",children:[e(It,{account:U.account,instance:l,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(bt,{datetime:U.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:_=>{_.preventDefault(),_.stopPropagation(),E.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:Pe==="down"?"arrow-down":"arrow-up"})})]}):e(R,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:_=>{_.preventDefault(),_.stopPropagation(),M.current.scrollTo({top:0,behavior:"smooth"})},hidden:!ke.length||Fe,title:`${ke.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),ke.filter((_,H,J)=>J.findIndex(ce=>ce.accountID===_.accountID)===H).slice(0,3).map(_=>e(st,{url:_.account.avatar,alt:_.account.displayName},_.account.id)),ke.length>3&&e(R,{children:[" ",e("span",{class:"insignificant",children:Ge(ke.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:p==="full"?"":"none"},onClick:()=>{f(null),s.delete("media"),s.delete("media-only"),s.delete("view"),o(s)},title:"Switch to Side Peek view",children:e(w,{icon:"layout4",size:"l"})}),P&&e("button",{type:"button",class:"plain button-refresh",onClick:()=>{T.reloadStatusPage++,L(!1)},children:e(w,{icon:"refresh",size:"l"})}),e(Je,{align:"end",portal:{target:M.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(de,{disabled:I==="loading",onClick:()=>{T.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(de,{className:"menu-switch-view",onClick:()=>{f(p==="full"?null:"full"),s.delete("media"),s.delete("media-only"),p==="full"?s.delete("view"):s.set("view","full"),o(s)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[p||""]}),e("span",{children:["Switch to ",p==="full"?"Side Peek":"Full"," view"]})]}),e(de,{onClick:()=>{Array.from(M.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(H=>{H.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(ze,{}),e(gs,{className:"plain",children:"Experimental"}),e(de,{disabled:!ve||fe,onClick:()=>{const _=cc(U.url);_?location.hash=_:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance",ve?e(R,{children:[" ","(",e("b",{children:xt.toUnicode(ve)}),")"]}):""]})]})]}),e(oe,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),C.length&&U?e("ul",{class:`timeline flat contextual grow ${I==="loading"?"loading":""}`,children:[re,ue>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:I==="loading",onClick:()=>me(_=>_+Bt),style:{marginBlockEnd:"6em"},"data-state-post-ids":F.join(" "),children:[e("div",{class:"ib avatars-bunch",children:C.slice(ne,ne+5).map(_=>e(st,{url:_.account.avatarStatic},_.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:ue>Bt?`${Bt}+`:ue})]})]})})]}):e(R,{children:[I==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Be,{skeleton:!0,size:"l"})})}),I==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{T.reloadStatusPage++},children:"Try again"})]})]})]})}function js({replies:t,instance:n,hasParentThread:i,level:s,accWeight:o,openAll:a,parentLink:d}){const[u,c]=it(),p=b=>b.reduce((C,v)=>{const{repliesCount:I,replies:x}=v,E=(x==null?void 0:x.length)||I;return C+E+p(x||[])},0),f=t.length+p(t),r=t.length===f,h=t.map(b=>b.account).filter((b,C,v)=>v.findIndex(I=>I.id===b.id)===C).slice(0,3),l=pe(()=>t==null?void 0:t.reduce((b,C)=>b+(C==null?void 0:C.weight),o),[o,t==null?void 0:t.length]);let y=!1;(a||l<=kc||!i&&f===1&&Et(t[0])<2)&&(y=!0);const m=dn[t[0].id],k=Qe((b,C,v,I)=>{b.preventDefault(),b.stopPropagation(),c({media:C+1,mediaStatusID:I.id})},[]),g=z();return lt(()=>{var C;function b(v){v.target.dataset.scrollLeft=v.target.scrollLeft}return(C=g.current)==null||C.addEventListener("scroll",b,{passive:!0}),()=>{var v;(v=g.current)==null||v.removeEventListener("scroll",b)}},[]),e("details",{ref:g,class:"replies",open:m||y,onToggle:b=>{const{open:C}=b.target;dn[t[0].id]=C},style:{"--comments-level":s},"data-comments-level":s,"data-comments-level-overflow":s>4,children:[e("summary",{class:"replies-summary",hidden:y,children:[e("span",{class:"avatars",children:h.map(b=>e(st,{url:b.avatarStatic,title:`${b.displayName} @${b.username}`,squircle:b==null?void 0:b.bot},b.id))}),e("span",{class:"replies-counts",children:[e("b",{children:[e("span",{title:t.length,children:Ge(t.length)})," ","repl",t.length===1?"y":"ies"]}),!r&&f>1&&e(R,{children:[" ","·"," ",e("span",{children:[e("span",{title:f,children:Ge(f)})," ","comment",f===1?"":"s"]})]})]}),e(w,{icon:"chevron-down",class:"replies-summary-chevron"}),!!d&&e(oe,{class:"replies-parent-link",to:d.to,onClick:d.onClick,title:"View post with its replies",children:"»"})]}),e("ul",{children:t.map(b=>{var C,v;return e("li",{children:[e("div",{class:"status-focus",tabIndex:0,children:[e(Be,{statusID:b.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:k,showActionsBar:!0}),!((C=b.replies)!=null&&C.length)&&b.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:b.repliesCount,children:Ge(b.repliesCount)})]})]}),((v=b.replies)==null?void 0:v.length)&&e(js,{instance:n,replies:b.replies,level:s+1,accWeight:y?l:b.weight,openAll:a,parentLink:{to:n?`/${n}/s/${b.id}`:`/s/${b.id}`,onClick:()=>{Yt(b.id)}}})]},b.id)})})]})}const Tc=140,xc=35,Ac=70,$c=140,un=new Map;function Et(t){var l,y;const n=un.get(t.id);if(n)return n;const{spoilerText:i,content:s,mediaAttachments:o,poll:a,card:d}=t,u=Cs(i+s),c=o!=null&&o.length?Tc:0,p=(((l=a==null?void 0:a.options)==null?void 0:l.length)||0)*xc,f=d&&(o!=null&&o.length||(y=a==null?void 0:a.options)!=null&&y.length)?0:Ac,h=(u+c+p+f)/$c;return un.set(t.id,h),h}const _c=Xe(Sc);function Rc(){const t=gt(),{id:n,instance:i}=t;return e(_c,{id:n,instance:i})}const Ec=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,Lc=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,Mc=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,Pc=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,Nc=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,Dc="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var Uc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Rt,PHANPY_WEBSITE:is,PHANPY_PRIVACY_POLICY_URL:Fc,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:os}=Uc,as=is?is.replace(/https?:\/\//g,"").replace(/\/$/,""):null,cs=`${"2024-05-29T18:54:06.357Z".slice(0,10).replace(/-/g,".")}.314075d`;function rs(){return qe(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("div",{class:"hero-content",children:[e("h1",{children:[e("img",{src:wn,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:Dc,alt:"Phanpy",width:"200"})]}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),e("p",{children:e(oe,{to:Rt?`/login?instance=${Rt}&submit=1`:"/login",class:"button",children:Rt?"Log in":"Log in with Mastodon"})}),Rt&&os&&e("p",{children:e("a",{href:os,class:"button plain5",children:"Sign up"})}),!Rt&&e("p",{class:"insignificant",children:e("small",{children:["Connect your existing Mastodon/Fediverse account.",e("br",{}),"Your credentials are not stored on this server."]})})]}),(as||cs)&&e("p",{class:"app-site-version",children:e("small",{children:[as," ",cs]})}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),T.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:Fc,target:"_blank",children:"Privacy Policy"}),"."]})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:Ec,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:Nc,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:Lc,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:Mc,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:Pc,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Oc=window.alert;window.__nativeAlert||(window.__nativeAlert=Oc);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=fi({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=T;window.__STATES_STATS__=()=>{const t=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};t.forEach(o=>{n[o]=Object.keys(T[o]).length});const{statuses:i}=T,s=[];for(const o in i)document.querySelector(`[data-state-post-id~="${o}"], [data-state-post-ids~="${o}"]`)||s.push(o)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:t,unfurledLinks:n,notifications:i}=T;let s=0;const{instance:o}=Q();for(const a in t){if(!window.__IDLE__)break;try{const d=document.querySelector(`[data-state-post-id~="${a}"], [data-state-post-ids~="${a}"]`),u=i.some(c=>{var p;return a===Ke((p=c.status)==null?void 0:p.id,o)});if(!d&&!u){delete T.statuses[a],delete T.statusQuotes[a];for(const c in n){const p=n[c];if(Ke(p.id,p.instance)===a){delete T.unfurledLinks[c];break}}s++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const t in Dt)queueMicrotask(()=>{var n,i,s,o;Array.isArray(Dt[t])?(i=(n=Dt[t])[0])==null||i.call(n):(o=(s=Dt)[t])==null||o.call(s)})},5e3);(()=>{window.__IDLE__=!0;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},s=bs(n,3e3),o=()=>{window.__IDLE__=!1,s()};t.forEach(a=>{window.addEventListener(a,o,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",a=>{!a.relatedTarget&&!a.toElement&&n()},{passive:!0})})();const zc=/iPad|iPhone|iPod/.test(navigator.userAgent);zc&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const t=be.local.get("theme");let n;if(t){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const i=n.content,s=t==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=s||"",setTimeout(()=>{n.content=i},10)}}else{const i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${i}"]`),n){const s=n.dataset.content,o=n.dataset.contentTemp;n.content=o||"",setTimeout(()=>{n.content=s},10)}}}});{const t=be.local.get("theme");if(t){document.documentElement.classList.add(`is-${t}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",t||"dark light");const i=document.querySelector('meta[data-theme-setting="manual"]');i&&(i.name="theme-color",i.content=t==="light"?i.dataset.themeLightColor:i.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(o=>{o.name=""})}const n=be.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}ps(T,t=>{var n;for(const[i,s,o,a]of t){if(s.join(".")==="settings.shortcutsViewMode"){const d=document.getElementById("app");d&&(d.dataset.shortcutsViewMode=(n=T.shortcuts)!=null&&n.length?o:"")}s.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",o)}});function Bc(){const[t,n]=A(!1),[i,s]=A("loading");G(()=>{const a=be.local.get("instanceURL"),d=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(d){window.history.replaceState({},document.title,window.location.pathname||"/");const u=be.session.get("clientID"),c=be.session.get("clientSecret"),p=be.session.get("vapidKey");(async()=>{s("loading");const{access_token:f}=await gc({instanceURL:a,client_id:u,client_secret:c,code:d}),r=ei({instance:a,accessToken:f});await Promise.allSettled([An(r,a),ti(r,a,f,p)]),$n(),_n(r),n(!0),s("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const u=St();if(u){ds(u.info.id);const{client:c}=Q({account:u}),{instance:p}=c;$n(),_n(c),s("loading"),(async()=>{try{await An(c,p)}catch{}finally{n(!0),s("default")}})()}else s("default")}},[]);let o=Tt();return T.currentLocation=o.pathname,G(an,[o,t]),/\/https?:/.test(o.pathname)?e(rc,{}):e(R,{children:[e(Hc,{isLoggedIn:t,loading:i==="loading"}),e(qc,{isLoggedIn:t}),i==="default"&&e(mn,{children:e(Ue,{path:"/:instance?/s/:id",element:e(Rc,{})})}),t&&e(_i,{}),t&&e(zo,{}),e(Mo,{}),t&&e(Uo,{}),e($i,{isLoggedIn:t}),i!=="loading"&&e(Fo,{onClose:an}),e(Ri,{})]})}function Hc({isLoggedIn:t,loading:n}){const i=Tt(),s=pe(()=>{const{pathname:o}=i;return!/^\/(login|welcome)/i.test(o)},[i]);return e(mn,{location:s||i,children:[e(Ue,{path:"/",element:t?e(oc,{}):n?e(Ae,{id:"loader-root"}):e(rs,{})}),e(Ue,{path:"/login",element:e(wc,{})}),e(Ue,{path:"/welcome",element:e(rs,{})})]})}function ls(){return T.prevLocation||null}function qc({isLoggedIn:t}){const n=Tt(),i=z(ls());return pe(()=>Lt("/:instance/s/:id",n.pathname)||Lt("/s/:id",n.pathname),[n.pathname,Lt])?i.current||(i.current=ls()):i.current=null,e(mn,{location:i.current||n,children:[t&&e(R,{children:[e(Ue,{path:"/notifications",element:e(qs,{})}),e(Ue,{path:"/mentions",element:e(Hs,{})}),e(Ue,{path:"/following",element:e(Tn,{})}),e(Ue,{path:"/b",element:e(Ns,{})}),e(Ue,{path:"/f",element:e(Ds,{})}),e(Ue,{path:"/l",children:[e(Ue,{index:!0,element:e(lc,{})}),e(Ue,{path:":id",element:e(Os,{})})]}),e(Ue,{path:"/fh",element:e(Ra,{})}),e(Ue,{path:"/ft",element:e(xa,{})}),e(Ue,{path:"/catchup",element:e(ha,{})})]}),e(Ue,{path:"/:instance?/t/:hashtag",element:e(Fs,{})}),e(Ue,{path:"/:instance?/a/:id",element:e(na,{})}),e(Ue,{path:"/:instance?/p",children:[e(Ue,{index:!0,element:e(ln,{})}),e(Ue,{path:"l",element:e(ln,{local:!0})})]}),e(Ue,{path:"/:instance?/trending",element:e(Gs,{})}),e(Ue,{path:"/:instance?/search",element:e(Vs,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));gi(e(mi,{children:e(Bc,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-jOhvYIqm.js.map
