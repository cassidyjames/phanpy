function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./catchup-H1KFAMtd.js","./db-_YTaDKZQ.js","./intl-segmenter-polyfill-XHDQHdV5.js","./db-XRzP4u6M.css","./index-_Y-Lyw2n.js","./catchup-dAbNFyA9.css","./modals-287wETG9.js","./compose-bkkYkwNs.js","./compose-N4NZlEAL.css","./modals-HMWK6usR.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{F as O,_ as V,p as A,s as $,a as H,b as Ct,u as es,c as ut,d as St,w as zt,o as Hs,I,e as t,f as It,M as Ht,g as E,L as At,h as bt,N as Je,i as Ft,R as dn,A as fe,S as xt,j as Vs,k as et,l as js,m as pe,n as Xt,q as Gt,T as Ys,r as Ws,t as se,v as gt,x as oe,y as Gs,z as Jt,B as Rt,C as Ks,D as Yt,E as te,G as ns,H as Qe,J as ss,K as ie,O as Zs,P as ct,Q as _t,U as is,V as Cn,W as Xs,X as os,Y as Js,Z as Qs,$ as Wt,a0 as ti,a1 as as,a2 as ei,a3 as tn,a4 as rs,a5 as ni,a6 as si,a7 as cs,a8 as ii,a9 as ye,aa as ls,ab as re,ac as Mt,ad as ds,ae as us,af as oi,ag as ai,ah as ri,ai as ci,aj as hs,ak as li,al as di,am as He,an as Te,ao as $n,ap as ui,aq as hi,ar as fi,as as fs,at as ps,au as Ae,av as pi,aw as mi,ax as xn,ay as gi,az as An,aA as En,aB as un,aC as wt,aD as ms,aE as bi,aF as vi}from"./db-_YTaDKZQ.js";import{g as pr}from"./intl-segmenter-polyfill-XHDQHdV5.js";var gs=yi;function yi(e,n,s){var i=null,o=null,a=function(){i&&(clearTimeout(i),o=null,i=null)},h=function(){var r=o;a(),r&&r()},c=function(){if(!n)return e.apply(this,arguments);var r=this,l=arguments,u=s&&!i;if(a(),o=function(){e.apply(r,l)},i=setTimeout(function(){if(i=null,!u){var d=o;return o=null,d()}},n),u)return o()};return c.cancel=a,c.flush=h,c}/*!
 * swiped-events.js - v@version@
 * Pure JavaScript swipe events
 * https://github.com/john-doherty/swiped-events
 * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */(function(e,n){"use strict";typeof e.CustomEvent!="function"&&(e.CustomEvent=function(p,g){g=g||{bubbles:!1,cancelable:!1,detail:void 0};var m=n.createEvent("CustomEvent");return m.initCustomEvent(p,g.bubbles,g.cancelable,g.detail),m},e.CustomEvent.prototype=e.Event.prototype),n.addEventListener("touchstart",u,!1),n.addEventListener("touchmove",d,!1),n.addEventListener("touchend",l,!1);var s=null,i=null,o=null,a=null,h=null,c=null,r=0;function l(p){if(c===p.target){var g=parseInt(f(c,"data-swipe-threshold","20"),10),m=f(c,"data-swipe-unit","px"),w=parseInt(f(c,"data-swipe-timeout","500"),10),b=Date.now()-h,v="",S=p.changedTouches||p.touches||[];if(m==="vh"&&(g=Math.round(g/100*n.documentElement.clientHeight)),m==="vw"&&(g=Math.round(g/100*n.documentElement.clientWidth)),Math.abs(o)>Math.abs(a)?Math.abs(o)>g&&b<w&&(o>0?v="swiped-left":v="swiped-right"):Math.abs(a)>g&&b<w&&(a>0?v="swiped-up":v="swiped-down"),v!==""){var y={dir:v.replace(/swiped-/,""),touchType:(S[0]||{}).touchType||"direct",fingers:r,xStart:parseInt(s,10),xEnd:parseInt((S[0]||{}).clientX||-1,10),yStart:parseInt(i,10),yEnd:parseInt((S[0]||{}).clientY||-1,10)};c.dispatchEvent(new CustomEvent("swiped",{bubbles:!0,cancelable:!0,detail:y})),c.dispatchEvent(new CustomEvent(v,{bubbles:!0,cancelable:!0,detail:y}))}s=null,i=null,h=null}}function u(p){p.target.getAttribute("data-swipe-ignore")!=="true"&&(c=p.target,h=Date.now(),s=p.touches[0].clientX,i=p.touches[0].clientY,o=0,a=0,r=p.touches.length)}function d(p){if(!(!s||!i)){var g=p.touches[0].clientX,m=p.touches[0].clientY;o=s-g,a=i-m}}function f(p,g,m){for(;p&&p!==n.documentElement;){var w=p.getAttribute(g);if(w)return w;p=p.parentNode}return m}})(window,document);function me(e=()=>{},n=[]){const s=O(e);V(()=>{s.current=e},[n]),V(()=>{const i=()=>{const o=document.hidden||document.visibilityState==="hidden";s.current(!o)};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)},[])}const wi=1e3*3,Si=15e3,ki=zt(function({isLoggedIn:n}){const[s,i]=A(!0);me(i);const o=async(c,r,l)=>{var u;if($.notificationsLast){const d=c.v1.notifications.list({limit:1,sinceId:$.notificationsLast.id}),{value:f}=await d.next();if(f!=null&&f.length)if(l)$.notificationsShowNew=!0;else{let p;try{const g=await c.v1.markers.fetch({timeline:"notifications"});p=(u=g==null?void 0:g.notifications)==null?void 0:u.lastReadId}catch{}p?$.notificationsShowNew=f[0].id!==p:$.notificationsShowNew=!0}}};V(()=>{let c,r;if(n&&s){const{masto:l,streaming:u,instance:d}=H();(async()=>{await o(l,d);let f=!1;u&&(r=setTimeout(()=>{(async()=>{try{f=!0,c=u.user.notification.subscribe();for await(const p of c){if(!c||!s)break;p.event==="notification"&&Ct(p.payload,d,{skipThreading:!0}),$.notificationsShowNew=!0}}catch{f=!1}f||(r=setInterval(()=>{o(l,d,!0)},Si))})()},wi))})()}return()=>{var l;(l=c==null?void 0:c.unsubscribe)==null||l.call(c),c=null,clearTimeout(r),clearInterval(r)}},[s,n]);const a=O(),h=()=>{a.current=Date.now(),fetch("./version.json").then(c=>c.json()).then(c=>{c&&($.appVersion=c)}).catch(c=>{})};return es(h,s&&1e3*60*30),me(c=>{c&&(a.current?Date.now()-a.current>1e3*60*60&&h():h())}),St("shift+alt+k",()=>{const c=$.settings.cloakMode;$.settings.cloakMode=!c,ut({text:`Cloak mode ${c?"disabled":"enabled"}`})}),null});function Ii(){function e(n){n.shiftKey?Hs()||($.showCompose=!0):$.showCompose=!0}return St("c, shift+c",e,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),t("button",{type:"button",id:"compose-button",onClick:e,children:t(I,{icon:"quill",size:"xl",alt:"Compose"})})}const Ti=zt(function(){const n=It($);function s(){$.showKeyboardShortcutsHelp=!1}return St("?, shift+?, shift+slash",i=>{$.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&t(Ht,{onClose:s,children:t("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:s,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:"Keyboard shortcuts"})}),t("main",{children:t("table",{children:[{action:"Keyboard shortcuts help",keys:t("kbd",{children:"?"})},{action:"Next post",keys:t("kbd",{children:"j"})},{action:"Previous post",keys:t("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"k"})]})},{action:"Load new posts",keys:t("kbd",{children:"."})},{action:"Open post details",keys:t(E,{children:[t("kbd",{children:"Enter"})," or ",t("kbd",{children:"o"})]})},{action:t(E,{children:["Expand content warning or",t("br",{}),"toggle expanded/collapsed thread"]}),keys:t("kbd",{children:"x"})},{action:"Close post or dialogs",keys:t(E,{children:[t("kbd",{children:"Esc"})," or ",t("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:t(E,{children:[t("kbd",{children:"1"})," to ",t("kbd",{children:"9"})]})},{action:"Compose new post",keys:t("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"c"})]})},{action:"Send post",keys:t(E,{children:[t("kbd",{children:"Ctrl"})," + ",t("kbd",{children:"Enter"})," or ",t("kbd",{children:"⌘"})," +"," ",t("kbd",{children:"Enter"})]})},{action:"Search",keys:t("kbd",{children:"/"})},{action:"Reply",keys:t("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:t(E,{children:[t("kbd",{children:"l"})," or ",t("kbd",{children:"f"})]})},{action:"Boost",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"b"})]})},{action:"Bookmark",keys:t("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"Alt"})," + ",t("kbd",{children:"k"})]})}].map(({action:i,className:o,keys:a})=>t("tr",{children:[t("th",{class:o,children:i}),t("td",{children:a})]},i))})})]})})});function en({accountID:e,onChange:n}){const{masto:s}=H(),[i,o]=A("default"),[a,h]=A(null),[c,r]=A(null),l=c!==null;return t("p",{class:"follow-request-buttons",children:[t("button",{type:"button",disabled:i==="loading"||l,onClick:()=>{o("loading"),h("accept"),(async()=>{try{const u=await s.v1.followRequests.$select(e).authorize();if(!(u!=null&&u.followedBy))throw new Error("Follow request not accepted");r(u),n()}catch{}o("default")})()},children:"Accept"})," ",t("button",{type:"button",disabled:i==="loading"||l,class:"light danger",onClick:()=>{o("loading"),h("reject"),(async()=>{try{const u=await s.v1.followRequests.$select(e).reject();if(u!=null&&u.followedBy)throw new Error("Follow request not rejected");r(u),n()}catch{o("default")}})()},children:"Reject"}),t("span",{class:"follow-request-states",children:l&&a?a==="accept"?t(I,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):t(I,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):t(At,{hidden:i!=="loading"})})]})}const Rn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},de={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":e=>`boosted ${e} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":e=>`liked ${e} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":e=>`boosted & liked ${e} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":e=>t(E,{children:["reported ",e]})},Ye=50;function Ci({notification:e,instance:n,isStatic:s,disableContextMenu:i}){var C,F,x,D;const{id:o,status:a,account:h,report:c,_accounts:r,_statuses:l}=e;let{type:u}=e;const d=(a==null?void 0:a.reblog)||a,f=d==null?void 0:d.id,p=bt.session.get("currentAccount"),g=p===(h==null?void 0:h.id),m=(C=a==null?void 0:a.poll)==null?void 0:C.voted,w=!!(a!=null&&a.inReplyToAccountId)&&(a==null?void 0:a.inReplyToAccountId)!==p&&((F=a==null?void 0:a.account)==null?void 0:F.id)===p;let b=0,v=0;if(u==="favourite+reblog"){for(const B of r)(x=B._types)!=null&&x.includes("favourite")&&b++,(D=B._types)!=null&&D.includes("reblog")&&v++;!v&&b&&(u="favourite"),!b&&v&&(u="reblog")}let S;if(u==="poll"?S=de[g?"poll-self":m?"poll-voted":"poll"]:u==="reblog"||u==="favourite"||u==="favourite+reblog"?(l==null?void 0:l.length)>1?S=de[`${u}+account`]:w?S=de[`${u}_reply`]:S=de[u]:de[u]?S=de[u]:S=`[Unknown notification type: ${u}]`,typeof S=="function"){const B=(l==null?void 0:l.length)||(r==null?void 0:r.length);if(B)S=S(B);else if(u==="admin.report"){const L=c==null?void 0:c.targetAccount;L&&(S=S(t(Je,{account:L,showAvatar:!0})))}}if(u==="mention"&&!a)return null;const y=e.createdAt&&new Date(e.createdAt).toLocaleString(),T={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[u]||"Accounts",k=()=>{$.showGenericAccounts={heading:T,accounts:r,showReactions:u==="favourite+reblog",excludeRelationshipAttrs:u==="follow"?["followedBy"]:[]}};return t("div",{class:`notification notification-${u}`,"data-notification-id":o,tabIndex:"0",children:[t("div",{class:`notification-type notification-${u}`,title:y,children:u==="favourite+reblog"?t(E,{children:[t(I,{icon:"rocket",size:"xl",alt:u,class:"reblog-icon"}),t(I,{icon:"heart",size:"xl",alt:u,class:"favourite-icon"})]}):t(I,{icon:Rn[u]||"notification",size:"xl",alt:u})}),t("div",{class:"notification-content",children:[u!=="mention"&&t(E,{children:[t("p",{children:[!/poll|update/i.test(u)&&t(E,{children:(r==null?void 0:r.length)>1?t(E,{children:[t("b",{tabIndex:"0",onClick:k,children:[t("span",{title:r.length,children:Ft(r.length)})," ","people"]})," "]}):t(E,{children:[t(Je,{account:h,showAvatar:!0})," "]})}),S,u==="mention"&&t("span",{class:"insignificant",children:[" ","•"," ",t(dn,{datetime:e.createdAt,format:"micro"})]})]}),u==="follow_request"&&t(en,{accountID:h.id})]}),(r==null?void 0:r.length)>1&&t("p",{class:"avatars-stack",children:[r.slice(0,Ye).map(B=>t(E,{children:[t("a",{href:B.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:L=>{L.preventDefault(),$.showAccount=B},children:[t(fe,{url:B.avatarStatic,size:r.length<=10?"xxl":r.length<20?"xl":r.length<30?"l":r.length<40?"m":"s",alt:`${B.displayName} @${B.acct}`,squircle:B==null?void 0:B.bot},B.id),u==="favourite+reblog"&&t("div",{class:"account-sub-icons",children:B._types.map(L=>t(I,{icon:Rn[L],size:"s",class:`${L}-icon`}))})]},B.id)," "]},B.id)),t("button",{type:"button",class:"small plain",onClick:k,children:[r.length>Ye&&`+${r.length-Ye}`,t(I,{icon:"chevron-down"})]})]}),(l==null?void 0:l.length)>1&&t("ul",{class:"notification-group-statuses",children:l.map(B=>t("li",{children:t(Mn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${B.id}`:`/s/${B.id}`,children:t(xt,{status:B,size:"s",previewMode:!0,allowContextMenu:!0})})},B.id))}),a&&(!(l!=null&&l.length)||(l==null?void 0:l.length)<=1)&&t(Mn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${f}`:`/s/${f}`,onContextMenu:i?void 0:B=>{const L=B.target.querySelector(".status");if(L){if(B.metaKey)return;B.preventDefault(),L.dispatchEvent(new MouseEvent("contextmenu",{clientX:B.clientX,clientY:B.clientY}))}},children:s?t(xt,{status:d,size:"s",readOnly:!0,allowContextMenu:!0}):t(xt,{statusID:f,size:"s",readOnly:!0,allowContextMenu:!0})})]})]})}function Mn(e){const n=Vs();return t(et,{...e,"data-read-more":"Read more →",ref:n})}const hn=zt(Ci,(e,n)=>{var s,i;return((s=e.notification)==null?void 0:s.id)===((i=n.notification)==null?void 0:i.id)});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{const{type:n,id:s,accessToken:i}=(e==null?void 0:e.data)||{};n==="notification"&&($.routeNotification={id:s,accessToken:i})});const $i=zt(function(){if(!("serviceWorker"in navigator))return null;const n=It($),{routeNotification:s}=n,{id:i,accessToken:o}=s||{},[a,h]=A(!1);Xt(()=>{if(!i||!o)return;const{instance:r}=H(),{masto:l,instance:u}=H({accessToken:o}),d=r===u,f=o?js(o):pe();(async()=>{const p=await l.v1.notifications.$select(i).fetch();if(p&&f){const g=f.instanceURL,{type:m,status:w,account:b}=p,v=!!document.querySelector("#modal-container > *"),S=m==="follow"&&!!(b!=null&&b.id),y=!!(b!=null&&b.id),T=!!(w!=null&&w.id);S&&d?$.showAccount={account:b,instance:g}:v||!d||y&&T?h({id:i,account:f,notification:p,sameInstance:d}):T?location.hash=`/${r}/s/${w.id}`:S?location.hash=`/${r}/a/${b.id}`:location.hash="/notifications"}})()},[i,o]),Xt(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),me(r=>{r&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const c=()=>{h(!1),$.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(a){const{id:r,account:l,notification:u,sameInstance:d}=a;return t(Ht,{onClick:f=>{f.target===f.currentTarget&&c()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:c,children:t(I,{icon:"x"})}),t("header",{children:t("b",{children:"Notification"})}),t("main",{children:[!d&&t("p",{children:"This notification is from your other account."}),t("div",{class:"notification-peek",onClick:f=>{const{target:p}=f;(f.target.tagName==="BUTTON"||f.target.tagName==="A")&&c()},children:t(hn,{instance:l.instanceURL,notification:u,isStatic:!0})}),t("div",{style:{textAlign:"end"},children:t(et,{to:"/notifications",class:"button light",onClick:c,children:[t("span",{children:"View all notifications"})," ",t(I,{icon:"arrow-right"})]})})]})]})})}return null}),bs=Ws((e,n)=>{const{instance:s}=H(),[i,o]=Gt(),[a,h]=A(!1),[c,r]=A(i.get("q")||""),l=i.get("type"),u=O(null),d=O(null);return Ys(n,()=>({setValue:f=>{r(f)},focus:()=>{d.current.focus()},select:()=>{d.current.select()},blur:()=>{d.current.blur()}})),t("form",{ref:u,class:"search-popover-container",onSubmit:f=>{var g;if(f.preventDefault(),/\/search/.test(location.hash))if(c){const m={q:c};l&&(m.type=l),o(m)}else o({});else c?location.hash=`/search?q=${encodeURIComponent(c)}${l?`&type=${l}`:""}`:location.hash="/search";(g=e==null?void 0:e.onSubmit)==null||g.call(e,f)},children:[t("input",{ref:d,value:c,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellCheck:"false",onSearch:f=>{f.target.value||o({})},onInput:f=>{r(f.target.value),h(!0)},onFocus:()=>{var f,p;h(!0),(p=(f=u.current)==null?void 0:f.querySelector(".search-popover-item"))==null||p.classList.add("focus")},onBlur:()=>{var f,p;setTimeout(()=>{h(!1)},100),(p=(f=u.current)==null?void 0:f.querySelector(".search-popover-item.focus"))==null||p.classList.remove("focus")},onKeyDown:f=>{var g;const{key:p}=f;switch(p){case"Escape":h(!1);break;case"Down":case"ArrowDown":if(f.preventDefault(),a){const m=u.current.querySelector(".search-popover-item.focus");if(m){let w=m.nextElementSibling;for(;w&&w.hidden;)w=w.nextElementSibling;w&&(w.classList.add("focus"),Array.from(w.parentElement.children).filter(v=>v!==w).forEach(v=>{v.classList.remove("focus")}))}else{const w=u.current.querySelector(".search-popover-item");w&&w.classList.add("focus")}}break;case"Up":case"ArrowUp":if(f.preventDefault(),a){const m=document.querySelector(".search-popover-item.focus");if(m){let w=m.previousElementSibling;for(;w&&w.hidden;)w=w.previousElementSibling;w&&(w.classList.add("focus"),Array.from(w.parentElement.children).filter(v=>v!==w).forEach(v=>{v.classList.remove("focus")}))}else{const w=document.querySelector(".search-popover-item:last-child");w&&w.classList.add("focus")}}break;case"Enter":if(a){const m=document.querySelector(".search-popover-item.focus");m&&(f.preventDefault(),m.click()),h(!1),(g=e==null?void 0:e.onSubmit)==null||g.call(e,f)}break}}}),t("div",{class:"search-popover",hidden:!a||!c,children:!!c&&[{label:t(E,{children:[c," ",t("small",{class:"insignificant",children:"‒ accounts, hashtags & posts"})]}),to:`/search?q=${encodeURIComponent(c)}`,top:!l&&!/\s/.test(c),hidden:!!l},{label:t(E,{children:["Posts with ",t("q",{children:c})]}),to:`/search?q=${encodeURIComponent(c)}&type=statuses`,hidden:/^https?:/.test(c),top:/\s/.test(c),icon:"document",queryType:"statuses"},{label:t(E,{children:["Posts tagged with ",t("mark",{children:["#",c.replace(/^#/,"")]})]}),to:`/${s}/t/${c.replace(/^#/,"")}`,hidden:/^@/.test(c)||/^https?:/.test(c)||/\s/.test(c),top:/^#/.test(c),type:"link",icon:"hashtag",queryType:"hashtags"},{label:t(E,{children:["Look up ",t("mark",{children:c})]}),to:`/${c}`,hidden:!/^https?:/.test(c),top:/^https?:/.test(c),type:"link"},{label:t(E,{children:["Accounts with ",t("q",{children:c})]}),to:`/search?q=${encodeURIComponent(c)}&type=accounts`,icon:"group",queryType:"accounts"}].sort((f,p)=>{if(l){if(f.queryType===l)return-1;if(p.queryType===l)return 1}return f.top&&!p.top?-1:!f.top&&p.top?1:0}).filter(({hidden:f})=>!f).map(({label:f,to:p,icon:g,type:m},w)=>t(et,{to:p,class:`search-popover-item ${w===0?"focus":""}`,onClick:b=>{var v;(v=e==null?void 0:e.onSubmit)==null||v.call(e,b)},children:[t(I,{icon:g||(m==="link"?"arrow-right":"search"),class:"more-insignificant"}),t("span",{children:f})," "]}))})]})}),xi=zt(function({onClose:n=()=>{}}){const[s,i]=A(!1),o=O(null);St(["Slash","/"],h=>{i(!0),setTimeout(()=>{var c,r,l,u;(r=(c=o.current)==null?void 0:c.focus)==null||r.call(c),(u=(l=o.current)==null?void 0:l.select)==null||u.call(l)},0)},{preventDefault:!0,ignoreEventWhen:h=>{const c=/\/search/.test(location.hash),r=!!document.querySelector("#modal-container > *");return c||r}});const a=()=>{i(!1),n()};return St("esc",h=>{var c,r;(r=(c=o.current)==null?void 0:c.blur)==null||r.call(c),a()},{enabled:s,enableOnFormTags:!0,preventDefault:!0}),t("div",{id:"search-command-container",hidden:!s,onClick:h=>{h.target===h.currentTarget&&a()},children:t(bs,{ref:o,onSubmit:()=>{a()}})})}),vs=new Set,Nt=new WeakMap,ge=new WeakMap,ae=new WeakMap,nn=new WeakMap,Ai=new WeakMap,be=new WeakMap,Be=new WeakMap,ke=new WeakSet;let ee,fn=0,pn=0;const Kt="__aa_tgt",Ce="__aa_del",Fe="__aa_new",Ei=e=>{const n=Ni(e);n&&n.forEach(s=>Pi(s))},Ri=e=>{e.forEach(n=>{n.target===ee&&Li(),Nt.has(n.target)&&ce(n.target)})};function Mi(e){const n=nn.get(e);n==null||n.disconnect();let s=Nt.get(e),i=0;const o=5;s||(s=ve(e),Nt.set(e,s));const{offsetWidth:a,offsetHeight:h}=ee,r=[s.top-o,a-(s.left+o+s.width),h-(s.top+o+s.height),s.left-o].map(u=>`${-1*Math.floor(u)}px`).join(" "),l=new IntersectionObserver(()=>{++i>1&&ce(e)},{root:ee,threshold:1,rootMargin:r});l.observe(e),nn.set(e,l)}function ce(e){clearTimeout(Be.get(e));const n=Ve(e),s=$e(n)?500:n.duration;Be.set(e,setTimeout(async()=>{const i=ae.get(e);try{await(i==null?void 0:i.finished),Nt.set(e,ve(e)),Mi(e)}catch{}},s))}function Li(){clearTimeout(Be.get(ee)),Be.set(ee,setTimeout(()=>{vs.forEach(e=>ks(e,n=>ys(()=>ce(n))))},100))}function _i(e){setTimeout(()=>{Ai.set(e,setInterval(()=>ys(ce.bind(null,e)),2e3))},Math.round(2e3*Math.random()))}function ys(e){typeof requestIdleCallback=="function"?requestIdleCallback(()=>e()):requestAnimationFrame(()=>e())}let sn,he;typeof window<"u"&&(ee=document.documentElement,sn=new MutationObserver(Ei),he=new ResizeObserver(Ri),window.addEventListener("scroll",()=>{pn=window.scrollY,fn=window.scrollX}),he.observe(ee));function Ni(e){return e.reduce((i,o)=>[...i,...Array.from(o.addedNodes),...Array.from(o.removedNodes)],[]).every(i=>i.nodeName==="#comment")?!1:e.reduce((i,o)=>{if(i===!1)return!1;if(o.target instanceof Element){if(We(o.target),!i.has(o.target)){i.add(o.target);for(let a=0;a<o.target.children.length;a++){const h=o.target.children.item(a);if(h){if(Ce in h)return!1;We(o.target,h),i.add(h)}}}if(o.removedNodes.length)for(let a=0;a<o.removedNodes.length;a++){const h=o.removedNodes[a];if(Ce in h)return!1;h instanceof Element&&(i.add(h),We(o.target,h),ge.set(h,[o.previousSibling,o.nextSibling]))}}return i},new Set)}function We(e,n){!n&&!(Kt in e)?Object.defineProperty(e,Kt,{value:e}):n&&!(Kt in n)&&Object.defineProperty(n,Kt,{value:e})}function Pi(e){var n;const s=e.isConnected,i=Nt.has(e);s&&ge.has(e)&&ge.delete(e),ae.has(e)&&((n=ae.get(e))===null||n===void 0||n.cancel()),Fe in e?Ln(e):i&&s?Ui(e):i&&!s?Oi(e):Ln(e)}function jt(e){return Number(e.replace(/[^0-9.\-]/g,""))}function Di(e){let n=e.parentElement;for(;n;){if(n.scrollLeft||n.scrollTop)return{x:n.scrollLeft,y:n.scrollTop};n=n.parentElement}return{x:0,y:0}}function ve(e){const n=e.getBoundingClientRect(),{x:s,y:i}=Di(e);return{top:n.top+i,left:n.left+s,width:n.width,height:n.height}}function ws(e,n,s){let i=n.width,o=n.height,a=s.width,h=s.height;const c=getComputedStyle(e);if(c.getPropertyValue("box-sizing")==="content-box"){const l=jt(c.paddingTop)+jt(c.paddingBottom)+jt(c.borderTopWidth)+jt(c.borderBottomWidth),u=jt(c.paddingLeft)+jt(c.paddingRight)+jt(c.borderRightWidth)+jt(c.borderLeftWidth);i-=u,a-=u,o-=l,h-=l}return[i,a,o,h].map(Math.round)}function Ve(e){return Kt in e&&be.has(e[Kt])?be.get(e[Kt]):{duration:250,easing:"ease-in-out"}}function Ss(e){if(Kt in e)return e[Kt]}function mn(e){const n=Ss(e);return n?ke.has(n):!1}function ks(e,...n){n.forEach(s=>s(e,be.has(e)));for(let s=0;s<e.children.length;s++){const i=e.children.item(s);i&&n.forEach(o=>o(i,be.has(i)))}}function gn(e){return Array.isArray(e)?e:[e]}function $e(e){return typeof e=="function"}function Ui(e){const n=Nt.get(e),s=ve(e);if(!mn(e))return Nt.set(e,s);let i;if(!n)return;const o=Ve(e);if(typeof o!="function"){const a=n.left-s.left,h=n.top-s.top,[c,r,l,u]=ws(e,n,s),d={transform:`translate(${a}px, ${h}px)`},f={transform:"translate(0, 0)"};c!==r&&(d.width=`${c}px`,f.width=`${r}px`),l!==u&&(d.height=`${l}px`,f.height=`${u}px`),i=e.animate([d,f],{duration:o.duration,easing:o.easing})}else{const[a]=gn(o(e,"remain",n,s));i=new Animation(a),i.play()}ae.set(e,i),Nt.set(e,s),i.addEventListener("finish",ce.bind(null,e))}function Ln(e){Fe in e&&delete e[Fe];const n=ve(e);Nt.set(e,n);const s=Ve(e);if(!mn(e))return;let i;if(typeof s!="function")i=e.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:s.duration*1.5,easing:"ease-in"});else{const[o]=gn(s(e,"add",n));i=new Animation(o),i.play()}ae.set(e,i),i.addEventListener("finish",ce.bind(null,e))}function _n(e,n){var s;e.remove(),Nt.delete(e),ge.delete(e),ae.delete(e),(s=nn.get(e))===null||s===void 0||s.disconnect(),setTimeout(()=>{if(Ce in e&&delete e[Ce],Object.defineProperty(e,Fe,{value:!0,configurable:!0}),n&&e instanceof HTMLElement)for(const i in n)e.style[i]=""},0)}function Oi(e){var n;if(!ge.has(e)||!Nt.has(e))return;const[s,i]=ge.get(e);Object.defineProperty(e,Ce,{value:!0,configurable:!0});const o=window.scrollX,a=window.scrollY;if(i&&i.parentNode&&i.parentNode instanceof Element?i.parentNode.insertBefore(e,i):s&&s.parentNode?s.parentNode.appendChild(e):(n=Ss(e))===null||n===void 0||n.appendChild(e),!mn(e))return _n(e);const[h,c,r,l]=Fi(e),u=Ve(e),d=Nt.get(e);(o!==fn||a!==pn)&&Bi(e,o,a,u);let f,p={position:"absolute",top:`${h}px`,left:`${c}px`,width:`${r}px`,height:`${l}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!$e(u))Object.assign(e.style,p),f=e.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:u.duration,easing:"ease-out"});else{const[g,m]=gn(u(e,"remove",d));(m==null?void 0:m.styleReset)!==!1&&(p=(m==null?void 0:m.styleReset)||p,Object.assign(e.style,p)),f=new Animation(g),f.play()}ae.set(e,f),f.addEventListener("finish",_n.bind(null,e,p))}function Bi(e,n,s,i){const o=fn-n,a=pn-s,h=document.documentElement.style.scrollBehavior;if(getComputedStyle(ee).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+o,window.scrollY+a),!e.parentElement)return;const r=e.parentElement;let l=r.clientHeight,u=r.clientWidth;const d=performance.now();function f(){requestAnimationFrame(()=>{if(!$e(i)){const p=l-r.clientHeight,g=u-r.clientWidth;d+i.duration>performance.now()?(window.scrollTo({left:window.scrollX-g,top:window.scrollY-p}),l=r.clientHeight,u=r.clientWidth,f()):document.documentElement.style.scrollBehavior=h}})}f()}function Fi(e){const n=Nt.get(e),[s,,i]=ws(e,n,ve(e));let o=e.parentElement;for(;o&&(getComputedStyle(o).position==="static"||o instanceof HTMLBodyElement);)o=o.parentElement;o||(o=document.body);const a=getComputedStyle(o),h=Nt.get(o)||ve(o),c=Math.round(n.top-h.top)-jt(a.borderTopWidth),r=Math.round(n.left-h.left)-jt(a.borderLeftWidth);return[c,r,s,i]}function zi(e,n={}){return sn&&he&&(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!$e(n)&&!n.disrespectUserMotionPreference||(ke.add(e),getComputedStyle(e).position==="static"&&Object.assign(e.style,{position:"relative"}),ks(e,ce,_i,o=>he==null?void 0:he.observe(o)),$e(n)?be.set(e,n):be.set(e,{duration:250,easing:"ease-in-out",...n}),sn.observe(e,{childList:!0}),vs.add(e))),Object.freeze({parent:e,enable:()=>{ke.add(e)},disable:()=>{ke.delete(e)},isEnabled:()=>ke.has(e)})}function Is(e){const n=O(null),[s,i]=A(),o=a=>{s&&(a?s.enable():s.disable())};return V(()=>{n.current instanceof HTMLElement&&i(zi(n.current,e||{}))},[]),[n,o]}var bn={exports:{}},mr=bn.exports;(function(e){var n=function(){var s=String.fromCharCode,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",a={};function h(r,l){if(!a[r]){a[r]={};for(var u=0;u<r.length;u++)a[r][r.charAt(u)]=u}return a[r][l]}var c={compressToBase64:function(r){if(r==null)return"";var l=c._compress(r,6,function(u){return i.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(r){return r==null?"":r==""?null:c._decompress(r.length,32,function(l){return h(i,r.charAt(l))})},compressToUTF16:function(r){return r==null?"":c._compress(r,15,function(l){return s(l+32)})+" "},decompressFromUTF16:function(r){return r==null?"":r==""?null:c._decompress(r.length,16384,function(l){return r.charCodeAt(l)-32})},compressToUint8Array:function(r){for(var l=c.compress(r),u=new Uint8Array(l.length*2),d=0,f=l.length;d<f;d++){var p=l.charCodeAt(d);u[d*2]=p>>>8,u[d*2+1]=p%256}return u},decompressFromUint8Array:function(r){if(r==null)return c.decompress(r);for(var l=new Array(r.length/2),u=0,d=l.length;u<d;u++)l[u]=r[u*2]*256+r[u*2+1];var f=[];return l.forEach(function(p){f.push(s(p))}),c.decompress(f.join(""))},compressToEncodedURIComponent:function(r){return r==null?"":c._compress(r,6,function(l){return o.charAt(l)})},decompressFromEncodedURIComponent:function(r){return r==null?"":r==""?null:(r=r.replace(/ /g,"+"),c._decompress(r.length,32,function(l){return h(o,r.charAt(l))}))},compress:function(r){return c._compress(r,16,function(l){return s(l)})},_compress:function(r,l,u){if(r==null)return"";var d,f,p={},g={},m="",w="",b="",v=2,S=3,y=2,T=[],k=0,C=0,F;for(F=0;F<r.length;F+=1)if(m=r.charAt(F),Object.prototype.hasOwnProperty.call(p,m)||(p[m]=S++,g[m]=!0),w=b+m,Object.prototype.hasOwnProperty.call(p,w))b=w;else{if(Object.prototype.hasOwnProperty.call(g,b)){if(b.charCodeAt(0)<256){for(d=0;d<y;d++)k=k<<1,C==l-1?(C=0,T.push(u(k)),k=0):C++;for(f=b.charCodeAt(0),d=0;d<8;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1}else{for(f=1,d=0;d<y;d++)k=k<<1|f,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1}v--,v==0&&(v=Math.pow(2,y),y++),delete g[b]}else for(f=p[b],d=0;d<y;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1;v--,v==0&&(v=Math.pow(2,y),y++),p[w]=S++,b=String(m)}if(b!==""){if(Object.prototype.hasOwnProperty.call(g,b)){if(b.charCodeAt(0)<256){for(d=0;d<y;d++)k=k<<1,C==l-1?(C=0,T.push(u(k)),k=0):C++;for(f=b.charCodeAt(0),d=0;d<8;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1}else{for(f=1,d=0;d<y;d++)k=k<<1|f,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1}v--,v==0&&(v=Math.pow(2,y),y++),delete g[b]}else for(f=p[b],d=0;d<y;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1;v--,v==0&&(v=Math.pow(2,y),y++)}for(f=2,d=0;d<y;d++)k=k<<1|f&1,C==l-1?(C=0,T.push(u(k)),k=0):C++,f=f>>1;for(;;)if(k=k<<1,C==l-1){T.push(u(k));break}else C++;return T.join("")},decompress:function(r){return r==null?"":r==""?null:c._decompress(r.length,32768,function(l){return r.charCodeAt(l)})},_decompress:function(r,l,u){var d=[],f,p=4,g=4,m=3,w="",b=[],v,S,y,T,k,C,F,x={val:u(0),position:l,index:1};for(v=0;v<3;v+=1)d[v]=v;for(y=0,k=Math.pow(2,2),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),y|=(T>0?1:0)*C,C<<=1;switch(f=y){case 0:for(y=0,k=Math.pow(2,8),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),y|=(T>0?1:0)*C,C<<=1;F=s(y);break;case 1:for(y=0,k=Math.pow(2,16),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),y|=(T>0?1:0)*C,C<<=1;F=s(y);break;case 2:return""}for(d[3]=F,S=F,b.push(F);;){if(x.index>r)return"";for(y=0,k=Math.pow(2,m),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),y|=(T>0?1:0)*C,C<<=1;switch(F=y){case 0:for(y=0,k=Math.pow(2,8),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),y|=(T>0?1:0)*C,C<<=1;d[g++]=s(y),F=g-1,p--;break;case 1:for(y=0,k=Math.pow(2,16),C=1;C!=k;)T=x.val&x.position,x.position>>=1,x.position==0&&(x.position=l,x.val=u(x.index++)),y|=(T>0?1:0)*C,C<<=1;d[g++]=s(y),F=g-1,p--;break;case 2:return b.join("")}if(p==0&&(p=Math.pow(2,m),m++),d[F])w=d[F];else if(F===g)w=S+S.charAt(0);else return null;b.push(w),d[g++]=S+w.charAt(0),p--,S=w,p==0&&(p=Math.pow(2,m),m++)}}};return c}();e!=null?e.exports=n:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return n})})(bn);var Nn=bn.exports;const qi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",Hi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",Vi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",ji=200,Yi=10;async function ze(){const{masto:e}=H(),n=e.v1.followedTags.list({limit:ji}),s=[];let i=0;do{const{value:o,done:a}=await n.next();if(a||(o==null?void 0:o.length)===0)break;s.push(...o),i++}while(i<Yi);return s.sort((o,a)=>o.name.localeCompare(a.name)),s.length&&setTimeout(()=>{bt.account.set("followedTags",{tags:s,updatedAt:Date.now()})},1),s}const Wi=24*60*60*1e3;async function Gi(){try{const{tags:e,updatedAt:n}=bt.account.get("followedTags")||{};return e!=null&&e.length?(Date.now()-n>Wi&&ze(),e):await ze()}catch{return[]}}const Pn=document.createElement("div"),Ki=e=>{if(!e)return[];if(e.indexOf("#")===-1)return[];Pn.innerHTML=e;const n=Pn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(s=>s.innerText.trim().replace(/^[^#]*#+/,"")):[]};function on({children:e}){if(typeof e=="string")return e;const[n,s]=A("");return V(()=>{Promise.resolve(e).then(s)},[e]),n}const Zt=9,Zi=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],Ts={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},Pe={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},Xi=se(async({id:e})=>(await H().masto.v1.lists.$select(e).fetch()).title),Ji=se(async({id:e})=>{const n=await H().masto.v1.accounts.$select(e).fetch();return n.username||n.acct||n.displayName}),qe={following:{id:"home",title:(e,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:Xi,path:({id:e})=>`/l/${e}`,icon:"list"},public:{id:"public",title:({local:e})=>e?"Local":"Federated",subtitle:({instance:e})=>e||H().instance,path:({local:e,instance:n})=>`/${n}/p${e?"/l":""}`,icon:({local:e})=>e?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:e})=>e||H().instance,path:({instance:e})=>`/${e}/trending`,icon:"chart"},search:{id:"search",title:({query:e})=>e?`“${e}”`:"Search",path:({query:e})=>e?`/search?q=${encodeURIComponent(e)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:e})=>e?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:Ji,path:({id:e})=>`/a/${e}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:e})=>e,subtitle:({instance:e})=>e||H().instance,path:({hashtag:e,instance:n,media:s})=>`${n?`/${n}`:""}/t/${e.split(/\s+/).join("+")}${s?"?media=1":""}`,icon:"hashtag"}};function gr({onClose:e}){const n=It($),{shortcuts:s}=n,[i,o]=A(!1),[a,h]=A(!1),[c]=Is();return t("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:[t(I,{icon:"shortcut"})," Shortcuts"," ",t("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),t("main",{children:[t("p",{children:"Specify a list of shortcuts that'll appear as:"}),t("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:qi},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Vi},{value:"multi-column",label:"Multi-column",imgURL:Hi}].map(({value:r,label:l,imgURL:u})=>{const d=n.settings.shortcutsViewMode===r||r==="float-button"&&!n.settings.shortcutsViewMode;return t("label",{class:d?"checked":"",children:[t("input",{type:"radio",name:"shortcuts-view-mode",value:r,checked:d,onChange:f=>{$.settings.shortcutsViewMode=f.target.value}})," ",t("img",{src:u,alt:"",width:"80",height:"58"})," ",t("span",{children:l})]},r)})}),s.length>0?t(E,{children:[t("ol",{class:"shortcuts-list",ref:c,children:s.filter(Boolean).map((r,l)=>{const u=Object.values(r).join("-"),{type:d}=r;if(!qe[d])return null;let{icon:f,title:p,subtitle:g,excludeViewMode:m}=qe[d];typeof p=="function"&&(p=p(r,l)),typeof g=="function"&&(g=g(r,l)),typeof f=="function"&&(f=f(r,l)),typeof m=="function"&&(m=m(r,l));const w=m==null?void 0:m.includes(n.settings.shortcutsViewMode);return t("li",{children:[t(I,{icon:f}),t("span",{class:"shortcut-text",children:[t(on,{children:p}),g&&t(E,{children:[" ",t("small",{class:"ib insignificant",children:g})]}),w&&t("span",{class:"tag",children:"Not available in current view mode"})]}),t("span",{class:"shortcut-actions",children:[t("button",{type:"button",class:"plain small",disabled:l===0,onClick:()=>{const b=Array.from($.shortcuts);if(l>0){const v=$.shortcuts[l-1];b[l-1]=r,b[l]=v,$.shortcuts=b}},children:t(I,{icon:"arrow-up",alt:"Move up"})}),t("button",{type:"button",class:"plain small",disabled:l===s.length-1,onClick:()=>{const b=Array.from($.shortcuts);if(l<$.shortcuts.length-1){const v=$.shortcuts[l+1];b[l+1]=r,b[l]=v,$.shortcuts=b}},children:t(I,{icon:"arrow-down",alt:"Move down"})}),t("button",{type:"button",class:"plain small",onClick:()=>{o({shortcut:r,shortcutIndex:l})},children:t(I,{icon:"pencil",alt:"Edit"})})]})]},u)})}),s.length===1&&n.settings.shortcutsViewMode!=="float-button"&&t("div",{class:"ui-state insignificant",children:[t(I,{icon:"info"})," ",t("small",{children:"Add more than one shortcut/column to make this work."})]})]}):t("div",{class:"ui-state insignificant",children:[t("p",{children:n.settings.shortcutsViewMode==="multi-column"?"No columns yet. Tap on the Add column button.":"No shortcuts yet. Tap on the Add shortcut button."}),t("p",{children:["Not sure what to add?",t("br",{}),"Try adding"," ",t("a",{href:"#",onClick:r=>{r.preventDefault(),$.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),t("p",{class:"insignificant",children:s.length>=Zt&&(n.settings.shortcutsViewMode==="multi-column"?`Max ${Zt} columns`:`Max ${Zt} shortcuts`)}),t("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t("button",{type:"button",class:"light",onClick:()=>h(!0),children:"Import/export"}),t("button",{type:"button",disabled:s.length>=Zt,onClick:()=>o(!0),children:[t(I,{icon:"plus"})," ",t("span",{children:n.settings.shortcutsViewMode==="multi-column"?"Add column…":"Add shortcut…"})]})]})]}),i&&t(Ht,{onClick:r=>{r.target===r.currentTarget&&o(!1)},children:t(eo,{shortcut:i.shortcut,shortcutIndex:i.shortcutIndex,onSubmit:({result:r,mode:l})=>{l==="edit"?$.shortcuts[i.shortcutIndex]=r:$.shortcuts.push(r)},onClose:()=>o(!1)})}),a&&t(Ht,{onClick:r=>{r.target===r.currentTarget&&h(!1)},children:t(no,{shortcuts:s,onClose:()=>h(!1)})})]})}const Qi=1e3*60,to=se(()=>{const{masto:e}=H();return e.v1.lists.list()},{maxAge:Qi}),Dn={search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function eo({onSubmit:e,disabled:n,shortcut:s,shortcutIndex:i,onClose:o}){var w,b;const a=!!s,[h,c]=A((s==null?void 0:s.type)||null),{masto:r}=H(),[l,u]=A("default"),[d,f]=A([]),[p,g]=A([]);V(()=>{(async()=>{if(h==="list")try{u("loading");const v=await to();v.sort((S,y)=>S.title.localeCompare(y.title)),f(v),u("default")}catch{u("error")}})(),(async()=>{if(h==="hashtag")try{const v=await ze();g(v)}catch{}})()},[h]);const m=O();return V(()=>{if(a&&h&&Pe[h]){const v=m.current;Pe[h].forEach(({name:S,type:y})=>{const T=v.querySelector(`[name="${S}"]`);T&&s[S]&&(y==="checkbox"?T.checked=s[S]==="on":T.value=s[S])})}},[a,h]),t("div",{id:"shortcut-settings-form",class:"sheet",children:[!!o&&t("button",{type:"button",class:"sheet-close",onClick:o,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:[a?"Edit":"Add"," shortcut"]})}),t("main",{tabindex:"-1",children:t("form",{ref:m,onSubmit:v=>{v.preventDefault();const S=new FormData(v.target),y={};S.forEach((T,k)=>{y[k]=T==null?void 0:T.trim(),k==="instance"&&(y[k]=y[k].replace(/^https?:\/\//,"").replace(/\/+$/,""),y[k]=y[k].replace(/^@?[^@]+@/,""))}),y.type&&(e({result:y,mode:a?"edit":"add"}),v.target.reset(),c(null),o==null||o())},children:[t("p",{children:t("label",{children:[t("span",{children:"Timeline"}),t("select",{required:!0,disabled:n,onChange:v=>{c(v.target.value)},defaultValue:a?s.type:void 0,name:"type",children:[t("option",{}),Zi.map(v=>t("option",{value:v,children:Ts[v]}))]})]})}),(b=(w=Pe[h])==null?void 0:w.map)==null?void 0:b.call(w,({text:v,name:S,type:y,placeholder:T,pattern:k,notRequired:C})=>h==="list"?t("p",{children:t("label",{children:[t("span",{children:"List"}),t("select",{name:"id",required:!C,disabled:n||l==="loading",defaultValue:a?s.id:void 0,children:d.map(F=>t("option",{value:F.id,children:F.title}))})]})}):t("p",{children:t("label",{children:[t("span",{children:v})," ",t("input",{type:y,switch:y==="checkbox"||void 0,name:S,placeholder:T,required:y==="text"&&!C,disabled:n,list:h==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:k}),h==="hashtag"&&p.length>0&&t("datalist",{id:"followed-hashtags-datalist",children:p.map(F=>t("option",{value:F.name}))})]})})),!!Dn[h]&&t("p",{class:"form-note insignificant",children:[t(I,{icon:"info"}),Dn[h]]}),t("footer",{children:[t("button",{type:"submit",class:"block",disabled:n||l==="loading",children:a?"Save":"Add"}),a&&t("button",{type:"button",class:"light danger",onClick:()=>{$.shortcuts.splice(i,1),o==null||o()},children:"Remove"})]})]})})]})}function no({shortcuts:e,onClose:n}){var d;const{masto:s}=H(),i=gt(()=>!e||!e.filter(Boolean).length?"":Nn.compressToEncodedURIComponent(JSON.stringify(e.filter(Boolean))),[e]),[o,a]=A(""),[h,c]=A("default"),r=gt(()=>{if(!o)return c("default"),null;try{const f=JSON.parse(Nn.decompressFromEncodedURIComponent(o));if(!Array.isArray(f))throw new Error("Not an array");return c("default"),f}catch{try{const p=JSON.parse(o);if(!Array.isArray(p))throw new Error("Not an array");return c("default"),p}catch{return c("error"),null}}},[o]),l=$.shortcuts.length>0,u=O();return t("div",{id:"import-export-container",class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:["Import/Export ",t("small",{class:"ib insignificant",children:"Shortcuts"})]})}),t("main",{tabindex:"-1",children:[t("section",{children:[t("h3",{children:[t(I,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Import"})]}),t("p",{class:"field-button",children:[t("input",{ref:u,type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:f=>{a(f.target.value)}}),$.settings.shortcutSettingsCloudImportExport&&t("button",{type:"button",class:"plain2 small",disabled:h==="cloud-downloading",onClick:async()=>{c("cloud-downloading");const f=bt.session.get("currentAccount");ut("Downloading saved shortcuts from instance server…");try{const g=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(g){const{note:m=""}=g;if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const w=m.match(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/)[1],{v:b,dt:v,data:S}=JSON.parse(w);u.current.value=S,u.current.dispatchEvent(new Event("input"))}}c("default")}catch{c("error"),ut("Unable to download shortcuts")}},title:"Download shortcuts from instance server",children:[t(I,{icon:"cloud"}),t(I,{icon:"arrow-down"})]})]}),!!r&&Array.isArray(r)&&t(E,{children:[t("p",{children:[t("b",{children:r.length})," shortcut",r.length>1?"s":""," ",t("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),t("ol",{class:"import-settings-list",children:r.map(f=>{var p,g;return t("li",{children:[t("span",{style:{opacity:e.some(m=>Object.keys(m).every(w=>m[w]===f[w]))?1:0},children:"*"}),t("span",{children:[Ts[f.type],f.type==="list"&&" ⚠️"," ",(g=(p=Pe[f.type])==null?void 0:p.map)==null?void 0:g.call(p,({text:m,name:w,type:b})=>f[w]?t(E,{children:[t("span",{class:"tag collapsed insignificant",children:[m,":"," ",b==="checkbox"?f[w]==="on"?"✅":"❌":f[w]]})," "]}):null)]})]})})}),t("p",{children:[t("small",{children:"* Exists in current shortcuts"}),t("br",{}),t("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),h==="error"&&t("p",{class:"error",children:t("small",{children:"⚠️ Invalid settings format"})}),t("p",{children:[l&&t(E,{children:[t(oe,{confirmLabel:"Append to current shortcuts?",menuFooter:t("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const f=r.filter(m=>!$.shortcuts.some(w=>Object.keys(w).every(b=>w[b]===m[b])));if(!f.length){ut("No new shortcuts to import");return}let p=[...$.shortcuts,...f];const g=p.length>Zt;g&&(p=p.slice(0,Zt)),$.shortcuts=p,ut(g?`Shortcuts imported. Exceeded max ${Zt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!r,children:"Import & append…"})})," "]}),t(oe,{confirmLabel:l?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:l?"danger":void 0,onClick:()=>{$.shortcuts=r,ut("Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!r,children:l?"or override…":"Import…"})})]})]}),t("section",{children:[t("h3",{children:[t(I,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Export"})]}),t("p",{children:t("input",{style:{width:"100%"},type:"text",value:i,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),ut("Shortcuts copied")}catch{ut("Unable to copy shortcuts")}}}})}),t("p",{children:[t("button",{type:"button",class:"plain2",disabled:!i,onClick:()=>{try{navigator.clipboard.writeText(i),ut("Shortcut settings copied")}catch{ut("Unable to copy shortcut settings")}},children:[t(I,{icon:"clipboard"})," ",t("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:i}))&&t("button",{type:"button",class:"plain2",disabled:!i,onClick:()=>{try{navigator.share({text:i})}catch{alert("Sharing doesn't seem to work.")}},children:[t(I,{icon:"share"})," ",t("span",{children:"Share"})]})," ",$.settings.shortcutSettingsCloudImportExport&&t("button",{type:"button",class:"plain2",disabled:h==="cloud-uploading",onClick:async()=>{c("cloud-uploading");const f=bt.session.get("currentAccount");try{const g=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(g){const{note:m=""}=g;let w="";if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const b=JSON.stringify({v:"1",dt:Date.now(),data:i});w=m.replace(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/,`<phanpy-shortcuts-settings>${b}</phanpy-shortcuts-settings>`)}else w=`${m}


<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;ut("Saving shortcuts to instance server…"),await s.v1.accounts.$select(f).note.create({comment:w}),c("default"),ut("Shortcuts saved")}}catch{c("error"),ut("Unable to save shortcuts")}},title:"Sync to instance server",children:[t(I,{icon:"cloud"}),t(I,{icon:"arrow-up"})]})," ",i.length>0&&t("small",{class:"insignificant ib",children:[i.length," characters"]})]}),!!i&&t("details",{children:[t("summary",{class:"insignificant",children:t("small",{children:"Raw Shortcuts JSON"})}),t("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(e.filter(Boolean),null,2)})]})]}),$.settings.shortcutSettingsCloudImportExport&&t("footer",{children:t("p",{children:[t(I,{icon:"cloud"})," Import/export settings from/to instance server (Very experimental)"]})})]})]})}function so(){const{instance:e}=H(),n=It($),{shortcuts:s,settings:i}=n;if(!s.length||i.shortcutsViewMode==="multi-column"||!i.shortcutsViewMode&&i.shortcutsColumnsMode)return null;const o=O(),a=gt(()=>s.map((c,r)=>{const{type:l,...u}=c;if(!qe[l])return null;let{id:d,path:f,title:p,subtitle:g,icon:m}=qe[l];return typeof d=="function"&&(d=d(u,r)),typeof f=="function"&&(f=f({...u,instance:u.instance||e},r)),typeof p=="function"&&(p=p(u,r)),typeof g=="function"&&(g=g(u,r)),typeof m=="function"&&(m=m(u,r)),{id:d,path:f,title:p,subtitle:g,icon:m}}).filter(Boolean),[s]),h=Gs();return St(["1","2","3","4","5","6","7","8","9"],(c,r)=>{var u,d;const l=parseInt(r.keys[0],10)-1;if(l<a.length){const{path:f}=a[l];f&&(h(f),(d=(u=o.current)==null?void 0:u.closeMenu)==null||d.call(u))}}),t("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?t("nav",{class:"tab-bar",onContextMenu:c=>{c.preventDefault(),$.showShortcutsSettings=!0},children:t("ul",{children:a.map(({id:c,path:r,title:l,subtitle:u,icon:d},f)=>t("li",{children:t(et,{class:u?"has-subtitle":"",to:r,onClick:p=>{if(p.target.classList.contains("is-active")){p.preventDefault();const g=document.getElementById(`${c}-page`);if(g){g.scrollTop=0;const m=g.querySelector(".updates-button");m&&m.click()}}},children:[t(I,{icon:d,size:"xl",alt:l}),t("span",{children:[t(on,{children:l}),u&&t(E,{children:[t("br",{}),t("small",{children:u})]})]})]})},`${f}-${c}-${l}-${u}-${r}`))})}):t(Jt,{instanceRef:o,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:t("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:c=>{c.preventDefault(),$.showShortcutsSettings=!0},onTransitionStart:c=>{var r,l;try{const{target:u}=c;getComputedStyle(u).pointerEvents==="none"&&((l=(r=o.current)==null?void 0:r.closeMenu)==null||l.call(r))}catch{}},children:t(I,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:a.map(({id:c,path:r,title:l,subtitle:u,icon:d},f)=>t(Rt,{to:r,class:"glass-menu-item",children:[t(I,{icon:d,size:"l"})," ",t("span",{class:"menu-grow",children:[t("span",{children:t(on,{children:l})}),u&&t(E,{children:[" ",t("small",{class:"more-insignificant",children:u})]})]}),t("span",{class:"menu-shortcut hide-until-focus-visible",children:f+1})]},`${f}-${c}-${l}-${u}-${r}`))})})}const io=zt(so);function vn({list:e,onClose:n}){const{masto:s}=H(),[i,o]=A("default"),a=!!e,h=O(),c=O(),r=O();V(()=>{a&&(h.current.value=e.title,c.current.value=e.repliesPolicy,r.current&&(r.current.checked=e.exclusive))},[a]);const l=Ks("@mastodon/list-exclusive");return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(I,{icon:"x"})})," ",t("header",{children:t("h2",{children:a?"Edit list":"New list"})}),t("main",{children:t("form",{class:"list-form",onSubmit:u=>{u.preventDefault();const d=new FormData(u.target),f=d.get("title"),p=d.get("replies_policy"),g=d.get("exclusive")==="on";o("loading"),(async()=>{try{let m;a?m=await s.v1.lists.$select(e.id).update({title:f,replies_policy:p,exclusive:g}):m=await s.v1.lists.create({title:f,replies_policy:p,exclusive:g}),o("default"),n==null||n({state:"success",list:m})}catch{o("error"),alert(a?"Unable to edit list.":"Unable to create list.")}})()},children:[t("div",{class:"list-form-row",children:t("label",{for:"list-title",children:["Name"," ",t("input",{ref:h,type:"text",id:"list-title",name:"title",required:!0,disabled:i==="loading",dir:"auto"})]})}),t("div",{class:"list-form-row",children:t("select",{ref:c,name:"replies_policy",required:!0,disabled:i==="loading",children:[t("option",{value:"list",children:"Show replies to list members"}),t("option",{value:"followed",children:"Show replies to people I follow"}),t("option",{value:"none",children:"Don't show replies"})]})}),l&&t("div",{class:"list-form-row",children:t("label",{class:"label-block",children:[t("input",{ref:r,type:"checkbox",name:"exclusive",disabled:i==="loading"})," ","Hide posts on this list from Home/Following"]})}),t("div",{class:"list-form-footer",children:[t("button",{type:"submit",disabled:i==="loading",children:a?"Save":"Create"}),a&&t(oe,{disabled:i==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await s.v1.lists.$select(e.id).remove(),o("default"),n==null||n({state:"deleted"})}catch{o("error"),alert("Unable to delete list.")}})()},children:t("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete…"})})]})]})})]})}const oo=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],Un={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},On=80,Cs=1e3*60*10;function ao(e,n){return n.v1.accounts.familiarFollowers.fetch({id:[e]})}const ro=se(ao,{maxAge:Cs});async function co(e,n){const s=n.v1.accounts.$select(e).statuses.list({limit:20}).next(),{value:i}=await s,o={total:i.length,originals:0,replies:0,boosts:0};return i.forEach(a=>{a.reblog?o.boosts++:a.inReplyToId&&a.inReplyToAccountId!==a.account.id?o.replies++:o.originals++}),i.length&&(o.daysSinceLastPost=Math.ceil((Date.now()-new Date(i[i.length-1].createdAt))/864e5)),o}const lo=se(co,{maxAge:Cs});function uo({account:e,fetchAccount:n=()=>{},standalone:s,instance:i,authenticated:o}){const{masto:a}=H({instance:i}),{masto:h,instance:c}=H(),[r,l]=A("default"),u=typeof e=="string",[d,f]=A(u?null:e),p=gt(()=>i===c,[i,c]);V(()=>{if(!u){f(e);return}l("loading"),(async()=>{try{const P=await n();$.accounts[`${P.id}@${i}`]=P,f(P),l("default")}catch{f(null),l("error")}})()},[u,e,n]);const{acct:g,avatar:m,avatarStatic:w,bot:b,createdAt:v,displayName:S,emojis:y,fields:T,followersCount:k,followingCount:C,group:F,id:x,lastStatusAt:D,locked:B,note:L,statusesCount:N,url:R,username:K,memorial:q,moved:tt,roles:Q}=d||{};let vt=!1,{header:Z,headerStatic:lt}=d||{};(!Z||/missing\.png$/.test(Z))&&m&&!/missing\.png$/.test(m)&&(Z=m,vt=!0,w&&!/missing\.png$/.test(w)&&(lt=w));const ot=gt(()=>x===bt.session.get("currentAccount"),[x]);V(()=>{const P=!!(d!=null&&d.id&&(d!=null&&d.username)&&(d!=null&&d.acct)&&(d!=null&&d.avatar)&&(d!=null&&d.avatarStatic)&&(d!=null&&d.displayName)&&(d!=null&&d.url));if(ot&&i&&P){const it=bt.local.getJSON("accounts");let pt=!1;it.forEach(at=>{at.info.id===d.id&&at.instanceURL===i&&(at.info=d,pt=!0)}),pt&&bt.local.setJSON("accounts",it)}},[ot,d,i]);const ft=gt(()=>R?new URL(R).hostname:null,[R]),[mt,$t]=A([]),_=O(),G=O([]);async function nt(P){(P||!_.current)&&(_.current=a.v1.accounts.$select(x).followers.list({limit:On}));const it=await _.current.next();if(ot||!p)return it;const{value:pt}=it;let at=[];if(P){const Dt=await a.v1.accounts.familiarFollowers.fetch({id:[x]});G.current=Dt[0].accounts,at=[...G.current,...pt.filter(Ut=>!G.current.some(Tt=>Tt.id===Ut.id))]}else pt!=null&&pt.length&&(at=pt.filter(Dt=>!G.current.some(Ut=>Ut.id===Dt.id)));return{...it,value:at}}const X=O();async function z(P){return(P||!X.current)&&(X.current=a.v1.accounts.$select(x).following.list({limit:On})),await X.current.next()}const Y=s?"div":et,U=i?`/${i}/a/${x}`:`/a/${x}`,[rt,ht]=A([]),[j,dt]=A(),[yt,Lt]=A("default"),Pt=!!(j!=null&&j.total),M=async P=>{try{const it=await ro(P,h);ht(it[0].accounts.slice(0,ho))}catch{}},W=async()=>{if(x){Lt("loading");try{const P=await lo(x,a);dt(P),Lt("default")}catch{Lt("error")}}},J=Yt(({relationship:P,currentID:it})=>{P.following||(M(it),!s&&N>0&&W())},[s,x,N]);return t("div",{tabIndex:"-1",class:`account-container ${r==="loading"?"skeleton":""}`,style:{"--header-color-1":mt[0],"--header-color-2":mt[1],"--header-color-3":mt[2],"--header-color-4":mt[3]},children:[r==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to load account."}),t("p",{children:t("a",{href:u?e:R,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",t(I,{icon:"external"})]})})]}),r==="loading"?t(E,{children:[t("header",{children:t(te,{avatarSize:"xxxl",skeleton:!0})}),t("main",{children:[t("div",{class:"note",children:[t("p",{children:"███████ ████ ████"}),t("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),t("div",{class:"account-metadata-box",children:[t("div",{class:"profile-metadata",children:[t("div",{class:"profile-field",children:[t("b",{class:"more-insignificant",children:"███"}),t("p",{children:"██████"})]}),t("div",{class:"profile-field",children:[t("b",{class:"more-insignificant",children:"████"}),t("p",{children:"███████████"})]})]}),t("div",{class:"stats",children:[t("div",{children:[t("span",{children:"██"})," Followers"]}),t("div",{children:[t("span",{children:"██"})," Following"]}),t("div",{children:[t("span",{children:"██"})," Posts"]})]})]}),t("div",{class:"actions",children:[t("span",{}),t("span",{class:"buttons",children:t("button",{type:"button",title:"More",class:"plain",disabled:!0,children:t(I,{icon:"more",size:"l",alt:"More"})})})]})]})]}):d&&t(E,{children:[!!tt&&t("div",{class:"account-moved",children:[t("p",{children:[t("b",{children:S})," has indicated that their new account is now:"]}),t(te,{account:tt,instance:i,onClick:P=>{P.stopPropagation(),$.showAccount=tt}})]}),!!Z&&!/missing\.png$/.test(Z)&&t("img",{src:Z,alt:"",class:`header-banner ${vt?"header-is-avatar":""}`,onError:P=>{P.target.crossOrigin?P.target.src!==lt?P.target.src=lt:(P.target.removeAttribute("crossorigin"),P.target.src=Z):P.target.src!==lt?P.target.src=lt:P.target.remove()},crossOrigin:"anonymous",onLoad:P=>{P.target.classList.add("loaded");try{const it=window.OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas"),pt=it.getContext("2d",{willReadFrequently:!0});it.width=P.target.width,it.height=P.target.height,pt.imageSmoothingEnabled=!1,pt.drawImage(P.target,0,0);const at=10,Ut=[pt.getImageData(0,0,at,at).data,pt.getImageData(P.target.width-at,0,at,at).data,pt.getImageData(0,P.target.height-at,at,at).data,pt.getImageData(P.target.width-at,P.target.height-at,at,at).data].map(Tt=>{let Ot=0,Vt=0,kt=0,qt=0;for(let Bt=0;Bt<Tt.length;Bt+=4)Ot+=Tt[Bt],Vt+=Tt[Bt+1],kt+=Tt[Bt+2],qt+=Tt[Bt+3];const le=Tt.length/4;return[Ot/le,Vt/le,kt/le,qt/le]}).map(Tt=>{const[Ot,Vt,kt,qt]=po(Tt);return`rgba(${Ot}, ${Vt}, ${kt}, ${qt})`});$t(Ut)}catch{}}}),t("header",{children:t(te,{account:d,instance:i,avatarSize:"xxxl",external:s,internal:!s})}),t("div",{class:"faux-header-bg","aria-hidden":"true"}),t("main",{children:[!!q&&t("span",{class:"tag",children:"In Memoriam"}),!!b&&t("span",{class:"tag",children:[t(I,{icon:"bot"})," Automated"]}),!!F&&t("span",{class:"tag",children:[t(I,{icon:"group"})," Group"]}),Q==null?void 0:Q.map(P=>t("span",{class:"tag",children:[P.name,!!ft&&t(E,{children:[" ",t("span",{class:"more-insignificant",children:ft})]})]})),t("div",{class:"note",dir:"auto",onClick:ns({instance:c}),dangerouslySetInnerHTML:{__html:Qe(L,{emojis:y})}}),t("div",{class:"account-metadata-box",children:[(T==null?void 0:T.length)>0&&t("div",{class:"profile-metadata",children:T.map(({name:P,value:it,verifiedAt:pt},at)=>t("div",{class:`profile-field ${pt?"profile-verified":""}`,dir:"auto",children:[t("b",{children:[t(ss,{text:P,emojis:y})," ",!!pt&&t(I,{icon:"check-circle",size:"s"})]}),t("p",{dangerouslySetInnerHTML:{__html:Qe(it,{emojis:y})}})]},P+at))}),t("div",{class:"stats",children:[t(Y,{tabIndex:0,to:U,onClick:()=>{setTimeout(()=>{$.showGenericAccounts={heading:"Followers",fetchAccounts:nt,instance:i,excludeRelationshipAttrs:ot?["followedBy"]:[]}},0)},children:[!!rt.length&&t("span",{class:"shazam-container-horizontal",children:t("span",{class:"shazam-container-inner stats-avatars-bunch",children:rt.map(P=>t(fe,{url:P.avatarStatic,size:"s",alt:`${P.displayName} @${P.acct}`,squircle:P==null?void 0:P.bot}))})}),t("span",{title:k,children:Ft(k)})," ","Followers"]}),t(Y,{class:"insignificant",tabIndex:0,to:U,onClick:()=>{setTimeout(()=>{$.showGenericAccounts={heading:"Following",fetchAccounts:z,instance:i,excludeRelationshipAttrs:ot?["following"]:[]}},0)},children:[t("span",{title:C,children:Ft(C)})," ","Following",t("br",{})]}),t(Y,{class:"insignificant",to:U,children:[t("span",{title:N,children:Ft(N)})," ","Posts"]}),!!v&&t("div",{class:"insignificant",children:["Joined"," ",t("time",{datetime:v,children:ie(v,{hideTime:!0})})]})]})]}),!!j&&t(Y,{to:U,class:"account-metadata-box",children:t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:Pt?t("div",{class:"posting-stats",title:`${Math.round(j.originals/j.total*100)}% original posts, ${Math.round(j.replies/j.total*100)}% replies, ${Math.round(j.boosts/j.total*100)}% boosts`,children:[t("div",{children:j.daysSinceLastPost<365?`Last ${j.total} post${j.total>1?"s":""} in the past 
                      ${j.daysSinceLastPost} day${j.daysSinceLastPost>1?"s":""}`:`
                      Last ${j.total} posts in the past year(s)
                      `}),t("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${j.originals/j.total*100}%`,"--replies-percentage":`${(j.originals+j.replies)/j.total*100}%`}}),t("div",{class:"posting-stats-legends",children:[t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):t("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),t("div",{class:"account-metadata-box",children:t("div",{class:"shazam-container no-animation",hidden:!!j,children:t("div",{class:"shazam-container-inner",children:t("button",{type:"button",class:"posting-stats-button",disabled:yt==="loading",onClick:()=>{W()},children:[t("div",{class:`posting-stats-bar posting-stats-icon ${yt==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),t("footer",{children:t(fo,{info:d,instance:i,authenticated:o,onRelationshipChange:J})})]})]})}const ho=3;function fo({info:e,instance:n,authenticated:s,onRelationshipChange:i=()=>{}}){var Y;if(!e)return null;const{masto:o,instance:a,authenticated:h}=H(),c=n===a,[r,l]=A("default"),[u,d]=A(null),{id:f,acct:p,url:g,username:m,locked:w,lastStatusAt:b,note:v,fields:S,moved:y}=e,T=O(f),{following:k,showingReblogs:C,notifying:F,followedBy:x,blocking:D,blockedBy:B,muting:L,mutingNotifications:N,requested:R,domainBlocking:K,endorsed:q,note:tt}=u||{},[Q,vt]=A(null),[Z,lt]=A(!1);V(()=>{if(e){const U=bt.session.get("currentAccount");let rt;(async()=>{if(c&&s)rt=f;else if(!c&&h){const j=e.acct.includes("@");try{const dt=await o.v2.search.fetch({q:j?e.acct:`${e.username}@${n}`,type:"accounts",limit:1,resolve:!0});dt.accounts.length&&(rt=dt.accounts[0].id,vt(dt.accounts[0]))}catch{}}if(!rt)return;if(U===rt){lt(!0);return}if(T.current=rt,y)return;l("loading");const ht=o.v1.accounts.relationships.fetch({id:[rt]});try{const j=await ht;if(l("default"),j.length){const dt=j[0];d(dt),i({relationship:dt,currentID:rt})}}catch{l("error")}})()}},[e,s]),V(()=>{e&&Z&&Zs(e)},[e,Z]);const ot=r==="loading",[ft,mt]=A(!1),[$t,_]=A(!1),[G,nt]=A(!1),[X,z]=A([]);return t(E,{children:[t("div",{class:"actions",children:[t("span",{children:[x?t("span",{class:"tag",children:"Follows you"}):b?t("small",{class:"insignificant",children:["Last post:"," ",t("span",{class:"ib",children:ie(b,{hideTime:!0})})]}):t("span",{}),L&&t("span",{class:"tag danger",children:"Muted"}),D&&t("span",{class:"tag danger",children:"Blocked"})]})," ",t("span",{class:"buttons",children:[!!tt&&t("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{nt(!0)},dir:"auto",children:t("span",{children:tt})}),t(Jt,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:t("button",{type:"button",title:"More",class:"plain",disabled:ot,children:t(I,{icon:"more",size:"l",alt:"More"})}),onMenuChange:U=>{k&&U.open&&(async()=>{try{const rt=await o.v1.accounts.$select(T.current).lists.list();z(rt)}catch{}})()},children:[h&&!Z&&t(E,{children:[t(ct,{onClick:()=>{$.showCompose={draftStatus:{status:`@${(Q==null?void 0:Q.acct)||p} `}}},children:[t(I,{icon:"at"}),t("span",{children:["Mention @",m]})]}),t(ct,{onClick:()=>{mt(!0)},children:[t(I,{icon:"translate"}),t("span",{children:"Translate bio"})]}),t(ct,{onClick:()=>{nt(!0)},children:[t(I,{icon:"pencil"}),t("span",{children:tt?"Edit private note":"Add private note"})]}),k&&t(ct,{onClick:()=>{_(!0)},children:[t(I,{icon:"list"}),X.length?t(E,{children:[t("small",{class:"menu-grow",children:["Add/Remove from Lists",t("br",{}),t("span",{class:"more-insignificant",children:X.map(U=>U.title).join(", ")})]}),t("small",{class:"more-insignificant",children:X.length})]}):t("span",{children:"Add/Remove from Lists"})]}),t(_t,{})]}),t(ct,{onClick:()=>{const U=`@${(Q==null?void 0:Q.acct)||p}`;try{navigator.clipboard.writeText(U),ut("Handle copied")}catch{ut("Unable to copy handle")}},children:[t(I,{icon:"copy"}),t("small",{children:["Copy handle",t("br",{}),t("span",{class:"more-insignificant",children:["@",(Q==null?void 0:Q.acct)||p]})]})]}),t(ct,{href:g,target:"_blank",children:[t(I,{icon:"external"}),t("small",{class:"menu-double-lines",children:mo(g)})]}),t("div",{class:"menu-horizontal",children:[t(ct,{onClick:()=>{try{navigator.clipboard.writeText(g),ut("Link copied")}catch{ut("Unable to copy link")}},children:[t(I,{icon:"link"}),t("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((Y=navigator==null?void 0:navigator.canShare)==null?void 0:Y.call(navigator,{url:g}))&&t(ct,{onClick:()=>{try{navigator.share({url:g})}catch{alert("Sharing doesn't seem to work.")}},children:[t(I,{icon:"share"}),t("span",{children:"Share…"})]})]}),!!u&&t(E,{children:[t(_t,{}),L?t(ct,{onClick:()=>{l("loading"),(async()=>{try{const U=await o.v1.accounts.$select((Q==null?void 0:Q.id)||f).unmute();d(U),l("default"),ut(`Unmuted @${m}`),$.reloadGenericAccounts.id="mute",$.reloadGenericAccounts.counter++}catch{l("error")}})()},children:[t(I,{icon:"unmute"}),t("span",{children:["Unmute @",m]})]}):t(is,{menuClassName:"menu-blur",openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:t(E,{children:[t(I,{icon:"mute"}),t("span",{class:"menu-grow",children:["Mute @",m,"…"]}),t("span",{style:{textOverflow:"clip"},children:[t(I,{icon:"time"}),t(I,{icon:"chevron-right"})]})]}),children:t("div",{class:"menu-wrap",children:oo.map(U=>t(ct,{onClick:()=>{l("loading"),(async()=>{try{const rt=await o.v1.accounts.$select((Q==null?void 0:Q.id)||f).mute({duration:U});d(rt),l("default"),ut(`Muted @${m} for ${Un[U]}`),$.reloadGenericAccounts.id="mute",$.reloadGenericAccounts.counter++}catch{l("error"),ut(`Unable to mute @${m}`)}})()},children:Un[U]}))})}),t(oe,{subMenu:!0,confirm:!D,confirmLabel:t(E,{children:[t(I,{icon:"block"}),t("span",{children:["Block @",m,"?"]})]}),menuItemClassName:"danger",onClick:()=>{l("loading"),(async()=>{try{if(D){const U=await o.v1.accounts.$select((Q==null?void 0:Q.id)||f).unblock();d(U),l("default"),ut(`Unblocked @${m}`)}else{const U=await o.v1.accounts.$select((Q==null?void 0:Q.id)||f).block();d(U),l("default"),ut(`Blocked @${m}`)}$.reloadGenericAccounts.id="block",$.reloadGenericAccounts.counter++}catch{l("error"),D?ut(`Unable to unblock @${m}`):ut(`Unable to block @${m}`)}})()},children:D?t(E,{children:[t(I,{icon:"unblock"}),t("span",{children:["Unblock @",m]})]}):t(E,{children:[t(I,{icon:"block"}),t("span",{children:["Block @",m,"…"]})]})}),t(ct,{className:"danger",onClick:()=>{$.showReportModal={account:Q||e}},children:[t(I,{icon:"flag"}),t("span",{children:["Report @",m,"…"]})]})]}),!1]}),!u&&r==="loading"&&t(At,{abrupt:!0}),!!u&&t(oe,{confirm:k||R,confirmLabel:t("span",{children:R?"Withdraw follow request?":`Unfollow @${e.acct||e.username}?`}),menuItemClassName:"danger",align:"end",disabled:ot,onClick:()=>{l("loading"),(async()=>{try{let U;k||R?U=await o.v1.accounts.$select(T.current).unfollow():U=await o.v1.accounts.$select(T.current).follow(),U&&d(U),l("default")}catch(U){alert(U),l("error")}})()},children:t("button",{type:"button",class:`${k||R?"light swap":""}`,"data-swap-state":k||R?"danger":"",disabled:ot,children:k?t(E,{children:[t("span",{children:"Following"}),t("span",{children:"Unfollow…"})]}):R?t(E,{children:[t("span",{children:"Requested"}),t("span",{children:"Withdraw…"})]}):w?t(E,{children:[t(I,{icon:"lock"})," ",t("span",{children:"Follow"})]}):"Follow"})})]})]}),!!ft&&t(Ht,{onClose:()=>{mt(!1)},children:t(go,{note:v,fields:S,onClose:()=>mt(!1)})}),!!$t&&t(Ht,{onClose:()=>{_(!1)},children:t(bo,{accountID:T.current,onClose:()=>_(!1)})}),!!G&&t(Ht,{onClose:()=>{nt(!1)},children:t(vo,{account:e,note:tt,onRelationshipChange:U=>{d(U)},onClose:()=>nt(!1)})})]})}function po([e,n,s]){const i=.2126*e+.7152*n+.0722*s;let o;return i>=220?o=1:i<=50?o=.1:o=i/255,o=Math.min(1,o),[e,n,s,o]}function mo(e){if(!e)return;const n=new URL(e),{host:s,pathname:i}=n,o=i.replace(/\/$/,"").replace(/^\//,"");return t(E,{children:[t("span",{class:"more-insignificant",children:[s,"/"]}),t("wbr",{}),t("span",{children:o})]})}function go({note:e,fields:n,onClose:s}){const i=(n==null?void 0:n.map(({name:a,value:h})=>`${a}
${Cn(h)}`).join(`

`))||"",o=Cn(e)+(i?`

${i}`:"");return t("div",{class:"sheet",children:[!!s&&t("button",{type:"button",class:"sheet-close",onClick:s,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:"Translated Bio"})}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:o}),t(Xs,{forceTranslate:!0,text:o})]})]})}function bo({accountID:e,onClose:n}){const{masto:s}=H(),[i,o]=A("default"),[a,h]=A([]),[c,r]=A([]),[l,u]=os(p=>p+1,0);V(()=>{o("loading"),(async()=>{try{const p=await s.v1.lists.list();p.sort((m,w)=>m.title.localeCompare(w.title));const g=await s.v1.accounts.$select(e).lists.list();h(p),r(g),o("default")}catch{o("error")}})()},[l]);const[d,f]=A(!1);return t("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:"Add/Remove from Lists"})}),t("main",{children:[a.length>0?t("ul",{class:"list-add-remove",children:a.map(p=>{const g=c.some(m=>m.id===p.id);return t("li",{children:t("button",{type:"button",class:`light ${g?"checked":""}`,disabled:i==="loading",onClick:()=>{o("loading"),(async()=>{try{g?await s.v1.lists.$select(p.id).accounts.remove({accountIds:[e]}):await s.v1.lists.$select(p.id).accounts.create({accountIds:[e]}),u()}catch{o("error"),alert(g?"Unable to remove from list.":"Unable to add to list.")}})()},children:[t(I,{icon:"check-circle"}),t("span",{children:p.title})]})})})}):i==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):i==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists."}),t("button",{type:"button",class:"plain2",onClick:()=>f(!0),disabled:i!=="default",children:[t(I,{icon:"plus",size:"l"})," ",t("span",{children:"New list"})]})]}),d&&t(Ht,{onClick:p=>{p.target===p.currentTarget&&f(!1)},children:t(vn,{list:d==null?void 0:d.list,onClose:p=>{p.state==="success"&&u(),f(!1)}})})]})}function vo({account:e,note:n,onRelationshipChange:s=()=>{},onClose:i=()=>{}}){const{masto:o}=H(),[a,h]=A("default"),c=O(null);return V(()=>{let r;return c.current&&!n&&(r=setTimeout(()=>{var l,u;(u=(l=c.current).focus)==null||u.call(l)},100)),()=>{clearTimeout(r)}},[]),t("div",{class:"sheet",id:"private-note-container",children:[!!i&&t("button",{type:"button",class:"sheet-close",onClick:i,children:t(I,{icon:"x"})}),t("header",{children:t("b",{children:["Private note about @",(e==null?void 0:e.username)||(e==null?void 0:e.acct)]})}),t("main",{children:t("form",{onSubmit:r=>{r.preventDefault();const u=new FormData(r.target).get("note");(u==null?void 0:u.trim())!==(n==null?void 0:n.trim())&&(h("loading"),(async()=>{try{const d=await o.v1.accounts.$select(e==null?void 0:e.id).note.create({comment:u});h("default"),s(d),i()}catch(d){h("error"),alert((d==null?void 0:d.message)||"Unable to update private note.")}})())},children:[t("textarea",{ref:c,name:"note",disabled:a==="loading",children:n}),t("footer",{children:[t("button",{type:"button",class:"light",disabled:a==="loading",onClick:()=>{i==null||i()},children:"Cancel"}),t("span",{children:[t(At,{abrupt:!0,hidden:a!=="loading"}),t("button",{disabled:a==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}var yo=Object.defineProperty,wo=(e,n,s)=>n in e?yo(e,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[n]=s,Ee=(e,n,s)=>(wo(e,typeof n!="symbol"?n+"":n,s),s),an=new Map,Re=new WeakMap,Bn=0,So=void 0;function ko(e){return e?(Re.has(e)||(Bn+=1,Re.set(e,Bn.toString())),Re.get(e)):"0"}function Io(e){return Object.keys(e).sort().filter(n=>e[n]!==void 0).map(n=>`${n}_${n==="root"?ko(e.root):e[n]}`).toString()}function To(e){const n=Io(e);let s=an.get(n);if(!s){const i=new Map;let o;const a=new IntersectionObserver(h=>{h.forEach(c=>{var r;const l=c.isIntersecting&&o.some(u=>c.intersectionRatio>=u);e.trackVisibility&&typeof c.isVisible>"u"&&(c.isVisible=l),(r=i.get(c.target))==null||r.forEach(u=>{u(l,c)})})},e);o=a.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),s={id:n,observer:a,elements:i},an.set(n,s)}return s}function Co(e,n,s={},i=So){if(typeof window.IntersectionObserver>"u"&&i!==void 0){const r=e.getBoundingClientRect();return n(i,{isIntersecting:i,target:e,intersectionRatio:typeof s.threshold=="number"?s.threshold:0,time:0,boundingClientRect:r,intersectionRect:r,rootBounds:r}),()=>{}}const{id:o,observer:a,elements:h}=To(s),c=h.get(e)||[];return h.has(e)||h.set(e,c),c.push(n),a.observe(e),function(){c.splice(c.indexOf(n),1),c.length===0&&(h.delete(e),a.unobserve(e)),h.size===0&&(a.disconnect(),an.delete(o))}}function $o(e){return typeof e.children!="function"}var ne=class extends Js{constructor(e){super(e),Ee(this,"node",null),Ee(this,"_unobserveCb",null),Ee(this,"handleNode",n=>{this.node&&(this.unobserve(),!n&&!this.props.triggerOnce&&!this.props.skip&&this.setState({inView:!!this.props.initialInView,entry:void 0})),this.node=n||null,this.observeNode()}),Ee(this,"handleChange",(n,s)=>{n&&this.props.triggerOnce&&this.unobserve(),$o(this.props)||this.setState({inView:n,entry:s}),this.props.onChange&&this.props.onChange(n,s)}),this.state={inView:!!e.initialInView,entry:void 0}}componentDidMount(){this.unobserve(),this.observeNode()}componentDidUpdate(e){(e.rootMargin!==this.props.rootMargin||e.root!==this.props.root||e.threshold!==this.props.threshold||e.skip!==this.props.skip||e.trackVisibility!==this.props.trackVisibility||e.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())}componentWillUnmount(){this.unobserve()}observeNode(){if(!this.node||this.props.skip)return;const{threshold:e,root:n,rootMargin:s,trackVisibility:i,delay:o,fallbackInView:a}=this.props;this._unobserveCb=Co(this.node,this.handleChange,{threshold:e,root:n,rootMargin:s,trackVisibility:i,delay:o},a)}unobserve(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)}render(){const{children:e}=this.props;if(typeof e=="function"){const{inView:p,entry:g}=this.state;return e({inView:p,entry:g,ref:this.handleNode})}const{as:n,triggerOnce:s,threshold:i,root:o,rootMargin:a,onChange:h,skip:c,trackVisibility:r,delay:l,initialInView:u,fallbackInView:d,...f}=this.props;return Qs(n||"div",{ref:this.handleNode,...f},e)}};async function $s(e,n={}){if(!(e!=null&&e.length))return;const{masto:s}=H(),i=bt.session.get("currentAccount"),o=e.reduce((a,h)=>(!a.includes(h.id)&&!n[h.id]&&h.id!==i&&a.push(h.id),a),[]);if(!o.length)return null;try{return(await s.v1.accounts.relationships.fetch({id:o})).reduce((c,r)=>(c[r.id]=r,c),{})}catch{return null}}function xo(e){var o;let n=[],s=[],i=0;for(let a=0;a<e.length;a++){const h=e[a];h.reblog&&!((o=h.account)!=null&&o.group)?(s.push(h),i++):(n.push(h),i<3&&(i=0))}if(e.length>10&&(s.length>e.length/4||i>=3)){const a=s.map(h=>h.id);if(s.length>e.length*3/4)n=[...n,{id:a,items:s,type:"boosts"}];else{const h=Math.floor(n.length/2);n=[...n.slice(0,h),{id:a,items:s,type:"boosts"},...n.slice(h)]}return n}else return e}function Fn(e,n){const s=bt.account.get("boostedStatusIDs")||{},i=e.filter(a=>{if(!a.reblog)return!0;const h=`${n}-${a.reblog.id}`,c=s[h];return c&&c!==a.id?!1:(s[h]=a.id,!0)}),o=Object.keys(s);return o.length>50&&o.slice(0,o.length-50).forEach(a=>{delete s[a]}),bt.account.set("boostedStatusIDs",s),i}function Ao(e,n){const s=[];let i=0;e.forEach(h=>{for(let r=0;r<s.length;r++){if(s[r].find(l=>l.id===h.id))return;if(s[r].find(l=>l.id===h.inReplyToId)||s[r].find(l=>l.inReplyToId===h.id)){s[r].push(h);return}}const c=e.find(r=>r.id===h.inReplyToId);c&&(s[i++]=[h,c])});for(let h=0;h<s.length;h++)for(let c=h+1;c<s.length;c++)s[h].find(l=>s[c].includes(l))&&(s[h]=[...s[h],...s[c]],s[h]=s[h].filter((l,u,d)=>d.findIndex(f=>f.id===l.id)===u),s.splice(c,1),c--);s.forEach(h=>{h.sort((c,r)=>!c.inReplyToId&&!r.inReplyToId?new Date(c.createdAt)-new Date(r.createdAt):c.inReplyToId===r.id?1:r.inReplyToId===c.id||!c.inReplyToId?-1:r.inReplyToId?new Date(c.createdAt)-new Date(r.createdAt):1)}),s.forEach(h=>{const c=h[0].account.id;h.forEach(r=>{r.account.id!==c&&(r._differentAuthor=!0)})}),s.length;const o=[],a=[];return e.forEach(h=>{if(h.reblog){o.push(h);return}for(let c=0;c<s.length;c++)if(s[c].find(r=>r.id===h.id)){if(a.includes(c))return;const r=s[c];r.sort((u,d)=>{const f=new Date(u.createdAt),p=new Date(d.createdAt);return f-p});const l=r[0].account.id;o.push({id:r.map(u=>u.id),items:r,type:r.every(u=>u.account.id===l)?"thread":"conversation"}),a.push(c);return}if(h.inReplyToId&&h.inReplyToAccountId!==h.account.id){const c=Wt(h.id,n);$.statusReply[c]||queueMicrotask(async()=>{try{const{masto:r}=H({instance:n}),l=await Eo(h.inReplyToId,r);Ct(l,n,{skipThreading:!0,skipUnfurling:!0}),$.statusReply[c]={id:l.id,instance:n}}catch{}})}o.push(h)}),o}const Eo=se((e,n)=>n.v1.statuses.$select(e).fetch());async function Ro(e,n){const s=await Gi();if(!s.length)return;const{statusFollowedTags:i}=$,o=[];if(e.forEach(a=>{var f;if(a.reblog)return;const{id:h,content:c,tags:r=[]}=a,l=Wt(h,n);if((f=i[l])!=null&&f.length)return;const u=Ki(c);if(!u.length&&!r.length)return;const d=s.reduce((p,g)=>((u.some(m=>m.toLowerCase()===g.name.toLowerCase())||r.some(m=>m.name.toLowerCase()===g.name.toLowerCase()))&&p.push(g.name),p),[]);d.length&&o.push({item:a,sKey:l,followedTags:d})}),o.length){const a=o.map(c=>c.item.account),h=await $s(a);if(!h)return;o.forEach(c=>{const{item:r,sKey:l,followedTags:u}=c,d=h[r.account.id];d&&!d.following&&(i[l]=u)})}}function Mo(){$.statusFollowedTags={}}function Lo({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:i=10,scrollThresholdEnd:o=10,direction:a="vertical",distanceFromStartPx:h,distanceFromEndPx:c}={}){const[r,l]=A(null),[u,d]=A(!1),[f,p]=A(!1),[g,m]=A(!1),[w,b]=A(!1),v=a==="vertical";return Xt(()=>{const S=e.current;if(!S)return{};let y=v?S.scrollTop:S.scrollLeft;function T(){const{scrollTop:k,scrollLeft:C,scrollHeight:F,scrollWidth:x,clientHeight:D,clientWidth:B}=S,L=v?k:C,N=v?F:x,R=v?D:B,K=Math.abs(L-y),q=h||Math.min(R*n,N,L),tt=c||Math.min(R*s,N,N-L-R);K>=(y<L?o:i)&&(l(y<L?"end":"start"),y=L),d(L<=0),p(L+R>=N),m(L<=q),b(L+R>=N-tt)}return S.addEventListener("scroll",T,{passive:!0}),()=>S.removeEventListener("scroll",T)},[n,s,i,o]),{scrollDirection:r,reachStart:u,reachEnd:f,nearReachStart:g,nearReachEnd:w,init:()=>{e.current&&e.current.dispatchEvent(new Event("scroll"))}}}function _o({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:i=10,scrollThresholdEnd:o=10,direction:a="vertical",distanceFromStartPx:h,distanceFromEndPx:c,init:r}={},l,u){if(!l)return;const d=a==="vertical",f=O(null),p=O(null),g=ti(()=>{let m=!1,w=!1,b=!1,v=!1;const S=e.current,{scrollTop:y,scrollLeft:T,scrollHeight:k,scrollWidth:C,clientHeight:F,clientWidth:x}=S,D=d?y:T,B=d?k:C,L=d?F:x,N=Math.abs(D-f.current),R=h||Math.min(L*n,B,D),K=c||Math.min(L*s,B,B-D-L);N>=(f.current<D?o:i)&&(p.current=f.current<D?"end":"start",f.current=D),m=D<=0,w=D+L>=B,b=D<=R,v=D+L>=B-K,l({scrollDirection:p.current,reachStart:m,reachEnd:w,nearReachStart:b,nearReachEnd:v})},500);Xt(()=>{const m=e.current;return m?(f.current=m[d?"scrollTop":"scrollLeft"],m.addEventListener("scroll",g,{passive:!0}),()=>m.removeEventListener("scroll",g)):{}},[n,s,i,o,...u]),V(()=>{r&&e.current&&queueMicrotask(()=>{e.current.dispatchEvent(new Event("scroll"))})},[r])}function No({class:e,statusID:n,status:s,instance:i,parent:o,onMediaClick:a}){let h=Wt(n,i);const c=It($);if(s||(s=c.statuses[h]||c.statuses[n],h=Wt(s==null?void 0:s.id,i)),!s)return null;const{account:{acct:r,avatar:l,avatarStatic:u,id:d,url:f,displayName:p,username:g,emojis:m,bot:w,group:b},id:v,repliesCount:S,reblogged:y,reblogsCount:T,favourited:k,favouritesCount:C,bookmarked:F,poll:x,muted:D,sensitive:B,spoilerText:L,visibility:N,language:R,editedAt:K,filtered:q,card:tt,createdAt:Q,inReplyToId:vt,inReplyToAccountId:Z,content:lt,mentions:ot,mediaAttachments:ft,reblog:mt,uri:$t,url:_,emojis:G,_deleted:nt,_pinned:X}=s;if(!(ft!=null&&ft.length))return null;const z=Pt=>{Pt.shiftKey},Y=gt(()=>bt.session.get("currentAccount"),[]),U=gt(()=>Y&&Y===d,[d,Y]),rt=ei(as),ht=!U&&tn(q,rt);if((ht==null?void 0:ht.action)==="hide")return null;const j=B,yt=gt(()=>(bt.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",Lt=o||"div";return ft.map((Pt,M)=>{const W=`${h}-${Pt.id}`,J=ht==null?void 0:ht.titlesStr;return t(Lt,{"data-state-post-id":h,onMouseEnter:z,"data-spoiler-text":L||(B?"Sensitive media":void 0),"data-filtered-text":ht?`Filtered${J?`: ${J}`:""}`:void 0,class:`
          media-post
          ${ht?"filtered":""}
          ${j?"has-spoiler":""}
          ${yt?"show-media":""}
        `,children:t(rs,{class:e,media:Pt,lang:R,to:`/${i}/s/${v}?media-only=${M+1}`,onClick:a?P=>a(P,M,Pt,s):void 0})},W)})}const zn=zt(No);function Po(e){var y,T,k,C,F;const n=It($),{masto:s,instance:i,authenticated:o}=H(),[a,h]=A(),[c,r]=A(!1);V(()=>{const x=bt.local.getJSON("accounts")||[],D=x.find(B=>B.info.id===bt.session.get("currentAccount"));D&&h(D),r(x.length>1)},[]);const l=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(x=>x.type==="following"),u=ni(()=>{$.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),d=O(),[f,p]=A(void 0),g=si([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),m=O();async function w(x){return(x||!m.current)&&(m.current=s.v1.mutes.list({limit:80})),await m.current.next()}const b=O();async function v(x){return(x||!b.current)&&(b.current=s.v1.blocks.list({limit:80})),await b.current.next()}const S=O();return t(E,{children:[t("button",{ref:d,type:"button",class:`button plain nav-menu-button ${c?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{S.current=Date.now(),p(x=>x?void 0:"open")},onContextMenu:x=>{x.preventDefault(),$.showAccounts=!0},...u(),children:[c&&t(fe,{url:((y=a==null?void 0:a.info)==null?void 0:y.avatar)||((T=a==null?void 0:a.info)==null?void 0:T.avatarStatic),size:"l",squircle:(k=a==null?void 0:a.info)==null?void 0:k.bot}),t(I,{icon:"menu",size:c?"s":"l"})]}),t(cs,{menuClassName:"nav-menu",state:f,anchorRef:d,onClose:()=>{p(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-S.current<300}},portal:{target:document.body},...e,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:g,unmountOnClose:!0,children:[!!((C=n.appVersion)!=null&&C.commitHash)&&n.appVersion.commitHash!=="2252758"&&t("div",{class:"top-menu",children:[t(ct,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[t(I,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",t("span",{children:"New update available…"})]}),t(_t,{})]}),t("section",{children:[t(Rt,{to:"/",children:[t(I,{icon:"home",size:"l"})," ",t("span",{children:"Home"})]}),o?t(E,{children:[l&&t(Rt,{to:"/following",children:[t(I,{icon:"following",size:"l"})," ",t("span",{children:"Following"})]}),t(Rt,{to:"/catchup",children:[t(I,{icon:"history2",size:"l"}),t("span",{children:"Catch-up"})]}),t(Rt,{to:"/mentions",children:[t(I,{icon:"at",size:"l"})," ",t("span",{children:"Mentions"})]}),t(Rt,{to:"/notifications",children:[t(I,{icon:"notification",size:"l"})," ",t("span",{children:"Notifications"}),n.notificationsShowNew&&t("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),t(_t,{}),((F=a==null?void 0:a.info)==null?void 0:F.id)&&t(Rt,{to:`/${i}/a/${a.info.id}`,children:[t(I,{icon:"user",size:"l"})," ",t("span",{children:"Profile"})]}),t(Rt,{to:"/l",children:[t(I,{icon:"list",size:"l"})," ",t("span",{children:"Lists"})]}),t(Rt,{to:"/b",children:[t(I,{icon:"bookmark",size:"l"})," ",t("span",{children:"Bookmarks"})]}),t(is,{overflow:"auto",gap:-8,label:t(E,{children:[t(I,{icon:"more",size:"l"}),t("span",{class:"menu-grow",children:"More…"}),t(I,{icon:"chevron-right"})]}),children:[t(Rt,{to:"/f",children:[t(I,{icon:"heart",size:"l"})," ",t("span",{children:"Likes"})]}),t(Rt,{to:"/ft",children:[t(I,{icon:"hashtag",size:"l"})," ",t("span",{children:"Followed Hashtags"})]}),t(_t,{}),t(ct,{onClick:()=>{$.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:w,excludeRelationshipAttrs:["muting"]}},children:[t(I,{icon:"mute",size:"l"})," Muted users…"]}),t(ct,{onClick:()=>{$.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:v,excludeRelationshipAttrs:["blocking"]}},children:[t(I,{icon:"block",size:"l"}),"Blocked users…"]})," "]}),t(_t,{}),t(ct,{onClick:()=>{$.showAccounts=!0},children:[t(I,{icon:"group",size:"l"})," ",t("span",{children:"Accounts…"})]})]}):t(E,{children:[t(_t,{}),t(Rt,{to:"/login",children:[t(I,{icon:"user",size:"l"})," ",t("span",{children:"Log in"})]})]})]}),t("section",{children:[t(_t,{}),t(Rt,{to:"/search",children:[t(I,{icon:"search",size:"l"})," ",t("span",{children:"Search"})]}),t(Rt,{to:`/${i}/trending`,children:[t(I,{icon:"chart",size:"l"})," ",t("span",{children:"Trending"})]}),t(Rt,{to:`/${i}/p/l`,children:[t(I,{icon:"building",size:"l"})," ",t("span",{children:"Local"})]}),t(Rt,{to:`/${i}/p`,children:[t(I,{icon:"earth",size:"l"})," ",t("span",{children:"Federated"})]}),o?t(E,{children:[t(_t,{className:"divider-grow"}),t(ct,{onClick:()=>{$.showKeyboardShortcutsHelp=!0},children:[t(I,{icon:"keyboard",size:"l"})," ",t("span",{children:"Keyboard shortcuts"})]}),t(ct,{onClick:()=>{$.showShortcutsSettings=!0},children:[t(I,{icon:"shortcut",size:"l"})," ",t("span",{children:"Shortcuts / Columns…"})]}),t(ct,{onClick:()=>{$.showSettings=!0},children:[t(I,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]}):t(E,{children:[t(_t,{}),t(ct,{onClick:()=>{$.showSettings=!0},children:[t(I,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]})]})]})]})}const xe=zt(Po),Me={block:"nearest",inline:"center",behavior:"smooth"};function Qt({title:e,titleComponent:n,id:s,instance:i,emptyText:o,errorText:a,useItemID:h,boostsCarousel:c,fetchItems:r=()=>{},checkForUpdates:l=()=>{},checkForUpdatesInterval:u=15e3,headerStart:d,headerEnd:f,timelineStart:p,refresh:g,view:m,filterContext:w,showFollowedTags:b,showReplyParent:v}){const S=It($),[y,T]=A([]),[k,C]=A("default"),[F,x]=A(!1),[D,B]=A(!1),[L,N]=A(!0),R=O(),K=m!=="media",q=ii(z=>{B(!1),k!=="loading"&&(C("loading"),(async()=>{try{let{done:Y,value:U}=await r(z);if(Array.isArray(U)){const[rt,ht]=U.reduce((j,dt)=>(dt._pinned?j[0].push(dt):j[1].push(dt),j),[[],[]]);U=ht,K&&(c&&(U=xo(U)),U=Ao(U,i)),rt.length&&(U=rt.concat(U)),T(z?U:j=>[...j,...U]),U.length||(Y=!0),x(!Y)}else x(!1);C("default")}catch{C("error")}finally{q.cancel()}})())},1500,{leading:!0,trailing:!1}),tt=".timeline-item, .timeline-item-alt",Q=St("j, shift+j",(z,Y)=>{const U=document.activeElement.closest(tt),rt=U==null?void 0:U.getBoundingClientRect(),ht=Array.from(R.current.querySelectorAll(tt));if(U&&rt.top<R.current.clientHeight&&rt.bottom>0){const j=ht.indexOf(U);let dt=ht[j+1];Y.shift&&(dt=ht.find((yt,Lt)=>Lt>j&&!yt.classList.contains("timeline-item-alt"))),dt&&(dt.focus(),dt.scrollIntoView(Me))}else{const j=ht.find(dt=>{const yt=dt.getBoundingClientRect();return yt.top>=44&&yt.left>=0});j&&(j.focus(),j.scrollIntoView(Me))}}),vt=St("k, shift+k",(z,Y)=>{const U=document.activeElement.closest(tt),rt=U==null?void 0:U.getBoundingClientRect(),ht=Array.from(R.current.querySelectorAll(tt));if(U&&rt.top<R.current.clientHeight&&rt.bottom>0){const j=ht.indexOf(U);let dt=ht[j-1];Y.shift&&(dt=ht.findLast((yt,Lt)=>Lt<j&&!yt.classList.contains("timeline-item-alt"))),dt&&(dt.focus(),dt.scrollIntoView(Me))}else{const j=ht.find(dt=>{const yt=dt.getBoundingClientRect();return yt.top>=44&&yt.left>=0});j&&(j.focus(),j.scrollIntoView(Me))}}),Z=St(["enter","o"],()=>{const z=document.activeElement.closest(tt);z&&z.click()}),lt=y.length>0&&k!=="loading"&&D,ot=Yt(()=>{var z;q(!0),(z=R.current)==null||z.scrollTo({top:0,behavior:"smooth"})},[q]),ft=St(".",()=>{lt&&ot()}),mt=O(),[$t,_]=A(!1);_o({scrollableRef:R,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:z,nearReachStart:Y,reachStart:U})=>{if(mt.current){const rt=z==="end"&&!Y;mt.current.hidden=rt}_(Y),U&&q(!0)},[]),V(()=>{var z;(z=R.current)==null||z.scrollTo({top:0}),q(!0)},[]),V(()=>{q(!0)},[g]);const G=O(m);V(()=>{G.current!==m&&(G.current=m,T([]))},[m]);const nt=Yt(async({disableIdleCheck:z=!1}={})=>{const Y=R.current?getComputedStyle(R.current).pointerEvents==="none":!1;S.settings.autoRefresh&&R.current.scrollTop<16&&(z||window.__IDLE__)&&!Bo()&&!Y?q(!0):await l()&&B(!0)},[s,q,l,S.settings.autoRefresh]),X=O();return me(z=>{if(z){const Y=Date.now()-X.current;(!X.current||Y>1e3*3)&&nt({disableIdleCheck:!0})}else X.current=Date.now();N(z)},[l,nt,S.settings.autoRefresh]),es(nt,L&&!D?u*($t?1:2):null),t(as.Provider,{value:w,children:t("div",{id:`${s}-page`,class:"deck-container",ref:z=>{R.current=z,Q.current=z,vt.current=z,Z.current=z},tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{ref:mt,onClick:z=>{var Y;z.target.closest("a, button")||(Y=R.current)==null||Y.scrollTo({top:0,behavior:"smooth"})},onDblClick:z=>{z.target.closest("a, button")||q(!0)},class:k==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),d??t(et,{to:"/",class:"button plain home-button",children:t(I,{icon:"home",size:"l"})})]}),e&&(n||t("h1",{children:e})),t("div",{class:"header-side",children:!!f&&f})]}),lt&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:ot,children:[t(I,{icon:"arrow-up"})," New posts"]})]}),!!p&&t("div",{class:`timeline-start ${k==="loading"?"loading":""}`,children:p}),y.length?t(E,{children:[t("ul",{class:`timeline ${m?`timeline-${m}`:""}`,children:[y.map(z=>t(Do,{status:z,instance:i,useItemID:h,filterContext:w,view:m,showFollowedTags:b,showReplyParent:v},z.id+(z==null?void 0:z._pinned)+m)),F&&k==="loading"&&(m==="media"?null:t(E,{children:[t("li",{style:{height:"20vh"},children:t(xt,{skeleton:!0})}),t("li",{style:{height:"25vh"},children:t(xt,{skeleton:!0})})]}))]}),k==="default"&&(F?t(ne,{root:R.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:z=>{z&&q()},children:t("button",{type:"button",class:"plain block",onClick:()=>q(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}))]}):k==="loading"?t("ul",{class:"timeline",children:Array.from({length:5}).map((z,Y)=>m==="media"?t("div",{style:{height:"50vh"}}):t("li",{children:t(xt,{skeleton:!0})},Y))}):k!=="error"&&t("p",{class:"ui-state",children:o}),k==="error"&&t("p",{class:"ui-state",children:[a,t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>q(!y.length),children:"Try again"})]})]})})})}const Do=zt(({status:e,instance:n,useItemID:s,filterContext:i,view:o,showFollowedTags:a,showReplyParent:h})=>{const{id:c,reblog:r,items:l,type:u,_pinned:d}=e;d&&(s=!1);const f=(r==null?void 0:r.id)||c,p=n?`/${n}/s/${f}`:`/s/${f}`;let g="";u==="boosts"?g=`${l.length} Boosts`:u==="pinned"&&(g="Pinned posts");const m=u==="boosts"||u==="pinned";if(l){const b=ye(l,i);if(m)return b.sort((S,y)=>{const T=tn(S.filtered,i),k=tn(y.filtered,i);return T&&!k?1:!T&&k?-1:0}),t("li",{class:"timeline-item-carousel",children:t(Uo,{title:g,class:`${u}-carousel`,children:b.map(S=>{const{id:y,reblog:T,_pinned:k}=S,C=(T==null?void 0:T.id)||y,F=n?`/${n}/s/${C}`:`/s/${C}`;return k&&(s=!1),t("li",{children:t(et,{class:"status-carousel-link timeline-item-alt",to:F,children:s?t(xt,{statusID:y,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):t(xt,{status:S,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},y)})})},`timeline-${c}`);const v=b.length>3;return b.map((S,y)=>{const{id:T,_differentAuthor:k}=S,C=n?`/${n}/s/${T}`:`/s/${T}`,F=y>0&&y<b.length-1,x=S.sensitive&&!!S.spoilerText,D=!k&&x&&y>0||v&&F&&(u==="thread"||u==="conversation"&&!k&&!b[y-1]._differentAuthor&&!b[y+1]._differentAuthor),B=y===0,L=y===b.length-1;return t("li",{class:`timeline-item-container timeline-item-container-type-${u} timeline-item-container-${B?"start":L?"end":"middle"} ${k?"timeline-item-diff-author":""}`,children:t(et,{class:"status-link timeline-item",to:C,children:D?t(Oo,{status:S,instance:n}):s?t(xt,{statusID:T,instance:n,enableCommentHint:L,showFollowedTags:a}):t(xt,{status:S,instance:n,enableCommentHint:L,showFollowedTags:a})})},`timeline-${T}`)})}const w=`timeline-${c+d}`;return o==="media"?s?t(zn,{class:"timeline-item",parent:"li",statusID:c,instance:n},w):t(zn,{class:"timeline-item",parent:"li",status:e,instance:n},w):t("li",{children:t(et,{class:"status-link timeline-item",to:p,children:s?t(xt,{statusID:c,instance:n,enableCommentHint:!0,showFollowedTags:a,showReplyParent:h}):t(xt,{status:e,instance:n,enableCommentHint:!0,showFollowedTags:a,showReplyParent:h})})},w)},(e,n)=>{var o,a;const s=(((o=e.status)==null?void 0:o.id)||"").toString(),i=(((a=n.status)==null?void 0:a.id)||"").toString();return s===i&&e.instance===n.instance&&e.view===n.view});function Uo({title:e,class:n,children:s}){const i=O(),o=O(),a=O(),[h,c]=A(!1);return V(()=>{setTimeout(()=>{c(!0)},1)},[]),t("div",{class:`status-carousel ${n}`,children:[t("header",{children:[t("h3",{children:e}),t("span",{children:[t("button",{ref:o,type:"button",class:"small plain2",onClick:()=>{var r,l;(l=i.current)==null||l.scrollBy({left:-Math.min(320,(r=i.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:t(I,{icon:"chevron-left"})})," ",t("button",{ref:a,type:"button",class:"small plain2",onClick:()=>{var r,l;(l=i.current)==null||l.scrollBy({left:Math.min(320,(r=i.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:t(I,{icon:"chevron-right"})})]})]}),t("ul",{ref:i,children:[t(ne,{class:"status-carousel-beacon",onChange:r=>{o.current&&(o.current.disabled=r)}}),s[0],h&&s.slice(1),t(ne,{class:"status-carousel-beacon",onChange:r=>{a.current&&(a.current.disabled=r)}})]})]})}function Oo({status:e,instance:n}){const s=It($),{id:i,visibility:o,language:a}=e,h=ls(e),c=Wt(i,n);return t("article",{class:`status compact-thread ${o==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[s.statusThreadNumber[c]?t("div",{class:"status-thread-badge",children:[t(I,{icon:"thread",size:"s"}),s.statusThreadNumber[c]?` ${s.statusThreadNumber[c]}/X`:""]}):t("div",{class:"status-thread-badge",children:t(I,{icon:"thread",size:"s"})}),t("div",{class:"content-compact",title:h,lang:a,dir:"auto",children:[h,e.sensitive&&e.spoilerText&&t(E,{children:[" ",t("span",{class:"spoiler-badge",children:t(I,{icon:"eye-close",size:"s"})})]})]})]})}function Bo(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const ue=20,yn=1983,qn=`${yn}-01`,Fo=(()=>{try{const e=document.createElement("input");return e.setAttribute("type","month"),e.type==="month"}catch{return!1}})();async function zo(e){var i;const{masto:n}=H({instance:e}),s=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((i=s==null?void 0:s.statuses)!=null&&i.length)}const qo=se(zo);function Ho(){const e=It($),{id:n,...s}=re(),[i,o]=Gt(),a=i.get("month"),h=!i.get("replies"),c=!!i.get("boosts"),r=i.get("tagged"),l=!!i.get("media"),{masto:u,instance:d,authenticated:f}=H({instance:s.instance}),{masto:p,instance:g}=H(),m=O(),w=[a,h,c,r,l],[b,v]=A(),S=O(0);V(()=>{S.current=0},w);const y=gt(()=>d===g,[d,g]),[T,k]=A(!1);V(()=>{y&&b!=null&&b.acct&&(async()=>{const Z=await qo(d);k(Z)})()},[d,y,b==null?void 0:b.acct]);async function C(Z){var _,G,nt;const lt=/^\d{4}-[01]\d$/.test(a),ot=((G=(_=a==null?void 0:a.split)==null?void 0:_.call(a,"-"))==null?void 0:G[0])>=yn;if(lt&&ot){if(!b)return{value:[],done:!0};const[X,z]=a.split("-"),Y=parseInt(z,10)-1,U=new Date(X,Y,0),rt=`${U.getFullYear()}-${(U.getMonth()+1).toString().padStart(2,"0")}-${U.getDate().toString().padStart(2,"0")}`,ht=new Date(X,Y+1,1),j=`${ht.getFullYear()}-${(ht.getMonth()+1).toString().padStart(2,"0")}-${ht.getDate().toString().padStart(2,"0")}`;let dt;Z?(dt=ue+1,S.current=0):(dt=ue+S.current+1,S.current+=ue);const yt=await u.v2.search.fetch({q:`from:${b.acct} after:${rt} before:${j}`,type:"statuses",limit:dt,offset:S.current});if((nt=yt==null?void 0:yt.statuses)!=null&&nt.length){const Lt=yt.statuses.slice(0,ue);Lt.forEach(M=>{Ct(M,d)});const Pt=yt.statuses.length<=ue;return{value:Lt,done:Pt}}else return{value:[],done:!0}}const ft=[];if(Z){const{value:X}=await u.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(X!=null&&X.length&&!r&&!l){const z=X.map(Y=>(Ct(Y,d),{...Y,_pinned:!0}));if(z.length>=3){const Y=z.map(U=>U.id);ft.push({id:Y,items:z,type:"pinned"})}else ft.push(...z)}}(Z||!m.current)&&(m.current=u.v1.accounts.$select(n).statuses.list({limit:ue,exclude_replies:h,exclude_reblogs:c,only_media:l,tagged:r}));const{value:mt,done:$t}=await m.current.next();return mt!=null&&mt.length&&(ft.push(...mt),mt.forEach(X=>{Ct(X,d)})),{value:ft,done:$t}}const[F,x]=A([]);Mt(b!=null&&b.acct?`${b!=null&&b.displayName?b.displayName+" ":""}@${b.acct}${h?c?" (- Boosts)":r?` (#${r})`:l?" (Media)":a?` (${new Date(a).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const D=O(),B=Yt(()=>{const Z=D.current||u.v1.accounts.$select(n).fetch();return D.current=Z,Z},[n,u]);V(()=>{(async()=>{try{const Z=await B();v(Z)}catch{}try{const Z=await u.v1.accounts.$select(n).featuredTags.list();x(Z)}catch{}})()},[n]);const{displayName:L,acct:N,emojis:R}=b||{},K=O(),q=gt(()=>{const Z=!h||c||r||l||!!a,lt=e.accounts[`${n}@${d}`];return t(E,{children:[t(uo,{instance:d,account:lt||n,fetchAccount:B,authenticated:f,standalone:!0}),t("div",{class:"filter-bar",ref:K,style:{position:"relative"},children:[Z?t(et,{to:`/${d}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:t(I,{icon:"x",size:"l"})},"clear-filters"):t(I,{icon:"filter",class:"insignificant",size:"l"}),t(et,{to:`/${d}/a/${n}${h?"?replies=1":""}`,onClick:()=>{h&&ut("Showing post with replies")},class:h?"":"is-active",children:"+ Replies"}),t(et,{to:`/${d}/a/${n}${c?"":"?boosts=0"}`,onClick:()=>{c||ut("Showing posts without boosts")},class:c?"is-active":"",children:"- Boosts"}),t(et,{to:`/${d}/a/${n}${l?"":"?media=1"}`,onClick:()=>{l||ut("Showing posts with media")},class:l?"is-active":"",children:"Media"}),F.map(ot=>t(et,{to:`/${d}/a/${n}${r===ot.name?"":`?tagged=${encodeURIComponent(ot.name)}`}`,onClick:()=>{r!==ot.name&&ut(`Showing posts tagged with #${ot.name}`)},class:r===ot.name?"is-active":"",children:t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),ot.name]})},ot.id)),T&&(Fo?t("label",{class:`filter-field ${a?"is-active":""}`,children:[t(I,{icon:"month",size:"l"}),t("input",{type:"month",disabled:!(b!=null&&b.acct),value:a||"",min:qn,max:new Date().toISOString().slice(0,7),onInput:ot=>{const{value:ft,validity:mt}=ot.currentTarget;if(!mt.valid)return;o(ft?{month:ft}:{});const[$t,_]=ft.split("-"),G=parseInt(_,10)-1,nt=new Date($t,G);ut(`Showing posts in ${nt.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):t(Vo,{class:`filter-field ${a?"is-active":""}`,disabled:!(b!=null&&b.acct),value:a||"",min:qn,max:new Date().toISOString().slice(0,7),onInput:ot=>{const{value:ft,validity:mt}=ot;mt.valid&&o(ft?{month:ft}:{})}}))]})]})},[n,d,f,F,B,T,...w]);V(()=>{var lt;const Z=(lt=K.current)==null?void 0:lt.querySelector(".is-active");Z&&K.current.scrollTo({behavior:"smooth",left:Z.offsetLeft-(K.current.offsetWidth-Z.offsetWidth)/2})},[F,T,...w]);const tt=gt(()=>b!=null&&b.url?new URL(b.url).hostname:null,[b]),vt=!!b&&!(d===tt);return t(Qt,{title:`${b!=null&&b.acct?"@"+b.acct:"Posts"}`,titleComponent:t("h1",{class:"header-double-lines header-account",children:[t("b",{children:t(ss,{text:L,emojis:R})}),t("div",{children:t("span",{children:["@",N]})})]}),id:"account-statuses",instance:d,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:C,useItemID:!0,view:l?"media":void 0,boostsCarousel:e.settings.boostsCarousel,timelineStart:q,refresh:[h,c,r,l,a+(b==null?void 0:b.acct)].toString(),headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[t(ct,{disabled:!vt,onClick:()=>{(async()=>{try{const{masto:Z}=H({instance:tt}),lt=await Z.v1.accounts.lookup({acct:b.acct}),{id:ot}=lt;location.hash=`/${tt}/a/${ot}`}catch{alert("Unable to fetch account info")}})()},children:[t(I,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to account's instance (",t("b",{children:tt}),")"]})]}),!y&&t(ct,{onClick:()=>{(async()=>{try{const Z=await p.v1.accounts.lookup({acct:b.acct+"@"+d}),{id:lt}=Z;location.hash=`/${g}/a/${lt}`}catch{alert("Unable to fetch account info")}})()},children:[t(I,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to my instance (",t("b",{children:g}),")"]})]})]})},n)}function Vo(e){const{class:n,disabled:s,value:i,min:o,max:a,onInput:h=()=>{}}=e,[c,r]=(i==null?void 0:i.split("-"))||[],l=O(),u=O(),d=(f,p)=>{const[g,m]=(o==null?void 0:o.split("-"))||[],[w,b]=(a==null?void 0:a.split("-"))||[];return!(p<g||p>w||p===g&&f<m||p===w&&f>b)};return t("div",{class:n,children:[t(I,{icon:"month",size:"l"}),t("select",{ref:l,disabled:s,value:r||"",onInput:f=>{const{value:p}=f.currentTarget,g=u.current.value;if(!d(p,g))return{value:"",validity:{valid:!1}};h({value:p?`${g}-${p}`:"",validity:{valid:!0}})},children:[t("option",{value:"",children:"Month"}),t("option",{disabled:!0,children:"-----"}),Array.from({length:12},(f,p)=>t("option",{value:(p+1).toString().padStart(2,"0"),children:new Date(0,p).toLocaleString("default",{month:"long"})},p))]})," ",t("input",{ref:u,type:"number",disabled:s,value:c||new Date().getFullYear(),min:(o==null?void 0:o.slice(0,4))||yn,max:(a==null?void 0:a.slice(0,4))||new Date().getFullYear(),onInput:f=>{const{value:p,validity:g}=f.currentTarget,m=l.current.value;if(!g.valid||!d(m,p))return{value:"",validity:{valid:!1}};h({value:p?`${p}-${m}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const jo=20;function xs(){Mt("Bookmarks","/b");const{masto:e,instance:n}=H(),s=O();async function i(o){return(o||!s.current)&&(s.current=e.v1.bookmarks.list({limit:jo})),await s.current.next()}return t(Qt,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:i})}const Yo=20;function As(){Mt("Likes","/f");const{masto:e,instance:n}=H(),s=O();async function i(o){return(o||!s.current)&&(s.current=e.v1.favourites.list({limit:Yo})),await s.current.next()}return t(Qt,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:i})}function Wo(){const{masto:e,instance:n}=H();Mt("Followed Hashtags","/ft");const[s,i]=A("default"),[o,a]=A([]);return V(()=>{i("loading"),(async()=>{try{const h=await ze();a(h),i("default")}catch{i("error")}})()},[]),t("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),t(et,{to:"/",class:"button plain",children:t(I,{icon:"home",size:"l"})})]}),t("h1",{children:"Followed Hashtags"}),t("div",{class:"header-side"})]})}),t("main",{children:o.length>0?t(E,{children:[t("ul",{class:"link-list",children:o.map(h=>t("li",{children:t(et,{to:n?`/${n}/t/${h.name}`:`/t/${h.name}`,children:[t(I,{icon:"hashtag"})," ",t("span",{children:h.name})]})}))}),o.length>1&&t("footer",{class:"ui-state",children:t("small",{class:"insignificant",children:[o.length," hashtag",o.length===1?"":"s"]})})]}):s==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):s==="error"?t("p",{class:"ui-state",children:"Unable to load followed hashtags."}):t("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const Go=20;function wn({title:e,path:n,id:s,...i}){Mt(e||"Following",n||"/following");const{masto:o,streaming:a,instance:h}=H(),c=It($),r=O(),l=O();async function u(f){(f||!r.current)&&(r.current=o.v1.timelines.home.list({limit:Go}));const p=await r.current.next();let{value:g}=p;if(g!=null&&g.length){let m=!1;f&&(g[0].id!==l.current&&(m=!0),l.current=g[0].id),g.forEach(w=>{Ct(w,h)}),g=Fn(g,h),f&&m&&Mo(),Ro(g,h),g.sort((w,b)=>{const v=new Date(w.createdAt);return new Date(b.createdAt)-v})}return{...p,value:g}}async function d(){try{const f=await o.v1.timelines.home.list({limit:5,since_id:l.current}).next();let{value:p}=f;return!!(p!=null&&p.length&&(l.current=p[0].id,p=Fn(p,h),p=ye(p,"home"),p.some(g=>!g.reblog)))}catch{return!1}}return V(()=>{let f;return(async()=>{if(a){f=a.user.subscribe();for await(const p of f){if(!f)break;if(p.event==="status.update"){const g=p.payload;Ct(g,h)}else if(p.event==="delete"){const g=p.payload,m=ds(g,h);m&&(m._deleted=!0)}}}})(),()=>{var p;(p=f==null?void 0:f.unsubscribe)==null||p.call(f),f=null}},[a]),t(Qt,{title:e||"Following",id:s||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:h,fetchItems:u,checkForUpdates:d,useItemID:!0,boostsCarousel:c.settings.boostsCarousel,...i,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const Ko=20,Zo=4,Hn=Zo+1;function Es({media:e,columnMode:n,...s}){let{hashtag:i,...o}=n?{}:re();s.hashtag&&(i=s.hashtag);let a=i.trim().split(/[\s+]+/);a.sort(),i=a[0];const[h,c]=Gt(),r=e||!!h.get("media"),l=r?"?media=1":"",{masto:u,instance:d,authenticated:f}=H({instance:(s==null?void 0:s.instance)||o.instance}),{masto:p,instance:g,authenticated:m}=H(),w=a.map(L=>`#${L}`).join(" "),b=r?" (Media only)":"",v=d?`${w}${b} on ${d}`:`${w}${b}`;Mt(v,"/:instance?/t/:hashtag");const S=O(),y=O(void 0);async function T(L){const N=await u.v1.timelines.tag.$select(i).list({limit:Ko,any:a.slice(1),maxId:L?void 0:y.current,onlyMedia:r}).next();let{value:R}=N;return R!=null&&R.length&&(L&&(S.current=R[0].id),R.forEach(K=>{Ct(K,d,{skipThreading:r})}),y.current=R[R.length-1].id),{...N,value:R}}async function k(){try{const L=await u.v1.timelines.tag.$select(i).list({limit:1,any:a.slice(1),since_id:S.current,onlyMedia:r}).next();let{value:N}=L;return N=ye(N,"public"),!!(N!=null&&N.length)}catch{return!1}}const[C,F]=A("default"),[x,D]=A();V(()=>{(async()=>{try{const L=await u.v1.tags.$select(i).fetch();D(L)}catch{}})()},[i]);const B=a.length>=Hn;return t(Qt,{title:v,titleComponent:!!d&&t("h1",{class:"header-double-lines",children:[t("b",{children:w}),t("div",{children:d})]}),id:"hashtag",instance:d,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:T,checkForUpdates:k,useItemID:!0,view:r?"media":void 0,refresh:r,filterContext:"public",headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[!!x&&a.length===1&&t(E,{children:[t(oe,{subMenu:!0,confirm:x.following,confirmLabel:`Unfollow #${i}?`,disabled:C==="loading"||!f,onClick:()=>{F("loading"),x.following?u.v1.tags.$select(i).unfollow().then(()=>{D({...x,following:!1}),ut(`Unfollowed #${i}`)}).catch(L=>{alert(L)}).finally(()=>{F("default")}):u.v1.tags.$select(i).follow().then(()=>{D({...x,following:!0}),ut(`Followed #${i}`)}).catch(L=>{alert(L)}).finally(()=>{F("default")})},children:x.following?t(E,{children:[t(I,{icon:"check-circle"})," ",t("span",{children:"Following…"})]}):t(E,{children:[t(I,{icon:"plus"})," ",t("span",{children:"Follow"})]})}),t(_t,{})]}),t(us,{className:"plain",children:"Filters"}),t(ct,{type:"checkbox",checked:!!r,onClick:()=>{r?h.delete("media"):h.set("media","1"),c(h)},children:[t(I,{icon:"check-circle"})," ",t("span",{class:"menu-grow",children:"Media only"})]}),t(_t,{}),t(oi,{className:"menu-field",disabled:B,children:({ref:L})=>t("form",{onSubmit:N=>{var K,q;N.preventDefault();const R=(q=(K=N.target[0].value)==null?void 0:K.trim)==null?void 0:q.call(K);R&&!a.some(tt=>tt.toLowerCase()===R.toLowerCase())&&(a.push(R),a.sort(),location.hash=d?`/${d}/t/${a.join("+")}`:`/t/${a.join("+")}${l}`)},children:[t(I,{icon:"hashtag"}),t("input",{ref:L,type:"text",placeholder:B?`Max ${Hn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:B})]})}),t(ai,{takeOverflow:!0,children:a.map((L,N)=>t(ct,{disabled:a.length===1,onClick:R=>{a.splice(N,1),a.sort(),location.hash=d?`/${d}/t/${a.join("+")}${l}`:`/t/${a.join("+")}${l}`},children:[t(I,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),L]})]},L))}),t(_t,{}),t(ct,{disabled:!m,onClick:()=>{if($.shortcuts.length>=Zt){alert(`Max ${Zt} shortcuts reached. Unable to add shortcut.`);return}const L={type:"hashtag",hashtag:a.join(" "),instance:d,media:r?"on":void 0};$.shortcuts.some(R=>R.type===L.type&&R.hashtag.split(/[\s+]+/).sort().join(" ")===L.hashtag.split(/[\s+]+/).sort().join(" ")&&(R.instance?R.instance===L.instance:!0)&&(R.media?!!R.media==!!L.media:!0))?alert("This shortcut already exists"):($.shortcuts.push(L),ut("Hashtag shortcut added"))},children:[t(I,{icon:"shortcut"})," ",t("span",{children:"Add to Shorcuts"})]}),t(ct,{onClick:()=>{let L=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(L)){L&&alert("Invalid instance");return}L&&(L=L.toLowerCase().trim(),location.hash=`/${L}/t/${a.join("+")}${l}`)},children:[t(I,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),g!==d&&t(ct,{onClick:()=>{location.hash=`/${g}/t/${a.join("+")}${l}`},children:[t(I,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:g}),")"]})]})]})},d+w)}const Xo=20;function Rs(e){var m;const n=It($),{masto:s,instance:i}=H(),o=(e==null?void 0:e.id)||((m=re())==null?void 0:m.id),a=O(),h=O();async function c(w){(w||!h.current)&&(h.current=s.v1.timelines.list.$select(o).list({limit:Xo}));const b=await h.current.next();let{value:v}=b;return v!=null&&v.length&&(w&&(a.current=v[0].id),v.forEach(S=>{Ct(S,i)})),{...b,value:v}}async function r(){try{const w=await s.v1.timelines.list.$select(o).list({limit:1,since_id:a.current});let{value:b}=w;return b=ye(b,"home"),!!(b!=null&&b.length)}catch{return!1}}const[l,u]=A({title:"List"});Mt(l.title,"/l/:id"),V(()=>{(async()=>{try{const w=await s.v1.lists.$select(o).fetch();u(w)}catch{}})()},[o]);const[d,f]=A(!1),[p,g]=A(!1);return t(E,{children:[t(Qt,{title:l.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:i,fetchItems:c,checkForUpdates:r,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:t(et,{to:"/l",class:"button plain",children:t(I,{icon:"list",size:"l"})}),headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[t(ct,{onClick:()=>f({list:l}),children:[t(I,{icon:"pencil",size:"l"}),t("span",{children:"Edit"})]}),t(ct,{onClick:()=>g(!0),children:[t(I,{icon:"group",size:"l"}),t("span",{children:"Manage members"})]})]})},o),d&&t(Ht,{onClick:w=>{w.target===w.currentTarget&&f(!1)},children:t(vn,{list:d==null?void 0:d.list,onClose:w=>{w.state==="success"&&w.list?u(w.list):w.state==="deleted"&&(location.hash="/l"),f(!1)}})}),p&&t(Ht,{onClick:w=>{w.target===w.currentTarget&&g(!1)},children:t(Qo,{listID:o,onClose:()=>g(!1)})})]})}const Jo=40;function Qo({listID:e,onClose:n}){const{masto:s,instance:i}=H(),[o,a]=A([]),[h,c]=A("default"),[r,l]=A(!1),u=O();async function d(f){l(!1),c("loading"),(async()=>{try{(f||!u.current)&&(u.current=s.v1.lists.$select(e).accounts.list({limit:Jo}));const p=await u.current.next();let{done:g,value:m}=p;m!=null&&m.length?(a(f?m:o.concat(m)),l(!g)):l(!1),c("default")}catch{c("error")}})()}return V(()=>{d(!0)},[]),t("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(I,{icon:"x"})}),t("header",{children:t("h2",{children:"Manage members"})}),t("main",{children:t("ul",{children:[o.map(f=>t("li",{children:[t(te,{account:f,instance:i}),t(ta,{account:f,listID:e})]},f.id)),r&&h==="default"&&t(ne,{as:"li",onChange:f=>f&&d(),children:t("button",{type:"button",class:"light block",onClick:d,children:"Show more…"})})]})})]})}function ta({account:e,listID:n}){const{masto:s}=H(),[i,o]=A("default"),[a,h]=A(!1);return t(oe,{confirm:!a,confirmLabel:t("span",{children:["Remove @",e.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{a?(o("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.create({accountIds:[e.id]}),o("default"),h(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.remove({accountIds:[e.id]}),o("default"),h(!0)}catch{o("error")}})())},children:t("button",{type:"button",class:`light ${a?"":"danger"}`,disabled:i==="loading",children:a?"Add":"Remove…"})})}const Vn=20,ea=new URLSearchParams;function Ms({columnMode:e,...n}){const{masto:s,instance:i}=H(),[o]=e?[ea]:Gt(),[a,h]=A(null),c=(n==null?void 0:n.type)||o.get("type")||a;Mt(`Mentions${c==="private"?" (Private)":""}`,"/mentions");const r=O(),l=O();async function u(b){(b||!r.current)&&(r.current=s.v1.notifications.list({limit:Vn,types:["mention"]}));const v=await r.current.next();let{value:S}=v;return S!=null&&S.length&&(b&&(l.current=S[0].id),S.forEach(({status:y})=>{Ct(y,i)})),{...v,value:S==null?void 0:S.map(y=>y.status)}}const d=O(),f=O();async function p(b){(b||!d.current)&&(d.current=s.v1.conversations.list({limit:Vn}));const v=await d.current.next();let{value:S}=v;return S=S==null?void 0:S.filter(y=>y.lastStatus),S!=null&&S.length&&(b&&(f.current=S[0].lastStatus.id),S.forEach(({lastStatus:y})=>{Ct(y,i)})),{...v,value:S==null?void 0:S.map(y=>y.lastStatus)}}function g(...b){return c==="private"?p(...b):u(...b)}async function m(){if(c==="private")try{const b=await s.v1.conversations.list({limit:1,since_id:f.current}).next();let{value:v}=b;return v!=null&&v.length?(f.current=v[0].lastStatus.id,!0):!1}catch{return!1}else try{const b=await s.v1.notifications.list({limit:1,types:["mention"],since_id:l.current}).next();let{value:v}=b;return v!=null&&v.length?(l.current=v[0].id,!0):!1}catch{return!1}}const w=gt(()=>t("div",{class:"filter-bar centered",children:[t(et,{to:"/mentions",class:c?"":"is-active",onClick:b=>{e&&(b.preventDefault(),h(null))},children:"All"}),t(et,{to:"/mentions?type=private",class:c==="private"?"is-active":"",onClick:b=>{e&&(b.preventDefault(),h("private"))},children:"Private"})]}),[c]);return t(Qt,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:i,fetchItems:g,checkForUpdates:m,useItemID:!0,timelineStart:w,refresh:c})}const na={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function sa(e){return e.filter(n=>{const{type:s,id:i,createdAt:o}=n;if(!s)return!1;const a=na[s];return a!=null&&a.length?a.every(h=>!!n[h]):!0})}function Ls(e){e=sa(e);const n={},s=[];for(let a=0,h=0;a<e.length;a++){const c=e[a],{id:r,status:l,account:u,type:d,createdAt:f}=c,p=f?new Date(f).toLocaleDateString():"";let g=d;(d==="favourite"||d==="reblog")&&(g="favourite+reblog");const m=`${l==null?void 0:l.id}-${g}-${p}`,w=n[m];if(g==="follow_request")s[h++]=c;else if(w!=null&&w.account){const b=w._accounts.find(v=>v.id===u.id);b?(b._types.push(d),b._types.sort().reverse(),w.id+=`-${r}`):(u._types=[d],w._accounts.push(u),w.id+=`-${r}`)}else{u._types=[d];let b=n[m]={...c,type:g,_accounts:[u]};s[h++]=b}}const i={},o=[];for(let a=0,h=0;a<s.length;a++){const c=s[a],{id:r,account:l,_accounts:u,type:d,createdAt:f}=c,p=f?new Date(f).toLocaleDateString():"";if(d==="favourite+reblog"&&l&&u.length===1){const g=`${l==null?void 0:l.id}-${d}-${p}`,m=i[g];if(m)m._statuses.push(c.status),m.id+=`-${r}`;else{let w=i[g]={...c,type:d,_statuses:[c.status]};o[h++]=w}}else o[h++]=c}return o}function jn(e){const{masto:n}=H();return n.v1.push.subscription.create(e)}function ia(){const{masto:e}=H();return e.v1.push.subscription.fetch()}function oa(e){const{masto:n}=H();return n.v1.push.subscription.update(e)}function aa(){const{masto:e}=H();return e.v1.push.subscription.remove()}function Sn(){return"serviceWorker"in navigator&&"PushManager"in window}function ra(){return navigator.serviceWorker.getRegistration()}async function kn(){const e=await ra(),n=e?await e.pushManager.getSubscription():void 0;return{registration:e,subscription:n}}function _s(e){const n="=".repeat((4-e.length%4)%4),s=`${e}${n}`.replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(s),o=new Uint8Array(i.length);for(let a=0;a<i.length;++a)o[a]=i.charCodeAt(a);return o}async function br(){if(!Sn())return;const{subscription:e}=await kn();let n=null;try{n=await ia()}catch(s){if(!/(not found|unknown)/i.test(s.message))throw s}if(n&&e){const s=n.endpoint===e.endpoint,{vapidKey:i}=pe(),o=n.serverKey===i;if(!s)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(e&&!n){const{vapidKey:s}=pe(),{applicationServerKey:i}=e.options,o=_s(s).toString(),a=new Uint8Array(i).toString();if(!(o===a))throw await e.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:e,backendSubscription:n}}async function vr({data:e,policy:n}){if(!Sn())return;let{registration:s,subscription:i}=await kn(),o=null;if(i)try{o=await oa({data:e,policy:n})}catch{o=await jn({subscription:i,data:e,policy:n})}else{const{vapidKey:a}=pe();if(!a)throw new Error("No server key found");i=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_s(a)}),o=await jn({subscription:i,data:e,policy:n})}return{subscription:i,backendSubscription:o}}async function yr(){if(!Sn())return;const{subscription:e}=await kn();e&&(await aa(),await e.unsubscribe())}const ca=30,la=new URLSearchParams,Le={block:"center",inline:"center",behavior:"smooth"};function da({columnMode:e}){Mt("Notifications","/notifications");const{masto:n,instance:s}=H(),i=It($),[o,a]=A("default"),[h]=e?[la]:Gt(),c=h.get("id"),r=h.get("access_token"),[l,u]=A(!1),[d,f]=A(!1),p=O(),{nearReachEnd:g,scrollDirection:m,reachStart:w,nearReachStart:b}=Lo({scrollableRef:p}),v=m==="end"&&!b,[S,y]=A([]),[T,k]=A([]),C=O();async function F(_){(_||!C.current)&&(C.current=n.v1.notifications.list({limit:ca,excludeTypes:["follow_request"]}));const G=await C.current.next(),nt=G.value;if(nt!=null&&nt.length){nt.forEach(z=>{Ct(z.status,s,{skipThreading:!0})});const X=Ls(nt);_?($.notificationsLast=nt[0],$.notifications=X,n.v1.markers.create({notifications:{lastReadId:nt[0].id}}).catch(()=>{})):$.notifications.push(...X)}return $.notificationsShowNew=!1,$.notificationsLastFetchTime=Date.now(),G}async function x(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const D=()=>{a("loading"),(async()=>{try{const _=await x();y(_),a("default")}catch{a("error")}})()};async function B(){try{return await n.v1.announcements.list()}catch{return[]}}const L=_=>{R(!1),a("loading"),(async()=>{try{const G=F(_);_&&(B().then(X=>{X.sort((z,Y)=>{const U=new Date(z.updatedAt||z.createdAt);return new Date(Y.updatedAt||Y.createdAt)-U}),k(X)}).catch(()=>{}),x().then(X=>{y(X)}).catch(()=>{}));const{done:nt}=await G;u(!nt),a("default")}catch{a("error")}})()};V(()=>{L(!0)},[]),V(()=>{w&&L(!0)},[w]);const[N,R]=A(!1),K=Yt(({disableIdleCheck:_=!1}={})=>{var G;o!=="loading"&&i.settings.autoRefresh&&((G=p.current)==null?void 0:G.scrollTop)<16&&(_||window.__IDLE__)&&!ua()&&L(!0)},[i.notificationsShowNew,i.settings.autoRefresh,o]),q=O();me(_=>{let G;if(_){const nt=Date.now()-q.current;!q.current||nt>1e3*3?K({disableIdleCheck:!0}):q.current=Date.now(),G=ri($,"notificationsShowNew",X=>{o!=="loading"&&(X&&K(),R(X))})}return()=>{G==null||G()}});const tt=new Date,Q=new Date(tt-24*60*60*1e3);let vt=new Date;const Z=!i.notifications.some(_=>new Date(_.createdAt).toDateString()===tt.toDateString()),lt=O();V(()=>{c&&($.routeNotification={id:c,accessToken:atob(r)})},[c,r]);const ot=".notification",ft=St("j",()=>{const _=document.activeElement.closest(ot),G=_==null?void 0:_.getBoundingClientRect(),nt=Array.from(p.current.querySelectorAll(ot));if(_&&G.top<p.current.clientHeight&&G.bottom>0){const X=nt.indexOf(_);let z=nt[X+1];z&&(z.focus(),z.scrollIntoView(Le))}else{const X=nt.find(z=>{const Y=z.getBoundingClientRect();return Y.top>=44&&Y.left>=0});X&&(X.focus(),X.scrollIntoView(Le))}}),mt=St("k",()=>{const _=document.activeElement.closest(ot),G=_==null?void 0:_.getBoundingClientRect(),nt=Array.from(p.current.querySelectorAll(ot));if(_&&G.top<p.current.clientHeight&&G.bottom>0){const X=nt.indexOf(_);let z=nt[X-1];z&&(z.focus(),z.scrollIntoView(Le))}else{const X=nt.find(z=>{const Y=z.getBoundingClientRect();return Y.top>=44&&Y.left>=0});X&&(X.focus(),X.scrollIntoView(Le))}}),$t=St(["enter","o"],()=>{const _=document.activeElement.closest(ot),G=_==null?void 0:_.querySelector(".status-link");G&&G.click()});return t("div",{id:"notifications-page",class:"deck-container",ref:_=>{p.current=_,ft.current=_,mt.current=_,$t.current=_},tabIndex:"-1",children:t("div",{class:`timeline-deck deck ${d?"only-mentions":""}`,children:[t("header",{hidden:v,onClick:_=>{var G;_.target.closest("a, button")||(G=p.current)==null||G.scrollTo({top:0,behavior:"smooth"})},onDblClick:_=>{_.target.closest("a, button")||L(!0)},class:o==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),t(et,{to:"/",class:"button plain",children:t(I,{icon:"home",size:"l",alt:"Home"})})]}),t("h1",{children:"Notifications"}),t("div",{class:"header-side"})]}),N&&o!=="loading"&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var _;L(!0),(_=p.current)==null||_.scrollTo({top:0,behavior:"smooth"})},children:[t(I,{icon:"arrow-up"})," New notifications"]})]}),T.length>0&&t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("details",{class:"announcements",children:[t("summary",{children:[t("span",{children:[t(I,{icon:"announce",class:"announcement-icon",size:"l"})," ",t("b",{children:["Announcement",T.length>1?"s":""]})," ",t("small",{class:"insignificant",children:s})]}),T.length>1&&t("span",{class:"announcements-nav-buttons",children:T.map((_,G)=>t("button",{type:"button",class:"plain2 small",onClick:()=>{var nt;(nt=lt.current)==null||nt.children[G].scrollIntoView({behavior:"smooth",block:"nearest"})},children:G+1}))})]}),t("ul",{class:`announcements-list-${T.length>1?"multiple":"single"}`,ref:lt,children:T.map(_=>t("li",{children:t(ha,{announcement:_})}))})]})})}),S.length>0&&t("div",{class:"follow-requests",children:[t("h2",{class:"timeline-header",children:"Follow requests"}),S.length>5?t("details",{children:[t("summary",{children:[S.length," follow requests"]}),t("ul",{children:S.map(_=>t("li",{children:[t(te,{account:_}),t(en,{accountID:_.id,onChange:()=>{}})]},_.id))})]}):t("ul",{children:S.map(_=>t("li",{children:[t(te,{account:_}),t(en,{accountID:_.id,onChange:()=>{}})]},_.id))})]}),t("div",{id:"mentions-option",children:t("label",{children:[t("input",{type:"checkbox",checked:d,onChange:_=>{f(_.target.checked)}})," ","Only mentions"]})}),t("h2",{class:"timeline-header",children:"Today"}),Z&&!!i.notifications.length&&t("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":t(E,{children:"…"})}),i.notifications.length?t(E,{children:i.notifications.filter(_=>_.type!=="follow_request").map(_=>{if(d&&_.type!=="mention")return null;const G=new Date(_.createdAt),nt=G.toDateString()!==vt.toDateString();nt&&(vt=G);const X=G.toDateString()===Q.toDateString()?"Yesterday":ie(vt,{hideTime:!0});return t(E,{children:[nt&&t("h2",{class:"timeline-header",children:X}),t(hn,{instance:s,notification:_},_.id)]},_.id)})}):t(E,{children:[o==="loading"&&t(E,{children:t("ul",{class:"timeline flat",children:Array.from({length:5}).map((_,G)=>t("li",{class:"notification skeleton",children:[t("div",{class:"notification-type",children:t(I,{icon:"notification",size:"xl"})}),t("div",{class:"notification-content",children:t("p",{children:"███████████ ████"})})]}))})}),o==="error"&&t("p",{class:"ui-state",children:["Unable to load notifications",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>L(!0),children:"Try again"})]})]}),l&&t(ne,{onChange:_=>{_&&L()},children:t("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>L(),style:{marginBlockEnd:"6em"},children:o==="loading"?t(At,{abrupt:!0}):t(E,{children:"Show more…"})})})]})})}function ua(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function ha({announcement:e}){const{instance:n}=H(),{contact:s}=ci(),i=s==null?void 0:s.account,{id:o,content:a,startsAt:h,endsAt:c,published:r,allDay:l,publishedAt:u,updatedAt:d,read:f,mentions:p,statuses:g,tags:m,emojis:w,reactions:b}=e,v=new Date(u),S=ie(v),y=new Date(d),T=ie(y);return t("div",{class:"announcement-block",children:[t(te,{account:i}),t("div",{class:"announcement-content",onClick:ns({mentions:p,instance:n}),dangerouslySetInnerHTML:{__html:Qe(a,{emojis:w})}}),t("p",{class:"insignificant",children:[t("time",{datetime:v.toISOString(),children:ie(v)}),d&&T!==S&&t(E,{children:[" ","•"," ",t("span",{class:"ib",children:["Updated"," ",t("time",{datetime:y.toISOString(),children:ie(y)})]})]})]}),t("div",{class:"announcement-reactions",hidden:!0,children:b.map(k=>{const{name:C,count:F,me:x,staticUrl:D,url:B}=k;return t("button",{type:"button",class:`plain4 small ${x?"reacted":""}`,children:[B||D?t("img",{src:B||D,alt:C,width:"16",height:"16"}):t("span",{children:C})," ",t("span",{class:"count",children:Ft(F)})]})})})]})}const Ns=zt(da),fa=20;function rn({local:e,columnMode:n,...s}){const i=It($),o=!!e,a=n?{}:re(),{masto:h,instance:c}=H({instance:(s==null?void 0:s.instance)||a.instance}),{masto:r,instance:l}=H(),u=`${o?"Local":"Federated"} timeline (${c})`;Mt(u,o?"/:instance?/p/l":"/:instance?/p");const d=O(),f=O();async function p(m){(m||!f.current)&&(f.current=h.v1.timelines.public.list({limit:fa,local:o}));const w=await f.current.next();let{value:b}=w;return b!=null&&b.length&&(m&&(d.current=b[0].id),b.forEach(v=>{Ct(v,c)})),{...w,value:b}}async function g(){try{const m=await h.v1.timelines.public.list({limit:1,local:o,since_id:d.current}).next();let{value:w}=m;return w=ye(w,"public"),!!(w!=null&&w.length)}catch{return!1}}return t(Qt,{title:u,titleComponent:t("h1",{class:"header-double-lines",children:[t("b",{children:o?"Local timeline":"Federated timeline"}),t("div",{children:c})]}),id:"public",instance:c,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:p,checkForUpdates:g,useItemID:!0,headerStart:t(E,{}),boostsCarousel:i.settings.boostsCarousel,filterContext:"public",headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[t(ct,{href:o?`/#/${c}/p`:`/#/${c}/p/l`,children:o?t(E,{children:[t(I,{icon:"transfer"})," ",t("span",{children:"Switch to Federated"})]}):t(E,{children:[t(I,{icon:"transfer"})," ",t("span",{children:"Switch to Local"})]})}),t(_t,{}),t(ct,{onClick:()=>{let m=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(m)){m&&alert("Invalid instance");return}m&&(m=m.toLowerCase().trim(),location.hash=o?`/${m}/p/l`:`/${m}/p`)},children:[t(I,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),l!==c&&t(ct,{onClick:()=>{location.hash=o?`/${l}/p/l`:`/${l}/p`},children:[t(I,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:l}),")"]})]})]})},c+o)}const _e=5,Ge=40,pa=new URLSearchParams;function Ps({columnMode:e,...n}){const s=e?{}:re(),{masto:i,instance:o,authenticated:a}=H({instance:s.instance}),[h,c]=A("default"),[r]=e?[pa]:Gt(),l=O(),u=(n==null?void 0:n.query)||r.get("q"),d=e?"statuses":(n==null?void 0:n.type)||r.get("type");Mt(u?`Search: ${u}${d?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[d]})`:""}`:"Search","/search");const[f,p]=A(!1),g=O(0);V(()=>{g.current=0},[u,d]);const m=O();Xt(()=>{var N,R;(R=(N=m.current)==null?void 0:N.scrollTo)==null||R.call(N,0,0)},[u,d]);const[w,b]=A([]),[v,S]=A([]),[y,T]=A([]);V(()=>{b([]),S([]),T([])},[u]);const k={statuses:b,accounts:S,hashtags:T},[C,F]=A({}),x=async N=>{if(!(N!=null&&N.length))return;const R=await $s(N,C);R&&F({...C,...R})};function D(N){N&&(g.current=0),!(!N&&!a)&&(c("loading"),N&&!d&&(b(w.slice(0,_e)),S(v.slice(0,_e)),T(y.slice(0,_e))),(async()=>{var K,q;const R={q:u,resolve:a,limit:_e};d&&(R.limit=Ge,R.type=d,a&&(R.offset=g.current));try{const tt=await i.v2.search.fetch(R);if(d)if(N){k[d](tt[d]);const Q=(K=tt[d])==null?void 0:K.length;g.current=Ge,p(!!Q)}else{k[d](vt=>[...vt,...tt[d]]);const Q=(q=tt[d])==null?void 0:q.length;g.current=g.current+Ge,p(!!Q)}else b(tt.statuses||[]),S(tt.accounts||[]),T(tt.hashtags||[]),g.current=0,p(!1);x(tt.accounts),c("default")}catch{c("error")}})())}const B=O();me(N=>{var K;const R=((K=m.current)==null?void 0:K.scrollTop)===0;if(N&&R){const q=Date.now()-B.current;!B.current||q>1e3*3?D(!0):B.current=Date.now()}}),V(()=>{var N,R,K,q;(R=(N=l.current)==null?void 0:N.setValue)==null||R.call(N,u||""),u?D(!0):(q=(K=l.current)==null?void 0:K.focus)==null||q.call(K)},[u,d,o]),St(["/","Slash"],N=>{var R,K;(K=(R=l.current)==null?void 0:R.focus)==null||K.call(R)},{preventDefault:!0});const[L]=Is();return t("div",{id:"search-page",class:"deck-container",ref:m,children:t("div",{class:"timeline-deck deck",children:[t("header",{class:h==="loading"?"loading":"",children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:t(xe,{})}),t(bs,{ref:l}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>{D(!0)},disabled:h==="loading",children:t(I,{icon:"search",size:"l"})})})]})}),t("main",{children:[!!u&&!e&&t("div",{ref:L,class:`filter-bar ${h==="loading"?"loading":""}`,children:[!!d&&t(et,{to:`/search${u?`?q=${encodeURIComponent(u)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(u)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(u)}&type=statuses`}].sort((N,R)=>N.type===d?-1:R.type===d?1:0).map(N=>t(et,{to:N.to,children:N.label},N.type))]}),u?t(E,{children:[(!d||d==="accounts")&&t(E,{children:[d!=="accounts"&&t("h2",{class:"timeline-header",children:["Accounts"," ",t(et,{to:`/search?q=${encodeURIComponent(u)}&type=accounts`,children:t(I,{icon:"arrow-right",size:"l"})})]}),v.length>0?t(E,{children:[t("ul",{class:"timeline flat accounts-list",children:v.map(N=>t("li",{children:t(te,{account:N,instance:o,showStats:!0,relationship:C[N.id]})},N.id))}),d!=="accounts"&&t("div",{class:"ui-state",children:t(et,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=accounts`,children:["See more accounts ",t(I,{icon:"arrow-right"})]})})]}):!d&&(h==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):t("p",{class:"ui-state",children:"No accounts found."}))]}),(!d||d==="hashtags")&&t(E,{children:[d!=="hashtags"&&t("h2",{class:"timeline-header",children:["Hashtags"," ",t(et,{to:`/search?q=${encodeURIComponent(u)}&type=hashtags`,children:t(I,{icon:"arrow-right",size:"l"})})]}),y.length>0?t(E,{children:[t("ul",{class:"link-list hashtag-list",children:y.map(N=>{var tt;const{name:R,history:K}=N,q=(tt=K==null?void 0:K.reduce)==null?void 0:tt.call(K,(Q,vt)=>Q+ +vt.uses,0);return t("li",{children:t(et,{to:o?`/${o}/t/${R}`:`/t/${R}`,children:[t(I,{icon:"hashtag"}),t("span",{children:R}),!!q&&t("span",{class:"count",children:Ft(q)})]})},`${R}-${q}`)})}),d!=="hashtags"&&t("div",{class:"ui-state",children:t(et,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`,children:["See more hashtags ",t(I,{icon:"arrow-right"})]})})]}):!d&&(h==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):t("p",{class:"ui-state",children:"No hashtags found."}))]}),(!d||d==="statuses")&&t(E,{children:[d!=="statuses"&&t("h2",{class:"timeline-header",children:["Posts"," ",t(et,{to:`/search?q=${encodeURIComponent(u)}&type=statuses`,children:t(I,{icon:"arrow-right",size:"l"})})]}),w.length>0?t(E,{children:[t("ul",{class:"timeline",children:w.map(N=>t("li",{children:t(et,{class:"status-link",to:o?`/${o}/s/${N.id}`:`/s/${N.id}`,children:t(xt,{status:N})})},N.id))}),d!=="statuses"&&t("div",{class:"ui-state",children:t(et,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=statuses`,children:["See more posts ",t(I,{icon:"arrow-right"})]})})]}):!d&&(h==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):t("p",{class:"ui-state",children:"No posts found."}))]}),!!d&&(h==="default"?f?t(ne,{onChange:N=>{N&&D()},children:t("button",{type:"button",class:"plain block",onClick:()=>D(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):h==="loading"&&t("p",{class:"ui-state",children:t(At,{abrupt:!0})}))]}):h==="loading"?t("p",{class:"ui-state",children:t(At,{abrupt:!0})}):t("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}function Ke(e,n,s){return Math.max(Math.min(e,s),n)}const Ze=e=>e>=.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,Xe=e=>e>=.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e;function Ds([e,n,s]){e=Ze(e/255),n=Ze(n/255),s=Ze(s/255);var i=.4122214708*e+.5363325363*n+.0514459929*s,o=.2119034982*e+.6806995451*n+.1073969566*s,a=.0883024619*e+.2817188376*n+.6299787005*s;return i=Math.cbrt(i),o=Math.cbrt(o),a=Math.cbrt(a),[i*.2104542553+o*.793617785+a*-.0040720468,i*1.9779984951+o*-2.428592205+a*.4505937099,i*.0259040371+o*.7827717662+a*-.808675766]}function Us([e,n,r]){var i=e+n*.3963377774+r*.2158037573,o=e+n*-.1055613458+r*-.0638541728,a=e+n*-.0894841775+r*-1.291485548;i=i**3,o=o**3,a=a**3;var h=i*4.0767416621+o*-3.3077115913+a*.2309699292,c=i*-1.2684380046+o*2.6097574011+a*-.3413193965,r=i*-.0041960863+o*-.7034186147+a*1.707614701;return h=255*Xe(h),c=255*Xe(c),r=255*Xe(r),h=Ke(h,0,255),c=Ke(c,0,255),r=Ke(r,0,255),h=Math.round(h),c=Math.round(c),r=Math.round(r),[h,c,r]}const ma=20,ga=se(e=>e.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Os({columnMode:e,...n}){const s=It($),i=e?{}:re(),{masto:o,instance:a}=H({instance:(n==null?void 0:n.instance)||i.instance}),{masto:h,instance:c}=H(),r=`Trending (${a})`;Mt(r,"/:instance?/trending");const l=O(),[u,d]=A([]),[f,p]=A([]),g=O();async function m(v){var T;if(v||!g.current){g.current=o.v1.trends.statuses.list({limit:ma});try{const k=o.v1.trends.tags.list(),{value:C}=await k.next();C!=null&&C.length&&d(C)}catch{}try{const{value:k}=await ga(o,a),C=(T=k==null?void 0:k.filter)==null?void 0:T.call(k,F=>F.type==="link");C!=null&&C.length&&p(C)}catch{}}const S=await g.current.next();let{value:y}=S;return y!=null&&y.length&&(v&&(l.current=y[0].id),y.forEach(k=>{Ct(k,a)})),{...S,value:y}}async function w(){try{const v=await o.v1.trends.statuses.list({limit:1}).next();let{value:S}=v;return S=ye(S,"public"),S!=null&&S.length&&S[0].id!==l.current?(l.current=S[0].id,!0):!1}catch{return!1}}const b=gt(()=>t(E,{children:[!!u.length&&t("div",{class:"filter-bar expandable",children:[t(I,{icon:"chart",class:"insignificant",size:"l"}),u.map((v,S)=>{const{name:y,history:T}=v,k=T.reduce((C,F)=>C+ +F.uses,0);return t(et,{to:`/${a}/t/${y}`,children:[t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),y]}),t("span",{class:"filter-count",children:Ft(k)})]},y)})]}),!!f.length&&t("div",{class:"links-bar",children:[t("header",{children:t("h3",{children:"Trending News"})}),f.map(v=>{const{authorName:S,authorUrl:y,blurhash:T,description:k,height:C,image:F,imageDescription:x,language:D,providerName:B,providerUrl:L,publishedAt:N,title:R,url:K,width:q}=v,tt=new URL(K).hostname.replace(/^www\./,"").replace(/\/$/,"");let Q;if(T){const vt=hs(T),Z=Ds(vt);Q=Us([.6,Z[1],Z[2]])}return t("a",{href:K,target:"_blank",rel:"noopener noreferrer",style:Q?{"--accent-color":`rgb(${Q.join(",")})`,"--accent-alpha-color":`rgba(${Q.join(",")}, 0.4)`}:{},children:t("article",{children:[t("figure",{children:t("img",{src:F,alt:x,width:q,height:C,loading:"lazy"})}),t("div",{class:"article-body",children:[t("header",{children:[t("div",{class:"article-meta",children:[t("span",{class:"domain",children:tt})," ",!!N&&t(E,{children:"· "}),!!N&&t(E,{children:t(dn,{datetime:N,format:"micro"})})]}),!!R&&t("h1",{class:"title",lang:D,dir:"auto",children:R})]}),!!k&&t("p",{class:"description",lang:D,dir:"auto",children:k})]})]})},K)})]})]}),[u,f]);return t(Qt,{title:r,titleComponent:t("h1",{class:"header-double-lines",children:[t("b",{children:"Trending"}),t("div",{children:a})]}),id:"trending",instance:a,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:m,checkForUpdates:w,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:t(E,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",timelineStart:b,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(I,{icon:"more",size:"l"})}),children:[t(ct,{onClick:()=>{let v=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(v)){v&&alert("Invalid instance");return}v&&(v=v.toLowerCase().trim(),location.hash=`/${v}/trending`)},children:[t(I,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),c!==a&&t(ct,{onClick:()=>{location.hash=`/${c}/trending`},children:[t(I,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:c}),")"]})]})]})},a)}function ba(){Mt("Home","/");const e=It($),{shortcuts:n}=e,s=n.map(i=>{if(!i)return null;const{type:o,...a}=i,h={following:wn,notifications:Ns,list:Rs,public:rn,bookmarks:xs,favourites:As,hashtag:Es,mentions:Ms,trending:Os,search:Ps}[o];return!h||o==="search"&&!a.query?null:t(h,{...a,columnMode:!0},o+JSON.stringify(a))});return St(["1","2","3","4","5","6","7","8","9"],(i,o)=>{try{const a=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[a].focus()}catch{}}),t("div",{id:"columns",onContextMenu:i=>{i.target.closest(".deck > header")&&!i.target.closest("a")&&!i.target.closest("button")&&(i.preventDefault(),$.showShortcutsSettings=!0)},children:s})}function va(){var n;const e=It($);return V(()=>{(async()=>{const s=await li.drafts.keys();if(s.length){const i=di();s.filter(a=>a.startsWith(i)).length&&($.showDrafts=!0)}})()},[]),t(E,{children:(e.settings.shortcutsViewMode==="multi-column"||!e.settings.shortcutsViewMode&&e.settings.shortcutsColumnsMode)&&((n=e.shortcuts)!=null&&n.length)?t(ba,{}):t(wn,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:t(ya,{})})})}function ya(){const e=It($),n=O(),[s,i]=A(void 0);return t(E,{children:[t(et,{ref:n,to:"/notifications",class:`button plain notifications-button ${e.notificationsShowNew?"has-badge":""} ${s||""}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),i(a=>a?void 0:"open"))},children:t(I,{icon:"notification",size:"l",alt:"Notifications"})}),t(ka,{state:s,anchorRef:n,onClose:()=>i(void 0)})]})}const wa=30,Sa=5;function ka({anchorRef:e,state:n,onClose:s}){const{masto:i,instance:o}=H(),a=It($),[h,c]=A("default"),r=i.v1.notifications.list({limit:wa});async function l(){const g=await r.next(),m=g.value;if(m!=null&&m.length){m.forEach(b=>{Ct(b.status,o,{skipThreading:!0})});const w=Ls(m);$.notificationsLast=m[0],$.notifications=w,i.v1.markers.create({notifications:{lastReadId:m[0].id}}).catch(()=>{})}return $.notificationsShowNew=!1,$.notificationsLastFetchTime=Date.now(),g}const[u,d]=A(!1);function f(){return i.v1.followRequests.list({limit:1})}function p(){c("loading"),(async()=>{try{await l();const g=await f();d(!!(g!=null&&g.length)),c("default")}catch{c("error")}})()}return V(()=>{n==="open"&&p()},[n]),t(cs,{menuClassName:"notifications-menu",state:n,anchorRef:e,onClose:s,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[t("header",{children:t("h2",{children:"Notifications"})}),t("main",{children:a.notifications.length?t(E,{children:a.notifications.slice(0,Sa).map(g=>t(hn,{instance:o,notification:g,disableContextMenu:!0},g.id))}):h==="loading"?t("div",{class:"ui-state",children:t(At,{abrupt:!0})}):h==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to fetch notifications."}),t("p",{children:t("button",{type:"button",onClick:p,children:"Try again"})})]})}),t("footer",{children:[t(et,{to:"/mentions",class:"button plain",children:[t(I,{icon:"at"})," ",t("span",{children:"Mentions"})]}),t(et,{to:"/notifications",class:"button plain2",children:[u?t(E,{children:[t("span",{class:"tag collapsed",children:"New"})," ",t("span",{children:"Follow Requests"})]}):t("b",{children:"See all"})," ",t(I,{icon:"arrow-right"})]})]})]})}const Ia=zt(va),Ta=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function Bs(e){const{hostname:n,pathname:s}=new URL(e);for(const i of Ta){const[,o]=s.match(i)||[];if(o)return{instance:n,id:o}}return{}}function Ca(e){const{instance:n,id:s}=Bs(e);return n&&s?`/${n}/s/${s}`:null}function $a(){const n=He().pathname.replace(/^\//,""),s=Bs(n),i=s!=null&&s.instance?`/${s.instance}/s/${s.id}`:null,[o,a]=A("loading");return Xt(()=>{a("loading"),(async()=>{try{const{instance:h,id:c}=s,{masto:r}=H({instance:h});if(await r.v1.statuses.$select(c).fetch()){window.location.hash=i+"?view=full";return}}catch{}{const{masto:h,instance:c}=H(),r=await h.v2.search.fetch({q:n,limit:1,resolve:!0});if(r.statuses.length){const l=r.statuses[0];window.location.hash=`/${c}/s/${l.id}?view=full`}else if(r.accounts.length){const l=r.accounts[0];window.location.hash=`/${c}/a/${l.id}`}else i?window.location.hash=i+"?view=full":a("error")}})()},[i]),t("div",{class:"ui-state",tabIndex:"-1",children:[o==="loading"?t(E,{children:[t(At,{abrupt:!0}),t("h2",{children:"Resolving…"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):t(E,{children:[t("h2",{children:"Unable to resolve URL"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),t("hr",{}),t("p",{children:t(et,{to:"/",children:"Go home"})})]})}function xa(){const{masto:e}=H();Mt("Lists","/l");const[n,s]=A("default"),[i,o]=os(l=>l+1,0),[a,h]=A([]);V(()=>{s("loading"),(async()=>{try{const l=await e.v1.lists.list();l.sort((u,d)=>u.title.localeCompare(d.title)),h(l),s("default")}catch{s("error")}})()},[i]);const[c,r]=A(!1);return t("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),t(et,{to:"/",class:"button plain",children:t(I,{icon:"home",size:"l"})})]}),t("h1",{children:"Lists"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>r(!0),children:t(I,{icon:"plus",size:"l",alt:"New list"})})})]})}),t("main",{children:a.length>0?t(E,{children:[t("ul",{class:"link-list",children:a.map(l=>t("li",{children:t(et,{to:`/l/${l.id}`,children:t("span",{children:[t(I,{icon:"list"})," ",t("span",{children:l.title})]})})}))}),a.length>1&&t("footer",{class:"ui-state",children:t("small",{class:"insignificant",children:[a.length," list",a.length===1?"":"s"]})})]}):n==="loading"?t("p",{class:"ui-state",children:t(At,{})}):n==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists yet."})})]}),c&&t(Ht,{onClick:l=>{l.target===l.currentTarget&&r(!1)},children:t(vn,{list:c==null?void 0:c.list,onClose:l=>{l.state==="success"&&o(),r(!1)}})})]})}const Fs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e",Aa=""+new URL("instances-MzK7fGXv.json",import.meta.url).href;var Ea={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:Ra,PHANPY_WEBSITE:Ma}=Ea,In="read write follow push";async function La({instanceURL:e}){const n=new URLSearchParams({client_name:Ra,redirect_uris:location.origin+location.pathname,scopes:In,website:Ma});return await(await fetch(`https://${e}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function _a({instanceURL:e,client_id:n}){const s=new URLSearchParams({client_id:n,scope:In,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${e}/oauth/authorize?${s.toString()}`}async function Na({instanceURL:e,client_id:n,client_secret:s,code:i}){const o=new URLSearchParams({client_id:n,client_secret:s,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:i,scope:In});return await(await fetch(`https://${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}var Pa={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Da}=Pa;function Ua(){Mt("Log in");const e=O(),n=bt.local.get("instanceURL"),[s,i]=A("default"),[o]=Gt(),a=o.get("instance"),h=o.get("submit"),[c,r]=A(a||(n==null?void 0:n.toLowerCase())||""),[l,u]=A([]);V(()=>{(async()=>{try{const v=await(await fetch(Aa)).json();u(v)}catch{}})()},[]);const d=b=>{b&&(bt.local.set("instanceURL",b),(async()=>{i("loading");try{const{client_id:v,client_secret:S,vapid_key:y}=await La({instanceURL:b});v&&S?(bt.session.set("clientID",v),bt.session.set("clientSecret",S),bt.session.set("vapidKey",y),location.href=await _a({instanceURL:b,client_id:v})):alert("Failed to register application"),i("default")}catch{i("error")}})())},f=c?c.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,p=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(f)&&!/[\s\/\\@]/.test(f),g=f?l.filter(b=>b.includes(c)).sort((b,v)=>{const S=b.toLowerCase().startsWith(c.toLowerCase()),y=v.toLowerCase().startsWith(c.toLowerCase());return S&&!y?-1:!S&&y?1:0}).slice(0,10):[],m=p?f:g!=null&&g.length?g[0]:c?l.find(b=>b.includes(c)):null,w=b=>{b.preventDefault(),d(m)};return h&&V(()=>{d(a||m)},[]),t("main",{id:"login",style:{textAlign:"center"},children:t("form",{onSubmit:w,children:[t("h1",{children:[t("img",{src:Fs,alt:"",width:"80",height:"80"}),t("br",{}),"Log in"]}),t("label",{children:[t("p",{children:"Instance"}),t("input",{value:c,required:!0,type:"text",class:"large",id:"instanceURL",ref:e,disabled:s==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellCheck:!1,placeholder:"instance domain",onInput:b=>{r(b.target.value)}}),(g==null?void 0:g.length)>0?t("ul",{id:"instances-suggestions",children:g.map((b,v)=>t("li",{children:t("button",{type:"button",class:"plain5",onClick:()=>{d(b)},children:b})}))}):t("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),s==="error"&&t("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),t("div",{children:[t("button",{disabled:s==="loading"||!c||!m,children:m?`Continue with ${m}`:"Continue"})," "]}),t(At,{hidden:s!=="loading"}),t("hr",{}),!Da&&t("p",{children:t("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),t("p",{children:t(et,{to:"/",children:"Go home"})})]})})}var Oa={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:wr}=Oa;function Ba({mediaAttachments:e,statusID:n,instance:s,lang:i,index:o=0,onClose:a=()=>{}}){var v,S;const[h,c]=A("default"),r=O(null),[l,u]=A(o),d=O(null);Xt(()=>{var y;(y=d.current)==null||y.scrollIntoView()},[]);const f=O(n);V(()=>{const y=o*r.current.clientWidth,T=f.current!==n;T&&(f.current=n),r.current.scrollTo({left:y,behavior:T?"auto":"smooth"}),r.current.focus()},[o,n]);const[p,g]=A(!0);V(()=>{let y=()=>{a()};return r.current&&r.current.addEventListener("swiped-down",y),()=>{r.current&&r.current.removeEventListener("swiped-down",y)}},[]),St("esc",a,{ignoreEventWhen:y=>!!document.querySelector("#modal-container > *")},[a]),V(()=>{let y=()=>{const{clientWidth:T,scrollLeft:k}=r.current,C=Math.round(k/T);u(C)};return r.current&&r.current.addEventListener("scroll",y,{passive:!0}),()=>{r.current&&r.current.removeEventListener("scroll",y)}},[]),V(()=>{let y=setTimeout(()=>{var T,k;(k=(T=r.current)==null?void 0:T.focus)==null||k.call(T)},100);return()=>clearTimeout(y)},[]);const m=gt(()=>e==null?void 0:e.map(y=>{const{blurhash:T}=y;if(T){const k=hs(T),C=Ds(k);return Us([.6,C[1],C[2]])}return null}),[e]),w=gt(()=>{var k;const T=100/m.length;return((k=m==null?void 0:m.map((C,F)=>{const x=F*T+5,D=(F+1)*T-5;return C?`
            rgba(${C==null?void 0:C.join(",")}, 0.4) ${x}%,
            rgba(${C==null?void 0:C.join(",")}, 0.4) ${D}%
          `:`
            transparent ${x}%,
            transparent ${D}%
          `}))==null?void 0:k.join(", "))||"transparent"},[m]);let b=O(null);return V(()=>()=>{var y,T;(T=(y=b.current)==null?void 0:y.hideToast)==null||T.call(y)},[]),t("div",{class:`media-modal-container media-modal-count-${e==null?void 0:e.length}`,children:[t("div",{ref:r,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:y=>{(y.target.classList.contains("carousel-item")||y.target.classList.contains("media")||y.target.classList.contains("media-zoom"))&&a()},style:e.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${w})`}:{},children:e==null?void 0:e.map((y,T)=>{const k=e.length===1?m[T]:null;return t("div",{class:"carousel-item",style:k?{"--accent-color":`rgb(${k==null?void 0:k.join(",")})`,"--accent-alpha-color":`rgba(${k==null?void 0:k.join(",")}, 0.4)`}:{},tabindex:"0",ref:T===l?d:null,onClick:C=>{C.target.classList.contains("media")||g(!p)},children:[!!y.description&&t("button",{type:"button",class:"media-alt",hidden:!p,onClick:()=>{$.showMediaAlt={alt:y.description,lang:i}},children:[t("span",{class:"alt-badge",children:"ALT"}),t("span",{class:"media-alt-desc",lang:i,dir:"auto",children:y.description})]}),t(rs,{media:y,showOriginal:!0,lang:i})]},y.id)})}),t("div",{class:"carousel-top-controls",hidden:!p,children:[t("span",{children:t("button",{type:"button",class:"carousel-button",onClick:()=>a(),children:t(I,{icon:"x"})})}),(e==null?void 0:e.length)>1?t("span",{class:"carousel-dots",children:e==null?void 0:e.map((y,T)=>t("button",{type:"button",disabled:T===l,class:`carousel-dot ${T===l?"active":""}`,onClick:k=>{k.preventDefault(),k.stopPropagation(),r.current.scrollTo({left:r.current.clientWidth*T,behavior:"smooth"}),r.current.focus()},children:t(I,{icon:"round",size:"s"})},y.id))}):t("span",{}),t("span",{children:[t(Jt,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:t("button",{type:"button",class:"carousel-button",children:t(I,{icon:"more",alt:"More"})}),children:[t(Rt,{href:((v=e[l])==null?void 0:v.remoteUrl)||((S=e[l])==null?void 0:S.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[t(I,{icon:"popout"}),t("span",{children:"Open original media"})]}),!1]})," ",t(et,{to:`${s?`/${s}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${l+1}`:""}`,class:"button carousel-button media-post-link",children:[t("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(e==null?void 0:e.length)>1&&t("div",{class:"carousel-controls",hidden:!p,children:[t("button",{type:"button",class:"carousel-button",hidden:l===0,onClick:y=>{y.preventDefault(),y.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(l-1),behavior:"smooth"})},children:t(I,{icon:"arrow-left"})}),t("button",{type:"button",class:"carousel-button",hidden:l===e.length-1,onClick:y=>{y.preventDefault(),y.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(l+1),behavior:"smooth"})},children:t(I,{icon:"arrow-right"})})]})]})}const Ne=40,Fa=10,za=5;let cn={},De={},Ue={};function Oe(e){delete De[e],delete Ue[e]}const we={block:"nearest",inline:"center",behavior:"smooth"},Yn=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",Wn=/\/s\//i;function qa(e){const{id:n}=e,{masto:s,instance:i}=H({instance:e.instance}),o=It($),[a,h]=Gt(),c=a.get("media"),r=a.get("media-only"),l=parseInt(c||r,10);let u=l>0;const d=a.get("mediaStatusID"),f=ds(d,i);d&&!f&&(u=!1);const p=u&&!!r,g=Wt(n,i),[m,w]=A($.statuses[g]);V(()=>{$.statuses[g]&&w($.statuses[g])},[g]);const b=gt(()=>{const{prevLocation:y}=$,T=((y==null?void 0:y.pathname)||"")+((y==null?void 0:y.search)||""),k=Te("/:instance/s/:id",T)||Te("/s/:id",T);return!T||k?"/":T},[]);V(()=>{!m&&u&&(async()=>{try{const y=await s.v1.statuses.$select(n).fetch();Ct(y,i),w(y)}catch{alert("Unable to load post."),location.hash=b}})()},[u]);const v=d?f==null?void 0:f.mediaAttachments:m==null?void 0:m.mediaAttachments,S=Yt(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():p?location.hash=b:(a.delete("media"),a.delete("mediaStatusID"),h(a))},[p,b,o.prevLocation]);return V(()=>{let y=setTimeout(()=>{const T=document.querySelector(".carousel");T&&T.focus()},100);return()=>clearTimeout(y)},[p]),t("div",{class:"deck-backdrop",children:[u?v!=null&&v.length?t(Ba,{mediaAttachments:v,statusID:d||n,instance:i,lang:m==null?void 0:m.language,index:l-1,onClose:S}):t("div",{class:"media-modal-container loading",children:t(At,{abrupt:!0})}):t(et,{to:b}),!p&&t(Va,{id:n,instance:e.instance,closeLink:b})]})}function Ha(e){const{linkable:n,to:s,onClick:i,...o}=e;return n?t(et,{class:"status-link",to:s,onClick:i,...o}):t("div",{class:"status-focus",tabIndex:0,...o})}function Va({id:e,closeLink:n="/",instance:s}){var Lt,Pt;const[i,o]=Gt(),a=i.get("media"),h=i.get("mediaStatusID"),c=parseInt(a,10)>0,r=O(!$.prevLocation&&(history.length===1||"navigation"in window&&((Pt=(Lt=navigation==null?void 0:navigation.entries)==null?void 0:Lt.call(navigation))==null?void 0:Pt.length)===1)),[l,u]=A(i.get("view")||r.current?"full":null),d=!!parseInt(i.get("translate")),{masto:f,instance:p}=H({instance:s}),{masto:g,instance:m,authenticated:w}=H(),b=p===m,v=It($),[S,y]=A([]),[T,k]=A("default"),C=O(),F=Wt(e,p),x=O(0),D=O();V(()=>{var M;(M=D.current)==null||M.focus()},[]),V(()=>{var W;const M=gs(()=>{if(!D.current)return;const{scrollTop:J}=D.current;T!=="loading"&&(Ue[e]=J)},50);return(W=D.current)==null||W.addEventListener("scroll",M,{passive:!0}),M(),()=>{var J;M.cancel(),(J=D.current)==null||J.removeEventListener("scroll",M)}},[e,T!=="loading"]);const B=O(),L=O(),N=({reloadHero:M}={})=>{k("loading");let W;const J=De[e];if(J){const P=J.filter(it=>$.statuses[F]);y(P)}else y([{id:e}]);return(async()=>{var Dt,Ut;const P=()=>$n(()=>f.v1.statuses.$select(e).fetch(),{retries:4}),it=$n(()=>f.v1.statuses.$select(e).context.fetch(),{retries:8}),pt=!!v.statuses[F];let at=v.statuses[F];if(!(pt&&!M))try{at=await P(),Ct(at,p),await new Promise(Tt=>{setTimeout(Tt,100)})}catch{k("error");return}try{let Tt=function(st){return st==null?void 0:st.map(Et=>({id:Et.id,account:Et.account,repliesCount:Et.repliesCount,content:Et.content,weight:Ie(Et),replies:Tt(Et.__replies)}))};const Ot=await it,{ancestors:Vt,descendants:kt}=Ot;x.current=(kt==null?void 0:kt.length)||0;const qt=new Set;Vt.forEach(st=>{Ct(st,p,{skipThreading:!0}),st.inReplyToId&&!Vt.find(Et=>Et.id===st.inReplyToId)&&qt.add(st.inReplyToId)});const le=Vt.every(st=>st.account.id===at.account.id),Bt=[];kt.forEach(st=>{if(Ct(st,p,{skipThreading:!0}),st.inReplyToId&&!kt.find(Et=>Et.id===st.inReplyToId)&&st.inReplyToId!==at.id&&qt.add(st.inReplyToId),st.inReplyToAccountId===st.account.id)Bt.push(st);else if(st.inReplyToId===at.id)Bt.push(st);else if(!st.inReplyToAccountId&&Bt.find(Et=>Et.id===st.inReplyToId)&&st.account.id===at.account.id)Bt.push(st);else{const Et=kt.find(qs=>qs.id===st.inReplyToId);Et&&(Et.__replies||(Et.__replies=[]),Et.__replies.push(st))}}),qt.size;const je=[...Vt.map(st=>({id:st.id,ancestor:!0,isThread:le,accountID:st.account.id,account:st.account,repliesCount:st.repliesCount,weight:Ie(st)})),{id:e,accountID:at.account.id,weight:Ie(at)},...Bt.map(st=>({id:st.id,account:st.account,accountID:st.account.id,descendant:!0,thread:st.account.id===at.account.id,weight:Ie(st),replies:Tt(st.__replies)}))];k("default"),B.current={offsetTop:(Dt=C.current)==null?void 0:Dt.offsetTop,scrollTop:(Ut=D.current)==null?void 0:Ut.scrollTop};const Tn=je.findIndex(st=>st.id===e);Tn>=lt&&ot(Tn+1),y(je),De[e]=je,ui(at,p)}catch{k("error")}})(),L.current=Date.now(),()=>{clearTimeout(W)}};V(N,[e,f]);const[R,K]=A(!1);V(()=>{let M=setInterval(()=>{const W=Date.now();L.current&&W-L.current>=6e4&&K(!0)},6e4);return()=>{clearInterval(M)}},[]),Xt(()=>{var W,J;if(!S.length)return;const M=Ue[e];if(M)D.current.scrollTop=M;else if(B.current){const P={offsetTop:(W=C.current)==null?void 0:W.offsetTop,scrollTop:(J=D.current)==null?void 0:J.scrollTop},it=P.offsetTop-B.current.offsetTop+P.scrollTop;D.current.scrollTop=it}else S.length===1&&(D.current.scrollTop=0);B.current=null},[S]),V(()=>{v.reloadStatusPage<=0||(async()=>{try{const{instanceURL:M}=pe(),W=`https://${M}/api/v1/statuses/${e}/context`;return await(await caches.open("api")).delete(W,{ignoreVary:!0}),N({reloadHero:!0})}catch{}})()},[v.reloadStatusPage]),V(()=>()=>{Ue={},$.reloadStatusPage=0,De={},cn={},ln.clear()},[]);const q=v.statuses[F]||v.statuses[e],tt=gt(()=>{if(!q)return"";const{account:M}=q,W=document.createElement("div");return W.innerHTML=M.displayName,W.innerText.trim()},[q]),Q=gt(()=>{if(!q)return"";let M=ls(q);return M.length>64&&(M=M.slice(0,64)+"…"),M},[q]);Mt(tt&&Q?`${tt}: "${Q}"`:"Status","/:instance?/s/:id");const vt=gt(()=>{if(!q)return;const{url:M}=q;if(M)return new URL(M).hostname},[q]),Z=gt(()=>{if(vt)return vt===p},[vt,p]),[lt,ot]=A(Ne),ft=gt(()=>S.length-lt,[S.length,lt]),mt=S.some(M=>M.descendant),$t=S.filter(M=>M.ancestor),[_,G]=A(!0),nt=gt(()=>{if(!C.current||_)return null;const{top:M}=C.current.getBoundingClientRect();return M>0?"down":"up"},[_]);St("esc",()=>{location.hash=n},{enabled:!c,ignoreEventWhen:M=>!!document.querySelector("#modal-container > *")}),St("backspace",()=>{location.hash=n}),St("j",()=>{const M=document.activeElement.closest(".status-link, .status-focus"),W=M==null?void 0:M.getBoundingClientRect(),J=Array.from(D.current.querySelectorAll(Yn));if(M&&W.top<D.current.clientHeight&&W.bottom>0){const P=J.indexOf(M);let it=J[P+1];it&&(it.focus(),it.scrollIntoView(we))}else{const P=J.find(it=>{const pt=it.getBoundingClientRect();return pt.top>=44&&pt.left>=0});P&&(P.focus(),P.scrollIntoView(we))}}),St("k",()=>{const M=document.activeElement.closest(".status-link, .status-focus"),W=M==null?void 0:M.getBoundingClientRect(),J=Array.from(D.current.querySelectorAll(Yn));if(M&&W.top<D.current.clientHeight&&W.bottom>0){const P=J.indexOf(M);let it=J[P-1];it&&(it.focus(),it.scrollIntoView(we))}else{const P=J.find(it=>{const pt=it.getBoundingClientRect();return pt.top>=44&&pt.left>=0});P&&(P.focus(),P.scrollIntoView(we))}}),St("x",()=>{const M=document.activeElement.closest(".status-link, .status-focus");if(M){const W=M.nextElementSibling;W&&W.tagName.toLowerCase()==="details"&&(W.open=!W.open)}});const[X,z]=A(!1),Y=O(c?"media+status":"status"),U=Yt((M,W,J,P)=>{M.preventDefault(),M.stopPropagation(),o({media:W+1,mediaStatusID:P.id})},[e]),rt=Yt((M,W)=>{Oe(W.id)},[]);V(()=>{let M;return h&&c&&(M=setTimeout(()=>{var J;const W=(J=D.current)==null?void 0:J.querySelector(`.status-link[href*="/${h}"]`);W&&W.scrollIntoView(we)},400)),()=>{clearTimeout(M)}},[h,c]);const ht=Yt((M,W)=>{const{id:J,ancestor:P,isThread:it,descendant:pt,thread:at,replies:Dt,repliesCount:Ut,weight:Tt}=M,Ot=J===e;return t("li",{ref:Ot?C:null,class:`${P?"ancestor":""} ${pt?"descendant":""} ${at?"thread":""} ${Ot?"hero":""}`,children:[Ot?t(E,{children:[t(ne,{threshold:.1,onChange:kt=>{queueMicrotask(()=>{requestAnimationFrame(()=>{G(kt)})})},class:"status-focus",tabIndex:0,children:t(xt,{statusID:J,instance:p,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:d})}),T!=="loading"&&!w?t("div",{class:"post-status-banner",children:[t("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),t(et,{to:"/login",class:"button",children:"Log in"})]}):!b&&t("div",{class:"post-status-banner",children:[t("p",{children:["This post is from another instance (",t("b",{children:p}),"). Interactions (reply, boost, etc) are not possible."]}),t("button",{type:"button",disabled:T==="loading",onClick:()=>{k("loading"),(async()=>{try{const kt=await g.v2.search.fetch({q:q.url,type:"statuses",resolve:!0,limit:1});if(kt.statuses.length){const qt=kt.statuses[0];location.hash=m?`/${m}/s/${qt.id}`:`/s/${qt.id}`}else throw new Error("No results")}catch(kt){k("default"),alert("Error: "+kt)}})()},children:[t(I,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):t(Ha,{linkable:it||P,to:p?`/${p}/s/${J}`:`/s/${J}`,onClick:()=>{Oe(J)},children:[W===0&&P?t(ne,{threshold:.5,onChange:kt=>{queueMicrotask(()=>{requestAnimationFrame(()=>{z(kt)})})},children:t(xt,{statusID:J,instance:p,withinContext:!0,size:at||P?"m":"s",enableTranslate:!0,onMediaClick:U,onStatusLinkClick:rt})}):t(xt,{statusID:J,instance:p,withinContext:!0,size:at||P?"m":"s",enableTranslate:!0,onMediaClick:U,onStatusLinkClick:rt,showActionsBar:!!pt}),P&&Ut>1&&t("div",{class:"replies-link",children:[t(I,{icon:"comment2"})," ",t("span",{title:Ut,children:Ft(Ut)})]})," "]}),pt&&(Dt==null?void 0:Dt.length)>0&&t(zs,{instance:p,replies:Dt,hasParentThread:at,level:1,accWeight:Tt,openAll:x.current<Fa,parentLink:{to:p?`/${p}/s/${J}`:`/s/${J}`,onClick:()=>Oe(J)}}),T==="loading"&&Ot&&!!(q!=null&&q.repliesCount)&&!mt&&t("div",{class:"status-loading",children:t(At,{abrupt:q.repliesCount>=3})}),T==="error"&&Ot&&!!(q!=null&&q.repliesCount)&&!mt&&t("div",{class:"status-error",children:["Unable to load replies.",t("br",{}),t("button",{type:"button",class:"plain",onClick:()=>{$.reloadStatusPage++},children:"Try again"})]})]},J)},[e,p,T,w,b,d,U,rt,mt]),j=gt(()=>{var M;if("navigation"in window&&(navigation!=null&&navigation.entries)){const W=navigation.entries()[navigation.currentEntry.index-1];if(W!=null&&W.url)return Wn.test(W.url)}return Wn.test((M=$.prevLocation)==null?void 0:M.pathname)},[F]),dt=gt(()=>{if(!ft)return[];const M=[];function W(J){M.push(J.id),J.replies&&J.replies.forEach(W)}return S.slice(lt).forEach(W),M.map(J=>Wt(J,p))},[ft,S,lt,p]),yt=gt(()=>S.slice(0,lt).map(ht),[S,lt,ht]);return t("div",{tabIndex:"-1",ref:D,class:`status-deck deck contained ${S.length>1?"padded-bottom":""} ${Y.current==="status"&&!r.current?"slide-in":""} ${l?`deck-view-${l}`:""}`,onAnimationEnd:M=>{Y.current==="status"&&(Y.current=null)},children:[t("header",{class:`${T==="loading"?"loading":""}`,onDblClick:M=>{$.reloadStatusPage++},children:t("div",{class:"header-grid header-grid-2",children:[t("h1",{children:[j&&t("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:t(I,{icon:"chevron-left",size:"xl"})}),!_&&q&&T!=="loading"?t(E,{children:[t("span",{class:"hero-heading",children:[t(Je,{account:q.account,instance:p,showAvatar:!0,short:!0})," ",t("span",{class:"insignificant",children:["•"," ",t(dn,{datetime:q.createdAt,format:"micro"})]})]})," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:M=>{M.preventDefault(),M.stopPropagation(),C.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:t(I,{icon:nt==="down"?"arrow-down":"arrow-up"})})]}):t(E,{children:["Post"," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:M=>{M.preventDefault(),M.stopPropagation(),D.current.scrollTo({top:0,behavior:"smooth"})},hidden:!$t.length||X,title:`${$t.length} posts above ‒ Go to top`,children:[t(I,{icon:"arrow-up"}),$t.filter((M,W,J)=>J.findIndex(P=>P.accountID===M.accountID)===W).slice(0,3).map(M=>t(fe,{url:M.account.avatar,alt:M.account.displayName},M.account.id)),$t.length>3&&t(E,{children:[" ",t("span",{class:"insignificant",children:Ft($t.length)})]})]})]})]}),t("div",{class:"header-side",children:[t("button",{type:"button",class:"plain4 button-switch-view",style:{display:l==="full"?"":"none"},onClick:()=>{u(null),i.delete("media"),i.delete("media-only"),i.delete("view"),o(i)},title:"Switch to Side Peek view",children:t(I,{icon:"layout4",size:"l"})}),R&&t("button",{type:"button",class:"plain button-refresh",onClick:()=>{$.reloadStatusPage++,K(!1)},children:t(I,{icon:"refresh",size:"l"})}),t(Jt,{align:"end",portal:{target:D.current},menuButton:t("button",{type:"button",class:"button plain4",children:t(I,{icon:"more",alt:"Actions",size:"xl"})}),children:[t(ct,{disabled:T==="loading",onClick:()=>{$.reloadStatusPage++},children:[t(I,{icon:"refresh"}),t("span",{children:"Refresh"})]}),t(ct,{className:"menu-switch-view",onClick:()=>{u(l==="full"?null:"full"),i.delete("media"),i.delete("media-only"),l==="full"?i.delete("view"):i.set("view","full"),o(i)},children:[t(I,{icon:{"":"layout5",full:"layout4"}[l||""]}),t("span",{children:["Switch to ",l==="full"?"Side Peek":"Full"," view"]})]}),t(ct,{onClick:()=>{Array.from(D.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(W=>{W.click()})},children:[t(I,{icon:"eye-open"})," ",t("span",{children:"Show all sensitive content"})]}),t(_t,{}),t(us,{className:"plain",children:"Experimental"}),t(ct,{disabled:!vt||Z,onClick:()=>{const M=Ca(q.url);M?location.hash=M:alert("Unable to switch")},children:[t(I,{icon:"transfer"}),t("small",{class:"menu-double-lines",children:["Switch to post's instance",vt?t(E,{children:[" ","(",t("b",{children:vt}),")"]}):""]})]})]}),t(et,{class:"button plain deck-close",to:n,children:t(I,{icon:"x",size:"xl"})})]})]})}),S.length&&q?t("ul",{class:`timeline flat contextual grow ${T==="loading"?"loading":""}`,children:[yt,ft>0&&t("li",{children:t("button",{type:"button",class:"plain block show-more",disabled:T==="loading",onClick:()=>ot(M=>M+Ne),style:{marginBlockEnd:"6em"},"data-state-post-ids":dt.join(" "),children:[t("div",{class:"ib avatars-bunch",children:S.slice(lt,lt+5).map(M=>t(fe,{url:M.account.avatarStatic},M.id))})," ",t("div",{class:"ib",children:["Show more…"," ",t("span",{class:"tag",children:ft>Ne?`${Ne}+`:ft})]})]})})]}):t(E,{children:[T==="loading"&&t("ul",{class:"timeline flat contextual grow loading",children:t("li",{children:t(xt,{skeleton:!0,size:"l"})})}),T==="error"&&t("p",{class:"ui-state",children:["Unable to load post",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>{$.reloadStatusPage++},children:"Try again"})]})]})]})}function zs({replies:e,instance:n,hasParentThread:s,level:i,accWeight:o,openAll:a,parentLink:h}){const[c,r]=Gt(),l=v=>v.reduce((S,y)=>{const{repliesCount:T,replies:k}=y,C=(k==null?void 0:k.length)||T;return S+C+l(k||[])},0),u=e.length+l(e),d=e.length===u,f=e.map(v=>v.account).filter((v,S,y)=>y.findIndex(T=>T.id===v.id)===S).slice(0,3),p=gt(()=>e==null?void 0:e.reduce((v,S)=>v+(S==null?void 0:S.weight),o),[o,e==null?void 0:e.length]);let g=!1;(a||p<=za||!s&&u===1&&Ie(e[0])<2)&&(g=!0);const m=cn[e[0].id],w=Yt((v,S,y,T)=>{v.preventDefault(),v.stopPropagation(),r({media:S+1,mediaStatusID:T.id})},[]),b=O();return Xt(()=>{var S;function v(y){y.target.dataset.scrollLeft=y.target.scrollLeft}return(S=b.current)==null||S.addEventListener("scroll",v,{passive:!0}),()=>{var y;(y=b.current)==null||y.removeEventListener("scroll",v)}},[]),t("details",{ref:b,class:"replies",open:m||g,onToggle:v=>{const{open:S}=v.target;cn[e[0].id]=S},style:{"--comments-level":i},"data-comments-level":i,"data-comments-level-overflow":i>4,children:[t("summary",{class:"replies-summary",hidden:g,children:[t("span",{class:"avatars",children:f.map(v=>t(fe,{url:v.avatarStatic,title:`${v.displayName} @${v.username}`,squircle:v==null?void 0:v.bot},v.id))}),t("span",{class:"replies-counts",children:[t("b",{children:[t("span",{title:e.length,children:Ft(e.length)})," ","repl",e.length===1?"y":"ies"]}),!d&&u>1&&t(E,{children:[" ","·"," ",t("span",{children:[t("span",{title:u,children:Ft(u)})," ","comment",u===1?"":"s"]})]})]}),t(I,{icon:"chevron-down",class:"replies-summary-chevron"}),!!h&&t(et,{class:"replies-parent-link",to:h.to,onClick:h.onClick,title:"View post with its replies",children:"»"})]}),t("ul",{children:e.map(v=>{var S,y;return t("li",{children:[t("div",{class:"status-focus",tabIndex:0,children:[t(xt,{statusID:v.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:w,showActionsBar:!0}),!((S=v.replies)!=null&&S.length)&&v.repliesCount>0&&t("div",{class:"replies-link",children:[t(I,{icon:"comment2"})," ",t("span",{title:v.repliesCount,children:Ft(v.repliesCount)})]})]}),((y=v.replies)==null?void 0:y.length)&&t(zs,{instance:n,replies:v.replies,level:i+1,accWeight:g?p:v.weight,openAll:a,parentLink:{to:n?`/${n}/s/${v.id}`:`/s/${v.id}`,onClick:()=>{Oe(v.id)}}})]},v.id)})})]})}const ja=140,Ya=35,Wa=70,Ga=140,ln=new Map;function Ie(e){var p,g;const n=ln.get(e.id);if(n)return n;const{spoilerText:s,content:i,mediaAttachments:o,poll:a,card:h}=e,c=hi(s+i),r=o!=null&&o.length?ja:0,l=(((p=a==null?void 0:a.options)==null?void 0:p.length)||0)*Ya,u=h&&(o!=null&&o.length||(g=a==null?void 0:a.options)!=null&&g.length)?0:Wa,f=(c+r+l+u)/Ga;return ln.set(e.id,f),f}const Ka=zt(qa);function Za(){const e=re(),{id:n,instance:s}=e;return t(Ka,{id:n,instance:s})}const Xa=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,Ja=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,Qa=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,tr=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,er=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,nr="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var sr={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Se,PHANPY_WEBSITE:Gn,PHANPY_PRIVACY_POLICY_URL:ir,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:Kn}=sr,Zn=Gn?Gn.replace(/https?:\/\//g,"").replace(/\/$/,""):null,Xn=`${"2024-03-12T18:11:10.212Z".slice(0,10).replace(/-/g,".")}.2252758`;function Jn(){return Mt(null,["/","/welcome"]),t("main",{id:"welcome",children:[t("div",{class:"hero-container",children:[t("div",{class:"hero-content",children:[t("h1",{children:[t("img",{src:Fs,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),t("img",{src:nr,alt:"Phanpy",width:"200"})]}),t("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),t("p",{children:t(et,{to:Se?`/login?instance=${Se}&submit=1`:"/login",class:"button",children:Se?"Log in":"Log in with Mastodon"})}),Se&&Kn&&t("p",{children:t("a",{href:Kn,class:"button plain5",children:"Sign up"})}),!Se&&t("p",{class:"insignificant",children:t("small",{children:["Connect your existing Mastodon/Fediverse account.",t("br",{}),"Your credentials are not stored on this server."]})})]}),(Zn||Xn)&&t("p",{class:"app-site-version",children:t("small",{children:[Zn," ",Xn]})}),t("p",{children:[t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:e=>{e.preventDefault(),$.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",t("a",{href:ir,target:"_blank",children:"Privacy Policy"}),"."]})]}),t("div",{id:"why-container",children:t("div",{class:"sections",children:[t("section",{children:[t("img",{src:Xa,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),t("h4",{children:"Boosts Carousel"}),t("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),t("section",{children:[t("img",{src:er,alt:"Screenshot of nested comments thread",loading:"lazy"}),t("h4",{children:"Nested comments thread"}),t("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),t("section",{children:[t("img",{src:Ja,alt:"Screenshot of grouped notifications",loading:"lazy"}),t("h4",{children:"Grouped notifications"}),t("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),t("section",{children:[t("img",{src:Qa,alt:"Screenshot of multi-column UI",loading:"lazy"}),t("h4",{children:"Single or multi-column"}),t("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),t("section",{children:[t("img",{src:tr,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),t("h4",{children:"Multi-hashtag timeline"}),t("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Qn=()=>{let e=setTimeout(()=>{if(!document.getElementById("columns")){const s=document.querySelectorAll("#modal-container > *");if(s!=null&&s.length){const h=s[s.length-1],c=h.querySelector('[tabindex="-1"]')||h;if(c){c.focus();return}}if(document.querySelector(".deck-backdrop"))return;const o=document.querySelectorAll(".deck-container"),a=o[o.length-1];a&&a.tabIndex===-1&&a.focus()}},100);return()=>clearTimeout(e)},or=window.alert;window.__nativeAlert||(window.__nativeAlert=or);window.alert=function(e){e instanceof Error&&(e!=null&&e.message)&&(e=e.message),typeof e!="string"&&(e=JSON.stringify(e));const n=fi({text:e,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};const ar=ps(()=>fs(()=>import("./catchup-H1KFAMtd.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),rr=ps(()=>fs(()=>import("./modals-287wETG9.js"),__vite__mapDeps([6,1,2,3,7,4,8,9]),import.meta.url));window.__STATES__=$;window.__STATES_STATS__=()=>{const e=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};e.forEach(o=>{n[o]=Object.keys($[o]).length});const{statuses:s}=$,i=[];for(const o in s)document.querySelector(`[data-state-post-id~="${o}"], [data-state-post-ids~="${o}"]`)||i.push(o)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:e,unfurledLinks:n,notifications:s}=$;let i=0;const{instance:o}=H();for(const a in e){if(!window.__IDLE__)break;try{const h=document.querySelector(`[data-state-post-id~="${a}"], [data-state-post-ids~="${a}"]`),c=s.some(r=>{var l;return a===Wt((l=r.status)==null?void 0:l.id,o)});if(!h&&!c){delete $.statuses[a],delete $.statusQuotes[a];for(const r in n){const l=n[r];if(Wt(l.id,l.instance)===a){delete $.unfurledLinks[r];break}}i++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const e in Ae)queueMicrotask(()=>{var n,s,i,o;Array.isArray(Ae[e])?(s=(n=Ae[e])[0])==null||s.call(n):(o=(i=Ae)[e])==null||o.call(i)})},5e3);(()=>{window.__IDLE__=!0;const e=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},i=gs(n,3e3),o=()=>{window.__IDLE__=!1,i()};e.forEach(a=>{window.addEventListener(a,o,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",a=>{!a.relatedTarget&&!a.toElement&&n()},{passive:!0})})();const cr=/iPad|iPhone|iPod/.test(navigator.userAgent);cr&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const e=bt.local.get("theme");let n;if(e){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const s=n.content,i=e==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=i||"",setTimeout(()=>{n.content=s},10)}}else{const s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${s}"]`),n){const i=n.dataset.content,o=n.dataset.contentTemp;n.content=o||"",setTimeout(()=>{n.content=i},10)}}}});{const e=bt.local.get("theme");if(e){document.documentElement.classList.add(`is-${e}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",e||"dark light");const s=document.querySelector('meta[data-theme-setting="manual"]');s&&(s.name="theme-color",s.content=e==="light"?s.dataset.themeLightColor:s.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(o=>{o.name=""})}const n=bt.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}pi($,e=>{var n;for(const[s,i,o,a]of e){if(i.join(".")==="settings.shortcutsViewMode"){const h=document.getElementById("app");h&&(h.dataset.shortcutsViewMode=(n=$.shortcuts)!=null&&n.length?o:"")}i.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",o)}});function lr(){const[e,n]=A(!1),[s,i]=A("loading");V(()=>{const a=bt.local.get("instanceURL"),h=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(h){window.history.replaceState({},document.title,window.location.pathname||"/");const c=bt.session.get("clientID"),r=bt.session.get("clientSecret"),l=bt.session.get("vapidKey");(async()=>{i("loading");const{access_token:u}=await Na({instanceURL:a,client_id:c,client_secret:r,code:h}),d=mi({instance:a,accessToken:u});await Promise.allSettled([xn(d,a),gi(d,a,u,l)]),An(),En(d),n(!0),i("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const c=pe();if(c){bt.session.set("currentAccount",c.info.id);const{client:r}=H({account:c}),{instance:l}=r;An(),En(r),i("loading"),(async()=>{try{await xn(r,l)}catch{}finally{n(!0),i("default")}})()}else i("default")}},[]);let o=He();return $.currentLocation=o.pathname,V(Qn,[o,e]),/\/https?:/.test(o.pathname)?t($a,{}):t(E,{children:[t(dr,{isLoggedIn:e,loading:s==="loading"}),t(ur,{isLoggedIn:e}),s==="default"&&t(un,{children:t(wt,{path:"/:instance?/s/:id",element:t(Za,{})})}),e&&t(Ii,{}),e&&t(io,{}),t(ms,{children:t(rr,{})}),e&&t($i,{}),t(ki,{isLoggedIn:e}),s!=="loading"&&t(xi,{onClose:Qn}),t(Ti,{})]})}function dr({isLoggedIn:e,loading:n}){const s=He(),i=gt(()=>{const{pathname:o}=s;return!/^\/(login|welcome)/i.test(o)},[s]);return t(un,{location:i||s,children:[t(wt,{path:"/",element:e?t(Ia,{}):n?t(At,{id:"loader-root"}):t(Jn,{})}),t(wt,{path:"/login",element:t(Ua,{})}),t(wt,{path:"/welcome",element:t(Jn,{})})]})}function ts(){return $.prevLocation||null}function ur({isLoggedIn:e}){const n=He(),s=O(ts());return gt(()=>Te("/:instance/s/:id",n.pathname)||Te("/s/:id",n.pathname),[n.pathname,Te])?s.current||(s.current=ts()):s.current=null,t(un,{location:s.current||n,children:[e&&t(E,{children:[t(wt,{path:"/notifications",element:t(Ns,{})}),t(wt,{path:"/mentions",element:t(Ms,{})}),t(wt,{path:"/following",element:t(wn,{})}),t(wt,{path:"/b",element:t(xs,{})}),t(wt,{path:"/f",element:t(As,{})}),t(wt,{path:"/l",children:[t(wt,{index:!0,element:t(xa,{})}),t(wt,{path:":id",element:t(Rs,{})})]}),t(wt,{path:"/ft",element:t(Wo,{})}),t(wt,{path:"/catchup",element:t(ms,{children:t(ar,{})})})]}),t(wt,{path:"/:instance?/t/:hashtag",element:t(Es,{})}),t(wt,{path:"/:instance?/a/:id",element:t(Ho,{})}),t(wt,{path:"/:instance?/p",children:[t(wt,{index:!0,element:t(rn,{})}),t(wt,{path:"l",element:t(rn,{local:!0})})]}),t(wt,{path:"/:instance?/trending",element:t(Os,{})}),t(wt,{path:"/:instance?/search",element:t(Ps,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(e=>{const n=new AbortController;return setTimeout(()=>n.abort(),e),n.signal}));vi(t(bi,{children:t(lr,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("iconify")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("iconify")&&sessionStorage.removeItem(e)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};export{uo as A,ne as I,Ba as M,xe as N,gr as S,Ro as a,zi as b,br as c,vr as d,yr as e,$s as f,Qn as g,Sn as i,Fs as l,Us as o,Ds as r,Is as u};
//# sourceMappingURL=main-QmoQoHP2.js.map
