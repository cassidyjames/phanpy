{"version":3,"mappings":"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","names":["getAccount","id","accounts","store","local","getJSON","find","a","info","getAccountByAccessToken","accessToken","getCurrentAccount","window","__IGNORE_GET_ACCOUNT_ERROR__","import","currentAccount","getCurrentAccountNS","account","instanceURL","saveAccount","acc","vapidKey","set","accountInfo","updateAccount","currentInstance","getCurrentInstance","instances","instance","e","console","alert","configuration","maxMediaAttachments","maxTootChars","pleroma","pollLimits","statuses","polls","maxCharactersPerOption","getInstanceConfiguration","get","key","localStorage","getItem","JSON","value","setJSON","warn","session","sessionStorage","setItem","data","del","DEFAULT_INSTANCE","apis","accountApis","__ACCOUNT_APIS__","currentAccountApi","initClient","test","replace","toLowerCase","url","client","masto","createRestAPIClient","timeout","initInstance","uri","streamingApi","urls","domain","streaming","streamClient","createStreamingAPIClient","implementation","initAccount","mastoAccount","initPreferences","preferences","accountID","authenticated","_b","_c","_d","_showToast","showToast","props","text","onClick","delay","rest","toast","Toastify","className","destination","gravity","position","setTimeout","_moize","moize","mem","fn","opts","maxSize","isDeepEqual","pmem","isPromise","states","proxy","appVersion","prevLocation","currentLocation","statusThreadNumber","home","homeNew","homeLast","homeLastFetchTime","notifications","notificationsLast","notificationsNew","notificationsShowNew","notificationsLastFetchTime","reloadStatusPage","reloadGenericAccounts","counter","spoilers","scrollPositions","unfurledLinks","statusQuotes","routeNotification","showCompose","showSettings","showAccount","showAccounts","showDrafts","showMediaModal","showShortcutsSettings","showKeyboardShortcutsHelp","showGenericAccounts","showMediaAlt","shortcuts","settings","autoRefresh","shortcutsViewMode","shortcutsColumnsMode","boostsCarousel","contentTranslation","contentTranslationTargetLanguage","contentTranslationHideLanguages","contentTranslationAutoInline","cloakMode","initStates","subscribeKey","v","subscribe","changes","prevValue","path","statusKey","getStatus","statusID","saveStatus","status","skipThreading","override","Object","oldStatus","_pinned","threadifyStatus","requestAnimationFrame","propInstance","api","traverse","index","fetchIndex","inReplyToAccountId","inReplyToId","prevStatus","r","fetchStatus","Promise","useInterval","deps","immediate","savedCallback","useRef","useEffect","current","setInterval","tick","clearInterval","openCompose","URL","location","width","screenWidth","height","screenHeight","screen","left","Math","max","top","min","winUID","uid","random","newWin","open","__COMPOSE__","SIZES","s","m","l","xl","xxl","ICONS","x","__vitePreload","heart","bookmark","check-circle","x-circle","transfer","rocket","arrow-left","arrow-right","arrow-up","arrow-down","earth","lock","unlock","eye-close","eye-open","message","comment","comment2","notification","follow","follow-add","poll","pencil","quill","at","attachment","upload","gear","more","external","popout","popin","plus","chevron-left","chevron-right","chevron-down","reply","thread","group","bot","menu","list","search","hashtag","shortcut","user","following","pin","bus","link","history","share","sparkles","exit","translate","play","trash","mute","unmute","block","unblock","flag","time","refresh","emoji2","filter","chart","react","layout4","layout5","announce","round","arrow-up-circle","arrow-down-circle","clipboard","account-edit","account-warning","keyboard","cloud","month","media","Icon","icon","size","alt","title","class","style","iconSize","iconBlock","rotate","flip","Array","isArray","iconData","setIconData","useState","default","_jsx","children","viewBox","dangerouslySetInnerHTML","__html","body","transform","memo","$modalContainer","document","getElementById","Modal","onClose","modalRef","timer","focusElement","querySelector","focus","clearTimeout","escRef","useHotkeys","enabled","keydown","keyup","ref","node","target","currentTarget","tabIndex","onFocus","createPortal","Loader","abrupt","hidden","xxxl","alphaCache","canvas","OffscreenCanvas","createElement","ctx","getContext","willReadFrequently","Avatar","squircle","avatarRef","isMissing","src","loading","decoding","crossOrigin","undefined","onError","onLoad","dataset","loaded","drawImage","allPixels","getImageData","hasAlpha","pixel","i","length","classList","add","clearRect","Link","forwardRef","routerLocation","useLocation","hash","trim","to","restProps","includes","parsedHash","origin","searchParams","searchParamsStr","from","entries","map","encodeURIComponent","join","pathname","isActive","decodeURIComponent","href","parentNode","closest","stopPropagation","MenuConfirm","subMenu","confirm","confirmLabel","menuItemClassName","menuFooter","MenuItem","cloneElement","Parent","SubMenu","Menu","menuRef","_jsxs","instanceRef","openTrigger","direction","overflow","gap","shift","menuClassName","menuButton","label","itemProps","onPointerMove","pointerType","openMenu","onPointerLeave","EmojiText","emojis","indexOf","regex","RegExp","shortcode","elements","split","word","emoji","staticUrl","srcset","NameText","showAvatar","showAcct","short","acct","avatar","avatarStatic","displayName","username","_","acct1","acct2","match","trimmedUsername","trimmedDisplayName","shortenedDisplayName","shortenedAlphaNumericDisplayName","localeCompare","sensitivity","preventDefault","_Fragment","dayjs","extend","dayjsTwitter","localizedFormat","relativeTime","dtf","Intl","DateTimeFormat","RelativeTime","datetime","format","date","dateStr","setDateStr","raf","update","str","now","diff","year","twitter","toDate","fromNow","cancelAnimationFrame","toISOString","_localeMatch","args","localeMatch","locales","resolvedOptions","locale","navigator","languages","getTranslateTargetLanguage","fromSettings","translationTargetLanguages","code","localeCode2Text","DisplayNames","type","of","emojifyText","forEach","fauxDiv","whitelistLinkClasses","_enhanceContent","content","postEnhanceDOM","enhancedContent","dom","innerHTML","hasLink","hasCodeBlock","querySelectorAll","setAttribute","c","remove","textContent","links","usernames","innerText","hasChildren","u","d","push","slice","textNodes","extractTextNodes","html","nodeValue","nodes","childNodes","replaceWith","p","pre","br","nextParagraphs","currentBlock","nextElementSibling","next","tagName","codeText","replaceAll","rejectFilter","prevIndex","hashtagStuffedParagraphs","hashtagCount","nodeType","Node","TEXT_NODE","linkText","startsWith","enhanceContent","defaultRejectFilter","defaultRejectFilterMap","fromEntries","nodeName","walk","createTreeWalker","NodeFilter","SHOW_TEXT","acceptNode","FILTER_REJECT","FILTER_ACCEPT","nextNode","div","getHTMLText","handleContentLinks","mentions","previewMode","statusURL","metaKey","ctrlKey","shiftKey","altKey","which","prevText","previousSibling","textBeforeLinkIsAt","endsWith","textStartsWithAt","contains","targetText","getAttribute","mention","textBeforeLinkIsHash","tag","niceDateTime","hideTime","formatOpts","Date","currentYear","getFullYear","day","hour","minute","NumberFormat","shortenNumber","notation","AccountBlock","skeleton","avatarSize","useAvatarStatic","internal","showActivity","showStats","accountInstance","hideDisplayName","statusesCount","lastStatusAt","fields","note","verifiedField","f","verifiedAt","supportsCache","supports","feature","version","range","features","satisfies","includePrerelease","loose","throttle","pThrottle","limit","interval","LINGVA_INSTANCES","currentLingvaInstance","_lingvaTranslate","source","pRetry","fetchCall","res","fetch","ok","then","provider","translation","detectedSourceLanguage","detectedSource","retries","log","TRANSLATED_MAX_AGE","lingvaTranslate","forceTranslate","sourceLanguage","onTranslate","mini","uiState","setUIState","targetLang","setTranslatedContent","pronunciationContent","detailsRef","translatedContent","sourceLangText","targetLangText","apiSourceLang","error","detectedLangText","setDetectedLang","pronunciation","_a","query","setPronunciationContent","detectedLang","lang","dir","sourceLanguages","name","draftsStore","createStore","drafts","val","getMany","keys","delMany","clear","db","visibilityIconsMap","public","unlisted","private","direct","Poll","readOnly","votePoll","expired","expiresAt","multiple","options","ownVotes","voted","votersCount","votesCount","expiresAtDate","pollVotesCount","roundPrecision","showResults","setShowResults","optionsHaveVoteCounts","every","o","option","optionVotesCount","percentage","toFixed","isLeading","disabled","onSubmit","form","formData","FormData","choices","marginLeft","FilterContext","createContext","_isFiltered","filtered","filterContext","appliedFilters","hasContext","context","isHidden","some","filterAction","action","filterTitles","titles","titlesStr","isFiltered","filteredItem","item","currentAccountID","isSelf","filterState","filteredItems","items","htmlContentLength","isMastodonLinkMaybe","root","documentElement","getComputedStyle","defaultBoundingBoxPadding","safeAreaInsets","getSafeAreaInsets","safeAreaInsetTop","getPropertyValue","safeAreaInsetRight","safeAreaInsetBottom","safeAreaInsetLeft","parseInt","safeBoundingBoxPadding","paddings","CSS","addEventListener","passive","statusPeek","spoilerText","mediaAttachments","image","gifv","video","audio","unknown","useTruncated","onResize","useThrottledCallback","scrollHeight","truncated","_height","maxHeight","computedHeight","toggle","useResizeObserver","box","isSafari","userAgent","dataAltLabel","AltBadge","MEDIA_CAPTION_LIMIT","isMediaCaptionLong","caption","Media","showOriginal","autoAnimate","showCaption","altIndex","blurhash","description","meta","previewRemoteUrl","previewUrl","remoteUrl","original","small","mediaURL","remoteMediaURL","orientation","rgbAverageColor","getBlurHashAverageColor","videoRef","focalBackgroundPosition","y","mediaRef","onUpdate","useCallback","scale","make3dTransformValue","removeProperty","setProperty","touchAction","pinchZoomEnabled","setPinchZoomEnabled","quickPinchZoomProps","draggableUnZoomed","inertiaFriction","doubleTapZoomOutOnMaxScale","containerProps","useMemo","isVideoMaybe","isImage","parentRef","imageSmallerThanParent","setImageSmallerThanParent","useLayoutEffect","offsetWidth","offsetHeight","smaller","maxAspectHeight","innerHeight","averageColorStyle","mediaStyles","aspectRatio","longDesc","showInlineDesc","Figure","Fragment","display","mode","backgroundImage","backgroundSize","QuickPinchZoom","backgroundColor","backgroundPosition","shortDuration","duration","isGIF","loopable","formattedDuration","formatDuration","hoverAnimate","autoGIFAnimate","videoHTML","pause","onMouseEnter","onMouseLeave","onBlur","poster","preload","playsinline","loop","muted","controls","autoplay","MenuLink","FocusableItem","closeMenu","detail","INLINE_TRANSLATE_LIMIT","fetchAccount","v1","$select","memFetchAccount","visibilityText","isIOS","ontouchstart","Status","withinContext","contentTextWeight","enableTranslate","_forceTranslate","onMediaClick","quoted","onStatusLinkClick","enableCommentHint","sameInstance","sKey","snapStates","useSnapshot","accountId","accountURL","accountEmojis","repliesCount","reblogged","reblogsCount","favourited","favouritesCount","bookmarked","sensitive","visibility","language","editedAt","card","createdAt","reblog","_deleted","useContext","filterInfo","debugHover","FilteredStatus","createdAtDate","inReplyToAccountRef","editedAtDate","setInReplyToAccount","inReplyToAccount","account2","catch","mentionSelf","readingExpandSpoilers","prefs","showSpoiler","setForceTranslate","targetLanguage","contentLength","inlineTranslate","isSizeLarge","showEdited","setShowEdited","showReactions","setShowReactions","readMoreText","statusRef","spoilerContentRef","contentRef","mediaContainerRef","textWeight","editedDateText","mediaNoDesc","replyToStatus","boostStatus","unauthInteractionErrorMessage","confirmText","yes","newStatus","favouriteStatus","differentLanguage","MenuHeader","StatusMenuItems","createdDateText","MenuDivider","done","replyStatus","nicePostURL","editStatus","cachedStatus","setIsContextMenuOpen","contextMenuProps","setContextMenuProps","showContextMenu","bindLongPressContext","useLongPress","clientX","clientY","isContextMenuOpen","hotkeysEnabled","fRef","rRef","dRef","confirmBoostStatus","bRef","showMultipleMediaCaptions","displayedMediaAttachments","captionChildren","attachments","canBoost","indices","showCommentHint","isThread","nodeRef","contextMenuRef","portal","url2","result","removeAttribute","unfurlMastodonLink","QuoteStatuses","newPoll","pollResponse","TranslationBlock","MultipleMediaFigure","Card","StatusButton","checked","bookmarkStatus","count","EditedAtModal","ReactionsModal","providerName","providerUrl","authorName","authorUrl","imageDescription","embedUrl","publishedAt","hasText","isLandscape","cardStatusURL","blurhashImage","setCardStatusURL","imageData","blurhashPixels","w","putImageData","videoID","fetchStatusHistory","editHistory","setEditHistory","editHistory2","REACTIONS_LIMIT","setAccounts","showMore","setShowMore","reblogIterator","favouriteIterator","fetchAccounts","firstLoad","favouriteResults","reblogResults","rebloggedBy","theAccount","_types","InView","favourite","onChange","inView","setButtonTitle","buttonTitle","iconAlt","hours","seconds","denylistDomains","failedUnfurls","_unfurlMastodonLink","snapshot","padStart","remoteInstanceFetch","theURL","resolve","urlObj","statusMatch","masto2","urlAfterHash","mastoSearchFetch","results","handleFulfill","instance2","selfURL","handleCatch","host","restPath","isReblog","setShowPeek","bindLongPressPeek","filterTitleStr","threshold","captureEvent","statusPeekRef","actualStatusID","statusPeekText","showPeek","uniqueQuotes","quotes","q","arr","q2","level","supportedLanguagesMap","supportedLanguages","reduce","common","native","expiryOptions","expirySeconds","values","oneDay","expiresInFromExpiresAt","delta","getTime","role","windowMargin","observer","IntersectionObserver","entry","isIntersecting","boundingClientRect","innerWidth","observe","DEFAULT_LANG","urlRegexObj","urlRegex","flags","usernameRegex","urlPlaceholder","countableText","inputText","USERNAME_RE","MENTION_RE","HASHTAG_RE","SHORTCODE_RE_FRAGMENT","SCAN_RE","highlightText","maxCharacters","Infinity","composerCharacterCount","leftoverHTML","leftoverCount","Compose","draftStatus","standalone","hasOpener","UID","currentAccountInfo","charactersReservedPerUrl","imageMatrixLimit","supportedMimeTypes","imageSizeLimit","videoSizeLimit","videoMatrixLimit","videoFrameRateLimit","maxExpiration","maxOptions","minExpiration","spoilerTextRef","textareaRef","prevLanguage","setMediaAttachments","setLanguage","oninputTextarea","focusTextarea","dispatchEvent","visibility2","language2","sensitive2","allMentions","setSensitive","poll2","expiresIn","statusSource","mediaAttachments2","setVisibility","setPoll","composablePoll","beforeUnloadCopy","hasMediaAttachments","canClose","hasOnlyAcct","confirmClose","hasIDMediaAttachments","handleBeforeUnload","sameWithSource","getCharCount","updateCharCount","escDownRef","capture","modals","hasModal","hasOnlyComposer","draftKey","equal","backgroundDraft","prevBackgroundDraft","handleItems","i2","file","files","state","allowedFiles","updatedAt","debug","mediaFiles","handleDragover","showEmoji2Picker","setShowEmoji2Picker","topSupportedLanguages","restSupportedLanguages","restLanguages","topLanguages","codeA","commonA","codeB","createObjectURL","commonB","dataTransfer","removeEventListener","passData","sort","opener","formRef","pointerEvents","opacity","mediaPromises","params2","removeNullUndefined","hasNoDescriptions","params","reason","e2","media_attributes","in_reply_to_id","Textarea","newAttachments","j","fileID","required","v2","onInput","accept","CharCountMeter","CustomEmojisModal","emojiWithSpace","textarea","selectionStart","selectionEnd","clientHeight","offset","setText","performSearch","customEmojis","textExpanderTextRef","handleChange","handleValue","handleCommited","textExpanderRef","provide","newText","text2","textareaProps","displayNameWithEmoji","encodeHTML","filterShortcodes","cur","matched","searchResults","input","composeHighlightRef","throttleHighlightText","total","lastLine","preSpaces","bullet","postSpaces","anything","event","Event","number","newBullet","pos","autoResizeTextarea","resizeObserver","scrollTop","autoComplete","autoCorrect","spellCheck","charCount","leftChars","MediaAttachment","setRangeText","setSelectionRange","setDescription","debouncedOnDescriptionChange","useDebouncedCallback","onDescriptionChange","showModal","supportsEdit","suffixType","setShowModal","descTextarea","placeholder","searchTerm","aLower","splice","bStartsWith","bLower","bContains","aStartsWith","b","aContains","char","obj","customEmojisList","setCustomEmojis","emojisCat","othersCat","bothStartWith","category","recentlyUsedCustomEmojis","recentlyUsedCustomEmojis2","recentlyUsedEmojiIndex","VITE_CLIENT_NAME","CLIENT_NAME","useTitle","setTitle","hasPaths","paths","matchPath"],"sources":["../../src/utils/store-utils.js","../../src/utils/store.js","../../src/utils/api.js","../../src/utils/show-toast.js","../../src/utils/mem.js","../../src/utils/pmem.js","../../src/utils/states.js","../../src/utils/useInterval.js","../../src/utils/open-compose.js","../../src/components/icon.jsx","../../src/components/modal.jsx","../../src/components/loader.jsx","../../src/components/avatar.jsx","../../src/components/link.jsx","../../src/components/menu-confirm.jsx","../../src/components/emoji-text.jsx","../../src/components/name-text.jsx","../../src/components/relative-time.jsx","../../src/utils/locale-match.jsx","../../src/utils/get-translate-target-language.jsx","../../src/utils/localeCode2Text.jsx","../../src/utils/emojify-text.js","../../src/utils/enhance-content.js","../../src/utils/getHTMLText.jsx","../../src/utils/handle-content-links.js","../../src/utils/nice-date-time.js","../../src/utils/shorten-number.jsx","../../src/components/account-block.jsx","../../src/utils/supports.js","../../src/components/translation-block.jsx","../../src/utils/db.js","../../src/utils/visibility-icons-map.js","../../src/components/poll.jsx","../../src/utils/filter-context.js","../../src/utils/filters.jsx","../../src/utils/html-content-length.js","../../src/utils/isMastodonLinkMaybe.jsx","../../src/utils/safe-bounding-box-padding.js","../../src/utils/status-peek.jsx","../../src/utils/useTruncated.js","../../src/components/media.jsx","../../src/components/menu-link.jsx","../../src/components/status.jsx","../../src/components/compose.jsx","../../src/utils/useTitle.js"],"sourcesContent":["import store from './store';\n\nexport function getAccount(id) {\n  const accounts = store.local.getJSON('accounts') || [];\n  return accounts.find((a) => a.info.id === id) || accounts[0];\n}\n\nexport function getAccountByAccessToken(accessToken) {\n  const accounts = store.local.getJSON('accounts') || [];\n  return accounts.find((a) => a.accessToken === accessToken);\n}\n\nexport function getCurrentAccount() {\n  if (!window.__IGNORE_GET_ACCOUNT_ERROR__) {\n    // Track down getCurrentAccount() calls before account-based states are initialized\n    console.error('getCurrentAccount() called before states are initialized');\n    if (import.meta.env.DEV) console.trace();\n  }\n  const currentAccount = store.session.get('currentAccount');\n  const account = getAccount(currentAccount);\n  return account;\n}\n\nexport function getCurrentAccountNS() {\n  const account = getCurrentAccount();\n  const {\n    instanceURL,\n    info: { id },\n  } = account;\n  return `${id}@${instanceURL}`;\n}\n\nexport function saveAccount(account) {\n  const accounts = store.local.getJSON('accounts') || [];\n  const acc = accounts.find((a) => a.info.id === account.info.id);\n  if (acc) {\n    acc.info = account.info;\n    acc.instanceURL = account.instanceURL;\n    acc.accessToken = account.accessToken;\n    acc.vapidKey = account.vapidKey;\n  } else {\n    accounts.push(account);\n  }\n  store.local.setJSON('accounts', accounts);\n  store.session.set('currentAccount', account.info.id);\n}\n\nexport function updateAccount(accountInfo) {\n  // Only update if displayName or avatar or avatar_static is different\n  const accounts = store.local.getJSON('accounts') || [];\n  const acc = accounts.find((a) => a.info.id === accountInfo.id);\n  if (acc) {\n    if (\n      acc.info.displayName !== accountInfo.displayName ||\n      acc.info.avatar !== accountInfo.avatar ||\n      acc.info.avatar_static !== accountInfo.avatar_static\n    ) {\n      acc.info = {\n        ...acc.info,\n        ...accountInfo,\n      };\n      store.local.setJSON('accounts', accounts);\n    }\n  }\n}\n\nlet currentInstance = null;\nexport function getCurrentInstance() {\n  if (currentInstance) return currentInstance;\n  try {\n    const account = getCurrentAccount();\n    const instances = store.local.getJSON('instances');\n    const instance = account.instanceURL.toLowerCase();\n    return (currentInstance = instances[instance]);\n  } catch (e) {\n    console.error(e);\n    alert(`Failed to load instance configuration. Please try again.\\n\\n${e}`);\n    // Temporary fix for corrupted data\n    store.local.del('instances');\n    location.reload();\n    return {};\n  }\n}\n\n// Massage these instance configurations to match the Mastodon API\n// - Pleroma\nfunction getInstanceConfiguration(instance) {\n  const {\n    configuration,\n    maxMediaAttachments,\n    maxTootChars,\n    pleroma,\n    pollLimits,\n  } = instance;\n\n  const statuses = configuration?.statuses || {};\n  if (maxMediaAttachments) {\n    statuses.maxMediaAttachments ??= maxMediaAttachments;\n  }\n  if (maxTootChars) {\n    statuses.maxCharacters ??= maxTootChars;\n  }\n\n  const polls = configuration?.polls || {};\n  if (pollLimits) {\n    polls.maxCharactersPerOption ??= pollLimits.maxOptionChars;\n    polls.maxExpiration ??= pollLimits.maxExpiration;\n    polls.maxOptions ??= pollLimits.maxOptions;\n    polls.minExpiration ??= pollLimits.minExpiration;\n  }\n\n  return {\n    ...configuration,\n    statuses,\n    polls,\n  };\n}\n\nexport function getCurrentInstanceConfiguration() {\n  const instance = getCurrentInstance();\n  return getInstanceConfiguration(instance);\n}\n","import { getCurrentAccountNS } from './store-utils';\n\nconst local = {\n  get: (key) => {\n    try {\n      return localStorage.getItem(key);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  getJSON: (key) => {\n    try {\n      return JSON.parse(local.get(key));\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  set: (key, value) => {\n    try {\n      return localStorage.setItem(key, value);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  setJSON: (key, value) => {\n    try {\n      return local.set(key, JSON.stringify(value));\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  del: (key) => {\n    try {\n      return localStorage.removeItem(key);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n};\n\nconst session = {\n  get: (key) => {\n    try {\n      return sessionStorage.getItem(key);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  getJSON: (key) => {\n    try {\n      return JSON.parse(session.get(key));\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  set: (key, value) => {\n    try {\n      return sessionStorage.setItem(key, value);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  setJSON: (key, value) => {\n    try {\n      return session.set(key, JSON.stringify(value));\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  del: (key) => {\n    try {\n      return sessionStorage.removeItem(key);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n};\n\n// Store with account namespace (id@domain.tld) <- uses id, not username\nconst account = {\n  get: (key) => {\n    try {\n      return local.getJSON(key)[getCurrentAccountNS()];\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  set: (key, value) => {\n    try {\n      const data = local.getJSON(key) || {};\n      data[getCurrentAccountNS()] = value;\n      return local.setJSON(key, data);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n  del: (key) => {\n    try {\n      const data = local.getJSON(key) || {};\n      delete data[getCurrentAccountNS()];\n      return local.setJSON(key, data);\n    } catch (e) {\n      console.warn(e);\n      return null;\n    }\n  },\n};\n\nexport default { local, session, account };\n","import { createRestAPIClient, createStreamingAPIClient } from 'masto';\n\nimport store from './store';\nimport {\n  getAccount,\n  getAccountByAccessToken,\n  getCurrentAccount,\n  saveAccount,\n} from './store-utils';\n\n// Default *fallback* instance\nconst DEFAULT_INSTANCE = 'mastodon.social';\n\n// Per-instance masto instance\n// Useful when only one account is logged in\n// I'm not sure if I'll ever allow multiple logged-in accounts but oh well...\n// E.g. apis['mastodon.social']\nconst apis = {};\n\n// Per-account masto instance\n// Note: There can be many accounts per instance\n// Useful when multiple accounts are logged in or when certain actions require a specific account\n// Just in case if I need this one day.\n// E.g. accountApis['mastodon.social']['ACCESS_TOKEN']\nconst accountApis = {};\nwindow.__ACCOUNT_APIS__ = accountApis;\n\n// Current account masto instance\nlet currentAccountApi;\n\nexport function initClient({ instance, accessToken }) {\n  if (/^https?:\\/\\//.test(instance)) {\n    instance = instance\n      .replace(/^https?:\\/\\//, '')\n      .replace(/\\/+$/, '')\n      .toLowerCase();\n  }\n  const url = instance ? `https://${instance}` : `https://${DEFAULT_INSTANCE}`;\n\n  const masto = createRestAPIClient({\n    url,\n    accessToken, // Can be null\n    timeout: 30_000, // Unfortunatly this is global instead of per-request\n  });\n\n  const client = {\n    masto,\n    instance,\n    accessToken,\n  };\n  apis[instance] = client;\n  if (!accountApis[instance]) accountApis[instance] = {};\n  if (accessToken) accountApis[instance][accessToken] = client;\n\n  return client;\n}\n\n// Get the instance information\n// The config is needed for composing\nexport async function initInstance(client, instance) {\n  console.log('INIT INSTANCE', client, instance);\n  const { masto, accessToken } = client;\n  // Request v2, fallback to v1 if fail\n  let info;\n  try {\n    info = await masto.v2.instance.fetch();\n  } catch (e) {}\n  if (!info) {\n    try {\n      info = await masto.v1.instance.fetch();\n    } catch (e) {}\n  }\n  if (!info) return;\n  console.log(info);\n  const {\n    // v1\n    uri,\n    urls: { streamingApi } = {},\n    // v2\n    domain,\n    configuration: { urls: { streaming } = {} } = {},\n  } = info;\n  const instances = store.local.getJSON('instances') || {};\n  if (uri || domain) {\n    instances[\n      (domain || uri)\n        .replace(/^https?:\\/\\//, '')\n        .replace(/\\/+$/, '')\n        .toLowerCase()\n    ] = info;\n  }\n  if (instance) {\n    instances[instance.toLowerCase()] = info;\n  }\n  store.local.setJSON('instances', instances);\n  // This is a weird place to put this but here's updating the masto instance with the streaming API URL set in the configuration\n  // Reason: Streaming WebSocket URL may change, unlike the standard API REST URLs\n  const supportsWebSocket = 'WebSocket' in window;\n  if (supportsWebSocket && (streamingApi || streaming)) {\n    console.log('🎏 Streaming API URL:', streaming || streamingApi);\n    // masto.config.props.streamingApiUrl = streaming || streamingApi;\n    // Legacy masto.ws\n    const streamClient = createStreamingAPIClient({\n      streamingApiUrl: streaming || streamingApi,\n      accessToken,\n      implementation: WebSocket,\n    });\n    client.streaming = streamClient;\n    // masto.ws = streamClient;\n    console.log('🎏 Streaming API client:', client);\n  }\n}\n\n// Get the account information and store it\nexport async function initAccount(client, instance, accessToken, vapidKey) {\n  const { masto } = client;\n  const mastoAccount = await masto.v1.accounts.verifyCredentials();\n\n  console.log('CURRENTACCOUNT SET', mastoAccount.id);\n  store.session.set('currentAccount', mastoAccount.id);\n\n  saveAccount({\n    info: mastoAccount,\n    instanceURL: instance.toLowerCase(),\n    accessToken,\n    vapidKey,\n  });\n}\n\n// Get preferences\nexport async function initPreferences(client) {\n  try {\n    const { masto } = client;\n    const preferences = await masto.v1.preferences.fetch();\n    store.account.set('preferences', preferences);\n  } catch (e) {\n    // silently fail\n    console.error(e);\n  }\n}\n\n// Get the masto instance\n// If accountID is provided, get the masto instance for that account\nexport function api({ instance, accessToken, accountID, account } = {}) {\n  // Always lowercase and trim the instance\n  if (instance) {\n    instance = instance.toLowerCase().trim();\n  }\n\n  // If instance and accessToken are provided, get the masto instance for that account\n  if (instance && accessToken) {\n    const client =\n      accountApis[instance]?.[accessToken] ||\n      initClient({ instance, accessToken });\n    const { masto, streaming } = client;\n    return {\n      masto,\n      streaming,\n      client,\n      authenticated: true,\n      instance,\n    };\n  }\n\n  if (accessToken) {\n    // If only accessToken is provided, get the masto instance for that accessToken\n    console.log('X 1', accountApis);\n    for (const instance in accountApis) {\n      if (accountApis[instance][accessToken]) {\n        console.log('X 2', accountApis, instance, accessToken);\n        const client = accountApis[instance][accessToken];\n        const { masto, streaming } = client;\n        return {\n          masto,\n          streaming,\n          client,\n          authenticated: true,\n          instance,\n        };\n      } else {\n        console.log('X 3', accountApis, instance, accessToken);\n        const account = getAccountByAccessToken(accessToken);\n        if (account) {\n          const accessToken = account.accessToken;\n          const instance = account.instanceURL.toLowerCase().trim();\n          const client = initClient({ instance, accessToken });\n          const { masto, streaming } = client;\n          return {\n            masto,\n            streaming,\n            client,\n            authenticated: true,\n            instance,\n          };\n        } else {\n          throw new Error(`Access token not found`);\n        }\n      }\n    }\n  }\n\n  // If account is provided, get the masto instance for that account\n  if (account || accountID) {\n    account = account || getAccount(accountID);\n    if (account) {\n      const accessToken = account.accessToken;\n      const instance = account.instanceURL.toLowerCase().trim();\n      const client =\n        accountApis[instance]?.[accessToken] ||\n        initClient({ instance, accessToken });\n      const { masto, streaming } = client;\n      return {\n        masto,\n        streaming,\n        client,\n        authenticated: true,\n        instance,\n      };\n    } else {\n      throw new Error(`Account ${accountID} not found`);\n    }\n  }\n\n  const currentAccount = getCurrentAccount();\n\n  // If only instance is provided, get the masto instance for that instance\n  if (instance) {\n    if (currentAccountApi?.instance === instance) {\n      return {\n        masto: currentAccountApi.masto,\n        streaming: currentAccountApi.streaming,\n        client: currentAccountApi,\n        authenticated: true,\n        instance,\n      };\n    }\n\n    if (currentAccount?.instanceURL === instance) {\n      const { accessToken } = currentAccount;\n      currentAccountApi =\n        accountApis[instance]?.[accessToken] ||\n        initClient({ instance, accessToken });\n      return {\n        masto: currentAccountApi.masto,\n        streaming: currentAccountApi.streaming,\n        client: currentAccountApi,\n        authenticated: true,\n        instance,\n      };\n    }\n\n    const client = apis[instance] || initClient({ instance });\n    const { masto, streaming, accessToken } = client;\n    return {\n      masto,\n      streaming,\n      client,\n      authenticated: !!accessToken,\n      instance,\n    };\n  }\n\n  // If no instance is provided, get the masto instance for the current account\n  if (currentAccountApi) {\n    return {\n      masto: currentAccountApi.masto,\n      streaming: currentAccountApi.streaming,\n      client: currentAccountApi,\n      authenticated: true,\n      instance: currentAccountApi.instance,\n    };\n  }\n  if (currentAccount) {\n    const { accessToken, instanceURL: instance } = currentAccount;\n    currentAccountApi =\n      accountApis[instance]?.[accessToken] ||\n      initClient({ instance, accessToken });\n    return {\n      masto: currentAccountApi.masto,\n      streaming: currentAccountApi.streaming,\n      client: currentAccountApi,\n      authenticated: true,\n      instance,\n    };\n  }\n\n  // If no instance is provided and no account is logged in, get the masto instance for DEFAULT_INSTANCE\n  const client =\n    apis[DEFAULT_INSTANCE] || initClient({ instance: DEFAULT_INSTANCE });\n  const { masto, streaming } = client;\n  return {\n    masto,\n    streaming,\n    client,\n    authenticated: false,\n    instance: DEFAULT_INSTANCE,\n  };\n}\n\nwindow.__API__ = {\n  currentAccountApi,\n  apis,\n  accountApis,\n};\n","import Toastify from 'toastify-js';\n\nwindow._showToast = showToast;\n\nfunction showToast(props) {\n  if (typeof props === 'string') {\n    props = { text: props };\n  }\n  const { onClick, delay, ...rest } = props;\n  const toast = Toastify({\n    className: `${onClick || props.destination ? 'shiny-pill' : ''}`,\n    gravity: 'bottom',\n    position: 'center',\n    ...rest,\n    onClick: () => {\n      onClick?.(toast); // Pass in the object itself!\n    },\n  });\n  if (delay) {\n    setTimeout(() => {\n      toast.showToast();\n    }, delay);\n  } else {\n    toast.showToast();\n  }\n}\n\nexport default showToast;\n","import moize from 'moize';\n\nwindow._moize = moize;\n\nexport default function mem(fn, opts = {}) {\n  return moize(fn, { ...opts, maxSize: 50, isDeepEqual: true });\n}\n","import mem from './mem';\n\nexport default function pmem(fn, opts = {}) {\n  return mem(fn, { isPromise: true, ...opts });\n}\n","import { proxy, subscribe } from 'valtio';\nimport { subscribeKey } from 'valtio/utils';\n\nimport { api } from './api';\nimport pmem from './pmem';\nimport store from './store';\n\nconst states = proxy({\n  appVersion: {},\n  // history: [],\n  prevLocation: null,\n  currentLocation: null,\n  statuses: {},\n  statusThreadNumber: {},\n  home: [],\n  // specialHome: [],\n  homeNew: [],\n  homeLast: null, // Last item in 'home' list\n  homeLastFetchTime: null,\n  notifications: [],\n  notificationsLast: null, // Last read notification\n  notificationsNew: [],\n  notificationsShowNew: false,\n  notificationsLastFetchTime: null,\n  reloadStatusPage: 0,\n  reloadGenericAccounts: {\n    id: null,\n    counter: 0,\n  },\n  spoilers: {},\n  scrollPositions: {},\n  unfurledLinks: {},\n  statusQuotes: {},\n  accounts: {},\n  routeNotification: null,\n  // Modals\n  showCompose: false,\n  showSettings: false,\n  showAccount: false,\n  showAccounts: false,\n  showDrafts: false,\n  showMediaModal: false,\n  showShortcutsSettings: false,\n  showKeyboardShortcutsHelp: false,\n  showGenericAccounts: false,\n  showMediaAlt: false,\n  // Shortcuts\n  shortcuts: [],\n  // Settings\n  settings: {\n    autoRefresh: false,\n    shortcutsViewMode: null,\n    shortcutsColumnsMode: false,\n    boostsCarousel: true,\n    contentTranslation: true,\n    contentTranslationTargetLanguage: null,\n    contentTranslationHideLanguages: [],\n    contentTranslationAutoInline: false,\n    cloakMode: false,\n  },\n});\n\nexport default states;\n\nexport function initStates() {\n  // init all account based states\n  // all keys that uses store.account.get() should be initialized here\n  states.notificationsLast = store.account.get('notificationsLast') || null;\n  states.shortcuts = store.account.get('shortcuts') ?? [];\n  states.settings.autoRefresh =\n    store.account.get('settings-autoRefresh') ?? false;\n  states.settings.shortcutsViewMode =\n    store.account.get('settings-shortcutsViewMode') ?? null;\n  if (store.account.get('settings-shortcutsColumnsMode')) {\n    states.settings.shortcutsColumnsMode = true;\n  }\n  states.settings.boostsCarousel =\n    store.account.get('settings-boostsCarousel') ?? true;\n  states.settings.contentTranslation =\n    store.account.get('settings-contentTranslation') ?? true;\n  states.settings.contentTranslationTargetLanguage =\n    store.account.get('settings-contentTranslationTargetLanguage') || null;\n  states.settings.contentTranslationHideLanguages =\n    store.account.get('settings-contentTranslationHideLanguages') || [];\n  states.settings.contentTranslationAutoInline =\n    store.account.get('settings-contentTranslationAutoInline') ?? false;\n  states.settings.cloakMode = store.account.get('settings-cloakMode') ?? false;\n}\n\nsubscribeKey(states, 'notificationsLast', (v) => {\n  console.log('CHANGE', v);\n  store.account.set('notificationsLast', states.notificationsLast);\n});\nsubscribe(states, (changes) => {\n  console.debug('STATES change', changes);\n  for (const [action, path, value, prevValue] of changes) {\n    if (path.join('.') === 'settings.autoRefresh') {\n      store.account.set('settings-autoRefresh', !!value);\n    }\n    if (path.join('.') === 'settings.boostsCarousel') {\n      store.account.set('settings-boostsCarousel', !!value);\n    }\n    if (path.join('.') === 'settings.shortcutsViewMode') {\n      store.account.set('settings-shortcutsViewMode', value);\n    }\n    if (path.join('.') === 'settings.contentTranslation') {\n      store.account.set('settings-contentTranslation', !!value);\n    }\n    if (path.join('.') === 'settings.contentTranslationAutoInline') {\n      store.account.set('settings-contentTranslationAutoInline', !!value);\n    }\n    if (path.join('.') === 'settings.contentTranslationTargetLanguage') {\n      console.log('SET', value);\n      store.account.set('settings-contentTranslationTargetLanguage', value);\n    }\n    if (/^settings\\.contentTranslationHideLanguages/i.test(path.join('.'))) {\n      store.account.set(\n        'settings-contentTranslationHideLanguages',\n        states.settings.contentTranslationHideLanguages,\n      );\n    }\n    if (path?.[0] === 'shortcuts') {\n      store.account.set('shortcuts', states.shortcuts);\n    }\n    if (path.join('.') === 'settings.cloakMode') {\n      store.account.set('settings-cloakMode', !!value);\n    }\n  }\n});\n\nexport function hideAllModals() {\n  states.showCompose = false;\n  states.showSettings = false;\n  states.showAccount = false;\n  states.showAccounts = false;\n  states.showDrafts = false;\n  states.showMediaModal = false;\n  states.showShortcutsSettings = false;\n  states.showKeyboardShortcutsHelp = false;\n  states.showGenericAccounts = false;\n  states.showMediaAlt = false;\n}\n\nexport function statusKey(id, instance) {\n  if (!id) return;\n  return instance ? `${instance}/${id}` : id;\n}\n\nexport function getStatus(statusID, instance) {\n  if (instance) {\n    const key = statusKey(statusID, instance);\n    return states.statuses[key];\n  }\n  return states.statuses[statusID];\n}\n\nexport function saveStatus(status, instance, opts) {\n  if (typeof instance === 'object') {\n    opts = instance;\n    instance = null;\n  }\n  const { override, skipThreading } = Object.assign(\n    { override: true, skipThreading: false },\n    opts,\n  );\n  if (!status) return;\n  const oldStatus = getStatus(status.id, instance);\n  if (!override && oldStatus) return;\n  const key = statusKey(status.id, instance);\n  if (oldStatus?._pinned) status._pinned = oldStatus._pinned;\n  // if (oldStatus?._filtered) status._filtered = oldStatus._filtered;\n  states.statuses[key] = status;\n  if (status.reblog) {\n    const key = statusKey(status.reblog.id, instance);\n    states.statuses[key] = status.reblog;\n  }\n\n  // THREAD TRAVERSER\n  if (!skipThreading) {\n    requestAnimationFrame(() => {\n      threadifyStatus(status, instance);\n      if (status.reblog) {\n        threadifyStatus(status.reblog, instance);\n      }\n    });\n  }\n}\n\nexport function threadifyStatus(status, propInstance) {\n  const { masto, instance } = api({ instance: propInstance });\n  // Return all statuses in the thread, via inReplyToId, if inReplyToAccountId === account.id\n  let fetchIndex = 0;\n  async function traverse(status, index = 0) {\n    const { inReplyToId, inReplyToAccountId } = status;\n    if (!inReplyToId || inReplyToAccountId !== status.account.id) {\n      return [status];\n    }\n    if (inReplyToId && inReplyToAccountId !== status.account.id) {\n      throw 'Not a thread';\n      // Possibly thread of replies by multiple people?\n    }\n    const key = statusKey(inReplyToId, instance);\n    let prevStatus = states.statuses[key];\n    if (!prevStatus) {\n      if (fetchIndex++ > 3) throw 'Too many fetches for thread'; // Some people revive old threads\n      await new Promise((r) => setTimeout(r, 500 * fetchIndex)); // Be nice to rate limits\n      // prevStatus = await masto.v1.statuses.$.select(inReplyToId).fetch();\n      prevStatus = await fetchStatus(inReplyToId, masto);\n      saveStatus(prevStatus, instance, { skipThreading: true });\n    }\n    // Prepend so that first status in thread will be index 0\n    return [...(await traverse(prevStatus, ++index)), status];\n  }\n  return traverse(status)\n    .then((statuses) => {\n      if (statuses.length > 1) {\n        console.debug('THREAD', statuses);\n        statuses.forEach((status, index) => {\n          const key = statusKey(status.id, instance);\n          states.statusThreadNumber[key] = index + 1;\n        });\n      }\n    })\n    .catch((e) => {\n      console.error(e, status);\n    });\n}\n\nconst fetchStatus = pmem((statusID, masto) => {\n  return masto.v1.statuses.$select(statusID).fetch();\n});\n","import { useEffect, useRef } from 'preact/hooks';\n\nfunction useInterval(fn, delay, deps, immediate) {\n  const savedCallback = useRef(fn);\n  useEffect(() => {\n    savedCallback.current = fn;\n  }, [fn, deps]);\n\n  useEffect(() => {\n    if (!immediate || delay === null || delay === false) return;\n    savedCallback.current();\n  }, [immediate]);\n\n  useEffect(() => {\n    if (delay === null || delay === false) return;\n    const tick = () => savedCallback.current();\n    const id = setInterval(tick, delay);\n    return () => clearInterval(id);\n  }, [delay]);\n}\n\nexport default useInterval;\n","export default function openCompose(opts) {\n  const url = new URL('/compose/', window.location);\n  const { width: screenWidth, height: screenHeight } = window.screen;\n  const left = Math.max(0, (screenWidth - 600) / 2);\n  const top = Math.max(0, (screenHeight - 450) / 2);\n  const width = Math.min(screenWidth, 600);\n  const height = Math.min(screenHeight, 450);\n  const winUID = opts?.uid || Math.random();\n  const newWin = window.open(\n    url,\n    'compose' + winUID,\n    `width=${width},height=${height},left=${left},top=${top}`,\n  );\n\n  if (newWin) {\n    // if (masto) {\n    //   newWin.masto = masto;\n    // }\n\n    newWin.__COMPOSE__ = opts;\n  } else {\n    alert('Looks like your browser is blocking popups.');\n  }\n\n  return newWin;\n}\n","import { memo } from 'preact/compat';\nimport { useEffect, useState } from 'preact/hooks';\n\nconst SIZES = {\n  s: 12,\n  m: 16,\n  l: 20,\n  xl: 24,\n  xxl: 32,\n};\n\nexport const ICONS = {\n  x: () => import('@iconify-icons/mingcute/close-line'),\n  heart: () => import('@iconify-icons/mingcute/heart-line'),\n  bookmark: () => import('@iconify-icons/mingcute/bookmark-line'),\n  'check-circle': () => import('@iconify-icons/mingcute/check-circle-line'),\n  'x-circle': () => import('@iconify-icons/mingcute/close-circle-line'),\n  transfer: () => import('@iconify-icons/mingcute/transfer-4-line'),\n  rocket: () => import('@iconify-icons/mingcute/rocket-line'),\n  'arrow-left': () => import('@iconify-icons/mingcute/arrow-left-line'),\n  'arrow-right': () => import('@iconify-icons/mingcute/arrow-right-line'),\n  'arrow-up': () => import('@iconify-icons/mingcute/arrow-up-line'),\n  'arrow-down': () => import('@iconify-icons/mingcute/arrow-down-line'),\n  earth: () => import('@iconify-icons/mingcute/earth-line'),\n  lock: () => import('@iconify-icons/mingcute/lock-line'),\n  unlock: () => import('@iconify-icons/mingcute/unlock-line'),\n  'eye-close': () => import('@iconify-icons/mingcute/eye-close-line'),\n  'eye-open': () => import('@iconify-icons/mingcute/eye-2-line'),\n  message: () => import('@iconify-icons/mingcute/mail-line'),\n  comment: () => import('@iconify-icons/mingcute/chat-3-line'),\n  comment2: () => import('@iconify-icons/mingcute/comment-2-line'),\n  home: () => import('@iconify-icons/mingcute/home-3-line'),\n  notification: () => import('@iconify-icons/mingcute/notification-line'),\n  follow: () => import('@iconify-icons/mingcute/user-follow-line'),\n  'follow-add': () => import('@iconify-icons/mingcute/user-add-line'),\n  poll: [() => import('@iconify-icons/mingcute/chart-bar-line'), '90deg'],\n  pencil: () => import('@iconify-icons/mingcute/pencil-line'),\n  quill: () => import('@iconify-icons/mingcute/quill-pen-line'),\n  at: () => import('@iconify-icons/mingcute/at-line'),\n  attachment: () => import('@iconify-icons/mingcute/attachment-line'),\n  upload: () => import('@iconify-icons/mingcute/upload-3-line'),\n  gear: () => import('@iconify-icons/mingcute/settings-3-line'),\n  more: () => import('@iconify-icons/mingcute/more-3-line'),\n  external: () => import('@iconify-icons/mingcute/external-link-line'),\n  popout: () => import('@iconify-icons/mingcute/external-link-line'),\n  popin: [() => import('@iconify-icons/mingcute/external-link-line'), '180deg'],\n  plus: () => import('@iconify-icons/mingcute/add-circle-line'),\n  'chevron-left': () => import('@iconify-icons/mingcute/left-line'),\n  'chevron-right': () => import('@iconify-icons/mingcute/right-line'),\n  'chevron-down': () => import('@iconify-icons/mingcute/down-line'),\n  reply: [\n    () => import('@iconify-icons/mingcute/share-forward-line'),\n    '180deg',\n    'horizontal',\n  ],\n  thread: () => import('@iconify-icons/mingcute/route-line'),\n  group: () => import('@iconify-icons/mingcute/group-line'),\n  bot: () => import('@iconify-icons/mingcute/android-2-line'),\n  menu: () => import('@iconify-icons/mingcute/rows-4-line'),\n  list: () => import('@iconify-icons/mingcute/list-check-line'),\n  search: () => import('@iconify-icons/mingcute/search-2-line'),\n  hashtag: () => import('@iconify-icons/mingcute/hashtag-line'),\n  info: () => import('@iconify-icons/mingcute/information-line'),\n  shortcut: () => import('@iconify-icons/mingcute/lightning-line'),\n  user: () => import('@iconify-icons/mingcute/user-4-line'),\n  following: () => import('@iconify-icons/mingcute/walk-line'),\n  pin: () => import('@iconify-icons/mingcute/pin-line'),\n  bus: () => import('@iconify-icons/mingcute/bus-2-line'),\n  link: () => import('@iconify-icons/mingcute/link-2-line'),\n  history: () => import('@iconify-icons/mingcute/history-line'),\n  share: () => import('@iconify-icons/mingcute/share-2-line'),\n  sparkles: () => import('@iconify-icons/mingcute/sparkles-line'),\n  exit: () => import('@iconify-icons/mingcute/exit-line'),\n  translate: () => import('@iconify-icons/mingcute/translate-line'),\n  play: () => import('@iconify-icons/mingcute/play-fill'),\n  trash: () => import('@iconify-icons/mingcute/delete-2-line'),\n  mute: () => import('@iconify-icons/mingcute/volume-mute-line'),\n  unmute: () => import('@iconify-icons/mingcute/volume-line'),\n  block: () => import('@iconify-icons/mingcute/forbid-circle-line'),\n  unblock: [\n    () => import('@iconify-icons/mingcute/forbid-circle-line'),\n    '180deg',\n  ],\n  flag: () => import('@iconify-icons/mingcute/flag-4-line'),\n  time: () => import('@iconify-icons/mingcute/time-line'),\n  refresh: () => import('@iconify-icons/mingcute/refresh-2-line'),\n  emoji2: () => import('@iconify-icons/mingcute/emoji-2-line'),\n  filter: () => import('@iconify-icons/mingcute/filter-2-line'),\n  chart: () => import('@iconify-icons/mingcute/chart-line-line'),\n  react: () => import('@iconify-icons/mingcute/react-line'),\n  layout4: () => import('@iconify-icons/mingcute/layout-4-line'),\n  layout5: () => import('@iconify-icons/mingcute/layout-5-line'),\n  announce: () => import('@iconify-icons/mingcute/announcement-line'),\n  alert: () => import('@iconify-icons/mingcute/alert-line'),\n  round: () => import('@iconify-icons/mingcute/round-fill'),\n  'arrow-up-circle': () =>\n    import('@iconify-icons/mingcute/arrow-up-circle-line'),\n  'arrow-down-circle': () =>\n    import('@iconify-icons/mingcute/arrow-down-circle-line'),\n  clipboard: () => import('@iconify-icons/mingcute/clipboard-line'),\n  'account-edit': () => import('@iconify-icons/mingcute/user-edit-line'),\n  'account-warning': () => import('@iconify-icons/mingcute/user-warning-line'),\n  keyboard: () => import('@iconify-icons/mingcute/keyboard-line'),\n  cloud: () => import('@iconify-icons/mingcute/cloud-line'),\n  month: () => import('@iconify-icons/mingcute/calendar-month-line'),\n  media: () => import('@iconify-icons/mingcute/photo-album-line'),\n};\n\nfunction Icon({\n  icon,\n  size = 'm',\n  alt,\n  title,\n  class: className = '',\n  style = {},\n}) {\n  if (!icon) return null;\n\n  const iconSize = SIZES[size];\n  let iconBlock = ICONS[icon];\n  let rotate, flip;\n  if (Array.isArray(iconBlock)) {\n    [iconBlock, rotate, flip] = iconBlock;\n  }\n\n  const [iconData, setIconData] = useState(null);\n  useEffect(async () => {\n    const icon = await iconBlock();\n    setIconData(icon.default);\n  }, [iconBlock]);\n\n  return (\n    <span\n      class={`icon ${className}`}\n      title={title || alt}\n      style={{\n        width: `${iconSize}px`,\n        height: `${iconSize}px`,\n        ...style,\n      }}\n    >\n      {iconData && (\n        <svg\n          width={iconSize}\n          height={iconSize}\n          viewBox={`0 0 ${iconData.width} ${iconData.height}`}\n          dangerouslySetInnerHTML={{ __html: iconData.body }}\n          style={{\n            transform: `${rotate ? `rotate(${rotate})` : ''} ${\n              flip ? `scaleX(-1)` : ''\n            }`,\n          }}\n        />\n      )}\n    </span>\n  );\n}\n\nexport default memo(Icon);\n","import './modal.css';\n\nimport { createPortal } from 'preact/compat';\nimport { useEffect, useRef } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\n\nconst $modalContainer = document.getElementById('modal-container');\n\nfunction Modal({ children, onClose, onClick, class: className }) {\n  if (!children) return null;\n\n  const modalRef = useRef();\n  useEffect(() => {\n    let timer = setTimeout(() => {\n      const focusElement = modalRef.current?.querySelector('[tabindex=\"-1\"]');\n      if (focusElement) {\n        focusElement.focus();\n      }\n    }, 100);\n    return () => clearTimeout(timer);\n  }, []);\n\n  const escRef = useHotkeys(\n    'esc',\n    () => {\n      setTimeout(() => {\n        onClose?.();\n      }, 0);\n    },\n    {\n      enabled: !!onClose,\n      // Using keyup and setTimeout above\n      // This will run \"later\" to prevent clash with esc handlers from other components\n      keydown: false,\n      keyup: true,\n    },\n    [onClose],\n  );\n\n  const Modal = (\n    <div\n      ref={(node) => {\n        modalRef.current = node;\n        escRef.current = node?.querySelector?.('[tabindex=\"-1\"]') || node;\n      }}\n      className={className}\n      onClick={(e) => {\n        onClick?.(e);\n        if (e.target === e.currentTarget) {\n          onClose?.(e);\n        }\n      }}\n      tabIndex=\"-1\"\n      onFocus={(e) => {\n        if (e.target === e.currentTarget) {\n          modalRef.current?.querySelector?.('[tabindex=\"-1\"]')?.focus?.();\n        }\n      }}\n    >\n      {children}\n    </div>\n  );\n\n  return createPortal(Modal, $modalContainer);\n\n  // return createPortal(children, $modalContainer);\n}\n\nexport default Modal;\n","import './loader.css';\n\nfunction Loader({ abrupt, hidden, ...props }) {\n  return (\n    <span\n      {...props}\n      class={`loader-container ${abrupt ? 'abrupt' : ''} ${\n        hidden ? 'hidden' : ''\n      }`}\n    >\n      <span class=\"loader\" />\n    </span>\n  );\n}\n\nexport default Loader;\n","import './avatar.css';\n\nimport { useRef } from 'preact/hooks';\n\nimport mem from '../utils/mem';\n\nconst SIZES = {\n  s: 16,\n  m: 20,\n  l: 24,\n  xl: 32,\n  xxl: 50,\n  xxxl: 64,\n};\n\nconst alphaCache = {};\n\nconst canvas = window.OffscreenCanvas\n  ? new OffscreenCanvas(1, 1)\n  : document.createElement('canvas');\nconst ctx = canvas.getContext('2d', {\n  willReadFrequently: true,\n});\n\nfunction Avatar({ url, size, alt = '', squircle, ...props }) {\n  size = SIZES[size] || size || SIZES.m;\n  const avatarRef = useRef();\n  const isMissing = /missing\\.png$/.test(url);\n  return (\n    <span\n      ref={avatarRef}\n      class={`avatar ${squircle ? 'squircle' : ''} ${\n        alphaCache[url] ? 'has-alpha' : ''\n      }`}\n      style={{\n        width: size,\n        height: size,\n      }}\n      title={alt}\n      {...props}\n    >\n      {!!url && (\n        <img\n          src={url}\n          width={size}\n          height={size}\n          alt={alt}\n          loading=\"lazy\"\n          decoding=\"async\"\n          crossOrigin={\n            alphaCache[url] === undefined && !isMissing\n              ? 'anonymous'\n              : undefined\n          }\n          onError={(e) => {\n            if (e.target.crossOrigin) {\n              e.target.crossOrigin = null;\n              e.target.src = url;\n            }\n          }}\n          onLoad={(e) => {\n            if (avatarRef.current) avatarRef.current.dataset.loaded = true;\n            if (alphaCache[url] !== undefined) return;\n            if (isMissing) return;\n            try {\n              // Check if image has alpha channel\n              const { width, height } = e.target;\n              if (canvas.width !== width) canvas.width = width;\n              if (canvas.height !== height) canvas.height = height;\n              ctx.drawImage(e.target, 0, 0);\n              const allPixels = ctx.getImageData(0, 0, width, height);\n              // At least 10% of pixels have alpha <= 128\n              const hasAlpha =\n                allPixels.data.filter((pixel, i) => i % 4 === 3 && pixel <= 128)\n                  .length /\n                  (allPixels.data.length / 4) >\n                0.1;\n              if (hasAlpha) {\n                // console.log('hasAlpha', hasAlpha, allPixels.data);\n                avatarRef.current.classList.add('has-alpha');\n              }\n              alphaCache[url] = hasAlpha;\n              ctx.clearRect(0, 0, width, height);\n            } catch (e) {\n              // Silent fail\n              alphaCache[url] = false;\n            }\n          }}\n        />\n      )}\n    </span>\n  );\n}\n\nexport default mem(Avatar);\n","import { forwardRef } from 'preact/compat';\nimport { useLocation } from 'react-router-dom';\n\nimport states from '../utils/states';\n\n/* NOTES\n   =====\n   Initially this uses <NavLink> from react-router-dom, but it doesn't work:\n   1. It interferes with nested <a> inside <a> and it's difficult to preventDefault/stopPropagation from the nested <a>\n   2. isActive doesn't work properly with the weird routes that's set up in this app, due to the faux \"location\" to make the modals work and prevent unmounting\n   3. Not using <Link state/> because it modifies history.state that *persists* across page reloads. I don't need that, so using valtio's states instead.\n*/\n\nconst Link = forwardRef((props, ref) => {\n  let routerLocation;\n  try {\n    routerLocation = useLocation();\n  } catch (e) {}\n  let hash = (location.hash || '').replace(/^#/, '').trim();\n  if (hash === '') hash = '/';\n  const { to, ...restProps } = props;\n\n  // Handle encodeURIComponent of searchParams values\n  if (!!hash && hash !== '/' && hash.includes('?')) {\n    const parsedHash = new URL(hash, location.origin); // Fake base URL\n    if (parsedHash.searchParams.size) {\n      const searchParamsStr = Array.from(parsedHash.searchParams.entries())\n        .map(([key, value]) => `${key}=${encodeURIComponent(value)}`)\n        .join('&');\n      hash = parsedHash.pathname + '?' + searchParamsStr;\n    }\n  }\n\n  const isActive = hash === to || decodeURIComponent(hash) === to;\n  return (\n    <a\n      ref={ref}\n      href={`#${to}`}\n      {...restProps}\n      class={`${props.class || ''} ${isActive ? 'is-active' : ''}`}\n      onClick={(e) => {\n        if (e.currentTarget?.parentNode?.closest('a')) {\n          // If this <a> is nested inside another <a>\n          e.stopPropagation();\n        }\n        if (routerLocation) states.prevLocation = routerLocation;\n        props.onClick?.(e);\n      }}\n    />\n  );\n});\n\nexport default Link;\n","import { Menu, MenuItem, SubMenu } from '@szhsin/react-menu';\nimport { cloneElement } from 'preact';\nimport { useRef } from 'preact/hooks';\n\nfunction MenuConfirm({\n  subMenu = false,\n  confirm = true,\n  confirmLabel,\n  menuItemClassName,\n  menuFooter,\n  ...props\n}) {\n  const { children, onClick, ...restProps } = props;\n  if (!confirm) {\n    if (subMenu) return <MenuItem {...props} />;\n    if (onClick) {\n      return cloneElement(children, {\n        onClick,\n      });\n    }\n    return children;\n  }\n  const Parent = subMenu ? SubMenu : Menu;\n  const menuRef = useRef();\n  return (\n    <Parent\n      instanceRef={menuRef}\n      openTrigger=\"clickOnly\"\n      direction=\"bottom\"\n      overflow=\"auto\"\n      gap={-8}\n      shift={8}\n      menuClassName=\"menu-emphasized\"\n      {...restProps}\n      menuButton={subMenu ? undefined : children}\n      label={subMenu ? children : undefined}\n      // Test fix for bug; submenus not opening on Android\n      itemProps={{\n        onPointerMove: (e) => {\n          if (e.pointerType === 'touch') {\n            menuRef.current?.openMenu?.();\n          }\n        },\n        onPointerLeave: (e) => {\n          if (e.pointerType === 'touch') {\n            menuRef.current?.openMenu?.();\n          }\n        },\n      }}\n    >\n      <MenuItem className={menuItemClassName} onClick={onClick}>\n        {confirmLabel}\n      </MenuItem>\n      {menuFooter}\n    </Parent>\n  );\n}\n\nexport default MenuConfirm;\n","function EmojiText({ text, emojis }) {\n  if (!text) return '';\n  if (!emojis?.length) return text;\n  if (text.indexOf(':') === -1) return text;\n  const regex = new RegExp(\n    `:(${emojis.map((e) => e.shortcode).join('|')}):`,\n    'g',\n  );\n  const elements = text.split(regex).map((word) => {\n    const emoji = emojis.find((e) => e.shortcode === word);\n    if (emoji) {\n      const { url, staticUrl } = emoji;\n      return (\n        <picture>\n          <source srcset={staticUrl} media=\"(prefers-reduced-motion: reduce)\" />\n          <img\n            key={word}\n            src={url}\n            alt={word}\n            class=\"shortcode-emoji emoji\"\n            width=\"16\"\n            height=\"16\"\n            loading=\"lazy\"\n            decoding=\"async\"\n          />\n        </picture>\n      );\n    }\n    return word;\n  });\n  return elements;\n}\n\nexport default EmojiText;\n","import './name-text.css';\n\nimport { memo } from 'preact/compat';\n\nimport states from '../utils/states';\n\nimport Avatar from './avatar';\nimport EmojiText from './emoji-text';\n\nfunction NameText({\n  account,\n  instance,\n  showAvatar,\n  showAcct,\n  short,\n  external,\n  onClick,\n}) {\n  const { acct, avatar, avatarStatic, id, url, displayName, emojis, bot } =\n    account;\n  let { username } = account;\n  const [_, acct1, acct2] = acct.match(/([^@]+)(@.+)/i) || [, acct];\n\n  const trimmedUsername = username.toLowerCase().trim();\n  const trimmedDisplayName = (displayName || '').toLowerCase().trim();\n  const shortenedDisplayName = trimmedDisplayName\n    .replace(/(\\:(\\w|\\+|\\-)+\\:)(?=|[\\!\\.\\?]|$)/g, '') // Remove shortcodes, regex from https://regex101.com/r/iE9uV0/1\n    .replace(/\\s+/g, ''); // E.g. \"My name\" === \"myname\"\n  const shortenedAlphaNumericDisplayName = shortenedDisplayName.replace(\n    /[^a-z0-9]/gi,\n    '',\n  ); // Remove non-alphanumeric characters\n\n  if (\n    !short &&\n    (trimmedUsername === trimmedDisplayName ||\n      trimmedUsername === shortenedDisplayName ||\n      trimmedUsername === shortenedAlphaNumericDisplayName ||\n      trimmedUsername.localeCompare?.(shortenedDisplayName, 'en', {\n        sensitivity: 'base',\n      }) === 0)\n  ) {\n    username = null;\n  }\n\n  return (\n    <a\n      class={`name-text ${showAcct ? 'show-acct' : ''} ${short ? 'short' : ''}`}\n      href={url}\n      target={external ? '_blank' : null}\n      title={`${displayName ? `${displayName} ` : ''}@${acct}`}\n      onClick={(e) => {\n        if (external) return;\n        e.preventDefault();\n        e.stopPropagation();\n        if (onClick) return onClick(e);\n        states.showAccount = {\n          account,\n          instance,\n        };\n      }}\n    >\n      {showAvatar && (\n        <>\n          <Avatar url={avatarStatic || avatar} squircle={bot} />{' '}\n        </>\n      )}\n      {displayName && !short ? (\n        <>\n          <b>\n            <EmojiText text={displayName} emojis={emojis} />\n          </b>\n          {!showAcct && username && (\n            <>\n              {' '}\n              <i>@{username}</i>\n            </>\n          )}\n        </>\n      ) : short ? (\n        <i>{username}</i>\n      ) : (\n        <b>{username}</b>\n      )}\n      {showAcct && (\n        <>\n          <br />\n          <i>\n            @{acct1}\n            <span class=\"ib\">{acct2}</span>\n          </i>\n        </>\n      )}\n    </a>\n  );\n}\n\nexport default memo(NameText);\n","// Twitter-style relative time component\n// Seconds = 1s\n// Minutes = 1m\n// Hours = 1h\n// Days = 1d\n// After 7 days, use DD/MM/YYYY or MM/DD/YYYY\nimport dayjs from 'dayjs';\nimport dayjsTwitter from 'dayjs-twitter';\nimport localizedFormat from 'dayjs/plugin/localizedFormat';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport { useEffect, useState } from 'preact/hooks';\n\ndayjs.extend(dayjsTwitter);\ndayjs.extend(localizedFormat);\ndayjs.extend(relativeTime);\n\nconst dtf = new Intl.DateTimeFormat();\n\nexport default function RelativeTime({ datetime, format }) {\n  if (!datetime) return null;\n  const date = dayjs(datetime);\n  const [dateStr, setDateStr] = useState('');\n\n  useEffect(() => {\n    let timer, raf;\n    const update = () => {\n      raf = requestAnimationFrame(() => {\n        let str;\n        if (format === 'micro') {\n          // If date <= 1 day ago or day is within this year\n          const now = dayjs();\n          const dayDiff = now.diff(date, 'day');\n          if (dayDiff <= 1 || now.year() === date.year()) {\n            str = date.twitter();\n          } else {\n            str = dtf.format(date.toDate());\n          }\n        } else {\n          str = date.fromNow();\n        }\n        setDateStr(str);\n\n        timer = setTimeout(update, 30_000);\n      });\n    };\n    raf = requestAnimationFrame(update);\n    return () => {\n      clearTimeout(timer);\n      cancelAnimationFrame(raf);\n    };\n  }, [date]);\n\n  return (\n    <time datetime={date.toISOString()} title={date.format('LLLL')}>\n      {dateStr}\n    </time>\n  );\n}\n","import { match } from '@formatjs/intl-localematcher';\n\nimport mem from './mem';\n\nfunction _localeMatch(...args) {\n  // Wrap in try/catch because localeMatcher throws on invalid locales\n  try {\n    return match(...args);\n  } catch (e) {\n    const defaultLocale = args[2];\n    return defaultLocale || false;\n  }\n}\nconst localeMatch = mem(_localeMatch);\n\nexport default localeMatch;\n","import translationTargetLanguages from '../data/lingva-target-languages';\n\nimport localeMatch from './locale-match';\nimport states from './states';\n\nconst locales = [\n  new Intl.DateTimeFormat().resolvedOptions().locale,\n  ...navigator.languages,\n];\n\nfunction getTranslateTargetLanguage(fromSettings = false) {\n  if (fromSettings) {\n    const { contentTranslationTargetLanguage } = states.settings;\n    if (contentTranslationTargetLanguage) {\n      return contentTranslationTargetLanguage;\n    }\n  }\n  return localeMatch(\n    locales,\n    translationTargetLanguages.map((l) => l.code.replace('_', '-')), // The underscore will fail Intl.Locale inside `match`\n    'en',\n  );\n}\n\nexport default getTranslateTargetLanguage;\n","export default function localeCode2Text(code) {\n  try {\n    return new Intl.DisplayNames(navigator.languages, {\n      type: 'language',\n    }).of(code);\n  } catch (e) {\n    console.error(e);\n    return null;\n  }\n}\n","function emojifyText(text, emojis = []) {\n  if (!text) return '';\n  if (!emojis.length) return text;\n  if (text.indexOf(':') === -1) return text;\n  // Replace shortcodes in text with emoji\n  // emojis = [{ shortcode: 'smile', url: 'https://example.com/emoji.png' }]\n  emojis.forEach((emoji) => {\n    const { shortcode, staticUrl, url } = emoji;\n    text = text.replace(\n      new RegExp(`:${shortcode}:`, 'g'),\n      `<picture><source srcset=\"${staticUrl}\" media=\"(prefers-reduced-motion: reduce)\"></source><img class=\"shortcode-emoji emoji\" src=\"${url}\" alt=\":${shortcode}:\" width=\"16\" height=\"16\" loading=\"lazy\" decoding=\"async\" /></picture>`,\n    );\n  });\n  // console.log(text, emojis);\n  return text;\n}\n\nexport default emojifyText;\n","import emojifyText from './emojify-text';\nimport mem from './mem';\n\nconst fauxDiv = document.createElement('div');\nconst whitelistLinkClasses = ['u-url', 'mention', 'hashtag'];\n\nfunction _enhanceContent(content, opts = {}) {\n  const { emojis, postEnhanceDOM = () => {} } = opts;\n  let enhancedContent = content;\n  const dom = document.createElement('div');\n  dom.innerHTML = enhancedContent;\n  const hasLink = /<a/i.test(enhancedContent);\n  const hasCodeBlock = enhancedContent.indexOf('```') !== -1;\n\n  if (hasLink) {\n    // Add target=\"_blank\" to all links with no target=\"_blank\"\n    // E.g. `note` in `account`\n    const noTargetBlankLinks = Array.from(\n      dom.querySelectorAll('a:not([target=\"_blank\"])'),\n    );\n    noTargetBlankLinks.forEach((link) => {\n      link.setAttribute('target', '_blank');\n    });\n\n    // Remove all classes except `u-url`, `mention`, `hashtag`\n    const links = Array.from(dom.querySelectorAll('a[class]'));\n    links.forEach((link) => {\n      Array.from(link.classList).forEach((c) => {\n        if (!whitelistLinkClasses.includes(c)) {\n          link.classList.remove(c);\n        }\n      });\n    });\n  }\n\n  // Add 'has-url-text' to all links that contains a url\n  if (hasLink) {\n    const links = Array.from(dom.querySelectorAll('a[href]'));\n    links.forEach((link) => {\n      if (/^https?:\\/\\//i.test(link.textContent.trim())) {\n        link.classList.add('has-url-text');\n      }\n    });\n  }\n\n  // Spanify un-spanned mentions\n  if (hasLink) {\n    const links = Array.from(dom.querySelectorAll('a[href]'));\n    const usernames = [];\n    links.forEach((link) => {\n      const text = link.innerText.trim();\n      const hasChildren = link.querySelector('*');\n      // If text looks like @username@domain, then it's a mention\n      if (/^@[^@]+(@[^@]+)?$/g.test(text)) {\n        // Only show @username\n        const [_, username, domain] = text.split('@');\n        if (!hasChildren) {\n          if (\n            !usernames.find(([u]) => u === username) ||\n            usernames.find(([u, d]) => u === username && d === domain)\n          ) {\n            link.innerHTML = `@<span>${username}</span>`;\n            usernames.push([username, domain]);\n          } else {\n            link.innerHTML = `@<span>${username}@${domain}</span>`;\n          }\n        }\n        link.classList.add('mention');\n      }\n      // If text looks like #hashtag, then it's a hashtag\n      if (/^#[^#]+$/g.test(text)) {\n        if (!hasChildren) link.innerHTML = `#<span>${text.slice(1)}</span>`;\n        link.classList.add('mention', 'hashtag');\n      }\n    });\n  }\n\n  // EMOJIS\n  // ======\n  // Convert :shortcode: to <img />\n  let textNodes;\n  if (enhancedContent.indexOf(':') !== -1) {\n    textNodes = extractTextNodes(dom);\n    textNodes.forEach((node) => {\n      let html = node.nodeValue\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n      if (emojis) {\n        html = emojifyText(html, emojis);\n      }\n      fauxDiv.innerHTML = html;\n      const nodes = Array.from(fauxDiv.childNodes);\n      node.replaceWith(...nodes);\n    });\n  }\n\n  // CODE BLOCKS\n  // ===========\n  // Convert ```code``` to <pre><code>code</code></pre>\n  if (hasCodeBlock) {\n    const blocks = Array.from(dom.querySelectorAll('p')).filter((p) =>\n      /^```[^]+```$/g.test(p.innerText.trim()),\n    );\n    blocks.forEach((block) => {\n      const pre = document.createElement('pre');\n      // Replace <br /> with newlines\n      block.querySelectorAll('br').forEach((br) => br.replaceWith('\\n'));\n      pre.innerHTML = `<code>${block.innerHTML.trim()}</code>`;\n      block.replaceWith(pre);\n    });\n  }\n\n  // Convert multi-paragraph code blocks to <pre><code>code</code></pre>\n  if (hasCodeBlock) {\n    const paragraphs = Array.from(dom.querySelectorAll('p'));\n    // Filter out paragraphs with ``` in beginning only\n    const codeBlocks = paragraphs.filter((p) => /^```/g.test(p.innerText));\n    // For each codeBlocks, get all paragraphs until the last paragraph with ``` at the end only\n    codeBlocks.forEach((block) => {\n      const nextParagraphs = [block];\n      let hasCodeBlock = false;\n      let currentBlock = block;\n      while (currentBlock.nextElementSibling) {\n        const next = currentBlock.nextElementSibling;\n        if (next && next.tagName === 'P') {\n          if (/```$/g.test(next.innerText)) {\n            nextParagraphs.push(next);\n            hasCodeBlock = true;\n            break;\n          } else {\n            nextParagraphs.push(next);\n          }\n        } else {\n          break;\n        }\n        currentBlock = next;\n      }\n      if (hasCodeBlock) {\n        const pre = document.createElement('pre');\n        nextParagraphs.forEach((p) => {\n          // Replace <br /> with newlines\n          p.querySelectorAll('br').forEach((br) => br.replaceWith('\\n'));\n        });\n        const codeText = nextParagraphs.map((p) => p.innerHTML).join('\\n\\n');\n        pre.innerHTML = `<code tabindex=\"0\">${codeText}</code>`;\n        block.replaceWith(pre);\n        nextParagraphs.forEach((p) => p.remove());\n      }\n    });\n  }\n\n  // INLINE CODE\n  // ===========\n  // Convert `code` to <code>code</code>\n  if (enhancedContent.indexOf('`') !== -1) {\n    textNodes = extractTextNodes(dom);\n    textNodes.forEach((node) => {\n      let html = node.nodeValue\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n      if (/`[^`]+`/g.test(html)) {\n        html = html.replaceAll(/(`[^]+?`)/g, '<code>$1</code>');\n      }\n      fauxDiv.innerHTML = html;\n      const nodes = Array.from(fauxDiv.childNodes);\n      node.replaceWith(...nodes);\n    });\n  }\n\n  // TWITTER USERNAMES\n  // =================\n  // Convert @username@twitter.com to <a href=\"https://twitter.com/username\">@username@twitter.com</a>\n  if (/twitter\\.com/i.test(enhancedContent)) {\n    textNodes = extractTextNodes(dom, {\n      rejectFilter: ['A'],\n    });\n    textNodes.forEach((node) => {\n      let html = node.nodeValue\n        .replace(/&/g, '&amp;')\n        .replace(/</g, '&lt;')\n        .replace(/>/g, '&gt;');\n      if (/@[a-zA-Z0-9_]+@twitter\\.com/g.test(html)) {\n        html = html.replaceAll(\n          /(@([a-zA-Z0-9_]+)@twitter\\.com)/g,\n          '<a href=\"https://twitter.com/$2\" rel=\"nofollow noopener noreferrer\" target=\"_blank\">$1</a>',\n        );\n      }\n      fauxDiv.innerHTML = html;\n      const nodes = Array.from(fauxDiv.childNodes);\n      node.replaceWith(...nodes);\n    });\n  }\n\n  // HASHTAG STUFFING\n  // ================\n  // Get the <p> that contains a lot of hashtags, add a class to it\n  if (enhancedContent.indexOf('#') !== -1) {\n    let prevIndex = null;\n    const hashtagStuffedParagraphs = Array.from(\n      dom.querySelectorAll('p'),\n    ).filter((p, index) => {\n      let hashtagCount = 0;\n      for (let i = 0; i < p.childNodes.length; i++) {\n        const node = p.childNodes[i];\n\n        if (node.nodeType === Node.TEXT_NODE) {\n          const text = node.textContent.trim();\n          if (text !== '') {\n            return false;\n          }\n        } else if (node.tagName === 'BR') {\n          // Ignore <br />\n        } else if (node.tagName === 'A') {\n          const linkText = node.textContent.trim();\n          if (!linkText || !linkText.startsWith('#')) {\n            return false;\n          } else {\n            hashtagCount++;\n          }\n        } else {\n          return false;\n        }\n      }\n      // Only consider \"stuffing\" if:\n      // - there are more than 3 hashtags\n      // - there are more than 1 hashtag in adjacent paragraphs\n      if (hashtagCount > 3) {\n        prevIndex = index;\n        return true;\n      }\n      if (hashtagCount > 1 && prevIndex && index === prevIndex + 1) {\n        prevIndex = index;\n        return true;\n      }\n    });\n    if (hashtagStuffedParagraphs?.length) {\n      hashtagStuffedParagraphs.forEach((p) => {\n        p.classList.add('hashtag-stuffing');\n        p.title = p.innerText;\n      });\n    }\n  }\n\n  if (postEnhanceDOM) {\n    postEnhanceDOM(dom); // mutate dom\n  }\n\n  enhancedContent = dom.innerHTML;\n\n  return enhancedContent;\n}\nconst enhanceContent = mem(_enhanceContent);\n\nconst defaultRejectFilter = [\n  // Document metadata\n  'STYLE',\n  // Image and multimedia\n  'IMG',\n  'VIDEO',\n  'AUDIO',\n  'AREA',\n  'MAP',\n  'TRACK',\n  // Embedded content\n  'EMBED',\n  'IFRAME',\n  'OBJECT',\n  'PICTURE',\n  'PORTAL',\n  'SOURCE',\n  // SVG and MathML\n  'SVG',\n  'MATH',\n  // Scripting\n  'CANVAS',\n  'NOSCRIPT',\n  'SCRIPT',\n  // Forms\n  'INPUT',\n  'OPTION',\n  'TEXTAREA',\n  // Web Components\n  'SLOT',\n  'TEMPLATE',\n];\nconst defaultRejectFilterMap = Object.fromEntries(\n  defaultRejectFilter.map((nodeName) => [nodeName, true]),\n);\nfunction extractTextNodes(dom, opts = {}) {\n  const textNodes = [];\n  const walk = document.createTreeWalker(\n    dom,\n    NodeFilter.SHOW_TEXT,\n    {\n      acceptNode(node) {\n        if (defaultRejectFilterMap[node.parentNode.nodeName]) {\n          return NodeFilter.FILTER_REJECT;\n        }\n        if (\n          opts.rejectFilter &&\n          opts.rejectFilter.includes(node.parentNode.nodeName)\n        ) {\n          return NodeFilter.FILTER_REJECT;\n        }\n        return NodeFilter.FILTER_ACCEPT;\n      },\n    },\n    false,\n  );\n  let node;\n  while ((node = walk.nextNode())) {\n    textNodes.push(node);\n  }\n  return textNodes;\n}\n\nexport default enhanceContent;\n","import mem from './mem';\n\nconst div = document.createElement('div');\nfunction getHTMLText(html) {\n  if (!html) return '';\n  div.innerHTML = html\n    .replace(/<\\/p>/g, '</p>\\n\\n')\n    .replace(/<\\/li>/g, '</li>\\n');\n  div.querySelectorAll('br').forEach((br) => {\n    br.replaceWith('\\n');\n  });\n  return div.innerText.replace(/[\\r\\n]{3,}/g, '\\n\\n').trim();\n}\n\nexport default mem(getHTMLText);\n","import states from './states';\n\nfunction handleContentLinks(opts) {\n  const { mentions = [], instance, previewMode, statusURL } = opts || {};\n  return (e) => {\n    let { target } = e;\n    target = target.closest('a');\n    if (!target) return;\n\n    // If cmd/ctrl/shift/alt key is pressed or middle-click, let the browser handle it\n    if (e.metaKey || e.ctrlKey || e.shiftKey || e.altKey || e.which === 2) {\n      return;\n    }\n\n    const prevText = target.previousSibling?.textContent;\n    const textBeforeLinkIsAt = prevText?.endsWith('@');\n    const textStartsWithAt = target.innerText.startsWith('@');\n    if (\n      (target.classList.contains('u-url') && textStartsWithAt) ||\n      (textBeforeLinkIsAt && !textStartsWithAt)\n    ) {\n      const targetText = (\n        target.querySelector('span') || target\n      ).innerText.trim();\n      const username = targetText.replace(/^@/, '');\n      const url = target.getAttribute('href');\n      const mention = mentions.find(\n        (mention) =>\n          mention.username === username ||\n          mention.acct === username ||\n          mention.url === url,\n      );\n      if (mention) {\n        e.preventDefault();\n        e.stopPropagation();\n        states.showAccount = {\n          account: mention.acct,\n          instance,\n        };\n      } else if (!/^http/i.test(targetText)) {\n        console.log('mention not found', targetText);\n        e.preventDefault();\n        e.stopPropagation();\n        const href = target.getAttribute('href');\n        states.showAccount = {\n          account: href,\n          instance,\n        };\n      }\n    } else if (!previewMode) {\n      const textBeforeLinkIsHash = prevText?.endsWith('#');\n      if (target.classList.contains('hashtag') || textBeforeLinkIsHash) {\n        e.preventDefault();\n        e.stopPropagation();\n        const tag = target.innerText.replace(/^#/, '').trim();\n        const hashURL = instance ? `#/${instance}/t/${tag}` : `#/t/${tag}`;\n        console.log({ hashURL });\n        location.hash = hashURL;\n      } else if (\n        states.unfurledLinks[target.href]?.url &&\n        statusURL !== target.href\n      ) {\n        // If unfurled AND not self-referential\n        e.preventDefault();\n        e.stopPropagation();\n        states.prevLocation = {\n          pathname: location.hash.replace(/^#/, ''),\n        };\n        location.hash = `#${states.unfurledLinks[target.href].url}`;\n      }\n    }\n  };\n}\n\nexport default handleContentLinks;\n","const { locale } = new Intl.DateTimeFormat().resolvedOptions();\n\nfunction niceDateTime(date, { hideTime, formatOpts } = {}) {\n  if (!(date instanceof Date)) {\n    date = new Date(date);\n  }\n  const currentYear = new Date().getFullYear();\n  const dateText = Intl.DateTimeFormat(locale, {\n    // Show year if not current year\n    year: date.getFullYear() === currentYear ? undefined : 'numeric',\n    month: 'short',\n    day: 'numeric',\n    // Hide time if requested\n    hour: hideTime ? undefined : 'numeric',\n    minute: hideTime ? undefined : 'numeric',\n    ...formatOpts,\n  }).format(date);\n  return dateText;\n}\n\nexport default niceDateTime;\n","const { locale } = Intl.NumberFormat().resolvedOptions();\nconst shortenNumber = Intl.NumberFormat(locale, {\n  notation: 'compact',\n}).format;\nexport default shortenNumber;\n","import './account-block.css';\n\n// import { useNavigate } from 'react-router-dom';\nimport enhanceContent from '../utils/enhance-content';\nimport niceDateTime from '../utils/nice-date-time';\nimport states from '../utils/states';\n\nimport Avatar from './avatar';\nimport EmojiText from './emoji-text';\nimport Icon from './icon';\n\nfunction AccountBlock({\n  skeleton,\n  account,\n  avatarSize = 'xl',\n  useAvatarStatic = false,\n  instance,\n  external,\n  internal,\n  onClick,\n  showActivity = false,\n  showStats = false,\n  accountInstance,\n  hideDisplayName = false,\n}) {\n  if (skeleton) {\n    return (\n      <div class=\"account-block skeleton\">\n        <Avatar size={avatarSize} />\n        <span>\n          <b>████████</b>\n          <br />\n          <span class=\"account-block-acct\">@██████</span>\n        </span>\n      </div>\n    );\n  }\n\n  // const navigate = useNavigate();\n\n  const {\n    id,\n    acct,\n    avatar,\n    avatarStatic,\n    displayName,\n    username,\n    emojis,\n    url,\n    statusesCount,\n    lastStatusAt,\n    bot,\n    fields,\n    note,\n    group,\n  } = account;\n  let [_, acct1, acct2] = acct.match(/([^@]+)(@.+)/i) || [, acct];\n  if (accountInstance) {\n    acct2 = `@${accountInstance}`;\n  }\n\n  const verifiedField = fields?.find((f) => !!f.verifiedAt && !!f.value);\n\n  return (\n    <a\n      class=\"account-block\"\n      href={url}\n      target={external ? '_blank' : null}\n      title={`@${acct}`}\n      onClick={(e) => {\n        if (external) return;\n        e.preventDefault();\n        if (onClick) return onClick(e);\n        if (internal) {\n          // navigate(`/${instance}/a/${id}`);\n          location.hash = `/${instance}/a/${id}`;\n        } else {\n          states.showAccount = {\n            account,\n            instance,\n          };\n        }\n      }}\n    >\n      <Avatar\n        url={useAvatarStatic ? avatarStatic : avatar || avatarStatic}\n        size={avatarSize}\n        squircle={bot}\n      />\n      <span class=\"account-block-content\">\n        {!hideDisplayName && (\n          <>\n            {displayName ? (\n              <b>\n                <EmojiText text={displayName} emojis={emojis} />\n              </b>\n            ) : (\n              <b>{username}</b>\n            )}\n            <br />\n          </>\n        )}\n        <span class=\"account-block-acct\">\n          @{acct1}\n          <wbr />\n          {acct2}\n        </span>\n        {showActivity && (\n          <>\n            <br />\n            <small class=\"last-status-at insignificant\">\n              Posts: {statusesCount}\n              {!!lastStatusAt && (\n                <>\n                  {' '}\n                  &middot; Last posted:{' '}\n                  {niceDateTime(lastStatusAt, {\n                    hideTime: true,\n                  })}\n                </>\n              )}\n            </small>\n          </>\n        )}\n        {showStats && (\n          <div class=\"account-block-stats\">\n            <div\n              class=\"short-desc\"\n              dangerouslySetInnerHTML={{\n                __html: enhanceContent(note, { emojis }),\n              }}\n            />\n            {bot && (\n              <>\n                <span class=\"tag\">\n                  <Icon icon=\"bot\" /> Automated\n                </span>\n              </>\n            )}\n            {!!group && (\n              <>\n                <span class=\"tag\">\n                  <Icon icon=\"group\" /> Group\n                </span>\n              </>\n            )}\n            {!!verifiedField && (\n              <span class=\"verified-field ib\">\n                <Icon icon=\"check-circle\" size=\"s\" />{' '}\n                <span\n                  dangerouslySetInnerHTML={{\n                    __html: enhanceContent(verifiedField.value, { emojis }),\n                  }}\n                />\n              </span>\n            )}\n          </div>\n        )}\n      </span>\n    </a>\n  );\n}\n\nexport default AccountBlock;\n","import { satisfies } from 'compare-versions';\n\nimport features from '../data/features.json';\n\nimport { getCurrentInstance } from './store-utils';\n\nconst supportsCache = {};\n\nfunction supports(feature) {\n  try {\n    const { version, domain } = getCurrentInstance();\n    const key = `${domain}-${feature}`;\n    if (supportsCache[key]) return supportsCache[key];\n    const range = features[feature];\n    if (!range) return false;\n    return (supportsCache[key] = satisfies(version, range, {\n      includePrerelease: true,\n      loose: true,\n    }));\n  } catch (e) {\n    return false;\n  }\n}\n\nexport default supports;\n","import './translation-block.css';\n\nimport pRetry from 'p-retry';\nimport pThrottle from 'p-throttle';\nimport { useEffect, useRef, useState } from 'preact/hooks';\n\nimport sourceLanguages from '../data/lingva-source-languages';\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport localeCode2Text from '../utils/localeCode2Text';\nimport pmem from '../utils/pmem';\n\nimport Icon from './icon';\nimport Loader from './loader';\n\nconst throttle = pThrottle({\n  limit: 1,\n  interval: 2000,\n});\n\n// Using other API instances instead of lingva.ml because of this bug (slashes don't work):\n// https://github.com/thedaviddelta/lingva-translate/issues/68\nconst LINGVA_INSTANCES = [\n  'lingva.lunar.icu',\n  'lingva.garudalinux.org',\n  'translate.plausibility.cloud',\n];\nlet currentLingvaInstance = 0;\n\nfunction _lingvaTranslate(text, source, target) {\n  console.log('TRANSLATE', text, source, target);\n  const fetchCall = () => {\n    let instance = LINGVA_INSTANCES[currentLingvaInstance];\n    return fetch(\n      `https://${instance}/api/v1/${source}/${target}/${encodeURIComponent(\n        text,\n      )}`,\n    )\n      .then((res) => {\n        if (!res.ok) throw new Error(res.statusText);\n        return res.json();\n      })\n      .then((res) => {\n        return {\n          provider: 'lingva',\n          content: res.translation,\n          detectedSourceLanguage: res.info?.detectedSource,\n          info: res.info,\n        };\n      });\n  };\n  return pRetry(fetchCall, {\n    retries: 3,\n    onFailedAttempt: (e) => {\n      currentLingvaInstance =\n        (currentLingvaInstance + 1) % LINGVA_INSTANCES.length;\n      console.log(\n        'Retrying translation with another instance',\n        currentLingvaInstance,\n      );\n    },\n  });\n  // return masto.v1.statuses.$select(id).translate({\n  //   lang: DEFAULT_LANG,\n  // });\n}\nconst TRANSLATED_MAX_AGE = 1000 * 60 * 60; // 1 hour\nconst lingvaTranslate = pmem(_lingvaTranslate, {\n  maxAge: TRANSLATED_MAX_AGE,\n});\nconst throttledLingvaTranslate = pmem(throttle(lingvaTranslate), {\n  // I know, this is double-layered memoization\n  maxAge: TRANSLATED_MAX_AGE,\n});\n\nfunction TranslationBlock({\n  forceTranslate,\n  sourceLanguage,\n  onTranslate,\n  text = '',\n  mini,\n}) {\n  const targetLang = getTranslateTargetLanguage(true);\n  const [uiState, setUIState] = useState('default');\n  const [pronunciationContent, setPronunciationContent] = useState(null);\n  const [translatedContent, setTranslatedContent] = useState(null);\n  const [detectedLang, setDetectedLang] = useState(null);\n  const detailsRef = useRef();\n\n  const sourceLangText = sourceLanguage\n    ? localeCode2Text(sourceLanguage)\n    : null;\n  const targetLangText = localeCode2Text(targetLang);\n  const apiSourceLang = useRef('auto');\n\n  if (!onTranslate) {\n    onTranslate = mini ? throttledLingvaTranslate : lingvaTranslate;\n  }\n\n  const translate = async () => {\n    setUIState('loading');\n    try {\n      const { content, detectedSourceLanguage, provider, error, ...props } =\n        await onTranslate(text, apiSourceLang.current, targetLang);\n      if (content) {\n        if (detectedSourceLanguage) {\n          const detectedLangText = localeCode2Text(detectedSourceLanguage);\n          setDetectedLang(detectedLangText);\n        }\n        if (provider === 'lingva') {\n          const pronunciation = props?.info?.pronunciation?.query;\n          if (pronunciation) {\n            setPronunciationContent(pronunciation);\n          }\n        }\n        setTranslatedContent(content);\n        setUIState('default');\n        if (!mini && content.trim() !== text.trim()) {\n          detailsRef.current.open = true;\n          detailsRef.current.scrollIntoView({\n            behavior: 'smooth',\n            block: 'nearest',\n          });\n        }\n      } else {\n        if (error) console.error(error);\n        setUIState('error');\n      }\n    } catch (e) {\n      console.error(e);\n      setUIState('error');\n    }\n  };\n\n  useEffect(() => {\n    if (forceTranslate) {\n      translate();\n    }\n  }, [forceTranslate]);\n\n  if (mini) {\n    if (\n      !!translatedContent &&\n      translatedContent.trim() !== text.trim() &&\n      detectedLang !== targetLangText\n    ) {\n      return (\n        <div class=\"shazam-container\">\n          <div class=\"shazam-container-inner\">\n            <div class=\"status-translation-block-mini\">\n              <Icon\n                icon=\"translate\"\n                alt={`Auto-translated from ${sourceLangText}`}\n              />\n              <output\n                lang={targetLang}\n                dir=\"auto\"\n                title={pronunciationContent || ''}\n              >\n                {translatedContent}\n              </output>\n            </div>\n          </div>\n        </div>\n      );\n    }\n    return null;\n  }\n\n  return (\n    <div\n      class=\"status-translation-block\"\n      onClick={(e) => {\n        e.preventDefault();\n      }}\n    >\n      <details ref={detailsRef}>\n        <summary>\n          <button\n            type=\"button\"\n            onClick={async (e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              detailsRef.current.open = !detailsRef.current.open;\n              if (uiState === 'loading') return;\n              if (!translatedContent) translate();\n            }}\n          >\n            <Icon icon=\"translate\" />{' '}\n            <span>\n              {uiState === 'loading'\n                ? 'Translating…'\n                : sourceLanguage && sourceLangText && !detectedLang\n                ? `Translate from ${sourceLangText}`\n                : `Translate`}\n            </span>\n          </button>\n        </summary>\n        <div class=\"translated-block\">\n          <div class=\"translation-info insignificant\">\n            <select\n              class=\"translated-source-select\"\n              disabled={uiState === 'loading'}\n              onChange={(e) => {\n                apiSourceLang.current = e.target.value;\n                translate();\n              }}\n            >\n              {sourceLanguages.map((l) => (\n                <option value={l.code}>\n                  {l.code === 'auto' ? `Auto (${detectedLang ?? '…'})` : l.name}\n                </option>\n              ))}\n            </select>{' '}\n            <span>→ {targetLangText}</span>\n            <Loader abrupt hidden={uiState !== 'loading'} />\n          </div>\n          {uiState === 'error' ? (\n            <p class=\"ui-state\">Failed to translate</p>\n          ) : (\n            !!translatedContent && (\n              <>\n                <output class=\"translated-content\" lang={targetLang} dir=\"auto\">\n                  {translatedContent}\n                </output>\n                {!!pronunciationContent && (\n                  <output\n                    class=\"translated-pronunciation-content\"\n                    tabIndex={-1}\n                    onClick={(e) => {\n                      e.target.classList.toggle('expand');\n                    }}\n                  >\n                    {pronunciationContent}\n                  </output>\n                )}\n              </>\n            )\n          )}\n        </div>\n      </details>\n    </div>\n  );\n}\n\nexport default TranslationBlock;\n","import {\n  clear,\n  createStore,\n  del,\n  delMany,\n  get,\n  getMany,\n  keys,\n  set,\n} from 'idb-keyval';\n\nconst draftsStore = createStore('drafts-db', 'drafts-store');\n\n// Add additonal `draftsStore` parameter to all methods\n\nconst drafts = {\n  set: (key, val) => set(key, val, draftsStore),\n  get: (key) => get(key, draftsStore),\n  getMany: (keys) => getMany(keys, draftsStore),\n  del: (key) => del(key, draftsStore),\n  delMany: (keys) => delMany(keys, draftsStore),\n  clear: () => clear(draftsStore),\n  keys: () => keys(draftsStore),\n};\n\nexport default {\n  drafts,\n};\n","export default {\n  public: 'earth',\n  unlisted: 'group',\n  private: 'lock',\n  direct: 'message',\n};\n","import { useState } from 'preact/hooks';\n\nimport shortenNumber from '../utils/shorten-number';\n\nimport EmojiText from './emoji-text';\nimport Icon from './icon';\nimport RelativeTime from './relative-time';\n\nexport default function Poll({\n  poll,\n  lang,\n  readOnly,\n  refresh = () => {},\n  votePoll = () => {},\n}) {\n  const [uiState, setUIState] = useState('default');\n  const {\n    expired,\n    expiresAt,\n    id,\n    multiple,\n    options,\n    ownVotes,\n    voted,\n    votersCount,\n    votesCount,\n    emojis,\n  } = poll;\n  const expiresAtDate = !!expiresAt && new Date(expiresAt); // Update poll at point of expiry\n  // NOTE: Disable this because setTimeout runs immediately if delay is too large\n  // https://stackoverflow.com/a/56718027/20838\n  // useEffect(() => {\n  //   let timeout;\n  //   if (!expired && expiresAtDate) {\n  //     const ms = expiresAtDate.getTime() - Date.now() + 1; // +1 to give it a little buffer\n  //     if (ms > 0) {\n  //       timeout = setTimeout(() => {\n  //         setUIState('loading');\n  //         (async () => {\n  //           // await refresh();\n  //           setUIState('default');\n  //         })();\n  //       }, ms);\n  //     }\n  //   }\n  //   return () => {\n  //     clearTimeout(timeout);\n  //   };\n  // }, [expired, expiresAtDate]);\n\n  const pollVotesCount = votersCount || votesCount;\n  let roundPrecision = 0;\n\n  if (pollVotesCount <= 1000) {\n    roundPrecision = 0;\n  } else if (pollVotesCount <= 10000) {\n    roundPrecision = 1;\n  } else if (pollVotesCount <= 100000) {\n    roundPrecision = 2;\n  }\n\n  const [showResults, setShowResults] = useState(false);\n  const optionsHaveVoteCounts = options.every((o) => o.votesCount !== null);\n\n  return (\n    <div\n      lang={lang}\n      dir=\"auto\"\n      class={`poll ${readOnly ? 'read-only' : ''} ${\n        uiState === 'loading' ? 'loading' : ''\n      }`}\n    >\n      {(showResults && optionsHaveVoteCounts) || voted || expired ? (\n        <>\n          <div class=\"poll-options\">\n            {options.map((option, i) => {\n              const { title, votesCount: optionVotesCount } = option;\n              const percentage = pollVotesCount\n                ? ((optionVotesCount / pollVotesCount) * 100).toFixed(\n                    roundPrecision,\n                  )\n                : 0; // check if current poll choice is the leading one\n\n              const isLeading =\n                optionVotesCount > 0 &&\n                optionVotesCount ===\n                  Math.max(...options.map((o) => o.votesCount));\n              return (\n                <div\n                  key={`${i}-${title}-${optionVotesCount}`}\n                  class={`poll-option poll-result ${\n                    isLeading ? 'poll-option-leading' : ''\n                  }`}\n                  style={{\n                    '--percentage': `${percentage}%`,\n                  }}\n                >\n                  <div class=\"poll-option-title\">\n                    <span>\n                      <EmojiText text={title} emojis={emojis} />\n                    </span>\n                    {voted && ownVotes.includes(i) && (\n                      <>\n                        {' '}\n                        <Icon icon=\"check-circle\" />\n                      </>\n                    )}\n                  </div>\n                  <div\n                    class=\"poll-option-votes\"\n                    title={`${optionVotesCount} vote${\n                      optionVotesCount === 1 ? '' : 's'\n                    }`}\n                  >\n                    {percentage}%\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n          {!expired && !voted && (\n            <button\n              class=\"poll-vote-button plain2\"\n              disabled={uiState === 'loading'}\n              onClick={(e) => {\n                e.preventDefault();\n                setShowResults(false);\n              }}\n            >\n              <Icon icon=\"arrow-left\" size=\"s\" /> Hide results\n            </button>\n          )}\n        </>\n      ) : (\n        <form\n          onSubmit={async (e) => {\n            e.preventDefault();\n            const form = e.target;\n            const formData = new FormData(form);\n            const choices = [];\n            formData.forEach((value, key) => {\n              if (key === 'poll') {\n                choices.push(value);\n              }\n            });\n            if (!choices.length) return;\n            setUIState('loading');\n            await votePoll(choices);\n            setUIState('default');\n          }}\n        >\n          <div class=\"poll-options\">\n            {options.map((option, i) => {\n              const { title } = option;\n              return (\n                <div class=\"poll-option\">\n                  <label class=\"poll-label\">\n                    <input\n                      type={multiple ? 'checkbox' : 'radio'}\n                      name=\"poll\"\n                      value={i}\n                      disabled={uiState === 'loading'}\n                      readOnly={readOnly}\n                    />\n                    <span class=\"poll-option-title\">\n                      <EmojiText text={title} emojis={emojis} />\n                    </span>\n                  </label>\n                </div>\n              );\n            })}\n          </div>\n          {!readOnly && (\n            <button\n              class=\"poll-vote-button\"\n              type=\"submit\"\n              disabled={uiState === 'loading'}\n            >\n              Vote\n            </button>\n          )}\n        </form>\n      )}\n      <p class=\"poll-meta\">\n        {!expired && !readOnly && (\n          <button\n            type=\"button\"\n            class=\"plain small\"\n            disabled={uiState === 'loading'}\n            style={{\n              marginLeft: -8,\n            }}\n            onClick={(e) => {\n              e.preventDefault();\n              setUIState('loading');\n\n              (async () => {\n                await refresh();\n                setUIState('default');\n              })();\n            }}\n            title=\"Refresh\"\n          >\n            <Icon icon=\"refresh\" alt=\"Refresh\" />\n          </button>\n        )}\n        {!voted && !expired && !readOnly && optionsHaveVoteCounts && (\n          <button\n            type=\"button\"\n            class=\"plain small\"\n            disabled={uiState === 'loading'}\n            onClick={(e) => {\n              e.preventDefault();\n              setShowResults(!showResults);\n            }}\n            title={showResults ? 'Hide results' : 'Show results'}\n          >\n            <Icon\n              icon={showResults ? 'eye-open' : 'eye-close'}\n              alt={showResults ? 'Hide results' : 'Show results'}\n            />{' '}\n          </button>\n        )}\n        {!expired && !readOnly && ' '}\n        <span title={votesCount}>{shortenNumber(votesCount)}</span> vote\n        {votesCount === 1 ? '' : 's'}\n        {!!votersCount && votersCount !== votesCount && (\n          <>\n            {' '}\n            &bull; <span title={votersCount}>\n              {shortenNumber(votersCount)}\n            </span>{' '}\n            voter\n            {votersCount === 1 ? '' : 's'}\n          </>\n        )}{' '}\n        &bull; {expired ? 'Ended' : 'Ending'}{' '}\n        {!!expiresAtDate && <RelativeTime datetime={expiresAtDate} />}\n      </p>{' '}\n    </div>\n  );\n}\n","import { createContext } from 'preact';\n\nconst FilterContext = createContext();\nexport default FilterContext;\n","import mem from './mem';\nimport store from './store';\n\nfunction _isFiltered(filtered, filterContext) {\n  if (!filtered?.length) return false;\n  const appliedFilters = filtered.filter((f) => {\n    const { filter } = f;\n    const hasContext = filter.context.includes(filterContext);\n    if (!hasContext) return false;\n    if (!filter.expiresAt) return hasContext;\n    return new Date(filter.expiresAt) > new Date();\n  });\n  if (!appliedFilters.length) return false;\n  const isHidden = appliedFilters.some((f) => f.filter.filterAction === 'hide');\n  if (isHidden)\n    return {\n      action: 'hide',\n    };\n  const isWarn = appliedFilters.some((f) => f.filter.filterAction === 'warn');\n  if (isWarn) {\n    const filterTitles = appliedFilters.map((f) => f.filter.title);\n    return {\n      action: 'warn',\n      titles: filterTitles,\n      titlesStr: filterTitles.join(' • '),\n    };\n  }\n  return false;\n}\nexport const isFiltered = mem(_isFiltered);\n\nexport function filteredItem(item, filterContext, currentAccountID) {\n  const { filtered } = item;\n  if (!filtered?.length) return true;\n  const isSelf = currentAccountID && item.account?.id === currentAccountID;\n  if (isSelf) return true;\n  const filterState = isFiltered(filtered, filterContext);\n  if (!filterState) return true;\n  if (filterState.action === 'hide') return false;\n  // item._filtered = filterState;\n  return true;\n}\nexport function filteredItems(items, filterContext) {\n  if (!items?.length) return [];\n  if (!filterContext) return items;\n  const currentAccountID = store.session.get('currentAccount');\n  return items.filter((item) =>\n    filteredItem(item, filterContext, currentAccountID),\n  );\n}\n","const div = document.createElement('div');\nexport default function htmlContentLength(html) {\n  if (!html) return 0;\n  div.innerHTML = html;\n  return div.innerText.length;\n}\n","export default function isMastodonLinkMaybe(url) {\n  const { pathname, hash } = new URL(url);\n  return (\n    /^\\/.*\\/\\d+$/i.test(pathname) ||\n    /^\\/@[^/]+\\/(statuses|posts)\\/\\w+\\/?$/i.test(pathname) || // GoToSocial, Takahe\n    /^\\/notes\\/[a-z0-9]+$/i.test(pathname) || // Misskey, Calckey\n    /^\\/notes\\/[a-z0-9]+$/i.test(pathname) || // Misskey, Calckey\n    /^\\/(notice|objects)\\/[a-z0-9-]+$/i.test(pathname) || // Pleroma\n    /#\\/[^\\/]+\\.[^\\/]+\\/s\\/.+/i.test(hash) // Phanpy 🫣\n  );\n}\n","const root = document.documentElement;\nconst style = getComputedStyle(root);\nconst defaultBoundingBoxPadding = 8;\n\nlet safeAreaInsets = [0, 0, 0, 0];\nfunction getSafeAreaInsets() {\n  // Get safe area inset variables from root\n  const safeAreaInsetTop = style.getPropertyValue('--sai-top');\n  const safeAreaInsetRight = style.getPropertyValue('--sai-right');\n  const safeAreaInsetBottom = style.getPropertyValue('--sai-bottom');\n  const safeAreaInsetLeft = style.getPropertyValue('--sai-left');\n  safeAreaInsets = [\n    // top, right, bottom, left (clockwise)\n    Math.max(0, parseInt(safeAreaInsetTop, 10)),\n    Math.max(0, parseInt(safeAreaInsetRight, 10)),\n    Math.max(0, parseInt(safeAreaInsetBottom, 10)),\n    Math.max(0, parseInt(safeAreaInsetLeft, 10)),\n  ];\n}\nrequestAnimationFrame(getSafeAreaInsets);\n\nfunction safeBoundingBoxPadding(paddings = []) {\n  const str = safeAreaInsets\n    .map((v, i) => (v || defaultBoundingBoxPadding) + (paddings[i] || 0))\n    .join(' ');\n  // console.log(str);\n  return str;\n}\n\n// Update safe area insets when orientation or resize\nif (CSS.supports('top: env(safe-area-inset-top)')) {\n  window.addEventListener('resize', getSafeAreaInsets, { passive: true });\n}\n\nexport default safeBoundingBoxPadding;\n","import getHTMLText from './getHTMLText';\n\nfunction statusPeek(status) {\n  const { spoilerText, content, poll, mediaAttachments } = status;\n  let text = '';\n  if (spoilerText?.trim()) {\n    text += spoilerText;\n  } else {\n    text += getHTMLText(content);\n  }\n  text = text.trim();\n  if (poll) {\n    text += ' 📊';\n  }\n  if (mediaAttachments?.length) {\n    text +=\n      ' ' +\n      mediaAttachments\n        .map(\n          (m) =>\n            ({\n              image: '🖼️',\n              gifv: '🎞️',\n              video: '📹',\n              audio: '🎵',\n              unknown: '',\n            }[m.type] || ''),\n        )\n        .join('');\n  }\n  return text;\n}\n\nexport default statusPeek;\n","import { useRef } from 'preact/hooks';\nimport { useThrottledCallback } from 'use-debounce';\nimport useResizeObserver from 'use-resize-observer';\n\nexport default function useTruncated({ className = 'truncated' } = {}) {\n  const ref = useRef();\n  const onResize = useThrottledCallback(({ height }) => {\n    if (ref.current) {\n      const { scrollHeight } = ref.current;\n      let truncated = scrollHeight > height;\n      if (truncated) {\n        const { height: _height, maxHeight } = getComputedStyle(ref.current);\n        const computedHeight = parseInt(maxHeight || _height, 10);\n        truncated = scrollHeight > computedHeight;\n      }\n      ref.current.classList.toggle(className, truncated);\n    }\n  }, 300);\n  useResizeObserver({\n    ref,\n    box: 'border-box',\n    onResize,\n  });\n  return ref;\n}\n","import { getBlurHashAverageColor } from 'fast-blurhash';\nimport { Fragment } from 'preact';\nimport {\n  useCallback,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport QuickPinchZoom, { make3dTransformValue } from 'react-quick-pinch-zoom';\n\nimport mem from '../utils/mem';\nimport states from '../utils/states';\n\nimport Icon from './icon';\nimport Link from './link';\nimport { formatDuration } from './status';\n\nconst isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent); // https://stackoverflow.com/a/23522755\n\n/*\nMedia type\n===\nunknown = unsupported or unrecognized file type\nimage = Static image\ngifv = Looping, soundless animation\nvideo = Video clip\naudio = Audio track\n*/\n\nconst dataAltLabel = 'ALT';\nconst AltBadge = (props) => {\n  const { alt, lang, index, ...rest } = props;\n  if (!alt || !alt.trim()) return null;\n  return (\n    <button\n      type=\"button\"\n      class=\"alt-badge clickable\"\n      {...rest}\n      onClick={(e) => {\n        e.stopPropagation();\n        e.preventDefault();\n        states.showMediaAlt = {\n          alt,\n          lang,\n        };\n      }}\n      title=\"Media description\"\n    >\n      {dataAltLabel}\n      {!!index && <sup>{index}</sup>}\n    </button>\n  );\n};\n\nconst MEDIA_CAPTION_LIMIT = 140;\nexport const isMediaCaptionLong = mem((caption) =>\n  caption?.length\n    ? caption.length > MEDIA_CAPTION_LIMIT ||\n      /[\\n\\r].*[\\n\\r]/.test(caption.trim())\n    : false,\n);\n\nfunction Media({\n  class: className = '',\n  media,\n  to,\n  lang,\n  showOriginal,\n  autoAnimate,\n  showCaption,\n  altIndex,\n  onClick = () => {},\n}) {\n  const {\n    blurhash,\n    description,\n    meta,\n    previewRemoteUrl,\n    previewUrl,\n    remoteUrl,\n    url,\n    type,\n  } = media;\n  const { original = {}, small, focus } = meta || {};\n\n  const width = showOriginal ? original?.width : small?.width;\n  const height = showOriginal ? original?.height : small?.height;\n  const mediaURL = showOriginal ? url : previewUrl || url;\n  const remoteMediaURL = showOriginal\n    ? remoteUrl\n    : previewRemoteUrl || remoteUrl;\n  const orientation = width >= height ? 'landscape' : 'portrait';\n\n  const rgbAverageColor = blurhash ? getBlurHashAverageColor(blurhash) : null;\n\n  const videoRef = useRef();\n\n  let focalBackgroundPosition;\n  if (focus) {\n    // Convert focal point to CSS background position\n    // Formula from jquery-focuspoint\n    // x = -1, y = 1 => 0% 0%\n    // x = 0, y = 0 => 50% 50%\n    // x = 1, y = -1 => 100% 100%\n    const x = ((focus.x + 1) / 2) * 100;\n    const y = ((1 - focus.y) / 2) * 100;\n    focalBackgroundPosition = `${x.toFixed(0)}% ${y.toFixed(0)}%`;\n  }\n\n  const mediaRef = useRef();\n  const onUpdate = useCallback(({ x, y, scale }) => {\n    const { current: media } = mediaRef;\n\n    if (media) {\n      const value = make3dTransformValue({ x, y, scale });\n\n      if (scale === 1) {\n        media.style.removeProperty('transform');\n      } else {\n        media.style.setProperty('transform', value);\n      }\n\n      media.closest('.media-zoom').style.touchAction =\n        scale <= 1.01 ? 'pan-x' : '';\n    }\n  }, []);\n\n  const [pinchZoomEnabled, setPinchZoomEnabled] = useState(false);\n  const quickPinchZoomProps = {\n    enabled: pinchZoomEnabled,\n    draggableUnZoomed: false,\n    inertiaFriction: 0.9,\n    doubleTapZoomOutOnMaxScale: true,\n    containerProps: {\n      className: 'media-zoom',\n      style: {\n        overflow: 'visible',\n        //   width: 'inherit',\n        //   height: 'inherit',\n        //   justifyContent: 'inherit',\n        //   alignItems: 'inherit',\n        //   display: 'inherit',\n      },\n    },\n    onUpdate,\n  };\n\n  const Parent = useMemo(\n    () => (to ? (props) => <Link to={to} {...props} /> : 'div'),\n    [to],\n  );\n\n  const isVideoMaybe =\n    type === 'unknown' &&\n    /\\.(mp4|m4a|m4p|m4b|m4r|m4v|mov|webm)$/i.test(remoteMediaURL);\n  const isImage =\n    type === 'image' || (type === 'unknown' && previewUrl && !isVideoMaybe);\n\n  const parentRef = useRef();\n  const [imageSmallerThanParent, setImageSmallerThanParent] = useState(false);\n  useLayoutEffect(() => {\n    if (!isImage) return;\n    if (!showOriginal) return;\n    if (!parentRef.current) return;\n    const { offsetWidth, offsetHeight } = parentRef.current;\n    const smaller = width < offsetWidth && height < offsetHeight;\n    if (smaller) setImageSmallerThanParent(smaller);\n  }, [width, height]);\n\n  const maxAspectHeight =\n    window.innerHeight * (orientation === 'portrait' ? 0.45 : 0.33);\n  const maxHeight = orientation === 'portrait' ? 0 : 160;\n  const averageColorStyle = {\n    '--average-color': rgbAverageColor && `rgb(${rgbAverageColor.join(',')})`,\n  };\n  const mediaStyles =\n    width && height\n      ? {\n          '--width': `${width}px`,\n          '--height': `${height}px`,\n          // Calculate '--aspectWidth' based on aspect ratio calculated from '--width' and '--height', max height has to be 160px\n          '--aspectWidth': `${\n            (width / height) * Math.max(maxHeight, maxAspectHeight)\n          }px`,\n          aspectRatio: `${width} / ${height}`,\n          ...averageColorStyle,\n        }\n      : {\n          ...averageColorStyle,\n        };\n\n  const longDesc = isMediaCaptionLong(description);\n  const showInlineDesc =\n    !!showCaption && !showOriginal && !!description && !longDesc;\n  const Figure = !showInlineDesc\n    ? Fragment\n    : (props) => {\n        const { children, ...restProps } = props;\n        return (\n          <figure {...restProps}>\n            {children}\n            <figcaption\n              class=\"media-caption\"\n              lang={lang}\n              dir=\"auto\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                states.showMediaAlt = {\n                  alt: description,\n                  lang,\n                };\n              }}\n            >\n              {description}\n            </figcaption>\n          </figure>\n        );\n      };\n\n  if (isImage) {\n    // Note: type: unknown might not have width/height\n    quickPinchZoomProps.containerProps.style.display = 'inherit';\n\n    useLayoutEffect(() => {\n      if (!isSafari) return;\n      if (!showOriginal) return;\n      (async () => {\n        try {\n          await fetch(mediaURL, { mode: 'no-cors' });\n          mediaRef.current.src = mediaURL;\n        } catch (e) {\n          // Ignore\n        }\n      })();\n    }, [mediaURL]);\n\n    return (\n      <Figure>\n        <Parent\n          ref={parentRef}\n          class={`media media-image ${className}`}\n          onClick={onClick}\n          data-orientation={orientation}\n          data-has-alt={!showInlineDesc}\n          style={\n            showOriginal\n              ? {\n                  backgroundImage: `url(${previewUrl})`,\n                  backgroundSize: imageSmallerThanParent\n                    ? `${width}px ${height}px`\n                    : undefined,\n                  ...averageColorStyle,\n                }\n              : mediaStyles\n          }\n        >\n          {showOriginal ? (\n            <QuickPinchZoom {...quickPinchZoomProps}>\n              <img\n                ref={mediaRef}\n                src={mediaURL}\n                alt={description}\n                width={width}\n                height={height}\n                data-orientation={orientation}\n                loading=\"eager\"\n                decoding=\"sync\"\n                onLoad={(e) => {\n                  e.target.closest('.media-image').style.backgroundImage = '';\n                  e.target.closest('.media-zoom').style.display = '';\n                  setPinchZoomEnabled(true);\n                }}\n                onError={(e) => {\n                  const { src } = e.target;\n                  if (src === mediaURL) {\n                    e.target.src = remoteMediaURL;\n                  }\n                }}\n              />\n            </QuickPinchZoom>\n          ) : (\n            <>\n              <img\n                src={mediaURL}\n                alt={showInlineDesc ? '' : description}\n                width={width}\n                height={height}\n                data-orientation={orientation}\n                loading=\"lazy\"\n                style={{\n                  backgroundColor:\n                    rgbAverageColor && `rgb(${rgbAverageColor.join(',')})`,\n                  backgroundPosition: focalBackgroundPosition || 'center',\n                  // Duration based on width or height in pixels\n                  // 100px per second (rough estimate)\n                  // Clamp between 5s and 120s\n                  '--anim-duration': `${Math.min(\n                    Math.max(Math.max(width, height) / 100, 5),\n                    120,\n                  )}s`,\n                }}\n                onLoad={(e) => {\n                  e.target.closest('.media-image').style.backgroundImage = '';\n                  e.target.dataset.loaded = true;\n                }}\n                onError={(e) => {\n                  const { src } = e.target;\n                  if (src === mediaURL) {\n                    e.target.src = remoteMediaURL;\n                  }\n                }}\n              />\n              {!showInlineDesc && (\n                <AltBadge alt={description} lang={lang} index={altIndex} />\n              )}\n            </>\n          )}\n        </Parent>\n      </Figure>\n    );\n  } else if (type === 'gifv' || type === 'video' || isVideoMaybe) {\n    const shortDuration = original.duration < 31;\n    const isGIF = type === 'gifv' && shortDuration;\n    // If GIF is too long, treat it as a video\n    const loopable = original.duration < 61;\n    const formattedDuration = formatDuration(original.duration);\n    const hoverAnimate = !showOriginal && !autoAnimate && isGIF;\n    const autoGIFAnimate = !showOriginal && autoAnimate && isGIF;\n\n    const videoHTML = `\n    <video\n      src=\"${url}\"\n      poster=\"${previewUrl}\"\n      width=\"${width}\"\n      height=\"${height}\"\n      data-orientation=\"${orientation}\"\n      preload=\"auto\"\n      autoplay\n      muted=\"${isGIF}\"\n      ${isGIF ? '' : 'controls'}\n      playsinline\n      loop=\"${loopable}\"\n      ${isGIF ? 'ondblclick=\"this.paused ? this.play() : this.pause()\"' : ''}\n    ></video>\n  `;\n\n    return (\n      <Figure>\n        <Parent\n          class={`media ${className} media-${isGIF ? 'gif' : 'video'} ${\n            autoGIFAnimate ? 'media-contain' : ''\n          }`}\n          data-orientation={orientation}\n          data-formatted-duration={\n            !showOriginal ? formattedDuration : undefined\n          }\n          data-label={isGIF && !showOriginal && !autoGIFAnimate ? 'GIF' : ''}\n          data-has-alt={!showInlineDesc}\n          // style={{\n          //   backgroundColor:\n          //     rgbAverageColor && `rgb(${rgbAverageColor.join(',')})`,\n          // }}\n          style={!showOriginal && mediaStyles}\n          onClick={(e) => {\n            if (hoverAnimate) {\n              try {\n                videoRef.current.pause();\n              } catch (e) {}\n            }\n            onClick(e);\n          }}\n          onMouseEnter={() => {\n            if (hoverAnimate) {\n              try {\n                videoRef.current.play();\n              } catch (e) {}\n            }\n          }}\n          onMouseLeave={() => {\n            if (hoverAnimate) {\n              try {\n                videoRef.current.pause();\n              } catch (e) {}\n            }\n          }}\n          onFocus={() => {\n            if (hoverAnimate) {\n              try {\n                videoRef.current.play();\n              } catch (e) {}\n            }\n          }}\n          onBlur={() => {\n            if (hoverAnimate) {\n              try {\n                videoRef.current.pause();\n              } catch (e) {}\n            }\n          }}\n        >\n          {showOriginal || autoGIFAnimate ? (\n            isGIF && showOriginal ? (\n              <QuickPinchZoom {...quickPinchZoomProps} enabled>\n                <div\n                  ref={mediaRef}\n                  dangerouslySetInnerHTML={{\n                    __html: videoHTML,\n                  }}\n                />\n              </QuickPinchZoom>\n            ) : (\n              <div\n                class=\"video-container\"\n                dangerouslySetInnerHTML={{\n                  __html: videoHTML,\n                }}\n              />\n            )\n          ) : isGIF ? (\n            <video\n              ref={videoRef}\n              src={url}\n              poster={previewUrl}\n              width={width}\n              height={height}\n              data-orientation={orientation}\n              preload=\"auto\"\n              // controls\n              playsinline\n              loop\n              muted\n            />\n          ) : (\n            <>\n              <img\n                src={previewUrl}\n                alt={showInlineDesc ? '' : description}\n                width={width}\n                height={height}\n                data-orientation={orientation}\n                loading=\"lazy\"\n              />\n              <div class=\"media-play\">\n                <Icon icon=\"play\" size=\"xl\" />\n              </div>\n            </>\n          )}\n          {!showOriginal && !showInlineDesc && (\n            <AltBadge alt={description} lang={lang} index={altIndex} />\n          )}\n        </Parent>\n      </Figure>\n    );\n  } else if (type === 'audio') {\n    const formattedDuration = formatDuration(original.duration);\n    return (\n      <Figure>\n        <Parent\n          class={`media media-audio ${className}`}\n          data-formatted-duration={\n            !showOriginal ? formattedDuration : undefined\n          }\n          data-has-alt={!showInlineDesc}\n          onClick={onClick}\n          style={!showOriginal && mediaStyles}\n        >\n          {showOriginal ? (\n            <audio src={remoteUrl || url} preload=\"none\" controls autoplay />\n          ) : previewUrl ? (\n            <img\n              src={previewUrl}\n              alt={showInlineDesc ? '' : description}\n              width={width}\n              height={height}\n              data-orientation={orientation}\n              loading=\"lazy\"\n            />\n          ) : null}\n          {!showOriginal && (\n            <>\n              <div class=\"media-play\">\n                <Icon icon=\"play\" size=\"xl\" />\n              </div>\n              {!showInlineDesc && (\n                <AltBadge alt={description} lang={lang} index={altIndex} />\n              )}\n            </>\n          )}\n        </Parent>\n      </Figure>\n    );\n  }\n}\n\nexport default Media;\n","import { FocusableItem } from '@szhsin/react-menu';\n\nimport Link from './link';\n\nfunction MenuLink(props) {\n  return (\n    <FocusableItem>\n      {({ ref, closeMenu }) => (\n        <Link\n          {...props}\n          ref={ref}\n          onClick={({ detail }) =>\n            closeMenu(detail === 0 ? 'Enter' : undefined)\n          }\n        />\n      )}\n    </FocusableItem>\n  );\n}\n\nexport default MenuLink;\n","import './status.css';\n\nimport '@justinribeiro/lite-youtube';\nimport {\n  ControlledMenu,\n  Menu,\n  MenuDivider,\n  MenuHeader,\n  MenuItem,\n} from '@szhsin/react-menu';\nimport { decodeBlurHash } from 'fast-blurhash';\nimport pThrottle from 'p-throttle';\nimport { memo } from 'preact/compat';\nimport {\n  useCallback,\n  useContext,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport { InView } from 'react-intersection-observer';\nimport { useLongPress } from 'use-long-press';\nimport { useSnapshot } from 'valtio';\nimport { snapshot } from 'valtio/vanilla';\n\nimport AccountBlock from '../components/account-block';\nimport EmojiText from '../components/emoji-text';\nimport Loader from '../components/loader';\nimport MenuConfirm from '../components/menu-confirm';\nimport Modal from '../components/modal';\nimport NameText from '../components/name-text';\nimport Poll from '../components/poll';\nimport { api } from '../utils/api';\nimport emojifyText from '../utils/emojify-text';\nimport enhanceContent from '../utils/enhance-content';\nimport FilterContext from '../utils/filter-context';\nimport { isFiltered } from '../utils/filters';\nimport getTranslateTargetLanguage from '../utils/get-translate-target-language';\nimport getHTMLText from '../utils/getHTMLText';\nimport handleContentLinks from '../utils/handle-content-links';\nimport htmlContentLength from '../utils/html-content-length';\nimport isMastodonLinkMaybe from '../utils/isMastodonLinkMaybe';\nimport localeMatch from '../utils/locale-match';\nimport niceDateTime from '../utils/nice-date-time';\nimport openCompose from '../utils/open-compose';\nimport pmem from '../utils/pmem';\nimport safeBoundingBoxPadding from '../utils/safe-bounding-box-padding';\nimport shortenNumber from '../utils/shorten-number';\nimport showToast from '../utils/show-toast';\nimport states, { getStatus, saveStatus, statusKey } from '../utils/states';\nimport statusPeek from '../utils/status-peek';\nimport store from '../utils/store';\nimport useTruncated from '../utils/useTruncated';\nimport visibilityIconsMap from '../utils/visibility-icons-map';\n\nimport Avatar from './avatar';\nimport Icon from './icon';\nimport Link from './link';\nimport Media from './media';\nimport { isMediaCaptionLong } from './media';\nimport MenuLink from './menu-link';\nimport RelativeTime from './relative-time';\nimport TranslationBlock from './translation-block';\n\nconst INLINE_TRANSLATE_LIMIT = 140;\nconst throttle = pThrottle({\n  limit: 1,\n  interval: 1000,\n});\n\nfunction fetchAccount(id, masto) {\n  return masto.v1.accounts.$select(id).fetch();\n}\nconst memFetchAccount = pmem(fetchAccount);\n\nconst visibilityText = {\n  public: 'Public',\n  unlisted: 'Unlisted',\n  private: 'Followers only',\n  direct: 'Private mention',\n};\n\nconst isIOS =\n  window.ontouchstart !== undefined &&\n  /iPad|iPhone|iPod/.test(navigator.userAgent);\n\nfunction Status({\n  statusID,\n  status,\n  instance: propInstance,\n  withinContext,\n  size = 'm',\n  skeleton,\n  readOnly,\n  contentTextWeight,\n  enableTranslate,\n  forceTranslate: _forceTranslate,\n  previewMode,\n  // allowFilters,\n  onMediaClick,\n  quoted,\n  onStatusLinkClick = () => {},\n  enableCommentHint,\n}) {\n  if (skeleton) {\n    return (\n      <div class=\"status skeleton\">\n        <Avatar size=\"xxl\" />\n        <div class=\"container\">\n          <div class=\"meta\">███ ████████</div>\n          <div class=\"content-container\">\n            <div class=\"content\">\n              <p>████ ████████</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n  const { masto, instance, authenticated } = api({ instance: propInstance });\n  const { instance: currentInstance } = api();\n  const sameInstance = instance === currentInstance;\n\n  let sKey = statusKey(statusID, instance);\n  const snapStates = useSnapshot(states);\n  if (!status) {\n    status = snapStates.statuses[sKey] || snapStates.statuses[statusID];\n    sKey = statusKey(status?.id, instance);\n  }\n  if (!status) {\n    return null;\n  }\n\n  const {\n    account: {\n      acct,\n      avatar,\n      avatarStatic,\n      id: accountId,\n      url: accountURL,\n      displayName,\n      username,\n      emojis: accountEmojis,\n      bot,\n      group,\n    },\n    id,\n    repliesCount,\n    reblogged,\n    reblogsCount,\n    favourited,\n    favouritesCount,\n    bookmarked,\n    poll,\n    muted,\n    sensitive,\n    spoilerText,\n    visibility, // public, unlisted, private, direct\n    language,\n    editedAt,\n    filtered,\n    card,\n    createdAt,\n    inReplyToId,\n    inReplyToAccountId,\n    content,\n    mentions,\n    mediaAttachments,\n    reblog,\n    uri,\n    url,\n    emojis,\n    // Non-API props\n    _deleted,\n    _pinned,\n    // _filtered,\n  } = status;\n\n  const currentAccount = useMemo(() => {\n    return store.session.get('currentAccount');\n  }, []);\n  const isSelf = useMemo(() => {\n    return currentAccount && currentAccount === accountId;\n  }, [accountId, currentAccount]);\n\n  const filterContext = useContext(FilterContext);\n  const filterInfo =\n    !isSelf && !readOnly && !previewMode && isFiltered(filtered, filterContext);\n\n  if (filterInfo?.action === 'hide') {\n    return null;\n  }\n\n  console.debug('RENDER Status', id, status?.account.displayName, quoted);\n\n  const debugHover = (e) => {\n    if (e.shiftKey) {\n      console.log({\n        ...status,\n      });\n    }\n  };\n\n  if (/*allowFilters && */ size !== 'l' && filterInfo) {\n    return (\n      <FilteredStatus\n        status={status}\n        filterInfo={filterInfo}\n        instance={instance}\n        containerProps={{\n          onMouseEnter: debugHover,\n        }}\n      />\n    );\n  }\n\n  const createdAtDate = new Date(createdAt);\n  const editedAtDate = new Date(editedAt);\n\n  let inReplyToAccountRef = mentions?.find(\n    (mention) => mention.id === inReplyToAccountId,\n  );\n  if (!inReplyToAccountRef && inReplyToAccountId === id) {\n    inReplyToAccountRef = { url: accountURL, username, displayName };\n  }\n  const [inReplyToAccount, setInReplyToAccount] = useState(inReplyToAccountRef);\n  if (!withinContext && !inReplyToAccount && inReplyToAccountId) {\n    const account = states.accounts[inReplyToAccountId];\n    if (account) {\n      setInReplyToAccount(account);\n    } else {\n      memFetchAccount(inReplyToAccountId, masto)\n        .then((account) => {\n          setInReplyToAccount(account);\n          states.accounts[account.id] = account;\n        })\n        .catch((e) => {});\n    }\n  }\n  const mentionSelf =\n    inReplyToAccountId === currentAccount ||\n    mentions?.find((mention) => mention.id === currentAccount);\n\n  const readingExpandSpoilers = useMemo(() => {\n    const prefs = store.account.get('preferences') || {};\n    return !!prefs['reading:expand:spoilers'];\n  }, []);\n  const showSpoiler =\n    previewMode || readingExpandSpoilers || !!snapStates.spoilers[id] || false;\n\n  if (reblog) {\n    // If has statusID, means useItemID (cached in states)\n\n    if (group) {\n      return (\n        <div\n          data-state-post-id={sKey}\n          class=\"status-group\"\n          onMouseEnter={debugHover}\n        >\n          <div class=\"status-pre-meta\">\n            <Icon icon=\"group\" size=\"l\" alt=\"Group\" />{' '}\n            <NameText account={status.account} instance={instance} showAvatar />\n          </div>\n          <Status\n            status={statusID ? null : reblog}\n            statusID={statusID ? reblog.id : null}\n            instance={instance}\n            size={size}\n            contentTextWeight={contentTextWeight}\n            readOnly={readOnly}\n          />\n        </div>\n      );\n    }\n\n    return (\n      <div\n        data-state-post-id={sKey}\n        class=\"status-reblog\"\n        onMouseEnter={debugHover}\n      >\n        <div class=\"status-pre-meta\">\n          <Icon icon=\"rocket\" size=\"l\" />{' '}\n          <NameText account={status.account} instance={instance} showAvatar />{' '}\n          <span>boosted</span>\n        </div>\n        <Status\n          status={statusID ? null : reblog}\n          statusID={statusID ? reblog.id : null}\n          instance={instance}\n          size={size}\n          contentTextWeight={contentTextWeight}\n          readOnly={readOnly}\n          enableCommentHint\n        />\n      </div>\n    );\n  }\n\n  const isSizeLarge = size === 'l';\n\n  const [forceTranslate, setForceTranslate] = useState(_forceTranslate);\n  const targetLanguage = getTranslateTargetLanguage(true);\n  const contentTranslationHideLanguages =\n    snapStates.settings.contentTranslationHideLanguages || [];\n  const { contentTranslation, contentTranslationAutoInline } =\n    snapStates.settings;\n  if (!contentTranslation) enableTranslate = false;\n  const inlineTranslate = useMemo(() => {\n    if (\n      !contentTranslation ||\n      !contentTranslationAutoInline ||\n      readOnly ||\n      (withinContext && !isSizeLarge) ||\n      previewMode ||\n      spoilerText ||\n      sensitive ||\n      poll ||\n      card ||\n      mediaAttachments?.length\n    ) {\n      return false;\n    }\n    const contentLength = htmlContentLength(content);\n    return contentLength > 0 && contentLength <= INLINE_TRANSLATE_LIMIT;\n  }, [\n    contentTranslation,\n    contentTranslationAutoInline,\n    readOnly,\n    withinContext,\n    isSizeLarge,\n    previewMode,\n    spoilerText,\n    sensitive,\n    poll,\n    card,\n    mediaAttachments,\n    content,\n  ]);\n\n  const [showEdited, setShowEdited] = useState(false);\n  const [showReactions, setShowReactions] = useState(false);\n\n  const spoilerContentRef = useTruncated();\n  const contentRef = useTruncated();\n  const mediaContainerRef = useTruncated();\n  const readMoreText = 'Read more →';\n\n  const statusRef = useRef(null);\n\n  const unauthInteractionErrorMessage = `Sorry, your current logged-in instance can't interact with this post from another instance.`;\n\n  const textWeight = useCallback(\n    () =>\n      Math.max(\n        Math.round((spoilerText.length + htmlContentLength(content)) / 140) ||\n          1,\n        1,\n      ),\n    [spoilerText, content],\n  );\n\n  const createdDateText = niceDateTime(createdAtDate);\n  const editedDateText = editedAt && niceDateTime(editedAtDate);\n\n  // Can boost if:\n  // - authenticated AND\n  // - visibility != direct OR\n  // - visibility = private AND isSelf\n  let canBoost =\n    authenticated && visibility !== 'direct' && visibility !== 'private';\n  if (visibility === 'private' && isSelf) {\n    canBoost = true;\n  }\n\n  const replyStatus = (e) => {\n    if (!sameInstance || !authenticated) {\n      return alert(unauthInteractionErrorMessage);\n    }\n    // syntheticEvent comes from MenuItem\n    if (e?.shiftKey || e?.syntheticEvent?.shiftKey) {\n      const newWin = openCompose({\n        replyToStatus: status,\n      });\n      if (newWin) return;\n    }\n    states.showCompose = {\n      replyToStatus: status,\n    };\n  };\n\n  // Check if media has no descriptions\n  const mediaNoDesc = useMemo(() => {\n    return mediaAttachments.some(\n      (attachment) => !attachment.description?.trim?.(),\n    );\n  }, [mediaAttachments]);\n  const boostStatus = async () => {\n    if (!sameInstance || !authenticated) {\n      alert(unauthInteractionErrorMessage);\n      return false;\n    }\n    try {\n      if (!reblogged) {\n        let confirmText = 'Boost this post?';\n        if (mediaNoDesc) {\n          confirmText += '\\n\\n⚠️ Some media have no descriptions.';\n        }\n        const yes = confirm(confirmText);\n        if (!yes) {\n          return false;\n        }\n      }\n      // Optimistic\n      states.statuses[sKey] = {\n        ...status,\n        reblogged: !reblogged,\n        reblogsCount: reblogsCount + (reblogged ? -1 : 1),\n      };\n      if (reblogged) {\n        const newStatus = await masto.v1.statuses.$select(id).unreblog();\n        saveStatus(newStatus, instance);\n        return true;\n      } else {\n        const newStatus = await masto.v1.statuses.$select(id).reblog();\n        saveStatus(newStatus, instance);\n        return true;\n      }\n    } catch (e) {\n      console.error(e);\n      // Revert optimistism\n      states.statuses[sKey] = status;\n      return false;\n    }\n  };\n  const confirmBoostStatus = async () => {\n    if (!sameInstance || !authenticated) {\n      alert(unauthInteractionErrorMessage);\n      return false;\n    }\n    try {\n      // Optimistic\n      states.statuses[sKey] = {\n        ...status,\n        reblogged: !reblogged,\n        reblogsCount: reblogsCount + (reblogged ? -1 : 1),\n      };\n      if (reblogged) {\n        const newStatus = await masto.v1.statuses.$select(id).unreblog();\n        saveStatus(newStatus, instance);\n        return true;\n      } else {\n        const newStatus = await masto.v1.statuses.$select(id).reblog();\n        saveStatus(newStatus, instance);\n        return true;\n      }\n    } catch (e) {\n      console.error(e);\n      // Revert optimistism\n      states.statuses[sKey] = status;\n      return false;\n    }\n  };\n\n  const favouriteStatus = async () => {\n    if (!sameInstance || !authenticated) {\n      return alert(unauthInteractionErrorMessage);\n    }\n    try {\n      // Optimistic\n      states.statuses[sKey] = {\n        ...status,\n        favourited: !favourited,\n        favouritesCount: favouritesCount + (favourited ? -1 : 1),\n      };\n      if (favourited) {\n        const newStatus = await masto.v1.statuses.$select(id).unfavourite();\n        saveStatus(newStatus, instance);\n      } else {\n        const newStatus = await masto.v1.statuses.$select(id).favourite();\n        saveStatus(newStatus, instance);\n      }\n    } catch (e) {\n      console.error(e);\n      // Revert optimistism\n      states.statuses[sKey] = status;\n    }\n  };\n\n  const bookmarkStatus = async () => {\n    if (!sameInstance || !authenticated) {\n      return alert(unauthInteractionErrorMessage);\n    }\n    try {\n      // Optimistic\n      states.statuses[sKey] = {\n        ...status,\n        bookmarked: !bookmarked,\n      };\n      if (bookmarked) {\n        const newStatus = await masto.v1.statuses.$select(id).unbookmark();\n        saveStatus(newStatus, instance);\n      } else {\n        const newStatus = await masto.v1.statuses.$select(id).bookmark();\n        saveStatus(newStatus, instance);\n      }\n    } catch (e) {\n      console.error(e);\n      // Revert optimistism\n      states.statuses[sKey] = status;\n    }\n  };\n\n  const differentLanguage =\n    !!language &&\n    language !== targetLanguage &&\n    !localeMatch([language], [targetLanguage]) &&\n    !contentTranslationHideLanguages.find(\n      (l) => language === l || localeMatch([language], [l]),\n    );\n\n  const menuInstanceRef = useRef();\n  const StatusMenuItems = (\n    <>\n      {!isSizeLarge && (\n        <>\n          <MenuHeader>\n            <span class=\"ib\">\n              <Icon icon={visibilityIconsMap[visibility]} size=\"s\" />{' '}\n              <span>{visibilityText[visibility]}</span>\n            </span>{' '}\n            <span class=\"ib\">\n              {repliesCount > 0 && (\n                <span>\n                  <Icon icon=\"comment2\" alt=\"Replies\" size=\"s\" />{' '}\n                  <span>{shortenNumber(repliesCount)}</span>\n                </span>\n              )}{' '}\n              {reblogsCount > 0 && (\n                <span>\n                  <Icon icon=\"rocket\" alt=\"Boosts\" size=\"s\" />{' '}\n                  <span>{shortenNumber(reblogsCount)}</span>\n                </span>\n              )}{' '}\n              {favouritesCount > 0 && (\n                <span>\n                  <Icon icon=\"heart\" alt=\"Likes\" size=\"s\" />{' '}\n                  <span>{shortenNumber(favouritesCount)}</span>\n                </span>\n              )}\n            </span>\n            <br />\n            {createdDateText}\n          </MenuHeader>\n          <MenuLink\n            to={instance ? `/${instance}/s/${id}` : `/s/${id}`}\n            onClick={(e) => {\n              onStatusLinkClick(e, status);\n            }}\n          >\n            <Icon icon=\"arrow-right\" />\n            <span>View post by @{username || acct}</span>\n          </MenuLink>\n        </>\n      )}\n      {!!editedAt && (\n        <MenuItem\n          onClick={() => {\n            setShowEdited(id);\n          }}\n        >\n          <Icon icon=\"history\" />\n          <span>\n            Show Edit History\n            <br />\n            <small class=\"more-insignificant\">Edited: {editedDateText}</small>\n          </span>\n        </MenuItem>\n      )}\n      {(!isSizeLarge || !!editedAt) && <MenuDivider />}\n      {isSizeLarge && (\n        <MenuItem onClick={() => setShowReactions(true)}>\n          <Icon icon=\"react\" />\n          <span>\n            Boosted/Liked by<span class=\"more-insignificant\">…</span>\n          </span>\n        </MenuItem>\n      )}\n      {!isSizeLarge && sameInstance && (\n        <>\n          <div class=\"menu-horizontal\">\n            <MenuConfirm\n              subMenu\n              confirmLabel={\n                <>\n                  <Icon icon=\"rocket\" />\n                  <span>{reblogged ? 'Unboost?' : 'Boost to everyone?'}</span>\n                </>\n              }\n              menuFooter={\n                mediaNoDesc &&\n                !reblogged && (\n                  <div class=\"footer\">\n                    <Icon icon=\"alert\" />\n                    Some media have no descriptions.\n                  </div>\n                )\n              }\n              disabled={!canBoost}\n              onClick={async () => {\n                try {\n                  const done = await confirmBoostStatus();\n                  if (!isSizeLarge && done) {\n                    showToast(\n                      reblogged\n                        ? `Unboosted @${username || acct}'s post`\n                        : `Boosted @${username || acct}'s post`,\n                    );\n                  }\n                } catch (e) {}\n              }}\n            >\n              <Icon\n                icon=\"rocket\"\n                style={{\n                  color: reblogged && 'var(--reblog-color)',\n                }}\n              />\n              <span>{reblogged ? 'Unboost' : 'Boost…'}</span>\n            </MenuConfirm>\n            <MenuItem\n              onClick={() => {\n                try {\n                  favouriteStatus();\n                  if (!isSizeLarge) {\n                    showToast(\n                      favourited\n                        ? `Unliked @${username || acct}'s post`\n                        : `Liked @${username || acct}'s post`,\n                    );\n                  }\n                } catch (e) {}\n              }}\n            >\n              <Icon\n                icon=\"heart\"\n                style={{\n                  color: favourited && 'var(--favourite-color)',\n                }}\n              />\n              <span>{favourited ? 'Unlike' : 'Like'}</span>\n            </MenuItem>\n          </div>\n          <div class=\"menu-horizontal\">\n            <MenuItem onClick={replyStatus}>\n              <Icon icon=\"reply\" />\n              <span>Reply</span>\n            </MenuItem>\n            <MenuItem\n              onClick={() => {\n                try {\n                  bookmarkStatus();\n                  if (!isSizeLarge) {\n                    showToast(\n                      bookmarked\n                        ? `Unbookmarked @${username || acct}'s post`\n                        : `Bookmarked @${username || acct}'s post`,\n                    );\n                  }\n                } catch (e) {}\n              }}\n            >\n              <Icon\n                icon=\"bookmark\"\n                style={{\n                  color: bookmarked && 'var(--link-color)',\n                }}\n              />\n              <span>{bookmarked ? 'Unbookmark' : 'Bookmark'}</span>\n            </MenuItem>\n          </div>\n        </>\n      )}\n      {enableTranslate ? (\n        <MenuItem\n          disabled={forceTranslate}\n          onClick={() => {\n            setForceTranslate(true);\n          }}\n        >\n          <Icon icon=\"translate\" />\n          <span>Translate</span>\n        </MenuItem>\n      ) : (\n        (!language || differentLanguage) && (\n          <MenuLink\n            to={`${instance ? `/${instance}` : ''}/s/${id}?translate=1`}\n          >\n            <Icon icon=\"translate\" />\n            <span>Translate</span>\n          </MenuLink>\n        )\n      )}\n      {((!isSizeLarge && sameInstance) || enableTranslate) && <MenuDivider />}\n      <MenuItem href={url} target=\"_blank\">\n        <Icon icon=\"external\" />\n        <small class=\"menu-double-lines\">{nicePostURL(url)}</small>\n      </MenuItem>\n      <div class=\"menu-horizontal\">\n        <MenuItem\n          onClick={() => {\n            // Copy url to clipboard\n            try {\n              navigator.clipboard.writeText(url);\n              showToast('Link copied');\n            } catch (e) {\n              console.error(e);\n              showToast('Unable to copy link');\n            }\n          }}\n        >\n          <Icon icon=\"link\" />\n          <span>Copy</span>\n        </MenuItem>\n        {navigator?.share &&\n          navigator?.canShare?.({\n            url,\n          }) && (\n            <MenuItem\n              onClick={() => {\n                try {\n                  navigator.share({\n                    url,\n                  });\n                } catch (e) {\n                  console.error(e);\n                  alert(\"Sharing doesn't seem to work.\");\n                }\n              }}\n            >\n              <Icon icon=\"share\" />\n              <span>Share…</span>\n            </MenuItem>\n          )}\n      </div>\n      {(isSelf || mentionSelf) && <MenuDivider />}\n      {(isSelf || mentionSelf) && (\n        <MenuItem\n          onClick={async () => {\n            try {\n              const newStatus = await masto.v1.statuses\n                .$select(id)\n                [muted ? 'unmute' : 'mute']();\n              saveStatus(newStatus, instance);\n              showToast(muted ? 'Conversation unmuted' : 'Conversation muted');\n            } catch (e) {\n              console.error(e);\n              showToast(\n                muted\n                  ? 'Unable to unmute conversation'\n                  : 'Unable to mute conversation',\n              );\n            }\n          }}\n        >\n          {muted ? (\n            <>\n              <Icon icon=\"unmute\" />\n              <span>Unmute conversation</span>\n            </>\n          ) : (\n            <>\n              <Icon icon=\"mute\" />\n              <span>Mute conversation</span>\n            </>\n          )}\n        </MenuItem>\n      )}\n      {isSelf && (\n        <div class=\"menu-horizontal\">\n          <MenuItem\n            onClick={() => {\n              states.showCompose = {\n                editStatus: status,\n              };\n            }}\n          >\n            <Icon icon=\"pencil\" />\n            <span>Edit</span>\n          </MenuItem>\n          {isSizeLarge && (\n            <MenuConfirm\n              subMenu\n              confirmLabel={\n                <>\n                  <Icon icon=\"trash\" />\n                  <span>Delete this post?</span>\n                </>\n              }\n              menuItemClassName=\"danger\"\n              onClick={() => {\n                // const yes = confirm('Delete this post?');\n                // if (yes) {\n                (async () => {\n                  try {\n                    await masto.v1.statuses.$select(id).remove();\n                    const cachedStatus = getStatus(id, instance);\n                    cachedStatus._deleted = true;\n                    showToast('Deleted');\n                  } catch (e) {\n                    console.error(e);\n                    showToast('Unable to delete');\n                  }\n                })();\n                // }\n              }}\n            >\n              <Icon icon=\"trash\" />\n              <span>Delete…</span>\n            </MenuConfirm>\n          )}\n        </div>\n      )}\n    </>\n  );\n\n  const contextMenuRef = useRef();\n  const [isContextMenuOpen, setIsContextMenuOpen] = useState(false);\n  const [contextMenuProps, setContextMenuProps] = useState({});\n\n  const showContextMenu = !isSizeLarge && !previewMode && !_deleted && !quoted;\n\n  // Only iOS/iPadOS browsers don't support contextmenu\n  // Some comments report iPadOS might support contextmenu if a mouse is connected\n  const bindLongPressContext = useLongPress(\n    isIOS && showContextMenu\n      ? (e) => {\n          if (e.pointerType === 'mouse') return;\n          // There's 'pen' too, but not sure if contextmenu event would trigger from a pen\n\n          const { clientX, clientY } = e.touches?.[0] || e;\n          // link detection copied from onContextMenu because here it works\n          const link = e.target.closest('a');\n          if (link && /^https?:\\/\\//.test(link.getAttribute('href'))) return;\n          e.preventDefault();\n          setContextMenuProps({\n            anchorPoint: {\n              x: clientX,\n              y: clientY,\n            },\n            direction: 'right',\n          });\n          setIsContextMenuOpen(true);\n        }\n      : null,\n    {\n      threshold: 600,\n      captureEvent: true,\n      detect: 'touch',\n      cancelOnMovement: 2, // true allows movement of up to 25 pixels\n    },\n  );\n\n  const hotkeysEnabled = !readOnly && !previewMode;\n  const rRef = useHotkeys('r, shift+r', replyStatus, {\n    enabled: hotkeysEnabled,\n  });\n  const fRef = useHotkeys(\n    'f, l',\n    () => {\n      try {\n        favouriteStatus();\n        if (!isSizeLarge) {\n          showToast(\n            favourited\n              ? `Unliked @${username || acct}'s post`\n              : `Liked @${username || acct}'s post`,\n          );\n        }\n      } catch (e) {}\n    },\n    {\n      enabled: hotkeysEnabled,\n    },\n  );\n  const dRef = useHotkeys(\n    'd',\n    () => {\n      try {\n        bookmarkStatus();\n        if (!isSizeLarge) {\n          showToast(\n            bookmarked\n              ? `Unbookmarked @${username || acct}'s post`\n              : `Bookmarked @${username || acct}'s post`,\n          );\n        }\n      } catch (e) {}\n    },\n    {\n      enabled: hotkeysEnabled,\n    },\n  );\n  const bRef = useHotkeys(\n    'shift+b',\n    () => {\n      (async () => {\n        try {\n          const done = await confirmBoostStatus();\n          if (!isSizeLarge && done) {\n            showToast(\n              reblogged\n                ? `Unboosted @${username || acct}'s post`\n                : `Boosted @${username || acct}'s post`,\n            );\n          }\n        } catch (e) {}\n      })();\n    },\n    {\n      enabled: hotkeysEnabled && canBoost,\n    },\n  );\n\n  const displayedMediaAttachments = mediaAttachments.slice(\n    0,\n    isSizeLarge ? undefined : 4,\n  );\n  const showMultipleMediaCaptions =\n    mediaAttachments.length > 1 &&\n    displayedMediaAttachments.some(\n      (media) => !!media.description && !isMediaCaptionLong(media.description),\n    );\n  const captionChildren = useMemo(() => {\n    if (!showMultipleMediaCaptions) return null;\n    const attachments = [];\n    displayedMediaAttachments.forEach((media, i) => {\n      if (!media.description) return;\n      const index = attachments.findIndex(\n        (attachment) => attachment.media.description === media.description,\n      );\n      if (index === -1) {\n        attachments.push({\n          media,\n          indices: [i],\n        });\n      } else {\n        attachments[index].indices.push(i);\n      }\n    });\n    return attachments.map(({ media, indices }) => (\n      <div\n        key={media.id}\n        data-caption-index={indices.map((i) => i + 1).join(' ')}\n        onClick={(e) => {\n          e.preventDefault();\n          e.stopPropagation();\n          states.showMediaAlt = {\n            alt: media.description,\n            lang: language,\n          };\n        }}\n        title={media.description}\n      >\n        <sup>{indices.map((i) => i + 1).join(' ')}</sup> {media.description}\n      </div>\n    ));\n\n    // return displayedMediaAttachments.map(\n    //   (media, i) =>\n    //     !!media.description && (\n    //       <div\n    //         key={media.id}\n    //         data-caption-index={i + 1}\n    //         onClick={(e) => {\n    //           e.preventDefault();\n    //           e.stopPropagation();\n    //           states.showMediaAlt = {\n    //             alt: media.description,\n    //             lang: language,\n    //           };\n    //         }}\n    //         title={media.description}\n    //       >\n    //         <sup>{i + 1}</sup> {media.description}\n    //       </div>\n    //     ),\n    // );\n  }, [showMultipleMediaCaptions, displayedMediaAttachments, language]);\n\n  const isThread = useMemo(() => {\n    return (\n      (!!inReplyToId && inReplyToAccountId === status.account?.id) ||\n      !!snapStates.statusThreadNumber[sKey]\n    );\n  }, [\n    inReplyToId,\n    inReplyToAccountId,\n    status.account?.id,\n    snapStates.statusThreadNumber[sKey],\n  ]);\n\n  const showCommentHint = useMemo(() => {\n    return (\n      enableCommentHint &&\n      !isThread &&\n      !withinContext &&\n      !inReplyToId &&\n      visibility === 'public' &&\n      repliesCount > 0\n    );\n  }, [\n    enableCommentHint,\n    isThread,\n    withinContext,\n    inReplyToId,\n    repliesCount,\n    visibility,\n  ]);\n\n  return (\n    <article\n      data-state-post-id={sKey}\n      ref={(node) => {\n        statusRef.current = node;\n        // Use parent node if it's in focus\n        // Use case: <a><status /></a>\n        // When navigating (j/k), the <a> is focused instead of <status />\n        // Hotkey binding doesn't bubble up thus this hack\n        const nodeRef =\n          node?.closest?.(\n            '.timeline-item, .timeline-item-alt, .status-link, .status-focus',\n          ) || node;\n        rRef.current = nodeRef;\n        fRef.current = nodeRef;\n        dRef.current = nodeRef;\n        bRef.current = nodeRef;\n      }}\n      tabindex=\"-1\"\n      class={`status ${\n        !withinContext && inReplyToId && inReplyToAccount\n          ? 'status-reply-to'\n          : ''\n      } visibility-${visibility} ${_pinned ? 'status-pinned' : ''} ${\n        {\n          s: 'small',\n          m: 'medium',\n          l: 'large',\n        }[size]\n      } ${_deleted ? 'status-deleted' : ''} ${quoted ? 'status-card' : ''}`}\n      onMouseEnter={debugHover}\n      onContextMenu={(e) => {\n        // FIXME: this code isn't getting called on Chrome at all?\n        if (!showContextMenu) return;\n        if (e.metaKey) return;\n        // console.log('context menu', e);\n        const link = e.target.closest('a');\n        if (link && /^https?:\\/\\//.test(link.getAttribute('href'))) return;\n        e.preventDefault();\n        setContextMenuProps({\n          anchorPoint: {\n            x: e.clientX,\n            y: e.clientY,\n          },\n          direction: 'right',\n        });\n        setIsContextMenuOpen(true);\n      }}\n      {...(showContextMenu ? bindLongPressContext() : {})}\n    >\n      {showContextMenu && (\n        <ControlledMenu\n          ref={contextMenuRef}\n          state={isContextMenuOpen ? 'open' : undefined}\n          {...contextMenuProps}\n          onClose={(e) => {\n            setIsContextMenuOpen(false);\n            // statusRef.current?.focus?.();\n            if (e?.reason === 'click') {\n              statusRef.current?.closest('[tabindex]')?.focus?.();\n            }\n          }}\n          portal={{\n            target: document.body,\n          }}\n          containerProps={{\n            style: {\n              // Higher than the backdrop\n              zIndex: 1001,\n            },\n            onClick: () => {\n              contextMenuRef.current?.closeMenu?.();\n            },\n          }}\n          overflow=\"auto\"\n          boundingBoxPadding={safeBoundingBoxPadding()}\n          unmountOnClose\n        >\n          {StatusMenuItems}\n        </ControlledMenu>\n      )}\n      {size !== 'l' && (\n        <div class=\"status-badge\">\n          {reblogged && <Icon class=\"reblog\" icon=\"rocket\" size=\"s\" />}\n          {favourited && <Icon class=\"favourite\" icon=\"heart\" size=\"s\" />}\n          {bookmarked && <Icon class=\"bookmark\" icon=\"bookmark\" size=\"s\" />}\n          {_pinned && <Icon class=\"pin\" icon=\"pin\" size=\"s\" />}\n        </div>\n      )}\n      {size !== 's' && (\n        <a\n          href={accountURL}\n          tabindex=\"-1\"\n          // target=\"_blank\"\n          title={`@${acct}`}\n          onClick={(e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            states.showAccount = {\n              account: status.account,\n              instance,\n            };\n          }}\n        >\n          <Avatar url={avatarStatic || avatar} size=\"xxl\" squircle={bot} />\n        </a>\n      )}\n      <div class=\"container\">\n        <div class=\"meta\">\n          <span class=\"meta-name\">\n            <NameText\n              account={status.account}\n              instance={instance}\n              showAvatar={size === 's'}\n              showAcct={isSizeLarge}\n            />\n          </span>\n          {/* {inReplyToAccount && !withinContext && size !== 's' && (\n              <>\n                {' '}\n                <span class=\"ib\">\n                  <Icon icon=\"arrow-right\" class=\"arrow\" />{' '}\n                  <NameText account={inReplyToAccount} instance={instance} short />\n                </span>\n              </>\n            )} */}\n          {/* </span> */}{' '}\n          {size !== 'l' &&\n            (_deleted ? (\n              <span class=\"status-deleted-tag\">Deleted</span>\n            ) : url && !previewMode && !quoted ? (\n              <Link\n                to={instance ? `/${instance}/s/${id}` : `/s/${id}`}\n                onClick={(e) => {\n                  if (\n                    e.metaKey ||\n                    e.ctrlKey ||\n                    e.shiftKey ||\n                    e.altKey ||\n                    e.which === 2\n                  ) {\n                    return;\n                  }\n                  e.preventDefault();\n                  e.stopPropagation();\n                  onStatusLinkClick?.(e, status);\n                  setContextMenuProps({\n                    anchorRef: {\n                      current: e.currentTarget,\n                    },\n                    align: 'end',\n                    direction: 'bottom',\n                    gap: 4,\n                  });\n                  setIsContextMenuOpen(true);\n                }}\n                class={`time ${\n                  isContextMenuOpen && contextMenuProps?.anchorRef\n                    ? 'is-open'\n                    : ''\n                }`}\n              >\n                {showCommentHint ? (\n                  <Icon\n                    icon=\"comment2\"\n                    size=\"s\"\n                    alt={`${repliesCount} ${\n                      repliesCount === 1 ? 'reply' : 'replies'\n                    }`}\n                  />\n                ) : (\n                  <Icon\n                    icon={visibilityIconsMap[visibility]}\n                    alt={visibilityText[visibility]}\n                    size=\"s\"\n                  />\n                )}{' '}\n                <RelativeTime datetime={createdAtDate} format=\"micro\" />\n              </Link>\n            ) : (\n              // <Menu\n              //   instanceRef={menuInstanceRef}\n              //   portal={{\n              //     target: document.body,\n              //   }}\n              //   containerProps={{\n              //     style: {\n              //       // Higher than the backdrop\n              //       zIndex: 1001,\n              //     },\n              //     onClick: (e) => {\n              //       if (e.target === e.currentTarget)\n              //         menuInstanceRef.current?.closeMenu?.();\n              //     },\n              //   }}\n              //   align=\"end\"\n              //   gap={4}\n              //   overflow=\"auto\"\n              //   viewScroll=\"close\"\n              //   boundingBoxPadding=\"8 8 8 8\"\n              //   unmountOnClose\n              //   menuButton={({ open }) => (\n              //     <Link\n              //       to={instance ? `/${instance}/s/${id}` : `/s/${id}`}\n              //       onClick={(e) => {\n              //         e.preventDefault();\n              //         e.stopPropagation();\n              //         onStatusLinkClick?.(e, status);\n              //       }}\n              //       class={`time ${open ? 'is-open' : ''}`}\n              //     >\n              //       <Icon\n              //         icon={visibilityIconsMap[visibility]}\n              //         alt={visibilityText[visibility]}\n              //         size=\"s\"\n              //       />{' '}\n              //       <RelativeTime datetime={createdAtDate} format=\"micro\" />\n              //     </Link>\n              //   )}\n              // >\n              //   {StatusMenuItems}\n              // </Menu>\n              <span class=\"time\">\n                <Icon\n                  icon={visibilityIconsMap[visibility]}\n                  alt={visibilityText[visibility]}\n                  size=\"s\"\n                />{' '}\n                <RelativeTime datetime={createdAtDate} format=\"micro\" />\n              </span>\n            ))}\n        </div>\n        {visibility === 'direct' && (\n          <>\n            <div class=\"status-direct-badge\">Private mention</div>{' '}\n          </>\n        )}\n        {!withinContext && (\n          <>\n            {isThread ? (\n              <div class=\"status-thread-badge\">\n                <Icon icon=\"thread\" size=\"s\" />\n                Thread\n                {snapStates.statusThreadNumber[sKey]\n                  ? ` ${snapStates.statusThreadNumber[sKey]}/X`\n                  : ''}\n              </div>\n            ) : (\n              !!inReplyToId &&\n              !!inReplyToAccount &&\n              (!!spoilerText ||\n                !mentions.find((mention) => {\n                  return mention.id === inReplyToAccountId;\n                })) && (\n                <div class=\"status-reply-badge\">\n                  <Icon icon=\"reply\" />{' '}\n                  <NameText\n                    account={inReplyToAccount}\n                    instance={instance}\n                    short\n                  />\n                </div>\n              )\n            )}\n          </>\n        )}\n        <div\n          class={`content-container ${\n            spoilerText || sensitive ? 'has-spoiler' : ''\n          } ${showSpoiler ? 'show-spoiler' : ''}`}\n          data-content-text-weight={contentTextWeight ? textWeight() : null}\n          style={\n            (isSizeLarge || contentTextWeight) && {\n              '--content-text-weight': textWeight(),\n            }\n          }\n        >\n          {!!spoilerText && (\n            <>\n              <div\n                class=\"content spoiler-content\"\n                lang={language}\n                dir=\"auto\"\n                ref={spoilerContentRef}\n                data-read-more={readMoreText}\n              >\n                <p>\n                  <EmojiText text={spoilerText} emojis={emojis} />\n                </p>\n              </div>\n              <button\n                class={`light spoiler ${showSpoiler ? 'spoiling' : ''}`}\n                type=\"button\"\n                disabled={readingExpandSpoilers}\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  if (showSpoiler) {\n                    delete states.spoilers[id];\n                  } else {\n                    states.spoilers[id] = true;\n                  }\n                }}\n              >\n                <Icon icon={showSpoiler ? 'eye-open' : 'eye-close'} />{' '}\n                {readingExpandSpoilers\n                  ? 'Content warning'\n                  : showSpoiler\n                  ? 'Show less'\n                  : 'Show more'}\n              </button>\n            </>\n          )}\n          <div class=\"content\" ref={contentRef} data-read-more={readMoreText}>\n            <div\n              lang={language}\n              dir=\"auto\"\n              class=\"inner-content\"\n              onClick={handleContentLinks({\n                mentions,\n                instance,\n                previewMode,\n                statusURL: url,\n              })}\n              dangerouslySetInnerHTML={{\n                __html: enhanceContent(content, {\n                  emojis,\n                  postEnhanceDOM: (dom) => {\n                    // Remove target=\"_blank\" from links\n                    dom\n                      .querySelectorAll('a.u-url[target=\"_blank\"]')\n                      .forEach((a) => {\n                        if (!/http/i.test(a.innerText.trim())) {\n                          a.removeAttribute('target');\n                        }\n                      });\n                    if (previewMode) return;\n                    // Unfurl Mastodon links\n                    Array.from(\n                      dom.querySelectorAll(\n                        'a[href]:not(.u-url):not(.mention):not(.hashtag)',\n                      ),\n                    )\n                      .filter((a) => {\n                        const url = a.href;\n                        const isPostItself =\n                          url === status.url || url === status.uri;\n                        return !isPostItself && isMastodonLinkMaybe(url);\n                      })\n                      .forEach((a, i) => {\n                        unfurlMastodonLink(currentInstance, a.href).then(\n                          (result) => {\n                            if (!result) return;\n                            a.removeAttribute('target');\n                            if (!sKey) return;\n                            if (!Array.isArray(states.statusQuotes[sKey])) {\n                              states.statusQuotes[sKey] = [];\n                            }\n                            if (!states.statusQuotes[sKey][i]) {\n                              states.statusQuotes[sKey].splice(i, 0, result);\n                            }\n                          },\n                        );\n                      });\n                  },\n                }),\n              }}\n            />\n            <QuoteStatuses id={id} instance={instance} level={quoted} />\n          </div>\n          {!!poll && (\n            <Poll\n              lang={language}\n              poll={poll}\n              readOnly={readOnly || !sameInstance || !authenticated}\n              onUpdate={(newPoll) => {\n                states.statuses[sKey].poll = newPoll;\n              }}\n              refresh={() => {\n                return masto.v1.polls\n                  .$select(poll.id)\n                  .fetch()\n                  .then((pollResponse) => {\n                    states.statuses[sKey].poll = pollResponse;\n                  })\n                  .catch((e) => {}); // Silently fail\n              }}\n              votePoll={(choices) => {\n                return masto.v1.polls\n                  .$select(poll.id)\n                  .votes.create({\n                    choices,\n                  })\n                  .then((pollResponse) => {\n                    states.statuses[sKey].poll = pollResponse;\n                  })\n                  .catch((e) => {}); // Silently fail\n              }}\n            />\n          )}\n          {(((enableTranslate || inlineTranslate) &&\n            !!content.trim() &&\n            !!getHTMLText(emojifyText(content, emojis)) &&\n            differentLanguage) ||\n            forceTranslate) && (\n            <TranslationBlock\n              forceTranslate={forceTranslate || inlineTranslate}\n              mini={!isSizeLarge && !withinContext}\n              sourceLanguage={language}\n              text={\n                (spoilerText ? `${spoilerText}\\n\\n` : '') +\n                getHTMLText(content) +\n                (poll?.options?.length\n                  ? `\\n\\nPoll:\\n${poll.options\n                      .map(\n                        (option) =>\n                          `- ${option.title}${\n                            option.votesCount >= 0\n                              ? ` (${option.votesCount})`\n                              : ''\n                          }`,\n                      )\n                      .join('\\n')}`\n                  : '')\n              }\n            />\n          )}\n          {!spoilerText && sensitive && !!mediaAttachments.length && (\n            <button\n              class={`plain spoiler ${showSpoiler ? 'spoiling' : ''}`}\n              type=\"button\"\n              onClick={(e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                if (showSpoiler) {\n                  delete states.spoilers[id];\n                } else {\n                  states.spoilers[id] = true;\n                }\n              }}\n            >\n              <Icon icon={showSpoiler ? 'eye-open' : 'eye-close'} /> Sensitive\n              content\n            </button>\n          )}\n          {!!mediaAttachments.length && (\n            <MultipleMediaFigure\n              lang={language}\n              enabled={showMultipleMediaCaptions}\n              captionChildren={captionChildren}\n            >\n              <div\n                ref={mediaContainerRef}\n                class={`media-container media-eq${mediaAttachments.length} ${\n                  mediaAttachments.length > 2 ? 'media-gt2' : ''\n                } ${mediaAttachments.length > 4 ? 'media-gt4' : ''}`}\n              >\n                {displayedMediaAttachments.map((media, i) => (\n                  <Media\n                    key={media.id}\n                    media={media}\n                    autoAnimate={isSizeLarge}\n                    showCaption={mediaAttachments.length === 1}\n                    lang={language}\n                    altIndex={\n                      showMultipleMediaCaptions && !!media.description && i + 1\n                    }\n                    to={`/${instance}/s/${id}?${\n                      withinContext ? 'media' : 'media-only'\n                    }=${i + 1}`}\n                    onClick={\n                      onMediaClick\n                        ? (e) => {\n                            onMediaClick(e, i, media, status);\n                          }\n                        : undefined\n                    }\n                  />\n                ))}\n              </div>\n            </MultipleMediaFigure>\n          )}\n          {!!card &&\n            card?.url !== status.url &&\n            card?.url !== status.uri &&\n            /^https/i.test(card?.url) &&\n            !sensitive &&\n            !spoilerText &&\n            !poll &&\n            !mediaAttachments.length &&\n            !snapStates.statusQuotes[sKey] && (\n              <Card card={card} instance={currentInstance} />\n            )}\n        </div>\n        {isSizeLarge && (\n          <>\n            <div class=\"extra-meta\">\n              {_deleted ? (\n                <span class=\"status-deleted-tag\">Deleted</span>\n              ) : (\n                <>\n                  <Icon\n                    icon={visibilityIconsMap[visibility]}\n                    alt={visibilityText[visibility]}\n                  />{' '}\n                  <a href={url} target=\"_blank\" rel=\"noopener noreferrer\">\n                    <time\n                      class=\"created\"\n                      datetime={createdAtDate.toISOString()}\n                    >\n                      {createdDateText}\n                    </time>\n                  </a>\n                  {editedAt && (\n                    <>\n                      {' '}\n                      &bull; <Icon icon=\"pencil\" alt=\"Edited\" />{' '}\n                      <time\n                        tabIndex=\"0\"\n                        class=\"edited\"\n                        datetime={editedAtDate.toISOString()}\n                        onClick={() => {\n                          setShowEdited(id);\n                        }}\n                      >\n                        {editedDateText}\n                      </time>\n                    </>\n                  )}\n                </>\n              )}\n            </div>\n            <div class={`actions ${_deleted ? 'disabled' : ''}`}>\n              <div class=\"action has-count\">\n                <StatusButton\n                  title=\"Reply\"\n                  alt=\"Comments\"\n                  class=\"reply-button\"\n                  icon=\"comment\"\n                  count={repliesCount}\n                  onClick={replyStatus}\n                />\n              </div>\n              {/* <div class=\"action has-count\">\n                <StatusButton\n                  checked={reblogged}\n                  title={['Boost', 'Unboost']}\n                  alt={['Boost', 'Boosted']}\n                  class=\"reblog-button\"\n                  icon=\"rocket\"\n                  count={reblogsCount}\n                  onClick={boostStatus}\n                  disabled={!canBoost}\n                />\n              </div> */}\n              <MenuConfirm\n                disabled={!canBoost}\n                onClick={confirmBoostStatus}\n                confirmLabel={\n                  <>\n                    <Icon icon=\"rocket\" />\n                    <span>{reblogged ? 'Unboost?' : 'Boost to everyone?'}</span>\n                  </>\n                }\n                menuFooter={\n                  mediaNoDesc &&\n                  !reblogged && (\n                    <div class=\"footer\">\n                      <Icon icon=\"alert\" />\n                      Some media have no descriptions.\n                    </div>\n                  )\n                }\n              >\n                <div class=\"action has-count\">\n                  <StatusButton\n                    checked={reblogged}\n                    title={['Boost', 'Unboost']}\n                    alt={['Boost', 'Boosted']}\n                    class=\"reblog-button\"\n                    icon=\"rocket\"\n                    count={reblogsCount}\n                    // onClick={boostStatus}\n                    disabled={!canBoost}\n                  />\n                </div>\n              </MenuConfirm>\n              <div class=\"action has-count\">\n                <StatusButton\n                  checked={favourited}\n                  title={['Like', 'Unlike']}\n                  alt={['Like', 'Liked']}\n                  class=\"favourite-button\"\n                  icon=\"heart\"\n                  count={favouritesCount}\n                  onClick={favouriteStatus}\n                />\n              </div>\n              <div class=\"action\">\n                <StatusButton\n                  checked={bookmarked}\n                  title={['Bookmark', 'Unbookmark']}\n                  alt={['Bookmark', 'Bookmarked']}\n                  class=\"bookmark-button\"\n                  icon=\"bookmark\"\n                  onClick={bookmarkStatus}\n                />\n              </div>\n              <Menu\n                portal={{\n                  target:\n                    document.querySelector('.status-deck') || document.body,\n                }}\n                align=\"end\"\n                gap={4}\n                overflow=\"auto\"\n                viewScroll=\"close\"\n                boundingBoxPadding=\"8 8 8 8\"\n                menuButton={\n                  <div class=\"action\">\n                    <button\n                      type=\"button\"\n                      title=\"More\"\n                      class=\"plain more-button\"\n                    >\n                      <Icon icon=\"more\" size=\"l\" alt=\"More\" />\n                    </button>\n                  </div>\n                }\n              >\n                {StatusMenuItems}\n              </Menu>\n            </div>\n          </>\n        )}\n      </div>\n      {!!showEdited && (\n        <Modal\n          class=\"light\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowEdited(false);\n              // statusRef.current?.focus();\n            }\n          }}\n        >\n          <EditedAtModal\n            statusID={showEdited}\n            instance={instance}\n            fetchStatusHistory={() => {\n              return masto.v1.statuses.$select(showEdited).history.list();\n            }}\n            onClose={() => {\n              setShowEdited(false);\n              statusRef.current?.focus();\n            }}\n          />\n        </Modal>\n      )}\n      {showReactions && (\n        <Modal\n          class=\"light\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowReactions(false);\n            }\n          }}\n        >\n          <ReactionsModal\n            statusID={id}\n            instance={instance}\n            onClose={() => setShowReactions(false)}\n          />\n        </Modal>\n      )}\n    </article>\n  );\n}\n\nfunction MultipleMediaFigure(props) {\n  const { enabled, children, lang, captionChildren } = props;\n  if (!enabled || !captionChildren) return children;\n  return (\n    <figure class=\"media-figure-multiple\">\n      {children}\n      <figcaption lang={lang} dir=\"auto\">\n        {captionChildren}\n      </figcaption>\n    </figure>\n  );\n}\n\nfunction Card({ card, instance }) {\n  const snapStates = useSnapshot(states);\n  const {\n    blurhash,\n    title,\n    description,\n    html,\n    providerName,\n    providerUrl,\n    authorName,\n    authorUrl,\n    width,\n    height,\n    image,\n    imageDescription,\n    url,\n    type,\n    embedUrl,\n    language,\n    publishedAt,\n  } = card;\n\n  /* type\n  link = Link OEmbed\n  photo = Photo OEmbed\n  video = Video OEmbed\n  rich = iframe OEmbed. Not currently accepted, so won’t show up in practice.\n  */\n\n  const hasText = title || providerName || authorName;\n  const isLandscape = width / height >= 1.2;\n  const size = isLandscape ? 'large' : '';\n\n  const [cardStatusURL, setCardStatusURL] = useState(null);\n  // const [cardStatusID, setCardStatusID] = useState(null);\n  useEffect(() => {\n    if (hasText && image && isMastodonLinkMaybe(url)) {\n      unfurlMastodonLink(instance, url).then((result) => {\n        if (!result) return;\n        const { id, url } = result;\n        setCardStatusURL('#' + url);\n\n        // NOTE: This is for quote post\n        // (async () => {\n        //   const { masto } = api({ instance });\n        //   const status = await masto.v1.statuses.$select(id).fetch();\n        //   saveStatus(status, instance);\n        //   setCardStatusID(id);\n        // })();\n      });\n    }\n  }, [hasText, image]);\n\n  // if (cardStatusID) {\n  //   return (\n  //     <Status statusID={cardStatusID} instance={instance} size=\"s\" readOnly />\n  //   );\n  // }\n\n  if (snapStates.unfurledLinks[url]) return null;\n\n  if (hasText && (image || (type === 'photo' && blurhash))) {\n    const domain = new URL(url).hostname\n      .replace(/^www\\./, '')\n      .replace(/\\/$/, '');\n    let blurhashImage;\n    if (!image) {\n      const w = 44;\n      const h = 44;\n      const blurhashPixels = decodeBlurHash(blurhash, w, h);\n      const canvas = document.createElement('canvas');\n      canvas.width = w;\n      canvas.height = h;\n      const ctx = canvas.getContext('2d');\n      const imageData = ctx.createImageData(w, h);\n      imageData.data.set(blurhashPixels);\n      ctx.putImageData(imageData, 0, 0);\n      blurhashImage = canvas.toDataURL();\n    }\n    return (\n      <a\n        href={cardStatusURL || url}\n        target={cardStatusURL ? null : '_blank'}\n        rel=\"nofollow noopener noreferrer\"\n        class={`card link ${blurhashImage ? '' : size}`}\n        lang={language}\n        dir=\"auto\"\n      >\n        <div class=\"card-image\">\n          <img\n            src={image || blurhashImage}\n            width={width}\n            height={height}\n            loading=\"lazy\"\n            alt={imageDescription || ''}\n            onError={(e) => {\n              try {\n                e.target.style.display = 'none';\n              } catch (e) {}\n            }}\n          />\n        </div>\n        <div class=\"meta-container\">\n          <p class=\"meta domain\" dir=\"auto\">\n            {domain}\n          </p>\n          <p class=\"title\" dir=\"auto\">\n            {title}\n          </p>\n          <p class=\"meta\" dir=\"auto\">\n            {description ||\n              (!!publishedAt && (\n                <RelativeTime datetime={publishedAt} format=\"micro\" />\n              ))}\n          </p>\n        </div>\n      </a>\n    );\n  } else if (type === 'photo') {\n    return (\n      <a\n        href={url}\n        target=\"_blank\"\n        rel=\"nofollow noopener noreferrer\"\n        class=\"card photo\"\n      >\n        <img\n          src={embedUrl}\n          width={width}\n          height={height}\n          alt={title || description}\n          loading=\"lazy\"\n          style={{\n            height: 'auto',\n            aspectRatio: `${width}/${height}`,\n          }}\n        />\n      </a>\n    );\n  } else if (type === 'video') {\n    if (/youtube/i.test(providerName)) {\n      // Get ID from e.g. https://www.youtube.com/watch?v=[VIDEO_ID]\n      const videoID = url.match(/watch\\?v=([^&]+)/)?.[1];\n      if (videoID) {\n        return <lite-youtube videoid={videoID} nocookie></lite-youtube>;\n      }\n    }\n    return (\n      <div\n        class=\"card video\"\n        style={{\n          aspectRatio: `${width}/${height}`,\n        }}\n        dangerouslySetInnerHTML={{ __html: html }}\n      />\n    );\n  } else if (hasText && !image) {\n    const domain = new URL(url).hostname.replace(/^www\\./, '');\n    return (\n      <a\n        href={cardStatusURL || url}\n        target={cardStatusURL ? null : '_blank'}\n        rel=\"nofollow noopener noreferrer\"\n        class={`card link no-image`}\n        lang={language}\n      >\n        <div class=\"meta-container\">\n          <p class=\"meta domain\">\n            <Icon icon=\"link\" size=\"s\" /> <span>{domain}</span>\n          </p>\n          <p class=\"title\">{title}</p>\n          <p class=\"meta\">{description || providerName || authorName}</p>\n        </div>\n      </a>\n    );\n  }\n}\n\nfunction EditedAtModal({\n  statusID,\n  instance,\n  fetchStatusHistory = () => {},\n  onClose,\n}) {\n  const [uiState, setUIState] = useState('default');\n  const [editHistory, setEditHistory] = useState([]);\n\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const editHistory = await fetchStatusHistory();\n        console.log(editHistory);\n        setEditHistory(editHistory);\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }, []);\n\n  return (\n    <div id=\"edit-history\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" />\n        </button>\n      )}\n      <header>\n        <h2>Edit History</h2>\n        {uiState === 'error' && <p>Failed to load history</p>}\n        {uiState === 'loading' && (\n          <p>\n            <Loader abrupt /> Loading&hellip;\n          </p>\n        )}\n      </header>\n      <main tabIndex=\"-1\">\n        {editHistory.length > 0 && (\n          <ol>\n            {editHistory.map((status) => {\n              const { createdAt } = status;\n              const createdAtDate = new Date(createdAt);\n              return (\n                <li key={createdAt} class=\"history-item\">\n                  <h3>\n                    <time>\n                      {niceDateTime(createdAtDate, {\n                        formatOpts: {\n                          weekday: 'short',\n                          second: 'numeric',\n                        },\n                      })}\n                    </time>\n                  </h3>\n                  <Status\n                    status={status}\n                    instance={instance}\n                    size=\"s\"\n                    withinContext\n                    readOnly\n                    previewMode\n                  />\n                </li>\n              );\n            })}\n          </ol>\n        )}\n      </main>\n    </div>\n  );\n}\n\nconst REACTIONS_LIMIT = 80;\nfunction ReactionsModal({ statusID, instance, onClose }) {\n  const { masto } = api({ instance });\n  const [uiState, setUIState] = useState('default');\n  const [accounts, setAccounts] = useState([]);\n  const [showMore, setShowMore] = useState(false);\n\n  const reblogIterator = useRef();\n  const favouriteIterator = useRef();\n\n  async function fetchAccounts(firstLoad) {\n    setShowMore(false);\n    setUIState('loading');\n    (async () => {\n      try {\n        if (firstLoad) {\n          reblogIterator.current = masto.v1.statuses\n            .$select(statusID)\n            .rebloggedBy.list({\n              limit: REACTIONS_LIMIT,\n            });\n          favouriteIterator.current = masto.v1.statuses\n            .$select(statusID)\n            .favouritedBy.list({\n              limit: REACTIONS_LIMIT,\n            });\n        }\n        const [{ value: reblogResults }, { value: favouriteResults }] =\n          await Promise.allSettled([\n            reblogIterator.current.next(),\n            favouriteIterator.current.next(),\n          ]);\n        if (reblogResults.value?.length || favouriteResults.value?.length) {\n          if (reblogResults.value?.length) {\n            for (const account of reblogResults.value) {\n              const theAccount = accounts.find((a) => a.id === account.id);\n              if (!theAccount) {\n                accounts.push({\n                  ...account,\n                  _types: ['reblog'],\n                });\n              } else {\n                theAccount._types.push('reblog');\n              }\n            }\n          }\n          if (favouriteResults.value?.length) {\n            for (const account of favouriteResults.value) {\n              const theAccount = accounts.find((a) => a.id === account.id);\n              if (!theAccount) {\n                accounts.push({\n                  ...account,\n                  _types: ['favourite'],\n                });\n              } else {\n                theAccount._types.push('favourite');\n              }\n            }\n          }\n          setAccounts(accounts);\n          setShowMore(!reblogResults.done || !favouriteResults.done);\n        } else {\n          setShowMore(false);\n        }\n        setUIState('default');\n      } catch (e) {\n        console.error(e);\n        setUIState('error');\n      }\n    })();\n  }\n\n  useEffect(() => {\n    fetchAccounts(true);\n  }, []);\n\n  return (\n    <div id=\"reactions-container\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" />\n        </button>\n      )}\n      <header>\n        <h2>Boosted/Liked by…</h2>\n      </header>\n      <main>\n        {accounts.length > 0 ? (\n          <>\n            <ul class=\"reactions-list\">\n              {accounts.map((account) => {\n                const { _types } = account;\n                return (\n                  <li key={account.id + _types}>\n                    <div class=\"reactions-block\">\n                      {_types.map((type) => (\n                        <Icon\n                          icon={\n                            {\n                              reblog: 'rocket',\n                              favourite: 'heart',\n                            }[type]\n                          }\n                          class={`${type}-icon`}\n                        />\n                      ))}\n                    </div>\n                    <AccountBlock account={account} instance={instance} />\n                  </li>\n                );\n              })}\n            </ul>\n            {uiState === 'default' ? (\n              showMore ? (\n                <InView\n                  onChange={(inView) => {\n                    if (inView) {\n                      fetchAccounts();\n                    }\n                  }}\n                >\n                  <button\n                    type=\"button\"\n                    class=\"plain block\"\n                    onClick={() => fetchAccounts()}\n                  >\n                    Show more&hellip;\n                  </button>\n                </InView>\n              ) : (\n                <p class=\"ui-state insignificant\">The end.</p>\n              )\n            ) : (\n              uiState === 'loading' && (\n                <p class=\"ui-state\">\n                  <Loader abrupt />\n                </p>\n              )\n            )}\n          </>\n        ) : uiState === 'loading' ? (\n          <p class=\"ui-state\">\n            <Loader abrupt />\n          </p>\n        ) : uiState === 'error' ? (\n          <p class=\"ui-state\">Unable to load accounts</p>\n        ) : (\n          <p class=\"ui-state insignificant\">No one yet.</p>\n        )}\n      </main>\n    </div>\n  );\n}\n\nfunction StatusButton({\n  checked,\n  count,\n  class: className,\n  title,\n  alt,\n  icon,\n  onClick,\n  ...props\n}) {\n  if (typeof title === 'string') {\n    title = [title, title];\n  }\n  if (typeof alt === 'string') {\n    alt = [alt, alt];\n  }\n\n  const [buttonTitle, setButtonTitle] = useState(title[0] || '');\n  const [iconAlt, setIconAlt] = useState(alt[0] || '');\n\n  useEffect(() => {\n    if (checked) {\n      setButtonTitle(title[1] || '');\n      setIconAlt(alt[1] || '');\n    } else {\n      setButtonTitle(title[0] || '');\n      setIconAlt(alt[0] || '');\n    }\n  }, [checked, title, alt]);\n\n  return (\n    <button\n      type=\"button\"\n      title={buttonTitle}\n      class={`plain ${className} ${checked ? 'checked' : ''}`}\n      onClick={(e) => {\n        if (!onClick) return;\n        e.preventDefault();\n        e.stopPropagation();\n        onClick(e);\n      }}\n      {...props}\n    >\n      <Icon icon={icon} size=\"l\" alt={iconAlt} />\n      {!!count && (\n        <>\n          {' '}\n          <small title={count}>{shortenNumber(count)}</small>\n        </>\n      )}\n    </button>\n  );\n}\n\nexport function formatDuration(time) {\n  if (!time) return;\n  let hours = Math.floor(time / 3600);\n  let minutes = Math.floor((time % 3600) / 60);\n  let seconds = Math.round(time % 60);\n\n  if (hours === 0) {\n    return `${minutes}:${seconds.toString().padStart(2, '0')}`;\n  } else {\n    return `${hours}:${minutes.toString().padStart(2, '0')}:${seconds\n      .toString()\n      .padStart(2, '0')}`;\n  }\n}\n\nconst denylistDomains = /(twitter|github)\\.com/i;\nconst failedUnfurls = {};\n\nfunction _unfurlMastodonLink(instance, url) {\n  const snapStates = snapshot(states);\n  if (denylistDomains.test(url)) {\n    return;\n  }\n  if (failedUnfurls[url]) {\n    return;\n  }\n  const instanceRegex = new RegExp(instance + '/');\n  if (instanceRegex.test(snapStates.unfurledLinks[url]?.url)) {\n    return Promise.resolve(snapStates.unfurledLinks[url]);\n  }\n  console.debug('🦦 Unfurling URL', url);\n\n  let remoteInstanceFetch;\n  let theURL = url;\n\n  // https://elk.zone/domain.com/@stest/123 -> https://domain.com/@stest/123\n  if (/\\/\\/elk\\.[^\\/]+\\/[^\\/]+\\.[^\\/]+/i.test(theURL)) {\n    theURL = theURL.replace(/elk\\.[^\\/]+\\//i, '');\n  }\n\n  // https://trunks.social/status/domain.com/@stest/123 -> https://domain.com/@stest/123\n  if (/\\/\\/trunks\\.[^\\/]+\\/status\\/[^\\/]+\\.[^\\/]+/i.test(theURL)) {\n    theURL = theURL.replace(/trunks\\.[^\\/]+\\/status\\//i, '');\n  }\n\n  // https://phanpy.social/#/domain.com/s/123 -> https://domain.com/statuses/123\n  if (/\\/#\\/[^\\/]+\\.[^\\/]+\\/s\\/.+/i.test(theURL)) {\n    const urlAfterHash = theURL.split('/#/')[1];\n    const finalURL = urlAfterHash.replace(/\\/s\\//i, '/@fakeUsername/');\n    theURL = `https://${finalURL}`;\n  }\n\n  const urlObj = new URL(theURL);\n  const domain = urlObj.hostname;\n  const path = urlObj.pathname;\n  // Regex /:username/:id, where username = @username or @username@domain, id = number\n  const statusRegex = /\\/@([^@\\/]+)@?([^\\/]+)?\\/(\\d+)$/i;\n  const statusMatch = statusRegex.exec(path);\n  if (statusMatch) {\n    const id = statusMatch[3];\n    const { masto } = api({ instance: domain });\n    remoteInstanceFetch = masto.v1.statuses\n      .$select(id)\n      .fetch()\n      .then((status) => {\n        if (status?.id) {\n          return {\n            status,\n            instance: domain,\n          };\n        } else {\n          throw new Error('No results');\n        }\n      });\n  }\n\n  const { masto } = api({ instance });\n  const mastoSearchFetch = masto.v2.search\n    .fetch({\n      q: theURL,\n      type: 'statuses',\n      resolve: true,\n      limit: 1,\n    })\n    .then((results) => {\n      if (results.statuses.length > 0) {\n        const status = results.statuses[0];\n        return {\n          status,\n          instance,\n        };\n      } else {\n        throw new Error('No results');\n      }\n    });\n\n  function handleFulfill(result) {\n    const { status, instance } = result;\n    const { id } = status;\n    const selfURL = `/${instance}/s/${id}`;\n    console.debug('🦦 Unfurled URL', url, id, selfURL);\n    const data = {\n      id,\n      instance,\n      url: selfURL,\n    };\n    states.unfurledLinks[url] = data;\n    saveStatus(status, instance, {\n      skipThreading: true,\n    });\n    return data;\n  }\n  function handleCatch(e) {\n    failedUnfurls[url] = true;\n  }\n\n  if (remoteInstanceFetch) {\n    return Promise.any([remoteInstanceFetch, mastoSearchFetch])\n      .then(handleFulfill)\n      .catch(handleCatch);\n  } else {\n    return mastoSearchFetch.then(handleFulfill).catch(handleCatch);\n  }\n}\n\nfunction nicePostURL(url) {\n  if (!url) return;\n  const urlObj = new URL(url);\n  const { host, pathname } = urlObj;\n  const path = pathname.replace(/\\/$/, '');\n  // split only first slash\n  const [_, username, restPath] = path.match(/\\/(@[^\\/]+)\\/(.*)/) || [];\n  return (\n    <>\n      {host}\n      {username ? (\n        <>\n          /{username}\n          <wbr />\n          <span class=\"more-insignificant\">/{restPath}</span>\n        </>\n      ) : (\n        <span class=\"more-insignificant\">{path}</span>\n      )}\n    </>\n  );\n}\n\nconst unfurlMastodonLink = throttle(_unfurlMastodonLink);\n\nfunction FilteredStatus({ status, filterInfo, instance, containerProps = {} }) {\n  const {\n    id: statusID,\n    account: { avatar, avatarStatic, bot, group },\n    createdAt,\n    visibility,\n    reblog,\n  } = status;\n  const isReblog = !!reblog;\n  const filterTitleStr = filterInfo?.titlesStr || '';\n  const createdAtDate = new Date(createdAt);\n  const statusPeekText = statusPeek(status.reblog || status);\n\n  const [showPeek, setShowPeek] = useState(false);\n  const bindLongPressPeek = useLongPress(\n    () => {\n      setShowPeek(true);\n    },\n    {\n      threshold: 600,\n      captureEvent: true,\n      detect: 'touch',\n      cancelOnMovement: 2, // true allows movement of up to 25 pixels\n    },\n  );\n\n  const statusPeekRef = useTruncated();\n  const sKey =\n    statusKey(status.id, instance) +\n    ' ' +\n    (statusKey(reblog?.id, instance) || '');\n\n  const actualStatusID = reblog?.id || statusID;\n  const url = instance\n    ? `/${instance}/s/${actualStatusID}`\n    : `/s/${actualStatusID}`;\n\n  return (\n    <div\n      class={isReblog ? (group ? 'status-group' : 'status-reblog') : ''}\n      {...containerProps}\n      title={statusPeekText}\n      onContextMenu={(e) => {\n        e.preventDefault();\n        setShowPeek(true);\n      }}\n      {...bindLongPressPeek()}\n    >\n      <article data-state-post-id={sKey} class=\"status filtered\" tabindex=\"-1\">\n        <b\n          class=\"status-filtered-badge clickable badge-meta\"\n          title={filterTitleStr}\n          onClick={(e) => {\n            e.preventDefault();\n            setShowPeek(true);\n          }}\n        >\n          <span>Filtered</span>\n          <span>{filterTitleStr}</span>\n        </b>{' '}\n        <Avatar url={avatarStatic || avatar} squircle={bot} />\n        <span class=\"status-filtered-info\">\n          <span class=\"status-filtered-info-1\">\n            <NameText account={status.account} instance={instance} />{' '}\n            <Icon\n              icon={visibilityIconsMap[visibility]}\n              alt={visibilityText[visibility]}\n              size=\"s\"\n            />{' '}\n            {isReblog ? (\n              'boosted'\n            ) : (\n              <RelativeTime datetime={createdAtDate} format=\"micro\" />\n            )}\n          </span>\n          <span class=\"status-filtered-info-2\">\n            {isReblog && (\n              <>\n                <Avatar\n                  url={reblog.account.avatarStatic || reblog.account.avatar}\n                  squircle={bot}\n                />{' '}\n              </>\n            )}\n            {statusPeekText}\n          </span>\n        </span>\n      </article>\n      {!!showPeek && (\n        <Modal\n          class=\"light\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowPeek(false);\n            }\n          }}\n        >\n          <div id=\"filtered-status-peek\" class=\"sheet\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => setShowPeek(false)}\n            >\n              <Icon icon=\"x\" />\n            </button>\n            <header>\n              <b class=\"status-filtered-badge\">Filtered</b> {filterTitleStr}\n            </header>\n            <main tabIndex=\"-1\">\n              <Link\n                ref={statusPeekRef}\n                class=\"status-link\"\n                to={url}\n                onClick={() => {\n                  setShowPeek(false);\n                }}\n                data-read-more=\"Read more →\"\n              >\n                <Status status={status} instance={instance} size=\"s\" readOnly />\n              </Link>\n            </main>\n          </div>\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nconst QuoteStatuses = memo(({ id, instance, level = 0 }) => {\n  if (!id || !instance) return;\n  const snapStates = useSnapshot(states);\n  const sKey = statusKey(id, instance);\n  const quotes = snapStates.statusQuotes[sKey];\n  const uniqueQuotes = quotes?.filter(\n    (q, i, arr) => arr.findIndex((q2) => q2.url === q.url) === i,\n  );\n\n  if (!uniqueQuotes?.length) return;\n  if (level > 2) return;\n\n  return uniqueQuotes.map((q) => {\n    return (\n      <Link\n        key={q.instance + q.id}\n        to={`${q.instance ? `/${q.instance}` : ''}/s/${q.id}`}\n        class=\"status-card-link\"\n        data-read-more=\"Read more →\"\n      >\n        <Status\n          statusID={q.id}\n          instance={q.instance}\n          size=\"s\"\n          quoted={level + 1}\n          enableCommentHint\n        />\n      </Link>\n    );\n  });\n});\n\nexport default memo(Status);\n","import './compose.css';\n\nimport '@github/text-expander-element';\nimport equal from 'fast-deep-equal';\nimport { forwardRef } from 'preact/compat';\nimport { useEffect, useMemo, useRef, useState } from 'preact/hooks';\nimport { useHotkeys } from 'react-hotkeys-hook';\nimport stringLength from 'string-length';\nimport { uid } from 'uid/single';\nimport { useDebouncedCallback, useThrottledCallback } from 'use-debounce';\nimport { useSnapshot } from 'valtio';\n\nimport supportedLanguages from '../data/status-supported-languages';\nimport urlRegex from '../data/url-regex';\nimport { api } from '../utils/api';\nimport db from '../utils/db';\nimport emojifyText from '../utils/emojify-text';\nimport localeMatch from '../utils/locale-match';\nimport openCompose from '../utils/open-compose';\nimport shortenNumber from '../utils/shorten-number';\nimport states, { saveStatus } from '../utils/states';\nimport store from '../utils/store';\nimport {\n  getCurrentAccount,\n  getCurrentAccountNS,\n  getCurrentInstance,\n  getCurrentInstanceConfiguration,\n} from '../utils/store-utils';\nimport supports from '../utils/supports';\nimport useInterval from '../utils/useInterval';\nimport visibilityIconsMap from '../utils/visibility-icons-map';\n\nimport AccountBlock from './account-block';\n// import Avatar from './avatar';\nimport Icon from './icon';\nimport Loader from './loader';\nimport Modal from './modal';\nimport Status from './status';\n\nconst supportedLanguagesMap = supportedLanguages.reduce((acc, l) => {\n  const [code, common, native] = l;\n  acc[code] = {\n    common,\n    native,\n  };\n  return acc;\n}, {});\n\n/* NOTES:\n  - Max character limit includes BOTH status text and Content Warning text\n*/\n\nconst expiryOptions = {\n  '5 minutes': 5 * 60,\n  '30 minutes': 30 * 60,\n  '1 hour': 60 * 60,\n  '6 hours': 6 * 60 * 60,\n  '12 hours': 12 * 60 * 60,\n  '1 day': 24 * 60 * 60,\n  '3 days': 3 * 24 * 60 * 60,\n  '7 days': 7 * 24 * 60 * 60,\n};\nconst expirySeconds = Object.values(expiryOptions);\nconst oneDay = 24 * 60 * 60;\n\nconst expiresInFromExpiresAt = (expiresAt) => {\n  if (!expiresAt) return oneDay;\n  const delta = (new Date(expiresAt).getTime() - Date.now()) / 1000;\n  return expirySeconds.find((s) => s >= delta) || oneDay;\n};\n\nconst menu = document.createElement('ul');\nmenu.role = 'listbox';\nmenu.className = 'text-expander-menu';\n\n// Set IntersectionObserver on menu, reposition it because text-expander doesn't handle it\nconst windowMargin = 16;\nconst observer = new IntersectionObserver((entries) => {\n  entries.forEach((entry) => {\n    if (entry.isIntersecting) {\n      const { left, width } = entry.boundingClientRect;\n      const { innerWidth } = window;\n      if (left + width > innerWidth) {\n        menu.style.left = innerWidth - width - windowMargin + 'px';\n      }\n    }\n  });\n});\nobserver.observe(menu);\n\nconst DEFAULT_LANG = localeMatch(\n  [new Intl.DateTimeFormat().resolvedOptions().locale, ...navigator.languages],\n  supportedLanguages.map((l) => l[0]),\n  'en',\n);\n\n// https://github.com/mastodon/mastodon/blob/c4a429ed47e85a6bbf0d470a41cc2f64cf120c19/app/javascript/mastodon/features/compose/util/counter.js\nconst urlRegexObj = new RegExp(urlRegex.source, urlRegex.flags);\nconst usernameRegex = /(^|[^\\/\\w])@(([a-z0-9_]+)@[a-z0-9\\.\\-]+[a-z0-9]+)/gi;\nconst urlPlaceholder = '$2xxxxxxxxxxxxxxxxxxxxxxx';\nfunction countableText(inputText) {\n  return inputText\n    .replace(urlRegexObj, urlPlaceholder)\n    .replace(usernameRegex, '$1@$3');\n}\n\n// https://github.com/mastodon/mastodon/blob/c03bd2a238741a012aa4b98dc4902d6cf948ab63/app/models/account.rb#L69\nconst USERNAME_RE = /[a-z0-9_]+([a-z0-9_.-]+[a-z0-9_]+)?/i;\nconst MENTION_RE = new RegExp(\n  `(?<![=\\\\/\\\\w])@((${USERNAME_RE.source})(?:@[\\\\w.-]+[\\\\w]+)?)`,\n  'ig',\n);\n\n// AI-generated, all other regexes are too complicated\nconst HASHTAG_RE = new RegExp(\n  `(?<![=\\\\/\\\\w])#([a-z0-9_]+([a-z0-9_.-]+[a-z0-9_]+)?)(?![\\\\/\\\\w])`,\n  'ig',\n);\n\n// https://github.com/mastodon/mastodon/blob/23e32a4b3031d1da8b911e0145d61b4dd47c4f96/app/models/custom_emoji.rb#L31\nconst SHORTCODE_RE_FRAGMENT = '[a-zA-Z0-9_]{2,}';\nconst SCAN_RE = new RegExp(\n  `(?<=[^A-Za-z0-9_:\\\\n]|^):(${SHORTCODE_RE_FRAGMENT}):(?=[^A-Za-z0-9_:]|$)`,\n  'g',\n);\n\nfunction highlightText(text, { maxCharacters = Infinity }) {\n  // Accept text string, return formatted HTML string\n  let html = text;\n  // Exceeded characters limit\n  const { composerCharacterCount } = states;\n  let leftoverHTML = '';\n  if (composerCharacterCount > maxCharacters) {\n    const leftoverCount = composerCharacterCount - maxCharacters;\n    // Highlight exceeded characters\n    leftoverHTML =\n      '<mark class=\"compose-highlight-exceeded\">' +\n      html.slice(-leftoverCount) +\n      '</mark>';\n    html = html.slice(0, -leftoverCount);\n  }\n\n  html = html\n    .replace(urlRegexObj, '$2<mark class=\"compose-highlight-url\">$3</mark>') // URLs\n    .replace(MENTION_RE, '<mark class=\"compose-highlight-mention\">$&</mark>') // Mentions\n    .replace(HASHTAG_RE, '<mark class=\"compose-highlight-hashtag\">#$1</mark>') // Hashtags\n    .replace(\n      SCAN_RE,\n      '<mark class=\"compose-highlight-emoji-shortcode\">$&</mark>',\n    ); // Emoji shortcodes\n\n  return html + leftoverHTML;\n}\n\nfunction Compose({\n  onClose,\n  replyToStatus,\n  editStatus,\n  draftStatus,\n  standalone,\n  hasOpener,\n}) {\n  console.warn('RENDER COMPOSER');\n  const { masto, instance } = api();\n  const [uiState, setUIState] = useState('default');\n  const UID = useRef(draftStatus?.uid || uid());\n  console.log('Compose UID', UID.current);\n\n  const currentAccount = getCurrentAccount();\n  const currentAccountInfo = currentAccount.info;\n\n  const configuration = getCurrentInstanceConfiguration();\n  console.log('⚙️ Configuration', configuration);\n\n  const {\n    statuses: {\n      maxCharacters,\n      maxMediaAttachments,\n      charactersReservedPerUrl,\n    } = {},\n    mediaAttachments: {\n      supportedMimeTypes = [],\n      imageSizeLimit,\n      imageMatrixLimit,\n      videoSizeLimit,\n      videoMatrixLimit,\n      videoFrameRateLimit,\n    } = {},\n    polls: {\n      maxOptions,\n      maxCharactersPerOption,\n      maxExpiration,\n      minExpiration,\n    } = {},\n  } = configuration || {};\n\n  const textareaRef = useRef();\n  const spoilerTextRef = useRef();\n  const [visibility, setVisibility] = useState('public');\n  const [sensitive, setSensitive] = useState(false);\n  const [language, setLanguage] = useState(\n    store.session.get('currentLanguage') || DEFAULT_LANG,\n  );\n  const prevLanguage = useRef(language);\n  const [mediaAttachments, setMediaAttachments] = useState([]);\n  const [poll, setPoll] = useState(null);\n\n  const prefs = store.account.get('preferences') || {};\n\n  const oninputTextarea = () => {\n    if (!textareaRef.current) return;\n    textareaRef.current.dispatchEvent(new Event('input'));\n  };\n  const focusTextarea = () => {\n    setTimeout(() => {\n      console.debug('FOCUS textarea');\n      textareaRef.current?.focus();\n    }, 300);\n  };\n\n  useEffect(() => {\n    if (replyToStatus) {\n      const { spoilerText, visibility, language, sensitive } = replyToStatus;\n      if (spoilerText && spoilerTextRef.current) {\n        spoilerTextRef.current.value = spoilerText;\n      }\n      const mentions = new Set([\n        replyToStatus.account.acct,\n        ...replyToStatus.mentions.map((m) => m.acct),\n      ]);\n      const allMentions = [...mentions].filter(\n        (m) => m !== currentAccountInfo.acct,\n      );\n      if (allMentions.length > 0) {\n        textareaRef.current.value = `${allMentions\n          .map((m) => `@${m}`)\n          .join(' ')} `;\n        oninputTextarea();\n      }\n      focusTextarea();\n      setVisibility(\n        visibility === 'public' && prefs['posting:default:visibility']\n          ? prefs['posting:default:visibility']\n          : visibility,\n      );\n      setLanguage(language || prefs.postingDefaultLanguage || DEFAULT_LANG);\n      setSensitive(sensitive && !!spoilerText);\n    } else if (editStatus) {\n      const { visibility, language, sensitive, poll, mediaAttachments } =\n        editStatus;\n      const composablePoll = !!poll?.options && {\n        ...poll,\n        options: poll.options.map((o) => o?.title || o),\n        expiresIn: poll?.expiresIn || expiresInFromExpiresAt(poll.expiresAt),\n      };\n      setUIState('loading');\n      (async () => {\n        try {\n          const statusSource = await masto.v1.statuses\n            .$select(editStatus.id)\n            .source.fetch();\n          console.log({ statusSource });\n          const { text, spoilerText } = statusSource;\n          textareaRef.current.value = text;\n          textareaRef.current.dataset.source = text;\n          oninputTextarea();\n          focusTextarea();\n          spoilerTextRef.current.value = spoilerText;\n          setVisibility(visibility);\n          setLanguage(language || presf.postingDefaultLanguage || DEFAULT_LANG);\n          setSensitive(sensitive);\n          setPoll(composablePoll);\n          setMediaAttachments(mediaAttachments);\n          setUIState('default');\n        } catch (e) {\n          console.error(e);\n          alert(e?.reason || e);\n          setUIState('error');\n        }\n      })();\n    } else {\n      focusTextarea();\n      console.log('Apply prefs', prefs);\n      if (prefs['posting:default:visibility']) {\n        setVisibility(prefs['posting:default:visibility']);\n      }\n      if (prefs['posting:default:language']) {\n        setLanguage(prefs['posting:default:language']);\n      }\n      if (prefs['posting:default:sensitive']) {\n        setSensitive(prefs['posting:default:sensitive']);\n      }\n    }\n    if (draftStatus) {\n      const {\n        status,\n        spoilerText,\n        visibility,\n        language,\n        sensitive,\n        poll,\n        mediaAttachments,\n      } = draftStatus;\n      const composablePoll = !!poll?.options && {\n        ...poll,\n        options: poll.options.map((o) => o?.title || o),\n        expiresIn: poll?.expiresIn || expiresInFromExpiresAt(poll.expiresAt),\n      };\n      textareaRef.current.value = status;\n      oninputTextarea();\n      focusTextarea();\n      if (spoilerText) spoilerTextRef.current.value = spoilerText;\n      if (visibility) setVisibility(visibility);\n      setLanguage(language || prefs.postingDefaultLanguage || DEFAULT_LANG);\n      if (sensitive !== null) setSensitive(sensitive);\n      if (composablePoll) setPoll(composablePoll);\n      if (mediaAttachments) setMediaAttachments(mediaAttachments);\n    }\n  }, [draftStatus, editStatus, replyToStatus]);\n\n  const formRef = useRef();\n\n  const beforeUnloadCopy = 'You have unsaved changes. Discard this post?';\n  const canClose = () => {\n    const { value, dataset } = textareaRef.current;\n\n    // check if loading\n    if (uiState === 'loading') {\n      console.log('canClose', { uiState });\n      return false;\n    }\n\n    // check for status and media attachments\n    const hasMediaAttachments = mediaAttachments.length > 0;\n    if (!value && !hasMediaAttachments) {\n      console.log('canClose', { value, mediaAttachments });\n      return true;\n    }\n\n    // check if all media attachments have IDs\n    const hasIDMediaAttachments =\n      mediaAttachments.length > 0 &&\n      mediaAttachments.every((media) => media.id);\n    if (hasIDMediaAttachments) {\n      console.log('canClose', { hasIDMediaAttachments });\n      return true;\n    }\n\n    // check if status contains only \"@acct\", if replying\n    const isSelf = replyToStatus?.account.id === currentAccountInfo.id;\n    const hasOnlyAcct =\n      replyToStatus && value.trim() === `@${replyToStatus.account.acct}`;\n    // TODO: check for mentions, or maybe just generic \"@username<space>\", including multiple mentions like \"@username1<space>@username2<space>\"\n    if (!isSelf && hasOnlyAcct) {\n      console.log('canClose', { isSelf, hasOnlyAcct });\n      return true;\n    }\n\n    // check if status is same with source\n    const sameWithSource = value === dataset?.source;\n    if (sameWithSource) {\n      console.log('canClose', { sameWithSource });\n      return true;\n    }\n\n    console.log('canClose', {\n      value,\n      hasMediaAttachments,\n      hasIDMediaAttachments,\n      poll,\n      isSelf,\n      hasOnlyAcct,\n      sameWithSource,\n      uiState,\n    });\n\n    return false;\n  };\n\n  const confirmClose = () => {\n    if (!canClose()) {\n      const yes = confirm(beforeUnloadCopy);\n      return yes;\n    }\n    return true;\n  };\n\n  useEffect(() => {\n    // Show warning if user tries to close window with unsaved changes\n    const handleBeforeUnload = (e) => {\n      if (!canClose()) {\n        e.preventDefault();\n        e.returnValue = beforeUnloadCopy;\n      }\n    };\n    window.addEventListener('beforeunload', handleBeforeUnload, {\n      capture: true,\n    });\n    return () =>\n      window.removeEventListener('beforeunload', handleBeforeUnload, {\n        capture: true,\n      });\n  }, []);\n\n  const getCharCount = () => {\n    const { value } = textareaRef.current;\n    const { value: spoilerText } = spoilerTextRef.current;\n    return stringLength(countableText(value)) + stringLength(spoilerText);\n  };\n  const updateCharCount = () => {\n    const count = getCharCount();\n    states.composerCharacterCount = count;\n  };\n  useEffect(updateCharCount, []);\n\n  const escDownRef = useRef(false);\n  useHotkeys(\n    'esc',\n    () => {\n      escDownRef.current = true;\n      // This won't be true if this event is already handled and not propagated 🤞\n    },\n    {\n      enableOnFormTags: true,\n    },\n  );\n  useHotkeys(\n    'esc',\n    () => {\n      if (!standalone && escDownRef.current && confirmClose()) {\n        onClose();\n      }\n      escDownRef.current = false;\n    },\n    {\n      enableOnFormTags: true,\n      // Use keyup because Esc keydown will close the confirm dialog on Safari\n      keyup: true,\n      ignoreEventWhen: (e) => {\n        const modals = document.querySelectorAll('#modal-container > *');\n        const hasModal = !!modals;\n        const hasOnlyComposer =\n          modals.length === 1 && modals[0].querySelector('#compose-container');\n        return hasModal && !hasOnlyComposer;\n      },\n    },\n  );\n\n  const prevBackgroundDraft = useRef({});\n  const draftKey = () => {\n    const ns = getCurrentAccountNS();\n    return `${ns}#${UID.current}`;\n  };\n  const saveUnsavedDraft = () => {\n    // Not enabling this for editing status\n    // I don't think this warrant a draft mode for a status that's already posted\n    // Maybe it could be a big edit change but it should be rare\n    if (editStatus) return;\n    const key = draftKey();\n    const backgroundDraft = {\n      key,\n      replyTo: replyToStatus\n        ? {\n            /* Smaller payload of replyToStatus. Reasons:\n              - No point storing whole thing\n              - Could have media attachments\n              - Could be deleted/edited later\n            */\n            id: replyToStatus.id,\n            account: {\n              id: replyToStatus.account.id,\n              username: replyToStatus.account.username,\n              acct: replyToStatus.account.acct,\n            },\n          }\n        : null,\n      draftStatus: {\n        uid: UID.current,\n        status: textareaRef.current.value,\n        spoilerText: spoilerTextRef.current.value,\n        visibility,\n        language,\n        sensitive,\n        poll,\n        mediaAttachments,\n      },\n    };\n    if (!equal(backgroundDraft, prevBackgroundDraft.current) && !canClose()) {\n      console.debug('not equal', backgroundDraft, prevBackgroundDraft.current);\n      db.drafts\n        .set(key, {\n          ...backgroundDraft,\n          state: 'unsaved',\n          updatedAt: Date.now(),\n        })\n        .then(() => {\n          console.debug('DRAFT saved', key, backgroundDraft);\n        })\n        .catch((e) => {\n          console.error('DRAFT failed', key, e);\n        });\n      prevBackgroundDraft.current = structuredClone(backgroundDraft);\n    }\n  };\n  useInterval(saveUnsavedDraft, 5000); // background save every 5s\n  useEffect(() => {\n    saveUnsavedDraft();\n    // If unmounted, means user discarded the draft\n    // Also means pop-out 🙈, but it's okay because the pop-out will persist the ID and re-create the draft\n    return () => {\n      db.drafts.del(draftKey());\n    };\n  }, []);\n\n  useEffect(() => {\n    const handleItems = (e) => {\n      const { items } = e.clipboardData || e.dataTransfer;\n      const files = [];\n      for (let i = 0; i < items.length; i++) {\n        const item = items[i];\n        if (item.kind === 'file') {\n          const file = item.getAsFile();\n          if (file && supportedMimeTypes.includes(file.type)) {\n            files.push(file);\n          }\n        }\n      }\n      if (files.length > 0 && mediaAttachments.length >= maxMediaAttachments) {\n        alert(`You can only attach up to ${maxMediaAttachments} files.`);\n        return;\n      }\n      console.log({ files });\n      if (files.length > 0) {\n        e.preventDefault();\n        e.stopPropagation();\n        // Auto-cut-off files to avoid exceeding maxMediaAttachments\n        const max = maxMediaAttachments - mediaAttachments.length;\n        const allowedFiles = files.slice(0, max);\n        if (allowedFiles.length <= 0) {\n          alert(`You can only attach up to ${maxMediaAttachments} files.`);\n          return;\n        }\n        const mediaFiles = allowedFiles.map((file) => ({\n          file,\n          type: file.type,\n          size: file.size,\n          url: URL.createObjectURL(file),\n          id: null,\n          description: null,\n        }));\n        setMediaAttachments([...mediaAttachments, ...mediaFiles]);\n      }\n    };\n    window.addEventListener('paste', handleItems);\n    const handleDragover = (e) => {\n      // Prevent default if there's files\n      if (e.dataTransfer.items.length > 0) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    };\n    window.addEventListener('dragover', handleDragover);\n    window.addEventListener('drop', handleItems);\n    return () => {\n      window.removeEventListener('paste', handleItems);\n      window.removeEventListener('dragover', handleDragover);\n      window.removeEventListener('drop', handleItems);\n    };\n  }, [mediaAttachments]);\n\n  const [showEmoji2Picker, setShowEmoji2Picker] = useState(false);\n\n  const [topSupportedLanguages, restSupportedLanguages] = useMemo(() => {\n    const topLanguages = [];\n    const restLanguages = [];\n    const { contentTranslationHideLanguages = [] } = states.settings;\n    supportedLanguages.forEach((l) => {\n      const [code] = l;\n      if (\n        code === language ||\n        code === prevLanguage.current ||\n        code === DEFAULT_LANG ||\n        contentTranslationHideLanguages.includes(code)\n      ) {\n        topLanguages.push(l);\n      } else {\n        restLanguages.push(l);\n      }\n    });\n    topLanguages.sort(([codeA, commonA], [codeB, commonB]) => {\n      if (codeA === language) return -1;\n      if (codeB === language) return 1;\n      return commonA.localeCompare(commonB);\n    });\n    restLanguages.sort(([codeA, commonA], [codeB, commonB]) =>\n      commonA.localeCompare(commonB),\n    );\n    return [topLanguages, restLanguages];\n  }, [language]);\n\n  return (\n    <div id=\"compose-container-outer\">\n      <div id=\"compose-container\" class={standalone ? 'standalone' : ''}>\n        <div class=\"compose-top\">\n          {currentAccountInfo?.avatarStatic && (\n            // <Avatar\n            //   url={currentAccountInfo.avatarStatic}\n            //   size=\"xl\"\n            //   alt={currentAccountInfo.username}\n            //   squircle={currentAccountInfo?.bot}\n            // />\n            <AccountBlock\n              account={currentAccountInfo}\n              accountInstance={currentAccount.instanceURL}\n              hideDisplayName\n              useAvatarStatic\n            />\n          )}\n          {!standalone ? (\n            <span>\n              <button\n                type=\"button\"\n                class=\"light pop-button\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  // If there are non-ID media attachments (not yet uploaded), show confirmation dialog because they are not going to be passed to the new window\n                  // const containNonIDMediaAttachments =\n                  //   mediaAttachments.length > 0 &&\n                  //   mediaAttachments.some((media) => !media.id);\n                  // if (containNonIDMediaAttachments) {\n                  //   const yes = confirm(\n                  //     'You have media attachments that are not yet uploaded. Opening a new window will discard them and you will need to re-attach them. Are you sure you want to continue?',\n                  //   );\n                  //   if (!yes) {\n                  //     return;\n                  //   }\n                  // }\n\n                  // const mediaAttachmentsWithIDs = mediaAttachments.filter(\n                  //   (media) => media.id,\n                  // );\n\n                  const newWin = openCompose({\n                    editStatus,\n                    replyToStatus,\n                    draftStatus: {\n                      uid: UID.current,\n                      status: textareaRef.current.value,\n                      spoilerText: spoilerTextRef.current.value,\n                      visibility,\n                      language,\n                      sensitive,\n                      poll,\n                      mediaAttachments,\n                    },\n                  });\n\n                  if (!newWin) {\n                    return;\n                  }\n\n                  onClose();\n                }}\n              >\n                <Icon icon=\"popout\" alt=\"Pop out\" />\n              </button>{' '}\n              <button\n                type=\"button\"\n                class=\"light close-button\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  if (confirmClose()) {\n                    onClose();\n                  }\n                }}\n              >\n                <Icon icon=\"x\" />\n              </button>\n            </span>\n          ) : (\n            hasOpener && (\n              <button\n                type=\"button\"\n                class=\"light pop-button\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  // If there are non-ID media attachments (not yet uploaded), show confirmation dialog because they are not going to be passed to the new window\n                  // const containNonIDMediaAttachments =\n                  //   mediaAttachments.length > 0 &&\n                  //   mediaAttachments.some((media) => !media.id);\n                  // if (containNonIDMediaAttachments) {\n                  //   const yes = confirm(\n                  //     'You have media attachments that are not yet uploaded. Opening a new window will discard them and you will need to re-attach them. Are you sure you want to continue?',\n                  //   );\n                  //   if (!yes) {\n                  //     return;\n                  //   }\n                  // }\n\n                  if (!window.opener) {\n                    alert('Looks like you closed the parent window.');\n                    return;\n                  }\n\n                  if (window.opener.__STATES__.showCompose) {\n                    const yes = confirm(\n                      'Looks like you already have a compose field open in the parent window. Popping in this window will discard the changes you made in the parent window. Continue?',\n                    );\n                    if (!yes) return;\n                  }\n\n                  // const mediaAttachmentsWithIDs = mediaAttachments.filter(\n                  //   (media) => media.id,\n                  // );\n\n                  onClose({\n                    fn: () => {\n                      const passData = {\n                        editStatus,\n                        replyToStatus,\n                        draftStatus: {\n                          uid: UID.current,\n                          status: textareaRef.current.value,\n                          spoilerText: spoilerTextRef.current.value,\n                          visibility,\n                          language,\n                          sensitive,\n                          poll,\n                          mediaAttachments,\n                        },\n                      };\n                      window.opener.__COMPOSE__ = passData; // Pass it here instead of `showCompose` due to some weird proxy issue again\n                      window.opener.__STATES__.showCompose = true;\n                    },\n                  });\n                }}\n              >\n                <Icon icon=\"popin\" alt=\"Pop in\" />\n              </button>\n            )\n          )}\n        </div>\n        {!!replyToStatus && (\n          <div class=\"status-preview\">\n            <Status status={replyToStatus} size=\"s\" previewMode />\n            <div class=\"status-preview-legend reply-to\">\n              Replying to @\n              {replyToStatus.account.acct || replyToStatus.account.username}\n              &rsquo;s post\n            </div>\n          </div>\n        )}\n        {!!editStatus && (\n          <div class=\"status-preview\">\n            <Status status={editStatus} size=\"s\" previewMode />\n            <div class=\"status-preview-legend\">Editing source post</div>\n          </div>\n        )}\n        <form\n          ref={formRef}\n          class={`form-visibility-${visibility}`}\n          style={{\n            pointerEvents: uiState === 'loading' ? 'none' : 'auto',\n            opacity: uiState === 'loading' ? 0.5 : 1,\n          }}\n          onKeyDown={(e) => {\n            if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {\n              formRef.current.dispatchEvent(\n                new Event('submit', { cancelable: true }),\n              );\n            }\n          }}\n          onSubmit={(e) => {\n            e.preventDefault();\n\n            const formData = new FormData(e.target);\n            const entries = Object.fromEntries(formData.entries());\n            console.log('ENTRIES', entries);\n            let { status, visibility, sensitive, spoilerText } = entries;\n\n            // Pre-cleanup\n            sensitive = sensitive === 'on'; // checkboxes return \"on\" if checked\n\n            // Validation\n            /* Let the backend validate this\n          if (stringLength(status) > maxCharacters) {\n            alert(`Status is too long! Max characters: ${maxCharacters}`);\n            return;\n          }\n          if (\n            sensitive &&\n            stringLength(status) + stringLength(spoilerText) > maxCharacters\n          ) {\n            alert(\n              `Status and content warning is too long! Max characters: ${maxCharacters}`,\n            );\n            return;\n          }\n          */\n            if (poll) {\n              if (poll.options.length < 2) {\n                alert('Poll must have at least 2 options');\n                return;\n              }\n              if (poll.options.some((option) => option === '')) {\n                alert('Some poll choices are empty');\n                return;\n              }\n            }\n            // TODO: check for URLs and use `charactersReservedPerUrl` to calculate max characters\n\n            if (mediaAttachments.length > 0) {\n              // If there are media attachments, check if they have no descriptions\n              const hasNoDescriptions = mediaAttachments.some(\n                (media) => !media.description?.trim?.(),\n              );\n              if (hasNoDescriptions) {\n                const yes = confirm(\n                  'Some media have no descriptions. Continue?',\n                );\n                if (!yes) return;\n              }\n            }\n\n            // Post-cleanup\n            spoilerText = (sensitive && spoilerText) || undefined;\n            status = status === '' ? undefined : status;\n\n            setUIState('loading');\n            (async () => {\n              try {\n                console.log('MEDIA ATTACHMENTS', mediaAttachments);\n                if (mediaAttachments.length > 0) {\n                  // Upload media attachments first\n                  const mediaPromises = mediaAttachments.map((attachment) => {\n                    const { file, description, id } = attachment;\n                    console.log('UPLOADING', attachment);\n                    if (id) {\n                      // If already uploaded\n                      return attachment;\n                    } else {\n                      const params = removeNullUndefined({\n                        file,\n                        description,\n                      });\n                      return masto.v2.media.create(params).then((res) => {\n                        if (res.id) {\n                          attachment.id = res.id;\n                        }\n                        return res;\n                      });\n                    }\n                  });\n                  const results = await Promise.allSettled(mediaPromises);\n\n                  // If any failed, return\n                  if (\n                    results.some((result) => {\n                      return result.status === 'rejected' || !result.value?.id;\n                    })\n                  ) {\n                    setUIState('error');\n                    // Alert all the reasons\n                    results.forEach((result) => {\n                      if (result.status === 'rejected') {\n                        console.error(result);\n                        alert(result.reason || `Attachment #${i} failed`);\n                      }\n                    });\n                    return;\n                  }\n\n                  console.log({ results, mediaAttachments });\n                }\n\n                /* NOTE:\n                Using snakecase here because masto.js's `isObject` returns false for `params`, ONLY happens when opening in pop-out window. This is maybe due to `window.masto` variable being passed from the parent window. The check that failed is `x.constructor === Object`, so maybe the `Object` in new window is different than parent window's?\n                Code: https://github.com/neet/masto.js/blob/dd0d649067b6a2b6e60fbb0a96597c373a255b00/src/serializers/is-object.ts#L2\n\n                // TODO: Note above is no longer true in Masto.js v6. Revisit this.\n              */\n                let params = {\n                  status,\n                  // spoilerText,\n                  spoiler_text: spoilerText,\n                  language,\n                  sensitive,\n                  poll,\n                  // mediaIds: mediaAttachments.map((attachment) => attachment.id),\n                  media_ids: mediaAttachments.map(\n                    (attachment) => attachment.id,\n                  ),\n                };\n                if (editStatus && supports('@mastodon/edit-media-attributes')) {\n                  params.media_attributes = mediaAttachments.map(\n                    (attachment) => {\n                      return {\n                        id: attachment.id,\n                        description: attachment.description,\n                        // focus\n                        // thumbnail\n                      };\n                    },\n                  );\n                } else if (!editStatus) {\n                  params.visibility = visibility;\n                  // params.inReplyToId = replyToStatus?.id || undefined;\n                  params.in_reply_to_id = replyToStatus?.id || undefined;\n                }\n                params = removeNullUndefined(params);\n                console.log('POST', params);\n\n                let newStatus;\n                if (editStatus) {\n                  newStatus = await masto.v1.statuses\n                    .$select(editStatus.id)\n                    .update(params);\n                  saveStatus(newStatus, instance, {\n                    skipThreading: true,\n                  });\n                } else {\n                  try {\n                    newStatus = await masto.v1.statuses.create(params, {\n                      idempotencyKey: UID.current,\n                    });\n                  } catch (_) {\n                    // If idempotency key fails, try again without it\n                    newStatus = await masto.v1.statuses.create(params);\n                  }\n                }\n                setUIState('default');\n\n                // Close\n                onClose({\n                  // type: post, reply, edit\n                  type: editStatus ? 'edit' : replyToStatus ? 'reply' : 'post',\n                  newStatus,\n                  instance,\n                });\n              } catch (e) {\n                console.error(e);\n                alert(e?.reason || e);\n                setUIState('error');\n              }\n            })();\n          }}\n        >\n          <div class=\"toolbar stretch\">\n            <input\n              ref={spoilerTextRef}\n              type=\"text\"\n              name=\"spoilerText\"\n              placeholder=\"Content warning\"\n              disabled={uiState === 'loading'}\n              class=\"spoiler-text-field\"\n              lang={language}\n              spellCheck=\"true\"\n              dir=\"auto\"\n              style={{\n                opacity: sensitive ? 1 : 0,\n                pointerEvents: sensitive ? 'auto' : 'none',\n              }}\n              onInput={() => {\n                updateCharCount();\n              }}\n            />\n            <label\n              class={`toolbar-button ${sensitive ? 'highlight' : ''}`}\n              title=\"Content warning or sensitive media\"\n            >\n              <input\n                name=\"sensitive\"\n                type=\"checkbox\"\n                checked={sensitive}\n                disabled={uiState === 'loading'}\n                onChange={(e) => {\n                  const sensitive = e.target.checked;\n                  setSensitive(sensitive);\n                  if (sensitive) {\n                    spoilerTextRef.current?.focus();\n                  } else {\n                    textareaRef.current?.focus();\n                  }\n                }}\n              />\n              <Icon icon={`eye-${sensitive ? 'close' : 'open'}`} />\n            </label>{' '}\n            <label\n              class={`toolbar-button ${\n                visibility !== 'public' && !sensitive ? 'show-field' : ''\n              } ${visibility !== 'public' ? 'highlight' : ''}`}\n              title={`Visibility: ${visibility}`}\n            >\n              <Icon icon={visibilityIconsMap[visibility]} alt={visibility} />\n              <select\n                name=\"visibility\"\n                value={visibility}\n                onChange={(e) => {\n                  setVisibility(e.target.value);\n                }}\n                disabled={uiState === 'loading' || !!editStatus}\n              >\n                <option value=\"public\">\n                  Public <Icon icon=\"earth\" />\n                </option>\n                <option value=\"unlisted\">Unlisted</option>\n                <option value=\"private\">Followers only</option>\n                <option value=\"direct\">Private mention</option>\n              </select>\n            </label>{' '}\n          </div>\n          <Textarea\n            ref={textareaRef}\n            placeholder={\n              replyToStatus\n                ? 'Post your reply'\n                : editStatus\n                ? 'Edit your post'\n                : 'What are you doing?'\n            }\n            required={mediaAttachments?.length === 0}\n            disabled={uiState === 'loading'}\n            lang={language}\n            onInput={() => {\n              updateCharCount();\n            }}\n            maxCharacters={maxCharacters}\n            performSearch={(params) => {\n              const { type, q, limit } = params;\n              if (type === 'accounts') {\n                return masto.v1.accounts.search.list({\n                  q,\n                  limit,\n                  resolve: false,\n                });\n              }\n              return masto.v2.search.fetch(params);\n            }}\n          />\n          {mediaAttachments?.length > 0 && (\n            <div class=\"media-attachments\">\n              {mediaAttachments.map((attachment, i) => {\n                const { id, file } = attachment;\n                const fileID = file?.size + file?.type + file?.name;\n                return (\n                  <MediaAttachment\n                    key={id || fileID || i}\n                    attachment={attachment}\n                    disabled={uiState === 'loading'}\n                    lang={language}\n                    onDescriptionChange={(value) => {\n                      setMediaAttachments((attachments) => {\n                        const newAttachments = [...attachments];\n                        newAttachments[i].description = value;\n                        return newAttachments;\n                      });\n                    }}\n                    onRemove={() => {\n                      setMediaAttachments((attachments) => {\n                        return attachments.filter((_, j) => j !== i);\n                      });\n                    }}\n                  />\n                );\n              })}\n              <label class=\"media-sensitive\">\n                <input\n                  name=\"sensitive\"\n                  type=\"checkbox\"\n                  checked={sensitive}\n                  disabled={uiState === 'loading'}\n                  onChange={(e) => {\n                    const sensitive = e.target.checked;\n                    setSensitive(sensitive);\n                  }}\n                />{' '}\n                <span>Mark media as sensitive</span>{' '}\n                <Icon icon={`eye-${sensitive ? 'close' : 'open'}`} />\n              </label>\n            </div>\n          )}\n          {!!poll && (\n            <Poll\n              lang={language}\n              maxOptions={maxOptions}\n              maxExpiration={maxExpiration}\n              minExpiration={minExpiration}\n              maxCharactersPerOption={maxCharactersPerOption}\n              poll={poll}\n              disabled={uiState === 'loading'}\n              onInput={(poll) => {\n                if (poll) {\n                  const newPoll = { ...poll };\n                  setPoll(newPoll);\n                } else {\n                  setPoll(null);\n                }\n              }}\n            />\n          )}\n          <div\n            class=\"toolbar wrap\"\n            style={{\n              justifyContent: 'flex-end',\n            }}\n          >\n            <span>\n              <label class=\"toolbar-button\">\n                <input\n                  type=\"file\"\n                  accept={supportedMimeTypes.join(',')}\n                  multiple={mediaAttachments.length < maxMediaAttachments - 1}\n                  disabled={\n                    uiState === 'loading' ||\n                    mediaAttachments.length >= maxMediaAttachments ||\n                    !!poll\n                  }\n                  onChange={(e) => {\n                    const files = e.target.files;\n                    if (!files) return;\n\n                    const mediaFiles = Array.from(files).map((file) => ({\n                      file,\n                      type: file.type,\n                      size: file.size,\n                      url: URL.createObjectURL(file),\n                      id: null, // indicate uploaded state\n                      description: null,\n                    }));\n                    console.log('MEDIA ATTACHMENTS', files, mediaFiles);\n\n                    // Validate max media attachments\n                    if (\n                      mediaAttachments.length + mediaFiles.length >\n                      maxMediaAttachments\n                    ) {\n                      alert(\n                        `You can only attach up to ${maxMediaAttachments} files.`,\n                      );\n                    } else {\n                      setMediaAttachments((attachments) => {\n                        return attachments.concat(mediaFiles);\n                      });\n                    }\n                    // Reset\n                    e.target.value = '';\n                  }}\n                />\n                <Icon icon=\"attachment\" />\n              </label>{' '}\n              <button\n                type=\"button\"\n                class=\"toolbar-button\"\n                disabled={\n                  uiState === 'loading' || !!poll || !!mediaAttachments.length\n                }\n                onClick={() => {\n                  setPoll({\n                    options: ['', ''],\n                    expiresIn: 24 * 60 * 60, // 1 day\n                    multiple: false,\n                  });\n                }}\n              >\n                <Icon icon=\"poll\" alt=\"Add poll\" />\n              </button>{' '}\n              <button\n                type=\"button\"\n                class=\"toolbar-button\"\n                disabled={uiState === 'loading'}\n                onClick={() => {\n                  setShowEmoji2Picker(true);\n                }}\n              >\n                <Icon icon=\"emoji2\" />\n              </button>\n            </span>\n            <div class=\"spacer\" />\n            {uiState === 'loading' ? (\n              <Loader abrupt />\n            ) : (\n              <CharCountMeter\n                maxCharacters={maxCharacters}\n                hidden={uiState === 'loading'}\n              />\n            )}\n            <label\n              class={`toolbar-button ${\n                language !== prevLanguage.current ? 'highlight' : ''\n              }`}\n            >\n              <span class=\"icon-text\">\n                {supportedLanguagesMap[language]?.native}\n              </span>\n              <select\n                name=\"language\"\n                value={language}\n                onChange={(e) => {\n                  const { value } = e.target;\n                  setLanguage(value || DEFAULT_LANG);\n                  store.session.set('currentLanguage', value || DEFAULT_LANG);\n                }}\n                disabled={uiState === 'loading'}\n              >\n                {topSupportedLanguages.map(([code, common, native]) => (\n                  <option value={code} key={code}>\n                    {common} ({native})\n                  </option>\n                ))}\n                <hr />\n                {restSupportedLanguages.map(([code, common, native]) => (\n                  <option value={code} key={code}>\n                    {common} ({native})\n                  </option>\n                ))}\n              </select>\n            </label>{' '}\n            <button\n              type=\"submit\"\n              class=\"large\"\n              disabled={uiState === 'loading'}\n            >\n              {replyToStatus ? 'Reply' : editStatus ? 'Update' : 'Post'}\n            </button>\n          </div>\n        </form>\n      </div>\n      {showEmoji2Picker && (\n        <Modal\n          class=\"light\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowEmoji2Picker(false);\n            }\n          }}\n        >\n          <CustomEmojisModal\n            masto={masto}\n            instance={instance}\n            onClose={() => {\n              setShowEmoji2Picker(false);\n            }}\n            onSelect={(emoji) => {\n              const emojiWithSpace = ` ${emoji} `;\n              const textarea = textareaRef.current;\n              if (!textarea) return;\n              const { selectionStart, selectionEnd } = textarea;\n              const text = textarea.value;\n              const newText =\n                text.slice(0, selectionStart) +\n                emojiWithSpace +\n                text.slice(selectionEnd);\n              textarea.value = newText;\n              textarea.selectionStart = textarea.selectionEnd =\n                selectionEnd + emojiWithSpace.length;\n              textarea.focus();\n              textarea.dispatchEvent(new Event('input'));\n            }}\n          />\n        </Modal>\n      )}\n    </div>\n  );\n}\n\nfunction autoResizeTextarea(textarea) {\n  if (!textarea) return;\n  const { value, offsetHeight, scrollHeight, clientHeight } = textarea;\n  if (offsetHeight < window.innerHeight) {\n    // NOTE: This check is needed because the offsetHeight return 50000 (really large number) on first render\n    // No idea why it does that, will re-investigate in far future\n    const offset = offsetHeight - clientHeight;\n    const height = value ? scrollHeight + offset + 'px' : null;\n    textarea.style.height = height;\n  }\n}\n\nconst Textarea = forwardRef((props, ref) => {\n  const { masto } = api();\n  const [text, setText] = useState(ref.current?.value || '');\n  const { maxCharacters, performSearch = () => {}, ...textareaProps } = props;\n  const snapStates = useSnapshot(states);\n  // const charCount = snapStates.composerCharacterCount;\n\n  const customEmojis = useRef();\n  useEffect(() => {\n    (async () => {\n      try {\n        const emojis = await masto.v1.customEmojis.list();\n        console.log({ emojis });\n        customEmojis.current = emojis;\n      } catch (e) {\n        // silent fail\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  const textExpanderRef = useRef();\n  const textExpanderTextRef = useRef('');\n  useEffect(() => {\n    let handleChange, handleValue, handleCommited;\n    if (textExpanderRef.current) {\n      handleChange = (e) => {\n        // console.log('text-expander-change', e);\n        const { key, provide, text } = e.detail;\n        textExpanderTextRef.current = text;\n\n        if (text === '') {\n          provide(\n            Promise.resolve({\n              matched: false,\n            }),\n          );\n          return;\n        }\n\n        if (key === ':') {\n          // const emojis = customEmojis.current.filter((emoji) =>\n          //   emoji.shortcode.startsWith(text),\n          // );\n          const emojis = filterShortcodes(customEmojis.current, text);\n          let html = '';\n          emojis.forEach((emoji) => {\n            const { shortcode, url } = emoji;\n            html += `\n                <li role=\"option\" data-value=\"${encodeHTML(shortcode)}\">\n                <img src=\"${encodeHTML(\n                  url,\n                )}\" width=\"16\" height=\"16\" alt=\"\" loading=\"lazy\" /> \n                :${encodeHTML(shortcode)}:\n              </li>`;\n          });\n          // console.log({ emojis, html });\n          menu.innerHTML = html;\n          provide(\n            Promise.resolve({\n              matched: emojis.length > 0,\n              fragment: menu,\n            }),\n          );\n          return;\n        }\n\n        const type = {\n          '@': 'accounts',\n          '#': 'hashtags',\n        }[key];\n        provide(\n          new Promise((resolve) => {\n            const searchResults = performSearch({\n              type,\n              q: text,\n              limit: 5,\n            });\n            searchResults.then((value) => {\n              if (text !== textExpanderTextRef.current) {\n                return;\n              }\n              console.log({ value, type, v: value[type] });\n              const results = value[type] || value;\n              console.log('RESULTS', value, results);\n              let html = '';\n              results.forEach((result) => {\n                const {\n                  name,\n                  avatarStatic,\n                  displayName,\n                  username,\n                  acct,\n                  emojis,\n                  history,\n                } = result;\n                const displayNameWithEmoji = emojifyText(displayName, emojis);\n                // const item = menuItem.cloneNode();\n                if (acct) {\n                  html += `\n                    <li role=\"option\" data-value=\"${encodeHTML(acct)}\">\n                      <span class=\"avatar\">\n                        <img src=\"${encodeHTML(\n                          avatarStatic,\n                        )}\" width=\"16\" height=\"16\" alt=\"\" loading=\"lazy\" />\n                      </span>\n                      <span>\n                        <b>${displayNameWithEmoji || username}</b>\n                        <br>@${encodeHTML(acct)}\n                      </span>\n                    </li>\n                  `;\n                } else {\n                  const total = history?.reduce?.(\n                    (acc, cur) => acc + +cur.uses,\n                    0,\n                  );\n                  html += `\n                    <li role=\"option\" data-value=\"${encodeHTML(name)}\">\n                      <span class=\"grow\">#<b>${encodeHTML(name)}</b></span>\n                      ${\n                        total\n                          ? `<span class=\"count\">${shortenNumber(total)}</span>`\n                          : ''\n                      }\n                    </li>\n                  `;\n                }\n                menu.innerHTML = html;\n              });\n              console.log('MENU', results, menu);\n              resolve({\n                matched: results.length > 0,\n                fragment: menu,\n              });\n            });\n          }),\n        );\n      };\n\n      textExpanderRef.current.addEventListener(\n        'text-expander-change',\n        handleChange,\n      );\n\n      handleValue = (e) => {\n        const { key, item } = e.detail;\n        if (key === ':') {\n          e.detail.value = `:${item.dataset.value}:`;\n        } else {\n          e.detail.value = `${key}${item.dataset.value}`;\n        }\n      };\n\n      textExpanderRef.current.addEventListener(\n        'text-expander-value',\n        handleValue,\n      );\n\n      handleCommited = (e) => {\n        const { input } = e.detail;\n        setText(input.value);\n        // fire input event\n        if (ref.current) {\n          const event = new Event('input', { bubbles: true });\n          ref.current.dispatchEvent(event);\n        }\n      };\n\n      textExpanderRef.current.addEventListener(\n        'text-expander-committed',\n        handleCommited,\n      );\n    }\n\n    return () => {\n      if (textExpanderRef.current) {\n        textExpanderRef.current.removeEventListener(\n          'text-expander-change',\n          handleChange,\n        );\n        textExpanderRef.current.removeEventListener(\n          'text-expander-value',\n          handleValue,\n        );\n        textExpanderRef.current.removeEventListener(\n          'text-expander-committed',\n          handleCommited,\n        );\n      }\n    };\n  }, []);\n\n  useEffect(() => {\n    // Resize observer for textarea\n    const textarea = ref.current;\n    if (!textarea) return;\n    const resizeObserver = new ResizeObserver(() => {\n      // Get height of textarea, set height to textExpander\n      const { height } = textarea.getBoundingClientRect();\n      textExpanderRef.current.style.height = height + 'px';\n    });\n    resizeObserver.observe(textarea);\n  }, []);\n\n  const composeHighlightRef = useRef();\n  const throttleHighlightText = useThrottledCallback((text) => {\n    composeHighlightRef.current.innerHTML =\n      highlightText(text, {\n        maxCharacters,\n      }) + '\\n';\n    // Newline to prevent multiple line breaks at the end from being collapsed, no idea why\n  }, 500);\n\n  return (\n    <text-expander\n      ref={textExpanderRef}\n      keys=\"@ # :\"\n      class=\"compose-field-container\"\n    >\n      <textarea\n        class=\"compose-field\"\n        autoCapitalize=\"sentences\"\n        autoComplete=\"on\"\n        autoCorrect=\"on\"\n        spellCheck=\"true\"\n        dir=\"auto\"\n        rows=\"6\"\n        cols=\"50\"\n        {...textareaProps}\n        ref={ref}\n        name=\"status\"\n        value={text}\n        onKeyDown={(e) => {\n          // Get line before cursor position after pressing 'Enter'\n          const { key, target } = e;\n          if (key === 'Enter') {\n            try {\n              const { value, selectionStart } = target;\n              const textBeforeCursor = value.slice(0, selectionStart);\n              const lastLine = textBeforeCursor.split('\\n').slice(-1)[0];\n              if (lastLine) {\n                // If line starts with \"- \" or \"12. \"\n                if (/^\\s*(-|\\d+\\.)\\s/.test(lastLine)) {\n                  // insert \"- \" at cursor position\n                  const [_, preSpaces, bullet, postSpaces, anything] =\n                    lastLine.match(/^(\\s*)(-|\\d+\\.)(\\s+)(.+)?/) || [];\n                  if (anything) {\n                    e.preventDefault();\n                    const [number] = bullet.match(/\\d+/) || [];\n                    const newBullet = number ? `${+number + 1}.` : '-';\n                    const text = `\\n${preSpaces}${newBullet}${postSpaces}`;\n                    target.setRangeText(text, selectionStart, selectionStart);\n                    const pos = selectionStart + text.length;\n                    target.setSelectionRange(pos, pos);\n                  } else {\n                    // trim the line before the cursor, then insert new line\n                    const pos = selectionStart - lastLine.length;\n                    target.setRangeText('', pos, selectionStart);\n                  }\n                  autoResizeTextarea(target);\n                }\n              }\n            } catch (e) {\n              // silent fail\n              console.error(e);\n            }\n          }\n        }}\n        onInput={(e) => {\n          const { target } = e;\n          const text = target.value;\n          setText(text);\n          autoResizeTextarea(target);\n          props.onInput?.(e);\n          throttleHighlightText(text);\n        }}\n        style={{\n          width: '100%',\n          height: '4em',\n          // '--text-weight': (1 + charCount / 140).toFixed(1) || 1,\n        }}\n        onScroll={(e) => {\n          const { scrollTop } = e.target;\n          composeHighlightRef.current.scrollTop = scrollTop;\n        }}\n      />\n      <div\n        ref={composeHighlightRef}\n        class=\"compose-highlight\"\n        aria-hidden=\"true\"\n      />\n    </text-expander>\n  );\n});\n\nfunction CharCountMeter({ maxCharacters = 500, hidden }) {\n  const snapStates = useSnapshot(states);\n  const charCount = snapStates.composerCharacterCount;\n  const leftChars = maxCharacters - charCount;\n  if (hidden) {\n    return <meter class=\"donut\" hidden />;\n  }\n  return (\n    <meter\n      class={`donut ${\n        leftChars <= -10\n          ? 'explode'\n          : leftChars <= 0\n          ? 'danger'\n          : leftChars <= 20\n          ? 'warning'\n          : ''\n      }`}\n      value={charCount}\n      max={maxCharacters}\n      data-left={leftChars}\n      title={`${leftChars}/${maxCharacters}`}\n      style={{\n        '--percentage': (charCount / maxCharacters) * 100,\n      }}\n    />\n  );\n}\n\nfunction MediaAttachment({\n  attachment,\n  disabled,\n  lang,\n  onDescriptionChange = () => {},\n  onRemove = () => {},\n}) {\n  const supportsEdit = supports('@mastodon/edit-media-attributes');\n  const { type, id, file } = attachment;\n  const url = useMemo(\n    () => (file ? URL.createObjectURL(file) : attachment.url),\n    [file, attachment.url],\n  );\n  console.log({ attachment });\n  const [description, setDescription] = useState(attachment.description);\n  const suffixType = type.split('/')[0];\n  const debouncedOnDescriptionChange = useDebouncedCallback(\n    onDescriptionChange,\n    250,\n  );\n\n  const [showModal, setShowModal] = useState(false);\n  const textareaRef = useRef(null);\n  useEffect(() => {\n    let timer;\n    if (showModal && textareaRef.current) {\n      timer = setTimeout(() => {\n        textareaRef.current.focus();\n      }, 100);\n    }\n    return () => {\n      clearTimeout(timer);\n    };\n  }, [showModal]);\n\n  const descTextarea = (\n    <>\n      {!!id && !supportsEdit ? (\n        <div class=\"media-desc\">\n          <span class=\"tag\">Uploaded</span>\n          <p title={description}>\n            {attachment.description || <i>No description</i>}\n          </p>\n        </div>\n      ) : (\n        <textarea\n          ref={textareaRef}\n          value={description || ''}\n          lang={lang}\n          placeholder={\n            {\n              image: 'Image description',\n              video: 'Video description',\n              audio: 'Audio description',\n            }[suffixType]\n          }\n          autoCapitalize=\"sentences\"\n          autoComplete=\"on\"\n          autoCorrect=\"on\"\n          spellCheck=\"true\"\n          dir=\"auto\"\n          disabled={disabled}\n          maxlength=\"1500\" // Not unicode-aware :(\n          // TODO: Un-hard-code this maxlength, ref: https://github.com/mastodon/mastodon/blob/b59fb28e90bc21d6fd1a6bafd13cfbd81ab5be54/app/models/media_attachment.rb#L39\n          onInput={(e) => {\n            const { value } = e.target;\n            setDescription(value);\n            debouncedOnDescriptionChange(value);\n          }}\n        ></textarea>\n      )}\n    </>\n  );\n\n  return (\n    <>\n      <div class=\"media-attachment\">\n        <div\n          class=\"media-preview\"\n          tabIndex=\"0\"\n          onClick={() => {\n            setShowModal(true);\n          }}\n        >\n          {suffixType === 'image' ? (\n            <img src={url} alt=\"\" />\n          ) : suffixType === 'video' || suffixType === 'gifv' ? (\n            <video src={url} playsinline muted />\n          ) : suffixType === 'audio' ? (\n            <audio src={url} controls />\n          ) : null}\n        </div>\n        {descTextarea}\n        <div class=\"media-aside\">\n          <button\n            type=\"button\"\n            class=\"plain close-button\"\n            disabled={disabled}\n            onClick={onRemove}\n          >\n            <Icon icon=\"x\" />\n          </button>\n        </div>\n      </div>\n      {showModal && (\n        <Modal\n          class=\"light\"\n          onClick={(e) => {\n            if (e.target === e.currentTarget) {\n              setShowModal(false);\n            }\n          }}\n        >\n          <div id=\"media-sheet\" class=\"sheet sheet-max\">\n            <button\n              type=\"button\"\n              class=\"sheet-close\"\n              onClick={() => {\n                setShowModal(false);\n              }}\n            >\n              <Icon icon=\"x\" />\n            </button>\n            <header>\n              <h2>\n                {\n                  {\n                    image: 'Edit image description',\n                    video: 'Edit video description',\n                    audio: 'Edit audio description',\n                  }[suffixType]\n                }\n              </h2>\n            </header>\n            <main tabIndex=\"-1\">\n              <div class=\"media-preview\">\n                {suffixType === 'image' ? (\n                  <img src={url} alt=\"\" />\n                ) : suffixType === 'video' || suffixType === 'gifv' ? (\n                  <video src={url} playsinline controls />\n                ) : suffixType === 'audio' ? (\n                  <audio src={url} controls />\n                ) : null}\n              </div>\n              <div class=\"media-form\">\n                {descTextarea}\n                <footer>\n                  <button\n                    type=\"button\"\n                    class=\"light block\"\n                    onClick={() => {\n                      setShowModal(false);\n                    }}\n                  >\n                    Done\n                  </button>\n                </footer>\n              </div>\n            </main>\n          </div>\n        </Modal>\n      )}\n    </>\n  );\n}\n\nfunction Poll({\n  lang,\n  poll,\n  disabled,\n  onInput = () => {},\n  maxOptions,\n  maxExpiration,\n  minExpiration,\n  maxCharactersPerOption,\n}) {\n  const { options, expiresIn, multiple } = poll;\n\n  return (\n    <div class={`poll ${multiple ? 'multiple' : ''}`}>\n      <div class=\"poll-choices\">\n        {options.map((option, i) => (\n          <div class=\"poll-choice\" key={i}>\n            <input\n              required\n              type=\"text\"\n              value={option}\n              disabled={disabled}\n              maxlength={maxCharactersPerOption}\n              placeholder={`Choice ${i + 1}`}\n              lang={lang}\n              spellCheck=\"true\"\n              dir=\"auto\"\n              onInput={(e) => {\n                const { value } = e.target;\n                options[i] = value;\n                onInput(poll);\n              }}\n            />\n            <button\n              type=\"button\"\n              class=\"plain2 poll-button\"\n              disabled={disabled || options.length <= 1}\n              onClick={() => {\n                options.splice(i, 1);\n                onInput(poll);\n              }}\n            >\n              <Icon icon=\"x\" size=\"s\" />\n            </button>\n          </div>\n        ))}\n      </div>\n      <div class=\"poll-toolbar\">\n        <button\n          type=\"button\"\n          class=\"plain2 poll-button\"\n          disabled={disabled || options.length >= maxOptions}\n          onClick={() => {\n            options.push('');\n            onInput(poll);\n          }}\n        >\n          +\n        </button>{' '}\n        <label class=\"multiple-choices\">\n          <input\n            type=\"checkbox\"\n            checked={multiple}\n            disabled={disabled}\n            onChange={(e) => {\n              const { checked } = e.target;\n              poll.multiple = checked;\n              onInput(poll);\n            }}\n          />{' '}\n          Multiple choices\n        </label>\n        <label class=\"expires-in\">\n          Duration{' '}\n          <select\n            value={expiresIn}\n            disabled={disabled}\n            onChange={(e) => {\n              const { value } = e.target;\n              poll.expiresIn = value;\n              onInput(poll);\n            }}\n          >\n            {Object.entries(expiryOptions)\n              .filter(([label, value]) => {\n                return value >= minExpiration && value <= maxExpiration;\n              })\n              .map(([label, value]) => (\n                <option value={value} key={value}>\n                  {label}\n                </option>\n              ))}\n          </select>\n        </label>\n      </div>\n      <div class=\"poll-toolbar\">\n        <button\n          type=\"button\"\n          class=\"plain remove-poll-button\"\n          disabled={disabled}\n          onClick={() => {\n            onInput(null);\n          }}\n        >\n          Remove poll\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction filterShortcodes(emojis, searchTerm) {\n  searchTerm = searchTerm.toLowerCase();\n\n  // Return an array of shortcodes that start with or contain the search term, sorted by relevance and limited to the first 5\n  return emojis\n    .sort((a, b) => {\n      let aLower = a.shortcode.toLowerCase();\n      let bLower = b.shortcode.toLowerCase();\n\n      let aStartsWith = aLower.startsWith(searchTerm);\n      let bStartsWith = bLower.startsWith(searchTerm);\n      let aContains = aLower.includes(searchTerm);\n      let bContains = bLower.includes(searchTerm);\n      let bothStartWith = aStartsWith && bStartsWith;\n      let bothContain = aContains && bContains;\n\n      return bothStartWith\n        ? a.length - b.length\n        : aStartsWith\n        ? -1\n        : bStartsWith\n        ? 1\n        : bothContain\n        ? a.length - b.length\n        : aContains\n        ? -1\n        : bContains\n        ? 1\n        : 0;\n    })\n    .slice(0, 5);\n}\n\nfunction encodeHTML(str) {\n  return str.replace(/[&<>\"']/g, function (char) {\n    return '&#' + char.charCodeAt(0) + ';';\n  });\n}\n\nfunction removeNullUndefined(obj) {\n  for (let key in obj) {\n    if (obj[key] === null || obj[key] === undefined) {\n      delete obj[key];\n    }\n  }\n  return obj;\n}\n\nfunction CustomEmojisModal({\n  masto,\n  instance,\n  onClose = () => {},\n  onSelect = () => {},\n}) {\n  const [uiState, setUIState] = useState('default');\n  const customEmojisList = useRef([]);\n  const [customEmojis, setCustomEmojis] = useState({});\n  const recentlyUsedCustomEmojis = useMemo(\n    () => store.account.get('recentlyUsedCustomEmojis') || [],\n  );\n  useEffect(() => {\n    setUIState('loading');\n    (async () => {\n      try {\n        const emojis = await masto.v1.customEmojis.list();\n        // Group emojis by category\n        const emojisCat = {\n          '--recent--': recentlyUsedCustomEmojis.filter((emoji) =>\n            emojis.find((e) => e.shortcode === emoji.shortcode),\n          ),\n        };\n        const othersCat = [];\n        emojis.forEach((emoji) => {\n          if (!emoji.visibleInPicker) return;\n          customEmojisList.current?.push?.(emoji);\n          if (!emoji.category) {\n            othersCat.push(emoji);\n            return;\n          }\n          if (!emojisCat[emoji.category]) {\n            emojisCat[emoji.category] = [];\n          }\n          emojisCat[emoji.category].push(emoji);\n        });\n        if (othersCat.length) {\n          emojisCat['--others--'] = othersCat;\n        }\n        setCustomEmojis(emojisCat);\n        setUIState('default');\n      } catch (e) {\n        setUIState('error');\n        console.error(e);\n      }\n    })();\n  }, []);\n\n  return (\n    <div id=\"custom-emojis-sheet\" class=\"sheet\">\n      {!!onClose && (\n        <button type=\"button\" class=\"sheet-close\" onClick={onClose}>\n          <Icon icon=\"x\" />\n        </button>\n      )}\n      <header>\n        <b>Custom emojis</b>{' '}\n        {uiState === 'loading' ? (\n          <Loader />\n        ) : (\n          <small class=\"insignificant\"> • {instance}</small>\n        )}\n      </header>\n      <main>\n        <div class=\"custom-emojis-list\">\n          {uiState === 'error' && (\n            <div class=\"ui-state\">\n              <p>Error loading custom emojis</p>\n            </div>\n          )}\n          {uiState === 'default' &&\n            Object.entries(customEmojis).map(\n              ([category, emojis]) =>\n                !!emojis?.length && (\n                  <>\n                    <div class=\"section-header\">\n                      {{\n                        '--recent--': 'Recently used',\n                        '--others--': 'Others',\n                      }[category] || category}\n                    </div>\n                    <section>\n                      {emojis.map((emoji) => (\n                        <button\n                          key={emoji}\n                          type=\"button\"\n                          class=\"plain4\"\n                          onClick={() => {\n                            onClose();\n                            requestAnimationFrame(() => {\n                              onSelect(`:${emoji.shortcode}:`);\n                            });\n                            let recentlyUsedCustomEmojis =\n                              store.account.get('recentlyUsedCustomEmojis') ||\n                              [];\n                            const recentlyUsedEmojiIndex =\n                              recentlyUsedCustomEmojis.findIndex(\n                                (e) => e.shortcode === emoji.shortcode,\n                              );\n                            if (recentlyUsedEmojiIndex !== -1) {\n                              // Move emoji to index 0\n                              recentlyUsedCustomEmojis.splice(\n                                recentlyUsedEmojiIndex,\n                                1,\n                              );\n                              recentlyUsedCustomEmojis.unshift(emoji);\n                            } else {\n                              recentlyUsedCustomEmojis.unshift(emoji);\n                              // Remove unavailable ones\n                              recentlyUsedCustomEmojis =\n                                recentlyUsedCustomEmojis.filter((e) =>\n                                  customEmojisList.current?.find?.(\n                                    (emoji) => emoji.shortcode === e.shortcode,\n                                  ),\n                                );\n                              // Limit to 10\n                              recentlyUsedCustomEmojis =\n                                recentlyUsedCustomEmojis.slice(0, 10);\n                            }\n\n                            // Store back\n                            store.account.set(\n                              'recentlyUsedCustomEmojis',\n                              recentlyUsedCustomEmojis,\n                            );\n                          }}\n                          title={`:${emoji.shortcode}:`}\n                        >\n                          <picture>\n                            {!!emoji.staticUrl && (\n                              <source\n                                srcset={emoji.staticUrl}\n                                media=\"(prefers-reduced-motion: reduce)\"\n                              />\n                            )}\n                            <img\n                              class=\"shortcode-emoji\"\n                              src={emoji.url || emoji.staticUrl}\n                              alt={emoji.shortcode}\n                              width=\"16\"\n                              height=\"16\"\n                              loading=\"lazy\"\n                              decoding=\"async\"\n                            />\n                          </picture>\n                        </button>\n                      ))}\n                    </section>\n                  </>\n                ),\n            )}\n        </div>\n      </main>\n    </div>\n  );\n}\n\nexport default Compose;\n","import { useLayoutEffect } from 'preact/hooks';\nimport { matchPath } from 'react-router-dom';\nimport { subscribeKey } from 'valtio/utils';\n\nimport states from './states';\n\nconst { VITE_CLIENT_NAME: CLIENT_NAME } = import.meta.env;\n\nexport default function useTitle(title, path) {\n  function setTitle() {\n    const { currentLocation } = states;\n    const hasPaths = Array.isArray(path);\n    let paths = hasPaths ? path : [];\n    // Workaround for matchPath not working for optional path segments\n    // https://github.com/remix-run/react-router/discussions/9862\n    if (!hasPaths && /:?\\w+\\?/.test(path)) {\n      paths.push(path.replace(/(:\\w+)\\?/g, '$1'));\n      paths.push(path.replace(/\\/?:\\w+\\?/g, ''));\n    }\n    let matched = false;\n    if (paths.length) {\n      matched = paths.some((p) => matchPath(p, currentLocation));\n    } else if (path) {\n      matched = matchPath(path, currentLocation);\n    }\n    console.debug('setTitle', { title, path, currentLocation, paths, matched });\n    if (matched) {\n      document.title = title ? `${title} / ${CLIENT_NAME}` : CLIENT_NAME;\n    }\n  }\n\n  useLayoutEffect(() => {\n    const unsub = subscribeKey(states, 'currentLocation', setTitle);\n    setTitle();\n    return unsub;\n  }, [title, path]);\n}\n"],"file":"assets/useTitle-4c1d8f3a.js"}