import{a as B,s as S,b as Ie,u as gn,o as Jn,I as w,M as ge,c as Z,A as Ge,N as vt,d as Ne,L as K,g as tt,e as bn,l as Xn,t as Wt,f as de,R as Tt,h as Zn,p as nt,i as Fe,j as yn,k as Mt,E as wn,m as Pe,n as He,q as Qn,r as ve,v as Kt,T as vn,w as ot,x as Sn,y as Yt,z as es,B as xe,C as ts,S as Te,D as ns,F as ss,G as kn,H as In,J as zt,K as $e,O as Tn,P as is,Q as os,U as cs,V as ht,W as as,X as Jt,Y as rs,Z as Xt,_ as Zt}from"./useTitle-8c5616c0.js";import{_ as D,p as U,x as Be,h as C,c as St,u as Ce,o as e,a as he,k as $,s as Ct,b as Cn,M as Ke,d as te,e as De,f as st,F as me,T as We,S as ls,I as it,y as ze,g as $n,l as Qt,i as xn,j as Ln,m as ds,n as Oe,A as us,q as hs,J as fs,C as Rn,r as Ye,t as ps,v as ms,w as at,z as An,B as en,D as gs,E as bs,R as Bt,G as we,H as ys,K as ws}from"./vendor-07e2fc23.js";function kt(t=()=>{},n=[]){const c=D(t);U(()=>{c.current=t},[n]),U(()=>{const o=()=>{const s=document.hidden||document.visibilityState==="hidden";c.current(!s)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[])}const vs=Be(function({isLoggedIn:n}){const[c,o]=C(!0);kt(o);const s=D(),i=St(()=>{const{masto:u,streaming:l,instance:h}=B();(async()=>{var f;if(S.notificationsLast){const b=u.v1.notifications.list({limit:1,since_id:S.notificationsLast.id}),{value:a}=await b.next();if(a!=null&&a.length){let m;try{const p=await u.v1.markers.fetch({timeline:"notifications"});m=(f=p==null?void 0:p.notifications)==null?void 0:f.lastReadId}catch{}m?S.notificationsShowNew=a[0].id!==m:S.notificationsShowNew=!0}}if(l){let b=s.current=l.user.notification.subscribe();for await(const a of b){if(!b)break;a.event==="notification"&&Ie(a.payload,h,{skipThreading:!0}),S.notificationsShowNew=!0}}})()},3e3);U(()=>(n&&c&&i(),()=>{var u,l,h;(u=i==null?void 0:i.cancel)==null||u.call(i),(h=(l=s.current)==null?void 0:l.unsubscribe)==null||h.call(l),s.current=null}),[c,n]);const d=D(),r=()=>{d.current=Date.now(),fetch("./version.json").then(u=>u.json()).then(u=>{u&&(S.appVersion=u)}).catch(u=>{})};return gn(r,c&&1e3*60*30),kt(u=>{u&&(d.current?Date.now()-d.current>1e3*60*60&&r():r())}),null});function Ss(){function t(n){n.shiftKey?Jn()||(alert("Looks like your browser is blocking popups."),S.showCompose=!0):S.showCompose=!0}return Ce("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const ks=Be(function(){const n=he(S);function c(){S.showKeyboardShortcutsHelp=!1}Ce("?, shift+?",s=>{S.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:s=>!!document.querySelector("#modal-container > *")});const o=Ce("esc",c,[]);return!!n.showKeyboardShortcutsHelp&&e(ge,{class:"light",onClick:s=>{s.target===s.currentTarget&&c()},children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:o,children:[e("button",{type:"button",class:"sheet-close",onClick:c,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e($,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e($,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e($,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e($,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e($,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Send post",keys:e($,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Favourite",keys:e("kbd",{children:"f"})},{action:"Boost",keys:e($,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})}].map(({action:s,keys:i})=>e("tr",{children:[e("th",{children:s}),e("td",{children:i})]},s))})})]})})});function Is({onClose:t}){const{masto:n}=B(),c=Z.local.getJSON("accounts"),o=Z.session.get("currentAccount"),s=c.length>1,[i,d]=Ct(u=>u+1,0),[r]=Cn();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:r,children:c.map((u,l)=>{const h=u.info.id===o,f=l===0;return e("li",{children:[e("div",{children:[s&&e("span",{class:`current ${h?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(Ge,{url:u.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(h)try{const b=await n.v1.accounts.$select(u.info.id).fetch();u.info=b,Z.local.setJSON("accounts",c),d()}catch{}}}),e(vt,{account:s?{...u.info,acct:/@/.test(u.info.acct)?u.info.acct:`${u.info.acct}@${u.instanceURL}`}:u.info,showAcct:!0,onClick:()=>{h?S.showAccount=`${u.info.username}@${u.instanceURL}`:(Z.session.set("currentAccount",u.info.id),location.reload())}})]}),e("div",{class:"actions",children:[f&&s&&e($,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Ke,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(te,{onClick:()=>{S.showAccount=`${u.info.username}@${u.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(De,{}),s&&e(te,{disabled:f,onClick:()=>{c.splice(l,1),c.unshift(u),Z.local.setJSON("accounts",c),d()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Ne,{subMenu:!0,confirmLabel:e($,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",u.info.acct,"?"]})]}),disabled:!h,menuItemClassName:"danger",onClick:()=>{c.splice(l,1),Z.local.setJSON("accounts",c),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},u.info.id)})}),e("p",{children:e(K,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),s&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const Mn=""+new URL("logo-f0531a6b.svg",import.meta.url).href;function tn(t){const{masto:n}=B();return n.v1.push.subscription.create(t)}function Ts(){const{masto:t}=B();return t.v1.push.subscription.fetch()}function Cs(t){const{masto:n}=B();return n.v1.push.subscription.update(t)}function $s(){const{masto:t}=B();return t.v1.push.subscription.remove()}function $t(){return"serviceWorker"in navigator&&"PushManager"in window}function xs(){return navigator.serviceWorker.getRegistration()}async function Ot(){const t=await xs(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Dn(t){const n="=".repeat((4-t.length%4)%4),c=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(c),s=new Uint8Array(o.length);for(let i=0;i<o.length;++i)s[i]=o.charCodeAt(i);return s}async function Ls(){if(!$t())return;const{subscription:t}=await Ot();let n=null;try{n=await Ts()}catch(c){if(!/(not found|unknown)/i.test(c.message))throw c}if(n&&t){const c=n.endpoint===t.endpoint,{vapidKey:o}=tt(),s=n.serverKey===o;if(!c)throw new Error("Backend subscription endpoint changed");if(!s)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:c}=tt(),{applicationServerKey:o}=t.options,s=Dn(c).toString(),i=new Uint8Array(o).toString();if(!(s===i))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function nn({data:t,policy:n}){if(!$t())return;let{registration:c,subscription:o}=await Ot(),s=null;if(o)try{s=await Cs({data:t,policy:n})}catch{s=await tn({subscription:o,data:t,policy:n})}else{const{vapidKey:i}=tt();if(!i)throw new Error("No server key found");o=await c.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Dn(i)}),s=await tn({subscription:o,data:t,policy:n})}return{subscription:o,backendSubscription:s}}async function sn(){if(!$t())return;const{subscription:t}=await Ot();t&&(await $s(),await t.unsubscribe())}const on=16,je=[16,17,18,19,20];function Rs({onClose:t}){const n=he(S),c=Z.local.get("theme")||"auto",o=D(),s=n.settings.contentTranslationTargetLanguage||null,i=bn(),d=Xn(i),r=Z.local.get("textSize")||on,[u,l]=C(Z.account.get("preferences")||{}),{masto:h,authenticated:f,instance:b}=B();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:o,onInput:a=>{a.preventDefault();const p=new FormData(o.current).get("theme"),y=document.documentElement;p==="auto"?y.classList.remove("is-light","is-dark"):(y.classList.toggle("is-light",p==="light"),y.classList.toggle("is-dark",p==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",p==="auto"?"dark light":p),p==="auto"?Z.local.del("theme"):Z.local.set("theme",p)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:c==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:c==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:c!=="light"&&c!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:je[0]},children:"A"})," ",e("input",{type:"range",min:je[0],max:je[je.length-1],step:"1",value:r,list:"sizes",onChange:a=>{const m=parseInt(a.target.value,10);document.documentElement.style.setProperty("--text-size",`${m}px`),m===on?Z.local.del("textSize"):Z.local.set("textSize",a.target.value)}})," ",e("span",{style:{fontSize:je[je.length-1]},children:"A"}),e("datalist",{id:"sizes",children:je.map(a=>e("option",{value:a}))})]})]})]})}),f&&e($,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:u["posting:default:visibility"]||"public",onChange:a=>{const{value:m}=a.target;(async()=>{try{await h.v1.accounts.updateCredentials({source:{privacy:m}}),l({...u,"posting:default:visibility":m}),Z.account.set("preferences",{...u,"posting:default:visibility":m})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${b}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",b,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:a=>{S.settings.autoRefresh=a.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:a=>{S.settings.boostsCarousel=a.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:a=>{const{checked:m}=a.target;S.settings.contentTranslation=m,m||(S.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:s||"",disabled:!n.settings.contentTranslation,onChange:a=>{S.settings.contentTranslationTargetLanguage=a.target.value||null},children:[e("option",{value:"",children:["System language (",d,")"]}),e("option",{disabled:!0,children:"──────────"}),Wt.map(a=>e("option",{value:a.code,children:a.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e($,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Wt.map(a=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(a.code),onChange:m=>{const{checked:p}=m.target;p?S.settings.contentTranslationHideLanguages.push(a.code):S.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(y=>y!==a.code)}})," ",a.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses an external API to translate, powered by"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:a=>{S.settings.contentTranslationAutoInline=a.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:a=>{S.settings.cloakMode=a.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),f&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{S.showDrafts=!0,S.showSettings=!1},children:"Unsent drafts"})})]})}),f&&e(As,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:Mn,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),S.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),S.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:["Version:"," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2023-10-24T15:33:18.798Z".slice(0,10).replace(/-/g,".")}.393847c`,onClick:a=>{a.target.select();try{navigator.clipboard.writeText(a.target.value),de("Version string copied")}catch{de("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/393847c",target:"_blank",rel:"noopener noreferrer",children:e(Tt,{datetime:new Date("2023-10-24T15:33:18.798Z")})}),")"]})]})]})]})]})}function As({onClose:t}){if(!$t())return null;const{instance:n}=B(),[c,o]=C("default"),s=D(),[i,d]=C(!1),[r,u]=C(!1),l=D();U(()=>{(async()=>{o("loading");try{const{subscription:f,backendSubscription:b}=await Ls();if(b!=null&&b.policy&&b.policy!=="none"){d(!0);const{alerts:a,policy:m}=b;l.current=m;const{elements:p}=s.current,y=p.namedItem(m);y&&(y.value=m),Object.keys(a).forEach(g=>{const v=p.namedItem(g);(v==null?void 0:v.type)==="checkbox"&&(v.checked=!0)})}o("default")}catch(f){/outside.*authorized/i.test(f.message)?u(!0):alert((f==null?void 0:f.message)||f),o("error")}})()},[]);const h=c==="loading";return e("form",{ref:s,onChange:()=>{const f=Object.fromEntries(new FormData(s.current)),b=!!f["policy-allow"],a={policy:f.policy,data:{alerts:{mention:!!f.mention,favourite:!!f.favourite,reblog:!!f.reblog,follow:!!f.follow,follow_request:!!f.followRequest,poll:!!f.poll,update:!!f.update,status:!!f.status}}};let m=0;Object.keys(a.data.alerts).forEach(y=>{a.data.alerts[y]?m++:delete a.data.alerts[y]});const p=l.current!==a.policy;b&&m>0?p?sn().then(()=>{nn(a)}).catch(y=>{alert("Failed to update subscription. Please try again.")}):nn(a).catch(y=>{alert("Failed to update subscription. Please try again.")}):sn().catch(y=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:h||r,name:"policy-allow",checked:i,onChange:async f=>{const{checked:b}=f.target;if(b){const a=await Notification.requestPermission();a==="granted"?d(!0):(d(!1),a==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else d(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:h||r||!i,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(f=>e("option",{value:f.value,children:f.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!i,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Favourites"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(f=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:f.value})," ",f.label]})}))})})})}),r&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(K,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const Dt=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const c=document.querySelectorAll("#modal-container > *");if(c!=null&&c.length){const d=c[c.length-1],r=d.querySelector('[tabindex="-1"]')||d;if(r){r.focus();return}}if(document.querySelector(".deck-backdrop"))return;const s=document.querySelectorAll(".deck-container"),i=s[s.length-1];i&&i.tabIndex===-1&&i.focus()}},100);return()=>clearTimeout(t)};function En(t){if(!t)return;const n=st(),c=D(n.pathname);U(()=>{c.current&&n.pathname!==c.current&&(t==null||t())},[n.pathname,t])}function qt({list:t,onClose:n}){const{masto:c}=B(),[o,s]=C("default"),i=!!t,d=D(),r=D(),u=D();U(()=>{i&&(d.current.value=t.title,r.current.value=t.repliesPolicy,u.current&&(u.current.checked=t.exclusive))},[i]);const l=Zn("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:i?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:h=>{h.preventDefault();const f=new FormData(h.target),b=f.get("title"),a=f.get("replies_policy"),m=f.get("exclusive")==="on";s("loading"),(async()=>{try{let p;i?p=await c.v1.lists.$select(t.id).update({title:b,replies_policy:a,exclusive:m}):p=await c.v1.lists.create({title:b,replies_policy:a,exclusive:m}),s("default"),n==null||n({state:"success",list:p})}catch{s("error"),alert(i?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:d,type:"text",id:"list-title",name:"title",required:!0,disabled:o==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:r,name:"replies_policy",required:!0,disabled:o==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),l&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:u,type:"checkbox",name:"exclusive",disabled:o==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:o==="loading",children:i?"Save":"Create"}),i&&e(Ne,{disabled:o==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{s("loading"),(async()=>{try{await c.v1.lists.$select(t.id).remove(),s("default"),n==null||n({state:"deleted"})}catch{s("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete…"})})]})]})})]})}const Ms=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],cn={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},an=80,_n=1e3*60*10;function Ds(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Es=nt(Ds,{maxAge:_n});async function _s(t,n){const c=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:o}=await c,s={total:o.length,originals:0,replies:0,boosts:0};return o.forEach(i=>{i.reblog?s.boosts++:i.inReplyToId&&i.inReplyToAccountId!==i.account.id?s.replies++:s.originals++}),o.length&&(s.daysSinceLastPost=Math.ceil((Date.now()-new Date(o[o.length-1].createdAt))/864e5)),s}const Ps=nt(_s,{maxAge:_n});function Pn({account:t,fetchAccount:n=()=>{},standalone:c,instance:o,authenticated:s}){const{masto:i}=B({instance:o}),{masto:d}=B(),[r,u]=C("default"),l=typeof t=="string",[h,f]=C(l?null:t),b=me(()=>t.id===Z.session.get("currentAccount"),[t==null?void 0:t.id]),a=me(()=>o===B().instance,[o]);U(()=>{if(!l){f(t);return}u("loading"),(async()=>{try{const N=await n();S.accounts[`${N.id}@${o}`]=N,f(N),u("default")}catch{f(null),u("error")}})()},[l,t,n]);const{acct:m,avatar:p,avatarStatic:y,bot:g,createdAt:v,displayName:I,emojis:k,fields:x,followersCount:E,followingCount:A,group:R,id:V,lastStatusAt:F,locked:_,note:O,statusesCount:ne,url:ie,username:Ae,memorial:W,moved:oe,roles:j}=h||{};let M=!1,{header:q,headerStatic:Y}=h||{};(!q||/missing\.png$/.test(q))&&p&&!/missing\.png$/.test(p)&&(q=p,M=!0,y&&!/missing\.png$/.test(y)&&(Y=y));const ae=me(()=>ie?new URL(ie).hostname:null,[ie]),[Se,Le]=C([]),re=D(),z=D([]);async function X(N){(N||!re.current)&&(re.current=i.v1.accounts.$select(V).followers.list({limit:an}));const le=await re.current.next();if(b||!a)return le;const{value:be}=le;let ye=[];if(N){const _e=await i.v1.accounts.familiarFollowers.fetch({id:[V]});z.current=_e[0].accounts,ye=[...z.current,...be.filter(Ue=>!z.current.some(Me=>Me.id===Ue.id))]}else be!=null&&be.length&&(ye=be.filter(_e=>!z.current.some(Ue=>Ue.id===_e.id)));return{...le,value:ye}}const J=D();async function ce(N){return(N||!J.current)&&(J.current=i.v1.accounts.$select(V).following.list({limit:an})),await J.current.next()}const Q=c?"div":K,T=o?`/${o}/a/${V}`:`/a/${V}`,[L,H]=C([]),[P,ee]=C(),[ke,se]=C("default"),ue=!!(P!=null&&P.total),Re=async N=>{try{const le=await Es(N,d);H(le[0].accounts.slice(0,Ns))}catch{}},fe=async()=>{if(V){se("loading");try{const N=await Ps(V,i);ee(N),se("default")}catch{se("error")}}},Ee=We(({relationship:N,currentID:le})=>{N.following||(Re(le),c||fe())},[c,V]);return e("div",{tabIndex:"-1",class:`account-container  ${r==="loading"?"skeleton":""}`,style:{"--header-color-1":Se[0],"--header-color-2":Se[1],"--header-color-3":Se[2],"--header-color-4":Se[3]},children:[r==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:l?t:ie,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),r==="loading"?e($,{children:[e("header",{children:e(Fe,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):h&&e($,{children:[!!oe&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:I})," has indicated that their new account is now:"]}),e(Fe,{account:oe,instance:o,onClick:N=>{N.stopPropagation(),S.showAccount=oe}})]}),!!q&&!/missing\.png$/.test(q)&&e("img",{src:q,alt:"",class:`header-banner ${M?"header-is-avatar":""}`,onError:N=>{N.target.crossOrigin?N.target.src!==Y?N.target.src=Y:(N.target.removeAttribute("crossorigin"),N.target.src=q):N.target.src!==Y?N.target.src=Y:N.target.remove()},crossOrigin:"anonymous",onLoad:N=>{N.target.classList.add("loaded");try{const le=document.createElement("canvas"),be=le.getContext("2d",{willReadFrequently:!0});le.width=N.target.width,le.height=N.target.height,be.drawImage(N.target,0,0);const ye=10,Ue=[be.getImageData(0,0,ye,ye).data,be.getImageData(N.target.width-ye,0,ye,ye).data,be.getImageData(0,N.target.height-ye,ye,ye).data,be.getImageData(N.target.width-ye,N.target.height-ye,ye,ye).data].map(Me=>{let G=0,pe=0,Je=0,dt=0;for(let Xe=0;Xe<Me.length;Xe+=4)G+=Me[Xe],pe+=Me[Xe+1],Je+=Me[Xe+2],dt+=Me[Xe+3];const ut=Me.length/4;return[G/ut,pe/ut,Je/ut,dt/ut]}).map(Me=>{const[G,pe,Je,dt]=Fs(Me);return`rgba(${G}, ${pe}, ${Je}, ${dt})`});Le(Ue)}catch{}}}),e("header",{children:e(Fe,{account:h,instance:o,avatarSize:"xxxl",external:c,internal:!c})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!W&&e("span",{class:"tag",children:"In Memoriam"}),!!g&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!R&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),j==null?void 0:j.map(N=>e("span",{class:"tag",children:[N.name,!!ae&&e($,{children:[" ",e("span",{class:"more-insignificant",children:ae})]})]})),e("div",{class:"note",dir:"auto",onClick:yn({instance:o}),dangerouslySetInnerHTML:{__html:Mt(O,{emojis:k})}}),e("div",{class:"account-metadata-box",children:[(x==null?void 0:x.length)>0&&e("div",{class:"profile-metadata",children:x.map(({name:N,value:le,verifiedAt:be},ye)=>e("div",{class:`profile-field ${be?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(wn,{text:N,emojis:k})," ",!!be&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:Mt(le,{emojis:k})}})]},N+ye))}),e("div",{class:"stats",children:[e(Q,{tabIndex:0,to:T,onClick:()=>{setTimeout(()=>{S.showGenericAccounts={heading:"Followers",fetchAccounts:X}},0)},children:[!!L.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:L.map(N=>e(Ge,{url:N.avatarStatic,size:"s",alt:`${N.displayName} @${N.acct}`,squircle:N==null?void 0:N.bot}))})}),e("span",{title:E,children:Pe(E)})," ","Followers"]}),e(Q,{class:"insignificant",tabIndex:0,to:T,onClick:()=>{setTimeout(()=>{S.showGenericAccounts={heading:"Following",fetchAccounts:ce}},0)},children:[e("span",{title:A,children:Pe(A)})," ","Following",e("br",{})]}),e(Q,{class:"insignificant",to:T,children:[e("span",{title:ne,children:Pe(ne)})," ","Posts"]}),!!v&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:v,children:He(v,{hideTime:!0})})]})]})]}),!!P&&e(Q,{to:T,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:ue?e("div",{class:"posting-stats",title:`${Math.round(P.originals/P.total*100)}% original posts, ${Math.round(P.replies/P.total*100)}% replies, ${Math.round(P.boosts/P.total*100)}% boosts`,children:[e("div",{children:P.daysSinceLastPost<365?`Last ${P.total} post${P.total>1?"s":""} in the past 
                      ${P.daysSinceLastPost} day${P.daysSinceLastPost>1?"s":""}`:`
                      Last ${P.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${P.originals/P.total*100}%`,"--replies-percentage":`${(P.originals+P.replies)/P.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!P,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:ke==="loading",onClick:()=>{fe()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${ke==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(Us,{info:h,instance:o,authenticated:s,onRelationshipChange:Ee})})]})]})}const Ns=3;function Us({info:t,instance:n,authenticated:c,onRelationshipChange:o=()=>{}}){var Q;if(!t)return null;const{masto:s,instance:i,authenticated:d}=B(),r=n===i,[u,l]=C("default"),[h,f]=C(null),{id:b,acct:a,url:m,username:p,locked:y,lastStatusAt:g,note:v,fields:I,moved:k}=t,x=D(b),{following:E,showingReblogs:A,notifying:R,followedBy:V,blocking:F,blockedBy:_,muting:O,mutingNotifications:ne,requested:ie,domainBlocking:Ae,endorsed:W,note:oe}=h||{},[j,M]=C(null),[q,Y]=C(!1);U(()=>{if(t){const T=Z.session.get("currentAccount");let L;(async()=>{if(r&&c)L=b;else if(!r&&d){const P=t.acct.includes("@");try{const ee=await s.v2.search.fetch({q:P?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});ee.accounts.length&&(L=ee.accounts[0].id,M(ee.accounts[0]))}catch{}}if(!L)return;if(T===L){Y(!0);return}if(x.current=L,k)return;l("loading");const H=s.v1.accounts.relationships.fetch({id:[L]});try{const P=await H;if(l("default"),P.length){const ee=P[0];f(ee),o({relationship:ee,currentID:L})}}catch{l("error")}})()}},[t,c]),U(()=>{t&&q&&Qn(t)},[t,q]);const ae=u==="loading",Se=D(null),[Le,re]=C(!1),[z,X]=C(!1),[J,ce]=C(!1);return e($,{children:[e("div",{class:"actions",children:[e("span",{children:[V?e("span",{class:"tag",children:"Following you"}):g?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:He(g,{hideTime:!0})})]}):e("span",{}),O&&e("span",{class:"tag danger",children:"Muted"}),F&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!oe&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{ce(!0)},dir:"auto",children:e("span",{children:oe})}),e(Ke,{instanceRef:Se,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:T=>{var L,H;T.target===T.currentTarget&&((H=(L=Se.current)==null?void 0:L.closeMenu)==null||H.call(L))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:ae,children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[d&&!q&&e($,{children:[e(te,{onClick:()=>{S.showCompose={draftStatus:{status:`@${(j==null?void 0:j.acct)||a} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",p]})]}),e(te,{onClick:()=>{re(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(te,{onClick:()=>{ce(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:oe?"Edit private note":"Add private note"})]}),E&&e(te,{onClick:()=>{X(!0)},children:[e(w,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(De,{})]}),e(te,{href:m,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:zs(m)})]}),e("div",{class:"menu-horizontal",children:[e(te,{onClick:()=>{try{navigator.clipboard.writeText(m),de("Link copied")}catch{de("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((Q=navigator==null?void 0:navigator.canShare)==null?void 0:Q.call(navigator,{url:m}))&&e(te,{onClick:()=>{try{navigator.share({url:m})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!h&&e($,{children:[e(De,{}),O?e(te,{onClick:()=>{l("loading"),(async()=>{try{const T=await s.v1.accounts.$select((j==null?void 0:j.id)||b).unmute();f(T),l("default"),de(`Unmuted @${p}`),S.reloadGenericAccounts.id="mute",S.reloadGenericAccounts.counter++}catch{l("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",p]})]}):e(ls,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e($,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",p,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:Ms.map(T=>e(te,{onClick:()=>{l("loading"),(async()=>{try{const L=await s.v1.accounts.$select((j==null?void 0:j.id)||b).mute({duration:T});f(L),l("default"),de(`Muted @${p} for ${cn[T]}`),S.reloadGenericAccounts.id="mute",S.reloadGenericAccounts.counter++}catch{l("error"),de(`Unable to mute @${p}`)}})()},children:cn[T]}))})}),e(Ne,{subMenu:!0,confirm:!F,confirmLabel:e($,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",p,"?"]})]}),menuItemClassName:"danger",onClick:()=>{l("loading"),(async()=>{try{if(F){const T=await s.v1.accounts.$select((j==null?void 0:j.id)||b).unblock();f(T),l("default"),de(`Unblocked @${p}`)}else{const T=await s.v1.accounts.$select((j==null?void 0:j.id)||b).block();f(T),l("default"),de(`Blocked @${p}`)}S.reloadGenericAccounts.id="block",S.reloadGenericAccounts.counter++}catch{l("error"),F?de(`Unable to unblock @${p}`):de(`Unable to block @${p}`)}})()},children:F?e($,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",p]})]}):e($,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",p,"…"]})]})})]})]}),!h&&u==="loading"&&e(ve,{abrupt:!0}),!!h&&e(Ne,{confirm:E||ie,confirmLabel:e("span",{children:ie?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:ae,onClick:()=>{l("loading"),(async()=>{try{let T;E||ie?T=await s.v1.accounts.$select(x.current).unfollow():T=await s.v1.accounts.$select(x.current).follow(),T&&f(T),l("default")}catch(T){alert(T),l("error")}})()},children:e("button",{type:"button",class:`${E||ie?"light swap":""}`,"data-swap-state":E||ie?"danger":"",disabled:ae,children:E?e($,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):ie?e($,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):y?e($,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!Le&&e(ge,{class:"light",onClose:()=>{re(!1)},children:e(Bs,{note:v,fields:I,onClose:()=>re(!1)})}),!!z&&e(ge,{class:"light",onClose:()=>{X(!1)},children:e(Os,{accountID:x.current,onClose:()=>X(!1)})}),!!J&&e(ge,{class:"light",onClose:()=>{ce(!1)},children:e(qs,{account:t,note:oe,onRelationshipChange:T=>{f(T)},onClose:()=>ce(!1)})})]})}function Fs([t,n,c]){const o=.2126*t+.7152*n+.0722*c;let s;return o>=220?s=1:o<=50?s=.1:s=o/255,s=Math.min(1,s),[t,n,c,s]}function zs(t){if(!t)return;const n=new URL(t),{host:c,pathname:o}=n,s=o.replace(/\/$/,"").replace(/^\//,"");return e($,{children:[e("span",{class:"more-insignificant",children:[c,"/"]}),e("wbr",{}),e("span",{children:s})]})}function Bs({note:t,fields:n,onClose:c}){const o=(n==null?void 0:n.map(({name:i,value:d})=>`${i}
${Kt(d)}`).join(`

`))||"",s=Kt(t)+(o?`

${o}`:"");return e("div",{class:"sheet",children:[!!c&&e("button",{type:"button",class:"sheet-close",onClick:c,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:s}),e(vn,{forceTranslate:!0,text:s})]})]})}function Os({accountID:t,onClose:n}){const{masto:c}=B(),[o,s]=C("default"),[i,d]=C([]),[r,u]=C([]),[l,h]=Ct(a=>a+1,0);U(()=>{s("loading"),(async()=>{try{const a=await c.v1.lists.list();a.sort((p,y)=>p.title.localeCompare(y.title));const m=await c.v1.accounts.$select(t).lists.list();d(a),u(m),s("default")}catch{s("error")}})()},[l]);const[f,b]=C(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[i.length>0?e("ul",{class:"list-add-remove",children:i.map(a=>{const m=r.some(p=>p.id===a.id);return e("li",{children:e("button",{type:"button",class:`light ${m?"checked":""}`,disabled:o==="loading",onClick:()=>{s("loading"),(async()=>{try{m?await c.v1.lists.$select(a.id).accounts.remove({accountIds:[t]}):await c.v1.lists.$select(a.id).accounts.create({accountIds:[t]}),h()}catch{s("error"),alert(m?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:a.title})]})})})}):o==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):o==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>b(!0),disabled:o!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),f&&e(ge,{class:"light",onClick:a=>{a.target===a.currentTarget&&b(!1)},children:e(qt,{list:f==null?void 0:f.list,onClose:a=>{a.state==="success"&&h(),b(!1)}})})]})}function qs({account:t,note:n,onRelationshipChange:c=()=>{},onClose:o=()=>{}}){const{masto:s}=B(),[i,d]=C("default"),r=D(null);return U(()=>{let u;return r.current&&!n&&(u=setTimeout(()=>{var l,h;(h=(l=r.current).focus)==null||h.call(l)},100)),()=>{clearTimeout(u)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:u=>{u.preventDefault();const h=new FormData(u.target).get("note");(h==null?void 0:h.trim())!==(n==null?void 0:n.trim())&&(d("loading"),(async()=>{try{const f=await s.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:h});d("default"),c(f),o()}catch(f){d("error"),alert((f==null?void 0:f.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:r,name:"note",disabled:i==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:i==="loading",onClick:()=>{o==null||o()},children:"Cancel"}),e("span",{children:[e(ve,{abrupt:!0,hidden:i!=="loading"}),e("button",{disabled:i==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function Hs({account:t,instance:n,onClose:c}){const{masto:o,instance:s,authenticated:i}=B({instance:n}),d=typeof t=="string";return U(()=>{d||(S.accounts[`${t.id}@${s}`]=t)},[t]),En(c),e("div",{class:"sheet",children:[!!c&&e("button",{type:"button",class:"sheet-close outer",onClick:c,children:e(w,{icon:"x"})}),e(Pn,{instance:s,authenticated:i,account:t,fetchAccount:async()=>{if(d)try{return await o.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const u=await o.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:i});if(u.accounts.length)return u.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const h=new URL(t).pathname.replace(/^\//,""),f=await o.v2.search.fetch({q:h,type:"accounts",limit:1,resolve:i});if(f.accounts.length)return f.accounts[0]}}else return t}})]})}function Vs({onClose:t}){const{masto:n}=B(),[c,o]=C("default"),[s,i]=C([]),[d,r]=Ct(l=>l+1,0);U(()=>{o("loading"),(async()=>{try{const l=await ot.drafts.keys();if(l.length){const h=Sn(),f=l.filter(b=>b.startsWith(h));if(f.length){const b=await ot.drafts.getMany(f);b.sort((a,m)=>new Date(m.updatedAt).getTime()-new Date(a.updatedAt).getTime()),i(b)}else i([])}else i([]);o("default")}catch{o("error")}})()},[d]);const u=(s==null?void 0:s.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(ve,{abrupt:!0,hidden:c!=="loading"})]}),u&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:u?e($,{children:[e("ul",{class:"drafts-list",children:s.map(l=>{const{updatedAt:h,key:f,draftStatus:b,replyTo:a}=l,m=new Date(h);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:a?"reply":"quill",size:"s"})," ",e("time",{children:[!!a&&e($,{children:["@",a.account.acct,e("br",{})]}),He(m)]})]}),e(Ne,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:c==="loading",onClick:()=>{(async()=>{try{await ot.drafts.del(f),r()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:c==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:c==="loading",class:"draft-item",onClick:async()=>{let p;if(a){o("loading");try{p=await n.v1.statuses.$select(a.id).fetch()}catch{alert("Error fetching reply-to status!"),o("default");return}o("default")}window.__COMPOSE__={draftStatus:b,replyToStatus:p},S.showCompose=!0,S.showDrafts=!1},children:e(js,{draft:l})})]},h)})}),s.length>1&&e("p",{children:e(Ne,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:c==="loading",onClick:()=>{(async()=>{o("loading");try{await ot.drafts.delMany(s.map(l=>l.key)),o("default"),r()}catch{alert("Error deleting drafts! Please try again."),o("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:c==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function js({draft:t}){var f;const{draftStatus:n,replyTo:c}=t,{status:o,spoilerText:s,poll:i,mediaAttachments:d}=n,r=((f=i==null?void 0:i.options)==null?void 0:f.length)>0,u=(d==null?void 0:d.length)>0,l=r||u,h=me(()=>{if(!u)return;const b=d.find(p=>/image/.test(p.type));if(!b)return;const{file:a}=b;return URL.createObjectURL(a)},[u,d]);return e($,{children:e("div",{class:"mini-draft",children:[l&&e("div",{class:`mini-draft-aside ${h?"has-image":""}`,style:h?{"--bg-image":`url(${h})`}:{},children:[r&&e(w,{icon:"poll"}),u&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:d==null?void 0:d.length})]})]}),e("div",{class:"mini-draft-main",children:[!!s&&e("div",{class:"mini-draft-spoiler",children:s}),!!o&&e("div",{class:"mini-draft-status",children:o})]})]})})}function Gs({onClose:t=()=>{}}){const n=he(S),[c,o]=C("default"),[s,i]=C([]),[d,r]=C(!1);if(En(t),!n.showGenericAccounts)return null;const{id:u,heading:l,fetchAccounts:h,accounts:f,showReactions:b}=n.showGenericAccounts,a=m=>{h&&(m&&i([]),o("loading"),(async()=>{try{const{done:p,value:y}=await h(m);Array.isArray(y)?(i(m?y:g=>[...g,...y]),r(!p)):r(!1),o("default")}catch{o("error")}})())};return U(()=>{(f==null?void 0:f.length)>0?i(f):a(!0)},[f,h]),U(()=>{var m;((m=n.reloadGenericAccounts)==null?void 0:m.id)===u&&a(!0)},[n.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:l||"Accounts"})}),e("main",{children:s.length>0?e($,{children:[e("ul",{class:"accounts-list",children:s.map(m=>{var p;return e("li",{children:[b&&((p=m._types)==null?void 0:p.length)>0&&e("div",{class:"reactions-block",children:m._types.map(y=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[y],class:`${y}-icon`}))}),e(Fe,{account:m})]},m.id+(m._types||""))})}),c==="default"?d?e(it,{onChange:m=>{m&&a()},children:e("button",{type:"button",class:"plain block",onClick:()=>a(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):c==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})})]}):c==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):c==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Nn({alt:t,lang:n,onClose:c}){const o=he(S),[s,i]=C(!1),d=bn(!0),r=o.settings.contentTranslationHideLanguages||[],u=!!n&&n!==d&&!Yt([n],[d])&&!r.find(l=>n===l||Yt([n],[l]));return e("div",{class:"sheet",children:[!!c&&e("button",{type:"button",class:"sheet-close outer",onClick:c,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Ke,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:e(te,{disabled:s,onClick:()=>{i(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]})})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap"},children:t}),(u||s)&&e(vn,{forceTranslate:s,sourceLanguage:n,text:t})]})]})}function Un({mediaAttachments:t,statusID:n,instance:c,lang:o,index:s=0,onClose:i=()=>{}}){var p,y;const d=D(null),[r,u]=C(s),l=D(null);ze(()=>{var g;(g=l.current)==null||g.scrollIntoView()},[]);const h=D(n);U(()=>{const g=s*d.current.clientWidth,v=h.current!==n;v&&(h.current=n),d.current.scrollTo({left:g,behavior:v?"auto":"smooth"}),d.current.focus()},[s,n]);const[f,b]=C(!0);U(()=>{let g=()=>{i()};return d.current&&d.current.addEventListener("swiped-down",g),()=>{d.current&&d.current.removeEventListener("swiped-down",g)}},[]),Ce("esc",i,[i]);const[a,m]=C(!1);return U(()=>{let g=()=>{const{clientWidth:v,scrollLeft:I}=d.current,k=Math.round(I/v);u(k)};return d.current&&d.current.addEventListener("scroll",g,{passive:!0}),()=>{d.current&&d.current.removeEventListener("scroll",g)}},[]),U(()=>{let g=setTimeout(()=>{var v,I;(I=(v=d.current)==null?void 0:v.focus)==null||I.call(v)},100);return()=>clearTimeout(g)},[]),e("div",{class:"media-modal-container",children:[e("div",{ref:d,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:g=>{(g.target.classList.contains("carousel-item")||g.target.classList.contains("media")||g.target.classList.contains("media-zoom"))&&i()},children:t==null?void 0:t.map((g,v)=>{const{blurhash:I}=g,k=I?$n(I):null;return e("div",{class:"carousel-item",style:{"--average-color":`rgb(${k==null?void 0:k.join(",")})`,"--average-color-alpha":`rgba(${k==null?void 0:k.join(",")}, .5)`},tabindex:"0",ref:v===r?l:null,onClick:x=>{x.target!==x.currentTarget&&b(!f)},children:[!!g.description&&e("button",{type:"button",class:"media-alt",hidden:!f,onClick:()=>{m({alt:g.description,lang:o})},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:o,dir:"auto",children:g.description})]}),e(es,{media:g,showOriginal:!0,lang:o})]},g.id)})}),e("div",{class:"carousel-top-controls",hidden:!f,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>i(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((g,v)=>e("button",{type:"button",disabled:v===r,class:`carousel-dot ${v===r?"active":""}`,onClick:I=>{I.preventDefault(),I.stopPropagation(),d.current.scrollTo({left:d.current.clientWidth*v,behavior:"smooth"}),d.current.focus()},children:e(w,{icon:"round",size:"s"})},g.id))}):e("span",{}),e("span",{children:[e(Ke,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:e(xe,{href:((p=t[r])==null?void 0:p.remoteUrl)||((y=t[r])==null?void 0:y.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]})})," ",e(K,{to:`${c?`/${c}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${r+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!f,children:[e("button",{type:"button",class:"carousel-button",hidden:r===0,onClick:g=>{g.preventDefault(),g.stopPropagation(),d.current.focus(),d.current.scrollTo({left:d.current.clientWidth*(r-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:r===t.length-1,onClick:g=>{g.preventDefault(),g.stopPropagation(),d.current.focus(),d.current.scrollTo({left:d.current.clientWidth*(r+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]}),!!a&&e(ge,{class:"light",onClick:g=>{g.target===g.currentTarget&&(m(!1),d.current.focus())},children:e(Nn,{alt:a.alt||a,lang:a==null?void 0:a.lang,onClose:()=>m(!1)})})]})}const Ws=""+new URL("floating-button-ef345856.svg",import.meta.url).href,Ks=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,Ys=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function Et({children:t}){if(typeof t=="string")return t;const[n,c]=C("");return U(()=>{Promise.resolve(t).then(c)},[t]),n}const et=9,Js=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],Fn={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Favourites",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},bt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},It={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:nt(async({id:t})=>(await B().masto.v1.lists.$select(t).fetch()).title),path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||B().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||B().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t,path:({query:t})=>`/search?q=${t}`,icon:"search"},"account-statuses":{id:"account-statuses",title:nt(async({id:t})=>{const n=await B().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Favourites",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||B().instance,path:({hashtag:t,instance:n})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}`,icon:"hashtag"}};function Xs({onClose:t}){const n=he(S),{masto:c}=B(),{shortcuts:o}=n,[s,i]=C([]),[d,r]=C([]),[u,l]=C(!1),[h,f]=C(!1),[b]=Cn();return U(()=>{(async()=>{try{const a=await c.v1.lists.list();a.sort((m,p)=>m.title.localeCompare(p.title)),i(a)}catch{}})(),(async()=>{try{const a=c.v1.followedTags.list(),m=[];do{const{value:p,done:y}=await a.next();if(y||(p==null?void 0:p.length)===0)break;m.push(...p)}while(!0);r(m)}catch{}})()},[]),e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Ws},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Ys},{value:"multi-column",label:"Multi-column",imgURL:Ks}].map(({value:a,label:m,imgURL:p})=>{const y=n.settings.shortcutsViewMode===a||a==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:y?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:a,checked:y,onChange:g=>{S.settings.shortcutsViewMode=g.target.value}})," ",e("img",{src:p,alt:"",width:"80",height:"58"})," ",e("span",{children:m})]},a)})}),o.length>0?e("ol",{class:"shortcuts-list",ref:b,children:o.filter(Boolean).map((a,m)=>{const p=Object.values(a).join("-"),{type:y}=a;if(!It[y])return null;let{icon:g,title:v,subtitle:I}=It[y];return typeof v=="function"&&(v=v(a,m)),typeof I=="function"&&(I=I(a,m)),typeof g=="function"&&(g=g(a,m)),e("li",{children:[e(w,{icon:g}),e("span",{class:"shortcut-text",children:[e(Et,{children:v}),I&&e($,{children:[" ",e("small",{class:"ib insignificant",children:I})]})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:m===0,onClick:()=>{const k=Array.from(S.shortcuts);if(m>0){const x=S.shortcuts[m-1];k[m-1]=a,k[m]=x,S.shortcuts=k}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:m===o.length-1,onClick:()=>{const k=Array.from(S.shortcuts);if(m<S.shortcuts.length-1){const x=S.shortcuts[m+1];k[m+1]=a,k[m]=x,S.shortcuts=k}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{l({shortcut:a,shortcutIndex:m})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},p)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:a=>{a.preventDefault(),S.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:o.length>=et&&`Max ${et} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>f(!0),children:"Import/export"}),e("button",{type:"button",disabled:o.length>=et,onClick:()=>l(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),u&&e(ge,{class:"light",onClick:a=>{a.target===a.currentTarget&&l(!1)},children:e(Zs,{shortcut:u.shortcut,shortcutIndex:u.shortcutIndex,lists:s,followedHashtags:d,onSubmit:({result:a,mode:m})=>{m==="edit"?S.shortcuts[u.shortcutIndex]=a:S.shortcuts.push(a)},onClose:()=>l(!1)})}),h&&e(ge,{class:"light",onClick:a=>{a.target===a.currentTarget&&f(!1)},children:e(Qs,{shortcuts:o,onClose:()=>f(!1)})})]})}function Zs({lists:t,followedHashtags:n,onSubmit:c,disabled:o,shortcut:s,shortcutIndex:i,onClose:d}){var f,b;const r=!!s,[u,l]=C((s==null?void 0:s.type)||null),h=D();return U(()=>{if(r&&u&&bt[u]){const a=h.current;bt[u].forEach(({name:m,type:p})=>{const y=a.querySelector(`[name="${m}"]`);y&&s[m]&&(p==="checkbox"?y.checked=s[m]==="on":y.value=s[m])})}},[r,u]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!d&&e("button",{type:"button",class:"sheet-close",onClick:d,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[r?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:h,onSubmit:a=>{a.preventDefault();const m=new FormData(a.target),p={};m.forEach((y,g)=>{p[g]=y==null?void 0:y.trim(),g==="instance"&&(p[g]=p[g].replace(/^https?:\/\//,"").replace(/\/+$/,""),p[g]=p[g].replace(/^@?[^@]+@/,""))}),p.type&&(c({result:p,mode:r?"edit":"add"}),a.target.reset(),l(null),d==null||d())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:o,onChange:a=>{l(a.target.value)},defaultValue:r?s.type:void 0,name:"type",children:[e("option",{}),Js.map(a=>e("option",{value:a,children:Fn[a]}))]})]})}),(b=(f=bt[u])==null?void 0:f.map)==null?void 0:b.call(f,({text:a,name:m,type:p,placeholder:y,pattern:g,notRequired:v})=>u==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!v,disabled:o,children:t.map(I=>e("option",{value:I.id,children:I.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:a})," ",e("input",{type:p,name:m,placeholder:y,required:p==="text"&&!v,disabled:o,list:u==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:g}),u==="hashtag"&&n.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:n.map(I=>e("option",{value:I.name}))})]})})),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:o,children:r?"Save":"Add"}),r&&e("button",{type:"button",class:"light danger",onClick:()=>{S.shortcuts.splice(i,1),d==null||d()},children:"Remove"})]})]})})]})}function Qs({shortcuts:t,onClose:n}){var l;const c=me(()=>!t||!t.filter(Boolean).length?"":Qt.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,s]=C(""),[i,d]=C("default"),r=me(()=>{if(!o)return d("default"),null;try{const h=JSON.parse(Qt.decompressFromEncodedURIComponent(o));if(!Array.isArray(h))throw new Error("Not an array");return d("default"),h}catch{try{const f=JSON.parse(o);if(!Array.isArray(f))throw new Error("Not an array");return d("default"),f}catch{return d("error"),null}}},[o]),u=S.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:h=>{s(h.target.value)}})}),!!r&&Array.isArray(r)&&e($,{children:[e("p",{children:[e("b",{children:r.length})," shortcut",r.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:r.map(h=>{var f,b;return e("li",{children:[e("span",{style:{opacity:t.some(a=>Object.keys(a).every(m=>a[m]===h[m]))?1:0},children:"*"}),e("span",{children:[Fn[h.type],h.type==="list"&&" ⚠️"," ",(b=(f=bt[h.type])==null?void 0:f.map)==null?void 0:b.call(f,({text:a,name:m,type:p})=>h[m]?e($,{children:[e("span",{class:"tag collapsed insignificant",children:[a,":"," ",p==="checkbox"?h[m]==="on"?"✅":"❌":h[m]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),i==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[u&&e($,{children:[e(Ne,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const h=r.filter(a=>!S.shortcuts.some(m=>Object.keys(m).every(p=>m[p]===a[p])));if(!h.length){de("No new shortcuts to import");return}let f=[...S.shortcuts,...h];const b=f.length>et;b&&(f=f.slice(0,et)),S.shortcuts=f,de(b?`Shortcuts imported. Exceeded max ${et}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:"Import & append…"})})," "]}),e(Ne,{confirmLabel:u?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:u?"danger":void 0,onClick:()=>{S.shortcuts=r,de("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:u?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:c,readOnly:!0,onClick:h=>{if(h.target.value){h.target.select();try{navigator.clipboard.writeText(h.target.value),de("Shortcuts copied")}catch{de("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!c,onClick:()=>{try{navigator.clipboard.writeText(c),de("Shortcut settings copied")}catch{de("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((l=navigator==null?void 0:navigator.canShare)==null?void 0:l.call(navigator,{text:c}))&&e("button",{type:"button",class:"plain2",disabled:!c,onClick:()=>{try{navigator.share({text:c})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",c.length>0&&e("small",{class:"insignificant",children:[c.length," characters"]})]}),!!c&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}xn(S,t=>{for(const[n,c,o,s]of t)/^show/i.test(c)&&!o&&Dt()});function ei(){var o,s,i,d,r,u,l,h;const t=he(S),n=Ln(),c=st();return e($,{children:[!!t.showCompose&&e(ge,{children:e(ts,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((o=window.__COMPOSE__)==null?void 0:o.replyToStatus)||null,editStatus:((s=S.showCompose)==null?void 0:s.editStatus)||((i=window.__COMPOSE__)==null?void 0:i.editStatus)||null,draftStatus:((d=S.showCompose)==null?void 0:d.draftStatus)||((r=window.__COMPOSE__)==null?void 0:r.draftStatus)||null,onClose:f=>{const{newStatus:b,instance:a,type:m}=f||{};S.showCompose=!1,window.__COMPOSE__=null,b&&(S.reloadStatusPage++,de({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[m||"post"],delay:1e3,duration:1e4,onClick:p=>{p.hideToast(),S.prevLocation=c,n(a?`/${a}/s/${b.id}`:`/s/${b.id}`)}}))}})}),!!t.showSettings&&e(ge,{onClose:()=>{S.showSettings=!1},children:e(Rs,{onClose:()=>{S.showSettings=!1}})}),!!t.showAccounts&&e(ge,{onClose:()=>{S.showAccounts=!1},children:e(Is,{onClose:()=>{S.showAccounts=!1}})}),!!t.showAccount&&e(ge,{class:"light",onClose:()=>{S.showAccount=!1},children:e(Hs,{account:((u=t.showAccount)==null?void 0:u.account)||t.showAccount,instance:(l=t.showAccount)==null?void 0:l.instance,onClose:({destination:f}={})=>{S.showAccount=!1}})}),!!t.showDrafts&&e(ge,{onClose:()=>{S.showDrafts=!1},children:e(Vs,{onClose:()=>S.showDrafts=!1})}),!!t.showMediaModal&&e(ge,{onClick:f=>{(f.target===f.currentTarget||f.target.classList.contains("media"))&&(S.showMediaModal=!1)},children:e(Un,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{S.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(ge,{class:"light",onClose:()=>{S.showShortcutsSettings=!1},children:e(Xs,{onClose:()=>S.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(ge,{class:"light",onClose:()=>{S.showGenericAccounts=!1},children:e(Gs,{onClose:()=>S.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(ge,{class:"light",onClick:f=>{f.target===f.currentTarget&&(S.showMediaAlt=!1)},children:e(Nn,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(h=t.showMediaAlt)==null?void 0:h.lang,onClose:()=>{S.showMediaAlt=!1}})})]})}function _t({accountID:t,onChange:n}){const{masto:c}=B(),[o,s]=C("default"),[i,d]=C(null),[r,u]=C(null),l=r!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:o==="loading"||l,onClick:()=>{s("loading"),d("accept"),(async()=>{try{const h=await c.v1.followRequests.$select(t).authorize();if(!(h!=null&&h.followedBy))throw new Error("Follow request not accepted");u(h),n()}catch{}s("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:o==="loading"||l,class:"light danger",onClick:()=>{s("loading"),d("reject"),(async()=>{try{const h=await c.v1.followRequests.$select(t).reject();if(h!=null&&h.followedBy)throw new Error("Follow request not rejected");u(h),n()}catch{s("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:l&&i?i==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(ve,{hidden:o!=="loading"})})]})}const rn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},Ze={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"favourited your post.","favourite+account":t=>`favourited ${t} of your posts.`,favourite_reply:"favourited your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & favourited your post.","favourite+reblog+account":t=>`boosted & favourited ${t} of your posts.`,"favourite+reblog_reply":"boosted & favourited your reply.","admin.sign_up":"signed up.","admin.report":t=>e($,{children:["reported ",t]})},Lt=50;function ti({notification:t,instance:n,isStatic:c}){var E,A,R,V;const{id:o,status:s,account:i,report:d,_accounts:r,_statuses:u}=t;let{type:l}=t;const h=(s==null?void 0:s.reblog)||s,f=h==null?void 0:h.id,b=Z.session.get("currentAccount"),a=b===(i==null?void 0:i.id),m=(E=s==null?void 0:s.poll)==null?void 0:E.voted,p=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==b&&((A=s==null?void 0:s.account)==null?void 0:A.id)===b;let y=0,g=0;if(l==="favourite+reblog"){for(const F of r)(R=F._types)!=null&&R.includes("favourite")&&y++,(V=F._types)!=null&&V.includes("reblog")&&g++;!g&&y&&(l="favourite"),!y&&g&&(l="reblog")}let v;if(l==="poll"?v=Ze[a?"poll-self":m?"poll-voted":"poll"]:l==="reblog"||l==="favourite"||l==="favourite+reblog"?(u==null?void 0:u.length)>1?v=Ze[`${l}+account`]:p?v=Ze[`${l}_reply`]:v=Ze[l]:Ze[l]?v=Ze[l]:v=`[Unknown notification type: ${l}]`,typeof v=="function"){const F=(u==null?void 0:u.length)||(r==null?void 0:r.length);if(F)v=v(F);else if(l==="admin.report"){const _=d==null?void 0:d.targetAccount;_&&(v=v(e(vt,{account:_,showAvatar:!0})))}}if(l==="mention"&&!s)return null;const I=t.createdAt&&new Date(t.createdAt).toLocaleString(),k={"favourite+reblog":"Boosted/Favourited by…",favourite:"Favourited by…",reblog:"Boosted by…",follow:"Followed by…"}[l]||"Accounts",x=()=>{S.showGenericAccounts={heading:k,accounts:r,showReactions:l==="favourite+reblog"}};return e("div",{class:`notification notification-${l}`,"data-notification-id":o,tabIndex:"0",children:[e("div",{class:`notification-type notification-${l}`,title:I,children:l==="favourite+reblog"?e($,{children:[e(w,{icon:"rocket",size:"xl",alt:l,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:l,class:"favourite-icon"})]}):e(w,{icon:rn[l]||"notification",size:"xl",alt:l})}),e("div",{class:"notification-content",children:[l!=="mention"&&e($,{children:[e("p",{children:[!/poll|update/i.test(l)&&e($,{children:(r==null?void 0:r.length)>1?e($,{children:[e("b",{tabIndex:"0",onClick:x,children:[e("span",{title:r.length,children:Pe(r.length)})," ","people"]})," "]}):e($,{children:[e(vt,{account:i,showAvatar:!0})," "]})}),v,l==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(Tt,{datetime:t.createdAt,format:"micro"})]})]}),l==="follow_request"&&e(_t,{accountID:i.id})]}),(r==null?void 0:r.length)>1&&e("p",{class:"avatars-stack",children:[r.slice(0,Lt).map((F,_)=>e($,{children:[e("a",{href:F.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:O=>{O.preventDefault(),S.showAccount=F},children:[e(Ge,{url:F.avatarStatic,size:r.length<=10?"xxl":r.length<20?"xl":r.length<30?"l":r.length<40?"m":"s",alt:`${F.displayName} @${F.acct}`,squircle:F==null?void 0:F.bot},F.id),l==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:F._types.map(O=>e(w,{icon:rn[O],size:"s",class:`${O}-icon`}))})]})," "]})),e("button",{type:"button",class:"small plain",onClick:x,children:[r.length>Lt&&`+${r.length-Lt}`,e(w,{icon:"chevron-down"})]})]}),(u==null?void 0:u.length)>1&&e("ul",{class:"notification-group-statuses",children:u.map(F=>e("li",{children:e(ln,{class:`status-link status-type-${l}`,to:n?`/${n}/s/${F.id}`:`/s/${F.id}`,children:e(Te,{status:F,size:"s"})})},F.id))}),s&&(!(u!=null&&u.length)||(u==null?void 0:u.length)<=1)&&e(ln,{class:`status-link status-type-${l}`,to:n?`/${n}/s/${f}`:`/s/${f}`,onContextMenu:F=>{const _=F.target.querySelector(".status");if(_){if(F.metaKey)return;F.preventDefault(),_.dispatchEvent(new MouseEvent("contextmenu",{clientX:F.clientX,clientY:F.clientY}))}},children:c?e(Te,{status:h,size:"s"}):e(Te,{statusID:f,size:"s"})})]})]})}function ln(t){const n=ns();return e(K,{...t,"data-read-more":"Read more →",ref:n})}const Ht=Be(ti),ni=Be(function(){if(!("serviceWorker"in navigator))return null;const n=he(S),{routeNotification:c}=n,{id:o,accessToken:s}=c||{},[i,d]=C(!1);ze(()=>{if(!o||!s)return;const{instance:u}=B(),{masto:l,instance:h}=B({accessToken:s}),f=u===h,b=s?ss(s):tt();(async()=>{const a=await l.v1.notifications.$select(o).fetch();if(a&&b){const m=b.instanceURL,{type:p,status:y,account:g}=a,v=!!document.querySelector("#modal-container > *"),I=p==="follow"&&!!(g!=null&&g.id),k=!!(g!=null&&g.id),x=!!(y!=null&&y.id);I&&f?S.showAccount={account:g,instance:m}:v||!f||k&&x?d({id:o,account:b,notification:a,sameInstance:f}):x?location.hash=`/${u}/s/${y.id}`:I?location.hash=`/${u}/a/${g.id}`:location.hash="/notifications"}})()},[o,s]),ze(()=>{const u=l=>{const{type:h,id:f,accessToken:b}=(l==null?void 0:l.data)||{};h==="notification"&&(S.routeNotification={id:f,accessToken:b})};return navigator.serviceWorker.addEventListener("message",u),()=>{navigator.serviceWorker.removeEventListener("message",u)}},[]),ze(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),kt(u=>{u&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const r=()=>{d(!1),S.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(i){const{id:u,account:l,notification:h,sameInstance:f}=i;return e(ge,{class:"light",onClick:b=>{b.target===b.currentTarget&&r()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:r,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!f&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:b=>{const{target:a}=b;(b.target.tagName==="BUTTON"||b.target.tagName==="A")&&r()},children:e(Ht,{instance:l.instanceURL,notification:h,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(K,{to:"/notifications",class:"button light",onClick:r,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null});const zn=ds((t,n)=>{const{instance:c}=B(),[o,s]=Oe(),[i,d]=C(!1),[r,u]=C(o.get("q")||""),l=o.get("type"),h=D(null),f=D(null);return us(n,()=>({setValue:b=>{u(b)},focus:()=>{f.current.focus()},select:()=>{f.current.select()},blur:()=>{f.current.blur()}})),e("form",{ref:h,class:"search-popover-container",onSubmit:b=>{var m;if(b.preventDefault(),/\/search/.test(location.hash))if(r){const p={q:r};l&&(p.type=l),s(p)}else s({});else r?location.hash=`/search?q=${encodeURIComponent(r)}${l?`&type=${l}`:""}`:location.hash="/search";(m=t==null?void 0:t.onSubmit)==null||m.call(t,b)},children:[e("input",{ref:f,value:r,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:b=>{b.target.value||s({})},onInput:b=>{u(b.target.value),d(!0)},onFocus:()=>{d(!0)},onBlur:()=>{var b,a;setTimeout(()=>{d(!1)},100),(a=(b=h.current)==null?void 0:b.querySelector(".search-popover-item.focus"))==null||a.classList.remove("focus")},onKeyDown:b=>{var m;const{key:a}=b;switch(a){case"Escape":d(!1);break;case"Down":case"ArrowDown":if(b.preventDefault(),i){const p=h.current.querySelector(".search-popover-item.focus");if(p){let y=p.nextElementSibling;for(;y&&y.hidden;)y=y.nextElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(v=>v!==y).forEach(v=>{v.classList.remove("focus")}))}else{const y=h.current.querySelector(".search-popover-item");y&&y.classList.add("focus")}}break;case"Up":case"ArrowUp":if(b.preventDefault(),i){const p=document.querySelector(".search-popover-item.focus");if(p){let y=p.previousElementSibling;for(;y&&y.hidden;)y=y.previousElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(v=>v!==y).forEach(v=>{v.classList.remove("focus")}))}else{const y=document.querySelector(".search-popover-item:last-child");y&&y.classList.add("focus")}}break;case"Enter":if(i){const p=document.querySelector(".search-popover-item.focus");p&&(b.preventDefault(),p.click()),d(!1),(m=t==null?void 0:t.onSubmit)==null||m.call(t,b)}break}}}),e("div",{class:"search-popover",hidden:!i||!r,children:!!r&&[{label:e($,{children:["Posts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=statuses`,hidden:/^https?:/.test(r)},{label:e($,{children:["Posts tagged with ",e("mark",{children:["#",r.replace(/^#/,"")]})]}),to:`/${c}/t/${r.replace(/^#/,"")}`,hidden:/^@/.test(r)||/^https?:/.test(r)||/\s/.test(r),top:/^#/.test(r),type:"link"},{label:e($,{children:["Look up ",e("mark",{children:r})]}),to:`/${r}`,hidden:!/^https?:/.test(r),top:/^https?:/.test(r),type:"link"},{label:e($,{children:["Accounts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=accounts`}].sort((b,a)=>b.top&&!a.top?-1:!b.top&&a.top?1:0).map(({label:b,to:a,hidden:m,type:p})=>e(K,{to:a,class:"search-popover-item",hidden:m,onClick:y=>{var g;(g=t==null?void 0:t.onSubmit)==null||g.call(t,y)},children:[e(w,{icon:p==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:b})," "]}))})]})}),si=Be(function({onClose:n=()=>{}}){const[c,o]=C(!1),s=D(null);Ce("/",d=>{o(!0),setTimeout(()=>{var r,u,l,h;(u=(r=s.current)==null?void 0:r.focus)==null||u.call(r),(h=(l=s.current)==null?void 0:l.select)==null||h.call(l)},0)},{preventDefault:!0,ignoreEventWhen:d=>{const r=/\/search/.test(location.hash),u=!!document.querySelector("#modal-container > *");return r||u}});const i=()=>{o(!1),n()};return Ce("esc",d=>{var r,u;(u=(r=s.current)==null?void 0:r.blur)==null||u.call(r),i()},{enabled:c,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!c,onClick:d=>{d.target===d.currentTarget&&i()},children:e(zn,{ref:s,onSubmit:()=>{i()}})})});function ii(){const{instance:t}=B(),n=he(S),{shortcuts:c,settings:o}=n;if(!c.length||o.shortcutsColumnsMode||o.shortcutsViewMode==="multi-column")return null;const s=D(),i=me(()=>c.map((r,u)=>{const{type:l,...h}=r;if(!It[l])return null;let{id:f,path:b,title:a,subtitle:m,icon:p}=It[l];return typeof f=="function"&&(f=f(h,u)),typeof b=="function"&&(b=b({...h,instance:h.instance||t},u)),typeof a=="function"&&(a=a(h,u)),typeof m=="function"&&(m=m(h,u)),typeof p=="function"&&(p=p(h,u)),{id:f,path:b,title:a,subtitle:m,icon:p}}).filter(Boolean),[c]),d=Ln();return Ce(["1","2","3","4","5","6","7","8","9"],(r,u)=>{var h,f;const l=parseInt(u.keys[0],10)-1;if(l<i.length){const{path:b}=i[l];b&&(d(b),(f=(h=s.current)==null?void 0:h.closeMenu)==null||f.call(h))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",children:e("ul",{children:i.map(({id:r,path:u,title:l,subtitle:h,icon:f},b)=>e("li",{children:e(K,{class:h?"has-subtitle":"",to:u,onClick:a=>{if(a.target.classList.contains("is-active")){a.preventDefault();const m=document.getElementById(`${r}-page`);if(m){m.scrollTop=0;const p=m.querySelector(".updates-button");p&&p.click()}}},children:[e(w,{icon:f,size:"xl",alt:l}),e("span",{children:[e(Et,{children:l}),h&&e($,{children:[e("br",{}),e("small",{children:h})]})]})]})},b+l))})}):e(Ke,{instanceRef:s,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:r=>{var u,l;try{const{target:h}=r;getComputedStyle(h).pointerEvents==="none"&&((l=(u=s.current)==null?void 0:u.closeMenu)==null||l.call(u))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:i.map(({path:r,title:u,subtitle:l,icon:h},f)=>e(xe,{to:r,class:"glass-menu-item",children:[e(w,{icon:h,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Et,{children:u})}),l&&e($,{children:[" ",e("small",{class:"more-insignificant",children:l})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:f+1})]},f+u))})})}const oi=Be(ii);function rt(t){const{containerProps:n}=t,c=hs(),o=D();return e(Ke,{boundingBoxPadding:kn(),repositionFlag:`${c.width}x${c.height}`,...t,instanceRef:o,containerProps:{onClick:s=>{var i,d,r;s.target===s.currentTarget&&((d=(i=o.current)==null?void 0:i.closeMenu)==null||d.call(i)),(r=n==null?void 0:n.onClick)==null||r.call(n,s)},...n}})}function ci(t){var s;let n=[],c=[],o=0;for(let i=0;i<t.length;i++){const d=t[i];d.reblog&&!((s=d.account)!=null&&s.group)?(c.push(d),o++):(n.push(d),o<3&&(o=0))}if(t.length>10&&(c.length>t.length/4||o>=3)){const i=c.map(d=>d.id);if(c.length>t.length*3/4)n=[...n,{id:i,items:c,type:"boosts"}];else{const d=Math.floor(n.length/2);n=[...n.slice(0,d),{id:i,items:c,type:"boosts"},...n.slice(d)]}return n}else return t}function dn(t,n){const c=Z.account.get("boostedStatusIDs")||{},o=t.filter(i=>{if(!i.reblog)return!0;const d=`${n}-${i.reblog.id}`,r=c[d];return r&&r!==i.id?!1:(c[d]=i.id,!0)}),s=Object.keys(c);return s.length>50&&s.slice(0,s.length-50).forEach(i=>{delete c[i]}),Z.account.set("boostedStatusIDs",c),o}function ai(t){const n=[];let c=0;t.forEach(i=>{for(let r=0;r<n.length;r++){if(n[r].find(u=>u.id===i.id))return;if(n[r].find(u=>u.id===i.inReplyToId)||n[r].find(u=>u.inReplyToId===i.id)){n[r].push(i);return}}const d=t.find(r=>r.id===i.inReplyToId);d&&(n[c++]=[i,d])});for(let i=0;i<n.length;i++)for(let d=i+1;d<n.length;d++)n[i].find(u=>n[d].includes(u))&&(n[i]=[...n[i],...n[d]],n[i]=n[i].filter((u,l,h)=>h.findIndex(f=>f.id===u.id)===l),n.splice(d,1),d--);n.forEach(i=>{i.sort((d,r)=>!d.inReplyToId&&!r.inReplyToId?new Date(d.createdAt)-new Date(r.createdAt):d.inReplyToId===r.id?1:r.inReplyToId===d.id||!d.inReplyToId?-1:r.inReplyToId?new Date(d.createdAt)-new Date(r.createdAt):1)}),n.forEach(i=>{const d=i[0].account.id;i.forEach(r=>{r.account.id!==d&&(r._differentAuthor=!0)})}),n.length;const o=[],s=[];return t.forEach(i=>{if(i.reblog){o.push(i);return}for(let d=0;d<n.length;d++)if(n[d].find(r=>r.id===i.id)){if(s.includes(d))return;const r=n[d];r.sort((l,h)=>{const f=new Date(l.createdAt),b=new Date(h.createdAt);return f-b});const u=r[0].account.id;o.push({id:r.map(l=>l.id),items:r,type:r.every(l=>l.account.id===u)?"thread":"conversation"}),s.push(d);return}o.push(i)}),o}function xt({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:c=1,scrollThresholdStart:o=10,scrollThresholdEnd:s=10,direction:i="vertical",distanceFromStartPx:d,distanceFromEndPx:r}={}){const[u,l]=C(null),[h,f]=C(!1),[b,a]=C(!1),[m,p]=C(!1),[y,g]=C(!1),v=i==="vertical";return ze(()=>{const I=t.current;if(!I)return{};let k=v?I.scrollTop:I.scrollLeft;function x(){const{scrollTop:E,scrollLeft:A,scrollHeight:R,scrollWidth:V,clientHeight:F,clientWidth:_}=I,O=v?E:A,ne=v?R:V,ie=v?F:_,Ae=Math.abs(O-k),W=d||Math.min(ie*n,ne,O),oe=r||Math.min(ie*c,ne,ne-O-ie);Ae>=(k<O?s:o)&&(l(k<O?"end":"start"),k=O),f(O<=0),a(O+ie>=ne),p(O<=W),g(O+ie>=ne-oe)}return I.addEventListener("scroll",x,{passive:!0}),()=>I.removeEventListener("scroll",x)},[n,c,o,s]),{scrollDirection:u,reachStart:h,reachEnd:b,nearReachStart:m,nearReachEnd:y,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function lt(t){var I,k,x,E,A;const n=he(S),{masto:c,instance:o,authenticated:s}=B(),[i,d]=C(),[r,u]=C(!1);U(()=>{const R=Z.local.getJSON("accounts")||[],V=R.find(F=>F.info.id===Z.session.get("currentAccount"));V&&d(V),u(R.length>1)},[]);const l=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(R=>R.type==="following"),h=fs(()=>{S.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),f=D(),[b,a]=C(void 0),m=kn([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),p=D();async function y(R){return(R||!p.current)&&(p.current=c.v1.mutes.list({limit:80})),await p.current.next()}const g=D();async function v(R){return(R||!g.current)&&(g.current=c.v1.blocks.list({limit:80})),await g.current.next()}return e($,{children:[e("button",{ref:f,type:"button",class:`button plain nav-menu-button ${r?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{a(R=>R?void 0:"open")},onContextMenu:R=>{R.preventDefault(),S.showAccounts=!0},...h(),children:[r&&e(Ge,{url:((I=i==null?void 0:i.info)==null?void 0:I.avatar)||((k=i==null?void 0:i.info)==null?void 0:k.avatarStatic),size:"l",squircle:(x=i==null?void 0:i.info)==null?void 0:x.bot}),e(w,{icon:"menu",size:r?"s":"l"})]}),e(Rn,{menuClassName:"nav-menu",state:b,anchorRef:f,onClose:()=>{a(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{a(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:m,unmountOnClose:!0,children:[!!((E=n.appVersion)!=null&&E.commitHash)&&n.appVersion.commitHash!=="393847c"&&e("div",{class:"top-menu",children:[e(te,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(De,{})]}),e("section",{children:[e(xe,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),s&&e($,{children:[l&&e(xe,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(xe,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(xe,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(De,{}),e(xe,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(xe,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(xe,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(xe,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Favourites"})]})]}),e(De,{}),e(xe,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(xe,{to:`/${o}/p/l`,children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Local"})]}),e(xe,{to:`/${o}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(xe,{to:`/${o}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:s?e($,{children:[e(De,{}),((A=i==null?void 0:i.info)==null?void 0:A.id)&&e(xe,{to:`/${o}/a/${i.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(te,{onClick:()=>{S.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(te,{onClick:()=>{S.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:y}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(te,{onClick:()=>{S.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:v}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(De,{className:"divider-grow"}),e(te,{onClick:()=>{S.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(te,{onClick:()=>{S.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(te,{onClick:()=>{S.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e($,{children:[e(De,{}),e(xe,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(te,{onClick:()=>{S.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const ft={block:"nearest",inline:"center",behavior:"smooth"};function qe({title:t,titleComponent:n,id:c,instance:o,emptyText:s,errorText:i,useItemID:d,boostsCarousel:r,fetchItems:u=()=>{},checkForUpdates:l=()=>{},checkForUpdatesInterval:h=6e4,headerStart:f,headerEnd:b,timelineStart:a,allowFilters:m,refresh:p}){const y=he(S),[g,v]=C([]),[I,k]=C("default"),[x,E]=C(!1),[A,R]=C(!1),[V,F]=C(!0),_=D(),O=St(z=>{R(!1),I!=="loading"&&(k("loading"),(async()=>{try{let{done:X,value:J}=await u(z);Array.isArray(J)?(r&&(J=ci(J)),J=ai(J),v(z?J:ce=>[...ce,...J]),J.length||(X=!0),E(!X)):E(!1),k("default")}catch{k("error")}finally{O.cancel()}})())},1500,{leading:!0,trailing:!1}),ne=".timeline-item, .timeline-item-alt",ie=Ce("j, shift+j",(z,X)=>{const J=document.activeElement.closest(ne),ce=J==null?void 0:J.getBoundingClientRect(),Q=Array.from(_.current.querySelectorAll(ne));if(J&&ce.top<_.current.clientHeight&&ce.bottom>0){const T=Q.indexOf(J);let L=Q[T+1];X.shift&&(L=Q.find((H,P)=>P>T&&!H.classList.contains("timeline-item-alt"))),L&&(L.focus(),L.scrollIntoView(ft))}else{const T=Q.find(L=>{const H=L.getBoundingClientRect();return H.top>=44&&H.left>=0});T&&(T.focus(),T.scrollIntoView(ft))}}),Ae=Ce("k, shift+k",(z,X)=>{const J=document.activeElement.closest(ne),ce=J==null?void 0:J.getBoundingClientRect(),Q=Array.from(_.current.querySelectorAll(ne));if(J&&ce.top<_.current.clientHeight&&ce.bottom>0){const T=Q.indexOf(J);let L=Q[T-1];X.shift&&(L=Q.findLast((H,P)=>P<T&&!H.classList.contains("timeline-item-alt"))),L&&(L.focus(),L.scrollIntoView(ft))}else{const T=Q.find(L=>{const H=L.getBoundingClientRect();return H.top>=44&&H.left>=0});T&&(T.focus(),T.scrollIntoView(ft))}}),W=Ce(["enter","o"],()=>{const z=document.activeElement.closest(ne);z&&z.click()}),{scrollDirection:oe,nearReachStart:j,nearReachEnd:M,reachStart:q,reachEnd:Y}=xt({scrollableRef:_,distanceFromEnd:2,scrollThresholdStart:44});U(()=>{var z;(z=_.current)==null||z.scrollTo({top:0}),O(!0)},[]),U(()=>{O(!0)},[p]),U(()=>{q&&O(!0)},[q]),U(()=>{(M||Y&&x)&&O()},[M,x]);const ae=We(async({disableIdleCheck:z=!1}={})=>{y.settings.autoRefresh&&_.current.scrollTop===0&&(z||window.__IDLE__)&&!di()?O(!0):await l()&&R(!0)},[c,O,l,y.settings.autoRefresh]),Se=St(ae,3e3),Le=D();kt(z=>{if(z){const X=Date.now()-Le.current;(!Le.current||X>1e3*60)&&Se({disableIdleCheck:!0})}else Le.current=Date.now(),Se.cancel();F(z)},[l,ae,y.settings.autoRefresh]),gn(ae,V&&!A?h:null);const re=oe==="end"&&!j;return e("div",{id:`${c}-page`,class:"deck-container",ref:z=>{_.current=z,ie.current=z,Ae.current=z,W.current=z},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{hidden:re,onClick:z=>{var X;z.target.closest("a, button")||(X=_.current)==null||X.scrollTo({top:0,behavior:"smooth"})},onDblClick:z=>{z.target.closest("a, button")||O(!0)},class:I==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(lt,{}),f??e(K,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!b&&b})]}),g.length>0&&I!=="loading"&&!re&&A&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var z;O(!0),(z=_.current)==null||z.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!a&&e("div",{class:`timeline-start ${I==="loading"?"loading":""}`,children:a}),g.length?e($,{children:[e("ul",{class:"timeline",children:[g.map(z=>{const{id:X,reblog:J,items:ce,type:Q,_pinned:T}=z,L=(J==null?void 0:J.id)||X,H=o?`/${o}/s/${L}`:`/s/${L}`;let P="";Q==="boosts"?P=`${ce.length} Boosts`:Q==="pinned"&&(P="Pinned posts");const ee=Q==="boosts"||Q==="pinned";if(ce){if(ee)return ce.sort((se,ue)=>se._filtered&&!ue._filtered?1:!se._filtered&&ue._filtered?-1:0),e("li",{class:"timeline-item-carousel",children:e(ri,{title:P,class:`${Q}-carousel`,children:ce.map(se=>{const{id:ue,reblog:Re}=se,fe=(Re==null?void 0:Re.id)||ue,Ee=o?`/${o}/s/${fe}`:`/s/${fe}`;return e("li",{children:e(K,{class:"status-carousel-link timeline-item-alt",to:Ee,children:d?e(Te,{statusID:ue,instance:o,size:"s",contentTextWeight:!0,allowFilters:m}):e(Te,{status:se,instance:o,size:"s",contentTextWeight:!0,allowFilters:m})})},ue)})})},`timeline-${X}`);const ke=ce.length>3;return ce.map((se,ue)=>{const{id:Re,_differentAuthor:fe}=se,Ee=o?`/${o}/s/${Re}`:`/s/${Re}`,N=ue>0&&ue<ce.length-1,le=se.sensitive&&!!se.spoilerText,be=!fe&&le&&ue>0||ke&&N&&(Q==="thread"||Q==="conversation"&&!fe&&!ce[ue-1]._differentAuthor&&!ce[ue+1]._differentAuthor);return e("li",{class:`timeline-item-container timeline-item-container-type-${Q} timeline-item-container-${ue===0?"start":ue===ce.length-1?"end":"middle"} ${fe?"timeline-item-diff-author":""}`,children:e(K,{class:"status-link timeline-item",to:Ee,children:be?e(li,{status:se,instance:o}):d?e(Te,{statusID:Re,instance:o,allowFilters:m}):e(Te,{status:se,instance:o,allowFilters:m})})},`timeline-${Re}`)})}return e("li",{children:e(K,{class:"status-link timeline-item",to:H,children:d?e(Te,{statusID:X,instance:o,allowFilters:m}):e(Te,{status:z,instance:o,allowFilters:m})})},`timeline-${X+T}`)}),x&&I==="loading"&&e($,{children:[e("li",{style:{height:"20vh"},children:e(Te,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(Te,{skeleton:!0})})]})]}),I==="default"&&(x?e(it,{onChange:z=>{z&&O()},children:e("button",{type:"button",class:"plain block",onClick:()=>O(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):I==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((z,X)=>e("li",{children:e(Te,{skeleton:!0})},X))}):I!=="error"&&e("p",{class:"ui-state",children:s}),I==="error"&&e("p",{class:"ui-state",children:[i,e("br",{}),e("br",{}),e("button",{class:"button plain",onClick:()=>O(!g.length),children:"Try again"})]})]})})}function ri({title:t,class:n,children:c}){const o=D(),{reachStart:s,reachEnd:i,init:d}=xt({scrollableRef:o,direction:"horizontal"});return U(()=>{d==null||d()},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var r,u;(u=o.current)==null||u.scrollBy({left:-Math.min(320,(r=o.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{type:"button",class:"small plain2",disabled:i,onClick:()=>{var r,u;(u=o.current)==null||u.scrollBy({left:Math.min(320,(r=o.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:o,children:c})]})}function li({status:t,instance:n}){const c=he(S),{id:o,visibility:s}=t,i=In(t),d=zt(o,n);return e("article",{class:`status compact-thread ${s==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[c.statusThreadNumber[d]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),c.statusThreadNumber[d]?` ${c.statusThreadNumber[d]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:i,children:[i,t.sensitive&&t.spoilerText&&e($,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function di(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const Qe=20,Vt=1983,un=`${Vt}-01`,ui=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function hi(t){var o;const{masto:n}=B({instance:t}),c=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((o=c==null?void 0:c.statuses)!=null&&o.length)}const fi=nt(hi);function pi(){const t=he(S),{id:n,...c}=Ye(),[o,s]=Oe(),i=o.get("month"),d=!o.get("replies"),r=!!o.get("boosts"),u=o.get("tagged"),l=!!o.get("media"),{masto:h,instance:f,authenticated:b}=B({instance:c.instance}),a=D(),m=[i,d,r,u,l],[p,y]=C(),g=D(0);U(()=>{g.current=0},m);const v=me(()=>f===B().instance,[f]),[I,k]=C(!1);U(()=>{v&&p!=null&&p.acct&&(async()=>{const W=await fi(f);k(W)})()},[f,v,p==null?void 0:p.acct]);async function x(W){var ae,Se,Le;const oe=/^\d{4}-[01]\d$/.test(i),j=((Se=(ae=i==null?void 0:i.split)==null?void 0:ae.call(i,"-"))==null?void 0:Se[0])>=Vt;if(oe&&j){if(!p)return{value:[],done:!0};const[re,z]=i.split("-"),X=parseInt(z,10)-1,J=new Date(re,X,0),ce=`${J.getFullYear()}-${(J.getMonth()+1).toString().padStart(2,"0")}-${J.getDate().toString().padStart(2,"0")}`,Q=new Date(re,X+1,1),T=`${Q.getFullYear()}-${(Q.getMonth()+1).toString().padStart(2,"0")}-${Q.getDate().toString().padStart(2,"0")}`;let L;W?(L=Qe+1,g.current=0):(L=Qe+g.current+1,g.current+=Qe);const H=await h.v2.search.fetch({q:`from:${p.acct} after:${ce} before:${T}`,type:"statuses",limit:L,offset:g.current});if((Le=H==null?void 0:H.statuses)!=null&&Le.length){const P=H.statuses.slice(0,Qe);P.forEach(ke=>{Ie(ke,f)});const ee=H.statuses.length<=Qe;return{value:P,done:ee}}else return{value:[],done:!0}}const M=[];if(W){const{value:re}=await h.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(re!=null&&re.length&&!u&&!l)if(re.forEach(z=>{z._pinned=!0,Ie(z,f)}),re.length>=3){const z=re.map(X=>X.id);M.push({id:z,items:re,type:"pinned"})}else M.push(...re)}(W||!a.current)&&(a.current=h.v1.accounts.$select(n).statuses.list({limit:Qe,exclude_replies:d,exclude_reblogs:r,only_media:l,tagged:u}));const{value:q,done:Y}=await a.current.next();return q!=null&&q.length&&(M.push(...q),q.forEach(re=>{Ie(re,f)})),{value:M,done:Y}}const[E,A]=C([]);$e(`${p!=null&&p.displayName?p.displayName+" ":""}@${p!=null&&p.acct?p.acct:"Account posts"}`,"/:instance?/a/:id"),U(()=>{(async()=>{try{const W=await h.v1.accounts.$select(n).fetch();y(W)}catch{}try{const W=await h.v1.accounts.$select(n).featuredTags.list();A(W)}catch{}})()},[n]);const{displayName:R,acct:V,emojis:F}=p||{},_=D(),O=me(()=>{const W=t.accounts[`${n}@${f}`],oe=!d||r||u||l||!!i;return e($,{children:[e(Pn,{instance:f,account:W||n,fetchAccount:()=>h.v1.accounts.$select(n).fetch(),authenticated:b,standalone:!0}),e("div",{class:"filter-bar",ref:_,children:[oe?e(K,{to:`/${f}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(K,{to:`/${f}/a/${n}${d?"?replies=1":""}`,onClick:()=>{d&&de("Showing post with replies")},class:d?"":"is-active",children:"+ Replies"}),e(K,{to:`/${f}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||de("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),e(K,{to:`/${f}/a/${n}${l?"":"?media=1"}`,onClick:()=>{l||de("Showing posts with media")},class:l?"is-active":"",children:"Media"}),E.map(j=>e(K,{to:`/${f}/a/${n}${u===j.name?"":`?tagged=${encodeURIComponent(j.name)}`}`,onClick:()=>{u!==j.name&&de(`Showing posts tagged with #${j.name}`)},class:u===j.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),j.name]})},j.id)),I&&(ui?e("label",{class:`filter-field ${i?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(p!=null&&p.acct),value:i||"",min:un,max:new Date().toISOString().slice(0,7),onInput:j=>{const{value:M,validity:q}=j.currentTarget;q.valid&&s(M?{month:M}:{})}})]}):e(mi,{class:`filter-field ${i?"is-active":""}`,disabled:!(p!=null&&p.acct),value:i||"",min:un,max:new Date().toISOString().slice(0,7),onInput:j=>{const{value:M,validity:q}=j;q.valid&&s(M?{month:M}:{})}}))]})]})},[n,f,b,E,I,...m]);U(()=>{var oe;const W=(oe=_.current)==null?void 0:oe.querySelector(".is-active");W&&_.current.scrollTo({behavior:"smooth",left:W.offsetLeft-(_.current.offsetWidth-W.offsetWidth)/2})},[E,I,...m]);const ne=me(()=>p!=null&&p.url?new URL(p.url).hostname:null,[p]),Ae=!!p&&!(f===ne);return e(qe,{title:`${p!=null&&p.acct?"@"+p.acct:"Posts"}`,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:e(wn,{text:R,emojis:F})}),e("div",{children:e("span",{children:["@",V]})})]}),id:"account-statuses",instance:f,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:x,useItemID:!0,boostsCarousel:t.settings.boostsCarousel,timelineStart:O,refresh:[d,r,u,l,i+(p==null?void 0:p.acct)].toString(),headerEnd:e(rt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(te,{disabled:!Ae,onClick:()=>{(async()=>{try{const{masto:W}=B({instance:ne}),oe=await W.v1.accounts.lookup({acct:p.acct}),{id:j}=oe;location.hash=`/${ne}/a/${j}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:ne}),")"]})]})})},n)}function mi(t){const{class:n,disabled:c,value:o,min:s,max:i,onInput:d=()=>{}}=t,[r,u]=(o==null?void 0:o.split("-"))||[],l=D(),h=D(),f=(b,a)=>{const[m,p]=(s==null?void 0:s.split("-"))||[],[y,g]=(i==null?void 0:i.split("-"))||[];return!(a<m||a>y||a===m&&b<p||a===y&&b>g)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:l,disabled:c,value:u||"",onInput:b=>{const{value:a}=b.currentTarget,m=h.current.value;if(!f(a,m))return{value:"",validity:{valid:!1}};d({value:a?`${m}-${a}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(b,a)=>e("option",{value:(a+1).toString().padStart(2,"0"),children:new Date(0,a).toLocaleString("default",{month:"long"})},a))]})," ",e("input",{ref:h,type:"number",disabled:c,value:r||new Date().getFullYear(),min:(s==null?void 0:s.slice(0,4))||Vt,max:(i==null?void 0:i.slice(0,4))||new Date().getFullYear(),onInput:b=>{const{value:a,validity:m}=b.currentTarget,p=l.current.value;if(!m.valid||!f(p,a))return{value:"",validity:{valid:!1}};d({value:a?`${a}-${p}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const gi=20;function Bn(){$e("Bookmarks","/b");const{masto:t,instance:n}=B(),c=D();async function o(s){return(s||!c.current)&&(c.current=t.v1.bookmarks.list({limit:gi})),await c.current.next()}return e(qe,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:o})}const bi=20;function On(){$e("Favourites","/f");const{masto:t,instance:n}=B(),c=D();async function o(s){return(s||!c.current)&&(c.current=t.v1.favourites.list({limit:bi})),await c.current.next()}return e(qe,{title:"Favourites",id:"favourites",emptyText:"No favourites yet. Go favourite something!",errorText:"Unable to load favourites",instance:n,fetchItems:o})}const yi=200;function wi(){const{masto:t,instance:n}=B();$e("Followed Hashtags","/ft");const[c,o]=C("default"),[s,i]=C([]);return U(()=>{o("loading"),(async()=>{try{const d=t.v1.followedTags.list({limit:yi}),r=[];do{const{value:u,done:l}=await d.next();if(l||(u==null?void 0:u.length)===0)break;r.push(...u)}while(!0);r.sort((u,l)=>u.name.localeCompare(l.name)),i(r),o("default")}catch{o("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(lt,{}),e(K,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(d=>e("li",{children:e(K,{to:n?`/${n}/t/${d.name}`:`/t/${d.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:d.name})]})}))}):c==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):c==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function vi(t,n,c){var u;const{filtered:o}=t;if(!(o!=null&&o.length)||c&&((u=t.account)==null?void 0:u.id)===c)return!0;const i=o.filter(l=>{const{filter:h}=l,f=h.context.includes(n);return f?h.expiresAt?new Date(h.expiresAt)>new Date:f:!1});if(!i.length)return!0;if(i.some(l=>l.filter.filterAction==="hide"))return!1;const r=i.some(l=>l.filter.filterAction==="warn");if(r){const l=i.map(h=>h.filter.title);t._filtered={titles:l,titlesStr:l.join(" • ")}}return r}function Ve(t,n){if(!(t!=null&&t.length))return[];if(!n)return t;const c=Z.session.get("currentAccount");return t.filter(o=>vi(o,n,c))}const Si=20;function jt({title:t,path:n,id:c,...o}){$e(t||"Following",n||"/following");const{masto:s,streaming:i,instance:d}=B(),r=he(S),u=D(),l=D();async function h(b){(b||!u.current)&&(u.current=s.v1.timelines.home.list({limit:Si}));const a=await u.current.next();let{value:m}=a;return m!=null&&m.length&&(b&&(l.current=m[0].id),m=Ve(m,"home"),m.forEach(p=>{Ie(p,d)}),m=dn(m,d),m.sort((p,y)=>{const g=new Date(p.createdAt);return new Date(y.createdAt)-g})),{...a,value:m}}async function f(){try{const b=await s.v1.timelines.home.list({limit:5,since_id:l.current}).next();let{value:a}=b;return!!(a!=null&&a.length&&(l.current=a[0].id,a=dn(a,d),a=Ve(a,"home"),a.some(m=>!m.reblog)))}catch{return!1}}return U(()=>{let b;return(async()=>{if(i){b=i.user.subscribe();for await(const a of b){if(!b)break;if(a.event==="status.update"){const m=a.payload;Ie(m,d)}else if(a.event==="delete"){const m=a.payload,p=Tn(m,d);p&&(p._deleted=!0)}}}})(),()=>{var a;(a=b==null?void 0:b.unsubscribe)==null||a.call(b),b=null}},[i]),e(qe,{title:t||"Following",id:c||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:d,fetchItems:h,checkForUpdates:f,useItemID:!0,boostsCarousel:r.settings.boostsCarousel,...o,allowFilters:!0})}const ki=20,Ii=4,hn=Ii+1;function qn({columnMode:t,...n}){let{hashtag:c,...o}=t?{}:Ye();n.hashtag&&(c=n.hashtag);let s=c.trim().split(/[\s+]+/);s.sort(),c=s[0];const{masto:i,instance:d,authenticated:r}=B({instance:(n==null?void 0:n.instance)||o.instance}),{authenticated:u}=B(),l=s.map(k=>`#${k}`).join(" "),h=d?`${l} on ${d}`:l;$e(h,"/:instance?/t/:hashtag");const f=D(),b=D(void 0);async function a(k){const x=await i.v1.timelines.tag.$select(c).list({limit:ki,any:s.slice(1),maxId:k?void 0:b.current}).next(),{value:E}=x;return E!=null&&E.length&&(k&&(f.current=E[0].id),E.forEach(A=>{Ie(A,d)}),b.current=E[E.length-1].id),{...x,value:E}}async function m(){try{const k=await i.v1.timelines.tag.$select(c).list({limit:1,any:s.slice(1),since_id:f.current}).next(),{value:x}=k;return!!(x!=null&&x.length)}catch{return!1}}const[p,y]=C("default"),[g,v]=C();U(()=>{(async()=>{try{const k=await i.v1.tags.$select(c).fetch();v(k)}catch{}})()},[c]);const I=s.length>=hn;return e(qe,{title:h,titleComponent:!!d&&e("h1",{class:"header-account",children:[e("b",{children:l}),e("div",{children:d})]}),id:"hashtag",instance:d,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:a,checkForUpdates:m,useItemID:!0,headerEnd:e(rt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!g&&s.length===1&&e($,{children:[e(Ne,{subMenu:!0,confirm:g.following,confirmLabel:`Unfollow #${c}?`,disabled:p==="loading"||!r,onClick:()=>{y("loading"),g.following?i.v1.tags.$select(c).unfollow().then(()=>{v({...g,following:!1}),de(`Unfollowed #${c}`)}).catch(k=>{alert(k)}).finally(()=>{y("default")}):i.v1.tags.$select(c).follow().then(()=>{v({...g,following:!0}),de(`Followed #${c}`)}).catch(k=>{alert(k)}).finally(()=>{y("default")})},children:g.following?e($,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e($,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(De,{})]}),e(ps,{className:"menu-field",disabled:I,children:({ref:k})=>e("form",{onSubmit:x=>{var A,R;x.preventDefault();const E=(R=(A=x.target[0].value)==null?void 0:A.trim)==null?void 0:R.call(A);E&&!s.some(V=>V.toLowerCase()===E.toLowerCase())&&(s.push(E),s.sort(),location.hash=d?`/${d}/t/${s.join("+")}`:`/t/${s.join("+")}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:k,type:"text",placeholder:I?`Max ${hn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:I})]})}),e(ms,{takeOverflow:!0,children:s.map((k,x)=>e(te,{disabled:s.length===1,onClick:E=>{s.splice(x,1),s.sort(),location.hash=d?`/${d}/t/${s.join("+")}`:`/t/${s.join("+")}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),k]})]},k))}),e(De,{}),e(te,{disabled:!u,onClick:()=>{const k={type:"hashtag",hashtag:s.join(" "),instance:d};S.shortcuts.some(E=>E.type===k.type&&E.hashtag.split(/[\s+]+/).sort().join(" ")===k.hashtag.split(/[\s+]+/).sort().join(" ")&&(E.instance?E.instance===k.instance:!0))?alert("This shortcut already exists"):(S.shortcuts.push(k),de("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(te,{onClick:()=>{let k=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(k)){k&&alert("Invalid instance");return}k&&(k=k.toLowerCase().trim(),location.hash=`/${k}/t/${s.join("+")}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},d+l)}const Ti=20;function Hn(t){var p;const n=he(S),{masto:c,instance:o}=B(),s=(t==null?void 0:t.id)||((p=Ye())==null?void 0:p.id),i=D(),d=D();async function r(y){(y||!d.current)&&(d.current=c.v1.timelines.list.$select(s).list({limit:Ti}));const g=await d.current.next();let{value:v}=g;return v!=null&&v.length&&(y&&(i.current=v[0].id),v=Ve(v,"home"),v.forEach(I=>{Ie(I,o)})),{...g,value:v}}async function u(){try{const y=await c.v1.timelines.list.$select(s).list({limit:1,since_id:i.current});let{value:g}=y;return g=Ve(g,"home"),!!(g!=null&&g.length)}catch{return!1}}const[l,h]=C({title:"List"});$e(l.title,"/l/:id"),U(()=>{(async()=>{try{const y=await c.v1.lists.$select(s).fetch();h(y)}catch{}})()},[s]);const[f,b]=C(!1),[a,m]=C(!1);return e($,{children:[e(qe,{title:l.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:o,fetchItems:r,checkForUpdates:u,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:e(K,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(rt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(te,{onClick:()=>b({list:l}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(te,{onClick:()=>m(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},s),f&&e(ge,{class:"light",onClick:y=>{y.target===y.currentTarget&&b(!1)},children:e(qt,{list:f==null?void 0:f.list,onClose:y=>{y.state==="success"&&y.list?h(y.list):y.state==="deleted"&&(location.hash="/l"),b(!1)}})}),a&&e(ge,{class:"light",onClick:y=>{y.target===y.currentTarget&&m(!1)},children:e($i,{listID:s,onClose:()=>m(!1)})})]})}const Ci=40;function $i({listID:t,onClose:n}){const{masto:c,instance:o}=B(),[s,i]=C([]),[d,r]=C("default"),[u,l]=C(!1),h=D();async function f(b){l(!1),r("loading"),(async()=>{try{(b||!h.current)&&(h.current=c.v1.lists.$select(t).accounts.list({limit:Ci}));const a=await h.current.next();let{done:m,value:p}=a;p!=null&&p.length?(i(b?p:s.concat(p)),l(!m)):l(!1),r("default")}catch{r("error")}})()}return U(()=>{f(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[s.map(b=>e("li",{children:[e(Fe,{account:b,instance:o}),e(xi,{account:b,listID:t})]},b.id)),u&&d==="default"&&e(it,{as:"li",onChange:b=>b&&f(),children:e("button",{type:"button",class:"light block",onClick:f,children:"Show more…"})})]})})]})}function xi({account:t,listID:n}){const{masto:c}=B(),[o,s]=C("default"),[i,d]=C(!1);return e(Ne,{confirm:!i,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{i?(s("loading"),(async()=>{try{await c.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),s("default"),d(!1)}catch{s("error")}})()):(s("loading"),(async()=>{try{await c.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),s("default"),d(!0)}catch{s("error")}})())},children:e("button",{type:"button",class:`light ${i?"":"danger"}`,disabled:o==="loading",children:i?"Add":"Remove…"})})}const fn=20,Li=new URLSearchParams;function Vn({columnMode:t,...n}){$e("Mentions","/mentions");const{masto:c,instance:o}=B(),[s]=t?[Li]:Oe(),[i,d]=C(null),r=(n==null?void 0:n.type)||s.get("type")||i,u=D(),l=D();async function h(g){(g||!u.current)&&(u.current=c.v1.notifications.list({limit:fn,types:["mention"]}));const v=await u.current.next();let{value:I}=v;return I!=null&&I.length&&(g&&(l.current=I[0].id),I.forEach(({status:k})=>{Ie(k,o)})),{...v,value:I==null?void 0:I.map(k=>k.status)}}const f=D(),b=D();async function a(g){(g||!f.current)&&(f.current=c.v1.conversations.list({limit:fn}));const v=await f.current.next();let{value:I}=v;return I=I==null?void 0:I.filter(k=>k.lastStatus),I!=null&&I.length&&(g&&(b.current=I[0].lastStatus.id),I.forEach(({lastStatus:k})=>{Ie(k,o)})),{...v,value:I==null?void 0:I.map(k=>k.lastStatus)}}function m(...g){return r==="private"?a(...g):h(...g)}async function p(){if(r==="private")try{const g=await c.v1.conversations.list({limit:1,since_id:b.current}).next();let{value:v}=g;return v!=null&&v.length?(b.current=v[0].lastStatus.id,!0):!1}catch{return!1}else try{const g=await c.v1.notifications.list({limit:1,types:["mention"],since_id:l.current}).next();let{value:v}=g;return v!=null&&v.length?(l.current=v[0].id,!0):!1}catch{return!1}}const y=me(()=>e("div",{class:"filter-bar centered",children:[e(K,{to:"/mentions",class:r?"":"is-active",onClick:g=>{t&&(g.preventDefault(),d(null))},children:"All"}),e(K,{to:"/mentions?type=private",class:r==="private"?"is-active":"",onClick:g=>{t&&(g.preventDefault(),d("private"))},children:"Private"})]}),[r]);return e(qe,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:o,fetchItems:m,checkForUpdates:p,useItemID:!0,timelineStart:y,refresh:r})}function jn(t){const n={},c=[];for(let i=0,d=0;i<t.length;i++){const r=t[i],{id:u,status:l,account:h,type:f,createdAt:b}=r,a=new Date(b).toLocaleDateString();let m=f;(f==="favourite"||f==="reblog")&&(m="favourite+reblog");const p=`${l==null?void 0:l.id}-${m}-${a}`,y=n[p];if(m==="follow_request")c[d++]=r;else if(y!=null&&y.account){const g=y._accounts.find(v=>v.id===h.id);g?(g._types.push(f),g._types.sort().reverse(),y.id+=`-${u}`):(h._types=[f],y._accounts.push(h),y.id+=`-${u}`)}else{h._types=[f];let g=n[p]={...r,type:m,_accounts:[h]};c[d++]=g}}const o={},s=[];for(let i=0,d=0;i<c.length;i++){const r=c[i],{id:u,account:l,_accounts:h,type:f,createdAt:b}=r,a=new Date(b).toLocaleDateString();if(f==="favourite+reblog"&&l&&h.length===1){const m=`${l==null?void 0:l.id}-${f}-${a}`,p=o[m];if(p)p._statuses.push(r.status),p.id+=`-${u}`;else{let y=o[m]={...r,type:f,_statuses:[r.status]};s[d++]=y}}else s[d++]=r}return s}const Ri=30,Ai=new URLSearchParams;function Mi({columnMode:t}){$e("Notifications","/notifications");const{masto:n,instance:c}=B(),o=he(S),[s,i]=C("default"),[d]=t?[Ai]:Oe(),r=d.get("id"),u=d.get("access_token"),[l,h]=C(!1),[f,b]=C(!1),a=D(),{nearReachEnd:m,scrollDirection:p,reachStart:y,nearReachStart:g}=xt({scrollableRef:a}),v=p==="end"&&!g,[I,k]=C([]),[x,E]=C([]),A=D();async function R(M){(M||!A.current)&&(A.current=n.v1.notifications.list({limit:Ri,excludeTypes:["follow_request"]}));const q=await A.current.next(),Y=q.value;if(Y!=null&&Y.length){Y.forEach(Se=>{Ie(Se.status,c,{skipThreading:!0})});const ae=jn(Y);M?(S.notificationsLast=Y[0],S.notifications=ae,n.v1.markers.create({notifications:{lastReadId:Y[0].id}}).catch(()=>{})):S.notifications.push(...ae)}return S.notificationsShowNew=!1,S.notificationsLastFetchTime=Date.now(),q}async function V(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const F=()=>{i("loading"),(async()=>{try{const M=await V();k(M),i("default")}catch{i("error")}})()};async function _(){try{return await n.v1.announcements.list()}catch{return[]}}const O=M=>{i("loading"),(async()=>{try{const q=R(M),Y=V(),ae=_();if(M){const Le=await ae;Le.sort((z,X)=>{const J=new Date(z.updatedAt||z.createdAt);return new Date(X.updatedAt||X.createdAt)-J}),E(Le);const re=await Y;k(re)}const{done:Se}=await q;h(!Se),i("default")}catch{i("error")}})()};U(()=>{O(!0)},[]),U(()=>{y&&O(!0)},[y]);const ne=We(()=>{var M;o.settings.autoRefresh&&((M=a.current)==null?void 0:M.scrollTop)===0&&window.__IDLE__&&!Di()&&o.notificationsShowNew&&s!=="loading"&&O(!0)},[o.notificationsShowNew,o.settings.autoRefresh,s]);U(ne,[o.notificationsShowNew]);const ie=new Date,Ae=new Date(ie-24*60*60*1e3);let W=new Date;const oe=!o.notifications.some(M=>new Date(M.createdAt).toDateString()===ie.toDateString()),j=D();return U(()=>{r&&(S.routeNotification={id:r,accessToken:atob(u)})},[r,u]),e("div",{id:"notifications-page",class:"deck-container",ref:a,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${f?"only-mentions":""}`,children:[e("header",{hidden:v,onClick:M=>{var q;M.target.closest("a, button")||(q=a.current)==null||q.scrollTo({top:0,behavior:"smooth"})},class:s==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(lt,{}),e(K,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),o.notificationsShowNew&&s!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var M;O(!0),(M=a.current)==null||M.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),x.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",x.length>1?"s":""]})," ",e("small",{class:"insignificant",children:c})]}),x.length>1&&e("span",{class:"announcements-nav-buttons",children:x.map((M,q)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var Y;(Y=j.current)==null||Y.children[q].scrollIntoView({behavior:"smooth",block:"nearest"})},children:q+1}))})]}),e("ul",{class:`announcements-list-${x.length>1?"multiple":"single"}`,ref:j,children:x.map(M=>e("li",{children:e(Ei,{announcement:M})}))})]})})}),I.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),I.length>5?e("details",{children:[e("summary",{children:[I.length," follow requests"]}),e("ul",{children:I.map(M=>e("li",{children:[e(Fe,{account:M}),e(_t,{accountID:M.id,onChange:()=>{}})]},M.id))})]}):e("ul",{children:I.map(M=>e("li",{children:[e(Fe,{account:M}),e(_t,{accountID:M.id,onChange:()=>{}})]},M.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:f,onChange:M=>{b(M.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),oe&&!!o.notifications.length&&e("p",{class:"ui-state insignificant",children:s==="default"?"You're all caught up.":e($,{children:"…"})}),o.notifications.length?e($,{children:o.notifications.filter(M=>M.type!=="follow_request").map(M=>{if(f&&M.type!=="mention")return null;const q=new Date(M.createdAt),Y=q.toDateString()!==W.toDateString();Y&&(W=q);const ae=q.toDateString()===Ae.toDateString()?"Yesterday":He(W,{hideTime:!0});return e($,{children:[Y&&e("h2",{class:"timeline-header",children:ae}),e(Ht,{instance:c,notification:M},M.id)]},M.id)})}):e($,{children:[s==="loading"&&e($,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((M,q)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),s==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>O(!0),children:"Try again"})]})]}),l&&e(it,{onChange:M=>{M&&O()},children:e("button",{type:"button",class:"plain block",disabled:s==="loading",onClick:()=>O(),style:{marginBlockEnd:"6em"},children:s==="loading"?e(ve,{abrupt:!0}):e($,{children:"Show more…"})})})]})})}function Di(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Ei({announcement:t}){const{instance:n}=B(),{contact:c}=is(),o=c==null?void 0:c.account,{id:s,content:i,startsAt:d,endsAt:r,published:u,allDay:l,publishedAt:h,updatedAt:f,read:b,mentions:a,statuses:m,tags:p,emojis:y,reactions:g}=t,v=new Date(h),I=He(v),k=new Date(f),x=He(k);return e("div",{class:"announcement-block",children:[e(Fe,{account:o}),e("div",{class:"announcement-content",onClick:yn({mentions:a,instance:n}),dangerouslySetInnerHTML:{__html:Mt(i,{emojis:y})}}),e("p",{class:"insignificant",children:[e("time",{datetime:v.toISOString(),children:He(v)}),f&&x!==I&&e($,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:k.toISOString(),children:He(k)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:g.map(E=>{const{name:A,count:R,me:V,staticUrl:F,url:_}=E;return e("button",{type:"button",class:`plain4 small ${V?"reacted":""}`,children:[_||F?e("img",{src:_||F,alt:A,width:"16",height:"16"}):e("span",{children:A})," ",e("span",{class:"count",children:Pe(R)})]})})})]})}const Gn=Be(Mi),_i=20;function Pt({local:t,columnMode:n,...c}){const o=he(S),s=!!t,i=n?{}:Ye(),{masto:d,instance:r}=B({instance:(c==null?void 0:c.instance)||i.instance}),u=`${s?"Local":"Federated"} timeline (${r})`;$e(u,s?"/:instance?/p/l":"/:instance?/p");const l=D(),h=D();async function f(a){(a||!h.current)&&(h.current=d.v1.timelines.public.list({limit:_i,local:s}));const m=await h.current.next();let{value:p}=m;return p!=null&&p.length&&(a&&(l.current=p[0].id),p=Ve(p,"public"),p.forEach(y=>{Ie(y,r)})),{...m,value:p}}async function b(){try{const a=await d.v1.timelines.public.list({limit:1,local:s,since_id:l.current}).next();let{value:m}=a;return m=Ve(m,"public"),!!(m!=null&&m.length)}catch{return!1}}return e(qe,{title:u,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:s?"Local timeline":"Federated timeline"}),e("div",{children:r})]}),id:"public",instance:r,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:b,useItemID:!0,headerStart:e($,{}),boostsCarousel:o.settings.boostsCarousel,allowFilters:!0,headerEnd:e(rt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(te,{href:s?`/#/${r}/p`:`/#/${r}/p/l`,children:s?e($,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e($,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(De,{}),e(te,{onClick:()=>{let a=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(a)){a&&alert("Invalid instance");return}a&&(a=a.toLowerCase().trim(),location.hash=s?`/${a}/p/l`:`/${a}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},r+s)}const Pi=20,Ni=nt(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Wn({columnMode:t,...n}){const c=he(S),o=t?{}:Ye(),{masto:s,instance:i}=B({instance:(n==null?void 0:n.instance)||o.instance}),d=`Trending (${i})`;$e(d,"/:instance?/trending");const r=D(),[u,l]=C([]),[h,f]=C([]),b=D();async function a(y){var I;if(y||!b.current){b.current=s.v1.trends.statuses.list({limit:Pi});try{const k=s.v1.trends.tags.list(),{value:x}=await k.next();x!=null&&x.length&&l(x)}catch{}try{const{value:k}=await Ni(s),x=(I=k==null?void 0:k.filter)==null?void 0:I.call(k,E=>E.type==="link");x!=null&&x.length&&f(x)}catch{}}const g=await b.current.next();let{value:v}=g;return v!=null&&v.length&&(y&&(r.current=v[0].id),v=Ve(v,"public"),v.forEach(k=>{Ie(k,i)})),{...g,value:v}}async function m(){try{const y=await s.v1.trends.statuses.list({limit:1}).next();let{value:g}=y;return g=Ve(g,"public"),g!=null&&g.length&&g[0].id!==r.current?(r.current=g[0].id,!0):!1}catch{return!1}}const p=me(()=>e($,{children:[!!u.length&&e("div",{class:"filter-bar",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),u.map((y,g)=>{const{name:v,history:I}=y,k=I.reduce((x,E)=>x+ +E.uses,0);return e(K,{to:`/${i}/t/${v}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),v]}),e("span",{class:"filter-count",children:k.toLocaleString()})]},v)})]}),!!h.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),h.map(y=>{const{authorName:g,authorUrl:v,blurhash:I,description:k,height:x,image:E,imageDescription:A,language:R,providerName:V,providerUrl:F,publishedAt:_,title:O,url:ne,width:ie}=y,Ae=new URL(ne).hostname.replace(/^www\./,"").replace(/\/$/,""),W=$n(I),oe=Ui(W),j=oe.map((Y,ae)=>ae===0?.65:Y),M=oe.map((Y,ae)=>ae===0?.9:Y),q=oe.map((Y,ae)=>ae===0?.4:Y);return e("a",{href:ne,target:"_blank",rel:"noopener noreferrer",style:{"--average-color":`rgb(${W==null?void 0:W.join(",")})`,"--accent-color":`oklab(${j==null?void 0:j.join(" ")})`,"--light-color":`oklab(${M==null?void 0:M.join(" ")})`,"--dark-color":`oklab(${q==null?void 0:q.join(" ")})`},children:e("article",{children:[e("figure",{children:e("img",{src:E,alt:A,width:ie,height:x,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:Ae})," ",!!_&&e($,{children:"· "}),!!_&&e($,{children:e(Tt,{datetime:_,format:"micro"})})]}),!!O&&e("h1",{class:"title",lang:R,dir:"auto",children:O})]}),!!k&&e("p",{class:"description",lang:R,dir:"auto",children:k})]})]})},ne)})]})]}),[u,h]);return e(qe,{title:d,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:"Trending"}),e("div",{children:i})]}),id:"trending",instance:i,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:a,checkForUpdates:m,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e($,{}),boostsCarousel:c.settings.boostsCarousel,allowFilters:!0,timelineStart:p,headerEnd:e(rt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(te,{onClick:()=>{let y=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(y)){y&&alert("Invalid instance");return}y&&(y=y.toLowerCase().trim(),location.hash=`/${y}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})})},i)}const Rt=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92;function Ui([t,n,c]){t=Rt(t/255),n=Rt(n/255),c=Rt(c/255);var o=.4122214708*t+.5363325363*n+.0514459929*c,s=.2119034982*t+.6806995451*n+.1073969566*c,i=.0883024619*t+.2817188376*n+.6299787005*c;return o=Math.cbrt(o),s=Math.cbrt(s),i=Math.cbrt(i),[o*.2104542553+s*.793617785+i*-.0040720468,o*1.9779984951+s*-2.428592205+i*.4505937099,o*.0259040371+s*.7827717662+i*-.808675766]}function Fi(){$e("Home","/");const t=he(S),{shortcuts:n}=t,c=n.map(o=>{if(!o)return null;const{type:s,...i}=o,d={following:jt,notifications:Gn,list:Hn,public:Pt,bookmarks:Bn,favourites:On,hashtag:qn,mentions:Vn,trending:Wn}[s];return d?e(d,{...i,columnMode:!0},s+JSON.stringify(i)):null});return Ce(["1","2","3","4","5","6","7","8","9"],(o,s)=>{try{const i=parseInt(s.keys[0],10)-1;document.querySelectorAll("#columns > *")[i].focus()}catch{}}),e("div",{id:"columns",children:c})}function zi(){var n;const t=he(S);return U(()=>{(async()=>{const c=await ot.drafts.keys();if(c.length){const o=Sn();c.filter(i=>i.startsWith(o)).length&&(S.showDrafts=!0)}})()},[]),e($,{children:(t.settings.shortcutsColumnsMode||t.settings.shortcutsViewMode==="multi-column")&&((n=t.shortcuts)!=null&&n.length)?e(Fi,{}):e(jt,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(Bi,{})})})}function Bi(){const t=he(S),n=D(),[c,o]=C(void 0);return e($,{children:[e(K,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${c||""}`,onClick:s=>{s.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(s.preventDefault(),o(i=>i?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(Hi,{state:c,anchorRef:n,onClose:()=>o(void 0)})]})}const Oi=30,qi=5;function Hi({anchorRef:t,state:n,onClose:c}){const{masto:o,instance:s}=B(),i=he(S),[d,r]=C("default"),u=o.v1.notifications.list({limit:Oi});async function l(){const m=await u.next(),p=m.value;if(p!=null&&p.length){p.forEach(g=>{Ie(g.status,s,{skipThreading:!0})});const y=jn(p);S.notificationsLast=p[0],S.notifications=y,o.v1.markers.create({notifications:{lastReadId:p[0].id}}).catch(()=>{})}return S.notificationsShowNew=!1,S.notificationsLastFetchTime=Date.now(),m}const[h,f]=C(!1);function b(){return o.v1.followRequests.list({limit:1})}function a(){r("loading"),(async()=>{try{await l();const m=await b();f(!!(m!=null&&m.length)),r("default")}catch{r("error")}})()}return U(()=>{n==="open"&&a()},[n]),e(Rn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:c,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:i.notifications.length?e($,{children:i.notifications.slice(0,qi).map(m=>e(Ht,{instance:s,notification:m},m.id))}):d==="loading"?e("div",{class:"ui-state",children:e(ve,{abrupt:!0})}):d==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:a,children:"Try again"})})]})}),e("footer",{children:[e(K,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(K,{to:"/notifications",class:"button plain2",children:[h?e($,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const Vi=Be(zi),ji=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,Gi=/\/notes\/([^\/]+)\/?$/i;function Kn(t){const{hostname:n,pathname:c}=new URL(t),[,o,s,i]=c.match(ji)||[];if(i)return`/${n}/s/${i}`;const[,d]=c.match(Gi)||[];if(d)return`/${n}/s/${d}`}function Wi(){const n=st().pathname.replace(/^\//,""),c=Kn(n);return ze(()=>{c&&setTimeout(()=>{window.location.hash=c+"?view=full"},300)},[c]),e("div",{class:"ui-state",tabIndex:"-1",children:[c?e($,{children:[e("h2",{children:"Redirecting…"}),e("p",{children:e("a",{href:`#${c}?view=full`,children:c})})]}):e($,{children:[e("h2",{children:"Unable to process URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(K,{to:"/",children:"Go home"})})]})}function Ki(){const{masto:t}=B();$e("Lists","/l");const[n,c]=C("default"),[o,s]=Ct(l=>l+1,0),[i,d]=C([]);U(()=>{c("loading"),(async()=>{try{const l=await t.v1.lists.list();l.sort((h,f)=>h.title.localeCompare(f.title)),d(l),c("default")}catch{c("error")}})()},[o]);const[r,u]=C(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(lt,{}),e(K,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>u(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:i.length>0?e("ul",{class:"link-list",children:i.map(l=>e("li",{children:e(K,{to:`/l/${l.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:l.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(ve,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),r&&e(ge,{class:"light",onClick:l=>{l.target===l.currentTarget&&u(!1)},children:e(qt,{list:r==null?void 0:r.list,onClose:l=>{l.state==="success"&&s(),u(!1)}})})]})}const Yi=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:Ji,VITE_WEBSITE:Xi}={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Gt="read write follow push";async function Zi({instanceURL:t}){const n=new URLSearchParams({client_name:Ji,redirect_uris:location.origin+location.pathname,scopes:Gt,website:Xi});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Qi({instanceURL:t,client_id:n}){const c=new URLSearchParams({client_id:n,scope:Gt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${c.toString()}`}async function eo({instanceURL:t,client_id:n,client_secret:c,code:o}){const s=new URLSearchParams({client_id:n,client_secret:c,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:o,scope:Gt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s.toString()})).json()}function to(){$e("Log in");const t=D(),n=Z.local.get("instanceURL"),[c,o]=C("default"),[s]=Oe(),i=s.get("instance"),[d,r]=C(i||(n==null?void 0:n.toLowerCase())||""),[u,l]=C([]);U(()=>{(async()=>{try{const m=await(await fetch(Yi)).json();l(m)}catch{}})()},[]);const h=a=>{Z.local.set("instanceURL",a),(async()=>{o("loading");try{const{client_id:m,client_secret:p,vapid_key:y}=await Zi({instanceURL:a});m&&p?(Z.session.set("clientID",m),Z.session.set("clientSecret",p),Z.session.set("vapidKey",y),location.href=await Qi({instanceURL:a,client_id:m})):alert("Failed to register application"),o("default")}catch{o("error")}})()},f=a=>{a.preventDefault();const{elements:m}=a.target;let p=m.instanceURL.value.toLowerCase();p=p.replace(/^https?:\/\//,"").replace(/\/+$/,""),p=p.replace(/^@?[^@]+@/,""),/\./.test(p)||(p=u.find(y=>y.includes(p))),h(p)},b=d?u.filter(a=>a.includes(d)).sort((a,m)=>{const p=a.toLowerCase().startsWith(d.toLowerCase()),y=m.toLowerCase().startsWith(d.toLowerCase());return p&&!y?-1:!p&&y?1:0}).slice(0,10):[];return e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:f,children:[e("h1",{children:"Log in"}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:d,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:c==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:a=>{r(a.target.value)}}),(b==null?void 0:b.length)>0?e("ul",{id:"instances-suggestions",children:b.map(a=>e("li",{children:e("button",{type:"button",class:"plain4",onClick:()=>{h(a)},children:a})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),c==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{class:"large",disabled:c==="loading",children:"Log in"})," "]}),e(ve,{hidden:c!=="loading"}),e("hr",{}),e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(K,{to:"/",children:"Go home"})})]})})}const pt=5,At=40;function no(t){const n=Ye(),{masto:c,instance:o,authenticated:s}=B({instance:n.instance}),[i,d]=C("default"),[r]=Oe(),u=D(),l=(t==null?void 0:t.query)||r.get("q"),h=(t==null?void 0:t.type)||r.get("type");$e(l?`Search: ${l}${h?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[h]})`:""}`:"Search","/search");const[f,b]=C(!1),a=D(0);U(()=>{a.current=0},[l,h]);const m=D();ze(()=>{var A,R;(R=(A=m.current)==null?void 0:A.scrollTo)==null||R.call(A,0,0)},[l,h]);const[p,y]=C([]),[g,v]=C([]),[I,k]=C([]);U(()=>{y([]),v([]),k([])},[l]);const x={statuses:y,accounts:v,hashtags:k};function E(A){d("loading"),A&&!h&&(y(p.slice(0,pt)),v(g.slice(0,pt)),k(I.slice(0,pt))),(async()=>{var V,F;const R={q:l,resolve:s,limit:pt};h&&(R.limit=At,R.type=h,s&&(R.offset=a.current));try{const _=await c.v2.search.fetch(R);if(h)if(A){x[h](_[h]);const O=(V=_[h])==null?void 0:V.length;a.current=At,b(!!O)}else{x[h](ne=>[...ne,..._[h]]);const O=(F=_[h])==null?void 0:F.length;a.current=a.current+At,b(!!O)}else y(_.statuses),v(_.accounts),k(_.hashtags),a.current=0,b(!1);d("default")}catch{d("error")}})()}return U(()=>{var A,R,V,F;l?((R=(A=u.current)==null?void 0:A.setValue)==null||R.call(A,l),E(!0)):(F=(V=u.current)==null?void 0:V.focus)==null||F.call(V)},[l,h,o]),Ce("/",A=>{var R,V;(V=(R=u.current)==null?void 0:R.focus)==null||V.call(R)},{preventDefault:!0}),e("div",{id:"search-page",class:"deck-container",ref:m,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:i==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(lt,{})}),e(zn,{ref:u}),e("div",{class:"header-side",children:" "})]})}),e("main",{children:[!!l&&e("div",{class:`filter-bar ${i==="loading"?"loading":""}`,children:[!!h&&e(K,{to:`/search${l?`?q=${encodeURIComponent(l)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(l)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(l)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(l)}&type=statuses`}].sort((A,R)=>A.type===h?-1:R.type===h?1:0).map(A=>e(K,{to:A.to,children:A.label},A.type))]}),l?e($,{children:[(!h||h==="accounts")&&e($,{children:[h!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),g.length>0?e($,{children:[e("ul",{class:"timeline flat accounts-list",children:g.map(A=>e("li",{children:e(Fe,{account:A,instance:o,showStats:!0})},A.id))}),h!=="accounts"&&e("div",{class:"ui-state",children:e(K,{class:"plain button",to:`/search?q=${l}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!h&&(i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!h||h==="hashtags")&&e($,{children:[h!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),I.length>0?e($,{children:[e("ul",{class:"link-list hashtag-list",children:I.map(A=>e("li",{children:e(K,{to:o?`/${o}/t/${A.name}`:`/t/${A.name}`,children:[e(w,{icon:"hashtag"}),e("span",{children:A.name})]})},A.name))}),h!=="hashtags"&&e("div",{class:"ui-state",children:e(K,{class:"plain button",to:`/search?q=${l}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!h&&(i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!h||h==="statuses")&&e($,{children:[h!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),p.length>0?e($,{children:[e("ul",{class:"timeline",children:p.map(A=>e("li",{children:e(K,{class:"status-link",to:o?`/${o}/s/${A.id}`:`/s/${A.id}`,children:e(Te,{status:A})})},A.id))}),h!=="statuses"&&e("div",{class:"ui-state",children:e(K,{class:"plain button",to:`/search?q=${l}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!h&&(i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!h&&(i==="default"?f?e(it,{onChange:A=>{A&&E()},children:e("button",{type:"button",class:"plain block",onClick:()=>E(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):i==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}))]}):i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const mt=40,so=10,io=5;let Nt={},yt={},wt={};function Ut(t){delete yt[t],delete wt[t]}const gt={block:"nearest",inline:"center",behavior:"smooth"};function oo(t){const{id:n}=t,{masto:c,instance:o}=B({instance:t.instance}),s=he(S),[i,d]=Oe(),r=i.get("media"),u=i.get("media-only"),l=parseInt(r||u,10);let h=l>0;const f=i.get("mediaStatusID"),b=Tn(f,o);f&&!b&&(h=!1);const a=h&&!!u,m=zt(n,o),[p,y]=C(S.statuses[m]);U(()=>{S.statuses[m]&&y(S.statuses[m])},[m]);const g=me(()=>{const{prevLocation:k}=S,x=((k==null?void 0:k.pathname)||"")+((k==null?void 0:k.search)||""),E=at("/:instance/s/:id",x)||at("/s/:id",x);return!x||E?"/":x},[]);U(()=>{!p&&h&&(async()=>{try{const k=await c.v1.statuses.$select(n).fetch();Ie(k,o),y(k)}catch{alert("Unable to load post."),location.hash=g}})()},[h]);const v=f?b==null?void 0:b.mediaAttachments:p==null?void 0:p.mediaAttachments,I=We(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&s.prevLocation?history.back():a?location.hash=g:(i.delete("media"),i.delete("mediaStatusID"),d(i))},[a,g,s.prevLocation]);return e("div",{class:"deck-backdrop",children:[h?v!=null&&v.length?e(Un,{mediaAttachments:v,statusID:f||n,instance:o,lang:p==null?void 0:p.language,index:l-1,onClose:I}):e("div",{class:"media-modal-container loading",children:e(ve,{abrupt:!0})}):e(K,{to:g}),!a&&e(co,{id:n,instance:t.instance,closeLink:g})]})}function co({id:t,closeLink:n="/",instance:c}){var Q;const[o,s]=Oe(),i=o.get("media"),d=parseInt(i,10)>0,[r,u]=C(o.get("view")),l=!!parseInt(o.get("translate")),{masto:h,instance:f}=B({instance:c}),{masto:b,instance:a,authenticated:m}=B(),p=f===a,y=he(S),[g,v]=C([]),[I,k]=C("default"),x=D(),E=zt(t,f),A=D(0),R=D();U(()=>{var T;(T=R.current)==null||T.focus()},[]),U(()=>{var L;const T=An(()=>{if(!R.current)return;const{scrollTop:H}=R.current;I!=="loading"&&(wt[t]=H)},50);return(L=R.current)==null||L.addEventListener("scroll",T,{passive:!0}),T(),()=>{var H;T.cancel(),(H=R.current)==null||H.removeEventListener("scroll",T)}},[t,I!=="loading"]);const V=D(),F=({reloadHero:T}={})=>{k("loading");let L;const H=yt[t];if(H){const P=H.filter(ee=>S.statuses[E]);v(P)}else v([{id:t}]);return(async()=>{var ue,Re;const P=()=>en(()=>h.v1.statuses.$select(t).fetch(),{retries:4}),ee=en(()=>h.v1.statuses.$select(t).context.fetch(),{retries:8}),ke=!!y.statuses[E];let se=y.statuses[E];if(!(ke&&!T))try{se=await P(),Ie(se,f),await new Promise(fe=>{setTimeout(fe,100)})}catch{k("error");return}try{let fe=function(G){return G==null?void 0:G.map(pe=>({id:pe.id,account:pe.account,repliesCount:pe.repliesCount,content:pe.content,weight:ct(pe),replies:fe(pe.__replies)}))};const Ee=await ee,{ancestors:N,descendants:le}=Ee;A.current=(le==null?void 0:le.length)||0;const be=new Set;N.forEach(G=>{Ie(G,f,{skipThreading:!0}),G.inReplyToId&&!N.find(pe=>pe.id===G.inReplyToId)&&be.add(G.inReplyToId)});const ye=N.every(G=>G.account.id===se.account.id),_e=[];le.forEach(G=>{if(Ie(G,f,{skipThreading:!0}),G.inReplyToId&&!le.find(pe=>pe.id===G.inReplyToId)&&G.inReplyToId!==se.id&&be.add(G.inReplyToId),G.inReplyToAccountId===G.account.id)_e.push(G);else if(G.inReplyToId===se.id)_e.push(G);else if(!G.inReplyToAccountId&&_e.find(pe=>pe.id===G.inReplyToId)&&G.account.id===se.account.id)_e.push(G);else{const pe=le.find(Je=>Je.id===G.inReplyToId);pe&&(pe.__replies||(pe.__replies=[]),pe.__replies.push(G))}}),be.size;const Ue=[...N.map(G=>({id:G.id,ancestor:!0,isThread:ye,accountID:G.account.id,account:G.account,repliesCount:G.repliesCount,weight:ct(G)})),{id:t,accountID:se.account.id,weight:ct(se)},..._e.map(G=>({id:G.id,account:G.account,accountID:G.account.id,descendant:!0,thread:G.account.id===se.account.id,weight:ct(G),replies:fe(G.__replies)}))];k("default"),V.current={offsetTop:(ue=x.current)==null?void 0:ue.offsetTop,scrollTop:(Re=R.current)==null?void 0:Re.scrollTop};const Me=Ue.findIndex(G=>G.id===t);Me>=W&&oe(Me+1),v(Ue),yt[t]=Ue,os(se,f)}catch{k("error")}})(),()=>{clearTimeout(L)}};U(F,[t,h]),U(()=>{var L,H;if(!g.length)return;const T=wt[t];if(T)R.current.scrollTop=T;else if(V.current){const P={offsetTop:(L=x.current)==null?void 0:L.offsetTop,scrollTop:(H=R.current)==null?void 0:H.scrollTop},ee=P.offsetTop-V.current.offsetTop+P.scrollTop;R.current.scrollTop=ee}else g.length===1&&(R.current.scrollTop=0);V.current=null},[g]),U(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:T}=tt(),L=`https://${T}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(L,{ignoreVary:!0}),F({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),U(()=>()=>{wt={},S.reloadStatusPage=0,yt={},Nt={},Ft.clear()},[]);const _=y.statuses[E]||y.statuses[t],O=me(()=>{if(!_)return"";const{account:T}=_,L=document.createElement("div");return L.innerHTML=T.displayName,L.innerText.trim()},[_]),ne=me(()=>{if(!_)return"";let T=In(_);return T.length>64&&(T=T.slice(0,64)+"…"),T},[_]);$e(O&&ne?`${O}: "${ne}"`:"Status","/:instance?/s/:id");const ie=me(()=>{if(!_)return;const{url:T}=_;if(T)return new URL(T).hostname},[_]),Ae=me(()=>{if(ie)return ie===f},[ie,f]),[W,oe]=C(mt),j=me(()=>g.length-W,[g.length,W]),M=g.some(T=>T.descendant),q=g.filter(T=>T.ancestor),[Y,ae]=C(!0),Se=St(ae,100),Le=me(()=>{if(!x.current||Y)return null;const{top:T}=x.current.getBoundingClientRect();return T>0?"down":"up"},[Y]);Ce("esc",()=>{location.hash=n},{enabled:!d}),Ce("backspace",()=>{location.hash=n}),Ce("j",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),L=T==null?void 0:T.getBoundingClientRect(),H=Array.from(R.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(T&&L.top<R.current.clientHeight&&L.bottom>0){const P=H.indexOf(T);let ee=H[P+1];ee&&(ee.focus(),ee.scrollIntoView(gt))}else{const P=H.find(ee=>{const ke=ee.getBoundingClientRect();return ke.top>=44&&ke.left>=0});P&&(P.focus(),P.scrollIntoView(gt))}}),Ce("k",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),L=T==null?void 0:T.getBoundingClientRect(),H=Array.from(R.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(T&&L.top<R.current.clientHeight&&L.bottom>0){const P=H.indexOf(T);let ee=H[P-1];ee&&(ee.focus(),ee.scrollIntoView(gt))}else{const P=H.find(ee=>{const ke=ee.getBoundingClientRect();return ke.top>=44&&ke.left>=0});P&&(P.focus(),P.scrollIntoView(gt))}}),Ce("x",()=>{const T=document.activeElement.closest(".status-link, .status-focus");if(T){const L=T.nextElementSibling;L&&L.tagName.toLowerCase()==="details"&&(L.open=!L.open)}});const{nearReachStart:re}=xt({scrollableRef:R,distanceFromStartPx:16}),z=D(d?"media+status":"status"),X=We((T,L,H,P)=>{T.preventDefault(),T.stopPropagation(),s({media:L+1,mediaStatusID:P.id})},[t]),J=We((T,L)=>{Ut(L.id)},[]),ce=T=>{const{id:L,ancestor:H,isThread:P,descendant:ee,thread:ke,replies:se,repliesCount:ue,weight:Re}=T,fe=L===t;return e("li",{ref:fe?x:null,class:`${H?"ancestor":""} ${ee?"descendant":""} ${ke?"thread":""} ${fe?"hero":""}`,children:[fe?e($,{children:[e(it,{threshold:.1,onChange:Se,class:"status-focus",tabIndex:0,children:e(Te,{statusID:L,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:l})}),I!=="loading"&&!m?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(K,{to:"/login",class:"button",children:"Log in"})]}):!p&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:I==="loading",onClick:()=>{k("loading"),(async()=>{try{const Ee=await b.v2.search.fetch({q:_.url,type:"statuses",resolve:!0,limit:1});if(Ee.statuses.length){const N=Ee.statuses[0];location.hash=a?`/${a}/s/${N.id}`:`/s/${N.id}`}else throw new Error("No results")}catch(Ee){k("default"),alert("Error: "+Ee)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(K,{class:"status-link",to:f?`/${f}/s/${L}`:`/s/${L}`,onClick:()=>{Ut(L)},children:[e(Te,{statusID:L,instance:f,withinContext:!0,size:ke||H?"m":"s",enableTranslate:!0,onMediaClick:X,onStatusLinkClick:J}),H&&P&&ue>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:ue,children:Pe(ue)})]})," "]}),ee&&(se==null?void 0:se.length)>0&&e(Yn,{instance:f,replies:se,hasParentThread:ke,level:1,accWeight:Re,openAll:A.current<so}),I==="loading"&&fe&&!!(_!=null&&_.repliesCount)&&!M&&e("div",{class:"status-loading",children:e(ve,{})}),I==="error"&&fe&&!!(_!=null&&_.repliesCount)&&!M&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{S.reloadStatusPage++},children:"Try again"})]})]},L)};return e("div",{tabIndex:"-1",ref:R,class:`status-deck deck contained ${g.length>1?"padded-bottom":""} ${z.current==="status"?"slide-in":""} ${r?`deck-view-${r}`:""}`,onAnimationEnd:T=>{z.current==="status"&&(z.current=null)},children:[e("header",{class:`${Y?"inview":""} ${I==="loading"?"loading":""}`,onDblClick:T=>{S.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[!!/\/s\//i.test((Q=y.prevLocation)==null?void 0:Q.pathname)&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!Y&&_&&I!=="loading"?e($,{children:[e("span",{class:"hero-heading",children:[e(vt,{account:_.account,instance:f,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(Tt,{datetime:_.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),x.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:Le==="down"?"arrow-down":"arrow-up"})})]}):e($,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),R.current.scrollTo({top:0,behavior:"smooth"})},hidden:!q.length||re,title:`${q.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),q.filter((T,L,H)=>H.findIndex(P=>P.accountID===T.accountID)===L).slice(0,3).map(T=>e(Ge,{url:T.account.avatar,alt:T.account.displayName},T.account.id)),q.length>3&&e($,{children:[" ",e("span",{class:"insignificant",children:Pe(q.length)})]})]})]})]}),e("div",{class:"header-side",children:[e(Ke,{align:"end",portal:{target:R.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(te,{disabled:I==="loading",onClick:()=>{S.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(te,{className:"menu-switch-view",onClick:()=>{u(r==="full"?null:"full"),o.delete("media"),o.delete("media-only"),r==="full"?o.delete("view"):o.set("view","full"),s(o)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[r||""]}),e("span",{children:["Switch to ",r==="full"?"Side Peek":"Full"," view"]})]}),e(te,{onClick:()=>{Array.from(R.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(L=>{L.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(De,{}),e(gs,{className:"plain",children:"Experimental"}),e(te,{disabled:Ae,onClick:()=>{const T=Kn(_.url);T?location.hash=T:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance (",e("b",{children:ie}),")"]})]})]}),e(K,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),g.length&&_?e("ul",{class:`timeline flat contextual grow ${I==="loading"?"loading":""}`,children:[g.slice(0,W).map(ce),j>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:I==="loading",onClick:()=>oe(T=>T+mt),style:{marginBlockEnd:"6em"},children:[e("div",{class:"ib avatars-bunch",children:g.slice(W,W+5).map(T=>e(Ge,{url:T.account.avatarStatic},T.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:j>mt?`${mt}+`:j})]})]})})]}):e($,{children:[I==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Te,{skeleton:!0,size:"l"})})}),I==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{S.reloadStatusPage++},children:"Try again"})]})]})]})}function Yn({replies:t,instance:n,hasParentThread:c,level:o,accWeight:s,openAll:i}){const[d,r]=Oe(),u=g=>g.reduce((v,I)=>{const{repliesCount:k,replies:x}=I,E=(x==null?void 0:x.length)||k;return v+E+u(x||[])},0),l=t.length+u(t),h=t.length===l,f=t.map(g=>g.account).filter((g,v,I)=>I.findIndex(k=>k.id===g.id)===v).slice(0,3),b=me(()=>t==null?void 0:t.reduce((g,v)=>g+(v==null?void 0:v.weight),s),[s,t==null?void 0:t.length]);let a=!1;(i||b<=io||!c&&l===1&&ct(t[0])<2)&&(a=!0);const m=Nt[t[0].id],p=We((g,v,I,k)=>{g.preventDefault(),g.stopPropagation(),r({media:v+1,mediaStatusID:k.id})},[]),y=D();return ze(()=>{var v;function g(I){I.target.dataset.scrollLeft=I.target.scrollLeft}return(v=y.current)==null||v.addEventListener("scroll",g,{passive:!0}),()=>{var I;(I=y.current)==null||I.removeEventListener("scroll",g)}},[]),e("details",{ref:y,class:"replies",open:m||a,onToggle:g=>{const{open:v}=g.target;Nt[t[0].id]=v},style:{"--comments-level":o},"data-comments-level":o,"data-comments-level-overflow":o>4,children:[e("summary",{class:"replies-summary",hidden:a,children:[e("span",{class:"avatars",children:f.map(g=>e(Ge,{url:g.avatarStatic,title:`${g.displayName} @${g.username}`,squircle:g==null?void 0:g.bot},g.id))}),e("span",{children:[e("span",{title:t.length,children:Pe(t.length)})," ","repl",t.length===1?"y":"ies"]}),!h&&l>1&&e($,{children:[" ","·"," ",e("span",{children:[e("span",{title:l,children:Pe(l)})," ","comment",l===1?"":"s"]})]})]}),e("ul",{children:t.map(g=>{var v,I;return e("li",{children:[e(K,{class:"status-link",to:n?`/${n}/s/${g.id}`:`/s/${g.id}`,onClick:()=>{Ut(g.id)},children:[e(Te,{statusID:g.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:p}),!((v=g.replies)!=null&&v.length)&&g.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:g.repliesCount,children:Pe(g.repliesCount)})]})]}),((I=g.replies)==null?void 0:I.length)&&e(Yn,{instance:n,replies:g.replies,level:o+1,accWeight:a?b:g.weight,openAll:i})]},g.id)})})]})}const ao=140,ro=35,lo=70,uo=140,Ft=new Map;function ct(t){var a,m;const n=Ft.get(t.id);if(n)return n;const{spoilerText:c,content:o,mediaAttachments:s,poll:i,card:d}=t,r=cs(c+o),u=s!=null&&s.length?ao:0,l=(((a=i==null?void 0:i.options)==null?void 0:a.length)||0)*ro,h=d&&(s!=null&&s.length||(m=i==null?void 0:i.options)!=null&&m.length)?0:lo,b=(r+u+l+h)/uo;return Ft.set(t.id,b),b}const ho=Be(oo);function fo(){const t=Ye(),{id:n,instance:c}=t;return e(ho,{id:n,instance:c})}const po=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,mo=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,go=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,bo=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,yo=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,wo=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function pn(){return $e(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("h1",{children:[e("img",{src:Mn,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:wo,alt:"Phanpy",width:"250"})]}),e("p",{children:e("big",{children:e("b",{children:e(K,{to:"/login",class:"button",children:"Log in"})})})}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:po,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:yo,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:mo,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:go,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:bo,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),e("hr",{}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),S.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const vo=window.alert;window.__nativeAlert||(window.__nativeAlert=vo);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=bs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=S;setTimeout(()=>{var t,n,c,o;for(const s in ht)Array.isArray(ht[s])?(n=(t=ht[s])[0])==null||n.call(t):(o=(c=ht)[s])==null||o.call(c)},5e3);(()=>{window.__IDLE__=!1;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],c=An(()=>{window.__IDLE__=!0},5e3),o=()=>{window.__IDLE__=!1,c()};t.forEach(s=>{window.addEventListener(s,o,{passive:!0,capture:!0})})})();xn(S,t=>{var n;for(const[c,o,s,i]of t){if(o.join(".")==="settings.shortcutsViewMode"){const d=document.getElementById("app");d&&(d.dataset.shortcutsViewMode=(n=S.shortcuts)!=null&&n.length?s:"")}o.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",s)}});function So(){const[t,n]=C(!1),[c,o]=C("loading");ze(()=>{const i=Z.local.get("theme");i&&(document.documentElement.classList.add(`is-${i}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",i==="auto"?"dark light":i));const d=Z.local.get("textSize");d&&document.documentElement.style.setProperty("--text-size",`${d}px`)},[]),U(()=>{const i=Z.local.get("instanceURL"),d=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(d){window.history.replaceState({},document.title,s.pathname||"/");const r=Z.session.get("clientID"),u=Z.session.get("clientSecret"),l=Z.session.get("vapidKey");(async()=>{o("loading");const{access_token:h}=await eo({instanceURL:i,client_id:r,client_secret:u,code:d}),f=as({instance:i,accessToken:h});await Promise.allSettled([Jt(f,i),rs(f,i,h,l)]),Xt(),Zt(f),n(!0),o("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const r=tt();if(r){Z.session.set("currentAccount",r.info.id);const{client:u}=B({account:r}),{instance:l}=u;Xt(),Zt(u),o("loading"),(async()=>{try{await Jt(u,l)}catch{}finally{n(!0),o("default")}})()}else o("default")}},[]);let s=st();return S.currentLocation=s.pathname,U(Dt,[s,t]),/\/https?:/.test(s.pathname)?e(Wi,{}):e($,{children:[e(ko,{isLoggedIn:t,loading:c==="loading"}),e(Io,{isLoggedIn:t}),c==="default"&&e(Bt,{children:e(we,{path:"/:instance?/s/:id",element:e(fo,{})})}),t&&e(Ss,{}),t&&e(oi,{}),e(ei,{}),t&&e(ni,{}),e(vs,{isLoggedIn:t}),c!=="loading"&&e(si,{onClose:Dt}),e(ks,{})]})}function ko({isLoggedIn:t,loading:n}){const c=st(),o=me(()=>{const{pathname:s}=c;return!/^\/(login|welcome)/.test(s)},[c]);return e(Bt,{location:o||c,children:[e(we,{path:"/",element:t?e(Vi,{}):n?e(ve,{id:"loader-root"}):e(pn,{})}),e(we,{path:"/login",element:e(to,{})}),e(we,{path:"/welcome",element:e(pn,{})})]})}function mn(){return S.prevLocation||null}function Io({isLoggedIn:t}){const n=st(),c=D(mn());return me(()=>at("/:instance/s/:id",n.pathname)||at("/s/:id",n.pathname),[n.pathname,at])?c.current||(c.current=mn()):c.current=null,e(Bt,{location:c.current||n,children:[t&&e($,{children:[e(we,{path:"/notifications",element:e(Gn,{})}),e(we,{path:"/mentions",element:e(Vn,{})}),e(we,{path:"/following",element:e(jt,{})}),e(we,{path:"/b",element:e(Bn,{})}),e(we,{path:"/f",element:e(On,{})}),e(we,{path:"/l",children:[e(we,{index:!0,element:e(Ki,{})}),e(we,{path:":id",element:e(Hn,{})})]}),e(we,{path:"/ft",element:e(wi,{})})]}),e(we,{path:"/:instance?/t/:hashtag",element:e(qn,{})}),e(we,{path:"/:instance?/a/:id",element:e(pi,{})}),e(we,{path:"/:instance?/p",children:[e(we,{index:!0,element:e(Pt,{})}),e(we,{path:"l",element:e(Pt,{local:!0})})]}),e(we,{path:"/:instance?/trending",element:e(Wn,{})}),e(we,{path:"/:instance?/search",element:e(no,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));ys(e(ws,{children:e(So,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-8c3c1c37.js.map
