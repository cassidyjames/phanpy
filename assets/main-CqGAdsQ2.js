import{A as B,y as G,M as rt,u as ce,d as R,s as E,a as se,b as Je,p as vt,c as Ge,q as nt,g as yt,e,k as P,T as u,f as yi,h as xt,i as Gt,j as Ln,l as Ee,m as Se,L as Do,C as Xn,n as Oo,o as zo,r as Mn,t as vi,v as Hi,w as bi,x as Qt,z as Bn,B as Fe,E as Fo,F as wi,G as ue,H as $n,I as Nn,_ as kt,J as Ls,K as su,N as Ms,O as $s,P as Uo,Q as Bo,R as ct,S as qo,U as Si,V as Ko,W as bt,X as Ho,Y as Yo,Z as ki,$ as _i,a0 as Pt,a1 as Qe,a2 as Ns,a3 as jo,a4 as Ps,a5 as Vo,a6 as Go,a7 as cn,a8 as Wo,ab as Zo,ac as Jn,ad as Qn,ae as Xo,af as Yi,ag as Jo,ah as Qo,ai as ea,aj as Ci,ak as Ze,am as ta,an as na,ao as ia,ap as sa,aq as oa,ar as aa}from"./pwa-viewport-DGn3pEw2.js";import{u as Ai,w as Ke,s as re,o as ji,a as ca,V as Ds,b as Os,I as A,C as Ii,M as He,c as Ye,S as hn,d as ge,e as qn,R as _t,n as st,f as zs,g as qe,A as pt,N as mt,h as lt,i as ft,L as fe,l as Mt,j as la,k as Fs,m as Nt,p as ru,q as Xe,r as Kn,t as ut,v as Vi,T as Us,x as it,y as ri,z as Bs,E as qs,B as We,D as gt,F as je,G as Tt,H as ra,J as da,K as Ft,O as Ti,P as Ks,Q as ua,U as Zt,W as ha,X as pa,Y as Hn,Z as fa,_ as Bt,$ as ma,a0 as ga,a1 as Hs,a2 as ya,a3 as xi,a4 as va,a5 as ba,a6 as wa,a7 as Sa,a8 as ka,a9 as Ys,aa as _a,ab as Ca,ac as Gi,ad as Aa,ae as Ia}from"./ScheduledAtField-Dfu2ULhx.js";import{ICONS as Yt}from"./ICONS-pwhJUn9E.js";var js=Ta;function Ta(n,i,o){var s=null,a=null,c=function(){s&&(clearTimeout(s),a=null,s=null)},p=function(){var r=a;c(),r&&r()},d=function(){if(!i)return n.apply(this,arguments);var r=this,l=arguments,h=o&&!s;if(c(),a=function(){n.apply(r,l)},s=setTimeout(function(){if(s=null,!h){var m=a;return a=null,m()}},i),h)return a()};return d.cancel=c,d.flush=p,d}/*!
 * swiped-events.js - v@version@
 * Pure JavaScript swipe events
 * https://github.com/john-doherty/swiped-events
 * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */(function(n,i){"use strict";typeof n.CustomEvent!="function"&&(n.CustomEvent=function(y,v){v=v||{bubbles:!1,cancelable:!1,detail:void 0};var k=i.createEvent("CustomEvent");return k.initCustomEvent(y,v.bubbles,v.cancelable,v.detail),k},n.CustomEvent.prototype=n.Event.prototype),i.addEventListener("touchstart",h,!1),i.addEventListener("touchmove",m,!1),i.addEventListener("touchend",l,!1);var o=null,s=null,a=null,c=null,p=null,d=null,r=0;function l(y){if(d===y.target){var v=parseInt(f(d,"data-swipe-threshold","20"),10),k=f(d,"data-swipe-unit","px"),S=parseInt(f(d,"data-swipe-timeout","500"),10),b=Date.now()-p,g="",C=y.changedTouches||y.touches||[];if(k==="vh"&&(v=Math.round(v/100*i.documentElement.clientHeight)),k==="vw"&&(v=Math.round(v/100*i.documentElement.clientWidth)),Math.abs(a)>Math.abs(c)?Math.abs(a)>v&&b<S&&(a>0?g="swiped-left":g="swiped-right"):Math.abs(c)>v&&b<S&&(c>0?g="swiped-up":g="swiped-down"),g!==""){var w={dir:g.replace(/swiped-/,""),touchType:(C[0]||{}).touchType||"direct",fingers:r,xStart:parseInt(o,10),xEnd:parseInt((C[0]||{}).clientX||-1,10),yStart:parseInt(s,10),yEnd:parseInt((C[0]||{}).clientY||-1,10)};d.dispatchEvent(new CustomEvent("swiped",{bubbles:!0,cancelable:!0,detail:w})),d.dispatchEvent(new CustomEvent(g,{bubbles:!0,cancelable:!0,detail:w}))}o=null,s=null,p=null}}function h(y){y.target.getAttribute("data-swipe-ignore")!=="true"&&(d=y.target,p=Date.now(),o=y.touches[0].clientX,s=y.touches[0].clientY,a=0,c=0,r=y.touches.length)}function m(y){if(!(!o||!s)){var v=y.touches[0].clientX,k=y.touches[0].clientY;a=o-v,c=s-k}}function f(y,v,k){for(;y&&y!==i.documentElement;){var S=y.getAttribute(v);if(S)return S;y=y.parentNode}return k}})(window,document);function Xt(n=()=>{},i=[]){const o=B(n);G(()=>{o.current=n},[i]),G(()=>{const s=()=>{const a=document.hidden||document.visibilityState==="hidden";o.current(!a)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[])}const xa=1e3*3,Wi=2e4,Ea=rt(function({isLoggedIn:i}){const{_:o}=ce(),[s,a]=R(!0),c=B();Xt(l=>{clearTimeout(c.current),l?a(!0):c.current=setTimeout(()=>{a(!1)},Wi)});const p=async(l,h,m)=>{if(E.notificationsLast){const f=l.v1.notifications.list({limit:1,sinceId:E.notificationsLast.id}).values(),{value:y}=await f.next();if(y?.length)if(m)E.notificationsShowNew=!0;else{let v;try{v=(await l.v1.markers.fetch({timeline:"notifications"}))?.notifications?.lastReadId}catch{}v?E.notificationsShowNew=y[0].id!==v:E.notificationsShowNew=!0}}};G(()=>{let l,h,m;if(i&&s){const{masto:f,streaming:y,instance:v}=se();(async()=>{await p(f,v);let k=!1;y&&(h=setTimeout(()=>{(async()=>{try{k=!0,l=y.user.notification.subscribe();for await(const S of l){if(!l||!s)break;S.event==="notification"&&Je(S.payload,v,{skipThreading:!0}),E.notificationsShowNew=!0}}catch{k=!1}k||(m=setInterval(()=>{p(f,v,!0)},Wi))})()},xa))})()}return()=>{l?.unsubscribe?.(),l=null,clearTimeout(h),clearInterval(m)}},[s,i]);const d=B(),r=()=>{d.current=Date.now(),fetch("./version.json").then(l=>l.json()).then(l=>{l&&(E.appVersion=l)}).catch(l=>{})};return Ai(r,s&&1e3*60*30),Xt(l=>{l&&(d.current?Date.now()-d.current>1e3*60*60&&r():r())}),Ke("shift+alt+k",l=>{if(!l.shiftKey||!l.altKey)return;const h=E.settings.cloakMode;E.settings.cloakMode=!h,re({text:o(h?{id:"oguMwa"}:{id:"IXZLPs"})})},{useKey:!0,ignoreEventWhen:l=>l.metaKey||l.ctrlKey}),null}),Ra=vt(async(n,i)=>{const o=n.v1.accounts.$select(i).statuses.list({limit:3,exclude_replies:!0,exclude_reblogs:!0}).values(),{value:s}=await o.next();return s||[]},{maxAge:6e4});function La(){const{_:n}=ce(),i=Ge(E),{masto:o}=se(),[s,a]=R(!1),[c,p]=R([]),[d,r]=R(!1),l=B(null),h=B(null),m=i.settings.shortcutsViewMode==="multi-column";function f(S){if(S.key&&S.key.toLowerCase()!=="c")return;if(i.composerState.minimized){E.composerState.minimized=!1,ji();return}const b=document.querySelectorAll("data.compose-data"),g=!m&&b.length===1?JSON.parse(b[0].value):void 0;S.shiftKey?ca(g)||(E.showCompose=g||!0):(ji(),E.showCompose=g||!0)}Ke("c, shift+c",f,{useKey:!0,ignoreEventWhen:S=>!!document.querySelector("#modal-container > *")||S.metaKey||S.ctrlKey||S.altKey});const y=Ds(()=>{a(!0)},{threshold:600}),v=nt(async()=>{try{r(!0);const S=yt();if(!S)return;const b=await Ra(o,S);p(b)}catch{}finally{r(!1)}},[o]),k=nt(S=>{Os({replyToStatus:S}),a(!1)},[]);return G(()=>{s&&v()},[v,s]),e(P,{children:[e("button",{ref:l,type:"button",id:"compose-button",onClick:f,onContextMenu:S=>{S.preventDefault(),a(!0)},...y(),class:`${i.composerState.minimized?"min":""} ${i.composerState.publishing?"loading":""} ${i.composerState.publishingError?"error":""}`,children:e(A,{icon:"quill",size:"xl",alt:n({id:"QOhkyl"})})}),e(Ii,{ref:h,state:s?"open":void 0,anchorRef:l,onClose:()=>a(!1),direction:"top",gap:8,unmountOnClose:!0,portal:{target:document.body},boundingBoxPadding:zs(),containerProps:{style:{zIndex:19},onClick:()=>{h.current?.closeMenu?.()}},submenuOpenDelay:600,children:[e(He,{to:"/sp",children:[e(A,{icon:"schedule"})," ",e("span",{children:e(u,{id:"+GkIdc"})})]}),e(Ye,{}),e(hn,{align:"end",direction:"top",shift:-8,disabled:d||c.length===0,label:e(P,{children:[e(A,{icon:"comment"})," ",e("span",{className:"menu-grow",children:e(u,{id:"LwOr4P"})}),d?"…":e(A,{icon:"chevron-right"})]}),children:c.length>0&&c.map(S=>{const b=new Date(S.createdAt),g=Date.now()-b.getTime()<864e5;return e(ge,{onClick:()=>k(S),children:e("small",{children:[e("div",{class:"menu-post-text",children:qn(S)}),e("span",{className:"more-insignificant",children:[g&&e(P,{children:[e(_t,{datetime:b,format:"micro"})," ","‒"," "]}),e("time",{className:"created",dateTime:b.toISOString(),title:b.toLocaleString(),children:st(S.createdAt)})]})]})},S.id)})})]})]})}const Ma=rt(function(){const{_:i}=ce(),o=Ge(E);function s(){E.showKeyboardShortcutsHelp=!1}return Ke("?",()=>{E.showKeyboardShortcutsHelp=!0},{useKey:!0,ignoreEventWhen:a=>/\/catchup/i.test(location.hash)||a.metaKey||a.ctrlKey||a.altKey}),!!o.showKeyboardShortcutsHelp&&e(qe,{onClose:s,children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:s,children:e(A,{icon:"x",alt:i({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:e(u,{id:"77Emn0"})})}),e("main",{children:e("table",{children:e("tbody",{children:[{action:i({id:"ulXSNi"}),keys:e("kbd",{children:"?"})},{action:i({id:"Gy9P9T"}),keys:e("kbd",{children:"j"})},{action:i({id:"6XYpYY"}),keys:e("kbd",{children:"k"})},{action:i({id:"DYowFe"}),keys:e(u,{id:"mzjGX4",components:{0:e("kbd",{}),1:e("kbd",{})}})},{action:i({id:"S5ez7Y"}),keys:e(u,{id:"Fd8FaU",components:{0:e("kbd",{}),1:e("kbd",{})}})},{action:i({id:"VkLESX"}),keys:e("kbd",{children:"."})},{action:i({id:"jsFF8C"}),keys:e(u,{id:"80sOCm",components:{0:e("kbd",{}),1:e("kbd",{})}})},{action:e(u,{id:"41gejM",components:{0:e("br",{})}}),keys:e("kbd",{children:"x"})},{action:i({id:"jAj8rv"}),keys:e(u,{id:"evz6c6",components:{0:e("kbd",{}),1:e("kbd",{})}})},{action:i({id:"duF1lx"}),keys:e(u,{id:"nhpsIN",components:{0:e("kbd",{}),1:e("kbd",{})}})},{action:i({id:"YrR3Co"}),keys:e("kbd",{children:"]"})},{action:i({id:"noxAFR"}),keys:e("kbd",{children:"["})},{action:i({id:"AIa/f7"}),keys:e("kbd",{children:"c"})},{action:i({id:"snPx8X"}),className:"insignificant",keys:e(u,{id:"+Cxvld",components:{0:e("kbd",{}),1:e("kbd",{})}})},{action:i({id:"1pKapz"}),keys:e(u,{id:"py67WT",components:{0:e("kbd",{}),1:e("kbd",{}),2:e("kbd",{}),3:e("kbd",{})}})},{action:i({id:"A1taO8"}),keys:e("kbd",{children:"/"})},{action:i({id:"ImOQa9"}),keys:e("kbd",{children:"r"})},{action:i({id:"KFs8c6"}),className:"insignificant",keys:e(u,{id:"XpQLJF",components:{0:e("kbd",{}),1:e("kbd",{})}})},{action:i({id:"cqi4Mx"}),keys:e(u,{id:"84WuL2",components:{0:e("kbd",{}),1:e("kbd",{})}})},{action:i({id:"kulphB"}),keys:e(u,{id:"yrz6Ck",components:{0:e("kbd",{}),1:e("kbd",{})}})},{action:i({id:"ZhhOwV"}),keys:e("kbd",{children:"q"})},{action:i({id:"PZlHt8"}),keys:e("kbd",{children:"d"})},{action:i({id:"C7ujRh"}),keys:e(u,{id:"v4TbMP",components:{0:e("kbd",{}),1:e("kbd",{}),2:e("kbd",{})}})}].map(({action:a,className:c,keys:p})=>e("tr",{children:[e("th",{class:c,children:a}),e("td",{children:p})]},a))})})})]})})}),di=new Set,tt=new WeakMap,qt=new WeakMap,ht=new WeakMap,ln=new WeakMap,ei=new WeakMap,on=new WeakMap,Ut=new WeakMap,$t=new WeakMap,Wt=new WeakSet;let at,Ei=0,Ri=0;const At="__aa_tgt",rn="__aa_del",Pn="__aa_new",Vs=n=>{const i=Da(n);i&&i.forEach(o=>Oa(o))},$a=n=>{n.forEach(i=>{i.target===at&&Na(),tt.has(i.target)&&Ht(i.target)})};function Gs(n){const i=n.getBoundingClientRect(),o=at?.clientWidth||0,s=at?.clientHeight||0;return i.bottom<0||i.top>s||i.right<0||i.left>o}function Li(n){const i=ln.get(n);i?.disconnect();let o=tt.get(n),s=0;const a=5;o||(o=Jt(n),tt.set(n,o));const{offsetWidth:c,offsetHeight:p}=at,r=[o.top-a,c-(o.left+a+o.width),p-(o.top+a+o.height),o.left-a].map(h=>`${-1*Math.floor(h)}px`).join(" "),l=new IntersectionObserver(()=>{++s>1&&Ht(n)},{root:at,threshold:1,rootMargin:r});l.observe(n),ln.set(n,l)}function Ht(n,i=!0){clearTimeout($t.get(n));const o=Yn(n),s=i?dn(o)?500:o.duration:0;$t.set(n,setTimeout(async()=>{const a=ht.get(n);try{await a?.finished,tt.set(n,Jt(n)),Li(n)}catch{}},s))}function Na(){clearTimeout($t.get(at)),$t.set(at,setTimeout(()=>{di.forEach(n=>_n(n,i=>Ws(()=>Ht(i))))},100))}function Pa(n){setTimeout(()=>{on.set(n,setInterval(()=>Ws(Ht.bind(null,n)),2e3))},Math.round(2e3*Math.random()))}function Ws(n){typeof requestIdleCallback=="function"?requestIdleCallback(()=>n()):requestAnimationFrame(()=>n())}let Ct;const Zs=typeof window<"u"&&"ResizeObserver"in window;Zs&&(at=document.documentElement,new MutationObserver(Vs),Ct=new ResizeObserver($a),window.addEventListener("scroll",()=>{Ri=window.scrollY,Ei=window.scrollX}),Ct.observe(at));function Da(n){return n.reduce((s,a)=>[...s,...Array.from(a.addedNodes),...Array.from(a.removedNodes)],[]).every(s=>s.nodeName==="#comment")?!1:n.reduce((s,a)=>{if(s===!1)return!1;if(a.target instanceof Element){if(ti(a.target),!s.has(a.target)){s.add(a.target);for(let c=0;c<a.target.children.length;c++){const p=a.target.children.item(c);if(p){if(rn in p)return!1;ti(a.target,p),s.add(p)}}}if(a.removedNodes.length)for(let c=0;c<a.removedNodes.length;c++){const p=a.removedNodes[c];if(rn in p)return!1;p instanceof Element&&(s.add(p),ti(a.target,p),qt.set(p,[a.previousSibling,a.nextSibling]))}}return s},new Set)}function ti(n,i){!i&&!(At in n)?Object.defineProperty(n,At,{value:n}):i&&!(At in i)&&Object.defineProperty(i,At,{value:n})}function Oa(n){var i,o;const s=n.isConnected,a=tt.has(n);s&&qt.has(n)&&qt.delete(n),((i=ht.get(n))===null||i===void 0?void 0:i.playState)!=="finished"&&((o=ht.get(n))===null||o===void 0||o.cancel()),Pn in n?Zi(n):a&&s?Fa(n):a&&!s?Ua(n):Zi(n)}function St(n){return Number(n.replace(/[^0-9.\-]/g,""))}function za(n){let i=n.parentElement;for(;i;){if(i.scrollLeft||i.scrollTop)return{x:i.scrollLeft,y:i.scrollTop};i=i.parentElement}return{x:0,y:0}}function Jt(n){const i=n.getBoundingClientRect(),{x:o,y:s}=za(n);return{top:i.top+s,left:i.left+o,width:i.width,height:i.height}}function Xs(n,i,o){let s=i.width,a=i.height,c=o.width,p=o.height;const d=getComputedStyle(n);if(d.getPropertyValue("box-sizing")==="content-box"){const l=St(d.paddingTop)+St(d.paddingBottom)+St(d.borderTopWidth)+St(d.borderBottomWidth),h=St(d.paddingLeft)+St(d.paddingRight)+St(d.borderRightWidth)+St(d.borderLeftWidth);s-=h,c-=h,a-=l,p-=l}return[s,c,a,p].map(Math.round)}function Yn(n){return At in n&&Ut.has(n[At])?Ut.get(n[At]):{duration:250,easing:"ease-in-out"}}function Js(n){if(At in n)return n[At]}function Mi(n){const i=Js(n);return i?Wt.has(i):!1}function _n(n,...i){i.forEach(o=>o(n,Ut.has(n)));for(let o=0;o<n.children.length;o++){const s=n.children.item(o);s&&i.forEach(a=>a(s,Ut.has(s)))}}function $i(n){return Array.isArray(n)?n:[n]}function dn(n){return typeof n=="function"}function Fa(n){const i=tt.get(n),o=Jt(n);if(!Mi(n))return tt.set(n,o);if(Gs(n)){tt.set(n,o),Li(n);return}let s;if(!i)return;const a=Yn(n);if(typeof a!="function"){let c=i.left-o.left,p=i.top-o.top;const d=i.left+i.width-(o.left+o.width);i.top+i.height-(o.top+o.height)==0&&(p=0),d==0&&(c=0);const[l,h,m,f]=Xs(n,i,o),y={transform:`translate(${c}px, ${p}px)`},v={transform:"translate(0, 0)"};l!==h&&(y.width=`${l}px`,v.width=`${h}px`),m!==f&&(y.height=`${m}px`,v.height=`${f}px`),s=n.animate([y,v],{duration:a.duration,easing:a.easing})}else{const[c]=$i(a(n,"remain",i,o));s=new Animation(c),s.play()}ht.set(n,s),tt.set(n,o),s.addEventListener("finish",Ht.bind(null,n,!1),{once:!0})}function Zi(n){Pn in n&&delete n[Pn];const i=Jt(n);tt.set(n,i);const o=Yn(n);if(!Mi(n))return;if(Gs(n)){Li(n);return}let s;if(typeof o!="function")s=n.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:o.duration*1.5,easing:"ease-in"});else{const[a]=$i(o(n,"add",i));s=new Animation(a),s.play()}ht.set(n,s),s.addEventListener("finish",Ht.bind(null,n,!1),{once:!0})}function Xi(n,i){var o;n.remove(),tt.delete(n),qt.delete(n),ht.delete(n),(o=ln.get(n))===null||o===void 0||o.disconnect(),setTimeout(()=>{if(rn in n&&delete n[rn],Object.defineProperty(n,Pn,{value:!0,configurable:!0}),i&&n instanceof HTMLElement)for(const s in i)n.style[s]=""},0)}function Ua(n){var i;if(!qt.has(n)||!tt.has(n))return;const[o,s]=qt.get(n);Object.defineProperty(n,rn,{value:!0,configurable:!0});const a=window.scrollX,c=window.scrollY;if(s&&s.parentNode&&s.parentNode instanceof Element?s.parentNode.insertBefore(n,s):o&&o.parentNode?o.parentNode.appendChild(n):(i=Js(n))===null||i===void 0||i.appendChild(n),!Mi(n))return Xi(n);const[p,d,r,l]=qa(n),h=Yn(n),m=tt.get(n);(a!==Ei||c!==Ri)&&Ba(n,a,c,h);let f,y={position:"absolute",top:`${p}px`,left:`${d}px`,width:`${r}px`,height:`${l}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!dn(h))Object.assign(n.style,y),f=n.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:h.duration,easing:"ease-out"});else{const[v,k]=$i(h(n,"remove",m));k?.styleReset!==!1&&(y=k?.styleReset||y,Object.assign(n.style,y)),f=new Animation(v),f.play()}ht.set(n,f),f.addEventListener("finish",()=>Xi(n,y),{once:!0})}function Ba(n,i,o,s){const a=Ei-i,c=Ri-o,p=document.documentElement.style.scrollBehavior;if(getComputedStyle(at).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+a,window.scrollY+c),!n.parentElement)return;const r=n.parentElement;let l=r.clientHeight,h=r.clientWidth;const m=performance.now();function f(){requestAnimationFrame(()=>{if(!dn(s)){const y=l-r.clientHeight,v=h-r.clientWidth;m+s.duration>performance.now()?(window.scrollTo({left:window.scrollX-v,top:window.scrollY-y}),l=r.clientHeight,h=r.clientWidth,f()):document.documentElement.style.scrollBehavior=p}})}f()}function qa(n){var i;const o=tt.get(n),[s,,a]=Xs(n,o,Jt(n));let c=n.parentElement;for(;c&&(getComputedStyle(c).position==="static"||c instanceof HTMLBodyElement);)c=c.parentElement;c||(c=document.body);const p=getComputedStyle(c),d=!ht.has(n)||((i=ht.get(n))===null||i===void 0?void 0:i.playState)==="finished"?Jt(c):tt.get(c),r=Math.round(o.top-d.top)-St(p.borderTopWidth),l=Math.round(o.left-d.left)-St(p.borderLeftWidth);return[r,l,s,a]}function Qs(n,i={}){if(Zs&&Ct&&!(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!dn(i)&&!i.disrespectUserMotionPreference)){Wt.add(n),getComputedStyle(n).position==="static"&&Object.assign(n.style,{position:"relative"}),_n(n,Ht,Pa,p=>Ct?.observe(p)),dn(i)?Ut.set(n,i):Ut.set(n,{duration:250,easing:"ease-in-out",...i});const c=new MutationObserver(Vs);c.observe(n,{childList:!0}),ei.set(n,c),di.add(n)}return Object.freeze({parent:n,enable:()=>{Wt.add(n)},disable:()=>{Wt.delete(n),_n(n,s=>{const a=ht.get(s);try{a?.cancel()}catch{}ht.delete(s);const c=$t.get(s);c&&clearTimeout(c),$t.delete(s);const p=on.get(s);p&&clearInterval(p),on.delete(s)})},isEnabled:()=>Wt.has(n),destroy:()=>{Wt.delete(n),di.delete(n),Ut.delete(n);const s=ei.get(n);s?.disconnect(),ei.delete(n),_n(n,a=>{Ct?.unobserve(a);const c=ht.get(a);try{c?.cancel()}catch{}ht.delete(a);const p=ln.get(a);p?.disconnect(),ln.delete(a);const d=on.get(a);d&&clearInterval(d),on.delete(a);const r=$t.get(a);r&&clearTimeout(r),$t.delete(a),tt.delete(a),qt.delete(a)})}})}function jn(n){const i=B(null),[o,s]=R(),a=c=>{o&&(c?o.enable():o.disable())};return G(()=>{i.current instanceof HTMLElement&&s(Qs(i.current,n||{}))},[]),G(()=>()=>{var c;(c=o?.destroy)===null||c===void 0||c.call(o)},[o]),[i,a]}function Ka(n){return("0"+n.toString(16)).slice(-2)}function Ha(){var n=new Uint32Array(28);return window.crypto.getRandomValues(n),Array.from(n,Ka).join("")}function Ya(n){const o=new TextEncoder().encode(n);return window.crypto.subtle.digest("SHA-256",o)}function ja(n){let i="";const o=new Uint8Array(n),s=o.byteLength;for(var a=0;a<s;a++)i+=String.fromCharCode(o[a]);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function eo(n){const i=await Ya(n);return ja(i)}async function Va({instanceURL:n}){if(!n)return!1;try{const i=await fetch(`https://${n}/.well-known/oauth-authorization-server`);return!i.ok||i.status!==200?!1:!!(await i.json()).code_challenge_methods_supported?.includes("S256")}catch{return!1}}window.__generateCodeChallenge=eo;const Ga={BASE_URL:"./",DEV:!1,MODE:"production",PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",PHANPY_TRANSLANG_INSTANCES:"translang.phanpy.social",PHANPY_WEBSITE:"https://phanpy.blaede.family",PROD:!0,SSR:!1,VITE_APP_ENV:"production"},{DEV:Wa,PHANPY_CLIENT_NAME:Za,PHANPY_WEBSITE:Dn}=Ga,Ni="read write follow push",Xa=Dn?Dn.toLowerCase().includes(location.hostname):!1,Ja=location.origin+location.pathname,Vn=Wa||!Xa?Ja:Dn;async function Qa({instanceURL:n}){const i=new URLSearchParams({client_name:Za,redirect_uris:Vn,scopes:Ni,website:Dn});return await(await fetch(`https://${n}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()})).json()}async function ec({instanceURL:n,client_id:i,forceLogin:o=!1}){const s=Ha(),a=await eo(s),c=new URLSearchParams({client_id:i,code_challenge_method:"S256",code_challenge:a,redirect_uri:Vn,response_type:"code",scope:Ni});return o&&c.append("force_login",!0),[`https://${n}/oauth/authorize?${c.toString()}`,s]}async function tc({instanceURL:n,client_id:i,forceLogin:o=!1}){const s=new URLSearchParams({client_id:i,scope:Ni,redirect_uri:Vn,response_type:"code"});return o&&s.append("force_login",!0),`https://${n}/oauth/authorize?${s.toString()}`}async function nc({instanceURL:n,client_id:i,client_secret:o,code:s,code_verifier:a}){const c=new URLSearchParams({client_id:i,redirect_uri:Vn,grant_type:"authorization_code",code:s});return o&&c.append("client_secret",o),a&&c.append("code_verifier",a),await(await fetch(`https://${n}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c.toString()})).json()}async function ic({instanceURL:n,client_id:i,client_secret:o,token:s}){try{const a=new URLSearchParams({client_id:i,client_secret:o,token:s});return(await fetch(`https://${n}/oauth/revoke`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:a.toString(),keepalive:!0})).ok}catch(a){return console.erro("Error revoking token",a),!1}}const sc=window.matchMedia("(display-mode: standalone)").matches;function oc({onClose:n}){const{_:i}=ce(),{masto:o}=se(),s=yi(),a=yt(),c=s.length>1,[p,d]=xt(l=>l+1,0),[r]=jn();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(A,{icon:"x",alt:i({id:"yz7wBu"})})}),e("header",{class:"header-grid",children:e("h2",{children:e(u,{id:"bPwFdf"})})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:r,children:s.map((l,h)=>{const m=l.info.id===a,f=h===0;return e("li",{children:[e("div",{children:[c&&e("span",{class:`current ${m?"is-current":""}`,children:e(A,{icon:"check-circle",alt:i({id:"Hp1l6f"})})}),e(pt,{url:l.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(m)try{const y=await o.v1.accounts.$select(l.info.id).fetch();l.info=y,Gt(s),d()}catch{}}}),e(mt,{account:c?{...l.info,acct:/@/.test(l.info.acct)?l.info.acct:`${l.info.acct}@${l.instanceURL}`}:l.info,showAcct:!0,onClick:()=>{m?E.showAccount=`${l.info.username}@${l.instanceURL}`:(Ln(l.info.id),location.reload())}})]}),e("div",{class:"actions",children:[f&&c&&e(P,{children:[e("span",{class:"tag",children:e(u,{id:"ovBPCi"})})," "]}),e(lt,{align:"end",menuButton:e("button",{type:"button",class:"plain more-button",children:e(A,{icon:"more",size:"l",alt:i({id:"2FYpfJ"})})}),children:[c&&e(P,{children:[e(ge,{disabled:m,onClick:()=>{Ln(l.info.id),location.reload()},children:[e(A,{icon:"transfer"})," ",e(u,{id:"3t/Nrv"})]}),!sc&&!m&&e(He,{href:`./?account=${l.info.id}`,target:"_blank",children:[e(A,{icon:"external"}),e("span",{children:e(u,{id:"PZgZtY"})})]}),e(Ye,{})]}),e(ge,{onClick:()=>{E.showAccount=`${l.info.username}@${l.instanceURL}`},children:[e(A,{icon:"user"}),e("span",{children:e(u,{id:"40z2Fm"})})]}),e(Ye,{}),c&&e(P,{children:[e(ge,{disabled:f,onClick:()=>{s.splice(h,1),s.unshift(l),Gt(s),d()},children:[e(A,{icon:"check-circle"}),e("span",{children:e(u,{id:"PPcets"})})]}),e(ge,{disabled:h<=1,onClick:()=>{s.splice(h,1),s.splice(h-1,0,l),Gt(s),d()},children:[e(A,{icon:"arrow-up"}),e("span",{children:e(u,{id:"QyioBP"})})]}),e(ge,{disabled:h===0||h===s.length-1,onClick:()=>{s.splice(h,1),s.splice(h+1,0,l),Gt(s),d()},children:[e(A,{icon:"arrow-down"}),e("span",{children:e(u,{id:"3Ib6FN"})})]}),e(Ye,{})]}),e(ft,{subMenu:!0,confirmLabel:e(P,{children:[e(A,{icon:"exit"}),e("span",{children:e(u,{id:"k08LxG",values:{0:l.info.acct},components:{0:e("span",{class:"bidi-isolate"})}})})]}),disabled:!m,menuItemClassName:"danger",onClick:async()=>{await ic({instanceURL:l.instanceURL,client_id:l.clientId,client_secret:l.clientSecret,token:l.accessToken}),s.splice(h,1),Gt(s);try{Ee.session.get("currentAccount")===l.info.id&&Ee.session.del("currentAccount")}catch{}location.href=location.pathname||"/"},children:[e(A,{icon:"exit"}),e("span",{children:e(u,{id:"CXk1bI"})})]}),!!l?.createdAt&&e("div",{class:"footer",children:[e(A,{icon:"account-add"}),e("span",{children:e(u,{id:"+9E7iR",values:{0:st(l.createdAt)},components:{0:e(_t,{datetime:l.createdAt})}})})]})]})]})]},l.info.id)})}),e("p",{children:e(fe,{to:"/login",class:"button plain2",onClick:n,children:[e(A,{icon:"plus"})," ",e("span",{children:e(u,{id:"Is7/PB"})})]})}),c&&e("p",{children:e("small",{children:e(u,{id:"52x24e",components:{0:e("i",{})}})})})]})})]})}const Pi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e",ac={"zh-CN":"zh-Hans","zh-TW":"zh-Hant","pt-BR":"pt-BR"};function Di(){const{i18n:n}=ce(),i=Se(()=>Do.map(o=>{const s=ac[o]||o.replace(/-[a-z]+$/i,""),a=Mt({code:s,locale:o,fallback:Xn.find(p=>p.code===o)?.nativeName}),c=Mt({code:s,locale:n.locale,fallback:Xn.find(p=>p.code===o)?.name});return{code:o,regionlessCode:s,_common:c,native:a}}).sort((o,s)=>{const a=o._common.localeCompare(s._common,n.locale);return a!==0?a:o.code<s.code?-1:o.code>s.code?1:0}),[]);return e("label",{class:"lang-selector",children:["🌐"," ",e("select",{class:"small",value:n.locale||zo,onChange:o=>{Ee.local.set("lang",o.target.value),Oo(o.target.value)},children:[i.map(({code:o,regionlessCode:s,native:a})=>{const c=Mt({code:s,locale:n.locale,fallback:Xn.find(d=>d.code===o)?.name});return e("option",{value:o,"data-regionless-code":s,children:!!c&&c!==a?`${a} - ${c}`:a},o)}),void 0]})]})}function Ji(n){const{masto:i}=se();return i.v1.push.subscription.create(n)}function cc(){const{masto:n}=se();return n.v1.push.subscription.fetch()}function lc(n){const{masto:i}=se();return i.v1.push.subscription.update(n)}function rc(){const{masto:n}=se();return n.v1.push.subscription.remove()}function Gn(){return"serviceWorker"in navigator&&"PushManager"in window}function dc(){return navigator.serviceWorker.getRegistration()}async function Oi(){const n=await dc(),i=n?await n.pushManager.getSubscription():void 0;return{registration:n,subscription:i}}function to(n){const i="=".repeat((4-n.length%4)%4),o=`${n}${i}`.replace(/-/g,"+").replace(/_/g,"/"),s=window.atob(o),a=new Uint8Array(s.length);for(let c=0;c<s.length;++c)a[c]=s.charCodeAt(c);return a}async function uc(){if(!Gn())return;const{subscription:n}=await Oi();let i=null;try{i=await cc()}catch(o){if(!/(not found|unknown)/i.test(o.message))throw o}if(i&&n){const o=i.endpoint===n.endpoint,s=Mn(),a=i.serverKey===s;if(!o)throw new Error("Backend subscription endpoint changed");if(!a)throw new Error("Backend subscription key and vapid key changed")}if(n&&!i){const o=Mn();if(o){const{applicationServerKey:s}=n.options,a=to(o).toString(),c=new Uint8Array(s).toString();if(!(a===c))throw await n.unsubscribe(),new Error("Subscription key and vapid key changed")}}return{subscription:n,backendSubscription:i}}async function Qi({data:n,policy:i}){if(!Gn())return;let{registration:o,subscription:s}=await Oi(),a=null;if(s)try{a=await lc({data:n,policy:i})}catch{a=await Ji({subscription:s,data:n,policy:i})}else{const c=Mn();if(!c)throw new Error("No server key found");s=await o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:to(c)}),a=await Ji({subscription:s,data:n,policy:i})}return{subscription:s,backendSubscription:a}}async function es(){if(!Gn())return;const{subscription:n}=await Oi();n&&(await rc(),await n.unsubscribe())}const hc={BASE_URL:"./",DEV:!1,MODE:"production",PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",PHANPY_TRANSLANG_INSTANCES:"translang.phanpy.social",PHANPY_WEBSITE:"https://phanpy.blaede.family",PROD:!0,SSR:!1,VITE_APP_ENV:"production"},ts=16,Ot=[14,15,16,17,18,19,20],{PHANPY_WEBSITE:ns,PHANPY_PRIVACY_POLICY_URL:pc,PHANPY_TRANSLANG_INSTANCES:fc,PHANPY_IMG_ALT_API_URL:mc,PHANPY_GIPHY_API_KEY:gc}=hc,is=Object.entries(la.tl).map(([n,i])=>({code:n,name:i})),yc="TransLang API";function vc({onClose:n}){const{_:i}=ce(),o=Ge(E),s=Ee.local.get("theme")||"auto",a=B(),c=o.settings.contentTranslationTargetLanguage||null,p=Fs(),d=Mt(p),r=Ee.local.get("textSize")||ts,[l,h]=R(vi()),{masto:m,authenticated:f,instance:y}=se(),[v,k]=R(Ee.local.get("experiments-tabBarV2")??!1),S=l["posting:default:visibility"]==="private";return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",style:{"--current-text-size":`${r}px`},children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(A,{icon:"x",alt:i({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:e(u,{id:"Tz0i8g"})})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:e(u,{id:"aAIQg2"})})}),e("div",{children:e("form",{ref:a,onInput:b=>{b.preventDefault();const C=new FormData(a.current).get("theme"),w=document.documentElement;if(C==="auto"){w.classList.remove("is-light","is-dark");const I=document.querySelector('meta[data-theme-setting="manual"]');I&&(I.name=""),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(T=>{T.name="theme-color"})}else{w.classList.toggle("is-light",C==="light"),w.classList.toggle("is-dark",C==="dark");const I=document.querySelector('meta[data-theme-setting="manual"]');I&&(I.name="theme-color",I.content=C==="light"?I.dataset.themeLightColor:I.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(T=>{T.name=""})}document.querySelector('meta[name="color-scheme"]').setAttribute("content",C==="auto"?"light dark":C),C==="auto"?Ee.local.del("theme"):Ee.local.set("theme",C)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:s==="light"}),e("span",{children:e(u,{id:"1njn7W"})})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:s==="dark"}),e("span",{children:e(u,{id:"pvnfJD"})})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:s!=="light"&&s!=="dark"}),e("span",{children:e(u,{id:"R9Khdg"})})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:e(u,{id:"7r6sCa"})})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:Ot[0]},children:e(u,{id:"J6ypuD"})})," ",e("input",{type:"range",min:Ot[0],max:Ot[Ot.length-1],step:"1",value:r,list:"sizes",onChange:b=>{const g=parseInt(b.target.value,10);document.documentElement.style.setProperty("--text-size",`${g}px`),g===ts?Ee.local.del("textSize"):Ee.local.set("textSize",b.target.value)}})," ",e("span",{style:{fontSize:Ot[Ot.length-1]},children:e(u,{id:"J6ypuD"})}),e("datalist",{id:"sizes",children:Ot.map(b=>e("option",{value:b}))})]})]}),e("li",{children:[e("span",{children:[e("label",{children:e(u,{id:"CeJHfb"})}),e("br",{}),e("small",{children:e("a",{href:"https://crowdin.com/project/phanpy",target:"_blank",rel:"noopener",children:e(u,{id:"FFmj1D"})})})]}),e(Di,{})]})]})}),f&&e(P,{children:[e("h3",{children:e(u,{id:"PcoS3v"})}),e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:[e(u,{id:"NAjVvt"})," ",e(A,{icon:"cloud",alt:i({id:"N2FcBE"}),class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:l["posting:default:visibility"]||"public",onChange:b=>{const{value:g}=b.target;(async()=>{try{await m.v1.accounts.updateCredentials({source:{privacy:g}});const C={...l,"posting:default:visibility":g};g==="private"&&(C["posting:default:quote_policy"]="nobody"),h(C),Hi(C)}catch{alert(i({id:"Oa+KBY"}))}})()},children:[e("option",{value:"public",children:e(u,{id:"7d1a0d"})}),e("option",{value:"unlisted",children:e(u,{id:"pPYeIN"})}),e("option",{value:"private",children:e(u,{id:"x5LEuB"})})]})})]}),Nt()&&e("li",{children:[e("div",{children:e("label",{for:"posting-quote-policy-field",children:[e(u,{id:"eKInue"})," ",e(A,{icon:"cloud",alt:i({id:"N2FcBE"}),class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-quote-policy-field",value:l["posting:default:quote_policy"]||S?"nobody":"public",disabled:S,onChange:b=>{const{value:g}=b.target;(async()=>{try{await m.v1.accounts.updateCredentials({source:{quote_policy:g}}),h({...l,"posting:default:quote_policy":g}),Hi({...l,"posting:default:quote_policy":g})}catch{alert(i({id:"hEe3YR"}))}})()},children:[e("option",{value:"public",disabled:S,children:e(u,{id:"hDWXuG"})}),e("option",{value:"followers",disabled:S,children:e(u,{id:"9Ko+Xp"})}),e("option",{value:"nobody",children:e(u,{id:"+bAQ3S"})})]})})]})]})}),e("p",{class:"section-postnote",children:[e(A,{icon:"cloud",alt:i({id:"N2FcBE"}),class:"synced-icon"})," ",e("small",{children:e(u,{id:"xlsg7n",values:{instance:y},components:{0:e("a",{href:`https://${y}/`,target:"_blank",rel:"noopener"})}})})]})]}),e("h3",{children:e(u,{id:"ivdhsq"})}),e("section",{children:e("ul",{children:[e("li",{class:"block",children:e("label",{children:[e("input",{type:"checkbox",checked:o.settings.autoRefresh,onChange:b=>{E.settings.autoRefresh=b.target.checked}})," ",e(u,{id:"0mC0SF"})]})}),e("li",{class:"block",children:e("label",{children:[e("input",{type:"checkbox",checked:o.settings.boostsCarousel,onChange:b=>{E.settings.boostsCarousel=b.target.checked}})," ",e(u,{id:"TSbnoW"})]})}),!!fc&&e("li",{class:"block",children:[e("label",{children:[e("input",{type:"checkbox",checked:o.settings.contentTranslation,onChange:b=>{const{checked:g}=b.target;E.settings.contentTranslation=g,g||(E.settings.contentTranslationTargetLanguage=null)}})," ",e(u,{id:"0SdaOt"})]}),e("div",{class:`sub-section ${o.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:[e(u,{id:"zXCa9e"})," ",e("select",{value:c||"",disabled:!o.settings.contentTranslation,style:{width:"10em"},onChange:b=>{E.settings.contentTranslationTargetLanguage=b.target.value||null},children:[e("option",{value:"",children:e(u,{id:"jNCSyx",values:{systemTargetLanguageText:d}})}),e("option",{disabled:!0,children:"──────────"}),is.map(b=>{const g=Mt({code:b.code,fallback:b.name}),C=Mt({code:b.code,locale:b.code}),w=C&&g!==C;return e("option",{value:b.code,children:w?`${C} - ${g}`:g})})]})]})}),e("hr",{}),e("div",{class:"checkbox-fieldset",children:[e(u,{id:"cc0NrU",values:{0:o.settings.contentTranslationHideLanguages.length}}),e("div",{class:"checkbox-fields",children:is.map(b=>{const g=Mt({code:b.code,fallback:b.name}),C=Mt({code:b.code,locale:b.code}),w=C&&g!==C;return e("label",{children:[e("input",{type:"checkbox",checked:o.settings.contentTranslationHideLanguages.includes(b.code),onChange:I=>{const{checked:_}=I.target;_?E.settings.contentTranslationHideLanguages.push(b.code):E.settings.contentTranslationHideLanguages=o.settings.contentTranslationHideLanguages.filter(T=>T!==b.code)}})," ",w?e("span",{children:[C," ",e("span",{class:"insignificant ib",children:["- ",g]})]}):g]})})})]}),e("p",{class:"insignificant",children:e("small",{children:e(u,{id:"7I3sDQ",values:{TRANSLATION_API_NAME:yc},components:{0:e("a",{href:"https://github.com/cheeaun/translang-api",target:"_blank",rel:"noopener"})}})})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:o.settings.contentTranslationAutoInline,disabled:!o.settings.contentTranslation,onChange:b=>{E.settings.contentTranslationAutoInline=b.target.checked}})," ",e(u,{id:"gURvmk"})]}),e("p",{class:"insignificant",children:e("small",{children:e(u,{id:"PbHARL",components:{0:e("b",{})}})})})]})]})]}),!!gc&&f&&e("li",{class:"block",children:[e("label",{children:[e("input",{type:"checkbox",checked:o.settings.composerGIFPicker,onChange:b=>{E.settings.composerGIFPicker=b.target.checked}})," ",e(u,{id:"D7/2jB"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:e(u,{id:"/CLBTL",components:{0:e("a",{href:"https://developers.giphy.com/",target:"_blank",rel:"noopener"})}})})})]}),!!mc&&f&&e("li",{class:"block",children:[e("label",{children:[e("input",{type:"checkbox",checked:o.settings.mediaAltGenerator,onChange:b=>{E.settings.mediaAltGenerator=b.target.checked}})," ",e(u,{id:"9q5uor"})," ",e(A,{icon:"sparkles2",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:e(u,{id:"faZ9RI"})})}),e("div",{class:"sub-section insignificant",children:e("small",{children:e(u,{id:"fHZgvt",components:{0:e("a",{href:"https://github.com/cheeaun/img-alt-api",target:"_blank",rel:"noopener"})}})})})]}),f&&bi()?.mastodon>=2&&e("li",{class:"block",children:[e("label",{children:[e("input",{type:"checkbox",checked:o.settings.groupedNotificationsAlpha,onChange:b=>{E.settings.groupedNotificationsAlpha=b.target.checked}})," ",e(u,{id:"aGziA/"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:e(u,{id:"X17jCM"})})})]}),f&&e("li",{class:"block",children:[e("label",{children:[e("input",{type:"checkbox",checked:o.settings.shortcutSettingsCloudImportExport,onChange:b=>{E.settings.shortcutSettingsCloudImportExport=b.target.checked}})," ",e(u,{id:"570qTm"})," ",e(A,{icon:"cloud",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:e(u,{id:"0tZAhT",components:{0:e("br",{})}})})}),e("div",{class:"sub-section insignificant",children:e("small",{children:e(u,{id:"fHf1v/"})})})]}),e("li",{class:"block",children:[e("label",{children:[e("input",{type:"checkbox",checked:o.settings.cloakMode,onChange:b=>{E.settings.cloakMode=b.target.checked}})," ",e(u,{id:"lxYe+I",components:{0:e("span",{class:"insignificant"}),1:e("samp",{}),2:e("samp",{})}})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:e(u,{id:"T/hglb"})})})]}),f&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{E.showDrafts=!0,E.showSettings=!1},children:e(u,{id:"krk5ws"})})})]})}),f&&e(bc,{onClose:n}),e("h3",{children:e(u,{id:"uyJsf6"})}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:Pi,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener",onClick:b=>{b.preventDefault(),E.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e(u,{id:"AZ2EoP",components:{0:e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener"}),1:e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener",onClick:b=>{b.preventDefault(),E.showAccount="cheeaun@mastodon.social"}})}})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener",children:e(u,{id:"O4cLCR"})})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener",children:e(u,{id:"Ng063n"})})," ","·"," ",e("a",{href:"https://patreon.com/cheeaun",target:"_blank",rel:"noopener",children:"Patreon"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/CHANGELOG.md",target:"_blank",rel:"noopener",children:e(u,{id:"3ePd3I"})})," ","·"," ",e("a",{href:pc,target:"_blank",rel:"noopener",children:e(u,{id:"LcET2C"})})]}),e("p",{children:[ns&&e(P,{children:[e(u,{id:"pFnMHn",values:{0:ns.replace(/https?:\/\//g,"").replace(/\/$/,"")},components:{0:e("span",{class:"insignificant"})}}),e("br",{})]}),e(u,{id:"6KkH+2",values:{0:e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/ac2004e",target:"_blank",rel:"noopener",children:e(_t,{datetime:new Date("2025-10-07T15:35:52.703Z")})}),")"]})},components:{0:e("span",{class:"insignificant"}),1:e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2025-10-07T15:35:52.703Z".slice(0,10).replace(/-/g,".")}.ac2004e`,onClick:b=>{b.target.select();try{navigator.clipboard.writeText(b.target.value),re(i({id:"PiPfua"}))}catch{re(i({id:"gdxreD"}))}}})}})]})]}),void 0]})]})}function bc({onClose:n}){const{_:i}=ce();if(!Gn())return null;const{instance:o}=se(),[s,a]=R("default"),c=B(),[p,d]=R(!1),[r,l]=R(!1),h=B();G(()=>{(async()=>{a("loading");try{const{subscription:f,backendSubscription:y}=await uc();if(y?.policy&&y.policy!=="none"){d(!0);const{alerts:v,policy:k}=y;h.current=k;const{elements:S}=c.current,b=S.namedItem("policy");b&&(b.value=k),Object.entries(v).forEach(([g,C])=>{const w=S.namedItem(g);w?.type==="checkbox"&&(w.checked=!!C)})}a("default")}catch(f){/outside.*authorized/i.test(f.message)?l(!0):alert(f?.message||f),a("error")}})()},[]);const m=s==="loading";return e("form",{ref:c,onChange:()=>{setTimeout(()=>{const f=Object.fromEntries(new FormData(c.current)),y=!!f["policy-allow"],v={data:{policy:f.policy,alerts:{mention:!!f.mention,favourite:!!f.favourite,reblog:!!f.reblog,follow:!!f.follow,follow_request:!!f.followRequest,poll:!!f.poll,update:!!f.update,status:!!f.status}}};let k=0;Object.keys(v.data.alerts).forEach(b=>{v.data.alerts[b]?k++:delete v.data.alerts[b]});const S=h.current!==v.data.policy;y&&k>0?S?es().then(()=>{Qi(v)}).catch(b=>{alert(i({id:"I6pdY3"}))}):Qi(v).catch(b=>{alert(i({id:"I6pdY3"}))}):es().catch(b=>{alert(i({id:"q1zFd+"}))})},100)},children:[e("h3",{children:e(u,{id:"WUHLnz"})}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:m||r,name:"policy-allow",checked:p,onChange:async f=>{const{checked:y}=f.target;if(y){const v=await Notification.requestPermission();v==="granted"?d(!0):(d(!1),v==="denied"&&alert(i({id:"6LUsk7"})))}else d(!1)}})," ",e(u,{id:"qYNCa1",values:{0:[{value:"all",label:i({id:"+niKJH"})},{value:"followed",label:i({id:"x2NYtp"})},{value:"follower",label:i({id:"PBFNgg"})}].map(f=>e("option",{value:f.value,children:f.label}))},components:{0:e("select",{name:"policy",disabled:m||r||!p})}})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!p,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:i({id:"/bZzdR"})},{value:"favourite",label:i({id:"zZOZj7"})},{value:"reblog",label:i({id:"puY2t0"})},{value:"follow",label:i({id:"aaJhcT"})},{value:"followRequest",label:i({id:"6Fs1Ba"})},{value:"poll",label:i({id:"wNExRS"})},{value:"update",label:i({id:"K/EtE6"})},{value:"status",label:i({id:"2yr1/p"})}].map(f=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:f.value})," ",f.label]})}))})})})}),r&&e("div",{class:"sub-section",children:e("p",{children:e(u,{id:"8d0b8B",components:{0:e(fe,{to:`/login?instance=${o}`,onClick:n}),1:e("b",{})}})})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:e(u,{id:"z96cOX",components:{0:e("b",{})}})})})]})}const ui=()=>{let n=setTimeout(()=>{const i=document.getElementById("columns");if(i){const o=i.querySelector(".deck-container.focus");if(o)o.focus();else{const s=Array.from(i.querySelectorAll(".deck-container")).find(a=>a.getBoundingClientRect().left>=0);s?s.focus():i.querySelector(".deck-container")?.focus?.()}}else{const o=document.querySelectorAll("#modal-container > *");if(o?.length){const p=o[o.length-1],d=p.querySelector('[tabindex="-1"]')||p;if(d){d.focus();return}}if(document.querySelector(".deck-backdrop"))return;const a=document.querySelectorAll(".deck-container"),c=a[a.length-1];c&&c.tabIndex===-1&&c.focus()}},100);return()=>clearTimeout(n)};function no(n){if(!n)return;const i=Qt(),o=B(i.pathname);G(()=>{o.current&&i.pathname!==o.current&&n?.()},[i.pathname,n])}function wc({acct:n,instance:i}){let[o,s]=n.split("@");s||(s=i);const a=Bn.toASCII(n);return e("div",{class:"handle-info",children:[e("span",{class:"handle-handle",title:a,children:[e("b",{class:"handle-username",children:o}),e("span",{class:"handle-at",children:"@"}),e("b",{class:"handle-server",children:s})]}),e("div",{class:"handle-legend",children:[e("span",{class:"ib",children:[e("span",{class:"handle-legend-icon username"})," ",e(u,{id:"silO9A"})]})," ",e("span",{class:"ib",children:[e("span",{class:"handle-legend-icon server"})," ",e(u,{id:"rZgCpJ"})]})]})]})}const Sc=["image/jpeg","image/png","image/gif","image/webp"],ss=Sc.join(",");function kc({name:n,value:i,disabled:o,index:s}){const[a,c]=R(!!i);return e("tr",{children:[e("td",{children:e("input",{type:"text",name:`fields_attributes[${s}][name]`,defaultValue:n,disabled:o,maxLength:255,required:a,dir:"auto"})}),e("td",{children:e("input",{type:"text",name:`fields_attributes[${s}][value]`,defaultValue:i,disabled:o,maxLength:255,onChange:p=>c(!!p.currentTarget.value),dir:"auto"})})]})}function _c({onClose:n=()=>{}}){const{_:i}=ce(),{masto:o}=se(),[s,a]=R("loading"),[c,p]=R(null),[d,r]=R(null),[l,h]=R(null);G(()=>{(async()=>{try{const w=await o.v1.accounts.verifyCredentials();p(w),a("default")}catch{a("error")}})()},[]);const{displayName:m,source:f,avatar:y,header:v}=c||{},{note:k,fields:S}=f||{},b=B(null),g=[...y?[{type:"image",url:y}]:[],...l?[{type:"image",url:l}]:[]],C=[...v?[{type:"image",url:v}]:[],...d?[{type:"image",url:d}]:[]];return e("div",{class:"sheet",id:"edit-profile-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(A,{icon:"x",alt:i({id:"yz7wBu"})})}),e("header",{children:e("b",{children:e(u,{id:"9OpVZg"})})}),e("main",{children:s==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):e("form",{onSubmit:w=>{w.preventDefault();const I=new FormData(w.target),_=I.get("header"),T=I.get("avatar"),L=I.get("display_name"),M=I.get("note"),K=b.current.querySelectorAll('input[name^="fields_attributes"]'),F=[];K.forEach(q=>{const X=q.name,[Q,j,V]=X.match(/fields_attributes\[(\d+)\]\[(.+)\]/)||[],H=q.value?q.value.trim():"";j&&V&&H&&(F[j]||(F[j]={}),F[j][V]=H)}),F.forEach(q=>{q.name&&!q.value&&(q.value="")}),(async()=>{try{const q=await o.v1.accounts.updateCredentials({header:_,avatar:T,displayName:L,note:M,fieldsAttributes:F});n?.({state:"success",account:q})}catch(q){alert(q?.message||i({id:"FwMMx0"}))}})()},children:[e("div",{class:"edit-profile-media-container",children:[e("label",{children:[e(u,{id:"C5zXYJ"})," ",e("input",{type:"file",name:"header",accept:ss,onChange:w=>{const I=w.target.files[0];if(I){const _=URL.createObjectURL(I);r(_)}}})]}),e("div",{class:"edit-profile-media-field",children:[v?e("div",{class:"edit-media",tabIndex:"0",onClick:()=>{E.showMediaModal={mediaAttachments:C,mediaIndex:0}},children:e("img",{src:v,alt:""})}):e("div",{class:"edit-media"}),d&&e(P,{children:[e(A,{icon:"arrow-right"}),e("div",{class:"edit-media",tabIndex:"0",onClick:()=>{E.showMediaModal={mediaAttachments:C,mediaIndex:1}},children:e("img",{src:d,alt:""})})]})]})]}),e("div",{class:"edit-profile-media-container",children:[e("label",{children:[e(u,{id:"4XF0BB"})," ",e("input",{type:"file",name:"avatar",accept:ss,onChange:w=>{const I=w.target.files[0];if(I){const _=URL.createObjectURL(I);h(_)}}})]}),e("div",{class:"edit-profile-media-field",children:[y?e("div",{class:"edit-media",tabIndex:"0",onClick:()=>{E.showMediaModal={mediaAttachments:g,mediaIndex:0}},children:e("img",{src:y,alt:""})}):e("div",{class:"edit-media"}),l&&e(P,{children:[e(A,{icon:"arrow-right"}),e("div",{class:"edit-media",tabIndex:"0",onClick:()=>{E.showMediaModal={mediaAttachments:g,mediaIndex:1}},children:e("img",{src:l,alt:""})})]})]})]}),e("p",{children:e("label",{children:[e(u,{id:"6YtxFj"})," ",e("input",{type:"text",name:"display_name",defaultValue:m,maxLength:30,disabled:s==="loading",dir:"auto"})]})}),e("p",{children:e("label",{children:[e(u,{id:"E+oKCO"}),e("textarea",{defaultValue:k,name:"note",maxLength:500,rows:"5",disabled:s==="loading",dir:"auto"})]})}),e("p",{children:e(u,{id:"T4I119"})}),e("table",{ref:b,children:[e("thead",{children:e("tr",{children:[e("th",{children:e(u,{id:"87a/t/"})}),e("th",{children:e(u,{id:"4b3oEV"})})]})}),e("tbody",{children:Array.from({length:Math.max(4,S.length)}).map((w,I)=>{const{name:_="",value:T=""}=S[I]||{};return e(kc,{name:_,value:T,index:I,disabled:s==="loading"},I)})})]}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:s==="loading",onClick:()=>{n?.()},children:e(u,{id:"dEgA5A"})}),e("button",{type:"submit",disabled:s==="loading",children:e(u,{id:"tfDRzk"})})]})]})})]})}const Cc=80;function Ac({accountID:n,info:i,open:o=!1,onlyOpenIfHasEndorsements:s=!1}){const{masto:a}=se(),c=B(),[p,d]=R("default"),[r,l]=R([]),[h,m]=R({});return G(()=>{Xe("@mastodon/endorsements")&&o&&(async()=>{d("loading");try{const y=await a.v1.accounts.$select(n).endorsements.list({limit:Cc});if(!y.length){d("default");return}l(y),d("default"),setTimeout(()=>{c.current.scrollIntoView({behavior:"smooth",block:"nearest"})},300);const v=await Kn(y,h);v&&m(v)}catch{d("error")}})()},[o,n]),(s?o&&r.length>0:o)?e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("div",{class:"endorsements-container",ref:c,children:[e("h3",{children:e(u,{id:"UIfdY1",values:{0:i.username}})}),p==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):r.length>0?e("ul",{class:`endorsements ${r.length>10?"expanded":""}`,children:r.map(y=>e("li",{children:e(ut,{account:y,showStats:!0,avatarSize:"xxl",relationship:h[y.id]},y.id)}))}):e("p",{class:"ui-state insignificant",children:e(u,{id:"AgkUZa"})})]})})}):null}const io=1e3*60,Ic=24*60*60*1e3,hi=vt(async()=>{const{masto:n}=se(),i=await n.v1.lists.list();return i.sort((o,s)=>o.title.localeCompare(s.title)),i.length&&setTimeout(()=>{Ee.account.set("lists",{lists:i,updatedAt:Date.now()})},1),i},{maxAge:io});async function pn(){try{const{lists:n,updatedAt:i}=Ee.account.get("lists")||{};return n?.length?(Date.now()-i>Ic&&hi(),n):await hi()}catch{return[]}}const Tc=vt(n=>{const{masto:i}=se();return i.v1.lists.$select(n).fetch()},{maxAge:io});async function so(n){const{lists:i}=Ee.account.get("lists")||{};if(i?.length){const o=i.find(s=>s.id===n);if(o)return o}try{return Tc(n)}catch{return null}}async function xc(n){return(await so(n))?.title||""}function Ec(n){const{lists:i}=Ee.account.get("lists")||{};i?.length&&(i.push(n),i.sort((o,s)=>o.title.localeCompare(s.title)),Ee.account.set("lists",{lists:i,updatedAt:Date.now()}))}function Rc(n){const{lists:i}=Ee.account.get("lists")||{};if(i?.length){const o=i.findIndex(s=>s.id===n.id);o!==-1&&(i[o]=n,i.sort((s,a)=>s.title.localeCompare(a.title)),Ee.account.set("lists",{lists:i,updatedAt:Date.now()}))}}function Lc(n){const{lists:i}=Ee.account.get("lists")||{};if(i?.length){const o=i.findIndex(s=>s.id===n);o!==-1&&(i.splice(o,1),Ee.account.set("lists",{lists:i,updatedAt:Date.now()}))}}function Kt({insignificant:n}){const{_:i}=ce();return e(A,{icon:"filter",size:"xs",class:`list-exclusive-badge ${n?"insignificant":""}`,title:i({id:"FNptcJ"})})}function zi({list:n,onClose:i}){const{_:o}=ce(),{masto:s}=se(),[a,c]=R("default"),p=!!n,d=B(),r=B(),l=B();G(()=>{p&&(d.current.value=n.title,r.current.value=n.repliesPolicy,l.current&&(l.current.checked=n.exclusive))},[p]);const h=Xe("@mastodon/list-exclusive")||Xe("@gotosocial/list-exclusive");return e("div",{class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(A,{icon:"x",alt:o({id:"yz7wBu"})})})," ",e("header",{children:e("h2",{children:o(p?{id:"tuhghE"}:{id:"Sb2gYF"})})}),e("main",{children:e("form",{class:"list-form",onSubmit:m=>{m.preventDefault();const f=new FormData(m.target),y=f.get("title"),v=f.get("replies_policy"),k=f.get("exclusive")==="on";c("loading"),(async()=>{try{let S;p?S=await s.v1.lists.$select(n.id).update({title:y,replies_policy:v,exclusive:k}):S=await s.v1.lists.create({title:y,replies_policy:v,exclusive:k}),c("default"),i?.({state:"success",list:S}),setTimeout(()=>{p?Rc(S):Ec(S)},1)}catch{c("error"),alert(o(p?{id:"R7ep1i"}:{id:"KPoj8w"}))}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:[e(u,{id:"6YtxFj"})," ",e("input",{ref:d,type:"text",id:"list-title",name:"title",required:!0,disabled:a==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:r,name:"replies_policy",required:!0,disabled:a==="loading",children:[e("option",{value:"list",children:e(u,{id:"ei6pnR"})}),e("option",{value:"followed",children:e(u,{id:"Mr53YX"})}),e("option",{value:"none",children:e(u,{id:"PM7llw"})})]})}),h&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:l,type:"checkbox",name:"exclusive",disabled:a==="loading"})," ",e(Kt,{insignificant:!0})," ",e(u,{id:"jxxYp0"})]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:a==="loading",children:o(p?{id:"tfDRzk"}:{id:"hYgDIe"})}),p&&e(ft,{disabled:a==="loading",align:"end",menuItemClassName:"danger",confirmLabel:o({id:"+kQ/cY"}),onClick:()=>{c("loading"),(async()=>{try{await s.v1.lists.$select(n.id).remove(),c("default"),i?.({state:"deleted"}),setTimeout(()=>{Lc(n.id)},1)}catch{c("error"),alert(o({id:"tqUaGL"}))}})()},children:e("button",{type:"button",class:"light danger",disabled:a==="loading",children:e(u,{id:"Jb6/SB"})})})]})]})})]})}function Mc({accountID:n,onClose:i}){const{_:o}=ce(),{masto:s}=se(),[a,c]=R("default"),[p,d]=R([]),[r,l]=R([]),[h,m]=xt(v=>v+1,0);G(()=>{c("loading"),(async()=>{try{const v=await pn();d(v);const k=await s.v1.accounts.$select(n).lists.list();l(k),c("default")}catch{c("error")}})()},[h]);const[f,y]=R(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(A,{icon:"x",alt:o({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:e(u,{id:"sJ2yQc"})})}),e("main",{children:[p.length>0?e("ul",{class:"list-add-remove",children:p.map(v=>{const k=r.some(S=>S.id===v.id);return e("li",{children:e("button",{type:"button",class:`light ${k?"checked":""}`,disabled:a==="loading",onClick:()=>{c("loading"),(async()=>{try{k?await s.v1.lists.$select(v.id).accounts.remove({accountIds:[n]}):await s.v1.lists.$select(v.id).accounts.create({accountIds:[n]}),m()}catch{c("error"),alert(o(k?{id:"7KnEYa"}:{id:"Tba8uO"}))}})()},children:[e(A,{icon:"check-circle",alt:"☑️"}),e("span",{children:v.title})]})})})}):a==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):a==="error"?e("p",{class:"ui-state",children:e(u,{id:"v/l5uA"})}):e("p",{class:"ui-state",children:e(u,{id:"/MJ7gZ"})}),e("button",{type:"button",class:"plain2",onClick:()=>y(!0),disabled:a!=="default",children:[e(A,{icon:"plus",size:"l"})," ",e("span",{children:e(u,{id:"Sb2gYF"})})]})]}),f&&e(qe,{onClick:v=>{v.target===v.currentTarget&&y(!1)},children:e(zi,{list:f?.list,onClose:v=>{v.state==="success"&&m(),y(!1)}})})]})}function $c({account:n,note:i,onRelationshipChange:o=()=>{},onClose:s=()=>{}}){const{_:a}=ce(),{masto:c}=se(),[p,d]=R("default"),r=B(null);return G(()=>{let l;return r.current&&!i&&(l=setTimeout(()=>{r.current.focus?.()},100)),()=>{clearTimeout(l)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!s&&e("button",{type:"button",class:"sheet-close",onClick:s,children:e(A,{icon:"x",alt:a({id:"yz7wBu"})})}),e("header",{children:e("b",{children:e(u,{id:"DYqYm5",values:{0:n?.username||n?.acct},components:{0:e("span",{class:"bidi-isolate"})}})})}),e("main",{children:e("form",{onSubmit:l=>{l.preventDefault();const m=new FormData(l.target).get("note");m?.trim()!==i?.trim()&&(d("loading"),(async()=>{try{const f=await c.v1.accounts.$select(n?.id).note.create({comment:m});d("default"),o(f),s()}catch(f){d("error"),alert(f?.message||a({id:"ot8LpF"}))}})())},children:[e("textarea",{ref:r,name:"note",disabled:p==="loading",dir:"auto",children:i}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:p==="loading",onClick:()=>{s?.()},children:e(u,{id:"dEgA5A"})}),e("span",{children:[e(Fe,{abrupt:!0,hidden:p!=="loading"}),e("button",{disabled:p==="loading",type:"submit",children:e(u,{id:"SrwrEj"})})]})]})]})})]})}function Nc({note:n,fields:i,onClose:o}){const{_:s}=ce(),a=i?.map(({name:p,value:d})=>`${p}
${Vi(d)}`).join(`

`)||"",c=Vi(n)+(a?`

${a}`:"");return e("div",{class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(A,{icon:"x",alt:s({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:e(u,{id:"9groMz"})})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:c}),e(Us,{forceTranslate:!0,text:c})]})]})}const Pc=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,60*60*24*30,0],jt={0:{id:"9ZP9cc"},300:it(5,"minute"),1800:it(30,"minute"),3600:it(1,"hour"),21600:it(6,"hour"),86400:it(1,"day"),259200:it(3,"day"),604800:it(1,"week"),2592e3:it(30,"day")};function Dc({info:n,instance:i,standalone:o,authenticated:s,onRelationshipChange:a=()=>{},setShowEditProfile:c=()=>{},showEndorsements:p=!1,renderEndorsements:d=!1,setRenderEndorsements:r=()=>{}}){if(!n)return null;const{_:l,_:h}=ce(),{masto:m,instance:f,authenticated:y}=se(),v=i===f,[k,S]=R("default"),[b,g]=R(null),{id:C,acct:w,url:I,username:_,locked:T,lastStatusAt:L,note:M,fields:K,moved:F}=n,q=B(C),{following:X,showingReblogs:Q,notifying:j,followedBy:V,blocking:H,blockedBy:pe,muting:$,mutingNotifications:ie,requested:Y,domainBlocking:ee,endorsed:he,note:le}=b||{},[J,Ae]=R(null),[ye,ve]=R(!1),Pe=w.includes("@")?w:`${w}@${i}`,_e=Xe("@mastodon/endorsements");G(()=>{if(n){const z=yt();let be;(async()=>{if(v&&s)be=C;else if(!v&&y){const Ne=n.acct.includes("@");try{const O=await m.v2.search.list({q:Ne?n.acct:`${n.username}@${i}`,type:"accounts",limit:1,resolve:!0});O.accounts.length&&(be=O.accounts[0].id,Ae(O.accounts[0]))}catch{}}if(!be)return;if(z===be){ve(!0);return}q.current=be,S("loading");const Le=m.v1.accounts.relationships.fetch({id:[be]});try{const Ne=await Le;if(S("default"),Ne.length){const O=Ne[0];g(O),a({relationship:O,currentID:be})}}catch{S("error")}})()}},[n,s]),G(()=>{n&&ye&&Fo(n)},[n,ye]);const Te=k==="loading",[xe,De]=R(!1),[Oe,Ue]=R(!1),[oe,Re]=R(!1),[$e,Ce]=R([]);return e(P,{children:[e("div",{class:"actions",children:[e("span",{children:[V?e("span",{class:"tag",children:e(u,{id:"p3UO/y"})}):L?e("small",{class:"insignificant",children:e(u,{id:"F3cM1G",values:{0:st(L,{hideTime:!0})},components:{0:e("span",{class:"ib"})}})}):e("span",{}),$&&e("span",{class:"tag danger",children:e(u,{id:"+IJm1Z"})}),H&&e("span",{class:"tag danger",children:e(u,{id:"32TndD"})})]})," ",e("span",{class:"buttons",children:[!!le&&e("button",{type:"button",class:"private-note-tag",title:h({id:"zxFxcH"}),onClick:()=>{Re(!0)},dir:"auto",children:e("span",{children:le})}),e(lt,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:e("button",{type:"button",class:"plain",disabled:Te,children:e(A,{icon:"more",size:"l",alt:h({id:"2FYpfJ"})})}),onMenuChange:z=>{X&&z.open&&(async()=>{try{const be=await m.v1.accounts.$select(q.current).lists.list();Ce(be)}catch{}})()},children:[y&&!ye?e(P,{children:[e(ge,{onClick:()=>{Os({draftStatus:{status:`@${J?.acct||w} `}})},children:[e(A,{icon:"at"}),e("span",{children:e(u,{id:"3LkfZu",values:{username:_},components:{0:e("span",{class:"bidi-isolate"})}})})]}),e(ge,{onClick:()=>{De(!0)},children:[e(A,{icon:"translate"}),e("span",{children:e(u,{id:"R8mSiS"})})]}),Xe("@mastodon/profile-private-note")&&e(ge,{onClick:()=>{Re(!0)},children:[e(A,{icon:"pencil"}),e("span",{children:h(le?{id:"U+Gokq"}:{id:"VcQzRi"})})]}),X&&!!b&&e(P,{children:[e(ge,{onClick:()=>{S("loading"),(async()=>{try{const z=await m.v1.accounts.$select(q.current).follow({notify:!j});z&&g(z),S("default"),re(z.notifying?h({id:"jL3N0G",values:{username:_}}):h({id:"0h4/9h",values:{username:_}}))}catch(z){alert(z),S("error")}})()},children:[e(A,{icon:"notification"}),e("span",{children:h(j?{id:"osJmEN"}:{id:"I92Z+b"})})]}),e(ge,{onClick:()=>{S("loading"),(async()=>{try{const z=await m.v1.accounts.$select(q.current).follow({reblogs:!Q});z&&g(z),S("default"),re(z.showingReblogs?h({id:"0X2KC8",values:{username:_}}):h({id:"cXWjH0",values:{username:_}}))}catch(z){alert(z),S("error")}})()},children:[e(A,{icon:"rocket"}),e("span",{children:h(Q?{id:"GRUr8d"}:{id:"uREpT3"})})]})]}),_e&&X&&e(ge,{onClick:()=>{S("loading"),(async()=>{try{if(he){const z=await m.v1.accounts.$select(J?.id||C).unpin();g(z),S("default"),re(h({id:"pWFLFk",values:{username:_}}))}else{const z=await m.v1.accounts.$select(J?.id||C).pin();g(z),S("default"),re(h({id:"xhiXaF",values:{username:_}}))}}catch{S("error"),he?re(h({id:"xHq5L2",values:{username:_}})):re(h({id:"Owr/5+",values:{username:_}}))}})()},children:[e(A,{icon:"endorsement"}),h(he?{id:"S9JvjK"}:{id:"UlJ3QN"})]}),p&&_e&&!d&&e(ge,{onClick:()=>r(!0),children:[e(A,{icon:"endorsement"}),e("span",{children:e(u,{id:"Qopbnd"})})]}),X&&e(ge,{onClick:()=>{Ue(!0)},children:[e(A,{icon:"list"}),$e.length?e(P,{children:[e("small",{class:"menu-grow",children:[e(u,{id:"sJ2yQc"}),e("br",{}),e("span",{class:"more-insignificant",children:$e.map(z=>z.title).join(", ")})]}),e("small",{class:"more-insignificant",children:$e.length})]}):e("span",{children:e(u,{id:"sJ2yQc"})})]}),e(Ye,{})]}):_e&&!d&&e(P,{children:[e(ge,{onClick:()=>r(!0),children:[e(A,{icon:"endorsement"}),"Show featured profiles"]}),e(Ye,{})]}),e(ge,{onClick:()=>{const z=`@${J?.acct||Pe}`;try{navigator.clipboard.writeText(z),re(h({id:"zJoEwS"}))}catch{re(h({id:"BC0lSD"}))}},children:[e(A,{icon:"copy"}),e("small",{children:[e(u,{id:"27x6gl"}),e("br",{}),e("span",{class:"more-insignificant bidi-isolate",children:["@",J?.acct||Pe]})]})]}),e(ge,{href:I,target:"_blank",children:[e(A,{icon:"external"}),e("small",{class:"menu-double-lines",children:Oc(I)})]}),e("div",{class:"menu-horizontal",children:[e(ge,{onClick:()=>{try{navigator.clipboard.writeText(I),re(h({id:"edWbV6"}))}catch{re(h({id:"W1ewR0"}))}},children:[e(A,{icon:"link"}),e("span",{children:e(u,{id:"he3ygx"})})]}),navigator?.share&&navigator?.canShare?.({url:I})&&e(ge,{onClick:()=>{try{navigator.share({url:I})}catch{alert(h({id:"TtG3Uh"}))}},children:[e(A,{icon:"share"}),e("span",{children:e(u,{id:"LFKLqp"})})]})]}),!!b&&e(P,{children:[e(Ye,{}),$?e(ge,{onClick:()=>{S("loading"),(async()=>{try{const z=await m.v1.accounts.$select(J?.id||C).unmute();g(z),S("default"),re(h({id:"B4Xkly",values:{username:_}})),E.reloadGenericAccounts.id="mute",E.reloadGenericAccounts.counter++}catch{S("error")}})()},children:[e(A,{icon:"unmute"}),e("span",{children:e(u,{id:"Q/HUhC",values:{username:_},components:{0:e("span",{class:"bidi-isolate"})}})})]}):e(hn,{menuClassName:"menu-blur",openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(P,{children:[e(A,{icon:"mute"}),e("span",{class:"menu-grow",children:e(u,{id:"xhPEH3",values:{username:_},components:{0:e("span",{class:"bidi-isolate"})}})}),e("span",{style:{textOverflow:"clip"},children:[e(A,{icon:"time"}),e(A,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:Pc.map(z=>e(ge,{onClick:()=>{S("loading"),(async()=>{try{const be=await m.v1.accounts.$select(J?.id||C).mute({duration:z});g(be),S("default"),re(h({id:"/plB9m",values:{0:typeof jt[z]=="function"?jt[z]():l(jt[z]),username:_}})),E.reloadGenericAccounts.id="mute",E.reloadGenericAccounts.counter++}catch{S("error"),re(h({id:"vWGBjT",values:{username:_}}))}})()},children:typeof jt[z]=="function"?jt[z]():l(jt[z])}))})}),V&&e(ft,{subMenu:!0,menuItemClassName:"danger",confirmLabel:e(P,{children:[e(A,{icon:"user-x"}),e("span",{children:e(u,{id:"unyq2W",values:{username:_},components:{0:e("span",{class:"bidi-isolate"})}})})]}),onClick:()=>{S("loading"),(async()=>{try{const z=await m.v1.accounts.$select(J?.id||C).removeFromFollowers();g(z),S("default"),re(h({id:"AgkcM/",values:{username:_}})),E.reloadGenericAccounts.id="followers",E.reloadGenericAccounts.counter++}catch{S("error")}})()},children:[e(A,{icon:"user-x"}),e("span",{children:e(u,{id:"VCZ0OT"})})]}),e(ft,{subMenu:!0,confirm:!H,confirmLabel:e(P,{children:[e(A,{icon:"block"}),e("span",{children:e(u,{id:"aforS9",values:{username:_},components:{0:e("span",{class:"bidi-isolate"})}})})]}),itemProps:{className:"danger"},menuItemClassName:"danger",onClick:()=>{S("loading"),(async()=>{try{if(H){const z=await m.v1.accounts.$select(J?.id||C).unblock();g(z),S("default"),re(h({id:"sI9N29",values:{username:_}}))}else{const z=await m.v1.accounts.$select(J?.id||C).block();g(z),S("default"),re(h({id:"uYcYzu",values:{username:_}}))}E.reloadGenericAccounts.id="block",E.reloadGenericAccounts.counter++}catch{S("error"),H?re(h({id:"0tG4wG",values:{username:_}})):re(h({id:"pA+qEx",values:{username:_}}))}})()},children:H?e(P,{children:[e(A,{icon:"unblock"}),e("span",{children:e(u,{id:"/3LJfX",values:{username:_},components:{0:e("span",{class:"bidi-isolate"})}})})]}):e(P,{children:[e(A,{icon:"block"}),e("span",{children:e(u,{id:"JRswkR",values:{username:_},components:{0:e("span",{class:"bidi-isolate"})}})})]})}),e(ge,{className:"danger",onClick:()=>{E.showReportModal={account:J||n}},children:[e(A,{icon:"flag"}),e("span",{children:e(u,{id:"qTJgpR",values:{username:_},components:{0:e("span",{class:"bidi-isolate"})}})})]})]}),y&&ye&&o&&Xe("@mastodon/profile-edit")&&e(P,{children:[e(Ye,{}),e(ge,{onClick:()=>{c(!0)},children:[e(A,{icon:"pencil"}),e("span",{children:e(u,{id:"9OpVZg"})})]})]}),!1]}),!b&&k==="loading"&&e(Fe,{abrupt:!0}),!!b&&!F&&e(ft,{confirm:X||Y,confirmLabel:e("span",{children:h(Y?{id:"e7qQIH"}:{id:"eYsAQr",values:{0:n.acct||n.username}})}),menuItemClassName:"danger",align:"end",disabled:Te,onClick:()=>{S("loading"),(async()=>{try{let z;X||Y?z=await m.v1.accounts.$select(q.current).unfollow():z=await m.v1.accounts.$select(q.current).follow(),z&&(g(z),p&&_e&&!d&&z.following&&r("onlyOpenIfHasEndorsements")),S("default")}catch(z){alert(z),S("error")}})()},children:e("button",{type:"button",class:`${X||Y?"light swap":""}`,"data-swap-state":X||Y?"danger":"",disabled:Te,children:X?e(P,{children:[e("span",{children:e(u,{id:"y6sq5j"})}),e("span",{children:e(u,{id:"HKrBPX"})})]}):Y?e(P,{children:[e("span",{children:e(u,{id:"Yx0Ud8"})}),e("span",{children:e(u,{id:"yTVtKs"})})]}):T?e(P,{children:[e(A,{icon:"lock"})," ",e("span",{children:e(u,{id:"MKEPCY"})})]}):h({id:"MKEPCY"})})})]})]}),!!xe&&e(qe,{onClose:()=>{De(!1)},children:e(Nc,{note:M,fields:K,onClose:()=>De(!1)})}),!!Oe&&e(qe,{onClose:()=>{Ue(!1)},children:e(Mc,{accountID:q.current,onClose:()=>Ue(!1)})}),!!oe&&e(qe,{onClose:()=>{Re(!1)},children:e($c,{account:n,note:le,onRelationshipChange:z=>{g(z)},onClose:()=>Re(!1)})})]})}function Oc(n){if(!n)return;const i=URL.parse(n);if(!i)return;const{host:o,pathname:s}=i,a=s.replace(/\/$/,"").replace(/^\//,"");return e(P,{children:[e("span",{class:"more-insignificant",children:[Bn.toUnicode(o),"/"]}),e("wbr",{}),e("span",{children:a})]})}const os=80,oo=1e3*60*10;function zc(n,i){return i.v1.accounts.familiarFollowers.fetch({id:[n]})}const Fc=vt(zc,{maxAge:oo});async function Uc(n,i){const o=i.v1.accounts.$select(n).statuses.list({limit:20}).values().next(),{value:s}=await o,a={total:s.length,originals:0,replies:0,boosts:0,quotes:0};return s.forEach(c=>{c.reblog?a.boosts++:c.inReplyToId&&c.inReplyToAccountId!==c.account.id?a.replies++:Nt()&&(c.quote?.id||c.quote?.quotedStatus?.id)?a.quotes++:a.originals++}),s.length&&(a.daysSinceLastPost=Math.ceil((Date.now()-Date.parse(s[s.length-1].createdAt))/864e5)),a}const Bc=vt(Uc,{maxAge:oo});function ao({account:n,fetchAccount:i=()=>{},standalone:o,instance:s,authenticated:a,showEndorsements:c=!1}){const{i18n:p,_:d}=ce(),{masto:r,authenticated:l}=se({instance:s}),{masto:h,instance:m}=se(),[f,y]=R("default"),v=typeof n=="string",[k,S]=R(v?null:n),b=Se(()=>s===m,[s,m]);G(()=>{if(!v){S(n);return}y("loading"),(async()=>{try{const D=await i();E.accounts[`${D.id}@${s}`]=D,S(D),y("default")}catch{S(null),y("error")}})()},[v,n,i]);const{acct:g,avatar:C,avatarStatic:w,bot:I,createdAt:_,displayName:T,emojis:L,fields:M,followersCount:K,followingCount:F,group:q,id:X,lastStatusAt:Q,locked:j,note:V,statusesCount:H,url:pe,username:$,memorial:ie,moved:Y,roles:ee,hideCollections:he}=k||{};let le=!1,{header:J,headerStatic:Ae}=k||{};(!J||/missing\.png$/.test(J))&&C&&!/missing\.png$/.test(C)&&(J=C,le=!0,w&&!/missing\.png$/.test(w)&&(Ae=w));const ye=Se(()=>X===yt(),[X]);G(()=>{const D=!!(k?.id&&k?.username&&k?.acct&&k?.avatar&&k?.avatarStatic&&k?.displayName&&k?.url);if(ye&&s&&D){const de=yi();let Ie=!1;de.forEach(me=>{me.info.id===k.id&&me.instanceURL===s&&(me.info=k,Ie=!0)}),Ie&&Gt(de)}},[ye,k,s]);const ve=wi(pe),[Pe,_e]=R([]),Te=B(),xe=B([]);async function De(D){(D||!Te.current)&&(Te.current=r.v1.accounts.$select(X).followers.list({limit:os}).values());const de=await Te.current.next();if(ye||!b)return de;const{value:Ie}=de;let me=[];if(D){let Z=[];try{Z=await r.v1.accounts.familiarFollowers.fetch({id:[X]})}catch{}xe.current=Z?.[0]?.accounts||[],me=[...xe.current,...Ie.filter(te=>!xe.current.some(we=>we.id===te.id))]}else Ie?.length&&(me=Ie.filter(Z=>!xe.current.some(te=>te.id===Z.id)));return{...de,value:me}}const Oe=B();async function Ue(D){return(D||!Oe.current)&&(Oe.current=r.v1.accounts.$select(X).following.list({limit:os}).values()),await Oe.current.next()}const oe=o?"div":fe,Re=s?`/${s}/a/${X}`:`/a/${X}`,[$e,Ce]=R([]),[z,be]=R(),[Le,Ne]=R("default"),O=!!z?.total,ke=async D=>{try{const de=await Fc(D,h);Ce(de[0].accounts.slice(0,qc))}catch{}},Be=async()=>{if(X){Ne("loading");try{const D=await Bc(X,r);be(D),Ne("default")}catch{Ne("error")}}},ze=nt(({relationship:D,currentID:de})=>{D.following||(ke(de),!o&&H>0&&Be())},[o,X,H]),N=nt(D=>{D.id===X&&(S(D),E.accounts[`${D.id}@${s}`]=D)},[X,s]),ae=v&&n&&/^https?:\/\//.test(n),[x,U]=R(!1),[W,ne]=R(!1);return e(P,{children:[e("div",{tabIndex:"-1",class:`account-container ${f==="loading"?"skeleton":""}`,style:{"--header-color-1":Pe[0],"--header-color-2":Pe[1],"--header-color-3":Pe[2],"--header-color-4":Pe[3]},children:[f==="error"&&e("div",{class:"ui-state",children:[e("p",{children:e(u,{id:"44hICK"})}),v?e("p",{children:ae?e("a",{href:n,target:"_blank",rel:"noopener",children:n}):e("code",{class:"insignificant",children:n})}):e("p",{children:e("a",{href:pe,target:"_blank",rel:"noopener",children:[e(u,{id:"Aadw0+"})," ",e(A,{icon:"external"})]})})]}),f==="loading"?e(P,{children:[e("header",{children:e(ut,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," ",e(u,{id:"x5LEuB"})]}),e("div",{children:[e("span",{children:"██"})," ",e(u,{id:"following.stats"})]}),e("div",{children:[e("span",{children:"██"})," ",e(u,{id:"+owNNn"})]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",class:"plain",disabled:!0,children:e(A,{icon:"more",size:"l",alt:d({id:"2FYpfJ"})})})})]})]})]}):k&&e(P,{children:[!!Y&&e("div",{class:"account-moved",children:[e("p",{children:e(u,{id:"C6cVP/",values:{displayName:T},components:{0:e("b",{})}})}),e(ut,{account:Y,instance:s,onClick:D=>{D.stopPropagation(),E.showAccount=Y}})]}),!!J&&!/missing\.png$/.test(J)&&e("img",{src:J,alt:"",class:`header-banner ${le?"header-is-avatar":""}`,onError:D=>{D.target.crossOrigin?D.target.src!==Ae?D.target.src=Ae:(D.target.removeAttribute("crossorigin"),D.target.src=J):D.target.src!==Ae?D.target.src=Ae:D.target.remove()},crossOrigin:"anonymous",onLoad:D=>{D.target.classList.add("loaded");try{const de=window.OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas"),Ie=de.getContext("2d",{willReadFrequently:!0});de.width=D.target.width,de.height=D.target.height,Ie.imageSmoothingEnabled=!1,Ie.drawImage(D.target,0,0);const me=10,te=[Ie.getImageData(0,0,me,me).data,Ie.getImageData(D.target.width-me,0,me,me).data,Ie.getImageData(0,D.target.height-me,me,me).data,Ie.getImageData(D.target.width-me,D.target.height-me,me,me).data].map(we=>{let Me=0,Ve=0,ot=0,et=0;for(let Rt=0;Rt<we.length;Rt+=4)Me+=we[Rt],Ve+=we[Rt+1],ot+=we[Rt+2],et+=we[Rt+3];const wt=we.length/4;return[Me/wt,Ve/wt,ot/wt,et/wt]}).map(we=>{const[Me,Ve,ot,et]=Kc(we);return`rgba(${Me}, ${Ve}, ${ot}, ${et})`});_e(te)}catch{}}}),e("header",{children:o?e(lt,{shift:window.matchMedia("(min-width: calc(40em))").matches?114:64,menuButton:e("div",{children:e(ut,{account:k,instance:s,avatarSize:"xxxl",onClick:()=>{}})}),children:[e("div",{class:"szh-menu__header",children:e(wc,{acct:g,instance:s})}),e(ge,{onClick:()=>{const D=g.includes("@")?`@${g}`:`@${g}@${s}`;try{navigator.clipboard.writeText(D),re(d({id:"zJoEwS"}))}catch{re(d({id:"BC0lSD"}))}},children:[e(A,{icon:"link"}),e("span",{children:e(u,{id:"27x6gl"})})]}),e(ge,{href:pe,target:"_blank",children:[e(A,{icon:"external"}),e("span",{children:e(u,{id:"Bz5hLl"})})]}),e(Ye,{}),e(ge,{onClick:()=>{E.showMediaModal={mediaAttachments:[{type:"image",url:w}]}},children:[e(A,{icon:"user"}),e("span",{children:e(u,{id:"7WYl2I"})})]}),!!Ae&&!le&&e(ge,{onClick:()=>{E.showMediaModal={mediaAttachments:[{type:"image",url:Ae}]}},children:[e(A,{icon:"media"}),e("span",{children:e(u,{id:"ZNme5R"})})]}),l&&ye&&Xe("@mastodon/profile-edit")&&e(P,{children:[e(Ye,{}),e(ge,{onClick:()=>{U(!0)},children:[e(A,{icon:"pencil"}),e("span",{children:e(u,{id:"9OpVZg"})})]})]})]}):e(ut,{account:k,instance:s,avatarSize:"xxxl",internal:!0})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!ie&&e("span",{class:"tag",children:e(u,{id:"prdIOK"})}),!!I&&e("span",{class:"tag",children:[e(A,{icon:"bot"})," ",e(u,{id:"9Vdq+j"})]}),!!q&&e("span",{class:"tag",children:[e(A,{icon:"group"})," ",e(u,{id:"L8fEEm"})]}),e("div",{class:"note",dir:"auto",onClick:Bs({instance:m}),dangerouslySetInnerHTML:{__html:ri(V,{emojis:L})}}),e("div",{class:"account-metadata-box",children:[M?.length>0&&e("div",{class:"profile-metadata",children:M.map(({name:D,value:de,verifiedAt:Ie},me)=>e("div",{class:`profile-field ${Ie?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(qs,{text:D,emojis:L})," ",!!Ie&&e(A,{icon:"check-circle",size:"s",alt:d({id:"QDEWii"})})]}),e("p",{dangerouslySetInnerHTML:{__html:ri(de,{emojis:L})}})]},D+me))}),e("div",{class:"stats",children:[e(oe,{tabIndex:0,to:Re,onClick:()=>{setTimeout(()=>{E.showGenericAccounts={id:"followers",heading:d({id:"x5LEuB"}),fetchAccounts:De,instance:s,excludeRelationshipAttrs:ye?["followedBy"]:[],blankCopy:he?d({id:"BRV/wh"}):void 0}},0)},children:[!!$e.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:$e.map(D=>e(pt,{url:D.avatarStatic,size:"s",alt:`${D.displayName} @${D.acct}`,squircle:D?.bot}))})}),e(u,{id:"TbttfX",values:{0:We(K),1:We(K),followersCount:K},components:{0:e("span",{title:K}),1:e("span",{title:K})}})]}),e(oe,{class:"insignificant",tabIndex:0,to:Re,onClick:()=>{setTimeout(()=>{E.showGenericAccounts={heading:d({id:"following.stats"}),fetchAccounts:Ue,instance:s,excludeRelationshipAttrs:ye?["following"]:[],blankCopy:he?d({id:"BRV/wh"}):void 0}},0)},children:[e(u,{id:"SGcIK+",values:{0:We(F),followingCount:F},components:{0:e("span",{title:F})}}),e("br",{})]}),e(oe,{class:"insignificant",to:Re,children:e(u,{id:"C4x3+X",values:{0:We(H),1:We(H),statusesCount:H},components:{0:e("span",{title:H}),1:e("span",{title:H})}})}),!!_&&e("div",{class:"insignificant",children:e(u,{id:"PCcEFZ",values:{0:st(_,{hideTime:!0})},components:{0:e("time",{datetime:_})}})})]})]}),!!z&&e(oe,{to:Re,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:O?e("div",{class:"posting-stats",title:Nt()?d({id:"CKHUZ2",values:{0:(z.originals/z.total).toLocaleString(p.locale||void 0,{style:"percent"}),1:(z.replies/z.total).toLocaleString(p.locale||void 0,{style:"percent"}),2:(z.quotes/z.total).toLocaleString(p.locale||void 0,{style:"percent"}),3:(z.boosts/z.total).toLocaleString(p.locale||void 0,{style:"percent"})}}):d({id:"wiuWLe",values:{0:(z.originals/z.total).toLocaleString(p.locale||void 0,{style:"percent"}),1:(z.replies/z.total).toLocaleString(p.locale||void 0,{style:"percent"}),2:(z.boosts/z.total).toLocaleString(p.locale||void 0,{style:"percent"})}}),children:[e("div",{children:z.daysSinceLastPost<365?ue._({id:"oZUtTk",values:{0:z.total,1:z.daysSinceLastPost,2:z.daysSinceLastPost,3:z.daysSinceLastPost,4:z.total,5:z.total,6:z.daysSinceLastPost}}):ue._({id:"JvA7Mo",values:{0:z.total,1:z.total}})}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${z.originals/z.total*100}%`,"--replies-percentage":`${(z.originals+z.replies)/z.total*100}%`,"--quotes-percentage":`${(z.originals+z.replies+z.quotes)/z.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ",e(u,{id:"HxF6Fk"})]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ",e(u,{id:"N8UzTV"})]})," ",Nt()&&e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-quotes"})," ",e(u,{id:"eWLklq"})]}),e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ",e(u,{id:"puY2t0"})]})]})]}):e("div",{class:"posting-stats",children:e(u,{id:"vl3XTJ"})})})})}),!Y&&e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!z,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:Le==="loading",onClick:()=>{Be()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${Le==="loading"?"loading":""}`,style:Nt()?{"--originals-percentage":"25%","--replies-percentage":"50%","--quotes-percentage":"75%"}:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),e(u,{id:"PjP87f"})," "]})})})})]}),e("footer",{children:e(Dc,{info:k,instance:s,standalone:o,authenticated:a,onRelationshipChange:ze,onProfileUpdate:N,setShowEditProfile:U,showEndorsements:c,renderEndorsements:W,setRenderEndorsements:ne})}),e(Ac,{accountID:X,info:k,open:W,onlyOpenIfHasEndorsements:W==="onlyOpenIfHasEndorsements"})]})]}),!!x&&e(qe,{onClose:()=>{U(!1)},children:e(_c,{onClose:({state:D,account:de}={})=>{U(!1),D==="success"&&de&&N(de)}})})]})}const qc=3;function Kc([n,i,o]){const s=.2126*n+.7152*i+.0722*o;let a;return s>=220?a=1:s<=50?a=.1:a=s/255,a=Math.min(1,a),[n,i,o,a]}function Hc({account:n,instance:i,onClose:o}){const{_:s}=ce(),{masto:a,instance:c,authenticated:p}=se({instance:i}),d=typeof n=="string";return G(()=>{d||(E.accounts[`${n.id}@${c}`]=n)},[n]),no(o),e("div",{class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close outer",onClick:o,children:e(A,{icon:"x",alt:s({id:"yz7wBu"})})}),e(ao,{instance:c,authenticated:p,account:n,fetchAccount:async()=>{if(d)try{return await a.v1.accounts.lookup({acct:n,skip_webfinger:!1})}catch{const l=await a.v2.search.list({q:n,type:"accounts",limit:p?1:11,resolve:p});if(l.accounts.length){const h=l.accounts.find(m=>m.url===n||n.startsWith(m.url));if(h)return h}if(/^https?:\/\/[^/]+\/@[^/]+$/.test(n)){const h=URL.parse(n);if(h){const{hostname:m,pathname:f}=h,y=f.replace(/^\//,"").replace(/\/$/,"")+"@"+m,v=await a.v2.search.list({q:y,type:"accounts",limit:1,resolve:p});if(v.accounts.length)return v.accounts[0]}}}else return n}})]})}function Yc({onClose:n}){const{_:i}=ce(),{masto:o}=se(),[s,a]=R("default"),[c,p]=R([]),[d,r]=xt(h=>h+1,0);G(()=>{a("loading"),(async()=>{try{const h=await gt.drafts.keys();if(h.length){const m=$n(),f=h.filter(y=>y.startsWith(m));if(f.length){const y=await gt.drafts.getMany(f);y.sort((v,k)=>Date.parse(k.updatedAt)-Date.parse(v.updatedAt)),p(y)}else p([])}else p([]);a("default")}catch{a("error")}})()},[d]);const l=c?.length>0;return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(A,{icon:"x",alt:i({id:"yz7wBu"})})}),e("header",{children:[e("h2",{children:[e(u,{id:"krk5ws"})," ",e(Fe,{abrupt:!0,hidden:s!=="loading"})]}),l&&e("div",{class:"insignificant",children:e(u,{id:"Ap/10+"})})]}),e("main",{children:l?e(P,{children:[e("ul",{class:"drafts-list",children:c.map(h=>{const{updatedAt:m,key:f,draftStatus:y,replyTo:v,quote:k}=h,S=new Date(m);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(A,{icon:v?"reply":"quill",size:"s"})," ",e("time",{children:[!!v&&e(P,{children:[e("span",{class:"bidi-isolate",children:["@",v.account.acct]}),e("br",{})]}),st(S)]})]}),e(ft,{confirmLabel:e("span",{children:e(u,{id:"/W5yFF"})}),menuItemClassName:"danger",align:"end",disabled:s==="loading",onClick:()=>{(async()=>{try{await gt.drafts.del(f),r()}catch{alert(i({id:"rEYoku"}))}})()},children:e("button",{type:"button",class:"small light",disabled:s==="loading",children:e(u,{id:"Jb6/SB"})})})]}),e("button",{type:"button",disabled:s==="loading",class:"draft-item",onClick:async()=>{let b,g;if(v?.id||k?.id){if(a("loading"),v)try{b=await o.v1.statuses.$select(v.id).fetch()}catch{alert(i({id:"tMwimH"})),a("default");return}if(k)try{g=await o.v1.statuses.$select(k.id).fetch()}catch{alert(i({id:"2oZ4Iw"})),a("default")}a("default")}window.__COMPOSE__={draftStatus:y,replyToStatus:b,quoteStatus:g},E.showCompose=!0,E.showDrafts=!1},children:e(jc,{draft:h})})]},m)})}),c.length>1&&e("p",{children:e(ft,{confirmLabel:e("span",{children:e(u,{id:"3IakFR"})}),menuItemClassName:"danger",disabled:s==="loading",onClick:()=>{(async()=>{a("loading");try{await gt.drafts.delMany(c.map(h=>h.key)),a("default"),r()}catch{alert(i({id:"0J4sZq"})),a("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:s==="loading",children:e(u,{id:"hOg+Mt"})})})})]}):e("p",{children:e(u,{id:"8iQ+jk"})})})]})}function jc({draft:n}){const{_:i}=ce(),{draftStatus:o,replyTo:s,quote:a}=n,{status:c,spoilerText:p,poll:d,mediaAttachments:r}=o,l=d?.options?.length>0,h=r?.length>0,m=!!a?.id,f=l||h||m,y=Se(()=>{if(!h)return;const v=r.find(b=>/image/.test(b.type));if(!v)return;const{file:k}=v;return URL.createObjectURL(k)},[h,r]);return e(P,{children:e("div",{class:"mini-draft",children:[f&&e("div",{class:`mini-draft-aside ${y?"has-image":""}`,style:y?{"--bg-image":`url(${y})`}:{},children:[l&&e(A,{icon:"poll",alt:i({id:"4WUbF1"})}),h&&e("span",{children:[e(A,{icon:"attachment",alt:i({id:"xYilR2"})})," ",e("small",{children:r?.length})]}),m&&e(A,{icon:"quote",alt:i({id:"ZhhOwV"})})]}),e("div",{class:"mini-draft-main",children:[!!p&&e("div",{class:"mini-draft-spoiler",children:p}),!!c&&e("div",{class:"mini-draft-status",children:c})]})]})})}function Vc({html:n,url:i,width:o,height:s,onClose:a=()=>{}}){const{_:c}=ce();return e("div",{class:"embed-modal-container",children:[e("div",{class:"top-controls",children:[e("button",{type:"button",class:"light",onClick:()=>a(),children:e(A,{icon:"x",alt:c({id:"yz7wBu"})})}),i&&e("a",{href:i,target:"_blank",rel:"noopener",class:"button plain",children:[e("span",{children:e(u,{id:"4/RpOy"})})," ",e(A,{icon:"external"})]})]}),e("div",{class:"embed-content",dangerouslySetInnerHTML:{__html:n},style:{"--width":o+"px","--height":s+"px","--aspect-ratio":`${o}/${s}`}})]})}function Gc({instance:n,excludeRelationshipAttrs:i=[],postID:o,onClose:s=()=>{},blankCopy:a}){const{_:c}=ce(),{masto:p,instance:d}=se(),r=n?n===d:!0,l=Ge(E),[h,m]=R("default"),[f,y]=R(!1);if(no(s),!l.showGenericAccounts)return null;const{id:v,heading:k,fetchAccounts:S,accounts:b,showReactions:g}=l.showGenericAccounts,[C,w]=R(b?.length?b:[]),[I,_]=R({}),T=async F=>{if(!F?.length||!r)return;const q=await Kn(F,I);q&&_({...I,...q})},L=F=>{S&&(F&&!C?.length&&w([]),m("loading"),(async()=>{try{const{done:q,value:X}=await S(F);if(Array.isArray(X)){if(F){const Q=[];for(let j=0;j<X.length;j++){const V=X[j],H=Q.find((pe,$)=>pe.id===V.id&&j!==$);H?H._types.push(...V._types):Q.push({_types:[],...V})}w(Q)}else w(Q=>{const j=Q;for(const V of X){const H=j.find(pe=>pe.id===V.id);H?H._types.push(...V._types):j.push(V)}return j});y(!q),T(X)}else y(!1);m("default")}catch{m("error")}})())},M=B(!0);G(()=>{C?.length>0?S?(L(!0),M.current=!1):T(C):(L(!0),M.current=!1)},[S]),G(()=>{M.current||l.reloadGenericAccounts?.id===v&&L(!0)},[l.reloadGenericAccounts.counter]);const K=E.statuses[o];return e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:s,children:e(A,{icon:"x",alt:c({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:k||c({id:"bPwFdf"})})}),e("main",{children:[K&&e(fe,{to:`/${n||d}/s/${K.id}`,class:"post-preview",children:e(je,{status:K,size:"s",readOnly:!0})}),C.length>0?e(P,{children:[e("ul",{class:"accounts-list",children:C.map(F=>{const q=I[F.id],X=`${F.id}-${F._types?.length||""}`;return e("li",{children:[g&&F._types?.length>0&&e("div",{class:"reactions-block",children:F._types.map(Q=>e(A,{icon:{reblog:"rocket",favourite:"heart"}[Q],class:`${Q}-icon`}))}),e("div",{class:"account-relationships",children:e(ut,{account:F,showStats:!0,relationship:q,excludeRelationshipAttrs:i})})]},X)})}),h==="default"?f?e(Tt,{onChange:F=>{F&&L()},children:e("button",{type:"button",class:"plain block",onClick:()=>L(),children:e(u,{id:"uXRAkV"})})}):e("p",{class:"ui-state insignificant",children:e(u,{id:"2EYeAZ"})}):h==="loading"&&e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})})]}):h==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):h==="error"?e("p",{class:"ui-state",children:e(u,{id:"AThL/k"})}):e("p",{class:"ui-state insignificant",children:a||c({id:"10OlfF"})})]})]})}const Wc=140;function Zc({alt:n,lang:i,onClose:o}){const{_:s}=ce(),a=Ge(E),[c,p]=R(!1),d=Fs(!0),r=a.settings.contentTranslationHideLanguages||[],l=!!i&&i!==d&&!Nn([i],[d])&&!r.find(h=>i===h||Nn([i],[h]));return G(()=>{const h=n?.length>0&&n?.length<=Wc;l&&h&&p(!0)},[l,n]),e("div",{class:"sheet",tabindex:"-1",children:[!!o&&e("button",{type:"button",class:"sheet-close outer",onClick:o,children:e(A,{icon:"x",alt:s({id:"yz7wBu"})})}),e("header",{class:"header-grid",children:[e("h2",{children:e(u,{id:"5gfDMm"})}),e("div",{class:"header-side",children:e(lt,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(A,{icon:"more",alt:s({id:"2FYpfJ"}),size:"xl"})}),children:[e(ge,{disabled:c,onClick:()=>{p(!0)},children:[e(A,{icon:"translate"}),e("span",{children:e(u,{id:"pi8x/S"})})]}),ra&&e(ge,{onClick:()=>{da(n,i)},children:[e(A,{icon:"speak"}),e("span",{children:e(u,{id:"yIBLq8"})})]})]})})]}),e("main",{lang:i,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:n}),(l||c)&&e(Us,{forceTranslate:c,sourceLanguage:i,text:n})]})]})}const{min:uu,max:hu}=Math;const co={};for(let n of["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"])co[`[object ${n}]`]=n.toLowerCase();function Xc(n){return co[Object.prototype.toString.call(n)]||"object"}const en=(n,i=null)=>n.length>=3?Array.prototype.slice.call(n):Xc(n[0])=="object"&&i?i.split("").filter(o=>n[0][o]!==void 0).map(o=>n[0][o]):n[0].slice(0);const{PI:Wn,min:pu,max:fu}=Math;const mu=Wn*2,gu=Wn/3,Jc=Wn/180,Qc=180/Wn;function On(n,i){let o=n.length;Array.isArray(n[0])||(n=[n]),Array.isArray(i[0])||(i=i.map(p=>[p]));let s=i[0].length,a=i[0].map((p,d)=>i.map(r=>r[d])),c=n.map(p=>a.map(d=>Array.isArray(p)?p.reduce((r,l,h)=>r+l*(d[h]||0),0):d.reduce((r,l)=>r+l*p,0)));return o===1&&(c=c[0]),s===1?c.map(p=>p[0]):c}const lo={Kn:18,labWhitePoint:"d65",Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452,kE:216/24389,kKE:8,kK:24389/27,RefWhiteRGB:{X:.95047,Y:1,Z:1.08883},MtxRGB2XYZ:{m00:.4124564390896922,m01:.21267285140562253,m02:.0193338955823293,m10:.357576077643909,m11:.715152155287818,m12:.11919202588130297,m20:.18043748326639894,m21:.07217499330655958,m22:.9503040785363679},MtxXYZ2RGB:{m00:3.2404541621141045,m01:-.9692660305051868,m02:.055643430959114726,m10:-1.5371385127977166,m11:1.8760108454466942,m12:-.2040259135167538,m20:-.498531409556016,m21:.041556017530349834,m22:1.0572251882231791},As:.9414285350000001,Bs:1.040417467,Cs:1.089532651,MtxAdaptMa:{m00:.8951,m01:-.7502,m02:.0389,m10:.2664,m11:1.7135,m12:-.0685,m20:-.1614,m21:.0367,m22:1.0296},MtxAdaptMaI:{m00:.9869929054667123,m01:.43230526972339456,m02:-.008528664575177328,m10:-.14705425642099013,m11:.5183602715367776,m12:.04004282165408487,m20:.15996265166373125,m21:.0492912282128556,m22:.9684866957875502}};const ni=n=>{const i=Math.sign(n);return n=Math.abs(n),(n<=.0031308?n*12.92:1.055*Math.pow(n,1/2.4)-.055)*i},el=(n,i,o)=>{const{MtxAdaptMa:s,MtxAdaptMaI:a,MtxXYZ2RGB:c,RefWhiteRGB:p,Xn:d,Yn:r,Zn:l}=lo,h=d*s.m00+r*s.m10+l*s.m20,m=d*s.m01+r*s.m11+l*s.m21,f=d*s.m02+r*s.m12+l*s.m22,y=p.X*s.m00+p.Y*s.m10+p.Z*s.m20,v=p.X*s.m01+p.Y*s.m11+p.Z*s.m21,k=p.X*s.m02+p.Y*s.m12+p.Z*s.m22,S=(n*s.m00+i*s.m10+o*s.m20)*(y/h),b=(n*s.m01+i*s.m11+o*s.m21)*(v/m),g=(n*s.m02+i*s.m12+o*s.m22)*(k/f),C=S*a.m00+b*a.m10+g*a.m20,w=S*a.m01+b*a.m11+g*a.m21,I=S*a.m02+b*a.m12+g*a.m22,_=ni(C*c.m00+w*c.m10+I*c.m20),T=ni(C*c.m01+w*c.m11+I*c.m21),L=ni(C*c.m02+w*c.m12+I*c.m22);return[_*255,T*255,L*255]},Fi=(...n)=>{n=en(n,"lab");const[i,o,s,...a]=n,[c,p,d]=tl([i,o,s]),[r,l,h]=el(c,p,d);return[r,l,h,...a.length>0&&a[0]<1?[a[0]]:[]]};function tl(n){var i=[[1.2268798758459243,-.5578149944602171,.2813910456659647],[-.0405757452148008,1.112286803280317,-.0717110580655164],[-.0763729366746601,-.4214933324022432,1.5869240198367816]],o=[[1,.3963377773761749,.2158037573099136],[1,-.1055613458156586,-.0638541728258133],[1,-.0894841775298119,-1.2914855480194092]],s=On(o,n);return On(i,s.map(a=>a**3))}function ii(n){const i=Math.sign(n);return n=Math.abs(n),(n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4))*i}const nl=(n,i,o)=>{n=ii(n/255),i=ii(i/255),o=ii(o/255);const{MtxRGB2XYZ:s,MtxAdaptMa:a,MtxAdaptMaI:c,Xn:p,Yn:d,Zn:r,As:l,Bs:h,Cs:m}=lo;let f=n*s.m00+i*s.m10+o*s.m20,y=n*s.m01+i*s.m11+o*s.m21,v=n*s.m02+i*s.m12+o*s.m22;const k=p*a.m00+d*a.m10+r*a.m20,S=p*a.m01+d*a.m11+r*a.m21,b=p*a.m02+d*a.m12+r*a.m22;let g=f*a.m00+y*a.m10+v*a.m20,C=f*a.m01+y*a.m11+v*a.m21,w=f*a.m02+y*a.m12+v*a.m22;return g*=k/l,C*=S/h,w*=b/m,f=g*c.m00+C*c.m10+w*c.m20,y=g*c.m01+C*c.m11+w*c.m21,v=g*c.m02+C*c.m12+w*c.m22,[f,y,v]},Ui=(...n)=>{const[i,o,s,...a]=en(n,"rgb"),c=nl(i,o,s);return[...il(c),...a.length>0&&a[0]<1?[a[0]]:[]]};function il(n){const i=[[.819022437996703,.3619062600528904,-.1288737815209879],[.0329836539323885,.9292868615863434,.0361446663506424],[.0481771893596242,.2642395317527308,.6335478284694309]],o=[[.210454268309314,.7936177747023054,-.0040720430116193],[1.9779985324311684,-2.42859224204858,.450593709617411],[.0259040424655478,.7827717124575296,-.8086757549230774]],s=On(i,n);return On(o,s.map(a=>Math.cbrt(a)))}const{sin:sl,cos:ol}=Math,al=(...n)=>{let[i,o,s]=en(n,"lch");return isNaN(s)&&(s=0),s=s*Jc,[i,ol(s)*o,sl(s)*o]},si=(...n)=>{n=en(n,"lch");const[i,o,s,...a]=n,[c,p,d]=al(i,o,s),[r,l,h]=Fi(c,p,d);return[r,l,h,...a.length>0&&a[0]<1?[a[0]]:[]]},{sqrt:cl,atan2:ll,round:rl}=Math,dl=(...n)=>{const[i,o,s]=en(n,"lab"),a=cl(o*o+s*s);let c=(ll(s,o)*Qc+360)%360;return rl(a*1e4)===0&&(c=Number.NaN),[i,a,c]},ul=(...n)=>{const[i,o,s,...a]=en(n,"rgb"),[c,p,d]=Ui(i,o,s),[r,l,h]=dl(c,p,d);return[r,l,h,...a.length>0&&a[0]<1?[a[0]]:[]]},hl={BASE_URL:"./",DEV:!1,MODE:"production",PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",PHANPY_TRANSLANG_INSTANCES:"translang.phanpy.social",PHANPY_WEBSITE:"https://phanpy.blaede.family",PROD:!0,SSR:!1,VITE_APP_ENV:"production"},{PHANPY_IMG_ALT_API_URL:yu}=hl;function ro({mediaAttachments:n,statusID:i,instance:o,lang:s,index:a=0,onClose:c=()=>{}}){const{_:p}=ce(),[d,r]=R("default"),l=B(null),[h,m]=R(a),f=B(null);kt(()=>{f.current?.scrollIntoView()},[]);const y=B(i);G(()=>{const w=a*l.current.clientWidth,I=y.current!==i;I&&(y.current=i),l.current.focus(),l.current.scrollTo({left:w*(Ft()?-1:1),behavior:I?"auto":"smooth"})},[a,i]);const[v,k]=R(!0);G(()=>{let w=I=>{c(I,h,n,l)};return l.current&&l.current.addEventListener("swiped-down",w),()=>{l.current&&l.current.removeEventListener("swiped-down",w)}},[h,n]),Ke("esc",w=>{c(w,h,n,l)},{ignoreEventWhen:w=>!!document.querySelector("#modal-container > *")||w.metaKey||w.ctrlKey||w.altKey||w.shiftKey,useKey:!0},[c,h,n]),G(()=>{let w=()=>{const{clientWidth:I,scrollLeft:_}=l.current,T=Math.round(Math.abs(_)/I);m(T)};return l.current&&l.current.addEventListener("scroll",w,{passive:!0}),()=>{l.current&&l.current.removeEventListener("scroll",w)}},[]),G(()=>{let w=setTimeout(()=>{l.current?.focus?.()},100);return()=>clearTimeout(w)},[]);const S=Se(()=>n?.map(w=>{const{blurhash:I}=w;if(I){const _=Ti(I);return ul(_)}return null}),[n]),b=Se(()=>S?.map(w=>w?{light:si([.95,.01,w[2]]),dark:si([.35,.01,w[2]]),default:si([.6,w[1],w[2]])}:null)),g=Se(()=>{const I=100/b.length,_=b.map((M,K)=>{const F=K*I+5,q=(K+1)*I-5;return M?.light&&M?.dark?{light:`
                rgb(${M.light?.join(",")}) ${F}%, 
                rgb(${M.light?.join(",")}) ${q}%
              `,dark:`
                rgb(${M.dark?.join(",")}) ${F}%, 
                rgb(${M.dark?.join(",")}) ${q}%
              `}:{light:`
              transparent ${F}%, 
              transparent ${q}%
            `,dark:`
              transparent ${F}%, 
              transparent ${q}%
            `}}),T=_.map(M=>M.light).join(", "),L=_.map(M=>M.dark).join(", ");return{light:T,dark:L}},[b]);let C=B(null);return G(()=>()=>{C.current?.hideToast?.()},[]),kt(()=>{const w=b[h];let I,_;if(w){const T=Ee.local.get("theme");if(T){const L=`rgb(${w[T].join(",")})`;I=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),I&&(_=I.content,I.content=L)}else{const L=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",M=`rgb(${w[L].join(",")})`;I=document.querySelector(`meta[name="theme-color"][media*="${L}"]`),I&&(_=I.content,I.content=M)}}return()=>{I&&_&&(I.content=_)}},[h,b]),e("div",{class:`media-modal-container media-modal-count-${n?.length}`,children:[e("div",{ref:l,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:w=>{(w.target.classList.contains("carousel-item")||w.target.classList.contains("media")||w.target.classList.contains("media-zoom"))&&c(w,h,n,l)},style:n.length>1?{backgroundAttachment:"local","--accent-gradient-light":g?.light,"--accent-gradient-dark":g?.dark}:{},children:n?.map((w,I)=>{const _=n.length===1?b[I]:null;return e("div",{class:"carousel-item",style:_?{"--accent-color":`rgb(${_.default.join(",")})`,"--accent-light-color":`rgb(${_.light?.join(",")})`,"--accent-dark-color":`rgb(${_.dark?.join(",")})`,"--accent-alpha-color":`rgba(${_.default.join(",")}, 0.4)`}:{},tabindex:"0",ref:I===h?f:null,onClick:T=>{T.target.classList.contains("media")||k(!v)},children:[!!w.description&&e("button",{type:"button",class:"media-alt",hidden:!v,onClick:()=>{E.showMediaAlt={alt:w.description,lang:s}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:s,dir:"auto",children:w.description})]}),e(Ks,{media:w,showOriginal:!0,lang:s})]},w.id)})}),e("div",{class:"carousel-top-controls",hidden:!v,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:w=>c(w,h,n,l),children:e(A,{icon:"x",alt:p({id:"yz7wBu"})})})}),n?.length>1?e("span",{class:"carousel-dots",children:n?.map((w,I)=>e("button",{type:"button",disabled:I===h,class:`carousel-dot ${I===h?"active":""}`,onClick:_=>{_.preventDefault(),_.stopPropagation();const T=l.current.clientWidth*I*(Ft()?-1:1);l.current.focus(),l.current.scrollTo({left:T,behavior:"smooth"})},children:e(A,{icon:"round",size:"s",alt:"⸱"})},w.id))}):e("span",{}),e("span",{children:[e(lt,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(A,{icon:"more",alt:p({id:"2FYpfJ"})})}),children:[e(He,{href:n[h]?.remoteUrl||n[h]?.url,class:"carousel-button",target:"_blank",title:p({id:"5hXGws"}),children:[e(A,{icon:"popout"}),e("span",{children:e(u,{id:"aDr7Vc"})})]}),!1]})," ",!!i&&e(fe,{to:`${o?`/${o}`:""}/s/${i}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${h+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:[e(u,{id:"ISg5SQ"})," "]}),"»"]})]})]}),n?.length>1&&e("div",{class:"carousel-controls",hidden:!v,children:[e("button",{type:"button",class:"carousel-button",hidden:h===0,onClick:w=>{w.preventDefault(),w.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(h-1)*(Ft()?-1:1),behavior:"smooth"})},children:e(A,{icon:"arrow-left",alt:p({id:"DHhJ7s"})})}),e("button",{type:"button",class:"carousel-button",hidden:h===n.length-1,onClick:w=>{w.preventDefault(),w.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(h+1)*(Ft()?-1:1),behavior:"smooth"})},children:e(A,{icon:"arrow-right",alt:p({id:"hXzOVo"})})})]})]})}function pl({url:n,linkText:i,onClose:o}){const{_:s}=ce();if(!n)return null;let a=n;try{const d=URL.parse(n),r=d.protocol,l=d.hostname,h=n.slice(d.origin.length);a=e(P,{children:[r,"//",e("strong",{children:l}),h]})}catch{}const c=()=>{try{navigator.clipboard.writeText(n),re(s({id:"edWbV6"}))}catch{re(s({id:"W1ewR0"}))}},p=()=>{if(navigator.share&&navigator.canShare({url:n}))try{navigator.share({url:n})}catch{}};return e("div",{class:"sheet sheet-modal",id:"open-link-sheet",tabindex:"-1",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(A,{icon:"x",alt:s({id:"yz7wBu"})})}),e("header",{class:"header-grid",children:e("h2",{children:e(u,{id:"Gj4mrz"})})}),e("main",{children:[!!i&&e(P,{children:[e("p",{class:"link-text",children:[e(A,{icon:"cursor-hand",size:"xl"})," ",i]}),e("div",{class:"arrow",children:e(A,{icon:"arrow-down"})})]}),e("p",{class:"full-url",children:a})]}),e("footer",{children:[e("button",{type:"button",class:"light",onClick:o,children:e(u,{id:"dEgA5A"})}),e("span",{class:"spacer"}),e("button",{type:"button",class:"plain6",onClick:c,children:e(A,{icon:"copy",alt:s({id:"he3ygx"})})}),navigator.canShare&&navigator.canShare({url:n})&&e("button",{type:"button",class:"plain6",onClick:p,children:e(A,{icon:"share",alt:s({id:"LFKLqp"})})}),e("a",{class:"button",href:n,target:"_blank",rel:"noopener noreferrer",onClick:o,children:e(u,{id:"1TNIig"})})]})]})}const fl=["spam","legal","violation","other"],tn={spam:{label:{id:"t8dIOP"},description:{id:"csQin/"}},legal:{label:{id:"IjKdHM"},description:{id:"e6tGFu"}},violation:{label:{id:"KPFHM2"},description:{id:"fpotTF"},stampLabel:{id:"iuLUuH"}},other:{label:{id:"/IX/7x"},description:{id:"kxiG8g"},excludeStamp:!0}};function ml(n,i){if(!n.translations||!i)return null;const o=Object.keys(n.translations);if(!o?.length)return null;let s=Nn([i],o,null);if(!s){const a=o.map(c=>c.split(/(?=[A-Z])/).map((d,r)=>r===0?d:d.toLowerCase()).join("-"));s=Nn([i],a,null)}if(s&&s.includes("-")){const[a,c]=s.split("-");s=a+c.charAt(0).toUpperCase()+c.slice(1)}return s}function gl(n,i){return n?.length?i?n.map(o=>{const s=ml(o,i);return{...o,_translatedText:o.translations?.[s]?.text||null}}):n:[]}function yl({account:n,post:i,onClose:o}){const{_:s,_:a,i18n:c}=ce(),{masto:p}=se(),[d,r]=R("default"),[l,h]=n.acct.split("@"),[m,f]=Se(()=>{const{rules:w,domain:I}=Ls();return[gl(w||[],c.locale),I]},[c.locale]),[y,v]=R(null),[k,S]=R(!1),b=B(null),[g,C]=R(!1);return e("div",{class:"report-modal-container",children:[e("div",{class:"top-controls",children:[e("h1",{children:a(i?{id:"muLhL3"}:{id:"ACul2G",values:{username:l}})}),e("button",{type:"button",class:"plain4 small",disabled:d==="loading",onClick:()=>o(),children:e(A,{icon:"x",size:"xl",alt:a({id:"yz7wBu"})})})]}),e("main",{children:[e("div",{class:"report-preview",children:i?e(je,{status:i,size:"s",previewMode:!0}):e(ut,{account:n,avatarSize:"xxl",useAvatarStatic:!0,showStats:!0,showActivity:!0})}),!!y&&!tn[y].excludeStamp&&e("span",{class:"rubber-stamp","aria-hidden":"true",children:[s(tn[y].stampLabel||s(tn[y].label)),e("small",{children:e(u,{id:"2WtL62"})})]},y),e("form",{onSubmit:w=>{w.preventDefault();const I=new FormData(w.target),_=Object.fromEntries(I.entries());let{category:T,comment:L,forward:M}=_;L||(L=void 0),M==="on"&&(M=!0);const K=T==="violation"?Object.entries(_).filter(([q])=>q.startsWith("rule_ids")).map(([q,X])=>X):void 0,F={category:T,comment:L,forward:M,ruleIds:K};r("loading"),(async()=>{try{await p.v1.reports.create({accountId:n.id,statusIds:i?.id?[i.id]:void 0,category:T,comment:L,ruleIds:K,forward:M}),r("success"),re(a(i?{id:"y3ou+8"}:{id:"R9kjEL"})),o()}catch(q){r("error"),re(q?.message||a(i?{id:"+3FjPq"}:{id:"oEQq5w"}))}})()},children:[e("p",{children:a(i?{id:"L9fUm+"}:{id:"rSLkfe"})}),e("section",{class:"report-categories",children:fl.map(w=>w==="violation"&&!m?.length?null:e(P,{children:[e("label",{class:"report-category",children:[e("input",{type:"radio",name:"category",value:w,required:!0,disabled:d==="loading",onChange:I=>{v(I.target.value),S(I.target.value==="violation")}}),e("span",{children:[s(tn[w].label),"  ",e("small",{class:"ib insignificant",children:s(tn[w].description)})]})]}),w==="violation"&&!!m?.length&&e("div",{class:"shazam-container no-animation",hidden:!k,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"report-rules",ref:b,children:m.map((I,_)=>e("label",{class:"report-rule",children:[e("input",{type:"checkbox",name:`rule_ids[${_}]`,value:I.id,required:k&&!g,disabled:d==="loading",onChange:T=>{const{checked:L}=T.target;L?C(!0):b.current.querySelectorAll("input:checked").length||C(!1)}}),e("span",{children:I._translatedText||I.text})]},I.id))})})})]},w))}),e("section",{class:"report-comment",children:[e("p",{children:e("label",{for:"report-comment",children:e(u,{id:"ecVtjm"})})}),e("textarea",{maxlength:"1000",rows:"1",name:"comment",id:"report-comment",disabled:d==="loading",required:!i})]}),!!h&&h!==f&&e("section",{children:e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,name:"forward",disabled:d==="loading"})," ",e("span",{children:e(u,{id:"cyjS8M",values:{domain:h},components:{0:e("i",{})}})})]})})}),e("footer",{children:[e("button",{type:"submit",disabled:d==="loading",children:e(u,{id:"4cijjm"})})," ",e("button",{type:"submit",class:"plain2",disabled:d==="loading",onClick:async()=>{try{await p.v1.accounts.$select(n.id).mute(),re(a({id:"/BGBeF",values:{username:l}}))}catch{re(a({id:"v02K7/",values:{username:l}}))}},children:e(u,{id:"caeqw/",components:{0:e("small",{class:"ib"})}})})," ",e("button",{type:"submit",class:"plain2",disabled:d==="loading",onClick:async()=>{try{await p.v1.accounts.$select(n.id).block(),re(a({id:"kjUejn",values:{username:l}}))}catch{re(a({id:"pMcdDp",values:{username:l}}))}},children:e(u,{id:"JybQca",components:{0:e("small",{class:"ib"})}})}),e(Fe,{hidden:d!=="loading"})]})]})]})]})}var Cn={exports:{}},vu=Cn.exports,as;function vl(){return as||(as=1,function(n){var i=function(){var o=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",c={};function p(r,l){if(!c[r]){c[r]={};for(var h=0;h<r.length;h++)c[r][r.charAt(h)]=h}return c[r][l]}var d={compressToBase64:function(r){if(r==null)return"";var l=d._compress(r,6,function(h){return s.charAt(h)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(r){return r==null?"":r==""?null:d._decompress(r.length,32,function(l){return p(s,r.charAt(l))})},compressToUTF16:function(r){return r==null?"":d._compress(r,15,function(l){return o(l+32)})+" "},decompressFromUTF16:function(r){return r==null?"":r==""?null:d._decompress(r.length,16384,function(l){return r.charCodeAt(l)-32})},compressToUint8Array:function(r){for(var l=d.compress(r),h=new Uint8Array(l.length*2),m=0,f=l.length;m<f;m++){var y=l.charCodeAt(m);h[m*2]=y>>>8,h[m*2+1]=y%256}return h},decompressFromUint8Array:function(r){if(r==null)return d.decompress(r);for(var l=new Array(r.length/2),h=0,m=l.length;h<m;h++)l[h]=r[h*2]*256+r[h*2+1];var f=[];return l.forEach(function(y){f.push(o(y))}),d.decompress(f.join(""))},compressToEncodedURIComponent:function(r){return r==null?"":d._compress(r,6,function(l){return a.charAt(l)})},decompressFromEncodedURIComponent:function(r){return r==null?"":r==""?null:(r=r.replace(/ /g,"+"),d._decompress(r.length,32,function(l){return p(a,r.charAt(l))}))},compress:function(r){return d._compress(r,16,function(l){return o(l)})},_compress:function(r,l,h){if(r==null)return"";var m,f,y={},v={},k="",S="",b="",g=2,C=3,w=2,I=[],_=0,T=0,L;for(L=0;L<r.length;L+=1)if(k=r.charAt(L),Object.prototype.hasOwnProperty.call(y,k)||(y[k]=C++,v[k]=!0),S=b+k,Object.prototype.hasOwnProperty.call(y,S))b=S;else{if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(m=0;m<w;m++)_=_<<1,T==l-1?(T=0,I.push(h(_)),_=0):T++;for(f=b.charCodeAt(0),m=0;m<8;m++)_=_<<1|f&1,T==l-1?(T=0,I.push(h(_)),_=0):T++,f=f>>1}else{for(f=1,m=0;m<w;m++)_=_<<1|f,T==l-1?(T=0,I.push(h(_)),_=0):T++,f=0;for(f=b.charCodeAt(0),m=0;m<16;m++)_=_<<1|f&1,T==l-1?(T=0,I.push(h(_)),_=0):T++,f=f>>1}g--,g==0&&(g=Math.pow(2,w),w++),delete v[b]}else for(f=y[b],m=0;m<w;m++)_=_<<1|f&1,T==l-1?(T=0,I.push(h(_)),_=0):T++,f=f>>1;g--,g==0&&(g=Math.pow(2,w),w++),y[S]=C++,b=String(k)}if(b!==""){if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(m=0;m<w;m++)_=_<<1,T==l-1?(T=0,I.push(h(_)),_=0):T++;for(f=b.charCodeAt(0),m=0;m<8;m++)_=_<<1|f&1,T==l-1?(T=0,I.push(h(_)),_=0):T++,f=f>>1}else{for(f=1,m=0;m<w;m++)_=_<<1|f,T==l-1?(T=0,I.push(h(_)),_=0):T++,f=0;for(f=b.charCodeAt(0),m=0;m<16;m++)_=_<<1|f&1,T==l-1?(T=0,I.push(h(_)),_=0):T++,f=f>>1}g--,g==0&&(g=Math.pow(2,w),w++),delete v[b]}else for(f=y[b],m=0;m<w;m++)_=_<<1|f&1,T==l-1?(T=0,I.push(h(_)),_=0):T++,f=f>>1;g--,g==0&&(g=Math.pow(2,w),w++)}for(f=2,m=0;m<w;m++)_=_<<1|f&1,T==l-1?(T=0,I.push(h(_)),_=0):T++,f=f>>1;for(;;)if(_=_<<1,T==l-1){I.push(h(_));break}else T++;return I.join("")},decompress:function(r){return r==null?"":r==""?null:d._decompress(r.length,32768,function(l){return r.charCodeAt(l)})},_decompress:function(r,l,h){var m=[],f,y=4,v=4,k=3,S="",b=[],g,C,w,I,_,T,L,M={val:h(0),position:l,index:1};for(g=0;g<3;g+=1)m[g]=g;for(w=0,_=Math.pow(2,2),T=1;T!=_;)I=M.val&M.position,M.position>>=1,M.position==0&&(M.position=l,M.val=h(M.index++)),w|=(I>0?1:0)*T,T<<=1;switch(f=w){case 0:for(w=0,_=Math.pow(2,8),T=1;T!=_;)I=M.val&M.position,M.position>>=1,M.position==0&&(M.position=l,M.val=h(M.index++)),w|=(I>0?1:0)*T,T<<=1;L=o(w);break;case 1:for(w=0,_=Math.pow(2,16),T=1;T!=_;)I=M.val&M.position,M.position>>=1,M.position==0&&(M.position=l,M.val=h(M.index++)),w|=(I>0?1:0)*T,T<<=1;L=o(w);break;case 2:return""}for(m[3]=L,C=L,b.push(L);;){if(M.index>r)return"";for(w=0,_=Math.pow(2,k),T=1;T!=_;)I=M.val&M.position,M.position>>=1,M.position==0&&(M.position=l,M.val=h(M.index++)),w|=(I>0?1:0)*T,T<<=1;switch(L=w){case 0:for(w=0,_=Math.pow(2,8),T=1;T!=_;)I=M.val&M.position,M.position>>=1,M.position==0&&(M.position=l,M.val=h(M.index++)),w|=(I>0?1:0)*T,T<<=1;m[v++]=o(w),L=v-1,y--;break;case 1:for(w=0,_=Math.pow(2,16),T=1;T!=_;)I=M.val&M.position,M.position>>=1,M.position==0&&(M.position=l,M.val=h(M.index++)),w|=(I>0?1:0)*T,T<<=1;m[v++]=o(w),L=v-1,y--;break;case 2:return b.join("")}if(y==0&&(y=Math.pow(2,k),k++),m[L])S=m[L];else if(L===v)S=C+C.charAt(0);else return null;b.push(S),m[v++]=C+S.charAt(0),y--,C=S,y==0&&(y=Math.pow(2,k),k++)}}};return d}();n!=null?n.exports=i:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return i})}(Cn)),Cn.exports}var cs=vl();const bl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",wl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",Sl="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",kl=200,_l=10;async function zn(){const{masto:n}=se(),i=n.v1.followedTags.list({limit:kl}).values(),o=[];let s=0;do{const{value:a,done:c}=await i.next();if(c||a?.length===0)break;o.push(...a),s++}while(s<_l);return o.sort((a,c)=>a.name.localeCompare(c.name)),o.length&&setTimeout(()=>{Ee.account.set("followedTags",{tags:o,updatedAt:Date.now()})},1),o}const Cl=24*60*60*1e3;async function Al(){try{const{tags:n,updatedAt:i}=Ee.account.get("followedTags")||{};return n?.length?(Date.now()-i>Cl&&zn(),n):await zn()}catch{return[]}}const ls=document.createElement("div"),Il=n=>{if(!n)return[];if(n.indexOf("#")===-1)return[];ls.innerHTML=n;const i=ls.querySelectorAll("a.hashtag");return i.length?Array.from(i).map(o=>o.innerText.trim().replace(/^[^#]*#+/,"")):[]};function An({children:n}){if(typeof n=="string")return n;const[i,o]=R("");return G(()=>{Promise.resolve(n).then(o)},[n]),i}const It=9,Tl=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],uo={following:{id:"7ZJHdw"},notifications:{id:"iDNBZe"},list:{id:"h16FyT"},public:{id:"tXgQpk"},search:{id:"A1taO8"},"account-statuses":{id:"AeXO77"},bookmarks:{id:"7Ff7ia"},favourites:{id:"zZOZj7"},hashtag:{id:"GP8RLS"},trending:{id:"4/iCqx"},mentions:{id:"/bZzdR"}},In={list:[{text:{id:"DUMt1y"},name:"id",notRequired:!0}],public:[{text:{id:"OgyJSr"},name:"local",type:"checkbox"},{text:{id:"kyAi7k"},name:"instance",type:"text",placeholder:{id:"7defFj"},notRequired:!0}],trending:[{text:{id:"kyAi7k"},name:"instance",type:"text",placeholder:{id:"7defFj"},notRequired:!0}],search:[{text:{id:"dmloPh"},name:"query",type:"text",placeholder:{id:"UHDQDE"},notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:{id:"a6oTWs"},pattern:"[^#]+"},{text:{id:"eK4SL/"},name:"media",type:"checkbox"},{text:{id:"kyAi7k"},name:"instance",type:"text",placeholder:{id:"7defFj"},notRequired:!0}]},xl=vt(async({id:n})=>{const i=await se().masto.v1.accounts.$select(n).fetch();return i.username||i.acct||i.displayName}),Fn={following:{id:"home",title:(n,i)=>i===0?ue._({id:"i0qMbr"}):ue._({id:"following.title"}),path:"/",icon:"home"},mentions:{id:"mentions",title:{id:"/bZzdR"},path:"/mentions",icon:"at"},notifications:{id:"notifications",title:{id:"iDNBZe"},path:"/notifications",icon:"notification"},list:{id:({id:n})=>n?"list":"lists",title:({id:n})=>n?xc(n):ue._({id:"h16FyT"}),path:({id:n})=>n?`/l/${n}`:"/l",icon:"list",excludeViewMode:({id:n})=>n?[]:["multi-column"]},public:{id:"public",title:({local:n})=>n?ue._({id:"d5zxa4"}):ue._({id:"4ERYY7"}),subtitle:({instance:n})=>n||se().instance,path:({local:n,instance:i})=>`/${i}/p${n?"/l":""}`,icon:({local:n})=>n?"building":"earth"},trending:{id:"trending",title:{id:"4/iCqx"},subtitle:({instance:n})=>n||se().instance,path:({instance:n})=>`/${n}/trending`,icon:"chart"},search:{id:"search",title:({query:n})=>n?`“${n}”`:ue._({id:"A1taO8"}),path:({query:n})=>n?`/search?q=${encodeURIComponent(n)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:n})=>n?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:xl,path:({id:n})=>`/a/${n}`,icon:"user"},bookmarks:{id:"bookmarks",title:{id:"7Ff7ia"},path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:{id:"zZOZj7"},path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:n})=>n,subtitle:({instance:n})=>n||se().instance,path:({hashtag:n,instance:i,media:o})=>`${i?`/${i}`:""}/t/${n.split(/\s+/).join("+")}${o?"?media=1":""}`,icon:"hashtag"}};function El({onClose:n}){const{_:i}=ce(),o=Ge(E),{shortcuts:s}=o,[a,c]=R(!1),[p,d]=R(!1),[r]=jn();return e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(A,{icon:"x",alt:ue._({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:[e(A,{icon:"shortcut"})," ",e(u,{id:"CTqTgr"})," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:e(u,{id:"A1As8l"})})]})}),e("main",{children:[e("p",{children:e(u,{id:"CIHAsy"})}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:ue._({id:"qwdOim"}),imgURL:bl},{value:"tab-menu-bar",label:ue._({id:"UxBoCm"}),imgURL:Sl},{value:"multi-column",label:ue._({id:"uvDfdW"}),imgURL:wl}].map(({value:l,label:h,imgURL:m})=>{const f=o.settings.shortcutsViewMode===l||l==="float-button"&&!o.settings.shortcutsViewMode;return e("label",{class:f?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:l,checked:f,onChange:y=>{E.settings.shortcutsViewMode=y.target.value}})," ",e("img",{src:m,alt:"",width:"80",height:"58"})," ",e("span",{children:h})]},l)})}),s.length>0?e(P,{children:[e("ol",{class:"shortcuts-list",ref:r,children:s.filter(Boolean).map((l,h)=>{const m=Object.values(l).join("-"),{type:f}=l;if(!Fn[f])return null;let{icon:y,title:v,subtitle:k,excludeViewMode:S}=Fn[f];typeof v=="function"?v=v(l,h):v=i(v),typeof k=="function"?k=k(l,h):k=i(k),typeof y=="function"&&(y=y(l,h)),typeof S=="function"&&(S=S(l,h));const b=S?.includes(o.settings.shortcutsViewMode);return e("li",{children:[e(A,{icon:y}),e("span",{class:"shortcut-text",children:[e(An,{children:v}),k&&e(P,{children:[" ",e("small",{class:"ib insignificant",children:k})]}),b&&e("span",{class:"tag",children:e(u,{id:"5KJFnN"})})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:h===0,onClick:()=>{const g=Array.from(E.shortcuts);if(h>0){const C=E.shortcuts[h-1];g[h-1]=l,g[h]=C,E.shortcuts=g}},children:e(A,{icon:"arrow-up",alt:ue._({id:"QyioBP"})})}),e("button",{type:"button",class:"plain small",disabled:h===s.length-1,onClick:()=>{const g=Array.from(E.shortcuts);if(h<E.shortcuts.length-1){const C=E.shortcuts[h+1];g[h+1]=l,g[h]=C,E.shortcuts=g}},children:e(A,{icon:"arrow-down",alt:ue._({id:"3Ib6FN"})})}),e("button",{type:"button",class:"plain small",onClick:()=>{c({shortcut:l,shortcutIndex:h})},children:e(A,{icon:"pencil",alt:ue._({id:"ePK91l"})})})]})]},m)})}),s.length===1&&o.settings.shortcutsViewMode!=="float-button"&&e("div",{class:"ui-state insignificant",children:[e(A,{icon:"info"})," ",e("small",{children:e(u,{id:"3Xq4Zi"})})]})]}):e("div",{class:"ui-state insignificant",children:[e("p",{children:o.settings.shortcutsViewMode==="multi-column"?ue._({id:"3xIN+E"}):ue._({id:"vLxvHT"})}),e("p",{children:e(u,{id:"Fq4zw3",components:{0:e("br",{}),1:e("a",{href:"#",onClick:l=>{l.preventDefault(),E.shortcuts=[{type:"following"},{type:"notifications"}]}})}})})]}),e("p",{class:"insignificant",children:s.length>=It&&(o.settings.shortcutsViewMode==="multi-column"?ue._({id:"RqXfsz",values:{SHORTCUTS_LIMIT:It}}):ue._({id:"EVRO/o",values:{SHORTCUTS_LIMIT:It}}))}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>d(!0),children:e(u,{id:"bgVLbt"})}),e("button",{type:"button",disabled:s.length>=It,onClick:()=>c(!0),children:[e(A,{icon:"plus"})," ",e("span",{children:o.settings.shortcutsViewMode==="multi-column"?ue._({id:"Vh3ADI"}):ue._({id:"9tmn6W"})})]})]})]}),a&&e(qe,{onClick:l=>{l.target===l.currentTarget&&c(!1)},children:e(Rl,{shortcut:a.shortcut,shortcutIndex:a.shortcutIndex,onSubmit:({result:l,mode:h})=>{h==="edit"?E.shortcuts[a.shortcutIndex]=l:E.shortcuts.push(l)},onClose:()=>c(!1)})}),p&&e(qe,{onClick:l=>{l.target===l.currentTarget&&d(!1)},children:e(Ll,{shortcuts:s,onClose:()=>d(!1)})})]})}const rs={list:{id:"1qL+L+"},search:{id:"dmTmkQ"},hashtag:{id:"E8laYz"}};function Rl({onSubmit:n,disabled:i,shortcut:o,shortcutIndex:s,onClose:a}){const{_:c}=ce(),p=!!o,[d,r]=R(o?.type||null),[l,h]=R("default"),[m,f]=R([]),[y,v]=R([]);G(()=>{(async()=>{if(d==="list")try{h("loading");const S=await pn();f(S),h("default")}catch{h("error")}})(),(async()=>{if(d==="hashtag")try{const S=await zn();v(S)}catch{}})()},[d]);const k=B();return G(()=>{if(p&&d&&In[d]){const S=k.current;In[d].forEach(({name:b,type:g})=>{const C=S.querySelector(`[name="${b}"]`);C&&o[b]&&(g==="checkbox"?C.checked=o[b]==="on":C.value=o[b])})}},[p,d]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close",onClick:a,children:e(A,{icon:"x",alt:ue._({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:p?ue._({id:"pe1jog"}):ue._({id:"Lsxpe5"})})}),e("main",{tabindex:"-1",children:e("form",{ref:k,onSubmit:S=>{S.preventDefault();const b=new FormData(S.target),g={};b.forEach((C,w)=>{g[w]=C?.trim(),w==="instance"&&(g[w]=g[w].replace(/^https?:\/\//,"").replace(/\/+$/,""),g[w]=g[w].replace(/^@?[^@]+@/,""))}),g.type&&(n({result:g,mode:p?"edit":"add"}),S.target.reset(),r(null),a?.())},children:[e("p",{children:e("label",{children:[e("span",{children:e(u,{id:"cklVjM"})}),e("select",{required:!0,disabled:i,onChange:S=>{r(S.target.value)},defaultValue:p?o.type:void 0,name:"type",dir:"auto",children:[e("option",{}),Tl.map(S=>e("option",{value:S,children:c(uo[S])}))]})]})}),In[d]?.map?.(({text:S,name:b,type:g,placeholder:C,pattern:w,notRequired:I})=>d==="list"?e("p",{children:e("label",{children:[e("span",{children:e(u,{id:"2BBAbc"})}),e("select",{name:"id",required:!I,disabled:i||l==="loading",defaultValue:p?o.id:void 0,dir:"auto",children:[e("option",{value:""}),m.map(_=>e("option",{value:_.id,children:_.title}))]})]})}):e("p",{children:e("label",{children:[e("span",{children:c(S)})," ",e("input",{type:g,switch:g==="checkbox"||void 0,name:b,placeholder:c(C),required:g==="text"&&!I,disabled:i,list:d==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:w,dir:"auto"}),d==="hashtag"&&y.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:y.map(_=>e("option",{value:_.name}))})]})})),!!rs[d]&&e("p",{class:"form-note insignificant",children:[e(A,{icon:"info"}),c(rs[d])]}),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:i||l==="loading",children:p?ue._({id:"tfDRzk"}):ue._({id:"m16xKo"})}),p&&e("button",{type:"button",class:"light danger",onClick:()=>{E.shortcuts.splice(s,1),a?.()},children:e(u,{id:"t/YqKh"})})]})]})})]})}function Ll({shortcuts:n,onClose:i}){const{_:o}=ce(),{masto:s}=se(),a=Se(()=>!n||!n.filter(Boolean).length?"":cs.compressToEncodedURIComponent(JSON.stringify(n.filter(Boolean))),[n]),[c,p]=R(""),[d,r]=R("default"),l=Se(()=>{if(!c)return r("default"),null;try{const f=JSON.parse(cs.decompressFromEncodedURIComponent(c));if(!Array.isArray(f))throw new Error("Not an array");return r("default"),f}catch{try{const y=JSON.parse(c);if(!Array.isArray(y))throw new Error("Not an array");return r("default"),y}catch{return r("error"),null}}},[c]),h=E.shortcuts.length>0,m=B();return e("div",{id:"import-export-container",class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(A,{icon:"x",alt:ue._({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:e(u,{id:"OOa7/5",components:{0:e("small",{class:"ib insignificant"})}})})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(A,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:e(u,{id:"l3s5ri"})})]}),e("p",{class:"field-button",children:[e("input",{ref:m,type:"text",name:"import",placeholder:ue._({id:"tBmklN"}),class:"block",onInput:f=>{p(f.target.value)},dir:"auto"}),E.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2 small",disabled:d==="cloud-downloading",onClick:async()=>{r("cloud-downloading");const f=yt();re(ue._({id:"HLqLGx"}));try{const v=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(v){const{note:k=""}=v;if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(k)){const S=k.match(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/)[1],{v:b,dt:g,data:C}=JSON.parse(S);m.current.value=C,m.current.dispatchEvent(new Event("input"))}}r("default")}catch{r("error"),re(ue._({id:"gCDfX+"}))}},title:ue._({id:"B6cG3J"}),children:[e(A,{icon:"cloud"}),e(A,{icon:"arrow-down"})]})]}),!!l&&Array.isArray(l)&&e(P,{children:[e("p",{children:[e("b",{children:l.length})," shortcut",l.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",c.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:l.map(f=>e("li",{children:[e("span",{style:{opacity:n.some(y=>Object.keys(y).every(v=>y[v]===f[v]))?1:0},children:"*"}),e("span",{children:[o(uo[f.type]),f.type==="list"&&" ⚠️"," ",In[f.type]?.map?.(({text:y,name:v,type:k})=>f[v]?e(P,{children:[e("span",{class:"tag collapsed insignificant",children:[y,":"," ",k==="checkbox"?f[v]==="on"?"✅":"❌":f[v]]})," "]}):null)]})]}))}),e("p",{children:[e("small",{children:e(u,{id:"o6sElH"})}),e("br",{}),e("small",{children:["⚠️"," ",e(u,{id:"N4z4P/"})]})]})]}),d==="error"&&e("p",{class:"error",children:e("small",{children:["⚠️ ",e(u,{id:"ZhsPEb"})]})}),e("p",{children:[h&&e(P,{children:[e(ft,{confirmLabel:ue._({id:"6MzUUU"}),menuFooter:e("div",{class:"footer",children:e(u,{id:"nl8sCE"})}),onClick:()=>{const f=l.filter(k=>!E.shortcuts.some(S=>Object.keys(S).every(b=>S[b]===k[b])));if(!f.length){re(ue._({id:"o6L30P"}));return}let y=[...E.shortcuts,...f];const v=y.length>It;v&&(y=y.slice(0,It)),E.shortcuts=y,re(v?ue._({id:"SBmqmC",values:{SHORTCUTS_LIMIT:It}}):ue._({id:"QO9uTx"})),i?.()},children:e("button",{type:"button",class:"plain2",disabled:!l,children:e(u,{id:"c89gCv"})})})," "]}),e(ft,{confirmLabel:h?ue._({id:"6ZjzWP"}):ue._({id:"DWumLi"}),menuItemClassName:h?"danger":void 0,onClick:()=>{E.shortcuts=l,re(ue._({id:"QO9uTx"})),i?.()},children:e("button",{type:"button",class:"plain2",disabled:!l,children:h?ue._({id:"uIp8WL"}):ue._({id:"Sjnlwj"})})})]})]}),e("section",{children:[e("h3",{children:[e(A,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:e(u,{id:"GS+Mus"})})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:a,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),re(ue._({id:"cWtH+v"}))}catch{re(ue._({id:"yUWyHa"}))}}},dir:"auto"})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.clipboard.writeText(a),re(ue._({id:"+Kq2vY"}))}catch{re(ue._({id:"tFvxZF"}))}},children:[e(A,{icon:"clipboard"})," ",e("span",{children:e(u,{id:"he3ygx"})})]})," ",navigator?.share&&navigator?.canShare?.({text:a})&&e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.share({text:a})}catch{alert(ue._({id:"TtG3Uh"}))}},children:[e(A,{icon:"share"})," ",e("span",{children:e(u,{id:"Z8lGw6"})})]})," ",E.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2",disabled:d==="cloud-uploading",onClick:async()=>{r("cloud-uploading");const f=yt();try{const v=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(v){const{note:k=""}=v;let S="";const b=JSON.stringify({v:"1",dt:Date.now(),data:a});/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(k)?S=k.replace(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/,`<phanpy-shortcuts-settings>${b}</phanpy-shortcuts-settings>`):S=`${k}


<phanpy-shortcuts-settings>${b}</phanpy-shortcuts-settings>`,re(ue._({id:"9ZYiLz"})),await s.v1.accounts.$select(f).note.create({comment:S}),r("default"),re(ue._({id:"5w02SH"}))}}catch{r("error"),re(ue._({id:"aVsTYo"}))}},title:ue._({id:"gWd6Cu"}),children:[e(A,{icon:"cloud"}),e(A,{icon:"arrow-up"})]})," ",a.length>0&&e("small",{class:"insignificant ib",children:e(u,{id:"IPXOXm",values:{0:a.length}})})]}),!!a&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:e(u,{id:"e5E+WH"})})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(n.filter(Boolean),null,2)})]})]}),E.settings.shortcutSettingsCloudImportExport&&e("footer",{children:e("p",{children:[e(A,{icon:"cloud"})," ",e(u,{id:"C4T6O/"})]})})]})]})}Ms(E,n=>{for(const[i,o,s,a]of n)/^show/i.test(o)&&!s&&ui()});function Ml(){const{_:n}=ce(),i=Ge(E),o=$s(),s=Qt();return G(()=>{setTimeout(Uo,1e3)},[]),e(P,{children:[!!i.showCompose&&e(qe,{class:`solid ${i.composerState.minimized?"min":""}`,minimized:!!i.composerState.minimized,children:e(Bo,{replyToStatus:typeof i.showCompose!="boolean"?i.showCompose.replyToStatus:window.__COMPOSE__?.replyToStatus||null,editStatus:E.showCompose?.editStatus||window.__COMPOSE__?.editStatus||null,draftStatus:E.showCompose?.draftStatus||window.__COMPOSE__?.draftStatus||null,quoteStatus:E.showCompose?.quoteStatus||window.__COMPOSE__?.quoteStatus||null,onClose:a=>{const{newStatus:c,instance:p,type:d,scheduledAt:r}=a||{};E.showCompose=!1,window.__COMPOSE__=null,c&&(E.reloadStatusPage++,r&&E.reloadScheduledPosts++,re({text:{post:n(r?{id:"IrX0sj"}:{id:"aTyHBW"}),reply:n(r?{id:"+38pse"}:{id:"lZdBKl"}),edit:n({id:"a5BN7l"})}[d||"post"],delay:1e3,duration:1e4,onClick:l=>{l.hideToast(),E.prevLocation=s,o(r?"/sp":p?`/${p}/s/${c.id}`:`/s/${c.id}`)}}))}})}),!!i.showSettings&&e(qe,{onClose:()=>{E.showSettings=!1},children:e(vc,{onClose:()=>{E.showSettings=!1}})}),!!i.showAccounts&&e(qe,{onClose:()=>{E.showAccounts=!1},children:e(oc,{onClose:()=>{E.showAccounts=!1}})}),!!i.showAccount&&e(qe,{onClose:()=>{E.showAccount=!1},children:e(Hc,{account:i.showAccount?.account||i.showAccount,instance:i.showAccount?.instance,onClose:({destination:a}={})=>{E.showAccount=!1}})}),!!i.showOpenLink&&e(qe,{onClose:()=>{E.showOpenLink=!1},children:e(pl,{url:i.showOpenLink.url,linkText:i.showOpenLink.linkText,onClose:()=>{E.showOpenLink=!1}})}),!!i.showDrafts&&e(qe,{onClose:()=>{E.showDrafts=!1},children:e(Yc,{onClose:()=>E.showDrafts=!1})}),!!i.showMediaModal&&e(qe,{onClick:a=>{(a.target===a.currentTarget||a.target.classList.contains("media"))&&(E.showMediaModal=!1)},children:e(ro,{mediaAttachments:i.showMediaModal.mediaAttachments,instance:i.showMediaModal.instance,index:i.showMediaModal.mediaIndex,statusID:i.showMediaModal.statusID,onClose:()=>{E.showMediaModal=!1}})}),!!i.showShortcutsSettings&&e(qe,{onClose:()=>{E.showShortcutsSettings=!1},children:e(El,{onClose:()=>E.showShortcutsSettings=!1})}),!!i.showGenericAccounts&&e(qe,{onClose:()=>{E.showGenericAccounts=!1},children:e(Gc,{instance:i.showGenericAccounts.instance,excludeRelationshipAttrs:i.showGenericAccounts.excludeRelationshipAttrs,postID:i.showGenericAccounts.postID,onClose:()=>E.showGenericAccounts=!1,blankCopy:i.showGenericAccounts.blankCopy})}),!!i.showMediaAlt&&e(qe,{onClose:a=>{E.showMediaAlt=!1},children:e(Zc,{alt:i.showMediaAlt.alt||i.showMediaAlt,lang:i.showMediaAlt?.lang,onClose:()=>{E.showMediaAlt=!1}})}),!!i.showEmbedModal&&e(qe,{class:"solid",onClose:()=>{E.showEmbedModal=!1},children:e(Vc,{html:i.showEmbedModal.html,url:i.showEmbedModal.url,width:i.showEmbedModal.width,height:i.showEmbedModal.height,onClose:()=>{E.showEmbedModal=!1}})}),!!i.showReportModal&&e(qe,{onClose:()=>{E.showReportModal=!1},children:e(yl,{account:i.showReportModal.account,post:i.showReportModal.post,onClose:()=>{E.showReportModal=!1}})})]})}function pi({accountID:n,onChange:i}){const{_:o}=ce(),{masto:s}=se(),[a,c]=R("default"),[p,d]=R(null),[r,l]=R(null),h=r!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:a==="loading"||h,onClick:()=>{c("loading"),d("accept"),(async()=>{try{const m=await s.v1.followRequests.$select(n).authorize();if(!m?.followedBy)throw new Error("Follow request not accepted");l(m),i()}catch{}c("default")})()},children:e(u,{id:"g3UF2V"})})," ",e("button",{type:"button",disabled:a==="loading"||h,class:"light danger",onClick:()=>{c("loading"),d("reject"),(async()=>{try{const m=await s.v1.followRequests.$select(n).reject();if(m?.followedBy)throw new Error("Follow request not rejected");l(m),i()}catch{c("default")}})()},children:e(u,{id:"1t/NnN"})}),e("span",{class:"follow-request-states",children:h&&p?p==="accept"?e(A,{icon:"check-circle",alt:o({id:"bzMKg7"}),class:"follow-accepted"}):e(A,{icon:"x-circle",alt:o({id:"ekCRTP"}),class:"follow-rejected"}):e(Fe,{hidden:a!=="loading"})})]})}const ds={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning",severed_relationships:"heart-break",moderation_warning:"alert",emoji_reaction:"emoji2","pleroma:emoji_reaction":"emoji2",annual_report:"celebrate",quote:"quote",quoted_update:"pencil"};function us({account:n,emoji:i,emoji_url:o}){let s,a;typeof o=="string"?s=o:(s=o?.url,a=o?.staticUrl);const c=s?e(ua,{url:s,staticUrl:a,alt:i}):i;return e(u,{id:"i5uN6K",values:{account:n,emojiObject:c}})}const oi={status:({account:n})=>e(u,{id:"idiIxW",values:{account:n}}),reblog:({count:n,account:i,postsCount:o,postType:s,components:{Subject:a}})=>e(u,{id:"jkt9P5",values:{0:We(n),1:We(n),count:n,postsCount:o,postType:s,account:i},components:{0:e(a,{clickable:n>1}),1:e("span",{title:n}),2:e(a,{clickable:n>1}),3:e("span",{title:n})}}),follow:({account:n,count:i,components:{Subject:o}})=>e(u,{id:"+71G9C",values:{0:We(i),count:i,account:n},components:{0:e(o,{clickable:i>1}),1:e("span",{title:i})}}),follow_request:({account:n})=>e(u,{id:"eh6NHW",values:{account:n}}),favourite:({account:n,count:i,postsCount:o,postType:s,components:{Subject:a}})=>e(u,{id:"RqX1mR",values:{0:We(i),1:We(i),count:i,postsCount:o,postType:s,account:n},components:{0:e(a,{clickable:i>1}),1:e("span",{title:i}),2:e(a,{clickable:i>1}),3:e("span",{title:i})}}),poll:()=>ue._({id:"kIlJaS"}),"poll-self":()=>ue._({id:"kpjzdN"}),"poll-voted":()=>ue._({id:"moT7M8"}),update:({account:n})=>n?e(u,{id:"W+eFn3",values:{account:n}}):ue._({id:"uzt17m"}),"favourite+reblog":({count:n,account:i,postsCount:o,postType:s,components:{Subject:a}})=>e(u,{id:"NunZZQ",values:{0:We(n),1:We(n),count:n,postsCount:o,postType:s,account:i},components:{0:e(a,{clickable:n>1}),1:e("span",{title:n}),2:e(a,{clickable:n>1}),3:e("span",{title:n})}}),quoted_update:({account:n})=>e(u,{id:"pkB7ti",values:{account:n}}),"admin.sign_up":({account:n})=>e(u,{id:"fJCCpx",values:{account:n}}),"admin.report":({account:n,targetAccount:i})=>e(u,{id:"eNfCmq",values:{account:n,targetAccount:i}}),severed_relationships:({name:n})=>e(u,{id:"Xl9v6+",values:{name:n},components:{0:e("i",{})}}),moderation_warning:()=>e("b",{children:e(u,{id:"YqffEv"})}),emoji_reaction:us,"pleroma:emoji_reaction":us,annual_report:({year:n})=>e(u,{id:"INLTzH",values:{year:n}})},$l={account_suspension:({from:n,targetName:i})=>e(u,{id:"uRkcgw",values:{from:n,targetName:i},components:{0:e("i",{}),1:e("i",{})}}),domain_block:({from:n,targetName:i,followersCount:o,followingCount:s})=>e(u,{id:"Q3yArs",values:{from:n,targetName:i,followersCount:o,followingCount:s},components:{0:e("i",{}),1:e("i",{})}}),user_domain_block:({targetName:n,followersCount:i,followingCount:o})=>e(u,{id:"RQKWUa",values:{targetName:n,followersCount:i,followingCount:o},components:{0:e("i",{})}})},Nl={none:{id:"ipnHrn"},disable:{id:"jw0eSZ"},mark_statuses_as_sensitive:{id:"v9jO+F"},delete_statuses:{id:"raUMBQ"},sensitive:{id:"w2OpMr"},silence:{id:"mlycBx"},suspend:{id:"Fz4lZ1"}},ai=30;function Pl({notification:n,instance:i,isStatic:o,disableContextMenu:s}){const{_:a}=ce(),{masto:c}=se(),{id:p,status:d,account:r,report:l,event:h,moderation_warning:m,annualReport:f,_ids:y,_accounts:v,_statuses:k,_groupKeys:S,sampleAccounts:b,notificationsCount:g,groupKey:C,_notificationsCount:w,_sampleAccountsCount:I}=n;let{type:_}=n;if((_==="mention"||_==="quote")&&!d)return null;const T=d?.reblog||d,L=T?.id,M=yt(),K=M===r?.id,F=d?.poll?.voted,q=!!d?.inReplyToAccountId&&d?.inReplyToAccountId!==M&&d?.account?.id===M;let X=0,Q=0;if(_==="favourite+reblog"){if(v)for(const ee of v)ee._types?.includes("favourite")&&X++,ee._types?.includes("reblog")&&Q++;!Q&&X&&(_="favourite"),!X&&Q&&(_="reblog")}let j;_==="poll"?j=oi[K?"poll-self":F?"poll-voted":"poll"]:oi[_]?j=oi[_]:j=ue._({id:"ODqZt1",values:{type:_}});const V=({clickable:ee,...he})=>ee?e("b",{tabIndex:"0",onClick:Y,...he}):e("b",{...he}),H=g>0&&g>b?.length,pe=H?"remote":"local";if(typeof j=="function"){const ee=(_==="favourite"||_==="reblog")&&g?H?g:b?.length:v?.length||b?.length||(r?1:0),he=k?.length||(d?1:0);if(_==="admin.report"){const le=l?.targetAccount;le&&(j=j({account:e(mt,{account:r,showAvatar:!0}),targetAccount:e(mt,{account:le,showAvatar:!0})}))}else if(_==="severed_relationships"){const le=h?.targetName;le&&(j=j({name:le}))}else if((_==="emoji_reaction"||_==="pleroma:emoji_reaction")&&n.emoji){const le=n.emoji_url||d?.emojis?.find?.(J=>J?.shortcode===n.emoji.replace(/^:/,"").replace(/:$/,""));j=j({account:e(mt,{account:r,showAvatar:!0}),emoji:n.emoji,emojiURL:le})}else _==="annual_report"?j=j({...n.annualReport}):j=j({account:r?e(mt,{account:r,showAvatar:!0}):b?.[0]&&e(mt,{account:b[0],showAvatar:!0}),count:ee,postsCount:he,postType:q?"reply":"post",components:{Subject:V}})}const $=n.createdAt&&new Date(n.createdAt).toLocaleString(),ie={"favourite+reblog":ue._({id:"+XOeb+"}),favourite:ue._({id:"LQFF6J"}),reblog:ue._({id:"phQpSa"}),follow:ue._({id:"Ih01jh"})}[_]||ue._({id:"bPwFdf"}),Y=()=>{E.showGenericAccounts={heading:ie,accounts:v,showReactions:_==="favourite+reblog",excludeRelationshipAttrs:_==="follow"?["followedBy"]:[],postID:ct(L,i)}};if(d?.filtered){const ee=d?.account?.id===M,he=Zt(d.filtered,"notifications");if(!K&&!ee&&he?.action==="hide")return null}return e("div",{class:`notification notification-${_}`,"data-notification-id":y||p,"data-group-key":S?.join(" ")||C,tabIndex:"0",children:[e("div",{class:`notification-type notification-${_}`,title:$,children:_==="favourite+reblog"?e(P,{children:[e(A,{icon:"rocket",size:"xl",alt:_,class:"reblog-icon"}),e(A,{icon:"heart",size:"xl",alt:_,class:"favourite-icon"})]}):e(A,{icon:ds[_]||"notification",size:"xl",alt:_})}),e("div",{class:"notification-content",children:[_!=="mention"&&_!=="quote"&&e(P,{children:[e("p",{children:j}),_==="follow_request"&&e(pi,{accountID:r.id}),_==="severed_relationships"&&e("div",{children:[$l[h.type]({from:i,...h}),e("br",{}),e("a",{href:`https://${i}/severed_relationships`,target:"_blank",rel:"noopener",children:e(u,{id:"YL6Y8P",components:{0:e(A,{icon:"external",size:"s"})}})}),"."]}),_==="moderation_warning"&&!!m&&e("div",{children:[a(Nl[m.action]()),e("br",{}),e("a",{href:`/disputes/strikes/${m.id}`,target:"_blank",rel:"noopener",children:e(u,{id:"YL6Y8P",components:{0:e(A,{icon:"external",size:"s"})}})})]}),_==="annual_report"&&e("div",{children:e(fe,{to:`/annual_report/${f?.year}`,children:e(u,{id:"5PGPvG"})})})]}),v?.length>1&&e("p",{class:"avatars-stack",children:[v.slice(0,ai).map(ee=>e(P,{children:[e("a",{href:ee.url,rel:"noopener",class:"account-avatar-stack",onClick:he=>{he.preventDefault(),E.showAccount=ee},children:[e(pt,{url:ee.avatarStatic,size:v.length<=10?"xxl":v.length<20?"xl":"l",alt:`${ee.displayName} @${ee.acct}`,squircle:ee?.bot},ee.id),_==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:ee._types.map(he=>e(A,{icon:ds[he],size:"s",class:`${he}-icon`}))})]},ee.id)," "]},ee.id)),(_==="favourite+reblog"||_==="favourite"||_==="reblog")&&pe==="remote"?e("button",{type:"button",class:"small plain","data-group-keys":S?.join(" "),onClick:()=>{E.showGenericAccounts={heading:ie,accounts:v,fetchAccounts:async()=>{const ee=await Promise.allSettled(S.map(async le=>{const J=c.v2.notifications.$select(le).accounts.list().values();return[le,(await J.next()).value]})),he=[];for(const le of ee){const[J,Ae]=le.value,ye=/^favourite/.test(J)?"favourite":/^reblog/.test(J)?"reblog":null;if(ye)for(const ve of Ae){const Pe=he.find(_e=>_e.id===ve.id);Pe?Pe._types.push(ye):(ve._types=[ye],he.push(ve))}}return{done:!0,value:he}},showReactions:_==="favourite+reblog",postID:ct(L,i)}},children:["+",(_==="favourite"||_==="reblog")&&g-v.length,e(A,{icon:"chevron-down"})]}):e("button",{type:"button",class:"small plain",onClick:Y,children:[v.length>ai&&`+${v.length-ai}`,e(A,{icon:"chevron-down"})]})]}),!v?.length&&b?.length>1&&e("p",{class:"avatars-stack",children:[b.map(ee=>e(P,{children:[e("a",{href:ee.url,rel:"noopener",class:"account-avatar-stack",onClick:he=>{he.preventDefault(),E.showAccount=ee},children:e(pt,{url:ee.avatarStatic,size:"xxl",alt:`${ee.displayName} @${ee.acct}`,squircle:ee?.bot},ee.id)},ee.id)," "]},ee.id)),g>b.length&&e(fe,{to:i?`/${i}/s/${d.id}`:`/s/${d.id}`,class:"button small plain centered",children:["+",g-b.length,e(A,{icon:"chevron-right"})]})]}),k?.length>1&&e("ul",{class:"notification-group-statuses",children:k.map(ee=>e("li",{children:e(hs,{class:`status-link status-type-${_}`,to:i?`/${i}/s/${ee.id}`:`/s/${ee.id}`,children:e(je,{status:ee,size:"s",previewMode:!0,allowContextMenu:!0,allowFilters:!0})})},ee.id))}),d&&(!k?.length||k?.length<=1)&&e(hs,{class:`status-link status-type-${_}`,to:i?`/${i}/s/${L}`:`/s/${L}`,onContextMenu:s?void 0:ee=>{const he=ee.target.querySelector(".status");if(he){if(ee.metaKey)return;ee.preventDefault(),he.dispatchEvent(new MouseEvent("contextmenu",{clientX:ee.clientX,clientY:ee.clientY}))}},children:o?e(je,{status:T,size:"s",readOnly:!0,allowContextMenu:!0,allowFilters:!0}):e(je,{statusID:L,size:"s",readOnly:!0,allowContextMenu:!0,allowFilters:!0})})]})]})}function hs(n){const i=ha();return e(fe,{...n,"data-read-more":ue._({id:"8fZueG"}),ref:i})}const un=rt(Pl,(n,i)=>n.notification?.id===i.notification?.id);"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",n=>{const{type:i,id:o,accessToken:s}=n?.data||{};i==="notification"&&(E.routeNotification={id:o,accessToken:s})});const Dl=rt(function(){const{_:i}=ce();if(!("serviceWorker"in navigator))return null;const o=Ge(E),{routeNotification:s}=o,{id:a,accessToken:c}=s||{},[p,d]=R(!1);kt(()=>{if(!a||!c)return;const{instance:l}=se(),{masto:h,instance:m}=se({accessToken:c}),f=l===m,y=c?qo(c):Si();(async()=>{const v=await h.v1.notifications.$select(a).fetch();if(v&&y){const k=y.instanceURL,{type:S,status:b,account:g}=v,C=!!document.querySelector("#modal-container > *"),w=S==="follow"&&!!g?.id,I=!!g?.id,_=!!b?.id;w&&f?E.showAccount={account:g,instance:k}:C||!f||I&&_?d({id:a,account:y,notification:v,sameInstance:f}):_?location.hash=`/${l}/s/${b.id}`:w?location.hash=`/${l}/a/${g.id}`:location.hash="/notifications"}})()},[a,c]),kt(()=>{navigator?.clearAppBadge&&navigator.clearAppBadge()},[]),Xt(l=>{l&&navigator?.clearAppBadge&&navigator.clearAppBadge()});const r=()=>{d(!1),E.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(p){const{id:l,account:h,notification:m,sameInstance:f}=p;return e(qe,{onClick:y=>{y.target===y.currentTarget&&r()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:r,children:e(A,{icon:"x",alt:i({id:"yz7wBu"})})}),e("header",{children:e("b",{children:e(u,{id:"5+87Pq"})})}),e("main",{children:[!f&&e("p",{children:e(u,{id:"k9N0Xk"})}),e("div",{class:"notification-peek",onClick:y=>{const{target:v}=y;(y.target.tagName==="BUTTON"||y.target.tagName==="A")&&r()},children:e(un,{instance:h.instanceURL,notification:m,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(fe,{to:"/notifications",class:"button light",onClick:r,children:[e("span",{children:e(u,{id:"/WA/tl"})})," ",e(A,{icon:"arrow-right"})]})})]})]})})}return null}),Zn=({limit:n}={})=>{const i=Ee.account.get("searchHistory")||[];return n?i.slice(0,n):i},Ol=10,Tn=(n,i=null)=>{if(!n?.trim?.())return;const o=Zn(),s=o.findIndex(c=>c.query===n&&c.queryType===i);s!==-1&&o.splice(s,1),o.unshift({query:n.trim(),queryType:i,timestamp:Date.now()});const a=o.slice(0,Ol);Ee.account.set("searchHistory",a)},zl=(n,i=null)=>{const s=Zn().filter(a=>!(a.query===n&&a.queryType===i));Ee.account.set("searchHistory",s)},Fl=()=>{Ee.account.set("searchHistory",[])},zt=(n,i,o)=>{let s,a,c;return i==="statuses"?(s=e(u,{id:"o1mMWT",values:{query:n},components:{0:e("q",{})}}),a=`/search?q=${encodeURIComponent(n)}&type=statuses`,c="document"):i==="accounts"?(s=e(u,{id:"cDoNQr",values:{query:n},components:{0:e("q",{})}}),a=`/search?q=${encodeURIComponent(n)}&type=accounts`,c="group"):i==="hashtags"?(s=e(u,{id:"YAZw8D",values:{0:n.replace(/^#/,"")},components:{0:e("mark",{})}}),a=`/${o}/t/${n.replace(/^#/,"")}`,c="hashtag"):(s=e(u,{id:"48oDit",values:{query:n},components:{0:e("small",{class:"insignificant"})}}),a=`/search?q=${encodeURIComponent(n)}`,c="search"),{label:s,to:a,icon:c}},ho=Ko((n,i)=>{const{_:o}=ce(),{instance:s}=se(),[a,c]=bt(),[p,d]=R(!1),[r,l]=R(a.get("q")||""),h=a.get("type"),m=B(null),f=B(null);Ho(i,()=>({setValue:k=>{l(k)},focus:()=>{f.current.focus()},select:()=>{f.current.select()},blur:()=>{f.current.blur()}}));const y=Se(()=>Zn({limit:5}),[n?.hidden]),v=Se(()=>{if(!r)return[];const S=y.filter(g=>g.query===r?!1:g.query.toLowerCase().includes(r.toLowerCase())).slice(0,2).map(g=>({...zt(g.query,g.queryType,s),queryType:g.queryType,isRecentSearch:!0,historyItem:g}));return[{...zt(r,null,s),top:!h&&!/\s/.test(r),hidden:!!h},...S,{...zt(r,"statuses",s),hidden:/^https?:/.test(r),top:/\s/.test(r),queryType:"statuses"},{...zt(r,"hashtags",s),hidden:/^@/.test(r)||/^https?:/.test(r)||/\s/.test(r),top:/^#/.test(r),type:"link",queryType:"hashtags"},{label:e(u,{id:"gEoOUj",values:{query:r},components:{0:e("mark",{})}}),to:`/${r}`,hidden:!/^https?:/.test(r),top:/^https?:/.test(r),type:"link",icon:"arrow-right"},{...zt(r,"accounts",s),queryType:"accounts"}].sort((g,C)=>{if(h){if(g.queryType===h)return-1;if(C.queryType===h)return 1}return g.top&&!C.top?-1:!g.top&&C.top?1:0}).filter(({hidden:g})=>!g)},[r,h,s]);return e("form",{ref:m,class:"search-popover-container",onSubmit:k=>{if(k.preventDefault(),/\/search/.test(location.hash))if(r){const b={q:r};h&&(b.type=h),c(b)}else c({});else r?location.hash=`/search?q=${encodeURIComponent(r)}${h?`&type=${h}`:""}`:location.hash="/search";Tn(r,h),n?.onSubmit?.(k)},children:[e("input",{ref:f,value:r,name:"q",type:"search",placeholder:o({id:"A1taO8"}),dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellCheck:"false",onSearch:k=>{k.target.value||c({})},onInput:k=>{l(k.target.value),d(!0)},onFocus:()=>{d(!0);const k=m.current?.querySelector(".search-popover-item");k&&k.classList.add("focus")},onBlur:()=>{setTimeout(()=>{d(!1)},100),m.current?.querySelector(".search-popover-item.focus")?.classList.remove("focus")},onKeyDown:k=>{const{key:S}=k;switch(S){case"Escape":d(!1);break;case"Down":case"ArrowDown":if(k.preventDefault(),p){const b=m.current.querySelector(".search-popover-item.focus");if(b){let g=b.nextElementSibling;for(;g&&g.hidden;)g=g.nextElementSibling;g&&(g.classList.add("focus"),Array.from(g.parentElement.children).filter(w=>w!==g).forEach(w=>{w.classList.remove("focus")}))}else{const g=m.current.querySelector(".search-popover-item");g&&g.classList.add("focus")}}break;case"Up":case"ArrowUp":if(k.preventDefault(),p){const b=document.querySelector(".search-popover-item.focus");if(b){let g=b.previousElementSibling;for(;g&&g.hidden;)g=g.previousElementSibling;g&&(g.classList.add("focus"),Array.from(g.parentElement.children).filter(w=>w!==g).forEach(w=>{w.classList.remove("focus")}))}else{const g=document.querySelectorAll(".search-popover-item"),C=g[g.length-1];C&&C.classList.add("focus")}}break;case"Enter":if(p){const b=document.querySelector(".search-popover-item.focus");b&&(k.preventDefault(),b.click()),d(!1),n?.onSubmit?.(k)}break}}}),e("div",{class:"search-popover",hidden:!p,children:[!r&&y.length>0&&e("div",{class:"search-popover-recent-searches",children:[e("div",{class:"search-popover-header",children:[e(A,{icon:"history",size:"s"}),e(u,{id:"4R1B1H"})]}),y.map((k,S)=>{const{label:b,to:g,icon:C}=zt(k.query,k.queryType,s);return e(fe,{to:g,class:`search-popover-item ${S===0?"focus":""}`,onClick:w=>{Tn(k.query,k.queryType),n?.onSubmit?.(w)},children:[e(A,{icon:C,class:"more-insignificant"}),e("span",{children:b})]},`${k.query}-${k.queryType}-${k.timestamp}`)}),e(fe,{to:"/search",class:"search-popover-item search-history-see-all",children:[e(A,{icon:"more2",class:"more-insignificant"}),e("span",{children:e(u,{id:"gukqfD"})})]})]}),v.map(({label:k,to:S,icon:b,queryType:g,isRecentSearch:C,historyItem:w},I)=>e(fe,{to:S,class:`search-popover-item ${C?"search-popover-item-recent":""} ${I===0?"focus":""}`,onClick:_=>{C||Tn(r,g),n?.onSubmit?.(_)},children:[e(A,{icon:b,class:"more-insignificant"}),e("span",{children:k})]},C?`recent-${w.query}-${w.queryType}-${w.timestamp}`:`suggestion-${g||"general"}-${I}`))]})]})}),Ul=rt(function({onClose:i=()=>{}}){const[o,s]=R(!1),a=B(null);Ke(["Slash","/"],d=>{s(!0),setTimeout(()=>{a.current?.focus?.(),a.current?.select?.()},0)},{useKey:!0,preventDefault:!0,ignoreEventWhen:d=>{const r=/\/search/.test(location.hash),l=!!document.querySelector("#modal-container > *");return r||l||d.metaKey||d.ctrlKey||d.altKey||d.shiftKey}});const c=()=>{s(!1),i()};Ke("esc",d=>{a.current?.blur?.(),c()},{enabled:o,enableOnFormTags:!0,preventDefault:!0,useKey:!0,ignoreEventWhen:d=>d.metaKey||d.ctrlKey||d.altKey||d.shiftKey});const p=!o;return e("div",{id:"search-command-container",hidden:p,onClick:d=>{d.target===d.currentTarget&&c()},children:e(ho,{ref:a,hidden:p,onSubmit:()=>{c()}})})});function Bl(){const{_:n,_:i}=ce(),{instance:o}=se(),s=Ge(E),{shortcuts:a,settings:c}=s;if(!a.length)return null;const p=c.shortcutsViewMode==="multi-column"||!c.shortcutsViewMode&&c.shortcutsColumnsMode,d=B(),r=B(),l=B(!1),h=a.map((v,k)=>{const{type:S,...b}=v;if(!Fn[S])return null;let{id:g,path:C,title:w,subtitle:I,icon:_}=Fn[S];return typeof g=="function"&&(g=g(b,k)),typeof C=="function"&&(C=C({...b,instance:b.instance||o},k)),typeof w=="function"?w=w(b,k):w?.id&&(w=i(w)),typeof I=="function"?I=I(b,k):I?.id&&(I=i(I)),typeof _=="function"&&(_=_(b,k)),g==="lists"&&(l.current=!0),{id:g,path:C,title:w,subtitle:I,icon:_}}).filter(Boolean);G(()=>{if(s.settings.shortcutsViewMode==="tab-menu-bar"&&r.current){const v=setTimeout(()=>{const k=r.current?.querySelector(".is-active");k&&k.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},100);return()=>clearTimeout(v)}},[]);const m=$s();Ke(["1","2","3","4","5","6","7","8","9"],v=>{const k=parseInt(v.key,10)-1;if(k<h.length){const{path:S}=h[k];S&&(m(S),d.current?.closeMenu?.())}},{enabled:!p,useKey:!0,ignoreEventWhen:v=>v.metaKey||v.ctrlKey||v.altKey||v.shiftKey});const[f,y]=R([]);return p?null:e("div",{id:"shortcuts",children:s.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{ref:r,class:"tab-bar",onContextMenu:v=>{v.preventDefault(),E.showShortcutsSettings=!0},children:e("ul",{children:h.map(({id:v,path:k,title:S,subtitle:b,icon:g},C)=>e("li",{children:e(fe,{class:b?"has-subtitle":"",to:k,onClick:w=>{if(w.target.classList.contains("is-active")){w.preventDefault();const I=document.getElementById(`${v}-page`);if(I){I.scrollTop=0;const _=I.querySelector(".updates-button");_&&_.click()}}},children:[e(A,{icon:g,size:"xl"}),e("span",{children:[e(An,{children:S}),b&&e(P,{children:[e("br",{}),e("small",{children:b})]})]})]})},`${C}-${v}-${S}-${b}-${k}`))})}):e(lt,{instanceRef:d,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",onMenuChange:v=>{v.open&&l.current&&pn().then(y)},menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:v=>{v.preventDefault(),E.showShortcutsSettings=!0},onTransitionStart:v=>{try{const{target:k}=v;getComputedStyle(k).pointerEvents==="none"&&d.current?.closeMenu?.()}catch{}},children:e(A,{icon:"shortcut",size:"xl",alt:n({id:"CTqTgr"})})}),children:h.map(({id:v,path:k,title:S,subtitle:b,icon:g},C)=>v==="lists"?e(hn,{menuClassName:"glass-menu",overflow:"auto",gap:-8,label:e(P,{children:[e(A,{icon:g,size:"l"}),e("span",{class:"menu-grow",children:e(An,{children:S})}),e(A,{icon:"chevron-right"})]}),children:[e(He,{to:"/l",children:e("span",{children:e(u,{id:"BHWx+g"})})}),e(Ye,{}),f?.map(w=>e(He,{to:`/l/${w.id}`,children:e("span",{children:[w.title,w.exclusive&&e(P,{children:[" ",e(Kt,{})]})]})},w.id))]}):e(He,{to:k,class:"glass-menu-item",children:[e(A,{icon:g,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(An,{children:S})}),b&&e(P,{children:[" ",e("small",{class:"more-insignificant",children:b})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:C+1})]},`${C}-${v}-${S}-${b}-${k}`))})})}const ql=rt(Bl);function Kl(n){let i=[],o=[],s=0;for(let a=0;a<n.length;a++){const c=n[a];c.reblog&&!c.account?.group?(o.push(c),s++):(i.push(c),s<3&&(s=0))}if(n.length>10&&(o.length>n.length/4||s>=3)){const a=o.map(c=>c.id);if(o.length>n.length*3/4)i=[...i,{id:a,items:o,type:"boosts"}];else{const c=Math.floor(i.length/2);i=[...i.slice(0,c),{id:a,items:o,type:"boosts"},...i.slice(c)]}return i}else return n}function ps(n,i){const o=Ee.account.get("boostedStatusIDs")||{},s=n.filter(c=>{if(!c.reblog)return!0;const p=`${i}-${c.reblog.id}`,d=o[p];return d&&d!==c.id?!1:(o[p]=c.id,!0)}),a=Object.keys(o);return a.length>50&&a.slice(0,a.length-50).forEach(c=>{delete o[c]}),Ee.account.set("boostedStatusIDs",o),s}function Hl(n,i){const o=[];let s=0;n.forEach(d=>{for(let l=0;l<o.length;l++){if(o[l].find(h=>h.id===d.id))return;if(o[l].find(h=>h.id===d.inReplyToId)||o[l].find(h=>h.inReplyToId===d.id)){o[l].push(d);return}}const r=n.find(l=>l.id===d.inReplyToId);r&&(o[s++]=[d,r])});for(let d=0;d<o.length;d++)for(let r=d+1;r<o.length;r++)o[d].find(h=>o[r].includes(h))&&(o[d]=[...o[d],...o[r]],o[d]=o[d].filter((h,m,f)=>f.findIndex(y=>y.id===h.id)===m),o.splice(r,1),r--);o.forEach(d=>{d.sort((r,l)=>!r.inReplyToId&&!l.inReplyToId?Date.parse(r.createdAt)-Date.parse(l.createdAt):r.inReplyToId===l.id?1:l.inReplyToId===r.id||!r.inReplyToId?-1:l.inReplyToId?Date.parse(r.createdAt)-Date.parse(l.createdAt):1)}),o.forEach(d=>{const r=d[0].account.id;d.forEach(l=>{l.account.id!==r&&(l._differentAuthor=!0)})}),o.length;const a=[],c=[],p=[];return n.forEach(d=>{if(d.reblog){a.push(d);return}for(let r=0;r<o.length;r++)if(o[r].find(l=>l.id===d.id)){if(c.includes(r))return;const l=o[r];l.sort((m,f)=>Date.parse(m.createdAt)-Date.parse(f.createdAt));const h=l[0].account.id;a.push({id:l.map(m=>m.id),items:l,type:l.every(m=>m.account.id===h)?"thread":"conversation"}),c.push(r);return}if(d.inReplyToId&&d.inReplyToAccountId!==d.account.id){const r=ct(d.id,i);E.statusReply[r]||p.push({sKey:r,inReplyToId:d.inReplyToId})}a.push(d)}),p?.length&&queueMicrotask(()=>{const{masto:d}=se({instance:i});async function r(){for(let l=0;l<p.length;l++){const{sKey:h,inReplyToId:m}=p[l];try{const f=await Yl(m,d);Je(f,i,{skipThreading:!0}),E.statusReply[h]={id:f.id,instance:i},await new Promise(y=>setTimeout(y,1e3))}catch{}}}if(Xe("@mastodon/fetch-multiple-statuses")){const l=p.map(({inReplyToId:h})=>h);(async()=>{try{const h=await d.v1.statuses.list({id:l});if(h?.length)for(const m of h){Je(m,i,{skipThreading:!0});const f=p.find(({inReplyToId:y})=>y===m.id)?.sKey;f&&(E.statusReply[f]={id:m.id,instance:i})}else r()}catch{r()}})()}else r()}),a}const Yl=vt((n,i)=>i.v1.statuses.$select(n).fetch());async function po(n,i){const o=await Al();if(!o.length)return;const{statusFollowedTags:s}=E,a=[];if(n.forEach(c=>{if(c.reblog)return;const{id:p,content:d,tags:r=[]}=c,l=ct(p,i);if(s[l]?.length)return;const h=Il(d);if(!h.length&&!r.length)return;const m=o.reduce((f,y)=>((h.some(v=>v.toLowerCase()===y.name.toLowerCase())||r.some(v=>v.name.toLowerCase()===y.name.toLowerCase()))&&f.push(y.name),f),[]);m.length&&a.push({item:c,sKey:l,followedTags:m})}),a.length){const c=a.map(d=>d.item.account),p=await Kn(c);if(!p)return;a.forEach(d=>{const{item:r,sKey:l,followedTags:h}=d,m=p[r.account.id];m&&!m.following&&(s[l]=h)})}}function jl(){E.statusFollowedTags={}}function Vl({scrollableRef:n,distanceFromStart:i=1,distanceFromEnd:o=1,scrollThresholdStart:s=10,scrollThresholdEnd:a=10,direction:c="vertical",distanceFromStartPx:p,distanceFromEndPx:d}={}){const[r,l]=R(null),[h,m]=R(!1),[f,y]=R(!1),[v,k]=R(!1),[S,b]=R(!1),g=c==="vertical";return kt(()=>{const C=n.current;if(!C)return{};let w=g?C.scrollTop:C.scrollLeft;function I(){const{scrollTop:_,scrollLeft:T,scrollHeight:L,scrollWidth:M,clientHeight:K,clientWidth:F}=C,q=g?_:T,X=g?L:M,Q=g?K:F,j=Math.abs(q-w),V=p||Math.min(Q*i,X,q),H=d||Math.min(Q*o,X,X-q-Q);j>=(w<q?a:s)&&(l(w<q?"end":"start"),w=q),m(q<=0),y(q+Q>=X),k(q<=V),b(q+Q>=X-H)}return C.addEventListener("scroll",I,{passive:!0}),()=>C.removeEventListener("scroll",I)},[i,o,s,a]),{scrollDirection:r,reachStart:h,reachEnd:f,nearReachStart:v,nearReachEnd:S,init:()=>{n.current&&n.current.dispatchEvent(new Event("scroll"))}}}function Gl({scrollableRef:n,distanceFromStart:i=1,distanceFromEnd:o=1,scrollThresholdStart:s=10,scrollThresholdEnd:a=10,direction:c="vertical",distanceFromStartPx:p,distanceFromEndPx:d,init:r}={},l,h){if(!l)return;const m=c==="vertical",f=B(null),y=B(null),v=pa(()=>{let k=!1,S=!1,b=!1,g=!1;const C=n.current,{scrollTop:w,scrollLeft:I,scrollHeight:_,scrollWidth:T,clientHeight:L,clientWidth:M}=C,K=m?w:I,F=m?_:T,q=m?L:M,X=Math.abs(K-f.current),Q=p||Math.min(q*i,F,K),j=d||Math.min(q*o,F,F-K-q);X>=(f.current<K?a:s)&&(y.current=f.current<K?"end":"start",f.current=K),k=K<=0,S=K+q>=F,b=K<=Q,g=K+q>=F-j,l({scrollDirection:y.current,reachStart:k,reachEnd:S,nearReachStart:b,nearReachEnd:g})},500);return kt(()=>{const k=n.current;return k?(f.current=k[m?"scrollTop":"scrollLeft"],k.addEventListener("scroll",v,{passive:!0}),()=>k.removeEventListener("scroll",v)):{}},[i,o,s,a,...h]),G(()=>{r&&n.current&&queueMicrotask(()=>{n.current.dispatchEvent(new Event("scroll"))})},[r]),{resetScrollDirection:()=>{y.current=null}}}function Wl({class:n,statusID:i,status:o,instance:s,parent:a,onMediaClick:c}){const{_:p}=ce();let d=ct(i,s);const r=Ge(E);if(o||(o=r.statuses[d]||r.statuses[i],d=ct(o?.id,s)),!o)return null;const{account:{acct:l,avatar:h,avatarStatic:m,id:f,url:y,displayName:v,username:k,emojis:S,bot:b,group:g},id:C,repliesCount:w,reblogged:I,reblogsCount:_,favourited:T,favouritesCount:L,bookmarked:M,poll:K,muted:F,sensitive:q,spoilerText:X,visibility:Q,language:j,editedAt:V,filtered:H,card:pe,createdAt:$,inReplyToId:ie,inReplyToAccountId:Y,content:ee,mentions:he,mediaAttachments:le,reblog:J,uri:Ae,url:ye,emojis:ve,_deleted:Pe,_pinned:_e}=o;if(!le?.length)return null;const Te=be=>{be.shiftKey},xe=Se(()=>yt(),[]),De=Se(()=>xe&&xe===f,[f,xe]),Oe=Yo(Hn),Ue=!De&&Zt(H,Oe);if(Ue?.action==="hide")return null;const oe=q,Ce=(vi()["reading:expand:media"]?.toLowerCase()||"default")==="show_all",z=a||"div";return le.map((be,Le)=>{const Ne=`${d}-${be.id}`,O=Ue?.titlesStr;return e(z,{"data-state-post-id":d,onMouseEnter:Te,"data-spoiler-text":X||(q?p({id:"FKojeB"}):void 0),"data-filtered-text":Ue?p(O?{id:"7FGvtQ",values:{filterTitleStr:O}}:{id:"03Qqf9"}):void 0,class:`
          media-post
          ${Ue?"filtered":""}
          ${oe?"has-spoiler":""}
          ${Ce?"show-media":""}
        `,children:e(Ks,{class:n,media:be,lang:j,to:`/${s}/s/${C}?media-only=${Le+1}`,onClick:c?ke=>c(ke,Le,be,o):void 0})},Ne)})}const fs=rt(Wl);function Zl(n){const{_:i}=ce(),o=Ge(E),{masto:s,instance:a,authenticated:c}=se(),[p,d]=Se(()=>{const C=yi();return[C.find(I=>I.info.id===yt())||C[0],C.length>1]},[]),r=(o.settings.shortcutsViewMode==="multi-column"||!o.settings.shortcutsViewMode&&o.settings.shortcutsColumnsMode)&&!o.shortcuts.find(C=>C.type==="following"),l=Ds(()=>{E.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),h=B(),[m,f]=R(void 0),y=zs([0,0,o.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),v=B();async function k(C){return(C||!v.current)&&(v.current=s.v1.mutes.list({limit:80}).values()),await v.current.next()}const S=B();async function b(C){return(C||!S.current)&&(S.current=s.v1.blocks.list({limit:80}).values()),await S.current.next()}const g=B();return e(P,{children:[e("button",{ref:h,type:"button",class:`button plain nav-menu-button ${d?"with-avatar":""} ${m==="open"?"active":""}`,style:{position:"relative"},onClick:()=>{g.current=Date.now(),f(C=>C?void 0:"open")},onContextMenu:C=>{C.preventDefault(),E.showAccounts=!0},...l(),children:[d&&e(pt,{url:p?.info?.avatar||p?.info?.avatarStatic,size:"l",squircle:p?.info?.bot}),e(A,{icon:"menu",size:d?"s":"l",alt:i({id:"zucql+"})})]}),e(Ii,{menuClassName:"nav-menu",state:m,anchorRef:h,onClose:()=>{f(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-g.current<300}},portal:{target:document.body},...n,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:y,unmountOnClose:!0,children:[!!o.appVersion?.commitHash&&o.appVersion.commitHash!=="ac2004e"&&e("div",{class:"top-menu",children:[e(ge,{onClick:()=>{confirm(i({id:"Djbaby"}))&&(async()=>{try{location.reload()}catch{}})()},children:[e(A,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:e(u,{id:"95IFnD"})})]}),e(Ye,{})]}),e("section",{children:[e(He,{to:"/",children:[e(A,{icon:"home",size:"l"})," ",e("span",{children:e(u,{id:"i0qMbr"})})]}),c?e(P,{children:[r&&e(He,{to:"/following",children:[e(A,{icon:"following",size:"l"})," ",e("span",{children:e(u,{id:"following.title"})})]}),e(He,{to:"/catchup",children:[e(A,{icon:"history2",size:"l"}),e("span",{children:e(u,{id:"xrl8fj"})})]}),Xe("@mastodon/mentions")&&e(He,{to:"/mentions",children:[e(A,{icon:"at",size:"l"})," ",e("span",{children:e(u,{id:"/bZzdR"})})]}),e(He,{to:"/notifications",children:[e(A,{icon:"notification",size:"l"})," ",e("span",{children:e(u,{id:"iDNBZe"})}),o.notificationsShowNew&&e("sup",{title:i({id:"isRobC"}),style:{opacity:.5},children:[" ","•"]})]}),e(Ye,{}),p?.info?.id&&e(He,{to:`/${a}/a/${p.info.id}`,children:[e(A,{icon:"user",size:"l"})," ",e("span",{children:e(u,{id:"vERlcd"})})]}),e(Xl,{menuState:m}),e(He,{to:"/b",children:[e(A,{icon:"bookmark",size:"l"})," ",e("span",{children:e(u,{id:"7Ff7ia"})})]}),e(hn,{menuClassName:"nav-submenu",overflow:"auto",gap:-8,label:e(P,{children:[e(A,{icon:"more",size:"l"}),e("span",{class:"menu-grow",children:e(u,{id:"24misb"})}),e(A,{icon:"chevron-right"})]}),children:[e(He,{to:"/f",children:[e(A,{icon:"heart",size:"l"})," ",e("span",{children:e(u,{id:"zZOZj7"})})]}),e(He,{to:"/fh",children:[e(A,{icon:"hashtag",size:"l"})," ",e("span",{children:e(u,{id:"Xi1/bw"})})]}),e(He,{to:"/sp",children:[e(A,{icon:"schedule",size:"l"})," ",e("span",{children:e(u,{id:"+GkIdc"})})]}),e(Ye,{}),Xe("@mastodon/filters")&&e(He,{to:"/ft",children:[e(A,{icon:"filters",size:"l"})," ",e("span",{children:e(u,{id:"cSev+j"})})]}),e(ge,{onClick:()=>{E.showGenericAccounts={id:"mute",heading:i({id:"sOKhEA"}),fetchAccounts:k,excludeRelationshipAttrs:["muting"]}},children:[e(A,{icon:"mute",size:"l"})," ",e("span",{children:e(u,{id:"n1sANU"})})]}),e(ge,{onClick:()=>{E.showGenericAccounts={id:"block",heading:i({id:"nL8nlr"}),fetchAccounts:b,excludeRelationshipAttrs:["blocking"]}},children:[e(A,{icon:"block",size:"l"})," ",e("span",{children:e(u,{id:"r3RRWo"})})]})," "]}),e(Ye,{}),e(ge,{onClick:()=>{E.showAccounts=!0},children:[e(A,{icon:"group",size:"l"})," ",e("span",{children:e(u,{id:"7e0O8Z"})})]})]}):e(P,{children:[e(Ye,{}),e(He,{to:"/login",children:[e(A,{icon:"user",size:"l"})," ",e("span",{children:e(u,{id:"sQia9P"})})]})]})]}),e("section",{children:[e(Ye,{}),e(He,{to:"/search",children:[e(A,{icon:"search",size:"l"})," ",e("span",{children:e(u,{id:"A1taO8"})})]}),e(He,{to:`/${a}/trending`,children:[e(A,{icon:"chart",size:"l"})," ",e("span",{children:e(u,{id:"4/iCqx"})})]}),e(He,{to:`/${a}/p/l`,children:[e(A,{icon:"building",size:"l"})," ",e("span",{children:e(u,{id:"d5zxa4"})})]}),e(He,{to:`/${a}/p`,children:[e(A,{icon:"earth",size:"l"})," ",e("span",{children:e(u,{id:"4ERYY7"})})]}),c?e(P,{children:[e(Ye,{className:"divider-grow"}),e(ge,{onClick:()=>{E.showKeyboardShortcutsHelp=!0},children:[e(A,{icon:"keyboard",size:"l"})," ",e("span",{children:e(u,{id:"77Emn0"})})]}),e(ge,{onClick:()=>{E.showShortcutsSettings=!0},children:[e(A,{icon:"shortcut",size:"l"})," ",e("span",{children:e(u,{id:"8Kudkr"})})]}),e(ge,{onClick:()=>{E.showSettings=!0},children:[e(A,{icon:"gear",size:"l"})," ",e("span",{children:e(u,{id:"uVbUP8"})})]})]}):e(P,{children:[e(Ye,{}),e(ge,{onClick:()=>{E.showSettings=!0},children:[e(A,{icon:"gear",size:"l"})," ",e("span",{children:e(u,{id:"uVbUP8"})})]})]})]})]})]})}function Xl({menuState:n}){const i=Xe("@mastodon/lists"),[o,s]=R([]);return G(()=>{i&&n==="open"&&pn().then(s)},[n,i]),o.length>0?e(hn,{menuClassName:"nav-submenu",overflow:"auto",gap:-8,label:e(P,{children:[e(A,{icon:"list",size:"l"}),e("span",{class:"menu-grow",children:e(u,{id:"h16FyT"})}),e(A,{icon:"chevron-right"})]}),children:[e(He,{to:"/l",children:e("span",{children:e(u,{id:"BHWx+g"})})}),o?.length>0&&e(P,{children:[e(Ye,{}),o.map(a=>e(He,{to:`/l/${a.id}`,children:e("span",{children:[a.title,a.exclusive&&e(P,{children:[" ",e(Kt,{})]})]})},a.id))]})]}):i&&e(He,{to:"/l",children:[e(A,{icon:"list",size:"l"}),e("span",{children:e(u,{id:"h16FyT"})})]})}const Dt=rt(Zl),yn={block:"start",inline:"center",behavior:"smooth"};function Et({title:n,titleComponent:i,id:o,instance:s,emptyText:a,errorText:c,useItemID:p,boostsCarousel:d,fetchItems:r=()=>{},checkForUpdates:l=()=>{},checkForUpdatesInterval:h=15e3,headerStart:m,headerEnd:f,timelineStart:y,refresh:v,view:k,filterContext:S,showFollowedTags:b,showReplyParent:g,clearWhenRefresh:C}){const{_:w}=ce(),I=Ge(E),[_,T]=R([]),[L,M]=R("start"),[K,F]=R(!1),[q,X]=R(!1),[Q,j]=R(!0),V=B();__BENCHMARK.start(`timeline-${o}-load`);const H=Se(()=>ki(),[]),pe=k!=="media",$=B(0),ie=fa(oe=>{X(!1),M("loading"),(async()=>{try{const Re=$.current=Date.now();let{done:$e,value:Ce}=await r(oe);if(Re!==$.current)return;if(Array.isArray(Ce)){const[z,be]=Ce.reduce((Le,Ne)=>(Ne._pinned?Le[0].push(Ne):Le[1].push(Ne),Le),[[],[]]);Ce=be,pe&&(d&&(Ce=Kl(Ce)),Ce=Hl(Ce,s)),z.length&&(Ce=z.concat(Ce)),T(oe?Ce:Le=>[...Le,...Ce]),Ce.length||($e=!0),F(!$e)}else F(!1);M("default"),__BENCHMARK.end(`timeline-${o}-load`)}catch{M("error"),oe&&!_.length&&c&&re(c)}finally{ie.cancel()}})()},1e3,{leading:!0}),Y=".timeline-item, .timeline-item-alt",ee=Ke("j, shift+j",(oe,Re)=>{if(oe.shiftKey!==Re.shift)return;const $e=document.activeElement.closest(Y),Ce=$e?.getBoundingClientRect(),z=Array.from(V.current.querySelectorAll(Y)).filter(be=>!!be.offsetHeight);if($e&&Ce.top<V.current.clientHeight&&Ce.bottom>0){const be=z.indexOf($e);let Le=z[be+1];Re.shift&&(Le=z.find((Ne,O)=>O>be&&!Ne.classList.contains("timeline-item-alt"))),Le&&(Le.focus(),Le.scrollIntoView(yn))}else{const be=z.find(Le=>{const Ne=Le.getBoundingClientRect();return Ne.top>=44&&Ne.left>=0});be&&(be.focus(),be.scrollIntoView(yn))}},{useKey:!0,ignoreEventWhen:oe=>oe.metaKey||oe.ctrlKey||oe.altKey}),he=Ke("k, shift+k",(oe,Re)=>{if(oe.shiftKey!==Re.shift)return;const $e=document.activeElement.closest(Y),Ce=$e?.getBoundingClientRect(),z=Array.from(V.current.querySelectorAll(Y)).filter(be=>!!be.offsetHeight);if($e&&Ce.top<V.current.clientHeight&&Ce.bottom>0){const be=z.indexOf($e);let Le=z[be-1];Re.shift&&(Le=z.findLast((Ne,O)=>O<be&&!Ne.classList.contains("timeline-item-alt"))),Le&&(Le.focus(),Le.scrollIntoView(yn))}else{const be=z.find(Le=>{const Ne=Le.getBoundingClientRect();return Ne.top>=44&&Ne.left>=0});be&&(be.focus(),be.scrollIntoView(yn))}},{useKey:!0,ignoreEventWhen:oe=>oe.metaKey||oe.ctrlKey||oe.altKey}),le=Ke(["enter","o"],()=>{const oe=document.activeElement;oe?.matches(Y)&&oe.click()},{useKey:!0,ignoreEventWhen:oe=>oe.metaKey||oe.ctrlKey||oe.altKey||oe.shiftKey}),J=_.length>0&&L!=="loading"&&q,Ae=nt(()=>{J&&ie(!0),V.current?.scrollTo({top:0,behavior:"smooth"})},[ie,J]),ye=Ke(".",Ae,{useKey:!0,ignoreEventWhen:oe=>oe.metaKey||oe.ctrlKey||oe.altKey||oe.shiftKey}),ve=B(),[Pe,_e]=R(!1),{resetScrollDirection:Te}=Gl({scrollableRef:V,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:oe,nearReachStart:Re,reachStart:$e})=>{if(ve.current){const Ce=oe==="end"&&!Re;ve.current.hidden=Ce}_e(Re),$e&&ie(!0)},[]);G(()=>{V.current?.scrollTo({top:0}),ie(!0)},[]);const xe=B(!0);G(()=>{if(xe.current){xe.current=!1;return}C&&_?.length&&(ie.cancel?.(),T([])),ie(!0)},[C,v]);const De=B(k);G(()=>{De.current!==k&&(De.current=k,T([]))},[k]);const Oe=nt(async({disableIdleCheck:oe=!1}={})=>{const Re=V.current?getComputedStyle(V.current).pointerEvents==="none":!1;I.settings.autoRefresh&&V.current.scrollTop<16&&(oe||window.__IDLE__)&&!tr()&&!Re?ie(!0):await l()&&X(!0)},[o,ie,l,I.settings.autoRefresh]),Ue=B();return Xt(oe=>{if(oe){const Re=Date.now()-Ue.current;(!Ue.current||Re>1e3*3)&&Oe({disableIdleCheck:!0})}else Ue.current=Date.now();j(oe)},[l,Oe,I.settings.autoRefresh]),Ai(Oe,Q&&!q?h*(Pe?1:2):null),e(Hn.Provider,{value:S,children:e("div",{id:`${o}-page`,class:`deck-container ${H?"deck-container-media-first":""}`,ref:oe=>{V.current=oe,ee.current=oe,he.current=oe,le.current=oe,ye.current=oe},tabIndex:"-1",onClick:oe=>{ve.current&&oe.target.closest(".timeline-item, .timeline-item-alt")&&setTimeout(()=>{ve.current.hidden=!1,Te()},250)},children:e("div",{class:"timeline-deck deck",children:[e("header",{ref:ve,onClick:oe=>{oe.target.closest("a, button")||V.current?.scrollTo({top:0,behavior:"smooth"})},onDblClick:oe=>{oe.target.closest("a, button")||ie(!0)},class:L==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(Dt,{}),m??e(fe,{to:"/",class:"button plain home-button",children:e(A,{icon:"home",size:"l",alt:w({id:"i0qMbr"})})})]}),n&&(i||e("h1",{children:n})),e("div",{class:"header-side",children:!!f&&f})]}),J&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:Ae,children:[e(A,{icon:"arrow-up"})," ",e(u,{id:"2yr1/p"})]})]}),!!y&&e("div",{class:`timeline-start ${L==="loading"?"loading":""}`,children:y}),_.length?e(P,{children:[e("ul",{class:`timeline ${k?`timeline-${k}`:""}`,children:[_.map(oe=>e(Jl,{status:oe,instance:s,useItemID:p,filterContext:S,view:k,showFollowedTags:b,showReplyParent:g,mediaFirst:H},oe.id+oe?._pinned+k)),K&&L==="loading"&&(k==="media"?null:e(P,{children:[e("li",{style:{height:"20vh"},children:e(je,{skeleton:!0,mediaFirst:H})}),e("li",{style:{height:"25vh"},children:e(je,{skeleton:!0,mediaFirst:H})})]}))]}),L==="default"&&(K?e(Tt,{root:V.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:oe=>{oe&&ie()},children:e("button",{type:"button",class:"plain block",onClick:()=>ie(),style:{marginBlockEnd:"6em"},children:e(u,{id:"uXRAkV"})})}):e("p",{class:"ui-state insignificant",children:e(u,{id:"2EYeAZ"})}))]}):L==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((oe,Re)=>k==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e(je,{skeleton:!0,mediaFirst:H})},Re))}):L!=="error"&&L!=="start"&&e("p",{class:"ui-state",children:a}),L==="error"&&e("p",{class:"ui-state",children:[c,e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>ie(!_.length),children:e(u,{id:"KDw4GX"})})]})]})})})}const Jl=rt(({status:n,instance:i,useItemID:o,filterContext:s,view:a,showFollowedTags:c,showReplyParent:p,mediaFirst:d})=>{const{_:r}=ce(),{id:l,reblog:h,items:m,type:f,_pinned:y}=n;y&&(o=!1);const v=h?.id||l,k=i?`/${i}/s/${v}`:`/s/${v}`;if(m){let b=Bt(m,s),g="";if(f==="boosts"?g=ue._({id:"NuqppG",values:{0:b.length}}):f==="pinned"&&(g=r({id:"GlfmCu"})),f==="boosts"||f==="pinned"){const I=new Set;if(b.sort((_,T)=>{const L=Zt(_.filtered,s),M=Zt(T.filtered,s);return L&&L?.action!=="blur"&&I.add(_.id),M&&M?.action!=="blur"&&I.add(T.id),L&&!M?1:!L&&M?-1:0}),I.size>=2){const T=[],L=[];b.forEach(K=>{I.has(K.id)?L.push(K):T.push(K)});const M=[];for(let K=0;K<L.length;K+=5)M.push({_grouped:!0,posts:L.slice(K,K+5)});b=T.concat(M)}return e("li",{class:"timeline-item-carousel",children:e(Ql,{title:g,class:`${f}-carousel`,children:b.map(_=>{const{id:T,reblog:L,_pinned:M,_grouped:K}=_;if(K)return e("li",{class:"timeline-item-carousel-group",children:_.posts.map(X=>{const{id:Q,reblog:j,_pinned:V}=X,H=j?.id||Q,pe=i?`/${i}/s/${H}`:`/s/${H}`;return V&&(o=!1),e(fe,{class:"status-carousel-link timeline-item-alt",to:pe,children:o?e(je,{statusID:Q,instance:i,size:"s"}):e(je,{status:X,instance:i,size:"s"})})})},T);const F=L?.id||T,q=i?`/${i}/s/${F}`:`/s/${F}`;return M&&(o=!1),e("li",{children:e(fe,{class:"status-carousel-link timeline-item-alt",to:q,children:o?e(je,{statusID:T,instance:i,size:"s",contentTextWeight:!0,enableCommentHint:!0,mediaFirst:d}):e(je,{status:_,instance:i,size:"s",contentTextWeight:!0,enableCommentHint:!0,mediaFirst:d})})},T)})})},`timeline-${l}`)}const w=b.length>3;return b.map((I,_)=>{const{id:T,_differentAuthor:L}=I,M=i?`/${i}/s/${T}`:`/s/${T}`,K=_>0&&_<b.length-1,F=I.sensitive&&!!I.spoilerText,q=!L&&F&&_>0||w&&K&&(f==="thread"||f==="conversation"&&!L&&!b[_-1]._differentAuthor&&!b[_+1]._differentAuthor),X=_===0,Q=_===b.length-1;return e("li",{class:`timeline-item-container timeline-item-container-type-${f} timeline-item-container-${X?"start":Q?"end":"middle"} ${L?"timeline-item-diff-author":""}`,children:e(fe,{class:"status-link timeline-item",to:M,children:q?e(er,{status:I,instance:i,filterContext:s}):o?e(je,{statusID:T,instance:i,enableCommentHint:Q,showFollowedTags:c}):e(je,{status:I,instance:i,enableCommentHint:Q,showFollowedTags:c})})},`timeline-${T}`)})}const S=`timeline-${l+y}`;return a==="media"?o?e(fs,{class:"timeline-item",parent:"li",statusID:l,instance:i},S):e(fs,{class:"timeline-item",parent:"li",status:n,instance:i},S):e("li",{children:e(fe,{class:"status-link timeline-item",to:k,children:o?e(je,{statusID:l,instance:i,enableCommentHint:!0,showFollowedTags:c,showReplyParent:p,mediaFirst:d}):e(je,{status:n,instance:i,enableCommentHint:!0,showFollowedTags:c,showReplyParent:p,mediaFirst:d})})},S)},(n,i)=>{const o=(n.status?.id||"").toString(),s=(i.status?.id||"").toString();return o===s&&n.instance===i.instance&&n.view===i.view});function Ql({title:n,class:i,children:o}){const{_:s}=ce(),a=B(),c=B(),p=B(),[d,r]=R(!1);return G(()=>{setTimeout(()=>{r(!0)},1)},[]),e("div",{class:`status-carousel ${i}`,children:[e("header",{children:[e("h3",{children:n}),e("span",{children:[e("button",{ref:c,type:"button",class:"small plain2",onClick:()=>{const l=Math.min(320,a.current?.offsetWidth)*(Ft()?1:-1);a.current?.scrollBy({left:l,behavior:"smooth"})},children:e(A,{icon:"chevron-left",alt:s({id:"DHhJ7s"})})})," ",e("button",{ref:p,type:"button",class:"small plain2",onClick:()=>{const l=Math.min(320,a.current?.offsetWidth)*(Ft()?-1:1);a.current?.scrollBy({left:l,behavior:"smooth"})},children:e(A,{icon:"chevron-right",alt:s({id:"hXzOVo"})})})]})]}),e("ul",{ref:a,children:[e(Tt,{class:"status-carousel-beacon",onChange:l=>{c.current&&(c.current.disabled=l)}}),o[0],d&&o.slice(1),e(Tt,{class:"status-carousel-beacon",onChange:l=>{p.current&&(p.current.disabled=l)}})]})]})}function er({status:n,instance:i,filterContext:o}){const{_:s}=ce(),a=Ge(E),{id:c,visibility:p,language:d}=n,r=qn(n),l=ct(c,i),h=Zt(n.filtered,o);return e("article",{class:`status compact-thread ${p==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[e("div",{class:"status-thread-badge-container",children:e(ma,{index:a.statusThreadNumber[l]})}),e("div",{class:"content-compact",title:r,lang:d,dir:"auto",children:h&&h?.action!=="blur"?e("b",{class:"status-filtered-badge badge-meta horizontal",title:h?.titlesStr||"",children:h?.titlesStr?e(u,{id:"sr6maL",values:{0:h.titlesStr},components:{0:e("span",{}),1:e("span",{})}}):e("span",{children:e(u,{id:"03Qqf9"})})}):e(P,{children:[r,n.sensitive&&n.spoilerText&&e(P,{children:[" ",e("span",{class:"spoiler-badge",children:e(A,{icon:"eye-close",size:"s",alt:s({id:"gnKo7f"})})})]})]})})]})}function tr(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const Vt=20,Bi=1983,ms=`${Bi}-01`,nr=_i(()=>{try{const n=document.createElement("input");return n.setAttribute("type","month"),n.type==="month"}catch{return!1}});async function ir(n){const{masto:i}=se({instance:n});return!!(await i.v2.search.list({q:"from:me",type:"statuses",limit:1}))?.statuses?.length}const sr=vt(ir);function or(){const{i18n:n,_:i}=ce(),o=Ge(E),{id:s,...a}=Pt(),[c,p]=bt(),d=c.get("month"),r=!c.get("replies"),l=!!c.get("boosts"),h=c.get("tagged"),m=!!c.get("media"),{masto:f,instance:y,authenticated:v}=se({instance:a.instance}),{masto:k,instance:S}=se(),b=B(),g=[d,r,l,h,m],[C,w]=R(),I=B(0);G(()=>{I.current=0},g);const _=Se(()=>ki(),[]),T=Se(()=>y===S,[y,S]),[L,M]=R(!1);G(()=>{T&&C?.acct&&(async()=>{const le=await sr(y);M(le)})()},[y,T,C?.acct]);async function K(le){const J=/^\d{4}-[01]\d$/.test(d),Ae=d?.split?.("-")?.[0]>=Bi;if(J&&Ae){if(!C)return{value:[],done:!0};const[_e,Te]=d.split("-"),xe=parseInt(Te,10)-1,De=new Date(_e,xe,0),Oe=`${De.getFullYear()}-${(De.getMonth()+1).toString().padStart(2,"0")}-${De.getDate().toString().padStart(2,"0")}`,Ue=new Date(_e,xe+1,1),oe=`${Ue.getFullYear()}-${(Ue.getMonth()+1).toString().padStart(2,"0")}-${Ue.getDate().toString().padStart(2,"0")}`;let Re;le?(Re=Vt+1,I.current=0):(Re=Vt+I.current+1,I.current+=Vt);const $e=await f.v2.search.list({q:`from:${C.acct} after:${Oe} before:${oe}`,type:"statuses",limit:Re,offset:I.current});if($e?.statuses?.length){const Ce=$e.statuses.slice(0,Vt);Ce.forEach(be=>{Je(be,y)});const z=$e.statuses.length<=Vt;return{value:Ce,done:z}}else return{value:[],done:!0}}let ye=[];if(le){const{value:_e}=await f.v1.accounts.$select(s).statuses.list({pinned:!0}).values().next();if(_e?.length&&!h&&!m){const Te=_e.map(xe=>(Je(xe,y),{...xe,_pinned:!0}));if(Te.length>=3){const xe=Te.map(De=>De.id);ye.push({id:xe,items:Te,type:"pinned"})}else ye.push(...Te)}}(le||!b.current)&&(b.current=f.v1.accounts.$select(s).statuses.list({limit:Vt,exclude_replies:r,exclude_reblogs:l,only_media:m||void 0,tagged:h}).values());const{value:ve,done:Pe}=await b.current.next();if(ve?.length){if(!Xe("@mastodon/pinned-posts")&&ye.length){let _e=[];ye[0]?.type==="pinned"?_e=ye[0].id:_e=ye.filter(xe=>xe._pinned).map(xe=>xe.id),_e.every(xe=>ve.some(De=>De.id===xe))&&(ye=[])}ye.push(...ve),ve.forEach(_e=>{Je(_e,y)})}return{value:ye,done:Pe}}const[F,q]=R([]);let X=i({id:"/cKnpj"});if(C?.acct){const le=(/@/.test(C.acct)?"":"@")+C.acct,J=C?.displayName?`${C.displayName} (${le})`:`${le}`;if(!r)X=i({id:"hS1Opy",values:{accountDisplay:J}});else if(l)X=i({id:"A/CX5F",values:{accountDisplay:J}});else if(h)X=i({id:"QQrO94",values:{accountDisplay:J,tagged:h}});else if(m)X=i({id:"NoG5wD",values:{accountDisplay:J}});else if(d){const Ae=new Date(d).toLocaleString(n.locale,{month:"long",year:"numeric"});X=i({id:"8GjLvB",values:{accountDisplay:J,monthYear:Ae}})}else X=J}Qe(X,"/:instance?/a/:id");const Q=nt(()=>lr(s,f),[s,f]);G(()=>{(async()=>{try{const le=await Q();w(le)}catch{}if(!_)try{const le=await f.v1.accounts.$select(s).featuredTags.list();q(le)}catch{}})()},[s,_]);const{displayName:j,acct:V,emojis:H}=C||{},pe=Se(()=>C?.id===yt(),[C?.id]),$=B(),ie=Se(()=>{const le=!r||l||h||m||!!d,J=o.accounts[`${s}@${y}`];return e(P,{children:[e(ao,{instance:y,account:J||s,fetchAccount:Q,authenticated:v,standalone:!0,showEndorsements:!0}),!_&&e("div",{class:"filter-bar",ref:$,style:{position:"relative"},children:[le?e(fe,{to:`/${y}/a/${s}`,class:"insignificant filter-clear",title:i({id:"u8JHrO"}),children:e(A,{icon:"x",size:"l",alt:i({id:"xCJdfg"})})},"clear-filters"):e(A,{icon:"filter",class:"insignificant",size:"l",alt:i({id:"cSev+j"})}),e(fe,{to:`/${y}/a/${s}${r?"?replies=1":""}`,onClick:()=>{r&&re(i({id:"PIWNSQ"}))},class:r?"":"is-active",children:e(u,{id:"5BFynH"})}),e(fe,{to:`/${y}/a/${s}${l?"":"?boosts=0"}`,onClick:()=>{l||re(i({id:"Qd13i0"}))},class:l?"is-active":"",children:e(u,{id:"usxQx0"})}),e(fe,{to:`/${y}/a/${s}${m?"":"?media=1"}`,onClick:()=>{m||re(i({id:"rKpfPY"}))},class:m?"is-active":"",children:e(u,{id:"xYilR2"})}),F.map(Ae=>e(fe,{to:`/${y}/a/${s}${h===Ae.name?"":`?tagged=${encodeURIComponent(Ae.name)}`}`,onClick:()=>{h!==Ae.name&&re(i({id:"L+HFfr",values:{0:Ae.name}}))},class:h===Ae.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),Ae.name]})},Ae.id)),L&&(nr()?e("label",{class:`filter-field ${d?"is-active":""}`,children:[e(A,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!C?.acct,value:d||"",min:ms,max:new Date().toISOString().slice(0,7),onInput:Ae=>{const{value:ye,validity:ve}=Ae.currentTarget;if(!ve.valid)return;p(ye?{month:ye}:{});const[Pe,_e]=ye.split("-"),Te=parseInt(_e,10)-1,xe=new Date(Pe,Te);re(i({id:"0WUFGD",values:{0:xe.toLocaleString(n.locale,{month:"long",year:"numeric"})}}))}})]}):e(ar,{class:`filter-field ${d?"is-active":""}`,disabled:!C?.acct,value:d||"",min:ms,max:new Date().toISOString().slice(0,7),onInput:Ae=>{const{value:ye,validity:ve}=Ae;ve.valid&&p(ye?{month:ye}:{})}}))]})]})},[s,y,v,F,Q,L,...g]);G(()=>{const le=$.current?.querySelector(".is-active");le&&$.current.scrollTo({behavior:"smooth",left:le.offsetLeft-($.current.offsetWidth-le.offsetWidth)/2})},[F,L,...g]);const Y=Se(()=>C?.url?URL.parse(C.url)?.hostname:null,[C]),he=!!C&&!(y===Y);return e(P,{children:[e(Et,{title:`${C?.acct?"@"+C.acct:i({id:"+owNNn"})}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(qs,{text:j,emojis:H})}),e("div",{children:e("span",{class:"bidi-isolate",children:["@",V]})})]}),id:"account-statuses",instance:y,emptyText:i({id:"+k97fV"}),errorText:i({id:"scd9lw"}),fetchItems:K,useItemID:!0,view:m||_?"media":void 0,boostsCarousel:o.settings.boostsCarousel,timelineStart:ie,refresh:[r,l,h,m,d+C?.acct].toString(),headerEnd:e(lt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(A,{icon:"more",size:"l",alt:i({id:"2FYpfJ"})})}),children:[e(ge,{disabled:!he,onClick:()=>{(async()=>{try{const{masto:le}=se({instance:Y}),J=await le.v1.accounts.lookup({acct:C.acct}),{id:Ae}=J;location.hash=`/${Y}/a/${Ae}`}catch{alert(i({id:"FgdLx0"}))}})()},children:[e(A,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:e(u,{id:"/JFxxT",values:{0:Y?e(P,{children:[" ","(",e("b",{children:Bn.toUnicode(Y)}),")"]}):null}})})]}),!T&&e(ge,{onClick:()=>{(async()=>{try{const le=await k.v1.accounts.lookup({acct:C.acct+"@"+y}),{id:J}=le;location.hash=`/${S}/a/${J}`}catch{alert(i({id:"FgdLx0"}))}})()},children:[e(A,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:e(u,{id:"HkuyOu",values:{currentInstance:S},components:{0:e("b",{})}})})]})]})},s),V&&!pe&&e("data",{class:"compose-data",value:JSON.stringify({draftStatus:{status:`@${V} `}})})]})}function ar(n){const{i18n:i}=ce(),{class:o,disabled:s,value:a,min:c,max:p,onInput:d=()=>{}}=n,[r,l]=a?.split("-")||[],h=B(),m=B(),f=(y,v)=>{const[k,S]=c?.split("-")||[],[b,g]=p?.split("-")||[];return!(v<k||v>b||v===k&&y<S||v===b&&y>g)};return e("div",{class:o,children:[e(A,{icon:"month",size:"l"}),e("select",{ref:h,disabled:s,value:l||"",onInput:y=>{const{value:v}=y.currentTarget,k=m.current.value;if(!f(v,k))return{value:"",validity:{valid:!1}};d({value:v?`${k}-${v}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:e(u,{id:"HajiZl"})}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(y,v)=>e("option",{value:(v+1).toString().padStart(2,"0"),children:new Date(0,v).toLocaleString(i.locale,{month:"long"})},v))]})," ",e("input",{ref:m,type:"number",disabled:s,value:r||new Date().getFullYear(),min:c?.slice(0,4)||Bi,max:p?.slice(0,4)||new Date().getFullYear(),onInput:y=>{const{value:v,validity:k}=y.currentTarget,S=h.current.value;if(!k.valid||!f(S,v))return{value:"",validity:{valid:!1}};d({value:v?`${v}-${S}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}function cr(n,i){return i.v1.accounts.$select(n).fetch()}const lr=vt(cr,{maxAge:30*60*1e3});function rr(){const n=Pt(),{year:i}=n;Qe(i?`Annual Report: ${i}`:"Annual Report");const{masto:o,instance:s}=se(),[a,c]=R(null),[p,d]=R("default");G(()=>{i&&(async()=>{d("loading");const y=await o.v1.annualReports.$select(i).fetch();c(y),d("default")})()},[i]);const{accounts:r,annualReports:l,statuses:h}=a||{},m=l?.find(y=>y.year==i)?.data,f=new Date;return e("div",{id:"annual-report-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"report",children:[e("h1",{children:[i," #Wrapstodon"]}),p==="loading"&&e("p",{children:[e(Fe,{abrupt:!0})," ",e(u,{id:"Pwqkdw"})]}),!!m&&e("dl",{children:Object.entries(m).map(([y,v])=>e(P,{children:[e("dt",{children:y}),e("dd",{class:`report-${y}`,children:Array.isArray(v)?e("table",{children:[e("thead",{children:e("tr",{children:Object.entries(v[0]).map(([k,S])=>e("th",{class:k!=="month"&&typeof S=="number"?"number":"",children:k}))})}),e("tbody",{children:v.map(k=>e("tr",{children:Object.entries(k).map(([S,b])=>e("td",{class:S!=="month"&&typeof b=="number"?"number":"",children:b&&/(accountId)/i.test(S)&&/^(mostRebloggedAccounts|commonlyInteractedWithAccounts)$/i.test(y)?e(mt,{account:r?.find(g=>g.id===b),showAvatar:!0}):S==="month"?f.setMonth(b-1)&&f.toLocaleString(void 0,{month:"long"}):typeof b=="number"?b.toLocaleString():b}))}))})]}):typeof v=="object"?/^(topStatuses)$/i.test(y)?e("dl",{children:Object.entries(v).map(([k,S])=>e(P,{children:[e("dt",{children:k}),e("dd",{children:S&&e(fe,{to:`/${s}/s/${S}`,children:e(je,{status:h?.find(b=>b.id===S),size:"s",readOnly:!0})})})]}))}):e("table",{children:e("tbody",{children:Object.entries(v).map(([k,S])=>e("tr",{children:[e("th",{children:k}),e("td",{class:typeof S=="number"?"number":"",children:S})]}))})}):typeof v=="string"?v:JSON.stringify(v,null,2)})]}))})]}),e("hr",{}),e("p",{style:{textAlign:"center"},children:e(fe,{to:"/",children:e(u,{id:"iWpEwy"})})})]})}const dr=20;function fo(){const{_:n}=ce();Qe(n({id:"7Ff7ia"}),"/b");const{masto:i,instance:o}=se(),s=B();async function a(c){return(c||!s.current)&&(s.current=i.v1.bookmarks.list({limit:dr}).values()),await s.current.next()}return e(Et,{title:n({id:"7Ff7ia"}),id:"bookmarks",emptyText:n({id:"8k2w6G"}),errorText:n({id:"UoL+FC"}),instance:o,fetchItems:a})}const ur=""+new URL("catch-up-O5q5C75Z.png",import.meta.url).href,hr="home",dt=[{label:{id:"Ov9hfp"},value:1},{label:{id:"tVE2wM"},value:2},{label:{id:"8+HOWa"},value:3},{label:{id:"1o+mEC"},value:4},{label:{id:"dZZ8oA"},value:5},{label:{id:"lpPucp"},value:6},{label:{id:"r9r5X6"},value:7},{label:{id:"I9uBFA"},value:8},{label:{id:"pBYFlb"},value:9},{label:{id:"wvL7OJ"},value:10},{label:{id:"7Vb+qD"},value:11},{label:{id:"VU1Pnd"},value:12},{label:{id:"vpc27K"},value:13}],pr={original:{id:"HxF6Fk"},replies:{id:"N8UzTV"},boosts:{id:"puY2t0"},quotes:{id:"eWLklq"},followedTags:{id:"lCLRBe"},groups:{id:"zhrjek"},filtered:{id:"03Qqf9"}},fr=["createdAt","repliesCount","favouritesCount","reblogsCount","density"],mr=[null,"account"],gr=_i(n=>new Intl.DateTimeFormat(n||void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}));function Un(n){return n?.id||n?.quotedStatus?.id}function yr(){const{i18n:n,_:i,_:o}=ce(),s=gr(n.locale);Qe("Catch-up","/catchup");const{masto:a,instance:c}=se(),[p,d]=bt(),r=p.get("id"),[l,h]=R("start"),[m,f]=R(!1),y=Se(()=>yt(),[]),v=x=>x===y,k=Xe("@pixelfed/home-include-reblogs");async function S({maxCreatedAt:x}){const U=[],W=a.v1.timelines.home.list({limit:40}),ne=W.values();e:for(;;)try{k&&W.params&&(typeof W.params=="string"?W.params+="&include_reblogs=true":W.params.include_reblogs=!0);const D=await ne.next(),{value:de}=D;if(de?.length){await po(de,c);let Ie=!1;for(let me=0;me<de.length;me++){const Z=de[me],te=Date.parse(Z.createdAt);if(!x||te>=x){const Me=!v(Z.reblog?.account?.id||Z.account.id)&&Zt(Z.reblog?.filtered||Z.filtered,hr);if(Me?.action==="hide")continue;Z._filtered=Me;const Ve=ct(Z.id,c);Z._followedTags=E.statusFollowedTags[Ve]?[...E.statusFollowedTags[Ve]]:[],U.push(Z),Ie=!0}if(!Ie)break e}}else break e;await new Promise(Ie=>setTimeout(Ie,1e3))}catch{break e}return U.forEach(D=>{if(D?.inReplyToId){const de=U.find(Ie=>Ie.id===D.inReplyToId);de&&!de.inReplyToId&&(de._thread=!0)}}),U}const[b,g]=R([]),C=B(),w=B(),I=Se(()=>$n(),[]),_=nt(async({duration:x}={})=>{const U=Date.now(),W=x?U-x:null;h("loading");const ne=await S({maxCreatedAt:W}),D=`${I}-${ga()}`;try{await gt.catchup.set(D,{id:D,posts:ne,count:ne.length,startAt:W,endAt:U}),d({id:D})}catch{}},[]);G(()=>{r?(async()=>{const x=await gt.catchup.get(r);x&&(x.posts.sort((U,W)=>U.createdAt>W.createdAt?1:-1),g(x.posts),h("results"))})():l==="results"&&(g([]),h("start"))},[r]);const[T,L]=xt(x=>x+1,0),[M,K]=R(null),[F,q]=R([]);G(()=>{(async()=>{try{const x=await gt.catchup.keys();if(x.length){const U=$n(),W=x.filter(ne=>ne.startsWith(`${U}-`));if(W.length){let ne=await gt.catchup.getMany(W);ne.sort((me,Z)=>Z.endAt-me.endAt);let D=ne.slice(0,3),de=ne.slice(3);const Ie=D.map(me=>{const{id:Z,count:te,startAt:we,endAt:Me}=me;return{id:Z,count:te,startAt:we,endAt:Me}});q(Ie),K(D[0].endAt),ne=null,D=null,queueMicrotask(()=>{de.length&&gt.catchup.delMany(de.map(me=>me.id)).then(()=>{de=null}).catch(me=>{})});return}}}catch{}q([])})()},[T]),G(()=>{l==="start"&&L()},[l==="start"]);const[X,Q]=Se(()=>{let x=0,U=0,W=0,ne=0,D=0,de=0,Ie=0;const me={};for(const te of b){te._filtered&&te._filtered?.action!=="blur"?(x++,te.__FILTER="filtered"):te.group?(U++,te.__FILTER="groups"):te.reblog?(W++,te.__FILTER="boosts"):Nt()&&Un(te.quote)?(ne++,te.__FILTER="quotes"):te._followedTags?.length?(de++,te.__FILTER="followedTags"):te.inReplyToId&&te.inReplyToAccountId!==te.account?.id?(D++,te.__FILTER="replies"):(Ie++,te.__FILTER="original");const we=te.reblog||te;if(te.__FILTER!=="filtered"&&we.card?.url&&we.card?.image&&we.card?.type==="link"){const{card:Me,favouritesCount:Ve,reblogsCount:ot}=we;let{url:et}=Me;if(et=et.replace(/\/$/,""),!me[et])me[et]={postID:we.id,card:Me,shared:1,sharers:[te.account],likes:Ve,boosts:ot};else{if(me[et].sharers.find(wt=>wt.id===te.account.id))continue;me[et].shared++,me[et].sharers.push(te.account),me[et].postID!==we.id&&(me[et].likes+=Ve,me[et].boosts+=ot)}}}let Z=[];for(const te in me)Z.push({url:te,...me[te]});if(Z.sort((te,we)=>te.shared>we.shared?-1:te.shared<we.shared?1:te.boosts>we.boosts?-1:te.boosts<we.boosts?1:te.likes>we.likes?-1:te.likes<we.likes?1:te.quotes>we.quotes?-1:te.quotes<we.quotes?1:0),Z.length>10)e:for(let te=10;te<Z.length;te++){const{shared:we}=Z[te];if(we<=1){Z=Z.slice(0,te);break e}}return[{filtered:x,groups:U,boosts:W,quotes:ne,replies:D,followedTags:de,original:Ie},Z]},[b]),[j,V]=R("all"),[H,pe]=R(null),[$,ie]=R(1),[Y,ee]=R("createdAt"),[he,le]=R("asc"),[J,Ae]=R(null),[ye,ve,Pe]=Se(()=>{const x={},U=new Map;let W=b.filter(D=>{const de=j==="all"||D.__FILTER===j;return de&&(x[D.account.id]=D.account,U.set(D.account.id,(U.get(D.account.id)||0)+1)),de});const ne={};return W.forEach(D=>{D.reblog&&(ne[D.reblog.id]?(ne[D.reblog.id].__BOOSTERS?ne[D.reblog.id].__BOOSTERS.add(D.account):ne[D.reblog.id].__BOOSTERS=new Set([D.account]),D.__HIDDEN=!0):ne[D.reblog.id]=D)}),H&&U.has(H)&&(W=W.filter(D=>D.account.id===H||[...D.__BOOSTERS||[]].find(de=>de.id===H))),[W,x,Object.fromEntries(U)]},[j,H,b]),_e=Se(()=>{const x={};return ye.forEach(U=>{x[U.id]=U}),x},[ye]),Te=Se(()=>Object.keys(Pe).sort((x,U)=>Pe[U]-Pe[x]),[Pe]),xe=Se(()=>{const x={};return Te.forEach((U,W)=>{x[U]=W}),ye.filter(U=>!U.__HIDDEN).sort((U,W)=>{if(J==="account"){const ne=U.account.id,D=W.account.id,de=x[ne],Ie=x[D],me=de-Ie;if(me!==0)return me}if(Y!=="createdAt"&&(U=U.reblog||U,W=W.reblog||W,Y!=="density"&&U[Y]===W[Y]))return U.createdAt>W.createdAt?1:-1;if(Y==="density"){const ne=gs(U),D=gs(W);return he==="asc"?ne>D?1:-1:D>ne?1:-1}return he==="asc"?U[Y]>W[Y]?1:-1:W[Y]>U[Y]?1:-1})},[ye,Y,he,J,Te]),De=B(null),Oe=B(null),Ue=B(!1);G(()=>{b.length>100||Ue.current||Oe.current&&(Qs(Oe.current,{duration:200}),Ue.current=!0)},[b,Oe]);const oe=b.length>160?"3d":"2d",Re=Se(()=>oe!=="2d"?null:b.map(x=>{const U=_e[x.id];return e("span",{class:`post-dot ${U?"post-dot-highlight":""}`},x.id)}),[_e]),$e=Se(()=>oe!=="3d"||!b?.length?null:Cr(b,"createdAt",320).map((U,W)=>e("div",{class:"posts-bin",children:U.map(ne=>{const D=_e[ne.id];return e("span",{class:`post-dot ${D?"post-dot-highlight":""}`},ne.id)})},W)),[_e]),Ce=B(null),z=Se(()=>M?(Date.now()-M)/1e3/60/60:null,[M,$]);G(()=>{if(l!=="results")return;const x=H&&ve[H]?ve[H].username:"",U=he==="asc"?0:1,W={account:"authors"};let ne=re({duration:5e3,text:o({id:"XKZRZ/",values:{selectedFilterCategory:j,sortBy:Y,sortOrder:he,groupBy:J}})});return()=>{ne?.hideToast?.()}},[l,j,H,Y,he,J,ve]),G(()=>{if(H&&ve[H]){const x=Oe.current.querySelector(`[data-author="${H}"]`),U=Oe.current?.getBoundingClientRect(),W=x?.getBoundingClientRect();W.left<U.left||W.right>U.right?x.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}):W.top<0&&x.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}},[H,ve]);const[be,Le]=R(!1),Ne=".catchup-list > li > a",O=Ke("j",()=>{const x=document.activeElement.closest(Ne),U=x?.getBoundingClientRect(),W=Array.from(Ce.current.querySelectorAll(Ne));if(x&&U.top<Ce.current.clientHeight&&U.bottom>0){const ne=W.indexOf(x),D=W[ne+1];D&&(D.focus(),D.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const ne=W.find(D=>D.getBoundingClientRect().top>=0);ne&&(ne.focus(),ne.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{useKey:!0,preventDefault:!0,ignoreEventWhen:x=>x.metaKey||x.ctrlKey||x.altKey||x.shiftKey}),ke=Ke("k",()=>{const x=document.activeElement.closest(Ne),U=x?.getBoundingClientRect(),W=Array.from(Ce.current.querySelectorAll(Ne));if(x&&U.top<Ce.current.clientHeight&&U.bottom>0){const ne=W.indexOf(x);let D=W[ne-1];D&&(D.focus(),D.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const ne=W.find(D=>{const de=D.getBoundingClientRect();return de.top>=44&&de.left>=0});ne&&(ne.focus(),ne.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{useKey:!0,preventDefault:!0,ignoreEventWhen:x=>x.metaKey||x.ctrlKey||x.altKey||x.shiftKey}),Be=Ke("h, l",(x,U)=>{const W=U.keys[0];if(H){const ne=Te.indexOf(H);W==="h"?ne>0&&ne<Te.length&&(pe(Te[ne-1]),Ce.current?.focus()):W==="l"&&ne<Te.length-1&&ne>=0&&(pe(Te[ne+1]),Ce.current?.focus())}else W==="l"&&(pe(Te[0]),Ce.current?.focus())},{useKey:!0,preventDefault:!0,ignoreEventWhen:x=>x.metaKey||x.ctrlKey||x.altKey||x.shiftKey,enableOnFormTags:["input"]}),ze=Ke("esc",()=>{pe(null),Ce.current?.focus()},{preventDefault:!0,ignoreEventWhen:x=>x.metaKey||x.ctrlKey||x.altKey||x.shiftKey,enableOnFormTags:["input"],useKey:!0}),N=Ke(".",()=>{Ce.current?.scrollTo({top:0,behavior:"smooth"})},{useKey:!0,preventDefault:!0,ignoreEventWhen:x=>x.metaKey||x.ctrlKey||x.altKey||x.shiftKey,enableOnFormTags:["input"]}),ae=nt(x=>{const U=document.activeElement,W=U?.tagName==="INPUT"&&U.type==="radio";if((x.key==="ArrowDown"||x.key==="ArrowUp"||x.key==="ArrowLeft"||x.key==="ArrowRight")&&W){U.blur();return}},[]);return e("div",{ref:x=>{Ce.current=x,O.current=x,ke.current=x,Be.current=x,ze.current=x,N.current=x},id:"catchup-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck wide",children:[e("header",{class:`${l==="loading"?"loading":""}`,onClick:x=>{x.target.closest("a, button")||Ce.current?.scrollTo({top:0,behavior:"smooth"})},children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(Dt,{}),l==="results"&&e(fe,{to:"/catchup",class:"button plain",children:e(A,{icon:"history2",size:"l",alt:o({id:"xrl8fj"})})}),l==="start"&&e(fe,{to:"/",class:"button plain",children:e(A,{icon:"home",size:"l",alt:o({id:"i0qMbr"})})})]}),e("h1",{children:l!=="start"&&e(u,{id:"wyL/3/",components:{0:e("sup",{})}})}),e("div",{class:"header-side",children:l!=="start"&&l!=="loading"&&e("button",{type:"button",class:"plain",onClick:()=>{Le(!0)},children:e(u,{id:"c3XJ18"})})})]})}),e("main",{onKeyDown:ae,children:[l==="start"&&e("div",{class:"catchup-start",children:[e("h1",{children:e(u,{id:"wyL/3/",components:{0:e("sup",{})}})}),e("details",{children:[e("summary",{children:e(u,{id:"CxKPv6"})}),e("p",{children:e(u,{id:"YMU1CK"})}),e("img",{src:ur,width:"1200",height:"900",alt:o({id:"CeInO2"})}),e("p",{children:e("button",{type:"button",onClick:x=>{x.target.closest("details").open=!1},children:e(u,{id:"2jI8hh"})})})]}),e("p",{children:e(u,{id:"1RfGk7"})}),e("p",{children:e("b",{children:e(u,{id:"OOEonE"})})}),e("div",{class:"catchup-form",children:[e("input",{ref:C,type:"range",value:$,min:dt[0].value,max:dt[dt.length-1].value,step:"1",list:"catchup-ranges",onChange:x=>ie(+x.target.value)})," ",e("span",{style:{width:"8em"},children:[i(dt[$-1].label),e("br",{}),e("small",{class:"insignificant",children:$==dt[dt.length-1].value?o({id:"NMNiaO"}):st(new Date(Date.now()-$*60*60*1e3))})]}),e("datalist",{id:"catchup-ranges",children:dt.map(({label:x,value:U})=>e("option",{value:U,label:i(x)}))})," ",e("button",{type:"button",onClick:()=>{if($<dt[dt.length-1].value){let x;$===dt[dt.length-1].value&&w.current?.checked?x=Date.now()-M:x=$*60*60*1e3,_({duration:x})}else _()},children:e(u,{id:"R0yu2l"})})]}),z&&$>z?e("p",{class:"catchup-info",children:[e(A,{icon:"info"})," ",e(u,{id:"AGyV7s"})]}):$===dt[dt.length-1].value&&M?e("p",{class:"catchup-info",children:e("label",{children:[e("input",{type:"checkbox",switch:!0,checked:!0,ref:w})," ",e(u,{id:"dDJEHI",values:{0:s.format(new Date(M))}})]})}):null,e("p",{class:"insignificant",children:e("small",{children:e(u,{id:"EAjFM0"})})}),!!F?.length&&e("div",{class:"catchup-prev",children:[e("p",{children:e(u,{id:"Yfb9A8"})}),e("ul",{children:F.map(x=>e("li",{children:[e(fe,{to:`/catchup?id=${x.id}`,children:[e(A,{icon:"history2"})," ",e("span",{children:x.startAt?s.formatRange(new Date(x.startAt),new Date(x.endAt)):`… – ${s.format(new Date(x.endAt))}`})]})," ",e("span",{children:[e("small",{class:"ib insignificant",children:e(u,{id:"S6XZwv",values:{0:x.count}})})," ",e("button",{type:"button",class:"light danger small",onClick:async()=>{if(confirm(o({id:"D9CmP2"}))){let W=re(o({id:"xJUo4P",values:{0:x.id}}));await gt.catchup.del(x.id),W?.hideToast?.(),re(o({id:"1dyGG/",values:{0:x.id}})),L()}},children:e(A,{icon:"x",alt:o({id:"t/YqKh"})})})]})]},x.id))}),F.length>=3&&e("p",{children:e("small",{children:e(u,{id:"sXmrl4"})})})]})]}),l==="loading"&&e("div",{class:"ui-state catchup-start",children:[e(Fe,{abrupt:!0}),e("p",{class:"insignificant",children:e(u,{id:"rbUTzD"})}),e("p",{class:"insignificant",children:e(u,{id:"q9urQO"})})]}),l==="results"&&e(P,{children:[e("div",{class:"catchup-header",children:[b.length>0&&e("p",{children:e("b",{class:"ib",children:s.formatRange(new Date(b[0].createdAt),new Date(b[b.length-1].createdAt))})}),e("aside",{children:[e("button",{hidden:j==="all"&&!H&&Y==="createdAt"&&he==="asc",type:"button",class:"plain4 small",onClick:()=>{V("all"),pe(null),ee("createdAt"),Ae(null),le("asc")},children:e(u,{id:"I9EnzM"})}),Q?.length>0&&e("button",{type:"button",class:"plain small",onClick:()=>f(!m),children:[e(u,{id:"EIZREX"})," ",e(A,{icon:"chevron-down",style:{transform:m?"rotate(180deg)":"rotate(0deg)"}})]})]})]}),e("div",{class:"shazam-container no-animation",hidden:!m,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"catchup-top-links links-bar",children:Q.map(x=>{const{card:U,shared:W,sharers:ne,likes:D,boosts:de}=x,{blurhash:Ie,title:me,description:Z,url:te,image:we,imageDescription:Me,language:Ve,width:ot,height:et,publishedAt:wt}=U,Rt=wi(te);let fn;if(Ie){const mn=Ti(Ie),gn=Ui(mn);fn=Fi([.6,gn[1],gn[2]])}return e("a",{href:te,target:"_blank",rel:"noopener",class:"link-block",style:fn?{"--accent-color":`rgb(${fn.join(",")})`,"--accent-alpha-color":`rgba(${fn.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:we,alt:Me,width:ot,height:et,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:Rt})," ",!!wt&&e(P,{children:"· "}),!!wt&&e(P,{children:e(_t,{datetime:wt,format:"micro"})})]}),!!me&&e("h1",{class:"title",lang:Ve,dir:"auto",title:me,children:me})]}),!!Z&&e("p",{class:"description",lang:Ve,dir:"auto",title:Z,children:Z}),e("hr",{}),e("p",{style:{whiteSpace:"nowrap"},children:e(u,{id:"bfSr6z",values:{0:ne.map(mn=>{const{avatarStatic:gn,displayName:No}=mn;return e("button",{type:"button",class:"plain",style:{padding:0},onClick:Ki=>{Ki.preventDefault(),Ki.stopPropagation();const{id:Po}=mn;pe(Po),V("all")},children:e(pt,{url:gn,size:"s",alt:No})})})}})})]})]})},te)})})})}),b.length>=5&&(oe==="3d"?e("div",{class:"catchup-posts-viz-time-bar",children:$e}):e("div",{class:"catchup-posts-viz-bar",children:Re})),b.length>=2&&e("div",{class:"catchup-filters",children:[e("label",{class:"filter-cat",children:[e("input",{type:"radio",name:"filter-cat",checked:j.toLowerCase()==="all",onChange:()=>{V("all")}}),e(u,{id:"N40H+G"})," ",e("span",{class:"count",children:b.length})]}),Object.entries(pr).map(([x,U])=>!!X[x]&&e("label",{class:"filter-cat",title:(X[x]/b.length*100).toFixed(2)+"%",children:[e("input",{type:"radio",name:"filter-cat",checked:j.toLowerCase()===x.toLowerCase(),onChange:()=>{V(x),x==="boosts"&&(ee("reblogsCount"),le("desc"),Ae(null))}}),i(U)," ",e("span",{class:"count",children:X[x]})]},i(U)))]}),b.length>=2&&!!Pe&&e("div",{class:"catchup-filters authors-filters",ref:Oe,children:[Te.map(x=>e("label",{class:"filter-author","data-author":x,children:[e("input",{type:"radio",name:"filter-author",checked:H===x,onChange:()=>{pe(x)},onClick:()=>{H===x&&pe(null)}}),e(pt,{url:ve[x].avatarStatic||ve[x].avatar,size:"xxl",alt:`${ve[x].displayName} (@${ve[x].acct})`})," ",e("span",{class:"count",children:Pe[x]}),e("span",{class:"username",children:ve[x].username})]},`${x}-${Pe[x]}`)),Te.length>5&&e("small",{style:{whiteSpace:"nowrap",paddingInline:"1em",opacity:.33},children:e(u,{id:"HHtYi7",values:{0:Te.length}})},"authors-count")]}),b.length>=2&&e("div",{class:"catchup-filters",children:[e("span",{class:"filter-label",children:e(u,{id:"f6Hub0"})})," ",e("fieldset",{class:"radio-field-group",children:fr.map(x=>e("label",{class:"filter-sort",onClick:U=>{Y===x&&(U.preventDefault(),U.stopPropagation(),le(he==="asc"?"desc":"asc"))},children:[e("input",{type:"radio",name:"filter-sort-cat",checked:Y===x,onChange:()=>{ee(x);const U=/(replies|favourites|reblogs|quotes)/.test(x)?"desc":"asc";le(U)}}),{createdAt:o({id:"mYGY3B"}),repliesCount:o({id:"N8UzTV"}),favouritesCount:o({id:"zZOZj7"}),reblogsCount:o({id:"puY2t0"}),quotesCount:o({id:"eWLklq"}),density:o({id:"0tQ7AD"})}[x],Y===x&&(he==="asc"?" ↑":" ↓")]},x))}),e("span",{class:"filter-label",children:e(u,{id:"group.filter"})})," ",e("fieldset",{class:"radio-field-group",children:mr.map(x=>e("label",{class:"filter-group",children:[e("input",{type:"radio",name:"filter-group",checked:J===x,onChange:()=>{Ae(x)},disabled:x==="account"&&H}),{account:o({id:"dpqPBg"})}[x]||o({id:"EdQY6l"})]},x||"none"))}),H&&Te.length>1?e("button",{type:"button",class:"plain6 small",onClick:()=>{pe(null)},style:{whiteSpace:"nowrap"},children:e(u,{id:"/dlmrZ"})}):null]}),e("ul",{class:`catchup-list catchup-filter-${j||""} ${Y?`catchup-sort-${Y}`:""} ${H&&ve[H]?"catchup-selected-author":""} ${J?`catchup-group-${J}`:""}`,children:xe.map((x,U)=>{const W=x.reblog?.id||x.id;let ne=!1;return J==="account"&&(De.current&&x.account.id!==De.current&&U>0&&(ne=!0),De.current=x.account.id),e(P,{children:[ne&&e("li",{class:"separator"}),e(br,{to:`/${c}/s/${W}`,post:x,root:Ce.current})]},`${x.id}-${ne}`)})}),e("footer",{children:ye.length>5&&e("p",{children:[o(j==="boosts"?{id:"eVosYr"}:{id:"rhmyFK"})," ",e("button",{type:"button",class:"textual",onClick:()=>{Ce.current.scrollTop=0},children:e(u,{id:"0MgdN+"})}),"."]})})]})]})]}),be&&e(qe,{onClose:()=>Le(!1),children:e("div",{class:"sheet",id:"catchup-help-sheet",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>Le(!1),children:e(A,{icon:"x",alt:o({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:e(u,{id:"c3XJ18"})})}),e("main",{children:e("dl",{children:[e("dt",{children:e(u,{id:"EIZREX"})}),e("dd",{children:e(u,{id:"YmGrIy"})}),e("dt",{children:e(u,{id:"coaNtr"})}),e("dd",{children:e(u,{id:"UUrqX1"})}),e("dt",{children:e(u,{id:"ScQBC/"})}),e("dd",{children:e(u,{id:"srocAr"})}),e("dt",{children:e(u,{id:"77Emn0"})}),e("dd",{children:e("table",{children:e("tbody",{children:[e("tr",{children:[e("td",{children:e(u,{id:"Gy9P9T"})}),e("td",{children:e("kbd",{children:"j"})})]}),e("tr",{children:[e("td",{children:e(u,{id:"6XYpYY"})}),e("td",{children:e("kbd",{children:"k"})})]}),e("tr",{children:[e("td",{children:e(u,{id:"f5dduh"})}),e("td",{children:e("kbd",{children:"l"})})]}),e("tr",{children:[e("td",{children:e(u,{id:"rj0vxZ"})}),e("td",{children:e("kbd",{children:"h"})})]}),e("tr",{children:[e("td",{children:e(u,{id:"jsFF8C"})}),e("td",{children:e("kbd",{children:"Enter"})})]}),e("tr",{children:[e("td",{children:e(u,{id:"bUUv3P"})}),e("td",{children:e("kbd",{children:"."})})]})]})})})]})})]})})]})}const vr=rt(function({post:n}){const{id:i,account:o,group:s,reblog:a,quote:c,inReplyToId:p,inReplyToAccountId:d,_followedTags:r,_filtered:l,visibility:h,__BOOSTERS:m}=n,f=p&&d!==o.id,y=!!l&&l?.action!=="blur",v=k=>{k.shiftKey};return e("article",{class:`post-line ${s?"group":a?"reblog":Nt()&&Un(c)?"quote":r?.length?"followed-tags":""} ${f?"reply-to":""} ${y?"filtered":""} visibility-${h}`,onMouseEnter:v,children:[e("span",{class:"post-author",children:a?e("span",{class:"post-reblog-avatar",children:[e(pt,{url:o.avatarStatic||o.avatar,squircle:o.bot}),m?.size>0?[...m].map(k=>e(pt,{url:k.avatarStatic||k.avatar,squircle:k.bot})):""," ",e(A,{icon:"rocket"})," ",e(mt,{account:a.account,showAvatar:!0})]}):Un(c)?e("span",{class:"post-quote-avatar",children:[e(pt,{url:o.avatarStatic||o.avatar,squircle:o.bot})," ",e(A,{icon:"quote"})," ",e(mt,{account:c.quotedStatus?.account||c.account,showAvatar:!0})]}):e(mt,{account:o,showAvatar:!0})}),e(kr,{post:a||n,filterInfo:l}),e("span",{class:"post-meta",children:[e(_r,{post:a||n})," ",e(_t,{datetime:new Date(a?.createdAt||n.createdAt),format:"micro"})]})]})},(n,i)=>n?.post?.id===i?.post?.id),br=({root:n,to:i,...o})=>{const s=B(),[a,c]=R(!1);return G(()=>{const p=new IntersectionObserver(d=>{d[0].isIntersecting&&(queueMicrotask(()=>c(!0)),p.unobserve(s.current))},{root:n,rootMargin:`${Math.max(320,screen.height*.75)}px`});return s.current&&p.observe(s.current),()=>{s.current&&p.unobserve(s.current)}},[]),a?e("li",{children:e(fe,{to:i,children:e(vr,{...o})})}):e("li",{ref:s,style:{height:"4em"}})},wr=8,Sr=8;function gs(n){const{spoilerText:i,content:o,poll:s,mediaAttachments:a,card:c}=n,p=s?.options?.length?s.options.reduce((r,l)=>r+l.title,""):"";return(i.length+Hs(o)+p.length)/140+(a?.length?wr*a.length:c?.image?Sr:0)}const Lt=48;function kr({post:n,filterInfo:i}){const{_:o}=ce();let{spoilerText:s,sensitive:a,content:c,emojis:p,poll:d,mediaAttachments:r,card:l,inReplyToId:h,inReplyToAccountId:m,account:f,_thread:y,quote:v}=n;const k=h&&m===f.id||!!y;let S=Nt()&&Un(v)?v.quotedStatus||v:null;(S?.spoilerText||S?.sensitive)&&(S=null),S?.emojis&&p.push(...S.emojis),!r?.length&&S?.mediaAttachments?.length&&(r=S.mediaAttachments);const g=!!vi()["reading:expand:spoilers"],C=g||!s&&!a&&i?.action!=="blur",w=c?qn(n):"",I=!s||g;return e("div",{class:"post-peek",title:s?"":w,children:[e("span",{class:"post-peek-content",children:[k&&!I&&e(P,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),i&&i?.action!=="blur"?e("span",{class:"post-peek-filtered",children:i?.titlesStr?o({id:"suKjh3",values:{0:i.titlesStr}}):o({id:"03Qqf9"})}):e(P,{children:[!!s&&e("span",{class:"post-peek-spoiler",children:[e(A,{icon:`${g?"eye-open":"eye-close"}`})," ",s]}),I&&e("div",{class:"post-peek-html",children:[k&&e(P,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:e(u,{id:"e66y2Z"})})," "]}),!!c&&e("div",{dangerouslySetInnerHTML:{__html:ya(c,p)+(S?.content?`<blockquote class="post-peek-quote">${S.content}</blockquote>`:"")}}),!!d?.options?.length&&d.options.map(_=>e("div",{children:[d.multiple?"▪️":"•"," ",_.title]})),!c&&r?.length===1&&r[0].description&&e(P,{children:[e("span",{class:"post-peek-tag post-peek-alt",children:"ALT"})," ",e("div",{children:r[0].description})]})]})]})]}),(!i||i?.action==="blur")&&e("span",{class:"post-peek-post-content",children:[!!d&&e("span",{class:"post-peek-tag post-peek-poll",children:[e(A,{icon:"poll",size:"s"}),e(u,{id:"4WUbF1"})]}),r?.length?r.map(_=>{const T=_.previewUrl||_.url,L=_.previewRemoteUrl||_.remoteUrl,M=_.meta?.original?_.meta.original.width:_.meta?.small?.width||_.meta?.original?.width,K=_.meta?.original?_.meta.original.height:_.meta?.small?.height||_.meta?.original?.height;return e("span",{class:"post-peek-media",children:{image:(T||L)&&C?e("img",{src:T,width:Lt,height:Lt,alt:_.description,loading:"lazy",onError:F=>{const{src:q}=F.target;q===T&&(F.target.src=L)},style:{"--anim-duration":`${Math.min(Math.max(Math.max(M,K)/100,5),120)}s`}}):e("span",{class:"post-peek-faux-media",children:"🖼"}),gifv:(T||L)&&C?e("img",{src:T,width:Lt,height:Lt,alt:_.description,loading:"lazy",onError:F=>{const{src:q}=F.target;q===T&&(F.target.src=L)}}):e("span",{class:"post-peek-faux-media",children:"🎞️"}),video:(T||L)&&C?e("img",{src:T,width:Lt,height:Lt,alt:_.description,loading:"lazy",onError:F=>{const{src:q}=F.target;q===T&&(F.target.src=L)}}):e("span",{class:"post-peek-faux-media",children:"📹"}),audio:e("span",{class:"post-peek-faux-media",children:"🎵"})}[_.type]||null},_.id)}):!!l&&l.image&&C&&e("span",{class:`post-peek-media post-peek-card card-${l.type||""}`,children:l.image?e("img",{src:l.image,width:Lt,height:Lt,alt:l.title||l.description||l.imageDescription,loading:"lazy",style:{"--anim-duration":l.width&&l.height&&`${Math.min(Math.max(Math.max(l.width,l.height)/100,5),120)}s`}}):e("span",{class:"post-peek-faux-media",children:"🔗"})})]})]})}function _r({post:n}){const{_:i}=ce(),{reblogsCount:o,repliesCount:s,favouritesCount:a,quotesCount:c}=n;return e("span",{class:"post-stats",children:[s>0&&e("span",{class:"post-stat-replies",children:[e(A,{icon:"comment2",size:"s",alt:i({id:"N8UzTV"})})," ",We(s)]}),a>0&&e("span",{class:"post-stat-likes",children:[e(A,{icon:"heart",size:"s",alt:i({id:"zZOZj7"})})," ",We(a)]}),o>0||c>0?e("span",{class:"post-stat-boosts",children:[e(A,{icon:"rocket",size:"s",alt:i({id:"puY2t0"})})," ",o>0||c>0?`${o>0?We(o):""}${o>0&&c>0?"+":""}${c>0?We(c):""}`:We(o)]}):null]})}function Cr(n,i,o){const s=n.map(r=>new Date(r[i])),a=s.reduce((r,l)=>l<r?l:r,s[0]),c=s.reduce((r,l)=>l>r?l:r,s[0]),p=Math.min(c.getTime(),Date.now())-a.getTime(),d=Array.from({length:o},()=>[]);return n.forEach(r=>{const l=Date.parse(r[i]);if(l>Date.now())d[d.length-1].push(r);else{const h=(l-a.getTime())/p,m=Math.floor(h*(o-1));d[m].push(r)}}),d}const Ar=20;function mo(){const{_:n}=ce();Qe(n({id:"zZOZj7"}),"/favourites");const{masto:i,instance:o}=se(),s=B();async function a(c){return(c||!s.current)&&(s.current=i.v1.favourites.list({limit:Ar}).values()),await s.current.next()}return e(Et,{title:n({id:"zZOZj7"}),id:"favourites",emptyText:n({id:"PHIrMr"}),errorText:n({id:"khVljG"}),instance:o,fetchItems:a})}const Ir=["home","public","notifications","thread","account"],ys=["thread","account"],Tr={home:{id:"Buy2bt"},notifications:{id:"iDNBZe"},public:{id:"RO10dm"},thread:{id:"EnJuK0"},account:{id:"vrQQgz"}},xr=[0,30*60,60*60,6*60*60,12*60*60,60*60*24,60*60*24*7,60*60*24*30],ci={0:{id:"qqeAJM"},1800:it(30,"minute"),3600:it(1,"hour"),21600:it(6,"hour"),43200:it(12,"hour"),86400:it(24,"hour"),604800:it(7,"day"),2592e3:it(30,"day")};function Er(){const{_:n}=ce(),{masto:i}=se();Qe(n({id:"cSev+j"}),"/ft");const[o,s]=R("default"),[a,c]=R(!1),[p,d]=xt(h=>h+1,0),[r,l]=R([]);return G(()=>{s("loading"),(async()=>{try{const h=await i.v2.filters.list();h.sort((m,f)=>m.title.localeCompare(f.title)),h.forEach(m=>{m.keywords?.length&&m.keywords.sort((f,y)=>f.id-y.id)}),l(h),s("default")}catch{s("error")}})()},[p]),e("div",{id:"filters-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(Dt,{}),e(fe,{to:"/",class:"button plain",children:e(A,{icon:"home",size:"l",alt:n({id:"i0qMbr"})})})]}),e("h1",{children:e(u,{id:"cSev+j"})}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{c(!0)},children:e(A,{icon:"plus",size:"l",alt:n({id:"yFfBdX"})})})})]})}),e("main",{children:r.length>0?e(P,{children:[e("ul",{class:"filters-list",children:r.map(h=>{const{id:m,title:f,expiresAt:y,keywords:v}=h;return e("li",{children:[e("div",{children:[e("h2",{children:f}),v?.length>0&&e("div",{children:v.map(k=>e(P,{children:[e("span",{class:"tag collapsed insignificant",children:k.wholeWord?`“${k.keyword}”`:k.keyword})," "]}))}),e("small",{class:"insignificant",children:e(go,{expiresAt:y})})]}),e("button",{type:"button",class:"plain",onClick:()=>{c({filter:h})},children:e(A,{icon:"pencil",size:"l",alt:"Edit filter"})})]},m)})}),r.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:e(u,{id:"5vzJxv",values:{0:r.length}})})})]}):o==="loading"?e("p",{class:"ui-state",children:e(Fe,{})}):o==="error"?e("p",{class:"ui-state",children:e(u,{id:"qcAUwp"})}):e("p",{class:"ui-state",children:e(u,{id:"cWIHTt"})})})]}),!!a&&e(qe,{title:n({id:"vCSBPD"}),onClose:()=>{c(!1)},children:e(Mr,{filter:a?.filter,onClose:h=>{h.state==="success"&&d(),c(!1)}})})]})}let Rr=1;const Lr=()=>Rr++;function Mr({filter:n,onClose:i}){const{_:o,_:s}=ce(),{masto:a}=se(),[c,p]=R("default"),d=!!n,{context:r,expiresAt:l,id:h,keywords:m,title:f,filterAction:y}=n||{},v=!!l,k=v&&new Date(l),[S,b]=R(m||[]),g=B(),[C,w]=R([]),[I,_]=R([]),T=S.filter(L=>!C.includes(L.id)&&!I.includes(L._id));return e("div",{class:"sheet",id:"filters-add-edit-modal",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(A,{icon:"x",alt:s({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:s(d?{id:"3mOee6"}:{id:"yFfBdX"})})}),e("main",{children:e("form",{onSubmit:L=>{L.preventDefault();const M=new FormData(L.target),K=M.get("title"),F=M.getAll("keyword_attributes[][id]"),q=M.getAll("keyword_attributes[][keyword]"),X=[...g.current.querySelectorAll('input[name="keyword_attributes[][whole_word]"]')].map(pe=>pe.checked),Q=q.map((pe,$)=>({id:F[$]||void 0,keyword:pe,wholeWord:X[$]}));d&&C?.length&&C.forEach(pe=>{Q.push({id:pe,_destroy:!0})});const j=M.getAll("context");let V=M.get("expires_in");const H=M.get("filter_action");!K||!j?.length||(p("loading"),(async()=>{try{let pe;d?(V===""||V===null?v?V=Math.floor((k-Date.now())/1e3):V=null:V==="0"||V===0?V=null:V=+V,pe=await a.v2.filters.$select(h).update({title:K,context:j,expiresIn:V,keywordsAttributes:Q,filterAction:H})):(V=+V||null,pe=await a.v2.filters.create({title:K,context:j,expiresIn:V,keywordsAttributes:Q,filterAction:H})),p("default"),i?.({state:"success",filter:pe})}catch{p("error"),alert(s(d?{id:"H8RP+h"}:{id:"Fr0hAN"}))}})())},children:[e("div",{class:"filter-form-row",children:e("label",{children:[e("b",{children:e(u,{id:"MHrjPM"})}),e("input",{type:"text",name:"title",defaultValue:f,disabled:c==="loading",dir:"auto",required:!0})]})}),e("div",{class:"filter-form-keywords",ref:g,children:[T.length?e("ul",{class:"filter-keywords",children:T.map(L=>{const{id:M,keyword:K,wholeWord:F,_id:q}=L;return e("li",{children:[e("input",{type:"hidden",name:"keyword_attributes[][id]",value:M}),e("input",{name:"keyword_attributes[][keyword]",type:"text",defaultValue:K,disabled:c==="loading",required:!0,dir:"auto"}),e("div",{class:"filter-keyword-actions",children:[e("label",{children:[e("input",{name:"keyword_attributes[][whole_word]",type:"checkbox",value:M,defaultChecked:F,disabled:c==="loading"})," ",e(u,{id:"/7UQ7y"})]}),e("button",{type:"button",class:"light danger small",disabled:c==="loading",onClick:()=>{M?(C.push(M),w([...C])):q&&(I.push(q),_([...I]))},children:e(A,{icon:"x",alt:s({id:"t/YqKh"})})})]})]},`${M}-${q}`)})}):e("div",{class:"filter-keywords",children:e("div",{class:"insignificant",children:e(u,{id:"SYKm3p"})})}),e("footer",{class:"filter-keywords-footer",children:[e("button",{type:"button",class:"light",onClick:()=>{b([...S,{_id:Lr(),keyword:"",wholeWord:!0}]),setTimeout(()=>{const L=g.current.querySelectorAll('input[type="text"]');L[L.length-1]?.focus?.()},10)},children:e(u,{id:"qn5Dbn"})})," ",T?.length>1&&e("small",{class:"insignificant",children:e(u,{id:"1JZ175",values:{0:T.length}})})]})]}),e("div",{class:"filter-form-cols",children:[e("div",{class:"filter-form-col",children:[e("div",{children:e("b",{children:e(u,{id:"uqf7Yq"})})}),Ir.map(L=>e("div",{children:[e("label",{class:ys.includes(L)?"insignificant":"",children:[e("input",{type:"checkbox",name:"context",value:L,defaultChecked:r?r.includes(L):!0,disabled:c==="loading"})," ",o(Tr[L]),ys.includes(L)?"*":""]})," "]})),e("p",{children:e("small",{class:"insignificant",children:e(u,{id:"m0G499"})})})]}),e("div",{class:"filter-form-col",children:[d&&e(u,{id:"ucJk3m",components:{0:e("b",{}),1:e(go,{expiresAt:l,showNeverExpires:!0})}}),e("div",{children:[e("label",{for:"filters-expires_in",children:s(d?{id:"BcNdg+"}:{id:"agO/T/"})}),e("select",{id:"filters-expires_in",name:"expires_in",disabled:c==="loading",defaultValue:d?void 0:0,children:[d&&e("option",{}),xr.map(L=>e("option",{value:L,children:typeof ci[L]=="function"?ci[L]():o(ci[L])}))]})]}),e("p",{children:[e(u,{id:"blQMpa"}),e("br",{}),bi()?.mastodon>=5&&e("label",{class:"ib",children:[e("input",{type:"radio",name:"filter_action",value:"blur",defaultChecked:y==="blur",disabled:c==="loading"})," ",e(u,{id:"ggxOw9"})]})," ",e("label",{class:"ib",children:[e("input",{type:"radio",name:"filter_action",value:"warn",defaultChecked:y!=="hide"&&y!=="blur"||!d,disabled:c==="loading"})," ",e(u,{id:"jbreWy"})]})," ",e("label",{class:"ib",children:[e("input",{type:"radio",name:"filter_action",value:"hide",defaultChecked:y==="hide",disabled:c==="loading"})," ",e(u,{id:"zNCBmf"})]})]})]})]}),e("footer",{class:"filter-form-footer",children:[e("span",{children:[e("button",{type:"submit",disabled:c==="loading",children:s(d?{id:"tfDRzk"}:{id:"hYgDIe"})})," ",e(Fe,{abrupt:!0,hidden:c!=="loading"})]}),d&&e(ft,{disabled:c==="loading",align:"end",menuItemClassName:"danger",confirmLabel:s({id:"BPjyR2"}),onClick:()=>{p("loading"),(async()=>{try{await a.v2.filters.$select(h).remove(),p("default"),i?.({state:"success"})}catch{p("error"),alert(s({id:"4Dh9J1"}))}})()},children:e("button",{type:"button",class:"light danger",onClick:()=>{},disabled:c==="loading",children:e(u,{id:"Jb6/SB"})})})]})]})})]})}function go({expiresAt:n,showNeverExpires:i}){const{_:o}=ce(),s=!!n,a=s&&new Date(n),c=s&&Date.parse(n)<=Date.now(),[p,d]=xt(r=>r+1,0);return Ai(d,c||3e4),c?o({id:"M1RnFv"}):s?e(u,{id:"urGtsw",components:{0:e(_t,{datetime:a})}}):i&&o({id:"O1Aswy"})}function $r(){const{_:n}=ce(),{masto:i,instance:o}=se();Qe(n({id:"Xi1/bw"}),"/fh");const[s,a]=R("default"),[c,p]=R([]);return G(()=>{a("loading"),(async()=>{try{const d=await zn();p(d),a("default")}catch{a("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(Dt,{}),e(fe,{to:"/",class:"button plain",children:e(A,{icon:"home",size:"l",alt:n({id:"i0qMbr"})})})]}),e("h1",{children:e(u,{id:"Xi1/bw"})}),e("div",{class:"header-side"})]})}),e("main",{children:c.length>0?e(P,{children:[e("ul",{class:"link-list",children:c.map(d=>e("li",{children:e(fe,{to:o?`/${o}/t/${d.name}`:`/t/${d.name}`,children:[e(A,{icon:"hashtag",alt:"#"})," ",e("span",{children:d.name})]})}))}),c.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:e(u,{id:"2S/uvJ",values:{0:c.length}})})})]}):s==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):s==="error"?e("p",{class:"ui-state",children:e(u,{id:"2AeREO"})}):e("p",{class:"ui-state",children:e(u,{id:"vKsGhk"})})})]})})}const Nr=20;function qi({title:n,path:i,id:o,...s}){const{_:a}=ce();Qe(n||a({id:"following.title"}),i||"/following");const{masto:c,streaming:p,instance:d,client:r}=se(),[l,h]=R(p),m=Ge(E),f=B(),y=B(),v=B();G(()=>{!p&&r?.onStreamingReady&&r.onStreamingReady(g=>{h(g)})},[r]),__BENCHMARK.end("time-to-following");const k=Xe("@pixelfed/home-include-reblogs");async function S(g){(g||!y.current)&&(__BENCHMARK.start("fetch-home-first"),f.current=c.v1.timelines.home.list({limit:Nr}),y.current=f.current.values()),k&&f.current?.params&&(typeof f.current.params=="string"?f.current.params+="&include_reblogs=true":f.current.params.include_reblogs=!0);const C=await y.current.next();let{value:w}=C;if(w?.length){let I=!1;g&&(w[0].id!==v.current&&(I=!0),v.current=w[0].id),w.forEach(_=>{Je(_,d)}),w=ps(w,d),g&&I&&jl(),setTimeout(()=>{po(w,d)},100),w.sort((_,T)=>Date.parse(T.createdAt)-Date.parse(_.createdAt))}return __BENCHMARK.end("fetch-home-first"),{...C,value:w}}async function b(){try{const g={limit:5,since_id:v.current};Xe("@pixelfed/home-include-reblogs")&&(g.include_reblogs=!0);const C=await c.v1.timelines.home.list(g).values().next();let{value:w}=C;const I=w[0]?.id===v.current;return!!(w?.length&&!I&&(v.current=w[0].id,w=ps(w,d),w=Bt(w,"home"),w.some(_=>!_.reblog)))}catch{return!1}}return G(()=>{let g;return(async()=>{if(l){g=l.user.subscribe();for await(const C of g){if(!g)break;if(C.event==="status.update"){const w=C.payload;Je(w,d)}else if(C.event==="delete"){const w=C.payload,I=Ns(w,d);I&&(I._deleted=!0)}}}})(),()=>{g?.unsubscribe?.(),g=null}},[l]),e(Et,{title:n||a({id:"following.title"}),id:o||"following",emptyText:a({id:"nJEKbY"}),errorText:a({id:"7QSeK6"}),instance:d,fetchItems:S,checkForUpdates:b,useItemID:!0,boostsCarousel:m.settings.boostsCarousel,...s,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const Pr=20,Dr=4,vs=Dr+1;function yo({media:n,columnMode:i,...o}){const{_:s}=ce();let{hashtag:a,...c}=i?{}:Pt();o.hashtag&&(a=o.hashtag);let p=a.trim().split(/[\s+]+/);p.sort(),a=p[0];const[d,r]=bt(),l=n||!!d.get("media"),h=l?"?media=1":"",{masto:m,instance:f,authenticated:y}=se({instance:o?.instance||c.instance}),{masto:v,instance:k,authenticated:S}=se(),b=p.map($=>`#${$}`).join(" "),g=s(f?l?{id:"kH0rA0",values:{hashtagTitle:b,instance:f}}:{id:"IK0zKi",values:{hashtagTitle:b,instance:f}}:l?{id:"hHSI3w",values:{hashtagTitle:b}}:{id:"+ZzjRY",values:{hashtagTitle:b}});Qe(g,"/:instance?/t/:hashtag");const C=B(),w=Se(()=>ki(),[]),I=B(void 0);async function _($){const ie=await m.v1.timelines.tag.$select(a).list({limit:Pr,any:p.slice(1),maxId:$?void 0:I.current,onlyMedia:l?!0:void 0}).values().next();let{value:Y}=ie;return Y?.length&&($&&(C.current=Y[0].id),Y.forEach(ee=>{Je(ee,f,{skipThreading:l||w})}),I.current=Y[Y.length-1].id),{...ie,value:Y}}async function T(){try{const $=await m.v1.timelines.tag.$select(a).list({limit:1,any:p.slice(1),since_id:C.current,onlyMedia:l}).values().next();let{value:ie}=$;const Y=ie[0]?.id===C.current;return ie?.length&&!Y?(ie=Bt(ie,"public"),!0):!1}catch{return!1}}const[L,M]=R("default"),[K,F]=R();G(()=>{(async()=>{try{const $=await m.v1.tags.$select(a).fetch();F($)}catch{}})()},[a]);const q=p.length>=vs,[X,Q]=R("default"),[j,V]=R([]),[H,pe]=R(!1);return G(()=>{y&&(async()=>{try{const $=await m.v1.featuredTags.list();V($),pe($.some(ie=>ie.name.toLowerCase()===a.toLowerCase()))}catch{}})()},[]),e(P,{children:[e(Et,{title:g,titleComponent:!!f&&e("h1",{class:"header-double-lines",children:[e("b",{dir:"auto",children:b}),e("div",{children:f})]}),id:"hashtag",instance:f,emptyText:s({id:"CNSLAW"}),errorText:s({id:"yjj6Ll"}),fetchItems:_,checkForUpdates:T,useItemID:!0,view:l||w?"media":void 0,refresh:l,filterContext:"public",headerEnd:e(lt,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(A,{icon:"more",size:"l",alt:s({id:"2FYpfJ"})})}),children:[!!K&&p.length===1&&e(P,{children:[e(ft,{subMenu:!0,confirm:K.following,confirmLabel:s({id:"ctJi7k",values:{hashtag:a}}),disabled:L==="loading"||!y,onClick:()=>{M("loading"),K.following?m.v1.tags.$select(a).unfollow().then(()=>{F({...K,following:!1}),re(s({id:"doK/ij",values:{hashtag:a}}))}).catch($=>{alert($)}).finally(()=>{M("default")}):m.v1.tags.$select(a).follow().then(()=>{F({...K,following:!0}),re(s({id:"R9+aEN",values:{hashtag:a}}))}).catch($=>{alert($)}).finally(()=>{M("default")})},children:K.following?e(P,{children:[e(A,{icon:"check-circle"})," ",e("span",{children:e(u,{id:"HOSk7R"})})]}):e(P,{children:[e(A,{icon:"plus"})," ",e("span",{children:e(u,{id:"MKEPCY"})})]})}),e(ge,{type:"checkbox",checked:H,disabled:X==="loading"||!y,onClick:()=>{if(Q("loading"),H){const $=j.find(ie=>ie.name.toLowerCase()===a.toLowerCase()).id;$?m.v1.featuredTags.$select($).remove().then(()=>{pe(!1),re(s({id:"VH+Tf9"})),V(j.filter(ie=>ie.id!==$))}).catch(ie=>{}).finally(()=>{Q("default")}):re(s({id:"3OLv47"}))}else m.v1.featuredTags.create({name:a}).then($=>{pe(!0),re(s({id:"9ra4hn"})),V(j.concat($))}).catch($=>{}).finally(()=>{Q("default")})},children:H?e(P,{children:[e(A,{icon:"check-circle"}),e("span",{children:e(u,{id:"9ra4hn"})})]}):e(P,{children:[e(A,{icon:"check-circle"}),e("span",{children:e(u,{id:"UlJ3QN"})})]})}),e(Ye,{})]}),!w&&e(P,{children:[e(xi,{className:"plain",children:e(u,{id:"cSev+j"})}),e(ge,{type:"checkbox",checked:!!l,onClick:()=>{l?d.delete("media"):d.set("media","1"),r(d)},children:[e(A,{icon:"check-circle",alt:"☑️"})," ",e("span",{class:"menu-grow",children:e(u,{id:"eK4SL/"})})]}),e(Ye,{})]}),e(va,{className:"menu-field",disabled:q,children:({ref:$})=>e("form",{onSubmit:ie=>{ie.preventDefault();const Y=ie.target[0].value?.trim?.();Y&&!p.some(ee=>ee.toLowerCase()===Y.toLowerCase())&&(p.push(Y),p.sort(),location.hash=f?`/${f}/t/${p.join("+")}${h}`:`/t/${p.join("+")}${h}`)},children:[e(A,{icon:"hashtag"}),e("input",{ref:$,type:"text",placeholder:q?ue._({id:"ouWc/D",values:{TOTAL_TAGS_LIMIT:vs}}):s({id:"cxL5F9"}),required:!0,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:q,dir:"auto"})]})}),e(ba,{takeOverflow:!0,children:p.map(($,ie)=>e(ge,{disabled:p.length===1,onClick:Y=>{p.splice(ie,1),p.sort(),location.hash=f?`/${f}/t/${p.join("+")}${h}`:`/t/${p.join("+")}${h}`},children:[e(A,{icon:"x",alt:s({id:"OISAkj"}),class:"danger-icon"}),e("span",{class:"bidi-isolate",children:[e("span",{class:"more-insignificant",children:"#"}),$]})]},$))}),e(Ye,{}),e(ge,{disabled:!S,onClick:()=>{if(E.shortcuts.length>=It){alert(ue._({id:"XN1xAY",values:{SHORTCUTS_LIMIT:It}}));return}const $={type:"hashtag",hashtag:p.join(" "),instance:f,media:l?"on":void 0};E.shortcuts.some(Y=>Y.type===$.type&&Y.hashtag.split(/[\s+]+/).sort().join(" ")===$.hashtag.split(/[\s+]+/).sort().join(" ")&&(Y.instance?Y.instance===$.instance:!0)&&(Y.media?!!Y.media==!!$.media:!0))?alert(s({id:"kfeQnS"})):(E.shortcuts.push($),re(s({id:"MIhb91"})))},children:[e(A,{icon:"shortcut"})," ",e("span",{children:e(u,{id:"i02Lq/"})})]}),e(ge,{onClick:()=>{let $=prompt(s({id:"2MQ2cd"}));if(!/\./.test($)){$&&alert(s({id:"7WddtO"}));return}$&&($=$.toLowerCase().trim(),location.hash=`/${$}/t/${p.join("+")}${h}`)},children:[e(A,{icon:"bus"})," ",e("span",{children:e(u,{id:"Sq04Yc"})})]}),k!==f&&e(ge,{onClick:()=>{location.hash=`/${k}/t/${p.join("+")}${h}`},children:[e(A,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:e(u,{id:"iAzCp4",values:{currentInstance:k},components:{0:e("b",{})}})})]})]})},f+b),!i&&!!p?.length&&e("data",{class:"compose-data",value:JSON.stringify({draftStatus:{status:`${p.length>1?`

`:" "}${b}`}})})]})}const Or=20;function vo(n){const{_:i}=ce(),o=Ge(E),{masto:s,instance:a}=se(),c=n?.id||Pt()?.id,p=B(),d=B();async function r(g){(g||!d.current)&&(d.current=s.v1.timelines.list.$select(c).list({limit:Or}).values());const C=await d.current.next();let{value:w}=C;return w?.length&&(g&&(p.current=w[0].id),w.forEach(I=>{Je(I,a)})),{...C,value:w}}async function l(){try{const g=await s.v1.timelines.list.$select(c).list({limit:1,since_id:p.current});let{value:C}=g;const w=C[0]?.id===p.current;return C?.length&&!w?(C=Bt(C,"home"),!0):!1}catch{return!1}}const[h,m]=R([]),[f,y]=R({title:"List"});Qe(f.title,"/l/:id"),G(()=>{(async()=>{try{const g=await so(c);y(g)}catch{}})()},[c]);const[v,k]=R(!1),[S,b]=R(!1);return e(P,{children:[e(Et,{title:f.title,id:"list",emptyText:i({id:"KkDhfU"}),errorText:i({id:"7QSeK6"}),instance:a,fetchItems:r,checkForUpdates:l,useItemID:!0,boostsCarousel:o.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:e(lt,{overflow:"auto",menuButton:e("button",{type:"button",class:"plain",children:[e(A,{icon:"list",size:"l",alt:i({id:"h16FyT"})}),e(A,{icon:"chevron-down",size:"s"})]}),onMenuChange:g=>{g.open&&pn().then(m)},children:[e(He,{to:"/l",children:e("span",{children:e(u,{id:"BHWx+g"})})}),h?.length>0&&e(P,{children:[e(Ye,{}),h.map(g=>e(He,{to:`/l/${g.id}`,children:e("span",{children:[g.title,g.exclusive&&e(P,{children:[" ",e(Kt,{})]})]})},g.id))]})]}),headerEnd:e(lt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(A,{icon:"more",size:"l",alt:i({id:"2FYpfJ"})})}),children:[f?.exclusive&&e(P,{children:[e(xi,{className:"plain",children:[e(Kt,{})," ",e(u,{id:"FNptcJ"})]}),e(Ye,{})]}),e(ge,{onClick:()=>k({list:f}),children:[e(A,{icon:"pencil",size:"l"}),e("span",{children:e(u,{id:"ePK91l"})})]}),e(ge,{onClick:()=>b(!0),children:[e(A,{icon:"group",size:"l"}),e("span",{children:e(u,{id:"hB02vO"})})]})]})},c),v&&e(qe,{onClick:g=>{g.target===g.currentTarget&&k(!1)},children:e(zi,{list:v?.list,onClose:g=>{g.state==="success"&&g.list?y(g.list):g.state==="deleted"&&(location.hash="/l"),k(!1)}})}),S&&e(qe,{onClick:g=>{g.target===g.currentTarget&&b(!1)},children:e(Fr,{listID:c,onClose:()=>b(!1)})})]})}const zr=40;function Fr({listID:n,onClose:i}){const{_:o}=ce(),{masto:s,instance:a}=se(),[c,p]=R([]),[d,r]=R("default"),[l,h]=R(!1),m=B();async function f(y){h(!1),r("loading"),(async()=>{try{(y||!m.current)&&(m.current=s.v1.lists.$select(n).accounts.list({limit:zr}).values());const v=await m.current.next();let{done:k,value:S}=v;S?.length?(p(y?S:c.concat(S)),h(!k)):h(!1),r("default")}catch{r("error")}})()}return G(()=>{f(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(A,{icon:"x",alt:o({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:e(u,{id:"hB02vO"})})}),e("main",{children:e("ul",{children:[c.map(y=>e("li",{children:[e(ut,{account:y,instance:a}),e(Ur,{account:y,listID:n})]},y.id)),l&&d==="default"&&e(Tt,{as:"li",onChange:y=>y&&f(),children:e("button",{type:"button",class:"light block",onClick:f,children:e(u,{id:"uXRAkV"})})})]})})]})}function Ur({account:n,listID:i}){const{_:o}=ce(),{masto:s}=se(),[a,c]=R("default"),[p,d]=R(!1);return e(ft,{confirm:!p,confirmLabel:e("span",{children:e(u,{id:"j5n9Ry",values:{0:n.username},components:{0:e("span",{class:"bidi-isolate"})}})}),align:"end",menuItemClassName:"danger",onClick:()=>{p?(c("loading"),(async()=>{try{await s.v1.lists.$select(i).accounts.create({accountIds:[n.id]}),c("default"),d(!1)}catch{c("error")}})()):(c("loading"),(async()=>{try{await s.v1.lists.$select(i).accounts.remove({accountIds:[n.id]}),c("default"),d(!0)}catch{c("error")}})())},children:e("button",{type:"button",class:`light ${p?"":"danger"}`,disabled:a==="loading",children:o(p?{id:"m16xKo"}:{id:"MWIaew"})})})}const Br={mention:["account","status"],quote:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]},qr=["favourite","reblog","follow"],bo=n=>qr.includes(n);function wo(n){return n.filter(i=>{const{type:o,id:s,createdAt:a}=i;if(!o)return!1;const c=Br[o];return c?.length?c.every(p=>!!i[p]):!0})}function So(n){if(n?.notificationGroups){const{accounts:i=[],notificationGroups:o=[],statuses:s=[]}=n;return o.map(a=>{const{sampleAccountIds:c,statusId:p}=a,d=c?.map(l=>i.find(h=>h.id===l))||[],r=s?.find(l=>l.id===p)||null;return{...a,sampleAccounts:d,status:r}})}return n}function Kr(n){const i=n.map(p=>{const{latestPageNotificationAt:d,mostRecentNotificationId:r,sampleAccounts:l,notificationsCount:h}=p;return{id:""+r,createdAt:d,account:l[0],...p}}),o={},s=[];for(let p=0;p<i.length;p++){const d=i[p],{type:r,status:l,createdAt:h,notificationsCount:m,sampleAccounts:f,groupKey:y}=d,v=h?new Date(h).toLocaleDateString():"";let k=r;!(m>0&&f?.length>0&&m>f?.length)&&(r==="favourite"||r==="reblog")&&(k="favourite+reblog");const b=`${l?.id}-${k}-${v}`,g=o[b];if(!bo(r))s.push(d);else if(g)f.forEach(C=>{const w=g.sampleAccounts.find(I=>I.id===C.id);w?(w._types.push(r),w._types.sort().reverse()):g.sampleAccounts.push({...C,_types:[r]})}),g.notificationsCount=Math.min(g.notificationsCount,m),g._notificationsCount.push(m),g._sampleAccountsCount.push(f?.length),g._accounts=g.sampleAccounts,g._groupKeys.push(y);else{const C=f.map(w=>({...w,_types:[r]}));o[b]={...d,sampleAccounts:C,type:k,_accounts:C,_groupKeys:y?[y]:[],_notificationsCount:[m],_sampleAccountsCount:[f?.length]},s.push(o[b])}}const a={},c=[];for(let p=0;p<s.length;p++){const d=s[p],{type:r,account:l,_accounts:h,sampleAccounts:m,createdAt:f,groupKey:y}=d,v=f?new Date(f).toLocaleDateString():"",k=m?.length===1||h?.length===1;if((r==="favourite"||r==="reblog"||r==="favourite+reblog")&&k){const S=`${l?.id}-${r}-${v}`,b=a[S];if(b)b._statuses.push(d.status),b._ids+=`-${d.id}`,b._groupKeys.push(y);else{let g=a[S]={...d,type:r,_ids:d.id,_statuses:[d.status],_groupKeys:y?[y]:[]};c.push(g)}}else c.push(d)}return c}function Hr(n){n=wo(n);const i={},o=[];for(let c=0,p=0;c<n.length;c++){const d=n[c],{id:r,status:l,account:h,type:m,createdAt:f}=d,y=f?new Date(f).toLocaleDateString():"";let v=m;(m==="favourite"||m==="reblog")&&(v="favourite+reblog");const k=`${l?.id}-${v}-${y}`,S=i[k];if(!bo(m))o[p++]=d;else if(S?.account){const b=S._accounts.find(g=>g.id===h.id);b?(b._types.push(m),b._types.sort().reverse(),S._ids+=`-${r}`):(h._types=[m],S._accounts.push(h),S._ids+=`-${r}`)}else{h&&(h._types=[m]);let b=i[k]={...d,type:v,_ids:r,_accounts:h?[h]:[]};o[p++]=b}}const s={},a=[];for(let c=0,p=0;c<o.length;c++){const d=o[c],{id:r,account:l,_accounts:h,type:m,createdAt:f}=d,y=f?new Date(f).toLocaleDateString():"";if(m==="favourite+reblog"&&l&&h.length===1){const v=`${l?.id}-${m}-${y}`,k=s[v];if(k)k._statuses.push(d.status),k._ids+=`-${r}`;else{let S=s[v]={...d,type:m,_ids:r,_statuses:[d.status]};a[p++]=S}}else a[p++]=d}return a}const bs=20,Yr=new URLSearchParams;function ko({columnMode:n,...i}){const{_:o}=ce(),{masto:s,instance:a}=se(),[c]=n?[Yr]:bt(),[p,d]=R(null),r=i?.type||c.get("type")||p;Qe(o(r==="private"?{id:"2BApYc"}:{id:"/bZzdR"}),"/mentions");const l=B(),h=B();async function m(g){(g||!l.current)&&(l.current=s.v1.notifications.list({limit:bs,types:["mention"]}).values());const C=await l.current.next();let{value:w}=C;return w?.length&&(w=wo(w),g&&(h.current=w[0].id),w.forEach(({status:I})=>{Je(I,a)})),{...C,value:w?.map(I=>I.status)}}const f=B(),y=B();async function v(g){(g||!f.current)&&(f.current=s.v1.conversations.list({limit:bs}).values());const C=await f.current.next();let{value:w}=C;return w=w?.filter(I=>I.lastStatus),w?.length&&(g&&(y.current=w[0].lastStatus.id),w.forEach(({lastStatus:I})=>{Je(I,a)})),{...C,value:w?.map(I=>I.lastStatus)}}function k(...g){return r==="private"?v(...g):m(...g)}async function S(){if(r==="private")try{const g=await s.v1.conversations.list({limit:1,since_id:y.current}).values().next();let{value:C}=g;const w=C[0]?.id===y.current;return C?.length&&!w?(y.current=C[0].lastStatus.id,!0):!1}catch{return!1}else try{const g=await s.v1.notifications.list({limit:1,types:["mention"],since_id:h.current}).values().next();let{value:C}=g;return C?.length?(h.current=C[0].id,!0):!1}catch{return!1}}const b=Se(()=>e("div",{class:"filter-bar centered",children:[e(fe,{to:"/mentions",class:r?"":"is-active",onClick:g=>{n&&(g.preventDefault(),d(null))},children:e(u,{id:"N40H+G"})}),e(fe,{to:"/mentions?type=private",class:r==="private"?"is-active":"",onClick:g=>{n&&(g.preventDefault(),d("private"))},children:e(u,{id:"zwBp5t"})})]}),[r]);return e(Et,{title:o({id:"/bZzdR"}),id:"mentions",emptyText:o({id:"03jFGT"}),errorText:o({id:"pqR9KF"}),instance:a,fetchItems:k,checkForUpdates:S,useItemID:!0,timelineStart:b,refresh:r,filterContext:"notifications"})}const jr=80,Vr=20,Gr=new URLSearchParams,vn={block:"center",inline:"center",behavior:"smooth"},_o=_i(()=>bi()?.mastodon>=2,{maxAge:1e3*60*5});function Co(n={}){const{masto:i}=se();return E.settings.groupedNotificationsAlpha&&_o()?i.v2.notifications.list({limit:Vr,...n}):i.v1.notifications.list({limit:jr,...n})}function Ao(n={}){return Co(n).values()}function Io(n){return E.settings.groupedNotificationsAlpha&&_o()?Kr(n):Hr(n)}const Wr=["forNotFollowing","forNotFollowers","forNewAccounts","forPrivateMentions","forLimitedAccounts"],Zr={forNotFollowing:{id:"d+hDoa"},forNotFollowers:{id:"oAwuQj"},forNewAccounts:{id:"Srs8u7"},forPrivateMentions:{id:"IDC5Uw"},forLimitedAccounts:{id:"XMGM2e"}};function Xr({columnMode:n}){const{_:i,_:o}=ce();Qe(o({id:"iDNBZe"}),"/notifications");const{masto:s,instance:a}=se(),c=Ge(E),[p,d]=R("default"),[r]=n?[Gr]:bt(),l=r.get("id"),h=r.get("access_token"),[m,f]=R(!1),[y,v]=R(!1),k=B(),{nearReachEnd:S,scrollDirection:b,reachStart:g,nearReachStart:C}=Vl({scrollableRef:k}),w=b==="end"&&!C,[I,_]=R([]),[T,L]=R([]),M=B(),K=B();async function F(O){if((O||!K.current)&&(M.current=Co({excludeTypes:["follow_request"]}),K.current=M.current.values()),/max_id=($|&)/i.test(K.current?.nextParams))return{done:!0};const ke=await K.current.next(),Be=So(ke.value);if(Be?.length){Be.forEach(N=>{Je(N.status,a,{skipThreading:!0})});const ze=Io(Be);O?(E.notificationsLast=ze[0],E.notifications=ze,s.v1.markers.create({notifications:{lastReadId:ze[0].id}}).catch(()=>{})):E.notifications.push(...ze)}return E.notificationsShowNew=!1,E.notificationsLastFetchTime=Date.now(),ke}async function q(){try{return await s.v1.followRequests.list({limit:80})}catch{return[]}}const X=()=>{d("loading"),(async()=>{try{const O=await q();_(O),d("default")}catch{d("error")}})()};async function Q(){try{return await s.v1.announcements.list()}catch{return[]}}const j=Xe("@mastodon/filtered-notifications"),[V,H]=R(!1),[pe,$]=R({});function ie(){return s.v2.notifications.policy.fetch().catch(()=>{})}function Y(){ie().then(O=>{$(O)}).catch(()=>{})}const[ee,he]=R(null);function le(){return s.v1.notifications.requests.list()}const J=O=>{ye(!1),d("loading"),(async()=>{try{const ke=F(O);O&&(Q().then(ze=>{ze.sort((N,ae)=>Date.parse(ae.updatedAt||ae.createdAt)-Date.parse(N.updatedAt||N.createdAt)),L(ze)}).catch(()=>{}),q().then(ze=>{_(ze)}).catch(()=>{}),j&&Y());const{done:Be}=await ke;f(!Be),d("default")}catch{d("error")}})()};G(()=>{J(!0)},[]),G(()=>{g&&J(!0)},[g]);const[Ae,ye]=R(!1),ve=nt(({disableIdleCheck:O=!1}={})=>{p!=="loading"&&c.settings.autoRefresh&&k.current?.scrollTop<16&&(O||window.__IDLE__)&&!Jr()&&J(!0)},[c.notificationsShowNew,c.settings.autoRefresh,p]),Pe=B();Xt(O=>{if(O){const ke=Date.now()-Pe.current;!Pe.current||ke>1e3*3?ve({disableIdleCheck:!0}):Pe.current=Date.now()}});const _e=B(!0);G(()=>{let O=jo(E,"notificationsShowNew",ke=>{if(_e.current){_e.current=!1;return}p!=="loading"&&(ke&&ve(),ye(ke))});return()=>O?.()},[]);const Te=new Date,xe=new Date(Te-24*60*60*1e3);let De=new Date;const Oe=!c.notifications.some(O=>new Date(O.createdAt).toDateString()===Te.toDateString()),Ue=B();G(()=>{l&&(E.routeNotification={id:l,accessToken:atob(h)})},[l,h]);const[oe,Re]=R(null);G(async()=>{const O=new Date;if(O.getMonth()!==11||!Xe("@mastodon/annual-report"))return;let ke=Ee.account.get("annualReportNotification");if(ke){Re(ke);return}const Be=Ao({types:["annual_report"]});try{ke=(await Be.next())?.value?.notificationGroups?.[0],ke?.annualReport?.year==O.getFullYear()&&(Re(ke),Ee.account.set("annualReportNotification",ke))}catch{}},[]);const $e=".notification",Ce=Ke("j",()=>{const O=document.activeElement.closest($e),ke=O?.getBoundingClientRect(),Be=Array.from(k.current.querySelectorAll($e));if(O&&ke.top<k.current.clientHeight&&ke.bottom>0){const ze=Be.indexOf(O);let N=Be[ze+1];N&&(N.focus(),N.scrollIntoView(vn))}else{const ze=Be.find(N=>{const ae=N.getBoundingClientRect();return ae.top>=44&&ae.left>=0});ze&&(ze.focus(),ze.scrollIntoView(vn))}},{useKey:!0,ignoreEventWhen:O=>O.metaKey||O.ctrlKey||O.altKey||O.shiftKey}),z=Ke("k",()=>{const O=document.activeElement.closest($e),ke=O?.getBoundingClientRect(),Be=Array.from(k.current.querySelectorAll($e));if(O&&ke.top<k.current.clientHeight&&ke.bottom>0){const ze=Be.indexOf(O);let N=Be[ze-1];N&&(N.focus(),N.scrollIntoView(vn))}else{const ze=Be.find(N=>{const ae=N.getBoundingClientRect();return ae.top>=44&&ae.left>=0});ze&&(ze.focus(),ze.scrollIntoView(vn))}},{useKey:!0,ignoreEventWhen:O=>O.metaKey||O.ctrlKey||O.altKey||O.shiftKey}),be=Ke(["enter","o"],()=>{const ke=document.activeElement.closest($e)?.querySelector(".status-link");ke&&ke.click()},{useKey:!0,ignoreEventWhen:O=>O.metaKey||O.ctrlKey||O.altKey||O.shiftKey}),Le=new Date,Ne=Se(()=>st(Le,{forceOpts:{weekday:"long"}}),[Le]);return e("div",{id:"notifications-page",class:"deck-container",ref:O=>{k.current=O,Ce.current=O,z.current=O,be.current=O},tabIndex:"-1",children:[e("div",{class:`timeline-deck deck ${y?"only-mentions":""}`,children:[e("header",{hidden:w,onClick:O=>{O.target.closest("a, button")||k.current?.scrollTo({top:0,behavior:"smooth"})},onDblClick:O=>{O.target.closest("a, button")||J(!0)},class:p==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(Dt,{}),e(fe,{to:"/",class:"button plain",children:e(A,{icon:"home",size:"l",alt:o({id:"i0qMbr"})})})]}),e("h1",{children:e(u,{id:"iDNBZe"})}),e("div",{class:"header-side",children:j&&e("button",{type:"button",class:"button plain4",onClick:()=>{H(!0)},children:e(A,{icon:"settings",size:"l",alt:o({id:"a/+arl"})})})})]}),Ae&&p!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{J(!0),k.current?.scrollTo({top:0,behavior:"smooth"})},children:[e(A,{icon:"arrow-up"})," ",e(u,{id:"Jy9RU/"})]})]}),T.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(A,{icon:"announce",class:"announcement-icon",size:"l"})," ",e(u,{id:"0whvLM",values:{0:T.length}})," ",e("small",{class:"insignificant",children:a})]}),T.length>1&&e("span",{class:"announcements-nav-buttons",children:T.map((O,ke)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{Ue.current?.children[ke].scrollIntoView({behavior:"smooth",block:"nearest"})},children:ke+1}))})]}),e("ul",{class:`announcements-list-${T.length>1?"multiple":"single"}`,ref:Ue,children:T.map(O=>e("li",{children:e(Qr,{announcement:O})}))})]})})}),I.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:e(u,{id:"6Fs1Ba"})}),I.length>5?e("details",{children:[e("summary",{children:e(u,{id:"7dHKu4",values:{0:I.length}})}),e("ul",{children:I.map(O=>e("li",{children:[e(ut,{account:O}),e(pi,{accountID:O.id,onChange:()=>{}})]},O.id))})]}):e("ul",{children:I.map(O=>e("li",{children:[e(ut,{account:O}),e(pi,{accountID:O.id,onChange:()=>{}})]},O.id))})]}),j&&pe?.summary?.pendingRequestsCount>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("div",{class:"filtered-notifications",children:e("details",{onToggle:async O=>{const{open:ke}=O.target;if(ke){const Be=await le();he(Be)}},children:[e("summary",{children:e(u,{id:"N3Bq0f",values:{0:pe.summary.pendingRequestsCount}})}),ee?ee?.length>0&&e("ul",{children:ee.map(O=>e("li",{children:[e("div",{class:"request-notifcations",children:[!O.lastStatus?.id&&e(ut,{useAvatarStatic:!0,showStats:!0,account:O.account}),O.lastStatus?.id&&e("div",{class:"last-post",children:e(fe,{class:"status-link",to:`/${a}/s/${O.lastStatus.id}`,children:e(je,{status:O.lastStatus,size:"s",readOnly:!0})})}),e(td,{request:O})]}),e(nd,{request:O,onChange:()=>{J(!0)}})]},O.id))}):e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})})]})})})}),oe&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e(un,{notification:oe})})}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:y,onChange:O=>{v(O.target.checked)}})," ",e(u,{id:"0udtPI"})]})}),e("h2",{class:"timeline-header",children:[e(u,{id:"ecUA8p"})," ",e("small",{class:"insignificant bidi-isolate",children:Ne})]}),Oe&&e("p",{class:"ui-state insignificant",children:p==="default"?o({id:"KS7iJH"}):e(P,{children:"…"})}),c.notifications.length?e(Hn.Provider,{value:"notifications",children:c.notifications.filter(O=>O.type!=="follow_request").map(O=>{if(y&&O.type!=="mention")return null;const ke=new Date(O.createdAt),Be=ke.toDateString()!==De.toDateString();Be&&(De=ke);const ze=ke.toDateString()===xe.toDateString()?o({id:"y/0uwd"}):st(De,{hideTime:!0}),N=st(De,{forceOpts:{weekday:"long"}});return e(P,{children:[Be&&e("h2",{class:"timeline-header",children:[e("span",{children:ze})," ",e("small",{class:"insignificant bidi-isolate",children:N})]}),e(un,{instance:a,notification:O},O._ids||O.id)]},O._ids||O.id)})}):e(P,{children:[p==="loading"&&e(P,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((O,ke)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(A,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),p==="error"&&e("p",{class:"ui-state",children:[e(u,{id:"gjzl8E"}),e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>J(!0),children:e(u,{id:"KDw4GX"})})]})]}),m&&e(Tt,{onChange:O=>{O&&J()},children:e("button",{type:"button",class:"plain block",disabled:p==="loading",onClick:()=>J(),style:{marginBlockEnd:"6em"},children:p==="loading"?e(Fe,{abrupt:!0}):e(u,{id:"uXRAkV"})})})]}),j&&V&&e(qe,{onClick:O=>{O.target===O.currentTarget&&H(!1)},children:e("div",{class:"sheet",id:"notifications-settings",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>H(!1),children:e(A,{icon:"x",alt:o({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:e(u,{id:"a/+arl"})})}),e("main",{children:e("form",{onSubmit:O=>{O.preventDefault();const{forNotFollowing:ke,forNotFollowers:Be,forNewAccounts:ze,forPrivateMentions:N,forLimitedAccounts:ae}=O.target,x={...pe,forNotFollowing:ke.value,forNotFollowers:Be.value,forNewAccounts:ze.value,forPrivateMentions:N.value,forLimitedAccounts:ae.value};$(x),H(!1),(async()=>{try{await s.v2.notifications.policy.update(x),re(o({id:"4+7X9i"}))}catch{}})()},children:[e("p",{children:e(u,{id:"WrkPTf"})}),e("div",{class:"notification-policy-fields",children:Wr.map(O=>{const ke=pe[O];return e("div",{children:e("label",{children:[i(Zr[O]),e("select",{name:O,defaultValue:ke,class:"small",children:[e("option",{value:"accept",children:e(u,{id:"g3UF2V"})}),e("option",{value:"filter",children:e(u,{id:"o7J4JM"})}),e("option",{value:"drop",children:e(u,{id:"gbbkE7"})})]})]})},O)})}),e("p",{children:e("button",{type:"submit",children:e(u,{id:"tfDRzk"})})})]})})]})})]})}function Jr(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Qr({announcement:n}){const{instance:i}=se(),{contact:o}=Ls(),s=o?.account,{id:a,content:c,startsAt:p,endsAt:d,published:r,allDay:l,publishedAt:h,updatedAt:m,read:f,mentions:y,statuses:v,tags:k,emojis:S,reactions:b}=n,g=new Date(h),C=st(g),w=new Date(m),I=st(w);return e("div",{class:"announcement-block",children:[e(ut,{account:s}),e("div",{class:"announcement-content",onClick:Bs({mentions:y,instance:i}),dangerouslySetInnerHTML:{__html:ri(c,{emojis:S})}}),e("p",{class:"insignificant",children:[e("time",{datetime:g.toISOString(),children:st(g)}),m&&I!==C&&e(P,{children:[" ","•"," ",e("span",{class:"ib",children:e(u,{id:"TbFrLc",values:{0:st(w)},components:{0:e("time",{datetime:w.toISOString()})}})})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:b.map(_=>{const{name:T,count:L,me:M,staticUrl:K,url:F}=_;return e("button",{type:"button",class:`plain4 small ${M?"reacted":""}`,children:[F||K?e("img",{src:F||K,alt:T,width:"16",height:"16"}):e("span",{children:T})," ",e("span",{class:"count",children:We(L)})]})})})]})}function ed(n){const{masto:i}=se();return i.v1.notifications.list({accountID:n})}function td({request:n}){const{instance:i}=se(),[o,s]=R("loading"),{account:a,lastStatus:c}=n,[p,d]=R(!1),[r,l]=R([]);function h(){d(!1)}return G(()=>{n?.account?.id&&p&&(s("loading"),(async()=>{const m=await ed(n.account.id);l(m||[]),s("default")})())},[p,n?.account?.id]),e(P,{children:[e("button",{type:"button",class:"plain4 request-notifications-account",onClick:()=>{d(!0)},children:[e(A,{icon:"notification",class:"more-insignificant"})," ",e("small",{children:e(u,{id:"H0wUNM",values:{0:a.username},components:{0:e("span",{class:"bidi-isolate"})}})})," ",e(A,{icon:"chevron-down"})]}),p&&e(qe,{onClick:m=>{m.target===m.currentTarget&&h()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:h,children:e(A,{icon:"x",alt:t`Close`})}),e("header",{children:e("b",{children:e(u,{id:"MXOmPt",values:{0:a.username},components:{0:e("span",{class:"bidi-isolate"})}})})}),e("main",{children:o==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):r.map(m=>e("div",{class:"notification-peek",onClick:f=>{const{target:y}=f;(f.target.tagName==="BUTTON"||f.target.tagName==="A")&&h()},children:e(un,{instance:i,notification:m,isStatic:!0})}))})]})})]})}function nd({request:n,onChange:i}){const{_:o}=ce(),{masto:s}=se(),[a,c]=R("default"),[p,d]=R(null),r=p!==null;return e("p",{class:"notification-request-buttons",children:[e("button",{type:"button",disabled:a==="loading"||r,onClick:()=>{c("loading"),(async()=>{try{await s.v1.notifications.requests.$select(n.id).accept(),d("accept"),c("default"),i({request:n,state:"accept"}),re(o({id:"ZtBMwU",values:{0:n.account.username}}))}catch{c("error"),re(o({id:"S92JKG"}))}})()},children:e(u,{id:"h7peZQ"})})," ",e("button",{type:"button",disabled:a==="loading"||r,class:"light danger",onClick:()=>{c("loading"),(async()=>{try{await s.v1.notifications.requests.$select(n.id).dismiss(),d("dismiss"),c("default"),i({request:n,state:"dismiss"}),re(o({id:"ibBDry",values:{0:n.account.username}}))}catch{c("error"),re(o({id:"S5aemF"}))}})()},children:e(u,{id:"1QfxQT"})}),e("span",{class:"notification-request-states",children:a==="loading"?e(Fe,{abrupt:!0}):p==="accept"?e(A,{icon:"check-circle",alt:o({id:"bzMKg7"}),class:"notification-accepted"}):p==="dismiss"&&e(A,{icon:"x-circle",alt:o({id:"J6hrEy"}),class:"notification-dismissed"})})]})}const To=rt(Xr),id=20;function fi({local:n,columnMode:i,...o}){const{_:s}=ce(),a=Ge(E),c=!!n,p=i?{}:Pt(),{masto:d,instance:r}=se({instance:o?.instance||p.instance}),{masto:l,instance:h}=se(),m=s(c?{id:"u96B/B",values:{instance:r}}:{id:"PgVqvd",values:{instance:r}});Qe(m,c?"/:instance?/p/l":"/:instance?/p");const f=B(),y=B();async function v(S){if(S||!y.current){const C={limit:id,local:c||void 0};!c&&Xe("@pixelfed/global-feed")&&(C.remote=!0),y.current=d.v1.timelines.public.list(C).values()}const b=await y.current.next();let{value:g}=b;return g?.length&&(S&&(f.current=g[0].id),g.forEach(C=>{Je(C,r)})),{...b,value:g}}async function k(){try{const S=await d.v1.timelines.public.list({limit:1,local:c,since_id:f.current}).values().next();let{value:b}=S;const g=b[0]?.id===f.current;return b?.length&&!g?(b=Bt(b,"public"),!0):!1}catch{return!1}}return e(Et,{title:m,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:s(c?{id:"pJQgQV"}:{id:"cg0I+x"})}),e("div",{children:r})]}),id:"public",instance:r,emptyText:s({id:"BiZJ6G"}),errorText:s({id:"scd9lw"}),fetchItems:v,checkForUpdates:k,useItemID:!0,headerStart:e(P,{}),boostsCarousel:a.settings.boostsCarousel,filterContext:"public",headerEnd:e(lt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(A,{icon:"more",size:"l",alt:s({id:"2FYpfJ"})})}),children:[e(ge,{href:c?`/#/${r}/p`:`/#/${r}/p/l`,children:c?e(P,{children:[e(A,{icon:"transfer"})," ",e("span",{children:e(u,{id:"dXMiUw"})})]}):e(P,{children:[e(A,{icon:"transfer"})," ",e("span",{children:e(u,{id:"t2B/we"})})]})}),e(Ye,{}),e(ge,{onClick:()=>{let S=prompt(s({id:"2MQ2cd"}));if(!/\./.test(S)){S&&alert(s({id:"7WddtO"}));return}S&&(S=S.toLowerCase().trim(),location.hash=c?`/${S}/p/l`:`/${S}/p`)},children:[e(A,{icon:"bus"})," ",e("span",{children:e(u,{id:"Sq04Yc"})})]}),h!==r&&e(ge,{onClick:()=>{location.hash=c?`/${h}/p/l`:`/${h}/p`},children:[e(A,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:e(u,{id:"iAzCp4",values:{currentInstance:h},components:{0:e("b",{})}})})]})]})},r+c)}function sd({onItemClick:n}){const{_:i}=ce(),{instance:o}=se(),[,s]=xt(r=>r+1,0),a=Zn(),c=()=>{Fl(),re({text:i({id:"hgPsUe"}),delay:1e3}),s()},p=(r,l)=>{zl(r,l),s()},[d]=jn();return a.length===0?null:e("div",{class:"recent-searches",children:[e("div",{class:"recent-searches-header",children:[e(A,{icon:"history"})," ",e("span",{children:e(u,{id:"4R1B1H"})}),e("span",{class:"spacer"}),e("button",{type:"button",class:"plain4 small",onClick:c,disabled:a.length<=0,children:e("span",{children:e(u,{id:"yYxB17"})})})]}),e("ul",{class:"link-list recent-searches-list",ref:d,children:a.map(r=>{const{label:l,to:h,icon:m}=zt(r.query,r.queryType,o);return e("li",{class:"recent-searches-item",children:[e(fe,{to:h,class:"recent-searches-link",onClick:f=>{Tn(r.query,r.queryType),n?.(f)},children:[e(A,{icon:m,class:"more-insignificant"}),e("span",{class:"recent-searches-label",children:l})]}),e("button",{type:"button",class:"plain4 small",onClick:()=>p(r.query,r.queryType),children:e(A,{icon:"trash",alt:i({id:"xCJdfg"})})})]},`${r.query}-${r.queryType}-${r.timestamp}`)})})]})}const bn=5,li=40,od=new URLSearchParams,wn={block:"nearest",inline:"center",behavior:"smooth"};function xo({columnMode:n,...i}){const{_:o}=ce(),s=n?{}:Pt(),{masto:a,instance:c,authenticated:p}=se({instance:s.instance}),[d,r]=R("default"),[l]=n?[od]:bt(),h=B(),m=i?.query||l.get("q"),f=n?"statuses":i?.type||l.get("type");let y=o({id:"A1taO8"});if(m)switch(f){case"statuses":y=o({id:"6YeoAt",values:{q:m}});break;case"accounts":y=o({id:"fpgumQ",values:{q:m}});break;case"hashtags":y=o({id:"AuiMZZ",values:{q:m}});break;default:y=o({id:"wr3GZI",values:{q:m}})}Qe(y,"/search");const[v,k]=R(!1),S=B(0);G(()=>{S.current=0},[m,f]);const b=B();kt(()=>{b.current?.scrollTo?.(0,0)},[m,f]);const[g,C]=R([]),[w,I]=R([]),[_,T]=R([]);G(()=>{C([]),I([]),T([])},[m]);const L={statuses:g,accounts:w,hashtags:_},M={statuses:C,accounts:I,hashtags:T},[K,F]=R({}),q=async $=>{if(!$?.length)return;const ie=await Kn($,K);ie&&F({...K,...ie})};function X($){$&&(S.current=0),!(!$&&!p)&&(r("loading"),$&&!f&&(C(g.slice(0,bn)),I(w.slice(0,bn)),T(_.slice(0,bn))),(async()=>{const ie={q:m,resolve:p,limit:bn};f&&(ie.limit=li,ie.type=f,p&&(ie.offset=S.current));try{const Y=await a.v2.search.list(ie);if(f)if($){M[f](Y[f]);const ee=Y[f]?.length;S.current=li,k(!!ee)}else if(Y[f]?.[0]?.id===L[f]?.[0]?.id)k(!1);else{M[f](he=>[...he,...Y[f]]);const ee=Y[f]?.length;S.current=S.current+li,k(!!ee)}else C(Y.statuses||[]),I(Y.accounts||[]),T(Y.hashtags||[]),S.current=0,k(!1);q(Y.accounts),r("default")}catch{r("error")}})())}const Q=B();Xt($=>{const ie=b.current?.scrollTop===0;if($&&ie){const Y=Date.now()-Q.current;!Q.current||Y>1e3*3?X(!0):Q.current=Date.now()}}),G(()=>{let $;return h.current?.setValue?.(m||""),m?X(!0):$=setTimeout(()=>{h.current?.focus?.()},150),()=>clearTimeout($)},[m,f,c]),Ke(["Slash","/"],$=>{h.current?.focus?.(),h.current?.select?.()},{useKey:!0,preventDefault:!0,ignoreEventWhen:$=>$.metaKey||$.ctrlKey||$.altKey||$.shiftKey});const j=".timeline > li > a, .hashtag-list > li > a",V=Ke("j",()=>{const $=document.activeElement.closest(j),ie=$?.getBoundingClientRect(),Y=Array.from(b.current.querySelectorAll(j));if($&&ie.top<b.current.clientHeight&&ie.bottom>0){const ee=Y.indexOf($);let he=Y[ee+1];he&&(he.focus(),he.scrollIntoView(wn))}else{const ee=Y.find(he=>{const le=he.getBoundingClientRect();return le.top>=44&&le.left>=0});ee&&(ee.focus(),ee.scrollIntoView(wn))}},{useKey:!0,ignoreEventWhen:$=>$.metaKey||$.ctrlKey||$.altKey||$.shiftKey}),H=Ke("k",()=>{const $=document.activeElement.closest(j),ie=$?.getBoundingClientRect(),Y=Array.from(b.current.querySelectorAll(j));if($&&ie.top<b.current.clientHeight&&ie.bottom>0){const ee=Y.indexOf($);let he=Y[ee-1];he&&(he.focus(),he.scrollIntoView(wn))}else{const ee=Y.find(he=>{const le=he.getBoundingClientRect();return le.top>=44&&le.left>=0});ee&&(ee.focus(),ee.scrollIntoView(wn))}},{useKey:!0,ignoreEventWhen:$=>$.metaKey||$.ctrlKey||$.altKey||$.shiftKey}),[pe]=jn();return e("div",{id:"search-page",class:"deck-container",tabIndex:"-1",ref:$=>{b.current=$,V.current=$,H.current=$},children:e("div",{class:"timeline-deck deck",children:[e("header",{class:d==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(Dt,{})}),e(ho,{ref:h}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{X(!0)},disabled:d==="loading",children:e(A,{icon:"search",size:"l",alt:o({id:"A1taO8"})})})})]})}),e("main",{children:[!!m&&!n&&e("div",{ref:pe,class:`filter-bar ${d==="loading"?"loading":""}`,children:[!!f&&e(fe,{to:`/search${m?`?q=${encodeURIComponent(m)}`:""}`,children:[e(A,{icon:"chevron-left"})," ",e(u,{id:"N40H+G"})]}),[{label:o({id:"bPwFdf"}),type:"accounts",to:`/search?q=${encodeURIComponent(m)}&type=accounts`},{label:o({id:"VwUsHI"}),type:"hashtags",to:`/search?q=${encodeURIComponent(m)}&type=hashtags`},{label:o({id:"+owNNn"}),type:"statuses",to:`/search?q=${encodeURIComponent(m)}&type=statuses`}].sort(($,ie)=>$.type===f?-1:ie.type===f?1:0).map($=>e(fe,{to:$.to,children:$.label},$.type))]}),m?e(P,{children:[(!f||f==="accounts")&&e(P,{children:[f!=="accounts"&&e("h2",{class:"timeline-header",children:[e(u,{id:"bPwFdf"})," ",e(fe,{to:`/search?q=${encodeURIComponent(m)}&type=accounts`,children:e(A,{icon:"arrow-right",size:"l",alt:o({id:"V1fa9u"})})})]}),w.length>0?e(P,{children:[e("ul",{class:"timeline flat accounts-list",children:w.map($=>e("li",{children:e(ut,{account:$,instance:c,showStats:!0,relationship:K[$.id]})},$.id))}),f!=="accounts"&&e("div",{class:"ui-state",children:e(fe,{class:"plain button",to:`/search?q=${encodeURIComponent(m)}&type=accounts`,children:[e(u,{id:"BMmtZ8"})," ",e(A,{icon:"arrow-right"})]})})]}):!f&&(d==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):e("p",{class:"ui-state",children:e(u,{id:"YYB61U"})}))]}),(!f||f==="hashtags")&&e(P,{children:[f!=="hashtags"&&e("h2",{class:"timeline-header",children:[e(u,{id:"VwUsHI"})," ",e(fe,{to:`/search?q=${encodeURIComponent(m)}&type=hashtags`,children:e(A,{icon:"arrow-right",size:"l",alt:o({id:"V1fa9u"})})})]}),_.length>0?e(P,{children:[e("ul",{class:"link-list hashtag-list",children:_.map($=>{const{name:ie,history:Y}=$,ee=Y?.reduce?.((he,le)=>he+ +le.uses,0);return e("li",{children:e(fe,{to:c?`/${c}/t/${ie}`:`/t/${ie}`,children:[e(A,{icon:"hashtag",alt:"#"}),e("span",{children:ie}),!!ee&&e("span",{class:"count",children:We(ee)})]})},`${ie}-${ee}`)})}),f!=="hashtags"&&e("div",{class:"ui-state",children:e(fe,{class:"plain button",to:`/search?q=${encodeURIComponent(m)}&type=hashtags`,children:[e(u,{id:"Nc/W5J"})," ",e(A,{icon:"arrow-right"})]})})]}):!f&&(d==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):e("p",{class:"ui-state",children:e(u,{id:"4MFM3P"})}))]}),(!f||f==="statuses")&&e(P,{children:[f!=="statuses"&&e("h2",{class:"timeline-header",children:[e(u,{id:"+owNNn"})," ",e(fe,{to:`/search?q=${encodeURIComponent(m)}&type=statuses`,children:e(A,{icon:"arrow-right",size:"l",alt:o({id:"V1fa9u"})})})]}),g.length>0?e(P,{children:[e("ul",{class:"timeline",children:g.map($=>e("li",{children:e(fe,{class:"status-link",to:c?`/${c}/s/${$.id}`:`/s/${$.id}`,children:e(je,{status:$})})},$.id))}),f!=="statuses"&&e("div",{class:"ui-state",children:e(fe,{class:"plain button",to:`/search?q=${encodeURIComponent(m)}&type=statuses`,children:[e(u,{id:"LYCgej"})," ",e(A,{icon:"arrow-right"})]})})]}):!f&&(d==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):e("p",{class:"ui-state",children:e(u,{id:"Hzi9AA"})}))]}),!!f&&(d==="default"?v?e(Tt,{onChange:$=>{$&&X()},children:e("button",{type:"button",class:"plain block",onClick:()=>X(),style:{marginBlockEnd:"6em"},children:e(u,{id:"uXRAkV"})})}):e("p",{class:"ui-state insignificant",children:e(u,{id:"2EYeAZ"})}):d==="loading"&&e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}))]}):d==="loading"?e("p",{class:"ui-state",children:e(Fe,{abrupt:!0})}):e(P,{children:[e("p",{class:"ui-state insignificant",children:e(u,{id:"fGn1Hk"})}),e(sd,{})]})]})]})})}const ad=20,Eo=10*60*1e3,cd=vt(n=>n.v1.trends.links.list().values().next(),{maxAge:Eo}),ld=vt(n=>n.v1.trends.tags.list().values().next(),{maxAge:Eo});function rd(n){return Xe("@pixelfed/trending")?n.pixelfed.v2.discover.posts.trending.list({range:"daily"}).values():n.v1.trends.statuses.list({limit:ad}).values()}function dd(n,i){return n.v1.timelines.link.list(i).values()}function Ro({columnMode:n,...i}){const{_:o}=ce(),s=Ge(E),a=n?{}:Pt(),{masto:c,instance:p}=se({instance:i?.instance||a.instance}),{masto:d,instance:r}=se(),l=o({id:"cI3UEs",values:{instance:p}});Qe(l,"/:instance?/trending");const h=B(),m=p===r,[f,y]=R([]),[v,k]=R([]),S=B();async function b(Q){if(Q||!S.current){if(S.current=rd(c),Xe("@mastodon/trending-hashtags"))try{const{value:H}=await ld(c);H?.length&&y(H)}catch{}if(Xe("@mastodon/trending-links"))try{const{value:H}=await cd(c,p),pe=H?.filter?.($=>$.type==="link");pe?.length&&k(pe)}catch{}}const j=await S.current.next();let{value:V}=j;return V?.length&&(Q&&(h.current=V[0].id),V.forEach(H=>{Je(H,p)})),{...j,value:V}}const[g,C]=R(!1),w=B(),[I,_]=R(null),T=!!I,L=B(),M=m&&Xe("@mastodon/trending-link-posts");G(()=>{I&&L.current&&L.current.scrollIntoView({behavior:"smooth",block:"nearest",inline:"center"})},[I]);const K=B();async function F(Q){(Q||!w.current)&&(C(!0),w.current=dd(c,{url:I})),K.current=I;const j=await w.current.next();let{value:V}=j;return V?.length&&(V=Bt(V,"public"),V.forEach(H=>{Je(H,p)})),K.current===I&&C(!1),{...j,value:V}}async function q(){try{const Q=await c.v1.trends.statuses.list({limit:1}).values().next();let{value:j}=Q;return j=Bt(j,"public"),j?.length&&j[0].id!==h.current?(h.current=j[0].id,!0):!1}catch{return!1}}const X=Se(()=>e(P,{children:[!!f.length&&e("div",{class:"filter-bar expandable",children:[e(A,{icon:"chart",class:"insignificant",size:"l"}),f.map((Q,j)=>{const{name:V,history:H}=Q,pe=H.reduce(($,ie)=>$+ +ie.uses,0);return e(fe,{to:`/${p}/t/${V}`,children:[e("span",{dir:"auto",children:[e("span",{class:"more-insignificant",children:"#"}),V]}),e("span",{class:"filter-count",children:We(pe)})]},V)})]}),!!v.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:e(u,{id:"9veeTb"})})}),v.map(Q=>{const{authors:j,authorName:V,authorUrl:H,blurhash:pe,description:$,height:ie,image:Y,imageDescription:ee,language:he,providerName:le,providerUrl:J,publishedAt:Ae,title:ye,url:ve,width:Pe}=Q,_e=j?.[0]?.account?.id?j[0].account:null,Te=ye.length<30,xe=!!(V||_e),De=wi(ve);let Oe;if(pe){const Ue=Ti(pe),oe=Ui(Ue);Oe=Fi([.6,oe[1],oe[2]])}return e("div",{children:[e("a",{ref:I===ve?L:null,href:ve,target:"_blank",rel:"noopener",class:`link-block ${T?I===ve?"active":"inactive":""}`,style:Oe?{"--accent-color":`rgb(${Oe.join(",")})`,"--accent-alpha-color":`rgba(${Oe.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:Y,alt:ee,width:Pe,height:ie,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:De})," ",!!Ae&&e(P,{children:"· "}),!!Ae&&e(P,{children:e(_t,{datetime:Ae,format:"micro"})})]}),!!ye&&e("h1",{class:"title",lang:he,dir:"auto",title:ye,children:ye})]}),!!$&&e("p",{class:`description ${xe&&!Te?"":"more-lines"}`,lang:he,dir:"auto",title:$,children:$}),xe&&e(P,{children:[e("hr",{}),e("p",{class:"byline",children:e("small",{children:e(u,{id:"aavdrC",values:{0:_e?e(mt,{account:_e,showAvatar:!0}):H?e("a",{href:H,target:"_blank",rel:"noopener",children:V}):V}})})})]})]})]})}),M&&e("button",{type:"button",class:"small plain4 block",onClick:()=>{_(ve)},disabled:ve===I,children:[e(A,{icon:"comment2"})," ",e("span",{children:e(u,{id:"/bZzdR"})})," ",e(A,{icon:"chevron-down"})]})]},ve)})]}),M&&!!v.length&&e("div",{class:`timeline-header-block ${T?"blended":""}`,children:T?e(P,{children:[e("div",{style:{width:50,flexShrink:0,textAlign:"center"},children:g?e(Fe,{abrupt:!0}):e("button",{type:"button",class:"light",onClick:()=>{_(null)},children:e(A,{icon:"x",alt:o({id:"9Q/4xJ"})})})}),e("p",{children:e(u,{id:"BATCqf",values:{0:I.replace(/^https?:\/\/(www\.)?/i,"").replace(/\/$/,"")},components:{0:e("span",{class:"link-text"})}})})]}):e("p",{class:"insignificant",children:e(u,{id:"Vosm4k"})})})]}),[f,v,I,g]);return e(Et,{title:l,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:e(u,{id:"4/iCqx"})}),e("div",{children:p})]}),id:"trending",instance:p,emptyText:o({id:"6HA9+s"}),errorText:o({id:"scd9lw"}),fetchItems:T?F:b,checkForUpdates:T?void 0:q,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(P,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",timelineStart:X,refresh:I,clearWhenRefresh:!0,view:T?"link-mentions":void 0,headerEnd:e(lt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(A,{icon:"more",size:"l",alt:o({id:"2FYpfJ"})})}),children:[e(ge,{onClick:()=>{let Q=prompt(o({id:"2MQ2cd"}));if(!/\./.test(Q)){Q&&alert(o({id:"7WddtO"}));return}Q&&(Q=Q.toLowerCase().trim(),location.hash=`/${Q}/trending`)},children:[e(A,{icon:"bus"})," ",e("span",{children:e(u,{id:"Sq04Yc"})})]}),r!==p&&e(ge,{onClick:()=>{location.hash=`/${r}/trending`},children:[e(A,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:e(u,{id:"iAzCp4",values:{currentInstance:r},components:{0:e("b",{})}})})]})]})},p)}const ws={block:"nearest",inline:"nearest",behavior:"smooth"};function ud(){const{_:n}=ce();Qe(n({id:"i0qMbr"}),"/");const i=Ge(E),{shortcuts:o}=i,s=o.map(a=>{if(!a)return null;const{type:c,...p}=a,d={following:qi,notifications:To,list:vo,public:fi,bookmarks:fo,favourites:mo,hashtag:yo,mentions:ko,trending:Ro,search:xo}[c];return!d||c==="search"&&!p.query||c==="list"&&!p.id?null:e(d,{...p,columnMode:!0},c+JSON.stringify(p))});return Ke(["1","2","3","4","5","6","7","8","9"],a=>{try{const c=parseInt(a.key,10)-1,p=document.querySelectorAll("#columns > *")[c];p&&(p.focus(),p.scrollIntoView(ws))}catch{}},{useKey:!0,ignoreEventWhen:a=>a.metaKey||a.ctrlKey||a.altKey||a.shiftKey}),Ke(["[","]"],(a,c)=>{const p=c.keys[0],d=document.activeElement.closest("#columns > *"),r=Ft(),l=r?"]":"[",h=r?"[":"]";let m;p===l?m=d?d.previousElementSibling:document.querySelectorAll("#columns > *")[0]:p===h&&(m=d?d.nextElementSibling:document.querySelectorAll("#columns > *")[1]),m&&(m.focus(),m.scrollIntoView(ws))},{useKey:!0,ignoreEventWhen:a=>a.metaKey||a.ctrlKey||a.altKey||a.shiftKey}),e("div",{id:"columns",onContextMenu:a=>{a.target.closest(".deck > header")&&!a.target.closest("a")&&!a.target.closest("button")&&(a.preventDefault(),E.showShortcutsSettings=!0)},onFocus:()=>{const a=document.activeElement.closest("#columns > *");a&&document.querySelectorAll("#columns > *").forEach(c=>{c.classList.toggle("focus",c===a)})},children:s})}function hd(){const{_:n}=ce(),i=Ge(E);return __BENCHMARK.end("time-to-home"),G(()=>{(async()=>{const o=await gt.drafts.keys();if(o.length){const s=$n();o.filter(c=>c.startsWith(s)).length&&(E.showDrafts=!0)}})()},[]),e(P,{children:(i.settings.shortcutsViewMode==="multi-column"||!i.settings.shortcutsViewMode&&i.settings.shortcutsColumnsMode)&&i.shortcuts?.length?e(ud,{}):e(qi,{title:n({id:"i0qMbr"}),path:"/",id:"home",headerStart:!1,headerEnd:e(pd,{})})})}function pd(){const{_:n}=ce(),i=Ge(E),o=B(),[s,a]=R(void 0);return e(P,{children:[e(fe,{ref:o,to:"/notifications",class:`button plain notifications-button ${i.notificationsShowNew?"has-badge":""} ${s||""}`,onClick:c=>{c.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(c.preventDefault(),a(p=>p?void 0:"open"))},children:e(A,{icon:"notification",size:"l",alt:n({id:"iDNBZe"})})}),e(md,{state:s,anchorRef:o,onClose:()=>a(void 0)})]})}const fd=5;function md({anchorRef:n,state:i,onClose:o}){const{masto:s,instance:a}=se(),c=Ge(E),[p,d]=R("default"),r=Ao();async function l(){const S=await r.next(),b=So(S.value);if(b?.length){b.forEach(C=>{Je(C.status,a,{skipThreading:!0})});const g=Io(b);E.notificationsLast=g[0],E.notifications=g,s.v1.markers.create({notifications:{lastReadId:g[0].id}}).catch(()=>{})}return E.notificationsShowNew=!1,E.notificationsLastFetchTime=Date.now(),S}const[h,m]=R(!1);function f(){return s.v1.followRequests.list({limit:1})}function y({skipFollowRequests:S=!1}={}){d("loading"),(async()=>{try{if(await l(),!S){const b=await f();m(!!b?.length)}d("default")}catch{d("error")}})()}const v=B(),k=52;return G(()=>{i==="open"&&(c.notificationsShowNew?v.current?.scrollTop<=k&&y({skipFollowRequests:!0}):y())},[i,c.notificationsShowNew]),e(Ii,{ref:v,menuClassName:"notifications-menu",state:i,anchorRef:n,onClose:o,portal:{target:document.body},containerProps:{onClick:()=>{v.current?.closeMenu?.()}},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:e(u,{id:"iDNBZe"})})}),e(Hn.Provider,{value:"notifications",children:e("main",{children:c.notifications.length?e(P,{children:c.notifications.slice(0,fd).map(S=>e(un,{instance:a,notification:S,disableContextMenu:!0},S._ids||S.id))}):p==="loading"?e("div",{class:"ui-state",children:e(Fe,{abrupt:!0})}):p==="error"&&e("div",{class:"ui-state",children:[e("p",{children:e(u,{id:"5GFQTh"})}),e("p",{children:e("button",{type:"button",onClick:y,children:e(u,{id:"KDw4GX"})})})]})})}),e("footer",{children:[e(fe,{to:"/mentions",class:"button plain",children:[e(A,{icon:"at"})," ",e("span",{children:e(u,{id:"/bZzdR"})})]}),e(fe,{to:"/notifications",class:"button plain2",children:[h?e(u,{id:"OdVhdR",components:{0:e("span",{class:"tag collapsed"}),1:e("span",{})}}):e("b",{children:e(u,{id:"gukqfD"})})," ",e(A,{icon:"arrow-right"})]})]})]})}const gd=rt(hd),yd=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+\/post\/([^\/]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i,/^\/p\/[^\/]+\/([^\/]+)/i];function Lo(n){const i=URL.parse(n);if(!i)return{};const{hostname:o,pathname:s}=i;for(const a of yd){const[,c]=s.match(a)||[];if(c)return{instance:o,id:c}}return{}}function vd(n){const{instance:i,id:o}=Lo(n);return i&&o?`/${i}/s/${o}`:null}function bd(){const i=Qt().pathname.replace(/^\//,""),o=Lo(i),s=o?.instance?`/${o.instance}/s/${o.id}`:null,[a,c]=R("loading");return kt(()=>{c("loading"),(async()=>{try{const{instance:p,id:d}=o;if(d){const{masto:r}=se({instance:p});if(await r.v1.statuses.$select(d).fetch()){window.location.hash=s+"?view=full";return}}}catch{}{const{masto:p,instance:d}=se(),r=await p.v2.search.list({q:i,limit:1,resolve:!0});if(r.statuses.length){const l=r.statuses[0];window.location.hash=`/${d}/s/${l.id}?view=full`}else if(r.accounts.length){const l=r.accounts[0];window.location.hash=`/${d}/a/${l.id}`}else s?window.location.hash=s+"?view=full":c("error")}})()},[s]),e("div",{class:"ui-state",tabIndex:"-1",children:[a==="loading"?e(P,{children:[e(Fe,{abrupt:!0}),e("h2",{children:e(u,{id:"RTAr/z"})}),e("p",{children:e("a",{href:i,target:"_blank",rel:"noopener",children:i})})]}):e(P,{children:[e("h2",{children:e(u,{id:"ufzZSJ"})}),e("p",{children:e("a",{href:i,target:"_blank",rel:"noopener",children:i})})]}),e("hr",{}),e("p",{children:e(fe,{to:"/",children:e(u,{id:"iWpEwy"})})})]})}function wd(){const{_:n}=ce();Qe(n({id:"h16FyT"}),"/l");const[i,o]=R("default"),[s,a]=xt(h=>h+1,0),[c,p]=R([]);G(()=>{o("loading"),(async()=>{try{const h=await hi();p(h),o("default")}catch{o("error")}})()},[s]);const[d,r]=R(!1),l=c.some(h=>h.exclusive);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(Dt,{}),e(fe,{to:"/",class:"button plain",children:e(A,{icon:"home",size:"l"})})]}),e("h1",{children:e(u,{id:"h16FyT"})}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>r(!0),children:e(A,{icon:"plus",size:"l",alt:n({id:"Sb2gYF"})})})})]})}),e("main",{children:c.length>0?e(P,{children:[e("ul",{class:"link-list",children:c.map(h=>e("li",{children:e(fe,{to:`/l/${h.id}`,children:[e(A,{icon:"list"})," ",e("span",{children:[h.title,h.exclusive&&e(P,{children:[" ",e(Kt,{insignificant:!0})]})]})]})}))}),c.length>1&&e("footer",{class:"ui-state",children:[l&&e("p",{children:e("small",{class:"insignificant",children:[e(Kt,{})," ",e(u,{id:"FNptcJ"})]})}),e("p",{children:e("small",{class:"insignificant",children:e(u,{id:"8prZNK",values:{0:c.length}})})})]})]}):i==="loading"?e("p",{class:"ui-state",children:e(Fe,{})}):i==="error"?e("p",{class:"ui-state",children:e(u,{id:"v/l5uA"})}):e("p",{class:"ui-state",children:e(u,{id:"IvPikw"})})})]}),d&&e(qe,{onClick:h=>{h.target===h.currentTarget&&r(!1)},children:e(zi,{list:d?.list,onClose:h=>{h.state==="success"&&a(),r(!1)}})})]})}const Sd=""+new URL("instances-Dd-nff5Z.json",import.meta.url).href,kd={BASE_URL:"./",DEV:!1,MODE:"production",PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",PHANPY_TRANSLANG_INSTANCES:"translang.phanpy.social",PHANPY_WEBSITE:"https://phanpy.blaede.family",PROD:!0,SSR:!1,VITE_APP_ENV:"production"},{PHANPY_DEFAULT_INSTANCE:_d}=kd;function Cd(){const{_:n}=ce();Qe(n({id:"sQia9P"}),"/login");const i=B(),o=Ee.local.get("instanceURL"),[s,a]=R("default"),[c]=bt(),p=c.get("instance"),d=c.get("submit"),[r,l]=R(p||o?.toLowerCase()||""),[h,m]=R([]),f=B();G(()=>{(async()=>{try{const w=await(await fetch(Sd)).json();m(w),f.current=new wa(w)}catch{}})()},[]);const y=C=>{C&&(async()=>{try{const I=await(await fetch(`https://${C}/.well-known/host-meta`)).text(),M=new DOMParser().parseFromString(I,"text/xml").getElementsByTagName("Link")[0].getAttribute("template"),K=URL.parse(M),{host:F}=K;C!==F&&(C=F)}catch{}Ee.local.set("instanceURL",C),a("loading");try{let w=Ps(C);(!w||!w.client_id||!w.client_secret)&&(w=await Qa({instanceURL:C}),Vo(C,w));const{client_id:I,client_secret:_}=w,T=await Va({instanceURL:C}),L=Go(C);if(T)if(I&&_){const[M,K]=await ec({instanceURL:C,client_id:I,forceLogin:L});Ee.sessionCookie.set("codeVerifier",K),location.href=M}else alert(n({id:"ZP1FIA"}));else I&&_?location.href=await tc({instanceURL:C,client_id:I,forceLogin:L}):alert(n({id:"ZP1FIA"}));a("default")}catch{a("error")}})()},v=r?r.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,k=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(v)&&!/[\s\/\\@]/.test(v),S=v?f.current?.search(v,{limit:10})?.map(C=>C.item):[],b=k?v:S?.length?S[0]:r?h.find(C=>C.includes(r)):null,g=C=>{C.preventDefault(),y(b)};return d&&G(()=>{y(p||b)},[]),e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:g,children:[e("h1",{children:[e("img",{src:Pi,alt:"",width:"80",height:"80"}),e("br",{}),e(u,{id:"sQia9P"})]}),e("label",{children:[e("p",{children:e(u,{id:"kyAi7k"})}),e("input",{value:r,required:!0,type:"text",class:"large",id:"instanceURL",ref:i,disabled:s==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellCheck:!1,placeholder:n({id:"u3gOdY"}),onInput:C=>{l(C.target.value)},dir:"auto"}),S?.length>0?e("ul",{id:"instances-suggestions",children:S.map((C,w)=>e("li",{children:e("button",{type:"button",class:"plain5",onClick:()=>{y(C)},children:C})}))}):e("div",{id:"instances-eg",children:e(u,{id:"/OvbEC"})})]}),s==="error"&&e("p",{class:"error",children:e(u,{id:"rmBHZn"})}),e("div",{children:[e("button",{disabled:s==="loading"||!r||!b,children:n(b?{id:"2xahsi",values:{selectedInstanceText:b}}:{id:"xGVfLh"})})," "]}),e(Fe,{hidden:s!=="loading"}),e("hr",{}),!_d&&e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:e(u,{id:"LcOiWS"})})}),e("p",{children:e(fe,{to:"/",children:e(u,{id:"iWpEwy"})})}),e(Di,{})]})})}const Ad=40;function Id(){const{_:n}=ce(),i=Ge(E);Qe(n({id:"+GkIdc"}),"/sp");const{masto:o}=se(),[s,a]=R([]),[c,p]=R("default"),[d,r]=xt(m=>m+1,0),[l,h]=R(!1);return G(r,[i.reloadScheduledPosts]),G(()=>{p("loading"),(async()=>{try{const m=o.v1.scheduledStatuses.list({limit:Ad}).values(),f=[];let y;do y=(await m.next()).value,y?.length&&f.push(...y);while(y?.length);a(f)}catch{p("error")}finally{p("default")}})()},[d]),e("div",{id:"scheduled-posts-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(Dt,{}),e(fe,{to:"/",class:"button plain",children:e(A,{icon:"home",size:"l",alt:n({id:"i0qMbr"})})})]}),e("h1",{children:e(u,{id:"+GkIdc"})}),e("div",{class:"header-side",children:e(lt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(A,{icon:"more",size:"l",alt:n({id:"2FYpfJ"})})}),children:e(ge,{onClick:()=>{r()},children:[e(A,{icon:"refresh",size:"l"}),e("span",{children:e(u,{id:"lCF0wC"})})]})})})]})}),e("main",{children:[s.length?e("ul",{class:"posts-list",children:s.map(m=>{const{id:f,params:y,scheduledAt:v,mediaAttachments:k}=m,{inReplyToId:S,language:b,poll:g,sensitive:C,spoilerText:w,text:I,visibility:_}=y,T={id:f,inReplyToId:S,language:b,mediaAttachments:k,poll:g?{...g,expiresAt:new Date(Date.now()+g.expiresIn*1e3),options:g.options.map(L=>({title:L,votesCount:0}))}:void 0,sensitive:C,spoilerText:w,text:I,visibility:_,content:`<p>${I}</p>`};return e("li",{children:e(Td,{status:T,scheduledAt:v,onClick:()=>{h({post:T,scheduledAt:new Date(v)})}})},f)})}):e("p",{class:"ui-state",children:c==="loading"?e(Fe,{}):n({id:"mZYb1f"})}),l&&e(qe,{onClick:m=>{m.target===m.currentTarget&&h(!1)},children:e(xd,{post:l.post,scheduledAt:l.scheduledAt,onClose:()=>h(!1)})})]})]})})}function Td({status:n,scheduledAt:i,onClick:o}){const s=Se(()=>{const a=(Date.parse(i)-Date.now())/36e5;return a<24?"time":a<720?"day":"month"},[i]);return e("button",{type:"button",class:"textual block",onClick:o,children:[e("div",{class:`post-schedule-meta post-schedule-${s}`,children:[e(A,{icon:s,class:"insignificant"})," ",e("span",{children:e(u,{id:"aEp6lO",values:{0:st(i,{formatOpts:{weekday:"short",second:"numeric"}})},components:{0:e("b",{}),1:e(_t,{datetime:i}),2:e("small",{})}})})]}),e(je,{status:n,size:"s",previewMode:!0,readOnly:!0})]})}function xd({post:n,scheduledAt:i,onClose:o}){const{masto:s}=se(),{_:a}=ce(),[c,p]=R("default"),[d,r]=R(),l=d&&d.getTime()!==i.getTime(),h=Sa(),m=i&&i<=Date.now(),{inReplyToId:f}=n,[y,v]=R(null);return e("div",{id:"scheduled-post-sheet",class:"sheet",children:[e("button",{type:"button",class:"sheet-close",onClick:o,children:e(A,{icon:"x",size:"l",alt:a({id:"yz7wBu"})})}),e("header",{children:e("h2",{children:[e(u,{id:"orjBLU",components:{0:e("b",{}),1:e(_t,{datetime:i})}}),e("br",{}),e("small",{children:st(i,{formatOpts:{weekday:"short",second:"numeric"}})})]})}),e("main",{tabIndex:"-1",children:[!!y&&e("div",{class:"status-reply",children:e(je,{status:y,size:"s",previewMode:!0,readOnly:!0})}),e(je,{status:n,size:"s",previewMode:!0,readOnly:!0,onMediaClick:(k,S,b,g)=>{k.preventDefault(),E.showMediaModal={mediaAttachments:n.mediaAttachments,mediaIndex:S}}}),e("form",{onSubmit:k=>{k.preventDefault(),p("loading"),(async()=>{try{await s.v1.scheduledStatuses.$select(n.id).update({scheduledAt:d.toISOString()}),re(a({id:"40naR1"})),o(),p("default"),E.reloadScheduledPosts++}catch{p("error"),re(a({id:"ZM3jAs"}))}})()},children:e("footer",{children:[e("div",{class:"row",children:e("span",{children:[e(ka,{scheduledAt:i,setScheduledAt:k=>{r(k)}})," ",e("small",{class:"ib",children:h})]})}),e("div",{class:"row",children:[e("button",{disabled:!l||c==="loading"||m,children:e(u,{id:"QqW27M"})}),e("span",{class:"grow"}),e(ft,{align:"end",menuItemClassName:"danger",confirmLabel:a({id:"09u3Kk"}),onClick:()=>{p("loading"),(async()=>{try{await se().masto.v1.scheduledStatuses.$select(n.id).remove(),re(a({id:"/zL/Mq"})),o(),p("default"),E.reloadScheduledPosts++}catch{p("error"),re(a({id:"aOh6Md"}))}})()},children:e("button",{type:"button",class:"light danger",disabled:c==="loading"||m,children:e(u,{id:"Jb6/SB"})})})]})]})})]})]})}function Ed(){const{_:n}=ce(),{prevEditedAt:i,nextEditedAt:o,editedAtIndex:s,editHistoryMode:a,editHistoryRef:c,exitEditHistory:p}=Ys();return a?e("div",{class:"edit-history-controls",children:[e(A,{icon:"edit"}),e("b",{class:"edit-history-heading",children:n({id:"HSA2au"})}),e("span",{class:"spacer"}),e("span",{class:"edit-history-pagination",children:[e("button",{type:"button",class:"plain4",onClick:()=>{i()},disabled:!a||s+1>=c.current.length,children:e(A,{icon:"chevron-left",alt:n({id:"DHhJ7s"})})})," ",c.current.length-s," /"," ",c.current.length," ",e("button",{type:"button",class:"plain4",onClick:()=>{o()},disabled:!a||s<=0,children:e(A,{icon:"chevron-right",alt:n({id:"hXzOVo"})})})]}),e("button",{type:"button",class:"plain3",onClick:()=>{p()},children:e(A,{icon:"exit",alt:n({id:"ydzS9x"})})})]}):null}const Rd={BASE_URL:"./",DEV:!1,MODE:"production",PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",PHANPY_TRANSLANG_INSTANCES:"translang.phanpy.social",PHANPY_WEBSITE:"https://phanpy.blaede.family",PROD:!0,SSR:!1,VITE_APP_ENV:"production"},{PHANPY_DEFAULT_INSTANCE:Ss}=Rd,Sn=40,Ld=10,Md=5;let mi={},xn={},En={};function Rn(n){delete xn[n],delete En[n]}const nn={block:"nearest",inline:"center",behavior:"smooth"},ks=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",_s=/\/s\//i;function $d(n){const{id:i}=n,{masto:o,instance:s}=se({instance:n.instance}),a=Ge(E),[c,p]=bt(),d=c.get("media"),r=c.get("media-only"),l=parseInt(d||r,10);let h=l>0;const m=c.get("mediaStatusID"),f=Ns(m,s);m&&!f&&(h=!1);const y=h&&!!r,v=ct(i,s),[k,S]=R(E.statuses[v]);G(()=>{E.statuses[v]&&S(E.statuses[v])},[v]);const b=Se(()=>{const{prevLocation:_}=E,T=(_?.pathname||"")+(_?.search||""),L=cn("/:instance/s/:id",T)||cn("/s/:id",T);return!T||L?"/":T},[]);G(()=>{!k&&h&&(async()=>{try{const _=await o.v1.statuses.$select(i).fetch();Je(_,s),S(_)}catch{alert("Unable to load post."),location.hash=b}})()},[h]);const g=m?a.statuses[ct(m,s)]?.mediaAttachments:k?.mediaAttachments,C=()=>window.matchMedia("(min-width: calc(40em + 350px))").matches?"large":"small",w=nt(()=>{C()==="small"&&a.prevLocation?history.back():y?location.hash=b:(c.delete("media"),c.delete("mediaStatusID"),p(c))},[y,b,a.prevLocation]),I=nt((_,T,L,M)=>{if(C()==="large"&&!y){w();return}if(h&&document.startViewTransition){const K=L[T],{id:F,blurhash:q,url:X}=K,Q=_a(F||q||X),V=[...document.querySelectorAll(`.status .media [data-view-transition-name="${Q}"]`)].filter?.(pe=>{const $=pe.getBoundingClientRect();return $.top<window.innerHeight&&$.bottom>0&&$.left<window.innerWidth&&$.right>0}),H=V.length===1?V[0]:V.find(pe=>!!pe.closest(".status-deck"));H?document.startViewTransition(()=>{H.style.viewTransitionName=Q,M?.current&&M.current.querySelectorAll(".media img, .media video")?.forEach($=>{$.style.viewTransitionName=""}),w()}).ready.finally(()=>{H.style.viewTransitionName="",H.dataset.viewTransitioned=Q}):w()}else w()},[h,y]);return G(()=>{let _=setTimeout(()=>{const T=document.querySelector(".carousel");T&&T.focus()},100);return()=>clearTimeout(_)},[y]),G(()=>{const _=document.querySelectorAll(".deck-container");return _.forEach(T=>{T.setAttribute("inert","")}),()=>{_.forEach(T=>{T.removeAttribute("inert")})}},[]),e("div",{class:"deck-backdrop",children:[h?g?.length?e(ro,{mediaAttachments:g,statusID:m||i,instance:s,lang:k?.language,index:l-1,onClose:I}):e("div",{class:"media-modal-container loading",children:e(Fe,{abrupt:!0})}):e(fe,{to:b}),!y&&e(Ca,{statusID:i,children:e(Pd,{id:i,instance:n.instance,closeLink:b})})]})}function Nd(n){const{linkable:i,to:o,onClick:s,...a}=n;return i?e(fe,{class:"status-link",to:o,onClick:s,...a}):e("div",{class:"status-focus",tabIndex:0,...a})}function Cs(n,i){return Date.parse(n.createdAt)-Date.parse(i.createdAt)}const As=1e3*60*60*24*30;function Pd({id:n,closeLink:i="/",instance:o}){const{_:s}=ce(),[a,c]=bt(),p=a.get("media"),d=a.get("mediaStatusID"),r=parseInt(p,10)>0,l=B(!E.prevLocation&&(history.length===1||"navigation"in window&&navigation?.entries?.()?.length===1)),[h,m]=R(a.get("view")||l.current?"full":null),f=!!parseInt(a.get("translate")),{masto:y,instance:v}=se({instance:o}),{masto:k,instance:S,authenticated:b}=se(),g=v===S,C=Ge(E),[w,I]=R([]),[_,T]=R("default"),L=B(),M=ct(n,v),K=B(0),F=B();G(()=>{F.current?.focus()},[]),G(()=>{const N=js(()=>{if(!F.current)return;const{scrollTop:ae}=F.current;_!=="loading"&&(En[n]=ae)},50);return F.current?.addEventListener("scroll",N,{passive:!0}),N(),()=>{N.cancel(),F.current?.removeEventListener("scroll",N)}},[n,_!=="loading"]);const{editHistoryMode:q,initEditHistory:X,editedAtIndex:Q,editHistoryRef:j}=Ys(),V=B(),H=B(),[pe,$]=R(0),ie=B(null),Y=()=>{if(!ie.current)return;let{ancestors:N,descendants:ae,heroStatus:x}=ie.current;if(q&&ae?.length){const Z=j.current[Q],te=Date.parse(Z.createdAt),we=j.current[Q-1],Me=we?Date.parse(we.createdAt):null;ae=ae.filter(Ve=>{const ot=Date.parse(Ve.editedAt||Ve.createdAt);return ot>=te&&(!Me||ot<=Me)})}N.sort(Cs),ae.sort(Cs),K.current=ae?.length||0;const U=new Set;N.forEach(Z=>{Je(Z,v,{skipThreading:!0}),Z.inReplyToId&&!N.find(te=>te.id===Z.inReplyToId)&&U.add(Z.inReplyToId)});const W=N.every(Z=>Z.account.id===x.account.id),ne=[];ae.forEach(Z=>{if(Je(Z,v,{}),Z.inReplyToId&&!ae.find(te=>te.id===Z.inReplyToId)&&Z.inReplyToId!==x.id&&U.add(Z.inReplyToId),Z.inReplyToAccountId===Z.account.id)ne.push(Z);else if(Z.inReplyToId===x.id)ne.push(Z);else if(!Z.inReplyToAccountId&&ne.find(te=>te.id===Z.inReplyToId&&te.account.id===x.account.id)&&Z.account.id===x.account.id)ne.push(Z);else{const te=ae.find(we=>we.id===Z.inReplyToId);te&&(te.__replies||(te.__replies=[]),te.__replies.push(Z))}}),ne.sort((Z,te)=>{const we=x.account.id;return Z.account.id===we&&te.account.id!==we?-1:te.account.id===we&&Z.account.id!==we?1:0}),U.size;let D=1;function de(Z,te){const we=te+1;return we>D&&(D=te),Z?.map(Me=>({id:Me.id,account:Me.account,repliesCount:Me.repliesCount,content:Me.content,weight:an(Me),level:we,replies:de(Me.__replies,we)}))}const Ie=ne.map(Z=>({id:Z.id,account:Z.account,accountID:Z.account.id,descendant:!0,thread:Z.account.id===x.account.id,weight:an(Z),level:1,replies:de(Z.__replies,1),createdAt:Z.createdAt}));return{allStatuses:[...N.map(Z=>({id:Z.id,ancestor:!0,isThread:W,accountID:Z.account.id,account:Z.account,repliesCount:Z.repliesCount,weight:an(Z),createdAt:Z.createdAt})),{id:n,accountID:x.account.id,weight:an(x),createdAt:x.createdAt},...Ie],ancestorsIsThread:W,mappedNestedDescendants:Ie}},ee=({reloadHero:N}={})=>{T("loading");let ae;const x=xn[n];if(x){const U=x.filter(W=>E.statuses[M]);I(U)}else I([{id:n}]);return(async()=>{const U=()=>Gi(()=>y.v1.statuses.$select(n).fetch(),{retries:4}),W=Gi(()=>y.v1.statuses.$select(n).context.fetch(),{retries:8}),ne=!!C.statuses[M];let D=C.statuses[M];if(!(ne&&!N))try{D=await U(),Je(D,v),await new Promise(de=>{setTimeout(de,100)})}catch{T("error");return}try{const de=await W,{ancestors:Ie}=de;ie.current={...de,heroStatus:D};const{allStatuses:me,ancestorsIsThread:Z,mappedNestedDescendants:te}=Y(),we=Ie.length&&!Z?[]:te.filter(ot=>ot.thread),Me=(Z?Ie.length:0)+we.length;Me>0&&Me<100&&$(Me+1),T("default"),V.current={offsetTop:L.current?.offsetTop,scrollTop:F.current?.scrollTop};const Ve=Ie.length||0;Ve>=_e&&Te(Ve+1),I(me),xn[n]=me,Wo(D,v)}catch{T("error")}})(),H.current=Date.now(),()=>{clearTimeout(ae)}};G(ee,[n,y]),G(()=>{try{const{allStatuses:N}=Y();I(N)}catch{}},[q,Q]);const[he,le]=R(!1);G(()=>{let N=setInterval(()=>{const ae=Date.now();H.current&&ae-H.current>=6e4&&le(!0)},6e4);return()=>{clearInterval(N)}},[]),kt(()=>{if(!w.length)return;const N=En[n];if(N)F.current.scrollTop=N;else if(V.current){const ae={offsetTop:L.current?.offsetTop,scrollTop:F.current?.scrollTop},x=ae.offsetTop-V.current.offsetTop+ae.scrollTop;F.current.scrollTop=x}else w.length===1&&(F.current.scrollTop=0);V.current=null},[w]),G(()=>{C.reloadStatusPage<=0||(async()=>{try{const{instanceURL:N}=Si(),ae=`https://${N}/api/v1/statuses/${n}/context`;return await(await caches.open("api")).delete(ae,{ignoreVary:!0}),ee({reloadHero:!0})}catch{}})()},[C.reloadStatusPage]),G(()=>()=>{En={},E.reloadStatusPage=0,xn={},mi={},gi.clear()},[]);const J=C.statuses[M]||C.statuses[n],Ae=Se(()=>{if(!J)return"";const{account:N}=J,ae=document.createElement("div");return ae.innerHTML=N.displayName,ae.innerText.trim()},[J]),ye=Se(()=>{if(!J)return"";let N=qn(J);return N.length>64&&(N=N.slice(0,64)+"…"),N},[J]);Qe(Ae&&ye?`${Ae}: "${ye}"`:s({id:"post.title"}),"/:instance?/s/:id");const ve=Se(()=>{if(!J)return;const{url:N}=J;if(N)return URL.parse(N)?.hostname},[J]),Pe=Se(()=>{if(ve)return ve===v},[ve,v]),[_e,Te]=R(Sn),xe=Se(()=>w.length-_e,[w.length,_e]),De=w.some(N=>N.descendant),Oe=w.filter(N=>N.ancestor),[Ue,oe]=R(!0),Re=Se(()=>{if(!L.current||Ue)return null;const{top:N}=L.current.getBoundingClientRect();return N>0?"down":"up"},[Ue]);Ke("esc",()=>{location.hash=i},{enabled:!r,ignoreEventWhen:N=>!!document.querySelector("#modal-container > *")||N.metaKey||N.ctrlKey||N.altKey||N.shiftKey,useKey:!0}),Ke("backspace",()=>{location.hash=i},{useKey:!0,ignoreEventWhen:N=>N.metaKey||N.ctrlKey||N.altKey||N.shiftKey}),Ke("j",()=>{const N=document.activeElement.closest(".status-link, .status-focus"),ae=N?.getBoundingClientRect(),x=Array.from(F.current.querySelectorAll(ks));if(N&&ae.top<F.current.clientHeight&&ae.bottom>0){const U=x.indexOf(N);let W=x[U+1];W&&(W.focus(),W.scrollIntoView(nn))}else{const U=x.find(W=>{const ne=W.getBoundingClientRect();return ne.top>=44&&ne.left>=0});U&&(U.focus(),U.scrollIntoView(nn))}},{useKey:!0,ignoreEventWhen:N=>N.metaKey||N.ctrlKey||N.altKey||N.shiftKey}),Ke("k",()=>{const N=document.activeElement.closest(".status-link, .status-focus"),ae=N?.getBoundingClientRect(),x=Array.from(F.current.querySelectorAll(ks));if(N&&ae.top<F.current.clientHeight&&ae.bottom>0){const U=x.indexOf(N);let W=x[U-1];W&&(W.focus(),W.scrollIntoView(nn))}else{const U=x.find(W=>{const ne=W.getBoundingClientRect();return ne.top>=44&&ne.left>=0});U&&(U.focus(),U.scrollIntoView(nn))}},{useKey:!0,ignoreEventWhen:N=>N.metaKey||N.ctrlKey||N.altKey||N.shiftKey}),Ke("x",()=>{const N=document.activeElement.closest(".status-link, .status-focus");if(N){const ae=N.nextElementSibling;ae&&ae.tagName.toLowerCase()==="details"&&(ae.open=!ae.open)}},{useKey:!0,ignoreEventWhen:N=>N.metaKey||N.ctrlKey||N.altKey||N.shiftKey});const[$e,Ce]=R(!1),z=B(r?"media+status":"status"),be=nt((N,ae,x,U)=>{N.preventDefault(),N.stopPropagation(),c({media:ae+1,mediaStatusID:U.id})},[n]),Le=nt((N,ae)=>{Rn(ae.id)},[]);G(()=>{let N;return d&&r&&(N=setTimeout(()=>{const ae=F.current?.querySelector(`.status-link[href*="/${d}"]`);ae&&ae.scrollIntoView(nn)},400)),()=>{clearTimeout(N)}},[d,r]);const Ne=nt((N,ae)=>{const{id:x,ancestor:U,isThread:W,descendant:ne,thread:D,replies:de,repliesCount:Ie,weight:me,level:Z}=N,te=x===n;return e("li",{ref:te?L:null,class:`${U?"ancestor":""} ${ne?"descendant":""} ${D?"thread":""} ${te?"hero":""}`,children:[te?e(P,{children:[e(Tt,{threshold:.1,onChange:Me=>{queueMicrotask(()=>{requestAnimationFrame(()=>{oe(Me)})})},class:"status-focus",tabIndex:0,children:e(je,{statusID:x,instance:v,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:f})}),_!=="loading"&&!b?e("div",{class:"post-status-banner",children:[e("p",{children:e(u,{id:"Vyeh4F"})}),e(fe,{to:Ss?`/login?instance=${Ss}&submit=1`:"/login",class:"button",children:e(u,{id:"sQia9P"})})]}):!g&&e("div",{class:"post-status-banner",children:[e("p",{children:e(u,{id:"j5roNG",values:{instance:v},components:{0:e("b",{})}})}),e("button",{type:"button",disabled:_==="loading",onClick:()=>{T("loading"),(async()=>{try{const Me=await k.v2.search.list({q:J.url,type:"statuses",resolve:!0,limit:1});if(Me.statuses.length){const Ve=Me.statuses[0];location.hash=S?`/${S}/s/${Ve.id}`:`/s/${Ve.id}`}else throw new Error("No results")}catch(Me){T("default"),alert(s({id:"DnepCE",values:{e:Me}}))}})()},children:[e(A,{icon:"transfer"})," ",e(u,{id:"ejAVrO"})]})]})]}):e(Nd,{linkable:W||U,to:v?`/${v}/s/${x}`:`/s/${x}`,onClick:()=>{Rn(x)},children:[ae===0&&U?e(Tt,{threshold:.5,onChange:Me=>{queueMicrotask(()=>{requestAnimationFrame(()=>{Ce(Me)})})},children:e(je,{statusID:x,instance:v,withinContext:!0,size:D||U?"m":"s",enableTranslate:!0,onMediaClick:be,onStatusLinkClick:Le})}):e(je,{statusID:x,instance:v,withinContext:!0,size:D||U?"m":"s",enableTranslate:!0,onMediaClick:be,onStatusLinkClick:Le,showActionsBar:!!ne}),U&&Ie>1&&e("div",{class:"replies-link",children:[e(A,{icon:"comment2",alt:s({id:"N8UzTV"})})," ",e("span",{title:Ie,children:We(Ie)})]})," "]}),ne&&de?.length>0&&e(Mo,{instance:v,replies:de,hasParentThread:D,level:Z,accWeight:me,openAll:K.current<Ld,parentLink:{to:v?`/${v}/s/${x}`:`/s/${x}`,onClick:()=>Rn(x)}}),_==="loading"&&te&&!!J?.repliesCount&&!De&&e("div",{class:"status-loading",children:e(Fe,{abrupt:J.repliesCount>=3})}),_==="error"&&te&&!!J?.repliesCount&&!De&&e("div",{class:"status-error",children:[e(u,{id:"HQJU6W"}),e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{E.reloadStatusPage++},children:e(u,{id:"KDw4GX"})})]})]},x)},[n,v,_,b,g,f,be,Le,De]),O=Se(()=>{if("navigation"in window&&navigation?.entries){const N=navigation.entries()[navigation.currentEntry.index-1];if(N?.url)return _s.test(N.url)}return _s.test(E.prevLocation?.pathname)},[M]),ke=Se(()=>{if(!xe)return[];const N=[];function ae(x){N.push(x.id),x.replies&&x.replies.forEach(ae)}return w.slice(_e).forEach(ae),N.map(x=>ct(x,v))},[xe,w,_e,v]);function Be(N){if(N<12)return ue._({id:"DqsEm+",values:{months:N}});{const ae=Math.floor(N/12);return ue._({id:"24w+FD",values:{years:ae}})}}const ze=Se(()=>{const N=[],ae=w.slice(0,_e);for(let x=0;x<ae.length;x++){const U=ae[x];if(x>0){const W=ae[x-1],{createdAt:ne,descendant:D,thread:de,id:Ie}=U;if(W?.createdAt&&ne){const me=Date.parse(ne);if(isFinite(me)&&me>As){const Z=Date.parse(W.createdAt);if(Z&&isFinite(Z)){const{ancestor:te,id:we}=W,Ve=~~((me-Z)/As);Ve>0&&N.push(e("li",{style:{"--time-gap-range":Math.min(12,Ve)},class:`time-gap ${te?"ancestor":""} ${D?"descendant":""} ${de?"thread":""}`,children:Be(Ve)},`time-gap-${Ie}-${we}`))}}}}N.push(Ne(U,x))}return N},[w,_e,Ne,q,Q]);return G(()=>{let N=setTimeout(()=>{if(!L.current)return;const ae=L.current.querySelector(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)");ae&&ae.click()},1e3);return()=>clearTimeout(N)},[n]),e(Aa.Provider,{value:pe,children:e("div",{tabIndex:"-1",ref:F,class:`status-deck deck contained ${w.length>1?"padded-bottom":""} ${z.current==="status"&&!l.current?"slide-in":""} ${h?`deck-view-${h}`:""} ${q?"edit-history-mode":""}`,style:q?{"--edit-history-percentage":`${Q/(j.current.length-1)}`}:void 0,onAnimationEnd:N=>{z.current==="status"&&(z.current=null)},children:[e("header",{class:`${_==="loading"?"loading":""}`,onDblClick:N=>{E.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[O&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(A,{icon:"chevron-left",size:"xl",alt:s({id:"iH8pgl"})})}),!Ue&&J&&_!=="loading"?e(P,{children:[e("span",{class:"hero-heading",children:[e(mt,{account:J.account,instance:v,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(_t,{datetime:J.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:N=>{N.preventDefault(),N.stopPropagation(),L.current.scrollIntoView({behavior:"smooth",block:"start"})},title:s({id:"NCy+Nw"}),children:e(A,{icon:Re==="down"?"arrow-down":"arrow-up"})})]}):e(P,{children:[e(u,{id:"post.title"})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:N=>{N.preventDefault(),N.stopPropagation(),F.current.scrollTo({top:0,behavior:"smooth"})},hidden:!Oe.length||$e,title:s({id:"R8CUl0",values:{0:Oe.length}}),children:[e(A,{icon:"arrow-up"}),Oe.filter((N,ae,x)=>x.findIndex(U=>U.accountID===N.accountID)===ae).slice(0,3).map(N=>e(pt,{url:N.account.avatarStatic||N.account.avatar,alt:N.account.displayName,squircle:N.account?.bot},N.account.id)),Oe.length>3&&e(P,{children:[" ",e("span",{class:"insignificant",children:We(Oe.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:h==="full"?"":"none"},onClick:()=>{m(null),a.delete("media"),a.delete("media-only"),a.delete("view"),c(a)},title:s({id:"+/xYEI"}),children:e(A,{icon:"layout4",size:"l"})}),he&&e("button",{type:"button",class:"plain button-refresh",onClick:()=>{E.reloadStatusPage++,le(!1)},children:e(A,{icon:"refresh",size:"l",alt:s({id:"lCF0wC"})})}),e(lt,{align:"end",portal:{target:F.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(A,{icon:"more",alt:s({id:"2FYpfJ"}),size:"xl"})}),children:[e(ge,{disabled:_==="loading",onClick:()=>{E.reloadStatusPage++},children:[e(A,{icon:"refresh"}),e("span",{children:e(u,{id:"lCF0wC"})})]}),e(ge,{className:"menu-switch-view",onClick:()=>{m(h==="full"?null:"full"),a.delete("media"),a.delete("media-only"),h==="full"?a.delete("view"):a.set("view","full"),c(a)},children:[e(A,{icon:{"":"layout5",full:"layout4"}[h||""]}),e("span",{children:s(h==="full"?{id:"+/xYEI"}:{id:"2LiWsE"})})]}),e(ge,{onClick:()=>{Array.from(F.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(ae=>{ae.click()})},children:[e(A,{icon:"eye-open"})," ",e("span",{children:e(u,{id:"8r8KmB"})})]}),e(Ye,{}),e(xi,{className:"plain",children:e(u,{id:"Rsjgm0"})}),e(ge,{disabled:!ve||Pe,onClick:()=>{const N=vd(J.url);N?location.hash=N:alert(s({id:"9J6biQ"}))},children:[e(A,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:s(ve?{id:"Kp9SAs",values:{0:Bn.toUnicode(ve)}}:{id:"lb07+k"})})]}),e(ge,{disabled:!g||_==="loading"||!J?.editedAt||!K.current,onClick:X,children:[e(A,{icon:"edit"}),e("span",{children:s({id:"OqaQnE"})})]})]}),e(fe,{class:"button plain deck-close",to:i,children:e(A,{icon:"x",size:"xl",alt:s({id:"yz7wBu"})})})]})]})}),e(Ed,{}),w.length&&J?e("ul",{class:`timeline flat contextual grow ${_==="loading"?"loading":""}`,children:[ze,xe>0&&e("li",{class:"descendant descendant-more",children:e("button",{type:"button",class:"plain block show-more",disabled:_==="loading",onClick:()=>Te(N=>N+Sn),style:{marginBlockEnd:"6em"},"data-state-post-ids":ke.join(" "),children:[e("div",{class:"ib avatars-bunch",children:w.slice(_e,_e+5).map(N=>e(pt,{url:N.account.avatarStatic},N.id))})," ",e("div",{class:"ib",children:[e(u,{id:"uXRAkV"})," ",e("span",{class:"tag",children:xe>Sn?`${Sn}+`:xe})]})]})})]}):e(P,{children:[_==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(je,{skeleton:!0,size:"l"})})}),_==="error"&&e("p",{class:"ui-state",children:[e(u,{id:"JWxodU"}),e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{E.reloadStatusPage++},children:e(u,{id:"KDw4GX"})})]})]})]})})}function Mo({replies:n,instance:i,hasParentThread:o,level:s,accWeight:a,openAll:c,parentLink:p}){const{_:d}=ce(),[r,l]=bt(),h=T=>T.reduce((L,M)=>{const{repliesCount:K,replies:F}=M,q=F?.length||K;return L+q+h(F||[])},0),m=n.length+h(n),f=n.length===m,y=n.map(T=>T.account).filter((T,L,M)=>M.findIndex(K=>K.id===T.id)===L).slice(0,3),v=Se(()=>n?.reduce((T,L)=>T+L?.weight,a),[a,n?.length]);let k=!1;(c||v<=Md||!o&&m===1&&an(n[0])<2)&&(k=!0);const S=mi[n[0].id],b=nt((T,L,M,K)=>{T.preventDefault(),T.stopPropagation(),l({media:L+1,mediaStatusID:K.id})},[]),g=B();kt(()=>{function T(L){L.target.dataset.scrollLeft=L.target.scrollLeft}return g.current?.addEventListener("scroll",T,{passive:!0}),()=>{g.current?.removeEventListener("scroll",T)}},[]);const[C,w]=R(S||k);G(()=>{let T;return!S&&!k&&(T=setTimeout(()=>w(!0),100)),()=>clearTimeout(T)},[S,k]);const I=k?"div":"details",_=I==="details";return e(I,{ref:g,class:"replies",open:_?S||k:void 0,onToggle:_?T=>{const{open:L}=T.target;mi[n[0].id]=L}:void 0,style:{"--comments-level":s},"data-comments-level":s,"data-comments-level-overflow":s>4,children:[!k&&e("summary",{class:"replies-summary",hidden:k,children:[e("span",{class:"avatars",children:y.map(T=>e(pt,{url:T.avatarStatic,title:`${T.displayName} @${T.username}`,squircle:T?.bot},T.id))}),e("span",{class:"replies-counts",children:[e("b",{children:e(u,{id:"DOQUen",values:{0:n.length,1:We(n.length)},components:{0:e("span",{title:n.length})}})}),!f&&m>1&&e(P,{children:[" ","·"," ",e("span",{children:e(u,{id:"qSQQSe",values:{0:We(m),totalComments:m},components:{0:e("span",{title:m})}})})]})]}),e(A,{icon:"chevron-down",class:"replies-summary-chevron"}),!!p&&e(fe,{class:"replies-parent-link",to:p.to,onClick:p.onClick,title:d({id:"ZlV82A"}),children:"»"})]}),C&&e("ul",{children:n.map(T=>e("li",{children:[e("div",{class:"status-focus",tabIndex:0,children:[e(je,{statusID:T.id,instance:i,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:b,showActionsBar:!0}),!T.replies?.length&&T.repliesCount>0&&e("div",{class:"replies-link",children:[e(A,{icon:"comment2",alt:d({id:"N8UzTV"})})," ",e("span",{title:T.repliesCount,children:We(T.repliesCount)})]})]}),T.replies?.length&&e(Mo,{instance:i,replies:T.replies,level:T.level,accWeight:k?v:T.weight,openAll:c,parentLink:{to:i?`/${i}/s/${T.id}`:`/s/${T.id}`,onClick:()=>{Rn(T.id)}}})]},T.id))})]})}const Dd=140,Od=35,zd=70,Fd=140,gi=new Map;function an(n){const i=gi.get(n.id);if(i)return i;const{spoilerText:o,content:s,mediaAttachments:a,poll:c,card:p}=n,d=Hs(o+s),r=a?.length?Dd:0,l=(c?.options?.length||0)*Od,h=p&&(a?.length||c?.options?.length)?0:zd,f=(d+r+l+h)/Fd;return gi.set(n.id,f),f}const Ud=rt($d);function Bd(){const n=Pt(),{id:i,instance:o}=n;return e(Ud,{id:i,instance:o})}const qd=""+new URL("boosts-carousel-BiOaNdMT.jpg",import.meta.url).href,Kd=""+new URL("grouped-notifications-DFgwVVj3.jpg",import.meta.url).href,Hd=""+new URL("multi-column-ROck0NVt.jpg",import.meta.url).href,Yd=""+new URL("multi-hashtag-timeline-DH5INVHi.jpg",import.meta.url).href,jd=""+new URL("nested-comments-thread-hv59kZLc.jpg",import.meta.url).href,Vd="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e",Gd={BASE_URL:"./",DEV:!1,MODE:"production",PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",PHANPY_TRANSLANG_INSTANCES:"translang.phanpy.social",PHANPY_WEBSITE:"https://phanpy.blaede.family",PROD:!0,SSR:!1,VITE_APP_ENV:"production"},{PHANPY_DEFAULT_INSTANCE:sn,PHANPY_WEBSITE:Is,PHANPY_PRIVACY_POLICY_URL:Wd,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:Ts}=Gd,xs=Is?Is.replace(/https?:\/\//g,"").replace(/\/$/,""):null,Es=`${"2025-10-07T15:35:52.703Z".slice(0,10).replace(/-/g,".")}.ac2004e`;function $o(){const{_:n}=ce();return Qe(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("div",{class:"hero-content",children:[e("h1",{children:[e("img",{src:Pi,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:Vd,alt:"Phanpy",width:"200"})]}),e("p",{class:"desc",children:e(u,{id:"Ogtv0V"})}),e("p",{children:e(fe,{to:sn?`/login?instance=${sn}&submit=1`:"/login",class:"button",children:n(sn?{id:"sQia9P"}:{id:"ZLoGls"})})}),sn&&Ts&&e("p",{children:e("a",{href:Ts,class:"button plain5",children:e(u,{id:"e+RpCP"})})}),!sn&&e("p",{class:"insignificant",children:e("small",{children:e(u,{id:"fvAsUK",components:{0:e("br",{})}})})})]}),(xs||Es)&&e("p",{class:"app-site-version",children:e("small",{children:[xs," ",Es]})}),e("p",{children:e(u,{id:"BskFI2",components:{0:e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank"}),1:e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:i=>{i.preventDefault(),E.showAccount="cheeaun@mastodon.social"}}),2:e("a",{href:Wd,target:"_blank"})}})}),e("div",{children:e(Di,{})})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:qd,alt:n({id:"S5cYrQ"}),loading:"lazy"}),e("h4",{children:e(u,{id:"Tu+sCN"})}),e("p",{children:e(u,{id:"e2uVlo"})})]}),e("section",{children:[e("img",{src:jd,alt:n({id:"CGQ27z"}),loading:"lazy"}),e("h4",{children:e(u,{id:"cYE45+"})}),e("p",{children:e(u,{id:"Pc7QKh"})})]}),e("section",{children:[e("img",{src:Kd,alt:n({id:"rnrM7k"}),loading:"lazy"}),e("h4",{children:e(u,{id:"4RRMre"})}),e("p",{children:e(u,{id:"8GMtDr"})})]}),e("section",{children:[e("img",{src:Hd,alt:n({id:"VLKtvP"}),loading:"lazy"}),e("h4",{children:e(u,{id:"pEkad9"})}),e("p",{children:e(u,{id:"t7Py5R"})})]}),e("section",{children:[e("img",{src:Yd,alt:n({id:"wOax6E"}),loading:"lazy"}),e("h4",{children:e(u,{id:"Wi1Ov0"})}),e("p",{children:e(u,{id:"tS2i+h"})})]})]})})]})}const Zd=window.alert;window.__nativeAlert||(window.__nativeAlert=Zd);window.alert=function(n){n instanceof Error&&n?.message&&(n=n.message),typeof n!="string"&&(n=JSON.stringify(n));const i=Ia({text:n,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{i.hideToast()}});i.showToast()};window.__STATES__=E;window.__STATES_STATS__=()=>{const n=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],i={};n.forEach(a=>{i[a]=Object.keys(E[a]).length});const{statuses:o}=E,s=[];for(const a in o)document.querySelector(`[data-state-post-id~="${a}"], [data-state-post-ids~="${a}"]`)||s.push(a)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:n,unfurledLinks:i,notifications:o}=E;let s=0;const{instance:a}=se();for(const c in n){if(!window.__IDLE__)break;try{const p=document.querySelector(`[data-state-post-id~="${c}"], [data-state-post-ids~="${c}"]`),d=o.some(r=>c===ct(r.status?.id,a));if(!p&&!d){delete E.statuses[c],delete E.statusQuotes[c];for(const r in i){const l=i[r];if(ct(l.id,l.instance)===c){delete E.unfurledLinks[r];break}}s++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const n in Yt)setTimeout(()=>{Array.isArray(Yt[n])?Yt[n][0]?.():typeof Yt[n]=="object"?Yt[n].module?.():Yt[n]?.()},1)},5e3);(()=>{window.__IDLE__=!0;const n=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],i=()=>{window.__IDLE__=!0},s=js(i,3e3),a=()=>{window.__IDLE__=!1,s()};n.forEach(c=>{window.addEventListener(c,a,{passive:!0,capture:!0})}),window.addEventListener("blur",i,{passive:!0}),document.documentElement.addEventListener("mouseleave",c=>{!c.relatedTarget&&!c.toElement&&i()},{passive:!0})})();const Xd=/iPad|iPhone|iPod/.test(navigator.userAgent);Xd&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){if(document.getElementsByClassName("media-modal-container").length>0)return;const i=Ee.local.get("theme");let o;if(i){if(o=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),o){const s=o.content,a=i==="light"?o.dataset.themeLightColorTemp:o.dataset.themeDarkColorTemp;o.content=a||"",setTimeout(()=>{o.content=s},10)}}else{const s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(o=document.querySelector(`meta[name="theme-color"][media*="${s}"]`),o){const a=o.dataset.content,c=o.dataset.contentTemp;o.content=c||"",setTimeout(()=>{o.content=a},10)}}}});{const n=Ee.local.get("theme");if(n){document.documentElement.classList.add(`is-${n}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",n||"light dark");const o=document.querySelector('meta[data-theme-setting="manual"]');o&&(o.name="theme-color",o.content=n==="light"?o.dataset.themeLightColor:o.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(a=>{a.name=""})}const i=Ee.local.get("textSize");i&&document.documentElement.style.setProperty("--text-size",`${i}px`)}Ms(E,n=>{for(const[i,o,s,a]of n){if(o.join(".")==="settings.shortcutsViewMode"){const c=document.getElementById("app");c&&(c.dataset.shortcutsViewMode=E.shortcuts?.length?s:"")}o.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",s)}});const kn=new Map;window.__BENCH_RESULTS=new Map;window.__BENCHMARK={start(n){},end(n){}};document.body.classList.toggle("exp-tab-bar-v2",Ee.local.get("experiments-tabBarV2")??!1);function Jd(){const[n,i]=R(!1),[o,s]=R("loading");__BENCHMARK.start("app-init"),__BENCHMARK.start("time-to-following"),__BENCHMARK.start("time-to-home"),__BENCHMARK.start("time-to-isLoggedIn"),ce(),G(()=>{const c=Ee.local.get("instanceURL"),p=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(p){window.history.replaceState({},document.title,window.location.pathname||"/");const{client_id:d,client_secret:r,vapid_key:l}=Ps(c)||{},h=Mn(c)||l,m=Ee.sessionCookie.get("codeVerifier");(async()=>{s("loading");const{access_token:f}=await nc({instanceURL:c,client_id:d,client_secret:r,code:p,code_verifier:m||void 0});if(f){const y=Zo({instance:c,accessToken:f});await Promise.allSettled([Jn(y),Qn(y,c),Xo(y,c,f,h)]),Yi(),window.__IGNORE_GET_ACCOUNT_ERROR__=!0,i(!0),s("default")}else s("error");__BENCHMARK.end("app-init")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const d=decodeURIComponent((window.location.search.match(/account=([^&]+)/)||[,""])[1]);let r;if(d&&(r=Jo(d),r&&(Ln(r.info.id),window.history.replaceState({},document.title,window.location.pathname||"/"))),r||(r=Si()),r){Ln(r.info.id);const{client:l}=se({account:r}),{instance:h}=l;Yi(),s("loading"),(async()=>{try{Qo()&&ea(h)?(Jn(l),Qn(l,h)):await Promise.allSettled([Jn(l),Qn(l,h)])}catch{}finally{i(!0),s("default"),__BENCHMARK.end("app-init")}})()}else s("default"),__BENCHMARK.end("app-init")}Ee.sessionCookie.del("clientID"),Ee.sessionCookie.del("clientSecret"),Ee.sessionCookie.del("codeVerifier")},[]);let a=Qt();return E.currentLocation=a.pathname,G(ui,[a,n]),/\/https?:/.test(a.pathname)?e(bd,{}):o==="loading"?e(Fe,{id:"loader-root"}):e(P,{children:[e(eu,{isLoggedIn:n}),e(tu,{isLoggedIn:n}),e(Ci,{children:e(Ze,{path:"/:instance?/s/:id",element:e(Bd,{})})}),n&&e(La,{}),n&&e(ql,{}),e(Ml,{}),n&&e(Dl,{}),e(Ea,{isLoggedIn:n}),e(Ul,{onClose:ui}),e(Ma,{})]})}function Qd({isLoggedIn:n}){return n&&__BENCHMARK.end("time-to-isLoggedIn"),n?e(gd,{}):e($o,{})}const eu=rt(({isLoggedIn:n})=>{const i=Qt(),o=Se(()=>{const{pathname:s}=i;return!/^\/(login|welcome|_sandbox)/i.test(s)},[i]);return e(Ci,{location:o||i,children:[e(Ze,{path:"/",element:e(Qd,{isLoggedIn:n})}),e(Ze,{path:"/login",element:e(Cd,{})}),e(Ze,{path:"/welcome",element:e($o,{})}),void 0]})});function Rs(){return E.prevLocation||null}function tu({isLoggedIn:n}){const i=Qt(),o=B(Rs());return Se(()=>cn("/:instance/s/:id",i.pathname)||cn("/s/:id",i.pathname),[i.pathname,cn])?o.current||(o.current=Rs()):o.current=null,e(Ci,{location:o.current||i,children:[n&&e(P,{children:[e(Ze,{path:"/notifications",element:e(To,{})}),e(Ze,{path:"/mentions",element:e(ko,{})}),e(Ze,{path:"/following",element:e(qi,{})}),e(Ze,{path:"/b",element:e(fo,{})}),e(Ze,{path:"/f",element:e(mo,{})}),e(Ze,{path:"/l",children:[e(Ze,{index:!0,element:e(wd,{})}),e(Ze,{path:":id",element:e(vo,{})})]}),e(Ze,{path:"/fh",element:e($r,{})}),e(Ze,{path:"/sp",element:e(Id,{})}),e(Ze,{path:"/ft",element:e(Er,{})}),e(Ze,{path:"/catchup",element:e(yr,{})}),e(Ze,{path:"/annual_report/:year",element:e(rr,{})})]}),e(Ze,{path:"/:instance?/t/:hashtag",element:e(yo,{})}),e(Ze,{path:"/:instance?/a/:id",element:e(or,{})}),e(Ze,{path:"/:instance?/p",children:[e(Ze,{index:!0,element:e(fi,{})}),e(Ze,{path:"l",element:e(fi,{local:!0})})]}),e(Ze,{path:"/:instance?/trending",element:e(Ro,{})}),e(Ze,{path:"/:instance?/search",element:e(xo,{})})]})}ta();na();ia(e(sa,{i18n:ue,children:e(oa,{children:e(aa,{children:e(Jd,{})})})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(n=>{n.startsWith("iconify")&&localStorage.removeItem(n)}),Object.keys(sessionStorage).forEach(n=>{n.startsWith("iconify")&&sessionStorage.removeItem(n)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);if("serviceWorker"in navigator&&typeof caches<"u"){const i=["icons"];let o=!1;const s=1e4,a=60*60*1e3;async function c(){if(window.__IDLE__)try{const p=await caches.keys();for(const d of p){if(i.includes(d))continue;const r=await caches.open(d),l=await r.keys();if(l.length>50){const h=l.slice(50);for(const m of h)await r.delete(m)}}o=!0}catch{}setTimeout(c,o?a:s)}setTimeout(c,s)}window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-CqGAdsQ2.js.map
