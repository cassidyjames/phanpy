function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./catchup-2sBjDPIQ.js","./vendor-vFSXznL_.js","./index-_Y-Lyw2n.js","./db-8OnnXSuA.js","./useTitle-mWfzJaN8.js","./modals-0VQDHbcv.js","./intl-segmenter-suspense-EhT4pn-r.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{s as C,a as V,b as _t,c as ct,g as gi,d as ae,p as ee,u as bi,e as Gt,f as Mt,h as _n,i as yi,j as wi,t as vi,_ as Nn,k as Si,l as nn,m as ki,n as sn,o as on}from"./useTitle-mWfzJaN8.js";import{F as P,_ as G,p as R,u as Tt,w as Bt,a as t,b as xt,g as E,A as Jt,c as Wt,T as Ii,N as Ti,d as Mn,l as cn,q as gt,e as $i,S as xe,M as Et,x as qt,f as st,y as Ee,h as Ci,P as xi,J as Ai,C as Pn,i as Ri,I as Qt,j as ie,k as Dn,m as Ei,n as Li,s as _i,o as Un,r as Le,t as me,v as Fn,z as an,B as Ni,U as Bn,D as Mi,R as Ye,E as It,G as On,H as Pi,K as Di}from"./vendor-vFSXznL_.js";import{u as We,s as ot,o as Ui,I as v,M as Dt,L as St,C as Fi,N as Be,a as Ft,R as _e,A as re,S as Lt,b as Bi,c as Q,d as te,e as Yt,f as vt,g as zn,h as Zt,i as qn,j as Oe,E as Hn,n as ne,k as rn,T as Oi,F as Vn,l as ze,m as jn,p as zi,q as de,r as Gn,t as qi,v as Hi,w as be}from"./db-8OnnXSuA.js";function le(e=()=>{},n=[]){const s=P(e);G(()=>{s.current=e},[n]),G(()=>{const i=()=>{const c=document.hidden||document.visibilityState==="hidden";s.current(!c)};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)},[])}const Vi=1e3*3,ji=15e3,Gi=Bt(function({isLoggedIn:n}){const[s,i]=R(!0);le(i);const c=async(r,l,h)=>{var p;if(C.notificationsLast){const a=r.v1.notifications.list({limit:1,sinceId:C.notificationsLast.id}),{value:f}=await a.next();if(f!=null&&f.length)if(h)C.notificationsShowNew=!0;else{let u;try{const b=await r.v1.markers.fetch({timeline:"notifications"});u=(p=b==null?void 0:b.notifications)==null?void 0:p.lastReadId}catch{}u?C.notificationsShowNew=f[0].id!==u:C.notificationsShowNew=!0}}};G(()=>{let r,l;if(n&&s){const{masto:h,streaming:p,instance:a}=V();(async()=>{await c(h,a);let f=!1;p&&(l=setTimeout(()=>{(async()=>{try{f=!0,r=p.user.notification.subscribe();for await(const u of r){if(!r||!s)break;u.event==="notification"&&_t(u.payload,a,{skipThreading:!0}),C.notificationsShowNew=!0}}catch{f=!1}f||(l=setInterval(()=>{c(h,a,!0)},ji))})()},Vi))})()}return()=>{var h;(h=r==null?void 0:r.unsubscribe)==null||h.call(r),r=null,clearTimeout(l),clearInterval(l)}},[s,n]);const o=P(),d=()=>{o.current=Date.now(),fetch("./version.json").then(r=>r.json()).then(r=>{r&&(C.appVersion=r)}).catch(r=>{})};return We(d,s&&1e3*60*30),le(r=>{r&&(o.current?Date.now()-o.current>1e3*60*60&&d():d())}),Tt("shift+alt+k",()=>{const r=C.settings.cloakMode;C.settings.cloakMode=!r,ot({text:`Cloak mode ${r?"disabled":"enabled"}`})}),null});function Yi(){function e(n){n.shiftKey?Ui()||(C.showCompose=!0):C.showCompose=!0}return Tt("c, shift+c",e,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),t("button",{type:"button",id:"compose-button",onClick:e,children:t(v,{icon:"quill",size:"xl",alt:"Compose"})})}const Wi=Bt(function(){const n=xt(C);function s(){C.showKeyboardShortcutsHelp=!1}return Tt("?, shift+?, shift+slash",i=>{C.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&t(Dt,{onClose:s,children:t("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:s,children:t(v,{icon:"x"})}),t("header",{children:t("h2",{children:"Keyboard shortcuts"})}),t("main",{children:t("table",{children:[{action:"Keyboard shortcuts help",keys:t("kbd",{children:"?"})},{action:"Next post",keys:t("kbd",{children:"j"})},{action:"Previous post",keys:t("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"k"})]})},{action:"Load new posts",keys:t("kbd",{children:"."})},{action:"Open post details",keys:t(E,{children:[t("kbd",{children:"Enter"})," or ",t("kbd",{children:"o"})]})},{action:t(E,{children:["Expand content warning or",t("br",{}),"toggle expanded/collapsed thread"]}),keys:t("kbd",{children:"x"})},{action:"Close post or dialogs",keys:t(E,{children:[t("kbd",{children:"Esc"})," or ",t("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:t(E,{children:[t("kbd",{children:"1"})," to ",t("kbd",{children:"9"})]})},{action:"Compose new post",keys:t("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"c"})]})},{action:"Send post",keys:t(E,{children:[t("kbd",{children:"Ctrl"})," + ",t("kbd",{children:"Enter"})," or ",t("kbd",{children:"⌘"})," +"," ",t("kbd",{children:"Enter"})]})},{action:"Search",keys:t("kbd",{children:"/"})},{action:"Reply",keys:t("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:t(E,{children:[t("kbd",{children:"l"})," or ",t("kbd",{children:"f"})]})},{action:"Boost",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"b"})]})},{action:"Bookmark",keys:t("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:t(E,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"Alt"})," + ",t("kbd",{children:"k"})]})}].map(({action:i,className:c,keys:o})=>t("tr",{children:[t("th",{class:c,children:i}),t("td",{children:o})]},i))})})]})})});function qe({accountID:e,onChange:n}){const{masto:s}=V(),[i,c]=R("default"),[o,d]=R(null),[r,l]=R(null),h=r!==null;return t("p",{class:"follow-request-buttons",children:[t("button",{type:"button",disabled:i==="loading"||h,onClick:()=>{c("loading"),d("accept"),(async()=>{try{const p=await s.v1.followRequests.$select(e).authorize();if(!(p!=null&&p.followedBy))throw new Error("Follow request not accepted");l(p),n()}catch{}c("default")})()},children:"Accept"})," ",t("button",{type:"button",disabled:i==="loading"||h,class:"light danger",onClick:()=>{c("loading"),d("reject"),(async()=>{try{const p=await s.v1.followRequests.$select(e).reject();if(p!=null&&p.followedBy)throw new Error("Follow request not rejected");l(p),n()}catch{c("default")}})()},children:"Reject"}),t("span",{class:"follow-request-states",children:h&&o?o==="accept"?t(v,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):t(v,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):t(St,{hidden:i!=="loading"})})]})}const ln={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning",severed_relationships:"heart-break",emoji_reaction:"emoji2","pleroma:emoji_reaction":"emoji2"};function dn(e,n){let s,i;return typeof n=="string"?s=n:(s=n==null?void 0:n.url,i=n==null?void 0:n.staticUrl),s?t(E,{children:["reacted to your post with"," ",t(Fi,{url:s,staticUrl:i,alt:e})]}):`reacted to your post with ${e}.`}const oe={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":e=>`boosted ${e} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":e=>`liked ${e} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":e=>`boosted & liked ${e} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":e=>t(E,{children:["reported ",e]}),severed_relationships:e=>t(E,{children:["Lost connections with ",t("i",{children:e}),"."]}),emoji_reaction:dn,"pleroma:emoji_reaction":dn},Ki={account_suspension:({from:e,targetName:n})=>t(E,{children:["An admin from ",t("i",{children:e})," has suspended ",t("i",{children:n}),", which means you can no longer receive updates from them or interact with them."]}),domain_block:({from:e,targetName:n,followersCount:s,followingCount:i})=>t(E,{children:["An admin from ",t("i",{children:e})," has blocked ",t("i",{children:n}),". Affected followers: ",s,", followings: ",i,"."]}),user_domain_block:({targetName:e,followersCount:n,followingCount:s})=>t(E,{children:["You have blocked ",t("i",{children:e}),". Removed followers: ",n,", followings: ",s,"."]})},Me=50;function Zi({notification:e,instance:n,isStatic:s,disableContextMenu:i}){var H,B,F,X,N,_;const{id:c,status:o,account:d,report:r,event:l,_accounts:h,_statuses:p}=e;let{type:a}=e;const f=(o==null?void 0:o.reblog)||o,u=f==null?void 0:f.id,b=ct.session.get("currentAccount"),y=b===(d==null?void 0:d.id),S=(H=o==null?void 0:o.poll)==null?void 0:H.voted,m=!!(o!=null&&o.inReplyToAccountId)&&(o==null?void 0:o.inReplyToAccountId)!==b&&((B=o==null?void 0:o.account)==null?void 0:B.id)===b;let g=0,k=0;if(a==="favourite+reblog"){for(const x of h)(F=x._types)!=null&&F.includes("favourite")&&g++,(X=x._types)!=null&&X.includes("reblog")&&k++;!k&&g&&(a="favourite"),!g&&k&&(a="reblog")}let w;if(a==="poll"?w=oe[y?"poll-self":S?"poll-voted":"poll"]:a==="reblog"||a==="favourite"||a==="favourite+reblog"?(p==null?void 0:p.length)>1?w=oe[`${a}+account`]:m?w=oe[`${a}_reply`]:w=oe[a]:oe[a]?w=oe[a]:w=`[Unknown notification type: ${a}]`,typeof w=="function"){const x=(p==null?void 0:p.length)||(h==null?void 0:h.length);if(a==="admin.report"){const M=r==null?void 0:r.targetAccount;M&&(w=w(t(Be,{account:M,showAvatar:!0})))}else if(a==="severed_relationships"){const M=l==null?void 0:l.targetName;M&&(w=w(M))}else if((a==="emoji_reaction"||a==="pleroma:emoji_reaction")&&e.emoji){const M=e.emoji_url||((_=(N=o==null?void 0:o.emojis)==null?void 0:N.find)==null?void 0:_.call(N,D=>(D==null?void 0:D.shortcode)===e.emoji.replace(/^:/,"").replace(/:$/,"")));w=w(e.emoji,M)}else x&&(w=w(x))}if(a==="mention"&&!o)return null;const I=e.createdAt&&new Date(e.createdAt).toLocaleString(),A={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[a]||"Accounts",L=()=>{C.showGenericAccounts={heading:A,accounts:h,showReactions:a==="favourite+reblog",excludeRelationshipAttrs:a==="follow"?["followedBy"]:[]}};return t("div",{class:`notification notification-${a}`,"data-notification-id":c,tabIndex:"0",children:[t("div",{class:`notification-type notification-${a}`,title:I,children:a==="favourite+reblog"?t(E,{children:[t(v,{icon:"rocket",size:"xl",alt:a,class:"reblog-icon"}),t(v,{icon:"heart",size:"xl",alt:a,class:"favourite-icon"})]}):t(v,{icon:ln[a]||"notification",size:"xl",alt:a})}),t("div",{class:"notification-content",children:[a!=="mention"&&t(E,{children:[t("p",{children:[!/poll|update/i.test(a)&&t(E,{children:(h==null?void 0:h.length)>1?t(E,{children:[t("b",{tabIndex:"0",onClick:L,children:[t("span",{title:h.length,children:Ft(h.length)})," ","people"]})," "]}):d&&t(E,{children:[t(Be,{account:d,showAvatar:!0})," "]})}),w,a==="mention"&&t("span",{class:"insignificant",children:[" ","•"," ",t(_e,{datetime:e.createdAt,format:"micro"})]})]}),a==="follow_request"&&t(qe,{accountID:d.id}),a==="severed_relationships"&&t("div",{children:[Ki[l.type]({from:n,...l}),t("br",{}),t("a",{href:`https://${n}/severed_relationships`,target:"_blank",rel:"noopener noreferrer",children:["Learn more ",t(v,{icon:"external",size:"s"})]}),"."]})]}),(h==null?void 0:h.length)>1&&t("p",{class:"avatars-stack",children:[h.slice(0,Me).map(x=>t(E,{children:[t("a",{href:x.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:M=>{M.preventDefault(),C.showAccount=x},children:[t(re,{url:x.avatarStatic,size:h.length<=10?"xxl":h.length<20?"xl":h.length<30?"l":h.length<40?"m":"s",alt:`${x.displayName} @${x.acct}`,squircle:x==null?void 0:x.bot},x.id),a==="favourite+reblog"&&t("div",{class:"account-sub-icons",children:x._types.map(M=>t(v,{icon:ln[M],size:"s",class:`${M}-icon`}))})]},x.id)," "]},x.id)),t("button",{type:"button",class:"small plain",onClick:L,children:[h.length>Me&&`+${h.length-Me}`,t(v,{icon:"chevron-down"})]})]}),(p==null?void 0:p.length)>1&&t("ul",{class:"notification-group-statuses",children:p.map(x=>t("li",{children:t(un,{class:`status-link status-type-${a}`,to:n?`/${n}/s/${x.id}`:`/s/${x.id}`,children:t(Lt,{status:x,size:"s",previewMode:!0,allowContextMenu:!0})})},x.id))}),o&&(!(p!=null&&p.length)||(p==null?void 0:p.length)<=1)&&t(un,{class:`status-link status-type-${a}`,to:n?`/${n}/s/${u}`:`/s/${u}`,onContextMenu:i?void 0:x=>{const M=x.target.querySelector(".status");if(M){if(x.metaKey)return;x.preventDefault(),M.dispatchEvent(new MouseEvent("contextmenu",{clientX:x.clientX,clientY:x.clientY}))}},children:s?t(Lt,{status:f,size:"s",readOnly:!0,allowContextMenu:!0}):t(Lt,{statusID:u,size:"s",readOnly:!0,allowContextMenu:!0})})]})]})}function un(e){const n=Bi();return t(Q,{...e,"data-read-more":"Read more →",ref:n})}const Ne=Bt(Zi,(e,n)=>{var s,i;return((s=e.notification)==null?void 0:s.id)===((i=n.notification)==null?void 0:i.id)});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{const{type:n,id:s,accessToken:i}=(e==null?void 0:e.data)||{};n==="notification"&&(C.routeNotification={id:s,accessToken:i})});const Ji=Bt(function(){if(!("serviceWorker"in navigator))return null;const n=xt(C),{routeNotification:s}=n,{id:i,accessToken:c}=s||{},[o,d]=R(!1);Jt(()=>{if(!i||!c)return;const{instance:l}=V(),{masto:h,instance:p}=V({accessToken:c}),a=l===p,f=c?gi(c):ae();(async()=>{const u=await h.v1.notifications.$select(i).fetch();if(u&&f){const b=f.instanceURL,{type:y,status:S,account:m}=u,g=!!document.querySelector("#modal-container > *"),k=y==="follow"&&!!(m!=null&&m.id),w=!!(m!=null&&m.id),I=!!(S!=null&&S.id);k&&a?C.showAccount={account:m,instance:b}:g||!a||w&&I?d({id:i,account:f,notification:u,sameInstance:a}):I?location.hash=`/${l}/s/${S.id}`:k?location.hash=`/${l}/a/${m.id}`:location.hash="/notifications"}})()},[i,c]),Jt(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),le(l=>{l&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const r=()=>{d(!1),C.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(o){const{id:l,account:h,notification:p,sameInstance:a}=o;return t(Dt,{onClick:f=>{f.target===f.currentTarget&&r()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:r,children:t(v,{icon:"x"})}),t("header",{children:t("b",{children:"Notification"})}),t("main",{children:[!a&&t("p",{children:"This notification is from your other account."}),t("div",{class:"notification-peek",onClick:f=>{const{target:u}=f;(f.target.tagName==="BUTTON"||f.target.tagName==="A")&&r()},children:t(Ne,{instance:h.instanceURL,notification:p,isStatic:!0})}),t("div",{style:{textAlign:"end"},children:t(Q,{to:"/notifications",class:"button light",onClick:r,children:[t("span",{children:"View all notifications"})," ",t(v,{icon:"arrow-right"})]})})]})]})})}return null}),Yn=Ti((e,n)=>{const{instance:s}=V(),[i,c]=Wt(),[o,d]=R(!1),[r,l]=R(i.get("q")||""),h=i.get("type"),p=P(null),a=P(null);return Ii(n,()=>({setValue:f=>{l(f)},focus:()=>{a.current.focus()},select:()=>{a.current.select()},blur:()=>{a.current.blur()}})),t("form",{ref:p,class:"search-popover-container",onSubmit:f=>{var b;if(f.preventDefault(),/\/search/.test(location.hash))if(r){const y={q:r};h&&(y.type=h),c(y)}else c({});else r?location.hash=`/search?q=${encodeURIComponent(r)}${h?`&type=${h}`:""}`:location.hash="/search";(b=e==null?void 0:e.onSubmit)==null||b.call(e,f)},children:[t("input",{ref:a,value:r,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellCheck:"false",onSearch:f=>{f.target.value||c({})},onInput:f=>{l(f.target.value),d(!0)},onFocus:()=>{var f,u;d(!0),(u=(f=p.current)==null?void 0:f.querySelector(".search-popover-item"))==null||u.classList.add("focus")},onBlur:()=>{var f,u;setTimeout(()=>{d(!1)},100),(u=(f=p.current)==null?void 0:f.querySelector(".search-popover-item.focus"))==null||u.classList.remove("focus")},onKeyDown:f=>{var b;const{key:u}=f;switch(u){case"Escape":d(!1);break;case"Down":case"ArrowDown":if(f.preventDefault(),o){const y=p.current.querySelector(".search-popover-item.focus");if(y){let S=y.nextElementSibling;for(;S&&S.hidden;)S=S.nextElementSibling;S&&(S.classList.add("focus"),Array.from(S.parentElement.children).filter(g=>g!==S).forEach(g=>{g.classList.remove("focus")}))}else{const S=p.current.querySelector(".search-popover-item");S&&S.classList.add("focus")}}break;case"Up":case"ArrowUp":if(f.preventDefault(),o){const y=document.querySelector(".search-popover-item.focus");if(y){let S=y.previousElementSibling;for(;S&&S.hidden;)S=S.previousElementSibling;S&&(S.classList.add("focus"),Array.from(S.parentElement.children).filter(g=>g!==S).forEach(g=>{g.classList.remove("focus")}))}else{const S=document.querySelector(".search-popover-item:last-child");S&&S.classList.add("focus")}}break;case"Enter":if(o){const y=document.querySelector(".search-popover-item.focus");y&&(f.preventDefault(),y.click()),d(!1),(b=e==null?void 0:e.onSubmit)==null||b.call(e,f)}break}}}),t("div",{class:"search-popover",hidden:!o||!r,children:!!r&&[{label:t(E,{children:[r," ",t("small",{class:"insignificant",children:"‒ accounts, hashtags & posts"})]}),to:`/search?q=${encodeURIComponent(r)}`,top:!h&&!/\s/.test(r),hidden:!!h},{label:t(E,{children:["Posts with ",t("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=statuses`,hidden:/^https?:/.test(r),top:/\s/.test(r),icon:"document",queryType:"statuses"},{label:t(E,{children:["Posts tagged with ",t("mark",{children:["#",r.replace(/^#/,"")]})]}),to:`/${s}/t/${r.replace(/^#/,"")}`,hidden:/^@/.test(r)||/^https?:/.test(r)||/\s/.test(r),top:/^#/.test(r),type:"link",icon:"hashtag",queryType:"hashtags"},{label:t(E,{children:["Look up ",t("mark",{children:r})]}),to:`/${r}`,hidden:!/^https?:/.test(r),top:/^https?:/.test(r),type:"link"},{label:t(E,{children:["Accounts with ",t("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=accounts`,icon:"group",queryType:"accounts"}].sort((f,u)=>{if(h){if(f.queryType===h)return-1;if(u.queryType===h)return 1}return f.top&&!u.top?-1:!f.top&&u.top?1:0}).filter(({hidden:f})=>!f).map(({label:f,to:u,icon:b,type:y},S)=>t(Q,{to:u,class:`search-popover-item ${S===0?"focus":""}`,onClick:m=>{var g;(g=e==null?void 0:e.onSubmit)==null||g.call(e,m)},children:[t(v,{icon:b||(y==="link"?"arrow-right":"search"),class:"more-insignificant"}),t("span",{children:f})," "]}))})]})}),Xi=Bt(function({onClose:n=()=>{}}){const[s,i]=R(!1),c=P(null);Tt(["Slash","/"],d=>{i(!0),setTimeout(()=>{var r,l,h,p;(l=(r=c.current)==null?void 0:r.focus)==null||l.call(r),(p=(h=c.current)==null?void 0:h.select)==null||p.call(h)},0)},{preventDefault:!0,ignoreEventWhen:d=>{const r=/\/search/.test(location.hash),l=!!document.querySelector("#modal-container > *");return r||l}});const o=()=>{i(!1),n()};return Tt("esc",d=>{var r,l;(l=(r=c.current)==null?void 0:r.blur)==null||l.call(r),o()},{enabled:s,enableOnFormTags:!0,preventDefault:!0}),t("div",{id:"search-command-container",hidden:!s,onClick:d=>{d.target===d.currentTarget&&o()},children:t(Yn,{ref:c,onSubmit:()=>{o()}})})}),Qi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",ts="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",es="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",ns=200,is=10;async function Ae(){const{masto:e}=V(),n=e.v1.followedTags.list({limit:ns}),s=[];let i=0;do{const{value:c,done:o}=await n.next();if(o||(c==null?void 0:c.length)===0)break;s.push(...c),i++}while(i<is);return s.sort((c,o)=>c.name.localeCompare(o.name)),s.length&&setTimeout(()=>{ct.account.set("followedTags",{tags:s,updatedAt:Date.now()})},1),s}const ss=24*60*60*1e3;async function os(){try{const{tags:e,updatedAt:n}=ct.account.get("followedTags")||{};return e!=null&&e.length?(Date.now()-n>ss&&Ae(),e):await Ae()}catch{return[]}}const hn=document.createElement("div"),cs=e=>{if(!e)return[];if(e.indexOf("#")===-1)return[];hn.innerHTML=e;const n=hn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(s=>s.innerText.trim().replace(/^[^#]*#+/,"")):[]},Wn=1e3*60,as=24*60*60*1e3,He=ee(async()=>{const{masto:e}=V(),n=await e.v1.lists.list();return n.sort((s,i)=>s.title.localeCompare(i.title)),n.length&&setTimeout(()=>{ct.account.set("lists",{lists:n,updatedAt:Date.now()})},1),n},{maxAge:Wn});async function ge(){try{const{lists:e,updatedAt:n}=ct.account.get("lists")||{};return e!=null&&e.length?(Date.now()-n>as&&He(),e):await He()}catch{return[]}}const rs=ee(e=>{const{masto:n}=V();return n.v1.lists.$select(e).fetch()},{maxAge:Wn});async function Kn(e){const{lists:n}=ct.account.get("lists")||{};if(n!=null&&n.length){const s=n.find(i=>i.id===e);if(s)return s}try{return rs(e)}catch{return null}}async function ls(e){const n=await Kn(e);return(n==null?void 0:n.title)||""}function ds(e){const{lists:n}=ct.account.get("lists")||{};n!=null&&n.length&&(n.push(e),n.sort((s,i)=>s.title.localeCompare(i.title)),ct.account.set("lists",{lists:n,updatedAt:Date.now()}))}function us(e){const{lists:n}=ct.account.get("lists")||{};if(n!=null&&n.length){const s=n.findIndex(i=>i.id===e.id);s!==-1&&(n[s]=e,n.sort((i,c)=>i.title.localeCompare(c.title)),ct.account.set("lists",{lists:n,updatedAt:Date.now()}))}}function hs(e){const{lists:n}=ct.account.get("lists")||{};if(n!=null&&n.length){const s=n.findIndex(i=>i.id===e);s!==-1&&(n.splice(s,1),ct.account.set("lists",{lists:n,updatedAt:Date.now()}))}}function ke({children:e}){if(typeof e=="string")return e;const[n,s]=R("");return G(()=>{Promise.resolve(e).then(s)},[e]),n}const Kt=9,fs=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],Zn={following:"Home / Following",notifications:"Notifications",list:"Lists",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},Ie={list:[{text:"List ID",name:"id",notRequired:!0}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},ps=ee(async({id:e})=>{const n=await V().masto.v1.accounts.$select(e).fetch();return n.username||n.acct||n.displayName}),Re={following:{id:"home",title:(e,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:({id:e})=>e?"list":"lists",title:({id:e})=>e?ls(e):"Lists",path:({id:e})=>e?`/l/${e}`:"/l",icon:"list",excludeViewMode:({id:e})=>e?[]:["multi-column"]},public:{id:"public",title:({local:e})=>e?"Local":"Federated",subtitle:({instance:e})=>e||V().instance,path:({local:e,instance:n})=>`/${n}/p${e?"/l":""}`,icon:({local:e})=>e?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:e})=>e||V().instance,path:({instance:e})=>`/${e}/trending`,icon:"chart"},search:{id:"search",title:({query:e})=>e?`“${e}”`:"Search",path:({query:e})=>e?`/search?q=${encodeURIComponent(e)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:e})=>e?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:ps,path:({id:e})=>`/a/${e}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:e})=>e,subtitle:({instance:e})=>e||V().instance,path:({hashtag:e,instance:n,media:s})=>`${n?`/${n}`:""}/t/${e.split(/\s+/).join("+")}${s?"?media=1":""}`,icon:"hashtag"}};function _c({onClose:e}){const n=xt(C),{shortcuts:s}=n,[i,c]=R(!1),[o,d]=R(!1),[r]=Mn();return t("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(v,{icon:"x"})}),t("header",{children:t("h2",{children:[t(v,{icon:"shortcut"})," Shortcuts"," ",t("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),t("main",{children:[t("p",{children:"Specify a list of shortcuts that'll appear as:"}),t("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Qi},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:es},{value:"multi-column",label:"Multi-column",imgURL:ts}].map(({value:l,label:h,imgURL:p})=>{const a=n.settings.shortcutsViewMode===l||l==="float-button"&&!n.settings.shortcutsViewMode;return t("label",{class:a?"checked":"",children:[t("input",{type:"radio",name:"shortcuts-view-mode",value:l,checked:a,onChange:f=>{C.settings.shortcutsViewMode=f.target.value}})," ",t("img",{src:p,alt:"",width:"80",height:"58"})," ",t("span",{children:h})]},l)})}),s.length>0?t(E,{children:[t("ol",{class:"shortcuts-list",ref:r,children:s.filter(Boolean).map((l,h)=>{const p=Object.values(l).join("-"),{type:a}=l;if(!Re[a])return null;let{icon:f,title:u,subtitle:b,excludeViewMode:y}=Re[a];typeof u=="function"&&(u=u(l,h)),typeof b=="function"&&(b=b(l,h)),typeof f=="function"&&(f=f(l,h)),typeof y=="function"&&(y=y(l,h));const S=y==null?void 0:y.includes(n.settings.shortcutsViewMode);return t("li",{children:[t(v,{icon:f}),t("span",{class:"shortcut-text",children:[t(ke,{children:u}),b&&t(E,{children:[" ",t("small",{class:"ib insignificant",children:b})]}),S&&t("span",{class:"tag",children:"Not available in current view mode"})]}),t("span",{class:"shortcut-actions",children:[t("button",{type:"button",class:"plain small",disabled:h===0,onClick:()=>{const m=Array.from(C.shortcuts);if(h>0){const g=C.shortcuts[h-1];m[h-1]=l,m[h]=g,C.shortcuts=m}},children:t(v,{icon:"arrow-up",alt:"Move up"})}),t("button",{type:"button",class:"plain small",disabled:h===s.length-1,onClick:()=>{const m=Array.from(C.shortcuts);if(h<C.shortcuts.length-1){const g=C.shortcuts[h+1];m[h+1]=l,m[h]=g,C.shortcuts=m}},children:t(v,{icon:"arrow-down",alt:"Move down"})}),t("button",{type:"button",class:"plain small",onClick:()=>{c({shortcut:l,shortcutIndex:h})},children:t(v,{icon:"pencil",alt:"Edit"})})]})]},p)})}),s.length===1&&n.settings.shortcutsViewMode!=="float-button"&&t("div",{class:"ui-state insignificant",children:[t(v,{icon:"info"})," ",t("small",{children:"Add more than one shortcut/column to make this work."})]})]}):t("div",{class:"ui-state insignificant",children:[t("p",{children:n.settings.shortcutsViewMode==="multi-column"?"No columns yet. Tap on the Add column button.":"No shortcuts yet. Tap on the Add shortcut button."}),t("p",{children:["Not sure what to add?",t("br",{}),"Try adding"," ",t("a",{href:"#",onClick:l=>{l.preventDefault(),C.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),t("p",{class:"insignificant",children:s.length>=Kt&&(n.settings.shortcutsViewMode==="multi-column"?`Max ${Kt} columns`:`Max ${Kt} shortcuts`)}),t("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t("button",{type:"button",class:"light",onClick:()=>d(!0),children:"Import/export"}),t("button",{type:"button",disabled:s.length>=Kt,onClick:()=>c(!0),children:[t(v,{icon:"plus"})," ",t("span",{children:n.settings.shortcutsViewMode==="multi-column"?"Add column…":"Add shortcut…"})]})]})]}),i&&t(Dt,{onClick:l=>{l.target===l.currentTarget&&c(!1)},children:t(ms,{shortcut:i.shortcut,shortcutIndex:i.shortcutIndex,onSubmit:({result:l,mode:h})=>{h==="edit"?C.shortcuts[i.shortcutIndex]=l:C.shortcuts.push(l)},onClose:()=>c(!1)})}),o&&t(Dt,{onClick:l=>{l.target===l.currentTarget&&d(!1)},children:t(gs,{shortcuts:s,onClose:()=>d(!1)})})]})}const fn={list:"Specific list is optional. For multi-column mode, list is required, else the column will not be shown.",search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function ms({onSubmit:e,disabled:n,shortcut:s,shortcutIndex:i,onClose:c}){var S,m;const o=!!s,[d,r]=R((s==null?void 0:s.type)||null),{masto:l}=V(),[h,p]=R("default"),[a,f]=R([]),[u,b]=R([]);G(()=>{(async()=>{if(d==="list")try{p("loading");const g=await ge();f(g),p("default")}catch{p("error")}})(),(async()=>{if(d==="hashtag")try{const g=await Ae();b(g)}catch{}})()},[d]);const y=P();return G(()=>{if(o&&d&&Ie[d]){const g=y.current;Ie[d].forEach(({name:k,type:w})=>{const I=g.querySelector(`[name="${k}"]`);I&&s[k]&&(w==="checkbox"?I.checked=s[k]==="on":I.value=s[k])})}},[o,d]),t("div",{id:"shortcut-settings-form",class:"sheet",children:[!!c&&t("button",{type:"button",class:"sheet-close",onClick:c,children:t(v,{icon:"x"})}),t("header",{children:t("h2",{children:[o?"Edit":"Add"," shortcut"]})}),t("main",{tabindex:"-1",children:t("form",{ref:y,onSubmit:g=>{g.preventDefault();const k=new FormData(g.target),w={};k.forEach((I,A)=>{w[A]=I==null?void 0:I.trim(),A==="instance"&&(w[A]=w[A].replace(/^https?:\/\//,"").replace(/\/+$/,""),w[A]=w[A].replace(/^@?[^@]+@/,""))}),w.type&&(e({result:w,mode:o?"edit":"add"}),g.target.reset(),r(null),c==null||c())},children:[t("p",{children:t("label",{children:[t("span",{children:"Timeline"}),t("select",{required:!0,disabled:n,onChange:g=>{r(g.target.value)},defaultValue:o?s.type:void 0,name:"type",children:[t("option",{}),fs.map(g=>t("option",{value:g,children:Zn[g]}))]})]})}),(m=(S=Ie[d])==null?void 0:S.map)==null?void 0:m.call(S,({text:g,name:k,type:w,placeholder:I,pattern:A,notRequired:L})=>d==="list"?t("p",{children:t("label",{children:[t("span",{children:"List"}),t("select",{name:"id",required:!L,disabled:n||h==="loading",defaultValue:o?s.id:void 0,children:[t("option",{value:""}),a.map(H=>t("option",{value:H.id,children:H.title}))]})]})}):t("p",{children:t("label",{children:[t("span",{children:g})," ",t("input",{type:w,switch:w==="checkbox"||void 0,name:k,placeholder:I,required:w==="text"&&!L,disabled:n,list:d==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:A}),d==="hashtag"&&u.length>0&&t("datalist",{id:"followed-hashtags-datalist",children:u.map(H=>t("option",{value:H.name}))})]})})),!!fn[d]&&t("p",{class:"form-note insignificant",children:[t(v,{icon:"info"}),fn[d]]}),t("footer",{children:[t("button",{type:"submit",class:"block",disabled:n||h==="loading",children:o?"Save":"Add"}),o&&t("button",{type:"button",class:"light danger",onClick:()=>{C.shortcuts.splice(i,1),c==null||c()},children:"Remove"})]})]})})]})}function gs({shortcuts:e,onClose:n}){var a;const{masto:s}=V(),i=gt(()=>!e||!e.filter(Boolean).length?"":cn.compressToEncodedURIComponent(JSON.stringify(e.filter(Boolean))),[e]),[c,o]=R(""),[d,r]=R("default"),l=gt(()=>{if(!c)return r("default"),null;try{const f=JSON.parse(cn.decompressFromEncodedURIComponent(c));if(!Array.isArray(f))throw new Error("Not an array");return r("default"),f}catch{try{const u=JSON.parse(c);if(!Array.isArray(u))throw new Error("Not an array");return r("default"),u}catch{return r("error"),null}}},[c]),h=C.shortcuts.length>0,p=P();return t("div",{id:"import-export-container",class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(v,{icon:"x"})}),t("header",{children:t("h2",{children:["Import/Export ",t("small",{class:"ib insignificant",children:"Shortcuts"})]})}),t("main",{tabindex:"-1",children:[t("section",{children:[t("h3",{children:[t(v,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Import"})]}),t("p",{class:"field-button",children:[t("input",{ref:p,type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:f=>{o(f.target.value)}}),C.settings.shortcutSettingsCloudImportExport&&t("button",{type:"button",class:"plain2 small",disabled:d==="cloud-downloading",onClick:async()=>{r("cloud-downloading");const f=ct.session.get("currentAccount");ot("Downloading saved shortcuts from instance server…");try{const b=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(b){const{note:y=""}=b;if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(y)){const S=y.match(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/)[1],{v:m,dt:g,data:k}=JSON.parse(S);p.current.value=k,p.current.dispatchEvent(new Event("input"))}}r("default")}catch{r("error"),ot("Unable to download shortcuts")}},title:"Download shortcuts from instance server",children:[t(v,{icon:"cloud"}),t(v,{icon:"arrow-down"})]})]}),!!l&&Array.isArray(l)&&t(E,{children:[t("p",{children:[t("b",{children:l.length})," shortcut",l.length>1?"s":""," ",t("small",{class:"insignificant",children:["(",c.length," characters)"]})]}),t("ol",{class:"import-settings-list",children:l.map(f=>{var u,b;return t("li",{children:[t("span",{style:{opacity:e.some(y=>Object.keys(y).every(S=>y[S]===f[S]))?1:0},children:"*"}),t("span",{children:[Zn[f.type],f.type==="list"&&" ⚠️"," ",(b=(u=Ie[f.type])==null?void 0:u.map)==null?void 0:b.call(u,({text:y,name:S,type:m})=>f[S]?t(E,{children:[t("span",{class:"tag collapsed insignificant",children:[y,":"," ",m==="checkbox"?f[S]==="on"?"✅":"❌":f[S]]})," "]}):null)]})]})})}),t("p",{children:[t("small",{children:"* Exists in current shortcuts"}),t("br",{}),t("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),d==="error"&&t("p",{class:"error",children:t("small",{children:"⚠️ Invalid settings format"})}),t("p",{children:[h&&t(E,{children:[t(te,{confirmLabel:"Append to current shortcuts?",menuFooter:t("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const f=l.filter(y=>!C.shortcuts.some(S=>Object.keys(S).every(m=>S[m]===y[m])));if(!f.length){ot("No new shortcuts to import");return}let u=[...C.shortcuts,...f];const b=u.length>Kt;b&&(u=u.slice(0,Kt)),C.shortcuts=u,ot(b?`Shortcuts imported. Exceeded max ${Kt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!l,children:"Import & append…"})})," "]}),t(te,{confirmLabel:h?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:h?"danger":void 0,onClick:()=>{C.shortcuts=l,ot("Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!l,children:h?"or override…":"Import…"})})]})]}),t("section",{children:[t("h3",{children:[t(v,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Export"})]}),t("p",{children:t("input",{style:{width:"100%"},type:"text",value:i,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),ot("Shortcuts copied")}catch{ot("Unable to copy shortcuts")}}}})}),t("p",{children:[t("button",{type:"button",class:"plain2",disabled:!i,onClick:()=>{try{navigator.clipboard.writeText(i),ot("Shortcut settings copied")}catch{ot("Unable to copy shortcut settings")}},children:[t(v,{icon:"clipboard"})," ",t("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((a=navigator==null?void 0:navigator.canShare)==null?void 0:a.call(navigator,{text:i}))&&t("button",{type:"button",class:"plain2",disabled:!i,onClick:()=>{try{navigator.share({text:i})}catch{alert("Sharing doesn't seem to work.")}},children:[t(v,{icon:"share"})," ",t("span",{children:"Share"})]})," ",C.settings.shortcutSettingsCloudImportExport&&t("button",{type:"button",class:"plain2",disabled:d==="cloud-uploading",onClick:async()=>{r("cloud-uploading");const f=ct.session.get("currentAccount");try{const b=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(b){const{note:y=""}=b;let S="";if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(y)){const m=JSON.stringify({v:"1",dt:Date.now(),data:i});S=y.replace(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/,`<phanpy-shortcuts-settings>${m}</phanpy-shortcuts-settings>`)}else S=`${y}


<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;ot("Saving shortcuts to instance server…"),await s.v1.accounts.$select(f).note.create({comment:S}),r("default"),ot("Shortcuts saved")}}catch{r("error"),ot("Unable to save shortcuts")}},title:"Sync to instance server",children:[t(v,{icon:"cloud"}),t(v,{icon:"arrow-up"})]})," ",i.length>0&&t("small",{class:"insignificant ib",children:[i.length," characters"]})]}),!!i&&t("details",{children:[t("summary",{class:"insignificant",children:t("small",{children:"Raw Shortcuts JSON"})}),t("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(e.filter(Boolean),null,2)})]})]}),C.settings.shortcutSettingsCloudImportExport&&t("footer",{children:t("p",{children:[t(v,{icon:"cloud"})," Import/export settings from/to instance server (Very experimental)"]})})]})]})}function bs(){const{instance:e}=V(),n=xt(C),{shortcuts:s,settings:i}=n;if(!s.length||i.shortcutsViewMode==="multi-column"||!i.shortcutsViewMode&&i.shortcutsColumnsMode)return null;const c=P(),o=P(!1),d=s.map((p,a)=>{const{type:f,...u}=p;if(!Re[f])return null;let{id:b,path:y,title:S,subtitle:m,icon:g}=Re[f];return typeof b=="function"&&(b=b(u,a)),typeof y=="function"&&(y=y({...u,instance:u.instance||e},a)),typeof S=="function"&&(S=S(u,a)),typeof m=="function"&&(m=m(u,a)),typeof g=="function"&&(g=g(u,a)),b==="lists"&&(o.current=!0),{id:b,path:y,title:S,subtitle:m,icon:g}}).filter(Boolean),r=$i();Tt(["1","2","3","4","5","6","7","8","9"],(p,a)=>{var u,b;const f=parseInt(a.keys[0],10)-1;if(f<d.length){const{path:y}=d[f];y&&(r(y),(b=(u=c.current)==null?void 0:u.closeMenu)==null||b.call(u))}});const[l,h]=R([]);return t("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?t("nav",{class:"tab-bar",onContextMenu:p=>{p.preventDefault(),C.showShortcutsSettings=!0},children:t("ul",{children:d.map(({id:p,path:a,title:f,subtitle:u,icon:b},y)=>t("li",{children:t(Q,{class:u?"has-subtitle":"",to:a,onClick:S=>{if(S.target.classList.contains("is-active")){S.preventDefault();const m=document.getElementById(`${p}-page`);if(m){m.scrollTop=0;const g=m.querySelector(".updates-button");g&&g.click()}}},children:[t(v,{icon:b,size:"xl",alt:f}),t("span",{children:[t(ke,{children:f}),u&&t(E,{children:[t("br",{}),t("small",{children:u})]})]})]})},`${y}-${p}-${f}-${u}-${a}`))})}):t(Yt,{instanceRef:c,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",onMenuChange:p=>{p.open&&o.current&&ge().then(h)},menuButton:t("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:p=>{p.preventDefault(),C.showShortcutsSettings=!0},onTransitionStart:p=>{var a,f;try{const{target:u}=p;getComputedStyle(u).pointerEvents==="none"&&((f=(a=c.current)==null?void 0:a.closeMenu)==null||f.call(a))}catch{}},children:t(v,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:d.map(({id:p,path:a,title:f,subtitle:u,icon:b},y)=>p==="lists"?t(xe,{menuClassName:"glass-menu",overflow:"auto",gap:-8,label:t(E,{children:[t(v,{icon:b,size:"l"}),t("span",{class:"menu-grow",children:t(ke,{children:f})}),t(v,{icon:"chevron-right"})]}),children:[t(vt,{to:"/l",children:t("span",{children:"All Lists"})}),t(Et,{}),l==null?void 0:l.map(S=>t(vt,{to:`/l/${S.id}`,children:t("span",{children:S.title})},S.id))]}):t(vt,{to:a,class:"glass-menu-item",children:[t(v,{icon:b,size:"l"})," ",t("span",{class:"menu-grow",children:[t("span",{children:t(ke,{children:f})}),u&&t(E,{children:[" ",t("small",{class:"more-insignificant",children:u})]})]}),t("span",{class:"menu-shortcut hide-until-focus-visible",children:y+1})]},`${y}-${p}-${f}-${u}-${a}`))})})}const ys=Bt(bs);function Ke({list:e,onClose:n}){const{masto:s}=V(),[i,c]=R("default"),o=!!e,d=P(),r=P(),l=P();G(()=>{o&&(d.current.value=e.title,r.current.value=e.repliesPolicy,l.current&&(l.current.checked=e.exclusive))},[o]);const h=zn("@mastodon/list-exclusive");return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(v,{icon:"x"})})," ",t("header",{children:t("h2",{children:o?"Edit list":"New list"})}),t("main",{children:t("form",{class:"list-form",onSubmit:p=>{p.preventDefault();const a=new FormData(p.target),f=a.get("title"),u=a.get("replies_policy"),b=a.get("exclusive")==="on";c("loading"),(async()=>{try{let y;o?y=await s.v1.lists.$select(e.id).update({title:f,replies_policy:u,exclusive:b}):y=await s.v1.lists.create({title:f,replies_policy:u,exclusive:b}),c("default"),n==null||n({state:"success",list:y}),setTimeout(()=>{o?us(y):ds(y)},1)}catch{c("error"),alert(o?"Unable to edit list.":"Unable to create list.")}})()},children:[t("div",{class:"list-form-row",children:t("label",{for:"list-title",children:["Name"," ",t("input",{ref:d,type:"text",id:"list-title",name:"title",required:!0,disabled:i==="loading",dir:"auto"})]})}),t("div",{class:"list-form-row",children:t("select",{ref:r,name:"replies_policy",required:!0,disabled:i==="loading",children:[t("option",{value:"list",children:"Show replies to list members"}),t("option",{value:"followed",children:"Show replies to people I follow"}),t("option",{value:"none",children:"Don't show replies"})]})}),h&&t("div",{class:"list-form-row",children:t("label",{class:"label-block",children:[t("input",{ref:l,type:"checkbox",name:"exclusive",disabled:i==="loading"})," ","Hide posts on this list from Home/Following"]})}),t("div",{class:"list-form-footer",children:[t("button",{type:"submit",disabled:i==="loading",children:o?"Save":"Create"}),o&&t(te,{disabled:i==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{c("loading"),(async()=>{try{await s.v1.lists.$select(e.id).remove(),c("default"),n==null||n({state:"deleted"}),setTimeout(()=>{hs(e.id)},1)}catch{c("error"),alert("Unable to delete list.")}})()},children:t("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete…"})})]})]})})]})}const ws=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],pn={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},mn=80,Jn=1e3*60*10;function vs(e,n){return n.v1.accounts.familiarFollowers.fetch({id:[e]})}const Ss=ee(vs,{maxAge:Jn});async function ks(e,n){const s=n.v1.accounts.$select(e).statuses.list({limit:20}).next(),{value:i}=await s,c={total:i.length,originals:0,replies:0,boosts:0};return i.forEach(o=>{o.reblog?c.boosts++:o.inReplyToId&&o.inReplyToAccountId!==o.account.id?c.replies++:c.originals++}),i.length&&(c.daysSinceLastPost=Math.ceil((Date.now()-new Date(i[i.length-1].createdAt))/864e5)),c}const Is=ee(ks,{maxAge:Jn});function Ts({account:e,fetchAccount:n=()=>{},standalone:s,instance:i,authenticated:c}){const{masto:o}=V({instance:i}),{masto:d,instance:r}=V(),[l,h]=R("default"),p=typeof e=="string",[a,f]=R(p?null:e),u=gt(()=>i===r,[i,r]);G(()=>{if(!p){f(e);return}h("loading"),(async()=>{try{const U=await n();C.accounts[`${U.id}@${i}`]=U,f(U),h("default")}catch{f(null),h("error")}})()},[p,e,n]);const{acct:b,avatar:y,avatarStatic:S,bot:m,createdAt:g,displayName:k,emojis:w,fields:I,followersCount:A,followingCount:L,group:H,id:B,lastStatusAt:F,locked:X,note:N,statusesCount:_,url:x,username:M,memorial:D,moved:it,roles:wt}=a||{};let ht=!1,{header:q,headerStatic:rt}=a||{};(!q||/missing\.png$/.test(q))&&y&&!/missing\.png$/.test(y)&&(q=y,ht=!0,S&&!/missing\.png$/.test(S)&&(rt=S));const et=gt(()=>B===ct.session.get("currentAccount"),[B]);G(()=>{const U=!!(a!=null&&a.id&&(a!=null&&a.username)&&(a!=null&&a.acct)&&(a!=null&&a.avatar)&&(a!=null&&a.avatarStatic)&&(a!=null&&a.displayName)&&(a!=null&&a.url));if(et&&i&&U){const ut=ct.local.getJSON("accounts");let lt=!1;ut.forEach(mt=>{mt.info.id===a.id&&mt.instanceURL===i&&(mt.info=a,lt=!0)}),lt&&ct.local.setJSON("accounts",ut)}},[et,a,i]);const ft=gt(()=>x?new URL(x).hostname:null,[x]),[pt,At]=R([]),kt=P(),$t=P([]);async function Rt(U){(U||!kt.current)&&(kt.current=o.v1.accounts.$select(B).followers.list({limit:mn}));const ut=await kt.current.next();if(et||!u)return ut;const{value:lt}=ut;let mt=[];if(U){const Ot=await o.v1.accounts.familiarFollowers.fetch({id:[B]});$t.current=Ot[0].accounts,mt=[...$t.current,...lt.filter(Ut=>!$t.current.some(Nt=>Nt.id===Ut.id))]}else lt!=null&&lt.length&&(mt=lt.filter(Ot=>!$t.current.some(Ut=>Ut.id===Ot.id)));return{...ut,value:mt}}const yt=P();async function Y(U){return(U||!yt.current)&&(yt.current=o.v1.accounts.$select(B).following.list({limit:mn})),await yt.current.next()}const tt=s?"div":Q,K=i?`/${i}/a/${B}`:`/a/${B}`,[bt,dt]=R([]),[Z,O]=R(),[$,W]=R("default"),J=!!(Z!=null&&Z.total),T=async U=>{try{const ut=await Ss(U,d);dt(ut[0].accounts.slice(0,$s))}catch{}},z=async()=>{if(B){W("loading");try{const U=await Is(B,o);O(U),W("default")}catch{W("error")}}},j=qt(({relationship:U,currentID:ut})=>{U.following||(T(ut),!s&&_>0&&z())},[s,B,_]),at=qt(U=>{U.id===B&&(f(U),C.accounts[`${U.id}@${i}`]=U)},[B,i]);return t("div",{tabIndex:"-1",class:`account-container ${l==="loading"?"skeleton":""}`,style:{"--header-color-1":pt[0],"--header-color-2":pt[1],"--header-color-3":pt[2],"--header-color-4":pt[3]},children:[l==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to load account."}),t("p",{children:t("a",{href:p?e:x,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",t(v,{icon:"external"})]})})]}),l==="loading"?t(E,{children:[t("header",{children:t(Zt,{avatarSize:"xxxl",skeleton:!0})}),t("main",{children:[t("div",{class:"note",children:[t("p",{children:"███████ ████ ████"}),t("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),t("div",{class:"account-metadata-box",children:[t("div",{class:"profile-metadata",children:[t("div",{class:"profile-field",children:[t("b",{class:"more-insignificant",children:"███"}),t("p",{children:"██████"})]}),t("div",{class:"profile-field",children:[t("b",{class:"more-insignificant",children:"████"}),t("p",{children:"███████████"})]})]}),t("div",{class:"stats",children:[t("div",{children:[t("span",{children:"██"})," Followers"]}),t("div",{children:[t("span",{children:"██"})," Following"]}),t("div",{children:[t("span",{children:"██"})," Posts"]})]})]}),t("div",{class:"actions",children:[t("span",{}),t("span",{class:"buttons",children:t("button",{type:"button",title:"More",class:"plain",disabled:!0,children:t(v,{icon:"more",size:"l",alt:"More"})})})]})]})]}):a&&t(E,{children:[!!it&&t("div",{class:"account-moved",children:[t("p",{children:[t("b",{children:k})," has indicated that their new account is now:"]}),t(Zt,{account:it,instance:i,onClick:U=>{U.stopPropagation(),C.showAccount=it}})]}),!!q&&!/missing\.png$/.test(q)&&t("img",{src:q,alt:"",class:`header-banner ${ht?"header-is-avatar":""}`,onError:U=>{U.target.crossOrigin?U.target.src!==rt?U.target.src=rt:(U.target.removeAttribute("crossorigin"),U.target.src=q):U.target.src!==rt?U.target.src=rt:U.target.remove()},crossOrigin:"anonymous",onLoad:U=>{U.target.classList.add("loaded");try{const ut=window.OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas"),lt=ut.getContext("2d",{willReadFrequently:!0});ut.width=U.target.width,ut.height=U.target.height,lt.imageSmoothingEnabled=!1,lt.drawImage(U.target,0,0);const mt=10,Ut=[lt.getImageData(0,0,mt,mt).data,lt.getImageData(U.target.width-mt,0,mt,mt).data,lt.getImageData(0,U.target.height-mt,mt,mt).data,lt.getImageData(U.target.width-mt,U.target.height-mt,mt,mt).data].map(Nt=>{let Ht=0,Ct=0,zt=0,se=0;for(let jt=0;jt<Nt.length;jt+=4)Ht+=Nt[jt],Ct+=Nt[jt+1],zt+=Nt[jt+2],se+=Nt[jt+3];const Vt=Nt.length/4;return[Ht/Vt,Ct/Vt,zt/Vt,se/Vt]}).map(Nt=>{const[Ht,Ct,zt,se]=xs(Nt);return`rgba(${Ht}, ${Ct}, ${zt}, ${se})`});At(Ut)}catch{}}}),t("header",{children:t(Zt,{account:a,instance:i,avatarSize:"xxxl",external:s,internal:!s})}),t("div",{class:"faux-header-bg","aria-hidden":"true"}),t("main",{children:[!!D&&t("span",{class:"tag",children:"In Memoriam"}),!!m&&t("span",{class:"tag",children:[t(v,{icon:"bot"})," Automated"]}),!!H&&t("span",{class:"tag",children:[t(v,{icon:"group"})," Group"]}),wt==null?void 0:wt.map(U=>t("span",{class:"tag",children:[U.name,!!ft&&t(E,{children:[" ",t("span",{class:"more-insignificant",children:ft})]})]})),t("div",{class:"note",dir:"auto",onClick:qn({instance:r}),dangerouslySetInnerHTML:{__html:Oe(N,{emojis:w})}}),t("div",{class:"account-metadata-box",children:[(I==null?void 0:I.length)>0&&t("div",{class:"profile-metadata",children:I.map(({name:U,value:ut,verifiedAt:lt},mt)=>t("div",{class:`profile-field ${lt?"profile-verified":""}`,dir:"auto",children:[t("b",{children:[t(Hn,{text:U,emojis:w})," ",!!lt&&t(v,{icon:"check-circle",size:"s"})]}),t("p",{dangerouslySetInnerHTML:{__html:Oe(ut,{emojis:w})}})]},U+mt))}),t("div",{class:"stats",children:[t(tt,{tabIndex:0,to:K,onClick:()=>{setTimeout(()=>{C.showGenericAccounts={heading:"Followers",fetchAccounts:Rt,instance:i,excludeRelationshipAttrs:et?["followedBy"]:[]}},0)},children:[!!bt.length&&t("span",{class:"shazam-container-horizontal",children:t("span",{class:"shazam-container-inner stats-avatars-bunch",children:bt.map(U=>t(re,{url:U.avatarStatic,size:"s",alt:`${U.displayName} @${U.acct}`,squircle:U==null?void 0:U.bot}))})}),t("span",{title:A,children:Ft(A)})," ","Followers"]}),t(tt,{class:"insignificant",tabIndex:0,to:K,onClick:()=>{setTimeout(()=>{C.showGenericAccounts={heading:"Following",fetchAccounts:Y,instance:i,excludeRelationshipAttrs:et?["following"]:[]}},0)},children:[t("span",{title:L,children:Ft(L)})," ","Following",t("br",{})]}),t(tt,{class:"insignificant",to:K,children:[t("span",{title:_,children:Ft(_)})," ","Posts"]}),!!g&&t("div",{class:"insignificant",children:["Joined"," ",t("time",{datetime:g,children:ne(g,{hideTime:!0})})]})]})]}),!!Z&&t(tt,{to:K,class:"account-metadata-box",children:t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:J?t("div",{class:"posting-stats",title:`${Math.round(Z.originals/Z.total*100)}% original posts, ${Math.round(Z.replies/Z.total*100)}% replies, ${Math.round(Z.boosts/Z.total*100)}% boosts`,children:[t("div",{children:Z.daysSinceLastPost<365?`Last ${Z.total} post${Z.total>1?"s":""} in the past 
                      ${Z.daysSinceLastPost} day${Z.daysSinceLastPost>1?"s":""}`:`
                      Last ${Z.total} posts in the past year(s)
                      `}),t("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${Z.originals/Z.total*100}%`,"--replies-percentage":`${(Z.originals+Z.replies)/Z.total*100}%`}}),t("div",{class:"posting-stats-legends",children:[t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):t("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),t("div",{class:"account-metadata-box",children:t("div",{class:"shazam-container no-animation",hidden:!!Z,children:t("div",{class:"shazam-container-inner",children:t("button",{type:"button",class:"posting-stats-button",disabled:$==="loading",onClick:()=>{z()},children:[t("div",{class:`posting-stats-bar posting-stats-icon ${$==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),t("footer",{children:t(Cs,{info:a,instance:i,standalone:s,authenticated:c,onRelationshipChange:j,onProfileUpdate:at})})]})]})}const $s=3;function Cs({info:e,instance:n,standalone:s,authenticated:i,onRelationshipChange:c=()=>{},onProfileUpdate:o=()=>{}}){var Z;if(!e)return null;const{masto:d,instance:r,authenticated:l}=V(),h=n===r,[p,a]=R("default"),[f,u]=R(null),{id:b,acct:y,url:S,username:m,locked:g,lastStatusAt:k,note:w,fields:I,moved:A}=e,L=P(b),{following:H,showingReblogs:B,notifying:F,followedBy:X,blocking:N,blockedBy:_,muting:x,mutingNotifications:M,requested:D,domainBlocking:it,endorsed:wt,note:ht}=f||{},[q,rt]=R(null),[et,ft]=R(!1);G(()=>{if(e){const O=ct.session.get("currentAccount");let $;(async()=>{if(h&&i)$=b;else if(!h&&l){const J=e.acct.includes("@");try{const T=await d.v2.search.fetch({q:J?e.acct:`${e.username}@${n}`,type:"accounts",limit:1,resolve:!0});T.accounts.length&&($=T.accounts[0].id,rt(T.accounts[0]))}catch{}}if(!$)return;if(O===$){ft(!0);return}if(L.current=$,A)return;a("loading");const W=d.v1.accounts.relationships.fetch({id:[$]});try{const J=await W;if(a("default"),J.length){const T=J[0];u(T),c({relationship:T,currentID:$})}}catch{a("error")}})()}},[e,i]),G(()=>{e&&et&&bi(e)},[e,et]);const pt=p==="loading",[At,kt]=R(!1),[$t,Rt]=R(!1),[yt,Y]=R(!1),[tt,K]=R(!1),[bt,dt]=R([]);return t(E,{children:[t("div",{class:"actions",children:[t("span",{children:[X?t("span",{class:"tag",children:"Follows you"}):k?t("small",{class:"insignificant",children:["Last post:"," ",t("span",{class:"ib",children:ne(k,{hideTime:!0})})]}):t("span",{}),x&&t("span",{class:"tag danger",children:"Muted"}),N&&t("span",{class:"tag danger",children:"Blocked"})]})," ",t("span",{class:"buttons",children:[!!ht&&t("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{Y(!0)},dir:"auto",children:t("span",{children:ht})}),t(Yt,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:t("button",{type:"button",title:"More",class:"plain",disabled:pt,children:t(v,{icon:"more",size:"l",alt:"More"})}),onMenuChange:O=>{H&&O.open&&(async()=>{try{const $=await d.v1.accounts.$select(L.current).lists.list();dt($)}catch{}})()},children:[l&&!et&&t(E,{children:[t(st,{onClick:()=>{C.showCompose={draftStatus:{status:`@${(q==null?void 0:q.acct)||y} `}}},children:[t(v,{icon:"at"}),t("span",{children:["Mention @",m]})]}),t(st,{onClick:()=>{kt(!0)},children:[t(v,{icon:"translate"}),t("span",{children:"Translate bio"})]}),t(st,{onClick:()=>{Y(!0)},children:[t(v,{icon:"pencil"}),t("span",{children:ht?"Edit private note":"Add private note"})]}),H&&!!f&&t(E,{children:[t(st,{onClick:()=>{a("loading"),(async()=>{try{const O=await d.v1.accounts.$select(L.current).follow({notify:!F});O&&u(O),a("default"),ot(O.notifying?`Notifications enabled for @${m}'s posts.`:` Notifications disabled for @${m}'s posts.`)}catch(O){alert(O),a("error")}})()},children:[t(v,{icon:"notification"}),t("span",{children:F?"Disable notifications":"Enable notifications"})]}),t(st,{onClick:()=>{a("loading"),(async()=>{try{const O=await d.v1.accounts.$select(L.current).follow({reblogs:!B});O&&u(O),a("default"),ot(O.showingReblogs?`Boosts from @${m} disabled.`:`Boosts from @${m} enabled.`)}catch(O){alert(O),a("error")}})()},children:[t(v,{icon:"rocket"}),t("span",{children:B?"Disable boosts":"Enable boosts"})]})]}),H&&t(st,{onClick:()=>{Rt(!0)},children:[t(v,{icon:"list"}),bt.length?t(E,{children:[t("small",{class:"menu-grow",children:["Add/Remove from Lists",t("br",{}),t("span",{class:"more-insignificant",children:bt.map(O=>O.title).join(", ")})]}),t("small",{class:"more-insignificant",children:bt.length})]}):t("span",{children:"Add/Remove from Lists"})]}),t(Et,{})]}),t(st,{onClick:()=>{const O=`@${(q==null?void 0:q.acct)||y}`;try{navigator.clipboard.writeText(O),ot("Handle copied")}catch{ot("Unable to copy handle")}},children:[t(v,{icon:"copy"}),t("small",{children:["Copy handle",t("br",{}),t("span",{class:"more-insignificant",children:["@",(q==null?void 0:q.acct)||y]})]})]}),t(st,{href:S,target:"_blank",children:[t(v,{icon:"external"}),t("small",{class:"menu-double-lines",children:As(S)})]}),t("div",{class:"menu-horizontal",children:[t(st,{onClick:()=>{try{navigator.clipboard.writeText(S),ot("Link copied")}catch{ot("Unable to copy link")}},children:[t(v,{icon:"link"}),t("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((Z=navigator==null?void 0:navigator.canShare)==null?void 0:Z.call(navigator,{url:S}))&&t(st,{onClick:()=>{try{navigator.share({url:S})}catch{alert("Sharing doesn't seem to work.")}},children:[t(v,{icon:"share"}),t("span",{children:"Share…"})]})]}),!!f&&t(E,{children:[t(Et,{}),x?t(st,{onClick:()=>{a("loading"),(async()=>{try{const O=await d.v1.accounts.$select((q==null?void 0:q.id)||b).unmute();u(O),a("default"),ot(`Unmuted @${m}`),C.reloadGenericAccounts.id="mute",C.reloadGenericAccounts.counter++}catch{a("error")}})()},children:[t(v,{icon:"unmute"}),t("span",{children:["Unmute @",m]})]}):t(xe,{menuClassName:"menu-blur",openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:t(E,{children:[t(v,{icon:"mute"}),t("span",{class:"menu-grow",children:["Mute @",m,"…"]}),t("span",{style:{textOverflow:"clip"},children:[t(v,{icon:"time"}),t(v,{icon:"chevron-right"})]})]}),children:t("div",{class:"menu-wrap",children:ws.map(O=>t(st,{onClick:()=>{a("loading"),(async()=>{try{const $=await d.v1.accounts.$select((q==null?void 0:q.id)||b).mute({duration:O});u($),a("default"),ot(`Muted @${m} for ${pn[O]}`),C.reloadGenericAccounts.id="mute",C.reloadGenericAccounts.counter++}catch{a("error"),ot(`Unable to mute @${m}`)}})()},children:pn[O]}))})}),t(te,{subMenu:!0,confirm:!N,confirmLabel:t(E,{children:[t(v,{icon:"block"}),t("span",{children:["Block @",m,"?"]})]}),menuItemClassName:"danger",onClick:()=>{a("loading"),(async()=>{try{if(N){const O=await d.v1.accounts.$select((q==null?void 0:q.id)||b).unblock();u(O),a("default"),ot(`Unblocked @${m}`)}else{const O=await d.v1.accounts.$select((q==null?void 0:q.id)||b).block();u(O),a("default"),ot(`Blocked @${m}`)}C.reloadGenericAccounts.id="block",C.reloadGenericAccounts.counter++}catch{a("error"),N?ot(`Unable to unblock @${m}`):ot(`Unable to block @${m}`)}})()},children:N?t(E,{children:[t(v,{icon:"unblock"}),t("span",{children:["Unblock @",m]})]}):t(E,{children:[t(v,{icon:"block"}),t("span",{children:["Block @",m,"…"]})]})}),t(st,{className:"danger",onClick:()=>{C.showReportModal={account:q||e}},children:[t(v,{icon:"flag"}),t("span",{children:["Report @",m,"…"]})]})]}),l&&et&&s&&t(E,{children:[t(Et,{}),t(st,{onClick:()=>{K(!0)},children:[t(v,{icon:"pencil"}),t("span",{children:"Edit profile"})]})]}),!1]}),!f&&p==="loading"&&t(St,{abrupt:!0}),!!f&&t(te,{confirm:H||D,confirmLabel:t("span",{children:D?"Withdraw follow request?":`Unfollow @${e.acct||e.username}?`}),menuItemClassName:"danger",align:"end",disabled:pt,onClick:()=>{a("loading"),(async()=>{try{let O;H||D?O=await d.v1.accounts.$select(L.current).unfollow():O=await d.v1.accounts.$select(L.current).follow(),O&&u(O),a("default")}catch(O){alert(O),a("error")}})()},children:t("button",{type:"button",class:`${H||D?"light swap":""}`,"data-swap-state":H||D?"danger":"",disabled:pt,children:H?t(E,{children:[t("span",{children:"Following"}),t("span",{children:"Unfollow…"})]}):D?t(E,{children:[t("span",{children:"Requested"}),t("span",{children:"Withdraw…"})]}):g?t(E,{children:[t(v,{icon:"lock"})," ",t("span",{children:"Follow"})]}):"Follow"})})]})]}),!!At&&t(Dt,{onClose:()=>{kt(!1)},children:t(Rs,{note:w,fields:I,onClose:()=>kt(!1)})}),!!$t&&t(Dt,{onClose:()=>{Rt(!1)},children:t(Es,{accountID:L.current,onClose:()=>Rt(!1)})}),!!yt&&t(Dt,{onClose:()=>{Y(!1)},children:t(Ls,{account:e,note:ht,onRelationshipChange:O=>{u(O)},onClose:()=>Y(!1)})}),!!tt&&t(Dt,{onClose:()=>{K(!1)},children:t(_s,{onClose:({state:O,account:$}={})=>{K(!1),O==="success"&&$&&o($)}})})]})}function xs([e,n,s]){const i=.2126*e+.7152*n+.0722*s;let c;return i>=220?c=1:i<=50?c=.1:c=i/255,c=Math.min(1,c),[e,n,s,c]}function As(e){if(!e)return;const n=new URL(e),{host:s,pathname:i}=n,c=i.replace(/\/$/,"").replace(/^\//,"");return t(E,{children:[t("span",{class:"more-insignificant",children:[s,"/"]}),t("wbr",{}),t("span",{children:c})]})}function Rs({note:e,fields:n,onClose:s}){const i=(n==null?void 0:n.map(({name:o,value:d})=>`${o}
${rn(d)}`).join(`

`))||"",c=rn(e)+(i?`

${i}`:"");return t("div",{class:"sheet",children:[!!s&&t("button",{type:"button",class:"sheet-close",onClick:s,children:t(v,{icon:"x"})}),t("header",{children:t("h2",{children:"Translated Bio"})}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:c}),t(Oi,{forceTranslate:!0,text:c})]})]})}function Es({accountID:e,onClose:n}){const{masto:s}=V(),[i,c]=R("default"),[o,d]=R([]),[r,l]=R([]),[h,p]=Ee(u=>u+1,0);G(()=>{c("loading"),(async()=>{try{const u=await ge();d(u);const b=await s.v1.accounts.$select(e).lists.list();l(b),c("default")}catch{c("error")}})()},[h]);const[a,f]=R(!1);return t("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(v,{icon:"x"})}),t("header",{children:t("h2",{children:"Add/Remove from Lists"})}),t("main",{children:[o.length>0?t("ul",{class:"list-add-remove",children:o.map(u=>{const b=r.some(y=>y.id===u.id);return t("li",{children:t("button",{type:"button",class:`light ${b?"checked":""}`,disabled:i==="loading",onClick:()=>{c("loading"),(async()=>{try{b?await s.v1.lists.$select(u.id).accounts.remove({accountIds:[e]}):await s.v1.lists.$select(u.id).accounts.create({accountIds:[e]}),p()}catch{c("error"),alert(b?"Unable to remove from list.":"Unable to add to list.")}})()},children:[t(v,{icon:"check-circle"}),t("span",{children:u.title})]})})})}):i==="loading"?t("p",{class:"ui-state",children:t(St,{abrupt:!0})}):i==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists."}),t("button",{type:"button",class:"plain2",onClick:()=>f(!0),disabled:i!=="default",children:[t(v,{icon:"plus",size:"l"})," ",t("span",{children:"New list"})]})]}),a&&t(Dt,{onClick:u=>{u.target===u.currentTarget&&f(!1)},children:t(Ke,{list:a==null?void 0:a.list,onClose:u=>{u.state==="success"&&p(),f(!1)}})})]})}function Ls({account:e,note:n,onRelationshipChange:s=()=>{},onClose:i=()=>{}}){const{masto:c}=V(),[o,d]=R("default"),r=P(null);return G(()=>{let l;return r.current&&!n&&(l=setTimeout(()=>{var h,p;(p=(h=r.current).focus)==null||p.call(h)},100)),()=>{clearTimeout(l)}},[]),t("div",{class:"sheet",id:"private-note-container",children:[!!i&&t("button",{type:"button",class:"sheet-close",onClick:i,children:t(v,{icon:"x"})}),t("header",{children:t("b",{children:["Private note about @",(e==null?void 0:e.username)||(e==null?void 0:e.acct)]})}),t("main",{children:t("form",{onSubmit:l=>{l.preventDefault();const p=new FormData(l.target).get("note");(p==null?void 0:p.trim())!==(n==null?void 0:n.trim())&&(d("loading"),(async()=>{try{const a=await c.v1.accounts.$select(e==null?void 0:e.id).note.create({comment:p});d("default"),s(a),i()}catch(a){d("error"),alert((a==null?void 0:a.message)||"Unable to update private note.")}})())},children:[t("textarea",{ref:r,name:"note",disabled:o==="loading",children:n}),t("footer",{children:[t("button",{type:"button",class:"light",disabled:o==="loading",onClick:()=>{i==null||i()},children:"Cancel"}),t("span",{children:[t(St,{abrupt:!0,hidden:o!=="loading"}),t("button",{disabled:o==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function _s({onClose:e=()=>{}}){const{masto:n}=V(),[s,i]=R("loading"),[c,o]=R(null);G(()=>{(async()=>{try{const a=await n.v1.accounts.verifyCredentials();o(a),i("default")}catch{i("error")}})()},[]);const{displayName:d,source:r}=c||{},{note:l,fields:h}=r||{},p=P(null);return t("div",{class:"sheet",id:"edit-profile-container",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(v,{icon:"x"})}),t("header",{children:t("b",{children:"Edit profile"})}),t("main",{children:s==="loading"?t("p",{class:"ui-state",children:t(St,{abrupt:!0})}):t("form",{onSubmit:a=>{a.preventDefault();const f=new FormData(a.target),u=f.get("display_name"),b=f.get("note"),y=p.current.querySelectorAll('input[name^="fields_attributes"]'),S=[];y.forEach(m=>{const g=m.name,[k,w,I]=g.match(/fields_attributes\[(\d+)\]\[(.+)\]/)||[],A=m.value?m.value.trim():"";w&&I&&A&&(S[w]||(S[w]={}),S[w][I]=A)}),S.forEach(m=>{m.name&&!m.value&&(m.value="")}),(async()=>{try{const m=await n.v1.accounts.updateCredentials({displayName:u,note:b,fieldsAttributes:S});e==null||e({state:"success",account:m})}catch(m){alert((m==null?void 0:m.message)||"Unable to update profile.")}})()},children:[t("p",{children:t("label",{children:["Name"," ",t("input",{type:"text",name:"display_name",defaultValue:d,maxLength:30,disabled:s==="loading"})]})}),t("p",{children:t("label",{children:["Bio",t("textarea",{defaultValue:l,name:"note",maxLength:500,rows:"5",disabled:s==="loading"})]})}),t("p",{children:"Extra fields"}),t("table",{ref:p,children:[t("thead",{children:t("tr",{children:[t("th",{children:"Label"}),t("th",{children:"Content"})]})}),t("tbody",{children:Array.from({length:Math.max(4,h.length)}).map((a,f)=>{const{name:u="",value:b=""}=h[f]||{};return t(Ns,{name:u,value:b,index:f,disabled:s==="loading"},f)})})]}),t("footer",{children:[t("button",{type:"button",class:"light",disabled:s==="loading",onClick:()=>{e==null||e()},children:"Cancel"}),t("button",{type:"submit",disabled:s==="loading",children:"Save"})]})]})})]})}function Ns({name:e,value:n,disabled:s,index:i}){const[c,o]=R(!!n);return t("tr",{children:[t("td",{children:t("input",{type:"text",name:`fields_attributes[${i}][name]`,defaultValue:e,disabled:s,maxLength:255,required:c})}),t("td",{children:t("input",{type:"text",name:`fields_attributes[${i}][value]`,defaultValue:n,disabled:s,maxLength:255,onChange:d=>o(!!d.currentTarget.value)})})]})}async function Xn(e,n={}){if(!(e!=null&&e.length))return;const{masto:s}=V(),i=ct.session.get("currentAccount"),c=e.reduce((o,d)=>(!o.includes(d.id)&&!n[d.id]&&d.id!==i&&o.push(d.id),o),[]);if(!c.length)return null;try{return(await s.v1.accounts.relationships.fetch({id:c})).reduce((r,l)=>(r[l.id]=l,r),{})}catch{return null}}function Ms(e){var c;let n=[],s=[],i=0;for(let o=0;o<e.length;o++){const d=e[o];d.reblog&&!((c=d.account)!=null&&c.group)?(s.push(d),i++):(n.push(d),i<3&&(i=0))}if(e.length>10&&(s.length>e.length/4||i>=3)){const o=s.map(d=>d.id);if(s.length>e.length*3/4)n=[...n,{id:o,items:s,type:"boosts"}];else{const d=Math.floor(n.length/2);n=[...n.slice(0,d),{id:o,items:s,type:"boosts"},...n.slice(d)]}return n}else return e}function gn(e,n){const s=ct.account.get("boostedStatusIDs")||{},i=e.filter(o=>{if(!o.reblog)return!0;const d=`${n}-${o.reblog.id}`,r=s[d];return r&&r!==o.id?!1:(s[d]=o.id,!0)}),c=Object.keys(s);return c.length>50&&c.slice(0,c.length-50).forEach(o=>{delete s[o]}),ct.account.set("boostedStatusIDs",s),i}function Ps(e,n){const s=[];let i=0;e.forEach(d=>{for(let l=0;l<s.length;l++){if(s[l].find(h=>h.id===d.id))return;if(s[l].find(h=>h.id===d.inReplyToId)||s[l].find(h=>h.inReplyToId===d.id)){s[l].push(d);return}}const r=e.find(l=>l.id===d.inReplyToId);r&&(s[i++]=[d,r])});for(let d=0;d<s.length;d++)for(let r=d+1;r<s.length;r++)s[d].find(h=>s[r].includes(h))&&(s[d]=[...s[d],...s[r]],s[d]=s[d].filter((h,p,a)=>a.findIndex(f=>f.id===h.id)===p),s.splice(r,1),r--);s.forEach(d=>{d.sort((r,l)=>!r.inReplyToId&&!l.inReplyToId?new Date(r.createdAt)-new Date(l.createdAt):r.inReplyToId===l.id?1:l.inReplyToId===r.id||!r.inReplyToId?-1:l.inReplyToId?new Date(r.createdAt)-new Date(l.createdAt):1)}),s.forEach(d=>{const r=d[0].account.id;d.forEach(l=>{l.account.id!==r&&(l._differentAuthor=!0)})}),s.length;const c=[],o=[];return e.forEach(d=>{if(d.reblog){c.push(d);return}for(let r=0;r<s.length;r++)if(s[r].find(l=>l.id===d.id)){if(o.includes(r))return;const l=s[r];l.sort((p,a)=>{const f=new Date(p.createdAt),u=new Date(a.createdAt);return f-u});const h=l[0].account.id;c.push({id:l.map(p=>p.id),items:l,type:l.every(p=>p.account.id===h)?"thread":"conversation"}),o.push(r);return}if(d.inReplyToId&&d.inReplyToAccountId!==d.account.id){const r=Gt(d.id,n);C.statusReply[r]||queueMicrotask(async()=>{try{const{masto:l}=V({instance:n}),h=await Ds(d.inReplyToId,l);_t(h,n,{skipThreading:!0,skipUnfurling:!0}),C.statusReply[r]={id:h.id,instance:n}}catch{}})}c.push(d)}),c}const Ds=ee((e,n)=>n.v1.statuses.$select(e).fetch());async function Us(e,n){const s=await os();if(!s.length)return;const{statusFollowedTags:i}=C,c=[];if(e.forEach(o=>{var f;if(o.reblog)return;const{id:d,content:r,tags:l=[]}=o,h=Gt(d,n);if((f=i[h])!=null&&f.length)return;const p=cs(r);if(!p.length&&!l.length)return;const a=s.reduce((u,b)=>((p.some(y=>y.toLowerCase()===b.name.toLowerCase())||l.some(y=>y.name.toLowerCase()===b.name.toLowerCase()))&&u.push(b.name),u),[]);a.length&&c.push({item:o,sKey:h,followedTags:a})}),c.length){const o=c.map(r=>r.item.account),d=await Xn(o);if(!d)return;c.forEach(r=>{const{item:l,sKey:h,followedTags:p}=r,a=d[l.account.id];a&&!a.following&&(i[h]=p)})}}function Fs(){C.statusFollowedTags={}}function Bs({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:i=10,scrollThresholdEnd:c=10,direction:o="vertical",distanceFromStartPx:d,distanceFromEndPx:r}={}){const[l,h]=R(null),[p,a]=R(!1),[f,u]=R(!1),[b,y]=R(!1),[S,m]=R(!1),g=o==="vertical";return Jt(()=>{const k=e.current;if(!k)return{};let w=g?k.scrollTop:k.scrollLeft;function I(){const{scrollTop:A,scrollLeft:L,scrollHeight:H,scrollWidth:B,clientHeight:F,clientWidth:X}=k,N=g?A:L,_=g?H:B,x=g?F:X,M=Math.abs(N-w),D=d||Math.min(x*n,_,N),it=r||Math.min(x*s,_,_-N-x);M>=(w<N?c:i)&&(h(w<N?"end":"start"),w=N),a(N<=0),u(N+x>=_),y(N<=D),m(N+x>=_-it)}return k.addEventListener("scroll",I,{passive:!0}),()=>k.removeEventListener("scroll",I)},[n,s,i,c]),{scrollDirection:l,reachStart:p,reachEnd:f,nearReachStart:b,nearReachEnd:S,init:()=>{e.current&&e.current.dispatchEvent(new Event("scroll"))}}}function Os({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:i=10,scrollThresholdEnd:c=10,direction:o="vertical",distanceFromStartPx:d,distanceFromEndPx:r,init:l}={},h,p){if(!h)return;const a=o==="vertical",f=P(null),u=P(null),b=Ci(()=>{let y=!1,S=!1,m=!1,g=!1;const k=e.current,{scrollTop:w,scrollLeft:I,scrollHeight:A,scrollWidth:L,clientHeight:H,clientWidth:B}=k,F=a?w:I,X=a?A:L,N=a?H:B,_=Math.abs(F-f.current),x=d||Math.min(N*n,X,F),M=r||Math.min(N*s,X,X-F-N);_>=(f.current<F?c:i)&&(u.current=f.current<F?"end":"start",f.current=F),y=F<=0,S=F+N>=X,m=F<=x,g=F+N>=X-M,h({scrollDirection:u.current,reachStart:y,reachEnd:S,nearReachStart:m,nearReachEnd:g})},500);Jt(()=>{const y=e.current;return y?(f.current=y[a?"scrollTop":"scrollLeft"],y.addEventListener("scroll",b,{passive:!0}),()=>y.removeEventListener("scroll",b)):{}},[n,s,i,c,...p]),G(()=>{l&&e.current&&queueMicrotask(()=>{e.current.dispatchEvent(new Event("scroll"))})},[l])}function zs({class:e,statusID:n,status:s,instance:i,parent:c,onMediaClick:o}){let d=Gt(n,i);const r=xt(C);if(s||(s=r.statuses[d]||r.statuses[n],d=Gt(s==null?void 0:s.id,i)),!s)return null;const{account:{acct:l,avatar:h,avatarStatic:p,id:a,url:f,displayName:u,username:b,emojis:y,bot:S,group:m},id:g,repliesCount:k,reblogged:w,reblogsCount:I,favourited:A,favouritesCount:L,bookmarked:H,poll:B,muted:F,sensitive:X,spoilerText:N,visibility:_,language:x,editedAt:M,filtered:D,card:it,createdAt:wt,inReplyToId:ht,inReplyToAccountId:q,content:rt,mentions:et,mediaAttachments:ft,reblog:pt,uri:At,url:kt,emojis:$t,_deleted:Rt,_pinned:yt}=s;if(!(ft!=null&&ft.length))return null;const Y=J=>{J.shiftKey},tt=gt(()=>ct.session.get("currentAccount"),[]),K=gt(()=>tt&&tt===a,[a,tt]),bt=xi(Vn),dt=!K&&ze(D,bt);if((dt==null?void 0:dt.action)==="hide")return null;const Z=X,$=gt(()=>(ct.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",W=c||"div";return ft.map((J,T)=>{const z=`${d}-${J.id}`,j=dt==null?void 0:dt.titlesStr;return t(W,{"data-state-post-id":d,onMouseEnter:Y,"data-spoiler-text":N||(X?"Sensitive media":void 0),"data-filtered-text":dt?`Filtered${j?`: ${j}`:""}`:void 0,class:`
          media-post
          ${dt?"filtered":""}
          ${Z?"has-spoiler":""}
          ${$?"show-media":""}
        `,children:t(jn,{class:e,media:J,lang:x,to:`/${i}/s/${g}?media-only=${T+1}`,onClick:o?at=>o(at,T,J,s):void 0})},z)})}const bn=Bt(zs);function qs(e){var w,I,A,L,H;const n=xt(C),{masto:s,instance:i,authenticated:c}=V(),[o,d]=gt(()=>{const B=ct.local.getJSON("accounts")||[];return[B.find(X=>X.info.id===ct.session.get("currentAccount")),B.length>1]},[]),r=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(B=>B.type==="following"),l=Ai(()=>{C.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),h=P(),[p,a]=R(void 0),f=zi([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),u=P();async function b(B){return(B||!u.current)&&(u.current=s.v1.mutes.list({limit:80})),await u.current.next()}const y=P();async function S(B){return(B||!y.current)&&(y.current=s.v1.blocks.list({limit:80})),await y.current.next()}const[m,g]=R([]);G(()=>{p==="open"&&ge().then(g)},[p==="open"]);const k=P();return t(E,{children:[t("button",{ref:h,type:"button",class:`button plain nav-menu-button ${d?"with-avatar":""} ${p==="open"?"active":""}`,style:{position:"relative"},onClick:()=>{k.current=Date.now(),a(B=>B?void 0:"open")},onContextMenu:B=>{B.preventDefault(),C.showAccounts=!0},...l(),children:[d&&t(re,{url:((w=o==null?void 0:o.info)==null?void 0:w.avatar)||((I=o==null?void 0:o.info)==null?void 0:I.avatarStatic),size:"l",squircle:(A=o==null?void 0:o.info)==null?void 0:A.bot}),t(v,{icon:"menu",size:d?"s":"l"})]}),t(Pn,{menuClassName:"nav-menu",state:p,anchorRef:h,onClose:()=>{a(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-k.current<300}},portal:{target:document.body},...e,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:f,unmountOnClose:!0,children:[!!((L=n.appVersion)!=null&&L.commitHash)&&n.appVersion.commitHash!=="e804e52"&&t("div",{class:"top-menu",children:[t(st,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[t(v,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",t("span",{children:"New update available…"})]}),t(Et,{})]}),t("section",{children:[t(vt,{to:"/",children:[t(v,{icon:"home",size:"l"})," ",t("span",{children:"Home"})]}),c?t(E,{children:[r&&t(vt,{to:"/following",children:[t(v,{icon:"following",size:"l"})," ",t("span",{children:"Following"})]}),t(vt,{to:"/catchup",children:[t(v,{icon:"history2",size:"l"}),t("span",{children:"Catch-up"})]}),t(vt,{to:"/mentions",children:[t(v,{icon:"at",size:"l"})," ",t("span",{children:"Mentions"})]}),t(vt,{to:"/notifications",children:[t(v,{icon:"notification",size:"l"})," ",t("span",{children:"Notifications"}),n.notificationsShowNew&&t("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),t(Et,{}),((H=o==null?void 0:o.info)==null?void 0:H.id)&&t(vt,{to:`/${i}/a/${o.info.id}`,children:[t(v,{icon:"user",size:"l"})," ",t("span",{children:"Profile"})]}),(m==null?void 0:m.length)>0?t(xe,{overflow:"auto",gap:-8,label:t(E,{children:[t(v,{icon:"list",size:"l"}),t("span",{class:"menu-grow",children:"Lists"}),t(v,{icon:"chevron-right"})]}),children:[t(vt,{to:"/l",children:t("span",{children:"All Lists"})}),(m==null?void 0:m.length)>0&&t(E,{children:[t(Et,{}),m.map(B=>t(vt,{to:`/l/${B.id}`,children:t("span",{children:B.title})},B.id))]})]}):t(vt,{to:"/l",children:[t(v,{icon:"list",size:"l"}),t("span",{children:"Lists"})]}),t(vt,{to:"/b",children:[t(v,{icon:"bookmark",size:"l"})," ",t("span",{children:"Bookmarks"})]}),t(xe,{overflow:"auto",gap:-8,label:t(E,{children:[t(v,{icon:"more",size:"l"}),t("span",{class:"menu-grow",children:"More…"}),t(v,{icon:"chevron-right"})]}),children:[t(vt,{to:"/f",children:[t(v,{icon:"heart",size:"l"})," ",t("span",{children:"Likes"})]}),t(vt,{to:"/fh",children:[t(v,{icon:"hashtag",size:"l"})," ",t("span",{children:"Followed Hashtags"})]}),t(Et,{}),t(vt,{to:"/ft",children:[t(v,{icon:"filters",size:"l"}),"Filters"]}),t(st,{onClick:()=>{C.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:b,excludeRelationshipAttrs:["muting"]}},children:[t(v,{icon:"mute",size:"l"})," Muted users…"]}),t(st,{onClick:()=>{C.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:S,excludeRelationshipAttrs:["blocking"]}},children:[t(v,{icon:"block",size:"l"}),"Blocked users…"]})," "]}),t(Et,{}),t(st,{onClick:()=>{C.showAccounts=!0},children:[t(v,{icon:"group",size:"l"})," ",t("span",{children:"Accounts…"})]})]}):t(E,{children:[t(Et,{}),t(vt,{to:"/login",children:[t(v,{icon:"user",size:"l"})," ",t("span",{children:"Log in"})]})]})]}),t("section",{children:[t(Et,{}),t(vt,{to:"/search",children:[t(v,{icon:"search",size:"l"})," ",t("span",{children:"Search"})]}),t(vt,{to:`/${i}/trending`,children:[t(v,{icon:"chart",size:"l"})," ",t("span",{children:"Trending"})]}),t(vt,{to:`/${i}/p/l`,children:[t(v,{icon:"building",size:"l"})," ",t("span",{children:"Local"})]}),t(vt,{to:`/${i}/p`,children:[t(v,{icon:"earth",size:"l"})," ",t("span",{children:"Federated"})]}),c?t(E,{children:[t(Et,{className:"divider-grow"}),t(st,{onClick:()=>{C.showKeyboardShortcutsHelp=!0},children:[t(v,{icon:"keyboard",size:"l"})," ",t("span",{children:"Keyboard shortcuts"})]}),t(st,{onClick:()=>{C.showShortcutsSettings=!0},children:[t(v,{icon:"shortcut",size:"l"})," ",t("span",{children:"Shortcuts / Columns…"})]}),t(st,{onClick:()=>{C.showSettings=!0},children:[t(v,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]}):t(E,{children:[t(Et,{}),t(st,{onClick:()=>{C.showSettings=!0},children:[t(v,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]})]})]})]})}const ue=Bt(qs),ye={block:"nearest",inline:"center",behavior:"smooth"};function Xt({title:e,titleComponent:n,id:s,instance:i,emptyText:c,errorText:o,useItemID:d,boostsCarousel:r,fetchItems:l=()=>{},checkForUpdates:h=()=>{},checkForUpdatesInterval:p=15e3,headerStart:a,headerEnd:f,timelineStart:u,refresh:b,view:y,filterContext:S,showFollowedTags:m,showReplyParent:g}){const k=xt(C),[w,I]=R([]),[A,L]=R("default"),[H,B]=R(!1),[F,X]=R(!1),[N,_]=R(!0),x=P(),M=y!=="media",D=Ri(Y=>{X(!1),A!=="loading"&&(L("loading"),(async()=>{try{let{done:tt,value:K}=await l(Y);if(Array.isArray(K)){const[bt,dt]=K.reduce((Z,O)=>(O._pinned?Z[0].push(O):Z[1].push(O),Z),[[],[]]);K=dt,M&&(r&&(K=Ms(K)),K=Ps(K,i)),bt.length&&(K=bt.concat(K)),I(Y?K:Z=>[...Z,...K]),K.length||(tt=!0),B(!tt)}else B(!1);L("default")}catch{L("error")}finally{D.cancel()}})())},1500,{leading:!0,trailing:!1}),it=".timeline-item, .timeline-item-alt",wt=Tt("j, shift+j",(Y,tt)=>{const K=document.activeElement.closest(it),bt=K==null?void 0:K.getBoundingClientRect(),dt=Array.from(x.current.querySelectorAll(it));if(K&&bt.top<x.current.clientHeight&&bt.bottom>0){const Z=dt.indexOf(K);let O=dt[Z+1];tt.shift&&(O=dt.find(($,W)=>W>Z&&!$.classList.contains("timeline-item-alt"))),O&&(O.focus(),O.scrollIntoView(ye))}else{const Z=dt.find(O=>{const $=O.getBoundingClientRect();return $.top>=44&&$.left>=0});Z&&(Z.focus(),Z.scrollIntoView(ye))}}),ht=Tt("k, shift+k",(Y,tt)=>{const K=document.activeElement.closest(it),bt=K==null?void 0:K.getBoundingClientRect(),dt=Array.from(x.current.querySelectorAll(it));if(K&&bt.top<x.current.clientHeight&&bt.bottom>0){const Z=dt.indexOf(K);let O=dt[Z-1];tt.shift&&(O=dt.findLast(($,W)=>W<Z&&!$.classList.contains("timeline-item-alt"))),O&&(O.focus(),O.scrollIntoView(ye))}else{const Z=dt.find(O=>{const $=O.getBoundingClientRect();return $.top>=44&&$.left>=0});Z&&(Z.focus(),Z.scrollIntoView(ye))}}),q=Tt(["enter","o"],()=>{const Y=document.activeElement.closest(it);Y&&Y.click()}),rt=w.length>0&&A!=="loading"&&F,et=qt(()=>{var Y;rt&&D(!0),(Y=x.current)==null||Y.scrollTo({top:0,behavior:"smooth"})},[D,rt]),ft=Tt(".",et),pt=P(),[At,kt]=R(!1);Os({scrollableRef:x,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:Y,nearReachStart:tt,reachStart:K})=>{if(pt.current){const bt=Y==="end"&&!tt;pt.current.hidden=bt}kt(tt),K&&D(!0)},[]),G(()=>{var Y;(Y=x.current)==null||Y.scrollTo({top:0}),D(!0)},[]),G(()=>{D(!0)},[b]);const $t=P(y);G(()=>{$t.current!==y&&($t.current=y,I([]))},[y]);const Rt=qt(async({disableIdleCheck:Y=!1}={})=>{const tt=x.current?getComputedStyle(x.current).pointerEvents==="none":!1;k.settings.autoRefresh&&x.current.scrollTop<16&&(Y||window.__IDLE__)&&!Gs()&&!tt?D(!0):await h()&&X(!0)},[s,D,h,k.settings.autoRefresh]),yt=P();return le(Y=>{if(Y){const tt=Date.now()-yt.current;(!yt.current||tt>1e3*3)&&Rt({disableIdleCheck:!0})}else yt.current=Date.now();_(Y)},[h,Rt,k.settings.autoRefresh]),We(Rt,N&&!F?p*(At?1:2):null),t(Vn.Provider,{value:S,children:t("div",{id:`${s}-page`,class:"deck-container",ref:Y=>{x.current=Y,wt.current=Y,ht.current=Y,q.current=Y,ft.current=Y},tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{ref:pt,onClick:Y=>{var tt;Y.target.closest("a, button")||(tt=x.current)==null||tt.scrollTo({top:0,behavior:"smooth"})},onDblClick:Y=>{Y.target.closest("a, button")||D(!0)},class:A==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(ue,{}),a??t(Q,{to:"/",class:"button plain home-button",children:t(v,{icon:"home",size:"l"})})]}),e&&(n||t("h1",{children:e})),t("div",{class:"header-side",children:!!f&&f})]}),rt&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:et,children:[t(v,{icon:"arrow-up"})," New posts"]})]}),!!u&&t("div",{class:`timeline-start ${A==="loading"?"loading":""}`,children:u}),w.length?t(E,{children:[t("ul",{class:`timeline ${y?`timeline-${y}`:""}`,children:[w.map(Y=>t(Hs,{status:Y,instance:i,useItemID:d,filterContext:S,view:y,showFollowedTags:m,showReplyParent:g},Y.id+(Y==null?void 0:Y._pinned)+y)),H&&A==="loading"&&(y==="media"?null:t(E,{children:[t("li",{style:{height:"20vh"},children:t(Lt,{skeleton:!0})}),t("li",{style:{height:"25vh"},children:t(Lt,{skeleton:!0})})]}))]}),A==="default"&&(H?t(Qt,{root:x.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:Y=>{Y&&D()},children:t("button",{type:"button",class:"plain block",onClick:()=>D(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}))]}):A==="loading"?t("ul",{class:"timeline",children:Array.from({length:5}).map((Y,tt)=>y==="media"?t("div",{style:{height:"50vh"}}):t("li",{children:t(Lt,{skeleton:!0})},tt))}):A!=="error"&&t("p",{class:"ui-state",children:c}),A==="error"&&t("p",{class:"ui-state",children:[o,t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>D(!w.length),children:"Try again"})]})]})})})}const Hs=Bt(({status:e,instance:n,useItemID:s,filterContext:i,view:c,showFollowedTags:o,showReplyParent:d})=>{const{id:r,reblog:l,items:h,type:p,_pinned:a}=e;a&&(s=!1);const f=(l==null?void 0:l.id)||r,u=n?`/${n}/s/${f}`:`/s/${f}`;if(h){const y=de(h,i);let S="";if(p==="boosts"?S=`${y.length} Boosts`:p==="pinned"&&(S="Pinned posts"),p==="boosts"||p==="pinned")return y.sort((k,w)=>{const I=ze(k.filtered,i),A=ze(w.filtered,i);return I&&!A?1:!I&&A?-1:0}),t("li",{class:"timeline-item-carousel",children:t(Vs,{title:S,class:`${p}-carousel`,children:y.map(k=>{const{id:w,reblog:I,_pinned:A}=k,L=(I==null?void 0:I.id)||w,H=n?`/${n}/s/${L}`:`/s/${L}`;return A&&(s=!1),t("li",{children:t(Q,{class:"status-carousel-link timeline-item-alt",to:H,children:s?t(Lt,{statusID:w,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):t(Lt,{status:k,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},w)})})},`timeline-${r}`);const g=y.length>3;return y.map((k,w)=>{const{id:I,_differentAuthor:A}=k,L=n?`/${n}/s/${I}`:`/s/${I}`,H=w>0&&w<y.length-1,B=k.sensitive&&!!k.spoilerText,F=!A&&B&&w>0||g&&H&&(p==="thread"||p==="conversation"&&!A&&!y[w-1]._differentAuthor&&!y[w+1]._differentAuthor),X=w===0,N=w===y.length-1;return t("li",{class:`timeline-item-container timeline-item-container-type-${p} timeline-item-container-${X?"start":N?"end":"middle"} ${A?"timeline-item-diff-author":""}`,children:t(Q,{class:"status-link timeline-item",to:L,children:F?t(js,{status:k,instance:n}):s?t(Lt,{statusID:I,instance:n,enableCommentHint:N,showFollowedTags:o}):t(Lt,{status:k,instance:n,enableCommentHint:N,showFollowedTags:o})})},`timeline-${I}`)})}const b=`timeline-${r+a}`;return c==="media"?s?t(bn,{class:"timeline-item",parent:"li",statusID:r,instance:n},b):t(bn,{class:"timeline-item",parent:"li",status:e,instance:n},b):t("li",{children:t(Q,{class:"status-link timeline-item",to:u,children:s?t(Lt,{statusID:r,instance:n,enableCommentHint:!0,showFollowedTags:o,showReplyParent:d}):t(Lt,{status:e,instance:n,enableCommentHint:!0,showFollowedTags:o,showReplyParent:d})})},b)},(e,n)=>{var c,o;const s=(((c=e.status)==null?void 0:c.id)||"").toString(),i=(((o=n.status)==null?void 0:o.id)||"").toString();return s===i&&e.instance===n.instance&&e.view===n.view});function Vs({title:e,class:n,children:s}){const i=P(),c=P(),o=P(),[d,r]=R(!1);return G(()=>{setTimeout(()=>{r(!0)},1)},[]),t("div",{class:`status-carousel ${n}`,children:[t("header",{children:[t("h3",{children:e}),t("span",{children:[t("button",{ref:c,type:"button",class:"small plain2",onClick:()=>{var l,h;(h=i.current)==null||h.scrollBy({left:-Math.min(320,(l=i.current)==null?void 0:l.offsetWidth),behavior:"smooth"})},children:t(v,{icon:"chevron-left"})})," ",t("button",{ref:o,type:"button",class:"small plain2",onClick:()=>{var l,h;(h=i.current)==null||h.scrollBy({left:Math.min(320,(l=i.current)==null?void 0:l.offsetWidth),behavior:"smooth"})},children:t(v,{icon:"chevron-right"})})]})]}),t("ul",{ref:i,children:[t(Qt,{class:"status-carousel-beacon",onChange:l=>{c.current&&(c.current.disabled=l)}}),s[0],d&&s.slice(1),t(Qt,{class:"status-carousel-beacon",onChange:l=>{o.current&&(o.current.disabled=l)}})]})]})}function js({status:e,instance:n}){const s=xt(C),{id:i,visibility:c,language:o}=e,d=Gn(e),r=Gt(i,n);return t("article",{class:`status compact-thread ${c==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[s.statusThreadNumber[r]?t("div",{class:"status-thread-badge",children:[t(v,{icon:"thread",size:"s"}),s.statusThreadNumber[r]?` ${s.statusThreadNumber[r]}/X`:""]}):t("div",{class:"status-thread-badge",children:t(v,{icon:"thread",size:"s"})}),t("div",{class:"content-compact",title:d,lang:o,dir:"auto",children:[d,e.sensitive&&e.spoilerText&&t(E,{children:[" ",t("span",{class:"spoiler-badge",children:t(v,{icon:"eye-close",size:"s"})})]})]})]})}function Gs(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const ce=20,Ze=1983,yn=`${Ze}-01`,Ys=(()=>{try{const e=document.createElement("input");return e.setAttribute("type","month"),e.type==="month"}catch{return!1}})();async function Ws(e){var i;const{masto:n}=V({instance:e}),s=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((i=s==null?void 0:s.statuses)!=null&&i.length)}const Ks=ee(Ws);function Zs(){const e=xt(C),{id:n,...s}=ie(),[i,c]=Wt(),o=i.get("month"),d=!i.get("replies"),r=!!i.get("boosts"),l=i.get("tagged"),h=!!i.get("media"),{masto:p,instance:a,authenticated:f}=V({instance:s.instance}),{masto:u,instance:b}=V(),y=P(),S=[o,d,r,l,h],[m,g]=R(),k=P(0);G(()=>{k.current=0},S);const w=gt(()=>a===b,[a,b]),[I,A]=R(!1);G(()=>{w&&m!=null&&m.acct&&(async()=>{const q=await Ks(a);A(q)})()},[a,w,m==null?void 0:m.acct]);async function L(q){var kt,$t,Rt;const rt=/^\d{4}-[01]\d$/.test(o),et=(($t=(kt=o==null?void 0:o.split)==null?void 0:kt.call(o,"-"))==null?void 0:$t[0])>=Ze;if(rt&&et){if(!m)return{value:[],done:!0};const[yt,Y]=o.split("-"),tt=parseInt(Y,10)-1,K=new Date(yt,tt,0),bt=`${K.getFullYear()}-${(K.getMonth()+1).toString().padStart(2,"0")}-${K.getDate().toString().padStart(2,"0")}`,dt=new Date(yt,tt+1,1),Z=`${dt.getFullYear()}-${(dt.getMonth()+1).toString().padStart(2,"0")}-${dt.getDate().toString().padStart(2,"0")}`;let O;q?(O=ce+1,k.current=0):(O=ce+k.current+1,k.current+=ce);const $=await p.v2.search.fetch({q:`from:${m.acct} after:${bt} before:${Z}`,type:"statuses",limit:O,offset:k.current});if((Rt=$==null?void 0:$.statuses)!=null&&Rt.length){const W=$.statuses.slice(0,ce);W.forEach(T=>{_t(T,a)});const J=$.statuses.length<=ce;return{value:W,done:J}}else return{value:[],done:!0}}const ft=[];if(q){const{value:yt}=await p.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(yt!=null&&yt.length&&!l&&!h){const Y=yt.map(tt=>(_t(tt,a),{...tt,_pinned:!0}));if(Y.length>=3){const tt=Y.map(K=>K.id);ft.push({id:tt,items:Y,type:"pinned"})}else ft.push(...Y)}}(q||!y.current)&&(y.current=p.v1.accounts.$select(n).statuses.list({limit:ce,exclude_replies:d,exclude_reblogs:r,only_media:h,tagged:l}));const{value:pt,done:At}=await y.current.next();return pt!=null&&pt.length&&(ft.push(...pt),pt.forEach(yt=>{_t(yt,a)})),{value:ft,done:At}}const[H,B]=R([]);Mt(m!=null&&m.acct?`${m!=null&&m.displayName?`${m.displayName} (${/@/.test(m.acct)?"":"@"}${m.acct})`:`${/@/.test(m.acct)?"":"@"}${m.acct}`}${d?r?" (- Boosts)":l?` (#${l})`:h?" (Media)":o?` (${new Date(o).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const F=P(),X=qt(()=>{const q=F.current||p.v1.accounts.$select(n).fetch();return F.current=q,q},[n,p]);G(()=>{(async()=>{try{const q=await X();g(q)}catch{}try{const q=await p.v1.accounts.$select(n).featuredTags.list();B(q)}catch{}})()},[n]);const{displayName:N,acct:_,emojis:x}=m||{},M=P(),D=gt(()=>{const q=!d||r||l||h||!!o,rt=e.accounts[`${n}@${a}`];return t(E,{children:[t(Ts,{instance:a,account:rt||n,fetchAccount:X,authenticated:f,standalone:!0}),t("div",{class:"filter-bar",ref:M,style:{position:"relative"},children:[q?t(Q,{to:`/${a}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:t(v,{icon:"x",size:"l"})},"clear-filters"):t(v,{icon:"filter",class:"insignificant",size:"l"}),t(Q,{to:`/${a}/a/${n}${d?"?replies=1":""}`,onClick:()=>{d&&ot("Showing post with replies")},class:d?"":"is-active",children:"+ Replies"}),t(Q,{to:`/${a}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||ot("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),t(Q,{to:`/${a}/a/${n}${h?"":"?media=1"}`,onClick:()=>{h||ot("Showing posts with media")},class:h?"is-active":"",children:"Media"}),H.map(et=>t(Q,{to:`/${a}/a/${n}${l===et.name?"":`?tagged=${encodeURIComponent(et.name)}`}`,onClick:()=>{l!==et.name&&ot(`Showing posts tagged with #${et.name}`)},class:l===et.name?"is-active":"",children:t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),et.name]})},et.id)),I&&(Ys?t("label",{class:`filter-field ${o?"is-active":""}`,children:[t(v,{icon:"month",size:"l"}),t("input",{type:"month",disabled:!(m!=null&&m.acct),value:o||"",min:yn,max:new Date().toISOString().slice(0,7),onInput:et=>{const{value:ft,validity:pt}=et.currentTarget;if(!pt.valid)return;c(ft?{month:ft}:{});const[At,kt]=ft.split("-"),$t=parseInt(kt,10)-1,Rt=new Date(At,$t);ot(`Showing posts in ${Rt.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):t(Js,{class:`filter-field ${o?"is-active":""}`,disabled:!(m!=null&&m.acct),value:o||"",min:yn,max:new Date().toISOString().slice(0,7),onInput:et=>{const{value:ft,validity:pt}=et;pt.valid&&c(ft?{month:ft}:{})}}))]})]})},[n,a,f,H,X,I,...S]);G(()=>{var rt;const q=(rt=M.current)==null?void 0:rt.querySelector(".is-active");q&&M.current.scrollTo({behavior:"smooth",left:q.offsetLeft-(M.current.offsetWidth-q.offsetWidth)/2})},[H,I,...S]);const it=gt(()=>m!=null&&m.url?new URL(m.url).hostname:null,[m]),ht=!!m&&!(a===it);return t(Xt,{title:`${m!=null&&m.acct?"@"+m.acct:"Posts"}`,titleComponent:t("h1",{class:"header-double-lines header-account",children:[t("b",{children:t(Hn,{text:N,emojis:x})}),t("div",{children:t("span",{children:["@",_]})})]}),id:"account-statuses",instance:a,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:L,useItemID:!0,view:h?"media":void 0,boostsCarousel:e.settings.boostsCarousel,timelineStart:D,refresh:[d,r,l,h,o+(m==null?void 0:m.acct)].toString(),headerEnd:t(Yt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(v,{icon:"more",size:"l"})}),children:[t(st,{disabled:!ht,onClick:()=>{(async()=>{try{const{masto:q}=V({instance:it}),rt=await q.v1.accounts.lookup({acct:m.acct}),{id:et}=rt;location.hash=`/${it}/a/${et}`}catch{alert("Unable to fetch account info")}})()},children:[t(v,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to account's instance (",t("b",{children:it}),")"]})]}),!w&&t(st,{onClick:()=>{(async()=>{try{const q=await u.v1.accounts.lookup({acct:m.acct+"@"+a}),{id:rt}=q;location.hash=`/${b}/a/${rt}`}catch{alert("Unable to fetch account info")}})()},children:[t(v,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to my instance (",t("b",{children:b}),")"]})]})]})},n)}function Js(e){const{class:n,disabled:s,value:i,min:c,max:o,onInput:d=()=>{}}=e,[r,l]=(i==null?void 0:i.split("-"))||[],h=P(),p=P(),a=(f,u)=>{const[b,y]=(c==null?void 0:c.split("-"))||[],[S,m]=(o==null?void 0:o.split("-"))||[];return!(u<b||u>S||u===b&&f<y||u===S&&f>m)};return t("div",{class:n,children:[t(v,{icon:"month",size:"l"}),t("select",{ref:h,disabled:s,value:l||"",onInput:f=>{const{value:u}=f.currentTarget,b=p.current.value;if(!a(u,b))return{value:"",validity:{valid:!1}};d({value:u?`${b}-${u}`:"",validity:{valid:!0}})},children:[t("option",{value:"",children:"Month"}),t("option",{disabled:!0,children:"-----"}),Array.from({length:12},(f,u)=>t("option",{value:(u+1).toString().padStart(2,"0"),children:new Date(0,u).toLocaleString("default",{month:"long"})},u))]})," ",t("input",{ref:p,type:"number",disabled:s,value:r||new Date().getFullYear(),min:(c==null?void 0:c.slice(0,4))||Ze,max:(o==null?void 0:o.slice(0,4))||new Date().getFullYear(),onInput:f=>{const{value:u,validity:b}=f.currentTarget,y=h.current.value;if(!b.valid||!a(y,u))return{value:"",validity:{valid:!1}};d({value:u?`${u}-${y}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const Xs=20;function Qn(){Mt("Bookmarks","/b");const{masto:e,instance:n}=V(),s=P();async function i(c){return(c||!s.current)&&(s.current=e.v1.bookmarks.list({limit:Xs})),await s.current.next()}return t(Xt,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:i})}const Qs=20;function ti(){Mt("Likes","/f");const{masto:e,instance:n}=V(),s=P();async function i(c){return(c||!s.current)&&(s.current=e.v1.favourites.list({limit:Qs})),await s.current.next()}return t(Xt,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:i})}const to=["home","public","notifications","thread","account"],wn=["notifications","thread","account"],eo={home:"Home and lists",notifications:"Notifications",public:"Public timelines",thread:"Conversations",account:"Profiles"},no=[0,30*60,60*60,6*60*60,12*60*60,60*60*24,60*60*24*7,60*60*24*30],io={0:"Never",1800:"30 minutes",3600:"1 hour",21600:"6 hours",43200:"12 hours",86400:"24 hours",604800:"7 days",2592e3:"30 days"};function so(){const{masto:e}=V();Mt("Filters","/ft");const[n,s]=R("default"),[i,c]=R(!1),[o,d]=Ee(h=>h+1,0),[r,l]=R([]);return G(()=>{s("loading"),(async()=>{try{const h=await e.v2.filters.list();h.sort((p,a)=>p.title.localeCompare(a.title)),h.forEach(p=>{var a;(a=p.keywords)!=null&&a.length&&p.keywords.sort((f,u)=>f.id-u.id)}),l(h),s("default")}catch{s("error")}})()},[o]),t("div",{id:"filters-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(ue,{}),t(Q,{to:"/",class:"button plain",children:t(v,{icon:"home",size:"l"})})]}),t("h1",{children:"Filters"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>{c(!0)},children:t(v,{icon:"plus",size:"l",alt:"New filter"})})})]})}),t("main",{children:r.length>0?t(E,{children:[t("ul",{class:"filters-list",children:r.map(h=>{const{id:p,title:a,expiresAt:f,keywords:u}=h;return t("li",{children:[t("div",{children:[t("h2",{children:a}),(u==null?void 0:u.length)>0&&t("div",{children:u.map(b=>t(E,{children:[t("span",{class:"tag collapsed insignificant",children:b.wholeWord?`“${b.keyword}”`:b.keyword})," "]}))}),t("small",{class:"insignificant",children:t(ei,{expiresAt:f})})]}),t("button",{type:"button",class:"plain",onClick:()=>{c({filter:h})},children:t(v,{icon:"pencil",size:"l",alt:"Edit filter"})})]},p)})}),r.length>1&&t("footer",{class:"ui-state",children:t("small",{class:"insignificant",children:[r.length," filter",r.length===1?"":"s"]})})]}):n==="loading"?t("p",{class:"ui-state",children:t(St,{})}):n==="error"?t("p",{class:"ui-state",children:"Unable to load filters."}):t("p",{class:"ui-state",children:"No filters yet."})})]}),!!i&&t(Dt,{title:"Add filter",onClose:()=>{c(!1)},children:t(oo,{filter:i==null?void 0:i.filter,onClose:h=>{h.state==="success"&&d(),c(!1)}})})]})}function oo({filter:e,onClose:n}){const{masto:s}=V(),[i,c]=R("default"),o=!!e,{context:d,expiresAt:r,id:l,keywords:h,title:p,filterAction:a}=e||{},u=!!r&&new Date(r),[b,y]=R(h||[]),S=P(),[m,g]=R([]),[k,w]=R([]);return t("div",{class:"sheet",id:"filters-add-edit-modal",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(v,{icon:"x"})}),t("header",{children:t("h2",{children:o?"Edit filter":"New filter"})}),t("main",{children:t("form",{onSubmit:I=>{I.preventDefault();const A=new FormData(I.target),L=A.get("title"),H=A.getAll("keyword_attributes[][id]"),B=A.getAll("keyword_attributes[][keyword]"),F=[...S.current.querySelectorAll('input[name="keyword_attributes[][whole_word]"]')].map(M=>M.checked),X=B.map((M,D)=>({id:H[D]||void 0,keyword:M,wholeWord:F[D]}));o&&(m!=null&&m.length)&&m.forEach(M=>{X.push({id:M,_destroy:!0})});const N=A.getAll("context");let _=A.get("expires_in");const x=A.get("filter_action");!L||!(N!=null&&N.length)||(c("loading"),(async()=>{try{let M;o?(_===""||_===null?_=Math.floor((u-new Date)/1e3):_==="0"||_===0?_=null:_=+_,M=await s.v2.filters.$select(l).update({title:L,context:N,expiresIn:_,keywordsAttributes:X,filterAction:x})):(_=+_||null,M=await s.v2.filters.create({title:L,context:N,expiresIn:_,keywordsAttributes:X,filterAction:x})),c("default"),n==null||n({state:"success",filter:M})}catch{c("error"),alert(o?"Unable to edit filter":"Unable to create filter")}})())},children:[t("div",{class:"filter-form-row",children:t("label",{children:[t("b",{children:"Title"}),t("input",{type:"text",name:"title",defaultValue:p,disabled:i==="loading",dir:"auto",required:!0})]})}),t("div",{class:"filter-form-keywords",ref:S,children:[b.length?t("ul",{class:"filter-keywords",children:b.map((I,A)=>{const{id:L,keyword:H,wholeWord:B}=I;return m.includes(L)||k.includes(A)?null:t("li",{children:[t("input",{type:"hidden",name:"keyword_attributes[][id]",value:L}),t("input",{name:"keyword_attributes[][keyword]",type:"text",defaultValue:H,disabled:i==="loading",required:!0}),t("div",{class:"filter-keyword-actions",children:[t("label",{children:[t("input",{name:"keyword_attributes[][whole_word]",type:"checkbox",value:L,defaultChecked:B,disabled:i==="loading"})," ","Whole word"]}),t("button",{type:"button",class:"light danger small",disabled:i==="loading",onClick:()=>{L?(m.push(L),g([...m])):(k.push(A),w([...k]))},children:t(v,{icon:"x"})})]})]},`${A}-${L}`)})}):t("div",{class:"filter-keywords",children:t("div",{class:"insignificant",children:"No keywords. Add one."})}),t("footer",{class:"filter-keywords-footer",children:[t("button",{type:"button",class:"light",onClick:()=>{y([...b,{keyword:"",wholeWord:!0}]),setTimeout(()=>{var A,L;const I=S.current.querySelectorAll('input[type="text"]');(L=(A=I[I.length-1])==null?void 0:A.focus)==null||L.call(A)},10)},children:"Add keyword"})," ",(b==null?void 0:b.length)>1&&t("small",{class:"insignificant",children:[b.length," keyword",b.length===1?"":"s"]})]})]}),t("div",{class:"filter-form-cols",children:[t("div",{class:"filter-form-col",children:[t("div",{children:t("b",{children:"Filter from…"})}),to.map(I=>t("div",{children:[t("label",{class:wn.includes(I)?"insignificant":"",children:[t("input",{type:"checkbox",name:"context",value:I,defaultChecked:d?d.includes(I):!0,disabled:i==="loading"})," ",eo[I],wn.includes(I)?"*":""]})," "]})),t("p",{children:t("small",{class:"insignificant",children:"* Not implemented yet"})})]}),t("div",{class:"filter-form-col",children:[o&&t(E,{children:["Status:"," ",t("b",{children:t(ei,{expiresAt:r,showNeverExpires:!0})})]}),t("div",{children:[t("label",{for:"filters-expires_in",children:o?"Change expiry":"Expiry"}),t("select",{id:"filters-expires_in",name:"expires_in",disabled:i==="loading",defaultValue:o?void 0:0,children:[o&&t("option",{}),no.map(I=>t("option",{value:I,children:io[I]}))]})]}),t("p",{children:["Filtered post will be…",t("br",{}),t("label",{class:"ib",children:[t("input",{type:"radio",name:"filter_action",value:"warn",defaultChecked:a==="warn"||!o,disabled:i==="loading"})," ","minimized"]})," ",t("label",{class:"ib",children:[t("input",{type:"radio",name:"filter_action",value:"hide",defaultChecked:a==="hide",disabled:i==="loading"})," ","hidden"]})]})]})]}),t("footer",{class:"filter-form-footer",children:[t("span",{children:[t("button",{type:"submit",disabled:i==="loading",children:o?"Save":"Create"})," ",t(St,{abrupt:!0,hidden:i!=="loading"})]}),o&&t(te,{disabled:i==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this filter?",onClick:()=>{c("loading"),(async()=>{try{await s.v2.filters.$select(l).remove(),c("default"),n==null||n({state:"success"})}catch{c("error"),alert("Unable to delete filter.")}})()},children:t("button",{type:"button",class:"light danger",onClick:()=>{},disabled:i==="loading",children:"Delete…"})})]})]})})]})}function ei({expiresAt:e,showNeverExpires:n}){const s=!!e,i=s&&new Date(e),c=s&&i<=new Date,[o,d]=Ee(r=>r+1,0);return We(d,c||3e4),c?"Expired":s?t(E,{children:["Expiring ",t(_e,{datetime:i})]}):n&&"Never expires"}function co(){const{masto:e,instance:n}=V();Mt("Followed Hashtags","/fh");const[s,i]=R("default"),[c,o]=R([]);return G(()=>{i("loading"),(async()=>{try{const d=await Ae();o(d),i("default")}catch{i("error")}})()},[]),t("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(ue,{}),t(Q,{to:"/",class:"button plain",children:t(v,{icon:"home",size:"l"})})]}),t("h1",{children:"Followed Hashtags"}),t("div",{class:"header-side"})]})}),t("main",{children:c.length>0?t(E,{children:[t("ul",{class:"link-list",children:c.map(d=>t("li",{children:t(Q,{to:n?`/${n}/t/${d.name}`:`/t/${d.name}`,children:[t(v,{icon:"hashtag"})," ",t("span",{children:d.name})]})}))}),c.length>1&&t("footer",{class:"ui-state",children:t("small",{class:"insignificant",children:[c.length," hashtag",c.length===1?"":"s"]})})]}):s==="loading"?t("p",{class:"ui-state",children:t(St,{abrupt:!0})}):s==="error"?t("p",{class:"ui-state",children:"Unable to load followed hashtags."}):t("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const ao=20;function Je({title:e,path:n,id:s,...i}){Mt(e||"Following",n||"/following");const{masto:c,streaming:o,instance:d}=V(),r=xt(C),l=P(),h=P();async function p(f){(f||!l.current)&&(l.current=c.v1.timelines.home.list({limit:ao}));const u=await l.current.next();let{value:b}=u;if(b!=null&&b.length){let y=!1;f&&(b[0].id!==h.current&&(y=!0),h.current=b[0].id),b.forEach(S=>{_t(S,d)}),b=gn(b,d),f&&y&&Fs(),Us(b,d),b.sort((S,m)=>{const g=new Date(S.createdAt);return new Date(m.createdAt)-g})}return{...u,value:b}}async function a(){try{const f=await c.v1.timelines.home.list({limit:5,since_id:h.current}).next();let{value:u}=f;return!!(u!=null&&u.length&&(h.current=u[0].id,u=gn(u,d),u=de(u,"home"),u.some(b=>!b.reblog)))}catch{return!1}}return G(()=>{let f;return(async()=>{if(o){f=o.user.subscribe();for await(const u of f){if(!f)break;if(u.event==="status.update"){const b=u.payload;_t(b,d)}else if(u.event==="delete"){const b=u.payload,y=_n(b,d);y&&(y._deleted=!0)}}}})(),()=>{var u;(u=f==null?void 0:f.unsubscribe)==null||u.call(f),f=null}},[o]),t(Xt,{title:e||"Following",id:s||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:d,fetchItems:p,checkForUpdates:a,useItemID:!0,boostsCarousel:r.settings.boostsCarousel,...i,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const ro=20,lo=4,vn=lo+1;function ni({media:e,columnMode:n,...s}){let{hashtag:i,...c}=n?{}:ie();s.hashtag&&(i=s.hashtag);let o=i.trim().split(/[\s+]+/);o.sort(),i=o[0];const[d,r]=Wt(),l=e||!!d.get("media"),h=l?"?media=1":"",{masto:p,instance:a,authenticated:f}=V({instance:(s==null?void 0:s.instance)||c.instance}),{masto:u,instance:b,authenticated:y}=V(),S=o.map(N=>`#${N}`).join(" "),m=l?" (Media only)":"",g=a?`${S}${m} on ${a}`:`${S}${m}`;Mt(g,"/:instance?/t/:hashtag");const k=P(),w=P(void 0);async function I(N){const _=await p.v1.timelines.tag.$select(i).list({limit:ro,any:o.slice(1),maxId:N?void 0:w.current,onlyMedia:l}).next();let{value:x}=_;return x!=null&&x.length&&(N&&(k.current=x[0].id),x.forEach(M=>{_t(M,a,{skipThreading:l})}),w.current=x[x.length-1].id),{..._,value:x}}async function A(){try{const N=await p.v1.timelines.tag.$select(i).list({limit:1,any:o.slice(1),since_id:k.current,onlyMedia:l}).next();let{value:_}=N;return _=de(_,"public"),!!(_!=null&&_.length)}catch{return!1}}const[L,H]=R("default"),[B,F]=R();G(()=>{(async()=>{try{const N=await p.v1.tags.$select(i).fetch();F(N)}catch{}})()},[i]);const X=o.length>=vn;return t(Xt,{title:g,titleComponent:!!a&&t("h1",{class:"header-double-lines",children:[t("b",{children:S}),t("div",{children:a})]}),id:"hashtag",instance:a,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:I,checkForUpdates:A,useItemID:!0,view:l?"media":void 0,refresh:l,filterContext:"public",headerEnd:t(Yt,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(v,{icon:"more",size:"l"})}),children:[!!B&&o.length===1&&t(E,{children:[t(te,{subMenu:!0,confirm:B.following,confirmLabel:`Unfollow #${i}?`,disabled:L==="loading"||!f,onClick:()=>{H("loading"),B.following?p.v1.tags.$select(i).unfollow().then(()=>{F({...B,following:!1}),ot(`Unfollowed #${i}`)}).catch(N=>{alert(N)}).finally(()=>{H("default")}):p.v1.tags.$select(i).follow().then(()=>{F({...B,following:!0}),ot(`Followed #${i}`)}).catch(N=>{alert(N)}).finally(()=>{H("default")})},children:B.following?t(E,{children:[t(v,{icon:"check-circle"})," ",t("span",{children:"Following…"})]}):t(E,{children:[t(v,{icon:"plus"})," ",t("span",{children:"Follow"})]})}),t(Et,{})]}),t(Dn,{className:"plain",children:"Filters"}),t(st,{type:"checkbox",checked:!!l,onClick:()=>{l?d.delete("media"):d.set("media","1"),r(d)},children:[t(v,{icon:"check-circle"})," ",t("span",{class:"menu-grow",children:"Media only"})]}),t(Et,{}),t(Ei,{className:"menu-field",disabled:X,children:({ref:N})=>t("form",{onSubmit:_=>{var M,D;_.preventDefault();const x=(D=(M=_.target[0].value)==null?void 0:M.trim)==null?void 0:D.call(M);x&&!o.some(it=>it.toLowerCase()===x.toLowerCase())&&(o.push(x),o.sort(),location.hash=a?`/${a}/t/${o.join("+")}`:`/t/${o.join("+")}${h}`)},children:[t(v,{icon:"hashtag"}),t("input",{ref:N,type:"text",placeholder:X?`Max ${vn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:X})]})}),t(Li,{takeOverflow:!0,children:o.map((N,_)=>t(st,{disabled:o.length===1,onClick:x=>{o.splice(_,1),o.sort(),location.hash=a?`/${a}/t/${o.join("+")}${h}`:`/t/${o.join("+")}${h}`},children:[t(v,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),N]})]},N))}),t(Et,{}),t(st,{disabled:!y,onClick:()=>{if(C.shortcuts.length>=Kt){alert(`Max ${Kt} shortcuts reached. Unable to add shortcut.`);return}const N={type:"hashtag",hashtag:o.join(" "),instance:a,media:l?"on":void 0};C.shortcuts.some(x=>x.type===N.type&&x.hashtag.split(/[\s+]+/).sort().join(" ")===N.hashtag.split(/[\s+]+/).sort().join(" ")&&(x.instance?x.instance===N.instance:!0)&&(x.media?!!x.media==!!N.media:!0))?alert("This shortcut already exists"):(C.shortcuts.push(N),ot("Hashtag shortcut added"))},children:[t(v,{icon:"shortcut"})," ",t("span",{children:"Add to Shorcuts"})]}),t(st,{onClick:()=>{let N=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(N)){N&&alert("Invalid instance");return}N&&(N=N.toLowerCase().trim(),location.hash=`/${N}/t/${o.join("+")}${h}`)},children:[t(v,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),b!==a&&t(st,{onClick:()=>{location.hash=`/${b}/t/${o.join("+")}${h}`},children:[t(v,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:b}),")"]})]})]})},a+S)}const uo=20;function ii(e){var m;const n=xt(C),{masto:s,instance:i}=V(),c=(e==null?void 0:e.id)||((m=ie())==null?void 0:m.id),o=P(),d=P();async function r(g){(g||!d.current)&&(d.current=s.v1.timelines.list.$select(c).list({limit:uo}));const k=await d.current.next();let{value:w}=k;return w!=null&&w.length&&(g&&(o.current=w[0].id),w.forEach(I=>{_t(I,i)})),{...k,value:w}}async function l(){try{const g=await s.v1.timelines.list.$select(c).list({limit:1,since_id:o.current});let{value:k}=g;return k=de(k,"home"),!!(k!=null&&k.length)}catch{return!1}}const[h,p]=R([]);G(()=>{ge().then(p)},[]);const[a,f]=R({title:"List"});Mt(a.title,"/l/:id"),G(()=>{(async()=>{try{const g=await Kn(c);f(g)}catch{}})()},[c]);const[u,b]=R(!1),[y,S]=R(!1);return t(E,{children:[t(Xt,{title:a.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:i,fetchItems:r,checkForUpdates:l,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:t(Yt,{overflow:"auto",menuButton:t("button",{type:"button",class:"plain",children:[t(v,{icon:"list",size:"l",alt:"Lists"}),t(v,{icon:"chevron-down",size:"s"})]}),children:[t(vt,{to:"/l",children:t("span",{children:"All Lists"})}),(h==null?void 0:h.length)>0&&t(E,{children:[t(Et,{}),h.map(g=>t(vt,{to:`/l/${g.id}`,children:t("span",{children:g.title})},g.id))]})]}),headerEnd:t(Yt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(v,{icon:"more",size:"l"})}),children:[t(st,{onClick:()=>b({list:a}),children:[t(v,{icon:"pencil",size:"l"}),t("span",{children:"Edit"})]}),t(st,{onClick:()=>S(!0),children:[t(v,{icon:"group",size:"l"}),t("span",{children:"Manage members"})]})]})},c),u&&t(Dt,{onClick:g=>{g.target===g.currentTarget&&b(!1)},children:t(Ke,{list:u==null?void 0:u.list,onClose:g=>{g.state==="success"&&g.list?f(g.list):g.state==="deleted"&&(location.hash="/l"),b(!1)}})}),y&&t(Dt,{onClick:g=>{g.target===g.currentTarget&&S(!1)},children:t(fo,{listID:c,onClose:()=>S(!1)})})]})}const ho=40;function fo({listID:e,onClose:n}){const{masto:s,instance:i}=V(),[c,o]=R([]),[d,r]=R("default"),[l,h]=R(!1),p=P();async function a(f){h(!1),r("loading"),(async()=>{try{(f||!p.current)&&(p.current=s.v1.lists.$select(e).accounts.list({limit:ho}));const u=await p.current.next();let{done:b,value:y}=u;y!=null&&y.length?(o(f?y:c.concat(y)),h(!b)):h(!1),r("default")}catch{r("error")}})()}return G(()=>{a(!0)},[]),t("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(v,{icon:"x"})}),t("header",{children:t("h2",{children:"Manage members"})}),t("main",{children:t("ul",{children:[c.map(f=>t("li",{children:[t(Zt,{account:f,instance:i}),t(po,{account:f,listID:e})]},f.id)),l&&d==="default"&&t(Qt,{as:"li",onChange:f=>f&&a(),children:t("button",{type:"button",class:"light block",onClick:a,children:"Show more…"})})]})})]})}function po({account:e,listID:n}){const{masto:s}=V(),[i,c]=R("default"),[o,d]=R(!1);return t(te,{confirm:!o,confirmLabel:t("span",{children:["Remove @",e.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{o?(c("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.create({accountIds:[e.id]}),c("default"),d(!1)}catch{c("error")}})()):(c("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.remove({accountIds:[e.id]}),c("default"),d(!0)}catch{c("error")}})())},children:t("button",{type:"button",class:`light ${o?"":"danger"}`,disabled:i==="loading",children:o?"Add":"Remove…"})})}const Sn=20,mo=new URLSearchParams;function si({columnMode:e,...n}){const{masto:s,instance:i}=V(),[c]=e?[mo]:Wt(),[o,d]=R(null),r=(n==null?void 0:n.type)||c.get("type")||o;Mt(`Mentions${r==="private"?" (Private)":""}`,"/mentions");const l=P(),h=P();async function p(m){(m||!l.current)&&(l.current=s.v1.notifications.list({limit:Sn,types:["mention"]}));const g=await l.current.next();let{value:k}=g;return k!=null&&k.length&&(m&&(h.current=k[0].id),k.forEach(({status:w})=>{_t(w,i)})),{...g,value:k==null?void 0:k.map(w=>w.status)}}const a=P(),f=P();async function u(m){(m||!a.current)&&(a.current=s.v1.conversations.list({limit:Sn}));const g=await a.current.next();let{value:k}=g;return k=k==null?void 0:k.filter(w=>w.lastStatus),k!=null&&k.length&&(m&&(f.current=k[0].lastStatus.id),k.forEach(({lastStatus:w})=>{_t(w,i)})),{...g,value:k==null?void 0:k.map(w=>w.lastStatus)}}function b(...m){return r==="private"?u(...m):p(...m)}async function y(){if(r==="private")try{const m=await s.v1.conversations.list({limit:1,since_id:f.current}).next();let{value:g}=m;return g!=null&&g.length?(f.current=g[0].lastStatus.id,!0):!1}catch{return!1}else try{const m=await s.v1.notifications.list({limit:1,types:["mention"],since_id:h.current}).next();let{value:g}=m;return g!=null&&g.length?(h.current=g[0].id,!0):!1}catch{return!1}}const S=gt(()=>t("div",{class:"filter-bar centered",children:[t(Q,{to:"/mentions",class:r?"":"is-active",onClick:m=>{e&&(m.preventDefault(),d(null))},children:"All"}),t(Q,{to:"/mentions?type=private",class:r==="private"?"is-active":"",onClick:m=>{e&&(m.preventDefault(),d("private"))},children:"Private"})]}),[r]);return t(Xt,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:i,fetchItems:b,checkForUpdates:y,useItemID:!0,timelineStart:S,refresh:r})}const go={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function bo(e){return e.filter(n=>{const{type:s,id:i,createdAt:c}=n;if(!s)return!1;const o=go[s];return o!=null&&o.length?o.every(d=>!!n[d]):!0})}function oi(e){e=bo(e);const n={},s=[];for(let o=0,d=0;o<e.length;o++){const r=e[o],{id:l,status:h,account:p,type:a,createdAt:f}=r,u=f?new Date(f).toLocaleDateString():"";let b=a;(a==="favourite"||a==="reblog")&&(b="favourite+reblog");const y=`${h==null?void 0:h.id}-${b}-${u}`,S=n[y];if(b==="follow_request")s[d++]=r;else if(S!=null&&S.account){const m=S._accounts.find(g=>g.id===p.id);m?(m._types.push(a),m._types.sort().reverse(),S.id+=`-${l}`):(p._types=[a],S._accounts.push(p),S.id+=`-${l}`)}else{p&&(p._types=[a]);let m=n[y]={...r,type:b,_accounts:p?[p]:[]};s[d++]=m}}const i={},c=[];for(let o=0,d=0;o<s.length;o++){const r=s[o],{id:l,account:h,_accounts:p,type:a,createdAt:f}=r,u=f?new Date(f).toLocaleDateString():"";if(a==="favourite+reblog"&&h&&p.length===1){const b=`${h==null?void 0:h.id}-${a}-${u}`,y=i[b];if(y)y._statuses.push(r.status),y.id+=`-${l}`;else{let S=i[b]={...r,type:a,_statuses:[r.status]};c[d++]=S}}else c[d++]=r}return c}function kn(e){const{masto:n}=V();return n.v1.push.subscription.create(e)}function yo(){const{masto:e}=V();return e.v1.push.subscription.fetch()}function wo(e){const{masto:n}=V();return n.v1.push.subscription.update(e)}function vo(){const{masto:e}=V();return e.v1.push.subscription.remove()}function Xe(){return"serviceWorker"in navigator&&"PushManager"in window}function So(){return navigator.serviceWorker.getRegistration()}async function Qe(){const e=await So(),n=e?await e.pushManager.getSubscription():void 0;return{registration:e,subscription:n}}function ci(e){const n="=".repeat((4-e.length%4)%4),s=`${e}${n}`.replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(s),c=new Uint8Array(i.length);for(let o=0;o<i.length;++o)c[o]=i.charCodeAt(o);return c}async function Nc(){if(!Xe())return;const{subscription:e}=await Qe();let n=null;try{n=await yo()}catch(s){if(!/(not found|unknown)/i.test(s.message))throw s}if(n&&e){const s=n.endpoint===e.endpoint,{vapidKey:i}=ae(),c=n.serverKey===i;if(!s)throw new Error("Backend subscription endpoint changed");if(!c)throw new Error("Backend subscription key and vapid key changed")}if(e&&!n){const{vapidKey:s}=ae(),{applicationServerKey:i}=e.options,c=ci(s).toString(),o=new Uint8Array(i).toString();if(!(c===o))throw await e.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:e,backendSubscription:n}}async function Mc({data:e,policy:n}){if(!Xe())return;let{registration:s,subscription:i}=await Qe(),c=null;if(i)try{c=await wo({data:e,policy:n})}catch{c=await kn({subscription:i,data:e,policy:n})}else{const{vapidKey:o}=ae();if(!o)throw new Error("No server key found");i=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:ci(o)}),c=await kn({subscription:i,data:e,policy:n})}return{subscription:i,backendSubscription:c}}async function Pc(){if(!Xe())return;const{subscription:e}=await Qe();e&&(await vo(),await e.unsubscribe())}const ko=30,Io=new URLSearchParams,we={block:"center",inline:"center",behavior:"smooth"};function To({columnMode:e}){var O;Mt("Notifications","/notifications");const{masto:n,instance:s}=V(),i=xt(C),[c,o]=R("default"),[d]=e?[Io]:Wt(),r=d.get("id"),l=d.get("access_token"),[h,p]=R(!1),[a,f]=R(!1),u=P(),{nearReachEnd:b,scrollDirection:y,reachStart:S,nearReachStart:m}=Bs({scrollableRef:u}),g=y==="end"&&!m,[k,w]=R([]),[I,A]=R([]),L=P();async function H($){($||!L.current)&&(L.current=n.v1.notifications.list({limit:ko,excludeTypes:["follow_request"]}));const W=await L.current.next(),J=W.value;if(J!=null&&J.length){J.forEach(z=>{_t(z.status,s,{skipThreading:!0})});const T=oi(J);$?(C.notificationsLast=J[0],C.notifications=T,n.v1.markers.create({notifications:{lastReadId:J[0].id}}).catch(()=>{})):C.notifications.push(...T)}return C.notificationsShowNew=!1,C.notificationsLastFetchTime=Date.now(),W}async function B(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const F=()=>{o("loading"),(async()=>{try{const $=await B();w($),o("default")}catch{o("error")}})()};async function X(){try{return await n.v1.announcements.list()}catch{return[]}}const N=zn("@mastodon/filtered-notifications"),[_,x]=R(!1),[M,D]=R({});function it(){return n.v1.notifications.policy.fetch().catch(()=>{})}function wt(){it().then($=>{D($)}).catch(()=>{})}const[ht,q]=R(null);function rt(){return n.v1.notifications.requests.list()}const et=$=>{pt(!1),o("loading"),(async()=>{try{const W=H($);$&&(X().then(T=>{T.sort((z,j)=>{const at=new Date(z.updatedAt||z.createdAt);return new Date(j.updatedAt||j.createdAt)-at}),A(T)}).catch(()=>{}),B().then(T=>{w(T)}).catch(()=>{}),N&&wt());const{done:J}=await W;p(!J),o("default")}catch{o("error")}})()};G(()=>{et(!0)},[]),G(()=>{S&&et(!0)},[S]);const[ft,pt]=R(!1),At=qt(({disableIdleCheck:$=!1}={})=>{var W;c!=="loading"&&i.settings.autoRefresh&&((W=u.current)==null?void 0:W.scrollTop)<16&&($||window.__IDLE__)&&!$o()&&et(!0)},[i.notificationsShowNew,i.settings.autoRefresh,c]),kt=P();le($=>{let W;if($){const J=Date.now()-kt.current;!kt.current||J>1e3*3?At({disableIdleCheck:!0}):kt.current=Date.now(),W=_i(C,"notificationsShowNew",T=>{c!=="loading"&&(T&&At(),pt(T))})}return()=>{W==null||W()}});const $t=new Date,Rt=new Date($t-24*60*60*1e3);let yt=new Date;const Y=!i.notifications.some($=>new Date($.createdAt).toDateString()===$t.toDateString()),tt=P();G(()=>{r&&(C.routeNotification={id:r,accessToken:atob(l)})},[r,l]);const K=".notification",bt=Tt("j",()=>{const $=document.activeElement.closest(K),W=$==null?void 0:$.getBoundingClientRect(),J=Array.from(u.current.querySelectorAll(K));if($&&W.top<u.current.clientHeight&&W.bottom>0){const T=J.indexOf($);let z=J[T+1];z&&(z.focus(),z.scrollIntoView(we))}else{const T=J.find(z=>{const j=z.getBoundingClientRect();return j.top>=44&&j.left>=0});T&&(T.focus(),T.scrollIntoView(we))}}),dt=Tt("k",()=>{const $=document.activeElement.closest(K),W=$==null?void 0:$.getBoundingClientRect(),J=Array.from(u.current.querySelectorAll(K));if($&&W.top<u.current.clientHeight&&W.bottom>0){const T=J.indexOf($);let z=J[T-1];z&&(z.focus(),z.scrollIntoView(we))}else{const T=J.find(z=>{const j=z.getBoundingClientRect();return j.top>=44&&j.left>=0});T&&(T.focus(),T.scrollIntoView(we))}}),Z=Tt(["enter","o"],()=>{const $=document.activeElement.closest(K),W=$==null?void 0:$.querySelector(".status-link");W&&W.click()});return t("div",{id:"notifications-page",class:"deck-container",ref:$=>{u.current=$,bt.current=$,dt.current=$,Z.current=$},tabIndex:"-1",children:[t("div",{class:`timeline-deck deck ${a?"only-mentions":""}`,children:[t("header",{hidden:g,onClick:$=>{var W;$.target.closest("a, button")||(W=u.current)==null||W.scrollTo({top:0,behavior:"smooth"})},onDblClick:$=>{$.target.closest("a, button")||et(!0)},class:c==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(ue,{}),t(Q,{to:"/",class:"button plain",children:t(v,{icon:"home",size:"l",alt:"Home"})})]}),t("h1",{children:"Notifications"}),t("div",{class:"header-side",children:N&&t("button",{type:"button",class:"button plain",onClick:()=>{x(!0)},children:t(v,{icon:"settings",size:"l",alt:"Notifications settings"})})})]}),ft&&c!=="loading"&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var $;et(!0),($=u.current)==null||$.scrollTo({top:0,behavior:"smooth"})},children:[t(v,{icon:"arrow-up"})," New notifications"]})]}),I.length>0&&t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("details",{class:"announcements",children:[t("summary",{children:[t("span",{children:[t(v,{icon:"announce",class:"announcement-icon",size:"l"})," ",t("b",{children:["Announcement",I.length>1?"s":""]})," ",t("small",{class:"insignificant",children:s})]}),I.length>1&&t("span",{class:"announcements-nav-buttons",children:I.map(($,W)=>t("button",{type:"button",class:"plain2 small",onClick:()=>{var J;(J=tt.current)==null||J.children[W].scrollIntoView({behavior:"smooth",block:"nearest"})},children:W+1}))})]}),t("ul",{class:`announcements-list-${I.length>1?"multiple":"single"}`,ref:tt,children:I.map($=>t("li",{children:t(Co,{announcement:$})}))})]})})}),k.length>0&&t("div",{class:"follow-requests",children:[t("h2",{class:"timeline-header",children:"Follow requests"}),k.length>5?t("details",{children:[t("summary",{children:[k.length," follow requests"]}),t("ul",{children:k.map($=>t("li",{children:[t(Zt,{account:$}),t(qe,{accountID:$.id,onChange:()=>{}})]},$.id))})]}):t("ul",{children:k.map($=>t("li",{children:[t(Zt,{account:$}),t(qe,{accountID:$.id,onChange:()=>{}})]},$.id))})]}),N&&((O=M==null?void 0:M.summary)==null?void 0:O.pendingRequestsCount)>0&&t("div",{class:"filtered-notifications",children:t("details",{onToggle:async $=>{const{open:W}=$.target;if(W){const J=await rt();q(J)}},children:[t("summary",{children:["Filtered notifications from"," ",M.summary.pendingRequestsCount," people"]}),ht?(ht==null?void 0:ht.length)>0&&t("ul",{children:ht.map($=>{var W,J;return t("li",{children:[t("div",{class:"request-notifcations",children:[!((W=$.lastStatus)!=null&&W.id)&&t(Zt,{useAvatarStatic:!0,showStats:!0,account:$.account}),((J=$.lastStatus)==null?void 0:J.id)&&t("div",{class:"last-post",children:t(Q,{class:"status-link",to:`/${s}/s/${$.lastStatus.id}`,children:t(Lt,{status:$.lastStatus,size:"s",readOnly:!0})})}),t(Ao,{request:$})]}),t(Ro,{request:$,onChange:()=>{et(!0)}})]},$.id)})}):t("p",{class:"ui-state",children:t(St,{abrupt:!0})})]})}),t("div",{id:"mentions-option",children:t("label",{children:[t("input",{type:"checkbox",checked:a,onChange:$=>{f($.target.checked)}})," ","Only mentions"]})}),t("h2",{class:"timeline-header",children:"Today"}),Y&&!!i.notifications.length&&t("p",{class:"ui-state insignificant",children:c==="default"?"You're all caught up.":t(E,{children:"…"})}),i.notifications.length?t(E,{children:i.notifications.filter($=>$.type!=="follow_request").map($=>{if(a&&$.type!=="mention")return null;const W=new Date($.createdAt),J=W.toDateString()!==yt.toDateString();J&&(yt=W);const T=W.toDateString()===Rt.toDateString()?"Yesterday":ne(yt,{hideTime:!0});return t(E,{children:[J&&t("h2",{class:"timeline-header",children:T}),t(Ne,{instance:s,notification:$},$.id)]},$.id)})}):t(E,{children:[c==="loading"&&t(E,{children:t("ul",{class:"timeline flat",children:Array.from({length:5}).map(($,W)=>t("li",{class:"notification skeleton",children:[t("div",{class:"notification-type",children:t(v,{icon:"notification",size:"xl"})}),t("div",{class:"notification-content",children:t("p",{children:"███████████ ████"})})]}))})}),c==="error"&&t("p",{class:"ui-state",children:["Unable to load notifications",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>et(!0),children:"Try again"})]})]}),h&&t(Qt,{onChange:$=>{$&&et()},children:t("button",{type:"button",class:"plain block",disabled:c==="loading",onClick:()=>et(),style:{marginBlockEnd:"6em"},children:c==="loading"?t(St,{abrupt:!0}):t(E,{children:"Show more…"})})})]}),N&&_&&t(Dt,{onClick:$=>{$.target===$.currentTarget&&x(!1)},children:t("div",{class:"sheet",id:"notifications-settings",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:()=>x(!1),children:t(v,{icon:"x"})}),t("header",{children:t("h2",{children:"Notifications settings"})}),t("main",{children:t("form",{onSubmit:$=>{$.preventDefault();const{filterNotFollowing:W,filterNotFollowers:J,filterNewAccounts:T,filterPrivateMentions:z}=$.target,j={filterNotFollowing:W.checked,filterNotFollowers:J.checked,filterNewAccounts:T.checked,filterPrivateMentions:z.checked};D({...M,...j}),x(!1),(async()=>{try{await n.v1.notifications.policy.update(j),ot("Notifications settings updated")}catch{}})()},children:[t("p",{children:"Filter out notifications from people:"}),t("p",{children:t("label",{children:[t("input",{type:"checkbox",switch:!0,defaultChecked:M.filterNotFollowing,name:"filterNotFollowing"})," ","You don't follow"]})}),t("p",{children:t("label",{children:[t("input",{type:"checkbox",switch:!0,defaultChecked:M.filterNotFollowers,name:"filterNotFollowers"})," ","Who don't follow you"]})}),t("p",{children:t("label",{children:[t("input",{type:"checkbox",switch:!0,defaultChecked:M.filterNewAccounts,name:"filterNewAccounts"})," ","With a new account"]})}),t("p",{children:t("label",{children:[t("input",{type:"checkbox",switch:!0,defaultChecked:M.filterPrivateMentions,name:"filterPrivateMentions"})," ","Who unsolicitedly private mention you"]})}),t("p",{children:t("button",{type:"submit",children:"Save"})})]})})]})})]})}function $o(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Co({announcement:e}){const{instance:n}=V(),{contact:s}=yi(),i=s==null?void 0:s.account,{id:c,content:o,startsAt:d,endsAt:r,published:l,allDay:h,publishedAt:p,updatedAt:a,read:f,mentions:u,statuses:b,tags:y,emojis:S,reactions:m}=e,g=new Date(p),k=ne(g),w=new Date(a),I=ne(w);return t("div",{class:"announcement-block",children:[t(Zt,{account:i}),t("div",{class:"announcement-content",onClick:qn({mentions:u,instance:n}),dangerouslySetInnerHTML:{__html:Oe(o,{emojis:S})}}),t("p",{class:"insignificant",children:[t("time",{datetime:g.toISOString(),children:ne(g)}),a&&I!==k&&t(E,{children:[" ","•"," ",t("span",{class:"ib",children:["Updated"," ",t("time",{datetime:w.toISOString(),children:ne(w)})]})]})]}),t("div",{class:"announcement-reactions",hidden:!0,children:m.map(A=>{const{name:L,count:H,me:B,staticUrl:F,url:X}=A;return t("button",{type:"button",class:`plain4 small ${B?"reacted":""}`,children:[X||F?t("img",{src:X||F,alt:L,width:"16",height:"16"}):t("span",{children:L})," ",t("span",{class:"count",children:Ft(H)})]})})})]})}function xo(e){const{masto:n}=V();return n.v1.notifications.list({accountID:e})}function Ao({request:e}){var a;const{instance:n}=V(),[s,i]=R("loading"),{account:c,lastStatus:o}=e,[d,r]=R(!1),[l,h]=R([]);function p(){r(!1)}return G(()=>{var f;(f=e==null?void 0:e.account)!=null&&f.id&&d&&(i("loading"),(async()=>{const u=await xo(e.account.id);h(u||[]),i("default")})())},[d,(a=e==null?void 0:e.account)==null?void 0:a.id]),t(E,{children:[t("button",{type:"button",class:"plain4 request-notifications-account",onClick:()=>{r(!0)},children:[t(v,{icon:"notification",class:"more-insignificant"})," ",t("small",{children:["View notifications from @",c.username]})," ",t(v,{icon:"chevron-down"})]}),d&&t(Dt,{onClick:f=>{f.target===f.currentTarget&&p()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:p,children:t(v,{icon:"x"})}),t("header",{children:t("b",{children:["Notifications from @",c.username]})}),t("main",{children:s==="loading"?t("p",{class:"ui-state",children:t(St,{abrupt:!0})}):l.map(f=>t("div",{class:"notification-peek",onClick:u=>{const{target:b}=u;(u.target.tagName==="BUTTON"||u.target.tagName==="A")&&p()},children:t(Ne,{instance:n,notification:f,isStatic:!0})}))})]})})]})}function Ro({request:e,onChange:n}){const{masto:s}=V(),[i,c]=R("default"),[o,d]=R(null),r=o!==null;return t("p",{class:"notification-request-buttons",children:[t("button",{type:"button",disabled:i==="loading"||r,onClick:()=>{c("loading"),(async()=>{try{await s.v1.notifications.requests.$select(e.id).accept(),d("accept"),c("default"),n({request:e,state:"accept"}),ot(`Notifications from @${e.account.username} will not be filtered from now on.`)}catch{c("error"),ot("Unable to accept notification request")}})()},children:"Allow"})," ",t("button",{type:"button",disabled:i==="loading"||r,class:"light danger",onClick:()=>{c("loading"),(async()=>{try{await s.v1.notifications.requests.$select(e.id).dismiss(),d("dismiss"),c("default"),n({request:e,state:"dismiss"}),ot(`Notifications from @${e.account.username} will not show up in Filtered notifications from now on.`)}catch{c("error"),ot("Unable to dismiss notification request")}})()},children:"Dismiss"}),t("span",{class:"notification-request-states",children:i==="loading"?t(St,{abrupt:!0}):o==="accept"?t(v,{icon:"check-circle",alt:"Accepted",class:"notification-accepted"}):o==="dismiss"&&t(v,{icon:"x-circle",alt:"Dismissed",class:"notification-dismissed"})})]})}const ai=Bt(To),Eo=20;function Ve({local:e,columnMode:n,...s}){const i=xt(C),c=!!e,o=n?{}:ie(),{masto:d,instance:r}=V({instance:(s==null?void 0:s.instance)||o.instance}),{masto:l,instance:h}=V(),p=`${c?"Local":"Federated"} timeline (${r})`;Mt(p,c?"/:instance?/p/l":"/:instance?/p");const a=P(),f=P();async function u(y){(y||!f.current)&&(f.current=d.v1.timelines.public.list({limit:Eo,local:c}));const S=await f.current.next();let{value:m}=S;return m!=null&&m.length&&(y&&(a.current=m[0].id),m.forEach(g=>{_t(g,r)})),{...S,value:m}}async function b(){try{const y=await d.v1.timelines.public.list({limit:1,local:c,since_id:a.current}).next();let{value:S}=y;return S=de(S,"public"),!!(S!=null&&S.length)}catch{return!1}}return t(Xt,{title:p,titleComponent:t("h1",{class:"header-double-lines",children:[t("b",{children:c?"Local timeline":"Federated timeline"}),t("div",{children:r})]}),id:"public",instance:r,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:u,checkForUpdates:b,useItemID:!0,headerStart:t(E,{}),boostsCarousel:i.settings.boostsCarousel,filterContext:"public",headerEnd:t(Yt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(v,{icon:"more",size:"l"})}),children:[t(st,{href:c?`/#/${r}/p`:`/#/${r}/p/l`,children:c?t(E,{children:[t(v,{icon:"transfer"})," ",t("span",{children:"Switch to Federated"})]}):t(E,{children:[t(v,{icon:"transfer"})," ",t("span",{children:"Switch to Local"})]})}),t(Et,{}),t(st,{onClick:()=>{let y=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(y)){y&&alert("Invalid instance");return}y&&(y=y.toLowerCase().trim(),location.hash=c?`/${y}/p/l`:`/${y}/p`)},children:[t(v,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),h!==r&&t(st,{onClick:()=>{location.hash=c?`/${h}/p/l`:`/${h}/p`},children:[t(v,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:h}),")"]})]})]})},r+c)}const ve=5,Pe=40,Lo=new URLSearchParams;function ri({columnMode:e,...n}){const s=e?{}:ie(),{masto:i,instance:c,authenticated:o}=V({instance:s.instance}),[d,r]=R("default"),[l]=e?[Lo]:Wt(),h=P(),p=(n==null?void 0:n.query)||l.get("q"),a=e?"statuses":(n==null?void 0:n.type)||l.get("type");Mt(p?`Search: ${p}${a?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[a]})`:""}`:"Search","/search");const[f,u]=R(!1),b=P(0);G(()=>{b.current=0},[p,a]);const y=P();Jt(()=>{var _,x;(x=(_=y.current)==null?void 0:_.scrollTo)==null||x.call(_,0,0)},[p,a]);const[S,m]=R([]),[g,k]=R([]),[w,I]=R([]);G(()=>{m([]),k([]),I([])},[p]);const A={statuses:m,accounts:k,hashtags:I},[L,H]=R({}),B=async _=>{if(!(_!=null&&_.length))return;const x=await Xn(_,L);x&&H({...L,...x})};function F(_){_&&(b.current=0),!(!_&&!o)&&(r("loading"),_&&!a&&(m(S.slice(0,ve)),k(g.slice(0,ve)),I(w.slice(0,ve))),(async()=>{var M,D;const x={q:p,resolve:o,limit:ve};a&&(x.limit=Pe,x.type=a,o&&(x.offset=b.current));try{const it=await i.v2.search.fetch(x);if(a)if(_){A[a](it[a]);const wt=(M=it[a])==null?void 0:M.length;b.current=Pe,u(!!wt)}else{A[a](ht=>[...ht,...it[a]]);const wt=(D=it[a])==null?void 0:D.length;b.current=b.current+Pe,u(!!wt)}else m(it.statuses||[]),k(it.accounts||[]),I(it.hashtags||[]),b.current=0,u(!1);B(it.accounts),r("default")}catch{r("error")}})())}const X=P();le(_=>{var M;const x=((M=y.current)==null?void 0:M.scrollTop)===0;if(_&&x){const D=Date.now()-X.current;!X.current||D>1e3*3?F(!0):X.current=Date.now()}}),G(()=>{var _,x,M,D;(x=(_=h.current)==null?void 0:_.setValue)==null||x.call(_,p||""),p?F(!0):(D=(M=h.current)==null?void 0:M.focus)==null||D.call(M)},[p,a,c]),Tt(["/","Slash"],_=>{var x,M;(M=(x=h.current)==null?void 0:x.focus)==null||M.call(x)},{preventDefault:!0});const[N]=Mn();return t("div",{id:"search-page",class:"deck-container",ref:y,children:t("div",{class:"timeline-deck deck",children:[t("header",{class:d==="loading"?"loading":"",children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:t(ue,{})}),t(Yn,{ref:h}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>{F(!0)},disabled:d==="loading",children:t(v,{icon:"search",size:"l"})})})]})}),t("main",{children:[!!p&&!e&&t("div",{ref:N,class:`filter-bar ${d==="loading"?"loading":""}`,children:[!!a&&t(Q,{to:`/search${p?`?q=${encodeURIComponent(p)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(p)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(p)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(p)}&type=statuses`}].sort((_,x)=>_.type===a?-1:x.type===a?1:0).map(_=>t(Q,{to:_.to,children:_.label},_.type))]}),p?t(E,{children:[(!a||a==="accounts")&&t(E,{children:[a!=="accounts"&&t("h2",{class:"timeline-header",children:["Accounts"," ",t(Q,{to:`/search?q=${encodeURIComponent(p)}&type=accounts`,children:t(v,{icon:"arrow-right",size:"l"})})]}),g.length>0?t(E,{children:[t("ul",{class:"timeline flat accounts-list",children:g.map(_=>t("li",{children:t(Zt,{account:_,instance:c,showStats:!0,relationship:L[_.id]})},_.id))}),a!=="accounts"&&t("div",{class:"ui-state",children:t(Q,{class:"plain button",to:`/search?q=${encodeURIComponent(p)}&type=accounts`,children:["See more accounts ",t(v,{icon:"arrow-right"})]})})]}):!a&&(d==="loading"?t("p",{class:"ui-state",children:t(St,{abrupt:!0})}):t("p",{class:"ui-state",children:"No accounts found."}))]}),(!a||a==="hashtags")&&t(E,{children:[a!=="hashtags"&&t("h2",{class:"timeline-header",children:["Hashtags"," ",t(Q,{to:`/search?q=${encodeURIComponent(p)}&type=hashtags`,children:t(v,{icon:"arrow-right",size:"l"})})]}),w.length>0?t(E,{children:[t("ul",{class:"link-list hashtag-list",children:w.map(_=>{var it;const{name:x,history:M}=_,D=(it=M==null?void 0:M.reduce)==null?void 0:it.call(M,(wt,ht)=>wt+ +ht.uses,0);return t("li",{children:t(Q,{to:c?`/${c}/t/${x}`:`/t/${x}`,children:[t(v,{icon:"hashtag"}),t("span",{children:x}),!!D&&t("span",{class:"count",children:Ft(D)})]})},`${x}-${D}`)})}),a!=="hashtags"&&t("div",{class:"ui-state",children:t(Q,{class:"plain button",to:`/search?q=${encodeURIComponent(p)}&type=hashtags`,children:["See more hashtags ",t(v,{icon:"arrow-right"})]})})]}):!a&&(d==="loading"?t("p",{class:"ui-state",children:t(St,{abrupt:!0})}):t("p",{class:"ui-state",children:"No hashtags found."}))]}),(!a||a==="statuses")&&t(E,{children:[a!=="statuses"&&t("h2",{class:"timeline-header",children:["Posts"," ",t(Q,{to:`/search?q=${encodeURIComponent(p)}&type=statuses`,children:t(v,{icon:"arrow-right",size:"l"})})]}),S.length>0?t(E,{children:[t("ul",{class:"timeline",children:S.map(_=>t("li",{children:t(Q,{class:"status-link",to:c?`/${c}/s/${_.id}`:`/s/${_.id}`,children:t(Lt,{status:_})})},_.id))}),a!=="statuses"&&t("div",{class:"ui-state",children:t(Q,{class:"plain button",to:`/search?q=${encodeURIComponent(p)}&type=statuses`,children:["See more posts ",t(v,{icon:"arrow-right"})]})})]}):!a&&(d==="loading"?t("p",{class:"ui-state",children:t(St,{abrupt:!0})}):t("p",{class:"ui-state",children:"No posts found."}))]}),!!a&&(d==="default"?f?t(Qt,{onChange:_=>{_&&F()},children:t("button",{type:"button",class:"plain block",onClick:()=>F(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):d==="loading"&&t("p",{class:"ui-state",children:t(St,{abrupt:!0})}))]}):d==="loading"?t("p",{class:"ui-state",children:t(St,{abrupt:!0})}):t("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}function De(e,n,s){return Math.max(Math.min(e,s),n)}const Ue=e=>e>=.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,Fe=e=>e>=.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e;function li([e,n,s]){e=Ue(e/255),n=Ue(n/255),s=Ue(s/255);var i=.4122214708*e+.5363325363*n+.0514459929*s,c=.2119034982*e+.6806995451*n+.1073969566*s,o=.0883024619*e+.2817188376*n+.6299787005*s;return i=Math.cbrt(i),c=Math.cbrt(c),o=Math.cbrt(o),[i*.2104542553+c*.793617785+o*-.0040720468,i*1.9779984951+c*-2.428592205+o*.4505937099,i*.0259040371+c*.7827717662+o*-.808675766]}function di([e,n,l]){var i=e+n*.3963377774+l*.2158037573,c=e+n*-.1055613458+l*-.0638541728,o=e+n*-.0894841775+l*-1.291485548;i=i**3,c=c**3,o=o**3;var d=i*4.0767416621+c*-3.3077115913+o*.2309699292,r=i*-1.2684380046+c*2.6097574011+o*-.3413193965,l=i*-.0041960863+c*-.7034186147+o*1.707614701;return d=255*Fe(d),r=255*Fe(r),l=255*Fe(l),d=De(d,0,255),r=De(r,0,255),l=De(l,0,255),d=Math.round(d),r=Math.round(r),l=Math.round(l),[d,r,l]}const _o=20,No=ee(e=>e.v1.trends.links.list().next(),{maxAge:10*60*1e3});function ui({columnMode:e,...n}){const s=xt(C),i=e?{}:ie(),{masto:c,instance:o}=V({instance:(n==null?void 0:n.instance)||i.instance}),{masto:d,instance:r}=V(),l=`Trending (${o})`;Mt(l,"/:instance?/trending");const h=P(),[p,a]=R([]),[f,u]=R([]),b=P();async function y(g){var I;if(g||!b.current){b.current=c.v1.trends.statuses.list({limit:_o});try{const A=c.v1.trends.tags.list(),{value:L}=await A.next();L!=null&&L.length&&a(L)}catch{}try{const{value:A}=await No(c,o),L=(I=A==null?void 0:A.filter)==null?void 0:I.call(A,H=>H.type==="link");L!=null&&L.length&&u(L)}catch{}}const k=await b.current.next();let{value:w}=k;return w!=null&&w.length&&(g&&(h.current=w[0].id),w.forEach(A=>{_t(A,o)})),{...k,value:w}}async function S(){try{const g=await c.v1.trends.statuses.list({limit:1}).next();let{value:k}=g;return k=de(k,"public"),k!=null&&k.length&&k[0].id!==h.current?(h.current=k[0].id,!0):!1}catch{return!1}}const m=gt(()=>t(E,{children:[!!p.length&&t("div",{class:"filter-bar expandable",children:[t(v,{icon:"chart",class:"insignificant",size:"l"}),p.map((g,k)=>{const{name:w,history:I}=g,A=I.reduce((L,H)=>L+ +H.uses,0);return t(Q,{to:`/${o}/t/${w}`,children:[t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),w]}),t("span",{class:"filter-count",children:Ft(A)})]},w)})]}),!!f.length&&t("div",{class:"links-bar",children:[t("header",{children:t("h3",{children:"Trending News"})}),f.map(g=>{const{authorName:k,authorUrl:w,blurhash:I,description:A,height:L,image:H,imageDescription:B,language:F,providerName:X,providerUrl:N,publishedAt:_,title:x,url:M,width:D}=g,it=new URL(M).hostname.replace(/^www\./,"").replace(/\/$/,"");let wt;if(I){const ht=Un(I),q=li(ht);wt=di([.6,q[1],q[2]])}return t("a",{href:M,target:"_blank",rel:"noopener noreferrer",style:wt?{"--accent-color":`rgb(${wt.join(",")})`,"--accent-alpha-color":`rgba(${wt.join(",")}, 0.4)`}:{},children:t("article",{children:[t("figure",{children:t("img",{src:H,alt:B,width:D,height:L,loading:"lazy"})}),t("div",{class:"article-body",children:[t("header",{children:[t("div",{class:"article-meta",children:[t("span",{class:"domain",children:it})," ",!!_&&t(E,{children:"· "}),!!_&&t(E,{children:t(_e,{datetime:_,format:"micro"})})]}),!!x&&t("h1",{class:"title",lang:F,dir:"auto",title:x,children:x})]}),!!A&&t("p",{class:"description",lang:F,dir:"auto",title:A,children:A})]})]})},M)})]})]}),[p,f]);return t(Xt,{title:l,titleComponent:t("h1",{class:"header-double-lines",children:[t("b",{children:"Trending"}),t("div",{children:o})]}),id:"trending",instance:o,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:y,checkForUpdates:S,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:t(E,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",timelineStart:m,headerEnd:t(Yt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(v,{icon:"more",size:"l"})}),children:[t(st,{onClick:()=>{let g=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(g)){g&&alert("Invalid instance");return}g&&(g=g.toLowerCase().trim(),location.hash=`/${g}/trending`)},children:[t(v,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),r!==o&&t(st,{onClick:()=>{location.hash=`/${r}/trending`},children:[t(v,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:r}),")"]})]})]})},o)}function Mo(){Mt("Home","/");const e=xt(C),{shortcuts:n}=e,s=n.map(i=>{if(!i)return null;const{type:c,...o}=i,d={following:Je,notifications:ai,list:ii,public:Ve,bookmarks:Qn,favourites:ti,hashtag:ni,mentions:si,trending:ui,search:ri}[c];return!d||c==="search"&&!o.query||c==="list"&&!o.id?null:t(d,{...o,columnMode:!0},c+JSON.stringify(o))});return Tt(["1","2","3","4","5","6","7","8","9"],(i,c)=>{try{const o=parseInt(c.keys[0],10)-1;document.querySelectorAll("#columns > *")[o].focus()}catch{}}),t("div",{id:"columns",onContextMenu:i=>{i.target.closest(".deck > header")&&!i.target.closest("a")&&!i.target.closest("button")&&(i.preventDefault(),C.showShortcutsSettings=!0)},children:s})}function Po(){var n;const e=xt(C);return G(()=>{(async()=>{const s=await qi.drafts.keys();if(s.length){const i=wi();s.filter(o=>o.startsWith(i)).length&&(C.showDrafts=!0)}})()},[]),t(E,{children:(e.settings.shortcutsViewMode==="multi-column"||!e.settings.shortcutsViewMode&&e.settings.shortcutsColumnsMode)&&((n=e.shortcuts)!=null&&n.length)?t(Mo,{}):t(Je,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:t(Do,{})})})}function Do(){const e=xt(C),n=P(),[s,i]=R(void 0);return t(E,{children:[t(Q,{ref:n,to:"/notifications",class:`button plain notifications-button ${e.notificationsShowNew?"has-badge":""} ${s||""}`,onClick:c=>{c.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(c.preventDefault(),i(o=>o?void 0:"open"))},children:t(v,{icon:"notification",size:"l",alt:"Notifications"})}),t(Bo,{state:s,anchorRef:n,onClose:()=>i(void 0)})]})}const Uo=30,Fo=5;function Bo({anchorRef:e,state:n,onClose:s}){const{masto:i,instance:c}=V(),o=xt(C),[d,r]=R("default"),l=i.v1.notifications.list({limit:Uo});async function h(){const b=await l.next(),y=b.value;if(y!=null&&y.length){y.forEach(m=>{_t(m.status,c,{skipThreading:!0})});const S=oi(y);C.notificationsLast=y[0],C.notifications=S,i.v1.markers.create({notifications:{lastReadId:y[0].id}}).catch(()=>{})}return C.notificationsShowNew=!1,C.notificationsLastFetchTime=Date.now(),b}const[p,a]=R(!1);function f(){return i.v1.followRequests.list({limit:1})}function u(){r("loading"),(async()=>{try{await h();const b=await f();a(!!(b!=null&&b.length)),r("default")}catch{r("error")}})()}return G(()=>{n==="open"&&u()},[n]),t(Pn,{menuClassName:"notifications-menu",state:n,anchorRef:e,onClose:s,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[t("header",{children:t("h2",{children:"Notifications"})}),t("main",{children:o.notifications.length?t(E,{children:o.notifications.slice(0,Fo).map(b=>t(Ne,{instance:c,notification:b,disableContextMenu:!0},b.id))}):d==="loading"?t("div",{class:"ui-state",children:t(St,{abrupt:!0})}):d==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to fetch notifications."}),t("p",{children:t("button",{type:"button",onClick:u,children:"Try again"})})]})}),t("footer",{children:[t(Q,{to:"/mentions",class:"button plain",children:[t(v,{icon:"at"})," ",t("span",{children:"Mentions"})]}),t(Q,{to:"/notifications",class:"button plain2",children:[p?t(E,{children:[t("span",{class:"tag collapsed",children:"New"})," ",t("span",{children:"Follow Requests"})]}):t("b",{children:"See all"})," ",t(v,{icon:"arrow-right"})]})]})]})}const Oo=Bt(Po),zo=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function hi(e){const{hostname:n,pathname:s}=new URL(e);for(const i of zo){const[,c]=s.match(i)||[];if(c)return{instance:n,id:c}}return{}}function qo(e){const{instance:n,id:s}=hi(e);return n&&s?`/${n}/s/${s}`:null}function Ho(){const n=Le().pathname.replace(/^\//,""),s=hi(n),i=s!=null&&s.instance?`/${s.instance}/s/${s.id}`:null,[c,o]=R("loading");return Jt(()=>{o("loading"),(async()=>{try{const{instance:d,id:r}=s,{masto:l}=V({instance:d});if(await l.v1.statuses.$select(r).fetch()){window.location.hash=i+"?view=full";return}}catch{}{const{masto:d,instance:r}=V(),l=await d.v2.search.fetch({q:n,limit:1,resolve:!0});if(l.statuses.length){const h=l.statuses[0];window.location.hash=`/${r}/s/${h.id}?view=full`}else if(l.accounts.length){const h=l.accounts[0];window.location.hash=`/${r}/a/${h.id}`}else i?window.location.hash=i+"?view=full":o("error")}})()},[i]),t("div",{class:"ui-state",tabIndex:"-1",children:[c==="loading"?t(E,{children:[t(St,{abrupt:!0}),t("h2",{children:"Resolving…"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):t(E,{children:[t("h2",{children:"Unable to resolve URL"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),t("hr",{}),t("p",{children:t(Q,{to:"/",children:"Go home"})})]})}function Vo(){Mt("Lists","/l");const[e,n]=R("default"),[s,i]=Ee(l=>l+1,0),[c,o]=R([]);G(()=>{n("loading"),(async()=>{try{const l=await He();o(l),n("default")}catch{n("error")}})()},[s]);const[d,r]=R(!1);return t("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(ue,{}),t(Q,{to:"/",class:"button plain",children:t(v,{icon:"home",size:"l"})})]}),t("h1",{children:"Lists"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>r(!0),children:t(v,{icon:"plus",size:"l",alt:"New list"})})})]})}),t("main",{children:c.length>0?t(E,{children:[t("ul",{class:"link-list",children:c.map(l=>t("li",{children:t(Q,{to:`/l/${l.id}`,children:t("span",{children:[t(v,{icon:"list"})," ",t("span",{children:l.title})]})})}))}),c.length>1&&t("footer",{class:"ui-state",children:t("small",{class:"insignificant",children:[c.length," list",c.length===1?"":"s"]})})]}):e==="loading"?t("p",{class:"ui-state",children:t(St,{})}):e==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists yet."})})]}),d&&t(Dt,{onClick:l=>{l.target===l.currentTarget&&r(!1)},children:t(Ke,{list:d==null?void 0:d.list,onClose:l=>{l.state==="success"&&i(),r(!1)}})})]})}const fi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e",jo=""+new URL("instances-MzK7fGXv.json",import.meta.url).href;var Go={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:Yo,PHANPY_WEBSITE:Wo}=Go,tn="read write follow push";async function Ko({instanceURL:e}){const n=new URLSearchParams({client_name:Yo,redirect_uris:location.origin+location.pathname,scopes:tn,website:Wo});return await(await fetch(`https://${e}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Zo({instanceURL:e,client_id:n}){const s=new URLSearchParams({client_id:n,scope:tn,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${e}/oauth/authorize?${s.toString()}`}async function Jo({instanceURL:e,client_id:n,client_secret:s,code:i}){const c=new URLSearchParams({client_id:n,client_secret:s,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:i,scope:tn});return await(await fetch(`https://${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c.toString()})).json()}var Xo={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Qo}=Xo;function tc(){Mt("Log in");const e=P(),n=ct.local.get("instanceURL"),[s,i]=R("default"),[c]=Wt(),o=c.get("instance"),d=c.get("submit"),[r,l]=R(o||(n==null?void 0:n.toLowerCase())||""),[h,p]=R([]);G(()=>{(async()=>{try{const g=await(await fetch(jo)).json();p(g)}catch{}})()},[]);const a=m=>{m&&(ct.local.set("instanceURL",m),(async()=>{i("loading");try{const{client_id:g,client_secret:k,vapid_key:w}=await Ko({instanceURL:m});g&&k?(ct.session.set("clientID",g),ct.session.set("clientSecret",k),ct.session.set("vapidKey",w),location.href=await Zo({instanceURL:m,client_id:g})):alert("Failed to register application"),i("default")}catch{i("error")}})())},f=r?r.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,u=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(f)&&!/[\s\/\\@]/.test(f),b=f?h.filter(m=>m.includes(r)).sort((m,g)=>{const k=m.toLowerCase().startsWith(r.toLowerCase()),w=g.toLowerCase().startsWith(r.toLowerCase());return k&&!w?-1:!k&&w?1:0}).slice(0,10):[],y=u?f:b!=null&&b.length?b[0]:r?h.find(m=>m.includes(r)):null,S=m=>{m.preventDefault(),a(y)};return d&&G(()=>{a(o||y)},[]),t("main",{id:"login",style:{textAlign:"center"},children:t("form",{onSubmit:S,children:[t("h1",{children:[t("img",{src:fi,alt:"",width:"80",height:"80"}),t("br",{}),"Log in"]}),t("label",{children:[t("p",{children:"Instance"}),t("input",{value:r,required:!0,type:"text",class:"large",id:"instanceURL",ref:e,disabled:s==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellCheck:!1,placeholder:"instance domain",onInput:m=>{l(m.target.value)}}),(b==null?void 0:b.length)>0?t("ul",{id:"instances-suggestions",children:b.map((m,g)=>t("li",{children:t("button",{type:"button",class:"plain5",onClick:()=>{a(m)},children:m})}))}):t("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),s==="error"&&t("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),t("div",{children:[t("button",{disabled:s==="loading"||!r||!y,children:y?`Continue with ${y}`:"Continue"})," "]}),t(St,{hidden:s!=="loading"}),t("hr",{}),!Qo&&t("p",{children:t("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),t("p",{children:t(Q,{to:"/",children:"Go home"})})]})})}var ec={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:Dc}=ec;function nc({mediaAttachments:e,statusID:n,instance:s,lang:i,index:c=0,onClose:o=()=>{}}){var g,k;const[d,r]=R("default"),l=P(null),[h,p]=R(c),a=P(null);Jt(()=>{var w;(w=a.current)==null||w.scrollIntoView()},[]);const f=P(n);G(()=>{const w=c*l.current.clientWidth,I=f.current!==n;I&&(f.current=n),l.current.scrollTo({left:w,behavior:I?"auto":"smooth"}),l.current.focus()},[c,n]);const[u,b]=R(!0);G(()=>{let w=()=>{o()};return l.current&&l.current.addEventListener("swiped-down",w),()=>{l.current&&l.current.removeEventListener("swiped-down",w)}},[]),Tt("esc",o,{ignoreEventWhen:w=>!!document.querySelector("#modal-container > *")},[o]),G(()=>{let w=()=>{const{clientWidth:I,scrollLeft:A}=l.current,L=Math.round(A/I);p(L)};return l.current&&l.current.addEventListener("scroll",w,{passive:!0}),()=>{l.current&&l.current.removeEventListener("scroll",w)}},[]),G(()=>{let w=setTimeout(()=>{var I,A;(A=(I=l.current)==null?void 0:I.focus)==null||A.call(I)},100);return()=>clearTimeout(w)},[]);const y=gt(()=>e==null?void 0:e.map(w=>{const{blurhash:I}=w;if(I){const A=Un(I),L=li(A);return di([.6,L[1],L[2]])}return null}),[e]),S=gt(()=>{var A;const I=100/y.length;return((A=y==null?void 0:y.map((L,H)=>{const B=H*I+5,F=(H+1)*I-5;return L?`
            rgba(${L==null?void 0:L.join(",")}, 0.4) ${B}%,
            rgba(${L==null?void 0:L.join(",")}, 0.4) ${F}%
          `:`
            transparent ${B}%,
            transparent ${F}%
          `}))==null?void 0:A.join(", "))||"transparent"},[y]);let m=P(null);return G(()=>()=>{var w,I;(I=(w=m.current)==null?void 0:w.hideToast)==null||I.call(w)},[]),t("div",{class:`media-modal-container media-modal-count-${e==null?void 0:e.length}`,children:[t("div",{ref:l,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:w=>{(w.target.classList.contains("carousel-item")||w.target.classList.contains("media")||w.target.classList.contains("media-zoom"))&&o()},style:e.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${S})`}:{},children:e==null?void 0:e.map((w,I)=>{const A=e.length===1?y[I]:null;return t("div",{class:"carousel-item",style:A?{"--accent-color":`rgb(${A==null?void 0:A.join(",")})`,"--accent-alpha-color":`rgba(${A==null?void 0:A.join(",")}, 0.4)`}:{},tabindex:"0",ref:I===h?a:null,onClick:L=>{L.target.classList.contains("media")||b(!u)},children:[!!w.description&&t("button",{type:"button",class:"media-alt",hidden:!u,onClick:()=>{C.showMediaAlt={alt:w.description,lang:i}},children:[t("span",{class:"alt-badge",children:"ALT"}),t("span",{class:"media-alt-desc",lang:i,dir:"auto",children:w.description})]}),t(jn,{media:w,showOriginal:!0,lang:i})]},w.id)})}),t("div",{class:"carousel-top-controls",hidden:!u,children:[t("span",{children:t("button",{type:"button",class:"carousel-button",onClick:()=>o(),children:t(v,{icon:"x"})})}),(e==null?void 0:e.length)>1?t("span",{class:"carousel-dots",children:e==null?void 0:e.map((w,I)=>t("button",{type:"button",disabled:I===h,class:`carousel-dot ${I===h?"active":""}`,onClick:A=>{A.preventDefault(),A.stopPropagation(),l.current.scrollTo({left:l.current.clientWidth*I,behavior:"smooth"}),l.current.focus()},children:t(v,{icon:"round",size:"s"})},w.id))}):t("span",{}),t("span",{children:[t(Yt,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:t("button",{type:"button",class:"carousel-button",children:t(v,{icon:"more",alt:"More"})}),children:[t(vt,{href:((g=e[h])==null?void 0:g.remoteUrl)||((k=e[h])==null?void 0:k.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[t(v,{icon:"popout"}),t("span",{children:"Open original media"})]}),!1]})," ",t(Q,{to:`${s?`/${s}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${h+1}`:""}`,class:"button carousel-button media-post-link",children:[t("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(e==null?void 0:e.length)>1&&t("div",{class:"carousel-controls",hidden:!u,children:[t("button",{type:"button",class:"carousel-button",hidden:h===0,onClick:w=>{w.preventDefault(),w.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(h-1),behavior:"smooth"})},children:t(v,{icon:"arrow-left"})}),t("button",{type:"button",class:"carousel-button",hidden:h===e.length-1,onClick:w=>{w.preventDefault(),w.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(h+1),behavior:"smooth"})},children:t(v,{icon:"arrow-right"})})]})]})}const Se=40,ic=10,sc=5;let je={},Te={},$e={};function Ce(e){delete Te[e],delete $e[e]}const he={block:"nearest",inline:"center",behavior:"smooth"},In=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",Tn=/\/s\//i;function oc(e){const{id:n}=e,{masto:s,instance:i}=V({instance:e.instance}),c=xt(C),[o,d]=Wt(),r=o.get("media"),l=o.get("media-only"),h=parseInt(r||l,10);let p=h>0;const a=o.get("mediaStatusID"),f=_n(a,i);a&&!f&&(p=!1);const u=p&&!!l,b=Gt(n,i),[y,S]=R(C.statuses[b]);G(()=>{C.statuses[b]&&S(C.statuses[b])},[b]);const m=gt(()=>{const{prevLocation:w}=C,I=((w==null?void 0:w.pathname)||"")+((w==null?void 0:w.search)||""),A=me("/:instance/s/:id",I)||me("/s/:id",I);return!I||A?"/":I},[]);G(()=>{!y&&p&&(async()=>{try{const w=await s.v1.statuses.$select(n).fetch();_t(w,i),S(w)}catch{alert("Unable to load post."),location.hash=m}})()},[p]);const g=a?f==null?void 0:f.mediaAttachments:y==null?void 0:y.mediaAttachments,k=qt(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&c.prevLocation?history.back():u?location.hash=m:(o.delete("media"),o.delete("mediaStatusID"),d(o))},[u,m,c.prevLocation]);return G(()=>{let w=setTimeout(()=>{const I=document.querySelector(".carousel");I&&I.focus()},100);return()=>clearTimeout(w)},[u]),t("div",{class:"deck-backdrop",children:[p?g!=null&&g.length?t(nc,{mediaAttachments:g,statusID:a||n,instance:i,lang:y==null?void 0:y.language,index:h-1,onClose:k}):t("div",{class:"media-modal-container loading",children:t(St,{abrupt:!0})}):t(Q,{to:m}),!u&&t(ac,{id:n,instance:e.instance,closeLink:m})]})}function cc(e){const{linkable:n,to:s,onClick:i,...c}=e;return n?t(Q,{class:"status-link",to:s,onClick:i,...c}):t("div",{class:"status-focus",tabIndex:0,...c})}function ac({id:e,closeLink:n="/",instance:s}){var W,J;const[i,c]=Wt(),o=i.get("media"),d=i.get("mediaStatusID"),r=parseInt(o,10)>0,l=P(!C.prevLocation&&(history.length===1||"navigation"in window&&((J=(W=navigation==null?void 0:navigation.entries)==null?void 0:W.call(navigation))==null?void 0:J.length)===1)),[h,p]=R(i.get("view")||l.current?"full":null),a=!!parseInt(i.get("translate")),{masto:f,instance:u}=V({instance:s}),{masto:b,instance:y,authenticated:S}=V(),m=u===y,g=xt(C),[k,w]=R([]),[I,A]=R("default"),L=P(),H=Gt(e,u),B=P(0),F=P();G(()=>{var T;(T=F.current)==null||T.focus()},[]),G(()=>{var z;const T=Fn(()=>{if(!F.current)return;const{scrollTop:j}=F.current;I!=="loading"&&($e[e]=j)},50);return(z=F.current)==null||z.addEventListener("scroll",T,{passive:!0}),T(),()=>{var j;T.cancel(),(j=F.current)==null||j.removeEventListener("scroll",T)}},[e,I!=="loading"]);const X=P(),N=P(),_=({reloadHero:T}={})=>{A("loading");let z;const j=Te[e];if(j){const at=j.filter(U=>C.statuses[H]);w(at)}else w([{id:e}]);return(async()=>{var mt,Ot;const at=()=>an(()=>f.v1.statuses.$select(e).fetch(),{retries:4}),U=an(()=>f.v1.statuses.$select(e).context.fetch(),{retries:8}),ut=!!g.statuses[H];let lt=g.statuses[H];if(!(ut&&!T))try{lt=await at(),_t(lt,u),await new Promise(Ut=>{setTimeout(Ut,100)})}catch{A("error");return}try{let Ut=function(nt){return nt==null?void 0:nt.map(Pt=>({id:Pt.id,account:Pt.account,repliesCount:Pt.repliesCount,content:Pt.content,weight:pe(Pt),replies:Ut(Pt.__replies)}))};const Nt=await U,{ancestors:Ht,descendants:Ct}=Nt;B.current=(Ct==null?void 0:Ct.length)||0;const zt=new Set;Ht.forEach(nt=>{_t(nt,u,{skipThreading:!0}),nt.inReplyToId&&!Ht.find(Pt=>Pt.id===nt.inReplyToId)&&zt.add(nt.inReplyToId)});const se=Ht.every(nt=>nt.account.id===lt.account.id),Vt=[];Ct.forEach(nt=>{if(_t(nt,u,{skipThreading:!0}),nt.inReplyToId&&!Ct.find(Pt=>Pt.id===nt.inReplyToId)&&nt.inReplyToId!==lt.id&&zt.add(nt.inReplyToId),nt.inReplyToAccountId===nt.account.id)Vt.push(nt);else if(nt.inReplyToId===lt.id)Vt.push(nt);else if(!nt.inReplyToAccountId&&Vt.find(Pt=>Pt.id===nt.inReplyToId)&&nt.account.id===lt.account.id)Vt.push(nt);else{const Pt=Ct.find(mi=>mi.id===nt.inReplyToId);Pt&&(Pt.__replies||(Pt.__replies=[]),Pt.__replies.push(nt))}}),zt.size;const jt=[...Ht.map(nt=>({id:nt.id,ancestor:!0,isThread:se,accountID:nt.account.id,account:nt.account,repliesCount:nt.repliesCount,weight:pe(nt)})),{id:e,accountID:lt.account.id,weight:pe(lt)},...Vt.map(nt=>({id:nt.id,account:nt.account,accountID:nt.account.id,descendant:!0,thread:nt.account.id===lt.account.id,weight:pe(nt),replies:Ut(nt.__replies)}))];A("default"),X.current={offsetTop:(mt=L.current)==null?void 0:mt.offsetTop,scrollTop:(Ot=F.current)==null?void 0:Ot.scrollTop};const en=jt.findIndex(nt=>nt.id===e);en>=rt&&et(en+1),w(jt),Te[e]=jt,vi(lt,u)}catch{A("error")}})(),N.current=Date.now(),()=>{clearTimeout(z)}};G(_,[e,f]);const[x,M]=R(!1);G(()=>{let T=setInterval(()=>{const z=Date.now();N.current&&z-N.current>=6e4&&M(!0)},6e4);return()=>{clearInterval(T)}},[]),Jt(()=>{var z,j;if(!k.length)return;const T=$e[e];if(T)F.current.scrollTop=T;else if(X.current){const at={offsetTop:(z=L.current)==null?void 0:z.offsetTop,scrollTop:(j=F.current)==null?void 0:j.scrollTop},U=at.offsetTop-X.current.offsetTop+at.scrollTop;F.current.scrollTop=U}else k.length===1&&(F.current.scrollTop=0);X.current=null},[k]),G(()=>{g.reloadStatusPage<=0||(async()=>{try{const{instanceURL:T}=ae(),z=`https://${T}/api/v1/statuses/${e}/context`;return await(await caches.open("api")).delete(z,{ignoreVary:!0}),_({reloadHero:!0})}catch{}})()},[g.reloadStatusPage]),G(()=>()=>{$e={},C.reloadStatusPage=0,Te={},je={},Ge.clear()},[]);const D=g.statuses[H]||g.statuses[e],it=gt(()=>{if(!D)return"";const{account:T}=D,z=document.createElement("div");return z.innerHTML=T.displayName,z.innerText.trim()},[D]),wt=gt(()=>{if(!D)return"";let T=Gn(D);return T.length>64&&(T=T.slice(0,64)+"…"),T},[D]);Mt(it&&wt?`${it}: "${wt}"`:"Status","/:instance?/s/:id");const ht=gt(()=>{if(!D)return;const{url:T}=D;if(T)return new URL(T).hostname},[D]),q=gt(()=>{if(ht)return ht===u},[ht,u]),[rt,et]=R(Se),ft=gt(()=>k.length-rt,[k.length,rt]),pt=k.some(T=>T.descendant),At=k.filter(T=>T.ancestor),[kt,$t]=R(!0),Rt=gt(()=>{if(!L.current||kt)return null;const{top:T}=L.current.getBoundingClientRect();return T>0?"down":"up"},[kt]);Tt("esc",()=>{location.hash=n},{enabled:!r,ignoreEventWhen:T=>!!document.querySelector("#modal-container > *")}),Tt("backspace",()=>{location.hash=n}),Tt("j",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),z=T==null?void 0:T.getBoundingClientRect(),j=Array.from(F.current.querySelectorAll(In));if(T&&z.top<F.current.clientHeight&&z.bottom>0){const at=j.indexOf(T);let U=j[at+1];U&&(U.focus(),U.scrollIntoView(he))}else{const at=j.find(U=>{const ut=U.getBoundingClientRect();return ut.top>=44&&ut.left>=0});at&&(at.focus(),at.scrollIntoView(he))}}),Tt("k",()=>{const T=document.activeElement.closest(".status-link, .status-focus"),z=T==null?void 0:T.getBoundingClientRect(),j=Array.from(F.current.querySelectorAll(In));if(T&&z.top<F.current.clientHeight&&z.bottom>0){const at=j.indexOf(T);let U=j[at-1];U&&(U.focus(),U.scrollIntoView(he))}else{const at=j.find(U=>{const ut=U.getBoundingClientRect();return ut.top>=44&&ut.left>=0});at&&(at.focus(),at.scrollIntoView(he))}}),Tt("x",()=>{const T=document.activeElement.closest(".status-link, .status-focus");if(T){const z=T.nextElementSibling;z&&z.tagName.toLowerCase()==="details"&&(z.open=!z.open)}});const[yt,Y]=R(!1),tt=P(r?"media+status":"status"),K=qt((T,z,j,at)=>{T.preventDefault(),T.stopPropagation(),c({media:z+1,mediaStatusID:at.id})},[e]),bt=qt((T,z)=>{Ce(z.id)},[]);G(()=>{let T;return d&&r&&(T=setTimeout(()=>{var j;const z=(j=F.current)==null?void 0:j.querySelector(`.status-link[href*="/${d}"]`);z&&z.scrollIntoView(he)},400)),()=>{clearTimeout(T)}},[d,r]);const dt=qt((T,z)=>{const{id:j,ancestor:at,isThread:U,descendant:ut,thread:lt,replies:mt,repliesCount:Ot,weight:Ut}=T,Nt=j===e;return t("li",{ref:Nt?L:null,class:`${at?"ancestor":""} ${ut?"descendant":""} ${lt?"thread":""} ${Nt?"hero":""}`,children:[Nt?t(E,{children:[t(Qt,{threshold:.1,onChange:Ct=>{queueMicrotask(()=>{requestAnimationFrame(()=>{$t(Ct)})})},class:"status-focus",tabIndex:0,children:t(Lt,{statusID:j,instance:u,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:a})}),I!=="loading"&&!S?t("div",{class:"post-status-banner",children:[t("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),t(Q,{to:"/login",class:"button",children:"Log in"})]}):!m&&t("div",{class:"post-status-banner",children:[t("p",{children:["This post is from another instance (",t("b",{children:u}),"). Interactions (reply, boost, etc) are not possible."]}),t("button",{type:"button",disabled:I==="loading",onClick:()=>{A("loading"),(async()=>{try{const Ct=await b.v2.search.fetch({q:D.url,type:"statuses",resolve:!0,limit:1});if(Ct.statuses.length){const zt=Ct.statuses[0];location.hash=y?`/${y}/s/${zt.id}`:`/s/${zt.id}`}else throw new Error("No results")}catch(Ct){A("default"),alert("Error: "+Ct)}})()},children:[t(v,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):t(cc,{linkable:U||at,to:u?`/${u}/s/${j}`:`/s/${j}`,onClick:()=>{Ce(j)},children:[z===0&&at?t(Qt,{threshold:.5,onChange:Ct=>{queueMicrotask(()=>{requestAnimationFrame(()=>{Y(Ct)})})},children:t(Lt,{statusID:j,instance:u,withinContext:!0,size:lt||at?"m":"s",enableTranslate:!0,onMediaClick:K,onStatusLinkClick:bt})}):t(Lt,{statusID:j,instance:u,withinContext:!0,size:lt||at?"m":"s",enableTranslate:!0,onMediaClick:K,onStatusLinkClick:bt,showActionsBar:!!ut}),at&&Ot>1&&t("div",{class:"replies-link",children:[t(v,{icon:"comment2"})," ",t("span",{title:Ot,children:Ft(Ot)})]})," "]}),ut&&(mt==null?void 0:mt.length)>0&&t(pi,{instance:u,replies:mt,hasParentThread:lt,level:1,accWeight:Ut,openAll:B.current<ic,parentLink:{to:u?`/${u}/s/${j}`:`/s/${j}`,onClick:()=>Ce(j)}}),I==="loading"&&Nt&&!!(D!=null&&D.repliesCount)&&!pt&&t("div",{class:"status-loading",children:t(St,{abrupt:D.repliesCount>=3})}),I==="error"&&Nt&&!!(D!=null&&D.repliesCount)&&!pt&&t("div",{class:"status-error",children:["Unable to load replies.",t("br",{}),t("button",{type:"button",class:"plain",onClick:()=>{C.reloadStatusPage++},children:"Try again"})]})]},j)},[e,u,I,S,m,a,K,bt,pt]),Z=gt(()=>{var T;if("navigation"in window&&(navigation!=null&&navigation.entries)){const z=navigation.entries()[navigation.currentEntry.index-1];if(z!=null&&z.url)return Tn.test(z.url)}return Tn.test((T=C.prevLocation)==null?void 0:T.pathname)},[H]),O=gt(()=>{if(!ft)return[];const T=[];function z(j){T.push(j.id),j.replies&&j.replies.forEach(z)}return k.slice(rt).forEach(z),T.map(j=>Gt(j,u))},[ft,k,rt,u]),$=gt(()=>k.slice(0,rt).map(dt),[k,rt,dt]);return t("div",{tabIndex:"-1",ref:F,class:`status-deck deck contained ${k.length>1?"padded-bottom":""} ${tt.current==="status"&&!l.current?"slide-in":""} ${h?`deck-view-${h}`:""}`,onAnimationEnd:T=>{tt.current==="status"&&(tt.current=null)},children:[t("header",{class:`${I==="loading"?"loading":""}`,onDblClick:T=>{C.reloadStatusPage++},children:t("div",{class:"header-grid header-grid-2",children:[t("h1",{children:[Z&&t("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:t(v,{icon:"chevron-left",size:"xl"})}),!kt&&D&&I!=="loading"?t(E,{children:[t("span",{class:"hero-heading",children:[t(Be,{account:D.account,instance:u,showAvatar:!0,short:!0})," ",t("span",{class:"insignificant",children:["•"," ",t(_e,{datetime:D.createdAt,format:"micro"})]})]})," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),L.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:t(v,{icon:Rt==="down"?"arrow-down":"arrow-up"})})]}):t(E,{children:["Post"," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:T=>{T.preventDefault(),T.stopPropagation(),F.current.scrollTo({top:0,behavior:"smooth"})},hidden:!At.length||yt,title:`${At.length} posts above ‒ Go to top`,children:[t(v,{icon:"arrow-up"}),At.filter((T,z,j)=>j.findIndex(at=>at.accountID===T.accountID)===z).slice(0,3).map(T=>t(re,{url:T.account.avatar,alt:T.account.displayName},T.account.id)),At.length>3&&t(E,{children:[" ",t("span",{class:"insignificant",children:Ft(At.length)})]})]})]})]}),t("div",{class:"header-side",children:[t("button",{type:"button",class:"plain4 button-switch-view",style:{display:h==="full"?"":"none"},onClick:()=>{p(null),i.delete("media"),i.delete("media-only"),i.delete("view"),c(i)},title:"Switch to Side Peek view",children:t(v,{icon:"layout4",size:"l"})}),x&&t("button",{type:"button",class:"plain button-refresh",onClick:()=>{C.reloadStatusPage++,M(!1)},children:t(v,{icon:"refresh",size:"l"})}),t(Yt,{align:"end",portal:{target:F.current},menuButton:t("button",{type:"button",class:"button plain4",children:t(v,{icon:"more",alt:"Actions",size:"xl"})}),children:[t(st,{disabled:I==="loading",onClick:()=>{C.reloadStatusPage++},children:[t(v,{icon:"refresh"}),t("span",{children:"Refresh"})]}),t(st,{className:"menu-switch-view",onClick:()=>{p(h==="full"?null:"full"),i.delete("media"),i.delete("media-only"),h==="full"?i.delete("view"):i.set("view","full"),c(i)},children:[t(v,{icon:{"":"layout5",full:"layout4"}[h||""]}),t("span",{children:["Switch to ",h==="full"?"Side Peek":"Full"," view"]})]}),t(st,{onClick:()=>{Array.from(F.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(z=>{z.click()})},children:[t(v,{icon:"eye-open"})," ",t("span",{children:"Show all sensitive content"})]}),t(Et,{}),t(Dn,{className:"plain",children:"Experimental"}),t(st,{disabled:!ht||q,onClick:()=>{const T=qo(D.url);T?location.hash=T:alert("Unable to switch")},children:[t(v,{icon:"transfer"}),t("small",{class:"menu-double-lines",children:["Switch to post's instance",ht?t(E,{children:[" ","(",t("b",{children:ht}),")"]}):""]})]})]}),t(Q,{class:"button plain deck-close",to:n,children:t(v,{icon:"x",size:"xl"})})]})]})}),k.length&&D?t("ul",{class:`timeline flat contextual grow ${I==="loading"?"loading":""}`,children:[$,ft>0&&t("li",{children:t("button",{type:"button",class:"plain block show-more",disabled:I==="loading",onClick:()=>et(T=>T+Se),style:{marginBlockEnd:"6em"},"data-state-post-ids":O.join(" "),children:[t("div",{class:"ib avatars-bunch",children:k.slice(rt,rt+5).map(T=>t(re,{url:T.account.avatarStatic},T.id))})," ",t("div",{class:"ib",children:["Show more…"," ",t("span",{class:"tag",children:ft>Se?`${Se}+`:ft})]})]})})]}):t(E,{children:[I==="loading"&&t("ul",{class:"timeline flat contextual grow loading",children:t("li",{children:t(Lt,{skeleton:!0,size:"l"})})}),I==="error"&&t("p",{class:"ui-state",children:["Unable to load post",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>{C.reloadStatusPage++},children:"Try again"})]})]})]})}function pi({replies:e,instance:n,hasParentThread:s,level:i,accWeight:c,openAll:o,parentLink:d}){const[r,l]=Wt(),h=g=>g.reduce((k,w)=>{const{repliesCount:I,replies:A}=w,L=(A==null?void 0:A.length)||I;return k+L+h(A||[])},0),p=e.length+h(e),a=e.length===p,f=e.map(g=>g.account).filter((g,k,w)=>w.findIndex(I=>I.id===g.id)===k).slice(0,3),u=gt(()=>e==null?void 0:e.reduce((g,k)=>g+(k==null?void 0:k.weight),c),[c,e==null?void 0:e.length]);let b=!1;(o||u<=sc||!s&&p===1&&pe(e[0])<2)&&(b=!0);const y=je[e[0].id],S=qt((g,k,w,I)=>{g.preventDefault(),g.stopPropagation(),l({media:k+1,mediaStatusID:I.id})},[]),m=P();return Jt(()=>{var k;function g(w){w.target.dataset.scrollLeft=w.target.scrollLeft}return(k=m.current)==null||k.addEventListener("scroll",g,{passive:!0}),()=>{var w;(w=m.current)==null||w.removeEventListener("scroll",g)}},[]),t("details",{ref:m,class:"replies",open:y||b,onToggle:g=>{const{open:k}=g.target;je[e[0].id]=k},style:{"--comments-level":i},"data-comments-level":i,"data-comments-level-overflow":i>4,children:[t("summary",{class:"replies-summary",hidden:b,children:[t("span",{class:"avatars",children:f.map(g=>t(re,{url:g.avatarStatic,title:`${g.displayName} @${g.username}`,squircle:g==null?void 0:g.bot},g.id))}),t("span",{class:"replies-counts",children:[t("b",{children:[t("span",{title:e.length,children:Ft(e.length)})," ","repl",e.length===1?"y":"ies"]}),!a&&p>1&&t(E,{children:[" ","·"," ",t("span",{children:[t("span",{title:p,children:Ft(p)})," ","comment",p===1?"":"s"]})]})]}),t(v,{icon:"chevron-down",class:"replies-summary-chevron"}),!!d&&t(Q,{class:"replies-parent-link",to:d.to,onClick:d.onClick,title:"View post with its replies",children:"»"})]}),t("ul",{children:e.map(g=>{var k,w;return t("li",{children:[t("div",{class:"status-focus",tabIndex:0,children:[t(Lt,{statusID:g.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:S,showActionsBar:!0}),!((k=g.replies)!=null&&k.length)&&g.repliesCount>0&&t("div",{class:"replies-link",children:[t(v,{icon:"comment2"})," ",t("span",{title:g.repliesCount,children:Ft(g.repliesCount)})]})]}),((w=g.replies)==null?void 0:w.length)&&t(pi,{instance:n,replies:g.replies,level:i+1,accWeight:b?u:g.weight,openAll:o,parentLink:{to:n?`/${n}/s/${g.id}`:`/s/${g.id}`,onClick:()=>{Ce(g.id)}}})]},g.id)})})]})}const rc=140,lc=35,dc=70,uc=140,Ge=new Map;function pe(e){var u,b;const n=Ge.get(e.id);if(n)return n;const{spoilerText:s,content:i,mediaAttachments:c,poll:o,card:d}=e,r=Hi(s+i),l=c!=null&&c.length?rc:0,h=(((u=o==null?void 0:o.options)==null?void 0:u.length)||0)*lc,p=d&&(c!=null&&c.length||(b=o==null?void 0:o.options)!=null&&b.length)?0:dc,f=(r+l+h+p)/uc;return Ge.set(e.id,f),f}const hc=Bt(oc);function fc(){const e=ie(),{id:n,instance:s}=e;return t(hc,{id:n,instance:s})}const pc=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,mc=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,gc=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,bc=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,yc=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,wc="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var vc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:fe,PHANPY_WEBSITE:$n,PHANPY_PRIVACY_POLICY_URL:Sc,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:Cn}=vc,xn=$n?$n.replace(/https?:\/\//g,"").replace(/\/$/,""):null,An=`${"2024-03-26T20:35:16.196Z".slice(0,10).replace(/-/g,".")}.e804e52`;function Rn(){return Mt(null,["/","/welcome"]),t("main",{id:"welcome",children:[t("div",{class:"hero-container",children:[t("div",{class:"hero-content",children:[t("h1",{children:[t("img",{src:fi,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),t("img",{src:wc,alt:"Phanpy",width:"200"})]}),t("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),t("p",{children:t(Q,{to:fe?`/login?instance=${fe}&submit=1`:"/login",class:"button",children:fe?"Log in":"Log in with Mastodon"})}),fe&&Cn&&t("p",{children:t("a",{href:Cn,class:"button plain5",children:"Sign up"})}),!fe&&t("p",{class:"insignificant",children:t("small",{children:["Connect your existing Mastodon/Fediverse account.",t("br",{}),"Your credentials are not stored on this server."]})})]}),(xn||An)&&t("p",{class:"app-site-version",children:t("small",{children:[xn," ",An]})}),t("p",{children:[t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:e=>{e.preventDefault(),C.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",t("a",{href:Sc,target:"_blank",children:"Privacy Policy"}),"."]})]}),t("div",{id:"why-container",children:t("div",{class:"sections",children:[t("section",{children:[t("img",{src:pc,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),t("h4",{children:"Boosts Carousel"}),t("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),t("section",{children:[t("img",{src:yc,alt:"Screenshot of nested comments thread",loading:"lazy"}),t("h4",{children:"Nested comments thread"}),t("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),t("section",{children:[t("img",{src:mc,alt:"Screenshot of grouped notifications",loading:"lazy"}),t("h4",{children:"Grouped notifications"}),t("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),t("section",{children:[t("img",{src:gc,alt:"Screenshot of multi-column UI",loading:"lazy"}),t("h4",{children:"Single or multi-column"}),t("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),t("section",{children:[t("img",{src:bc,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),t("h4",{children:"Multi-hashtag timeline"}),t("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const En=()=>{let e=setTimeout(()=>{if(!document.getElementById("columns")){const s=document.querySelectorAll("#modal-container > *");if(s!=null&&s.length){const d=s[s.length-1],r=d.querySelector('[tabindex="-1"]')||d;if(r){r.focus();return}}if(document.querySelector(".deck-backdrop"))return;const c=document.querySelectorAll(".deck-container"),o=c[c.length-1];o&&o.tabIndex===-1&&o.focus()}},100);return()=>clearTimeout(e)},kc=window.alert;window.__nativeAlert||(window.__nativeAlert=kc);window.alert=function(e){e instanceof Error&&(e!=null&&e.message)&&(e=e.message),typeof e!="string"&&(e=JSON.stringify(e));const n=Ni({text:e,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};const Ic=Bn(()=>Nn(()=>import("./catchup-2sBjDPIQ.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),Tc=Bn(()=>Nn(()=>import("./modals-0VQDHbcv.js"),__vite__mapDeps([5,4,1,3,6]),import.meta.url));window.__STATES__=C;window.__STATES_STATS__=()=>{const e=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};e.forEach(c=>{n[c]=Object.keys(C[c]).length});const{statuses:s}=C,i=[];for(const c in s)document.querySelector(`[data-state-post-id~="${c}"], [data-state-post-ids~="${c}"]`)||i.push(c)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:e,unfurledLinks:n,notifications:s}=C;let i=0;const{instance:c}=V();for(const o in e){if(!window.__IDLE__)break;try{const d=document.querySelector(`[data-state-post-id~="${o}"], [data-state-post-ids~="${o}"]`),r=s.some(l=>{var h;return o===Gt((h=l.status)==null?void 0:h.id,c)});if(!d&&!r){delete C.statuses[o],delete C.statusQuotes[o];for(const l in n){const h=n[l];if(Gt(h.id,h.instance)===o){delete C.unfurledLinks[l];break}}i++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const e in be)queueMicrotask(()=>{var n,s,i,c;Array.isArray(be[e])?(s=(n=be[e])[0])==null||s.call(n):(c=(i=be)[e])==null||c.call(i)})},5e3);(()=>{window.__IDLE__=!0;const e=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},i=Fn(n,3e3),c=()=>{window.__IDLE__=!1,i()};e.forEach(o=>{window.addEventListener(o,c,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",o=>{!o.relatedTarget&&!o.toElement&&n()},{passive:!0})})();const $c=/iPad|iPhone|iPod/.test(navigator.userAgent);$c&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const e=ct.local.get("theme");let n;if(e){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const s=n.content,i=e==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=i||"",setTimeout(()=>{n.content=s},10)}}else{const s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${s}"]`),n){const i=n.dataset.content,c=n.dataset.contentTemp;n.content=c||"",setTimeout(()=>{n.content=i},10)}}}});{const e=ct.local.get("theme");if(e){document.documentElement.classList.add(`is-${e}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",e||"dark light");const s=document.querySelector('meta[data-theme-setting="manual"]');s&&(s.name="theme-color",s.content=e==="light"?s.dataset.themeLightColor:s.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(c=>{c.name=""})}const n=ct.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}Mi(C,e=>{var n;for(const[s,i,c,o]of e){if(i.join(".")==="settings.shortcutsViewMode"){const d=document.getElementById("app");d&&(d.dataset.shortcutsViewMode=(n=C.shortcuts)!=null&&n.length?c:"")}i.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",c)}});function Cc(){const[e,n]=R(!1),[s,i]=R("loading");G(()=>{const o=ct.local.get("instanceURL"),d=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(d){window.history.replaceState({},document.title,window.location.pathname||"/");const r=ct.session.get("clientID"),l=ct.session.get("clientSecret"),h=ct.session.get("vapidKey");(async()=>{i("loading");const{access_token:p}=await Jo({instanceURL:o,client_id:r,client_secret:l,code:d}),a=Si({instance:o,accessToken:p});await Promise.allSettled([nn(a,o),ki(a,o,p,h)]),sn(),on(a),n(!0),i("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const r=ae();if(r){ct.session.set("currentAccount",r.info.id);const{client:l}=V({account:r}),{instance:h}=l;sn(),on(l),i("loading"),(async()=>{try{await nn(l,h)}catch{}finally{n(!0),i("default")}})()}else i("default")}},[]);let c=Le();return C.currentLocation=c.pathname,G(En,[c,e]),/\/https?:/.test(c.pathname)?t(Ho,{}):t(E,{children:[t(xc,{isLoggedIn:e,loading:s==="loading"}),t(Ac,{isLoggedIn:e}),s==="default"&&t(Ye,{children:t(It,{path:"/:instance?/s/:id",element:t(fc,{})})}),e&&t(Yi,{}),e&&t(ys,{}),t(On,{children:t(Tc,{})}),e&&t(Ji,{}),t(Gi,{isLoggedIn:e}),s!=="loading"&&t(Xi,{onClose:En}),t(Wi,{})]})}function xc({isLoggedIn:e,loading:n}){const s=Le(),i=gt(()=>{const{pathname:c}=s;return!/^\/(login|welcome)/i.test(c)},[s]);return t(Ye,{location:i||s,children:[t(It,{path:"/",element:e?t(Oo,{}):n?t(St,{id:"loader-root"}):t(Rn,{})}),t(It,{path:"/login",element:t(tc,{})}),t(It,{path:"/welcome",element:t(Rn,{})})]})}function Ln(){return C.prevLocation||null}function Ac({isLoggedIn:e}){const n=Le(),s=P(Ln());return gt(()=>me("/:instance/s/:id",n.pathname)||me("/s/:id",n.pathname),[n.pathname,me])?s.current||(s.current=Ln()):s.current=null,t(Ye,{location:s.current||n,children:[e&&t(E,{children:[t(It,{path:"/notifications",element:t(ai,{})}),t(It,{path:"/mentions",element:t(si,{})}),t(It,{path:"/following",element:t(Je,{})}),t(It,{path:"/b",element:t(Qn,{})}),t(It,{path:"/f",element:t(ti,{})}),t(It,{path:"/l",children:[t(It,{index:!0,element:t(Vo,{})}),t(It,{path:":id",element:t(ii,{})})]}),t(It,{path:"/fh",element:t(co,{})}),t(It,{path:"/ft",element:t(so,{})}),t(It,{path:"/catchup",element:t(On,{children:t(Ic,{})})})]}),t(It,{path:"/:instance?/t/:hashtag",element:t(ni,{})}),t(It,{path:"/:instance?/a/:id",element:t(Zs,{})}),t(It,{path:"/:instance?/p",children:[t(It,{index:!0,element:t(Ve,{})}),t(It,{path:"l",element:t(Ve,{local:!0})})]}),t(It,{path:"/:instance?/trending",element:t(ui,{})}),t(It,{path:"/:instance?/search",element:t(ri,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(e=>{const n=new AbortController;return setTimeout(()=>n.abort(),e),n.signal}));Di(t(Pi,{children:t(Cc,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("iconify")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("iconify")&&sessionStorage.removeItem(e)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};export{Ts as A,nc as M,ue as N,_c as S,Us as a,Nc as b,Pc as c,En as d,Xn as f,Xe as i,fi as l,di as o,li as r,Mc as u};
//# sourceMappingURL=main-FpkV7_zf.js.map
