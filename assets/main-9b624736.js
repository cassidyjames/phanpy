import{a as q,s as v,b as kt,u as dn,o as qn,I as w,M as pt,c as X,A as Vt,N as Ne,d as Nt,L as G,g as Qt,e as un,l as Hn,t as He,R as _e,f as Vn,h as _t,i as hn,j as xe,E as fn,k as Et,m as jn,n as Ot,p as Gn,q as it,r as gt,v as Ve,T as pn,w as te,x as mn,y as je,z as Wn,B as Ct,C as Kn,S as wt,D as Jn,F as Yn,G as gn,H as bn,J as Pe,K as St,O as yn,P as Xn,Q as Zn,U as Qn,V as re,W as ts,X as Ge,Y as es,Z as We,_ as Ke}from"./useTitle-37d18384.js";import{_,p as z,x as Gt,h as T,u as vt,o as t,a as ot,k as x,s as ve,M as Wt,b as Z,c as Dt,m as be,F as ut,T as jt,S as ns,I as se,y as Pt,g as ss,l as Je,d as is,e as wn,f as Ue,i as os,j as Ut,A as cs,n as as,J as ls,C as vn,q as kn,r as Sn,t as Kt,v as rs,w as ds,z as ne,B as us,D as Ye,E as hs,G as fs,R as Ie,H as ft,K as ps,L as ms}from"./vendor-6f584d39.js";function ye(e=()=>{},n=[]){const d=_(e);z(()=>{d.current=e},[n]),z(()=>{const o=()=>{const i=document.hidden||document.visibilityState==="hidden";d.current(!i)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[])}const gs=Gt(function({isLoggedIn:n}){const[d,o]=T(!0);ye(o),z(()=>{let r;if(n&&d){const{masto:c,streaming:m,instance:l}=q();(async()=>{var u;if(v.notificationsLast){const f=c.v1.notifications.list({limit:1,since_id:v.notificationsLast.id}),{value:p}=await f.next();if(p!=null&&p.length){let a;try{const h=await c.v1.markers.fetch({timeline:"notifications"});a=(u=h==null?void 0:h.notifications)==null?void 0:u.lastReadId}catch{}a?p[0].id!==a&&(v.notificationsShowNew=!0):v.notificationsShowNew=!0}}if(m){r=m.user.notification.subscribe();for await(const f of r){if(!r)break;f.event==="notification"&&kt(f.payload,l,{skipThreading:!0}),v.notificationsShowNew=!0}}})()}return()=>{var c;(c=r==null?void 0:r.unsubscribe)==null||c.call(r),r=null}},[d,n]);const i=_(),s=()=>{i.current=Date.now(),fetch("./version.json").then(r=>r.json()).then(r=>{r&&(v.appVersion=r)}).catch(r=>{})};return dn(s,d&&1e3*60*30),ye(r=>{r&&(i.current?Date.now()-i.current>1e3*60*60&&s():s())}),null});function bs(){function e(n){n.shiftKey?qn()||(alert("Looks like your browser is blocking popups."),v.showCompose=!0):v.showCompose=!0}return vt("c, shift+c",e,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),t("button",{type:"button",id:"compose-button",onClick:e,children:t(w,{icon:"quill",size:"xl",alt:"Compose"})})}const ys=Gt(function(){const n=ot(v);function d(){v.showKeyboardShortcutsHelp=!1}vt("?, shift+?",i=>{v.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")});const o=vt("esc",d,[]);return!!n.showKeyboardShortcutsHelp&&t(pt,{class:"light",onClick:i=>{i.target===i.currentTarget&&d()},children:t("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:o,children:[t("button",{type:"button",class:"sheet-close",onClick:d,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Keyboard shortcuts"})}),t("main",{children:t("table",{children:[{action:"Keyboard shortcuts help",keys:t("kbd",{children:"?"})},{action:"Next post",keys:t("kbd",{children:"j"})},{action:"Previous post",keys:t("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:t(x,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:t(x,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"k"})]})},{action:"Open post details",keys:t(x,{children:[t("kbd",{children:"Enter"})," or ",t("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:t("kbd",{children:"x"})},{action:"Close post or dialogs",keys:t(x,{children:[t("kbd",{children:"Esc"})," or ",t("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:t(x,{children:[t("kbd",{children:"1"})," to ",t("kbd",{children:"9"})]})},{action:"Compose new post",keys:t("kbd",{children:"c"})},{action:"Send post",keys:t(x,{children:[t("kbd",{children:"Ctrl"})," + ",t("kbd",{children:"Enter"})," or ",t("kbd",{children:"⌘"})," +"," ",t("kbd",{children:"Enter"})]})},{action:"Search",keys:t("kbd",{children:"/"})},{action:"Reply",keys:t("kbd",{children:"r"})},{action:"Favourite",keys:t("kbd",{children:"f"})},{action:"Boost",keys:t(x,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"b"})]})},{action:"Bookmark",keys:t("kbd",{children:"d"})}].map(({action:i,keys:s})=>t("tr",{children:[t("th",{children:i}),t("td",{children:s})]},i))})})]})})});function ws({onClose:e}){const{masto:n}=q(),d=X.local.getJSON("accounts"),o=X.session.get("currentAccount"),i=d.length>1,[s,r]=T(0),[c,m]=ve(l=>l+1,0);return t("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:t("h2",{children:"Accounts"})}),t("main",{children:t("section",{children:[t("ul",{class:"accounts-list",children:d.map((l,u)=>{const f=l.info.id===o,p=u===(s||0);return t("li",{children:[t("div",{children:[i&&t("span",{class:`current ${f?"is-current":""}`,children:t(w,{icon:"check-circle",alt:"Current"})}),t(Vt,{url:l.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const a=await n.v1.accounts.$select(l.info.id).fetch();l.info=a,X.local.setJSON("accounts",d),m()}catch{}}}),t(Ne,{account:i?{...l.info,acct:/@/.test(l.info.acct)?l.info.acct:`${l.info.acct}@${l.instanceURL}`}:l.info,showAcct:!0,onClick:()=>{f?v.showAccount=`${l.info.username}@${l.instanceURL}`:(X.session.set("currentAccount",l.info.id),location.reload())}})]}),t("div",{class:"actions",children:[p&&i&&t(x,{children:[t("span",{class:"tag",children:"Default"})," "]}),t(Wt,{align:"end",menuButton:t("button",{type:"button",title:"More",class:"plain more-button",children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[t(Z,{onClick:()=>{v.showAccount=`${l.info.username}@${l.instanceURL}`},children:[t(w,{icon:"user"}),t("span",{children:"View profile…"})]}),t(Dt,{}),i&&t(Z,{disabled:p,onClick:()=>{d.splice(u,1),d.unshift(l),X.local.setJSON("accounts",d),r(u)},children:[t(w,{icon:"check-circle"}),t("span",{children:"Set as default"})]}),t(Nt,{subMenu:!0,confirmLabel:t(x,{children:[t(w,{icon:"exit"}),t("span",{children:["Log out @",l.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{d.splice(u,1),X.local.setJSON("accounts",d),location.href=location.pathname||"/"},children:[t(w,{icon:"exit"}),t("span",{children:"Log out…"})]})]})]})]},u+l.id)})}),t("p",{children:t(G,{to:"/login",class:"button plain2",onClick:e,children:[t(w,{icon:"plus"})," ",t("span",{children:"Add an existing account"})]})}),i&&t("p",{children:t("small",{children:["Note: ",t("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const In=""+new URL("logo-f0531a6b.svg",import.meta.url).href;function Xe(e){const{masto:n}=q();return n.v1.push.subscription.create(e)}function vs(){const{masto:e}=q();return e.v1.push.subscription.fetch()}function ks(e){const{masto:n}=q();return n.v1.push.subscription.update(e)}function Ss(){const{masto:e}=q();return e.v1.push.subscription.remove()}function ke(){return"serviceWorker"in navigator&&"PushManager"in window}function Cn(){return navigator.serviceWorker.getRegistration()}async function Fe(){const e=await Cn(),n=e?await e.pushManager.getSubscription():void 0;return{registration:e,subscription:n}}function Tn(e){const n="=".repeat((4-e.length%4)%4),d=`${e}${n}`.replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(d),i=new Uint8Array(o.length);for(let s=0;s<o.length;++s)i[s]=o.charCodeAt(s);return i}async function Is(){if(!ke())return;const{subscription:e}=await Fe();let n=null;try{n=await vs()}catch(d){if(!/(not found|unknown)/i.test(d.message))throw d}if(n&&e){const d=n.endpoint===e.endpoint,{vapidKey:o}=Qt(),i=n.serverKey===o;if(!d)throw new Error("Backend subscription endpoint changed");if(!i)throw new Error("Backend subscription key and vapid key changed")}if(e&&!n){const{vapidKey:d}=Qt(),{applicationServerKey:o}=e.options,i=Tn(d).toString(),s=new Uint8Array(o).toString();if(!(i===s))throw await e.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:e,backendSubscription:n}}async function Ze({data:e,policy:n}){if(!ke())return;let{registration:d,subscription:o}=await Fe(),i=null;if(o)try{i=await ks({data:e,policy:n})}catch{i=await Xe({subscription:o,data:e,policy:n})}else{const{vapidKey:s}=Qt();if(!s)throw new Error("No server key found");o=await d.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Tn(s)}),i=await Xe({subscription:o,data:e,policy:n})}return{subscription:o,backendSubscription:i}}async function Qe(){if(!ke())return;const{subscription:e}=await Fe();e&&(await Ss(),await e.unsubscribe())}const tn=16,Ht=[16,17,18,19,20];function Cs({onClose:e}){const n=ot(v),d=X.local.get("theme")||"auto",o=_(),i=n.settings.contentTranslationTargetLanguage||null,s=un(),r=Hn(s),c=X.local.get("textSize")||tn,[m,l]=T(X.account.get("preferences")||{}),{masto:u,authenticated:f,instance:p}=q();return t("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Settings"})}),t("main",{children:[t("section",{children:t("ul",{children:[t("li",{children:[t("div",{children:t("label",{children:"Appearance"})}),t("div",{children:t("form",{ref:o,onInput:a=>{a.preventDefault();const g=new FormData(o.current).get("theme"),y=document.documentElement;g==="auto"?y.classList.remove("is-light","is-dark"):(y.classList.toggle("is-light",g==="light"),y.classList.toggle("is-dark",g==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",g==="auto"?"dark light":g),g==="auto"?X.local.del("theme"):X.local.set("theme",g)},children:t("div",{class:"radio-group",children:[t("label",{children:[t("input",{type:"radio",name:"theme",value:"light",defaultChecked:d==="light"}),t("span",{children:"Light"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"dark",defaultChecked:d==="dark"}),t("span",{children:"Dark"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"auto",defaultChecked:d!=="light"&&d!=="dark"}),t("span",{children:"Auto"})]})]})})})]}),t("li",{children:[t("div",{children:t("label",{children:"Text size"})}),t("div",{class:"range-group",children:[t("span",{style:{fontSize:Ht[0]},children:"A"})," ",t("input",{type:"range",min:Ht[0],max:Ht[Ht.length-1],step:"1",value:c,list:"sizes",onChange:a=>{const h=parseInt(a.target.value,10);document.documentElement.style.setProperty("--text-size",`${h}px`),h===tn?X.local.del("textSize"):X.local.set("textSize",a.target.value)}})," ",t("span",{style:{fontSize:Ht[Ht.length-1]},children:"A"}),t("datalist",{id:"sizes",children:Ht.map(a=>t("option",{value:a}))})]})]})]})}),f&&t(x,{children:[t("h3",{children:"Posting"}),t("section",{children:t("ul",{children:t("li",{children:[t("div",{children:t("label",{for:"posting-privacy-field",children:["Default visibility"," ",t(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),t("div",{children:t("select",{id:"posting-privacy-field",value:m["posting:default:visibility"]||"public",onChange:a=>{const{value:h}=a.target;(async()=>{try{await u.v1.accounts.updateCredentials({source:{privacy:h}}),l({...m,"posting:default:visibility":h}),X.account.set("preferences",{...m,"posting:default:visibility":h})}catch{alert("Failed to update posting privacy")}})()},children:[t("option",{value:"public",children:"Public"}),t("option",{value:"unlisted",children:"Unlisted"}),t("option",{value:"private",children:"Followers only"})]})})]})})}),t("p",{class:"section-postnote",children:[t(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",t("small",{children:["Synced to your instance server's settings."," ",t("a",{href:`https://${p}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",p,") for more settings."]})]})]})]}),t("h3",{children:"Experiments"}),t("section",{children:t("ul",{children:[t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:a=>{v.settings.autoRefresh=a.target.checked}})," ","Auto refresh timeline posts"]})}),t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:a=>{v.settings.boostsCarousel=a.target.checked}})," ","Boosts carousel"]})}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:a=>{const{checked:h}=a.target;v.settings.contentTranslation=h,h||(v.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),t("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[t("div",{children:t("label",{children:["Translate to"," ",t("select",{value:i||"",disabled:!n.settings.contentTranslation,onChange:a=>{v.settings.contentTranslationTargetLanguage=a.target.value||null},children:[t("option",{value:"",children:["System language (",r,")"]}),t("option",{disabled:!0,children:"──────────"}),He.map(a=>t("option",{value:a.code,children:a.name}))]})]})}),t("hr",{}),t("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&t(x,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",t("div",{class:"checkbox-fields",children:He.map(a=>t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(a.code),onChange:h=>{const{checked:g}=h.target;g?v.settings.contentTranslationHideLanguages.push(a.code):v.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(y=>y!==a.code)}})," ",a.name]}))})]}),t("p",{class:"insignificant",children:t("small",{children:["Note: This feature uses an external API to translate, powered by"," ",t("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),t("hr",{}),t("div",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:a=>{v.settings.contentTranslationAutoInline=a.target.checked}})," ","Auto inline translation"]}),t("p",{class:"insignificant",children:t("small",{children:["Automatically show translation for posts in timeline. Only works for ",t("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:a=>{v.settings.cloakMode=a.target.checked}})," ","Cloak mode"," ",t("span",{class:"insignificant",children:["(",t("samp",{children:"Text"})," → ",t("samp",{children:"████"}),")"]})]}),t("div",{class:"sub-section insignificant",children:t("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),f&&t("li",{children:t("button",{type:"button",class:"light",onClick:()=>{v.showDrafts=!0,v.showSettings=!1},children:"Unsent drafts"})})]})}),f&&t(Ts,{onClose:e}),t("h3",{children:"About"}),t("section",{children:[t("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[t("img",{src:In,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),t("div",{children:[t("b",{children:"Phanpy"})," ",t("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),v.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),t("br",{}),t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),t("p",{children:[t("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",t("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),t("p",{children:[t("span",{class:"insignificant",children:"Last build:"})," ",t(_e,{datetime:new Date("2023-10-13T17:30:10.695Z")})," ",t(x,{children:["(",t("a",{href:"https://github.com/cheeaun/phanpy/commit/b9557b5",target:"_blank",rel:"noopener noreferrer",children:t("code",{children:"b9557b5"})}),")"]})]})]})]})]})}function Ts({onClose:e}){if(!ke())return null;const{instance:n}=q(),[d,o]=T("default"),i=_(),[s,r]=T(!1),[c,m]=T(!1),l=_();z(()=>{(async()=>{o("loading");try{const{subscription:f,backendSubscription:p}=await Is();if(p!=null&&p.policy&&p.policy!=="none"){r(!0);const{alerts:a,policy:h}=p;l.current=h;const{elements:g}=i.current,y=g.namedItem(h);y&&(y.value=h),Object.keys(a).forEach(b=>{const k=g.namedItem(b);(k==null?void 0:k.type)==="checkbox"&&(k.checked=!0)})}o("default")}catch(f){/outside.*authorized/i.test(f.message)?m(!0):alert((f==null?void 0:f.message)||f),o("error")}})()},[]);const u=d==="loading";return t("form",{ref:i,onChange:()=>{const f=Object.fromEntries(new FormData(i.current)),p=!!f["policy-allow"],a={policy:f.policy,data:{alerts:{mention:!!f.mention,favourite:!!f.favourite,reblog:!!f.reblog,follow:!!f.follow,follow_request:!!f.followRequest,poll:!!f.poll,update:!!f.update,status:!!f.status}}};let h=0;Object.keys(a.data.alerts).forEach(y=>{a.data.alerts[y]?h++:delete a.data.alerts[y]});const g=l.current!==a.policy;p&&h>0?g?Qe().then(()=>{Ze(a)}).catch(y=>{alert("Failed to update subscription. Please try again.")}):Ze(a).catch(y=>{alert("Failed to update subscription. Please try again.")}):Qe().catch(y=>{alert("Failed to remove subscription. Please try again.")})},children:[t("h3",{children:"Push Notifications (beta)"}),t("section",{children:t("ul",{children:t("li",{children:[t("label",{children:[t("input",{type:"checkbox",disabled:u||c,name:"policy-allow",checked:s,onChange:async f=>{const{checked:p}=f.target;if(p){const a=await Notification.requestPermission();a==="granted"?r(!0):(r(!1),a==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else r(!1)}})," ","Allow from"," ",t("select",{name:"policy",disabled:u||c||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(f=>t("option",{value:f.value,children:f.label}))})]}),t("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:t("div",{class:"shazam-container-inner",children:t("div",{class:"sub-section",children:t("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Favourites"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(f=>t("li",{children:t("label",{children:[t("input",{type:"checkbox",name:f.value})," ",f.label]})}))})})})}),c&&t("div",{class:"sub-section",children:t("p",{children:["Push permission was not granted since your last login. You'll need to"," ",t(G,{to:`/login?instance=${n}`,onClick:e,children:[t("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),t("p",{class:"section-postnote",children:t("small",{children:["NOTE: Push notifications only work for ",t("b",{children:"one account"}),"."]})})]})}const $e=()=>{let e=setTimeout(()=>{if(!document.getElementById("columns")){const d=document.querySelectorAll("#modal-container > *");if(d!=null&&d.length){const r=d[d.length-1],c=r.querySelector('[tabindex="-1"]')||r;if(c){c.focus();return}}if(document.querySelector(".deck-backdrop"))return;const i=document.querySelectorAll(".deck-container"),s=i[i.length-1];s&&s.tabIndex===-1&&s.focus()}},100);return()=>clearTimeout(e)};function ze({list:e,onClose:n}){const{masto:d}=q(),[o,i]=T("default"),s=!!e,r=_(),c=_(),m=_();z(()=>{s&&(r.current.value=e.title,c.current.value=e.repliesPolicy,m.current&&(m.current.checked=e.exclusive))},[s]);const l=Vn("@mastodon/list-exclusive");return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})})," ",t("header",{children:t("h2",{children:s?"Edit list":"New list"})}),t("main",{children:t("form",{class:"list-form",onSubmit:u=>{u.preventDefault();const f=new FormData(u.target),p=f.get("title"),a=f.get("replies_policy"),h=f.get("exclusive")==="on";i("loading"),(async()=>{try{let g;s?g=await d.v1.lists.$select(e.id).update({title:p,replies_policy:a,exclusive:h}):g=await d.v1.lists.create({title:p,replies_policy:a,exclusive:h}),i("default"),n==null||n({state:"success",list:g})}catch{i("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[t("div",{class:"list-form-row",children:t("label",{for:"list-title",children:["Name"," ",t("input",{ref:r,type:"text",id:"list-title",name:"title",required:!0,disabled:o==="loading",dir:"auto"})]})}),t("div",{class:"list-form-row",children:t("select",{ref:c,name:"replies_policy",required:!0,disabled:o==="loading",children:[t("option",{value:"list",children:"Show replies to list members"}),t("option",{value:"followed",children:"Show replies to people I follow"}),t("option",{value:"none",children:"Don't show replies"})]})}),l&&t("div",{class:"list-form-row",children:t("label",{class:"label-block",children:[t("input",{ref:m,type:"checkbox",name:"exclusive",disabled:o==="loading"})," ","Hide posts on this list from Home/Following"]})}),t("div",{class:"list-form-footer",children:[t("button",{type:"submit",disabled:o==="loading",children:s?"Save":"Create"}),s&&t(Nt,{disabled:o==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{i("loading"),(async()=>{try{await d.v1.lists.$select(e.id).remove(),i("default"),n==null||n({state:"deleted"})}catch{i("error"),alert("Unable to delete list.")}})()},children:t("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete…"})})]})]})})]})}const xs=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],en={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},nn=80,xn=1e3*60*10;function $s(e,n){return n.v1.accounts.familiarFollowers.fetch({id:[e]})}const Ls=be($s,{maxAge:xn});async function Rs(e,n){const d=n.v1.accounts.$select(e).statuses.list({limit:20}).next(),{value:o}=await d,i={total:o.length,originals:0,replies:0,boosts:0};return o.forEach(s=>{s.reblog?i.boosts++:s.inReplyToId&&s.inReplyToAccountId!==s.account.id?i.replies++:i.originals++}),o.length&&(i.daysSinceLastPost=Math.ceil((Date.now()-new Date(o[o.length-1].createdAt))/864e5)),i}const As=be(Rs,{maxAge:xn});function $n({account:e,fetchAccount:n=()=>{},standalone:d,instance:o,authenticated:i}){const{masto:s}=q({instance:o}),{masto:r}=q(),[c,m]=T("default"),l=typeof e=="string",[u,f]=T(l?null:e),p=ut(()=>e.id===X.session.get("currentAccount"),[e==null?void 0:e.id]),a=ut(()=>o===q().instance,[o]);z(()=>{if(!l){f(e);return}m("loading"),(async()=>{try{const F=await n();v.accounts[`${F.id}@${o}`]=F,f(F),m("default")}catch{f(null),m("error")}})()},[l,e,n]);const{acct:h,avatar:g,avatarStatic:y,bot:b,createdAt:k,displayName:S,emojis:I,fields:$,followersCount:U,followingCount:L,group:R,id:j,lastStatusAt:A,locked:M,note:N,statusesCount:nt,url:J,username:Tt,memorial:yt,moved:Q,roles:Rt}=u||{};let xt=!1,{header:D,headerStatic:Y}=u||{};(!D||/missing\.png$/.test(D))&&g&&!/missing\.png$/.test(g)&&(D=g,xt=!0,y&&!/missing\.png$/.test(y)&&(Y=y));const et=ut(()=>J?new URL(J).hostname:null,[J]),[mt,$t]=T([]),At=_(),V=_([]);async function tt(F){(F||!At.current)&&(At.current=s.v1.accounts.$select(j).followers.list({limit:nn}));const at=await At.current.next();if(p||!a)return at;const{value:bt}=at;let st=[];if(F){const zt=await s.v1.accounts.familiarFollowers(j).fetch();V.current=zt[0].accounts,st=[...V.current,...bt.filter(Bt=>!V.current.some(O=>O.id===Bt.id))]}else bt!=null&&bt.length&&(st=bt.filter(zt=>!V.current.some(Bt=>Bt.id===zt.id)));return{...at,value:st}}const P=_();async function W(F){return(F||!P.current)&&(P.current=s.v1.accounts.$select(j).following.list({limit:nn})),await P.current.next()}const C=d?"div":G,E=o?`/${o}/a/${j}`:`/a/${j}`,[B,K]=T([]),[H,Lt]=T(),[ht,lt]=T("default"),dt=!!(H!=null&&H.total),ct=async F=>{try{const at=await Ls(F,r);K(at[0].accounts.slice(0,Ms))}catch{}},It=async()=>{if(j){lt("loading");try{const F=await As(j,s);Lt(F),lt("default")}catch{lt("error")}}},Mt=jt(({relationship:F,currentID:at})=>{F.following||(ct(at),d||It())},[d]);return t("div",{class:`account-container  ${c==="loading"?"skeleton":""}`,style:{"--header-color-1":mt[0],"--header-color-2":mt[1],"--header-color-3":mt[2],"--header-color-4":mt[3]},children:[c==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to load account."}),t("p",{children:t("a",{href:l?e:J,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",t(w,{icon:"external"})]})})]}),c==="loading"?t(x,{children:[t("header",{children:t(_t,{avatarSize:"xxxl",skeleton:!0})}),t("main",{children:[t("div",{class:"note",children:[t("p",{children:"████████ ███████"}),t("p",{children:"███████████████ ███████████████"})]}),t("p",{class:"stats",children:[t("div",{children:[t("span",{children:"██"})," Followers"]}),t("div",{children:[t("span",{children:"██"})," Following"]}),t("div",{children:[t("span",{children:"██"})," Posts"]}),t("div",{children:"Joined ██"})]})]})]}):u&&t(x,{children:[!!Q&&t("div",{class:"account-moved",children:[t("p",{children:[t("b",{children:S})," has indicated that their new account is now:"]}),t(_t,{account:Q,instance:o,onClick:F=>{F.stopPropagation(),v.showAccount=Q}})]}),D&&!/missing\.png$/.test(D)&&t("img",{src:D,alt:"",class:`header-banner ${xt?"header-is-avatar":""}`,onError:F=>{F.target.crossOrigin?F.target.src!==Y?F.target.src=Y:(F.target.removeAttribute("crossorigin"),F.target.src=D):F.target.src!==Y?F.target.src=Y:F.target.remove()},crossOrigin:"anonymous",onLoad:F=>{F.target.classList.add("loaded");try{const at=document.createElement("canvas"),bt=at.getContext("2d",{willReadFrequently:!0});at.width=F.target.width,at.height=F.target.height,bt.drawImage(F.target,0,0);const st=10,Bt=[bt.getImageData(0,0,st,st).data,bt.getImageData(F.target.width-st,0,st,st).data,bt.getImageData(0,F.target.height-st,st,st).data,bt.getImageData(F.target.width-st,F.target.height-st,st,st).data].map(O=>{let rt=0,Jt=0,ce=0,ae=0;for(let Yt=0;Yt<O.length;Yt+=4)rt+=O[Yt],Jt+=O[Yt+1],ce+=O[Yt+2],ae+=O[Yt+3];const le=O.length/4;return[rt/le,Jt/le,ce/le,ae/le]}).map(O=>{const[rt,Jt,ce,ae]=Es(O);return`rgba(${rt}, ${Jt}, ${ce}, ${ae})`});$t(Bt)}catch{}}}),t("header",{children:t(_t,{account:u,instance:o,avatarSize:"xxxl",external:d,internal:!d})}),t("main",{tabIndex:"-1",children:[!!yt&&t("span",{class:"tag",children:"In Memoriam"}),!!b&&t("span",{class:"tag",children:[t(w,{icon:"bot"})," Automated"]}),!!R&&t("span",{class:"tag",children:[t(w,{icon:"group"})," Group"]}),Rt==null?void 0:Rt.map(F=>t("span",{class:"tag",children:[F.name,!!et&&t(x,{children:[" ",t("span",{class:"more-insignificant",children:et})]})]})),t("div",{class:"note",dir:"auto",onClick:hn({instance:o}),dangerouslySetInnerHTML:{__html:xe(N,{emojis:I})}}),t("div",{class:"account-metadata-box",children:[($==null?void 0:$.length)>0&&t("div",{class:"profile-metadata",children:$.map(({name:F,value:at,verifiedAt:bt},st)=>t("div",{class:`profile-field ${bt?"profile-verified":""}`,dir:"auto",children:[t("b",{children:[t(fn,{text:F,emojis:I})," ",!!bt&&t(w,{icon:"check-circle",size:"s"})]}),t("p",{dangerouslySetInnerHTML:{__html:xe(at,{emojis:I})}})]},F+st))}),t("div",{class:"stats",children:[t(C,{tabIndex:0,to:E,onClick:()=>{v.showAccount=!1,v.showGenericAccounts={heading:"Followers",fetchAccounts:tt}},children:[!!B.length&&t("span",{class:"shazam-container-horizontal",children:t("span",{class:"shazam-container-inner stats-avatars-bunch",children:B.map(F=>t(Vt,{url:F.avatarStatic,size:"s",alt:`${F.displayName} @${F.acct}`,squircle:F==null?void 0:F.bot}))})}),t("span",{title:U,children:Et(U)})," ","Followers"]}),t(C,{class:"insignificant",tabIndex:0,to:E,onClick:()=>{v.showAccount=!1,v.showGenericAccounts={heading:"Following",fetchAccounts:W}},children:[t("span",{title:L,children:Et(L)})," ","Following",t("br",{})]}),t(C,{class:"insignificant",to:E,onClick:d?void 0:()=>{jn()},children:[t("span",{title:nt,children:Et(nt)})," ","Posts"]}),!!k&&t("div",{class:"insignificant",children:["Joined"," ",t("time",{datetime:k,children:Ot(k,{hideTime:!0})})]})]})]}),!!H&&t(C,{to:E,class:"account-metadata-box",onClick:()=>{v.showAccount=!1},children:t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:dt?t("div",{class:"posting-stats",title:`${Math.round(H.originals/H.total*100)}% original posts, ${Math.round(H.replies/H.total*100)}% replies, ${Math.round(H.boosts/H.total*100)}% boosts`,children:[t("div",{children:H.daysSinceLastPost<365?`Last ${H.total} posts in the past 
                      ${H.daysSinceLastPost} day${H.daysSinceLastPost>1?"s":""}`:`
                      Last ${H.total} posts in the past year(s)
                      `}),t("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${H.originals/H.total*100}%`,"--replies-percentage":`${(H.originals+H.replies)/H.total*100}%`}}),t("div",{class:"posting-stats-legends",children:[t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):t("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),t("div",{class:"account-metadata-box",children:t("div",{class:"shazam-container no-animation",hidden:!!H,children:t("div",{class:"shazam-container-inner",children:t("button",{type:"button",class:"posting-stats-button",disabled:ht==="loading",onClick:()=>{It()},children:[t("div",{class:`posting-stats-bar posting-stats-icon ${ht==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})}),t(Ds,{info:u,instance:o,authenticated:i,onRelationshipChange:Mt})]})]})]})}const Ms=3;function Ds({info:e,instance:n,authenticated:d,onRelationshipChange:o=()=>{}}){var tt;if(!e)return null;const{masto:i,instance:s,authenticated:r}=q(),c=n===s,[m,l]=T("default"),[u,f]=T(null),{id:p,acct:a,url:h,username:g,locked:y,lastStatusAt:b,note:k,fields:S,moved:I}=e,$=_(p),{following:U,showingReblogs:L,notifying:R,followedBy:j,blocking:A,blockedBy:M,muting:N,mutingNotifications:nt,requested:J,domainBlocking:Tt,endorsed:yt}=u||{},[Q,Rt]=T(null),[xt,D]=T(!1);z(()=>{if(e){const P=X.session.get("currentAccount");let W;(async()=>{if(c&&d)W=p;else if(!c&&r){const E=e.acct.includes("@");try{const B=await i.v2.search.fetch({q:E?e.acct:`${e.username}@${n}`,type:"accounts",limit:1,resolve:!0});B.accounts.length&&(W=B.accounts[0].id,Rt(B.accounts[0]))}catch{}}if(!W)return;if(P===W){D(!0);return}if($.current=W,I)return;l("loading");const C=i.v1.accounts.relationships.fetch({id:[W]});try{const E=await C;if(l("default"),E.length){const B=E[0];f(B),o({relationship:B,currentID:W})}}catch{l("error")}})()}},[e,d]),z(()=>{e&&xt&&Gn(e)},[e,xt]);const Y=m==="loading",et=_(null),[mt,$t]=T(!1),[At,V]=T(!1);return t(x,{children:[t("div",{class:"actions",children:[t("span",{children:[j?t("span",{class:"tag",children:"Following you"}):b?t("small",{class:"insignificant",children:["Last post:"," ",Ot(b,{hideTime:!0})]}):t("span",{}),N&&t("span",{class:"tag danger",children:"Muted"}),A&&t("span",{class:"tag danger",children:"Blocked"})]})," ",t("span",{class:"buttons",children:[t(Wt,{instanceRef:et,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:P=>{var W,C;P.target===P.currentTarget&&((C=(W=et.current)==null?void 0:W.closeMenu)==null||C.call(W))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:t("button",{type:"button",title:"More",class:"plain",disabled:Y,children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[r&&!xt&&t(x,{children:[t(Z,{onClick:()=>{v.showCompose={draftStatus:{status:`@${(Q==null?void 0:Q.acct)||a} `}}},children:[t(w,{icon:"at"}),t("span",{children:["Mention @",g]})]}),t(Z,{onClick:()=>{$t(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate bio"})]}),U&&t(Z,{onClick:()=>{V(!0)},children:[t(w,{icon:"list"}),t("span",{children:"Add/remove from Lists"})]}),t(Dt,{})]}),t(Z,{href:h,target:"_blank",children:[t(w,{icon:"external"}),t("small",{class:"menu-double-lines",children:Ns(h)})]}),t("div",{class:"menu-horizontal",children:[t(Z,{onClick:()=>{try{navigator.clipboard.writeText(h),it("Link copied")}catch{it("Unable to copy link")}},children:[t(w,{icon:"link"}),t("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((tt=navigator==null?void 0:navigator.canShare)==null?void 0:tt.call(navigator,{url:h}))&&t(Z,{onClick:()=>{try{navigator.share({url:h})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"}),t("span",{children:"Share…"})]})]}),!!u&&t(x,{children:[t(Dt,{}),N?t(Z,{onClick:()=>{l("loading"),(async()=>{try{const P=await i.v1.accounts.$select((Q==null?void 0:Q.id)||p).unmute();f(P),l("default"),it(`Unmuted @${g}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{l("error")}})()},children:[t(w,{icon:"unmute"}),t("span",{children:["Unmute @",g]})]}):t(ns,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:t(x,{children:[t(w,{icon:"mute"}),t("span",{class:"menu-grow",children:["Mute @",g,"…"]}),t("span",{style:{textOverflow:"clip"},children:[t(w,{icon:"time"}),t(w,{icon:"chevron-right"})]})]}),children:t("div",{class:"menu-wrap",children:xs.map(P=>t(Z,{onClick:()=>{l("loading"),(async()=>{try{const W=await i.v1.accounts.$select((Q==null?void 0:Q.id)||p).mute({duration:P});f(W),l("default"),it(`Muted @${g} for ${en[P]}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{l("error"),it(`Unable to mute @${g}`)}})()},children:en[P]}))})}),t(Nt,{subMenu:!0,confirm:!A,confirmLabel:t(x,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",g,"?"]})]}),menuItemClassName:"danger",onClick:()=>{l("loading"),(async()=>{try{if(A){const P=await i.v1.accounts.$select((Q==null?void 0:Q.id)||p).unblock();f(P),l("default"),it(`Unblocked @${g}`)}else{const P=await i.v1.accounts.$select((Q==null?void 0:Q.id)||p).block();f(P),l("default"),it(`Blocked @${g}`)}v.reloadGenericAccounts.id="block",v.reloadGenericAccounts.counter++}catch{l("error"),A?it(`Unable to unblock @${g}`):it(`Unable to block @${g}`)}})()},children:A?t(x,{children:[t(w,{icon:"unblock"}),t("span",{children:["Unblock @",g]})]}):t(x,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",g,"…"]})]})})]})]}),!u&&m==="loading"&&t(gt,{abrupt:!0}),!!u&&t(Nt,{confirm:U||J,confirmLabel:t("span",{children:J?"Withdraw follow request?":`Unfollow @${e.acct||e.username}?`}),menuItemClassName:"danger",align:"end",disabled:Y,onClick:()=>{l("loading"),(async()=>{try{let P;U||J?P=await i.v1.accounts.$select($.current).unfollow():P=await i.v1.accounts.$select($.current).follow(),P&&f(P),l("default")}catch(P){alert(P),l("error")}})()},children:t("button",{type:"button",class:`${U||J?"light swap":""}`,"data-swap-state":U||J?"danger":"",disabled:Y,children:U?t(x,{children:[t("span",{children:"Following"}),t("span",{children:"Unfollow…"})]}):J?t(x,{children:[t("span",{children:"Requested"}),t("span",{children:"Withdraw…"})]}):y?t(x,{children:[t(w,{icon:"lock"})," ",t("span",{children:"Follow"})]}):"Follow"})})]})]}),!!mt&&t(pt,{class:"light",onClose:()=>{$t(!1)},children:t(_s,{note:k,fields:S,onClose:()=>$t(!1)})}),!!At&&t(pt,{class:"light",onClose:()=>{V(!1)},children:t(Ps,{accountID:$.current,onClose:()=>V(!1)})})]})}function Es([e,n,d]){const o=.2126*e+.7152*n+.0722*d;let i;return o>=220?i=1:o<=50?i=.1:i=o/255,i=Math.min(1,i),[e,n,d,i]}function Ns(e){if(!e)return;const n=new URL(e),{host:d,pathname:o}=n,i=o.replace(/\/$/,"").replace(/^\//,"");return t(x,{children:[t("span",{class:"more-insignificant",children:[d,"/"]}),t("wbr",{}),t("span",{children:i})]})}function _s({note:e,fields:n,onClose:d}){const o=(n==null?void 0:n.map(({name:s,value:r})=>`${s}
${Ve(r)}`).join(`

`))||"",i=Ve(e)+(o?`

${o}`:"");return t("div",{class:"sheet",children:[!!d&&t("button",{type:"button",class:"sheet-close",onClick:d,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Translated Bio"})}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:i}),t(pn,{forceTranslate:!0,text:i})]})]})}function Ps({accountID:e,onClose:n}){const{masto:d}=q(),[o,i]=T("default"),[s,r]=T([]),[c,m]=T([]),[l,u]=ve(a=>a+1,0);z(()=>{i("loading"),(async()=>{try{const a=await d.v1.lists.list(),h=await d.v1.accounts.$select(e).lists.list();r(a),m(h),i("default")}catch{i("error")}})()},[l]);const[f,p]=T(!1);return t("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Add/Remove from Lists"})}),t("main",{children:[s.length>0?t("ul",{class:"list-add-remove",children:s.map(a=>{const h=c.some(g=>g.id===a.id);return t("li",{children:t("button",{type:"button",class:`light ${h?"checked":""}`,disabled:o==="loading",onClick:()=>{i("loading"),(async()=>{try{h?await d.v1.lists.$select(a.id).accounts.remove({accountIds:[e]}):await d.v1.lists.$select(a.id).accounts.create({accountIds:[e]}),u()}catch{i("error"),alert(h?"Unable to remove from list.":"Unable to add to list.")}})()},children:[t(w,{icon:"check-circle"}),t("span",{children:a.title})]})})})}):o==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):o==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists."}),t("button",{type:"button",class:"plain2",onClick:()=>p(!0),disabled:o!=="default",children:[t(w,{icon:"plus",size:"l"})," ",t("span",{children:"New list"})]})]}),f&&t(pt,{class:"light",onClick:a=>{a.target===a.currentTarget&&p(!1)},children:t(ze,{list:f==null?void 0:f.list,onClose:a=>{a.state==="success"&&u(),p(!1)}})})]})}function Us({account:e,instance:n,onClose:d}){const{masto:o,instance:i,authenticated:s}=q({instance:n}),r=typeof e=="string";return z(()=>{r||(v.accounts[`${e.id}@${i}`]=e)},[e]),t("div",{class:"sheet",onClick:c=>{c.target.closest(".account-block")&&d({destination:"account-statuses"})},children:[!!d&&t("button",{type:"button",class:"sheet-close outer",onClick:d,children:t(w,{icon:"x"})}),t($n,{instance:i,authenticated:s,account:e,fetchAccount:async()=>{if(r)try{return await o.v1.accounts.lookup({acct:e,skip_webfinger:!1})}catch{const m=await o.v2.search.fetch({q:e,type:"accounts",limit:1,resolve:s});if(m.accounts.length)return m.accounts[0];if(/https?:\/\/[^/]+\/@/.test(e)){const u=new URL(e).pathname.replace(/^\//,""),f=await o.v2.search.fetch({q:u,type:"accounts",limit:1,resolve:s});if(f.accounts.length)return f.accounts[0]}}else return e}})]})}function Fs({onClose:e}){const{masto:n}=q(),[d,o]=T("default"),[i,s]=T([]),[r,c]=ve(l=>l+1,0);z(()=>{o("loading"),(async()=>{try{const l=await te.drafts.keys();if(l.length){const u=mn(),f=l.filter(p=>p.startsWith(u));if(f.length){const p=await te.drafts.getMany(f);p.sort((a,h)=>new Date(h.updatedAt).getTime()-new Date(a.updatedAt).getTime()),s(p)}else s([])}else s([]);o("default")}catch{o("error")}})()},[r]);const m=(i==null?void 0:i.length)>0;return t("div",{class:"sheet",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:[t("h2",{children:["Unsent drafts ",t(gt,{abrupt:!0,hidden:d!=="loading"})]}),m&&t("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),t("main",{children:m?t(x,{children:[t("ul",{class:"drafts-list",children:i.map(l=>{const{updatedAt:u,key:f,draftStatus:p,replyTo:a}=l,h=new Date(u);return t("li",{children:[t("div",{class:"mini-draft-meta",children:[t("b",{children:[t(w,{icon:a?"reply":"quill",size:"s"})," ",t("time",{children:[!!a&&t(x,{children:["@",a.account.acct,t("br",{})]}),Ot(h)]})]}),t(Nt,{confirmLabel:t("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:d==="loading",onClick:()=>{(async()=>{try{await te.drafts.del(f),c()}catch{alert("Error deleting draft! Please try again.")}})()},children:t("button",{type:"button",class:"small light",disabled:d==="loading",children:"Delete…"})})]}),t("button",{type:"button",disabled:d==="loading",class:"draft-item",onClick:async()=>{let g;if(a){o("loading");try{g=await n.v1.statuses.$select(a.id).fetch()}catch{alert("Error fetching reply-to status!"),o("default");return}o("default")}window.__COMPOSE__={draftStatus:p,replyToStatus:g},v.showCompose=!0,v.showDrafts=!1},children:t(zs,{draft:l})})]},u)})}),i.length>1&&t("p",{children:t(Nt,{confirmLabel:t("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:d==="loading",onClick:()=>{(async()=>{o("loading");try{await te.drafts.delMany(i.map(l=>l.key)),o("default"),c()}catch{alert("Error deleting drafts! Please try again."),o("error")}})()},children:t("button",{type:"button",class:"light danger",disabled:d==="loading",children:"Delete all…"})})})]}):t("p",{children:"No drafts found."})})]})}function zs({draft:e}){var f;const{draftStatus:n,replyTo:d}=e,{status:o,spoilerText:i,poll:s,mediaAttachments:r}=n,c=((f=s==null?void 0:s.options)==null?void 0:f.length)>0,m=(r==null?void 0:r.length)>0,l=c||m,u=ut(()=>{if(!m)return;const p=r.find(g=>/image/.test(g.type));if(!p)return;const{file:a}=p;return URL.createObjectURL(a)},[m,r]);return t(x,{children:t("div",{class:"mini-draft",children:[l&&t("div",{class:`mini-draft-aside ${u?"has-image":""}`,style:u?{"--bg-image":`url(${u})`}:{},children:[c&&t(w,{icon:"poll"}),m&&t("span",{children:[t(w,{icon:"attachment"})," ",t("small",{children:r==null?void 0:r.length})]})]}),t("div",{class:"mini-draft-main",children:[!!i&&t("div",{class:"mini-draft-spoiler",children:i}),!!o&&t("div",{class:"mini-draft-status",children:o})]})]})})}function Bs({onClose:e=()=>{}}){const n=ot(v),[d,o]=T("default"),[i,s]=T([]),[r,c]=T(!1);if(!n.showGenericAccounts)return null;const{id:m,heading:l,fetchAccounts:u,accounts:f,showReactions:p}=n.showGenericAccounts,a=h=>{u&&(h&&s([]),o("loading"),(async()=>{try{const{done:g,value:y}=await u(h);Array.isArray(y)?(s(h?y:b=>[...b,...y]),c(!g)):c(!1),o("default")}catch{o("error")}})())};return z(()=>{(f==null?void 0:f.length)>0?s(f):a(!0)},[f,u]),z(()=>{var h;((h=n.reloadGenericAccounts)==null?void 0:h.id)===m&&a(!0)},[n.reloadGenericAccounts.counter]),t("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:l||"Accounts"})}),t("main",{children:i.length>0?t(x,{children:[t("ul",{class:"accounts-list",children:i.map(h=>{var g;return t("li",{children:[p&&((g=h._types)==null?void 0:g.length)>0&&t("div",{class:"reactions-block",children:h._types.map(y=>t(w,{icon:{reblog:"rocket",favourite:"heart"}[y],class:`${y}-icon`}))}),t(_t,{account:h})]},h.id+(h._types||""))})}),d==="default"?r?t(se,{onChange:h=>{h&&a()},children:t("button",{type:"button",class:"plain block",onClick:()=>a(),children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):d==="loading"&&t("p",{class:"ui-state",children:t(gt,{abrupt:!0})})]}):d==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):d==="error"?t("p",{class:"ui-state",children:"Error loading accounts"}):t("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Ln({alt:e,lang:n,onClose:d}){const o=ot(v),[i,s]=T(!1),r=un(!0),c=o.settings.contentTranslationHideLanguages||[],m=!!n&&n!==r&&!je([n],[r])&&!c.find(l=>n===l||je([n],[l]));return t("div",{class:"sheet",children:[!!d&&t("button",{type:"button",class:"sheet-close outer",onClick:d,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:[t("h2",{children:"Media description"}),t("div",{class:"header-side",children:t(Wt,{align:"end",menuButton:t("button",{type:"button",class:"plain4",children:t(w,{icon:"more",alt:"More",size:"xl"})}),children:t(Z,{disabled:i,onClick:()=>{s(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate"})]})})})]}),t("main",{lang:n,dir:"auto",children:[t("p",{style:{whiteSpace:"pre-wrap"},children:e}),(m||i)&&t(pn,{forceTranslate:i,sourceLanguage:n,text:e})]})]})}function Rn({mediaAttachments:e,statusID:n,instance:d,lang:o,index:i=0,onClose:s=()=>{}}){var g,y;const r=_(null),[c,m]=T(i),l=_(null);Pt(()=>{var b;(b=l.current)==null||b.scrollIntoView()},[]);const u=_(n);z(()=>{const b=i*r.current.clientWidth,k=u.current!==n;k&&(u.current=n),r.current.scrollTo({left:b,behavior:k?"auto":"smooth"}),r.current.focus()},[i,n]);const[f,p]=T(!0);z(()=>{let b=()=>{s()};return r.current&&r.current.addEventListener("swiped-down",b),()=>{r.current&&r.current.removeEventListener("swiped-down",b)}},[]),vt("esc",s,[s]);const[a,h]=T(!1);return z(()=>{let b=()=>{const{clientWidth:k,scrollLeft:S}=r.current,I=Math.round(S/k);m(I)};return r.current&&r.current.addEventListener("scroll",b,{passive:!0}),()=>{r.current&&r.current.removeEventListener("scroll",b)}},[]),z(()=>{let b=setTimeout(()=>{var k,S;(S=(k=r.current)==null?void 0:k.focus)==null||S.call(k)},100);return()=>clearTimeout(b)},[]),t("div",{class:"media-modal-container",children:[t("div",{ref:r,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:b=>{(b.target.classList.contains("carousel-item")||b.target.classList.contains("media")||b.target.classList.contains("media-zoom"))&&s()},children:e==null?void 0:e.map((b,k)=>{const{blurhash:S}=b,I=S?ss(S):null;return t("div",{class:"carousel-item",style:{"--average-color":`rgb(${I==null?void 0:I.join(",")})`,"--average-color-alpha":`rgba(${I==null?void 0:I.join(",")}, .5)`},tabindex:"0",ref:k===c?l:null,onClick:$=>{$.target!==$.currentTarget&&p(!f)},children:[!!b.description&&t("button",{type:"button",class:"media-alt",hidden:!f,onClick:()=>{h({alt:b.description,lang:o})},children:[t("span",{class:"alt-badge",children:"ALT"}),t("span",{class:"media-alt-desc",lang:o,dir:"auto",children:b.description})]}),t(Wn,{media:b,showOriginal:!0,lang:o})]},b.id)})}),t("div",{class:"carousel-top-controls",hidden:!f,children:[t("span",{children:t("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:t(w,{icon:"x"})})}),(e==null?void 0:e.length)>1?t("span",{class:"carousel-dots",children:e==null?void 0:e.map((b,k)=>t("button",{type:"button",disabled:k===c,class:`carousel-dot ${k===c?"active":""}`,onClick:S=>{S.preventDefault(),S.stopPropagation(),r.current.scrollTo({left:r.current.clientWidth*k,behavior:"smooth"}),r.current.focus()},children:t(w,{icon:"round",size:"s"})},b.id))}):t("span",{}),t("span",{children:[t(Wt,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:t("button",{type:"button",class:"carousel-button",children:t(w,{icon:"more",alt:"More"})}),children:t(Ct,{href:((g=e[c])==null?void 0:g.remoteUrl)||((y=e[c])==null?void 0:y.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[t(w,{icon:"popout"}),t("span",{children:"Open original media"})]})})," ",t(G,{to:`${d?`/${d}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${c+1}`:""}`,class:"button carousel-button media-post-link",children:[t("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(e==null?void 0:e.length)>1&&t("div",{class:"carousel-controls",hidden:!f,children:[t("button",{type:"button",class:"carousel-button",hidden:c===0,onClick:b=>{b.preventDefault(),b.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(c-1),behavior:"smooth"})},children:t(w,{icon:"arrow-left"})}),t("button",{type:"button",class:"carousel-button",hidden:c===e.length-1,onClick:b=>{b.preventDefault(),b.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(c+1),behavior:"smooth"})},children:t(w,{icon:"arrow-right"})})]}),!!a&&t(pt,{class:"light",onClick:b=>{b.target===b.currentTarget&&(h(!1),r.current.focus())},children:t(Ln,{alt:a.alt||a,lang:a==null?void 0:a.lang,onClose:()=>h(!1)})})]})}const Os=""+new URL("floating-button-ef345856.svg",import.meta.url).href,qs=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,Hs=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function Le({children:e}){if(typeof e=="string")return e;const[n,d]=T("");return z(()=>{Promise.resolve(e).then(d)},[e]),n}const Zt=9,Vs=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],An={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Favourites",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},pe={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},we={following:{id:"home",title:(e,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:be(async({id:e})=>(await q().masto.v1.lists.$select(e).fetch()).title,{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/l/${e}`,icon:"list"},public:{id:"public",title:({local:e})=>e?"Local":"Federated",subtitle:({instance:e})=>e||q().instance,path:({local:e,instance:n})=>`/${n}/p${e?"/l":""}`,icon:({local:e})=>e?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:e})=>e||q().instance,path:({instance:e})=>`/${e}/trending`,icon:"chart"},search:{id:"search",title:({query:e})=>e,path:({query:e})=>`/search?q=${e}`,icon:"search"},"account-statuses":{id:"account-statuses",title:be(async({id:e})=>{const n=await q().masto.v1.accounts.$select(e).fetch();return n.username||n.acct||n.displayName},{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/a/${e}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Favourites",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:e})=>e,subtitle:({instance:e})=>e||q().instance,path:({hashtag:e,instance:n})=>`${n?`/${n}`:""}/t/${e.split(/\s+/).join("+")}`,icon:"hashtag"}};function js({onClose:e}){const n=ot(v),{masto:d}=q(),{shortcuts:o}=n,[i,s]=T([]),[r,c]=T([]),[m,l]=T(!1),[u,f]=T(!1);return z(()=>{(async()=>{try{const p=await d.v1.lists.list();s(p)}catch{}})(),(async()=>{try{const p=d.v1.followedTags.list(),a=[];do{const{value:h,done:g}=await p.next();if(g||(h==null?void 0:h.length)===0)break;a.push(...h)}while(!0);c(a)}catch{}})()},[]),t("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[t(w,{icon:"shortcut"})," Shortcuts"," ",t("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),t("main",{children:[t("p",{children:["Specify a list of shortcuts that'll appear as:",t("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Os},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Hs},{value:"multi-column",label:"Multi-column",imgURL:qs}].map(({value:p,label:a,imgURL:h})=>t("label",{children:[t("input",{type:"radio",name:"shortcuts-view-mode",value:p,checked:n.settings.shortcutsViewMode===p||p==="float-button"&&!n.settings.shortcutsViewMode,onChange:g=>{v.settings.shortcutsViewMode=g.target.value}})," ",t("img",{src:h,alt:"",width:"80",height:"58"})," ",t("span",{children:a})]}))})]}),o.length>0?t("ol",{class:"shortcuts-list",children:o.filter(Boolean).map((p,a)=>{const h=a+Object.values(p),{type:g}=p;if(!we[g])return null;let{icon:y,title:b,subtitle:k}=we[g];return typeof b=="function"&&(b=b(p,a)),typeof k=="function"&&(k=k(p,a)),typeof y=="function"&&(y=y(p,a)),t("li",{children:[t(w,{icon:y}),t("span",{class:"shortcut-text",children:[t(Le,{children:b}),k&&t(x,{children:[" ",t("small",{class:"ib insignificant",children:k})]})]}),t("span",{class:"shortcut-actions",children:[t("button",{type:"button",class:"plain small",disabled:a===0,onClick:()=>{const S=Array.from(v.shortcuts);if(a>0){const I=v.shortcuts[a-1];S[a-1]=p,S[a]=I,v.shortcuts=S}},children:t(w,{icon:"arrow-up",alt:"Move up"})}),t("button",{type:"button",class:"plain small",disabled:a===o.length-1,onClick:()=>{const S=Array.from(v.shortcuts);if(a<v.shortcuts.length-1){const I=v.shortcuts[a+1];S[a+1]=p,S[a]=I,v.shortcuts=S}},children:t(w,{icon:"arrow-down",alt:"Move down"})}),t("button",{type:"button",class:"plain small",onClick:()=>{l({shortcut:p,shortcutIndex:a})},children:t(w,{icon:"pencil",alt:"Edit"})})]})]},h)})}):t("div",{class:"ui-state insignificant",children:[t("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),t("p",{children:["Not sure what to add?",t("br",{}),"Try adding"," ",t("a",{href:"#",onClick:p=>{p.preventDefault(),v.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),t("p",{class:"insignificant",children:o.length>=Zt&&`Max ${Zt} shortcuts`}),t("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t("button",{type:"button",class:"light",onClick:()=>f(!0),children:"Import/export"}),t("button",{type:"button",disabled:o.length>=Zt,onClick:()=>l(!0),children:[t(w,{icon:"plus"})," ",t("span",{children:"Add shortcut"})]})]})]}),m&&t(pt,{class:"light",onClick:p=>{p.target===p.currentTarget&&l(!1)},children:t(Gs,{shortcut:m.shortcut,shortcutIndex:m.shortcutIndex,lists:i,followedHashtags:r,onSubmit:({result:p,mode:a})=>{a==="edit"?v.shortcuts[m.shortcutIndex]=p:v.shortcuts.push(p)},onClose:()=>l(!1)})}),u&&t(pt,{class:"light",onClick:p=>{p.target===p.currentTarget&&f(!1)},children:t(Ws,{shortcuts:o,onClose:()=>f(!1)})})]})}function Gs({lists:e,followedHashtags:n,onSubmit:d,disabled:o,shortcut:i,shortcutIndex:s,onClose:r}){var f,p;const c=!!i,[m,l]=T((i==null?void 0:i.type)||null),u=_();return z(()=>{if(c&&m&&pe[m]){const a=u.current;pe[m].forEach(({name:h,type:g})=>{const y=a.querySelector(`[name="${h}"]`);y&&i[h]&&(g==="checkbox"?y.checked=i[h]==="on":y.value=i[h])})}},[c,m]),t("div",{id:"shortcut-settings-form",class:"sheet",children:[!!r&&t("button",{type:"button",class:"sheet-close",onClick:r,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[c?"Edit":"Add"," shortcut"]})}),t("main",{tabindex:"-1",children:t("form",{ref:u,onSubmit:a=>{a.preventDefault();const h=new FormData(a.target),g={};h.forEach((y,b)=>{g[b]=y==null?void 0:y.trim(),b==="instance"&&(g[b]=g[b].replace(/^https?:\/\//,"").replace(/\/+$/,""),g[b]=g[b].replace(/^@?[^@]+@/,""))}),g.type&&(d({result:g,mode:c?"edit":"add"}),a.target.reset(),l(null),r==null||r())},children:[t("p",{children:t("label",{children:[t("span",{children:"Timeline"}),t("select",{required:!0,disabled:o,onChange:a=>{l(a.target.value)},defaultValue:c?i.type:void 0,name:"type",children:[t("option",{}),Vs.map(a=>t("option",{value:a,children:An[a]}))]})]})}),(p=(f=pe[m])==null?void 0:f.map)==null?void 0:p.call(f,({text:a,name:h,type:g,placeholder:y,pattern:b,notRequired:k})=>m==="list"?t("p",{children:t("label",{children:[t("span",{children:"List"}),t("select",{name:"id",required:!k,disabled:o,children:e.map(S=>t("option",{value:S.id,children:S.title}))})]})}):t("p",{children:t("label",{children:[t("span",{children:a})," ",t("input",{type:g,name:h,placeholder:y,required:g==="text"&&!k,disabled:o,list:m==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:b}),m==="hashtag"&&n.length>0&&t("datalist",{id:"followed-hashtags-datalist",children:n.map(S=>t("option",{value:S.name}))})]})})),t("footer",{children:[t("button",{type:"submit",class:"block",disabled:o,children:c?"Save":"Add"}),c&&t("button",{type:"button",class:"light danger",onClick:()=>{v.shortcuts.splice(s,1),r==null||r()},children:"Remove"})]})]})})]})}function Ws({shortcuts:e,onClose:n}){var l;const d=ut(()=>!e||!e.filter(Boolean).length?"":Je.compressToEncodedURIComponent(JSON.stringify(e.filter(Boolean))),[e]),[o,i]=T(""),[s,r]=T("default"),c=ut(()=>{if(!o)return r("default"),null;try{const u=JSON.parse(Je.decompressFromEncodedURIComponent(o));if(!Array.isArray(u))throw new Error("Not an array");return r("default"),u}catch{try{const f=JSON.parse(o);if(!Array.isArray(f))throw new Error("Not an array");return r("default"),f}catch{return r("error"),null}}},[o]),m=v.shortcuts.length>0;return t("div",{id:"import-export-container",class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:["Import/Export ",t("small",{class:"ib insignificant",children:"Shortcuts"})]})}),t("main",{tabindex:"-1",children:[t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Import"})]}),t("p",{children:t("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:u=>{i(u.target.value)}})}),!!c&&Array.isArray(c)&&t(x,{children:[t("p",{children:[t("b",{children:c.length})," shortcut",c.length>1?"s":""," ",t("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),t("ol",{class:"import-settings-list",children:c.map(u=>{var f,p;return t("li",{children:[t("span",{style:{opacity:e.some(a=>Object.keys(a).every(h=>a[h]===u[h]))?1:0},children:"*"}),t("span",{children:[An[u.type],u.type==="list"&&" ⚠️"," ",(p=(f=pe[u.type])==null?void 0:f.map)==null?void 0:p.call(f,({text:a,name:h,type:g})=>u[h]?t(x,{children:[t("span",{class:"tag collapsed insignificant",children:[a,":"," ",g==="checkbox"?u[h]==="on"?"✅":"❌":u[h]]})," "]}):null)]})]})})}),t("p",{children:[t("small",{children:"* Exists in current shortcuts"}),t("br",{}),t("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&t("p",{class:"error",children:t("small",{children:"⚠️ Invalid settings format"})}),t("p",{children:[m&&t(x,{children:[t(Nt,{confirmLabel:"Append to current shortcuts?",menuFooter:t("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const u=c.filter(a=>!v.shortcuts.some(h=>Object.keys(h).every(g=>h[g]===a[g])));if(!u.length){it("No new shortcuts to import");return}let f=[...v.shortcuts,...u];const p=f.length>Zt;p&&(f=f.slice(0,Zt)),v.shortcuts=f,it(p?`Shortcuts imported. Exceeded max ${Zt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!c,children:"Import & append…"})})," "]}),t(Nt,{confirmLabel:m?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:m?"danger":void 0,onClick:()=>{v.shortcuts=c,it("Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!c,children:m?"or override…":"Import…"})})]})]}),t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Export"})]}),t("p",{children:t("input",{style:{width:"100%"},type:"text",value:d,readOnly:!0,onClick:u=>{if(u.target.value){u.target.select();try{navigator.clipboard.writeText(u.target.value),it("Shortcuts copied")}catch{it("Unable to copy shortcuts")}}}})}),t("p",{children:[t("button",{type:"button",class:"plain2",disabled:!d,onClick:()=>{try{navigator.clipboard.writeText(d),it("Shortcut settings copied")}catch{it("Unable to copy shortcut settings")}},children:[t(w,{icon:"clipboard"})," ",t("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((l=navigator==null?void 0:navigator.canShare)==null?void 0:l.call(navigator,{text:d}))&&t("button",{type:"button",class:"plain2",disabled:!d,onClick:()=>{try{navigator.share({text:d})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"})," ",t("span",{children:"Share"})]})," ",d.length>0&&t("small",{class:"insignificant",children:[d.length," characters"]})]}),!!d&&t("details",{children:[t("summary",{class:"insignificant",children:t("small",{children:"Raw Shortcuts JSON"})}),t("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(e.filter(Boolean),null,2)})]})]})]})]})}is(v,e=>{for(const[n,d,o,i]of e)/^show/i.test(d)&&!o&&$e()});function Ks(){var o,i,s,r,c,m,l,u;const e=ot(v),n=wn(),d=Ue();return t(x,{children:[!!e.showCompose&&t(pt,{children:t(Kn,{replyToStatus:typeof e.showCompose!="boolean"?e.showCompose.replyToStatus:((o=window.__COMPOSE__)==null?void 0:o.replyToStatus)||null,editStatus:((i=v.showCompose)==null?void 0:i.editStatus)||((s=window.__COMPOSE__)==null?void 0:s.editStatus)||null,draftStatus:((r=v.showCompose)==null?void 0:r.draftStatus)||((c=window.__COMPOSE__)==null?void 0:c.draftStatus)||null,onClose:f=>{const{newStatus:p,instance:a,type:h}=f||{};v.showCompose=!1,window.__COMPOSE__=null,p&&(v.reloadStatusPage++,it({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[h||"post"],delay:1e3,duration:1e4,onClick:g=>{g.hideToast(),v.prevLocation=d,n(a?`/${a}/s/${p.id}`:`/s/${p.id}`)}}))}})}),!!e.showSettings&&t(pt,{onClose:()=>{v.showSettings=!1},children:t(Cs,{onClose:()=>{v.showSettings=!1}})}),!!e.showAccounts&&t(pt,{onClose:()=>{v.showAccounts=!1},children:t(ws,{onClose:()=>{v.showAccounts=!1}})}),!!e.showAccount&&t(pt,{class:"light",onClose:()=>{v.showAccount=!1},children:t(Us,{account:((m=e.showAccount)==null?void 0:m.account)||e.showAccount,instance:(l=e.showAccount)==null?void 0:l.instance,onClose:({destination:f}={})=>{v.showAccount=!1,f&&(v.showAccounts=!1)}})}),!!e.showDrafts&&t(pt,{onClose:()=>{v.showDrafts=!1},children:t(Fs,{onClose:()=>v.showDrafts=!1})}),!!e.showMediaModal&&t(pt,{onClick:f=>{(f.target===f.currentTarget||f.target.classList.contains("media"))&&(v.showMediaModal=!1)},children:t(Rn,{mediaAttachments:e.showMediaModal.mediaAttachments,instance:e.showMediaModal.instance,index:e.showMediaModal.index,statusID:e.showMediaModal.statusID,onClose:()=>{v.showMediaModal=!1}})}),!!e.showShortcutsSettings&&t(pt,{class:"light",onClose:()=>{v.showShortcutsSettings=!1},children:t(js,{onClose:()=>v.showShortcutsSettings=!1})}),!!e.showGenericAccounts&&t(pt,{class:"light",onClose:()=>{v.showGenericAccounts=!1},children:t(Bs,{onClose:()=>v.showGenericAccounts=!1})}),!!e.showMediaAlt&&t(pt,{class:"light",onClick:f=>{f.target===f.currentTarget&&(v.showMediaAlt=!1)},children:t(Ln,{alt:e.showMediaAlt.alt||e.showMediaAlt,lang:(u=e.showMediaAlt)==null?void 0:u.lang,onClose:()=>{v.showMediaAlt=!1}})})]})}function Re({accountID:e,onChange:n}){const{masto:d}=q(),[o,i]=T("default"),[s,r]=T(null),[c,m]=T(null),l=c!==null;return t("p",{class:"follow-request-buttons",children:[t("button",{type:"button",disabled:o==="loading"||l,onClick:()=>{i("loading"),r("accept"),(async()=>{try{const u=await d.v1.followRequests.$select(e).authorize();if(!(u!=null&&u.followedBy))throw new Error("Follow request not accepted");m(u),n()}catch{}i("default")})()},children:"Accept"})," ",t("button",{type:"button",disabled:o==="loading"||l,class:"light danger",onClick:()=>{i("loading"),r("reject"),(async()=>{try{const u=await d.v1.followRequests.$select(e).reject();if(u!=null&&u.followedBy)throw new Error("Follow request not rejected");m(u),n()}catch{i("default")}})()},children:"Reject"}),t("span",{class:"follow-request-states",children:l&&s?s==="accept"?t(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):t(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):t(gt,{hidden:o!=="loading"})})]})}const sn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},Xt={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":e=>`boosted ${e} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"favourited your post.","favourite+account":e=>`favourited ${e} of your posts.`,favourite_reply:"favourited your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & favourited your post.","favourite+reblog+account":e=>`boosted & favourited ${e} of your posts.`,"favourite+reblog_reply":"boosted & favourited your reply.","admin.signup":"signed up.","admin.report":"reported a post."},Ce=50;function Be({notification:e,instance:n,reload:d,isStatic:o}){var U,L,R,j;const{id:i,status:s,account:r,_accounts:c,_statuses:m}=e;let{type:l}=e;const u=(s==null?void 0:s.reblog)||s,f=u==null?void 0:u.id,p=X.session.get("currentAccount"),a=p===(r==null?void 0:r.id),h=(U=s==null?void 0:s.poll)==null?void 0:U.voted,g=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==p&&((L=s==null?void 0:s.account)==null?void 0:L.id)===p;let y=0,b=0;if(l==="favourite+reblog"){for(const A of c)(R=A._types)!=null&&R.includes("favourite")&&y++,(j=A._types)!=null&&j.includes("reblog")&&b++;!b&&y&&(l="favourite"),!y&&b&&(l="reblog")}let k;if(l==="poll"?k=Xt[a?"poll-self":h?"poll-voted":"poll"]:l==="reblog"||l==="favourite"||l==="favourite+reblog"?(m==null?void 0:m.length)>1?k=Xt[`${l}+account`]:g?k=Xt[`${l}_reply`]:k=Xt[l]:Xt[l]?k=Xt[l]:k=`[Unknown notification type: ${l}]`,typeof k=="function"&&(k=k((m==null?void 0:m.length)||(c==null?void 0:c.length))),l==="mention"&&!s)return null;const S=e.createdAt&&new Date(e.createdAt).toLocaleString(),I={"favourite+reblog":"Boosted/Favourited by…",favourite:"Favourited by…",reblog:"Boosted by…",follow:"Followed by…"}[l]||"Accounts",$=()=>{v.showGenericAccounts={heading:I,accounts:c,showReactions:l==="favourite+reblog"}};return t("div",{class:`notification notification-${l}`,tabIndex:"0",children:[t("div",{class:`notification-type notification-${l}`,title:S,children:l==="favourite+reblog"?t(x,{children:[t(w,{icon:"rocket",size:"xl",alt:l,class:"reblog-icon"}),t(w,{icon:"heart",size:"xl",alt:l,class:"favourite-icon"})]}):t(w,{icon:sn[l]||"notification",size:"xl",alt:l})}),t("div",{class:"notification-content",children:[l!=="mention"&&t(x,{children:[t("p",{children:[!/poll|update/i.test(l)&&t(x,{children:(c==null?void 0:c.length)>1?t(x,{children:[t("b",{tabIndex:"0",onClick:$,children:[t("span",{title:c.length,children:Et(c.length)})," ","people"]})," "]}):t(x,{children:[t(Ne,{account:r,showAvatar:!0})," "]})}),k,l==="mention"&&t("span",{class:"insignificant",children:[" ","•"," ",t(_e,{datetime:e.createdAt,format:"micro"})]})]}),l==="follow_request"&&t(Re,{accountID:r.id,onChange:()=>{}})]}),(c==null?void 0:c.length)>1&&t("p",{class:"avatars-stack",children:[c.slice(0,Ce).map((A,M)=>t(x,{children:[t("a",{href:A.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:N=>{N.preventDefault(),v.showAccount=A},children:[t(Vt,{url:A.avatarStatic,size:c.length<=10?"xxl":c.length<20?"xl":c.length<30?"l":c.length<40?"m":"s",alt:`${A.displayName} @${A.acct}`,squircle:A==null?void 0:A.bot},A.id),l==="favourite+reblog"&&t("div",{class:"account-sub-icons",children:A._types.map(N=>t(w,{icon:sn[N],size:"s",class:`${N}-icon`}))})]})," "]})),t("button",{type:"button",class:"small plain",onClick:$,children:[c.length>Ce&&`+${c.length-Ce}`,t(w,{icon:"chevron-down"})]})]}),(m==null?void 0:m.length)>1&&t("ul",{class:"notification-group-statuses",children:m.map(A=>t("li",{children:t(on,{class:`status-link status-type-${l}`,to:n?`/${n}/s/${A.id}`:`/s/${A.id}`,children:t(wt,{status:A,size:"s"})})},A.id))}),s&&(!(m!=null&&m.length)||(m==null?void 0:m.length)<=1)&&t(on,{class:`status-link status-type-${l}`,to:n?`/${n}/s/${f}`:`/s/${f}`,onContextMenu:A=>{const M=A.target.querySelector(".status");if(M){if(A.metaKey)return;A.preventDefault(),M.dispatchEvent(new MouseEvent("contextmenu",{clientX:A.clientX,clientY:A.clientY}))}},children:o?t(wt,{status:u,size:"s"}):t(wt,{statusID:f,size:"s"})})]})]})}function on(e){const n=Jn();return t(G,{...e,"data-read-more":"Read more →",ref:n})}const Js=Gt(function(){if(!("serviceWorker"in navigator))return null;const n=ot(v),{routeNotification:d}=n,{id:o,accessToken:i}=d||{},[s,r]=T(!1);Pt(()=>{if(!o||!i)return;const{instance:m}=q(),{masto:l,instance:u}=q({accessToken:i}),f=m===u,p=i?Yn(i):Qt();(async()=>{const a=await l.v1.notifications.$select(o).fetch();if(a&&p){const h=p.instanceURL,{type:g,status:y,account:b}=a,k=!!document.querySelector("#modal-container > *"),S=g==="follow"&&!!(b!=null&&b.id),I=!!(b!=null&&b.id),$=!!(y!=null&&y.id);S&&f?v.showAccount={account:b,instance:h}:k||!f||I&&$?r({id:o,account:p,notification:a,sameInstance:f}):$?location.hash=`/${m}/s/${y.id}`:S?location.hash=`/${m}/a/${b.id}`:location.hash="/notifications"}})()},[o,i]),Pt(()=>{const m=l=>{const{type:u,id:f,accessToken:p}=(l==null?void 0:l.data)||{};u==="notification"&&(v.routeNotification={id:f,accessToken:p})};return navigator.serviceWorker.addEventListener("message",m),()=>{navigator.serviceWorker.removeEventListener("message",m)}},[]),Pt(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),ye(m=>{m&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const c=()=>{r(!1),v.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(s){const{id:m,account:l,notification:u,sameInstance:f}=s;return t(pt,{class:"light",onClick:p=>{p.target===p.currentTarget&&c()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:c,children:t(w,{icon:"x"})}),t("header",{children:t("b",{children:"Notification"})}),t("main",{children:[!f&&t("p",{children:"This notification is from your other account."}),t("div",{class:"notification-peek",onClick:p=>{const{target:a}=p;(p.target.tagName==="BUTTON"||p.target.tagName==="A")&&c()},children:t(Be,{instance:l.instanceURL,notification:u,isStatic:!0})}),t("div",{style:{textAlign:"end"},children:t(G,{to:"/notifications",class:"button light",onClick:c,children:[t("span",{children:"View all notifications"})," ",t(w,{icon:"arrow-right"})]})})]})]})})}return null});const Mn=os((e,n)=>{const{instance:d}=q(),[o,i]=Ut(),[s,r]=T(!1),[c,m]=T(o.get("q")||""),l=o.get("type"),u=_(null),f=_(null);return cs(n,()=>({setValue:p=>{m(p)},focus:()=>{f.current.focus()},select:()=>{f.current.select()},blur:()=>{f.current.blur()}})),t("form",{ref:u,class:"search-popover-container",onSubmit:p=>{var h;if(p.preventDefault(),/\/search/.test(location.hash))if(c){const g={q:c};l&&(g.type=l),i(g)}else i({});else c?location.hash=`/search?q=${encodeURIComponent(c)}${l?`&type=${l}`:""}`:location.hash="/search";(h=e==null?void 0:e.onSubmit)==null||h.call(e,p)},children:[t("input",{ref:f,value:c,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:p=>{p.target.value||i({})},onInput:p=>{m(p.target.value),r(!0)},onFocus:()=>{r(!0)},onBlur:()=>{var p,a;setTimeout(()=>{r(!1)},100),(a=(p=u.current)==null?void 0:p.querySelector(".search-popover-item.focus"))==null||a.classList.remove("focus")},onKeyDown:p=>{var h;const{key:a}=p;switch(a){case"Escape":r(!1);break;case"Down":case"ArrowDown":if(p.preventDefault(),s){const g=u.current.querySelector(".search-popover-item.focus");if(g){let y=g.nextElementSibling;for(;y&&y.hidden;)y=y.nextElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(k=>k!==y).forEach(k=>{k.classList.remove("focus")}))}else{const y=u.current.querySelector(".search-popover-item");y&&y.classList.add("focus")}}break;case"Up":case"ArrowUp":if(p.preventDefault(),s){const g=document.querySelector(".search-popover-item.focus");if(g){let y=g.previousElementSibling;for(;y&&y.hidden;)y=y.previousElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(k=>k!==y).forEach(k=>{k.classList.remove("focus")}))}else{const y=document.querySelector(".search-popover-item:last-child");y&&y.classList.add("focus")}}break;case"Enter":if(s){const g=document.querySelector(".search-popover-item.focus");g&&(p.preventDefault(),g.click()),r(!1),(h=e==null?void 0:e.onSubmit)==null||h.call(e,p)}break}}}),t("div",{class:"search-popover",hidden:!s||!c,children:!!c&&[{label:t(x,{children:["Posts with ",t("q",{children:c})]}),to:`/search?q=${encodeURIComponent(c)}&type=statuses`,hidden:/^https?:/.test(c)},{label:t(x,{children:["Posts tagged with ",t("mark",{children:["#",c.replace(/^#/,"")]})]}),to:`/${d}/t/${c.replace(/^#/,"")}`,hidden:/^@/.test(c)||/^https?:/.test(c)||/\s/.test(c),top:/^#/.test(c),type:"link"},{label:t(x,{children:["Look up ",t("mark",{children:c})]}),to:`/${c}`,hidden:!/^https?:/.test(c),top:/^https?:/.test(c),type:"link"},{label:t(x,{children:["Accounts with ",t("q",{children:c})]}),to:`/search?q=${encodeURIComponent(c)}&type=accounts`}].sort((p,a)=>p.top&&!a.top?-1:!p.top&&a.top?1:0).map(({label:p,to:a,hidden:h,type:g})=>t(G,{to:a,class:"search-popover-item",hidden:h,onClick:y=>{var b;(b=e==null?void 0:e.onSubmit)==null||b.call(e,y)},children:[t(w,{icon:g==="link"?"arrow-right":"search",class:"more-insignificant"}),t("span",{children:p})," "]}))})]})}),Ys=Gt(function({onClose:n=()=>{}}){const[d,o]=T(!1),i=_(null);vt("/",r=>{o(!0),setTimeout(()=>{var c,m,l,u;(m=(c=i.current)==null?void 0:c.focus)==null||m.call(c),(u=(l=i.current)==null?void 0:l.select)==null||u.call(l)},0)},{preventDefault:!0,ignoreEventWhen:r=>{const c=/\/search/.test(location.hash),m=!!document.querySelector("#modal-container > *");return c||m}});const s=()=>{o(!1),n()};return vt("esc",r=>{var c,m;(m=(c=i.current)==null?void 0:c.blur)==null||m.call(c),s()},{enabled:d,enableOnFormTags:!0,preventDefault:!0}),t("div",{id:"search-command-container",hidden:!d,onClick:r=>{r.target===r.currentTarget&&s()},children:t(Mn,{ref:i,onSubmit:()=>{s()}})})});function Xs(){const{instance:e}=q(),n=ot(v),{shortcuts:d}=n;if(!d.length)return null;const o=_(),i=ut(()=>d.map((r,c)=>{const{type:m,...l}=r;if(!we[m])return null;let{id:u,path:f,title:p,subtitle:a,icon:h}=we[m];return typeof u=="function"&&(u=u(l,c)),typeof f=="function"&&(f=f({...l,instance:l.instance||e},c)),typeof p=="function"&&(p=p(l,c)),typeof a=="function"&&(a=a(l,c)),typeof h=="function"&&(h=h(l,c)),{id:u,path:f,title:p,subtitle:a,icon:h}}).filter(Boolean),[d]),s=wn();return vt(["1","2","3","4","5","6","7","8","9"],(r,c)=>{var l,u;const m=parseInt(c.keys[0],10)-1;if(m<i.length){const{path:f}=i[m];f&&(s(f),(u=(l=o.current)==null?void 0:l.closeMenu)==null||u.call(l))}}),t("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?t("nav",{class:"tab-bar",children:t("ul",{children:i.map(({id:r,path:c,title:m,subtitle:l,icon:u},f)=>t("li",{children:t(G,{class:l?"has-subtitle":"",to:c,onClick:p=>{if(p.target.classList.contains("is-active")){p.preventDefault();const a=document.getElementById(`${r}-page`);if(a){a.scrollTop=0;const h=a.querySelector(".updates-button");h&&h.click()}}},children:[t(w,{icon:u,size:"xl",alt:m}),t("span",{children:[t(Le,{children:m}),l&&t(x,{children:[t("br",{}),t("small",{children:l})]})]})]})},f+m))})}):t(Wt,{instanceRef:o,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:t("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:r=>{var c,m;try{const{target:l}=r;getComputedStyle(l).pointerEvents==="none"&&((m=(c=o.current)==null?void 0:c.closeMenu)==null||m.call(c))}catch{}},children:t(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:i.map(({path:r,title:c,subtitle:m,icon:l},u)=>t(Ct,{to:r,class:"glass-menu-item",children:[t(w,{icon:l,size:"l"})," ",t("span",{class:"menu-grow",children:[t("span",{children:t(Le,{children:c})}),m&&t(x,{children:[" ",t("small",{class:"more-insignificant",children:m})]})]}),t("span",{class:"menu-shortcut hide-until-focus-visible",children:u+1})]},u+c))})})}function ie(e){const{containerProps:n}=e,d=as(),o=_();return t(Wt,{boundingBoxPadding:gn(),repositionFlag:`${d.width}x${d.height}`,...e,instanceRef:o,containerProps:{onClick:i=>{var s,r,c;i.target===i.currentTarget&&((r=(s=o.current)==null?void 0:s.closeMenu)==null||r.call(s)),(c=n==null?void 0:n.onClick)==null||c.call(n,i)},...n}})}function Zs(e){var i;let n=[],d=[],o=0;for(let s=0;s<e.length;s++){const r=e[s];r.reblog&&!((i=r.account)!=null&&i.group)?(d.push(r),o++):(n.push(r),o<3&&(o=0))}if(e.length>10&&(d.length>e.length/4||o>=3)){const s=d.map(r=>r.id);if(d.length>e.length*3/4)n=[...n,{id:s,items:d,type:"boosts"}];else{const r=Math.floor(n.length/2);n=[...n.slice(0,r),{id:s,items:d,type:"boosts"},...n.slice(r)]}return n}else return e}function cn(e,n){const d=X.account.get("boostedStatusIDs")||{},o=e.filter(s=>{if(!s.reblog)return!0;const r=`${n}-${s.reblog.id}`,c=d[r];return c&&c!==s.id?!1:(d[r]=s.id,!0)}),i=Object.keys(d);return i.length>50&&i.slice(0,i.length-50).forEach(s=>{delete d[s]}),X.account.set("boostedStatusIDs",d),o}function Qs(e){const n=[];let d=0;e.forEach(s=>{for(let c=0;c<n.length;c++){if(n[c].find(m=>m.id===s.id))return;if(n[c].find(m=>m.id===s.inReplyToId)||n[c].find(m=>m.inReplyToId===s.id)){n[c].push(s);return}}const r=e.find(c=>c.id===s.inReplyToId);r&&(n[d++]=[s,r])});for(let s=0;s<n.length;s++)for(let r=s+1;r<n.length;r++)n[s].find(m=>n[r].includes(m))&&(n[s]=[...n[s],...n[r]],n[s]=n[s].filter((m,l,u)=>u.findIndex(f=>f.id===m.id)===l),n.splice(r,1),r--);n.forEach(s=>{s.sort((r,c)=>!r.inReplyToId&&!c.inReplyToId?new Date(r.createdAt)-new Date(c.createdAt):r.inReplyToId===c.id?1:c.inReplyToId===r.id||!r.inReplyToId?-1:c.inReplyToId?new Date(r.createdAt)-new Date(c.createdAt):1)}),n.forEach(s=>{const r=s[0].account.id;s.forEach(c=>{c.account.id!==r&&(c._differentAuthor=!0)})}),n.length;const o=[],i=[];return e.forEach(s=>{if(s.reblog){o.push(s);return}for(let r=0;r<n.length;r++)if(n[r].find(c=>c.id===s.id)){if(i.includes(r))return;const c=n[r];c.sort((l,u)=>{const f=new Date(l.createdAt),p=new Date(u.createdAt);return f-p});const m=c[0].account.id;o.push({id:c.map(l=>l.id),items:c,type:c.every(l=>l.account.id===m)?"thread":"conversation"}),i.push(r);return}o.push(s)}),o}function Se({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:d=1,scrollThresholdStart:o=10,scrollThresholdEnd:i=10,direction:s="vertical",distanceFromStartPx:r,distanceFromEndPx:c}={}){const[m,l]=T(null),[u,f]=T(!1),[p,a]=T(!1),[h,g]=T(!1),[y,b]=T(!1),k=s==="vertical";return Pt(()=>{const S=e.current;if(!S)return{};let I=k?S.scrollTop:S.scrollLeft;function $(){const{scrollTop:U,scrollLeft:L,scrollHeight:R,scrollWidth:j,clientHeight:A,clientWidth:M}=S,N=k?U:L,nt=k?R:j,J=k?A:M,Tt=Math.abs(N-I),yt=r||Math.min(J*n,nt,N),Q=c||Math.min(J*d,nt,nt-N-J);Tt>=(I<N?i:o)&&(l(I<N?"end":"start"),I=N),f(N<=0),a(N+J>=nt),g(N<=yt),b(N+J>=nt-Q)}return S.addEventListener("scroll",$,{passive:!0}),()=>S.removeEventListener("scroll",$)},[n,d,o,i]),{scrollDirection:m,reachStart:u,reachEnd:p,nearReachStart:h,nearReachEnd:y,init:()=>{e.current&&e.current.dispatchEvent(new Event("scroll"))}}}function oe(e){var S,I,$,U,L;const n=ot(v),{masto:d,instance:o,authenticated:i}=q(),[s,r]=T(),[c,m]=T(!1);z(()=>{const R=X.local.getJSON("accounts")||[],j=R.find(A=>A.info.id===X.session.get("currentAccount"));j&&r(j),m(R.length>1)},[]);const l=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(R=>R.type==="following"),u=ls(()=>{v.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),f=_(),[p,a]=T(void 0),h=gn([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),g=_();async function y(R){return(R||!g.current)&&(g.current=d.v1.mutes.list({limit:80})),await g.current.next()}const b=_();async function k(R){return(R||!b.current)&&(b.current=d.v1.blocks.list({limit:80})),await b.current.next()}return t(x,{children:[t("button",{ref:f,type:"button",class:`button plain nav-menu-button ${c?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{a(R=>R?void 0:"open")},onContextMenu:R=>{R.preventDefault(),v.showAccounts=!0},...u(),children:[c&&t(Vt,{url:((S=s==null?void 0:s.info)==null?void 0:S.avatar)||((I=s==null?void 0:s.info)==null?void 0:I.avatarStatic),size:"l",squircle:($=s==null?void 0:s.info)==null?void 0:$.bot}),t(w,{icon:"menu",size:c?"s":"l"})]}),t(vn,{menuClassName:"nav-menu",state:p,anchorRef:f,onClose:()=>{a(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{a(void 0)}},portal:{target:document.body},...e,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:h,unmountOnClose:!0,children:[!!((U=n.appVersion)!=null&&U.commitHash)&&n.appVersion.commitHash!=="b9557b5"&&t("div",{class:"top-menu",children:[t(Z,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[t(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",t("span",{children:"New update available…"})]}),t(Dt,{})]}),t("section",{children:[t(Ct,{to:"/",children:[t(w,{icon:"home",size:"l"})," ",t("span",{children:"Home"})]}),i&&t(x,{children:[l&&t(Ct,{to:"/following",children:[t(w,{icon:"following",size:"l"})," ",t("span",{children:"Following"})]}),t(Ct,{to:"/mentions",children:[t(w,{icon:"at",size:"l"})," ",t("span",{children:"Mentions"})]}),t(Ct,{to:"/notifications",children:[t(w,{icon:"notification",size:"l"})," ",t("span",{children:"Notifications"}),n.notificationsShowNew&&t("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),t(Dt,{}),t(Ct,{to:"/l",children:[t(w,{icon:"list",size:"l"})," ",t("span",{children:"Lists"})]}),t(Ct,{to:"/ft",children:[t(w,{icon:"hashtag",size:"l"})," ",t("span",{children:"Followed Hashtags"})]}),t(Ct,{to:"/b",children:[t(w,{icon:"bookmark",size:"l"})," ",t("span",{children:"Bookmarks"})]}),t(Ct,{to:"/f",children:[t(w,{icon:"heart",size:"l"})," ",t("span",{children:"Favourites"})]})]}),t(Dt,{}),t(Ct,{to:"/search",children:[t(w,{icon:"search",size:"l"})," ",t("span",{children:"Search"})]}),t(Ct,{to:`/${o}/p/l`,children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Local"})]}),t(Ct,{to:`/${o}/p`,children:[t(w,{icon:"earth",size:"l"})," ",t("span",{children:"Federated"})]}),t(Ct,{to:`/${o}/trending`,children:[t(w,{icon:"chart",size:"l"})," ",t("span",{children:"Trending"})]})]}),t("section",{children:i?t(x,{children:[t(Dt,{}),((L=s==null?void 0:s.info)==null?void 0:L.id)&&t(Ct,{to:`/${o}/a/${s.info.id}`,children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Profile"})]}),t(Z,{onClick:()=>{v.showAccounts=!0},children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Accounts…"})]}),t(Z,{onClick:()=>{v.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:y}},children:[t(w,{icon:"mute",size:"l"})," Muted users…"]}),t(Z,{onClick:()=>{v.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:k}},children:[t(w,{icon:"block",size:"l"}),"Blocked users…"]}),t(Z,{onClick:()=>{v.showKeyboardShortcutsHelp=!0},children:[t(w,{icon:"keyboard",size:"l"})," ",t("span",{children:"Keyboard shortcuts"})]}),t(Z,{onClick:()=>{v.showShortcutsSettings=!0},children:[t(w,{icon:"shortcut",size:"l"})," ",t("span",{children:"Shortcuts Settings…"})]}),t(Z,{onClick:()=>{v.showSettings=!0},children:[t(w,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]}):t(x,{children:[t(Dt,{}),t(Ct,{to:"/login",children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Log in"})]}),t(Z,{onClick:()=>{v.showSettings=!0},children:[t(w,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]})})]})]})}const de={block:"nearest",inline:"center",behavior:"smooth"};function Ft({title:e,titleComponent:n,id:d,instance:o,emptyText:i,errorText:s,useItemID:r,boostsCarousel:c,fetchItems:m=()=>{},checkForUpdates:l=()=>{},checkForUpdatesInterval:u=6e4,headerStart:f,headerEnd:p,timelineStart:a,allowFilters:h,refresh:g}){const y=ot(v),[b,k]=T([]),[S,I]=T("default"),[$,U]=T(!1),[L,R]=T(!1),[j,A]=T(!0),M=_(),N=kn(V=>{R(!1),S!=="loading"&&(I("loading"),(async()=>{try{let{done:tt,value:P}=await m(V);Array.isArray(P)?(c&&(P=Zs(P)),P=Qs(P),k(V?P:W=>[...W,...P]),P.length||(tt=!0),U(!tt)):U(!1),I("default")}catch{I("error")}finally{N.cancel()}})())},1500,{leading:!0,trailing:!1}),nt=".timeline-item, .timeline-item-alt",J=vt("j, shift+j",(V,tt)=>{const P=document.activeElement.closest(nt),W=P==null?void 0:P.getBoundingClientRect(),C=Array.from(M.current.querySelectorAll(nt));if(P&&W.top<M.current.clientHeight&&W.bottom>0){const E=C.indexOf(P);let B=C[E+1];tt.shift&&(B=C.find((K,H)=>H>E&&!K.classList.contains("timeline-item-alt"))),B&&(B.focus(),B.scrollIntoView(de))}else{const E=C.find(B=>{const K=B.getBoundingClientRect();return K.top>=44&&K.left>=0});E&&(E.focus(),E.scrollIntoView(de))}}),Tt=vt("k, shift+k",(V,tt)=>{const P=document.activeElement.closest(nt),W=P==null?void 0:P.getBoundingClientRect(),C=Array.from(M.current.querySelectorAll(nt));if(P&&W.top<M.current.clientHeight&&W.bottom>0){const E=C.indexOf(P);let B=C[E-1];tt.shift&&(B=C.findLast((K,H)=>H<E&&!K.classList.contains("timeline-item-alt"))),B&&(B.focus(),B.scrollIntoView(de))}else{const E=C.find(B=>{const K=B.getBoundingClientRect();return K.top>=44&&K.left>=0});E&&(E.focus(),E.scrollIntoView(de))}}),yt=vt(["enter","o"],()=>{const V=document.activeElement.closest(nt);V&&V.click()}),{scrollDirection:Q,nearReachStart:Rt,nearReachEnd:xt,reachStart:D,reachEnd:Y}=Se({scrollableRef:M,distanceFromEnd:2,scrollThresholdStart:44});z(()=>{var V;(V=M.current)==null||V.scrollTo({top:0}),N(!0)},[]),z(()=>{N(!0)},[g]),z(()=>{D&&N(!0)},[D]),z(()=>{(xt||Y&&$)&&N()},[xt,$]);const et=Sn(5e3),mt=jt(async({disableHoverCheck:V=!1}={})=>{y.settings.autoRefresh&&M.current.scrollTop===0&&(V||et)&&!ni()?N(!0):await l()&&R(!0)},[d,et,N,l,y.settings.autoRefresh]),$t=_();ye(V=>{if(V){const tt=Date.now()-$t.current;(!$t.current||tt>1e3*60)&&mt({disableHoverCheck:!0})}else $t.current=Date.now();A(V)},[l,mt,y.settings.autoRefresh]),dn(mt,j&&!L?u:null);const At=Q==="end"&&!Rt;return t("div",{id:`${d}-page`,class:"deck-container",ref:V=>{M.current=V,J.current=V,Tt.current=V,yt.current=V},tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{hidden:At,onClick:V=>{var tt;V.target.closest("a, button")||(tt=M.current)==null||tt.scrollTo({top:0,behavior:"smooth"})},onDblClick:V=>{V.target.closest("a, button")||N(!0)},class:S==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(oe,{}),f??t(G,{to:"/",class:"button plain home-button",children:t(w,{icon:"home",size:"l"})})]}),e&&(n||t("h1",{children:e})),t("div",{class:"header-side",children:!!p&&p})]}),b.length>0&&S!=="loading"&&!At&&L&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var V;N(!0),(V=M.current)==null||V.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New posts"]})]}),!!a&&t("div",{class:"timeline-start",children:a}),b.length?t(x,{children:[t("ul",{class:"timeline",children:[b.map(V=>{const{id:tt,reblog:P,items:W,type:C,_pinned:E}=V,B=(P==null?void 0:P.id)||tt,K=o?`/${o}/s/${B}`:`/s/${B}`;let H="";C==="boosts"?H=`${W.length} Boosts`:C==="pinned"&&(H="Pinned posts");const Lt=C==="boosts"||C==="pinned";if(W){if(Lt)return W.sort((lt,dt)=>lt._filtered&&!dt._filtered?1:!lt._filtered&&dt._filtered?-1:0),t("li",{class:"timeline-item-carousel",children:t(ti,{title:H,class:`${C}-carousel`,children:W.map(lt=>{const{id:dt,reblog:ct}=lt,It=(ct==null?void 0:ct.id)||dt,Mt=o?`/${o}/s/${It}`:`/s/${It}`;return t("li",{children:t(G,{class:"status-carousel-link timeline-item-alt",to:Mt,children:r?t(wt,{statusID:dt,instance:o,size:"s",contentTextWeight:!0,allowFilters:h}):t(wt,{status:lt,instance:o,size:"s",contentTextWeight:!0,allowFilters:h})})},dt)})})},`timeline-${tt}`);const ht=W.length>3;return W.map((lt,dt)=>{const{id:ct,_differentAuthor:It}=lt,Mt=o?`/${o}/s/${ct}`:`/s/${ct}`,F=dt>0&&dt<W.length-1,at=lt.sensitive&&!!lt.spoilerText,bt=!It&&at&&dt>0||ht&&F&&(C==="thread"||C==="conversation"&&!It&&!W[dt-1]._differentAuthor&&!W[dt+1]._differentAuthor);return t("li",{class:`timeline-item-container timeline-item-container-type-${C} timeline-item-container-${dt===0?"start":dt===W.length-1?"end":"middle"} ${It?"timeline-item-diff-author":""}`,children:t(G,{class:"status-link timeline-item",to:Mt,children:bt?t(ei,{status:lt,instance:o}):r?t(wt,{statusID:ct,instance:o,allowFilters:h}):t(wt,{status:lt,instance:o,allowFilters:h})})},`timeline-${ct}`)})}return t("li",{children:t(G,{class:"status-link timeline-item",to:K,children:r?t(wt,{statusID:tt,instance:o,allowFilters:h}):t(wt,{status:V,instance:o,allowFilters:h})})},`timeline-${tt+E}`)}),$&&S==="loading"&&t(x,{children:[t("li",{style:{height:"20vh"},children:t(wt,{skeleton:!0})}),t("li",{style:{height:"25vh"},children:t(wt,{skeleton:!0})})]})]}),S==="default"&&($?t(se,{onChange:V=>{V&&N()},children:t("button",{type:"button",class:"plain block",onClick:()=>N(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}))]}):S==="loading"?t("ul",{class:"timeline",children:Array.from({length:5}).map((V,tt)=>t("li",{children:t(wt,{skeleton:!0})},tt))}):S!=="error"&&t("p",{class:"ui-state",children:i}),S==="error"&&t("p",{class:"ui-state",children:[s,t("br",{}),t("br",{}),t("button",{class:"button plain",onClick:()=>N(!b.length),children:"Try again"})]})]})})}function ti({title:e,class:n,children:d}){const o=_(),{reachStart:i,reachEnd:s,init:r}=Se({scrollableRef:o,direction:"horizontal"});return z(()=>{r==null||r()},[]),t("div",{class:`status-carousel ${n}`,children:[t("header",{children:[t("h3",{children:e}),t("span",{children:[t("button",{type:"button",class:"small plain2",disabled:i,onClick:()=>{var c,m;(m=o.current)==null||m.scrollBy({left:-Math.min(320,(c=o.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-left"})})," ",t("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var c,m;(m=o.current)==null||m.scrollBy({left:Math.min(320,(c=o.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-right"})})]})]}),t("ul",{ref:o,children:d})]})}function ei({status:e,instance:n}){const d=ot(v),{id:o}=e,i=bn(e),s=Pe(o,n);return t("article",{class:"status compact-thread",tabindex:"-1",children:[d.statusThreadNumber[s]?t("div",{class:"status-thread-badge",children:[t(w,{icon:"thread",size:"s"}),d.statusThreadNumber[s]?` ${d.statusThreadNumber[s]}/X`:""]}):t("div",{class:"status-thread-badge",children:t(w,{icon:"thread",size:"s"})}),t("div",{class:"content-compact",title:i,children:[i,e.sensitive&&e.spoilerText&&t(x,{children:[" ",t("span",{class:"spoiler-badge",children:t(w,{icon:"eye-close",size:"s"})})]})]})]})}function ni(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const si=20;function ii(){const e=ot(v),{id:n,...d}=Kt(),[o,i]=Ut(),s=!o.get("replies"),r=!!o.get("boosts"),c=o.get("tagged"),m=!!o.get("media"),{masto:l,instance:u,authenticated:f}=q({instance:d.instance}),p=_();async function a(A){const M=[];if(A){const{value:J}=await l.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(J!=null&&J.length&&!c&&!m)if(J.forEach(Tt=>{Tt._pinned=!0,kt(Tt,u)}),J.length>=3){const Tt=J.map(yt=>yt.id);M.push({id:Tt,items:J,type:"pinned"})}else M.push(...J)}(A||!p.current)&&(p.current=l.v1.accounts.$select(n).statuses.list({limit:si,exclude_replies:s,exclude_reblogs:r,only_media:m,tagged:c}));const{value:N,done:nt}=await p.current.next();return N!=null&&N.length&&(M.push(...N),N.forEach(J=>{kt(J,u)})),{value:M,done:nt}}const[h,g]=T(),[y,b]=T([]);St(`${h!=null&&h.displayName?h.displayName+" ":""}@${h!=null&&h.acct?h.acct:"Account posts"}`,"/:instance?/a/:id"),z(()=>{(async()=>{try{const A=await l.v1.accounts.$select(n).fetch();g(A)}catch{}try{const A=await l.v1.accounts.$select(n).featuredTags.list(n);b(A)}catch{}})()},[n]);const{displayName:k,acct:S,emojis:I}=h||{},$=_(),U=ut(()=>{const A=e.accounts[`${n}@${u}`],M=!s||r||c||m;return t(x,{children:[t($n,{instance:u,account:A||n,fetchAccount:()=>l.v1.accounts.$select(n).fetch(),authenticated:f,standalone:!0}),t("div",{class:"filter-bar",ref:$,children:[M?t(G,{to:`/${u}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:t(w,{icon:"x",size:"l"})}):t(w,{icon:"filter",class:"insignificant",size:"l"}),t(G,{to:`/${u}/a/${n}${s?"?replies=1":""}`,onClick:()=>{s&&it("Showing post with replies")},class:s?"":"is-active",children:"+ Replies"}),t(G,{to:`/${u}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||it("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),t(G,{to:`/${u}/a/${n}${m?"":"?media=1"}`,onClick:()=>{m||it("Showing posts with media")},class:m?"is-active":"",children:"Media"}),y.map(N=>t(G,{to:`/${u}/a/${n}${c===N.name?"":`?tagged=${encodeURIComponent(N.name)}`}`,onClick:()=>{c!==N.name&&it(`Showing posts tagged with #${N.name}`)},class:c===N.name?"is-active":"",children:t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),N.name]})}))]})]})},[n,u,f,s,r,y,c,m]);z(()=>{var M;const A=(M=$.current)==null?void 0:M.querySelector(".is-active");A&&$.current.scrollTo({behavior:"smooth",left:A.offsetLeft-($.current.offsetWidth-A.offsetWidth)/2})},[y,c,m,s,r]);const L=ut(()=>h!=null&&h.url?new URL(h.url).hostname:null,[h]),j=!!h&&!(u===L);return t(Ft,{title:`${h!=null&&h.acct?"@"+h.acct:"Posts"}`,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:t(fn,{text:k,emojis:I})}),t("div",{children:t("span",{children:["@",S]})})]}),id:"account-statuses",instance:u,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:a,useItemID:!0,boostsCarousel:e.settings.boostsCarousel,timelineStart:U,refresh:s+r+c+m,headerEnd:t(ie,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(Z,{disabled:!j,onClick:()=>{(async()=>{try{const{masto:A}=q({instance:L}),M=await A.v1.accounts.lookup({acct:h.acct}),{id:N}=M;location.hash=`/${L}/a/${N}`}catch{alert("Unable to fetch account info")}})()},children:[t(w,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to account's instance (",t("b",{children:L}),")"]})]})})},n)}const oi=20;function Dn(){St("Bookmarks","/b");const{masto:e,instance:n}=q(),d=_();async function o(i){return(i||!d.current)&&(d.current=e.v1.bookmarks.list({limit:oi})),await d.current.next()}return t(Ft,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:o})}const ci=20;function En(){St("Favourites","/f");const{masto:e,instance:n}=q(),d=_();async function o(i){return(i||!d.current)&&(d.current=e.v1.favourites.list({limit:ci})),await d.current.next()}return t(Ft,{title:"Favourites",id:"favourites",emptyText:"No favourites yet. Go favourite something!",errorText:"Unable to load favourites",instance:n,fetchItems:o})}const ai=200;function li(){const{masto:e,instance:n}=q();St("Followed Hashtags","/ft");const[d,o]=T("default"),[i,s]=T([]);return z(()=>{o("loading"),(async()=>{try{const r=e.v1.followedTags.list({limit:ai}),c=[];do{const{value:m,done:l}=await r.next();if(l||(m==null?void 0:m.length)===0)break;c.push(...m)}while(!0);c.sort((m,l)=>m.name.localeCompare(l.name)),s(c),o("default")}catch{o("error")}})()},[]),t("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(oe,{}),t(G,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Followed Hashtags"}),t("div",{class:"header-side"})]})}),t("main",{children:i.length>0?t("ul",{class:"link-list",children:i.map(r=>t("li",{children:t(G,{to:n?`/${n}/t/${r.name}`:`/t/${r.name}`,children:[t(w,{icon:"hashtag"})," ",t("span",{children:r.name})]})}))}):d==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):d==="error"?t("p",{class:"ui-state",children:"Unable to load followed hashtags."}):t("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function ri(e,n,d){var m;const{filtered:o}=e;if(!(o!=null&&o.length)||d&&((m=e.account)==null?void 0:m.id)===d)return!0;const s=o.filter(l=>{const{filter:u}=l,f=u.context.includes(n);return f?u.expiresAt?new Date(u.expiresAt)>new Date:f:!1});if(!s.length)return!0;if(s.some(l=>l.filter.filterAction==="hide"))return!1;const c=s.some(l=>l.filter.filterAction==="warn");if(c){const l=s.map(u=>u.filter.title);e._filtered={titles:l,titlesStr:l.join(" • ")}}return c}function qt(e,n){if(!(e!=null&&e.length))return[];if(!n)return e;const d=X.session.get("currentAccount");return e.filter(o=>ri(o,n,d))}const di=20;function Oe({title:e,path:n,id:d,...o}){St(e||"Following",n||"/following");const{masto:i,streaming:s,instance:r}=q(),c=ot(v),m=_(),l=_();async function u(p){(p||!m.current)&&(m.current=i.v1.timelines.home.list({limit:di}));const a=await m.current.next();let{value:h}=a;return h!=null&&h.length&&(p&&(l.current=h[0].id),h=qt(h,"home"),h.forEach(g=>{kt(g,r)}),h=cn(h,r),h.sort((g,y)=>{const b=new Date(g.createdAt);return new Date(y.createdAt)-b})),{...a,value:h}}async function f(){try{const p=await i.v1.timelines.home.list({limit:5,since_id:l.current}).next();let{value:a}=p;return!!(a!=null&&a.length&&(l.current=a[0].id,a=cn(a,r),a=qt(a,"home"),a.some(h=>!h.reblog)))}catch{return!1}}return z(()=>{let p;return(async()=>{if(s){p=s.user.subscribe();for await(const a of p){if(!p)break;if(a.event==="status.update"){const h=a.payload;kt(h,r)}else if(a.event==="delete"){const h=a.payload,g=yn(h,r);g&&(g._deleted=!0)}}}})(),()=>{var a;(a=p==null?void 0:p.unsubscribe)==null||a.call(p),p=null}},[s]),t(Ft,{title:e||"Following",id:d||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:r,fetchItems:u,checkForUpdates:f,useItemID:!0,boostsCarousel:c.settings.boostsCarousel,...o,allowFilters:!0})}const ui=20,hi=4,an=hi+1;function Nn({columnMode:e,...n}){let{hashtag:d,...o}=e?{}:Kt();n.hashtag&&(d=n.hashtag);let i=d.trim().split(/[\s+]+/);i.sort(),d=i[0];const{masto:s,instance:r,authenticated:c}=q({instance:(n==null?void 0:n.instance)||o.instance}),{authenticated:m}=q(),l=i.map(I=>`#${I}`).join(" "),u=r?`${l} on ${r}`:l;St(u,"/:instance?/t/:hashtag");const f=_(),p=_(void 0);async function a(I){const $=await s.v1.timelines.tag.$select(d).list({limit:ui,any:i.slice(1),maxId:I?void 0:p.current}).next(),{value:U}=$;return U!=null&&U.length&&(I&&(f.current=U[0].id),U.forEach(L=>{kt(L,r)}),p.current=U[U.length-1].id),{...$,value:U}}async function h(){try{const I=await s.v1.timelines.tag.$select(d).list({limit:1,any:i.slice(1),since_id:f.current}).next(),{value:$}=I;return!!($!=null&&$.length)}catch{return!1}}const[g,y]=T("default"),[b,k]=T();z(()=>{(async()=>{try{const I=await s.v1.tags.$select(d).fetch();k(I)}catch{}})()},[d]);const S=i.length>=an;return t(Ft,{title:u,titleComponent:!!r&&t("h1",{class:"header-account",children:[t("b",{children:l}),t("div",{children:r})]}),id:"hashtag",instance:r,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:a,checkForUpdates:h,useItemID:!0,headerEnd:t(ie,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[!!b&&i.length===1&&t(x,{children:[t(Nt,{subMenu:!0,confirm:b.following,confirmLabel:`Unfollow #${d}?`,disabled:g==="loading"||!c,onClick:()=>{y("loading"),b.following?s.v1.tags.$select(d).unfollow().then(()=>{k({...b,following:!1}),it(`Unfollowed #${d}`)}).catch(I=>{alert(I)}).finally(()=>{y("default")}):s.v1.tags.$select(d).follow().then(()=>{k({...b,following:!0}),it(`Followed #${d}`)}).catch(I=>{alert(I)}).finally(()=>{y("default")})},children:b.following?t(x,{children:[t(w,{icon:"check-circle"})," ",t("span",{children:"Following…"})]}):t(x,{children:[t(w,{icon:"plus"})," ",t("span",{children:"Follow"})]})}),t(Dt,{})]}),t(rs,{className:"menu-field",disabled:S,children:({ref:I})=>t("form",{onSubmit:$=>{var L,R;$.preventDefault();const U=(R=(L=$.target[0].value)==null?void 0:L.trim)==null?void 0:R.call(L);U&&!i.some(j=>j.toLowerCase()===U.toLowerCase())&&(i.push(U),i.sort(),location.hash=r?`/${r}/t/${i.join("+")}`:`/t/${i.join("+")}`)},children:[t(w,{icon:"hashtag"}),t("input",{ref:I,type:"text",placeholder:S?`Max ${an} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:S})]})}),t(ds,{takeOverflow:!0,children:i.map((I,$)=>t(Z,{disabled:i.length===1,onClick:U=>{i.splice($,1),i.sort(),location.hash=r?`/${r}/t/${i.join("+")}`:`/t/${i.join("+")}`},children:[t(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),I]})]},I))}),t(Dt,{}),t(Z,{disabled:!m,onClick:()=>{const I={type:"hashtag",hashtag:i.join(" "),instance:r};v.shortcuts.some(U=>U.type===I.type&&U.hashtag.split(/[\s+]+/).sort().join(" ")===I.hashtag.split(/[\s+]+/).sort().join(" ")&&(U.instance?U.instance===I.instance:!0))?alert("This shortcut already exists"):(v.shortcuts.push(I),it("Hashtag shortcut added"))},children:[t(w,{icon:"shortcut"})," ",t("span",{children:"Add to Shorcuts"})]}),t(Z,{onClick:()=>{let I=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(I)){I&&alert("Invalid instance");return}I&&(I=I.toLowerCase().trim(),location.hash=`/${I}/t/${i.join("+")}`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},r+l)}const fi=20;function _n(e){var g;const n=ot(v),{masto:d,instance:o}=q(),i=(e==null?void 0:e.id)||((g=Kt())==null?void 0:g.id),s=_(),r=_();async function c(y){(y||!r.current)&&(r.current=d.v1.timelines.list.$select(i).list({limit:fi}));const b=await r.current.next();let{value:k}=b;return k!=null&&k.length&&(y&&(s.current=k[0].id),k=qt(k,"home"),k.forEach(S=>{kt(S,o)})),{...b,value:k}}async function m(){try{const y=await d.v1.timelines.list.$select(i).list({limit:1,since_id:s.current});let{value:b}=y;return b=qt(b,"home"),!!(b!=null&&b.length)}catch{return!1}}const[l,u]=T({title:"List"});St(l.title,"/l/:id"),z(()=>{(async()=>{try{const y=await d.v1.lists.$select(i).fetch();u(y)}catch{}})()},[i]);const[f,p]=T(!1),[a,h]=T(!1);return t(x,{children:[t(Ft,{title:l.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:o,fetchItems:c,checkForUpdates:m,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:t(G,{to:"/l",class:"button plain",children:t(w,{icon:"list",size:"l"})}),headerEnd:t(ie,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(Z,{onClick:()=>p({list:l}),children:[t(w,{icon:"pencil",size:"l"}),t("span",{children:"Edit"})]}),t(Z,{onClick:()=>h(!0),children:[t(w,{icon:"group",size:"l"}),t("span",{children:"Manage members"})]})]})},i),f&&t(pt,{class:"light",onClick:y=>{y.target===y.currentTarget&&p(!1)},children:t(ze,{list:f==null?void 0:f.list,onClose:y=>{y.state==="success"&&y.list?u(y.list):y.state==="deleted"&&(location.hash="/l"),p(!1)}})}),a&&t(pt,{class:"light",onClick:y=>{y.target===y.currentTarget&&h(!1)},children:t(mi,{listID:i,onClose:()=>h(!1)})})]})}const pi=40;function mi({listID:e,onClose:n}){const{masto:d,instance:o}=q(),[i,s]=T([]),[r,c]=T("default"),[m,l]=T(!1),u=_();async function f(p){l(!1),c("loading"),(async()=>{try{(p||!u.current)&&(u.current=d.v1.lists.$select(e).accounts.list({limit:pi}));const a=await u.current.next();let{done:h,value:g}=a;g!=null&&g.length?(s(p?g:i.concat(g)),l(!h)):l(!1),c("default")}catch{c("error")}})()}return z(()=>{f(!0)},[]),t("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Manage members"})}),t("main",{children:t("ul",{children:[i.map(p=>t("li",{children:[t(_t,{account:p,instance:o}),t(gi,{account:p,listID:e})]},p.id)),m&&r==="default"&&t(se,{as:"li",onChange:p=>p&&f(),children:t("button",{type:"button",class:"light block",onClick:f,children:"Show more…"})})]})})]})}function gi({account:e,listID:n}){const{masto:d}=q(),[o,i]=T("default"),[s,r]=T(!1);return t(Nt,{confirm:!s,confirmLabel:t("span",{children:["Remove @",e.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(i("loading"),(async()=>{try{await d.v1.lists.$select(n).accounts.create({accountIds:[e.id]}),i("default"),r(!1)}catch{i("error")}})()):(i("loading"),(async()=>{try{await d.v1.lists.$select(n).accounts.remove({accountIds:[e.id]}),i("default"),r(!0)}catch{i("error")}})())},children:t("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:o==="loading",children:s?"Add":"Remove…"})})}const ln=20,bi=new URLSearchParams;function Pn({columnMode:e,...n}){St("Mentions","/mentions");const{masto:d,instance:o}=q(),[i]=e?[bi]:Ut(),[s,r]=T(null),c=(n==null?void 0:n.type)||i.get("type")||s,m=_(),l=_();async function u(b){(b||!m.current)&&(m.current=d.v1.notifications.list({limit:ln,types:["mention"]}));const k=await m.current.next();let{value:S}=k;return S!=null&&S.length&&(b&&(l.current=S[0].id),S.forEach(({status:I})=>{kt(I,o)})),{...k,value:S==null?void 0:S.map(I=>I.status)}}const f=_(),p=_();async function a(b){(b||!f.current)&&(f.current=d.v1.conversations.list({limit:ln}));const k=await f.current.next();let{value:S}=k;return S=S==null?void 0:S.filter(I=>I.lastStatus),S!=null&&S.length&&(b&&(p.current=S[0].lastStatus.id),S.forEach(({lastStatus:I})=>{kt(I,o)})),{...k,value:S==null?void 0:S.map(I=>I.lastStatus)}}function h(...b){return c==="private"?a(...b):u(...b)}async function g(){if(c==="private")try{const b=await d.v1.conversations.list({limit:1,since_id:p.current}).next();let{value:k}=b;return k!=null&&k.length?(p.current=k[0].lastStatus.id,!0):!1}catch{return!1}else try{const b=await d.v1.notifications.list({limit:1,types:["mention"],since_id:l.current}).next();let{value:k}=b;return k!=null&&k.length?(l.current=k[0].id,!0):!1}catch{return!1}}const y=ut(()=>t("div",{class:"filter-bar centered",children:[t(G,{to:"/mentions",class:c?"":"is-active",onClick:b=>{e&&(b.preventDefault(),r(null))},children:"All"}),t(G,{to:"/mentions?type=private",class:c==="private"?"is-active":"",onClick:b=>{e&&(b.preventDefault(),r("private"))},children:"Private"})]}),[c]);return t(Ft,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:o,fetchItems:h,checkForUpdates:g,useItemID:!0,timelineStart:y,refresh:c})}function Un(e){const n={},d=[];for(let s=0,r=0;s<e.length;s++){const c=e[s],{status:m,account:l,type:u,createdAt:f}=c,p=new Date(f).toLocaleDateString();let a=u;(u==="favourite"||u==="reblog")&&(a="favourite+reblog");const h=`${m==null?void 0:m.id}-${a}-${p}`,g=n[h];if(a==="follow_request")d[r++]=c;else if(g!=null&&g.account){const y=g._accounts.find(b=>b.id===l.id);y?(y._types.push(u),y._types.sort().reverse()):(l._types=[u],g._accounts.push(l))}else{l._types=[u];let y=n[h]={...c,type:a,_accounts:[l]};d[r++]=y}}const o={},i=[];for(let s=0,r=0;s<d.length;s++){const c=d[s],{account:m,_accounts:l,type:u,createdAt:f}=c,p=new Date(f).toLocaleDateString();if(u==="favourite+reblog"&&m&&l.length===1){const a=`${m==null?void 0:m.id}-${u}-${p}`,h=o[a];if(h)h._statuses.push(c.status);else{let g=o[a]={...c,type:u,_statuses:[c.status]};i[r++]=g}}else i[r++]=c}return i}const yi=30,wi=new URLSearchParams;function vi({columnMode:e}){St("Notifications","/notifications");const{masto:n,instance:d}=q(),o=ot(v),[i,s]=T("default"),[r]=e?[wi]:Ut(),c=r.get("id"),m=r.get("access_token"),[l,u]=T(!1),[f,p]=T(!1),a=_(),{nearReachEnd:h,scrollDirection:g,reachStart:y,nearReachStart:b}=Se({scrollableRef:a}),k=g==="end"&&!b,[S,I]=T([]),[$,U]=T([]),L=_();async function R(D){(D||!L.current)&&(L.current=n.v1.notifications.list({limit:yi,excludeTypes:["follow_request"]}));const Y=await L.current.next(),et=Y.value;if(et!=null&&et.length){et.forEach($t=>{kt($t.status,d,{skipThreading:!0})});const mt=Un(et);D?(v.notificationsLast=et[0],v.notifications=mt,n.v1.markers.create({notifications:{lastReadId:et[0].id}}).catch(()=>{})):v.notifications.push(...mt)}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),Y}async function j(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const A=()=>{s("loading"),(async()=>{try{const D=await j();I(D),s("default")}catch{s("error")}})()};async function M(){try{return await n.v1.announcements.list()}catch{return[]}}const N=D=>{s("loading"),(async()=>{try{const Y=R(D),et=j(),mt=M();if(D){const At=await mt;At.sort((tt,P)=>{const W=new Date(tt.updatedAt||tt.createdAt);return new Date(P.updatedAt||P.createdAt)-W}),U(At);const V=await et;I(V)}const{done:$t}=await Y;u(!$t),s("default")}catch{s("error")}})()};z(()=>{N(!0)},[]),z(()=>{y&&N(!0)},[y]),z(()=>{h&&l&&N()},[h,l]);const nt=Sn(5e3),J=jt(()=>{var D;o.settings.autoRefresh&&((D=a.current)==null?void 0:D.scrollTop)===0&&nt&&!ki()&&o.notificationsShowNew&&i!=="loading"&&N(!0)},[nt,o.notificationsShowNew,o.settings.autoRefresh,i]);z(J,[o.notificationsShowNew]);const Tt=new Date,yt=new Date(Tt-24*60*60*1e3);let Q=new Date;const Rt=!o.notifications.some(D=>new Date(D.createdAt).toDateString()===Tt.toDateString()),xt=_();return z(()=>{c&&(v.routeNotification={id:c,accessToken:atob(m)})},[c,m]),z(()=>{i==="default"&&(async()=>{try{const D=await Cn();if(D!=null&&D.getNotifications){const Y=await D.getNotifications()}}catch{}})()},[i]),t("div",{id:"notifications-page",class:"deck-container",ref:a,tabIndex:"-1",children:t("div",{class:`timeline-deck deck ${f?"only-mentions":""}`,children:[t("header",{hidden:k,onClick:D=>{var Y;D.target.closest("a, button")||(Y=a.current)==null||Y.scrollTo({top:0,behavior:"smooth"})},class:i==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(oe,{}),t(G,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l",alt:"Home"})})]}),t("h1",{children:"Notifications"}),t("div",{class:"header-side"})]}),o.notificationsShowNew&&i!=="loading"&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var D;N(!0),(D=a.current)==null||D.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New notifications"]})]}),$.length>0&&t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("details",{class:"announcements",children:[t("summary",{children:[t("span",{children:[t(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",t("b",{children:["Announcement",$.length>1?"s":""]})," ",t("small",{class:"insignificant",children:d})]}),$.length>1&&t("span",{class:"announcements-nav-buttons",children:$.map((D,Y)=>t("button",{type:"button",class:"plain2 small",onClick:()=>{var et;(et=xt.current)==null||et.children[Y].scrollIntoView({behavior:"smooth",block:"nearest"})},children:Y+1}))})]}),t("ul",{class:`announcements-list-${$.length>1?"multiple":"single"}`,ref:xt,children:$.map(D=>t("li",{children:t(Si,{announcement:D})}))})]})})}),S.length>0&&t("div",{class:"follow-requests",children:[t("h2",{class:"timeline-header",children:"Follow requests"}),S.length>5?t("details",{children:[t("summary",{children:[S.length," follow requests"]}),t("ul",{children:S.map(D=>t("li",{children:[t(_t,{account:D}),t(Re,{accountID:D.id,onChange:()=>{}})]},D.id))})]}):t("ul",{children:S.map(D=>t("li",{children:[t(_t,{account:D}),t(Re,{accountID:D.id,onChange:()=>{}})]},D.id))})]}),t("div",{id:"mentions-option",children:t("label",{children:[t("input",{type:"checkbox",checked:f,onChange:D=>{p(D.target.checked)}})," ","Only mentions"]})}),t("h2",{class:"timeline-header",children:"Today"}),Rt&&!!o.notifications.length&&t("p",{class:"ui-state insignificant",children:i==="default"?"You're all caught up.":t(x,{children:"…"})}),o.notifications.length?t(x,{children:o.notifications.filter(D=>D.type!=="follow_request").map(D=>{if(f&&D.type!=="mention")return null;const Y=new Date(D.createdAt),et=Y.toDateString()!==Q.toDateString();et&&(Q=Y);const mt=Y.toDateString()===yt.toDateString()?"Yesterday":Ot(Q,{hideTime:!0});return t(x,{children:[et&&t("h2",{class:"timeline-header",children:mt}),t(Be,{instance:d,notification:D,reload:()=>{N(!0),A()}},D.id)]})})}):t(x,{children:[i==="loading"&&t(x,{children:t("ul",{class:"timeline flat",children:Array.from({length:5}).map((D,Y)=>t("li",{class:"notification skeleton",children:[t("div",{class:"notification-type",children:t(w,{icon:"notification",size:"xl"})}),t("div",{class:"notification-content",children:t("p",{children:"███████████ ████"})})]}))})}),i==="error"&&t("p",{class:"ui-state",children:["Unable to load notifications",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>N(!0),children:"Try again"})]})]}),l&&t("button",{type:"button",class:"plain block",disabled:i==="loading",onClick:()=>N(),style:{marginBlockEnd:"6em"},children:i==="loading"?t(gt,{abrupt:!0}):t(x,{children:"Show more…"})})]})})}function ki(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Si({announcement:e}){const{instance:n}=q(),{contact:d}=Xn(),o=d==null?void 0:d.account,{id:i,content:s,startsAt:r,endsAt:c,published:m,allDay:l,publishedAt:u,updatedAt:f,read:p,mentions:a,statuses:h,tags:g,emojis:y,reactions:b}=e,k=new Date(u),S=Ot(k),I=new Date(f),$=Ot(I);return t("div",{class:"announcement-block",children:[t(_t,{account:o}),t("div",{class:"announcement-content",onClick:hn({mentions:a,instance:n}),dangerouslySetInnerHTML:{__html:xe(s,{emojis:y})}}),t("p",{class:"insignificant",children:[t("time",{datetime:k.toISOString(),children:Ot(k)}),f&&$!==S&&t(x,{children:[" ","•"," ",t("span",{class:"ib",children:["Updated"," ",t("time",{datetime:I.toISOString(),children:Ot(I)})]})]})]}),t("div",{class:"announcement-reactions",hidden:!0,children:b.map(U=>{const{name:L,count:R,me:j,staticUrl:A,url:M}=U;return t("button",{type:"button",class:`plain4 small ${j?"reacted":""}`,children:[M||A?t("img",{src:M||A,alt:L,width:"16",height:"16"}):t("span",{children:L})," ",t("span",{class:"count",children:Et(R)})]})})})]})}const Fn=Gt(vi),Ii=20;function Ae({local:e,columnMode:n,...d}){const o=ot(v),i=!!e,s=n?{}:Kt(),{masto:r,instance:c}=q({instance:(d==null?void 0:d.instance)||s.instance}),m=`${i?"Local":"Federated"} timeline (${c})`;St(m,i?"/:instance?/p/l":"/:instance?/p");const l=_(),u=_();async function f(a){(a||!u.current)&&(u.current=r.v1.timelines.public.list({limit:Ii,local:i}));const h=await u.current.next();let{value:g}=h;return g!=null&&g.length&&(a&&(l.current=g[0].id),g=qt(g,"public"),g.forEach(y=>{kt(y,c)})),{...h,value:g}}async function p(){try{const a=await r.v1.timelines.public.list({limit:1,local:i,since_id:l.current}).next();let{value:h}=a;return h=qt(h,"public"),!!(h!=null&&h.length)}catch{return!1}}return t(Ft,{title:m,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:i?"Local timeline":"Federated timeline"}),t("div",{children:c})]}),id:"public",instance:c,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:p,useItemID:!0,headerStart:t(x,{}),boostsCarousel:o.settings.boostsCarousel,allowFilters:!0,headerEnd:t(ie,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(Z,{href:i?`/#/${c}/p`:`/#/${c}/p/l`,children:i?t(x,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Federated"})]}):t(x,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Local"})]})}),t(Dt,{}),t(Z,{onClick:()=>{let a=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(a)){a&&alert("Invalid instance");return}a&&(a=a.toLowerCase().trim(),location.hash=i?`/${a}/p/l`:`/${a}/p`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},c+i)}const Ci=20;function zn({columnMode:e,...n}){const d=ot(v),o=e?{}:Kt(),{masto:i,instance:s}=q({instance:(n==null?void 0:n.instance)||o.instance}),r=`Trending (${s})`;St(r,"/:instance?/trending");const c=_(),[m,l]=T([]),u=_();async function f(h){if(h||!u.current){u.current=i.v1.trends.statuses.list({limit:Ci});try{const b=i.v1.trends.tags.list(),{value:k}=await b.next();l(k)}catch{}}const g=await u.current.next();let{value:y}=g;return y!=null&&y.length&&(h&&(c.current=y[0].id),y=qt(y,"public"),y.forEach(b=>{kt(b,s)})),{...g,value:y}}async function p(){try{const h=await i.v1.trends.statuses.list({limit:1}).next();let{value:g}=h;return g=qt(g,"public"),g!=null&&g.length&&g[0].id!==c.current?(c.current=g[0].id,!0):!1}catch{return!1}}const a=ut(()=>m.length?t("div",{class:"filter-bar",children:[t(w,{icon:"chart",class:"insignificant",size:"l"}),m.map((h,g)=>{const{name:y,history:b}=h,k=b.reduce((S,I)=>S+ +I.uses,0);return t(G,{to:`/${s}/t/${y}`,children:[t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),y]}),t("span",{class:"filter-count",children:k.toLocaleString()})]})})]}):null,[m]);return t(Ft,{title:r,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:"Trending"}),t("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:p,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:t(x,{}),boostsCarousel:d.settings.boostsCarousel,allowFilters:!0,timelineStart:a,headerEnd:t(ie,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(Z,{onClick:()=>{let h=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(h)){h&&alert("Invalid instance");return}h&&(h=h.toLowerCase().trim(),location.hash=`/${h}/trending`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})})},s)}function Ti(){St("Home","/");const e=ot(v),{shortcuts:n}=e,d=n.map(o=>{if(!o)return null;const{type:i,...s}=o,r={following:Oe,notifications:Fn,list:_n,public:Ae,bookmarks:Dn,favourites:En,hashtag:Nn,mentions:Pn,trending:zn}[i];return r?t(r,{...s,columnMode:!0},i+JSON.stringify(s)):null});return vt(["1","2","3","4","5","6","7","8","9"],(o,i)=>{try{const s=parseInt(i.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),t("div",{id:"columns",children:d})}function xi(){var n;const e=ot(v);return z(()=>{(async()=>{const d=await te.drafts.keys();if(d.length){const o=mn();d.filter(s=>s.startsWith(o)).length&&(v.showDrafts=!0)}})()},[]),t(x,{children:(e.settings.shortcutsColumnsMode||e.settings.shortcutsViewMode==="multi-column")&&((n=e.shortcuts)!=null&&n.length)?t(Ti,{}):t(Oe,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:t($i,{})})})}function $i(){const e=ot(v),n=_(),[d,o]=T(void 0);return t(x,{children:[t(G,{ref:n,to:"/notifications",class:`button plain notifications-button ${e.notificationsShowNew?"has-badge":""} ${d}`,onClick:i=>{i.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(i.preventDefault(),o(s=>s?void 0:"open"))},children:t(w,{icon:"notification",size:"l",alt:"Notifications"})}),t(Ai,{state:d,anchorRef:n,onClose:()=>o(void 0)})]})}const Li=30,Ri=5;function Ai({anchorRef:e,state:n,onClose:d}){const{masto:o,instance:i}=q(),s=ot(v),[r,c]=T("default"),m=o.v1.notifications.list({limit:Li});async function l(){const h=await m.next(),g=h.value;if(g!=null&&g.length){g.forEach(b=>{kt(b.status,i,{skipThreading:!0})});const y=Un(g);v.notificationsLast=g[0],v.notifications=y,o.v1.markers.create({notifications:{lastReadId:g[0].id}}).catch(()=>{})}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),h}const[u,f]=T(!1);function p(){return o.v1.followRequests.list({limit:1})}function a(){c("loading"),(async()=>{try{await l();const h=await p();f(!!(h!=null&&h.length)),c("default")}catch{c("error")}})()}return z(()=>{n==="open"&&a()},[n]),t(vn,{menuClassName:"notifications-menu",state:n,anchorRef:e,onClose:d,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[t("header",{children:t("h2",{children:"Notifications"})}),t("main",{children:s.notifications.length?t(x,{children:s.notifications.slice(0,Ri).map(h=>t(Be,{instance:i,notification:h},h.id))}):r==="loading"?t("div",{class:"ui-state",children:t(gt,{abrupt:!0})}):r==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to fetch notifications."}),t("p",{children:t("button",{type:"button",onClick:a,children:"Try again"})})]})}),t("footer",{children:[t(G,{to:"/mentions",class:"button plain",children:[t(w,{icon:"at"})," ",t("span",{children:"Mentions"})]}),t(G,{to:"/notifications",class:"button plain2",children:[u?t(x,{children:[t("span",{class:"tag collapsed",children:"New"})," ",t("span",{children:"Follow Requests"})]}):t("b",{children:"See all"})," ",t(w,{icon:"arrow-right"})]})]})]})}const Mi=Gt(xi),Di=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,Ei=/\/notes\/([^\/]+)\/?$/i;function Bn(e){const{hostname:n,pathname:d}=new URL(e),[,o,i,s]=d.match(Di)||[];if(s)return`/${n}/s/${s}`;const[,r]=d.match(Ei)||[];if(r)return`/${n}/s/${r}`}function Ni(){const n=Ue().pathname.replace(/^\//,""),d=Bn(n);return Pt(()=>{d&&setTimeout(()=>{window.location.hash=d+"?view=full"},300)},[d]),t("div",{class:"ui-state",tabIndex:"-1",children:[d?t(x,{children:[t("h2",{children:"Redirecting…"}),t("p",{children:t("a",{href:`#${d}?view=full`,children:d})})]}):t(x,{children:[t("h2",{children:"Unable to process URL"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),t("hr",{}),t("p",{children:t(G,{to:"/",children:"Go home"})})]})}function _i(){const{masto:e}=q();St("Lists","/l");const[n,d]=T("default"),[o,i]=ve(l=>l+1,0),[s,r]=T([]);z(()=>{d("loading"),(async()=>{try{const l=await e.v1.lists.list();r(l),d("default")}catch{d("error")}})()},[o]);const[c,m]=T(!1);return t("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(oe,{}),t(G,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Lists"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>m(!0),children:t(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),t("main",{children:s.length>0?t("ul",{class:"link-list",children:s.map(l=>t("li",{children:t(G,{to:`/l/${l.id}`,children:t("span",{children:[t(w,{icon:"list"})," ",t("span",{children:l.title})]})})}))}):n==="loading"?t("p",{class:"ui-state",children:t(gt,{})}):n==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists yet."})})]}),c&&t(pt,{class:"light",onClick:l=>{l.target===l.currentTarget&&m(!1)},children:t(ze,{list:c==null?void 0:c.list,onClose:l=>{l.state==="success"&&i(),m(!1)}})})]})}const Pi=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:Ui,VITE_WEBSITE:Fi}={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},qe="read write follow push";async function zi({instanceURL:e}){const n=new URLSearchParams({client_name:Ui,redirect_uris:location.origin+location.pathname,scopes:qe,website:Fi});return await(await fetch(`https://${e}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Bi({instanceURL:e,client_id:n}){const d=new URLSearchParams({client_id:n,scope:qe,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${e}/oauth/authorize?${d.toString()}`}async function Oi({instanceURL:e,client_id:n,client_secret:d,code:o}){const i=new URLSearchParams({client_id:n,client_secret:d,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:o,scope:qe});return await(await fetch(`https://${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()})).json()}function qi(){St("Log in");const e=_(),n=X.local.get("instanceURL"),[d,o]=T("default"),[i]=Ut(),s=i.get("instance"),[r,c]=T(s||(n==null?void 0:n.toLowerCase())||""),[m,l]=T([]);z(()=>{(async()=>{try{const h=await(await fetch(Pi)).json();l(h)}catch{}})()},[]);const u=a=>{X.local.set("instanceURL",a),(async()=>{o("loading");try{const{client_id:h,client_secret:g,vapid_key:y}=await zi({instanceURL:a});h&&g?(X.session.set("clientID",h),X.session.set("clientSecret",g),X.session.set("vapidKey",y),location.href=await Bi({instanceURL:a,client_id:h})):alert("Failed to register application"),o("default")}catch{o("error")}})()},f=a=>{a.preventDefault();const{elements:h}=a.target;let g=h.instanceURL.value.toLowerCase();g=g.replace(/^https?:\/\//,"").replace(/\/+$/,""),g=g.replace(/^@?[^@]+@/,""),/\./.test(g)||(g=m.find(y=>y.includes(g))),u(g)},p=r?m.filter(a=>a.includes(r)).sort((a,h)=>{const g=a.toLowerCase().startsWith(r.toLowerCase()),y=h.toLowerCase().startsWith(r.toLowerCase());return g&&!y?-1:!g&&y?1:0}).slice(0,10):[];return t("main",{id:"login",style:{textAlign:"center"},children:t("form",{onSubmit:f,children:[t("h1",{children:"Log in"}),t("label",{children:[t("p",{children:"Instance"}),t("input",{value:r,required:!0,type:"text",class:"large",id:"instanceURL",ref:e,disabled:d==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:a=>{c(a.target.value)}}),(p==null?void 0:p.length)>0?t("ul",{id:"instances-suggestions",children:p.map(a=>t("li",{children:t("button",{type:"button",class:"plain4",onClick:()=>{u(a)},children:a})}))}):t("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),d==="error"&&t("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),t("div",{children:[t("button",{class:"large",disabled:d==="loading",children:"Log in"})," "]}),t(gt,{hidden:d!=="loading"}),t("hr",{}),t("p",{children:t("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),t("p",{children:t(G,{to:"/",children:"Go home"})})]})})}const ue=5,Te=40;function Hi(e){const n=Kt(),{masto:d,instance:o,authenticated:i}=q({instance:n.instance}),[s,r]=T("default"),[c]=Ut(),m=_(),l=(e==null?void 0:e.query)||c.get("q"),u=(e==null?void 0:e.type)||c.get("type");St(l?`Search: ${l}${u?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[u]})`:""}`:"Search","/search");const[f,p]=T(!1),a=_(0);z(()=>{a.current=0},[l,u]);const h=_();Pt(()=>{var L,R;(R=(L=h.current)==null?void 0:L.scrollTo)==null||R.call(L,0,0)},[l,u]);const[g,y]=T([]),[b,k]=T([]),[S,I]=T([]);z(()=>{y([]),k([]),I([])},[l]);const $={statuses:y,accounts:k,hashtags:I};function U(L){r("loading"),L&&!u&&(y(g.slice(0,ue)),k(b.slice(0,ue)),I(S.slice(0,ue))),(async()=>{var j,A;const R={q:l,resolve:i,limit:ue};u&&(R.limit=Te,R.type=u,i&&(R.offset=a.current));try{const M=await d.v2.search.fetch(R);if(u)if(L){$[u](M[u]);const N=(j=M[u])==null?void 0:j.length;a.current=Te,p(!!N)}else{$[u](nt=>[...nt,...M[u]]);const N=(A=M[u])==null?void 0:A.length;a.current=a.current+Te,p(!!N)}else y(M.statuses),k(M.accounts),I(M.hashtags),a.current=0,p(!1);r("default")}catch{r("error")}})()}return z(()=>{var L,R,j,A;l?((R=(L=m.current)==null?void 0:L.setValue)==null||R.call(L,l),U(!0)):(A=(j=m.current)==null?void 0:j.focus)==null||A.call(j)},[l,u,o]),vt("/",L=>{var R,j;(j=(R=m.current)==null?void 0:R.focus)==null||j.call(R)},{preventDefault:!0}),t("div",{id:"search-page",class:"deck-container",ref:h,children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:t(oe,{})}),t(Mn,{ref:m}),t("div",{class:"header-side",children:" "})]})}),t("main",{children:[!!l&&t("div",{class:"filter-bar",children:[!!u&&t(G,{to:`/search${l?`?q=${encodeURIComponent(l)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(l)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(l)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(l)}&type=statuses`}].sort((L,R)=>L.type===u?-1:R.type===u?1:0).map(L=>t(G,{to:L.to,children:L.label}))]}),l?t(x,{children:[(!u||u==="accounts")&&t(x,{children:[u!=="accounts"&&t("h2",{class:"timeline-header",children:"Accounts"}),b.length>0?t(x,{children:[t("ul",{class:"timeline flat accounts-list",children:b.map(L=>t("li",{children:t(_t,{account:L,instance:o,showStats:!0})},L.id))}),u!=="accounts"&&t("div",{class:"ui-state",children:t(G,{class:"plain button",to:`/search?q=${l}&type=accounts`,children:["See more accounts ",t(w,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No accounts found."}))]}),(!u||u==="hashtags")&&t(x,{children:[u!=="hashtags"&&t("h2",{class:"timeline-header",children:"Hashtags"}),S.length>0?t(x,{children:[t("ul",{class:"link-list hashtag-list",children:S.map(L=>t("li",{children:t(G,{to:o?`/${o}/t/${L.name}`:`/t/${L.name}`,children:[t(w,{icon:"hashtag"}),t("span",{children:L.name})]})},L.name))}),u!=="hashtags"&&t("div",{class:"ui-state",children:t(G,{class:"plain button",to:`/search?q=${l}&type=hashtags`,children:["See more hashtags ",t(w,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No hashtags found."}))]}),(!u||u==="statuses")&&t(x,{children:[u!=="statuses"&&t("h2",{class:"timeline-header",children:"Posts"}),g.length>0?t(x,{children:[t("ul",{class:"timeline",children:g.map(L=>t("li",{children:t(G,{class:"status-link",to:o?`/${o}/s/${L.id}`:`/s/${L.id}`,children:t(wt,{status:L})})},L.id))}),u!=="statuses"&&t("div",{class:"ui-state",children:t(G,{class:"plain button",to:`/search?q=${l}&type=statuses`,children:["See more posts ",t(w,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No posts found."}))]}),!!u&&(s==="default"?f?t(se,{onChange:L=>{L&&U()},children:t("button",{type:"button",class:"plain block",onClick:()=>U(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}))]}):s==="loading"?t("p",{class:"ui-state",children:t(gt,{abrupt:!0})}):t("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const he=40,Vi=10,ji=5;let Me={},me={},ge={};function De(e){delete me[e],delete ge[e]}const fe={block:"nearest",inline:"center",behavior:"smooth"};function Gi(e){const{id:n}=e,{masto:d,instance:o}=q({instance:e.instance}),i=ot(v),[s,r]=Ut(),c=s.get("media"),m=s.get("media-only"),l=parseInt(c||m,10);let u=l>0;const f=s.get("mediaStatusID"),p=yn(f,o);f&&!p&&(u=!1);const a=u&&!!m,h=Pe(n,o),[g,y]=T(v.statuses[h]);z(()=>{v.statuses[h]&&y(v.statuses[h])},[h]);const b=ut(()=>{const{prevLocation:I}=v,$=((I==null?void 0:I.pathname)||"")+((I==null?void 0:I.search)||""),U=ne("/:instance/s/:id",$)||ne("/s/:id",$);return!$||U?"/":$},[]);z(()=>{!g&&u&&(async()=>{try{const I=await d.v1.statuses.$select(n).fetch();kt(I,o),y(I)}catch{alert("Unable to load post."),location.hash=b}})()},[u]);const k=f?p==null?void 0:p.mediaAttachments:g==null?void 0:g.mediaAttachments,S=jt(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&i.prevLocation?history.back():a?location.hash=b:(s.delete("media"),s.delete("mediaStatusID"),r(s))},[a,b,i.prevLocation]);return t("div",{class:"deck-backdrop",children:[u?k!=null&&k.length?t(Rn,{mediaAttachments:k,statusID:f||n,instance:o,lang:g==null?void 0:g.language,index:l-1,onClose:S}):t("div",{class:"media-modal-container loading",children:t(gt,{abrupt:!0})}):t(G,{to:b}),!a&&t(Wi,{id:n,instance:e.instance,closeLink:b})]})}function Wi({id:e,closeLink:n="/",instance:d}){var W;const[o,i]=Ut(),s=o.get("media"),r=parseInt(s,10)>0,[c,m]=T(o.get("view")),l=!!parseInt(o.get("translate")),{masto:u,instance:f}=q({instance:d}),{masto:p,instance:a,authenticated:h}=q(),g=f===a,y=ot(v),[b,k]=T([]),[S,I]=T("default"),$=_(),U=Pe(e,f),L=_(0),R=_();z(()=>{var C;(C=R.current)==null||C.focus()},[]),z(()=>{var E;const C=us(()=>{if(!R.current)return;const{scrollTop:B}=R.current;S!=="loading"&&(ge[e]=B)},50);return(E=R.current)==null||E.addEventListener("scroll",C,{passive:!0}),C(),()=>{var B;C.cancel(),(B=R.current)==null||B.removeEventListener("scroll",C)}},[e,S!=="loading"]);const j=_(),A=({reloadHero:C}={})=>{I("loading");let E;const B=me[e];if(B){const K=B.filter(H=>v.statuses[U]);k(K)}else k([{id:e}]);return(async()=>{var lt,dt;const K=()=>Ye(()=>u.v1.statuses.$select(e).fetch(),{retries:4}),H=Ye(()=>u.v1.statuses.$select(e).context.fetch(),{retries:8}),Lt=!!y.statuses[U];let ht=y.statuses[U];if(!(Lt&&!C))try{ht=await K(),kt(ht,f),await new Promise(ct=>{setTimeout(ct,100)})}catch{I("error");return}try{let ct=function(O){return O==null?void 0:O.map(rt=>({id:rt.id,account:rt.account,repliesCount:rt.repliesCount,content:rt.content,weight:ee(rt),replies:ct(rt.__replies)}))};const It=await H,{ancestors:Mt,descendants:F}=It;L.current=(F==null?void 0:F.length)||0;const at=new Set;Mt.forEach(O=>{kt(O,f,{skipThreading:!0}),O.inReplyToId&&!Mt.find(rt=>rt.id===O.inReplyToId)&&at.add(O.inReplyToId)});const bt=Mt.every(O=>O.account.id===ht.account.id),st=[];F.forEach(O=>{if(kt(O,f,{skipThreading:!0}),O.inReplyToId&&!F.find(rt=>rt.id===O.inReplyToId)&&O.inReplyToId!==ht.id&&at.add(O.inReplyToId),O.inReplyToAccountId===O.account.id)st.push(O);else if(O.inReplyToId===ht.id)st.push(O);else if(!O.inReplyToAccountId&&st.find(rt=>rt.id===O.inReplyToId)&&O.account.id===ht.account.id)st.push(O);else{const rt=F.find(Jt=>Jt.id===O.inReplyToId);rt&&(rt.__replies||(rt.__replies=[]),rt.__replies.push(O))}}),at.size;const zt=[...Mt.map(O=>({id:O.id,ancestor:!0,isThread:bt,accountID:O.account.id,account:O.account,repliesCount:O.repliesCount,weight:ee(O)})),{id:e,accountID:ht.account.id,weight:ee(ht)},...st.map(O=>({id:O.id,account:O.account,accountID:O.account.id,descendant:!0,thread:O.account.id===ht.account.id,weight:ee(O),replies:ct(O.__replies)}))];I("default"),j.current={offsetTop:(lt=$.current)==null?void 0:lt.offsetTop,scrollTop:(dt=R.current)==null?void 0:dt.scrollTop};const Bt=zt.findIndex(O=>O.id===e);Bt>=yt&&Q(Bt+1),k(zt),me[e]=zt,Zn(ht,f)}catch{I("error")}})(),()=>{clearTimeout(E)}};z(A,[e,u]),z(()=>{var E,B;if(!b.length)return;const C=ge[e];if(C)R.current.scrollTop=C;else if(j.current){const K={offsetTop:(E=$.current)==null?void 0:E.offsetTop,scrollTop:(B=R.current)==null?void 0:B.scrollTop},H=K.offsetTop-j.current.offsetTop+K.scrollTop;R.current.scrollTop=H}else b.length===1&&(R.current.scrollTop=0);j.current=null},[b]),z(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:C}=Qt(),E=`https://${C}/api/v1/statuses/${e}/context`;return await(await caches.open("api")).delete(E,{ignoreVary:!0}),A({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),z(()=>()=>{ge={},v.reloadStatusPage=0,me={},Me={},Ee.clear()},[]);const M=y.statuses[U]||y.statuses[e],N=ut(()=>{if(!M)return"";const{account:C}=M,E=document.createElement("div");return E.innerHTML=C.displayName,E.innerText.trim()},[M]),nt=ut(()=>{if(!M)return"";let C=bn(M);return C.length>64&&(C=C.slice(0,64)+"…"),C},[M]);St(N&&nt?`${N}: "${nt}"`:"Status","/:instance?/s/:id");const J=ut(()=>{if(!M)return;const{url:C}=M;if(C)return new URL(C).hostname},[M]),Tt=ut(()=>{if(J)return J===f},[J,f]),[yt,Q]=T(he),Rt=ut(()=>b.length-yt,[b.length,yt]),xt=b.some(C=>C.descendant),D=b.filter(C=>C.ancestor),[Y,et]=T(!0),mt=kn(et,100),$t=ut(()=>{if(!$.current||Y)return null;const{top:C}=$.current.getBoundingClientRect();return C>0?"down":"up"},[Y]);vt("esc",()=>{location.hash=n},{enabled:!r}),vt("backspace",()=>{location.hash=n}),vt("j",()=>{const C=document.activeElement.closest(".status-link, .status-focus"),E=C==null?void 0:C.getBoundingClientRect(),B=Array.from(R.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(C&&E.top<R.current.clientHeight&&E.bottom>0){const K=B.indexOf(C);let H=B[K+1];H&&(H.focus(),H.scrollIntoView(fe))}else{const K=B.find(H=>{const Lt=H.getBoundingClientRect();return Lt.top>=44&&Lt.left>=0});K&&(K.focus(),K.scrollIntoView(fe))}}),vt("k",()=>{const C=document.activeElement.closest(".status-link, .status-focus"),E=C==null?void 0:C.getBoundingClientRect(),B=Array.from(R.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(C&&E.top<R.current.clientHeight&&E.bottom>0){const K=B.indexOf(C);let H=B[K-1];H&&(H.focus(),H.scrollIntoView(fe))}else{const K=B.find(H=>{const Lt=H.getBoundingClientRect();return Lt.top>=44&&Lt.left>=0});K&&(K.focus(),K.scrollIntoView(fe))}}),vt("x",()=>{const C=document.activeElement.closest(".status-link, .status-focus");if(C){const E=C.nextElementSibling;E&&E.tagName.toLowerCase()==="details"&&(E.open=!E.open)}});const{nearReachStart:At}=Se({scrollableRef:R,distanceFromStartPx:16}),V=_(r?"media+status":"status"),tt=jt((C,E,B,K)=>{C.preventDefault(),C.stopPropagation(),i({media:E+1,mediaStatusID:K.id})},[e]),P=jt((C,E)=>{De(E.id)},[]);return t("div",{tabIndex:"-1",ref:R,class:`status-deck deck contained ${b.length>1?"padded-bottom":""} ${V.current==="status"?"slide-in":""} ${c?`deck-view-${c}`:""}`,onAnimationEnd:C=>{V.current==="status"&&(V.current=null)},children:[t("header",{class:`${Y?"inview":""} ${S==="loading"?"loading":""}`,onDblClick:C=>{v.reloadStatusPage++},children:t("div",{class:"header-grid header-grid-2",children:[t("h1",{children:[!!/\/s\//i.test((W=y.prevLocation)==null?void 0:W.pathname)&&t("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:t(w,{icon:"chevron-left",size:"xl"})}),!Y&&M&&S!=="loading"?t(x,{children:[t("span",{class:"hero-heading",children:[t(Ne,{account:M.account,instance:f,showAvatar:!0,short:!0})," ",t("span",{class:"insignificant",children:["•"," ",t(_e,{datetime:M.createdAt,format:"micro"})]})]})," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:C=>{C.preventDefault(),C.stopPropagation(),$.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:t(w,{icon:$t==="down"?"arrow-down":"arrow-up"})})]}):t(x,{children:["Post"," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:C=>{C.preventDefault(),C.stopPropagation(),R.current.scrollTo({top:0,behavior:"smooth"})},hidden:!D.length||At,title:`${D.length} posts above ‒ Go to top`,children:[t(w,{icon:"arrow-up"}),D.filter((C,E,B)=>B.findIndex(K=>K.accountID===C.accountID)===E).slice(0,3).map(C=>t(Vt,{url:C.account.avatar,alt:C.account.displayName},C.account.id)),D.length>3&&t(x,{children:[" ",t("span",{class:"insignificant",children:Et(D.length)})]})]})]})]}),t("div",{class:"header-side",children:[t(Wt,{align:"end",portal:{target:R.current},menuButton:t("button",{type:"button",class:"button plain4",children:t(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[t(Z,{disabled:S==="loading",onClick:()=>{v.reloadStatusPage++},children:[t(w,{icon:"refresh"}),t("span",{children:"Refresh"})]}),t(Z,{className:"menu-switch-view",onClick:()=>{m(c==="full"?null:"full"),o.delete("media"),o.delete("media-only"),c==="full"?o.delete("view"):o.set("view","full"),i(o)},children:[t(w,{icon:{"":"layout5",full:"layout4"}[c||""]}),t("span",{children:["Switch to ",c==="full"?"Side Peek":"Full"," view"]})]}),t(Z,{onClick:()=>{Array.from(R.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(E=>{E.click()})},children:[t(w,{icon:"eye-open"})," ",t("span",{children:"Show all sensitive content"})]}),t(Dt,{}),t(hs,{className:"plain",children:"Experimental"}),t(Z,{disabled:Tt,onClick:()=>{const C=Bn(M.url);C?location.hash=C:alert("Unable to switch")},children:[t(w,{icon:"transfer"}),t("small",{class:"menu-double-lines",children:["Switch to post's instance (",t("b",{children:J}),")"]})]})]}),t(G,{class:"button plain deck-close",to:n,children:t(w,{icon:"x",size:"xl"})})]})]})}),b.length&&M?t("ul",{class:`timeline flat contextual grow ${S==="loading"?"loading":""}`,children:[b.slice(0,yt).map(C=>{const{id:E,ancestor:B,isThread:K,descendant:H,thread:Lt,replies:ht,repliesCount:lt,weight:dt}=C,ct=E===e;return t("li",{ref:ct?$:null,class:`${B?"ancestor":""} ${H?"descendant":""} ${Lt?"thread":""} ${ct?"hero":""}`,children:[ct?t(x,{children:[t(se,{threshold:.1,onChange:mt,class:"status-focus",tabIndex:0,children:t(wt,{statusID:E,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:l})}),S!=="loading"&&!h?t("div",{class:"post-status-banner",children:[t("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),t(G,{to:"/login",class:"button",children:"Log in"})]}):!g&&t("div",{class:"post-status-banner",children:[t("p",{children:["This post is from another instance (",t("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),t("button",{type:"button",disabled:S==="loading",onClick:()=>{I("loading"),(async()=>{try{const It=await p.v2.search.fetch({q:M.url,type:"statuses",resolve:!0,limit:1});if(It.statuses.length){const Mt=It.statuses[0];location.hash=a?`/${a}/s/${Mt.id}`:`/s/${Mt.id}`}else throw new Error("No results")}catch(It){I("default"),alert("Error: "+It)}})()},children:[t(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):t(G,{class:"status-link",to:f?`/${f}/s/${E}`:`/s/${E}`,onClick:()=>{De(E)},children:[t(wt,{statusID:E,instance:f,withinContext:!0,size:Lt||B?"m":"s",enableTranslate:!0,onMediaClick:tt,onStatusLinkClick:P}),B&&K&&lt>1&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:lt,children:Et(lt)})]})," "]}),H&&(ht==null?void 0:ht.length)>0&&t(On,{instance:f,replies:ht,hasParentThread:Lt,level:1,accWeight:dt,openAll:L.current<Vi}),S==="loading"&&ct&&!!(M!=null&&M.repliesCount)&&!xt&&t("div",{class:"status-loading",children:t(gt,{})}),S==="error"&&ct&&!!(M!=null&&M.repliesCount)&&!xt&&t("div",{class:"status-error",children:["Unable to load replies.",t("br",{}),t("button",{type:"button",class:"plain",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]},E)}),Rt>0&&t("li",{children:t("button",{type:"button",class:"plain block show-more",disabled:S==="loading",onClick:()=>Q(C=>C+he),style:{marginBlockEnd:"6em"},children:[t("div",{class:"ib",children:b.slice(yt,yt+5).map(C=>t(Vt,{url:C.account.avatarStatic},C.id))})," ",t("div",{class:"ib",children:["Show more…"," ",t("span",{class:"tag",children:Rt>he?`${he}+`:Rt})]})]})})]}):t(x,{children:[S==="loading"&&t("ul",{class:"timeline flat contextual grow loading",children:t("li",{children:t(wt,{skeleton:!0,size:"l"})})}),S==="error"&&t("p",{class:"ui-state",children:["Unable to load post",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]})]})}function On({replies:e,instance:n,hasParentThread:d,level:o,accWeight:i,openAll:s}){const[r,c]=Ut(),m=b=>b.reduce((k,S)=>{const{repliesCount:I,replies:$}=S,U=($==null?void 0:$.length)||I;return k+U+m($||[])},0),l=e.length+m(e),u=e.length===l,f=e.map(b=>b.account).filter((b,k,S)=>S.findIndex(I=>I.id===b.id)===k).slice(0,3),p=ut(()=>e==null?void 0:e.reduce((b,k)=>b+(k==null?void 0:k.weight),i),[i,e==null?void 0:e.length]);let a=!1;(s||p<=ji||!d&&l===1&&ee(e[0])<2)&&(a=!0);const h=Me[e[0].id],g=jt((b,k,S,I)=>{b.preventDefault(),b.stopPropagation(),c({media:k+1,mediaStatusID:I.id})},[]),y=_();return Pt(()=>{var k;function b(S){S.target.dataset.scrollLeft=S.target.scrollLeft}return(k=y.current)==null||k.addEventListener("scroll",b,{passive:!0}),()=>{var S;(S=y.current)==null||S.removeEventListener("scroll",b)}},[]),t("details",{ref:y,class:"replies",open:h||a,onToggle:b=>{const{open:k}=b.target;Me[e[0].id]=k},style:{"--comments-level":o},"data-comments-level":o,"data-comments-level-overflow":o>4,children:[t("summary",{class:"replies-summary",hidden:a,children:[t("span",{class:"avatars",children:f.map(b=>t(Vt,{url:b.avatarStatic,title:`${b.displayName} @${b.username}`,squircle:b==null?void 0:b.bot},b.id))}),t("span",{children:[t("span",{title:e.length,children:Et(e.length)})," ","repl",e.length===1?"y":"ies"]}),!u&&l>1&&t(x,{children:[" ","·"," ",t("span",{children:[t("span",{title:l,children:Et(l)})," ","comment",l===1?"":"s"]})]})]}),t("ul",{children:e.map(b=>{var k,S;return t("li",{children:[t(G,{class:"status-link",to:n?`/${n}/s/${b.id}`:`/s/${b.id}`,onClick:()=>{De(b.id)},children:[t(wt,{statusID:b.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:g}),!((k=b.replies)!=null&&k.length)&&b.repliesCount>0&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:b.repliesCount,children:Et(b.repliesCount)})]})]}),((S=b.replies)==null?void 0:S.length)&&t(On,{instance:n,replies:b.replies,level:o+1,accWeight:a?p:b.weight,openAll:s})]},b.id)})})]})}const Ki=140,Ji=35,Yi=70,Xi=140,Ee=new Map;function ee(e){var a,h;const n=Ee.get(e.id);if(n)return n;const{spoilerText:d,content:o,mediaAttachments:i,poll:s,card:r}=e,c=Qn(d+o),m=i!=null&&i.length?Ki:0,l=(((a=s==null?void 0:s.options)==null?void 0:a.length)||0)*Ji,u=r&&(i!=null&&i.length||(h=s==null?void 0:s.options)!=null&&h.length)?0:Yi,p=(c+m+l+u)/Xi;return Ee.set(e.id,p),p}const Zi=Gt(Gi);function Qi(){const e=Kt(),{id:n,instance:d}=e;return t(Zi,{id:n,instance:d})}const to=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,eo=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,no=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,so=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,io=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,oo=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function rn(){return St(null,["/","/welcome"]),t("main",{id:"welcome",children:[t("div",{class:"hero-container",children:[t("h1",{children:[t("img",{src:In,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),t("img",{src:oo,alt:"Phanpy",width:"250"})]}),t("p",{children:t("big",{children:t("b",{children:t(G,{to:"/login",class:"button",children:"Log in"})})})}),t("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),t("div",{id:"why-container",children:t("div",{class:"sections",children:[t("section",{children:[t("img",{src:to,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),t("h4",{children:"Boosts Carousel"}),t("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),t("section",{children:[t("img",{src:io,alt:"Screenshot of nested comments thread",loading:"lazy"}),t("h4",{children:"Nested comments thread"}),t("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),t("section",{children:[t("img",{src:eo,alt:"Screenshot of grouped notifications",loading:"lazy"}),t("h4",{children:"Grouped notifications"}),t("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),t("section",{children:[t("img",{src:no,alt:"Screenshot of multi-column UI",loading:"lazy"}),t("h4",{children:"Single or multi-column"}),t("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),t("section",{children:[t("img",{src:so,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),t("h4",{children:"Multi-hashtag timeline"}),t("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),t("hr",{}),t("p",{children:[t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:e=>{e.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const co=window.alert;window.__nativeAlert||(window.__nativeAlert=co);window.alert=function(e){e instanceof Error&&(e!=null&&e.message)&&(e=e.message),typeof e!="string"&&(e=JSON.stringify(e));const n=fs({text:e,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=v;setTimeout(()=>{var e,n,d,o;for(const i in re)Array.isArray(re[i])?(n=(e=re[i])[0])==null||n.call(e):(o=(d=re)[i])==null||o.call(d)},5e3);function ao(){const e=ot(v),[n,d]=T(!1),[o,i]=T("loading");Pt(()=>{const u=X.local.get("theme");u&&(document.documentElement.classList.add(`is-${u}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",u==="auto"?"dark light":u));const f=X.local.get("textSize");f&&document.documentElement.style.setProperty("--text-size",`${f}px`)},[]),z(()=>{const u=X.local.get("instanceURL"),f=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(f){window.history.replaceState({},document.title,s.pathname||"/");const p=X.session.get("clientID"),a=X.session.get("clientSecret"),h=X.session.get("vapidKey");(async()=>{i("loading");const{access_token:g}=await Oi({instanceURL:u,client_id:p,client_secret:a,code:f}),y=ts({instance:u,accessToken:g});await Promise.allSettled([Ge(y,u),es(y,u,g,h)]),We(),Ke(y),d(!0),i("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const p=Qt();if(p){X.session.set("currentAccount",p.info.id);const{client:a}=q({account:p}),{instance:h}=a;We(),Ke(a),i("loading"),(async()=>{try{await Ge(a,h)}catch{}finally{d(!0),i("default")}})()}else i("default")}},[]);let s=Ue();v.currentLocation=s.pathname,z($e,[s,n]);const r=e.prevLocation,c=_(r||null);if(ut(()=>ne("/:instance/s/:id",s.pathname)||ne("/s/:id",s.pathname),[s.pathname,ne])?c.current||(c.current=r):c.current=null,/\/https?:/.test(s.pathname))return t(Ni,{});const l=ut(()=>{const{pathname:u}=s;return!/^\/(login|welcome)/.test(u)},[s]);return z(()=>{var f;const u=document.getElementById("app");u&&(u.dataset.shortcutsViewMode=(f=e.shortcuts)!=null&&f.length?e.settings.shortcutsViewMode:"")},[e.shortcuts,e.settings.shortcutsViewMode]),z(()=>{document.body.classList.toggle("cloak",e.settings.cloakMode)},[e.settings.cloakMode]),t(x,{children:[t(Ie,{location:l||s,children:[t(ft,{path:"/",element:n?t(Mi,{}):o==="loading"?t(gt,{id:"loader-root"}):t(rn,{})}),t(ft,{path:"/login",element:t(qi,{})}),t(ft,{path:"/welcome",element:t(rn,{})})]}),t(Ie,{location:c.current||s,children:[n&&t(ft,{path:"/notifications",element:t(Fn,{})}),n&&t(ft,{path:"/mentions",element:t(Pn,{})}),n&&t(ft,{path:"/following",element:t(Oe,{})}),n&&t(ft,{path:"/b",element:t(Dn,{})}),n&&t(ft,{path:"/f",element:t(En,{})}),n&&t(ft,{path:"/l",children:[t(ft,{index:!0,element:t(_i,{})}),t(ft,{path:":id",element:t(_n,{})})]}),n&&t(ft,{path:"/ft",element:t(li,{})}),t(ft,{path:"/:instance?/t/:hashtag",element:t(Nn,{})}),t(ft,{path:"/:instance?/a/:id",element:t(ii,{})}),t(ft,{path:"/:instance?/p",children:[t(ft,{index:!0,element:t(Ae,{})}),t(ft,{path:"l",element:t(Ae,{local:!0})})]}),t(ft,{path:"/:instance?/trending",element:t(zn,{})}),t(ft,{path:"/:instance?/search",element:t(Hi,{})})]}),o==="default"&&t(Ie,{children:t(ft,{path:"/:instance?/s/:id",element:t(Qi,{})})}),n&&t(bs,{}),n&&!e.settings.shortcutsColumnsMode&&e.settings.shortcutsViewMode!=="multi-column"&&t(Xs,{}),t(Ks,{}),n&&t(Js,{}),t(gs,{isLoggedIn:n}),o!=="loading"&&t(Ys,{onClose:$e}),t(ys,{})]})}ps(t(ms,{children:t(ao,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("iconify")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("iconify")&&sessionStorage.removeItem(e)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-9b624736.js.map
