import{s as k,a as F,b as xe,u as $n,c as le,o as as,I as v,M as Se,d as te,A as et,N as St,e as Ne,f as Fe,L as Y,g as ot,h as Cn,l as rs,t as Xt,R as $t,i as ls,p as tt,j as qe,k as xn,m as _t,E as Ln,n as _e,q as Ye,r as ds,v as ve,w as Qt,T as Mn,x as lt,y as An,z as en,B as Rn,C as Re,D as us,S as Me,F as hs,G as fs,H as je,J as En,K as Pt,O as ps,P as Dn,Q as Ae,U as ft,V as _n,W as ms,X as gs,Y as bs,Z as mt,_ as ys,$ as tn,a0 as ws,a1 as nn,a2 as sn}from"./useTitle-PsUNIdja.js";import{_ as P,p as U,h as $,u as Ce,w as ze,a as e,b as ge,g as L,s as Ct,c as Ht,M as ee,d as Ee,e as ct,F as de,T as He,S as vs,I as at,y as Ve,f as Pn,l as on,i as Nn,j as Un,k as Oe,A as ks,N as Ss,q as Is,J as Ts,C as Fn,m as zn,n as nt,o as On,r as $s,t as Cs,v as xs,x as ut,z as Bn,B as cn,D as Ls,R as Vt,E as ke,H as Ms,G as As}from"./vendor-GFeCuUbE.js";function ht(t=()=>{},n=[]){const c=P(t);U(()=>{c.current=t},[n]),U(()=>{const o=()=>{const i=document.hidden||document.visibilityState==="hidden";c.current(!i)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[])}const Rs=1e3*3,Es=15e3,Ds=ze(function({isLoggedIn:n}){const[c,o]=$(!0);ht(o);const i=async(a,d,r)=>{var f;if(k.notificationsLast){const u=a.v1.notifications.list({limit:1,sinceId:k.notificationsLast.id}),{value:m}=await u.next();if(m!=null&&m.length)if(r)k.notificationsShowNew=!0;else{let h;try{const y=await a.v1.markers.fetch({timeline:"notifications"});h=(f=y==null?void 0:y.notifications)==null?void 0:f.lastReadId}catch{}h?k.notificationsShowNew=m[0].id!==h:k.notificationsShowNew=!0}}};U(()=>{let a,d;if(n&&c){const{masto:r,streaming:f,instance:u}=F();(async()=>{await i(r,u);let m=!1;f&&(d=setTimeout(()=>{(async()=>{try{m=!0,a=f.user.notification.subscribe();for await(const h of a){if(!a||!c)break;h.event==="notification"&&xe(h.payload,u,{skipThreading:!0}),k.notificationsShowNew=!0}}catch{m=!1}m||(d=setInterval(()=>{i(r,u,!0)},Es))})()},Rs))})()}return()=>{var r;(r=a==null?void 0:a.unsubscribe)==null||r.call(a),a=null,clearTimeout(d),clearInterval(d)}},[c,n]);const s=P(),l=()=>{s.current=Date.now(),fetch("./version.json").then(a=>a.json()).then(a=>{a&&(k.appVersion=a)}).catch(a=>{})};return $n(l,c&&1e3*60*30),ht(a=>{a&&(s.current?Date.now()-s.current>1e3*60*60&&l():l())}),Ce("shift+alt+k",()=>{const a=k.settings.cloakMode;k.settings.cloakMode=!a,le({text:`Cloak mode ${a?"disabled":"enabled"}`})}),null});function _s(){function t(n){n.shiftKey?as()||(k.showCompose=!0):k.showCompose=!0}return Ce("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(v,{icon:"quill",size:"xl",alt:"Compose"})})}const Ps=ze(function(){const n=ge(k);function c(){k.showKeyboardShortcutsHelp=!1}Ce("?, shift+?",i=>{k.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")});const o=Ce("esc",c,[]);return!!n.showKeyboardShortcutsHelp&&e(Se,{class:"light",onClick:i=>{i.target===i.currentTarget&&c()},children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:o,children:[e("button",{type:"button",class:"sheet-close",onClick:c,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e(L,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(L,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(L,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"c"})]})},{action:"Send post",keys:e(L,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:e(L,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"Alt"})," + ",e("kbd",{children:"k"})]})}].map(({action:i,className:s,keys:l})=>e("tr",{children:[e("th",{class:s,children:i}),e("td",{children:l})]},i))})})]})})});function Ns({onClose:t}){const{masto:n}=F(),c=te.local.getJSON("accounts"),o=te.session.get("currentAccount"),i=c.length>1,[s,l]=Ct(d=>d+1,0),[a]=Ht();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(v,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:a,children:c.map((d,r)=>{const f=d.info.id===o,u=r===0;return e("li",{children:[e("div",{children:[i&&e("span",{class:`current ${f?"is-current":""}`,children:e(v,{icon:"check-circle",alt:"Current"})}),e(et,{url:d.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const m=await n.v1.accounts.$select(d.info.id).fetch();d.info=m,te.local.setJSON("accounts",c),l()}catch{}}}),e(St,{account:i?{...d.info,acct:/@/.test(d.info.acct)?d.info.acct:`${d.info.acct}@${d.instanceURL}`}:d.info,showAcct:!0,onClick:()=>{f?k.showAccount=`${d.info.username}@${d.instanceURL}`:(te.session.set("currentAccount",d.info.id),location.reload())}})]}),e("div",{class:"actions",children:[u&&i&&e(L,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Ne,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(v,{icon:"more",size:"l",alt:"More"})}),children:[e(ee,{onClick:()=>{k.showAccount=`${d.info.username}@${d.instanceURL}`},children:[e(v,{icon:"user"}),e("span",{children:"View profile…"})]}),e(Ee,{}),i&&e(ee,{disabled:u,onClick:()=>{c.splice(r,1),c.unshift(d),te.local.setJSON("accounts",c),l()},children:[e(v,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Fe,{subMenu:!0,confirmLabel:e(L,{children:[e(v,{icon:"exit"}),e("span",{children:["Log out @",d.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{c.splice(r,1),te.local.setJSON("accounts",c),location.href=location.pathname||"/"},children:[e(v,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},d.info.id)})}),e("p",{children:e(Y,{to:"/login",class:"button plain2",onClick:t,children:[e(v,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),i&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const jt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e";function an(t){const{masto:n}=F();return n.v1.push.subscription.create(t)}function Us(){const{masto:t}=F();return t.v1.push.subscription.fetch()}function Fs(t){const{masto:n}=F();return n.v1.push.subscription.update(t)}function zs(){const{masto:t}=F();return t.v1.push.subscription.remove()}function xt(){return"serviceWorker"in navigator&&"PushManager"in window}function Os(){return navigator.serviceWorker.getRegistration()}async function Gt(){const t=await Os(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function qn(t){const n="=".repeat((4-t.length%4)%4),c=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(c),i=new Uint8Array(o.length);for(let s=0;s<o.length;++s)i[s]=o.charCodeAt(s);return i}async function Bs(){if(!xt())return;const{subscription:t}=await Gt();let n=null;try{n=await Us()}catch(c){if(!/(not found|unknown)/i.test(c.message))throw c}if(n&&t){const c=n.endpoint===t.endpoint,{vapidKey:o}=ot(),i=n.serverKey===o;if(!c)throw new Error("Backend subscription endpoint changed");if(!i)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:c}=ot(),{applicationServerKey:o}=t.options,i=qn(c).toString(),s=new Uint8Array(o).toString();if(!(i===s))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function rn({data:t,policy:n}){if(!xt())return;let{registration:c,subscription:o}=await Gt(),i=null;if(o)try{i=await Fs({data:t,policy:n})}catch{i=await an({subscription:o,data:t,policy:n})}else{const{vapidKey:s}=ot();if(!s)throw new Error("No server key found");o=await c.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:qn(s)}),i=await an({subscription:o,data:t,policy:n})}return{subscription:o,backendSubscription:i}}async function ln(){if(!xt())return;const{subscription:t}=await Gt();t&&(await zs(),await t.unsubscribe())}const dn=16,Qe=[15,16,17,18,19,20];function qs({onClose:t}){const n=ge(k),c=te.local.get("theme")||"auto",o=P(),i=n.settings.contentTranslationTargetLanguage||null,s=Cn(),l=rs(s),a=te.local.get("textSize")||dn,[d,r]=$(te.account.get("preferences")||{}),{masto:f,authenticated:u,instance:m}=F();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:o,onInput:h=>{h.preventDefault();const g=new FormData(o.current).get("theme"),w=document.documentElement;g==="auto"?w.classList.remove("is-light","is-dark"):(w.classList.toggle("is-light",g==="light"),w.classList.toggle("is-dark",g==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",g==="auto"?"dark light":g),g==="auto"?te.local.del("theme"):te.local.set("theme",g)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:c==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:c==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:c!=="light"&&c!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:Qe[0]},children:"A"})," ",e("input",{type:"range",min:Qe[0],max:Qe[Qe.length-1],step:"1",value:a,list:"sizes",onChange:h=>{const y=parseInt(h.target.value,10);document.documentElement.style.setProperty("--text-size",`${y}px`),y===dn?te.local.del("textSize"):te.local.set("textSize",h.target.value)}})," ",e("span",{style:{fontSize:Qe[Qe.length-1]},children:"A"}),e("datalist",{id:"sizes",children:Qe.map(h=>e("option",{value:h}))})]})]})]})}),u&&e(L,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(v,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:d["posting:default:visibility"]||"public",onChange:h=>{const{value:y}=h.target;(async()=>{try{await f.v1.accounts.updateCredentials({source:{privacy:y}}),r({...d,"posting:default:visibility":y}),te.account.set("preferences",{...d,"posting:default:visibility":y})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(v,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${m}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",m,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:h=>{k.settings.autoRefresh=h.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:h=>{k.settings.boostsCarousel=h.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:h=>{const{checked:y}=h.target;k.settings.contentTranslation=y,y||(k.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:i||"",disabled:!n.settings.contentTranslation,onChange:h=>{k.settings.contentTranslationTargetLanguage=h.target.value||null},children:[e("option",{value:"",children:["System language (",l,")"]}),e("option",{disabled:!0,children:"──────────"}),Xt.map(h=>e("option",{value:h.code,children:h.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(L,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Xt.map(h=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(h.code),onChange:y=>{const{checked:g}=y.target;g?k.settings.contentTranslationHideLanguages.push(h.code):k.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(w=>w!==h.code)}})," ",h.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses an external API to translate, powered by"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:h=>{k.settings.contentTranslationAutoInline=h.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:h=>{k.settings.cloakMode=h.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),u&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{k.showDrafts=!0,k.showSettings=!1},children:"Unsent drafts"})})]})}),u&&e(Hs,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:jt,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:h=>{h.preventDefault(),k.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:h=>{h.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:["Version:"," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2023-12-18T05:07:34.830Z".slice(0,10).replace(/-/g,".")}.bfd0cc3`,onClick:h=>{h.target.select();try{navigator.clipboard.writeText(h.target.value),le("Version string copied")}catch{le("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/bfd0cc3",target:"_blank",rel:"noopener noreferrer",children:e($t,{datetime:new Date("2023-12-18T05:07:34.830Z")})}),")"]})]})]})]})]})}function Hs({onClose:t}){if(!xt())return null;const{instance:n}=F(),[c,o]=$("default"),i=P(),[s,l]=$(!1),[a,d]=$(!1),r=P();U(()=>{(async()=>{o("loading");try{const{subscription:u,backendSubscription:m}=await Bs();if(m!=null&&m.policy&&m.policy!=="none"){l(!0);const{alerts:h,policy:y}=m;r.current=y;const{elements:g}=i.current,w=g.namedItem(y);w&&(w.value=y),Object.keys(h).forEach(p=>{const b=g.namedItem(p);(b==null?void 0:b.type)==="checkbox"&&(b.checked=!0)})}o("default")}catch(u){/outside.*authorized/i.test(u.message)?d(!0):alert((u==null?void 0:u.message)||u),o("error")}})()},[]);const f=c==="loading";return e("form",{ref:i,onChange:()=>{const u=Object.fromEntries(new FormData(i.current)),m=!!u["policy-allow"],h={policy:u.policy,data:{alerts:{mention:!!u.mention,favourite:!!u.favourite,reblog:!!u.reblog,follow:!!u.follow,follow_request:!!u.followRequest,poll:!!u.poll,update:!!u.update,status:!!u.status}}};let y=0;Object.keys(h.data.alerts).forEach(w=>{h.data.alerts[w]?y++:delete h.data.alerts[w]});const g=r.current!==h.policy;m&&y>0?g?ln().then(()=>{rn(h)}).catch(w=>{alert("Failed to update subscription. Please try again.")}):rn(h).catch(w=>{alert("Failed to update subscription. Please try again.")}):ln().catch(w=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:f||a,name:"policy-allow",checked:s,onChange:async u=>{const{checked:m}=u.target;if(m){const h=await Notification.requestPermission();h==="granted"?l(!0):(l(!1),h==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else l(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:f||a||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(u=>e("option",{value:u.value,children:u.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(u=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:u.value})," ",u.label]})}))})})})}),a&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(Y,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const Nt=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const c=document.querySelectorAll("#modal-container > *");if(c!=null&&c.length){const l=c[c.length-1],a=l.querySelector('[tabindex="-1"]')||l;if(a){a.focus();return}}if(document.querySelector(".deck-backdrop"))return;const i=document.querySelectorAll(".deck-container"),s=i[i.length-1];s&&s.tabIndex===-1&&s.focus()}},100);return()=>clearTimeout(t)};function Hn(t){if(!t)return;const n=ct(),c=P(n.pathname);U(()=>{c.current&&n.pathname!==c.current&&(t==null||t())},[n.pathname,t])}function Wt({list:t,onClose:n}){const{masto:c}=F(),[o,i]=$("default"),s=!!t,l=P(),a=P(),d=P();U(()=>{s&&(l.current.value=t.title,a.current.value=t.repliesPolicy,d.current&&(d.current.checked=t.exclusive))},[s]);const r=ls("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(v,{icon:"x"})})," ",e("header",{children:e("h2",{children:s?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:f=>{f.preventDefault();const u=new FormData(f.target),m=u.get("title"),h=u.get("replies_policy"),y=u.get("exclusive")==="on";i("loading"),(async()=>{try{let g;s?g=await c.v1.lists.$select(t.id).update({title:m,replies_policy:h,exclusive:y}):g=await c.v1.lists.create({title:m,replies_policy:h,exclusive:y}),i("default"),n==null||n({state:"success",list:g})}catch{i("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:l,type:"text",id:"list-title",name:"title",required:!0,disabled:o==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:a,name:"replies_policy",required:!0,disabled:o==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),r&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:d,type:"checkbox",name:"exclusive",disabled:o==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:o==="loading",children:s?"Save":"Create"}),s&&e(Fe,{disabled:o==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{i("loading"),(async()=>{try{await c.v1.lists.$select(t.id).remove(),i("default"),n==null||n({state:"deleted"})}catch{i("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete…"})})]})]})})]})}const Vs=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],un={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},hn=80,Vn=1e3*60*10;function js(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Gs=tt(js,{maxAge:Vn});async function Ws(t,n){const c=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:o}=await c,i={total:o.length,originals:0,replies:0,boosts:0};return o.forEach(s=>{s.reblog?i.boosts++:s.inReplyToId&&s.inReplyToAccountId!==s.account.id?i.replies++:i.originals++}),o.length&&(i.daysSinceLastPost=Math.ceil((Date.now()-new Date(o[o.length-1].createdAt))/864e5)),i}const Ks=tt(Ws,{maxAge:Vn});function jn({account:t,fetchAccount:n=()=>{},standalone:c,instance:o,authenticated:i}){const{masto:s}=F({instance:o}),{masto:l,instance:a}=F(),[d,r]=$("default"),f=typeof t=="string",[u,m]=$(f?null:t),h=de(()=>o===a,[o,a]);U(()=>{if(!f){m(t);return}r("loading"),(async()=>{try{const q=await n();k.accounts[`${q.id}@${o}`]=q,m(q),r("default")}catch{m(null),r("error")}})()},[f,t,n]);const{acct:y,avatar:g,avatarStatic:w,bot:p,createdAt:b,displayName:S,emojis:T,fields:C,followersCount:E,followingCount:z,group:M,id:_,lastStatusAt:x,locked:G,note:R,statusesCount:D,url:B,username:se,memorial:ie,moved:pe,roles:X}=u||{};let Le=!1,{header:fe,headerStatic:W}=u||{};(!fe||/missing\.png$/.test(fe))&&g&&!/missing\.png$/.test(g)&&(fe=g,Le=!0,w&&!/missing\.png$/.test(w)&&(W=w));const A=de(()=>_===te.session.get("currentAccount"),[_]);U(()=>{const q=!!(u!=null&&u.id&&(u!=null&&u.username)&&(u!=null&&u.acct)&&(u!=null&&u.avatar)&&(u!=null&&u.avatarStatic)&&(u!=null&&u.displayName)&&(u!=null&&u.url));if(A&&o&&q){const oe=te.local.getJSON("accounts");let me=!1;oe.forEach(ae=>{ae.info.id===u.id&&ae.instanceURL===o&&(ae.info=u,me=!0)}),me&&te.local.setJSON("accounts",oe)}},[A,u,o]);const V=de(()=>B?new URL(B).hostname:null,[B]),[Q,re]=$([]),we=P(),Ie=P([]);async function Te(q){(q||!we.current)&&(we.current=s.v1.accounts.$select(_).followers.list({limit:hn}));const oe=await we.current.next();if(A||!h)return oe;const{value:me}=oe;let ae=[];if(q){const Pe=await s.v1.accounts.familiarFollowers.fetch({id:[_]});Ie.current=Pe[0].accounts,ae=[...Ie.current,...me.filter(Be=>!Ie.current.some(De=>De.id===Be.id))]}else me!=null&&me.length&&(ae=me.filter(Pe=>!Ie.current.some(Be=>Be.id===Pe.id)));return{...oe,value:ae}}const j=P();async function O(q){return(q||!j.current)&&(j.current=s.v1.accounts.$select(_).following.list({limit:hn})),await j.current.next()}const H=c?"div":Y,ue=o?`/${o}/a/${_}`:`/a/${_}`,[ce,J]=$([]),[I,N]=$(),[Z,ne]=$("default"),he=!!(I!=null&&I.total),$e=async q=>{try{const oe=await Gs(q,l);J(oe[0].accounts.slice(0,Zs))}catch{}},be=async()=>{if(_){ne("loading");try{const q=await Ks(_,s);N(q),ne("default")}catch{ne("error")}}},We=He(({relationship:q,currentID:oe})=>{q.following||($e(oe),!c&&D>0&&be())},[c,_,D]);return e("div",{tabIndex:"-1",class:`account-container  ${d==="loading"?"skeleton":""}`,style:{"--header-color-1":Q[0],"--header-color-2":Q[1],"--header-color-3":Q[2],"--header-color-4":Q[3]},children:[d==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:f?t:B,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(v,{icon:"external"})]})})]}),d==="loading"?e(L,{children:[e("header",{children:e(qe,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(v,{icon:"more",size:"l",alt:"More"})})})]})]})]}):u&&e(L,{children:[!!pe&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:S})," has indicated that their new account is now:"]}),e(qe,{account:pe,instance:o,onClick:q=>{q.stopPropagation(),k.showAccount=pe}})]}),!!fe&&!/missing\.png$/.test(fe)&&e("img",{src:fe,alt:"",class:`header-banner ${Le?"header-is-avatar":""}`,onError:q=>{q.target.crossOrigin?q.target.src!==W?q.target.src=W:(q.target.removeAttribute("crossorigin"),q.target.src=fe):q.target.src!==W?q.target.src=W:q.target.remove()},crossOrigin:"anonymous",onLoad:q=>{q.target.classList.add("loaded");try{const oe=document.createElement("canvas"),me=oe.getContext("2d",{willReadFrequently:!0});oe.width=q.target.width,oe.height=q.target.height,me.drawImage(q.target,0,0);const ae=10,Be=[me.getImageData(0,0,ae,ae).data,me.getImageData(q.target.width-ae,0,ae,ae).data,me.getImageData(0,q.target.height-ae,ae,ae).data,me.getImageData(q.target.width-ae,q.target.height-ae,ae,ae).data].map(De=>{let Ue=0,Ke=0,Xe=0,K=0;for(let Ze=0;Ze<De.length;Ze+=4)Ue+=De[Ze],Ke+=De[Ze+1],Xe+=De[Ze+2],K+=De[Ze+3];const ye=De.length/4;return[Ue/ye,Ke/ye,Xe/ye,K/ye]}).map(De=>{const[Ue,Ke,Xe,K]=Js(De);return`rgba(${Ue}, ${Ke}, ${Xe}, ${K})`});re(Be)}catch{}}}),e("header",{children:e(qe,{account:u,instance:o,avatarSize:"xxxl",external:c,internal:!c})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!ie&&e("span",{class:"tag",children:"In Memoriam"}),!!p&&e("span",{class:"tag",children:[e(v,{icon:"bot"})," Automated"]}),!!M&&e("span",{class:"tag",children:[e(v,{icon:"group"})," Group"]}),X==null?void 0:X.map(q=>e("span",{class:"tag",children:[q.name,!!V&&e(L,{children:[" ",e("span",{class:"more-insignificant",children:V})]})]})),e("div",{class:"note",dir:"auto",onClick:xn({instance:a}),dangerouslySetInnerHTML:{__html:_t(R,{emojis:T})}}),e("div",{class:"account-metadata-box",children:[(C==null?void 0:C.length)>0&&e("div",{class:"profile-metadata",children:C.map(({name:q,value:oe,verifiedAt:me},ae)=>e("div",{class:`profile-field ${me?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(Ln,{text:q,emojis:T})," ",!!me&&e(v,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:_t(oe,{emojis:T})}})]},q+ae))}),e("div",{class:"stats",children:[e(H,{tabIndex:0,to:ue,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Followers",fetchAccounts:Te}},0)},children:[!!ce.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:ce.map(q=>e(et,{url:q.avatarStatic,size:"s",alt:`${q.displayName} @${q.acct}`,squircle:q==null?void 0:q.bot}))})}),e("span",{title:E,children:_e(E)})," ","Followers"]}),e(H,{class:"insignificant",tabIndex:0,to:ue,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Following",fetchAccounts:O}},0)},children:[e("span",{title:z,children:_e(z)})," ","Following",e("br",{})]}),e(H,{class:"insignificant",to:ue,children:[e("span",{title:D,children:_e(D)})," ","Posts"]}),!!b&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:b,children:Ye(b,{hideTime:!0})})]})]})]}),!!I&&e(H,{to:ue,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:he?e("div",{class:"posting-stats",title:`${Math.round(I.originals/I.total*100)}% original posts, ${Math.round(I.replies/I.total*100)}% replies, ${Math.round(I.boosts/I.total*100)}% boosts`,children:[e("div",{children:I.daysSinceLastPost<365?`Last ${I.total} post${I.total>1?"s":""} in the past 
                      ${I.daysSinceLastPost} day${I.daysSinceLastPost>1?"s":""}`:`
                      Last ${I.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${I.originals/I.total*100}%`,"--replies-percentage":`${(I.originals+I.replies)/I.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!I,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:Z==="loading",onClick:()=>{be()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${Z==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(Ys,{info:u,instance:o,authenticated:i,onRelationshipChange:We})})]})]})}const Zs=3;function Ys({info:t,instance:n,authenticated:c,onRelationshipChange:o=()=>{}}){var j;if(!t)return null;const{masto:i,instance:s,authenticated:l}=F(),a=n===s,[d,r]=$("default"),[f,u]=$(null),{id:m,acct:h,url:y,username:g,locked:w,lastStatusAt:p,note:b,fields:S,moved:T}=t,C=P(m),{following:E,showingReblogs:z,notifying:M,followedBy:_,blocking:x,blockedBy:G,muting:R,mutingNotifications:D,requested:B,domainBlocking:se,endorsed:ie,note:pe}=f||{},[X,Le]=$(null),[fe,W]=$(!1);U(()=>{if(t){const O=te.session.get("currentAccount");let H;(async()=>{if(a&&c)H=m;else if(!a&&l){const ce=t.acct.includes("@");try{const J=await i.v2.search.fetch({q:ce?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});J.accounts.length&&(H=J.accounts[0].id,Le(J.accounts[0]))}catch{}}if(!H)return;if(O===H){W(!0);return}if(C.current=H,T)return;r("loading");const ue=i.v1.accounts.relationships.fetch({id:[H]});try{const ce=await ue;if(r("default"),ce.length){const J=ce[0];u(J),o({relationship:J,currentID:H})}}catch{r("error")}})()}},[t,c]),U(()=>{t&&fe&&ds(t)},[t,fe]);const A=d==="loading",[V,Q]=$(!1),[re,we]=$(!1),[Ie,Te]=$(!1);return e(L,{children:[e("div",{class:"actions",children:[e("span",{children:[_?e("span",{class:"tag",children:"Following you"}):p?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:Ye(p,{hideTime:!0})})]}):e("span",{}),R&&e("span",{class:"tag danger",children:"Muted"}),x&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!pe&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{Te(!0)},dir:"auto",children:e("span",{children:pe})}),e(Ne,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:A,children:e(v,{icon:"more",size:"l",alt:"More"})}),children:[l&&!fe&&e(L,{children:[e(ee,{onClick:()=>{k.showCompose={draftStatus:{status:`@${(X==null?void 0:X.acct)||h} `}}},children:[e(v,{icon:"at"}),e("span",{children:["Mention @",g]})]}),e(ee,{onClick:()=>{Q(!0)},children:[e(v,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(ee,{onClick:()=>{Te(!0)},children:[e(v,{icon:"pencil"}),e("span",{children:pe?"Edit private note":"Add private note"})]}),E&&e(ee,{onClick:()=>{we(!0)},children:[e(v,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(Ee,{})]}),e(ee,{href:y,target:"_blank",children:[e(v,{icon:"external"}),e("small",{class:"menu-double-lines",children:Xs(y)})]}),e("div",{class:"menu-horizontal",children:[e(ee,{onClick:()=>{try{navigator.clipboard.writeText(y),le("Link copied")}catch{le("Unable to copy link")}},children:[e(v,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((j=navigator==null?void 0:navigator.canShare)==null?void 0:j.call(navigator,{url:y}))&&e(ee,{onClick:()=>{try{navigator.share({url:y})}catch{alert("Sharing doesn't seem to work.")}},children:[e(v,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!f&&e(L,{children:[e(Ee,{}),R?e(ee,{onClick:()=>{r("loading"),(async()=>{try{const O=await i.v1.accounts.$select((X==null?void 0:X.id)||m).unmute();u(O),r("default"),le(`Unmuted @${g}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{r("error")}})()},children:[e(v,{icon:"unmute"}),e("span",{children:["Unmute @",g]})]}):e(vs,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(L,{children:[e(v,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",g,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(v,{icon:"time"}),e(v,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:Vs.map(O=>e(ee,{onClick:()=>{r("loading"),(async()=>{try{const H=await i.v1.accounts.$select((X==null?void 0:X.id)||m).mute({duration:O});u(H),r("default"),le(`Muted @${g} for ${un[O]}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{r("error"),le(`Unable to mute @${g}`)}})()},children:un[O]}))})}),e(Fe,{subMenu:!0,confirm:!x,confirmLabel:e(L,{children:[e(v,{icon:"block"}),e("span",{children:["Block @",g,"?"]})]}),menuItemClassName:"danger",onClick:()=>{r("loading"),(async()=>{try{if(x){const O=await i.v1.accounts.$select((X==null?void 0:X.id)||m).unblock();u(O),r("default"),le(`Unblocked @${g}`)}else{const O=await i.v1.accounts.$select((X==null?void 0:X.id)||m).block();u(O),r("default"),le(`Blocked @${g}`)}k.reloadGenericAccounts.id="block",k.reloadGenericAccounts.counter++}catch{r("error"),x?le(`Unable to unblock @${g}`):le(`Unable to block @${g}`)}})()},children:x?e(L,{children:[e(v,{icon:"unblock"}),e("span",{children:["Unblock @",g]})]}):e(L,{children:[e(v,{icon:"block"}),e("span",{children:["Block @",g,"…"]})]})})]})]}),!f&&d==="loading"&&e(ve,{abrupt:!0}),!!f&&e(Fe,{confirm:E||B,confirmLabel:e("span",{children:B?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:A,onClick:()=>{r("loading"),(async()=>{try{let O;E||B?O=await i.v1.accounts.$select(C.current).unfollow():O=await i.v1.accounts.$select(C.current).follow(),O&&u(O),r("default")}catch(O){alert(O),r("error")}})()},children:e("button",{type:"button",class:`${E||B?"light swap":""}`,"data-swap-state":E||B?"danger":"",disabled:A,children:E?e(L,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):B?e(L,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):w?e(L,{children:[e(v,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!V&&e(Se,{class:"light",onClose:()=>{Q(!1)},children:e(Qs,{note:b,fields:S,onClose:()=>Q(!1)})}),!!re&&e(Se,{class:"light",onClose:()=>{we(!1)},children:e(ei,{accountID:C.current,onClose:()=>we(!1)})}),!!Ie&&e(Se,{class:"light",onClose:()=>{Te(!1)},children:e(ti,{account:t,note:pe,onRelationshipChange:O=>{u(O)},onClose:()=>Te(!1)})})]})}function Js([t,n,c]){const o=.2126*t+.7152*n+.0722*c;let i;return o>=220?i=1:o<=50?i=.1:i=o/255,i=Math.min(1,i),[t,n,c,i]}function Xs(t){if(!t)return;const n=new URL(t),{host:c,pathname:o}=n,i=o.replace(/\/$/,"").replace(/^\//,"");return e(L,{children:[e("span",{class:"more-insignificant",children:[c,"/"]}),e("wbr",{}),e("span",{children:i})]})}function Qs({note:t,fields:n,onClose:c}){const o=(n==null?void 0:n.map(({name:s,value:l})=>`${s}
${Qt(l)}`).join(`

`))||"",i=Qt(t)+(o?`

${o}`:"");return e("div",{class:"sheet",children:[!!c&&e("button",{type:"button",class:"sheet-close",onClick:c,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:i}),e(Mn,{forceTranslate:!0,text:i})]})]})}function ei({accountID:t,onClose:n}){const{masto:c}=F(),[o,i]=$("default"),[s,l]=$([]),[a,d]=$([]),[r,f]=Ct(h=>h+1,0);U(()=>{i("loading"),(async()=>{try{const h=await c.v1.lists.list();h.sort((g,w)=>g.title.localeCompare(w.title));const y=await c.v1.accounts.$select(t).lists.list();l(h),d(y),i("default")}catch{i("error")}})()},[r]);const[u,m]=$(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[s.length>0?e("ul",{class:"list-add-remove",children:s.map(h=>{const y=a.some(g=>g.id===h.id);return e("li",{children:e("button",{type:"button",class:`light ${y?"checked":""}`,disabled:o==="loading",onClick:()=>{i("loading"),(async()=>{try{y?await c.v1.lists.$select(h.id).accounts.remove({accountIds:[t]}):await c.v1.lists.$select(h.id).accounts.create({accountIds:[t]}),f()}catch{i("error"),alert(y?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(v,{icon:"check-circle"}),e("span",{children:h.title})]})})})}):o==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):o==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>m(!0),disabled:o!=="default",children:[e(v,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),u&&e(Se,{class:"light",onClick:h=>{h.target===h.currentTarget&&m(!1)},children:e(Wt,{list:u==null?void 0:u.list,onClose:h=>{h.state==="success"&&f(),m(!1)}})})]})}function ti({account:t,note:n,onRelationshipChange:c=()=>{},onClose:o=()=>{}}){const{masto:i}=F(),[s,l]=$("default"),a=P(null);return U(()=>{let d;return a.current&&!n&&(d=setTimeout(()=>{var r,f;(f=(r=a.current).focus)==null||f.call(r)},100)),()=>{clearTimeout(d)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(v,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:d=>{d.preventDefault();const f=new FormData(d.target).get("note");(f==null?void 0:f.trim())!==(n==null?void 0:n.trim())&&(l("loading"),(async()=>{try{const u=await i.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:f});l("default"),c(u),o()}catch(u){l("error"),alert((u==null?void 0:u.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:a,name:"note",disabled:s==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:s==="loading",onClick:()=>{o==null||o()},children:"Cancel"}),e("span",{children:[e(ve,{abrupt:!0,hidden:s!=="loading"}),e("button",{disabled:s==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function ni({account:t,instance:n,onClose:c}){const{masto:o,instance:i,authenticated:s}=F({instance:n}),l=typeof t=="string";return U(()=>{l||(k.accounts[`${t.id}@${i}`]=t)},[t]),Hn(c),e("div",{class:"sheet",children:[!!c&&e("button",{type:"button",class:"sheet-close outer",onClick:c,children:e(v,{icon:"x"})}),e(jn,{instance:i,authenticated:s,account:t,fetchAccount:async()=>{if(l)try{return await o.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const d=await o.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:s});if(d.accounts.length)return d.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const f=new URL(t).pathname.replace(/^\//,""),u=await o.v2.search.fetch({q:f,type:"accounts",limit:1,resolve:s});if(u.accounts.length)return u.accounts[0]}}else return t}})]})}function si({onClose:t}){const{masto:n}=F(),[c,o]=$("default"),[i,s]=$([]),[l,a]=Ct(r=>r+1,0);U(()=>{o("loading"),(async()=>{try{const r=await lt.drafts.keys();if(r.length){const f=An(),u=r.filter(m=>m.startsWith(f));if(u.length){const m=await lt.drafts.getMany(u);m.sort((h,y)=>new Date(y.updatedAt).getTime()-new Date(h.updatedAt).getTime()),s(m)}else s([])}else s([]);o("default")}catch{o("error")}})()},[l]);const d=(i==null?void 0:i.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(v,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(ve,{abrupt:!0,hidden:c!=="loading"})]}),d&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:d?e(L,{children:[e("ul",{class:"drafts-list",children:i.map(r=>{const{updatedAt:f,key:u,draftStatus:m,replyTo:h}=r,y=new Date(f);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(v,{icon:h?"reply":"quill",size:"s"})," ",e("time",{children:[!!h&&e(L,{children:["@",h.account.acct,e("br",{})]}),Ye(y)]})]}),e(Fe,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:c==="loading",onClick:()=>{(async()=>{try{await lt.drafts.del(u),a()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:c==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:c==="loading",class:"draft-item",onClick:async()=>{let g;if(h){o("loading");try{g=await n.v1.statuses.$select(h.id).fetch()}catch{alert("Error fetching reply-to status!"),o("default");return}o("default")}window.__COMPOSE__={draftStatus:m,replyToStatus:g},k.showCompose=!0,k.showDrafts=!1},children:e(ii,{draft:r})})]},f)})}),i.length>1&&e("p",{children:e(Fe,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:c==="loading",onClick:()=>{(async()=>{o("loading");try{await lt.drafts.delMany(i.map(r=>r.key)),o("default"),a()}catch{alert("Error deleting drafts! Please try again."),o("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:c==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function ii({draft:t}){var u;const{draftStatus:n,replyTo:c}=t,{status:o,spoilerText:i,poll:s,mediaAttachments:l}=n,a=((u=s==null?void 0:s.options)==null?void 0:u.length)>0,d=(l==null?void 0:l.length)>0,r=a||d,f=de(()=>{if(!d)return;const m=l.find(g=>/image/.test(g.type));if(!m)return;const{file:h}=m;return URL.createObjectURL(h)},[d,l]);return e(L,{children:e("div",{class:"mini-draft",children:[r&&e("div",{class:`mini-draft-aside ${f?"has-image":""}`,style:f?{"--bg-image":`url(${f})`}:{},children:[a&&e(v,{icon:"poll"}),d&&e("span",{children:[e(v,{icon:"attachment"})," ",e("small",{children:l==null?void 0:l.length})]})]}),e("div",{class:"mini-draft-main",children:[!!i&&e("div",{class:"mini-draft-spoiler",children:i}),!!o&&e("div",{class:"mini-draft-status",children:o})]})]})})}function oi({onClose:t=()=>{}}){const n=ge(k),[c,o]=$("default"),[i,s]=$([]),[l,a]=$(!1);if(Hn(t),!n.showGenericAccounts)return null;const{id:d,heading:r,fetchAccounts:f,accounts:u,showReactions:m}=n.showGenericAccounts,h=g=>{f&&(g&&s([]),o("loading"),(async()=>{try{const{done:w,value:p}=await f(g);Array.isArray(p)?(s(g?p:b=>[...b,...p]),a(!w)):a(!1),o("default")}catch{o("error")}})())},y=P(!0);return U(()=>{(u==null?void 0:u.length)>0?s(u):(h(!0),y.current=!1)},[u,f]),U(()=>{var g;y.current||((g=n.reloadGenericAccounts)==null?void 0:g.id)===d&&h(!0)},[n.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:t,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:r||"Accounts"})}),e("main",{children:i.length>0?e(L,{children:[e("ul",{class:"accounts-list",children:i.map(g=>{var w;return e("li",{children:[m&&((w=g._types)==null?void 0:w.length)>0&&e("div",{class:"reactions-block",children:g._types.map(p=>e(v,{icon:{reblog:"rocket",favourite:"heart"}[p],class:`${p}-icon`}))}),e(qe,{account:g})]},g.id+(g._types||""))})}),c==="default"?l?e(at,{onChange:g=>{g&&h()},children:e("button",{type:"button",class:"plain block",onClick:()=>h(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):c==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})})]}):c==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):c==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function ci({alt:t,lang:n,onClose:c}){const o=ge(k),[i,s]=$(!1),l=Cn(!0),a=o.settings.contentTranslationHideLanguages||[],d=!!n&&n!==l&&!en([n],[l])&&!a.find(r=>n===r||en([n],[r]));return e("div",{class:"sheet",tabindex:"-1",children:[!!c&&e("button",{type:"button",class:"sheet-close outer",onClick:c,children:e(v,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Ne,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(v,{icon:"more",alt:"More",size:"xl"})}),children:e(ee,{disabled:i,onClick:()=>{s(!0)},children:[e(v,{icon:"translate"}),e("span",{children:"Translate"})]})})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(d||i)&&e(Mn,{forceTranslate:i,sourceLanguage:n,text:t})]})]})}function Mt(t,n,c){return Math.max(Math.min(t,c),n)}const At=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,Rt=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function Gn([t,n,c]){t=At(t/255),n=At(n/255),c=At(c/255);var o=.4122214708*t+.5363325363*n+.0514459929*c,i=.2119034982*t+.6806995451*n+.1073969566*c,s=.0883024619*t+.2817188376*n+.6299787005*c;return o=Math.cbrt(o),i=Math.cbrt(i),s=Math.cbrt(s),[o*.2104542553+i*.793617785+s*-.0040720468,o*1.9779984951+i*-2.428592205+s*.4505937099,o*.0259040371+i*.7827717662+s*-.808675766]}function Wn([t,n,d]){var o=t+n*.3963377774+d*.2158037573,i=t+n*-.1055613458+d*-.0638541728,s=t+n*-.0894841775+d*-1.291485548;o=o**3,i=i**3,s=s**3;var l=o*4.0767416621+i*-3.3077115913+s*.2309699292,a=o*-1.2684380046+i*2.6097574011+s*-.3413193965,d=o*-.0041960863+i*-.7034186147+s*1.707614701;return l=255*Rt(l),a=255*Rt(a),d=255*Rt(d),l=Mt(l,0,255),a=Mt(a,0,255),d=Mt(d,0,255),l=Math.round(l),a=Math.round(a),d=Math.round(d),[l,a,d]}function Kn({mediaAttachments:t,statusID:n,instance:c,lang:o,index:i=0,onClose:s=()=>{}}){var g,w;const l=P(null),[a,d]=$(i),r=P(null);Ve(()=>{var p;(p=r.current)==null||p.scrollIntoView()},[]);const f=P(n);U(()=>{const p=i*l.current.clientWidth,b=f.current!==n;b&&(f.current=n),l.current.scrollTo({left:p,behavior:b?"auto":"smooth"}),l.current.focus()},[i,n]);const[u,m]=$(!0);U(()=>{let p=()=>{s()};return l.current&&l.current.addEventListener("swiped-down",p),()=>{l.current&&l.current.removeEventListener("swiped-down",p)}},[]),Ce("esc",s,{ignoreEventWhen:p=>!!document.querySelector("#modal-container > *")},[s]),U(()=>{let p=()=>{const{clientWidth:b,scrollLeft:S}=l.current,T=Math.round(S/b);d(T)};return l.current&&l.current.addEventListener("scroll",p,{passive:!0}),()=>{l.current&&l.current.removeEventListener("scroll",p)}},[]),U(()=>{let p=setTimeout(()=>{var b,S;(S=(b=l.current)==null?void 0:b.focus)==null||S.call(b)},100);return()=>clearTimeout(p)},[]);const h=de(()=>t==null?void 0:t.map(p=>{const{blurhash:b}=p;if(b){const S=Pn(b),T=Gn(S);return Wn([.6,T[1],T[2]])}return null}),[t]),y=de(()=>{var S;const b=100/h.length;return((S=h==null?void 0:h.map((T,C)=>{const E=C*b+5,z=(C+1)*b-5;return T?`
            rgba(${T==null?void 0:T.join(",")}, 0.4) ${E}%,
            rgba(${T==null?void 0:T.join(",")}, 0.4) ${z}%
          `:`
            transparent ${E}%,
            transparent ${z}%
          `}))==null?void 0:S.join(", "))||"transparent"},[h]);return e("div",{class:`media-modal-container media-modal-count-${t==null?void 0:t.length}`,children:[e("div",{ref:l,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:p=>{(p.target.classList.contains("carousel-item")||p.target.classList.contains("media")||p.target.classList.contains("media-zoom"))&&s()},style:t.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${y})`}:{},children:t==null?void 0:t.map((p,b)=>{const S=t.length===1?h[b]:null;return e("div",{class:"carousel-item",style:S?{"--accent-color":`rgb(${S==null?void 0:S.join(",")})`,"--accent-alpha-color":`rgba(${S==null?void 0:S.join(",")}, 0.4)`}:{},tabindex:"0",ref:b===a?r:null,onClick:T=>{T.target.classList.contains("media")||m(!u)},children:[!!p.description&&e("button",{type:"button",class:"media-alt",hidden:!u,onClick:()=>{k.showMediaAlt={alt:p.description,lang:o}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:o,dir:"auto",children:p.description})]}),e(Rn,{media:p,showOriginal:!0,lang:o})]},p.id)})}),e("div",{class:"carousel-top-controls",hidden:!u,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:e(v,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((p,b)=>e("button",{type:"button",disabled:b===a,class:`carousel-dot ${b===a?"active":""}`,onClick:S=>{S.preventDefault(),S.stopPropagation(),l.current.scrollTo({left:l.current.clientWidth*b,behavior:"smooth"}),l.current.focus()},children:e(v,{icon:"round",size:"s"})},p.id))}):e("span",{}),e("span",{children:[e(Ne,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(v,{icon:"more",alt:"More"})}),children:e(Re,{href:((g=t[a])==null?void 0:g.remoteUrl)||((w=t[a])==null?void 0:w.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(v,{icon:"popout"}),e("span",{children:"Open original media"})]})})," ",e(Y,{to:`${c?`/${c}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${a+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!u,children:[e("button",{type:"button",class:"carousel-button",hidden:a===0,onClick:p=>{p.preventDefault(),p.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(a-1),behavior:"smooth"})},children:e(v,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:a===t.length-1,onClick:p=>{p.preventDefault(),p.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(a+1),behavior:"smooth"})},children:e(v,{icon:"arrow-right"})})]})]})}const ai="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",ri="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",li="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",di=200,ui=10;async function It(){const{masto:t}=F(),n=t.v1.followedTags.list({limit:di}),c=[];let o=0;do{const{value:i,done:s}=await n.next();if(s||(i==null?void 0:i.length)===0)break;c.push(...i),o++}while(o<ui);return c.sort((i,s)=>i.name.localeCompare(s.name)),c.length&&setTimeout(()=>{te.account.set("followedTags",{tags:c,updatedAt:Date.now()})},1),c}const hi=24*60*60*1e3;async function fi(){try{const{tags:t,updatedAt:n}=te.account.get("followedTags")||{};return t!=null&&t.length?(Date.now()-n>hi&&It(),t):await It()}catch{return[]}}const fn=document.createElement("div"),pi=t=>{if(!t)return[];if(t.indexOf("#")===-1)return[];fn.innerHTML=t;const n=fn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(c=>c.innerText.trim().replace(/^[^#]*#+/,"")):[]};function Ut({children:t}){if(typeof t=="string")return t;const[n,c]=$("");return U(()=>{Promise.resolve(t).then(c)},[t]),n}const Je=9,mi=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],Zn={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},wt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},gi=tt(async({id:t})=>(await F().masto.v1.lists.$select(t).fetch()).title),bi=tt(async({id:t})=>{const n=await F().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),Tt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:gi,path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||F().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||F().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t,path:({query:t})=>`/search?q=${t}`,icon:"search"},"account-statuses":{id:"account-statuses",title:bi,path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||F().instance,path:({hashtag:t,instance:n,media:c})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}${c?"?media=1":""}`,icon:"hashtag"}};function yi({onClose:t}){const n=ge(k),{shortcuts:c}=n,[o,i]=$(!1),[s,l]=$(!1),[a]=Ht();return e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:[e(v,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:ai},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:li},{value:"multi-column",label:"Multi-column",imgURL:ri}].map(({value:d,label:r,imgURL:f})=>{const u=n.settings.shortcutsViewMode===d||d==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:u?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:d,checked:u,onChange:m=>{k.settings.shortcutsViewMode=m.target.value}})," ",e("img",{src:f,alt:"",width:"80",height:"58"})," ",e("span",{children:r})]},d)})}),c.length>0?e("ol",{class:"shortcuts-list",ref:a,children:c.filter(Boolean).map((d,r)=>{const f=Object.values(d).join("-"),{type:u}=d;if(!Tt[u])return null;let{icon:m,title:h,subtitle:y}=Tt[u];return typeof h=="function"&&(h=h(d,r)),typeof y=="function"&&(y=y(d,r)),typeof m=="function"&&(m=m(d,r)),e("li",{children:[e(v,{icon:m}),e("span",{class:"shortcut-text",children:[e(Ut,{children:h}),y&&e(L,{children:[" ",e("small",{class:"ib insignificant",children:y})]})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:r===0,onClick:()=>{const g=Array.from(k.shortcuts);if(r>0){const w=k.shortcuts[r-1];g[r-1]=d,g[r]=w,k.shortcuts=g}},children:e(v,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:r===c.length-1,onClick:()=>{const g=Array.from(k.shortcuts);if(r<k.shortcuts.length-1){const w=k.shortcuts[r+1];g[r+1]=d,g[r]=w,k.shortcuts=g}},children:e(v,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{i({shortcut:d,shortcutIndex:r})},children:e(v,{icon:"pencil",alt:"Edit"})})]})]},f)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:d=>{d.preventDefault(),k.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:c.length>=Je&&`Max ${Je} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>l(!0),children:"Import/export"}),e("button",{type:"button",disabled:c.length>=Je,onClick:()=>i(!0),children:[e(v,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),o&&e(Se,{class:"light",onClick:d=>{d.target===d.currentTarget&&i(!1)},children:e(ki,{shortcut:o.shortcut,shortcutIndex:o.shortcutIndex,onSubmit:({result:d,mode:r})=>{r==="edit"?k.shortcuts[o.shortcutIndex]=d:k.shortcuts.push(d)},onClose:()=>i(!1)})}),s&&e(Se,{class:"light",onClick:d=>{d.target===d.currentTarget&&l(!1)},children:e(Si,{shortcuts:c,onClose:()=>l(!1)})})]})}const wi=1e3*60,vi=tt(()=>{const{masto:t}=F();return t.v1.lists.list()},{maxAge:wi});function ki({onSubmit:t,disabled:n,shortcut:c,shortcutIndex:o,onClose:i}){var w,p;const s=!!c,[l,a]=$((c==null?void 0:c.type)||null),{masto:d}=F(),[r,f]=$("default"),[u,m]=$([]),[h,y]=$([]);U(()=>{(async()=>{if(l==="list")try{f("loading");const b=await vi();b.sort((S,T)=>S.title.localeCompare(T.title)),m(b),f("default")}catch{f("error")}})(),(async()=>{if(l==="hashtag")try{const b=await It();y(b)}catch{}})()},[l]);const g=P();return U(()=>{if(s&&l&&wt[l]){const b=g.current;wt[l].forEach(({name:S,type:T})=>{const C=b.querySelector(`[name="${S}"]`);C&&c[S]&&(T==="checkbox"?C.checked=c[S]==="on":C.value=c[S])})}},[s,l]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:[s?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:g,onSubmit:b=>{b.preventDefault();const S=new FormData(b.target),T={};S.forEach((C,E)=>{T[E]=C==null?void 0:C.trim(),E==="instance"&&(T[E]=T[E].replace(/^https?:\/\//,"").replace(/\/+$/,""),T[E]=T[E].replace(/^@?[^@]+@/,""))}),T.type&&(t({result:T,mode:s?"edit":"add"}),b.target.reset(),a(null),i==null||i())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:n,onChange:b=>{a(b.target.value)},defaultValue:s?c.type:void 0,name:"type",children:[e("option",{}),mi.map(b=>e("option",{value:b,children:Zn[b]}))]})]})}),(p=(w=wt[l])==null?void 0:w.map)==null?void 0:p.call(w,({text:b,name:S,type:T,placeholder:C,pattern:E,notRequired:z})=>l==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!z,disabled:n||r==="loading",defaultValue:s?c.id:void 0,children:u.map(M=>e("option",{value:M.id,children:M.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:b})," ",e("input",{type:T,name:S,placeholder:C,required:T==="text"&&!z,disabled:n,list:l==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:E}),l==="hashtag"&&h.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:h.map(M=>e("option",{value:M.name}))})]})})),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:n||r==="loading",children:s?"Save":"Add"}),s&&e("button",{type:"button",class:"light danger",onClick:()=>{k.shortcuts.splice(o,1),i==null||i()},children:"Remove"})]})]})})]})}function Si({shortcuts:t,onClose:n}){var r;const c=de(()=>!t||!t.filter(Boolean).length?"":on.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,i]=$(""),[s,l]=$("default"),a=de(()=>{if(!o)return l("default"),null;try{const f=JSON.parse(on.decompressFromEncodedURIComponent(o));if(!Array.isArray(f))throw new Error("Not an array");return l("default"),f}catch{try{const u=JSON.parse(o);if(!Array.isArray(u))throw new Error("Not an array");return l("default"),u}catch{return l("error"),null}}},[o]),d=k.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(v,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:f=>{i(f.target.value)}})}),!!a&&Array.isArray(a)&&e(L,{children:[e("p",{children:[e("b",{children:a.length})," shortcut",a.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:a.map(f=>{var u,m;return e("li",{children:[e("span",{style:{opacity:t.some(h=>Object.keys(h).every(y=>h[y]===f[y]))?1:0},children:"*"}),e("span",{children:[Zn[f.type],f.type==="list"&&" ⚠️"," ",(m=(u=wt[f.type])==null?void 0:u.map)==null?void 0:m.call(u,({text:h,name:y,type:g})=>f[y]?e(L,{children:[e("span",{class:"tag collapsed insignificant",children:[h,":"," ",g==="checkbox"?f[y]==="on"?"✅":"❌":f[y]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[d&&e(L,{children:[e(Fe,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const f=a.filter(h=>!k.shortcuts.some(y=>Object.keys(y).every(g=>y[g]===h[g])));if(!f.length){le("No new shortcuts to import");return}let u=[...k.shortcuts,...f];const m=u.length>Je;m&&(u=u.slice(0,Je)),k.shortcuts=u,le(m?`Shortcuts imported. Exceeded max ${Je}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!a,children:"Import & append…"})})," "]}),e(Fe,{confirmLabel:d?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:d?"danger":void 0,onClick:()=>{k.shortcuts=a,le("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!a,children:d?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(v,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:c,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),le("Shortcuts copied")}catch{le("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!c,onClick:()=>{try{navigator.clipboard.writeText(c),le("Shortcut settings copied")}catch{le("Unable to copy shortcut settings")}},children:[e(v,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((r=navigator==null?void 0:navigator.canShare)==null?void 0:r.call(navigator,{text:c}))&&e("button",{type:"button",class:"plain2",disabled:!c,onClick:()=>{try{navigator.share({text:c})}catch{alert("Sharing doesn't seem to work.")}},children:[e(v,{icon:"share"})," ",e("span",{children:"Share"})]})," ",c.length>0&&e("small",{class:"insignificant",children:[c.length," characters"]})]}),!!c&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}Nn(k,t=>{for(const[n,c,o,i]of t)/^show/i.test(c)&&!o&&Nt()});function Ii(){var o,i,s,l,a,d,r,f;const t=ge(k),n=Un(),c=ct();return e(L,{children:[!!t.showCompose&&e(Se,{children:e(us,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((o=window.__COMPOSE__)==null?void 0:o.replyToStatus)||null,editStatus:((i=k.showCompose)==null?void 0:i.editStatus)||((s=window.__COMPOSE__)==null?void 0:s.editStatus)||null,draftStatus:((l=k.showCompose)==null?void 0:l.draftStatus)||((a=window.__COMPOSE__)==null?void 0:a.draftStatus)||null,onClose:u=>{const{newStatus:m,instance:h,type:y}=u||{};k.showCompose=!1,window.__COMPOSE__=null,m&&(k.reloadStatusPage++,le({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[y||"post"],delay:1e3,duration:1e4,onClick:g=>{g.hideToast(),k.prevLocation=c,n(h?`/${h}/s/${m.id}`:`/s/${m.id}`)}}))}})}),!!t.showSettings&&e(Se,{onClose:()=>{k.showSettings=!1},children:e(qs,{onClose:()=>{k.showSettings=!1}})}),!!t.showAccounts&&e(Se,{onClose:()=>{k.showAccounts=!1},children:e(Ns,{onClose:()=>{k.showAccounts=!1}})}),!!t.showAccount&&e(Se,{class:"light",onClose:()=>{k.showAccount=!1},children:e(ni,{account:((d=t.showAccount)==null?void 0:d.account)||t.showAccount,instance:(r=t.showAccount)==null?void 0:r.instance,onClose:({destination:u}={})=>{k.showAccount=!1}})}),!!t.showDrafts&&e(Se,{onClose:()=>{k.showDrafts=!1},children:e(si,{onClose:()=>k.showDrafts=!1})}),!!t.showMediaModal&&e(Se,{onClick:u=>{(u.target===u.currentTarget||u.target.classList.contains("media"))&&(k.showMediaModal=!1)},children:e(Kn,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{k.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(Se,{class:"light",onClose:()=>{k.showShortcutsSettings=!1},children:e(yi,{onClose:()=>k.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(Se,{class:"light",onClose:()=>{k.showGenericAccounts=!1},children:e(oi,{onClose:()=>k.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(Se,{class:"light",onClose:u=>{k.showMediaAlt=!1},children:e(ci,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(f=t.showMediaAlt)==null?void 0:f.lang,onClose:()=>{k.showMediaAlt=!1}})})]})}function Ft({accountID:t,onChange:n}){const{masto:c}=F(),[o,i]=$("default"),[s,l]=$(null),[a,d]=$(null),r=a!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:o==="loading"||r,onClick:()=>{i("loading"),l("accept"),(async()=>{try{const f=await c.v1.followRequests.$select(t).authorize();if(!(f!=null&&f.followedBy))throw new Error("Follow request not accepted");d(f),n()}catch{}i("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:o==="loading"||r,class:"light danger",onClick:()=>{i("loading"),l("reject"),(async()=>{try{const f=await c.v1.followRequests.$select(t).reject();if(f!=null&&f.followedBy)throw new Error("Follow request not rejected");d(f),n()}catch{i("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:r&&s?s==="accept"?e(v,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(v,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(ve,{hidden:o!=="loading"})})]})}const pn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},st={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(L,{children:["reported ",t]})},Et=50;function Ti({notification:t,instance:n,isStatic:c}){var E,z,M,_;const{id:o,status:i,account:s,report:l,_accounts:a,_statuses:d}=t;let{type:r}=t;const f=(i==null?void 0:i.reblog)||i,u=f==null?void 0:f.id,m=te.session.get("currentAccount"),h=m===(s==null?void 0:s.id),y=(E=i==null?void 0:i.poll)==null?void 0:E.voted,g=!!(i!=null&&i.inReplyToAccountId)&&(i==null?void 0:i.inReplyToAccountId)!==m&&((z=i==null?void 0:i.account)==null?void 0:z.id)===m;let w=0,p=0;if(r==="favourite+reblog"){for(const x of a)(M=x._types)!=null&&M.includes("favourite")&&w++,(_=x._types)!=null&&_.includes("reblog")&&p++;!p&&w&&(r="favourite"),!w&&p&&(r="reblog")}let b;if(r==="poll"?b=st[h?"poll-self":y?"poll-voted":"poll"]:r==="reblog"||r==="favourite"||r==="favourite+reblog"?(d==null?void 0:d.length)>1?b=st[`${r}+account`]:g?b=st[`${r}_reply`]:b=st[r]:st[r]?b=st[r]:b=`[Unknown notification type: ${r}]`,typeof b=="function"){const x=(d==null?void 0:d.length)||(a==null?void 0:a.length);if(x)b=b(x);else if(r==="admin.report"){const G=l==null?void 0:l.targetAccount;G&&(b=b(e(St,{account:G,showAvatar:!0})))}}if(r==="mention"&&!i)return null;const S=t.createdAt&&new Date(t.createdAt).toLocaleString(),T={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[r]||"Accounts",C=()=>{k.showGenericAccounts={heading:T,accounts:a,showReactions:r==="favourite+reblog"}};return e("div",{class:`notification notification-${r}`,"data-notification-id":o,tabIndex:"0",children:[e("div",{class:`notification-type notification-${r}`,title:S,children:r==="favourite+reblog"?e(L,{children:[e(v,{icon:"rocket",size:"xl",alt:r,class:"reblog-icon"}),e(v,{icon:"heart",size:"xl",alt:r,class:"favourite-icon"})]}):e(v,{icon:pn[r]||"notification",size:"xl",alt:r})}),e("div",{class:"notification-content",children:[r!=="mention"&&e(L,{children:[e("p",{children:[!/poll|update/i.test(r)&&e(L,{children:(a==null?void 0:a.length)>1?e(L,{children:[e("b",{tabIndex:"0",onClick:C,children:[e("span",{title:a.length,children:_e(a.length)})," ","people"]})," "]}):e(L,{children:[e(St,{account:s,showAvatar:!0})," "]})}),b,r==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e($t,{datetime:t.createdAt,format:"micro"})]})]}),r==="follow_request"&&e(Ft,{accountID:s.id})]}),(a==null?void 0:a.length)>1&&e("p",{class:"avatars-stack",children:[a.slice(0,Et).map(x=>e(L,{children:[e("a",{href:x.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:G=>{G.preventDefault(),k.showAccount=x},children:[e(et,{url:x.avatarStatic,size:a.length<=10?"xxl":a.length<20?"xl":a.length<30?"l":a.length<40?"m":"s",alt:`${x.displayName} @${x.acct}`,squircle:x==null?void 0:x.bot},x.id),r==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:x._types.map(G=>e(v,{icon:pn[G],size:"s",class:`${G}-icon`}))})]},x.id)," "]},x.id)),e("button",{type:"button",class:"small plain",onClick:C,children:[a.length>Et&&`+${a.length-Et}`,e(v,{icon:"chevron-down"})]})]}),(d==null?void 0:d.length)>1&&e("ul",{class:"notification-group-statuses",children:d.map(x=>e("li",{children:e(mn,{class:`status-link status-type-${r}`,to:n?`/${n}/s/${x.id}`:`/s/${x.id}`,children:e(Me,{status:x,size:"s"})})},x.id))}),i&&(!(d!=null&&d.length)||(d==null?void 0:d.length)<=1)&&e(mn,{class:`status-link status-type-${r}`,to:n?`/${n}/s/${u}`:`/s/${u}`,onContextMenu:x=>{const G=x.target.querySelector(".status");if(G){if(x.metaKey)return;x.preventDefault(),G.dispatchEvent(new MouseEvent("contextmenu",{clientX:x.clientX,clientY:x.clientY}))}},children:c?e(Me,{status:f,size:"s"}):e(Me,{statusID:u,size:"s"})})]})]})}function mn(t){const n=hs();return e(Y,{...t,"data-read-more":"Read more →",ref:n})}const Kt=ze(Ti),$i=ze(function(){if(!("serviceWorker"in navigator))return null;const n=ge(k),{routeNotification:c}=n,{id:o,accessToken:i}=c||{},[s,l]=$(!1);Ve(()=>{if(!o||!i)return;const{instance:d}=F(),{masto:r,instance:f}=F({accessToken:i}),u=d===f,m=i?fs(i):ot();(async()=>{const h=await r.v1.notifications.$select(o).fetch();if(h&&m){const y=m.instanceURL,{type:g,status:w,account:p}=h,b=!!document.querySelector("#modal-container > *"),S=g==="follow"&&!!(p!=null&&p.id),T=!!(p!=null&&p.id),C=!!(w!=null&&w.id);S&&u?k.showAccount={account:p,instance:y}:b||!u||T&&C?l({id:o,account:m,notification:h,sameInstance:u}):C?location.hash=`/${d}/s/${w.id}`:S?location.hash=`/${d}/a/${p.id}`:location.hash="/notifications"}})()},[o,i]),Ve(()=>{const d=r=>{const{type:f,id:u,accessToken:m}=(r==null?void 0:r.data)||{};f==="notification"&&(k.routeNotification={id:u,accessToken:m})};return navigator.serviceWorker.addEventListener("message",d),()=>{navigator.serviceWorker.removeEventListener("message",d)}},[]),Ve(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),ht(d=>{d&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const a=()=>{l(!1),k.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(s){const{id:d,account:r,notification:f,sameInstance:u}=s;return e(Se,{class:"light",onClick:m=>{m.target===m.currentTarget&&a()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:a,children:e(v,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!u&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:m=>{const{target:h}=m;(m.target.tagName==="BUTTON"||m.target.tagName==="A")&&a()},children:e(Kt,{instance:r.instanceURL,notification:f,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(Y,{to:"/notifications",class:"button light",onClick:a,children:[e("span",{children:"View all notifications"})," ",e(v,{icon:"arrow-right"})]})})]})]})})}return null}),Yn=Ss((t,n)=>{const{instance:c}=F(),[o,i]=Oe(),[s,l]=$(!1),[a,d]=$(o.get("q")||""),r=o.get("type"),f=P(null),u=P(null);return ks(n,()=>({setValue:m=>{d(m)},focus:()=>{u.current.focus()},select:()=>{u.current.select()},blur:()=>{u.current.blur()}})),e("form",{ref:f,class:"search-popover-container",onSubmit:m=>{var y;if(m.preventDefault(),/\/search/.test(location.hash))if(a){const g={q:a};r&&(g.type=r),i(g)}else i({});else a?location.hash=`/search?q=${encodeURIComponent(a)}${r?`&type=${r}`:""}`:location.hash="/search";(y=t==null?void 0:t.onSubmit)==null||y.call(t,m)},children:[e("input",{ref:u,value:a,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:m=>{m.target.value||i({})},onInput:m=>{d(m.target.value),l(!0)},onFocus:()=>{l(!0)},onBlur:()=>{var m,h;setTimeout(()=>{l(!1)},100),(h=(m=f.current)==null?void 0:m.querySelector(".search-popover-item.focus"))==null||h.classList.remove("focus")},onKeyDown:m=>{var y;const{key:h}=m;switch(h){case"Escape":l(!1);break;case"Down":case"ArrowDown":if(m.preventDefault(),s){const g=f.current.querySelector(".search-popover-item.focus");if(g){let w=g.nextElementSibling;for(;w&&w.hidden;)w=w.nextElementSibling;w&&(w.classList.add("focus"),Array.from(w.parentElement.children).filter(b=>b!==w).forEach(b=>{b.classList.remove("focus")}))}else{const w=f.current.querySelector(".search-popover-item");w&&w.classList.add("focus")}}break;case"Up":case"ArrowUp":if(m.preventDefault(),s){const g=document.querySelector(".search-popover-item.focus");if(g){let w=g.previousElementSibling;for(;w&&w.hidden;)w=w.previousElementSibling;w&&(w.classList.add("focus"),Array.from(w.parentElement.children).filter(b=>b!==w).forEach(b=>{b.classList.remove("focus")}))}else{const w=document.querySelector(".search-popover-item:last-child");w&&w.classList.add("focus")}}break;case"Enter":if(s){const g=document.querySelector(".search-popover-item.focus");g&&(m.preventDefault(),g.click()),l(!1),(y=t==null?void 0:t.onSubmit)==null||y.call(t,m)}break}}}),e("div",{class:"search-popover",hidden:!s||!a,children:!!a&&[{label:e(L,{children:["Posts with ",e("q",{children:a})]}),to:`/search?q=${encodeURIComponent(a)}&type=statuses`,hidden:/^https?:/.test(a)},{label:e(L,{children:["Posts tagged with ",e("mark",{children:["#",a.replace(/^#/,"")]})]}),to:`/${c}/t/${a.replace(/^#/,"")}`,hidden:/^@/.test(a)||/^https?:/.test(a)||/\s/.test(a),top:/^#/.test(a),type:"link"},{label:e(L,{children:["Look up ",e("mark",{children:a})]}),to:`/${a}`,hidden:!/^https?:/.test(a),top:/^https?:/.test(a),type:"link"},{label:e(L,{children:["Accounts with ",e("q",{children:a})]}),to:`/search?q=${encodeURIComponent(a)}&type=accounts`}].sort((m,h)=>m.top&&!h.top?-1:!m.top&&h.top?1:0).map(({label:m,to:h,hidden:y,type:g})=>e(Y,{to:h,class:"search-popover-item",hidden:y,onClick:w=>{var p;(p=t==null?void 0:t.onSubmit)==null||p.call(t,w)},children:[e(v,{icon:g==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:m})," "]}))})]})}),Ci=ze(function({onClose:n=()=>{}}){const[c,o]=$(!1),i=P(null);Ce("/",l=>{o(!0),setTimeout(()=>{var a,d,r,f;(d=(a=i.current)==null?void 0:a.focus)==null||d.call(a),(f=(r=i.current)==null?void 0:r.select)==null||f.call(r)},0)},{preventDefault:!0,ignoreEventWhen:l=>{const a=/\/search/.test(location.hash),d=!!document.querySelector("#modal-container > *");return a||d}});const s=()=>{o(!1),n()};return Ce("esc",l=>{var a,d;(d=(a=i.current)==null?void 0:a.blur)==null||d.call(a),s()},{enabled:c,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!c,onClick:l=>{l.target===l.currentTarget&&s()},children:e(Yn,{ref:i,onSubmit:()=>{s()}})})});function xi(){const{instance:t}=F(),n=ge(k),{shortcuts:c,settings:o}=n;if(!c.length||o.shortcutsViewMode==="multi-column"||!o.shortcutsViewMode&&o.shortcutsColumnsMode)return null;const i=P(),s=de(()=>c.map((a,d)=>{const{type:r,...f}=a;if(!Tt[r])return null;let{id:u,path:m,title:h,subtitle:y,icon:g}=Tt[r];return typeof u=="function"&&(u=u(f,d)),typeof m=="function"&&(m=m({...f,instance:f.instance||t},d)),typeof h=="function"&&(h=h(f,d)),typeof y=="function"&&(y=y(f,d)),typeof g=="function"&&(g=g(f,d)),{id:u,path:m,title:h,subtitle:y,icon:g}}).filter(Boolean),[c]),l=Un();return Ce(["1","2","3","4","5","6","7","8","9"],(a,d)=>{var f,u;const r=parseInt(d.keys[0],10)-1;if(r<s.length){const{path:m}=s[r];m&&(l(m),(u=(f=i.current)==null?void 0:f.closeMenu)==null||u.call(f))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",onContextMenu:a=>{a.preventDefault(),k.showShortcutsSettings=!0},children:e("ul",{children:s.map(({id:a,path:d,title:r,subtitle:f,icon:u},m)=>e("li",{children:e(Y,{class:f?"has-subtitle":"",to:d,onClick:h=>{if(h.target.classList.contains("is-active")){h.preventDefault();const y=document.getElementById(`${a}-page`);if(y){y.scrollTop=0;const g=y.querySelector(".updates-button");g&&g.click()}}},children:[e(v,{icon:u,size:"xl",alt:r}),e("span",{children:[e(Ut,{children:r}),f&&e(L,{children:[e("br",{}),e("small",{children:f})]})]})]})},`${m}-${a}-${r}-${f}-${d}`))})}):e(Ne,{instanceRef:i,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:a=>{a.preventDefault(),k.showShortcutsSettings=!0},onTransitionStart:a=>{var d,r;try{const{target:f}=a;getComputedStyle(f).pointerEvents==="none"&&((r=(d=i.current)==null?void 0:d.closeMenu)==null||r.call(d))}catch{}},children:e(v,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:s.map(({id:a,path:d,title:r,subtitle:f,icon:u},m)=>e(Re,{to:d,class:"glass-menu-item",children:[e(v,{icon:u,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Ut,{children:r})}),f&&e(L,{children:[" ",e("small",{class:"more-insignificant",children:f})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:m+1})]},`${m}-${a}-${r}-${f}-${d}`))})})}const Li=ze(xi);function Mi(t){var i;let n=[],c=[],o=0;for(let s=0;s<t.length;s++){const l=t[s];l.reblog&&!((i=l.account)!=null&&i.group)?(c.push(l),o++):(n.push(l),o<3&&(o=0))}if(t.length>10&&(c.length>t.length/4||o>=3)){const s=c.map(l=>l.id);if(c.length>t.length*3/4)n=[...n,{id:s,items:c,type:"boosts"}];else{const l=Math.floor(n.length/2);n=[...n.slice(0,l),{id:s,items:c,type:"boosts"},...n.slice(l)]}return n}else return t}function gn(t,n){const c=te.account.get("boostedStatusIDs")||{},o=t.filter(s=>{if(!s.reblog)return!0;const l=`${n}-${s.reblog.id}`,a=c[l];return a&&a!==s.id?!1:(c[l]=s.id,!0)}),i=Object.keys(c);return i.length>50&&i.slice(0,i.length-50).forEach(s=>{delete c[s]}),te.account.set("boostedStatusIDs",c),o}function Ai(t){const n=[];let c=0;t.forEach(s=>{for(let a=0;a<n.length;a++){if(n[a].find(d=>d.id===s.id))return;if(n[a].find(d=>d.id===s.inReplyToId)||n[a].find(d=>d.inReplyToId===s.id)){n[a].push(s);return}}const l=t.find(a=>a.id===s.inReplyToId);l&&(n[c++]=[s,l])});for(let s=0;s<n.length;s++)for(let l=s+1;l<n.length;l++)n[s].find(d=>n[l].includes(d))&&(n[s]=[...n[s],...n[l]],n[s]=n[s].filter((d,r,f)=>f.findIndex(u=>u.id===d.id)===r),n.splice(l,1),l--);n.forEach(s=>{s.sort((l,a)=>!l.inReplyToId&&!a.inReplyToId?new Date(l.createdAt)-new Date(a.createdAt):l.inReplyToId===a.id?1:a.inReplyToId===l.id||!l.inReplyToId?-1:a.inReplyToId?new Date(l.createdAt)-new Date(a.createdAt):1)}),n.forEach(s=>{const l=s[0].account.id;s.forEach(a=>{a.account.id!==l&&(a._differentAuthor=!0)})}),n.length;const o=[],i=[];return t.forEach(s=>{if(s.reblog){o.push(s);return}for(let l=0;l<n.length;l++)if(n[l].find(a=>a.id===s.id)){if(i.includes(l))return;const a=n[l];a.sort((r,f)=>{const u=new Date(r.createdAt),m=new Date(f.createdAt);return u-m});const d=a[0].account.id;o.push({id:a.map(r=>r.id),items:a,type:a.every(r=>r.account.id===d)?"thread":"conversation"}),i.push(l);return}o.push(s)}),o}async function Ri(t,n){const c=await fi();if(!c.length)return;const{statusFollowedTags:o}=k;t.forEach(i=>{var u;if(i.reblog)return;const{id:s,content:l,tags:a=[]}=i,d=je(s,n);if((u=o[d])!=null&&u.length)return;const r=pi(l);if(!r.length&&!a.length)return;const f=c.reduce((m,h)=>((r.some(y=>y.toLowerCase()===h.name.toLowerCase())||a.some(y=>y.name.toLowerCase()===h.name.toLowerCase()))&&m.push(h.name),m),[]);f.length&&(o[d]=f)})}function Ei(){k.statusFollowedTags={}}function Lt({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:c=1,scrollThresholdStart:o=10,scrollThresholdEnd:i=10,direction:s="vertical",distanceFromStartPx:l,distanceFromEndPx:a}={}){const[d,r]=$(null),[f,u]=$(!1),[m,h]=$(!1),[y,g]=$(!1),[w,p]=$(!1),b=s==="vertical";return Ve(()=>{const S=t.current;if(!S)return{};let T=b?S.scrollTop:S.scrollLeft;function C(){const{scrollTop:E,scrollLeft:z,scrollHeight:M,scrollWidth:_,clientHeight:x,clientWidth:G}=S,R=b?E:z,D=b?M:_,B=b?x:G,se=Math.abs(R-T),ie=l||Math.min(B*n,D,R),pe=a||Math.min(B*c,D,D-R-B);se>=(T<R?i:o)&&(r(T<R?"end":"start"),T=R),u(R<=0),h(R+B>=D),g(R<=ie),p(R+B>=D-pe)}return S.addEventListener("scroll",C,{passive:!0}),()=>S.removeEventListener("scroll",C)},[n,c,o,i]),{scrollDirection:d,reachStart:f,reachEnd:m,nearReachStart:y,nearReachEnd:w,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function Di({class:t,statusID:n,status:c,instance:o,parent:i,onMediaClick:s}){let l=je(n,o);const a=ge(k);if(c||(c=a.statuses[l]||a.statuses[n],l=je(c==null?void 0:c.id,o)),!c)return null;const{account:{acct:d,avatar:r,avatarStatic:f,id:u,url:m,displayName:h,username:y,emojis:g,bot:w,group:p},id:b,repliesCount:S,reblogged:T,reblogsCount:C,favourited:E,favouritesCount:z,bookmarked:M,poll:_,muted:x,sensitive:G,spoilerText:R,visibility:D,language:B,editedAt:se,filtered:ie,card:pe,createdAt:X,inReplyToId:Le,inReplyToAccountId:fe,content:W,mentions:A,mediaAttachments:V,reblog:Q,uri:re,url:we,emojis:Ie,_deleted:Te,_pinned:j}=c;if(!(V!=null&&V.length))return null;const O=Z=>{Z.shiftKey},H=de(()=>te.session.get("currentAccount"),[]),ue=de(()=>H&&H===u,[u,H]),ce=Is(En),J=!ue&&Pt(ie,ce);if((J==null?void 0:J.action)==="hide")return null;const I=R||G,N=i||"div";return V.map((Z,ne)=>{const he=`${l}-${Z.id}`,$e=J==null?void 0:J.titlesStr;return e(N,{"data-state-post-id":l,onMouseEnter:O,"data-spoiler-text":R||(G?"Sensitive media":void 0),"data-filtered-text":J?`Filtered${$e?`: ${$e}`:""}`:void 0,class:`
          media-post
          ${J?"filtered":""}
          ${I?"has-spoiler":""}
        `,children:e(Rn,{class:t,media:Z,lang:B,to:`/${o}/s/${b}?media-only=${ne+1}`,onClick:s?be=>s(be,ne,Z,c):void 0})},he)})}const bn=ze(Di);function pt(t){var S,T,C,E,z;const n=ge(k),{masto:c,instance:o,authenticated:i}=F(),[s,l]=$(),[a,d]=$(!1);U(()=>{const M=te.local.getJSON("accounts")||[],_=M.find(x=>x.info.id===te.session.get("currentAccount"));_&&l(_),d(M.length>1)},[]);const r=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(M=>M.type==="following"),f=Ts(()=>{k.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),u=P(),[m,h]=$(void 0),y=ps([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),g=P();async function w(M){return(M||!g.current)&&(g.current=c.v1.mutes.list({limit:80})),await g.current.next()}const p=P();async function b(M){return(M||!p.current)&&(p.current=c.v1.blocks.list({limit:80})),await p.current.next()}return e(L,{children:[e("button",{ref:u,type:"button",class:`button plain nav-menu-button ${a?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{h(M=>M?void 0:"open")},onContextMenu:M=>{M.preventDefault(),k.showAccounts=!0},...f(),children:[a&&e(et,{url:((S=s==null?void 0:s.info)==null?void 0:S.avatar)||((T=s==null?void 0:s.info)==null?void 0:T.avatarStatic),size:"l",squircle:(C=s==null?void 0:s.info)==null?void 0:C.bot}),e(v,{icon:"menu",size:a?"s":"l"})]}),e(Fn,{menuClassName:"nav-menu",state:m,anchorRef:u,onClose:()=>{h(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{h(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:y,unmountOnClose:!0,children:[!!((E=n.appVersion)!=null&&E.commitHash)&&n.appVersion.commitHash!=="bfd0cc3"&&e("div",{class:"top-menu",children:[e(ee,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(v,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(Ee,{})]}),e("section",{children:[e(Re,{to:"/",children:[e(v,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),i&&e(L,{children:[r&&e(Re,{to:"/following",children:[e(v,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Re,{to:"/mentions",children:[e(v,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Re,{to:"/notifications",children:[e(v,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(Ee,{}),e(Re,{to:"/l",children:[e(v,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(Re,{to:"/ft",children:[e(v,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Re,{to:"/b",children:[e(v,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Re,{to:"/f",children:[e(v,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]})]}),e(Ee,{}),e(Re,{to:"/search",children:[e(v,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Re,{to:`/${o}/p/l`,children:[e(v,{icon:"group",size:"l"})," ",e("span",{children:"Local"})]}),e(Re,{to:`/${o}/p`,children:[e(v,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(Re,{to:`/${o}/trending`,children:[e(v,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:i?e(L,{children:[e(Ee,{}),((z=s==null?void 0:s.info)==null?void 0:z.id)&&e(Re,{to:`/${o}/a/${s.info.id}`,children:[e(v,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(ee,{onClick:()=>{k.showAccounts=!0},children:[e(v,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(ee,{onClick:()=>{k.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:w}},children:[e(v,{icon:"mute",size:"l"})," Muted users…"]}),e(ee,{onClick:()=>{k.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:b}},children:[e(v,{icon:"block",size:"l"}),"Blocked users…"]}),e(Ee,{className:"divider-grow"}),e(ee,{onClick:()=>{k.showKeyboardShortcutsHelp=!0},children:[e(v,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(ee,{onClick:()=>{k.showShortcutsSettings=!0},children:[e(v,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(ee,{onClick:()=>{k.showSettings=!0},children:[e(v,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(L,{children:[e(Ee,{}),e(Re,{to:"/login",children:[e(v,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(ee,{onClick:()=>{k.showSettings=!0},children:[e(v,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const gt={block:"nearest",inline:"center",behavior:"smooth"};function Ge({title:t,titleComponent:n,id:c,instance:o,emptyText:i,errorText:s,useItemID:l,boostsCarousel:a,fetchItems:d=()=>{},checkForUpdates:r=()=>{},checkForUpdatesInterval:f=15e3,headerStart:u,headerEnd:m,timelineStart:h,refresh:y,view:g,filterContext:w,showFollowedTags:p}){const b=ge(k),[S,T]=$([]),[C,E]=$("default"),[z,M]=$(!1),[_,x]=$(!1),[G,R]=$(!0),D=P(),B=g!=="media",se=zn(j=>{x(!1),C!=="loading"&&(E("loading"),(async()=>{try{let{done:O,value:H}=await d(j);if(Array.isArray(H)){const[ue,ce]=H.reduce((J,I)=>(I._pinned?J[0].push(I):J[1].push(I),J),[[],[]]);H=ce,B&&(a&&(H=Mi(H)),H=Ai(H)),ue.length&&(H=ue.concat(H)),T(j?H:J=>[...J,...H]),H.length||(O=!0),M(!O)}else M(!1);E("default")}catch{E("error")}finally{se.cancel()}})())},1500,{leading:!0,trailing:!1}),ie=".timeline-item, .timeline-item-alt",pe=Ce("j, shift+j",(j,O)=>{const H=document.activeElement.closest(ie),ue=H==null?void 0:H.getBoundingClientRect(),ce=Array.from(D.current.querySelectorAll(ie));if(H&&ue.top<D.current.clientHeight&&ue.bottom>0){const J=ce.indexOf(H);let I=ce[J+1];O.shift&&(I=ce.find((N,Z)=>Z>J&&!N.classList.contains("timeline-item-alt"))),I&&(I.focus(),I.scrollIntoView(gt))}else{const J=ce.find(I=>{const N=I.getBoundingClientRect();return N.top>=44&&N.left>=0});J&&(J.focus(),J.scrollIntoView(gt))}}),X=Ce("k, shift+k",(j,O)=>{const H=document.activeElement.closest(ie),ue=H==null?void 0:H.getBoundingClientRect(),ce=Array.from(D.current.querySelectorAll(ie));if(H&&ue.top<D.current.clientHeight&&ue.bottom>0){const J=ce.indexOf(H);let I=ce[J-1];O.shift&&(I=ce.findLast((N,Z)=>Z<J&&!N.classList.contains("timeline-item-alt"))),I&&(I.focus(),I.scrollIntoView(gt))}else{const J=ce.find(I=>{const N=I.getBoundingClientRect();return N.top>=44&&N.left>=0});J&&(J.focus(),J.scrollIntoView(gt))}}),Le=Ce(["enter","o"],()=>{const j=document.activeElement.closest(ie);j&&j.click()}),{scrollDirection:fe,nearReachStart:W,nearReachEnd:A,reachStart:V,reachEnd:Q}=Lt({scrollableRef:D,distanceFromEnd:2,scrollThresholdStart:44});U(()=>{var j;(j=D.current)==null||j.scrollTo({top:0}),se(!0)},[]),U(()=>{se(!0)},[y]),U(()=>{V&&se(!0)},[V]),U(()=>{(A||Q&&z)&&se()},[A,z]);const re=P(g);U(()=>{re.current!==g&&(re.current=g,T([]))},[g]);const we=He(async({disableIdleCheck:j=!1}={})=>{const O=D.current?getComputedStyle(D.current).pointerEvents==="none":!1;b.settings.autoRefresh&&D.current.scrollTop<16&&(j||window.__IDLE__)&&!Ui()&&!O?se(!0):await r()&&x(!0)},[c,se,r,b.settings.autoRefresh]),Ie=P();ht(j=>{if(j){const O=Date.now()-Ie.current;(!Ie.current||O>1e3*3)&&we({disableIdleCheck:!0})}else Ie.current=Date.now();R(j)},[r,we,b.settings.autoRefresh]),$n(we,G&&!_?f*(W?1:2):null);const Te=fe==="end"&&!W;return e(En.Provider,{value:w,children:e("div",{id:`${c}-page`,class:"deck-container",ref:j=>{D.current=j,pe.current=j,X.current=j,Le.current=j},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{hidden:Te,onClick:j=>{var O;j.target.closest("a, button")||(O=D.current)==null||O.scrollTo({top:0,behavior:"smooth"})},onDblClick:j=>{j.target.closest("a, button")||se(!0)},class:C==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(pt,{}),u??e(Y,{to:"/",class:"button plain home-button",children:e(v,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!m&&m})]}),S.length>0&&C!=="loading"&&!Te&&_&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var j;se(!0),(j=D.current)==null||j.scrollTo({top:0,behavior:"smooth"})},children:[e(v,{icon:"arrow-up"})," New posts"]})]}),!!h&&e("div",{class:`timeline-start ${C==="loading"?"loading":""}`,children:h}),S.length?e(L,{children:[e("ul",{class:`timeline ${g?`timeline-${g}`:""}`,children:[S.map(j=>e(_i,{status:j,instance:o,useItemID:l,filterContext:w,view:g,showFollowedTags:p},j.id+(j==null?void 0:j._pinned)+g)),z&&C==="loading"&&(g==="media"?null:e(L,{children:[e("li",{style:{height:"20vh"},children:e(Me,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(Me,{skeleton:!0})})]}))]}),C==="default"&&(z?e(at,{onChange:j=>{j&&se()},children:e("button",{type:"button",class:"plain block",onClick:()=>se(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):C==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((j,O)=>g==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e(Me,{skeleton:!0})},O))}):C!=="error"&&e("p",{class:"ui-state",children:i}),C==="error"&&e("p",{class:"ui-state",children:[s,e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>se(!S.length),children:"Try again"})]})]})})})}function _i({status:t,instance:n,useItemID:c,filterContext:o,view:i,showFollowedTags:s}){const{id:l,reblog:a,items:d,type:r,_pinned:f}=t;f&&(c=!1);const u=(a==null?void 0:a.id)||l,m=n?`/${n}/s/${u}`:`/s/${u}`;let h="";r==="boosts"?h=`${d.length} Boosts`:r==="pinned"&&(h="Pinned posts");const y=r==="boosts"||r==="pinned";if(d){if(y)return d.sort((p,b)=>{const S=Pt(p.filtered,o),T=Pt(b.filtered,o);return S&&!T?1:!S&&T?-1:0}),e("li",{class:"timeline-item-carousel",children:e(Pi,{title:h,class:`${r}-carousel`,children:d.map(p=>{const{id:b,reblog:S,_pinned:T}=p,C=(S==null?void 0:S.id)||b,E=n?`/${n}/s/${C}`:`/s/${C}`;return T&&(c=!1),e("li",{children:e(Y,{class:"status-carousel-link timeline-item-alt",to:E,children:c?e(Me,{statusID:b,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):e(Me,{status:p,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},b)})})},`timeline-${l}`);const w=d.length>3;return d.map((p,b)=>{const{id:S,_differentAuthor:T}=p,C=n?`/${n}/s/${S}`:`/s/${S}`,E=b>0&&b<d.length-1,z=p.sensitive&&!!p.spoilerText,M=!T&&z&&b>0||w&&E&&(r==="thread"||r==="conversation"&&!T&&!d[b-1]._differentAuthor&&!d[b+1]._differentAuthor),_=b===0,x=b===d.length-1;return e("li",{class:`timeline-item-container timeline-item-container-type-${r} timeline-item-container-${_?"start":x?"end":"middle"} ${T?"timeline-item-diff-author":""}`,children:e(Y,{class:"status-link timeline-item",to:C,children:M?e(Ni,{status:p,instance:n}):c?e(Me,{statusID:S,instance:n,enableCommentHint:x,showFollowedTags:s}):e(Me,{status:p,instance:n,enableCommentHint:x,showFollowedTags:s})})},`timeline-${S}`)})}const g=`timeline-${l+f}`;return i==="media"?c?e(bn,{class:"timeline-item",parent:"li",statusID:l,instance:n},g):e(bn,{class:"timeline-item",parent:"li",status:t,instance:n},g):e("li",{children:e(Y,{class:"status-link timeline-item",to:m,children:c?e(Me,{statusID:l,instance:n,enableCommentHint:!0,showFollowedTags:s}):e(Me,{status:t,instance:n,enableCommentHint:!0,showFollowedTags:s})})},g)}function Pi({title:t,class:n,children:c}){const o=P(),{reachStart:i,reachEnd:s,init:l}=Lt({scrollableRef:o,direction:"horizontal"});return U(()=>{l==null||l()},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{type:"button",class:"small plain2",disabled:i,onClick:()=>{var a,d;(d=o.current)==null||d.scrollBy({left:-Math.min(320,(a=o.current)==null?void 0:a.offsetWidth),behavior:"smooth"})},children:e(v,{icon:"chevron-left"})})," ",e("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var a,d;(d=o.current)==null||d.scrollBy({left:Math.min(320,(a=o.current)==null?void 0:a.offsetWidth),behavior:"smooth"})},children:e(v,{icon:"chevron-right"})})]})]}),e("ul",{ref:o,children:c})]})}function Ni({status:t,instance:n}){const c=ge(k),{id:o,visibility:i}=t,s=Dn(t),l=je(o,n);return e("article",{class:`status compact-thread ${i==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[c.statusThreadNumber[l]?e("div",{class:"status-thread-badge",children:[e(v,{icon:"thread",size:"s"}),c.statusThreadNumber[l]?` ${c.statusThreadNumber[l]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(v,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:s,children:[s,t.sensitive&&t.spoilerText&&e(L,{children:[" ",e("span",{class:"spoiler-badge",children:e(v,{icon:"eye-close",size:"s"})})]})]})]})}function Ui(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const it=20,Zt=1983,yn=`${Zt}-01`,Fi=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function zi(t){var o;const{masto:n}=F({instance:t}),c=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((o=c==null?void 0:c.statuses)!=null&&o.length)}const Oi=tt(zi);function Bi(){const t=ge(k),{id:n,...c}=nt(),[o,i]=Oe(),s=o.get("month"),l=!o.get("replies"),a=!!o.get("boosts"),d=o.get("tagged"),r=!!o.get("media"),{masto:f,instance:u,authenticated:m}=F({instance:c.instance}),{masto:h,instance:y}=F(),g=P(),w=[s,l,a,d,r],[p,b]=$(),S=P(0);U(()=>{S.current=0},w);const T=de(()=>u===y,[u,y]),[C,E]=$(!1);U(()=>{T&&p!=null&&p.acct&&(async()=>{const W=await Oi(u);E(W)})()},[u,T,p==null?void 0:p.acct]);async function z(W){var Ie,Te,j;const A=/^\d{4}-[01]\d$/.test(s),V=((Te=(Ie=s==null?void 0:s.split)==null?void 0:Ie.call(s,"-"))==null?void 0:Te[0])>=Zt;if(A&&V){if(!p)return{value:[],done:!0};const[O,H]=s.split("-"),ue=parseInt(H,10)-1,ce=new Date(O,ue,0),J=`${ce.getFullYear()}-${(ce.getMonth()+1).toString().padStart(2,"0")}-${ce.getDate().toString().padStart(2,"0")}`,I=new Date(O,ue+1,1),N=`${I.getFullYear()}-${(I.getMonth()+1).toString().padStart(2,"0")}-${I.getDate().toString().padStart(2,"0")}`;let Z;W?(Z=it+1,S.current=0):(Z=it+S.current+1,S.current+=it);const ne=await f.v2.search.fetch({q:`from:${p.acct} after:${J} before:${N}`,type:"statuses",limit:Z,offset:S.current});if((j=ne==null?void 0:ne.statuses)!=null&&j.length){const he=ne.statuses.slice(0,it);he.forEach(be=>{xe(be,u)});const $e=ne.statuses.length<=it;return{value:he,done:$e}}else return{value:[],done:!0}}const Q=[];if(W){const{value:O}=await f.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(O!=null&&O.length&&!d&&!r){const H=O.map(ue=>(xe(ue,u),{...ue,_pinned:!0}));if(H.length>=3){const ue=H.map(ce=>ce.id);Q.push({id:ue,items:H,type:"pinned"})}else Q.push(...H)}}(W||!g.current)&&(g.current=f.v1.accounts.$select(n).statuses.list({limit:it,exclude_replies:l,exclude_reblogs:a,only_media:r,tagged:d}));const{value:re,done:we}=await g.current.next();return re!=null&&re.length&&(Q.push(...re),re.forEach(O=>{xe(O,u)})),{value:Q,done:we}}const[M,_]=$([]);Ae(p!=null&&p.acct?`${p!=null&&p.displayName?p.displayName+" ":""}@${p.acct}${l?a?" (- Boosts)":d?` (#${d})`:r?" (Media)":s?` (${new Date(s).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const x=P(),G=He(()=>{const W=x.current||f.v1.accounts.$select(n).fetch();return x.current=W,W},[n,f]);U(()=>{(async()=>{try{const W=await G();b(W)}catch{}try{const W=await f.v1.accounts.$select(n).featuredTags.list();_(W)}catch{}})()},[n]);const{displayName:R,acct:D,emojis:B}=p||{},se=de(()=>{const W=t.accounts[`${n}@${u}`];return e(jn,{instance:u,account:W||n,fetchAccount:G,authenticated:m,standalone:!0})},[n,u,m,G]),ie=P(),pe=de(()=>e(L,{children:[se,e("div",{class:"filter-bar",ref:ie,style:{position:"relative"},children:[!l||a||d||r||!!s?e(Y,{to:`/${u}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(v,{icon:"x",size:"l"})},"clear-filters"):e(v,{icon:"filter",class:"insignificant",size:"l"}),e(Y,{to:`/${u}/a/${n}${l?"?replies=1":""}`,onClick:()=>{l&&le("Showing post with replies")},class:l?"":"is-active",children:"+ Replies"}),e(Y,{to:`/${u}/a/${n}${a?"":"?boosts=0"}`,onClick:()=>{a||le("Showing posts without boosts")},class:a?"is-active":"",children:"- Boosts"}),e(Y,{to:`/${u}/a/${n}${r?"":"?media=1"}`,onClick:()=>{r||le("Showing posts with media")},class:r?"is-active":"",children:"Media"}),M.map(A=>e(Y,{to:`/${u}/a/${n}${d===A.name?"":`?tagged=${encodeURIComponent(A.name)}`}`,onClick:()=>{d!==A.name&&le(`Showing posts tagged with #${A.name}`)},class:d===A.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),A.name]})},A.id)),C&&(Fi?e("label",{class:`filter-field ${s?"is-active":""}`,children:[e(v,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(p!=null&&p.acct),value:s||"",min:yn,max:new Date().toISOString().slice(0,7),onInput:A=>{const{value:V,validity:Q}=A.currentTarget;Q.valid&&(i(V?{month:V}:{}),le(`Showing posts in ${new Date(V).toLocaleString("default",{month:"long",year:"numeric"})}`))}})]}):e(qi,{class:`filter-field ${s?"is-active":""}`,disabled:!(p!=null&&p.acct),value:s||"",min:yn,max:new Date().toISOString().slice(0,7),onInput:A=>{const{value:V,validity:Q}=A;Q.valid&&i(V?{month:V}:{})}}))]})]}),[n,u,m,M,C,...w]);U(()=>{var A;const W=(A=ie.current)==null?void 0:A.querySelector(".is-active");W&&ie.current.scrollTo({behavior:"smooth",left:W.offsetLeft-(ie.current.offsetWidth-W.offsetWidth)/2})},[M,C,...w]);const X=de(()=>p!=null&&p.url?new URL(p.url).hostname:null,[p]),fe=!!p&&!(u===X);return e(Ge,{title:`${p!=null&&p.acct?"@"+p.acct:"Posts"}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(Ln,{text:R,emojis:B})}),e("div",{children:e("span",{children:["@",D]})})]}),id:"account-statuses",instance:u,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:z,useItemID:!0,view:r?"media":void 0,boostsCarousel:t.settings.boostsCarousel,timelineStart:pe,refresh:[l,a,d,r,s+(p==null?void 0:p.acct)].toString(),headerEnd:e(Ne,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(v,{icon:"more",size:"l"})}),children:[e(ee,{disabled:!fe,onClick:()=>{(async()=>{try{const{masto:W}=F({instance:X}),A=await W.v1.accounts.lookup({acct:p.acct}),{id:V}=A;location.hash=`/${X}/a/${V}`}catch{alert("Unable to fetch account info")}})()},children:[e(v,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:X}),")"]})]}),!T&&e(ee,{onClick:()=>{(async()=>{try{const W=await h.v1.accounts.lookup({acct:p.acct+"@"+u}),{id:A}=W;location.hash=`/${y}/a/${A}`}catch{alert("Unable to fetch account info")}})()},children:[e(v,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to my instance (",e("b",{children:y}),")"]})]})]})},n)}function qi(t){const{class:n,disabled:c,value:o,min:i,max:s,onInput:l=()=>{}}=t,[a,d]=(o==null?void 0:o.split("-"))||[],r=P(),f=P(),u=(m,h)=>{const[y,g]=(i==null?void 0:i.split("-"))||[],[w,p]=(s==null?void 0:s.split("-"))||[];return!(h<y||h>w||h===y&&m<g||h===w&&m>p)};return e("div",{class:n,children:[e(v,{icon:"month",size:"l"}),e("select",{ref:r,disabled:c,value:d||"",onInput:m=>{const{value:h}=m.currentTarget,y=f.current.value;if(!u(h,y))return{value:"",validity:{valid:!1}};l({value:h?`${y}-${h}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(m,h)=>e("option",{value:(h+1).toString().padStart(2,"0"),children:new Date(0,h).toLocaleString("default",{month:"long"})},h))]})," ",e("input",{ref:f,type:"number",disabled:c,value:a||new Date().getFullYear(),min:(i==null?void 0:i.slice(0,4))||Zt,max:(s==null?void 0:s.slice(0,4))||new Date().getFullYear(),onInput:m=>{const{value:h,validity:y}=m.currentTarget,g=r.current.value;if(!y.valid||!u(g,h))return{value:"",validity:{valid:!1}};l({value:h?`${h}-${g}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const Hi=20;function Jn(){Ae("Bookmarks","/b");const{masto:t,instance:n}=F(),c=P();async function o(i){return(i||!c.current)&&(c.current=t.v1.bookmarks.list({limit:Hi})),await c.current.next()}return e(Ge,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:o})}const Vi=20;function Xn(){Ae("Likes","/f");const{masto:t,instance:n}=F(),c=P();async function o(i){return(i||!c.current)&&(c.current=t.v1.favourites.list({limit:Vi})),await c.current.next()}return e(Ge,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:o})}function ji(){const{masto:t,instance:n}=F();Ae("Followed Hashtags","/ft");const[c,o]=$("default"),[i,s]=$([]);return U(()=>{o("loading"),(async()=>{try{const l=await It();s(l),o("default")}catch{o("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(pt,{}),e(Y,{to:"/",class:"button plain",children:e(v,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:i.length>0?e("ul",{class:"link-list",children:i.map(l=>e("li",{children:e(Y,{to:n?`/${n}/t/${l.name}`:`/t/${l.name}`,children:[e(v,{icon:"hashtag"})," ",e("span",{children:l.name})]})}))}):c==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):c==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const Gi=20;function Yt({title:t,path:n,id:c,...o}){Ae(t||"Following",n||"/following");const{masto:i,streaming:s,instance:l}=F(),a=ge(k),d=P(),r=P();async function f(m){(m||!d.current)&&(d.current=i.v1.timelines.home.list({limit:Gi}));const h=await d.current.next();let{value:y}=h;return y!=null&&y.length&&(m&&(r.current=y[0].id),y.forEach(g=>{xe(g,l)}),y=gn(y,l),m&&Ei(),Ri(y,l),y.sort((g,w)=>{const p=new Date(g.createdAt);return new Date(w.createdAt)-p})),{...h,value:y}}async function u(){try{const m=await i.v1.timelines.home.list({limit:5,since_id:r.current}).next();let{value:h}=m;return!!(h!=null&&h.length&&(r.current=h[0].id,h=gn(h,l),h=ft(h,"home"),h.some(y=>!y.reblog)))}catch{return!1}}return U(()=>{let m;return(async()=>{if(s){m=s.user.subscribe();for await(const h of m){if(!m)break;if(h.event==="status.update"){const y=h.payload;xe(y,l)}else if(h.event==="delete"){const y=h.payload,g=_n(y,l);g&&(g._deleted=!0)}}}})(),()=>{var h;(h=m==null?void 0:m.unsubscribe)==null||h.call(m),m=null}},[s]),e(Ge,{title:t||"Following",id:c||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:l,fetchItems:f,checkForUpdates:u,useItemID:!0,boostsCarousel:a.settings.boostsCarousel,...o,filterContext:"home",showFollowedTags:!0})}const Wi=20,Ki=4,wn=Ki+1;function Qn({media:t,columnMode:n,...c}){let{hashtag:o,...i}=n?{}:nt();c.hashtag&&(o=c.hashtag);let s=o.trim().split(/[\s+]+/);s.sort(),o=s[0];const[l,a]=Oe(),d=t||!!l.get("media"),r=d?"?media=1":"",{masto:f,instance:u,authenticated:m}=F({instance:(c==null?void 0:c.instance)||i.instance}),{masto:h,instance:y,authenticated:g}=F(),w=s.map(R=>`#${R}`).join(" "),p=d?" (Media only)":"",b=u?`${w}${p} on ${u}`:`${w}${p}`;Ae(b,"/:instance?/t/:hashtag");const S=P(),T=P(void 0);async function C(R){const D=await f.v1.timelines.tag.$select(o).list({limit:Wi,any:s.slice(1),maxId:R?void 0:T.current,onlyMedia:d}).next();let{value:B}=D;return B!=null&&B.length&&(R&&(S.current=B[0].id),B.forEach(se=>{xe(se,u,{skipThreading:d})}),T.current=B[B.length-1].id),{...D,value:B}}async function E(){try{const R=await f.v1.timelines.tag.$select(o).list({limit:1,any:s.slice(1),since_id:S.current,onlyMedia:d}).next();let{value:D}=R;return D=ft(D,"public"),!!(D!=null&&D.length)}catch{return!1}}const[z,M]=$("default"),[_,x]=$();U(()=>{(async()=>{try{const R=await f.v1.tags.$select(o).fetch();x(R)}catch{}})()},[o]);const G=s.length>=wn;return e(Ge,{title:b,titleComponent:!!u&&e("h1",{class:"header-double-lines",children:[e("b",{children:w}),e("div",{children:u})]}),id:"hashtag",instance:u,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:C,checkForUpdates:E,useItemID:!0,view:d?"media":void 0,refresh:d,filterContext:"public",headerEnd:e(Ne,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(v,{icon:"more",size:"l"})}),children:[!!_&&s.length===1&&e(L,{children:[e(Fe,{subMenu:!0,confirm:_.following,confirmLabel:`Unfollow #${o}?`,disabled:z==="loading"||!m,onClick:()=>{M("loading"),_.following?f.v1.tags.$select(o).unfollow().then(()=>{x({..._,following:!1}),le(`Unfollowed #${o}`)}).catch(R=>{alert(R)}).finally(()=>{M("default")}):f.v1.tags.$select(o).follow().then(()=>{x({..._,following:!0}),le(`Followed #${o}`)}).catch(R=>{alert(R)}).finally(()=>{M("default")})},children:_.following?e(L,{children:[e(v,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(L,{children:[e(v,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(Ee,{})]}),e(On,{className:"plain",children:"Filters"}),e(ee,{type:"checkbox",checked:!!d,onClick:()=>{d?l.delete("media"):l.set("media","1"),a(l)},children:[e(v,{icon:"check-circle"})," ",e("span",{class:"menu-grow",children:"Media only"})]}),e(Ee,{}),e($s,{className:"menu-field",disabled:G,children:({ref:R})=>e("form",{onSubmit:D=>{var se,ie;D.preventDefault();const B=(ie=(se=D.target[0].value)==null?void 0:se.trim)==null?void 0:ie.call(se);B&&!s.some(pe=>pe.toLowerCase()===B.toLowerCase())&&(s.push(B),s.sort(),location.hash=u?`/${u}/t/${s.join("+")}`:`/t/${s.join("+")}${r}`)},children:[e(v,{icon:"hashtag"}),e("input",{ref:R,type:"text",placeholder:G?`Max ${wn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:G})]})}),e(Cs,{takeOverflow:!0,children:s.map((R,D)=>e(ee,{disabled:s.length===1,onClick:B=>{s.splice(D,1),s.sort(),location.hash=u?`/${u}/t/${s.join("+")}${r}`:`/t/${s.join("+")}${r}`},children:[e(v,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),R]})]},R))}),e(Ee,{}),e(ee,{disabled:!g,onClick:()=>{if(k.shortcuts.length>=Je){alert(`Max ${Je} shortcuts reached. Unable to add shortcut.`);return}const R={type:"hashtag",hashtag:s.join(" "),instance:u,media:d?"on":void 0};k.shortcuts.some(B=>B.type===R.type&&B.hashtag.split(/[\s+]+/).sort().join(" ")===R.hashtag.split(/[\s+]+/).sort().join(" ")&&(B.instance?B.instance===R.instance:!0)&&(B.media?!!B.media==!!R.media:!0))?alert("This shortcut already exists"):(k.shortcuts.push(R),le("Hashtag shortcut added"))},children:[e(v,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(ee,{onClick:()=>{let R=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(R)){R&&alert("Invalid instance");return}R&&(R=R.toLowerCase().trim(),location.hash=`/${R}/t/${s.join("+")}${r}`)},children:[e(v,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),y!==u&&e(ee,{onClick:()=>{location.hash=`/${y}/t/${s.join("+")}${r}`},children:[e(v,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:y}),")"]})]})]})},u+w)}const Zi=20;function es(t){var g;const n=ge(k),{masto:c,instance:o}=F(),i=(t==null?void 0:t.id)||((g=nt())==null?void 0:g.id),s=P(),l=P();async function a(w){(w||!l.current)&&(l.current=c.v1.timelines.list.$select(i).list({limit:Zi}));const p=await l.current.next();let{value:b}=p;return b!=null&&b.length&&(w&&(s.current=b[0].id),b.forEach(S=>{xe(S,o)})),{...p,value:b}}async function d(){try{const w=await c.v1.timelines.list.$select(i).list({limit:1,since_id:s.current});let{value:p}=w;return p=ft(p,"home"),!!(p!=null&&p.length)}catch{return!1}}const[r,f]=$({title:"List"});Ae(r.title,"/l/:id"),U(()=>{(async()=>{try{const w=await c.v1.lists.$select(i).fetch();f(w)}catch{}})()},[i]);const[u,m]=$(!1),[h,y]=$(!1);return e(L,{children:[e(Ge,{title:r.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:o,fetchItems:a,checkForUpdates:d,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",headerStart:e(Y,{to:"/l",class:"button plain",children:e(v,{icon:"list",size:"l"})}),headerEnd:e(Ne,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(v,{icon:"more",size:"l"})}),children:[e(ee,{onClick:()=>m({list:r}),children:[e(v,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(ee,{onClick:()=>y(!0),children:[e(v,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},i),u&&e(Se,{class:"light",onClick:w=>{w.target===w.currentTarget&&m(!1)},children:e(Wt,{list:u==null?void 0:u.list,onClose:w=>{w.state==="success"&&w.list?f(w.list):w.state==="deleted"&&(location.hash="/l"),m(!1)}})}),h&&e(Se,{class:"light",onClick:w=>{w.target===w.currentTarget&&y(!1)},children:e(Ji,{listID:i,onClose:()=>y(!1)})})]})}const Yi=40;function Ji({listID:t,onClose:n}){const{masto:c,instance:o}=F(),[i,s]=$([]),[l,a]=$("default"),[d,r]=$(!1),f=P();async function u(m){r(!1),a("loading"),(async()=>{try{(m||!f.current)&&(f.current=c.v1.lists.$select(t).accounts.list({limit:Yi}));const h=await f.current.next();let{done:y,value:g}=h;g!=null&&g.length?(s(m?g:i.concat(g)),r(!y)):r(!1),a("default")}catch{a("error")}})()}return U(()=>{u(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(v,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[i.map(m=>e("li",{children:[e(qe,{account:m,instance:o}),e(Xi,{account:m,listID:t})]},m.id)),d&&l==="default"&&e(at,{as:"li",onChange:m=>m&&u(),children:e("button",{type:"button",class:"light block",onClick:u,children:"Show more…"})})]})})]})}function Xi({account:t,listID:n}){const{masto:c}=F(),[o,i]=$("default"),[s,l]=$(!1);return e(Fe,{confirm:!s,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(i("loading"),(async()=>{try{await c.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),i("default"),l(!1)}catch{i("error")}})()):(i("loading"),(async()=>{try{await c.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),i("default"),l(!0)}catch{i("error")}})())},children:e("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:o==="loading",children:s?"Add":"Remove…"})})}const vn=20,Qi=new URLSearchParams;function ts({columnMode:t,...n}){const{masto:c,instance:o}=F(),[i]=t?[Qi]:Oe(),[s,l]=$(null),a=(n==null?void 0:n.type)||i.get("type")||s;Ae(`Mentions${a==="private"?" (Private)":""}`,"/mentions");const d=P(),r=P();async function f(p){(p||!d.current)&&(d.current=c.v1.notifications.list({limit:vn,types:["mention"]}));const b=await d.current.next();let{value:S}=b;return S!=null&&S.length&&(p&&(r.current=S[0].id),S.forEach(({status:T})=>{xe(T,o)})),{...b,value:S==null?void 0:S.map(T=>T.status)}}const u=P(),m=P();async function h(p){(p||!u.current)&&(u.current=c.v1.conversations.list({limit:vn}));const b=await u.current.next();let{value:S}=b;return S=S==null?void 0:S.filter(T=>T.lastStatus),S!=null&&S.length&&(p&&(m.current=S[0].lastStatus.id),S.forEach(({lastStatus:T})=>{xe(T,o)})),{...b,value:S==null?void 0:S.map(T=>T.lastStatus)}}function y(...p){return a==="private"?h(...p):f(...p)}async function g(){if(a==="private")try{const p=await c.v1.conversations.list({limit:1,since_id:m.current}).next();let{value:b}=p;return b!=null&&b.length?(m.current=b[0].lastStatus.id,!0):!1}catch{return!1}else try{const p=await c.v1.notifications.list({limit:1,types:["mention"],since_id:r.current}).next();let{value:b}=p;return b!=null&&b.length?(r.current=b[0].id,!0):!1}catch{return!1}}const w=de(()=>e("div",{class:"filter-bar centered",children:[e(Y,{to:"/mentions",class:a?"":"is-active",onClick:p=>{t&&(p.preventDefault(),l(null))},children:"All"}),e(Y,{to:"/mentions?type=private",class:a==="private"?"is-active":"",onClick:p=>{t&&(p.preventDefault(),l("private"))},children:"Private"})]}),[a]);return e(Ge,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:o,fetchItems:y,checkForUpdates:g,useItemID:!0,timelineStart:w,refresh:a})}const eo={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function to(t){return t.filter(n=>{const{type:c,id:o,createdAt:i}=n;if(!c)return!1;const s=eo[c];return s!=null&&s.length?s.every(l=>!!n[l]):!0})}function ns(t){t=to(t);const n={},c=[];for(let s=0,l=0;s<t.length;s++){const a=t[s],{id:d,status:r,account:f,type:u,createdAt:m}=a,h=m?new Date(m).toLocaleDateString():"";let y=u;(u==="favourite"||u==="reblog")&&(y="favourite+reblog");const g=`${r==null?void 0:r.id}-${y}-${h}`,w=n[g];if(y==="follow_request")c[l++]=a;else if(w!=null&&w.account){const p=w._accounts.find(b=>b.id===f.id);p?(p._types.push(u),p._types.sort().reverse(),w.id+=`-${d}`):(f._types=[u],w._accounts.push(f),w.id+=`-${d}`)}else{f._types=[u];let p=n[g]={...a,type:y,_accounts:[f]};c[l++]=p}}const o={},i=[];for(let s=0,l=0;s<c.length;s++){const a=c[s],{id:d,account:r,_accounts:f,type:u,createdAt:m}=a,h=m?new Date(m).toLocaleDateString():"";if(u==="favourite+reblog"&&r&&f.length===1){const y=`${r==null?void 0:r.id}-${u}-${h}`,g=o[y];if(g)g._statuses.push(a.status),g.id+=`-${d}`;else{let w=o[y]={...a,type:u,_statuses:[a.status]};i[l++]=w}}else i[l++]=a}return i}const no=30,so=new URLSearchParams;function io({columnMode:t}){Ae("Notifications","/notifications");const{masto:n,instance:c}=F(),o=ge(k),[i,s]=$("default"),[l]=t?[so]:Oe(),a=l.get("id"),d=l.get("access_token"),[r,f]=$(!1),[u,m]=$(!1),h=P(),{nearReachEnd:y,scrollDirection:g,reachStart:w,nearReachStart:p}=Lt({scrollableRef:h}),b=g==="end"&&!p,[S,T]=$([]),[C,E]=$([]),z=P();async function M(A){(A||!z.current)&&(z.current=n.v1.notifications.list({limit:no,excludeTypes:["follow_request"]}));const V=await z.current.next(),Q=V.value;if(Q!=null&&Q.length){Q.forEach(we=>{xe(we.status,c,{skipThreading:!0})});const re=ns(Q);A?(k.notificationsLast=Q[0],k.notifications=re,n.v1.markers.create({notifications:{lastReadId:Q[0].id}}).catch(()=>{})):k.notifications.push(...re)}return k.notificationsShowNew=!1,k.notificationsLastFetchTime=Date.now(),V}async function _(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const x=()=>{s("loading"),(async()=>{try{const A=await _();T(A),s("default")}catch{s("error")}})()};async function G(){try{return await n.v1.announcements.list()}catch{return[]}}const R=A=>{B(!1),s("loading"),(async()=>{try{const V=M(A);A&&(G().then(re=>{re.sort((we,Ie)=>{const Te=new Date(we.updatedAt||we.createdAt);return new Date(Ie.updatedAt||Ie.createdAt)-Te}),E(re)}).catch(()=>{}),_().then(re=>{T(re)}).catch(()=>{}));const{done:Q}=await V;f(!Q),s("default")}catch{s("error")}})()};U(()=>{R(!0)},[]),U(()=>{w&&R(!0)},[w]);const[D,B]=$(!1),se=He(({disableIdleCheck:A=!1}={})=>{var V;i!=="loading"&&o.settings.autoRefresh&&((V=h.current)==null?void 0:V.scrollTop)<16&&(A||window.__IDLE__)&&!oo()&&R(!0)},[o.notificationsShowNew,o.settings.autoRefresh,i]),ie=P();ht(A=>{let V;if(A){const Q=Date.now()-ie.current;!ie.current||Q>1e3*3?se({disableIdleCheck:!0}):ie.current=Date.now(),V=xs(k,"notificationsShowNew",re=>{re&&se(),B(re)})}return()=>{V==null||V()}});const pe=new Date,X=new Date(pe-24*60*60*1e3);let Le=new Date;const fe=!o.notifications.some(A=>new Date(A.createdAt).toDateString()===pe.toDateString()),W=P();return U(()=>{a&&(k.routeNotification={id:a,accessToken:atob(d)})},[a,d]),e("div",{id:"notifications-page",class:"deck-container",ref:h,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${u?"only-mentions":""}`,children:[e("header",{hidden:b,onClick:A=>{var V;A.target.closest("a, button")||(V=h.current)==null||V.scrollTo({top:0,behavior:"smooth"})},class:i==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(pt,{}),e(Y,{to:"/",class:"button plain",children:e(v,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),D&&i!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var A;R(!0),(A=h.current)==null||A.scrollTo({top:0,behavior:"smooth"})},children:[e(v,{icon:"arrow-up"})," New notifications"]})]}),C.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(v,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",C.length>1?"s":""]})," ",e("small",{class:"insignificant",children:c})]}),C.length>1&&e("span",{class:"announcements-nav-buttons",children:C.map((A,V)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var Q;(Q=W.current)==null||Q.children[V].scrollIntoView({behavior:"smooth",block:"nearest"})},children:V+1}))})]}),e("ul",{class:`announcements-list-${C.length>1?"multiple":"single"}`,ref:W,children:C.map(A=>e("li",{children:e(co,{announcement:A})}))})]})})}),S.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),S.length>5?e("details",{children:[e("summary",{children:[S.length," follow requests"]}),e("ul",{children:S.map(A=>e("li",{children:[e(qe,{account:A}),e(Ft,{accountID:A.id,onChange:()=>{}})]},A.id))})]}):e("ul",{children:S.map(A=>e("li",{children:[e(qe,{account:A}),e(Ft,{accountID:A.id,onChange:()=>{}})]},A.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:u,onChange:A=>{m(A.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),fe&&!!o.notifications.length&&e("p",{class:"ui-state insignificant",children:i==="default"?"You're all caught up.":e(L,{children:"…"})}),o.notifications.length?e(L,{children:o.notifications.filter(A=>A.type!=="follow_request").map(A=>{if(u&&A.type!=="mention")return null;const V=new Date(A.createdAt),Q=V.toDateString()!==Le.toDateString();Q&&(Le=V);const re=V.toDateString()===X.toDateString()?"Yesterday":Ye(Le,{hideTime:!0});return e(L,{children:[Q&&e("h2",{class:"timeline-header",children:re}),e(Kt,{instance:c,notification:A},A.id)]},A.id)})}):e(L,{children:[i==="loading"&&e(L,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((A,V)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(v,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),i==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>R(!0),children:"Try again"})]})]}),r&&e(at,{onChange:A=>{A&&R()},children:e("button",{type:"button",class:"plain block",disabled:i==="loading",onClick:()=>R(),style:{marginBlockEnd:"6em"},children:i==="loading"?e(ve,{abrupt:!0}):e(L,{children:"Show more…"})})})]})})}function oo(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function co({announcement:t}){const{instance:n}=F(),{contact:c}=ms(),o=c==null?void 0:c.account,{id:i,content:s,startsAt:l,endsAt:a,published:d,allDay:r,publishedAt:f,updatedAt:u,read:m,mentions:h,statuses:y,tags:g,emojis:w,reactions:p}=t,b=new Date(f),S=Ye(b),T=new Date(u),C=Ye(T);return e("div",{class:"announcement-block",children:[e(qe,{account:o}),e("div",{class:"announcement-content",onClick:xn({mentions:h,instance:n}),dangerouslySetInnerHTML:{__html:_t(s,{emojis:w})}}),e("p",{class:"insignificant",children:[e("time",{datetime:b.toISOString(),children:Ye(b)}),u&&C!==S&&e(L,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:T.toISOString(),children:Ye(T)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:p.map(E=>{const{name:z,count:M,me:_,staticUrl:x,url:G}=E;return e("button",{type:"button",class:`plain4 small ${_?"reacted":""}`,children:[G||x?e("img",{src:G||x,alt:z,width:"16",height:"16"}):e("span",{children:z})," ",e("span",{class:"count",children:_e(M)})]})})})]})}const ss=ze(io),ao=20;function zt({local:t,columnMode:n,...c}){const o=ge(k),i=!!t,s=n?{}:nt(),{masto:l,instance:a}=F({instance:(c==null?void 0:c.instance)||s.instance}),{masto:d,instance:r}=F(),f=`${i?"Local":"Federated"} timeline (${a})`;Ae(f,i?"/:instance?/p/l":"/:instance?/p");const u=P(),m=P();async function h(g){(g||!m.current)&&(m.current=l.v1.timelines.public.list({limit:ao,local:i}));const w=await m.current.next();let{value:p}=w;return p!=null&&p.length&&(g&&(u.current=p[0].id),p.forEach(b=>{xe(b,a)})),{...w,value:p}}async function y(){try{const g=await l.v1.timelines.public.list({limit:1,local:i,since_id:u.current}).next();let{value:w}=g;return w=ft(w,"public"),!!(w!=null&&w.length)}catch{return!1}}return e(Ge,{title:f,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:i?"Local timeline":"Federated timeline"}),e("div",{children:a})]}),id:"public",instance:a,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:h,checkForUpdates:y,useItemID:!0,headerStart:e(L,{}),boostsCarousel:o.settings.boostsCarousel,filterContext:"public",headerEnd:e(Ne,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(v,{icon:"more",size:"l"})}),children:[e(ee,{href:i?`/#/${a}/p`:`/#/${a}/p/l`,children:i?e(L,{children:[e(v,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(L,{children:[e(v,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(Ee,{}),e(ee,{onClick:()=>{let g=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(g)){g&&alert("Invalid instance");return}g&&(g=g.toLowerCase().trim(),location.hash=i?`/${g}/p/l`:`/${g}/p`)},children:[e(v,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),r!==a&&e(ee,{onClick:()=>{location.hash=i?`/${r}/p/l`:`/${r}/p`},children:[e(v,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:r}),")"]})]})]})},a+i)}const ro=20,lo=tt(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function is({columnMode:t,...n}){const c=ge(k),o=t?{}:nt(),{masto:i,instance:s}=F({instance:(n==null?void 0:n.instance)||o.instance}),{masto:l,instance:a}=F(),d=`Trending (${s})`;Ae(d,"/:instance?/trending");const r=P(),[f,u]=$([]),[m,h]=$([]),y=P();async function g(b){var C;if(b||!y.current){y.current=i.v1.trends.statuses.list({limit:ro});try{const E=i.v1.trends.tags.list(),{value:z}=await E.next();z!=null&&z.length&&u(z)}catch{}try{const{value:E}=await lo(i),z=(C=E==null?void 0:E.filter)==null?void 0:C.call(E,M=>M.type==="link");z!=null&&z.length&&h(z)}catch{}}const S=await y.current.next();let{value:T}=S;return T!=null&&T.length&&(b&&(r.current=T[0].id),T.forEach(E=>{xe(E,s)})),{...S,value:T}}async function w(){try{const b=await i.v1.trends.statuses.list({limit:1}).next();let{value:S}=b;return S=ft(S,"public"),S!=null&&S.length&&S[0].id!==r.current?(r.current=S[0].id,!0):!1}catch{return!1}}const p=de(()=>e(L,{children:[!!f.length&&e("div",{class:"filter-bar expandable",children:[e(v,{icon:"chart",class:"insignificant",size:"l"}),f.map((b,S)=>{const{name:T,history:C}=b,E=C.reduce((z,M)=>z+ +M.uses,0);return e(Y,{to:`/${s}/t/${T}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),T]}),e("span",{class:"filter-count",children:_e(E)})]},T)})]}),!!m.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),m.map(b=>{const{authorName:S,authorUrl:T,blurhash:C,description:E,height:z,image:M,imageDescription:_,language:x,providerName:G,providerUrl:R,publishedAt:D,title:B,url:se,width:ie}=b,pe=new URL(se).hostname.replace(/^www\./,"").replace(/\/$/,"");let X;if(C){const Le=Pn(C),fe=Gn(Le);X=Wn([.6,fe[1],fe[2]])}return e("a",{href:se,target:"_blank",rel:"noopener noreferrer",style:X?{"--accent-color":`rgb(${X.join(",")})`,"--accent-alpha-color":`rgba(${X.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:M,alt:_,width:ie,height:z,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:pe})," ",!!D&&e(L,{children:"· "}),!!D&&e(L,{children:e($t,{datetime:D,format:"micro"})})]}),!!B&&e("h1",{class:"title",lang:x,dir:"auto",children:B})]}),!!E&&e("p",{class:"description",lang:x,dir:"auto",children:E})]})]})},se)})]})]}),[f,m]);return e(Ge,{title:d,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:"Trending"}),e("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:g,checkForUpdates:w,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(L,{}),boostsCarousel:c.settings.boostsCarousel,filterContext:"public",timelineStart:p,headerEnd:e(Ne,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(v,{icon:"more",size:"l"})}),children:[e(ee,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[e(v,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),a!==s&&e(ee,{onClick:()=>{location.hash=`/${a}/trending`},children:[e(v,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:a}),")"]})]})]})},s)}function uo(){Ae("Home","/");const t=ge(k),{shortcuts:n}=t,c=n.map(o=>{if(!o)return null;const{type:i,...s}=o,l={following:Yt,notifications:ss,list:es,public:zt,bookmarks:Jn,favourites:Xn,hashtag:Qn,mentions:ts,trending:is}[i];return l?e(l,{...s,columnMode:!0},i+JSON.stringify(s)):null});return Ce(["1","2","3","4","5","6","7","8","9"],(o,i)=>{try{const s=parseInt(i.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),e("div",{id:"columns",onContextMenu:o=>{o.target.closest(".deck > header")&&!o.target.closest("a")&&!o.target.closest("button")&&(o.preventDefault(),k.showShortcutsSettings=!0)},children:c})}function ho(){var n;const t=ge(k);return U(()=>{(async()=>{const c=await lt.drafts.keys();if(c.length){const o=An();c.filter(s=>s.startsWith(o)).length&&(k.showDrafts=!0)}})()},[]),e(L,{children:(t.settings.shortcutsViewMode==="multi-column"||!t.settings.shortcutsViewMode&&t.settings.shortcutsColumnsMode)&&((n=t.shortcuts)!=null&&n.length)?e(uo,{}):e(Yt,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(fo,{})})})}function fo(){const t=ge(k),n=P(),[c,o]=$(void 0);return e(L,{children:[e(Y,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${c||""}`,onClick:i=>{i.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(i.preventDefault(),o(s=>s?void 0:"open"))},children:e(v,{icon:"notification",size:"l",alt:"Notifications"})}),e(go,{state:c,anchorRef:n,onClose:()=>o(void 0)})]})}const po=30,mo=5;function go({anchorRef:t,state:n,onClose:c}){const{masto:o,instance:i}=F(),s=ge(k),[l,a]=$("default"),d=o.v1.notifications.list({limit:po});async function r(){const y=await d.next(),g=y.value;if(g!=null&&g.length){g.forEach(p=>{xe(p.status,i,{skipThreading:!0})});const w=ns(g);k.notificationsLast=g[0],k.notifications=w,o.v1.markers.create({notifications:{lastReadId:g[0].id}}).catch(()=>{})}return k.notificationsShowNew=!1,k.notificationsLastFetchTime=Date.now(),y}const[f,u]=$(!1);function m(){return o.v1.followRequests.list({limit:1})}function h(){a("loading"),(async()=>{try{await r();const y=await m();u(!!(y!=null&&y.length)),a("default")}catch{a("error")}})()}return U(()=>{n==="open"&&h()},[n]),e(Fn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:c,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:s.notifications.length?e(L,{children:s.notifications.slice(0,mo).map(y=>e(Kt,{instance:i,notification:y},y.id))}):l==="loading"?e("div",{class:"ui-state",children:e(ve,{abrupt:!0})}):l==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:h,children:"Try again"})})]})}),e("footer",{children:[e(Y,{to:"/mentions",class:"button plain",children:[e(v,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(Y,{to:"/notifications",class:"button plain2",children:[f?e(L,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(v,{icon:"arrow-right"})]})]})]})}const bo=ze(ho),yo=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function os(t){const{hostname:n,pathname:c}=new URL(t);for(const o of yo){const[,i]=c.match(o)||[];if(i)return{instance:n,id:i}}return null}function wo(t){const{instance:n,id:c}=os(t);return n&&c?`/${n}/s/${c}`:null}function vo(){const n=ct().pathname.replace(/^\//,""),c=os(n),o=c!=null&&c.instance?`/${c.instance}/s/${c.id}`:null,[i,s]=$("loading");return Ve(()=>{s("loading"),(async()=>{const{instance:l,id:a}=c,{masto:d}=F({instance:l});try{if(await d.v1.statuses.$select(a).fetch()){window.location.hash=o+"?view=full";return}}catch{}{const{masto:r,instance:f}=F(),u=await r.v2.search.fetch({q:n,type:"statuses",limit:1,resolve:!0});if(u.statuses.length){const m=u.statuses[0];window.location.hash=`/${f}/s/${m.id}?view=full`}else window.location.hash=o+"?view=full"}})()},[o]),e("div",{class:"ui-state",tabIndex:"-1",children:[i==="loading"?e(L,{children:[e(ve,{abrupt:!0}),e("h2",{children:"Resolving…"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):e(L,{children:[e("h2",{children:"Unable to resolve URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(Y,{to:"/",children:"Go home"})})]})}function ko(){const{masto:t}=F();Ae("Lists","/l");const[n,c]=$("default"),[o,i]=Ct(r=>r+1,0),[s,l]=$([]);U(()=>{c("loading"),(async()=>{try{const r=await t.v1.lists.list();r.sort((f,u)=>f.title.localeCompare(u.title)),l(r),c("default")}catch{c("error")}})()},[o]);const[a,d]=$(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(pt,{}),e(Y,{to:"/",class:"button plain",children:e(v,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>d(!0),children:e(v,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(r=>e("li",{children:e(Y,{to:`/l/${r.id}`,children:e("span",{children:[e(v,{icon:"list"})," ",e("span",{children:r.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(ve,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),a&&e(Se,{class:"light",onClick:r=>{r.target===r.currentTarget&&d(!1)},children:e(Wt,{list:a==null?void 0:a.list,onClose:r=>{r.state==="success"&&i(),d(!1)}})})]})}const So=""+new URL("instances-cddSOnAA.json",import.meta.url).href;var Io={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_CLIENT_NAME:To,VITE_WEBSITE:$o}=Io,Jt="read write follow push";async function Co({instanceURL:t}){const n=new URLSearchParams({client_name:To,redirect_uris:location.origin+location.pathname,scopes:Jt,website:$o});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function xo({instanceURL:t,client_id:n}){const c=new URLSearchParams({client_id:n,scope:Jt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${c.toString()}`}async function Lo({instanceURL:t,client_id:n,client_secret:c,code:o}){const i=new URLSearchParams({client_id:n,client_secret:c,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:o,scope:Jt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()})).json()}function Mo(){Ae("Log in");const t=P(),n=te.local.get("instanceURL"),[c,o]=$("default"),[i]=Oe(),s=i.get("instance"),[l,a]=$(s||(n==null?void 0:n.toLowerCase())||""),[d,r]=$([]);U(()=>{(async()=>{try{const p=await(await fetch(So)).json();r(p)}catch{}})()},[]);const f=w=>{w&&(te.local.set("instanceURL",w),(async()=>{o("loading");try{const{client_id:p,client_secret:b,vapid_key:S}=await Co({instanceURL:w});p&&b?(te.session.set("clientID",p),te.session.set("clientSecret",b),te.session.set("vapidKey",S),location.href=await xo({instanceURL:w,client_id:p})):alert("Failed to register application"),o("default")}catch{o("error")}})())},u=l?l.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,m=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(u)&&!/[\s\/\\@]/.test(u),h=u?d.filter(w=>w.includes(l)).sort((w,p)=>{const b=w.toLowerCase().startsWith(l.toLowerCase()),S=p.toLowerCase().startsWith(l.toLowerCase());return b&&!S?-1:!b&&S?1:0}).slice(0,10):[],y=m?u:h!=null&&h.length?h[0]:l?d.find(w=>w.includes(l)):null;return e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:w=>{w.preventDefault(),f(y)},children:[e("h1",{children:[e("img",{src:jt,alt:"",width:"80",height:"80"}),e("br",{}),"Log in"]}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:l,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:c==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:w=>{a(w.target.value)}}),(h==null?void 0:h.length)>0?e("ul",{id:"instances-suggestions",children:h.map((w,p)=>e("li",{children:e("button",{type:"button",class:"plain5",onClick:()=>{f(w)},children:w})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),c==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{disabled:c==="loading"||!l||!y,children:y?`Continue with ${y}`:"Continue"})," "]}),e(ve,{hidden:c!=="loading"}),e("hr",{}),e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(Y,{to:"/",children:"Go home"})})]})})}const bt=5,Dt=40;function Ao(t){const n=nt(),{masto:c,instance:o,authenticated:i}=F({instance:n.instance}),[s,l]=$("default"),[a]=Oe(),d=P(),r=(t==null?void 0:t.query)||a.get("q"),f=(t==null?void 0:t.type)||a.get("type");Ae(r?`Search: ${r}${f?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[f]})`:""}`:"Search","/search");const[u,m]=$(!1),h=P(0);U(()=>{h.current=0},[r,f]);const y=P();Ve(()=>{var M,_;(_=(M=y.current)==null?void 0:M.scrollTo)==null||_.call(M,0,0)},[r,f]);const[g,w]=$([]),[p,b]=$([]),[S,T]=$([]);U(()=>{w([]),b([]),T([])},[r]);const C={statuses:w,accounts:b,hashtags:T};function E(M){!M&&!i||(l("loading"),M&&!f&&(w(g.slice(0,bt)),b(p.slice(0,bt)),T(S.slice(0,bt))),(async()=>{var x,G;const _={q:r,resolve:i,limit:bt};f&&(_.limit=Dt,_.type=f,i&&(_.offset=h.current));try{const R=await c.v2.search.fetch(_);if(f)if(M){C[f](R[f]);const D=(x=R[f])==null?void 0:x.length;h.current=Dt,m(!!D)}else{C[f](B=>[...B,...R[f]]);const D=(G=R[f])==null?void 0:G.length;h.current=h.current+Dt,m(!!D)}else w(R.statuses||[]),b(R.accounts||[]),T(R.hashtags||[]),h.current=0,m(!1);l("default")}catch{l("error")}})())}U(()=>{var M,_,x,G;r?((_=(M=d.current)==null?void 0:M.setValue)==null||_.call(M,r),E(!0)):(G=(x=d.current)==null?void 0:x.focus)==null||G.call(x)},[r,f,o]),Ce("/",M=>{var _,x;(x=(_=d.current)==null?void 0:_.focus)==null||x.call(_)},{preventDefault:!0});const[z]=Ht();return e("div",{id:"search-page",class:"deck-container",ref:y,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:s==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(pt,{})}),e(Yn,{ref:d}),e("div",{class:"header-side",children:" "})]})}),e("main",{children:[!!r&&e("div",{ref:z,class:`filter-bar ${s==="loading"?"loading":""}`,children:[!!f&&e(Y,{to:`/search${r?`?q=${encodeURIComponent(r)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(r)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(r)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(r)}&type=statuses`}].sort((M,_)=>M.type===f?-1:_.type===f?1:0).map(M=>e(Y,{to:M.to,children:M.label},M.type))]}),r?e(L,{children:[(!f||f==="accounts")&&e(L,{children:[f!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),p.length>0?e(L,{children:[e("ul",{class:"timeline flat accounts-list",children:p.map(M=>e("li",{children:e(qe,{account:M,instance:o,showStats:!0})},M.id))}),f!=="accounts"&&e("div",{class:"ui-state",children:e(Y,{class:"plain button",to:`/search?q=${r}&type=accounts`,children:["See more accounts ",e(v,{icon:"arrow-right"})]})})]}):!f&&(s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!f||f==="hashtags")&&e(L,{children:[f!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),S.length>0?e(L,{children:[e("ul",{class:"link-list hashtag-list",children:S.map(M=>{var R;const{name:_,history:x}=M,G=(R=x==null?void 0:x.reduce)==null?void 0:R.call(x,(D,B)=>D+ +B.uses,0);return e("li",{children:e(Y,{to:o?`/${o}/t/${_}`:`/t/${_}`,children:[e(v,{icon:"hashtag"}),e("span",{children:_}),!!G&&e("span",{class:"count",children:_e(G)})]})},`${_}-${G}`)})}),f!=="hashtags"&&e("div",{class:"ui-state",children:e(Y,{class:"plain button",to:`/search?q=${r}&type=hashtags`,children:["See more hashtags ",e(v,{icon:"arrow-right"})]})})]}):!f&&(s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!f||f==="statuses")&&e(L,{children:[f!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),g.length>0?e(L,{children:[e("ul",{class:"timeline",children:g.map(M=>e("li",{children:e(Y,{class:"status-link",to:o?`/${o}/s/${M.id}`:`/s/${M.id}`,children:e(Me,{status:M})})},M.id))}),f!=="statuses"&&e("div",{class:"ui-state",children:e(Y,{class:"plain button",to:`/search?q=${r}&type=statuses`,children:["See more posts ",e(v,{icon:"arrow-right"})]})})]}):!f&&(s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!f&&(s==="default"?u?e(at,{onChange:M=>{M&&E()},children:e("button",{type:"button",class:"plain block",onClick:()=>E(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}))]}):s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const yt=40,Ro=10,Eo=5;let Ot={},vt={},kt={};function Bt(t){delete vt[t],delete kt[t]}const rt={block:"nearest",inline:"center",behavior:"smooth"},kn=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",Sn=/\/s\//i;function Do(t){const{id:n}=t,{masto:c,instance:o}=F({instance:t.instance}),i=ge(k),[s,l]=Oe(),a=s.get("media"),d=s.get("media-only"),r=parseInt(a||d,10);let f=r>0;const u=s.get("mediaStatusID"),m=_n(u,o);u&&!m&&(f=!1);const h=f&&!!d,y=je(n,o),[g,w]=$(k.statuses[y]);U(()=>{k.statuses[y]&&w(k.statuses[y])},[y]);const p=de(()=>{const{prevLocation:T}=k,C=((T==null?void 0:T.pathname)||"")+((T==null?void 0:T.search)||""),E=ut("/:instance/s/:id",C)||ut("/s/:id",C);return!C||E?"/":C},[]);U(()=>{!g&&f&&(async()=>{try{const T=await c.v1.statuses.$select(n).fetch();xe(T,o),w(T)}catch{alert("Unable to load post."),location.hash=p}})()},[f]);const b=u?m==null?void 0:m.mediaAttachments:g==null?void 0:g.mediaAttachments,S=He(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&i.prevLocation?history.back():h?location.hash=p:(s.delete("media"),s.delete("mediaStatusID"),l(s))},[h,p,i.prevLocation]);return U(()=>{let T=setTimeout(()=>{const C=document.querySelector(".carousel");C&&C.focus()},100);return()=>clearTimeout(T)},[h]),e("div",{class:"deck-backdrop",children:[f?b!=null&&b.length?e(Kn,{mediaAttachments:b,statusID:u||n,instance:o,lang:g==null?void 0:g.language,index:r-1,onClose:S}):e("div",{class:"media-modal-container loading",children:e(ve,{abrupt:!0})}):e(Y,{to:p}),!h&&e(_o,{id:n,instance:t.instance,closeLink:p})]})}function _o({id:t,closeLink:n="/",instance:c}){var ce,J;const[o,i]=Oe(),s=o.get("media"),l=o.get("mediaStatusID"),a=parseInt(s,10)>0,d=P(!k.prevLocation&&(history.length===1||"navigation"in window&&((J=(ce=navigation==null?void 0:navigation.entries)==null?void 0:ce.call(navigation))==null?void 0:J.length)===1)),[r,f]=$(o.get("view")||d.current?"full":null),u=!!parseInt(o.get("translate")),{masto:m,instance:h}=F({instance:c}),{masto:y,instance:g,authenticated:w}=F(),p=h===g,b=ge(k),[S,T]=$([]),[C,E]=$("default"),z=P(),M=je(t,h),_=P(0),x=P();U(()=>{var I;(I=x.current)==null||I.focus()},[]),U(()=>{var N;const I=Bn(()=>{if(!x.current)return;const{scrollTop:Z}=x.current;C!=="loading"&&(kt[t]=Z)},50);return(N=x.current)==null||N.addEventListener("scroll",I,{passive:!0}),I(),()=>{var Z;I.cancel(),(Z=x.current)==null||Z.removeEventListener("scroll",I)}},[t,C!=="loading"]);const G=P(),R=({reloadHero:I}={})=>{E("loading");let N;const Z=vt[t];if(Z){const ne=Z.filter(he=>k.statuses[M]);T(ne)}else T([{id:t}]);return(async()=>{var We,q;const ne=()=>cn(()=>m.v1.statuses.$select(t).fetch(),{retries:4}),he=cn(()=>m.v1.statuses.$select(t).context.fetch(),{retries:8}),$e=!!b.statuses[M];let be=b.statuses[M];if(!($e&&!I))try{be=await ne(),xe(be,h),await new Promise(oe=>{setTimeout(oe,100)})}catch{E("error");return}try{let oe=function(K){return K==null?void 0:K.map(ye=>({id:ye.id,account:ye.account,repliesCount:ye.repliesCount,content:ye.content,weight:dt(ye),replies:oe(ye.__replies)}))};const me=await he,{ancestors:ae,descendants:Pe}=me;_.current=(Pe==null?void 0:Pe.length)||0;const Be=new Set;ae.forEach(K=>{xe(K,h,{skipThreading:!0}),K.inReplyToId&&!ae.find(ye=>ye.id===K.inReplyToId)&&Be.add(K.inReplyToId)});const De=ae.every(K=>K.account.id===be.account.id),Ue=[];Pe.forEach(K=>{if(xe(K,h,{skipThreading:!0}),K.inReplyToId&&!Pe.find(ye=>ye.id===K.inReplyToId)&&K.inReplyToId!==be.id&&Be.add(K.inReplyToId),K.inReplyToAccountId===K.account.id)Ue.push(K);else if(K.inReplyToId===be.id)Ue.push(K);else if(!K.inReplyToAccountId&&Ue.find(ye=>ye.id===K.inReplyToId)&&K.account.id===be.account.id)Ue.push(K);else{const ye=Pe.find(Ze=>Ze.id===K.inReplyToId);ye&&(ye.__replies||(ye.__replies=[]),ye.__replies.push(K))}}),Be.size;const Ke=[...ae.map(K=>({id:K.id,ancestor:!0,isThread:De,accountID:K.account.id,account:K.account,repliesCount:K.repliesCount,weight:dt(K)})),{id:t,accountID:be.account.id,weight:dt(be)},...Ue.map(K=>({id:K.id,account:K.account,accountID:K.account.id,descendant:!0,thread:K.account.id===be.account.id,weight:dt(K),replies:oe(K.__replies)}))];E("default"),G.current={offsetTop:(We=z.current)==null?void 0:We.offsetTop,scrollTop:(q=x.current)==null?void 0:q.scrollTop};const Xe=Ke.findIndex(K=>K.id===t);Xe>=X&&Le(Xe+1),T(Ke),vt[t]=Ke,gs(be,h)}catch{E("error")}})(),()=>{clearTimeout(N)}};U(R,[t,m]),U(()=>{var N,Z;if(!S.length)return;const I=kt[t];if(I)x.current.scrollTop=I;else if(G.current){const ne={offsetTop:(N=z.current)==null?void 0:N.offsetTop,scrollTop:(Z=x.current)==null?void 0:Z.scrollTop},he=ne.offsetTop-G.current.offsetTop+ne.scrollTop;x.current.scrollTop=he}else S.length===1&&(x.current.scrollTop=0);G.current=null},[S]),U(()=>{b.reloadStatusPage<=0||(async()=>{try{const{instanceURL:I}=ot(),N=`https://${I}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(N,{ignoreVary:!0}),R({reloadHero:!0})}catch{}})()},[b.reloadStatusPage]),U(()=>()=>{kt={},k.reloadStatusPage=0,vt={},Ot={},qt.clear()},[]);const D=b.statuses[M]||b.statuses[t],B=de(()=>{if(!D)return"";const{account:I}=D,N=document.createElement("div");return N.innerHTML=I.displayName,N.innerText.trim()},[D]),se=de(()=>{if(!D)return"";let I=Dn(D);return I.length>64&&(I=I.slice(0,64)+"…"),I},[D]);Ae(B&&se?`${B}: "${se}"`:"Status","/:instance?/s/:id");const ie=de(()=>{if(!D)return;const{url:I}=D;if(I)return new URL(I).hostname},[D]),pe=de(()=>{if(ie)return ie===h},[ie,h]),[X,Le]=$(yt),fe=de(()=>S.length-X,[S.length,X]),W=S.some(I=>I.descendant),A=S.filter(I=>I.ancestor),[V,Q]=$(!0),re=zn(Q,100),we=de(()=>{if(!z.current||V)return null;const{top:I}=z.current.getBoundingClientRect();return I>0?"down":"up"},[V]);Ce("esc",()=>{location.hash=n},{enabled:!a,ignoreEventWhen:I=>!!document.querySelector("#modal-container > *")}),Ce("backspace",()=>{location.hash=n}),Ce("j",()=>{const I=document.activeElement.closest(".status-link, .status-focus"),N=I==null?void 0:I.getBoundingClientRect(),Z=Array.from(x.current.querySelectorAll(kn));if(I&&N.top<x.current.clientHeight&&N.bottom>0){const ne=Z.indexOf(I);let he=Z[ne+1];he&&(he.focus(),he.scrollIntoView(rt))}else{const ne=Z.find(he=>{const $e=he.getBoundingClientRect();return $e.top>=44&&$e.left>=0});ne&&(ne.focus(),ne.scrollIntoView(rt))}}),Ce("k",()=>{const I=document.activeElement.closest(".status-link, .status-focus"),N=I==null?void 0:I.getBoundingClientRect(),Z=Array.from(x.current.querySelectorAll(kn));if(I&&N.top<x.current.clientHeight&&N.bottom>0){const ne=Z.indexOf(I);let he=Z[ne-1];he&&(he.focus(),he.scrollIntoView(rt))}else{const ne=Z.find(he=>{const $e=he.getBoundingClientRect();return $e.top>=44&&$e.left>=0});ne&&(ne.focus(),ne.scrollIntoView(rt))}}),Ce("x",()=>{const I=document.activeElement.closest(".status-link, .status-focus");if(I){const N=I.nextElementSibling;N&&N.tagName.toLowerCase()==="details"&&(N.open=!N.open)}});const{nearReachStart:Ie}=Lt({scrollableRef:x,distanceFromStartPx:16}),Te=P(a?"media+status":"status"),j=He((I,N,Z,ne)=>{I.preventDefault(),I.stopPropagation(),i({media:N+1,mediaStatusID:ne.id})},[t]),O=He((I,N)=>{Bt(N.id)},[]);U(()=>{let I;return l&&a&&(I=setTimeout(()=>{var Z;const N=(Z=x.current)==null?void 0:Z.querySelector(`.status-link[href*="/${l}"]`);N&&N.scrollIntoView(rt)},400)),()=>{clearTimeout(I)}},[l,a]);const H=He(I=>{const{id:N,ancestor:Z,isThread:ne,descendant:he,thread:$e,replies:be,repliesCount:We,weight:q}=I,oe=N===t;return e("li",{ref:oe?z:null,class:`${Z?"ancestor":""} ${he?"descendant":""} ${$e?"thread":""} ${oe?"hero":""}`,children:[oe?e(L,{children:[e(at,{threshold:.1,onChange:re,class:"status-focus",tabIndex:0,children:e(Me,{statusID:N,instance:h,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:u})}),C!=="loading"&&!w?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(Y,{to:"/login",class:"button",children:"Log in"})]}):!p&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:h}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:C==="loading",onClick:()=>{E("loading"),(async()=>{try{const me=await y.v2.search.fetch({q:D.url,type:"statuses",resolve:!0,limit:1});if(me.statuses.length){const ae=me.statuses[0];location.hash=g?`/${g}/s/${ae.id}`:`/s/${ae.id}`}else throw new Error("No results")}catch(me){E("default"),alert("Error: "+me)}})()},children:[e(v,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(Y,{class:"status-link",to:h?`/${h}/s/${N}`:`/s/${N}`,onClick:()=>{Bt(N)},children:[e(Me,{statusID:N,instance:h,withinContext:!0,size:$e||Z?"m":"s",enableTranslate:!0,onMediaClick:j,onStatusLinkClick:O}),Z&&ne&&We>1&&e("div",{class:"replies-link",children:[e(v,{icon:"comment2"})," ",e("span",{title:We,children:_e(We)})]})," "]}),he&&(be==null?void 0:be.length)>0&&e(cs,{instance:h,replies:be,hasParentThread:$e,level:1,accWeight:q,openAll:_.current<Ro}),C==="loading"&&oe&&!!(D!=null&&D.repliesCount)&&!W&&e("div",{class:"status-loading",children:e(ve,{})}),C==="error"&&oe&&!!(D!=null&&D.repliesCount)&&!W&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]},N)},[t,h,C,w,p,u,j,O,W]),ue=de(()=>{var I;if("navigation"in window&&(navigation!=null&&navigation.entries)){const N=navigation.entries()[navigation.currentEntry.index-1];if(N!=null&&N.url)return Sn.test(N.url)}return Sn.test((I=k.prevLocation)==null?void 0:I.pathname)},[M]);return e("div",{tabIndex:"-1",ref:x,class:`status-deck deck contained ${S.length>1?"padded-bottom":""} ${Te.current==="status"&&!d.current?"slide-in":""} ${r?`deck-view-${r}`:""}`,onAnimationEnd:I=>{Te.current==="status"&&(Te.current=null)},children:[e("header",{class:`${V?"inview":""} ${C==="loading"?"loading":""}`,onDblClick:I=>{k.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[ue&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(v,{icon:"chevron-left",size:"xl"})}),!V&&D&&C!=="loading"?e(L,{children:[e("span",{class:"hero-heading",children:[e(St,{account:D.account,instance:h,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e($t,{datetime:D.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),z.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(v,{icon:we==="down"?"arrow-down":"arrow-up"})})]}):e(L,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),x.current.scrollTo({top:0,behavior:"smooth"})},hidden:!A.length||Ie,title:`${A.length} posts above ‒ Go to top`,children:[e(v,{icon:"arrow-up"}),A.filter((I,N,Z)=>Z.findIndex(ne=>ne.accountID===I.accountID)===N).slice(0,3).map(I=>e(et,{url:I.account.avatar,alt:I.account.displayName},I.account.id)),A.length>3&&e(L,{children:[" ",e("span",{class:"insignificant",children:_e(A.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:r==="full"?"":"none"},onClick:()=>{f(null),o.delete("media"),o.delete("media-only"),o.delete("view"),i(o)},title:"Switch to Side Peek view",children:e(v,{icon:"layout4",size:"l"})}),e(Ne,{align:"end",portal:{target:x.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(v,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(ee,{disabled:C==="loading",onClick:()=>{k.reloadStatusPage++},children:[e(v,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(ee,{className:"menu-switch-view",onClick:()=>{f(r==="full"?null:"full"),o.delete("media"),o.delete("media-only"),r==="full"?o.delete("view"):o.set("view","full"),i(o)},children:[e(v,{icon:{"":"layout5",full:"layout4"}[r||""]}),e("span",{children:["Switch to ",r==="full"?"Side Peek":"Full"," view"]})]}),e(ee,{onClick:()=>{Array.from(x.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(N=>{N.click()})},children:[e(v,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(Ee,{}),e(On,{className:"plain",children:"Experimental"}),e(ee,{disabled:!ie||pe,onClick:()=>{const I=wo(D.url);I?location.hash=I:alert("Unable to switch")},children:[e(v,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance",ie?e(L,{children:[" ","(",e("b",{children:ie}),")"]}):""]})]})]}),e(Y,{class:"button plain deck-close",to:n,children:e(v,{icon:"x",size:"xl"})})]})]})}),S.length&&D?e("ul",{class:`timeline flat contextual grow ${C==="loading"?"loading":""}`,children:[S.slice(0,X).map(H),fe>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:C==="loading",onClick:()=>Le(I=>I+yt),style:{marginBlockEnd:"6em"},"data-state-post-ids":S.slice(X).map(I=>je(I.id,h)).join(" "),children:[e("div",{class:"ib avatars-bunch",children:S.slice(X,X+5).map(I=>e(et,{url:I.account.avatarStatic},I.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:fe>yt?`${yt}+`:fe})]})]})})]}):e(L,{children:[C==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Me,{skeleton:!0,size:"l"})})}),C==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]})]})}function cs({replies:t,instance:n,hasParentThread:c,level:o,accWeight:i,openAll:s}){const[l,a]=Oe(),d=p=>p.reduce((b,S)=>{const{repliesCount:T,replies:C}=S,E=(C==null?void 0:C.length)||T;return b+E+d(C||[])},0),r=t.length+d(t),f=t.length===r,u=t.map(p=>p.account).filter((p,b,S)=>S.findIndex(T=>T.id===p.id)===b).slice(0,3),m=de(()=>t==null?void 0:t.reduce((p,b)=>p+(b==null?void 0:b.weight),i),[i,t==null?void 0:t.length]);let h=!1;(s||m<=Eo||!c&&r===1&&dt(t[0])<2)&&(h=!0);const y=Ot[t[0].id],g=He((p,b,S,T)=>{p.preventDefault(),p.stopPropagation(),a({media:b+1,mediaStatusID:T.id})},[]),w=P();return Ve(()=>{var b;function p(S){S.target.dataset.scrollLeft=S.target.scrollLeft}return(b=w.current)==null||b.addEventListener("scroll",p,{passive:!0}),()=>{var S;(S=w.current)==null||S.removeEventListener("scroll",p)}},[]),e("details",{ref:w,class:"replies",open:y||h,onToggle:p=>{const{open:b}=p.target;Ot[t[0].id]=b},style:{"--comments-level":o},"data-comments-level":o,"data-comments-level-overflow":o>4,children:[e("summary",{class:"replies-summary",hidden:h,children:[e("span",{class:"avatars",children:u.map(p=>e(et,{url:p.avatarStatic,title:`${p.displayName} @${p.username}`,squircle:p==null?void 0:p.bot},p.id))}),e("b",{children:[e("span",{title:t.length,children:_e(t.length)})," ","repl",t.length===1?"y":"ies"]}),!f&&r>1&&e(L,{children:[" ","·"," ",e("span",{children:[e("span",{title:r,children:_e(r)})," ","comment",r===1?"":"s"]})]})]}),e("ul",{children:t.map(p=>{var b,S;return e("li",{children:[e(Y,{class:"status-link",to:n?`/${n}/s/${p.id}`:`/s/${p.id}`,onClick:()=>{Bt(p.id)},children:[e(Me,{statusID:p.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:g}),!((b=p.replies)!=null&&b.length)&&p.repliesCount>0&&e("div",{class:"replies-link",children:[e(v,{icon:"comment2"})," ",e("span",{title:p.repliesCount,children:_e(p.repliesCount)})]})]}),((S=p.replies)==null?void 0:S.length)&&e(cs,{instance:n,replies:p.replies,level:o+1,accWeight:h?m:p.weight,openAll:s})]},p.id)})})]})}const Po=140,No=35,Uo=70,Fo=140,qt=new Map;function dt(t){var h,y;const n=qt.get(t.id);if(n)return n;const{spoilerText:c,content:o,mediaAttachments:i,poll:s,card:l}=t,a=bs(c+o),d=i!=null&&i.length?Po:0,r=(((h=s==null?void 0:s.options)==null?void 0:h.length)||0)*No,f=l&&(i!=null&&i.length||(y=s==null?void 0:s.options)!=null&&y.length)?0:Uo,m=(a+d+r+f)/Fo;return qt.set(t.id,m),m}const zo=ze(Do);function Oo(){const t=nt(),{id:n,instance:c}=t;return e(zo,{id:n,instance:c})}const Bo=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,qo=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,Ho=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,Vo=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,jo=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,Go="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";function In(){return Ae(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("div",{class:"hero-content",children:[e("h1",{children:[e("img",{src:jt,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:Go,alt:"Phanpy",width:"200"})]}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),e("p",{children:e(Y,{to:"/login",class:"button",children:"Log in with Mastodon"})}),e("p",{class:"insignificant",children:e("small",{children:["Connect your existing Mastodon/Fediverse account.",e("br",{}),"Your credentials are not stored on this server."]})})]}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:Bo,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:jo,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:qo,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:Ho,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:Vo,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Wo=window.alert;window.__nativeAlert||(window.__nativeAlert=Wo);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=Ls({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=k;window.__STATES_STATS__=()=>{const t=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};t.forEach(i=>{n[i]=Object.keys(k[i]).length});const{statuses:c}=k,o=[];for(const i in c)document.querySelector(`[data-state-post-id~="${i}"], [data-state-post-ids~="${i}"]`)||o.push(i)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:t,unfurledLinks:n,notifications:c}=k;let o=0;const{instance:i}=F();for(const s in t){if(!window.__IDLE__)break;try{const l=document.querySelector(`[data-state-post-id~="${s}"], [data-state-post-ids~="${s}"]`),a=c.some(d=>{var r;return s===je((r=d.status)==null?void 0:r.id,i)});if(!l&&!a){delete k.statuses[s],delete k.statusQuotes[s];for(const d in n){const r=n[d];if(je(r.id,r.instance)===s){delete k.unfurledLinks[d];break}}o++}}catch{}}},15*60*1e3);setTimeout(()=>{var t,n,c,o;for(const i in mt)Array.isArray(mt[i])?(n=(t=mt[i])[0])==null||n.call(t):(o=(c=mt)[i])==null||o.call(c)},5e3);(()=>{window.__IDLE__=!0;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},o=Bn(n,3e3),i=()=>{window.__IDLE__=!1,o()};t.forEach(s=>{window.addEventListener(s,i,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",s=>{!s.relatedTarget&&!s.toElement&&n()},{passive:!0})})();const Ko=/iPad|iPhone|iPod/.test(navigator.userAgent);Ko&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",n=document.querySelector(`meta[name="theme-color"][media*="${t}"]`),c=n==null?void 0:n.getAttribute("content");c&&(n.content="",setTimeout(()=>{n.content=c},10))}});Nn(k,t=>{var n;for(const[c,o,i,s]of t){if(o.join(".")==="settings.shortcutsViewMode"){const l=document.getElementById("app");l&&(l.dataset.shortcutsViewMode=(n=k.shortcuts)!=null&&n.length?i:"")}o.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",i)}});function Zo(){const[t,n]=$(!1),[c,o]=$("loading");Ve(()=>{const s=te.local.get("theme");s&&(document.documentElement.classList.add(`is-${s}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",s==="auto"?"dark light":s));const l=te.local.get("textSize");l&&document.documentElement.style.setProperty("--text-size",`${l}px`)},[]),U(()=>{const s=te.local.get("instanceURL"),l=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(l){window.history.replaceState({},document.title,window.location.pathname||"/");const a=te.session.get("clientID"),d=te.session.get("clientSecret"),r=te.session.get("vapidKey");(async()=>{o("loading");const{access_token:f}=await Lo({instanceURL:s,client_id:a,client_secret:d,code:l}),u=ys({instance:s,accessToken:f});await Promise.allSettled([tn(u,s),ws(u,s,f,r)]),nn(),sn(u),n(!0),o("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const a=ot();if(a){te.session.set("currentAccount",a.info.id);const{client:d}=F({account:a}),{instance:r}=d;nn(),sn(d),o("loading"),(async()=>{try{await tn(d,r)}catch{}finally{n(!0),o("default")}})()}else o("default")}},[]);let i=ct();return k.currentLocation=i.pathname,U(Nt,[i,t]),/\/https?:/.test(i.pathname)?e(vo,{}):e(L,{children:[e(Yo,{isLoggedIn:t,loading:c==="loading"}),e(Jo,{isLoggedIn:t}),c==="default"&&e(Vt,{children:e(ke,{path:"/:instance?/s/:id",element:e(Oo,{})})}),t&&e(_s,{}),t&&e(Li,{}),e(Ii,{}),t&&e($i,{}),e(Ds,{isLoggedIn:t}),c!=="loading"&&e(Ci,{onClose:Nt}),e(Ps,{})]})}function Yo({isLoggedIn:t,loading:n}){const c=ct(),o=de(()=>{const{pathname:i}=c;return!/^\/(login|welcome)/.test(i)},[c]);return e(Vt,{location:o||c,children:[e(ke,{path:"/",element:t?e(bo,{}):n?e(ve,{id:"loader-root"}):e(In,{})}),e(ke,{path:"/login",element:e(Mo,{})}),e(ke,{path:"/welcome",element:e(In,{})})]})}function Tn(){return k.prevLocation||null}function Jo({isLoggedIn:t}){const n=ct(),c=P(Tn());return de(()=>ut("/:instance/s/:id",n.pathname)||ut("/s/:id",n.pathname),[n.pathname,ut])?c.current||(c.current=Tn()):c.current=null,e(Vt,{location:c.current||n,children:[t&&e(L,{children:[e(ke,{path:"/notifications",element:e(ss,{})}),e(ke,{path:"/mentions",element:e(ts,{})}),e(ke,{path:"/following",element:e(Yt,{})}),e(ke,{path:"/b",element:e(Jn,{})}),e(ke,{path:"/f",element:e(Xn,{})}),e(ke,{path:"/l",children:[e(ke,{index:!0,element:e(ko,{})}),e(ke,{path:":id",element:e(es,{})})]}),e(ke,{path:"/ft",element:e(ji,{})})]}),e(ke,{path:"/:instance?/t/:hashtag",element:e(Qn,{})}),e(ke,{path:"/:instance?/a/:id",element:e(Bi,{})}),e(ke,{path:"/:instance?/p",children:[e(ke,{index:!0,element:e(zt,{})}),e(ke,{path:"l",element:e(zt,{local:!0})})]}),e(ke,{path:"/:instance?/trending",element:e(is,{})}),e(ke,{path:"/:instance?/search",element:e(Ao,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));As(e(Ms,{children:e(Zo,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-jXEHyDho.js.map
