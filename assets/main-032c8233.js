import{a as z,s as k,b as ke,u as yn,o as Qn,I as w,M as we,c as Z,A as Ke,N as vt,d as Ee,L as W,g as st,e as wn,l as es,t as Yt,f as ae,R as Tt,h as ts,p as it,i as Pe,j as vn,k as Et,E as kn,m as De,n as qe,q as ns,r as ve,v as Jt,T as Sn,w as rt,x as In,y as Xt,z as ss,B as xe,C as is,S as Ie,D as os,F as cs,G as Tn,H as Cn,J as Ot,K as Ce,O as $n,P as as,Q as rs,U as ls,V as ft,W as ds,X as Zt,Y as hs,Z as Qt,_ as en}from"./useTitle-e347a2d9.js";import{_ as M,p as N,x as Ue,h as T,c as kt,u as Te,o as e,a as ue,k as x,s as Ct,b as xn,M as Ye,d as Q,e as Me,f as ot,F as ge,T as He,S as us,I as ct,y as Ne,g as Ln,l as tn,i as An,j as Rn,m as fs,n as ze,A as ps,q as ms,J as gs,C as Mn,r as Je,t as bs,v as ys,w as dt,z as Dn,B as nn,D as ws,E as vs,R as qt,G as ye,H as ks,K as Ss}from"./vendor-07e2fc23.js";function St(t=()=>{},n=[]){const a=M(t);N(()=>{a.current=t},[n]),N(()=>{const o=()=>{const s=document.hidden||document.visibilityState==="hidden";a.current(!s)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[])}const Is=Ue(function({isLoggedIn:n}){const[a,o]=T(!0);St(o);const s=M(),i=kt(()=>{const{masto:u,streaming:h,instance:f}=z();(async()=>{var p;if(k.notificationsLast){const g=u.v1.notifications.list({limit:1,since_id:k.notificationsLast.id}),{value:c}=await g.next();if(c!=null&&c.length){let m;try{const d=await u.v1.markers.fetch({timeline:"notifications"});m=(p=d==null?void 0:d.notifications)==null?void 0:p.lastReadId}catch{}m?k.notificationsShowNew=c[0].id!==m:k.notificationsShowNew=!0}}if(h){let g=s.current=h.user.notification.subscribe();for await(const c of g){if(!g)break;c.event==="notification"&&ke(c.payload,f,{skipThreading:!0}),k.notificationsShowNew=!0}}})()},3e3);N(()=>(n&&a&&i(),()=>{var u,h,f;(u=i==null?void 0:i.cancel)==null||u.call(i),(f=(h=s.current)==null?void 0:h.unsubscribe)==null||f.call(h),s.current=null}),[a,n]);const l=M(),r=()=>{l.current=Date.now(),fetch("./version.json").then(u=>u.json()).then(u=>{u&&(k.appVersion=u)}).catch(u=>{})};return yn(r,a&&1e3*60*30),St(u=>{u&&(l.current?Date.now()-l.current>1e3*60*60&&r():r())}),null});function Ts(){function t(n){n.shiftKey?Qn()||(alert("Looks like your browser is blocking popups."),k.showCompose=!0):k.showCompose=!0}return Te("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const Cs=Ue(function(){const n=ue(k);function a(){k.showKeyboardShortcutsHelp=!1}Te("?, shift+?",s=>{k.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:s=>!!document.querySelector("#modal-container > *")});const o=Te("esc",a,[]);return!!n.showKeyboardShortcutsHelp&&e(we,{class:"light",onClick:s=>{s.target===s.currentTarget&&a()},children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:o,children:[e("button",{type:"button",class:"sheet-close",onClick:a,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e(x,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(x,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(x,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Send post",keys:e(x,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Like (favourite)",keys:e(x,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})}].map(({action:s,keys:i})=>e("tr",{children:[e("th",{children:s}),e("td",{children:i})]},s))})})]})})});function $s({onClose:t}){const{masto:n}=z(),a=Z.local.getJSON("accounts"),o=Z.session.get("currentAccount"),s=a.length>1,[i,l]=Ct(u=>u+1,0),[r]=xn();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:r,children:a.map((u,h)=>{const f=u.info.id===o,p=h===0;return e("li",{children:[e("div",{children:[s&&e("span",{class:`current ${f?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(Ke,{url:u.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const g=await n.v1.accounts.$select(u.info.id).fetch();u.info=g,Z.local.setJSON("accounts",a),l()}catch{}}}),e(vt,{account:s?{...u.info,acct:/@/.test(u.info.acct)?u.info.acct:`${u.info.acct}@${u.instanceURL}`}:u.info,showAcct:!0,onClick:()=>{f?k.showAccount=`${u.info.username}@${u.instanceURL}`:(Z.session.set("currentAccount",u.info.id),location.reload())}})]}),e("div",{class:"actions",children:[p&&s&&e(x,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Ye,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(Q,{onClick:()=>{k.showAccount=`${u.info.username}@${u.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(Me,{}),s&&e(Q,{disabled:p,onClick:()=>{a.splice(h,1),a.unshift(u),Z.local.setJSON("accounts",a),l()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Ee,{subMenu:!0,confirmLabel:e(x,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",u.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{a.splice(h,1),Z.local.setJSON("accounts",a),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},u.info.id)})}),e("p",{children:e(W,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),s&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const En=""+new URL("logo-f0531a6b.svg",import.meta.url).href;function sn(t){const{masto:n}=z();return n.v1.push.subscription.create(t)}function xs(){const{masto:t}=z();return t.v1.push.subscription.fetch()}function Ls(t){const{masto:n}=z();return n.v1.push.subscription.update(t)}function As(){const{masto:t}=z();return t.v1.push.subscription.remove()}function $t(){return"serviceWorker"in navigator&&"PushManager"in window}function Rs(){return navigator.serviceWorker.getRegistration()}async function Ht(){const t=await Rs(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function _n(t){const n="=".repeat((4-t.length%4)%4),a=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(a),s=new Uint8Array(o.length);for(let i=0;i<o.length;++i)s[i]=o.charCodeAt(i);return s}async function Ms(){if(!$t())return;const{subscription:t}=await Ht();let n=null;try{n=await xs()}catch(a){if(!/(not found|unknown)/i.test(a.message))throw a}if(n&&t){const a=n.endpoint===t.endpoint,{vapidKey:o}=st(),s=n.serverKey===o;if(!a)throw new Error("Backend subscription endpoint changed");if(!s)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:a}=st(),{applicationServerKey:o}=t.options,s=_n(a).toString(),i=new Uint8Array(o).toString();if(!(s===i))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function on({data:t,policy:n}){if(!$t())return;let{registration:a,subscription:o}=await Ht(),s=null;if(o)try{s=await Ls({data:t,policy:n})}catch{s=await sn({subscription:o,data:t,policy:n})}else{const{vapidKey:i}=st();if(!i)throw new Error("No server key found");o=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:_n(i)}),s=await sn({subscription:o,data:t,policy:n})}return{subscription:o,backendSubscription:s}}async function cn(){if(!$t())return;const{subscription:t}=await Ht();t&&(await As(),await t.unsubscribe())}const an=16,We=[16,17,18,19,20];function Ds({onClose:t}){const n=ue(k),a=Z.local.get("theme")||"auto",o=M(),s=n.settings.contentTranslationTargetLanguage||null,i=wn(),l=es(i),r=Z.local.get("textSize")||an,[u,h]=T(Z.account.get("preferences")||{}),{masto:f,authenticated:p,instance:g}=z();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:o,onInput:c=>{c.preventDefault();const d=new FormData(o.current).get("theme"),b=document.documentElement;d==="auto"?b.classList.remove("is-light","is-dark"):(b.classList.toggle("is-light",d==="light"),b.classList.toggle("is-dark",d==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",d==="auto"?"dark light":d),d==="auto"?Z.local.del("theme"):Z.local.set("theme",d)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:a==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:a==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:a!=="light"&&a!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:We[0]},children:"A"})," ",e("input",{type:"range",min:We[0],max:We[We.length-1],step:"1",value:r,list:"sizes",onChange:c=>{const m=parseInt(c.target.value,10);document.documentElement.style.setProperty("--text-size",`${m}px`),m===an?Z.local.del("textSize"):Z.local.set("textSize",c.target.value)}})," ",e("span",{style:{fontSize:We[We.length-1]},children:"A"}),e("datalist",{id:"sizes",children:We.map(c=>e("option",{value:c}))})]})]})]})}),p&&e(x,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:u["posting:default:visibility"]||"public",onChange:c=>{const{value:m}=c.target;(async()=>{try{await f.v1.accounts.updateCredentials({source:{privacy:m}}),h({...u,"posting:default:visibility":m}),Z.account.set("preferences",{...u,"posting:default:visibility":m})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${g}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",g,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:c=>{k.settings.autoRefresh=c.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:c=>{k.settings.boostsCarousel=c.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:c=>{const{checked:m}=c.target;k.settings.contentTranslation=m,m||(k.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:s||"",disabled:!n.settings.contentTranslation,onChange:c=>{k.settings.contentTranslationTargetLanguage=c.target.value||null},children:[e("option",{value:"",children:["System language (",l,")"]}),e("option",{disabled:!0,children:"──────────"}),Yt.map(c=>e("option",{value:c.code,children:c.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(x,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Yt.map(c=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(c.code),onChange:m=>{const{checked:d}=m.target;d?k.settings.contentTranslationHideLanguages.push(c.code):k.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(b=>b!==c.code)}})," ",c.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses an external API to translate, powered by"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:c=>{k.settings.contentTranslationAutoInline=c.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:c=>{k.settings.cloakMode=c.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),p&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{k.showDrafts=!0,k.showSettings=!1},children:"Unsent drafts"})})]})}),p&&e(Es,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:En,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:c=>{c.preventDefault(),k.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:c=>{c.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:["Version:"," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2023-10-27T15:27:01.870Z".slice(0,10).replace(/-/g,".")}.116e8ac`,onClick:c=>{c.target.select();try{navigator.clipboard.writeText(c.target.value),ae("Version string copied")}catch{ae("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/116e8ac",target:"_blank",rel:"noopener noreferrer",children:e(Tt,{datetime:new Date("2023-10-27T15:27:01.870Z")})}),")"]})]})]})]})]})}function Es({onClose:t}){if(!$t())return null;const{instance:n}=z(),[a,o]=T("default"),s=M(),[i,l]=T(!1),[r,u]=T(!1),h=M();N(()=>{(async()=>{o("loading");try{const{subscription:p,backendSubscription:g}=await Ms();if(g!=null&&g.policy&&g.policy!=="none"){l(!0);const{alerts:c,policy:m}=g;h.current=m;const{elements:d}=s.current,b=d.namedItem(m);b&&(b.value=m),Object.keys(c).forEach(y=>{const v=d.namedItem(y);(v==null?void 0:v.type)==="checkbox"&&(v.checked=!0)})}o("default")}catch(p){/outside.*authorized/i.test(p.message)?u(!0):alert((p==null?void 0:p.message)||p),o("error")}})()},[]);const f=a==="loading";return e("form",{ref:s,onChange:()=>{const p=Object.fromEntries(new FormData(s.current)),g=!!p["policy-allow"],c={policy:p.policy,data:{alerts:{mention:!!p.mention,favourite:!!p.favourite,reblog:!!p.reblog,follow:!!p.follow,follow_request:!!p.followRequest,poll:!!p.poll,update:!!p.update,status:!!p.status}}};let m=0;Object.keys(c.data.alerts).forEach(b=>{c.data.alerts[b]?m++:delete c.data.alerts[b]});const d=h.current!==c.policy;g&&m>0?d?cn().then(()=>{on(c)}).catch(b=>{alert("Failed to update subscription. Please try again.")}):on(c).catch(b=>{alert("Failed to update subscription. Please try again.")}):cn().catch(b=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:f||r,name:"policy-allow",checked:i,onChange:async p=>{const{checked:g}=p.target;if(g){const c=await Notification.requestPermission();c==="granted"?l(!0):(l(!1),c==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else l(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:f||r||!i,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(p=>e("option",{value:p.value,children:p.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!i,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(p=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:p.value})," ",p.label]})}))})})})}),r&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(W,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const _t=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const a=document.querySelectorAll("#modal-container > *");if(a!=null&&a.length){const l=a[a.length-1],r=l.querySelector('[tabindex="-1"]')||l;if(r){r.focus();return}}if(document.querySelector(".deck-backdrop"))return;const s=document.querySelectorAll(".deck-container"),i=s[s.length-1];i&&i.tabIndex===-1&&i.focus()}},100);return()=>clearTimeout(t)};function Pn(t){if(!t)return;const n=ot(),a=M(n.pathname);N(()=>{a.current&&n.pathname!==a.current&&(t==null||t())},[n.pathname,t])}function Vt({list:t,onClose:n}){const{masto:a}=z(),[o,s]=T("default"),i=!!t,l=M(),r=M(),u=M();N(()=>{i&&(l.current.value=t.title,r.current.value=t.repliesPolicy,u.current&&(u.current.checked=t.exclusive))},[i]);const h=ts("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:i?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:f=>{f.preventDefault();const p=new FormData(f.target),g=p.get("title"),c=p.get("replies_policy"),m=p.get("exclusive")==="on";s("loading"),(async()=>{try{let d;i?d=await a.v1.lists.$select(t.id).update({title:g,replies_policy:c,exclusive:m}):d=await a.v1.lists.create({title:g,replies_policy:c,exclusive:m}),s("default"),n==null||n({state:"success",list:d})}catch{s("error"),alert(i?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:l,type:"text",id:"list-title",name:"title",required:!0,disabled:o==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:r,name:"replies_policy",required:!0,disabled:o==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),h&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:u,type:"checkbox",name:"exclusive",disabled:o==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:o==="loading",children:i?"Save":"Create"}),i&&e(Ee,{disabled:o==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{s("loading"),(async()=>{try{await a.v1.lists.$select(t.id).remove(),s("default"),n==null||n({state:"deleted"})}catch{s("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete…"})})]})]})})]})}const _s=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],rn={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},ln=80,Nn=1e3*60*10;function Ps(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Ns=it(Ps,{maxAge:Nn});async function Us(t,n){const a=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:o}=await a,s={total:o.length,originals:0,replies:0,boosts:0};return o.forEach(i=>{i.reblog?s.boosts++:i.inReplyToId&&i.inReplyToAccountId!==i.account.id?s.replies++:s.originals++}),o.length&&(s.daysSinceLastPost=Math.ceil((Date.now()-new Date(o[o.length-1].createdAt))/864e5)),s}const zs=it(Us,{maxAge:Nn});function Un({account:t,fetchAccount:n=()=>{},standalone:a,instance:o,authenticated:s}){const{masto:i}=z({instance:o}),{masto:l}=z(),[r,u]=T("default"),h=typeof t=="string",[f,p]=T(h?null:t),g=ge(()=>t.id===Z.session.get("currentAccount"),[t==null?void 0:t.id]),c=ge(()=>o===z().instance,[o]);N(()=>{if(!h){p(t);return}u("loading"),(async()=>{try{const _=await n();k.accounts[`${_.id}@${o}`]=_,p(_),u("default")}catch{p(null),u("error")}})()},[h,t,n]);const{acct:m,avatar:d,avatarStatic:b,bot:y,createdAt:v,displayName:I,emojis:S,fields:$,followersCount:D,followingCount:A,group:P,id:V,lastStatusAt:R,locked:H,note:F,statusesCount:B,url:se,username:Ae,memorial:K,moved:oe,roles:O}=f||{};let E=!1,{header:G,headerStatic:ee}=f||{};(!G||/missing\.png$/.test(G))&&d&&!/missing\.png$/.test(d)&&(G=d,E=!0,b&&!/missing\.png$/.test(b)&&(ee=b));const ce=ge(()=>se?new URL(se).hostname:null,[se]),[fe,Le]=T([]),ie=M(),U=M([]);async function te(_){(_||!ie.current)&&(ie.current=i.v1.accounts.$select(V).followers.list({limit:ln}));const de=await ie.current.next();if(g||!c)return de;const{value:pe}=de;let re=[];if(_){const Be=await i.v1.accounts.familiarFollowers.fetch({id:[V]});U.current=Be[0].accounts,re=[...U.current,...pe.filter(je=>!U.current.some($e=>$e.id===je.id))]}else pe!=null&&pe.length&&(re=pe.filter(Be=>!U.current.some(je=>je.id===Be.id)));return{...de,value:re}}const X=M();async function be(_){return(_||!X.current)&&(X.current=i.v1.accounts.$select(V).following.list({limit:ln})),await X.current.next()}const le=a?"div":W,q=o?`/${o}/a/${V}`:`/a/${V}`,[J,C]=T([]),[L,Y]=T(),[ne,he]=T("default"),Re=!!(L!=null&&L.total),Se=async _=>{try{const de=await Ns(_,l);C(de[0].accounts.slice(0,Fs))}catch{}},_e=async()=>{if(V){he("loading");try{const _=await zs(V,i);Y(_),he("default")}catch{he("error")}}},Xe=He(({relationship:_,currentID:de})=>{_.following||(Se(de),a||_e())},[a,V]);return e("div",{tabIndex:"-1",class:`account-container  ${r==="loading"?"skeleton":""}`,style:{"--header-color-1":fe[0],"--header-color-2":fe[1],"--header-color-3":fe[2],"--header-color-4":fe[3]},children:[r==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:h?t:se,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),r==="loading"?e(x,{children:[e("header",{children:e(Pe,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):f&&e(x,{children:[!!oe&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:I})," has indicated that their new account is now:"]}),e(Pe,{account:oe,instance:o,onClick:_=>{_.stopPropagation(),k.showAccount=oe}})]}),!!G&&!/missing\.png$/.test(G)&&e("img",{src:G,alt:"",class:`header-banner ${E?"header-is-avatar":""}`,onError:_=>{_.target.crossOrigin?_.target.src!==ee?_.target.src=ee:(_.target.removeAttribute("crossorigin"),_.target.src=G):_.target.src!==ee?_.target.src=ee:_.target.remove()},crossOrigin:"anonymous",onLoad:_=>{_.target.classList.add("loaded");try{const de=document.createElement("canvas"),pe=de.getContext("2d",{willReadFrequently:!0});de.width=_.target.width,de.height=_.target.height,pe.drawImage(_.target,0,0);const re=10,je=[pe.getImageData(0,0,re,re).data,pe.getImageData(_.target.width-re,0,re,re).data,pe.getImageData(0,_.target.height-re,re,re).data,pe.getImageData(_.target.width-re,_.target.height-re,re,re).data].map($e=>{let Oe=0,Ge=0,j=0,me=0;for(let Qe=0;Qe<$e.length;Qe+=4)Oe+=$e[Qe],Ge+=$e[Qe+1],j+=$e[Qe+2],me+=$e[Qe+3];const Ze=$e.length/4;return[Oe/Ze,Ge/Ze,j/Ze,me/Ze]}).map($e=>{const[Oe,Ge,j,me]=Os($e);return`rgba(${Oe}, ${Ge}, ${j}, ${me})`});Le(je)}catch{}}}),e("header",{children:e(Pe,{account:f,instance:o,avatarSize:"xxxl",external:a,internal:!a})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!K&&e("span",{class:"tag",children:"In Memoriam"}),!!y&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!P&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),O==null?void 0:O.map(_=>e("span",{class:"tag",children:[_.name,!!ce&&e(x,{children:[" ",e("span",{class:"more-insignificant",children:ce})]})]})),e("div",{class:"note",dir:"auto",onClick:vn({instance:o}),dangerouslySetInnerHTML:{__html:Et(F,{emojis:S})}}),e("div",{class:"account-metadata-box",children:[($==null?void 0:$.length)>0&&e("div",{class:"profile-metadata",children:$.map(({name:_,value:de,verifiedAt:pe},re)=>e("div",{class:`profile-field ${pe?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(kn,{text:_,emojis:S})," ",!!pe&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:Et(de,{emojis:S})}})]},_+re))}),e("div",{class:"stats",children:[e(le,{tabIndex:0,to:q,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Followers",fetchAccounts:te}},0)},children:[!!J.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:J.map(_=>e(Ke,{url:_.avatarStatic,size:"s",alt:`${_.displayName} @${_.acct}`,squircle:_==null?void 0:_.bot}))})}),e("span",{title:D,children:De(D)})," ","Followers"]}),e(le,{class:"insignificant",tabIndex:0,to:q,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Following",fetchAccounts:be}},0)},children:[e("span",{title:A,children:De(A)})," ","Following",e("br",{})]}),e(le,{class:"insignificant",to:q,children:[e("span",{title:B,children:De(B)})," ","Posts"]}),!!v&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:v,children:qe(v,{hideTime:!0})})]})]})]}),!!L&&e(le,{to:q,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:Re?e("div",{class:"posting-stats",title:`${Math.round(L.originals/L.total*100)}% original posts, ${Math.round(L.replies/L.total*100)}% replies, ${Math.round(L.boosts/L.total*100)}% boosts`,children:[e("div",{children:L.daysSinceLastPost<365?`Last ${L.total} post${L.total>1?"s":""} in the past 
                      ${L.daysSinceLastPost} day${L.daysSinceLastPost>1?"s":""}`:`
                      Last ${L.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${L.originals/L.total*100}%`,"--replies-percentage":`${(L.originals+L.replies)/L.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!L,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:ne==="loading",onClick:()=>{_e()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${ne==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(Bs,{info:f,instance:o,authenticated:s,onRelationshipChange:Xe})})]})]})}const Fs=3;function Bs({info:t,instance:n,authenticated:a,onRelationshipChange:o=()=>{}}){var le;if(!t)return null;const{masto:s,instance:i,authenticated:l}=z(),r=n===i,[u,h]=T("default"),[f,p]=T(null),{id:g,acct:c,url:m,username:d,locked:b,lastStatusAt:y,note:v,fields:I,moved:S}=t,$=M(g),{following:D,showingReblogs:A,notifying:P,followedBy:V,blocking:R,blockedBy:H,muting:F,mutingNotifications:B,requested:se,domainBlocking:Ae,endorsed:K,note:oe}=f||{},[O,E]=T(null),[G,ee]=T(!1);N(()=>{if(t){const q=Z.session.get("currentAccount");let J;(async()=>{if(r&&a)J=g;else if(!r&&l){const L=t.acct.includes("@");try{const Y=await s.v2.search.fetch({q:L?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});Y.accounts.length&&(J=Y.accounts[0].id,E(Y.accounts[0]))}catch{}}if(!J)return;if(q===J){ee(!0);return}if($.current=J,S)return;h("loading");const C=s.v1.accounts.relationships.fetch({id:[J]});try{const L=await C;if(h("default"),L.length){const Y=L[0];p(Y),o({relationship:Y,currentID:J})}}catch{h("error")}})()}},[t,a]),N(()=>{t&&G&&ns(t)},[t,G]);const ce=u==="loading",fe=M(null),[Le,ie]=T(!1),[U,te]=T(!1),[X,be]=T(!1);return e(x,{children:[e("div",{class:"actions",children:[e("span",{children:[V?e("span",{class:"tag",children:"Following you"}):y?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:qe(y,{hideTime:!0})})]}):e("span",{}),F&&e("span",{class:"tag danger",children:"Muted"}),R&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!oe&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{be(!0)},dir:"auto",children:e("span",{children:oe})}),e(Ye,{instanceRef:fe,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:q=>{var J,C;q.target===q.currentTarget&&((C=(J=fe.current)==null?void 0:J.closeMenu)==null||C.call(J))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:ce,children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[l&&!G&&e(x,{children:[e(Q,{onClick:()=>{k.showCompose={draftStatus:{status:`@${(O==null?void 0:O.acct)||c} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",d]})]}),e(Q,{onClick:()=>{ie(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(Q,{onClick:()=>{be(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:oe?"Edit private note":"Add private note"})]}),D&&e(Q,{onClick:()=>{te(!0)},children:[e(w,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(Me,{})]}),e(Q,{href:m,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:qs(m)})]}),e("div",{class:"menu-horizontal",children:[e(Q,{onClick:()=>{try{navigator.clipboard.writeText(m),ae("Link copied")}catch{ae("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((le=navigator==null?void 0:navigator.canShare)==null?void 0:le.call(navigator,{url:m}))&&e(Q,{onClick:()=>{try{navigator.share({url:m})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!f&&e(x,{children:[e(Me,{}),F?e(Q,{onClick:()=>{h("loading"),(async()=>{try{const q=await s.v1.accounts.$select((O==null?void 0:O.id)||g).unmute();p(q),h("default"),ae(`Unmuted @${d}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{h("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",d]})]}):e(us,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(x,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",d,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:_s.map(q=>e(Q,{onClick:()=>{h("loading"),(async()=>{try{const J=await s.v1.accounts.$select((O==null?void 0:O.id)||g).mute({duration:q});p(J),h("default"),ae(`Muted @${d} for ${rn[q]}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{h("error"),ae(`Unable to mute @${d}`)}})()},children:rn[q]}))})}),e(Ee,{subMenu:!0,confirm:!R,confirmLabel:e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",d,"?"]})]}),menuItemClassName:"danger",onClick:()=>{h("loading"),(async()=>{try{if(R){const q=await s.v1.accounts.$select((O==null?void 0:O.id)||g).unblock();p(q),h("default"),ae(`Unblocked @${d}`)}else{const q=await s.v1.accounts.$select((O==null?void 0:O.id)||g).block();p(q),h("default"),ae(`Blocked @${d}`)}k.reloadGenericAccounts.id="block",k.reloadGenericAccounts.counter++}catch{h("error"),R?ae(`Unable to unblock @${d}`):ae(`Unable to block @${d}`)}})()},children:R?e(x,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",d]})]}):e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",d,"…"]})]})})]})]}),!f&&u==="loading"&&e(ve,{abrupt:!0}),!!f&&e(Ee,{confirm:D||se,confirmLabel:e("span",{children:se?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:ce,onClick:()=>{h("loading"),(async()=>{try{let q;D||se?q=await s.v1.accounts.$select($.current).unfollow():q=await s.v1.accounts.$select($.current).follow(),q&&p(q),h("default")}catch(q){alert(q),h("error")}})()},children:e("button",{type:"button",class:`${D||se?"light swap":""}`,"data-swap-state":D||se?"danger":"",disabled:ce,children:D?e(x,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):se?e(x,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):b?e(x,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!Le&&e(we,{class:"light",onClose:()=>{ie(!1)},children:e(Hs,{note:v,fields:I,onClose:()=>ie(!1)})}),!!U&&e(we,{class:"light",onClose:()=>{te(!1)},children:e(Vs,{accountID:$.current,onClose:()=>te(!1)})}),!!X&&e(we,{class:"light",onClose:()=>{be(!1)},children:e(js,{account:t,note:oe,onRelationshipChange:q=>{p(q)},onClose:()=>be(!1)})})]})}function Os([t,n,a]){const o=.2126*t+.7152*n+.0722*a;let s;return o>=220?s=1:o<=50?s=.1:s=o/255,s=Math.min(1,s),[t,n,a,s]}function qs(t){if(!t)return;const n=new URL(t),{host:a,pathname:o}=n,s=o.replace(/\/$/,"").replace(/^\//,"");return e(x,{children:[e("span",{class:"more-insignificant",children:[a,"/"]}),e("wbr",{}),e("span",{children:s})]})}function Hs({note:t,fields:n,onClose:a}){const o=(n==null?void 0:n.map(({name:i,value:l})=>`${i}
${Jt(l)}`).join(`

`))||"",s=Jt(t)+(o?`

${o}`:"");return e("div",{class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close",onClick:a,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:s}),e(Sn,{forceTranslate:!0,text:s})]})]})}function Vs({accountID:t,onClose:n}){const{masto:a}=z(),[o,s]=T("default"),[i,l]=T([]),[r,u]=T([]),[h,f]=Ct(c=>c+1,0);N(()=>{s("loading"),(async()=>{try{const c=await a.v1.lists.list();c.sort((d,b)=>d.title.localeCompare(b.title));const m=await a.v1.accounts.$select(t).lists.list();l(c),u(m),s("default")}catch{s("error")}})()},[h]);const[p,g]=T(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[i.length>0?e("ul",{class:"list-add-remove",children:i.map(c=>{const m=r.some(d=>d.id===c.id);return e("li",{children:e("button",{type:"button",class:`light ${m?"checked":""}`,disabled:o==="loading",onClick:()=>{s("loading"),(async()=>{try{m?await a.v1.lists.$select(c.id).accounts.remove({accountIds:[t]}):await a.v1.lists.$select(c.id).accounts.create({accountIds:[t]}),f()}catch{s("error"),alert(m?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:c.title})]})})})}):o==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):o==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>g(!0),disabled:o!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),p&&e(we,{class:"light",onClick:c=>{c.target===c.currentTarget&&g(!1)},children:e(Vt,{list:p==null?void 0:p.list,onClose:c=>{c.state==="success"&&f(),g(!1)}})})]})}function js({account:t,note:n,onRelationshipChange:a=()=>{},onClose:o=()=>{}}){const{masto:s}=z(),[i,l]=T("default"),r=M(null);return N(()=>{let u;return r.current&&!n&&(u=setTimeout(()=>{var h,f;(f=(h=r.current).focus)==null||f.call(h)},100)),()=>{clearTimeout(u)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:u=>{u.preventDefault();const f=new FormData(u.target).get("note");(f==null?void 0:f.trim())!==(n==null?void 0:n.trim())&&(l("loading"),(async()=>{try{const p=await s.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:f});l("default"),a(p),o()}catch(p){l("error"),alert((p==null?void 0:p.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:r,name:"note",disabled:i==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:i==="loading",onClick:()=>{o==null||o()},children:"Cancel"}),e("span",{children:[e(ve,{abrupt:!0,hidden:i!=="loading"}),e("button",{disabled:i==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function Gs({account:t,instance:n,onClose:a}){const{masto:o,instance:s,authenticated:i}=z({instance:n}),l=typeof t=="string";return N(()=>{l||(k.accounts[`${t.id}@${s}`]=t)},[t]),Pn(a),e("div",{class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close outer",onClick:a,children:e(w,{icon:"x"})}),e(Un,{instance:s,authenticated:i,account:t,fetchAccount:async()=>{if(l)try{return await o.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const u=await o.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:i});if(u.accounts.length)return u.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const f=new URL(t).pathname.replace(/^\//,""),p=await o.v2.search.fetch({q:f,type:"accounts",limit:1,resolve:i});if(p.accounts.length)return p.accounts[0]}}else return t}})]})}function Ws({onClose:t}){const{masto:n}=z(),[a,o]=T("default"),[s,i]=T([]),[l,r]=Ct(h=>h+1,0);N(()=>{o("loading"),(async()=>{try{const h=await rt.drafts.keys();if(h.length){const f=In(),p=h.filter(g=>g.startsWith(f));if(p.length){const g=await rt.drafts.getMany(p);g.sort((c,m)=>new Date(m.updatedAt).getTime()-new Date(c.updatedAt).getTime()),i(g)}else i([])}else i([]);o("default")}catch{o("error")}})()},[l]);const u=(s==null?void 0:s.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(ve,{abrupt:!0,hidden:a!=="loading"})]}),u&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:u?e(x,{children:[e("ul",{class:"drafts-list",children:s.map(h=>{const{updatedAt:f,key:p,draftStatus:g,replyTo:c}=h,m=new Date(f);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:c?"reply":"quill",size:"s"})," ",e("time",{children:[!!c&&e(x,{children:["@",c.account.acct,e("br",{})]}),qe(m)]})]}),e(Ee,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:a==="loading",onClick:()=>{(async()=>{try{await rt.drafts.del(p),r()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:a==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:a==="loading",class:"draft-item",onClick:async()=>{let d;if(c){o("loading");try{d=await n.v1.statuses.$select(c.id).fetch()}catch{alert("Error fetching reply-to status!"),o("default");return}o("default")}window.__COMPOSE__={draftStatus:g,replyToStatus:d},k.showCompose=!0,k.showDrafts=!1},children:e(Ks,{draft:h})})]},f)})}),s.length>1&&e("p",{children:e(Ee,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:a==="loading",onClick:()=>{(async()=>{o("loading");try{await rt.drafts.delMany(s.map(h=>h.key)),o("default"),r()}catch{alert("Error deleting drafts! Please try again."),o("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:a==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function Ks({draft:t}){var p;const{draftStatus:n,replyTo:a}=t,{status:o,spoilerText:s,poll:i,mediaAttachments:l}=n,r=((p=i==null?void 0:i.options)==null?void 0:p.length)>0,u=(l==null?void 0:l.length)>0,h=r||u,f=ge(()=>{if(!u)return;const g=l.find(d=>/image/.test(d.type));if(!g)return;const{file:c}=g;return URL.createObjectURL(c)},[u,l]);return e(x,{children:e("div",{class:"mini-draft",children:[h&&e("div",{class:`mini-draft-aside ${f?"has-image":""}`,style:f?{"--bg-image":`url(${f})`}:{},children:[r&&e(w,{icon:"poll"}),u&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:l==null?void 0:l.length})]})]}),e("div",{class:"mini-draft-main",children:[!!s&&e("div",{class:"mini-draft-spoiler",children:s}),!!o&&e("div",{class:"mini-draft-status",children:o})]})]})})}function Ys({onClose:t=()=>{}}){const n=ue(k),[a,o]=T("default"),[s,i]=T([]),[l,r]=T(!1);if(Pn(t),!n.showGenericAccounts)return null;const{id:u,heading:h,fetchAccounts:f,accounts:p,showReactions:g}=n.showGenericAccounts,c=m=>{f&&(m&&i([]),o("loading"),(async()=>{try{const{done:d,value:b}=await f(m);Array.isArray(b)?(i(m?b:y=>[...y,...b]),r(!d)):r(!1),o("default")}catch{o("error")}})())};return N(()=>{(p==null?void 0:p.length)>0?i(p):c(!0)},[p,f]),N(()=>{var m;((m=n.reloadGenericAccounts)==null?void 0:m.id)===u&&c(!0)},[n.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:h||"Accounts"})}),e("main",{children:s.length>0?e(x,{children:[e("ul",{class:"accounts-list",children:s.map(m=>{var d;return e("li",{children:[g&&((d=m._types)==null?void 0:d.length)>0&&e("div",{class:"reactions-block",children:m._types.map(b=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[b],class:`${b}-icon`}))}),e(Pe,{account:m})]},m.id+(m._types||""))})}),a==="default"?l?e(ct,{onChange:m=>{m&&c()},children:e("button",{type:"button",class:"plain block",onClick:()=>c(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):a==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})})]}):a==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):a==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Js({alt:t,lang:n,onClose:a}){const o=ue(k),[s,i]=T(!1),l=wn(!0),r=o.settings.contentTranslationHideLanguages||[],u=!!n&&n!==l&&!Xt([n],[l])&&!r.find(h=>n===h||Xt([n],[h]));return e("div",{class:"sheet",tabindex:"-1",children:[!!a&&e("button",{type:"button",class:"sheet-close outer",onClick:a,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Ye,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:e(Q,{disabled:s,onClick:()=>{i(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]})})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap"},children:t}),(u||s)&&e(Sn,{forceTranslate:s,sourceLanguage:n,text:t})]})]})}function Lt(t,n,a){return Math.max(Math.min(t,a),n)}const At=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,Rt=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function zn([t,n,a]){t=At(t/255),n=At(n/255),a=At(a/255);var o=.4122214708*t+.5363325363*n+.0514459929*a,s=.2119034982*t+.6806995451*n+.1073969566*a,i=.0883024619*t+.2817188376*n+.6299787005*a;return o=Math.cbrt(o),s=Math.cbrt(s),i=Math.cbrt(i),[o*.2104542553+s*.793617785+i*-.0040720468,o*1.9779984951+s*-2.428592205+i*.4505937099,o*.0259040371+s*.7827717662+i*-.808675766]}function Fn([t,n,u]){var o=t+n*.3963377774+u*.2158037573,s=t+n*-.1055613458+u*-.0638541728,i=t+n*-.0894841775+u*-1.291485548;o=o**3,s=s**3,i=i**3;var l=o*4.0767416621+s*-3.3077115913+i*.2309699292,r=o*-1.2684380046+s*2.6097574011+i*-.3413193965,u=o*-.0041960863+s*-.7034186147+i*1.707614701;return l=255*Rt(l),r=255*Rt(r),u=255*Rt(u),l=Lt(l,0,255),r=Lt(r,0,255),u=Lt(u,0,255),l=Math.round(l),r=Math.round(r),u=Math.round(u),[l,r,u]}function Bn({mediaAttachments:t,statusID:n,instance:a,lang:o,index:s=0,onClose:i=()=>{}}){var c,m;const l=M(null),[r,u]=T(s),h=M(null);Ne(()=>{var d;(d=h.current)==null||d.scrollIntoView()},[]);const f=M(n);N(()=>{const d=s*l.current.clientWidth,b=f.current!==n;b&&(f.current=n),l.current.scrollTo({left:d,behavior:b?"auto":"smooth"}),l.current.focus()},[s,n]);const[p,g]=T(!0);return N(()=>{let d=()=>{i()};return l.current&&l.current.addEventListener("swiped-down",d),()=>{l.current&&l.current.removeEventListener("swiped-down",d)}},[]),Te("esc",i,{ignoreEventWhen:d=>!!document.querySelector("#modal-container > *")},[i]),N(()=>{let d=()=>{const{clientWidth:b,scrollLeft:y}=l.current,v=Math.round(y/b);u(v)};return l.current&&l.current.addEventListener("scroll",d,{passive:!0}),()=>{l.current&&l.current.removeEventListener("scroll",d)}},[]),N(()=>{let d=setTimeout(()=>{var b,y;(y=(b=l.current)==null?void 0:b.focus)==null||y.call(b)},100);return()=>clearTimeout(d)},[]),e("div",{class:"media-modal-container",children:[e("div",{ref:l,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:d=>{(d.target.classList.contains("carousel-item")||d.target.classList.contains("media")||d.target.classList.contains("media-zoom"))&&i()},children:t==null?void 0:t.map((d,b)=>{const{blurhash:y}=d;let v;if(y){const I=Ln(y),S=zn(I);v=Fn([.6,S[1],S[2]])}return e("div",{class:"carousel-item",style:{"--accent-color":`rgb(${v==null?void 0:v.join(",")})`,"--accent-alpha-color":`rgba(${v==null?void 0:v.join(",")}, 0.4)`},tabindex:"0",ref:b===r?h:null,onClick:I=>{I.target!==I.currentTarget&&g(!p)},children:[!!d.description&&e("button",{type:"button",class:"media-alt",hidden:!p,onClick:()=>{k.showMediaAlt={alt:d.description,lang:o}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:o,dir:"auto",children:d.description})]}),e(ss,{media:d,showOriginal:!0,lang:o})]},d.id)})}),e("div",{class:"carousel-top-controls",hidden:!p,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>i(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((d,b)=>e("button",{type:"button",disabled:b===r,class:`carousel-dot ${b===r?"active":""}`,onClick:y=>{y.preventDefault(),y.stopPropagation(),l.current.scrollTo({left:l.current.clientWidth*b,behavior:"smooth"}),l.current.focus()},children:e(w,{icon:"round",size:"s"})},d.id))}):e("span",{}),e("span",{children:[e(Ye,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:e(xe,{href:((c=t[r])==null?void 0:c.remoteUrl)||((m=t[r])==null?void 0:m.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]})})," ",e(W,{to:`${a?`/${a}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${r+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!p,children:[e("button",{type:"button",class:"carousel-button",hidden:r===0,onClick:d=>{d.preventDefault(),d.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(r-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:r===t.length-1,onClick:d=>{d.preventDefault(),d.stopPropagation(),l.current.focus(),l.current.scrollTo({left:l.current.clientWidth*(r+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]})]})}const Xs=""+new URL("floating-button-ef345856.svg",import.meta.url).href,Zs=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,Qs=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function Pt({children:t}){if(typeof t=="string")return t;const[n,a]=T("");return N(()=>{Promise.resolve(t).then(a)},[t]),n}const nt=9,ei=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],On={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},bt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},It={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:it(async({id:t})=>(await z().masto.v1.lists.$select(t).fetch()).title),path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||z().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||z().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t,path:({query:t})=>`/search?q=${t}`,icon:"search"},"account-statuses":{id:"account-statuses",title:it(async({id:t})=>{const n=await z().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||z().instance,path:({hashtag:t,instance:n})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}`,icon:"hashtag"}};function ti({onClose:t}){const n=ue(k),{masto:a}=z(),{shortcuts:o}=n,[s,i]=T([]),[l,r]=T([]),[u,h]=T(!1),[f,p]=T(!1),[g]=xn();return N(()=>{(async()=>{try{const c=await a.v1.lists.list();c.sort((m,d)=>m.title.localeCompare(d.title)),i(c)}catch{}})(),(async()=>{try{const c=a.v1.followedTags.list(),m=[];do{const{value:d,done:b}=await c.next();if(b||(d==null?void 0:d.length)===0)break;m.push(...d)}while(!0);r(m)}catch{}})()},[]),e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Xs},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Qs},{value:"multi-column",label:"Multi-column",imgURL:Zs}].map(({value:c,label:m,imgURL:d})=>{const b=n.settings.shortcutsViewMode===c||c==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:b?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:c,checked:b,onChange:y=>{k.settings.shortcutsViewMode=y.target.value}})," ",e("img",{src:d,alt:"",width:"80",height:"58"})," ",e("span",{children:m})]},c)})}),o.length>0?e("ol",{class:"shortcuts-list",ref:g,children:o.filter(Boolean).map((c,m)=>{const d=Object.values(c).join("-"),{type:b}=c;if(!It[b])return null;let{icon:y,title:v,subtitle:I}=It[b];return typeof v=="function"&&(v=v(c,m)),typeof I=="function"&&(I=I(c,m)),typeof y=="function"&&(y=y(c,m)),e("li",{children:[e(w,{icon:y}),e("span",{class:"shortcut-text",children:[e(Pt,{children:v}),I&&e(x,{children:[" ",e("small",{class:"ib insignificant",children:I})]})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:m===0,onClick:()=>{const S=Array.from(k.shortcuts);if(m>0){const $=k.shortcuts[m-1];S[m-1]=c,S[m]=$,k.shortcuts=S}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:m===o.length-1,onClick:()=>{const S=Array.from(k.shortcuts);if(m<k.shortcuts.length-1){const $=k.shortcuts[m+1];S[m+1]=c,S[m]=$,k.shortcuts=S}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{h({shortcut:c,shortcutIndex:m})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},d)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:c=>{c.preventDefault(),k.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:o.length>=nt&&`Max ${nt} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>p(!0),children:"Import/export"}),e("button",{type:"button",disabled:o.length>=nt,onClick:()=>h(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),u&&e(we,{class:"light",onClick:c=>{c.target===c.currentTarget&&h(!1)},children:e(ni,{shortcut:u.shortcut,shortcutIndex:u.shortcutIndex,lists:s,followedHashtags:l,onSubmit:({result:c,mode:m})=>{m==="edit"?k.shortcuts[u.shortcutIndex]=c:k.shortcuts.push(c)},onClose:()=>h(!1)})}),f&&e(we,{class:"light",onClick:c=>{c.target===c.currentTarget&&p(!1)},children:e(si,{shortcuts:o,onClose:()=>p(!1)})})]})}function ni({lists:t,followedHashtags:n,onSubmit:a,disabled:o,shortcut:s,shortcutIndex:i,onClose:l}){var p,g;const r=!!s,[u,h]=T((s==null?void 0:s.type)||null),f=M();return N(()=>{if(r&&u&&bt[u]){const c=f.current;bt[u].forEach(({name:m,type:d})=>{const b=c.querySelector(`[name="${m}"]`);b&&s[m]&&(d==="checkbox"?b.checked=s[m]==="on":b.value=s[m])})}},[r,u]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!l&&e("button",{type:"button",class:"sheet-close",onClick:l,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[r?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:f,onSubmit:c=>{c.preventDefault();const m=new FormData(c.target),d={};m.forEach((b,y)=>{d[y]=b==null?void 0:b.trim(),y==="instance"&&(d[y]=d[y].replace(/^https?:\/\//,"").replace(/\/+$/,""),d[y]=d[y].replace(/^@?[^@]+@/,""))}),d.type&&(a({result:d,mode:r?"edit":"add"}),c.target.reset(),h(null),l==null||l())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:o,onChange:c=>{h(c.target.value)},defaultValue:r?s.type:void 0,name:"type",children:[e("option",{}),ei.map(c=>e("option",{value:c,children:On[c]}))]})]})}),(g=(p=bt[u])==null?void 0:p.map)==null?void 0:g.call(p,({text:c,name:m,type:d,placeholder:b,pattern:y,notRequired:v})=>u==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!v,disabled:o,children:t.map(I=>e("option",{value:I.id,children:I.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:c})," ",e("input",{type:d,name:m,placeholder:b,required:d==="text"&&!v,disabled:o,list:u==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:y}),u==="hashtag"&&n.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:n.map(I=>e("option",{value:I.name}))})]})})),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:o,children:r?"Save":"Add"}),r&&e("button",{type:"button",class:"light danger",onClick:()=>{k.shortcuts.splice(i,1),l==null||l()},children:"Remove"})]})]})})]})}function si({shortcuts:t,onClose:n}){var h;const a=ge(()=>!t||!t.filter(Boolean).length?"":tn.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,s]=T(""),[i,l]=T("default"),r=ge(()=>{if(!o)return l("default"),null;try{const f=JSON.parse(tn.decompressFromEncodedURIComponent(o));if(!Array.isArray(f))throw new Error("Not an array");return l("default"),f}catch{try{const p=JSON.parse(o);if(!Array.isArray(p))throw new Error("Not an array");return l("default"),p}catch{return l("error"),null}}},[o]),u=k.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:f=>{s(f.target.value)}})}),!!r&&Array.isArray(r)&&e(x,{children:[e("p",{children:[e("b",{children:r.length})," shortcut",r.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:r.map(f=>{var p,g;return e("li",{children:[e("span",{style:{opacity:t.some(c=>Object.keys(c).every(m=>c[m]===f[m]))?1:0},children:"*"}),e("span",{children:[On[f.type],f.type==="list"&&" ⚠️"," ",(g=(p=bt[f.type])==null?void 0:p.map)==null?void 0:g.call(p,({text:c,name:m,type:d})=>f[m]?e(x,{children:[e("span",{class:"tag collapsed insignificant",children:[c,":"," ",d==="checkbox"?f[m]==="on"?"✅":"❌":f[m]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),i==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[u&&e(x,{children:[e(Ee,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const f=r.filter(c=>!k.shortcuts.some(m=>Object.keys(m).every(d=>m[d]===c[d])));if(!f.length){ae("No new shortcuts to import");return}let p=[...k.shortcuts,...f];const g=p.length>nt;g&&(p=p.slice(0,nt)),k.shortcuts=p,ae(g?`Shortcuts imported. Exceeded max ${nt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:"Import & append…"})})," "]}),e(Ee,{confirmLabel:u?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:u?"danger":void 0,onClick:()=>{k.shortcuts=r,ae("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:u?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:a,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),ae("Shortcuts copied")}catch{ae("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.clipboard.writeText(a),ae("Shortcut settings copied")}catch{ae("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((h=navigator==null?void 0:navigator.canShare)==null?void 0:h.call(navigator,{text:a}))&&e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.share({text:a})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",a.length>0&&e("small",{class:"insignificant",children:[a.length," characters"]})]}),!!a&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}An(k,t=>{for(const[n,a,o,s]of t)/^show/i.test(a)&&!o&&_t()});function ii(){var o,s,i,l,r,u,h,f;const t=ue(k),n=Rn(),a=ot();return e(x,{children:[!!t.showCompose&&e(we,{children:e(is,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((o=window.__COMPOSE__)==null?void 0:o.replyToStatus)||null,editStatus:((s=k.showCompose)==null?void 0:s.editStatus)||((i=window.__COMPOSE__)==null?void 0:i.editStatus)||null,draftStatus:((l=k.showCompose)==null?void 0:l.draftStatus)||((r=window.__COMPOSE__)==null?void 0:r.draftStatus)||null,onClose:p=>{const{newStatus:g,instance:c,type:m}=p||{};k.showCompose=!1,window.__COMPOSE__=null,g&&(k.reloadStatusPage++,ae({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[m||"post"],delay:1e3,duration:1e4,onClick:d=>{d.hideToast(),k.prevLocation=a,n(c?`/${c}/s/${g.id}`:`/s/${g.id}`)}}))}})}),!!t.showSettings&&e(we,{onClose:()=>{k.showSettings=!1},children:e(Ds,{onClose:()=>{k.showSettings=!1}})}),!!t.showAccounts&&e(we,{onClose:()=>{k.showAccounts=!1},children:e($s,{onClose:()=>{k.showAccounts=!1}})}),!!t.showAccount&&e(we,{class:"light",onClose:()=>{k.showAccount=!1},children:e(Gs,{account:((u=t.showAccount)==null?void 0:u.account)||t.showAccount,instance:(h=t.showAccount)==null?void 0:h.instance,onClose:({destination:p}={})=>{k.showAccount=!1}})}),!!t.showDrafts&&e(we,{onClose:()=>{k.showDrafts=!1},children:e(Ws,{onClose:()=>k.showDrafts=!1})}),!!t.showMediaModal&&e(we,{onClick:p=>{(p.target===p.currentTarget||p.target.classList.contains("media"))&&(k.showMediaModal=!1)},children:e(Bn,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{k.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(we,{class:"light",onClose:()=>{k.showShortcutsSettings=!1},children:e(ti,{onClose:()=>k.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(we,{class:"light",onClose:()=>{k.showGenericAccounts=!1},children:e(Ys,{onClose:()=>k.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(we,{class:"light",onClose:p=>{k.showMediaAlt=!1},children:e(Js,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(f=t.showMediaAlt)==null?void 0:f.lang,onClose:()=>{k.showMediaAlt=!1}})})]})}function Nt({accountID:t,onChange:n}){const{masto:a}=z(),[o,s]=T("default"),[i,l]=T(null),[r,u]=T(null),h=r!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:o==="loading"||h,onClick:()=>{s("loading"),l("accept"),(async()=>{try{const f=await a.v1.followRequests.$select(t).authorize();if(!(f!=null&&f.followedBy))throw new Error("Follow request not accepted");u(f),n()}catch{}s("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:o==="loading"||h,class:"light danger",onClick:()=>{s("loading"),l("reject"),(async()=>{try{const f=await a.v1.followRequests.$select(t).reject();if(f!=null&&f.followedBy)throw new Error("Follow request not rejected");u(f),n()}catch{s("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:h&&i?i==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(ve,{hidden:o!=="loading"})})]})}const dn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},et={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(x,{children:["reported ",t]})},Mt=50;function oi({notification:t,instance:n,isStatic:a}){var D,A,P,V;const{id:o,status:s,account:i,report:l,_accounts:r,_statuses:u}=t;let{type:h}=t;const f=(s==null?void 0:s.reblog)||s,p=f==null?void 0:f.id,g=Z.session.get("currentAccount"),c=g===(i==null?void 0:i.id),m=(D=s==null?void 0:s.poll)==null?void 0:D.voted,d=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==g&&((A=s==null?void 0:s.account)==null?void 0:A.id)===g;let b=0,y=0;if(h==="favourite+reblog"){for(const R of r)(P=R._types)!=null&&P.includes("favourite")&&b++,(V=R._types)!=null&&V.includes("reblog")&&y++;!y&&b&&(h="favourite"),!b&&y&&(h="reblog")}let v;if(h==="poll"?v=et[c?"poll-self":m?"poll-voted":"poll"]:h==="reblog"||h==="favourite"||h==="favourite+reblog"?(u==null?void 0:u.length)>1?v=et[`${h}+account`]:d?v=et[`${h}_reply`]:v=et[h]:et[h]?v=et[h]:v=`[Unknown notification type: ${h}]`,typeof v=="function"){const R=(u==null?void 0:u.length)||(r==null?void 0:r.length);if(R)v=v(R);else if(h==="admin.report"){const H=l==null?void 0:l.targetAccount;H&&(v=v(e(vt,{account:H,showAvatar:!0})))}}if(h==="mention"&&!s)return null;const I=t.createdAt&&new Date(t.createdAt).toLocaleString(),S={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[h]||"Accounts",$=()=>{k.showGenericAccounts={heading:S,accounts:r,showReactions:h==="favourite+reblog"}};return e("div",{class:`notification notification-${h}`,"data-notification-id":o,tabIndex:"0",children:[e("div",{class:`notification-type notification-${h}`,title:I,children:h==="favourite+reblog"?e(x,{children:[e(w,{icon:"rocket",size:"xl",alt:h,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:h,class:"favourite-icon"})]}):e(w,{icon:dn[h]||"notification",size:"xl",alt:h})}),e("div",{class:"notification-content",children:[h!=="mention"&&e(x,{children:[e("p",{children:[!/poll|update/i.test(h)&&e(x,{children:(r==null?void 0:r.length)>1?e(x,{children:[e("b",{tabIndex:"0",onClick:$,children:[e("span",{title:r.length,children:De(r.length)})," ","people"]})," "]}):e(x,{children:[e(vt,{account:i,showAvatar:!0})," "]})}),v,h==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(Tt,{datetime:t.createdAt,format:"micro"})]})]}),h==="follow_request"&&e(Nt,{accountID:i.id})]}),(r==null?void 0:r.length)>1&&e("p",{class:"avatars-stack",children:[r.slice(0,Mt).map((R,H)=>e(x,{children:[e("a",{href:R.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:F=>{F.preventDefault(),k.showAccount=R},children:[e(Ke,{url:R.avatarStatic,size:r.length<=10?"xxl":r.length<20?"xl":r.length<30?"l":r.length<40?"m":"s",alt:`${R.displayName} @${R.acct}`,squircle:R==null?void 0:R.bot},R.id),h==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:R._types.map(F=>e(w,{icon:dn[F],size:"s",class:`${F}-icon`}))})]})," "]})),e("button",{type:"button",class:"small plain",onClick:$,children:[r.length>Mt&&`+${r.length-Mt}`,e(w,{icon:"chevron-down"})]})]}),(u==null?void 0:u.length)>1&&e("ul",{class:"notification-group-statuses",children:u.map(R=>e("li",{children:e(hn,{class:`status-link status-type-${h}`,to:n?`/${n}/s/${R.id}`:`/s/${R.id}`,children:e(Ie,{status:R,size:"s"})})},R.id))}),s&&(!(u!=null&&u.length)||(u==null?void 0:u.length)<=1)&&e(hn,{class:`status-link status-type-${h}`,to:n?`/${n}/s/${p}`:`/s/${p}`,onContextMenu:R=>{const H=R.target.querySelector(".status");if(H){if(R.metaKey)return;R.preventDefault(),H.dispatchEvent(new MouseEvent("contextmenu",{clientX:R.clientX,clientY:R.clientY}))}},children:a?e(Ie,{status:f,size:"s"}):e(Ie,{statusID:p,size:"s"})})]})]})}function hn(t){const n=os();return e(W,{...t,"data-read-more":"Read more →",ref:n})}const jt=Ue(oi),ci=Ue(function(){if(!("serviceWorker"in navigator))return null;const n=ue(k),{routeNotification:a}=n,{id:o,accessToken:s}=a||{},[i,l]=T(!1);Ne(()=>{if(!o||!s)return;const{instance:u}=z(),{masto:h,instance:f}=z({accessToken:s}),p=u===f,g=s?cs(s):st();(async()=>{const c=await h.v1.notifications.$select(o).fetch();if(c&&g){const m=g.instanceURL,{type:d,status:b,account:y}=c,v=!!document.querySelector("#modal-container > *"),I=d==="follow"&&!!(y!=null&&y.id),S=!!(y!=null&&y.id),$=!!(b!=null&&b.id);I&&p?k.showAccount={account:y,instance:m}:v||!p||S&&$?l({id:o,account:g,notification:c,sameInstance:p}):$?location.hash=`/${u}/s/${b.id}`:I?location.hash=`/${u}/a/${y.id}`:location.hash="/notifications"}})()},[o,s]),Ne(()=>{const u=h=>{const{type:f,id:p,accessToken:g}=(h==null?void 0:h.data)||{};f==="notification"&&(k.routeNotification={id:p,accessToken:g})};return navigator.serviceWorker.addEventListener("message",u),()=>{navigator.serviceWorker.removeEventListener("message",u)}},[]),Ne(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),St(u=>{u&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const r=()=>{l(!1),k.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(i){const{id:u,account:h,notification:f,sameInstance:p}=i;return e(we,{class:"light",onClick:g=>{g.target===g.currentTarget&&r()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:r,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!p&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:g=>{const{target:c}=g;(g.target.tagName==="BUTTON"||g.target.tagName==="A")&&r()},children:e(jt,{instance:h.instanceURL,notification:f,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(W,{to:"/notifications",class:"button light",onClick:r,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null});const qn=fs((t,n)=>{const{instance:a}=z(),[o,s]=ze(),[i,l]=T(!1),[r,u]=T(o.get("q")||""),h=o.get("type"),f=M(null),p=M(null);return ps(n,()=>({setValue:g=>{u(g)},focus:()=>{p.current.focus()},select:()=>{p.current.select()},blur:()=>{p.current.blur()}})),e("form",{ref:f,class:"search-popover-container",onSubmit:g=>{var m;if(g.preventDefault(),/\/search/.test(location.hash))if(r){const d={q:r};h&&(d.type=h),s(d)}else s({});else r?location.hash=`/search?q=${encodeURIComponent(r)}${h?`&type=${h}`:""}`:location.hash="/search";(m=t==null?void 0:t.onSubmit)==null||m.call(t,g)},children:[e("input",{ref:p,value:r,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:g=>{g.target.value||s({})},onInput:g=>{u(g.target.value),l(!0)},onFocus:()=>{l(!0)},onBlur:()=>{var g,c;setTimeout(()=>{l(!1)},100),(c=(g=f.current)==null?void 0:g.querySelector(".search-popover-item.focus"))==null||c.classList.remove("focus")},onKeyDown:g=>{var m;const{key:c}=g;switch(c){case"Escape":l(!1);break;case"Down":case"ArrowDown":if(g.preventDefault(),i){const d=f.current.querySelector(".search-popover-item.focus");if(d){let b=d.nextElementSibling;for(;b&&b.hidden;)b=b.nextElementSibling;b&&(b.classList.add("focus"),Array.from(b.parentElement.children).filter(v=>v!==b).forEach(v=>{v.classList.remove("focus")}))}else{const b=f.current.querySelector(".search-popover-item");b&&b.classList.add("focus")}}break;case"Up":case"ArrowUp":if(g.preventDefault(),i){const d=document.querySelector(".search-popover-item.focus");if(d){let b=d.previousElementSibling;for(;b&&b.hidden;)b=b.previousElementSibling;b&&(b.classList.add("focus"),Array.from(b.parentElement.children).filter(v=>v!==b).forEach(v=>{v.classList.remove("focus")}))}else{const b=document.querySelector(".search-popover-item:last-child");b&&b.classList.add("focus")}}break;case"Enter":if(i){const d=document.querySelector(".search-popover-item.focus");d&&(g.preventDefault(),d.click()),l(!1),(m=t==null?void 0:t.onSubmit)==null||m.call(t,g)}break}}}),e("div",{class:"search-popover",hidden:!i||!r,children:!!r&&[{label:e(x,{children:["Posts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=statuses`,hidden:/^https?:/.test(r)},{label:e(x,{children:["Posts tagged with ",e("mark",{children:["#",r.replace(/^#/,"")]})]}),to:`/${a}/t/${r.replace(/^#/,"")}`,hidden:/^@/.test(r)||/^https?:/.test(r)||/\s/.test(r),top:/^#/.test(r),type:"link"},{label:e(x,{children:["Look up ",e("mark",{children:r})]}),to:`/${r}`,hidden:!/^https?:/.test(r),top:/^https?:/.test(r),type:"link"},{label:e(x,{children:["Accounts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=accounts`}].sort((g,c)=>g.top&&!c.top?-1:!g.top&&c.top?1:0).map(({label:g,to:c,hidden:m,type:d})=>e(W,{to:c,class:"search-popover-item",hidden:m,onClick:b=>{var y;(y=t==null?void 0:t.onSubmit)==null||y.call(t,b)},children:[e(w,{icon:d==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:g})," "]}))})]})}),ai=Ue(function({onClose:n=()=>{}}){const[a,o]=T(!1),s=M(null);Te("/",l=>{o(!0),setTimeout(()=>{var r,u,h,f;(u=(r=s.current)==null?void 0:r.focus)==null||u.call(r),(f=(h=s.current)==null?void 0:h.select)==null||f.call(h)},0)},{preventDefault:!0,ignoreEventWhen:l=>{const r=/\/search/.test(location.hash),u=!!document.querySelector("#modal-container > *");return r||u}});const i=()=>{o(!1),n()};return Te("esc",l=>{var r,u;(u=(r=s.current)==null?void 0:r.blur)==null||u.call(r),i()},{enabled:a,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!a,onClick:l=>{l.target===l.currentTarget&&i()},children:e(qn,{ref:s,onSubmit:()=>{i()}})})});function ri(){const{instance:t}=z(),n=ue(k),{shortcuts:a,settings:o}=n;if(!a.length||o.shortcutsColumnsMode||o.shortcutsViewMode==="multi-column")return null;const s=M(),i=ge(()=>a.map((r,u)=>{const{type:h,...f}=r;if(!It[h])return null;let{id:p,path:g,title:c,subtitle:m,icon:d}=It[h];return typeof p=="function"&&(p=p(f,u)),typeof g=="function"&&(g=g({...f,instance:f.instance||t},u)),typeof c=="function"&&(c=c(f,u)),typeof m=="function"&&(m=m(f,u)),typeof d=="function"&&(d=d(f,u)),{id:p,path:g,title:c,subtitle:m,icon:d}}).filter(Boolean),[a]),l=Rn();return Te(["1","2","3","4","5","6","7","8","9"],(r,u)=>{var f,p;const h=parseInt(u.keys[0],10)-1;if(h<i.length){const{path:g}=i[h];g&&(l(g),(p=(f=s.current)==null?void 0:f.closeMenu)==null||p.call(f))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",children:e("ul",{children:i.map(({id:r,path:u,title:h,subtitle:f,icon:p},g)=>e("li",{children:e(W,{class:f?"has-subtitle":"",to:u,onClick:c=>{if(c.target.classList.contains("is-active")){c.preventDefault();const m=document.getElementById(`${r}-page`);if(m){m.scrollTop=0;const d=m.querySelector(".updates-button");d&&d.click()}}},children:[e(w,{icon:p,size:"xl",alt:h}),e("span",{children:[e(Pt,{children:h}),f&&e(x,{children:[e("br",{}),e("small",{children:f})]})]})]})},g+h))})}):e(Ye,{instanceRef:s,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:r=>{var u,h;try{const{target:f}=r;getComputedStyle(f).pointerEvents==="none"&&((h=(u=s.current)==null?void 0:u.closeMenu)==null||h.call(u))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:i.map(({path:r,title:u,subtitle:h,icon:f},p)=>e(xe,{to:r,class:"glass-menu-item",children:[e(w,{icon:f,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Pt,{children:u})}),h&&e(x,{children:[" ",e("small",{class:"more-insignificant",children:h})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:p+1})]},p+u))})})}const li=Ue(ri);function ht(t){const{containerProps:n}=t,a=ms(),o=M();return e(Ye,{boundingBoxPadding:Tn(),repositionFlag:`${a.width}x${a.height}`,...t,instanceRef:o,containerProps:{onClick:s=>{var i,l,r;s.target===s.currentTarget&&((l=(i=o.current)==null?void 0:i.closeMenu)==null||l.call(i)),(r=n==null?void 0:n.onClick)==null||r.call(n,s)},...n}})}function di(t){var s;let n=[],a=[],o=0;for(let i=0;i<t.length;i++){const l=t[i];l.reblog&&!((s=l.account)!=null&&s.group)?(a.push(l),o++):(n.push(l),o<3&&(o=0))}if(t.length>10&&(a.length>t.length/4||o>=3)){const i=a.map(l=>l.id);if(a.length>t.length*3/4)n=[...n,{id:i,items:a,type:"boosts"}];else{const l=Math.floor(n.length/2);n=[...n.slice(0,l),{id:i,items:a,type:"boosts"},...n.slice(l)]}return n}else return t}function un(t,n){const a=Z.account.get("boostedStatusIDs")||{},o=t.filter(i=>{if(!i.reblog)return!0;const l=`${n}-${i.reblog.id}`,r=a[l];return r&&r!==i.id?!1:(a[l]=i.id,!0)}),s=Object.keys(a);return s.length>50&&s.slice(0,s.length-50).forEach(i=>{delete a[i]}),Z.account.set("boostedStatusIDs",a),o}function hi(t){const n=[];let a=0;t.forEach(i=>{for(let r=0;r<n.length;r++){if(n[r].find(u=>u.id===i.id))return;if(n[r].find(u=>u.id===i.inReplyToId)||n[r].find(u=>u.inReplyToId===i.id)){n[r].push(i);return}}const l=t.find(r=>r.id===i.inReplyToId);l&&(n[a++]=[i,l])});for(let i=0;i<n.length;i++)for(let l=i+1;l<n.length;l++)n[i].find(u=>n[l].includes(u))&&(n[i]=[...n[i],...n[l]],n[i]=n[i].filter((u,h,f)=>f.findIndex(p=>p.id===u.id)===h),n.splice(l,1),l--);n.forEach(i=>{i.sort((l,r)=>!l.inReplyToId&&!r.inReplyToId?new Date(l.createdAt)-new Date(r.createdAt):l.inReplyToId===r.id?1:r.inReplyToId===l.id||!l.inReplyToId?-1:r.inReplyToId?new Date(l.createdAt)-new Date(r.createdAt):1)}),n.forEach(i=>{const l=i[0].account.id;i.forEach(r=>{r.account.id!==l&&(r._differentAuthor=!0)})}),n.length;const o=[],s=[];return t.forEach(i=>{if(i.reblog){o.push(i);return}for(let l=0;l<n.length;l++)if(n[l].find(r=>r.id===i.id)){if(s.includes(l))return;const r=n[l];r.sort((h,f)=>{const p=new Date(h.createdAt),g=new Date(f.createdAt);return p-g});const u=r[0].account.id;o.push({id:r.map(h=>h.id),items:r,type:r.every(h=>h.account.id===u)?"thread":"conversation"}),s.push(l);return}o.push(i)}),o}function xt({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:a=1,scrollThresholdStart:o=10,scrollThresholdEnd:s=10,direction:i="vertical",distanceFromStartPx:l,distanceFromEndPx:r}={}){const[u,h]=T(null),[f,p]=T(!1),[g,c]=T(!1),[m,d]=T(!1),[b,y]=T(!1),v=i==="vertical";return Ne(()=>{const I=t.current;if(!I)return{};let S=v?I.scrollTop:I.scrollLeft;function $(){const{scrollTop:D,scrollLeft:A,scrollHeight:P,scrollWidth:V,clientHeight:R,clientWidth:H}=I,F=v?D:A,B=v?P:V,se=v?R:H,Ae=Math.abs(F-S),K=l||Math.min(se*n,B,F),oe=r||Math.min(se*a,B,B-F-se);Ae>=(S<F?s:o)&&(h(S<F?"end":"start"),S=F),p(F<=0),c(F+se>=B),d(F<=K),y(F+se>=B-oe)}return I.addEventListener("scroll",$,{passive:!0}),()=>I.removeEventListener("scroll",$)},[n,a,o,s]),{scrollDirection:u,reachStart:f,reachEnd:g,nearReachStart:m,nearReachEnd:b,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function ut(t){var I,S,$,D,A;const n=ue(k),{masto:a,instance:o,authenticated:s}=z(),[i,l]=T(),[r,u]=T(!1);N(()=>{const P=Z.local.getJSON("accounts")||[],V=P.find(R=>R.info.id===Z.session.get("currentAccount"));V&&l(V),u(P.length>1)},[]);const h=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(P=>P.type==="following"),f=gs(()=>{k.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),p=M(),[g,c]=T(void 0),m=Tn([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),d=M();async function b(P){return(P||!d.current)&&(d.current=a.v1.mutes.list({limit:80})),await d.current.next()}const y=M();async function v(P){return(P||!y.current)&&(y.current=a.v1.blocks.list({limit:80})),await y.current.next()}return e(x,{children:[e("button",{ref:p,type:"button",class:`button plain nav-menu-button ${r?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{c(P=>P?void 0:"open")},onContextMenu:P=>{P.preventDefault(),k.showAccounts=!0},...f(),children:[r&&e(Ke,{url:((I=i==null?void 0:i.info)==null?void 0:I.avatar)||((S=i==null?void 0:i.info)==null?void 0:S.avatarStatic),size:"l",squircle:($=i==null?void 0:i.info)==null?void 0:$.bot}),e(w,{icon:"menu",size:r?"s":"l"})]}),e(Mn,{menuClassName:"nav-menu",state:g,anchorRef:p,onClose:()=>{c(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{c(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:m,unmountOnClose:!0,children:[!!((D=n.appVersion)!=null&&D.commitHash)&&n.appVersion.commitHash!=="116e8ac"&&e("div",{class:"top-menu",children:[e(Q,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(Me,{})]}),e("section",{children:[e(xe,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),s&&e(x,{children:[h&&e(xe,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(xe,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(xe,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(Me,{}),e(xe,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(xe,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(xe,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(xe,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]})]}),e(Me,{}),e(xe,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(xe,{to:`/${o}/p/l`,children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Local"})]}),e(xe,{to:`/${o}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(xe,{to:`/${o}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:s?e(x,{children:[e(Me,{}),((A=i==null?void 0:i.info)==null?void 0:A.id)&&e(xe,{to:`/${o}/a/${i.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(Q,{onClick:()=>{k.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(Q,{onClick:()=>{k.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:b}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(Q,{onClick:()=>{k.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:v}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(Me,{className:"divider-grow"}),e(Q,{onClick:()=>{k.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(Q,{onClick:()=>{k.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(Q,{onClick:()=>{k.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(x,{children:[e(Me,{}),e(xe,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(Q,{onClick:()=>{k.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const pt={block:"nearest",inline:"center",behavior:"smooth"};function Fe({title:t,titleComponent:n,id:a,instance:o,emptyText:s,errorText:i,useItemID:l,boostsCarousel:r,fetchItems:u=()=>{},checkForUpdates:h=()=>{},checkForUpdatesInterval:f=6e4,headerStart:p,headerEnd:g,timelineStart:c,allowFilters:m,refresh:d}){const b=ue(k),[y,v]=T([]),[I,S]=T("default"),[$,D]=T(!1),[A,P]=T(!1),[V,R]=T(!0),H=M(),F=kt(U=>{P(!1),I!=="loading"&&(S("loading"),(async()=>{try{let{done:te,value:X}=await u(U);Array.isArray(X)?(r&&(X=di(X)),X=hi(X),v(U?X:be=>[...be,...X]),X.length||(te=!0),D(!te)):D(!1),S("default")}catch{S("error")}finally{F.cancel()}})())},1500,{leading:!0,trailing:!1}),B=".timeline-item, .timeline-item-alt",se=Te("j, shift+j",(U,te)=>{const X=document.activeElement.closest(B),be=X==null?void 0:X.getBoundingClientRect(),le=Array.from(H.current.querySelectorAll(B));if(X&&be.top<H.current.clientHeight&&be.bottom>0){const q=le.indexOf(X);let J=le[q+1];te.shift&&(J=le.find((C,L)=>L>q&&!C.classList.contains("timeline-item-alt"))),J&&(J.focus(),J.scrollIntoView(pt))}else{const q=le.find(J=>{const C=J.getBoundingClientRect();return C.top>=44&&C.left>=0});q&&(q.focus(),q.scrollIntoView(pt))}}),Ae=Te("k, shift+k",(U,te)=>{const X=document.activeElement.closest(B),be=X==null?void 0:X.getBoundingClientRect(),le=Array.from(H.current.querySelectorAll(B));if(X&&be.top<H.current.clientHeight&&be.bottom>0){const q=le.indexOf(X);let J=le[q-1];te.shift&&(J=le.findLast((C,L)=>L<q&&!C.classList.contains("timeline-item-alt"))),J&&(J.focus(),J.scrollIntoView(pt))}else{const q=le.find(J=>{const C=J.getBoundingClientRect();return C.top>=44&&C.left>=0});q&&(q.focus(),q.scrollIntoView(pt))}}),K=Te(["enter","o"],()=>{const U=document.activeElement.closest(B);U&&U.click()}),{scrollDirection:oe,nearReachStart:O,nearReachEnd:E,reachStart:G,reachEnd:ee}=xt({scrollableRef:H,distanceFromEnd:2,scrollThresholdStart:44});N(()=>{var U;(U=H.current)==null||U.scrollTo({top:0}),F(!0)},[]),N(()=>{F(!0)},[d]),N(()=>{G&&F(!0)},[G]),N(()=>{(E||ee&&$)&&F()},[E,$]);const ce=He(async({disableIdleCheck:U=!1}={})=>{b.settings.autoRefresh&&H.current.scrollTop===0&&(U||window.__IDLE__)&&!mi()?F(!0):await h()&&P(!0)},[a,F,h,b.settings.autoRefresh]),fe=kt(ce,3e3),Le=M();St(U=>{if(U){const te=Date.now()-Le.current;(!Le.current||te>1e3*60)&&fe({disableIdleCheck:!0})}else Le.current=Date.now(),fe.cancel();R(U)},[h,ce,b.settings.autoRefresh]),yn(ce,V&&!A?f:null);const ie=oe==="end"&&!O;return e("div",{id:`${a}-page`,class:"deck-container",ref:U=>{H.current=U,se.current=U,Ae.current=U,K.current=U},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{hidden:ie,onClick:U=>{var te;U.target.closest("a, button")||(te=H.current)==null||te.scrollTo({top:0,behavior:"smooth"})},onDblClick:U=>{U.target.closest("a, button")||F(!0)},class:I==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ut,{}),p??e(W,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!g&&g})]}),y.length>0&&I!=="loading"&&!ie&&A&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var U;F(!0),(U=H.current)==null||U.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!c&&e("div",{class:`timeline-start ${I==="loading"?"loading":""}`,children:c}),y.length?e(x,{children:[e("ul",{class:"timeline",children:[y.map(U=>e(ui,{status:U,instance:o,useItemID:l,allowFilters:m},U.id+(U==null?void 0:U._pinned))),$&&I==="loading"&&e(x,{children:[e("li",{style:{height:"20vh"},children:e(Ie,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(Ie,{skeleton:!0})})]})]}),I==="default"&&($?e(ct,{onChange:U=>{U&&F()},children:e("button",{type:"button",class:"plain block",onClick:()=>F(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):I==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((U,te)=>e("li",{children:e(Ie,{skeleton:!0})},te))}):I!=="error"&&e("p",{class:"ui-state",children:s}),I==="error"&&e("p",{class:"ui-state",children:[i,e("br",{}),e("br",{}),e("button",{class:"button plain",onClick:()=>F(!y.length),children:"Try again"})]})]})})}function ui({status:t,instance:n,useItemID:a,allowFilters:o}){const{id:s,reblog:i,items:l,type:r,_pinned:u}=t,h=(i==null?void 0:i.id)||s,f=n?`/${n}/s/${h}`:`/s/${h}`;let p="";r==="boosts"?p=`${l.length} Boosts`:r==="pinned"&&(p="Pinned posts");const g=r==="boosts"||r==="pinned";if(l){if(g)return l.sort((m,d)=>m._filtered&&!d._filtered?1:!m._filtered&&d._filtered?-1:0),e("li",{class:"timeline-item-carousel",children:e(fi,{title:p,class:`${r}-carousel`,children:l.map(m=>{const{id:d,reblog:b}=m,y=(b==null?void 0:b.id)||d,v=n?`/${n}/s/${y}`:`/s/${y}`;return e("li",{children:e(W,{class:"status-carousel-link timeline-item-alt",to:v,children:a?e(Ie,{statusID:d,instance:n,size:"s",contentTextWeight:!0,allowFilters:o}):e(Ie,{status:m,instance:n,size:"s",contentTextWeight:!0,allowFilters:o})})},d)})})},`timeline-${s}`);const c=l.length>3;return l.map((m,d)=>{const{id:b,_differentAuthor:y}=m,v=n?`/${n}/s/${b}`:`/s/${b}`,I=d>0&&d<l.length-1,S=m.sensitive&&!!m.spoilerText,$=!y&&S&&d>0||c&&I&&(r==="thread"||r==="conversation"&&!y&&!l[d-1]._differentAuthor&&!l[d+1]._differentAuthor);return e("li",{class:`timeline-item-container timeline-item-container-type-${r} timeline-item-container-${d===0?"start":d===l.length-1?"end":"middle"} ${y?"timeline-item-diff-author":""}`,children:e(W,{class:"status-link timeline-item",to:v,children:$?e(pi,{status:m,instance:n}):a?e(Ie,{statusID:b,instance:n,allowFilters:o}):e(Ie,{status:m,instance:n,allowFilters:o})})},`timeline-${b}`)})}return e("li",{children:e(W,{class:"status-link timeline-item",to:f,children:a?e(Ie,{statusID:s,instance:n,allowFilters:o}):e(Ie,{status:t,instance:n,allowFilters:o})})},`timeline-${s+u}`)}function fi({title:t,class:n,children:a}){const o=M(),{reachStart:s,reachEnd:i,init:l}=xt({scrollableRef:o,direction:"horizontal"});return N(()=>{l==null||l()},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var r,u;(u=o.current)==null||u.scrollBy({left:-Math.min(320,(r=o.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{type:"button",class:"small plain2",disabled:i,onClick:()=>{var r,u;(u=o.current)==null||u.scrollBy({left:Math.min(320,(r=o.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:o,children:a})]})}function pi({status:t,instance:n}){const a=ue(k),{id:o,visibility:s}=t,i=Cn(t),l=Ot(o,n);return e("article",{class:`status compact-thread ${s==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[a.statusThreadNumber[l]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),a.statusThreadNumber[l]?` ${a.statusThreadNumber[l]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:i,children:[i,t.sensitive&&t.spoilerText&&e(x,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function mi(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const tt=20,Gt=1983,fn=`${Gt}-01`,gi=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function bi(t){var o;const{masto:n}=z({instance:t}),a=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((o=a==null?void 0:a.statuses)!=null&&o.length)}const yi=it(bi);function wi(){const t=ue(k),{id:n,...a}=Je(),[o,s]=ze(),i=o.get("month"),l=!o.get("replies"),r=!!o.get("boosts"),u=o.get("tagged"),h=!!o.get("media"),{masto:f,instance:p,authenticated:g}=z({instance:a.instance}),c=M(),m=[i,l,r,u,h],[d,b]=T(),y=M(0);N(()=>{y.current=0},m);const v=ge(()=>p===z().instance,[p]),[I,S]=T(!1);N(()=>{v&&d!=null&&d.acct&&(async()=>{const K=await yi(p);S(K)})()},[p,v,d==null?void 0:d.acct]);async function $(K){var ce,fe,Le;const oe=/^\d{4}-[01]\d$/.test(i),O=((fe=(ce=i==null?void 0:i.split)==null?void 0:ce.call(i,"-"))==null?void 0:fe[0])>=Gt;if(oe&&O){if(!d)return{value:[],done:!0};const[ie,U]=i.split("-"),te=parseInt(U,10)-1,X=new Date(ie,te,0),be=`${X.getFullYear()}-${(X.getMonth()+1).toString().padStart(2,"0")}-${X.getDate().toString().padStart(2,"0")}`,le=new Date(ie,te+1,1),q=`${le.getFullYear()}-${(le.getMonth()+1).toString().padStart(2,"0")}-${le.getDate().toString().padStart(2,"0")}`;let J;K?(J=tt+1,y.current=0):(J=tt+y.current+1,y.current+=tt);const C=await f.v2.search.fetch({q:`from:${d.acct} after:${be} before:${q}`,type:"statuses",limit:J,offset:y.current});if((Le=C==null?void 0:C.statuses)!=null&&Le.length){const L=C.statuses.slice(0,tt);L.forEach(ne=>{ke(ne,p)});const Y=C.statuses.length<=tt;return{value:L,done:Y}}else return{value:[],done:!0}}const E=[];if(K){const{value:ie}=await f.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(ie!=null&&ie.length&&!u&&!h)if(ie.forEach(U=>{U._pinned=!0,ke(U,p)}),ie.length>=3){const U=ie.map(te=>te.id);E.push({id:U,items:ie,type:"pinned"})}else E.push(...ie)}(K||!c.current)&&(c.current=f.v1.accounts.$select(n).statuses.list({limit:tt,exclude_replies:l,exclude_reblogs:r,only_media:h,tagged:u}));const{value:G,done:ee}=await c.current.next();return G!=null&&G.length&&(E.push(...G),G.forEach(ie=>{ke(ie,p)})),{value:E,done:ee}}const[D,A]=T([]);Ce(`${d!=null&&d.displayName?d.displayName+" ":""}@${d!=null&&d.acct?d.acct:"Account posts"}`,"/:instance?/a/:id"),N(()=>{(async()=>{try{const K=await f.v1.accounts.$select(n).fetch();b(K)}catch{}try{const K=await f.v1.accounts.$select(n).featuredTags.list();A(K)}catch{}})()},[n]);const{displayName:P,acct:V,emojis:R}=d||{},H=M(),F=ge(()=>{const K=t.accounts[`${n}@${p}`],oe=!l||r||u||h||!!i;return e(x,{children:[e(Un,{instance:p,account:K||n,fetchAccount:()=>f.v1.accounts.$select(n).fetch(),authenticated:g,standalone:!0}),e("div",{class:"filter-bar",ref:H,children:[oe?e(W,{to:`/${p}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(W,{to:`/${p}/a/${n}${l?"?replies=1":""}`,onClick:()=>{l&&ae("Showing post with replies")},class:l?"":"is-active",children:"+ Replies"}),e(W,{to:`/${p}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||ae("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),e(W,{to:`/${p}/a/${n}${h?"":"?media=1"}`,onClick:()=>{h||ae("Showing posts with media")},class:h?"is-active":"",children:"Media"}),D.map(O=>e(W,{to:`/${p}/a/${n}${u===O.name?"":`?tagged=${encodeURIComponent(O.name)}`}`,onClick:()=>{u!==O.name&&ae(`Showing posts tagged with #${O.name}`)},class:u===O.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),O.name]})},O.id)),I&&(gi?e("label",{class:`filter-field ${i?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(d!=null&&d.acct),value:i||"",min:fn,max:new Date().toISOString().slice(0,7),onInput:O=>{const{value:E,validity:G}=O.currentTarget;G.valid&&s(E?{month:E}:{})}})]}):e(vi,{class:`filter-field ${i?"is-active":""}`,disabled:!(d!=null&&d.acct),value:i||"",min:fn,max:new Date().toISOString().slice(0,7),onInput:O=>{const{value:E,validity:G}=O;G.valid&&s(E?{month:E}:{})}}))]})]})},[n,p,g,D,I,...m]);N(()=>{var oe;const K=(oe=H.current)==null?void 0:oe.querySelector(".is-active");K&&H.current.scrollTo({behavior:"smooth",left:K.offsetLeft-(H.current.offsetWidth-K.offsetWidth)/2})},[D,I,...m]);const B=ge(()=>d!=null&&d.url?new URL(d.url).hostname:null,[d]),Ae=!!d&&!(p===B);return e(Fe,{title:`${d!=null&&d.acct?"@"+d.acct:"Posts"}`,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:e(kn,{text:P,emojis:R})}),e("div",{children:e("span",{children:["@",V]})})]}),id:"account-statuses",instance:p,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:$,useItemID:!0,boostsCarousel:t.settings.boostsCarousel,timelineStart:F,refresh:[l,r,u,h,i+(d==null?void 0:d.acct)].toString(),headerEnd:e(ht,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(Q,{disabled:!Ae,onClick:()=>{(async()=>{try{const{masto:K}=z({instance:B}),oe=await K.v1.accounts.lookup({acct:d.acct}),{id:O}=oe;location.hash=`/${B}/a/${O}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:B}),")"]})]})})},n)}function vi(t){const{class:n,disabled:a,value:o,min:s,max:i,onInput:l=()=>{}}=t,[r,u]=(o==null?void 0:o.split("-"))||[],h=M(),f=M(),p=(g,c)=>{const[m,d]=(s==null?void 0:s.split("-"))||[],[b,y]=(i==null?void 0:i.split("-"))||[];return!(c<m||c>b||c===m&&g<d||c===b&&g>y)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:h,disabled:a,value:u||"",onInput:g=>{const{value:c}=g.currentTarget,m=f.current.value;if(!p(c,m))return{value:"",validity:{valid:!1}};l({value:c?`${m}-${c}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(g,c)=>e("option",{value:(c+1).toString().padStart(2,"0"),children:new Date(0,c).toLocaleString("default",{month:"long"})},c))]})," ",e("input",{ref:f,type:"number",disabled:a,value:r||new Date().getFullYear(),min:(s==null?void 0:s.slice(0,4))||Gt,max:(i==null?void 0:i.slice(0,4))||new Date().getFullYear(),onInput:g=>{const{value:c,validity:m}=g.currentTarget,d=h.current.value;if(!m.valid||!p(d,c))return{value:"",validity:{valid:!1}};l({value:c?`${c}-${d}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const ki=20;function Hn(){Ce("Bookmarks","/b");const{masto:t,instance:n}=z(),a=M();async function o(s){return(s||!a.current)&&(a.current=t.v1.bookmarks.list({limit:ki})),await a.current.next()}return e(Fe,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:o})}const Si=20;function Vn(){Ce("Likes","/f");const{masto:t,instance:n}=z(),a=M();async function o(s){return(s||!a.current)&&(a.current=t.v1.favourites.list({limit:Si})),await a.current.next()}return e(Fe,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:o})}const Ii=200;function Ti(){const{masto:t,instance:n}=z();Ce("Followed Hashtags","/ft");const[a,o]=T("default"),[s,i]=T([]);return N(()=>{o("loading"),(async()=>{try{const l=t.v1.followedTags.list({limit:Ii}),r=[];do{const{value:u,done:h}=await l.next();if(h||(u==null?void 0:u.length)===0)break;r.push(...u)}while(!0);r.sort((u,h)=>u.name.localeCompare(h.name)),i(r),o("default")}catch{o("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ut,{}),e(W,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(l=>e("li",{children:e(W,{to:n?`/${n}/t/${l.name}`:`/t/${l.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:l.name})]})}))}):a==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):a==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function Ci(t,n,a){var u;const{filtered:o}=t;if(!(o!=null&&o.length)||a&&((u=t.account)==null?void 0:u.id)===a)return!0;const i=o.filter(h=>{const{filter:f}=h,p=f.context.includes(n);return p?f.expiresAt?new Date(f.expiresAt)>new Date:p:!1});if(!i.length)return!0;if(i.some(h=>h.filter.filterAction==="hide"))return!1;const r=i.some(h=>h.filter.filterAction==="warn");if(r){const h=i.map(f=>f.filter.title);t._filtered={titles:h,titlesStr:h.join(" • ")}}return r}function Ve(t,n){if(!(t!=null&&t.length))return[];if(!n)return t;const a=Z.session.get("currentAccount");return t.filter(o=>Ci(o,n,a))}const $i=20;function Wt({title:t,path:n,id:a,...o}){Ce(t||"Following",n||"/following");const{masto:s,streaming:i,instance:l}=z(),r=ue(k),u=M(),h=M();async function f(g){(g||!u.current)&&(u.current=s.v1.timelines.home.list({limit:$i}));const c=await u.current.next();let{value:m}=c;return m!=null&&m.length&&(g&&(h.current=m[0].id),m=Ve(m,"home"),m.forEach(d=>{ke(d,l)}),m=un(m,l),m.sort((d,b)=>{const y=new Date(d.createdAt);return new Date(b.createdAt)-y})),{...c,value:m}}async function p(){try{const g=await s.v1.timelines.home.list({limit:5,since_id:h.current}).next();let{value:c}=g;return!!(c!=null&&c.length&&(h.current=c[0].id,c=un(c,l),c=Ve(c,"home"),c.some(m=>!m.reblog)))}catch{return!1}}return N(()=>{let g;return(async()=>{if(i){g=i.user.subscribe();for await(const c of g){if(!g)break;if(c.event==="status.update"){const m=c.payload;ke(m,l)}else if(c.event==="delete"){const m=c.payload,d=$n(m,l);d&&(d._deleted=!0)}}}})(),()=>{var c;(c=g==null?void 0:g.unsubscribe)==null||c.call(g),g=null}},[i]),e(Fe,{title:t||"Following",id:a||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:l,fetchItems:f,checkForUpdates:p,useItemID:!0,boostsCarousel:r.settings.boostsCarousel,...o,allowFilters:!0})}const xi=20,Li=4,pn=Li+1;function jn({columnMode:t,...n}){let{hashtag:a,...o}=t?{}:Je();n.hashtag&&(a=n.hashtag);let s=a.trim().split(/[\s+]+/);s.sort(),a=s[0];const{masto:i,instance:l,authenticated:r}=z({instance:(n==null?void 0:n.instance)||o.instance}),{authenticated:u}=z(),h=s.map(S=>`#${S}`).join(" "),f=l?`${h} on ${l}`:h;Ce(f,"/:instance?/t/:hashtag");const p=M(),g=M(void 0);async function c(S){const $=await i.v1.timelines.tag.$select(a).list({limit:xi,any:s.slice(1),maxId:S?void 0:g.current}).next(),{value:D}=$;return D!=null&&D.length&&(S&&(p.current=D[0].id),D.forEach(A=>{ke(A,l)}),g.current=D[D.length-1].id),{...$,value:D}}async function m(){try{const S=await i.v1.timelines.tag.$select(a).list({limit:1,any:s.slice(1),since_id:p.current}).next(),{value:$}=S;return!!($!=null&&$.length)}catch{return!1}}const[d,b]=T("default"),[y,v]=T();N(()=>{(async()=>{try{const S=await i.v1.tags.$select(a).fetch();v(S)}catch{}})()},[a]);const I=s.length>=pn;return e(Fe,{title:f,titleComponent:!!l&&e("h1",{class:"header-account",children:[e("b",{children:h}),e("div",{children:l})]}),id:"hashtag",instance:l,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:c,checkForUpdates:m,useItemID:!0,headerEnd:e(ht,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!y&&s.length===1&&e(x,{children:[e(Ee,{subMenu:!0,confirm:y.following,confirmLabel:`Unfollow #${a}?`,disabled:d==="loading"||!r,onClick:()=>{b("loading"),y.following?i.v1.tags.$select(a).unfollow().then(()=>{v({...y,following:!1}),ae(`Unfollowed #${a}`)}).catch(S=>{alert(S)}).finally(()=>{b("default")}):i.v1.tags.$select(a).follow().then(()=>{v({...y,following:!0}),ae(`Followed #${a}`)}).catch(S=>{alert(S)}).finally(()=>{b("default")})},children:y.following?e(x,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(x,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(Me,{})]}),e(bs,{className:"menu-field",disabled:I,children:({ref:S})=>e("form",{onSubmit:$=>{var A,P;$.preventDefault();const D=(P=(A=$.target[0].value)==null?void 0:A.trim)==null?void 0:P.call(A);D&&!s.some(V=>V.toLowerCase()===D.toLowerCase())&&(s.push(D),s.sort(),location.hash=l?`/${l}/t/${s.join("+")}`:`/t/${s.join("+")}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:S,type:"text",placeholder:I?`Max ${pn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:I})]})}),e(ys,{takeOverflow:!0,children:s.map((S,$)=>e(Q,{disabled:s.length===1,onClick:D=>{s.splice($,1),s.sort(),location.hash=l?`/${l}/t/${s.join("+")}`:`/t/${s.join("+")}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),S]})]},S))}),e(Me,{}),e(Q,{disabled:!u,onClick:()=>{const S={type:"hashtag",hashtag:s.join(" "),instance:l};k.shortcuts.some(D=>D.type===S.type&&D.hashtag.split(/[\s+]+/).sort().join(" ")===S.hashtag.split(/[\s+]+/).sort().join(" ")&&(D.instance?D.instance===S.instance:!0))?alert("This shortcut already exists"):(k.shortcuts.push(S),ae("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(Q,{onClick:()=>{let S=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(S)){S&&alert("Invalid instance");return}S&&(S=S.toLowerCase().trim(),location.hash=`/${S}/t/${s.join("+")}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},l+h)}const Ai=20;function Gn(t){var d;const n=ue(k),{masto:a,instance:o}=z(),s=(t==null?void 0:t.id)||((d=Je())==null?void 0:d.id),i=M(),l=M();async function r(b){(b||!l.current)&&(l.current=a.v1.timelines.list.$select(s).list({limit:Ai}));const y=await l.current.next();let{value:v}=y;return v!=null&&v.length&&(b&&(i.current=v[0].id),v=Ve(v,"home"),v.forEach(I=>{ke(I,o)})),{...y,value:v}}async function u(){try{const b=await a.v1.timelines.list.$select(s).list({limit:1,since_id:i.current});let{value:y}=b;return y=Ve(y,"home"),!!(y!=null&&y.length)}catch{return!1}}const[h,f]=T({title:"List"});Ce(h.title,"/l/:id"),N(()=>{(async()=>{try{const b=await a.v1.lists.$select(s).fetch();f(b)}catch{}})()},[s]);const[p,g]=T(!1),[c,m]=T(!1);return e(x,{children:[e(Fe,{title:h.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:o,fetchItems:r,checkForUpdates:u,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:e(W,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(ht,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(Q,{onClick:()=>g({list:h}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(Q,{onClick:()=>m(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},s),p&&e(we,{class:"light",onClick:b=>{b.target===b.currentTarget&&g(!1)},children:e(Vt,{list:p==null?void 0:p.list,onClose:b=>{b.state==="success"&&b.list?f(b.list):b.state==="deleted"&&(location.hash="/l"),g(!1)}})}),c&&e(we,{class:"light",onClick:b=>{b.target===b.currentTarget&&m(!1)},children:e(Mi,{listID:s,onClose:()=>m(!1)})})]})}const Ri=40;function Mi({listID:t,onClose:n}){const{masto:a,instance:o}=z(),[s,i]=T([]),[l,r]=T("default"),[u,h]=T(!1),f=M();async function p(g){h(!1),r("loading"),(async()=>{try{(g||!f.current)&&(f.current=a.v1.lists.$select(t).accounts.list({limit:Ri}));const c=await f.current.next();let{done:m,value:d}=c;d!=null&&d.length?(i(g?d:s.concat(d)),h(!m)):h(!1),r("default")}catch{r("error")}})()}return N(()=>{p(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[s.map(g=>e("li",{children:[e(Pe,{account:g,instance:o}),e(Di,{account:g,listID:t})]},g.id)),u&&l==="default"&&e(ct,{as:"li",onChange:g=>g&&p(),children:e("button",{type:"button",class:"light block",onClick:p,children:"Show more…"})})]})})]})}function Di({account:t,listID:n}){const{masto:a}=z(),[o,s]=T("default"),[i,l]=T(!1);return e(Ee,{confirm:!i,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{i?(s("loading"),(async()=>{try{await a.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),s("default"),l(!1)}catch{s("error")}})()):(s("loading"),(async()=>{try{await a.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),s("default"),l(!0)}catch{s("error")}})())},children:e("button",{type:"button",class:`light ${i?"":"danger"}`,disabled:o==="loading",children:i?"Add":"Remove…"})})}const mn=20,Ei=new URLSearchParams;function Wn({columnMode:t,...n}){Ce("Mentions","/mentions");const{masto:a,instance:o}=z(),[s]=t?[Ei]:ze(),[i,l]=T(null),r=(n==null?void 0:n.type)||s.get("type")||i,u=M(),h=M();async function f(y){(y||!u.current)&&(u.current=a.v1.notifications.list({limit:mn,types:["mention"]}));const v=await u.current.next();let{value:I}=v;return I!=null&&I.length&&(y&&(h.current=I[0].id),I.forEach(({status:S})=>{ke(S,o)})),{...v,value:I==null?void 0:I.map(S=>S.status)}}const p=M(),g=M();async function c(y){(y||!p.current)&&(p.current=a.v1.conversations.list({limit:mn}));const v=await p.current.next();let{value:I}=v;return I=I==null?void 0:I.filter(S=>S.lastStatus),I!=null&&I.length&&(y&&(g.current=I[0].lastStatus.id),I.forEach(({lastStatus:S})=>{ke(S,o)})),{...v,value:I==null?void 0:I.map(S=>S.lastStatus)}}function m(...y){return r==="private"?c(...y):f(...y)}async function d(){if(r==="private")try{const y=await a.v1.conversations.list({limit:1,since_id:g.current}).next();let{value:v}=y;return v!=null&&v.length?(g.current=v[0].lastStatus.id,!0):!1}catch{return!1}else try{const y=await a.v1.notifications.list({limit:1,types:["mention"],since_id:h.current}).next();let{value:v}=y;return v!=null&&v.length?(h.current=v[0].id,!0):!1}catch{return!1}}const b=ge(()=>e("div",{class:"filter-bar centered",children:[e(W,{to:"/mentions",class:r?"":"is-active",onClick:y=>{t&&(y.preventDefault(),l(null))},children:"All"}),e(W,{to:"/mentions?type=private",class:r==="private"?"is-active":"",onClick:y=>{t&&(y.preventDefault(),l("private"))},children:"Private"})]}),[r]);return e(Fe,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:o,fetchItems:m,checkForUpdates:d,useItemID:!0,timelineStart:b,refresh:r})}function Kn(t){const n={},a=[];for(let i=0,l=0;i<t.length;i++){const r=t[i],{id:u,status:h,account:f,type:p,createdAt:g}=r,c=new Date(g).toLocaleDateString();let m=p;(p==="favourite"||p==="reblog")&&(m="favourite+reblog");const d=`${h==null?void 0:h.id}-${m}-${c}`,b=n[d];if(m==="follow_request")a[l++]=r;else if(b!=null&&b.account){const y=b._accounts.find(v=>v.id===f.id);y?(y._types.push(p),y._types.sort().reverse(),b.id+=`-${u}`):(f._types=[p],b._accounts.push(f),b.id+=`-${u}`)}else{f._types=[p];let y=n[d]={...r,type:m,_accounts:[f]};a[l++]=y}}const o={},s=[];for(let i=0,l=0;i<a.length;i++){const r=a[i],{id:u,account:h,_accounts:f,type:p,createdAt:g}=r,c=new Date(g).toLocaleDateString();if(p==="favourite+reblog"&&h&&f.length===1){const m=`${h==null?void 0:h.id}-${p}-${c}`,d=o[m];if(d)d._statuses.push(r.status),d.id+=`-${u}`;else{let b=o[m]={...r,type:p,_statuses:[r.status]};s[l++]=b}}else s[l++]=r}return s}const _i=30,Pi=new URLSearchParams;function Ni({columnMode:t}){Ce("Notifications","/notifications");const{masto:n,instance:a}=z(),o=ue(k),[s,i]=T("default"),[l]=t?[Pi]:ze(),r=l.get("id"),u=l.get("access_token"),[h,f]=T(!1),[p,g]=T(!1),c=M(),{nearReachEnd:m,scrollDirection:d,reachStart:b,nearReachStart:y}=xt({scrollableRef:c}),v=d==="end"&&!y,[I,S]=T([]),[$,D]=T([]),A=M();async function P(E){(E||!A.current)&&(A.current=n.v1.notifications.list({limit:_i,excludeTypes:["follow_request"]}));const G=await A.current.next(),ee=G.value;if(ee!=null&&ee.length){ee.forEach(fe=>{ke(fe.status,a,{skipThreading:!0})});const ce=Kn(ee);E?(k.notificationsLast=ee[0],k.notifications=ce,n.v1.markers.create({notifications:{lastReadId:ee[0].id}}).catch(()=>{})):k.notifications.push(...ce)}return k.notificationsShowNew=!1,k.notificationsLastFetchTime=Date.now(),G}async function V(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const R=()=>{i("loading"),(async()=>{try{const E=await V();S(E),i("default")}catch{i("error")}})()};async function H(){try{return await n.v1.announcements.list()}catch{return[]}}const F=E=>{i("loading"),(async()=>{try{const G=P(E),ee=V(),ce=H();if(E){const Le=await ce;Le.sort((U,te)=>{const X=new Date(U.updatedAt||U.createdAt);return new Date(te.updatedAt||te.createdAt)-X}),D(Le);const ie=await ee;S(ie)}const{done:fe}=await G;f(!fe),i("default")}catch{i("error")}})()};N(()=>{F(!0)},[]),N(()=>{b&&F(!0)},[b]);const B=He(()=>{var E;o.settings.autoRefresh&&((E=c.current)==null?void 0:E.scrollTop)===0&&window.__IDLE__&&!Ui()&&o.notificationsShowNew&&s!=="loading"&&F(!0)},[o.notificationsShowNew,o.settings.autoRefresh,s]);N(B,[o.notificationsShowNew]);const se=new Date,Ae=new Date(se-24*60*60*1e3);let K=new Date;const oe=!o.notifications.some(E=>new Date(E.createdAt).toDateString()===se.toDateString()),O=M();return N(()=>{r&&(k.routeNotification={id:r,accessToken:atob(u)})},[r,u]),e("div",{id:"notifications-page",class:"deck-container",ref:c,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${p?"only-mentions":""}`,children:[e("header",{hidden:v,onClick:E=>{var G;E.target.closest("a, button")||(G=c.current)==null||G.scrollTo({top:0,behavior:"smooth"})},class:s==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ut,{}),e(W,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),o.notificationsShowNew&&s!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var E;F(!0),(E=c.current)==null||E.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),$.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",$.length>1?"s":""]})," ",e("small",{class:"insignificant",children:a})]}),$.length>1&&e("span",{class:"announcements-nav-buttons",children:$.map((E,G)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var ee;(ee=O.current)==null||ee.children[G].scrollIntoView({behavior:"smooth",block:"nearest"})},children:G+1}))})]}),e("ul",{class:`announcements-list-${$.length>1?"multiple":"single"}`,ref:O,children:$.map(E=>e("li",{children:e(zi,{announcement:E})}))})]})})}),I.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),I.length>5?e("details",{children:[e("summary",{children:[I.length," follow requests"]}),e("ul",{children:I.map(E=>e("li",{children:[e(Pe,{account:E}),e(Nt,{accountID:E.id,onChange:()=>{}})]},E.id))})]}):e("ul",{children:I.map(E=>e("li",{children:[e(Pe,{account:E}),e(Nt,{accountID:E.id,onChange:()=>{}})]},E.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:p,onChange:E=>{g(E.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),oe&&!!o.notifications.length&&e("p",{class:"ui-state insignificant",children:s==="default"?"You're all caught up.":e(x,{children:"…"})}),o.notifications.length?e(x,{children:o.notifications.filter(E=>E.type!=="follow_request").map(E=>{if(p&&E.type!=="mention")return null;const G=new Date(E.createdAt),ee=G.toDateString()!==K.toDateString();ee&&(K=G);const ce=G.toDateString()===Ae.toDateString()?"Yesterday":qe(K,{hideTime:!0});return e(x,{children:[ee&&e("h2",{class:"timeline-header",children:ce}),e(jt,{instance:a,notification:E},E.id)]},E.id)})}):e(x,{children:[s==="loading"&&e(x,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((E,G)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),s==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>F(!0),children:"Try again"})]})]}),h&&e(ct,{onChange:E=>{E&&F()},children:e("button",{type:"button",class:"plain block",disabled:s==="loading",onClick:()=>F(),style:{marginBlockEnd:"6em"},children:s==="loading"?e(ve,{abrupt:!0}):e(x,{children:"Show more…"})})})]})})}function Ui(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function zi({announcement:t}){const{instance:n}=z(),{contact:a}=as(),o=a==null?void 0:a.account,{id:s,content:i,startsAt:l,endsAt:r,published:u,allDay:h,publishedAt:f,updatedAt:p,read:g,mentions:c,statuses:m,tags:d,emojis:b,reactions:y}=t,v=new Date(f),I=qe(v),S=new Date(p),$=qe(S);return e("div",{class:"announcement-block",children:[e(Pe,{account:o}),e("div",{class:"announcement-content",onClick:vn({mentions:c,instance:n}),dangerouslySetInnerHTML:{__html:Et(i,{emojis:b})}}),e("p",{class:"insignificant",children:[e("time",{datetime:v.toISOString(),children:qe(v)}),p&&$!==I&&e(x,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:S.toISOString(),children:qe(S)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:y.map(D=>{const{name:A,count:P,me:V,staticUrl:R,url:H}=D;return e("button",{type:"button",class:`plain4 small ${V?"reacted":""}`,children:[H||R?e("img",{src:H||R,alt:A,width:"16",height:"16"}):e("span",{children:A})," ",e("span",{class:"count",children:De(P)})]})})})]})}const Yn=Ue(Ni),Fi=20;function Ut({local:t,columnMode:n,...a}){const o=ue(k),s=!!t,i=n?{}:Je(),{masto:l,instance:r}=z({instance:(a==null?void 0:a.instance)||i.instance}),u=`${s?"Local":"Federated"} timeline (${r})`;Ce(u,s?"/:instance?/p/l":"/:instance?/p");const h=M(),f=M();async function p(c){(c||!f.current)&&(f.current=l.v1.timelines.public.list({limit:Fi,local:s}));const m=await f.current.next();let{value:d}=m;return d!=null&&d.length&&(c&&(h.current=d[0].id),d=Ve(d,"public"),d.forEach(b=>{ke(b,r)})),{...m,value:d}}async function g(){try{const c=await l.v1.timelines.public.list({limit:1,local:s,since_id:h.current}).next();let{value:m}=c;return m=Ve(m,"public"),!!(m!=null&&m.length)}catch{return!1}}return e(Fe,{title:u,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:s?"Local timeline":"Federated timeline"}),e("div",{children:r})]}),id:"public",instance:r,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:p,checkForUpdates:g,useItemID:!0,headerStart:e(x,{}),boostsCarousel:o.settings.boostsCarousel,allowFilters:!0,headerEnd:e(ht,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(Q,{href:s?`/#/${r}/p`:`/#/${r}/p/l`,children:s?e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(Me,{}),e(Q,{onClick:()=>{let c=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(c)){c&&alert("Invalid instance");return}c&&(c=c.toLowerCase().trim(),location.hash=s?`/${c}/p/l`:`/${c}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},r+s)}const Bi=20,Oi=it(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Jn({columnMode:t,...n}){const a=ue(k),o=t?{}:Je(),{masto:s,instance:i}=z({instance:(n==null?void 0:n.instance)||o.instance}),l=`Trending (${i})`;Ce(l,"/:instance?/trending");const r=M(),[u,h]=T([]),[f,p]=T([]),g=M();async function c(b){var I;if(b||!g.current){g.current=s.v1.trends.statuses.list({limit:Bi});try{const S=s.v1.trends.tags.list(),{value:$}=await S.next();$!=null&&$.length&&h($)}catch{}try{const{value:S}=await Oi(s),$=(I=S==null?void 0:S.filter)==null?void 0:I.call(S,D=>D.type==="link");$!=null&&$.length&&p($)}catch{}}const y=await g.current.next();let{value:v}=y;return v!=null&&v.length&&(b&&(r.current=v[0].id),v=Ve(v,"public"),v.forEach(S=>{ke(S,i)})),{...y,value:v}}async function m(){try{const b=await s.v1.trends.statuses.list({limit:1}).next();let{value:y}=b;return y=Ve(y,"public"),y!=null&&y.length&&y[0].id!==r.current?(r.current=y[0].id,!0):!1}catch{return!1}}const d=ge(()=>e(x,{children:[!!u.length&&e("div",{class:"filter-bar expandable",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),u.map((b,y)=>{const{name:v,history:I}=b,S=I.reduce(($,D)=>$+ +D.uses,0);return e(W,{to:`/${i}/t/${v}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),v]}),e("span",{class:"filter-count",children:S.toLocaleString()})]},v)})]}),!!f.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),f.map(b=>{const{authorName:y,authorUrl:v,blurhash:I,description:S,height:$,image:D,imageDescription:A,language:P,providerName:V,providerUrl:R,publishedAt:H,title:F,url:B,width:se}=b,Ae=new URL(B).hostname.replace(/^www\./,"").replace(/\/$/,"");let K;if(I){const oe=Ln(I),O=zn(oe);K=Fn([.6,O[1],O[2]])}return e("a",{href:B,target:"_blank",rel:"noopener noreferrer",style:K?{"--accent-color":`rgb(${K.join(",")})`,"--accent-alpha-color":`rgba(${K.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:D,alt:A,width:se,height:$,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:Ae})," ",!!H&&e(x,{children:"· "}),!!H&&e(x,{children:e(Tt,{datetime:H,format:"micro"})})]}),!!F&&e("h1",{class:"title",lang:P,dir:"auto",children:F})]}),!!S&&e("p",{class:"description",lang:P,dir:"auto",children:S})]})]})},B)})]})]}),[u,f]);return e(Fe,{title:l,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:"Trending"}),e("div",{children:i})]}),id:"trending",instance:i,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:c,checkForUpdates:m,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(x,{}),boostsCarousel:a.settings.boostsCarousel,allowFilters:!0,timelineStart:d,headerEnd:e(ht,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(Q,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})})},i)}function qi(){Ce("Home","/");const t=ue(k),{shortcuts:n}=t,a=n.map(o=>{if(!o)return null;const{type:s,...i}=o,l={following:Wt,notifications:Yn,list:Gn,public:Ut,bookmarks:Hn,favourites:Vn,hashtag:jn,mentions:Wn,trending:Jn}[s];return l?e(l,{...i,columnMode:!0},s+JSON.stringify(i)):null});return Te(["1","2","3","4","5","6","7","8","9"],(o,s)=>{try{const i=parseInt(s.keys[0],10)-1;document.querySelectorAll("#columns > *")[i].focus()}catch{}}),e("div",{id:"columns",children:a})}function Hi(){var n;const t=ue(k);return N(()=>{(async()=>{const a=await rt.drafts.keys();if(a.length){const o=In();a.filter(i=>i.startsWith(o)).length&&(k.showDrafts=!0)}})()},[]),e(x,{children:(t.settings.shortcutsColumnsMode||t.settings.shortcutsViewMode==="multi-column")&&((n=t.shortcuts)!=null&&n.length)?e(qi,{}):e(Wt,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(Vi,{})})})}function Vi(){const t=ue(k),n=M(),[a,o]=T(void 0);return e(x,{children:[e(W,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${a||""}`,onClick:s=>{s.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(s.preventDefault(),o(i=>i?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(Wi,{state:a,anchorRef:n,onClose:()=>o(void 0)})]})}const ji=30,Gi=5;function Wi({anchorRef:t,state:n,onClose:a}){const{masto:o,instance:s}=z(),i=ue(k),[l,r]=T("default"),u=o.v1.notifications.list({limit:ji});async function h(){const m=await u.next(),d=m.value;if(d!=null&&d.length){d.forEach(y=>{ke(y.status,s,{skipThreading:!0})});const b=Kn(d);k.notificationsLast=d[0],k.notifications=b,o.v1.markers.create({notifications:{lastReadId:d[0].id}}).catch(()=>{})}return k.notificationsShowNew=!1,k.notificationsLastFetchTime=Date.now(),m}const[f,p]=T(!1);function g(){return o.v1.followRequests.list({limit:1})}function c(){r("loading"),(async()=>{try{await h();const m=await g();p(!!(m!=null&&m.length)),r("default")}catch{r("error")}})()}return N(()=>{n==="open"&&c()},[n]),e(Mn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:a,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:i.notifications.length?e(x,{children:i.notifications.slice(0,Gi).map(m=>e(jt,{instance:s,notification:m},m.id))}):l==="loading"?e("div",{class:"ui-state",children:e(ve,{abrupt:!0})}):l==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:c,children:"Try again"})})]})}),e("footer",{children:[e(W,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(W,{to:"/notifications",class:"button plain2",children:[f?e(x,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const Ki=Ue(Hi),Yi=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,Ji=/\/notes\/([^\/]+)\/?$/i;function Xn(t){const{hostname:n,pathname:a}=new URL(t),[,o,s,i]=a.match(Yi)||[];if(i)return`/${n}/s/${i}`;const[,l]=a.match(Ji)||[];if(l)return`/${n}/s/${l}`}function Xi(){const n=ot().pathname.replace(/^\//,""),a=Xn(n);return Ne(()=>{a&&setTimeout(()=>{window.location.hash=a+"?view=full"},300)},[a]),e("div",{class:"ui-state",tabIndex:"-1",children:[a?e(x,{children:[e("h2",{children:"Redirecting…"}),e("p",{children:e("a",{href:`#${a}?view=full`,children:a})})]}):e(x,{children:[e("h2",{children:"Unable to process URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(W,{to:"/",children:"Go home"})})]})}function Zi(){const{masto:t}=z();Ce("Lists","/l");const[n,a]=T("default"),[o,s]=Ct(h=>h+1,0),[i,l]=T([]);N(()=>{a("loading"),(async()=>{try{const h=await t.v1.lists.list();h.sort((f,p)=>f.title.localeCompare(p.title)),l(h),a("default")}catch{a("error")}})()},[o]);const[r,u]=T(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ut,{}),e(W,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>u(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:i.length>0?e("ul",{class:"link-list",children:i.map(h=>e("li",{children:e(W,{to:`/l/${h.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:h.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(ve,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),r&&e(we,{class:"light",onClick:h=>{h.target===h.currentTarget&&u(!1)},children:e(Vt,{list:r==null?void 0:r.list,onClose:h=>{h.state==="success"&&s(),u(!1)}})})]})}const Qi=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:eo,VITE_WEBSITE:to}={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Kt="read write follow push";async function no({instanceURL:t}){const n=new URLSearchParams({client_name:eo,redirect_uris:location.origin+location.pathname,scopes:Kt,website:to});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function so({instanceURL:t,client_id:n}){const a=new URLSearchParams({client_id:n,scope:Kt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${a.toString()}`}async function io({instanceURL:t,client_id:n,client_secret:a,code:o}){const s=new URLSearchParams({client_id:n,client_secret:a,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:o,scope:Kt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:s.toString()})).json()}function oo(){Ce("Log in");const t=M(),n=Z.local.get("instanceURL"),[a,o]=T("default"),[s]=ze(),i=s.get("instance"),[l,r]=T(i||(n==null?void 0:n.toLowerCase())||""),[u,h]=T([]);N(()=>{(async()=>{try{const m=await(await fetch(Qi)).json();h(m)}catch{}})()},[]);const f=c=>{Z.local.set("instanceURL",c),(async()=>{o("loading");try{const{client_id:m,client_secret:d,vapid_key:b}=await no({instanceURL:c});m&&d?(Z.session.set("clientID",m),Z.session.set("clientSecret",d),Z.session.set("vapidKey",b),location.href=await so({instanceURL:c,client_id:m})):alert("Failed to register application"),o("default")}catch{o("error")}})()},p=c=>{c.preventDefault();const{elements:m}=c.target;let d=m.instanceURL.value.toLowerCase();d=d.replace(/^https?:\/\//,"").replace(/\/+$/,""),d=d.replace(/^@?[^@]+@/,""),/\./.test(d)||(d=u.find(b=>b.includes(d))),f(d)},g=l?u.filter(c=>c.includes(l)).sort((c,m)=>{const d=c.toLowerCase().startsWith(l.toLowerCase()),b=m.toLowerCase().startsWith(l.toLowerCase());return d&&!b?-1:!d&&b?1:0}).slice(0,10):[];return e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:p,children:[e("h1",{children:"Log in"}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:l,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:a==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:c=>{r(c.target.value)}}),(g==null?void 0:g.length)>0?e("ul",{id:"instances-suggestions",children:g.map(c=>e("li",{children:e("button",{type:"button",class:"plain4",onClick:()=>{f(c)},children:c})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),a==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{class:"large",disabled:a==="loading",children:"Log in"})," "]}),e(ve,{hidden:a!=="loading"}),e("hr",{}),e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(W,{to:"/",children:"Go home"})})]})})}const mt=5,Dt=40;function co(t){const n=Je(),{masto:a,instance:o,authenticated:s}=z({instance:n.instance}),[i,l]=T("default"),[r]=ze(),u=M(),h=(t==null?void 0:t.query)||r.get("q"),f=(t==null?void 0:t.type)||r.get("type");Ce(h?`Search: ${h}${f?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[f]})`:""}`:"Search","/search");const[p,g]=T(!1),c=M(0);N(()=>{c.current=0},[h,f]);const m=M();Ne(()=>{var A,P;(P=(A=m.current)==null?void 0:A.scrollTo)==null||P.call(A,0,0)},[h,f]);const[d,b]=T([]),[y,v]=T([]),[I,S]=T([]);N(()=>{b([]),v([]),S([])},[h]);const $={statuses:b,accounts:v,hashtags:S};function D(A){!A&&!s||(l("loading"),A&&!f&&(b(d.slice(0,mt)),v(y.slice(0,mt)),S(I.slice(0,mt))),(async()=>{var V,R;const P={q:h,resolve:s,limit:mt};f&&(P.limit=Dt,P.type=f,s&&(P.offset=c.current));try{const H=await a.v2.search.fetch(P);if(f)if(A){$[f](H[f]);const F=(V=H[f])==null?void 0:V.length;c.current=Dt,g(!!F)}else{$[f](B=>[...B,...H[f]]);const F=(R=H[f])==null?void 0:R.length;c.current=c.current+Dt,g(!!F)}else b(H.statuses),v(H.accounts),S(H.hashtags),c.current=0,g(!1);l("default")}catch{l("error")}})())}return N(()=>{var A,P,V,R;h?((P=(A=u.current)==null?void 0:A.setValue)==null||P.call(A,h),D(!0)):(R=(V=u.current)==null?void 0:V.focus)==null||R.call(V)},[h,f,o]),Te("/",A=>{var P,V;(V=(P=u.current)==null?void 0:P.focus)==null||V.call(P)},{preventDefault:!0}),e("div",{id:"search-page",class:"deck-container",ref:m,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:i==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(ut,{})}),e(qn,{ref:u}),e("div",{class:"header-side",children:" "})]})}),e("main",{children:[!!h&&e("div",{class:`filter-bar ${i==="loading"?"loading":""}`,children:[!!f&&e(W,{to:`/search${h?`?q=${encodeURIComponent(h)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(h)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(h)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(h)}&type=statuses`}].sort((A,P)=>A.type===f?-1:P.type===f?1:0).map(A=>e(W,{to:A.to,children:A.label},A.type))]}),h?e(x,{children:[(!f||f==="accounts")&&e(x,{children:[f!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),y.length>0?e(x,{children:[e("ul",{class:"timeline flat accounts-list",children:y.map(A=>e("li",{children:e(Pe,{account:A,instance:o,showStats:!0})},A.id))}),f!=="accounts"&&e("div",{class:"ui-state",children:e(W,{class:"plain button",to:`/search?q=${h}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!f&&(i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!f||f==="hashtags")&&e(x,{children:[f!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),I.length>0?e(x,{children:[e("ul",{class:"link-list hashtag-list",children:I.map(A=>e("li",{children:e(W,{to:o?`/${o}/t/${A.name}`:`/t/${A.name}`,children:[e(w,{icon:"hashtag"}),e("span",{children:A.name})]})},A.name))}),f!=="hashtags"&&e("div",{class:"ui-state",children:e(W,{class:"plain button",to:`/search?q=${h}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!f&&(i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!f||f==="statuses")&&e(x,{children:[f!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),d.length>0?e(x,{children:[e("ul",{class:"timeline",children:d.map(A=>e("li",{children:e(W,{class:"status-link",to:o?`/${o}/s/${A.id}`:`/s/${A.id}`,children:e(Ie,{status:A})})},A.id))}),f!=="statuses"&&e("div",{class:"ui-state",children:e(W,{class:"plain button",to:`/search?q=${h}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!f&&(i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!f&&(i==="default"?p?e(ct,{onChange:A=>{A&&D()},children:e("button",{type:"button",class:"plain block",onClick:()=>D(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):i==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}))]}):i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const gt=40,ao=10,ro=5;let zt={},yt={},wt={};function Ft(t){delete yt[t],delete wt[t]}const at={block:"nearest",inline:"center",behavior:"smooth"};function lo(t){const{id:n}=t,{masto:a,instance:o}=z({instance:t.instance}),s=ue(k),[i,l]=ze(),r=i.get("media"),u=i.get("media-only"),h=parseInt(r||u,10);let f=h>0;const p=i.get("mediaStatusID"),g=$n(p,o);p&&!g&&(f=!1);const c=f&&!!u,m=Ot(n,o),[d,b]=T(k.statuses[m]);N(()=>{k.statuses[m]&&b(k.statuses[m])},[m]);const y=ge(()=>{const{prevLocation:S}=k,$=((S==null?void 0:S.pathname)||"")+((S==null?void 0:S.search)||""),D=dt("/:instance/s/:id",$)||dt("/s/:id",$);return!$||D?"/":$},[]);N(()=>{!d&&f&&(async()=>{try{const S=await a.v1.statuses.$select(n).fetch();ke(S,o),b(S)}catch{alert("Unable to load post."),location.hash=y}})()},[f]);const v=p?g==null?void 0:g.mediaAttachments:d==null?void 0:d.mediaAttachments,I=He(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&s.prevLocation?history.back():c?location.hash=y:(i.delete("media"),i.delete("mediaStatusID"),l(i))},[c,y,s.prevLocation]);return e("div",{class:"deck-backdrop",children:[f?v!=null&&v.length?e(Bn,{mediaAttachments:v,statusID:p||n,instance:o,lang:d==null?void 0:d.language,index:h-1,onClose:I}):e("div",{class:"media-modal-container loading",children:e(ve,{abrupt:!0})}):e(W,{to:y}),!c&&e(ho,{id:n,instance:t.instance,closeLink:y})]})}function ho({id:t,closeLink:n="/",instance:a}){var J;const[o,s]=ze(),i=o.get("media"),l=o.get("mediaStatusID"),r=parseInt(i,10)>0,u=M(!k.prevLocation&&history.length===1),[h,f]=T(o.get("view")||u.current?"full":null),p=!!parseInt(o.get("translate")),{masto:g,instance:c}=z({instance:a}),{masto:m,instance:d,authenticated:b}=z(),y=c===d,v=ue(k),[I,S]=T([]),[$,D]=T("default"),A=M(),P=Ot(t,c),V=M(0),R=M();N(()=>{var C;(C=R.current)==null||C.focus()},[]),N(()=>{var L;const C=Dn(()=>{if(!R.current)return;const{scrollTop:Y}=R.current;$!=="loading"&&(wt[t]=Y)},50);return(L=R.current)==null||L.addEventListener("scroll",C,{passive:!0}),C(),()=>{var Y;C.cancel(),(Y=R.current)==null||Y.removeEventListener("scroll",C)}},[t,$!=="loading"]);const H=M(),F=({reloadHero:C}={})=>{D("loading");let L;const Y=yt[t];if(Y){const ne=Y.filter(he=>k.statuses[P]);S(ne)}else S([{id:t}]);return(async()=>{var _e,Xe;const ne=()=>nn(()=>g.v1.statuses.$select(t).fetch(),{retries:4}),he=nn(()=>g.v1.statuses.$select(t).context.fetch(),{retries:8}),Re=!!v.statuses[P];let Se=v.statuses[P];if(!(Re&&!C))try{Se=await ne(),ke(Se,c),await new Promise(_=>{setTimeout(_,100)})}catch{D("error");return}try{let _=function(j){return j==null?void 0:j.map(me=>({id:me.id,account:me.account,repliesCount:me.repliesCount,content:me.content,weight:lt(me),replies:_(me.__replies)}))};const de=await he,{ancestors:pe,descendants:re}=de;V.current=(re==null?void 0:re.length)||0;const Be=new Set;pe.forEach(j=>{ke(j,c,{skipThreading:!0}),j.inReplyToId&&!pe.find(me=>me.id===j.inReplyToId)&&Be.add(j.inReplyToId)});const je=pe.every(j=>j.account.id===Se.account.id),$e=[];re.forEach(j=>{if(ke(j,c,{skipThreading:!0}),j.inReplyToId&&!re.find(me=>me.id===j.inReplyToId)&&j.inReplyToId!==Se.id&&Be.add(j.inReplyToId),j.inReplyToAccountId===j.account.id)$e.push(j);else if(j.inReplyToId===Se.id)$e.push(j);else if(!j.inReplyToAccountId&&$e.find(me=>me.id===j.inReplyToId)&&j.account.id===Se.account.id)$e.push(j);else{const me=re.find(Ze=>Ze.id===j.inReplyToId);me&&(me.__replies||(me.__replies=[]),me.__replies.push(j))}}),Be.size;const Oe=[...pe.map(j=>({id:j.id,ancestor:!0,isThread:je,accountID:j.account.id,account:j.account,repliesCount:j.repliesCount,weight:lt(j)})),{id:t,accountID:Se.account.id,weight:lt(Se)},...$e.map(j=>({id:j.id,account:j.account,accountID:j.account.id,descendant:!0,thread:j.account.id===Se.account.id,weight:lt(j),replies:_(j.__replies)}))];D("default"),H.current={offsetTop:(_e=A.current)==null?void 0:_e.offsetTop,scrollTop:(Xe=R.current)==null?void 0:Xe.scrollTop};const Ge=Oe.findIndex(j=>j.id===t);Ge>=O&&E(Ge+1),S(Oe),yt[t]=Oe,rs(Se,c)}catch{D("error")}})(),()=>{clearTimeout(L)}};N(F,[t,g]),N(()=>{var L,Y;if(!I.length)return;const C=wt[t];if(C)R.current.scrollTop=C;else if(H.current){const ne={offsetTop:(L=A.current)==null?void 0:L.offsetTop,scrollTop:(Y=R.current)==null?void 0:Y.scrollTop},he=ne.offsetTop-H.current.offsetTop+ne.scrollTop;R.current.scrollTop=he}else I.length===1&&(R.current.scrollTop=0);H.current=null},[I]),N(()=>{v.reloadStatusPage<=0||(async()=>{try{const{instanceURL:C}=st(),L=`https://${C}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(L,{ignoreVary:!0}),F({reloadHero:!0})}catch{}})()},[v.reloadStatusPage]),N(()=>()=>{wt={},k.reloadStatusPage=0,yt={},zt={},Bt.clear()},[]);const B=v.statuses[P]||v.statuses[t],se=ge(()=>{if(!B)return"";const{account:C}=B,L=document.createElement("div");return L.innerHTML=C.displayName,L.innerText.trim()},[B]),Ae=ge(()=>{if(!B)return"";let C=Cn(B);return C.length>64&&(C=C.slice(0,64)+"…"),C},[B]);Ce(se&&Ae?`${se}: "${Ae}"`:"Status","/:instance?/s/:id");const K=ge(()=>{if(!B)return;const{url:C}=B;if(C)return new URL(C).hostname},[B]),oe=ge(()=>{if(K)return K===c},[K,c]),[O,E]=T(gt),G=ge(()=>I.length-O,[I.length,O]),ee=I.some(C=>C.descendant),ce=I.filter(C=>C.ancestor),[fe,Le]=T(!0),ie=kt(Le,100),U=ge(()=>{if(!A.current||fe)return null;const{top:C}=A.current.getBoundingClientRect();return C>0?"down":"up"},[fe]);Te("esc",()=>{location.hash=n},{enabled:!r,ignoreEventWhen:C=>!!document.querySelector("#modal-container > *")}),Te("backspace",()=>{location.hash=n}),Te("j",()=>{const C=document.activeElement.closest(".status-link, .status-focus"),L=C==null?void 0:C.getBoundingClientRect(),Y=Array.from(R.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(C&&L.top<R.current.clientHeight&&L.bottom>0){const ne=Y.indexOf(C);let he=Y[ne+1];he&&(he.focus(),he.scrollIntoView(at))}else{const ne=Y.find(he=>{const Re=he.getBoundingClientRect();return Re.top>=44&&Re.left>=0});ne&&(ne.focus(),ne.scrollIntoView(at))}}),Te("k",()=>{const C=document.activeElement.closest(".status-link, .status-focus"),L=C==null?void 0:C.getBoundingClientRect(),Y=Array.from(R.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(C&&L.top<R.current.clientHeight&&L.bottom>0){const ne=Y.indexOf(C);let he=Y[ne-1];he&&(he.focus(),he.scrollIntoView(at))}else{const ne=Y.find(he=>{const Re=he.getBoundingClientRect();return Re.top>=44&&Re.left>=0});ne&&(ne.focus(),ne.scrollIntoView(at))}}),Te("x",()=>{const C=document.activeElement.closest(".status-link, .status-focus");if(C){const L=C.nextElementSibling;L&&L.tagName.toLowerCase()==="details"&&(L.open=!L.open)}});const{nearReachStart:te}=xt({scrollableRef:R,distanceFromStartPx:16}),X=M(r?"media+status":"status"),be=He((C,L,Y,ne)=>{C.preventDefault(),C.stopPropagation(),s({media:L+1,mediaStatusID:ne.id})},[t]),le=He((C,L)=>{Ft(L.id)},[]);N(()=>{let C;return l&&r&&(C=setTimeout(()=>{var Y;const L=(Y=R.current)==null?void 0:Y.querySelector(`.status-link[href*="/${l}"]`);L&&L.scrollIntoView(at)},400)),()=>{clearTimeout(C)}},[l,r]);const q=He(C=>{const{id:L,ancestor:Y,isThread:ne,descendant:he,thread:Re,replies:Se,repliesCount:_e,weight:Xe}=C,_=L===t;return e("li",{ref:_?A:null,class:`${Y?"ancestor":""} ${he?"descendant":""} ${Re?"thread":""} ${_?"hero":""}`,children:[_?e(x,{children:[e(ct,{threshold:.1,onChange:ie,class:"status-focus",tabIndex:0,children:e(Ie,{statusID:L,instance:c,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:p})}),$!=="loading"&&!b?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(W,{to:"/login",class:"button",children:"Log in"})]}):!y&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:c}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:$==="loading",onClick:()=>{D("loading"),(async()=>{try{const de=await m.v2.search.fetch({q:B.url,type:"statuses",resolve:!0,limit:1});if(de.statuses.length){const pe=de.statuses[0];location.hash=d?`/${d}/s/${pe.id}`:`/s/${pe.id}`}else throw new Error("No results")}catch(de){D("default"),alert("Error: "+de)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(W,{class:"status-link",to:c?`/${c}/s/${L}`:`/s/${L}`,onClick:()=>{Ft(L)},children:[e(Ie,{statusID:L,instance:c,withinContext:!0,size:Re||Y?"m":"s",enableTranslate:!0,onMediaClick:be,onStatusLinkClick:le}),Y&&ne&&_e>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:_e,children:De(_e)})]})," "]}),he&&(Se==null?void 0:Se.length)>0&&e(Zn,{instance:c,replies:Se,hasParentThread:Re,level:1,accWeight:Xe,openAll:V.current<ao}),$==="loading"&&_&&!!(B!=null&&B.repliesCount)&&!ee&&e("div",{class:"status-loading",children:e(ve,{})}),$==="error"&&_&&!!(B!=null&&B.repliesCount)&&!ee&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]},L)},[t,c,$,b,y,p,be,le,ee]);return e("div",{tabIndex:"-1",ref:R,class:`status-deck deck contained ${I.length>1?"padded-bottom":""} ${X.current==="status"&&!u.current?"slide-in":""} ${h?`deck-view-${h}`:""}`,onAnimationEnd:C=>{X.current==="status"&&(X.current=null)},children:[e("header",{class:`${fe?"inview":""} ${$==="loading"?"loading":""}`,onDblClick:C=>{k.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[!!/\/s\//i.test((J=v.prevLocation)==null?void 0:J.pathname)&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!fe&&B&&$!=="loading"?e(x,{children:[e("span",{class:"hero-heading",children:[e(vt,{account:B.account,instance:c,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(Tt,{datetime:B.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:C=>{C.preventDefault(),C.stopPropagation(),A.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:U==="down"?"arrow-down":"arrow-up"})})]}):e(x,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:C=>{C.preventDefault(),C.stopPropagation(),R.current.scrollTo({top:0,behavior:"smooth"})},hidden:!ce.length||te,title:`${ce.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),ce.filter((C,L,Y)=>Y.findIndex(ne=>ne.accountID===C.accountID)===L).slice(0,3).map(C=>e(Ke,{url:C.account.avatar,alt:C.account.displayName},C.account.id)),ce.length>3&&e(x,{children:[" ",e("span",{class:"insignificant",children:De(ce.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:h==="full"?"":"none"},onClick:()=>{f(null),o.delete("media"),o.delete("media-only"),o.delete("view"),s(o)},title:"Switch to Side Peek view",children:e(w,{icon:"layout4",size:"l"})}),e(Ye,{align:"end",portal:{target:R.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(Q,{disabled:$==="loading",onClick:()=>{k.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(Q,{className:"menu-switch-view",onClick:()=>{f(h==="full"?null:"full"),o.delete("media"),o.delete("media-only"),h==="full"?o.delete("view"):o.set("view","full"),s(o)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[h||""]}),e("span",{children:["Switch to ",h==="full"?"Side Peek":"Full"," view"]})]}),e(Q,{onClick:()=>{Array.from(R.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(L=>{L.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(Me,{}),e(ws,{className:"plain",children:"Experimental"}),e(Q,{disabled:oe,onClick:()=>{const C=Xn(B.url);C?location.hash=C:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance (",e("b",{children:K}),")"]})]})]}),e(W,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),I.length&&B?e("ul",{class:`timeline flat contextual grow ${$==="loading"?"loading":""}`,children:[I.slice(0,O).map(q),G>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:$==="loading",onClick:()=>E(C=>C+gt),style:{marginBlockEnd:"6em"},children:[e("div",{class:"ib avatars-bunch",children:I.slice(O,O+5).map(C=>e(Ke,{url:C.account.avatarStatic},C.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:G>gt?`${gt}+`:G})]})]})})]}):e(x,{children:[$==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Ie,{skeleton:!0,size:"l"})})}),$==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]})]})}function Zn({replies:t,instance:n,hasParentThread:a,level:o,accWeight:s,openAll:i}){const[l,r]=ze(),u=y=>y.reduce((v,I)=>{const{repliesCount:S,replies:$}=I,D=($==null?void 0:$.length)||S;return v+D+u($||[])},0),h=t.length+u(t),f=t.length===h,p=t.map(y=>y.account).filter((y,v,I)=>I.findIndex(S=>S.id===y.id)===v).slice(0,3),g=ge(()=>t==null?void 0:t.reduce((y,v)=>y+(v==null?void 0:v.weight),s),[s,t==null?void 0:t.length]);let c=!1;(i||g<=ro||!a&&h===1&&lt(t[0])<2)&&(c=!0);const m=zt[t[0].id],d=He((y,v,I,S)=>{y.preventDefault(),y.stopPropagation(),r({media:v+1,mediaStatusID:S.id})},[]),b=M();return Ne(()=>{var v;function y(I){I.target.dataset.scrollLeft=I.target.scrollLeft}return(v=b.current)==null||v.addEventListener("scroll",y,{passive:!0}),()=>{var I;(I=b.current)==null||I.removeEventListener("scroll",y)}},[]),e("details",{ref:b,class:"replies",open:m||c,onToggle:y=>{const{open:v}=y.target;zt[t[0].id]=v},style:{"--comments-level":o},"data-comments-level":o,"data-comments-level-overflow":o>4,children:[e("summary",{class:"replies-summary",hidden:c,children:[e("span",{class:"avatars",children:p.map(y=>e(Ke,{url:y.avatarStatic,title:`${y.displayName} @${y.username}`,squircle:y==null?void 0:y.bot},y.id))}),e("span",{children:[e("span",{title:t.length,children:De(t.length)})," ","repl",t.length===1?"y":"ies"]}),!f&&h>1&&e(x,{children:[" ","·"," ",e("span",{children:[e("span",{title:h,children:De(h)})," ","comment",h===1?"":"s"]})]})]}),e("ul",{children:t.map(y=>{var v,I;return e("li",{children:[e(W,{class:"status-link",to:n?`/${n}/s/${y.id}`:`/s/${y.id}`,onClick:()=>{Ft(y.id)},children:[e(Ie,{statusID:y.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:d}),!((v=y.replies)!=null&&v.length)&&y.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:y.repliesCount,children:De(y.repliesCount)})]})]}),((I=y.replies)==null?void 0:I.length)&&e(Zn,{instance:n,replies:y.replies,level:o+1,accWeight:c?g:y.weight,openAll:i})]},y.id)})})]})}const uo=140,fo=35,po=70,mo=140,Bt=new Map;function lt(t){var c,m;const n=Bt.get(t.id);if(n)return n;const{spoilerText:a,content:o,mediaAttachments:s,poll:i,card:l}=t,r=ls(a+o),u=s!=null&&s.length?uo:0,h=(((c=i==null?void 0:i.options)==null?void 0:c.length)||0)*fo,f=l&&(s!=null&&s.length||(m=i==null?void 0:i.options)!=null&&m.length)?0:po,g=(r+u+h+f)/mo;return Bt.set(t.id,g),g}const go=Ue(lo);function bo(){const t=Je(),{id:n,instance:a}=t;return e(go,{id:n,instance:a})}const yo=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,wo=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,vo=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,ko=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,So=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,Io=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function gn(){return Ce(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("h1",{children:[e("img",{src:En,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:Io,alt:"Phanpy",width:"250"})]}),e("p",{children:e("big",{children:e("b",{children:e(W,{to:"/login",class:"button",children:"Log in"})})})}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:yo,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:So,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:wo,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:vo,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:ko,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),e("hr",{}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const To=window.alert;window.__nativeAlert||(window.__nativeAlert=To);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=vs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=k;setTimeout(()=>{var t,n,a,o;for(const s in ft)Array.isArray(ft[s])?(n=(t=ft[s])[0])==null||n.call(t):(o=(a=ft)[s])==null||o.call(a)},5e3);(()=>{window.__IDLE__=!1;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],a=Dn(()=>{window.__IDLE__=!0},5e3),o=()=>{window.__IDLE__=!1,a()};t.forEach(s=>{window.addEventListener(s,o,{passive:!0,capture:!0})})})();An(k,t=>{var n;for(const[a,o,s,i]of t){if(o.join(".")==="settings.shortcutsViewMode"){const l=document.getElementById("app");l&&(l.dataset.shortcutsViewMode=(n=k.shortcuts)!=null&&n.length?s:"")}o.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",s)}});function Co(){const[t,n]=T(!1),[a,o]=T("loading");Ne(()=>{const i=Z.local.get("theme");i&&(document.documentElement.classList.add(`is-${i}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",i==="auto"?"dark light":i));const l=Z.local.get("textSize");l&&document.documentElement.style.setProperty("--text-size",`${l}px`)},[]),N(()=>{const i=Z.local.get("instanceURL"),l=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(l){window.history.replaceState({},document.title,s.pathname||"/");const r=Z.session.get("clientID"),u=Z.session.get("clientSecret"),h=Z.session.get("vapidKey");(async()=>{o("loading");const{access_token:f}=await io({instanceURL:i,client_id:r,client_secret:u,code:l}),p=ds({instance:i,accessToken:f});await Promise.allSettled([Zt(p,i),hs(p,i,f,h)]),Qt(),en(p),n(!0),o("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const r=st();if(r){Z.session.set("currentAccount",r.info.id);const{client:u}=z({account:r}),{instance:h}=u;Qt(),en(u),o("loading"),(async()=>{try{await Zt(u,h)}catch{}finally{n(!0),o("default")}})()}else o("default")}},[]);let s=ot();return k.currentLocation=s.pathname,N(_t,[s,t]),/\/https?:/.test(s.pathname)?e(Xi,{}):e(x,{children:[e($o,{isLoggedIn:t,loading:a==="loading"}),e(xo,{isLoggedIn:t}),a==="default"&&e(qt,{children:e(ye,{path:"/:instance?/s/:id",element:e(bo,{})})}),t&&e(Ts,{}),t&&e(li,{}),e(ii,{}),t&&e(ci,{}),e(Is,{isLoggedIn:t}),a!=="loading"&&e(ai,{onClose:_t}),e(Cs,{})]})}function $o({isLoggedIn:t,loading:n}){const a=ot(),o=ge(()=>{const{pathname:s}=a;return!/^\/(login|welcome)/.test(s)},[a]);return e(qt,{location:o||a,children:[e(ye,{path:"/",element:t?e(Ki,{}):n?e(ve,{id:"loader-root"}):e(gn,{})}),e(ye,{path:"/login",element:e(oo,{})}),e(ye,{path:"/welcome",element:e(gn,{})})]})}function bn(){return k.prevLocation||null}function xo({isLoggedIn:t}){const n=ot(),a=M(bn());return ge(()=>dt("/:instance/s/:id",n.pathname)||dt("/s/:id",n.pathname),[n.pathname,dt])?a.current||(a.current=bn()):a.current=null,e(qt,{location:a.current||n,children:[t&&e(x,{children:[e(ye,{path:"/notifications",element:e(Yn,{})}),e(ye,{path:"/mentions",element:e(Wn,{})}),e(ye,{path:"/following",element:e(Wt,{})}),e(ye,{path:"/b",element:e(Hn,{})}),e(ye,{path:"/f",element:e(Vn,{})}),e(ye,{path:"/l",children:[e(ye,{index:!0,element:e(Zi,{})}),e(ye,{path:":id",element:e(Gn,{})})]}),e(ye,{path:"/ft",element:e(Ti,{})})]}),e(ye,{path:"/:instance?/t/:hashtag",element:e(jn,{})}),e(ye,{path:"/:instance?/a/:id",element:e(wi,{})}),e(ye,{path:"/:instance?/p",children:[e(ye,{index:!0,element:e(Ut,{})}),e(ye,{path:"l",element:e(Ut,{local:!0})})]}),e(ye,{path:"/:instance?/trending",element:e(Jn,{})}),e(ye,{path:"/:instance?/search",element:e(co,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));ks(e(Ss,{children:e(Co,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-032c8233.js.map
