import{a as U,h as M,X as te,I as y,e,A as de,N as he,s as l,g as L,z as ne,P as Y,Q as ue,x as j,k as se,f as V,F as z,aH as ae,aI as pe,p as A,aJ as J,c as E,R as fe,_ as H,am as ie,ak as q,al as ge,L as B,K as me,v as le,E as oe,aK as Z,aL as be,aM as ye,W as we,ai as ve,S as ke,y as Se,M as x,av as Ae}from"./db-sFMzSqk3.js";import{u as Ce,l as Me,i as Te,c as _e,d as K,e as X,A as xe,I as Le,f as Pe,M as Ie,S as Re,g as Ee}from"./main-TOTHqHaZ.js";import{C as De}from"./compose-M09VS2Ab.js";import"./intl-segmenter-polyfill-XHDQHdV5.js";import"./index-_Y-Lyw2n.js";function Ne({onClose:t}){const{masto:s}=U(),o=M.local.getJSON("accounts"),r=M.session.get("currentAccount"),c=o.length>1,[m,d]=te(i=>i+1,0),[b]=Ce();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(y,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:b,children:o.map((i,u)=>{const p=i.info.id===r,a=u===0;return e("li",{children:[e("div",{children:[c&&e("span",{class:`current ${p?"is-current":""}`,children:e(y,{icon:"check-circle",alt:"Current"})}),e(de,{url:i.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(p)try{const h=await s.v1.accounts.$select(i.info.id).fetch();i.info=h,M.local.setJSON("accounts",o),d()}catch{}}}),e(he,{account:c?{...i.info,acct:/@/.test(i.info.acct)?i.info.acct:`${i.info.acct}@${i.instanceURL}`}:i.info,showAcct:!0,onClick:()=>{p?l.showAccount=`${i.info.username}@${i.instanceURL}`:(M.session.set("currentAccount",i.info.id),location.reload())}})]}),e("div",{class:"actions",children:[a&&c&&e(L,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(ne,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(y,{icon:"more",size:"l",alt:"More"})}),children:[e(Y,{onClick:()=>{l.showAccount=`${i.info.username}@${i.instanceURL}`},children:[e(y,{icon:"user"}),e("span",{children:"View profile…"})]}),e(ue,{}),c&&e(Y,{disabled:a,onClick:()=>{o.splice(u,1),o.unshift(i),M.local.setJSON("accounts",o),d()},children:[e(y,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(j,{subMenu:!0,confirmLabel:e(L,{children:[e(y,{icon:"exit"}),e("span",{children:["Log out @",i.info.acct,"?"]})]}),disabled:!p,menuItemClassName:"danger",onClick:()=>{o.splice(u,1),M.local.setJSON("accounts",o),location.href=location.pathname||"/"},children:[e(y,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},i.info.id)})}),e("p",{children:e(se,{to:"/login",class:"button plain2",onClick:t,children:[e(y,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),c&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}var $e={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Q=16,O=[14,15,16,17,18,19,20],{PHANPY_WEBSITE:ee,PHANPY_PRIVACY_POLICY_URL:Oe,PHANPY_IMG_ALT_API_URL:Ue}=$e;function ze({onClose:t}){const s=V(l),o=M.local.get("theme")||"auto",r=z(),c=s.settings.contentTranslationTargetLanguage||null,m=ae(),d=pe(m),b=M.local.get("textSize")||Q,[i,u]=A(M.account.get("preferences")||{}),{masto:p,authenticated:a,instance:h}=U();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(y,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:r,onInput:n=>{n.preventDefault();const g=new FormData(r.current).get("theme"),v=document.documentElement;if(g==="auto"){v.classList.remove("is-light","is-dark");const w=document.querySelector('meta[data-theme-setting="manual"]');w&&(w.name=""),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(P=>{P.name="theme-color"})}else{v.classList.toggle("is-light",g==="light"),v.classList.toggle("is-dark",g==="dark");const w=document.querySelector('meta[data-theme-setting="manual"]');w&&(w.name="theme-color",w.content=g==="light"?w.dataset.themeLightColor:w.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(P=>{P.name=""})}document.querySelector('meta[name="color-scheme"]').setAttribute("content",g==="auto"?"dark light":g),g==="auto"?M.local.del("theme"):M.local.set("theme",g)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:o==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:o==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:o!=="light"&&o!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:O[0]},children:"A"})," ",e("input",{type:"range",min:O[0],max:O[O.length-1],step:"1",value:b,list:"sizes",onChange:n=>{const f=parseInt(n.target.value,10);document.documentElement.style.setProperty("--text-size",`${f}px`),f===Q?M.local.del("textSize"):M.local.set("textSize",n.target.value)}})," ",e("span",{style:{fontSize:O[O.length-1]},children:"A"}),e("datalist",{id:"sizes",children:O.map(n=>e("option",{value:n}))})]})]})]})}),a&&e(L,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(y,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:i["posting:default:visibility"]||"public",onChange:n=>{const{value:f}=n.target;(async()=>{try{await p.v1.accounts.updateCredentials({source:{privacy:f}}),u({...i,"posting:default:visibility":f}),M.account.set("preferences",{...i,"posting:default:visibility":f})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(y,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${h}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",h,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:s.settings.autoRefresh,onChange:n=>{l.settings.autoRefresh=n.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:s.settings.boostsCarousel,onChange:n=>{l.settings.boostsCarousel=n.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:s.settings.contentTranslation,onChange:n=>{const{checked:f}=n.target;l.settings.contentTranslation=f,f||(l.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${s.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:c||"",disabled:!s.settings.contentTranslation,onChange:n=>{l.settings.contentTranslationTargetLanguage=n.target.value||null},children:[e("option",{value:"",children:["System language (",d,")"]}),e("option",{disabled:!0,children:"──────────"}),J.map(n=>e("option",{value:n.code,children:n.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',s.settings.contentTranslationHideLanguages.length>0&&e(L,{children:[" ","(",s.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:J.map(n=>e("label",{children:[e("input",{type:"checkbox",checked:s.settings.contentTranslationHideLanguages.includes(n.code),onChange:f=>{const{checked:g}=f.target;g?l.settings.contentTranslationHideLanguages.push(n.code):l.settings.contentTranslationHideLanguages=s.settings.contentTranslationHideLanguages.filter(v=>v!==n.code)}})," ",n.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses external translation services, powered by"," ",e("a",{href:"https://github.com/cheeaun/lingva-api",target:"_blank",rel:"noopener noreferrer",children:"Lingva API"})," ","&"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:s.settings.contentTranslationAutoInline,disabled:!s.settings.contentTranslation,onChange:n=>{l.settings.contentTranslationAutoInline=n.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),!!Ue&&a&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:s.settings.mediaAltGenerator,onChange:n=>{l.settings.mediaAltGenerator=n.target.checked}})," ","Image description generator"," ",e(y,{icon:"sparkles2",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Only for new images while composing new posts."})}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external AI service, powered by"," ",e("a",{href:"https://github.com/cheeaun/img-alt-api",target:"_blank",rel:"noopener noreferrer",children:"img-alt-api"}),". May not work well. Only for images and in English."]})})]}),a&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:s.settings.shortcutSettingsCloudImportExport,onChange:n=>{l.settings.shortcutSettingsCloudImportExport=n.target.checked}})," ",'"Cloud" import/export for shortcuts settings'," ",e(y,{icon:"cloud",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:["⚠️⚠️⚠️ Very experimental.",e("br",{}),"Stored in your own profile’s notes. Profile (private) notes are mainly used for other profiles, and hidden for own profile."]})}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Note: This feature uses currently-logged-in instance server API."})})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:s.settings.cloakMode,onChange:n=>{l.settings.cloakMode=n.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),a&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{l.showDrafts=!0,l.showSettings=!1},children:"Unsent drafts"})})]})}),a&&e(He,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:Me,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:n=>{n.preventDefault(),l.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:n=>{n.preventDefault(),l.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:Oe,target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[ee&&e(L,{children:[e("span",{class:"insignificant",children:"Site:"})," ",ee.replace(/https?:\/\//g,"").replace(/\/$/,""),e("br",{})]}),e("span",{class:"insignificant",children:"Version:"})," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2024-03-21T23:58:46.627Z".slice(0,10).replace(/-/g,".")}.d863347`,onClick:n=>{n.target.select();try{navigator.clipboard.writeText(n.target.value),E("Version string copied")}catch{E("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/d863347",target:"_blank",rel:"noopener noreferrer",children:e(fe,{datetime:new Date("2024-03-21T23:58:46.627Z")})}),")"]})]})]})]})]})}function He({onClose:t}){if(!Te())return null;const{instance:s}=U(),[o,r]=A("default"),c=z(),[m,d]=A(!1),[b,i]=A(!1),u=z();H(()=>{(async()=>{r("loading");try{const{subscription:a,backendSubscription:h}=await _e();if(h!=null&&h.policy&&h.policy!=="none"){d(!0);const{alerts:n,policy:f}=h;u.current=f;const{elements:g}=c.current,v=g.namedItem(f);v&&(v.value=f),Object.keys(n).forEach(w=>{const S=g.namedItem(w);(S==null?void 0:S.type)==="checkbox"&&(S.checked=!0)})}r("default")}catch(a){/outside.*authorized/i.test(a.message)?i(!0):alert((a==null?void 0:a.message)||a),r("error")}})()},[]);const p=o==="loading";return e("form",{ref:c,onChange:()=>{const a=Object.fromEntries(new FormData(c.current)),h=!!a["policy-allow"],n={policy:a.policy,data:{alerts:{mention:!!a.mention,favourite:!!a.favourite,reblog:!!a.reblog,follow:!!a.follow,follow_request:!!a.followRequest,poll:!!a.poll,update:!!a.update,status:!!a.status}}};let f=0;Object.keys(n.data.alerts).forEach(v=>{n.data.alerts[v]?f++:delete n.data.alerts[v]});const g=u.current!==n.policy;h&&f>0?g?X().then(()=>{K(n)}).catch(v=>{alert("Failed to update subscription. Please try again.")}):K(n).catch(v=>{alert("Failed to update subscription. Please try again.")}):X().catch(v=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:p||b,name:"policy-allow",checked:m,onChange:async a=>{const{checked:h}=a.target;if(h){const n=await Notification.requestPermission();n==="granted"?d(!0):(d(!1),n==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else d(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:p||b||!m,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(a=>e("option",{value:a.value,children:a.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!m,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(a=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:a.value})," ",a.label]})}))})})})}),b&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(se,{to:`/login?instance=${s}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}function ce(t){if(!t)return;const s=ie(),o=z(s.pathname);H(()=>{o.current&&s.pathname!==o.current&&(t==null||t())},[s.pathname,t])}function Fe({account:t,instance:s,onClose:o}){const{masto:r,instance:c,authenticated:m}=U({instance:s}),d=typeof t=="string";return H(()=>{d||(l.accounts[`${t.id}@${c}`]=t)},[t]),ce(o),e("div",{class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close outer",onClick:o,children:e(y,{icon:"x"})}),e(xe,{instance:c,authenticated:m,account:t,fetchAccount:async()=>{if(d)try{return await r.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const i=await r.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:m});if(i.accounts.length)return i.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const u=new URL(t),{hostname:p,pathname:a}=u,h=a.replace(/^\//,"").replace(/\/$/,"")+"@"+p,n=await r.v2.search.fetch({q:h,type:"accounts",limit:1,resolve:m});if(n.accounts.length)return n.accounts[0]}}else return t}})]})}function Ge({onClose:t}){const{masto:s}=U(),[o,r]=A("default"),[c,m]=A([]),[d,b]=te(u=>u+1,0);H(()=>{r("loading"),(async()=>{try{const u=await q.drafts.keys();if(u.length){const p=ge(),a=u.filter(h=>h.startsWith(p));if(a.length){const h=await q.drafts.getMany(a);h.sort((n,f)=>new Date(f.updatedAt).getTime()-new Date(n.updatedAt).getTime()),m(h)}else m([])}else m([]);r("default")}catch{r("error")}})()},[d]);const i=(c==null?void 0:c.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(y,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(B,{abrupt:!0,hidden:o!=="loading"})]}),i&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:i?e(L,{children:[e("ul",{class:"drafts-list",children:c.map(u=>{const{updatedAt:p,key:a,draftStatus:h,replyTo:n}=u,f=new Date(p);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(y,{icon:n?"reply":"quill",size:"s"})," ",e("time",{children:[!!n&&e(L,{children:["@",n.account.acct,e("br",{})]}),me(f)]})]}),e(j,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:o==="loading",onClick:()=>{(async()=>{try{await q.drafts.del(a),b()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:o==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:o==="loading",class:"draft-item",onClick:async()=>{let g;if(n){r("loading");try{g=await s.v1.statuses.$select(n.id).fetch()}catch{alert("Error fetching reply-to status!"),r("default");return}r("default")}window.__COMPOSE__={draftStatus:h,replyToStatus:g},l.showCompose=!0,l.showDrafts=!1},children:e(qe,{draft:u})})]},p)})}),c.length>1&&e("p",{children:e(j,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:o==="loading",onClick:()=>{(async()=>{r("loading");try{await q.drafts.delMany(c.map(u=>u.key)),r("default"),b()}catch{alert("Error deleting drafts! Please try again."),r("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function qe({draft:t}){var a;const{draftStatus:s,replyTo:o}=t,{status:r,spoilerText:c,poll:m,mediaAttachments:d}=s,b=((a=m==null?void 0:m.options)==null?void 0:a.length)>0,i=(d==null?void 0:d.length)>0,u=b||i,p=le(()=>{if(!i)return;const h=d.find(g=>/image/.test(g.type));if(!h)return;const{file:n}=h;return URL.createObjectURL(n)},[i,d]);return e(L,{children:e("div",{class:"mini-draft",children:[u&&e("div",{class:`mini-draft-aside ${p?"has-image":""}`,style:p?{"--bg-image":`url(${p})`}:{},children:[b&&e(y,{icon:"poll"}),i&&e("span",{children:[e(y,{icon:"attachment"})," ",e("small",{children:d==null?void 0:d.length})]})]}),e("div",{class:"mini-draft-main",children:[!!c&&e("div",{class:"mini-draft-spoiler",children:c}),!!r&&e("div",{class:"mini-draft-status",children:r})]})]})})}function Ye({html:t,url:s,width:o,height:r,onClose:c=()=>{}}){return e("div",{class:"embed-modal-container",children:[e("div",{class:"top-controls",children:[e("button",{type:"button",class:"light",onClick:()=>c(),children:e(y,{icon:"x"})}),s&&e("a",{href:s,target:"_blank",rel:"noopener noreferrer",class:"button plain",children:[e("span",{children:"Open link"})," ",e(y,{icon:"external"})]})]}),e("div",{class:"embed-content",dangerouslySetInnerHTML:{__html:t},style:{"--width":o+"px","--height":r+"px","--aspect-ratio":`${o}/${r}`}})]})}function Be({instance:t,excludeRelationshipAttrs:s=[],onClose:o=()=>{}}){const{masto:r,instance:c}=U(),m=t?t===c:!0,d=V(l),[b,i]=A("default"),[u,p]=A([]),[a,h]=A(!1);if(ce(o),!d.showGenericAccounts)return null;const{id:n,heading:f,fetchAccounts:g,accounts:v,showReactions:w}=d.showGenericAccounts,[S,P]=A({}),D=async k=>{if(!(k!=null&&k.length)||!m)return;const $=await Pe(k,S);$&&P({...S,...$})},T=k=>{g&&(k&&p([]),i("loading"),(async()=>{try{const{done:$,value:C}=await g(k);if(Array.isArray(C)){if(k){const I=[];for(let _=0;_<C.length;_++){const R=C[_],F=I.find((W,re)=>W.id===R.id&&_!==re);F?F._types.push(...R._types):I.push({_types:[],...R})}p(I)}else p(I=>{const _=I;for(const R of C){const F=_.find(W=>W.id===R.id);F?F._types.push(...R._types):_.push(R)}return _});h(!$),D(C)}else h(!1);i("default")}catch{i("error")}})())},N=z(!0);return H(()=>{(v==null?void 0:v.length)>0?(p(v),D(v)):(T(!0),N.current=!1)},[v,g]),H(()=>{var k;N.current||((k=d.reloadGenericAccounts)==null?void 0:k.id)===n&&T(!0)},[d.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:o,children:e(y,{icon:"x"})}),e("header",{children:e("h2",{children:f||"Accounts"})}),e("main",{children:u.length>0?e(L,{children:[e("ul",{class:"accounts-list",children:u.map(k=>{var I,_;const $=S[k.id],C=`${k.id}-${((I=k._types)==null?void 0:I.length)||""}`;return e("li",{children:[w&&((_=k._types)==null?void 0:_.length)>0&&e("div",{class:"reactions-block",children:k._types.map(R=>e(y,{icon:{reblog:"rocket",favourite:"heart"}[R],class:`${R}-icon`}))}),e("div",{class:"account-relationships",children:e(oe,{account:k,showStats:!0,relationship:$,excludeRelationshipAttrs:s})})]},C)})}),b==="default"?a?e(Le,{onChange:k=>{k&&T()},children:e("button",{type:"button",class:"plain block",onClick:()=>T(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):b==="loading"&&e("p",{class:"ui-state",children:e(B,{abrupt:!0})})]}):b==="loading"?e("p",{class:"ui-state",children:e(B,{abrupt:!0})}):b==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Ve({alt:t,lang:s,onClose:o}){const r=V(l),[c,m]=A(!1),d=ae(!0),b=r.settings.contentTranslationHideLanguages||[],i=!!s&&s!==d&&!Z([s],[d])&&!b.find(u=>s===u||Z([s],[u]));return e("div",{class:"sheet",tabindex:"-1",children:[!!o&&e("button",{type:"button",class:"sheet-close outer",onClick:o,children:e(y,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(ne,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(y,{icon:"more",alt:"More",size:"xl"})}),children:[e(Y,{disabled:c,onClick:()=>{m(!0)},children:[e(y,{icon:"translate"}),e("span",{children:"Translate"})]}),be&&e(Y,{onClick:()=>{ye(t,s)},children:[e(y,{icon:"speak"}),e("span",{children:"Speak"})]})]})})]}),e("main",{lang:s,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(i||c)&&e(we,{forceTranslate:c,sourceLanguage:s,text:t})]})]})}const We=[,"spam","legal","violation","other"],G={spam:{label:"Spam",description:"Malicious links, fake engagement, or repetitive replies"},legal:{label:"Illegal",description:"Violates the law of your or the server's country"},violation:{label:"Server rule violation",description:"Breaks specific server rules",stampLabel:"Violation"},other:{label:"Other",description:"Issue doesn't fit other categories",excludeStamp:!0}};function je({account:t,post:s,onClose:o}){const{masto:r}=U(),[c,m]=A("default"),[d,b]=t.acct.split("@"),[i,u]=le(()=>{const{rules:w,domain:S}=ve();return[w||[],S]}),[p,a]=A(null),[h,n]=A(!1),f=z(null),[g,v]=A(!1);return e("div",{class:"report-modal-container",children:[e("div",{class:"top-controls",children:[e("h1",{children:s?"Report Post":`Report @${d}`}),e("button",{type:"button",class:"plain4 small",disabled:c==="loading",onClick:()=>o(),children:e(y,{icon:"x",size:"xl"})})]}),e("main",{children:[e("div",{class:"report-preview",children:s?e(ke,{status:s,size:"s",previewMode:!0}):e(oe,{account:t,avatarSize:"xxl",useAvatarStatic:!0,showStats:!0,showActivity:!0})}),!!p&&!G[p].excludeStamp&&e("span",{class:"rubber-stamp","aria-hidden":"true",children:[G[p].stampLabel||G[p].label,e("small",{children:"Pending review"})]},p),e("form",{onSubmit:w=>{w.preventDefault();const S=new FormData(w.target),P=Object.fromEntries(S.entries());let{category:D,comment:T,forward:N}=P;T||(T=void 0),N==="on"&&(N=!0);const k=D==="violation"?Object.entries(P).filter(([C])=>C.startsWith("rule_ids")).map(([C,I])=>I):void 0,$={category:D,comment:T,forward:N,ruleIds:k};m("loading"),(async()=>{try{await r.v1.reports.create({accountId:t.id,statusIds:s!=null&&s.id?[s.id]:void 0,category:D,comment:T,ruleIds:k,forward:N}),m("success"),E(s?"Post reported":"Profile reported"),o()}catch(C){m("error"),E((C==null?void 0:C.message)||(s?"Unable to report post":"Unable to report profile"))}})()},children:[e("p",{children:s?"What's the issue with this post?":"What's the issue with this profile?"}),e("section",{class:"report-categories",children:We.map(w=>w==="violation"&&!(i!=null&&i.length)?null:e(L,{children:[e("label",{class:"report-category",children:[e("input",{type:"radio",name:"category",value:w,required:!0,disabled:c==="loading",onChange:S=>{a(S.target.value),n(S.target.value==="violation")}}),e("span",{children:[G[w].label,"  ",e("small",{class:"ib insignificant",children:G[w].description})]})]}),w==="violation"&&!!(i!=null&&i.length)&&e("div",{class:"shazam-container no-animation",hidden:!h,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"report-rules",ref:f,children:i.map((S,P)=>e("label",{class:"report-rule",children:[e("input",{type:"checkbox",name:`rule_ids[${P}]`,value:S.id,required:h&&!g,disabled:c==="loading",onChange:D=>{const{checked:T}=D.target;T?v(!0):f.current.querySelectorAll("input:checked").length||v(!1)}}),e("span",{children:S.text})]},S.id))})})})]},w))}),e("section",{class:"report-comment",children:[e("p",{children:e("label",{for:"report-comment",children:"Additional info"})}),e("textarea",{maxlength:"1000",rows:"1",name:"comment",id:"report-comment",disabled:c==="loading"})]}),!!b&&b!==u&&e("section",{children:e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,name:"forward",disabled:c==="loading"})," ",e("span",{children:["Forward to ",e("i",{children:b})]})]})})}),e("footer",{children:[e("button",{type:"submit",disabled:c==="loading",children:"Send Report"})," ",e("button",{type:"submit",class:"plain2",disabled:c==="loading",onClick:async()=>{try{await r.v1.accounts.$select(t.id).mute(),E(`Muted ${d}`)}catch{E(`Unable to mute ${d}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Mute profile"})]})," ",e("button",{type:"submit",class:"plain2",disabled:c==="loading",onClick:async()=>{try{await r.v1.accounts.$select(t.id).block(),E(`Blocked ${d}`)}catch{E(`Unable to block ${d}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Block profile"})]}),e(B,{hidden:c!=="loading"})]})]})]})]})}Ae(l,t=>{for(const[s,o,r,c]of t)/^show/i.test(o)&&!r&&Ee()});function et(){var r,c,m,d,b,i,u,p;const t=V(l),s=Se(),o=ie();return e(L,{children:[!!t.showCompose&&e(x,{class:"solid",children:e(De,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((r=window.__COMPOSE__)==null?void 0:r.replyToStatus)||null,editStatus:((c=l.showCompose)==null?void 0:c.editStatus)||((m=window.__COMPOSE__)==null?void 0:m.editStatus)||null,draftStatus:((d=l.showCompose)==null?void 0:d.draftStatus)||((b=window.__COMPOSE__)==null?void 0:b.draftStatus)||null,onClose:a=>{const{newStatus:h,instance:n,type:f}=a||{};l.showCompose=!1,window.__COMPOSE__=null,h&&(l.reloadStatusPage++,E({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[f||"post"],delay:1e3,duration:1e4,onClick:g=>{g.hideToast(),l.prevLocation=o,s(n?`/${n}/s/${h.id}`:`/s/${h.id}`)}}))}})}),!!t.showSettings&&e(x,{onClose:()=>{l.showSettings=!1},children:e(ze,{onClose:()=>{l.showSettings=!1}})}),!!t.showAccounts&&e(x,{onClose:()=>{l.showAccounts=!1},children:e(Ne,{onClose:()=>{l.showAccounts=!1}})}),!!t.showAccount&&e(x,{onClose:()=>{l.showAccount=!1},children:e(Fe,{account:((i=t.showAccount)==null?void 0:i.account)||t.showAccount,instance:(u=t.showAccount)==null?void 0:u.instance,onClose:({destination:a}={})=>{l.showAccount=!1}})}),!!t.showDrafts&&e(x,{onClose:()=>{l.showDrafts=!1},children:e(Ge,{onClose:()=>l.showDrafts=!1})}),!!t.showMediaModal&&e(x,{onClick:a=>{(a.target===a.currentTarget||a.target.classList.contains("media"))&&(l.showMediaModal=!1)},children:e(Ie,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{l.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(x,{onClose:()=>{l.showShortcutsSettings=!1},children:e(Re,{onClose:()=>l.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(x,{onClose:()=>{l.showGenericAccounts=!1},children:e(Be,{instance:t.showGenericAccounts.instance,excludeRelationshipAttrs:t.showGenericAccounts.excludeRelationshipAttrs,onClose:()=>l.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(x,{onClose:a=>{l.showMediaAlt=!1},children:e(Ve,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(p=t.showMediaAlt)==null?void 0:p.lang,onClose:()=>{l.showMediaAlt=!1}})}),!!t.showEmbedModal&&e(x,{class:"solid",onClose:()=>{l.showEmbedModal=!1},children:e(Ye,{html:t.showEmbedModal.html,url:t.showEmbedModal.url,width:t.showEmbedModal.width,height:t.showEmbedModal.height,onClose:()=>{l.showEmbedModal=!1}})}),!!t.showReportModal&&e(x,{onClose:()=>{l.showReportModal=!1},children:e(je,{account:t.showReportModal.account,post:t.showReportModal.post,onClose:()=>{l.showReportModal=!1}})})]})}export{et as default};
//# sourceMappingURL=modals-sjK9tbPd.js.map
