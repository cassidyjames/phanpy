import{s as k,a as q,b as $e,u as Sn,c as re,o as os,I as w,M as ke,d as ne,A as Qe,N as It,e as Ue,L as K,g as it,f as In,l as cs,t as Jt,R as Ct,h as as,p as ot,i as Oe,j as Tn,k as _t,E as Cn,m as _e,n as Ke,q as rs,r as Se,v as Xt,T as $n,w as lt,x as xn,y as Zt,z as Ln,B as Re,C as ls,S as Le,D as ds,F as us,G as An,H as ht,J as Rn,K as Ae,O as Mn,P as hs,Q as fs,U as ps,V as gt,W as ms,X as Qt,Y as gs,Z as en,_ as tn}from"./useTitle-0d9083c3.js";import{_ as E,p as N,x as ze,h as $,u as Ce,o as e,a as he,k as x,s as $t,b as qt,M as et,c as te,d as Me,e as ct,F as ue,T as qe,S as bs,I as at,y as He,g as En,l as nn,f as Dn,i as _n,j as ys,m as Fe,A as ws,n as vs,J as ks,C as Pn,q as Nn,r as tt,t as Un,v as Ss,w as Is,z as Ts,B as ut,D as zn,E as sn,G as Cs,R as Ht,H as ve,K as $s,L as xs}from"./vendor-d00568ff.js";function ft(t=()=>{},n=[]){const a=E(t);N(()=>{a.current=t},[n]),N(()=>{const i=()=>{const o=document.hidden||document.visibilityState==="hidden";a.current(!o)};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)},[])}const Ls=1e3*3,As=1e3*60,Rs=ze(function({isLoggedIn:n}){const[a,i]=$(!0);ft(i);const o=async(c,u,l)=>{var f;if(k.notificationsLast){const p=c.v1.notifications.list({limit:1,sinceId:k.notificationsLast.id}),{value:g}=await p.next();if(g!=null&&g.length)if(l)k.notificationsShowNew=!0;else{let r;try{const m=await c.v1.markers.fetch({timeline:"notifications"});r=(f=m==null?void 0:m.notifications)==null?void 0:f.lastReadId}catch{}r?k.notificationsShowNew=g[0].id!==r:k.notificationsShowNew=!0}}};N(()=>{let c,u;if(n&&a){const{masto:l,streaming:f,instance:p}=q();(async()=>{await o(l,p);let g=!1;f&&(u=setTimeout(()=>{(async()=>{try{g=!0,c=f.user.notification.subscribe();for await(const r of c){if(!c||!a)break;r.event==="notification"&&$e(r.payload,p,{skipThreading:!0}),k.notificationsShowNew=!0}}catch{g=!1}g||(u=setInterval(()=>{o(l,p,!0)},As))})()},Ls))})()}return()=>{var l;(l=c==null?void 0:c.unsubscribe)==null||l.call(c),c=null,clearTimeout(u),clearInterval(u)}},[a,n]);const s=E(),d=()=>{s.current=Date.now(),fetch("./version.json").then(c=>c.json()).then(c=>{c&&(k.appVersion=c)}).catch(c=>{})};return Sn(d,a&&1e3*60*30),ft(c=>{c&&(s.current?Date.now()-s.current>1e3*60*60&&d():d())}),Ce("shift+alt+k",()=>{const c=k.settings.cloakMode;k.settings.cloakMode=!c,re({text:`Cloak mode ${c?"disabled":"enabled"}`})}),null});function Ms(){function t(n){n.shiftKey?os()||(alert("Looks like your browser is blocking popups."),k.showCompose=!0):k.showCompose=!0}return Ce("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const Es=ze(function(){const n=he(k);function a(){k.showKeyboardShortcutsHelp=!1}Ce("?, shift+?",o=>{k.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:o=>!!document.querySelector("#modal-container > *")});const i=Ce("esc",a,[]);return!!n.showKeyboardShortcutsHelp&&e(ke,{class:"light",onClick:o=>{o.target===o.currentTarget&&a()},children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:i,children:[e("button",{type:"button",class:"sheet-close",onClick:a,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e(x,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(x,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(x,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Send post",keys:e(x,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Like (favourite)",keys:e(x,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"Alt"})," + ",e("kbd",{children:"k"})]})}].map(({action:o,keys:s})=>e("tr",{children:[e("th",{children:o}),e("td",{children:s})]},o))})})]})})});function Ds({onClose:t}){const{masto:n}=q(),a=ne.local.getJSON("accounts"),i=ne.session.get("currentAccount"),o=a.length>1,[s,d]=$t(u=>u+1,0),[c]=qt();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:c,children:a.map((u,l)=>{const f=u.info.id===i,p=l===0;return e("li",{children:[e("div",{children:[o&&e("span",{class:`current ${f?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(Qe,{url:u.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const g=await n.v1.accounts.$select(u.info.id).fetch();u.info=g,ne.local.setJSON("accounts",a),d()}catch{}}}),e(It,{account:o?{...u.info,acct:/@/.test(u.info.acct)?u.info.acct:`${u.info.acct}@${u.instanceURL}`}:u.info,showAcct:!0,onClick:()=>{f?k.showAccount=`${u.info.username}@${u.instanceURL}`:(ne.session.set("currentAccount",u.info.id),location.reload())}})]}),e("div",{class:"actions",children:[p&&o&&e(x,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(et,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(te,{onClick:()=>{k.showAccount=`${u.info.username}@${u.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(Me,{}),o&&e(te,{disabled:p,onClick:()=>{a.splice(l,1),a.unshift(u),ne.local.setJSON("accounts",a),d()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Ue,{subMenu:!0,confirmLabel:e(x,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",u.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{a.splice(l,1),ne.local.setJSON("accounts",a),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},u.info.id)})}),e("p",{children:e(K,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),o&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const Fn=""+new URL("logo-f0531a6b.svg",import.meta.url).href;function on(t){const{masto:n}=q();return n.v1.push.subscription.create(t)}function _s(){const{masto:t}=q();return t.v1.push.subscription.fetch()}function Ps(t){const{masto:n}=q();return n.v1.push.subscription.update(t)}function Ns(){const{masto:t}=q();return t.v1.push.subscription.remove()}function xt(){return"serviceWorker"in navigator&&"PushManager"in window}function Us(){return navigator.serviceWorker.getRegistration()}async function Vt(){const t=await Us(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Bn(t){const n="=".repeat((4-t.length%4)%4),a=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(a),o=new Uint8Array(i.length);for(let s=0;s<i.length;++s)o[s]=i.charCodeAt(s);return o}async function zs(){if(!xt())return;const{subscription:t}=await Vt();let n=null;try{n=await _s()}catch(a){if(!/(not found|unknown)/i.test(a.message))throw a}if(n&&t){const a=n.endpoint===t.endpoint,{vapidKey:i}=it(),o=n.serverKey===i;if(!a)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:a}=it(),{applicationServerKey:i}=t.options,o=Bn(a).toString(),s=new Uint8Array(i).toString();if(!(o===s))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function cn({data:t,policy:n}){if(!xt())return;let{registration:a,subscription:i}=await Vt(),o=null;if(i)try{o=await Ps({data:t,policy:n})}catch{o=await on({subscription:i,data:t,policy:n})}else{const{vapidKey:s}=it();if(!s)throw new Error("No server key found");i=await a.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Bn(s)}),o=await on({subscription:i,data:t,policy:n})}return{subscription:i,backendSubscription:o}}async function an(){if(!xt())return;const{subscription:t}=await Vt();t&&(await Ns(),await t.unsubscribe())}const rn=16,Ze=[16,17,18,19,20];function Fs({onClose:t}){const n=he(k),a=ne.local.get("theme")||"auto",i=E(),o=n.settings.contentTranslationTargetLanguage||null,s=In(),d=cs(s),c=ne.local.get("textSize")||rn,[u,l]=$(ne.account.get("preferences")||{}),{masto:f,authenticated:p,instance:g}=q();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:i,onInput:r=>{r.preventDefault();const h=new FormData(i.current).get("theme"),b=document.documentElement;h==="auto"?b.classList.remove("is-light","is-dark"):(b.classList.toggle("is-light",h==="light"),b.classList.toggle("is-dark",h==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",h==="auto"?"dark light":h),h==="auto"?ne.local.del("theme"):ne.local.set("theme",h)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:a==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:a==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:a!=="light"&&a!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:Ze[0]},children:"A"})," ",e("input",{type:"range",min:Ze[0],max:Ze[Ze.length-1],step:"1",value:c,list:"sizes",onChange:r=>{const m=parseInt(r.target.value,10);document.documentElement.style.setProperty("--text-size",`${m}px`),m===rn?ne.local.del("textSize"):ne.local.set("textSize",r.target.value)}})," ",e("span",{style:{fontSize:Ze[Ze.length-1]},children:"A"}),e("datalist",{id:"sizes",children:Ze.map(r=>e("option",{value:r}))})]})]})]})}),p&&e(x,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:u["posting:default:visibility"]||"public",onChange:r=>{const{value:m}=r.target;(async()=>{try{await f.v1.accounts.updateCredentials({source:{privacy:m}}),l({...u,"posting:default:visibility":m}),ne.account.set("preferences",{...u,"posting:default:visibility":m})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${g}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",g,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:r=>{k.settings.autoRefresh=r.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:r=>{k.settings.boostsCarousel=r.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:r=>{const{checked:m}=r.target;k.settings.contentTranslation=m,m||(k.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:o||"",disabled:!n.settings.contentTranslation,onChange:r=>{k.settings.contentTranslationTargetLanguage=r.target.value||null},children:[e("option",{value:"",children:["System language (",d,")"]}),e("option",{disabled:!0,children:"──────────"}),Jt.map(r=>e("option",{value:r.code,children:r.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(x,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Jt.map(r=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(r.code),onChange:m=>{const{checked:h}=m.target;h?k.settings.contentTranslationHideLanguages.push(r.code):k.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(b=>b!==r.code)}})," ",r.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses an external API to translate, powered by"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:r=>{k.settings.contentTranslationAutoInline=r.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:r=>{k.settings.cloakMode=r.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),p&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{k.showDrafts=!0,k.showSettings=!1},children:"Unsent drafts"})})]})}),p&&e(Bs,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:Fn,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:r=>{r.preventDefault(),k.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:r=>{r.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:["Version:"," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2023-11-01T17:58:43.315Z".slice(0,10).replace(/-/g,".")}.b9355d6`,onClick:r=>{r.target.select();try{navigator.clipboard.writeText(r.target.value),re("Version string copied")}catch{re("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/b9355d6",target:"_blank",rel:"noopener noreferrer",children:e(Ct,{datetime:new Date("2023-11-01T17:58:43.315Z")})}),")"]})]})]})]})]})}function Bs({onClose:t}){if(!xt())return null;const{instance:n}=q(),[a,i]=$("default"),o=E(),[s,d]=$(!1),[c,u]=$(!1),l=E();N(()=>{(async()=>{i("loading");try{const{subscription:p,backendSubscription:g}=await zs();if(g!=null&&g.policy&&g.policy!=="none"){d(!0);const{alerts:r,policy:m}=g;l.current=m;const{elements:h}=o.current,b=h.namedItem(m);b&&(b.value=m),Object.keys(r).forEach(y=>{const v=h.namedItem(y);(v==null?void 0:v.type)==="checkbox"&&(v.checked=!0)})}i("default")}catch(p){/outside.*authorized/i.test(p.message)?u(!0):alert((p==null?void 0:p.message)||p),i("error")}})()},[]);const f=a==="loading";return e("form",{ref:o,onChange:()=>{const p=Object.fromEntries(new FormData(o.current)),g=!!p["policy-allow"],r={policy:p.policy,data:{alerts:{mention:!!p.mention,favourite:!!p.favourite,reblog:!!p.reblog,follow:!!p.follow,follow_request:!!p.followRequest,poll:!!p.poll,update:!!p.update,status:!!p.status}}};let m=0;Object.keys(r.data.alerts).forEach(b=>{r.data.alerts[b]?m++:delete r.data.alerts[b]});const h=l.current!==r.policy;g&&m>0?h?an().then(()=>{cn(r)}).catch(b=>{alert("Failed to update subscription. Please try again.")}):cn(r).catch(b=>{alert("Failed to update subscription. Please try again.")}):an().catch(b=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:f||c,name:"policy-allow",checked:s,onChange:async p=>{const{checked:g}=p.target;if(g){const r=await Notification.requestPermission();r==="granted"?d(!0):(d(!1),r==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else d(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:f||c||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(p=>e("option",{value:p.value,children:p.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(p=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:p.value})," ",p.label]})}))})})})}),c&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(K,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const Pt=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const a=document.querySelectorAll("#modal-container > *");if(a!=null&&a.length){const d=a[a.length-1],c=d.querySelector('[tabindex="-1"]')||d;if(c){c.focus();return}}if(document.querySelector(".deck-backdrop"))return;const o=document.querySelectorAll(".deck-container"),s=o[o.length-1];s&&s.tabIndex===-1&&s.focus()}},100);return()=>clearTimeout(t)};function On(t){if(!t)return;const n=ct(),a=E(n.pathname);N(()=>{a.current&&n.pathname!==a.current&&(t==null||t())},[n.pathname,t])}function jt({list:t,onClose:n}){const{masto:a}=q(),[i,o]=$("default"),s=!!t,d=E(),c=E(),u=E();N(()=>{s&&(d.current.value=t.title,c.current.value=t.repliesPolicy,u.current&&(u.current.checked=t.exclusive))},[s]);const l=as("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:s?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:f=>{f.preventDefault();const p=new FormData(f.target),g=p.get("title"),r=p.get("replies_policy"),m=p.get("exclusive")==="on";o("loading"),(async()=>{try{let h;s?h=await a.v1.lists.$select(t.id).update({title:g,replies_policy:r,exclusive:m}):h=await a.v1.lists.create({title:g,replies_policy:r,exclusive:m}),o("default"),n==null||n({state:"success",list:h})}catch{o("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:d,type:"text",id:"list-title",name:"title",required:!0,disabled:i==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:c,name:"replies_policy",required:!0,disabled:i==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),l&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:u,type:"checkbox",name:"exclusive",disabled:i==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:i==="loading",children:s?"Save":"Create"}),s&&e(Ue,{disabled:i==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await a.v1.lists.$select(t.id).remove(),o("default"),n==null||n({state:"deleted"})}catch{o("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete…"})})]})]})})]})}const Os=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],ln={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},dn=80,qn=1e3*60*10;function qs(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Hs=ot(qs,{maxAge:qn});async function Vs(t,n){const a=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:i}=await a,o={total:i.length,originals:0,replies:0,boosts:0};return i.forEach(s=>{s.reblog?o.boosts++:s.inReplyToId&&s.inReplyToAccountId!==s.account.id?o.replies++:o.originals++}),i.length&&(o.daysSinceLastPost=Math.ceil((Date.now()-new Date(i[i.length-1].createdAt))/864e5)),o}const js=ot(Vs,{maxAge:qn});function Hn({account:t,fetchAccount:n=()=>{},standalone:a,instance:i,authenticated:o}){const{masto:s}=q({instance:i}),{masto:d,instance:c}=q(),[u,l]=$("default"),f=typeof t=="string",[p,g]=$(f?null:t),r=ue(()=>t.id===ne.session.get("currentAccount"),[t==null?void 0:t.id]),m=ue(()=>i===c,[i,c]);N(()=>{if(!f){g(t);return}l("loading"),(async()=>{try{const B=await n();k.accounts[`${B.id}@${i}`]=B,g(B),l("default")}catch{g(null),l("error")}})()},[f,t,n]);const{acct:h,avatar:b,avatarStatic:y,bot:v,createdAt:I,displayName:C,emojis:L,fields:P,followersCount:W,followingCount:A,group:F,id:T,lastStatusAt:z,locked:R,note:U,statusesCount:V,url:le,username:fe,memorial:ye,moved:Z,roles:Y}=p||{};let M=!1,{header:O,headerStatic:G}=p||{};(!O||/missing\.png$/.test(O))&&b&&!/missing\.png$/.test(b)&&(O=b,M=!0,y&&!/missing\.png$/.test(y)&&(G=y));const ce=ue(()=>le?new URL(le).hostname:null,[le]),[me,Ie]=$([]),xe=E(),we=E([]);async function _(B){(B||!xe.current)&&(xe.current=s.v1.accounts.$select(T).followers.list({limit:dn}));const oe=await xe.current.next();if(r||!m)return oe;const{value:be}=oe;let de=[];if(B){const Pe=await s.v1.accounts.familiarFollowers.fetch({id:[T]});we.current=Pe[0].accounts,de=[...we.current,...be.filter(Be=>!we.current.some(De=>De.id===Be.id))]}else be!=null&&be.length&&(de=be.filter(Pe=>!we.current.some(Be=>Be.id===Pe.id)));return{...oe,value:de}}const J=E();async function Q(B){return(B||!J.current)&&(J.current=s.v1.accounts.$select(T).following.list({limit:dn})),await J.current.next()}const H=a?"div":K,ee=i?`/${i}/a/${T}`:`/a/${T}`,[ie,ae]=$([]),[S,D]=$(),[X,se]=$("default"),pe=!!(S!=null&&S.total),Ee=async B=>{try{const oe=await Hs(B,d);ae(oe[0].accounts.slice(0,Gs))}catch{}},Te=async()=>{if(T){se("loading");try{const B=await js(T,s);D(B),se("default")}catch{se("error")}}},je=qe(({relationship:B,currentID:oe})=>{B.following||(Ee(oe),a||Te())},[a,T]);return e("div",{tabIndex:"-1",class:`account-container  ${u==="loading"?"skeleton":""}`,style:{"--header-color-1":me[0],"--header-color-2":me[1],"--header-color-3":me[2],"--header-color-4":me[3]},children:[u==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:f?t:le,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),u==="loading"?e(x,{children:[e("header",{children:e(Oe,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):p&&e(x,{children:[!!Z&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:C})," has indicated that their new account is now:"]}),e(Oe,{account:Z,instance:i,onClick:B=>{B.stopPropagation(),k.showAccount=Z}})]}),!!O&&!/missing\.png$/.test(O)&&e("img",{src:O,alt:"",class:`header-banner ${M?"header-is-avatar":""}`,onError:B=>{B.target.crossOrigin?B.target.src!==G?B.target.src=G:(B.target.removeAttribute("crossorigin"),B.target.src=O):B.target.src!==G?B.target.src=G:B.target.remove()},crossOrigin:"anonymous",onLoad:B=>{B.target.classList.add("loaded");try{const oe=document.createElement("canvas"),be=oe.getContext("2d",{willReadFrequently:!0});oe.width=B.target.width,oe.height=B.target.height,be.drawImage(B.target,0,0);const de=10,Be=[be.getImageData(0,0,de,de).data,be.getImageData(B.target.width-de,0,de,de).data,be.getImageData(0,B.target.height-de,de,de).data,be.getImageData(B.target.width-de,B.target.height-de,de,de).data].map(De=>{let Ne=0,Ge=0,Xe=0,j=0;for(let We=0;We<De.length;We+=4)Ne+=De[We],Ge+=De[We+1],Xe+=De[We+2],j+=De[We+3];const ge=De.length/4;return[Ne/ge,Ge/ge,Xe/ge,j/ge]}).map(De=>{const[Ne,Ge,Xe,j]=Ks(De);return`rgba(${Ne}, ${Ge}, ${Xe}, ${j})`});Ie(Be)}catch{}}}),e("header",{children:e(Oe,{account:p,instance:i,avatarSize:"xxxl",external:a,internal:!a})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!ye&&e("span",{class:"tag",children:"In Memoriam"}),!!v&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!F&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),Y==null?void 0:Y.map(B=>e("span",{class:"tag",children:[B.name,!!ce&&e(x,{children:[" ",e("span",{class:"more-insignificant",children:ce})]})]})),e("div",{class:"note",dir:"auto",onClick:Tn({instance:c}),dangerouslySetInnerHTML:{__html:_t(U,{emojis:L})}}),e("div",{class:"account-metadata-box",children:[(P==null?void 0:P.length)>0&&e("div",{class:"profile-metadata",children:P.map(({name:B,value:oe,verifiedAt:be},de)=>e("div",{class:`profile-field ${be?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(Cn,{text:B,emojis:L})," ",!!be&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:_t(oe,{emojis:L})}})]},B+de))}),e("div",{class:"stats",children:[e(H,{tabIndex:0,to:ee,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Followers",fetchAccounts:_}},0)},children:[!!ie.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:ie.map(B=>e(Qe,{url:B.avatarStatic,size:"s",alt:`${B.displayName} @${B.acct}`,squircle:B==null?void 0:B.bot}))})}),e("span",{title:W,children:_e(W)})," ","Followers"]}),e(H,{class:"insignificant",tabIndex:0,to:ee,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Following",fetchAccounts:Q}},0)},children:[e("span",{title:A,children:_e(A)})," ","Following",e("br",{})]}),e(H,{class:"insignificant",to:ee,children:[e("span",{title:V,children:_e(V)})," ","Posts"]}),!!I&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:I,children:Ke(I,{hideTime:!0})})]})]})]}),!!S&&e(H,{to:ee,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:pe?e("div",{class:"posting-stats",title:`${Math.round(S.originals/S.total*100)}% original posts, ${Math.round(S.replies/S.total*100)}% replies, ${Math.round(S.boosts/S.total*100)}% boosts`,children:[e("div",{children:S.daysSinceLastPost<365?`Last ${S.total} post${S.total>1?"s":""} in the past 
                      ${S.daysSinceLastPost} day${S.daysSinceLastPost>1?"s":""}`:`
                      Last ${S.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${S.originals/S.total*100}%`,"--replies-percentage":`${(S.originals+S.replies)/S.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!S,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:X==="loading",onClick:()=>{Te()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${X==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(Ws,{info:p,instance:i,authenticated:o,onRelationshipChange:je})})]})]})}const Gs=3;function Ws({info:t,instance:n,authenticated:a,onRelationshipChange:i=()=>{}}){var Q;if(!t)return null;const{masto:o,instance:s,authenticated:d}=q(),c=n===s,[u,l]=$("default"),[f,p]=$(null),{id:g,acct:r,url:m,username:h,locked:b,lastStatusAt:y,note:v,fields:I,moved:C}=t,L=E(g),{following:P,showingReblogs:W,notifying:A,followedBy:F,blocking:T,blockedBy:z,muting:R,mutingNotifications:U,requested:V,domainBlocking:le,endorsed:fe,note:ye}=f||{},[Z,Y]=$(null),[M,O]=$(!1);N(()=>{if(t){const H=ne.session.get("currentAccount");let ee;(async()=>{if(c&&a)ee=g;else if(!c&&d){const ae=t.acct.includes("@");try{const S=await o.v2.search.fetch({q:ae?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});S.accounts.length&&(ee=S.accounts[0].id,Y(S.accounts[0]))}catch{}}if(!ee)return;if(H===ee){O(!0);return}if(L.current=ee,C)return;l("loading");const ie=o.v1.accounts.relationships.fetch({id:[ee]});try{const ae=await ie;if(l("default"),ae.length){const S=ae[0];p(S),i({relationship:S,currentID:ee})}}catch{l("error")}})()}},[t,a]),N(()=>{t&&M&&rs(t)},[t,M]);const G=u==="loading",ce=E(null),[me,Ie]=$(!1),[xe,we]=$(!1),[_,J]=$(!1);return e(x,{children:[e("div",{class:"actions",children:[e("span",{children:[F?e("span",{class:"tag",children:"Following you"}):y?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:Ke(y,{hideTime:!0})})]}):e("span",{}),R&&e("span",{class:"tag danger",children:"Muted"}),T&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!ye&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{J(!0)},dir:"auto",children:e("span",{children:ye})}),e(et,{instanceRef:ce,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:H=>{var ee,ie;H.target===H.currentTarget&&((ie=(ee=ce.current)==null?void 0:ee.closeMenu)==null||ie.call(ee))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:G,children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[d&&!M&&e(x,{children:[e(te,{onClick:()=>{k.showCompose={draftStatus:{status:`@${(Z==null?void 0:Z.acct)||r} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",h]})]}),e(te,{onClick:()=>{Ie(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(te,{onClick:()=>{J(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:ye?"Edit private note":"Add private note"})]}),P&&e(te,{onClick:()=>{we(!0)},children:[e(w,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(Me,{})]}),e(te,{href:m,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:Ys(m)})]}),e("div",{class:"menu-horizontal",children:[e(te,{onClick:()=>{try{navigator.clipboard.writeText(m),re("Link copied")}catch{re("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((Q=navigator==null?void 0:navigator.canShare)==null?void 0:Q.call(navigator,{url:m}))&&e(te,{onClick:()=>{try{navigator.share({url:m})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!f&&e(x,{children:[e(Me,{}),R?e(te,{onClick:()=>{l("loading"),(async()=>{try{const H=await o.v1.accounts.$select((Z==null?void 0:Z.id)||g).unmute();p(H),l("default"),re(`Unmuted @${h}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{l("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",h]})]}):e(bs,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(x,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",h,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:Os.map(H=>e(te,{onClick:()=>{l("loading"),(async()=>{try{const ee=await o.v1.accounts.$select((Z==null?void 0:Z.id)||g).mute({duration:H});p(ee),l("default"),re(`Muted @${h} for ${ln[H]}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{l("error"),re(`Unable to mute @${h}`)}})()},children:ln[H]}))})}),e(Ue,{subMenu:!0,confirm:!T,confirmLabel:e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",h,"?"]})]}),menuItemClassName:"danger",onClick:()=>{l("loading"),(async()=>{try{if(T){const H=await o.v1.accounts.$select((Z==null?void 0:Z.id)||g).unblock();p(H),l("default"),re(`Unblocked @${h}`)}else{const H=await o.v1.accounts.$select((Z==null?void 0:Z.id)||g).block();p(H),l("default"),re(`Blocked @${h}`)}k.reloadGenericAccounts.id="block",k.reloadGenericAccounts.counter++}catch{l("error"),T?re(`Unable to unblock @${h}`):re(`Unable to block @${h}`)}})()},children:T?e(x,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",h]})]}):e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",h,"…"]})]})})]})]}),!f&&u==="loading"&&e(Se,{abrupt:!0}),!!f&&e(Ue,{confirm:P||V,confirmLabel:e("span",{children:V?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:G,onClick:()=>{l("loading"),(async()=>{try{let H;P||V?H=await o.v1.accounts.$select(L.current).unfollow():H=await o.v1.accounts.$select(L.current).follow(),H&&p(H),l("default")}catch(H){alert(H),l("error")}})()},children:e("button",{type:"button",class:`${P||V?"light swap":""}`,"data-swap-state":P||V?"danger":"",disabled:G,children:P?e(x,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):V?e(x,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):b?e(x,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!me&&e(ke,{class:"light",onClose:()=>{Ie(!1)},children:e(Js,{note:v,fields:I,onClose:()=>Ie(!1)})}),!!xe&&e(ke,{class:"light",onClose:()=>{we(!1)},children:e(Xs,{accountID:L.current,onClose:()=>we(!1)})}),!!_&&e(ke,{class:"light",onClose:()=>{J(!1)},children:e(Zs,{account:t,note:ye,onRelationshipChange:H=>{p(H)},onClose:()=>J(!1)})})]})}function Ks([t,n,a]){const i=.2126*t+.7152*n+.0722*a;let o;return i>=220?o=1:i<=50?o=.1:o=i/255,o=Math.min(1,o),[t,n,a,o]}function Ys(t){if(!t)return;const n=new URL(t),{host:a,pathname:i}=n,o=i.replace(/\/$/,"").replace(/^\//,"");return e(x,{children:[e("span",{class:"more-insignificant",children:[a,"/"]}),e("wbr",{}),e("span",{children:o})]})}function Js({note:t,fields:n,onClose:a}){const i=(n==null?void 0:n.map(({name:s,value:d})=>`${s}
${Xt(d)}`).join(`

`))||"",o=Xt(t)+(i?`

${i}`:"");return e("div",{class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close",onClick:a,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:o}),e($n,{forceTranslate:!0,text:o})]})]})}function Xs({accountID:t,onClose:n}){const{masto:a}=q(),[i,o]=$("default"),[s,d]=$([]),[c,u]=$([]),[l,f]=$t(r=>r+1,0);N(()=>{o("loading"),(async()=>{try{const r=await a.v1.lists.list();r.sort((h,b)=>h.title.localeCompare(b.title));const m=await a.v1.accounts.$select(t).lists.list();d(r),u(m),o("default")}catch{o("error")}})()},[l]);const[p,g]=$(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[s.length>0?e("ul",{class:"list-add-remove",children:s.map(r=>{const m=c.some(h=>h.id===r.id);return e("li",{children:e("button",{type:"button",class:`light ${m?"checked":""}`,disabled:i==="loading",onClick:()=>{o("loading"),(async()=>{try{m?await a.v1.lists.$select(r.id).accounts.remove({accountIds:[t]}):await a.v1.lists.$select(r.id).accounts.create({accountIds:[t]}),f()}catch{o("error"),alert(m?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:r.title})]})})})}):i==="loading"?e("p",{class:"ui-state",children:e(Se,{abrupt:!0})}):i==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>g(!0),disabled:i!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),p&&e(ke,{class:"light",onClick:r=>{r.target===r.currentTarget&&g(!1)},children:e(jt,{list:p==null?void 0:p.list,onClose:r=>{r.state==="success"&&f(),g(!1)}})})]})}function Zs({account:t,note:n,onRelationshipChange:a=()=>{},onClose:i=()=>{}}){const{masto:o}=q(),[s,d]=$("default"),c=E(null);return N(()=>{let u;return c.current&&!n&&(u=setTimeout(()=>{var l,f;(f=(l=c.current).focus)==null||f.call(l)},100)),()=>{clearTimeout(u)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:u=>{u.preventDefault();const f=new FormData(u.target).get("note");(f==null?void 0:f.trim())!==(n==null?void 0:n.trim())&&(d("loading"),(async()=>{try{const p=await o.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:f});d("default"),a(p),i()}catch(p){d("error"),alert((p==null?void 0:p.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:c,name:"note",disabled:s==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:s==="loading",onClick:()=>{i==null||i()},children:"Cancel"}),e("span",{children:[e(Se,{abrupt:!0,hidden:s!=="loading"}),e("button",{disabled:s==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function Qs({account:t,instance:n,onClose:a}){const{masto:i,instance:o,authenticated:s}=q({instance:n}),d=typeof t=="string";return N(()=>{d||(k.accounts[`${t.id}@${o}`]=t)},[t]),On(a),e("div",{class:"sheet",children:[!!a&&e("button",{type:"button",class:"sheet-close outer",onClick:a,children:e(w,{icon:"x"})}),e(Hn,{instance:o,authenticated:s,account:t,fetchAccount:async()=>{if(d)try{return await i.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const u=await i.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:s});if(u.accounts.length)return u.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const f=new URL(t).pathname.replace(/^\//,""),p=await i.v2.search.fetch({q:f,type:"accounts",limit:1,resolve:s});if(p.accounts.length)return p.accounts[0]}}else return t}})]})}function ei({onClose:t}){const{masto:n}=q(),[a,i]=$("default"),[o,s]=$([]),[d,c]=$t(l=>l+1,0);N(()=>{i("loading"),(async()=>{try{const l=await lt.drafts.keys();if(l.length){const f=xn(),p=l.filter(g=>g.startsWith(f));if(p.length){const g=await lt.drafts.getMany(p);g.sort((r,m)=>new Date(m.updatedAt).getTime()-new Date(r.updatedAt).getTime()),s(g)}else s([])}else s([]);i("default")}catch{i("error")}})()},[d]);const u=(o==null?void 0:o.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(Se,{abrupt:!0,hidden:a!=="loading"})]}),u&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:u?e(x,{children:[e("ul",{class:"drafts-list",children:o.map(l=>{const{updatedAt:f,key:p,draftStatus:g,replyTo:r}=l,m=new Date(f);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:r?"reply":"quill",size:"s"})," ",e("time",{children:[!!r&&e(x,{children:["@",r.account.acct,e("br",{})]}),Ke(m)]})]}),e(Ue,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:a==="loading",onClick:()=>{(async()=>{try{await lt.drafts.del(p),c()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:a==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:a==="loading",class:"draft-item",onClick:async()=>{let h;if(r){i("loading");try{h=await n.v1.statuses.$select(r.id).fetch()}catch{alert("Error fetching reply-to status!"),i("default");return}i("default")}window.__COMPOSE__={draftStatus:g,replyToStatus:h},k.showCompose=!0,k.showDrafts=!1},children:e(ti,{draft:l})})]},f)})}),o.length>1&&e("p",{children:e(Ue,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:a==="loading",onClick:()=>{(async()=>{i("loading");try{await lt.drafts.delMany(o.map(l=>l.key)),i("default"),c()}catch{alert("Error deleting drafts! Please try again."),i("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:a==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function ti({draft:t}){var p;const{draftStatus:n,replyTo:a}=t,{status:i,spoilerText:o,poll:s,mediaAttachments:d}=n,c=((p=s==null?void 0:s.options)==null?void 0:p.length)>0,u=(d==null?void 0:d.length)>0,l=c||u,f=ue(()=>{if(!u)return;const g=d.find(h=>/image/.test(h.type));if(!g)return;const{file:r}=g;return URL.createObjectURL(r)},[u,d]);return e(x,{children:e("div",{class:"mini-draft",children:[l&&e("div",{class:`mini-draft-aside ${f?"has-image":""}`,style:f?{"--bg-image":`url(${f})`}:{},children:[c&&e(w,{icon:"poll"}),u&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:d==null?void 0:d.length})]})]}),e("div",{class:"mini-draft-main",children:[!!o&&e("div",{class:"mini-draft-spoiler",children:o}),!!i&&e("div",{class:"mini-draft-status",children:i})]})]})})}function ni({onClose:t=()=>{}}){const n=he(k),[a,i]=$("default"),[o,s]=$([]),[d,c]=$(!1);if(On(t),!n.showGenericAccounts)return null;const{id:u,heading:l,fetchAccounts:f,accounts:p,showReactions:g}=n.showGenericAccounts,r=h=>{f&&(h&&s([]),i("loading"),(async()=>{try{const{done:b,value:y}=await f(h);Array.isArray(y)?(s(h?y:v=>[...v,...y]),c(!b)):c(!1),i("default")}catch{i("error")}})())},m=E(!0);return N(()=>{(p==null?void 0:p.length)>0?s(p):(r(!0),m.current=!1)},[p,f]),N(()=>{var h;m.current||((h=n.reloadGenericAccounts)==null?void 0:h.id)===u&&r(!0)},[n.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:l||"Accounts"})}),e("main",{children:o.length>0?e(x,{children:[e("ul",{class:"accounts-list",children:o.map(h=>{var b;return e("li",{children:[g&&((b=h._types)==null?void 0:b.length)>0&&e("div",{class:"reactions-block",children:h._types.map(y=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[y],class:`${y}-icon`}))}),e(Oe,{account:h})]},h.id+(h._types||""))})}),a==="default"?d?e(at,{onChange:h=>{h&&r()},children:e("button",{type:"button",class:"plain block",onClick:()=>r(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):a==="loading"&&e("p",{class:"ui-state",children:e(Se,{abrupt:!0})})]}):a==="loading"?e("p",{class:"ui-state",children:e(Se,{abrupt:!0})}):a==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function si({alt:t,lang:n,onClose:a}){const i=he(k),[o,s]=$(!1),d=In(!0),c=i.settings.contentTranslationHideLanguages||[],u=!!n&&n!==d&&!Zt([n],[d])&&!c.find(l=>n===l||Zt([n],[l]));return e("div",{class:"sheet",tabindex:"-1",children:[!!a&&e("button",{type:"button",class:"sheet-close outer",onClick:a,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(et,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:e(te,{disabled:o,onClick:()=>{s(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]})})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap"},children:t}),(u||o)&&e($n,{forceTranslate:o,sourceLanguage:n,text:t})]})]})}function At(t,n,a){return Math.max(Math.min(t,a),n)}const Rt=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,Mt=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function Vn([t,n,a]){t=Rt(t/255),n=Rt(n/255),a=Rt(a/255);var i=.4122214708*t+.5363325363*n+.0514459929*a,o=.2119034982*t+.6806995451*n+.1073969566*a,s=.0883024619*t+.2817188376*n+.6299787005*a;return i=Math.cbrt(i),o=Math.cbrt(o),s=Math.cbrt(s),[i*.2104542553+o*.793617785+s*-.0040720468,i*1.9779984951+o*-2.428592205+s*.4505937099,i*.0259040371+o*.7827717662+s*-.808675766]}function jn([t,n,u]){var i=t+n*.3963377774+u*.2158037573,o=t+n*-.1055613458+u*-.0638541728,s=t+n*-.0894841775+u*-1.291485548;i=i**3,o=o**3,s=s**3;var d=i*4.0767416621+o*-3.3077115913+s*.2309699292,c=i*-1.2684380046+o*2.6097574011+s*-.3413193965,u=i*-.0041960863+o*-.7034186147+s*1.707614701;return d=255*Mt(d),c=255*Mt(c),u=255*Mt(u),d=At(d,0,255),c=At(c,0,255),u=At(u,0,255),d=Math.round(d),c=Math.round(c),u=Math.round(u),[d,c,u]}function Gn({mediaAttachments:t,statusID:n,instance:a,lang:i,index:o=0,onClose:s=()=>{}}){var r,m;const d=E(null),[c,u]=$(o),l=E(null);He(()=>{var h;(h=l.current)==null||h.scrollIntoView()},[]);const f=E(n);N(()=>{const h=o*d.current.clientWidth,b=f.current!==n;b&&(f.current=n),d.current.scrollTo({left:h,behavior:b?"auto":"smooth"}),d.current.focus()},[o,n]);const[p,g]=$(!0);return N(()=>{let h=()=>{s()};return d.current&&d.current.addEventListener("swiped-down",h),()=>{d.current&&d.current.removeEventListener("swiped-down",h)}},[]),Ce("esc",s,{ignoreEventWhen:h=>!!document.querySelector("#modal-container > *")},[s]),N(()=>{let h=()=>{const{clientWidth:b,scrollLeft:y}=d.current,v=Math.round(y/b);u(v)};return d.current&&d.current.addEventListener("scroll",h,{passive:!0}),()=>{d.current&&d.current.removeEventListener("scroll",h)}},[]),N(()=>{let h=setTimeout(()=>{var b,y;(y=(b=d.current)==null?void 0:b.focus)==null||y.call(b)},100);return()=>clearTimeout(h)},[]),e("div",{class:"media-modal-container",children:[e("div",{ref:d,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:h=>{(h.target.classList.contains("carousel-item")||h.target.classList.contains("media")||h.target.classList.contains("media-zoom"))&&s()},children:t==null?void 0:t.map((h,b)=>{const{blurhash:y}=h;let v;if(y){const I=En(y),C=Vn(I);v=jn([.6,C[1],C[2]])}return e("div",{class:"carousel-item",style:{"--accent-color":`rgb(${v==null?void 0:v.join(",")})`,"--accent-alpha-color":`rgba(${v==null?void 0:v.join(",")}, 0.4)`},tabindex:"0",ref:b===c?l:null,onClick:I=>{I.target.classList.contains("media")||g(!p)},children:[!!h.description&&e("button",{type:"button",class:"media-alt",hidden:!p,onClick:()=>{k.showMediaAlt={alt:h.description,lang:i}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:i,dir:"auto",children:h.description})]}),e(Ln,{media:h,showOriginal:!0,lang:i})]},h.id)})}),e("div",{class:"carousel-top-controls",hidden:!p,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((h,b)=>e("button",{type:"button",disabled:b===c,class:`carousel-dot ${b===c?"active":""}`,onClick:y=>{y.preventDefault(),y.stopPropagation(),d.current.scrollTo({left:d.current.clientWidth*b,behavior:"smooth"}),d.current.focus()},children:e(w,{icon:"round",size:"s"})},h.id))}):e("span",{}),e("span",{children:[e(et,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:e(Re,{href:((r=t[c])==null?void 0:r.remoteUrl)||((m=t[c])==null?void 0:m.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]})})," ",e(K,{to:`${a?`/${a}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${c+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!p,children:[e("button",{type:"button",class:"carousel-button",hidden:c===0,onClick:h=>{h.preventDefault(),h.stopPropagation(),d.current.focus(),d.current.scrollTo({left:d.current.clientWidth*(c-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:c===t.length-1,onClick:h=>{h.preventDefault(),h.stopPropagation(),d.current.focus(),d.current.scrollTo({left:d.current.clientWidth*(c+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]})]})}const ii=""+new URL("floating-button-ef345856.svg",import.meta.url).href,oi=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,ci=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function Nt({children:t}){if(typeof t=="string")return t;const[n,a]=$("");return N(()=>{Promise.resolve(t).then(a)},[t]),n}const Ye=9,ai=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],Wn={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},vt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},Tt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:ot(async({id:t})=>(await q().masto.v1.lists.$select(t).fetch()).title),path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||q().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||q().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t,path:({query:t})=>`/search?q=${t}`,icon:"search"},"account-statuses":{id:"account-statuses",title:ot(async({id:t})=>{const n=await q().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||q().instance,path:({hashtag:t,instance:n,media:a})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}${a?"?media=1":""}`,icon:"hashtag"}};function ri({onClose:t}){const n=he(k),{masto:a}=q(),{shortcuts:i}=n,[o,s]=$([]),[d,c]=$([]),[u,l]=$(!1),[f,p]=$(!1),[g]=qt();return N(()=>{(async()=>{try{const r=await a.v1.lists.list();r.sort((m,h)=>m.title.localeCompare(h.title)),s(r)}catch{}})(),(async()=>{try{const r=a.v1.followedTags.list(),m=[];do{const{value:h,done:b}=await r.next();if(b||(h==null?void 0:h.length)===0)break;m.push(...h)}while(!0);c(m)}catch{}})()},[]),e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:ii},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:ci},{value:"multi-column",label:"Multi-column",imgURL:oi}].map(({value:r,label:m,imgURL:h})=>{const b=n.settings.shortcutsViewMode===r||r==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:b?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:r,checked:b,onChange:y=>{k.settings.shortcutsViewMode=y.target.value}})," ",e("img",{src:h,alt:"",width:"80",height:"58"})," ",e("span",{children:m})]},r)})}),i.length>0?e("ol",{class:"shortcuts-list",ref:g,children:i.filter(Boolean).map((r,m)=>{const h=Object.values(r).join("-"),{type:b}=r;if(!Tt[b])return null;let{icon:y,title:v,subtitle:I}=Tt[b];return typeof v=="function"&&(v=v(r,m)),typeof I=="function"&&(I=I(r,m)),typeof y=="function"&&(y=y(r,m)),e("li",{children:[e(w,{icon:y}),e("span",{class:"shortcut-text",children:[e(Nt,{children:v}),I&&e(x,{children:[" ",e("small",{class:"ib insignificant",children:I})]})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:m===0,onClick:()=>{const C=Array.from(k.shortcuts);if(m>0){const L=k.shortcuts[m-1];C[m-1]=r,C[m]=L,k.shortcuts=C}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:m===i.length-1,onClick:()=>{const C=Array.from(k.shortcuts);if(m<k.shortcuts.length-1){const L=k.shortcuts[m+1];C[m+1]=r,C[m]=L,k.shortcuts=C}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{l({shortcut:r,shortcutIndex:m})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},h)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:r=>{r.preventDefault(),k.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:i.length>=Ye&&`Max ${Ye} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>p(!0),children:"Import/export"}),e("button",{type:"button",disabled:i.length>=Ye,onClick:()=>l(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),u&&e(ke,{class:"light",onClick:r=>{r.target===r.currentTarget&&l(!1)},children:e(li,{shortcut:u.shortcut,shortcutIndex:u.shortcutIndex,lists:o,followedHashtags:d,onSubmit:({result:r,mode:m})=>{m==="edit"?k.shortcuts[u.shortcutIndex]=r:k.shortcuts.push(r)},onClose:()=>l(!1)})}),f&&e(ke,{class:"light",onClick:r=>{r.target===r.currentTarget&&p(!1)},children:e(di,{shortcuts:i,onClose:()=>p(!1)})})]})}function li({lists:t,followedHashtags:n,onSubmit:a,disabled:i,shortcut:o,shortcutIndex:s,onClose:d}){var p,g;const c=!!o,[u,l]=$((o==null?void 0:o.type)||null),f=E();return N(()=>{if(c&&u&&vt[u]){const r=f.current;vt[u].forEach(({name:m,type:h})=>{const b=r.querySelector(`[name="${m}"]`);b&&o[m]&&(h==="checkbox"?b.checked=o[m]==="on":b.value=o[m])})}},[c,u]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!d&&e("button",{type:"button",class:"sheet-close",onClick:d,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[c?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:f,onSubmit:r=>{r.preventDefault();const m=new FormData(r.target),h={};m.forEach((b,y)=>{h[y]=b==null?void 0:b.trim(),y==="instance"&&(h[y]=h[y].replace(/^https?:\/\//,"").replace(/\/+$/,""),h[y]=h[y].replace(/^@?[^@]+@/,""))}),h.type&&(a({result:h,mode:c?"edit":"add"}),r.target.reset(),l(null),d==null||d())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:i,onChange:r=>{l(r.target.value)},defaultValue:c?o.type:void 0,name:"type",children:[e("option",{}),ai.map(r=>e("option",{value:r,children:Wn[r]}))]})]})}),(g=(p=vt[u])==null?void 0:p.map)==null?void 0:g.call(p,({text:r,name:m,type:h,placeholder:b,pattern:y,notRequired:v})=>u==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!v,disabled:i,children:t.map(I=>e("option",{value:I.id,children:I.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:r})," ",e("input",{type:h,name:m,placeholder:b,required:h==="text"&&!v,disabled:i,list:u==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:y}),u==="hashtag"&&n.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:n.map(I=>e("option",{value:I.name}))})]})})),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:i,children:c?"Save":"Add"}),c&&e("button",{type:"button",class:"light danger",onClick:()=>{k.shortcuts.splice(s,1),d==null||d()},children:"Remove"})]})]})})]})}function di({shortcuts:t,onClose:n}){var l;const a=ue(()=>!t||!t.filter(Boolean).length?"":nn.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[i,o]=$(""),[s,d]=$("default"),c=ue(()=>{if(!i)return d("default"),null;try{const f=JSON.parse(nn.decompressFromEncodedURIComponent(i));if(!Array.isArray(f))throw new Error("Not an array");return d("default"),f}catch{try{const p=JSON.parse(i);if(!Array.isArray(p))throw new Error("Not an array");return d("default"),p}catch{return d("error"),null}}},[i]),u=k.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:f=>{o(f.target.value)}})}),!!c&&Array.isArray(c)&&e(x,{children:[e("p",{children:[e("b",{children:c.length})," shortcut",c.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",i.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:c.map(f=>{var p,g;return e("li",{children:[e("span",{style:{opacity:t.some(r=>Object.keys(r).every(m=>r[m]===f[m]))?1:0},children:"*"}),e("span",{children:[Wn[f.type],f.type==="list"&&" ⚠️"," ",(g=(p=vt[f.type])==null?void 0:p.map)==null?void 0:g.call(p,({text:r,name:m,type:h})=>f[m]?e(x,{children:[e("span",{class:"tag collapsed insignificant",children:[r,":"," ",h==="checkbox"?f[m]==="on"?"✅":"❌":f[m]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[u&&e(x,{children:[e(Ue,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const f=c.filter(r=>!k.shortcuts.some(m=>Object.keys(m).every(h=>m[h]===r[h])));if(!f.length){re("No new shortcuts to import");return}let p=[...k.shortcuts,...f];const g=p.length>Ye;g&&(p=p.slice(0,Ye)),k.shortcuts=p,re(g?`Shortcuts imported. Exceeded max ${Ye}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!c,children:"Import & append…"})})," "]}),e(Ue,{confirmLabel:u?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:u?"danger":void 0,onClick:()=>{k.shortcuts=c,re("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!c,children:u?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:a,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),re("Shortcuts copied")}catch{re("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.clipboard.writeText(a),re("Shortcut settings copied")}catch{re("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((l=navigator==null?void 0:navigator.canShare)==null?void 0:l.call(navigator,{text:a}))&&e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.share({text:a})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",a.length>0&&e("small",{class:"insignificant",children:[a.length," characters"]})]}),!!a&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}Dn(k,t=>{for(const[n,a,i,o]of t)/^show/i.test(a)&&!i&&Pt()});function ui(){var i,o,s,d,c,u,l,f;const t=he(k),n=_n(),a=ct();return e(x,{children:[!!t.showCompose&&e(ke,{children:e(ls,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((i=window.__COMPOSE__)==null?void 0:i.replyToStatus)||null,editStatus:((o=k.showCompose)==null?void 0:o.editStatus)||((s=window.__COMPOSE__)==null?void 0:s.editStatus)||null,draftStatus:((d=k.showCompose)==null?void 0:d.draftStatus)||((c=window.__COMPOSE__)==null?void 0:c.draftStatus)||null,onClose:p=>{const{newStatus:g,instance:r,type:m}=p||{};k.showCompose=!1,window.__COMPOSE__=null,g&&(k.reloadStatusPage++,re({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[m||"post"],delay:1e3,duration:1e4,onClick:h=>{h.hideToast(),k.prevLocation=a,n(r?`/${r}/s/${g.id}`:`/s/${g.id}`)}}))}})}),!!t.showSettings&&e(ke,{onClose:()=>{k.showSettings=!1},children:e(Fs,{onClose:()=>{k.showSettings=!1}})}),!!t.showAccounts&&e(ke,{onClose:()=>{k.showAccounts=!1},children:e(Ds,{onClose:()=>{k.showAccounts=!1}})}),!!t.showAccount&&e(ke,{class:"light",onClose:()=>{k.showAccount=!1},children:e(Qs,{account:((u=t.showAccount)==null?void 0:u.account)||t.showAccount,instance:(l=t.showAccount)==null?void 0:l.instance,onClose:({destination:p}={})=>{k.showAccount=!1}})}),!!t.showDrafts&&e(ke,{onClose:()=>{k.showDrafts=!1},children:e(ei,{onClose:()=>k.showDrafts=!1})}),!!t.showMediaModal&&e(ke,{onClick:p=>{(p.target===p.currentTarget||p.target.classList.contains("media"))&&(k.showMediaModal=!1)},children:e(Gn,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{k.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(ke,{class:"light",onClose:()=>{k.showShortcutsSettings=!1},children:e(ri,{onClose:()=>k.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(ke,{class:"light",onClose:()=>{k.showGenericAccounts=!1},children:e(ni,{onClose:()=>k.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(ke,{class:"light",onClose:p=>{k.showMediaAlt=!1},children:e(si,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(f=t.showMediaAlt)==null?void 0:f.lang,onClose:()=>{k.showMediaAlt=!1}})})]})}function Ut({accountID:t,onChange:n}){const{masto:a}=q(),[i,o]=$("default"),[s,d]=$(null),[c,u]=$(null),l=c!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:i==="loading"||l,onClick:()=>{o("loading"),d("accept"),(async()=>{try{const f=await a.v1.followRequests.$select(t).authorize();if(!(f!=null&&f.followedBy))throw new Error("Follow request not accepted");u(f),n()}catch{}o("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:i==="loading"||l,class:"light danger",onClick:()=>{o("loading"),d("reject"),(async()=>{try{const f=await a.v1.followRequests.$select(t).reject();if(f!=null&&f.followedBy)throw new Error("Follow request not rejected");u(f),n()}catch{o("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:l&&s?s==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(Se,{hidden:i!=="loading"})})]})}const un={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},nt={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(x,{children:["reported ",t]})},Et=50;function hi({notification:t,instance:n,isStatic:a}){var P,W,A,F;const{id:i,status:o,account:s,report:d,_accounts:c,_statuses:u}=t;let{type:l}=t;const f=(o==null?void 0:o.reblog)||o,p=f==null?void 0:f.id,g=ne.session.get("currentAccount"),r=g===(s==null?void 0:s.id),m=(P=o==null?void 0:o.poll)==null?void 0:P.voted,h=!!(o!=null&&o.inReplyToAccountId)&&(o==null?void 0:o.inReplyToAccountId)!==g&&((W=o==null?void 0:o.account)==null?void 0:W.id)===g;let b=0,y=0;if(l==="favourite+reblog"){for(const T of c)(A=T._types)!=null&&A.includes("favourite")&&b++,(F=T._types)!=null&&F.includes("reblog")&&y++;!y&&b&&(l="favourite"),!b&&y&&(l="reblog")}let v;if(l==="poll"?v=nt[r?"poll-self":m?"poll-voted":"poll"]:l==="reblog"||l==="favourite"||l==="favourite+reblog"?(u==null?void 0:u.length)>1?v=nt[`${l}+account`]:h?v=nt[`${l}_reply`]:v=nt[l]:nt[l]?v=nt[l]:v=`[Unknown notification type: ${l}]`,typeof v=="function"){const T=(u==null?void 0:u.length)||(c==null?void 0:c.length);if(T)v=v(T);else if(l==="admin.report"){const z=d==null?void 0:d.targetAccount;z&&(v=v(e(It,{account:z,showAvatar:!0})))}}if(l==="mention"&&!o)return null;const I=t.createdAt&&new Date(t.createdAt).toLocaleString(),C={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[l]||"Accounts",L=()=>{k.showGenericAccounts={heading:C,accounts:c,showReactions:l==="favourite+reblog"}};return e("div",{class:`notification notification-${l}`,"data-notification-id":i,tabIndex:"0",children:[e("div",{class:`notification-type notification-${l}`,title:I,children:l==="favourite+reblog"?e(x,{children:[e(w,{icon:"rocket",size:"xl",alt:l,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:l,class:"favourite-icon"})]}):e(w,{icon:un[l]||"notification",size:"xl",alt:l})}),e("div",{class:"notification-content",children:[l!=="mention"&&e(x,{children:[e("p",{children:[!/poll|update/i.test(l)&&e(x,{children:(c==null?void 0:c.length)>1?e(x,{children:[e("b",{tabIndex:"0",onClick:L,children:[e("span",{title:c.length,children:_e(c.length)})," ","people"]})," "]}):e(x,{children:[e(It,{account:s,showAvatar:!0})," "]})}),v,l==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(Ct,{datetime:t.createdAt,format:"micro"})]})]}),l==="follow_request"&&e(Ut,{accountID:s.id})]}),(c==null?void 0:c.length)>1&&e("p",{class:"avatars-stack",children:[c.slice(0,Et).map(T=>e(x,{children:[e("a",{href:T.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:z=>{z.preventDefault(),k.showAccount=T},children:[e(Qe,{url:T.avatarStatic,size:c.length<=10?"xxl":c.length<20?"xl":c.length<30?"l":c.length<40?"m":"s",alt:`${T.displayName} @${T.acct}`,squircle:T==null?void 0:T.bot},T.id),l==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:T._types.map(z=>e(w,{icon:un[z],size:"s",class:`${z}-icon`}))})]},T.id)," "]},T.id)),e("button",{type:"button",class:"small plain",onClick:L,children:[c.length>Et&&`+${c.length-Et}`,e(w,{icon:"chevron-down"})]})]}),(u==null?void 0:u.length)>1&&e("ul",{class:"notification-group-statuses",children:u.map(T=>e("li",{children:e(hn,{class:`status-link status-type-${l}`,to:n?`/${n}/s/${T.id}`:`/s/${T.id}`,children:e(Le,{status:T,size:"s"})})},T.id))}),o&&(!(u!=null&&u.length)||(u==null?void 0:u.length)<=1)&&e(hn,{class:`status-link status-type-${l}`,to:n?`/${n}/s/${p}`:`/s/${p}`,onContextMenu:T=>{const z=T.target.querySelector(".status");if(z){if(T.metaKey)return;T.preventDefault(),z.dispatchEvent(new MouseEvent("contextmenu",{clientX:T.clientX,clientY:T.clientY}))}},children:a?e(Le,{status:f,size:"s"}):e(Le,{statusID:p,size:"s"})})]})]})}function hn(t){const n=ds();return e(K,{...t,"data-read-more":"Read more →",ref:n})}const Gt=ze(hi),fi=ze(function(){if(!("serviceWorker"in navigator))return null;const n=he(k),{routeNotification:a}=n,{id:i,accessToken:o}=a||{},[s,d]=$(!1);He(()=>{if(!i||!o)return;const{instance:u}=q(),{masto:l,instance:f}=q({accessToken:o}),p=u===f,g=o?us(o):it();(async()=>{const r=await l.v1.notifications.$select(i).fetch();if(r&&g){const m=g.instanceURL,{type:h,status:b,account:y}=r,v=!!document.querySelector("#modal-container > *"),I=h==="follow"&&!!(y!=null&&y.id),C=!!(y!=null&&y.id),L=!!(b!=null&&b.id);I&&p?k.showAccount={account:y,instance:m}:v||!p||C&&L?d({id:i,account:g,notification:r,sameInstance:p}):L?location.hash=`/${u}/s/${b.id}`:I?location.hash=`/${u}/a/${y.id}`:location.hash="/notifications"}})()},[i,o]),He(()=>{const u=l=>{const{type:f,id:p,accessToken:g}=(l==null?void 0:l.data)||{};f==="notification"&&(k.routeNotification={id:p,accessToken:g})};return navigator.serviceWorker.addEventListener("message",u),()=>{navigator.serviceWorker.removeEventListener("message",u)}},[]),He(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),ft(u=>{u&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const c=()=>{d(!1),k.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(s){const{id:u,account:l,notification:f,sameInstance:p}=s;return e(ke,{class:"light",onClick:g=>{g.target===g.currentTarget&&c()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:c,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!p&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:g=>{const{target:r}=g;(g.target.tagName==="BUTTON"||g.target.tagName==="A")&&c()},children:e(Gt,{instance:l.instanceURL,notification:f,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(K,{to:"/notifications",class:"button light",onClick:c,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null});const Kn=ys((t,n)=>{const{instance:a}=q(),[i,o]=Fe(),[s,d]=$(!1),[c,u]=$(i.get("q")||""),l=i.get("type"),f=E(null),p=E(null);return ws(n,()=>({setValue:g=>{u(g)},focus:()=>{p.current.focus()},select:()=>{p.current.select()},blur:()=>{p.current.blur()}})),e("form",{ref:f,class:"search-popover-container",onSubmit:g=>{var m;if(g.preventDefault(),/\/search/.test(location.hash))if(c){const h={q:c};l&&(h.type=l),o(h)}else o({});else c?location.hash=`/search?q=${encodeURIComponent(c)}${l?`&type=${l}`:""}`:location.hash="/search";(m=t==null?void 0:t.onSubmit)==null||m.call(t,g)},children:[e("input",{ref:p,value:c,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:g=>{g.target.value||o({})},onInput:g=>{u(g.target.value),d(!0)},onFocus:()=>{d(!0)},onBlur:()=>{var g,r;setTimeout(()=>{d(!1)},100),(r=(g=f.current)==null?void 0:g.querySelector(".search-popover-item.focus"))==null||r.classList.remove("focus")},onKeyDown:g=>{var m;const{key:r}=g;switch(r){case"Escape":d(!1);break;case"Down":case"ArrowDown":if(g.preventDefault(),s){const h=f.current.querySelector(".search-popover-item.focus");if(h){let b=h.nextElementSibling;for(;b&&b.hidden;)b=b.nextElementSibling;b&&(b.classList.add("focus"),Array.from(b.parentElement.children).filter(v=>v!==b).forEach(v=>{v.classList.remove("focus")}))}else{const b=f.current.querySelector(".search-popover-item");b&&b.classList.add("focus")}}break;case"Up":case"ArrowUp":if(g.preventDefault(),s){const h=document.querySelector(".search-popover-item.focus");if(h){let b=h.previousElementSibling;for(;b&&b.hidden;)b=b.previousElementSibling;b&&(b.classList.add("focus"),Array.from(b.parentElement.children).filter(v=>v!==b).forEach(v=>{v.classList.remove("focus")}))}else{const b=document.querySelector(".search-popover-item:last-child");b&&b.classList.add("focus")}}break;case"Enter":if(s){const h=document.querySelector(".search-popover-item.focus");h&&(g.preventDefault(),h.click()),d(!1),(m=t==null?void 0:t.onSubmit)==null||m.call(t,g)}break}}}),e("div",{class:"search-popover",hidden:!s||!c,children:!!c&&[{label:e(x,{children:["Posts with ",e("q",{children:c})]}),to:`/search?q=${encodeURIComponent(c)}&type=statuses`,hidden:/^https?:/.test(c)},{label:e(x,{children:["Posts tagged with ",e("mark",{children:["#",c.replace(/^#/,"")]})]}),to:`/${a}/t/${c.replace(/^#/,"")}`,hidden:/^@/.test(c)||/^https?:/.test(c)||/\s/.test(c),top:/^#/.test(c),type:"link"},{label:e(x,{children:["Look up ",e("mark",{children:c})]}),to:`/${c}`,hidden:!/^https?:/.test(c),top:/^https?:/.test(c),type:"link"},{label:e(x,{children:["Accounts with ",e("q",{children:c})]}),to:`/search?q=${encodeURIComponent(c)}&type=accounts`}].sort((g,r)=>g.top&&!r.top?-1:!g.top&&r.top?1:0).map(({label:g,to:r,hidden:m,type:h})=>e(K,{to:r,class:"search-popover-item",hidden:m,onClick:b=>{var y;(y=t==null?void 0:t.onSubmit)==null||y.call(t,b)},children:[e(w,{icon:h==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:g})," "]}))})]})}),pi=ze(function({onClose:n=()=>{}}){const[a,i]=$(!1),o=E(null);Ce("/",d=>{i(!0),setTimeout(()=>{var c,u,l,f;(u=(c=o.current)==null?void 0:c.focus)==null||u.call(c),(f=(l=o.current)==null?void 0:l.select)==null||f.call(l)},0)},{preventDefault:!0,ignoreEventWhen:d=>{const c=/\/search/.test(location.hash),u=!!document.querySelector("#modal-container > *");return c||u}});const s=()=>{i(!1),n()};return Ce("esc",d=>{var c,u;(u=(c=o.current)==null?void 0:c.blur)==null||u.call(c),s()},{enabled:a,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!a,onClick:d=>{d.target===d.currentTarget&&s()},children:e(Kn,{ref:o,onSubmit:()=>{s()}})})});function mi(){const{instance:t}=q(),n=he(k),{shortcuts:a,settings:i}=n;if(!a.length||i.shortcutsColumnsMode||i.shortcutsViewMode==="multi-column")return null;const o=E(),s=ue(()=>a.map((c,u)=>{const{type:l,...f}=c;if(!Tt[l])return null;let{id:p,path:g,title:r,subtitle:m,icon:h}=Tt[l];return typeof p=="function"&&(p=p(f,u)),typeof g=="function"&&(g=g({...f,instance:f.instance||t},u)),typeof r=="function"&&(r=r(f,u)),typeof m=="function"&&(m=m(f,u)),typeof h=="function"&&(h=h(f,u)),{id:p,path:g,title:r,subtitle:m,icon:h}}).filter(Boolean),[a]),d=_n();return Ce(["1","2","3","4","5","6","7","8","9"],(c,u)=>{var f,p;const l=parseInt(u.keys[0],10)-1;if(l<s.length){const{path:g}=s[l];g&&(d(g),(p=(f=o.current)==null?void 0:f.closeMenu)==null||p.call(f))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",children:e("ul",{children:s.map(({id:c,path:u,title:l,subtitle:f,icon:p},g)=>e("li",{children:e(K,{class:f?"has-subtitle":"",to:u,onClick:r=>{if(r.target.classList.contains("is-active")){r.preventDefault();const m=document.getElementById(`${c}-page`);if(m){m.scrollTop=0;const h=m.querySelector(".updates-button");h&&h.click()}}},children:[e(w,{icon:p,size:"xl",alt:l}),e("span",{children:[e(Nt,{children:l}),f&&e(x,{children:[e("br",{}),e("small",{children:f})]})]})]})},g+l))})}):e(et,{instanceRef:o,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:c=>{var u,l;try{const{target:f}=c;getComputedStyle(f).pointerEvents==="none"&&((l=(u=o.current)==null?void 0:u.closeMenu)==null||l.call(u))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:s.map(({path:c,title:u,subtitle:l,icon:f},p)=>e(Re,{to:c,class:"glass-menu-item",children:[e(w,{icon:f,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Nt,{children:u})}),l&&e(x,{children:[" ",e("small",{class:"more-insignificant",children:l})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:p+1})]},p+u))})})}const gi=ze(mi);function pt(t){const{containerProps:n}=t,a=vs(),i=E();return e(et,{boundingBoxPadding:An(),repositionFlag:`${a.width}x${a.height}`,...t,instanceRef:i,containerProps:{onClick:o=>{var s,d,c;o.target===o.currentTarget&&((d=(s=i.current)==null?void 0:s.closeMenu)==null||d.call(s)),(c=n==null?void 0:n.onClick)==null||c.call(n,o)},...n}})}function bi(t){var o;let n=[],a=[],i=0;for(let s=0;s<t.length;s++){const d=t[s];d.reblog&&!((o=d.account)!=null&&o.group)?(a.push(d),i++):(n.push(d),i<3&&(i=0))}if(t.length>10&&(a.length>t.length/4||i>=3)){const s=a.map(d=>d.id);if(a.length>t.length*3/4)n=[...n,{id:s,items:a,type:"boosts"}];else{const d=Math.floor(n.length/2);n=[...n.slice(0,d),{id:s,items:a,type:"boosts"},...n.slice(d)]}return n}else return t}function fn(t,n){const a=ne.account.get("boostedStatusIDs")||{},i=t.filter(s=>{if(!s.reblog)return!0;const d=`${n}-${s.reblog.id}`,c=a[d];return c&&c!==s.id?!1:(a[d]=s.id,!0)}),o=Object.keys(a);return o.length>50&&o.slice(0,o.length-50).forEach(s=>{delete a[s]}),ne.account.set("boostedStatusIDs",a),i}function yi(t){const n=[];let a=0;t.forEach(s=>{for(let c=0;c<n.length;c++){if(n[c].find(u=>u.id===s.id))return;if(n[c].find(u=>u.id===s.inReplyToId)||n[c].find(u=>u.inReplyToId===s.id)){n[c].push(s);return}}const d=t.find(c=>c.id===s.inReplyToId);d&&(n[a++]=[s,d])});for(let s=0;s<n.length;s++)for(let d=s+1;d<n.length;d++)n[s].find(u=>n[d].includes(u))&&(n[s]=[...n[s],...n[d]],n[s]=n[s].filter((u,l,f)=>f.findIndex(p=>p.id===u.id)===l),n.splice(d,1),d--);n.forEach(s=>{s.sort((d,c)=>!d.inReplyToId&&!c.inReplyToId?new Date(d.createdAt)-new Date(c.createdAt):d.inReplyToId===c.id?1:c.inReplyToId===d.id||!d.inReplyToId?-1:c.inReplyToId?new Date(d.createdAt)-new Date(c.createdAt):1)}),n.forEach(s=>{const d=s[0].account.id;s.forEach(c=>{c.account.id!==d&&(c._differentAuthor=!0)})}),n.length;const i=[],o=[];return t.forEach(s=>{if(s.reblog){i.push(s);return}for(let d=0;d<n.length;d++)if(n[d].find(c=>c.id===s.id)){if(o.includes(d))return;const c=n[d];c.sort((l,f)=>{const p=new Date(l.createdAt),g=new Date(f.createdAt);return p-g});const u=c[0].account.id;i.push({id:c.map(l=>l.id),items:c,type:c.every(l=>l.account.id===u)?"thread":"conversation"}),o.push(d);return}i.push(s)}),i}function Lt({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:a=1,scrollThresholdStart:i=10,scrollThresholdEnd:o=10,direction:s="vertical",distanceFromStartPx:d,distanceFromEndPx:c}={}){const[u,l]=$(null),[f,p]=$(!1),[g,r]=$(!1),[m,h]=$(!1),[b,y]=$(!1),v=s==="vertical";return He(()=>{const I=t.current;if(!I)return{};let C=v?I.scrollTop:I.scrollLeft;function L(){const{scrollTop:P,scrollLeft:W,scrollHeight:A,scrollWidth:F,clientHeight:T,clientWidth:z}=I,R=v?P:W,U=v?A:F,V=v?T:z,le=Math.abs(R-C),fe=d||Math.min(V*n,U,R),ye=c||Math.min(V*a,U,U-R-V);le>=(C<R?o:i)&&(l(C<R?"end":"start"),C=R),p(R<=0),r(R+V>=U),h(R<=fe),y(R+V>=U-ye)}return I.addEventListener("scroll",L,{passive:!0}),()=>I.removeEventListener("scroll",L)},[n,a,i,o]),{scrollDirection:u,reachStart:f,reachEnd:g,nearReachStart:m,nearReachEnd:b,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function wi({class:t,statusID:n,status:a,instance:i,parent:o,allowFilters:s,onMediaClick:d}){let c=ht(n,i);const u=he(k);if(a||(a=u.statuses[c]||u.statuses[n],c=ht(a==null?void 0:a.id,i)),!a)return null;const{account:{acct:l,avatar:f,avatarStatic:p,id:g,url:r,displayName:m,username:h,emojis:b,bot:y,group:v},id:I,repliesCount:C,reblogged:L,reblogsCount:P,favourited:W,favouritesCount:A,bookmarked:F,poll:T,muted:z,sensitive:R,spoilerText:U,visibility:V,language:le,editedAt:fe,filtered:ye,card:Z,createdAt:Y,inReplyToId:M,inReplyToAccountId:O,content:G,mentions:ce,mediaAttachments:me,reblog:Ie,uri:xe,url:we,emojis:_,_deleted:J,_pinned:Q,_filtered:H}=a;if(!(me!=null&&me.length))return null;const ee=S=>{S.shiftKey},ie=U||R,ae=o||"div";return me.map((S,D)=>{const X=`${c}-${S.id}`;return e(ae,{onMouseEnter:ee,"data-spoiler-text":U||(R?"Sensitive media":void 0),"data-filtered-text":H?"Filtered":void 0,class:`
          media-post
          ${s&&H?"filtered":""}
          ${ie?"has-spoiler":""}
        `,children:e(Ln,{class:t,media:S,lang:le,to:`/${i}/s/${I}?media-only=${D+1}`,onClick:d?se=>d(se,D,S,a):void 0})},X)})}const pn=ze(wi);function mt(t){var I,C,L,P,W;const n=he(k),{masto:a,instance:i,authenticated:o}=q(),[s,d]=$(),[c,u]=$(!1);N(()=>{const A=ne.local.getJSON("accounts")||[],F=A.find(T=>T.info.id===ne.session.get("currentAccount"));F&&d(F),u(A.length>1)},[]);const l=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(A=>A.type==="following"),f=ks(()=>{k.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),p=E(),[g,r]=$(void 0),m=An([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),h=E();async function b(A){return(A||!h.current)&&(h.current=a.v1.mutes.list({limit:80})),await h.current.next()}const y=E();async function v(A){return(A||!y.current)&&(y.current=a.v1.blocks.list({limit:80})),await y.current.next()}return e(x,{children:[e("button",{ref:p,type:"button",class:`button plain nav-menu-button ${c?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{r(A=>A?void 0:"open")},onContextMenu:A=>{A.preventDefault(),k.showAccounts=!0},...f(),children:[c&&e(Qe,{url:((I=s==null?void 0:s.info)==null?void 0:I.avatar)||((C=s==null?void 0:s.info)==null?void 0:C.avatarStatic),size:"l",squircle:(L=s==null?void 0:s.info)==null?void 0:L.bot}),e(w,{icon:"menu",size:c?"s":"l"})]}),e(Pn,{menuClassName:"nav-menu",state:g,anchorRef:p,onClose:()=>{r(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{r(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:m,unmountOnClose:!0,children:[!!((P=n.appVersion)!=null&&P.commitHash)&&n.appVersion.commitHash!=="b9355d6"&&e("div",{class:"top-menu",children:[e(te,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(Me,{})]}),e("section",{children:[e(Re,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),o&&e(x,{children:[l&&e(Re,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Re,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Re,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(Me,{}),e(Re,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(Re,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Re,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Re,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]})]}),e(Me,{}),e(Re,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Re,{to:`/${i}/p/l`,children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Local"})]}),e(Re,{to:`/${i}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(Re,{to:`/${i}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:o?e(x,{children:[e(Me,{}),((W=s==null?void 0:s.info)==null?void 0:W.id)&&e(Re,{to:`/${i}/a/${s.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(te,{onClick:()=>{k.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(te,{onClick:()=>{k.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:b}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(te,{onClick:()=>{k.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:v}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(Me,{className:"divider-grow"}),e(te,{onClick:()=>{k.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(te,{onClick:()=>{k.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(te,{onClick:()=>{k.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(x,{children:[e(Me,{}),e(Re,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(te,{onClick:()=>{k.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const bt={block:"nearest",inline:"center",behavior:"smooth"};function Ve({title:t,titleComponent:n,id:a,instance:i,emptyText:o,errorText:s,useItemID:d,boostsCarousel:c,fetchItems:u=()=>{},checkForUpdates:l=()=>{},checkForUpdatesInterval:f=6e4,headerStart:p,headerEnd:g,timelineStart:r,allowFilters:m,refresh:h,view:b}){const y=he(k),[v,I]=$([]),[C,L]=$("default"),[P,W]=$(!1),[A,F]=$(!1),[T,z]=$(!0),R=E(),U=b!=="media",V=Nn(_=>{F(!1),C!=="loading"&&(L("loading"),(async()=>{try{let{done:J,value:Q}=await u(_);Array.isArray(Q)?(U&&(c&&(Q=bi(Q)),Q=yi(Q)),I(_?Q:H=>[...H,...Q]),Q.length||(J=!0),W(!J)):W(!1),L("default")}catch{L("error")}finally{V.cancel()}})())},1500,{leading:!0,trailing:!1}),le=".timeline-item, .timeline-item-alt",fe=Ce("j, shift+j",(_,J)=>{const Q=document.activeElement.closest(le),H=Q==null?void 0:Q.getBoundingClientRect(),ee=Array.from(R.current.querySelectorAll(le));if(Q&&H.top<R.current.clientHeight&&H.bottom>0){const ie=ee.indexOf(Q);let ae=ee[ie+1];J.shift&&(ae=ee.find((S,D)=>D>ie&&!S.classList.contains("timeline-item-alt"))),ae&&(ae.focus(),ae.scrollIntoView(bt))}else{const ie=ee.find(ae=>{const S=ae.getBoundingClientRect();return S.top>=44&&S.left>=0});ie&&(ie.focus(),ie.scrollIntoView(bt))}}),ye=Ce("k, shift+k",(_,J)=>{const Q=document.activeElement.closest(le),H=Q==null?void 0:Q.getBoundingClientRect(),ee=Array.from(R.current.querySelectorAll(le));if(Q&&H.top<R.current.clientHeight&&H.bottom>0){const ie=ee.indexOf(Q);let ae=ee[ie-1];J.shift&&(ae=ee.findLast((S,D)=>D<ie&&!S.classList.contains("timeline-item-alt"))),ae&&(ae.focus(),ae.scrollIntoView(bt))}else{const ie=ee.find(ae=>{const S=ae.getBoundingClientRect();return S.top>=44&&S.left>=0});ie&&(ie.focus(),ie.scrollIntoView(bt))}}),Z=Ce(["enter","o"],()=>{const _=document.activeElement.closest(le);_&&_.click()}),{scrollDirection:Y,nearReachStart:M,nearReachEnd:O,reachStart:G,reachEnd:ce}=Lt({scrollableRef:R,distanceFromEnd:2,scrollThresholdStart:44});N(()=>{var _;(_=R.current)==null||_.scrollTo({top:0}),V(!0)},[]),N(()=>{V(!0)},[h]),N(()=>{G&&V(!0)},[G]),N(()=>{(O||ce&&P)&&V()},[O,P]);const me=E(b);N(()=>{me.current!==b&&(me.current=b,I([]))},[b]);const Ie=qe(async({disableIdleCheck:_=!1}={})=>{const J=R.current?getComputedStyle(R.current).pointerEvents==="none":!1;y.settings.autoRefresh&&R.current.scrollTop<16&&(_||window.__IDLE__)&&!Ii()&&!J?V(!0):await l()&&F(!0)},[a,V,l,y.settings.autoRefresh]),xe=E();ft(_=>{if(_){const J=Date.now()-xe.current;(!xe.current||J>1e3*60)&&Ie({disableIdleCheck:!0})}else xe.current=Date.now();z(_)},[l,Ie,y.settings.autoRefresh]),Sn(Ie,T&&!A?f:null);const we=Y==="end"&&!M;return e("div",{id:`${a}-page`,class:"deck-container",ref:_=>{R.current=_,fe.current=_,ye.current=_,Z.current=_},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{hidden:we,onClick:_=>{var J;_.target.closest("a, button")||(J=R.current)==null||J.scrollTo({top:0,behavior:"smooth"})},onDblClick:_=>{_.target.closest("a, button")||V(!0)},class:C==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),p??e(K,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!g&&g})]}),v.length>0&&C!=="loading"&&!we&&A&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var _;V(!0),(_=R.current)==null||_.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!r&&e("div",{class:`timeline-start ${C==="loading"?"loading":""}`,children:r}),v.length?e(x,{children:[e("ul",{class:`timeline ${b?`timeline-${b}`:""}`,children:[v.map(_=>e(vi,{status:_,instance:i,useItemID:d,allowFilters:m,view:b},_.id+(_==null?void 0:_._pinned))),P&&C==="loading"&&(b==="media"?null:e(x,{children:[e("li",{style:{height:"20vh"},children:e(Le,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(Le,{skeleton:!0})})]}))]}),C==="default"&&(P?e(at,{onChange:_=>{_&&V()},children:e("button",{type:"button",class:"plain block",onClick:()=>V(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):C==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((_,J)=>b==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e(Le,{skeleton:!0})},J))}):C!=="error"&&e("p",{class:"ui-state",children:o}),C==="error"&&e("p",{class:"ui-state",children:[s,e("br",{}),e("br",{}),e("button",{class:"button plain",onClick:()=>V(!v.length),children:"Try again"})]})]})})}function vi({status:t,instance:n,useItemID:a,allowFilters:i,view:o}){const{id:s,reblog:d,items:c,type:u,_pinned:l}=t,f=(d==null?void 0:d.id)||s,p=n?`/${n}/s/${f}`:`/s/${f}`;let g="";u==="boosts"?g=`${c.length} Boosts`:u==="pinned"&&(g="Pinned posts");const r=u==="boosts"||u==="pinned";if(c){if(r)return c.sort((b,y)=>b._filtered&&!y._filtered?1:!b._filtered&&y._filtered?-1:0),e("li",{class:"timeline-item-carousel",children:e(ki,{title:g,class:`${u}-carousel`,children:c.map(b=>{const{id:y,reblog:v}=b,I=(v==null?void 0:v.id)||y,C=n?`/${n}/s/${I}`:`/s/${I}`;return e("li",{children:e(K,{class:"status-carousel-link timeline-item-alt",to:C,children:a?e(Le,{statusID:y,instance:n,size:"s",contentTextWeight:!0,allowFilters:i}):e(Le,{status:b,instance:n,size:"s",contentTextWeight:!0,allowFilters:i})})},y)})})},`timeline-${s}`);const h=c.length>3;return c.map((b,y)=>{const{id:v,_differentAuthor:I}=b,C=n?`/${n}/s/${v}`:`/s/${v}`,L=y>0&&y<c.length-1,P=b.sensitive&&!!b.spoilerText,W=!I&&P&&y>0||h&&L&&(u==="thread"||u==="conversation"&&!I&&!c[y-1]._differentAuthor&&!c[y+1]._differentAuthor);return e("li",{class:`timeline-item-container timeline-item-container-type-${u} timeline-item-container-${y===0?"start":y===c.length-1?"end":"middle"} ${I?"timeline-item-diff-author":""}`,children:e(K,{class:"status-link timeline-item",to:C,children:W?e(Si,{status:b,instance:n}):a?e(Le,{statusID:v,instance:n,allowFilters:i}):e(Le,{status:b,instance:n,allowFilters:i})})},`timeline-${v}`)})}const m=`timeline-${s+l}`;return o==="media"?a?e(pn,{class:"timeline-item",parent:"li",statusID:s,instance:n,allowFilters:i},m):e(pn,{class:"timeline-item",parent:"li",status:t,instance:n,allowFilters:i},m):e("li",{children:e(K,{class:"status-link timeline-item",to:p,children:a?e(Le,{statusID:s,instance:n,allowFilters:i}):e(Le,{status:t,instance:n,allowFilters:i})})},m)}function ki({title:t,class:n,children:a}){const i=E(),{reachStart:o,reachEnd:s,init:d}=Lt({scrollableRef:i,direction:"horizontal"});return N(()=>{d==null||d()},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{type:"button",class:"small plain2",disabled:o,onClick:()=>{var c,u;(u=i.current)==null||u.scrollBy({left:-Math.min(320,(c=i.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var c,u;(u=i.current)==null||u.scrollBy({left:Math.min(320,(c=i.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:i,children:a})]})}function Si({status:t,instance:n}){const a=he(k),{id:i,visibility:o}=t,s=Rn(t),d=ht(i,n);return e("article",{class:`status compact-thread ${o==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[a.statusThreadNumber[d]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),a.statusThreadNumber[d]?` ${a.statusThreadNumber[d]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:s,children:[s,t.sensitive&&t.spoilerText&&e(x,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function Ii(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const st=20,Wt=1983,mn=`${Wt}-01`,Ti=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function Ci(t){var i;const{masto:n}=q({instance:t}),a=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((i=a==null?void 0:a.statuses)!=null&&i.length)}const $i=ot(Ci);function xi(){const t=he(k),{id:n,...a}=tt(),[i,o]=Fe(),s=i.get("month"),d=!i.get("replies"),c=!!i.get("boosts"),u=i.get("tagged"),l=!!i.get("media"),{masto:f,instance:p,authenticated:g}=q({instance:a.instance}),r=E(),m=[s,d,c,u,l],[h,b]=$(),y=E(0);N(()=>{y.current=0},m);const v=ue(()=>p===q().instance,[p]),[I,C]=$(!1);N(()=>{v&&h!=null&&h.acct&&(async()=>{const Y=await $i(p);C(Y)})()},[p,v,h==null?void 0:h.acct]);async function L(Y){var Ie,xe,we;const M=/^\d{4}-[01]\d$/.test(s),O=((xe=(Ie=s==null?void 0:s.split)==null?void 0:Ie.call(s,"-"))==null?void 0:xe[0])>=Wt;if(M&&O){if(!h)return{value:[],done:!0};const[_,J]=s.split("-"),Q=parseInt(J,10)-1,H=new Date(_,Q,0),ee=`${H.getFullYear()}-${(H.getMonth()+1).toString().padStart(2,"0")}-${H.getDate().toString().padStart(2,"0")}`,ie=new Date(_,Q+1,1),ae=`${ie.getFullYear()}-${(ie.getMonth()+1).toString().padStart(2,"0")}-${ie.getDate().toString().padStart(2,"0")}`;let S;Y?(S=st+1,y.current=0):(S=st+y.current+1,y.current+=st);const D=await f.v2.search.fetch({q:`from:${h.acct} after:${ee} before:${ae}`,type:"statuses",limit:S,offset:y.current});if((we=D==null?void 0:D.statuses)!=null&&we.length){const X=D.statuses.slice(0,st);X.forEach(pe=>{$e(pe,p)});const se=D.statuses.length<=st;return{value:X,done:se}}else return{value:[],done:!0}}const G=[];if(Y){const{value:_}=await f.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(_!=null&&_.length&&!u&&!l)if(_.forEach(J=>{J._pinned=!0,$e(J,p)}),_.length>=3){const J=_.map(Q=>Q.id);G.push({id:J,items:_,type:"pinned"})}else G.push(..._)}(Y||!r.current)&&(r.current=f.v1.accounts.$select(n).statuses.list({limit:st,exclude_replies:d,exclude_reblogs:c,only_media:l,tagged:u}));const{value:ce,done:me}=await r.current.next();return ce!=null&&ce.length&&(G.push(...ce),ce.forEach(_=>{$e(_,p)})),{value:G,done:me}}const[P,W]=$([]);Ae(h!=null&&h.acct?`${h!=null&&h.displayName?h.displayName+" ":""}@${h.acct}${d?c?" (- Boosts)":u?` (#${u})`:l?" (Media)":s?` (${new Date(s).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const A=E(),F=qe(()=>{const Y=A.current||f.v1.accounts.$select(n).fetch();return A.current=Y,Y},[n,f]);N(()=>{(async()=>{try{const Y=await F();b(Y)}catch{}try{const Y=await f.v1.accounts.$select(n).featuredTags.list();W(Y)}catch{}})()},[n]);const{displayName:T,acct:z,emojis:R}=h||{},U=ue(()=>{const Y=t.accounts[`${n}@${p}`];return e(Hn,{instance:p,account:Y||n,fetchAccount:F,authenticated:g,standalone:!0})},[n,p,g,F]),V=E(),le=ue(()=>e(x,{children:[U,e("div",{class:"filter-bar",ref:V,style:{position:"relative"},children:[!d||c||u||l||!!s?e(K,{to:`/${p}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(K,{to:`/${p}/a/${n}${d?"?replies=1":""}`,onClick:()=>{d&&re("Showing post with replies")},class:d?"":"is-active",children:"+ Replies"}),e(K,{to:`/${p}/a/${n}${c?"":"?boosts=0"}`,onClick:()=>{c||re("Showing posts without boosts")},class:c?"is-active":"",children:"- Boosts"}),e(K,{to:`/${p}/a/${n}${l?"":"?media=1"}`,onClick:()=>{l||re("Showing posts with media")},class:l?"is-active":"",children:"Media"}),P.map(M=>e(K,{to:`/${p}/a/${n}${u===M.name?"":`?tagged=${encodeURIComponent(M.name)}`}`,onClick:()=>{u!==M.name&&re(`Showing posts tagged with #${M.name}`)},class:u===M.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),M.name]})},M.id)),I&&(Ti?e("label",{class:`filter-field ${s?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(h!=null&&h.acct),value:s||"",min:mn,max:new Date().toISOString().slice(0,7),onInput:M=>{const{value:O,validity:G}=M.currentTarget;G.valid&&(o(O?{month:O}:{}),re(`Showing posts in ${new Date(O).toLocaleString("default",{month:"long",year:"numeric"})}`))}})]}):e(Li,{class:`filter-field ${s?"is-active":""}`,disabled:!(h!=null&&h.acct),value:s||"",min:mn,max:new Date().toISOString().slice(0,7),onInput:M=>{const{value:O,validity:G}=M;G.valid&&o(O?{month:O}:{})}}))]})]}),[n,p,g,P,I,...m]);N(()=>{var M;const Y=(M=V.current)==null?void 0:M.querySelector(".is-active");Y&&V.current.scrollTo({behavior:"smooth",left:Y.offsetLeft-(V.current.offsetWidth-Y.offsetWidth)/2})},[P,I,...m]);const fe=ue(()=>h!=null&&h.url?new URL(h.url).hostname:null,[h]),Z=!!h&&!(p===fe);return e(Ve,{title:`${h!=null&&h.acct?"@"+h.acct:"Posts"}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(Cn,{text:T,emojis:R})}),e("div",{children:e("span",{children:["@",z]})})]}),id:"account-statuses",instance:p,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:L,useItemID:!0,view:l?"media":void 0,boostsCarousel:t.settings.boostsCarousel,timelineStart:le,refresh:[d,c,u,l,s+(h==null?void 0:h.acct)].toString(),headerEnd:e(pt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(te,{disabled:!Z,onClick:()=>{(async()=>{try{const{masto:Y}=q({instance:fe}),M=await Y.v1.accounts.lookup({acct:h.acct}),{id:O}=M;location.hash=`/${fe}/a/${O}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:fe}),")"]})]})})},n)}function Li(t){const{class:n,disabled:a,value:i,min:o,max:s,onInput:d=()=>{}}=t,[c,u]=(i==null?void 0:i.split("-"))||[],l=E(),f=E(),p=(g,r)=>{const[m,h]=(o==null?void 0:o.split("-"))||[],[b,y]=(s==null?void 0:s.split("-"))||[];return!(r<m||r>b||r===m&&g<h||r===b&&g>y)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:l,disabled:a,value:u||"",onInput:g=>{const{value:r}=g.currentTarget,m=f.current.value;if(!p(r,m))return{value:"",validity:{valid:!1}};d({value:r?`${m}-${r}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(g,r)=>e("option",{value:(r+1).toString().padStart(2,"0"),children:new Date(0,r).toLocaleString("default",{month:"long"})},r))]})," ",e("input",{ref:f,type:"number",disabled:a,value:c||new Date().getFullYear(),min:(o==null?void 0:o.slice(0,4))||Wt,max:(s==null?void 0:s.slice(0,4))||new Date().getFullYear(),onInput:g=>{const{value:r,validity:m}=g.currentTarget,h=l.current.value;if(!m.valid||!p(h,r))return{value:"",validity:{valid:!1}};d({value:r?`${r}-${h}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const Ai=20;function Yn(){Ae("Bookmarks","/b");const{masto:t,instance:n}=q(),a=E();async function i(o){return(o||!a.current)&&(a.current=t.v1.bookmarks.list({limit:Ai})),await a.current.next()}return e(Ve,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:i})}const Ri=20;function Jn(){Ae("Likes","/f");const{masto:t,instance:n}=q(),a=E();async function i(o){return(o||!a.current)&&(a.current=t.v1.favourites.list({limit:Ri})),await a.current.next()}return e(Ve,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:i})}const Mi=200;function Ei(){const{masto:t,instance:n}=q();Ae("Followed Hashtags","/ft");const[a,i]=$("default"),[o,s]=$([]);return N(()=>{i("loading"),(async()=>{try{const d=t.v1.followedTags.list({limit:Mi}),c=[];do{const{value:u,done:l}=await d.next();if(l||(u==null?void 0:u.length)===0)break;c.push(...u)}while(!0);c.sort((u,l)=>u.name.localeCompare(l.name)),s(c),i("default")}catch{i("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),e(K,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:o.length>0?e("ul",{class:"link-list",children:o.map(d=>e("li",{children:e(K,{to:n?`/${n}/t/${d.name}`:`/t/${d.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:d.name})]})}))}):a==="loading"?e("p",{class:"ui-state",children:e(Se,{abrupt:!0})}):a==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function Di(t,n,a){var u;const{filtered:i}=t;if(!(i!=null&&i.length)||a&&((u=t.account)==null?void 0:u.id)===a)return!0;const s=i.filter(l=>{const{filter:f}=l,p=f.context.includes(n);return p?f.expiresAt?new Date(f.expiresAt)>new Date:p:!1});if(!s.length)return!0;if(s.some(l=>l.filter.filterAction==="hide"))return!1;const c=s.some(l=>l.filter.filterAction==="warn");if(c){const l=s.map(f=>f.filter.title);t._filtered={titles:l,titlesStr:l.join(" • ")}}return c}function Je(t,n){if(!(t!=null&&t.length))return[];if(!n)return t;const a=ne.session.get("currentAccount");return t.filter(i=>Di(i,n,a))}const _i=20;function Kt({title:t,path:n,id:a,...i}){Ae(t||"Following",n||"/following");const{masto:o,streaming:s,instance:d}=q(),c=he(k),u=E(),l=E();async function f(g){(g||!u.current)&&(u.current=o.v1.timelines.home.list({limit:_i}));const r=await u.current.next();let{value:m}=r;return m!=null&&m.length&&(g&&(l.current=m[0].id),m=Je(m,"home"),m.forEach(h=>{$e(h,d)}),m=fn(m,d),m.sort((h,b)=>{const y=new Date(h.createdAt);return new Date(b.createdAt)-y})),{...r,value:m}}async function p(){try{const g=await o.v1.timelines.home.list({limit:5,since_id:l.current}).next();let{value:r}=g;return!!(r!=null&&r.length&&(l.current=r[0].id,r=fn(r,d),r=Je(r,"home"),r.some(m=>!m.reblog)))}catch{return!1}}return N(()=>{let g;return(async()=>{if(s){g=s.user.subscribe();for await(const r of g){if(!g)break;if(r.event==="status.update"){const m=r.payload;$e(m,d)}else if(r.event==="delete"){const m=r.payload,h=Mn(m,d);h&&(h._deleted=!0)}}}})(),()=>{var r;(r=g==null?void 0:g.unsubscribe)==null||r.call(g),g=null}},[s]),e(Ve,{title:t||"Following",id:a||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:d,fetchItems:f,checkForUpdates:p,useItemID:!0,boostsCarousel:c.settings.boostsCarousel,...i,allowFilters:!0})}const Pi=20,Ni=4,gn=Ni+1;function Xn({media:t,columnMode:n,...a}){let{hashtag:i,...o}=n?{}:tt();a.hashtag&&(i=a.hashtag);let s=i.trim().split(/[\s+]+/);s.sort(),i=s[0];const[d,c]=Fe(),u=t||!!d.get("media"),l=u?"?media=1":"",{masto:f,instance:p,authenticated:g}=q({instance:(a==null?void 0:a.instance)||o.instance}),{authenticated:r}=q(),m=s.map(T=>`#${T}`).join(" "),h=u?" (Media only)":"",b=p?`${m}${h} on ${p}`:`${m}${h}`;Ae(b,"/:instance?/t/:hashtag");const y=E(),v=E(void 0);async function I(T){const z=await f.v1.timelines.tag.$select(i).list({limit:Pi,any:s.slice(1),maxId:T?void 0:v.current,onlyMedia:u}).next(),{value:R}=z;return R!=null&&R.length&&(T&&(y.current=R[0].id),R.forEach(U=>{$e(U,p,{skipThreading:u})}),v.current=R[R.length-1].id),{...z,value:R}}async function C(){try{const T=await f.v1.timelines.tag.$select(i).list({limit:1,any:s.slice(1),since_id:y.current,onlyMedia:u}).next(),{value:z}=T;return!!(z!=null&&z.length)}catch{return!1}}const[L,P]=$("default"),[W,A]=$();N(()=>{(async()=>{try{const T=await f.v1.tags.$select(i).fetch();A(T)}catch{}})()},[i]);const F=s.length>=gn;return e(Ve,{title:b,titleComponent:!!p&&e("h1",{class:"header-double-lines",children:[e("b",{children:m}),e("div",{children:p})]}),id:"hashtag",instance:p,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:I,checkForUpdates:C,useItemID:!0,view:u?"media":void 0,refresh:u,headerEnd:e(pt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!W&&s.length===1&&e(x,{children:[e(Ue,{subMenu:!0,confirm:W.following,confirmLabel:`Unfollow #${i}?`,disabled:L==="loading"||!g,onClick:()=>{P("loading"),W.following?f.v1.tags.$select(i).unfollow().then(()=>{A({...W,following:!1}),re(`Unfollowed #${i}`)}).catch(T=>{alert(T)}).finally(()=>{P("default")}):f.v1.tags.$select(i).follow().then(()=>{A({...W,following:!0}),re(`Followed #${i}`)}).catch(T=>{alert(T)}).finally(()=>{P("default")})},children:W.following?e(x,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(x,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(Me,{})]}),e(Un,{className:"plain",children:"Filters"}),e(te,{type:"checkbox",checked:!!u,onClick:()=>{u?d.delete("media"):d.set("media","1"),c(d)},children:[e(w,{icon:"check-circle"})," ",e("span",{class:"menu-grow",children:"Media only"})]}),e(Me,{}),e(Ss,{className:"menu-field",disabled:F,children:({ref:T})=>e("form",{onSubmit:z=>{var U,V;z.preventDefault();const R=(V=(U=z.target[0].value)==null?void 0:U.trim)==null?void 0:V.call(U);R&&!s.some(le=>le.toLowerCase()===R.toLowerCase())&&(s.push(R),s.sort(),location.hash=p?`/${p}/t/${s.join("+")}`:`/t/${s.join("+")}${l}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:T,type:"text",placeholder:F?`Max ${gn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:F})]})}),e(Is,{takeOverflow:!0,children:s.map((T,z)=>e(te,{disabled:s.length===1,onClick:R=>{s.splice(z,1),s.sort(),location.hash=p?`/${p}/t/${s.join("+")}${l}`:`/t/${s.join("+")}${l}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),T]})]},T))}),e(Me,{}),e(te,{disabled:!r,onClick:()=>{if(k.shortcuts.length>=Ye){alert(`Max ${Ye} shortcuts reached. Unable to add shortcut.`);return}const T={type:"hashtag",hashtag:s.join(" "),instance:p,media:u?"on":void 0};k.shortcuts.some(R=>R.type===T.type&&R.hashtag.split(/[\s+]+/).sort().join(" ")===T.hashtag.split(/[\s+]+/).sort().join(" ")&&(R.instance?R.instance===T.instance:!0)&&(R.media?!!R.media==!!T.media:!0))?alert("This shortcut already exists"):(k.shortcuts.push(T),re("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(te,{onClick:()=>{let T=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(T)){T&&alert("Invalid instance");return}T&&(T=T.toLowerCase().trim(),location.hash=`/${T}/t/${s.join("+")}${l}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},p+m)}const Ui=20;function Zn(t){var h;const n=he(k),{masto:a,instance:i}=q(),o=(t==null?void 0:t.id)||((h=tt())==null?void 0:h.id),s=E(),d=E();async function c(b){(b||!d.current)&&(d.current=a.v1.timelines.list.$select(o).list({limit:Ui}));const y=await d.current.next();let{value:v}=y;return v!=null&&v.length&&(b&&(s.current=v[0].id),v=Je(v,"home"),v.forEach(I=>{$e(I,i)})),{...y,value:v}}async function u(){try{const b=await a.v1.timelines.list.$select(o).list({limit:1,since_id:s.current});let{value:y}=b;return y=Je(y,"home"),!!(y!=null&&y.length)}catch{return!1}}const[l,f]=$({title:"List"});Ae(l.title,"/l/:id"),N(()=>{(async()=>{try{const b=await a.v1.lists.$select(o).fetch();f(b)}catch{}})()},[o]);const[p,g]=$(!1),[r,m]=$(!1);return e(x,{children:[e(Ve,{title:l.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:i,fetchItems:c,checkForUpdates:u,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:e(K,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(pt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(te,{onClick:()=>g({list:l}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(te,{onClick:()=>m(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},o),p&&e(ke,{class:"light",onClick:b=>{b.target===b.currentTarget&&g(!1)},children:e(jt,{list:p==null?void 0:p.list,onClose:b=>{b.state==="success"&&b.list?f(b.list):b.state==="deleted"&&(location.hash="/l"),g(!1)}})}),r&&e(ke,{class:"light",onClick:b=>{b.target===b.currentTarget&&m(!1)},children:e(Fi,{listID:o,onClose:()=>m(!1)})})]})}const zi=40;function Fi({listID:t,onClose:n}){const{masto:a,instance:i}=q(),[o,s]=$([]),[d,c]=$("default"),[u,l]=$(!1),f=E();async function p(g){l(!1),c("loading"),(async()=>{try{(g||!f.current)&&(f.current=a.v1.lists.$select(t).accounts.list({limit:zi}));const r=await f.current.next();let{done:m,value:h}=r;h!=null&&h.length?(s(g?h:o.concat(h)),l(!m)):l(!1),c("default")}catch{c("error")}})()}return N(()=>{p(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[o.map(g=>e("li",{children:[e(Oe,{account:g,instance:i}),e(Bi,{account:g,listID:t})]},g.id)),u&&d==="default"&&e(at,{as:"li",onChange:g=>g&&p(),children:e("button",{type:"button",class:"light block",onClick:p,children:"Show more…"})})]})})]})}function Bi({account:t,listID:n}){const{masto:a}=q(),[i,o]=$("default"),[s,d]=$(!1);return e(Ue,{confirm:!s,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(o("loading"),(async()=>{try{await a.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),o("default"),d(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await a.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),o("default"),d(!0)}catch{o("error")}})())},children:e("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:i==="loading",children:s?"Add":"Remove…"})})}const bn=20,Oi=new URLSearchParams;function Qn({columnMode:t,...n}){const{masto:a,instance:i}=q(),[o]=t?[Oi]:Fe(),[s,d]=$(null),c=(n==null?void 0:n.type)||o.get("type")||s;Ae(`Mentions${c==="private"?" (Private)":""}`,"/mentions");const u=E(),l=E();async function f(y){(y||!u.current)&&(u.current=a.v1.notifications.list({limit:bn,types:["mention"]}));const v=await u.current.next();let{value:I}=v;return I!=null&&I.length&&(y&&(l.current=I[0].id),I.forEach(({status:C})=>{$e(C,i)})),{...v,value:I==null?void 0:I.map(C=>C.status)}}const p=E(),g=E();async function r(y){(y||!p.current)&&(p.current=a.v1.conversations.list({limit:bn}));const v=await p.current.next();let{value:I}=v;return I=I==null?void 0:I.filter(C=>C.lastStatus),I!=null&&I.length&&(y&&(g.current=I[0].lastStatus.id),I.forEach(({lastStatus:C})=>{$e(C,i)})),{...v,value:I==null?void 0:I.map(C=>C.lastStatus)}}function m(...y){return c==="private"?r(...y):f(...y)}async function h(){if(c==="private")try{const y=await a.v1.conversations.list({limit:1,since_id:g.current}).next();let{value:v}=y;return v!=null&&v.length?(g.current=v[0].lastStatus.id,!0):!1}catch{return!1}else try{const y=await a.v1.notifications.list({limit:1,types:["mention"],since_id:l.current}).next();let{value:v}=y;return v!=null&&v.length?(l.current=v[0].id,!0):!1}catch{return!1}}const b=ue(()=>e("div",{class:"filter-bar centered",children:[e(K,{to:"/mentions",class:c?"":"is-active",onClick:y=>{t&&(y.preventDefault(),d(null))},children:"All"}),e(K,{to:"/mentions?type=private",class:c==="private"?"is-active":"",onClick:y=>{t&&(y.preventDefault(),d("private"))},children:"Private"})]}),[c]);return e(Ve,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:i,fetchItems:m,checkForUpdates:h,useItemID:!0,timelineStart:b,refresh:c})}const qi={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function Hi(t){return t.filter(n=>{const{type:a,id:i,createdAt:o}=n;if(!a)return!1;const s=qi[a];return s!=null&&s.length?s.every(d=>!!n[d]):!0})}function es(t){t=Hi(t);const n={},a=[];for(let s=0,d=0;s<t.length;s++){const c=t[s],{id:u,status:l,account:f,type:p,createdAt:g}=c,r=g?new Date(g).toLocaleDateString():"";let m=p;(p==="favourite"||p==="reblog")&&(m="favourite+reblog");const h=`${l==null?void 0:l.id}-${m}-${r}`,b=n[h];if(m==="follow_request")a[d++]=c;else if(b!=null&&b.account){const y=b._accounts.find(v=>v.id===f.id);y?(y._types.push(p),y._types.sort().reverse(),b.id+=`-${u}`):(f._types=[p],b._accounts.push(f),b.id+=`-${u}`)}else{f._types=[p];let y=n[h]={...c,type:m,_accounts:[f]};a[d++]=y}}const i={},o=[];for(let s=0,d=0;s<a.length;s++){const c=a[s],{id:u,account:l,_accounts:f,type:p,createdAt:g}=c,r=g?new Date(g).toLocaleDateString():"";if(p==="favourite+reblog"&&l&&f.length===1){const m=`${l==null?void 0:l.id}-${p}-${r}`,h=i[m];if(h)h._statuses.push(c.status),h.id+=`-${u}`;else{let b=i[m]={...c,type:p,_statuses:[c.status]};o[d++]=b}}else o[d++]=c}return o}const Vi=30,ji=new URLSearchParams;function Gi({columnMode:t}){Ae("Notifications","/notifications");const{masto:n,instance:a}=q(),i=he(k),[o,s]=$("default"),[d]=t?[ji]:Fe(),c=d.get("id"),u=d.get("access_token"),[l,f]=$(!1),[p,g]=$(!1),r=E(),{nearReachEnd:m,scrollDirection:h,reachStart:b,nearReachStart:y}=Lt({scrollableRef:r}),v=h==="end"&&!y,[I,C]=$([]),[L,P]=$([]),W=E();async function A(M){k.notificationsShowNew=!1,(M||!W.current)&&(W.current=n.v1.notifications.list({limit:Vi,excludeTypes:["follow_request"]}));const O=await W.current.next(),G=O.value;if(G!=null&&G.length){G.forEach(me=>{$e(me.status,a,{skipThreading:!0})});const ce=es(G);M?(k.notificationsLast=G[0],k.notifications=ce,n.v1.markers.create({notifications:{lastReadId:G[0].id}}).catch(()=>{})):k.notifications.push(...ce)}return k.notificationsLastFetchTime=Date.now(),O}async function F(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const T=()=>{s("loading"),(async()=>{try{const M=await F();C(M),s("default")}catch{s("error")}})()};async function z(){try{return await n.v1.announcements.list()}catch{return[]}}const R=M=>{s("loading"),(async()=>{try{const O=A(M),G=F(),ce=z();if(M){const Ie=await ce;Ie.sort((we,_)=>{const J=new Date(we.updatedAt||we.createdAt);return new Date(_.updatedAt||_.createdAt)-J}),P(Ie);const xe=await G;C(xe)}const{done:me}=await O;f(!me),s("default")}catch{s("error")}})()};N(()=>{R(!0)},[]),N(()=>{b&&R(!0)},[b]);const U=qe(({disableIdleCheck:M=!1}={})=>{var O;i.settings.autoRefresh&&((O=r.current)==null?void 0:O.scrollTop)<16&&(M||window.__IDLE__)&&!Wi()&&i.notificationsShowNew&&o!=="loading"&&R(!0)},[i.notificationsShowNew,i.settings.autoRefresh,o]),V=E();ft(M=>{let O;if(M){const G=Date.now()-V.current;!V.current||G>1e3*60?U({disableIdleCheck:!0}):V.current=Date.now(),O=Ts(k,"notificationsShowNew",ce=>{ce&&U()})}return()=>{O==null||O()}});const le=new Date,fe=new Date(le-24*60*60*1e3);let ye=new Date;const Z=!i.notifications.some(M=>new Date(M.createdAt).toDateString()===le.toDateString()),Y=E();return N(()=>{c&&(k.routeNotification={id:c,accessToken:atob(u)})},[c,u]),e("div",{id:"notifications-page",class:"deck-container",ref:r,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${p?"only-mentions":""}`,children:[e("header",{hidden:v,onClick:M=>{var O;M.target.closest("a, button")||(O=r.current)==null||O.scrollTo({top:0,behavior:"smooth"})},class:o==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),e(K,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),i.notificationsShowNew&&o!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var M;R(!0),(M=r.current)==null||M.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),L.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",L.length>1?"s":""]})," ",e("small",{class:"insignificant",children:a})]}),L.length>1&&e("span",{class:"announcements-nav-buttons",children:L.map((M,O)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var G;(G=Y.current)==null||G.children[O].scrollIntoView({behavior:"smooth",block:"nearest"})},children:O+1}))})]}),e("ul",{class:`announcements-list-${L.length>1?"multiple":"single"}`,ref:Y,children:L.map(M=>e("li",{children:e(Ki,{announcement:M})}))})]})})}),I.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),I.length>5?e("details",{children:[e("summary",{children:[I.length," follow requests"]}),e("ul",{children:I.map(M=>e("li",{children:[e(Oe,{account:M}),e(Ut,{accountID:M.id,onChange:()=>{}})]},M.id))})]}):e("ul",{children:I.map(M=>e("li",{children:[e(Oe,{account:M}),e(Ut,{accountID:M.id,onChange:()=>{}})]},M.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:p,onChange:M=>{g(M.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),Z&&!!i.notifications.length&&e("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":e(x,{children:"…"})}),i.notifications.length?e(x,{children:i.notifications.filter(M=>M.type!=="follow_request").map(M=>{if(p&&M.type!=="mention")return null;const O=new Date(M.createdAt),G=O.toDateString()!==ye.toDateString();G&&(ye=O);const ce=O.toDateString()===fe.toDateString()?"Yesterday":Ke(ye,{hideTime:!0});return e(x,{children:[G&&e("h2",{class:"timeline-header",children:ce}),e(Gt,{instance:a,notification:M},M.id)]},M.id)})}):e(x,{children:[o==="loading"&&e(x,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((M,O)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),o==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>R(!0),children:"Try again"})]})]}),l&&e(at,{onChange:M=>{M&&R()},children:e("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>R(),style:{marginBlockEnd:"6em"},children:o==="loading"?e(Se,{abrupt:!0}):e(x,{children:"Show more…"})})})]})})}function Wi(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Ki({announcement:t}){const{instance:n}=q(),{contact:a}=hs(),i=a==null?void 0:a.account,{id:o,content:s,startsAt:d,endsAt:c,published:u,allDay:l,publishedAt:f,updatedAt:p,read:g,mentions:r,statuses:m,tags:h,emojis:b,reactions:y}=t,v=new Date(f),I=Ke(v),C=new Date(p),L=Ke(C);return e("div",{class:"announcement-block",children:[e(Oe,{account:i}),e("div",{class:"announcement-content",onClick:Tn({mentions:r,instance:n}),dangerouslySetInnerHTML:{__html:_t(s,{emojis:b})}}),e("p",{class:"insignificant",children:[e("time",{datetime:v.toISOString(),children:Ke(v)}),p&&L!==I&&e(x,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:C.toISOString(),children:Ke(C)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:y.map(P=>{const{name:W,count:A,me:F,staticUrl:T,url:z}=P;return e("button",{type:"button",class:`plain4 small ${F?"reacted":""}`,children:[z||T?e("img",{src:z||T,alt:W,width:"16",height:"16"}):e("span",{children:W})," ",e("span",{class:"count",children:_e(A)})]})})})]})}const ts=ze(Gi),Yi=20;function zt({local:t,columnMode:n,...a}){const i=he(k),o=!!t,s=n?{}:tt(),{masto:d,instance:c}=q({instance:(a==null?void 0:a.instance)||s.instance}),u=`${o?"Local":"Federated"} timeline (${c})`;Ae(u,o?"/:instance?/p/l":"/:instance?/p");const l=E(),f=E();async function p(r){(r||!f.current)&&(f.current=d.v1.timelines.public.list({limit:Yi,local:o}));const m=await f.current.next();let{value:h}=m;return h!=null&&h.length&&(r&&(l.current=h[0].id),h=Je(h,"public"),h.forEach(b=>{$e(b,c)})),{...m,value:h}}async function g(){try{const r=await d.v1.timelines.public.list({limit:1,local:o,since_id:l.current}).next();let{value:m}=r;return m=Je(m,"public"),!!(m!=null&&m.length)}catch{return!1}}return e(Ve,{title:u,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:o?"Local timeline":"Federated timeline"}),e("div",{children:c})]}),id:"public",instance:c,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:p,checkForUpdates:g,useItemID:!0,headerStart:e(x,{}),boostsCarousel:i.settings.boostsCarousel,allowFilters:!0,headerEnd:e(pt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(te,{href:o?`/#/${c}/p`:`/#/${c}/p/l`,children:o?e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(Me,{}),e(te,{onClick:()=>{let r=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(r)){r&&alert("Invalid instance");return}r&&(r=r.toLowerCase().trim(),location.hash=o?`/${r}/p/l`:`/${r}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},c+o)}const Ji=20,Xi=ot(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function ns({columnMode:t,...n}){const a=he(k),i=t?{}:tt(),{masto:o,instance:s}=q({instance:(n==null?void 0:n.instance)||i.instance}),d=`Trending (${s})`;Ae(d,"/:instance?/trending");const c=E(),[u,l]=$([]),[f,p]=$([]),g=E();async function r(b){var I;if(b||!g.current){g.current=o.v1.trends.statuses.list({limit:Ji});try{const C=o.v1.trends.tags.list(),{value:L}=await C.next();L!=null&&L.length&&l(L)}catch{}try{const{value:C}=await Xi(o),L=(I=C==null?void 0:C.filter)==null?void 0:I.call(C,P=>P.type==="link");L!=null&&L.length&&p(L)}catch{}}const y=await g.current.next();let{value:v}=y;return v!=null&&v.length&&(b&&(c.current=v[0].id),v=Je(v,"public"),v.forEach(C=>{$e(C,s)})),{...y,value:v}}async function m(){try{const b=await o.v1.trends.statuses.list({limit:1}).next();let{value:y}=b;return y=Je(y,"public"),y!=null&&y.length&&y[0].id!==c.current?(c.current=y[0].id,!0):!1}catch{return!1}}const h=ue(()=>e(x,{children:[!!u.length&&e("div",{class:"filter-bar expandable",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),u.map((b,y)=>{const{name:v,history:I}=b,C=I.reduce((L,P)=>L+ +P.uses,0);return e(K,{to:`/${s}/t/${v}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),v]}),e("span",{class:"filter-count",children:_e(C)})]},v)})]}),!!f.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),f.map(b=>{const{authorName:y,authorUrl:v,blurhash:I,description:C,height:L,image:P,imageDescription:W,language:A,providerName:F,providerUrl:T,publishedAt:z,title:R,url:U,width:V}=b,le=new URL(U).hostname.replace(/^www\./,"").replace(/\/$/,"");let fe;if(I){const ye=En(I),Z=Vn(ye);fe=jn([.6,Z[1],Z[2]])}return e("a",{href:U,target:"_blank",rel:"noopener noreferrer",style:fe?{"--accent-color":`rgb(${fe.join(",")})`,"--accent-alpha-color":`rgba(${fe.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:P,alt:W,width:V,height:L,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:le})," ",!!z&&e(x,{children:"· "}),!!z&&e(x,{children:e(Ct,{datetime:z,format:"micro"})})]}),!!R&&e("h1",{class:"title",lang:A,dir:"auto",children:R})]}),!!C&&e("p",{class:"description",lang:A,dir:"auto",children:C})]})]})},U)})]})]}),[u,f]);return e(Ve,{title:d,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:"Trending"}),e("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:r,checkForUpdates:m,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(x,{}),boostsCarousel:a.settings.boostsCarousel,allowFilters:!0,timelineStart:h,headerEnd:e(pt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(te,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})})},s)}function Zi(){Ae("Home","/");const t=he(k),{shortcuts:n}=t,a=n.map(i=>{if(!i)return null;const{type:o,...s}=i,d={following:Kt,notifications:ts,list:Zn,public:zt,bookmarks:Yn,favourites:Jn,hashtag:Xn,mentions:Qn,trending:ns}[o];return d?e(d,{...s,columnMode:!0},o+JSON.stringify(s)):null});return Ce(["1","2","3","4","5","6","7","8","9"],(i,o)=>{try{const s=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),e("div",{id:"columns",children:a})}function Qi(){var n;const t=he(k);return N(()=>{(async()=>{const a=await lt.drafts.keys();if(a.length){const i=xn();a.filter(s=>s.startsWith(i)).length&&(k.showDrafts=!0)}})()},[]),e(x,{children:(t.settings.shortcutsColumnsMode||t.settings.shortcutsViewMode==="multi-column")&&((n=t.shortcuts)!=null&&n.length)?e(Zi,{}):e(Kt,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(eo,{})})})}function eo(){const t=he(k),n=E(),[a,i]=$(void 0);return e(x,{children:[e(K,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${a||""}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),i(s=>s?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(so,{state:a,anchorRef:n,onClose:()=>i(void 0)})]})}const to=30,no=5;function so({anchorRef:t,state:n,onClose:a}){const{masto:i,instance:o}=q(),s=he(k),[d,c]=$("default"),u=i.v1.notifications.list({limit:to});async function l(){const m=await u.next(),h=m.value;if(h!=null&&h.length){h.forEach(y=>{$e(y.status,o,{skipThreading:!0})});const b=es(h);k.notificationsLast=h[0],k.notifications=b,i.v1.markers.create({notifications:{lastReadId:h[0].id}}).catch(()=>{})}return k.notificationsShowNew=!1,k.notificationsLastFetchTime=Date.now(),m}const[f,p]=$(!1);function g(){return i.v1.followRequests.list({limit:1})}function r(){c("loading"),(async()=>{try{await l();const m=await g();p(!!(m!=null&&m.length)),c("default")}catch{c("error")}})()}return N(()=>{n==="open"&&r()},[n]),e(Pn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:a,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:s.notifications.length?e(x,{children:s.notifications.slice(0,no).map(m=>e(Gt,{instance:o,notification:m},m.id))}):d==="loading"?e("div",{class:"ui-state",children:e(Se,{abrupt:!0})}):d==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:r,children:"Try again"})})]})}),e("footer",{children:[e(K,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(K,{to:"/notifications",class:"button plain2",children:[f?e(x,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const io=ze(Qi),oo=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,co=/\/notes\/([^\/]+)\/?$/i;function ss(t){const{hostname:n,pathname:a}=new URL(t),[,i,o,s]=a.match(oo)||[];if(s)return`/${n}/s/${s}`;const[,d]=a.match(co)||[];if(d)return`/${n}/s/${d}`}function ao(){const n=ct().pathname.replace(/^\//,""),a=ss(n);return He(()=>{a&&setTimeout(()=>{window.location.hash=a+"?view=full"},300)},[a]),e("div",{class:"ui-state",tabIndex:"-1",children:[a?e(x,{children:[e("h2",{children:"Redirecting…"}),e("p",{children:e("a",{href:`#${a}?view=full`,children:a})})]}):e(x,{children:[e("h2",{children:"Unable to process URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(K,{to:"/",children:"Go home"})})]})}function ro(){const{masto:t}=q();Ae("Lists","/l");const[n,a]=$("default"),[i,o]=$t(l=>l+1,0),[s,d]=$([]);N(()=>{a("loading"),(async()=>{try{const l=await t.v1.lists.list();l.sort((f,p)=>f.title.localeCompare(p.title)),d(l),a("default")}catch{a("error")}})()},[i]);const[c,u]=$(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(mt,{}),e(K,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>u(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(l=>e("li",{children:e(K,{to:`/l/${l.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:l.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(Se,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),c&&e(ke,{class:"light",onClick:l=>{l.target===l.currentTarget&&u(!1)},children:e(jt,{list:c==null?void 0:c.list,onClose:l=>{l.state==="success"&&o(),u(!1)}})})]})}const lo=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:uo,VITE_WEBSITE:ho}={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Yt="read write follow push";async function fo({instanceURL:t}){const n=new URLSearchParams({client_name:uo,redirect_uris:location.origin+location.pathname,scopes:Yt,website:ho});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function po({instanceURL:t,client_id:n}){const a=new URLSearchParams({client_id:n,scope:Yt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${a.toString()}`}async function mo({instanceURL:t,client_id:n,client_secret:a,code:i}){const o=new URLSearchParams({client_id:n,client_secret:a,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:i,scope:Yt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}function go(){Ae("Log in");const t=E(),n=ne.local.get("instanceURL"),[a,i]=$("default"),[o]=Fe(),s=o.get("instance"),[d,c]=$(s||(n==null?void 0:n.toLowerCase())||""),[u,l]=$([]);N(()=>{(async()=>{try{const m=await(await fetch(lo)).json();l(m)}catch{}})()},[]);const f=r=>{ne.local.set("instanceURL",r),(async()=>{i("loading");try{const{client_id:m,client_secret:h,vapid_key:b}=await fo({instanceURL:r});m&&h?(ne.session.set("clientID",m),ne.session.set("clientSecret",h),ne.session.set("vapidKey",b),location.href=await po({instanceURL:r,client_id:m})):alert("Failed to register application"),i("default")}catch{i("error")}})()},p=r=>{r.preventDefault();const{elements:m}=r.target;let h=m.instanceURL.value.toLowerCase();h=h.replace(/^https?:\/\//,"").replace(/\/+$/,""),h=h.replace(/^@?[^@]+@/,""),/\./.test(h)||(h=u.find(b=>b.includes(h))),f(h)},g=d?u.filter(r=>r.includes(d)).sort((r,m)=>{const h=r.toLowerCase().startsWith(d.toLowerCase()),b=m.toLowerCase().startsWith(d.toLowerCase());return h&&!b?-1:!h&&b?1:0}).slice(0,10):[];return e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:p,children:[e("h1",{children:"Log in"}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:d,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:a==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:r=>{c(r.target.value)}}),(g==null?void 0:g.length)>0?e("ul",{id:"instances-suggestions",children:g.map(r=>e("li",{children:e("button",{type:"button",class:"plain4",onClick:()=>{f(r)},children:r})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),a==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{class:"large",disabled:a==="loading",children:"Log in"})," "]}),e(Se,{hidden:a!=="loading"}),e("hr",{}),e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(K,{to:"/",children:"Go home"})})]})})}const yt=5,Dt=40;function bo(t){const n=tt(),{masto:a,instance:i,authenticated:o}=q({instance:n.instance}),[s,d]=$("default"),[c]=Fe(),u=E(),l=(t==null?void 0:t.query)||c.get("q"),f=(t==null?void 0:t.type)||c.get("type");Ae(l?`Search: ${l}${f?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[f]})`:""}`:"Search","/search");const[p,g]=$(!1),r=E(0);N(()=>{r.current=0},[l,f]);const m=E();He(()=>{var A,F;(F=(A=m.current)==null?void 0:A.scrollTo)==null||F.call(A,0,0)},[l,f]);const[h,b]=$([]),[y,v]=$([]),[I,C]=$([]);N(()=>{b([]),v([]),C([])},[l]);const L={statuses:b,accounts:v,hashtags:C};function P(A){!A&&!o||(d("loading"),A&&!f&&(b(h.slice(0,yt)),v(y.slice(0,yt)),C(I.slice(0,yt))),(async()=>{var T,z;const F={q:l,resolve:o,limit:yt};f&&(F.limit=Dt,F.type=f,o&&(F.offset=r.current));try{const R=await a.v2.search.fetch(F);if(f)if(A){L[f](R[f]);const U=(T=R[f])==null?void 0:T.length;r.current=Dt,g(!!U)}else{L[f](V=>[...V,...R[f]]);const U=(z=R[f])==null?void 0:z.length;r.current=r.current+Dt,g(!!U)}else b(R.statuses),v(R.accounts),C(R.hashtags),r.current=0,g(!1);d("default")}catch{d("error")}})())}N(()=>{var A,F,T,z;l?((F=(A=u.current)==null?void 0:A.setValue)==null||F.call(A,l),P(!0)):(z=(T=u.current)==null?void 0:T.focus)==null||z.call(T)},[l,f,i]),Ce("/",A=>{var F,T;(T=(F=u.current)==null?void 0:F.focus)==null||T.call(F)},{preventDefault:!0});const[W]=qt();return e("div",{id:"search-page",class:"deck-container",ref:m,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:s==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(mt,{})}),e(Kn,{ref:u}),e("div",{class:"header-side",children:" "})]})}),e("main",{children:[!!l&&e("div",{ref:W,class:`filter-bar ${s==="loading"?"loading":""}`,children:[!!f&&e(K,{to:`/search${l?`?q=${encodeURIComponent(l)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(l)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(l)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(l)}&type=statuses`}].sort((A,F)=>A.type===f?-1:F.type===f?1:0).map(A=>e(K,{to:A.to,children:A.label},A.type))]}),l?e(x,{children:[(!f||f==="accounts")&&e(x,{children:[f!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),y.length>0?e(x,{children:[e("ul",{class:"timeline flat accounts-list",children:y.map(A=>e("li",{children:e(Oe,{account:A,instance:i,showStats:!0})},A.id))}),f!=="accounts"&&e("div",{class:"ui-state",children:e(K,{class:"plain button",to:`/search?q=${l}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!f&&(s==="loading"?e("p",{class:"ui-state",children:e(Se,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!f||f==="hashtags")&&e(x,{children:[f!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),I.length>0?e(x,{children:[e("ul",{class:"link-list hashtag-list",children:I.map(A=>{const{name:F,history:T}=A,z=T.reduce((R,U)=>R+ +U.uses,0);return e("li",{children:e(K,{to:i?`/${i}/t/${A.name}`:`/t/${A.name}`,children:[e(w,{icon:"hashtag"}),e("span",{children:A.name}),!!z&&e("span",{class:"count",children:_e(z)})]})},A.name)})}),f!=="hashtags"&&e("div",{class:"ui-state",children:e(K,{class:"plain button",to:`/search?q=${l}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!f&&(s==="loading"?e("p",{class:"ui-state",children:e(Se,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!f||f==="statuses")&&e(x,{children:[f!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),h.length>0?e(x,{children:[e("ul",{class:"timeline",children:h.map(A=>e("li",{children:e(K,{class:"status-link",to:i?`/${i}/s/${A.id}`:`/s/${A.id}`,children:e(Le,{status:A})})},A.id))}),f!=="statuses"&&e("div",{class:"ui-state",children:e(K,{class:"plain button",to:`/search?q=${l}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!f&&(s==="loading"?e("p",{class:"ui-state",children:e(Se,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!f&&(s==="default"?p?e(at,{onChange:A=>{A&&P()},children:e("button",{type:"button",class:"plain block",onClick:()=>P(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&e("p",{class:"ui-state",children:e(Se,{abrupt:!0})}))]}):s==="loading"?e("p",{class:"ui-state",children:e(Se,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const wt=40,yo=10,wo=5;let Ft={},kt={},St={};function Bt(t){delete kt[t],delete St[t]}const rt={block:"nearest",inline:"center",behavior:"smooth"},yn=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",wn=/\/s\//i;function vo(t){const{id:n}=t,{masto:a,instance:i}=q({instance:t.instance}),o=he(k),[s,d]=Fe(),c=s.get("media"),u=s.get("media-only"),l=parseInt(c||u,10);let f=l>0;const p=s.get("mediaStatusID"),g=Mn(p,i);p&&!g&&(f=!1);const r=f&&!!u,m=ht(n,i),[h,b]=$(k.statuses[m]);N(()=>{k.statuses[m]&&b(k.statuses[m])},[m]);const y=ue(()=>{const{prevLocation:C}=k,L=((C==null?void 0:C.pathname)||"")+((C==null?void 0:C.search)||""),P=ut("/:instance/s/:id",L)||ut("/s/:id",L);return!L||P?"/":L},[]);N(()=>{!h&&f&&(async()=>{try{const C=await a.v1.statuses.$select(n).fetch();$e(C,i),b(C)}catch{alert("Unable to load post."),location.hash=y}})()},[f]);const v=p?g==null?void 0:g.mediaAttachments:h==null?void 0:h.mediaAttachments,I=qe(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():r?location.hash=y:(s.delete("media"),s.delete("mediaStatusID"),d(s))},[r,y,o.prevLocation]);return e("div",{class:"deck-backdrop",children:[f?v!=null&&v.length?e(Gn,{mediaAttachments:v,statusID:p||n,instance:i,lang:h==null?void 0:h.language,index:l-1,onClose:I}):e("div",{class:"media-modal-container loading",children:e(Se,{abrupt:!0})}):e(K,{to:y}),!r&&e(ko,{id:n,instance:t.instance,closeLink:y})]})}function ko({id:t,closeLink:n="/",instance:a}){var ie,ae;const[i,o]=Fe(),s=i.get("media"),d=i.get("mediaStatusID"),c=parseInt(s,10)>0,u=E(!k.prevLocation&&(history.length===1||"navigation"in window&&((ae=(ie=navigation==null?void 0:navigation.entries)==null?void 0:ie.call(navigation))==null?void 0:ae.length)===1)),[l,f]=$(i.get("view")||u.current?"full":null),p=!!parseInt(i.get("translate")),{masto:g,instance:r}=q({instance:a}),{masto:m,instance:h,authenticated:b}=q(),y=r===h,v=he(k),[I,C]=$([]),[L,P]=$("default"),W=E(),A=ht(t,r),F=E(0),T=E();N(()=>{var S;(S=T.current)==null||S.focus()},[]),N(()=>{var D;const S=zn(()=>{if(!T.current)return;const{scrollTop:X}=T.current;L!=="loading"&&(St[t]=X)},50);return(D=T.current)==null||D.addEventListener("scroll",S,{passive:!0}),S(),()=>{var X;S.cancel(),(X=T.current)==null||X.removeEventListener("scroll",S)}},[t,L!=="loading"]);const z=E(),R=({reloadHero:S}={})=>{P("loading");let D;const X=kt[t];if(X){const se=X.filter(pe=>k.statuses[A]);C(se)}else C([{id:t}]);return(async()=>{var je,B;const se=()=>sn(()=>g.v1.statuses.$select(t).fetch(),{retries:4}),pe=sn(()=>g.v1.statuses.$select(t).context.fetch(),{retries:8}),Ee=!!v.statuses[A];let Te=v.statuses[A];if(!(Ee&&!S))try{Te=await se(),$e(Te,r),await new Promise(oe=>{setTimeout(oe,100)})}catch{P("error");return}try{let oe=function(j){return j==null?void 0:j.map(ge=>({id:ge.id,account:ge.account,repliesCount:ge.repliesCount,content:ge.content,weight:dt(ge),replies:oe(ge.__replies)}))};const be=await pe,{ancestors:de,descendants:Pe}=be;F.current=(Pe==null?void 0:Pe.length)||0;const Be=new Set;de.forEach(j=>{$e(j,r,{skipThreading:!0}),j.inReplyToId&&!de.find(ge=>ge.id===j.inReplyToId)&&Be.add(j.inReplyToId)});const De=de.every(j=>j.account.id===Te.account.id),Ne=[];Pe.forEach(j=>{if($e(j,r,{skipThreading:!0}),j.inReplyToId&&!Pe.find(ge=>ge.id===j.inReplyToId)&&j.inReplyToId!==Te.id&&Be.add(j.inReplyToId),j.inReplyToAccountId===j.account.id)Ne.push(j);else if(j.inReplyToId===Te.id)Ne.push(j);else if(!j.inReplyToAccountId&&Ne.find(ge=>ge.id===j.inReplyToId)&&j.account.id===Te.account.id)Ne.push(j);else{const ge=Pe.find(We=>We.id===j.inReplyToId);ge&&(ge.__replies||(ge.__replies=[]),ge.__replies.push(j))}}),Be.size;const Ge=[...de.map(j=>({id:j.id,ancestor:!0,isThread:De,accountID:j.account.id,account:j.account,repliesCount:j.repliesCount,weight:dt(j)})),{id:t,accountID:Te.account.id,weight:dt(Te)},...Ne.map(j=>({id:j.id,account:j.account,accountID:j.account.id,descendant:!0,thread:j.account.id===Te.account.id,weight:dt(j),replies:oe(j.__replies)}))];P("default"),z.current={offsetTop:(je=W.current)==null?void 0:je.offsetTop,scrollTop:(B=T.current)==null?void 0:B.scrollTop};const Xe=Ge.findIndex(j=>j.id===t);Xe>=Z&&Y(Xe+1),C(Ge),kt[t]=Ge,fs(Te,r)}catch{P("error")}})(),()=>{clearTimeout(D)}};N(R,[t,g]),N(()=>{var D,X;if(!I.length)return;const S=St[t];if(S)T.current.scrollTop=S;else if(z.current){const se={offsetTop:(D=W.current)==null?void 0:D.offsetTop,scrollTop:(X=T.current)==null?void 0:X.scrollTop},pe=se.offsetTop-z.current.offsetTop+se.scrollTop;T.current.scrollTop=pe}else I.length===1&&(T.current.scrollTop=0);z.current=null},[I]),N(()=>{v.reloadStatusPage<=0||(async()=>{try{const{instanceURL:S}=it(),D=`https://${S}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(D,{ignoreVary:!0}),R({reloadHero:!0})}catch{}})()},[v.reloadStatusPage]),N(()=>()=>{St={},k.reloadStatusPage=0,kt={},Ft={},Ot.clear()},[]);const U=v.statuses[A]||v.statuses[t],V=ue(()=>{if(!U)return"";const{account:S}=U,D=document.createElement("div");return D.innerHTML=S.displayName,D.innerText.trim()},[U]),le=ue(()=>{if(!U)return"";let S=Rn(U);return S.length>64&&(S=S.slice(0,64)+"…"),S},[U]);Ae(V&&le?`${V}: "${le}"`:"Status","/:instance?/s/:id");const fe=ue(()=>{if(!U)return;const{url:S}=U;if(S)return new URL(S).hostname},[U]),ye=ue(()=>{if(fe)return fe===r},[fe,r]),[Z,Y]=$(wt),M=ue(()=>I.length-Z,[I.length,Z]),O=I.some(S=>S.descendant),G=I.filter(S=>S.ancestor),[ce,me]=$(!0),Ie=Nn(me,100),xe=ue(()=>{if(!W.current||ce)return null;const{top:S}=W.current.getBoundingClientRect();return S>0?"down":"up"},[ce]);Ce("esc",()=>{location.hash=n},{enabled:!c,ignoreEventWhen:S=>!!document.querySelector("#modal-container > *")}),Ce("backspace",()=>{location.hash=n}),Ce("j",()=>{const S=document.activeElement.closest(".status-link, .status-focus"),D=S==null?void 0:S.getBoundingClientRect(),X=Array.from(T.current.querySelectorAll(yn));if(S&&D.top<T.current.clientHeight&&D.bottom>0){const se=X.indexOf(S);let pe=X[se+1];pe&&(pe.focus(),pe.scrollIntoView(rt))}else{const se=X.find(pe=>{const Ee=pe.getBoundingClientRect();return Ee.top>=44&&Ee.left>=0});se&&(se.focus(),se.scrollIntoView(rt))}}),Ce("k",()=>{const S=document.activeElement.closest(".status-link, .status-focus"),D=S==null?void 0:S.getBoundingClientRect(),X=Array.from(T.current.querySelectorAll(yn));if(S&&D.top<T.current.clientHeight&&D.bottom>0){const se=X.indexOf(S);let pe=X[se-1];pe&&(pe.focus(),pe.scrollIntoView(rt))}else{const se=X.find(pe=>{const Ee=pe.getBoundingClientRect();return Ee.top>=44&&Ee.left>=0});se&&(se.focus(),se.scrollIntoView(rt))}}),Ce("x",()=>{const S=document.activeElement.closest(".status-link, .status-focus");if(S){const D=S.nextElementSibling;D&&D.tagName.toLowerCase()==="details"&&(D.open=!D.open)}});const{nearReachStart:we}=Lt({scrollableRef:T,distanceFromStartPx:16}),_=E(c?"media+status":"status"),J=qe((S,D,X,se)=>{S.preventDefault(),S.stopPropagation(),o({media:D+1,mediaStatusID:se.id})},[t]),Q=qe((S,D)=>{Bt(D.id)},[]);N(()=>{let S;return d&&c&&(S=setTimeout(()=>{var X;const D=(X=T.current)==null?void 0:X.querySelector(`.status-link[href*="/${d}"]`);D&&D.scrollIntoView(rt)},400)),()=>{clearTimeout(S)}},[d,c]);const H=qe(S=>{const{id:D,ancestor:X,isThread:se,descendant:pe,thread:Ee,replies:Te,repliesCount:je,weight:B}=S,oe=D===t;return e("li",{ref:oe?W:null,class:`${X?"ancestor":""} ${pe?"descendant":""} ${Ee?"thread":""} ${oe?"hero":""}`,children:[oe?e(x,{children:[e(at,{threshold:.1,onChange:Ie,class:"status-focus",tabIndex:0,children:e(Le,{statusID:D,instance:r,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:p})}),L!=="loading"&&!b?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(K,{to:"/login",class:"button",children:"Log in"})]}):!y&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:r}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:L==="loading",onClick:()=>{P("loading"),(async()=>{try{const be=await m.v2.search.fetch({q:U.url,type:"statuses",resolve:!0,limit:1});if(be.statuses.length){const de=be.statuses[0];location.hash=h?`/${h}/s/${de.id}`:`/s/${de.id}`}else throw new Error("No results")}catch(be){P("default"),alert("Error: "+be)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(K,{class:"status-link",to:r?`/${r}/s/${D}`:`/s/${D}`,onClick:()=>{Bt(D)},children:[e(Le,{statusID:D,instance:r,withinContext:!0,size:Ee||X?"m":"s",enableTranslate:!0,onMediaClick:J,onStatusLinkClick:Q}),X&&se&&je>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:je,children:_e(je)})]})," "]}),pe&&(Te==null?void 0:Te.length)>0&&e(is,{instance:r,replies:Te,hasParentThread:Ee,level:1,accWeight:B,openAll:F.current<yo}),L==="loading"&&oe&&!!(U!=null&&U.repliesCount)&&!O&&e("div",{class:"status-loading",children:e(Se,{})}),L==="error"&&oe&&!!(U!=null&&U.repliesCount)&&!O&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]},D)},[t,r,L,b,y,p,J,Q,O]),ee=ue(()=>{var S;if("navigation"in window&&(navigation!=null&&navigation.entries)){const D=navigation.entries()[navigation.currentEntry.index-1];if(D!=null&&D.url)return wn.test(D.url)}return wn.test((S=k.prevLocation)==null?void 0:S.pathname)},[A]);return e("div",{tabIndex:"-1",ref:T,class:`status-deck deck contained ${I.length>1?"padded-bottom":""} ${_.current==="status"&&!u.current?"slide-in":""} ${l?`deck-view-${l}`:""}`,onAnimationEnd:S=>{_.current==="status"&&(_.current=null)},children:[e("header",{class:`${ce?"inview":""} ${L==="loading"?"loading":""}`,onDblClick:S=>{k.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[ee&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!ce&&U&&L!=="loading"?e(x,{children:[e("span",{class:"hero-heading",children:[e(It,{account:U.account,instance:r,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(Ct,{datetime:U.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:S=>{S.preventDefault(),S.stopPropagation(),W.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:xe==="down"?"arrow-down":"arrow-up"})})]}):e(x,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:S=>{S.preventDefault(),S.stopPropagation(),T.current.scrollTo({top:0,behavior:"smooth"})},hidden:!G.length||we,title:`${G.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),G.filter((S,D,X)=>X.findIndex(se=>se.accountID===S.accountID)===D).slice(0,3).map(S=>e(Qe,{url:S.account.avatar,alt:S.account.displayName},S.account.id)),G.length>3&&e(x,{children:[" ",e("span",{class:"insignificant",children:_e(G.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:l==="full"?"":"none"},onClick:()=>{f(null),i.delete("media"),i.delete("media-only"),i.delete("view"),o(i)},title:"Switch to Side Peek view",children:e(w,{icon:"layout4",size:"l"})}),e(et,{align:"end",portal:{target:T.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(te,{disabled:L==="loading",onClick:()=>{k.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(te,{className:"menu-switch-view",onClick:()=>{f(l==="full"?null:"full"),i.delete("media"),i.delete("media-only"),l==="full"?i.delete("view"):i.set("view","full"),o(i)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[l||""]}),e("span",{children:["Switch to ",l==="full"?"Side Peek":"Full"," view"]})]}),e(te,{onClick:()=>{Array.from(T.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(D=>{D.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(Me,{}),e(Un,{className:"plain",children:"Experimental"}),e(te,{disabled:ye,onClick:()=>{const S=ss(U.url);S?location.hash=S:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance (",e("b",{children:fe}),")"]})]})]}),e(K,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),I.length&&U?e("ul",{class:`timeline flat contextual grow ${L==="loading"?"loading":""}`,children:[I.slice(0,Z).map(H),M>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:L==="loading",onClick:()=>Y(S=>S+wt),style:{marginBlockEnd:"6em"},children:[e("div",{class:"ib avatars-bunch",children:I.slice(Z,Z+5).map(S=>e(Qe,{url:S.account.avatarStatic},S.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:M>wt?`${wt}+`:M})]})]})})]}):e(x,{children:[L==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Le,{skeleton:!0,size:"l"})})}),L==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]})]})}function is({replies:t,instance:n,hasParentThread:a,level:i,accWeight:o,openAll:s}){const[d,c]=Fe(),u=y=>y.reduce((v,I)=>{const{repliesCount:C,replies:L}=I,P=(L==null?void 0:L.length)||C;return v+P+u(L||[])},0),l=t.length+u(t),f=t.length===l,p=t.map(y=>y.account).filter((y,v,I)=>I.findIndex(C=>C.id===y.id)===v).slice(0,3),g=ue(()=>t==null?void 0:t.reduce((y,v)=>y+(v==null?void 0:v.weight),o),[o,t==null?void 0:t.length]);let r=!1;(s||g<=wo||!a&&l===1&&dt(t[0])<2)&&(r=!0);const m=Ft[t[0].id],h=qe((y,v,I,C)=>{y.preventDefault(),y.stopPropagation(),c({media:v+1,mediaStatusID:C.id})},[]),b=E();return He(()=>{var v;function y(I){I.target.dataset.scrollLeft=I.target.scrollLeft}return(v=b.current)==null||v.addEventListener("scroll",y,{passive:!0}),()=>{var I;(I=b.current)==null||I.removeEventListener("scroll",y)}},[]),e("details",{ref:b,class:"replies",open:m||r,onToggle:y=>{const{open:v}=y.target;Ft[t[0].id]=v},style:{"--comments-level":i},"data-comments-level":i,"data-comments-level-overflow":i>4,children:[e("summary",{class:"replies-summary",hidden:r,children:[e("span",{class:"avatars",children:p.map(y=>e(Qe,{url:y.avatarStatic,title:`${y.displayName} @${y.username}`,squircle:y==null?void 0:y.bot},y.id))}),e("span",{children:[e("span",{title:t.length,children:_e(t.length)})," ","repl",t.length===1?"y":"ies"]}),!f&&l>1&&e(x,{children:[" ","·"," ",e("span",{children:[e("span",{title:l,children:_e(l)})," ","comment",l===1?"":"s"]})]})]}),e("ul",{children:t.map(y=>{var v,I;return e("li",{children:[e(K,{class:"status-link",to:n?`/${n}/s/${y.id}`:`/s/${y.id}`,onClick:()=>{Bt(y.id)},children:[e(Le,{statusID:y.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:h}),!((v=y.replies)!=null&&v.length)&&y.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:y.repliesCount,children:_e(y.repliesCount)})]})]}),((I=y.replies)==null?void 0:I.length)&&e(is,{instance:n,replies:y.replies,level:i+1,accWeight:r?g:y.weight,openAll:s})]},y.id)})})]})}const So=140,Io=35,To=70,Co=140,Ot=new Map;function dt(t){var r,m;const n=Ot.get(t.id);if(n)return n;const{spoilerText:a,content:i,mediaAttachments:o,poll:s,card:d}=t,c=ps(a+i),u=o!=null&&o.length?So:0,l=(((r=s==null?void 0:s.options)==null?void 0:r.length)||0)*Io,f=d&&(o!=null&&o.length||(m=s==null?void 0:s.options)!=null&&m.length)?0:To,g=(c+u+l+f)/Co;return Ot.set(t.id,g),g}const $o=ze(vo);function xo(){const t=tt(),{id:n,instance:a}=t;return e($o,{id:n,instance:a})}const Lo=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,Ao=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,Ro=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,Mo=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,Eo=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,Do=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function vn(){return Ae(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("h1",{children:[e("img",{src:Fn,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:Do,alt:"Phanpy",width:"250"})]}),e("p",{children:e("big",{children:e("b",{children:e(K,{to:"/login",class:"button",children:"Log in"})})})}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:Lo,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:Eo,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:Ao,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:Ro,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:Mo,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),e("hr",{}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const _o=window.alert;window.__nativeAlert||(window.__nativeAlert=_o);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=Cs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=k;window.__STATES_STATS__=()=>{const t=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};t.forEach(a=>{n[a]=Object.keys(k[a]).length})};setTimeout(()=>{var t,n,a,i;for(const o in gt)Array.isArray(gt[o])?(n=(t=gt[o])[0])==null||n.call(t):(i=(a=gt)[o])==null||i.call(a)},5e3);(()=>{window.__IDLE__=!0;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},i=zn(n,3e3),o=()=>{window.__IDLE__=!1,i()};t.forEach(s=>{window.addEventListener(s,o,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",s=>{!s.relatedTarget&&!s.toElement&&n()},{passive:!0})})();Dn(k,t=>{var n;for(const[a,i,o,s]of t){if(i.join(".")==="settings.shortcutsViewMode"){const d=document.getElementById("app");d&&(d.dataset.shortcutsViewMode=(n=k.shortcuts)!=null&&n.length?o:"")}i.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",o)}});function Po(){const[t,n]=$(!1),[a,i]=$("loading");He(()=>{const s=ne.local.get("theme");s&&(document.documentElement.classList.add(`is-${s}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",s==="auto"?"dark light":s));const d=ne.local.get("textSize");d&&document.documentElement.style.setProperty("--text-size",`${d}px`)},[]),N(()=>{const s=ne.local.get("instanceURL"),d=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(d){window.history.replaceState({},document.title,o.pathname||"/");const c=ne.session.get("clientID"),u=ne.session.get("clientSecret"),l=ne.session.get("vapidKey");(async()=>{i("loading");const{access_token:f}=await mo({instanceURL:s,client_id:c,client_secret:u,code:d}),p=ms({instance:s,accessToken:f});await Promise.allSettled([Qt(p,s),gs(p,s,f,l)]),en(),tn(p),n(!0),i("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const c=it();if(c){ne.session.set("currentAccount",c.info.id);const{client:u}=q({account:c}),{instance:l}=u;en(),tn(u),i("loading"),(async()=>{try{await Qt(u,l)}catch{}finally{n(!0),i("default")}})()}else i("default")}},[]);let o=ct();return k.currentLocation=o.pathname,N(Pt,[o,t]),/\/https?:/.test(o.pathname)?e(ao,{}):e(x,{children:[e(No,{isLoggedIn:t,loading:a==="loading"}),e(Uo,{isLoggedIn:t}),a==="default"&&e(Ht,{children:e(ve,{path:"/:instance?/s/:id",element:e(xo,{})})}),t&&e(Ms,{}),t&&e(gi,{}),e(ui,{}),t&&e(fi,{}),e(Rs,{isLoggedIn:t}),a!=="loading"&&e(pi,{onClose:Pt}),e(Es,{})]})}function No({isLoggedIn:t,loading:n}){const a=ct(),i=ue(()=>{const{pathname:o}=a;return!/^\/(login|welcome)/.test(o)},[a]);return e(Ht,{location:i||a,children:[e(ve,{path:"/",element:t?e(io,{}):n?e(Se,{id:"loader-root"}):e(vn,{})}),e(ve,{path:"/login",element:e(go,{})}),e(ve,{path:"/welcome",element:e(vn,{})})]})}function kn(){return k.prevLocation||null}function Uo({isLoggedIn:t}){const n=ct(),a=E(kn());return ue(()=>ut("/:instance/s/:id",n.pathname)||ut("/s/:id",n.pathname),[n.pathname,ut])?a.current||(a.current=kn()):a.current=null,e(Ht,{location:a.current||n,children:[t&&e(x,{children:[e(ve,{path:"/notifications",element:e(ts,{})}),e(ve,{path:"/mentions",element:e(Qn,{})}),e(ve,{path:"/following",element:e(Kt,{})}),e(ve,{path:"/b",element:e(Yn,{})}),e(ve,{path:"/f",element:e(Jn,{})}),e(ve,{path:"/l",children:[e(ve,{index:!0,element:e(ro,{})}),e(ve,{path:":id",element:e(Zn,{})})]}),e(ve,{path:"/ft",element:e(Ei,{})})]}),e(ve,{path:"/:instance?/t/:hashtag",element:e(Xn,{})}),e(ve,{path:"/:instance?/a/:id",element:e(xi,{})}),e(ve,{path:"/:instance?/p",children:[e(ve,{index:!0,element:e(zt,{})}),e(ve,{path:"l",element:e(zt,{local:!0})})]}),e(ve,{path:"/:instance?/trending",element:e(ns,{})}),e(ve,{path:"/:instance?/search",element:e(bo,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));$s(e(xs,{children:e(Po,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-d1d1736c.js.map
