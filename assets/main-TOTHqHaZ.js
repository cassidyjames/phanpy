function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["./catchup-CmKwglby.js","./db-sFMzSqk3.js","./intl-segmenter-polyfill-XHDQHdV5.js","./db--rXe_OM3.css","./index-_Y-Lyw2n.js","./catchup-HBTLInPQ.css","./modals-sjK9tbPd.js","./compose-M09VS2Ab.js","./compose-HEGNIWHD.css","./modals-HMWK6usR.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{F as O,_ as j,p as A,s as $,a as q,b as Rt,u as ei,c as rt,d as St,w as Ht,o as Vi,I as k,e as t,f as $t,M as Dt,g as M,L as kt,h as gt,N as Qe,i as zt,R as un,A as fe,S as Et,j as ji,k as tt,l as Wi,m as pe,n as Jt,q as Gt,T as Yi,r as Gi,t as ie,v as mt,x as oe,y as Ki,z as Qt,B as Lt,C as ni,D as Wt,E as Xt,G as ii,H as tn,J as si,K as se,O as Zi,P as lt,Q as Nt,U as oi,V as Cn,W as Xi,X as ci,Y as Ji,Z as Qi,$ as Yt,a0 as ts,a1 as ai,a2 as es,a3 as en,a4 as ri,a5 as ns,a6 as is,a7 as li,a8 as ss,a9 as we,aa as di,ab as ae,ac as _t,ad as ui,ae as hi,af as os,ag as cs,ah as as,ai as rs,aj as fi,ak as ls,al as ds,am as qe,an as Te,ao as $n,ap as us,aq as hs,ar as fs,as as pi,at as mi,au as Ae,av as ps,aw as ms,ax as xn,ay as gs,az as An,aA as En,aB as hn,aC as yt,aD as gi,aE as bs,aF as vs}from"./db-sFMzSqk3.js";import{g as ba}from"./intl-segmenter-polyfill-XHDQHdV5.js";var bi=ws;function ws(e,n,i){var s=null,o=null,c=function(){s&&(clearTimeout(s),o=null,s=null)},h=function(){var a=o;c(),a&&a()},r=function(){if(!n)return e.apply(this,arguments);var a=this,l=arguments,u=i&&!s;if(c(),o=function(){e.apply(a,l)},s=setTimeout(function(){if(s=null,!u){var d=o;return o=null,d()}},n),u)return o()};return r.cancel=c,r.flush=h,r}/*!
 * swiped-events.js - v@version@
 * Pure JavaScript swipe events
 * https://github.com/john-doherty/swiped-events
 * @inspiration https://stackoverflow.com/questions/16348031/disable-scrolling-when-touch-moving-certain-element
 * @author John Doherty <www.johndoherty.info>
 * @license MIT
 */(function(e,n){"use strict";typeof e.CustomEvent!="function"&&(e.CustomEvent=function(p,g){g=g||{bubbles:!1,cancelable:!1,detail:void 0};var m=n.createEvent("CustomEvent");return m.initCustomEvent(p,g.bubbles,g.cancelable,g.detail),m},e.CustomEvent.prototype=e.Event.prototype),n.addEventListener("touchstart",u,!1),n.addEventListener("touchmove",d,!1),n.addEventListener("touchend",l,!1);var i=null,s=null,o=null,c=null,h=null,r=null,a=0;function l(p){if(r===p.target){var g=parseInt(f(r,"data-swipe-threshold","20"),10),m=f(r,"data-swipe-unit","px"),y=parseInt(f(r,"data-swipe-timeout","500"),10),b=Date.now()-h,v="",S=p.changedTouches||p.touches||[];if(m==="vh"&&(g=Math.round(g/100*n.documentElement.clientHeight)),m==="vw"&&(g=Math.round(g/100*n.documentElement.clientWidth)),Math.abs(o)>Math.abs(c)?Math.abs(o)>g&&b<y&&(o>0?v="swiped-left":v="swiped-right"):Math.abs(c)>g&&b<y&&(c>0?v="swiped-up":v="swiped-down"),v!==""){var w={dir:v.replace(/swiped-/,""),touchType:(S[0]||{}).touchType||"direct",fingers:a,xStart:parseInt(i,10),xEnd:parseInt((S[0]||{}).clientX||-1,10),yStart:parseInt(s,10),yEnd:parseInt((S[0]||{}).clientY||-1,10)};r.dispatchEvent(new CustomEvent("swiped",{bubbles:!0,cancelable:!0,detail:w})),r.dispatchEvent(new CustomEvent(v,{bubbles:!0,cancelable:!0,detail:w}))}i=null,s=null,h=null}}function u(p){p.target.getAttribute("data-swipe-ignore")!=="true"&&(r=p.target,h=Date.now(),i=p.touches[0].clientX,s=p.touches[0].clientY,o=0,c=0,a=p.touches.length)}function d(p){if(!(!i||!s)){var g=p.touches[0].clientX,m=p.touches[0].clientY;o=i-g,c=s-m}}function f(p,g,m){for(;p&&p!==n.documentElement;){var y=p.getAttribute(g);if(y)return y;p=p.parentNode}return m}})(window,document);function me(e=()=>{},n=[]){const i=O(e);j(()=>{i.current=e},[n]),j(()=>{const s=()=>{const o=document.hidden||document.visibilityState==="hidden";i.current(!o)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[])}const ys=1e3*3,Ss=15e3,ks=Ht(function({isLoggedIn:n}){const[i,s]=A(!0);me(s);const o=async(r,a,l)=>{var u;if($.notificationsLast){const d=r.v1.notifications.list({limit:1,sinceId:$.notificationsLast.id}),{value:f}=await d.next();if(f!=null&&f.length)if(l)$.notificationsShowNew=!0;else{let p;try{const g=await r.v1.markers.fetch({timeline:"notifications"});p=(u=g==null?void 0:g.notifications)==null?void 0:u.lastReadId}catch{}p?$.notificationsShowNew=f[0].id!==p:$.notificationsShowNew=!0}}};j(()=>{let r,a;if(n&&i){const{masto:l,streaming:u,instance:d}=q();(async()=>{await o(l,d);let f=!1;u&&(a=setTimeout(()=>{(async()=>{try{f=!0,r=u.user.notification.subscribe();for await(const p of r){if(!r||!i)break;p.event==="notification"&&Rt(p.payload,d,{skipThreading:!0}),$.notificationsShowNew=!0}}catch{f=!1}f||(a=setInterval(()=>{o(l,d,!0)},Ss))})()},ys))})()}return()=>{var l;(l=r==null?void 0:r.unsubscribe)==null||l.call(r),r=null,clearTimeout(a),clearInterval(a)}},[i,n]);const c=O(),h=()=>{c.current=Date.now(),fetch("./version.json").then(r=>r.json()).then(r=>{r&&($.appVersion=r)}).catch(r=>{})};return ei(h,i&&1e3*60*30),me(r=>{r&&(c.current?Date.now()-c.current>1e3*60*60&&h():h())}),St("shift+alt+k",()=>{const r=$.settings.cloakMode;$.settings.cloakMode=!r,rt({text:`Cloak mode ${r?"disabled":"enabled"}`})}),null});function Is(){function e(n){n.shiftKey?Vi()||($.showCompose=!0):$.showCompose=!0}return St("c, shift+c",e,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),t("button",{type:"button",id:"compose-button",onClick:e,children:t(k,{icon:"quill",size:"xl",alt:"Compose"})})}const Ts=Ht(function(){const n=$t($);function i(){$.showKeyboardShortcutsHelp=!1}return St("?, shift+?, shift+slash",s=>{$.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:s=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&t(Dt,{onClose:i,children:t("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:i,children:t(k,{icon:"x"})}),t("header",{children:t("h2",{children:"Keyboard shortcuts"})}),t("main",{children:t("table",{children:[{action:"Keyboard shortcuts help",keys:t("kbd",{children:"?"})},{action:"Next post",keys:t("kbd",{children:"j"})},{action:"Previous post",keys:t("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"k"})]})},{action:"Load new posts",keys:t("kbd",{children:"."})},{action:"Open post details",keys:t(M,{children:[t("kbd",{children:"Enter"})," or ",t("kbd",{children:"o"})]})},{action:t(M,{children:["Expand content warning or",t("br",{}),"toggle expanded/collapsed thread"]}),keys:t("kbd",{children:"x"})},{action:"Close post or dialogs",keys:t(M,{children:[t("kbd",{children:"Esc"})," or ",t("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:t(M,{children:[t("kbd",{children:"1"})," to ",t("kbd",{children:"9"})]})},{action:"Compose new post",keys:t("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"c"})]})},{action:"Send post",keys:t(M,{children:[t("kbd",{children:"Ctrl"})," + ",t("kbd",{children:"Enter"})," or ",t("kbd",{children:"⌘"})," +"," ",t("kbd",{children:"Enter"})]})},{action:"Search",keys:t("kbd",{children:"/"})},{action:"Reply",keys:t("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:t(M,{children:[t("kbd",{children:"l"})," or ",t("kbd",{children:"f"})]})},{action:"Boost",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"b"})]})},{action:"Bookmark",keys:t("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:t(M,{children:[t("kbd",{children:"Shift"})," + ",t("kbd",{children:"Alt"})," + ",t("kbd",{children:"k"})]})}].map(({action:s,className:o,keys:c})=>t("tr",{children:[t("th",{class:o,children:s}),t("td",{children:c})]},s))})})]})})});function nn({accountID:e,onChange:n}){const{masto:i}=q(),[s,o]=A("default"),[c,h]=A(null),[r,a]=A(null),l=r!==null;return t("p",{class:"follow-request-buttons",children:[t("button",{type:"button",disabled:s==="loading"||l,onClick:()=>{o("loading"),h("accept"),(async()=>{try{const u=await i.v1.followRequests.$select(e).authorize();if(!(u!=null&&u.followedBy))throw new Error("Follow request not accepted");a(u),n()}catch{}o("default")})()},children:"Accept"})," ",t("button",{type:"button",disabled:s==="loading"||l,class:"light danger",onClick:()=>{o("loading"),h("reject"),(async()=>{try{const u=await i.v1.followRequests.$select(e).reject();if(u!=null&&u.followedBy)throw new Error("Follow request not rejected");a(u),n()}catch{o("default")}})()},children:"Reject"}),t("span",{class:"follow-request-states",children:l&&c?c==="accept"?t(k,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):t(k,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):t(kt,{hidden:s!=="loading"})})]})}const Rn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},de={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":e=>`boosted ${e} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":e=>`liked ${e} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":e=>`boosted & liked ${e} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":e=>t(M,{children:["reported ",e]})},Ye=50;function Cs({notification:e,instance:n,isStatic:i,disableContextMenu:s}){var C,B,R,U;const{id:o,status:c,account:h,report:r,_accounts:a,_statuses:l}=e;let{type:u}=e;const d=(c==null?void 0:c.reblog)||c,f=d==null?void 0:d.id,p=gt.session.get("currentAccount"),g=p===(h==null?void 0:h.id),m=(C=c==null?void 0:c.poll)==null?void 0:C.voted,y=!!(c!=null&&c.inReplyToAccountId)&&(c==null?void 0:c.inReplyToAccountId)!==p&&((B=c==null?void 0:c.account)==null?void 0:B.id)===p;let b=0,v=0;if(u==="favourite+reblog"){for(const F of a)(R=F._types)!=null&&R.includes("favourite")&&b++,(U=F._types)!=null&&U.includes("reblog")&&v++;!v&&b&&(u="favourite"),!b&&v&&(u="reblog")}let S;if(u==="poll"?S=de[g?"poll-self":m?"poll-voted":"poll"]:u==="reblog"||u==="favourite"||u==="favourite+reblog"?(l==null?void 0:l.length)>1?S=de[`${u}+account`]:y?S=de[`${u}_reply`]:S=de[u]:de[u]?S=de[u]:S=`[Unknown notification type: ${u}]`,typeof S=="function"){const F=(l==null?void 0:l.length)||(a==null?void 0:a.length);if(F)S=S(F);else if(u==="admin.report"){const _=r==null?void 0:r.targetAccount;_&&(S=S(t(Qe,{account:_,showAvatar:!0})))}}if(u==="mention"&&!c)return null;const w=e.createdAt&&new Date(e.createdAt).toLocaleString(),T={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[u]||"Accounts",I=()=>{$.showGenericAccounts={heading:T,accounts:a,showReactions:u==="favourite+reblog",excludeRelationshipAttrs:u==="follow"?["followedBy"]:[]}};return t("div",{class:`notification notification-${u}`,"data-notification-id":o,tabIndex:"0",children:[t("div",{class:`notification-type notification-${u}`,title:w,children:u==="favourite+reblog"?t(M,{children:[t(k,{icon:"rocket",size:"xl",alt:u,class:"reblog-icon"}),t(k,{icon:"heart",size:"xl",alt:u,class:"favourite-icon"})]}):t(k,{icon:Rn[u]||"notification",size:"xl",alt:u})}),t("div",{class:"notification-content",children:[u!=="mention"&&t(M,{children:[t("p",{children:[!/poll|update/i.test(u)&&t(M,{children:(a==null?void 0:a.length)>1?t(M,{children:[t("b",{tabIndex:"0",onClick:I,children:[t("span",{title:a.length,children:zt(a.length)})," ","people"]})," "]}):t(M,{children:[t(Qe,{account:h,showAvatar:!0})," "]})}),S,u==="mention"&&t("span",{class:"insignificant",children:[" ","•"," ",t(un,{datetime:e.createdAt,format:"micro"})]})]}),u==="follow_request"&&t(nn,{accountID:h.id})]}),(a==null?void 0:a.length)>1&&t("p",{class:"avatars-stack",children:[a.slice(0,Ye).map(F=>t(M,{children:[t("a",{href:F.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:_=>{_.preventDefault(),$.showAccount=F},children:[t(fe,{url:F.avatarStatic,size:a.length<=10?"xxl":a.length<20?"xl":a.length<30?"l":a.length<40?"m":"s",alt:`${F.displayName} @${F.acct}`,squircle:F==null?void 0:F.bot},F.id),u==="favourite+reblog"&&t("div",{class:"account-sub-icons",children:F._types.map(_=>t(k,{icon:Rn[_],size:"s",class:`${_}-icon`}))})]},F.id)," "]},F.id)),t("button",{type:"button",class:"small plain",onClick:I,children:[a.length>Ye&&`+${a.length-Ye}`,t(k,{icon:"chevron-down"})]})]}),(l==null?void 0:l.length)>1&&t("ul",{class:"notification-group-statuses",children:l.map(F=>t("li",{children:t(Mn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${F.id}`:`/s/${F.id}`,children:t(Et,{status:F,size:"s",previewMode:!0,allowContextMenu:!0})})},F.id))}),c&&(!(l!=null&&l.length)||(l==null?void 0:l.length)<=1)&&t(Mn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${f}`:`/s/${f}`,onContextMenu:s?void 0:F=>{const _=F.target.querySelector(".status");if(_){if(F.metaKey)return;F.preventDefault(),_.dispatchEvent(new MouseEvent("contextmenu",{clientX:F.clientX,clientY:F.clientY}))}},children:i?t(Et,{status:d,size:"s",readOnly:!0,allowContextMenu:!0}):t(Et,{statusID:f,size:"s",readOnly:!0,allowContextMenu:!0})})]})]})}function Mn(e){const n=ji();return t(tt,{...e,"data-read-more":"Read more →",ref:n})}const Ve=Ht(Cs,(e,n)=>{var i,s;return((i=e.notification)==null?void 0:i.id)===((s=n.notification)==null?void 0:s.id)});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{const{type:n,id:i,accessToken:s}=(e==null?void 0:e.data)||{};n==="notification"&&($.routeNotification={id:i,accessToken:s})});const $s=Ht(function(){if(!("serviceWorker"in navigator))return null;const n=$t($),{routeNotification:i}=n,{id:s,accessToken:o}=i||{},[c,h]=A(!1);Jt(()=>{if(!s||!o)return;const{instance:a}=q(),{masto:l,instance:u}=q({accessToken:o}),d=a===u,f=o?Wi(o):pe();(async()=>{const p=await l.v1.notifications.$select(s).fetch();if(p&&f){const g=f.instanceURL,{type:m,status:y,account:b}=p,v=!!document.querySelector("#modal-container > *"),S=m==="follow"&&!!(b!=null&&b.id),w=!!(b!=null&&b.id),T=!!(y!=null&&y.id);S&&d?$.showAccount={account:b,instance:g}:v||!d||w&&T?h({id:s,account:f,notification:p,sameInstance:d}):T?location.hash=`/${a}/s/${y.id}`:S?location.hash=`/${a}/a/${b.id}`:location.hash="/notifications"}})()},[s,o]),Jt(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),me(a=>{a&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const r=()=>{h(!1),$.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(c){const{id:a,account:l,notification:u,sameInstance:d}=c;return t(Dt,{onClick:f=>{f.target===f.currentTarget&&r()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:r,children:t(k,{icon:"x"})}),t("header",{children:t("b",{children:"Notification"})}),t("main",{children:[!d&&t("p",{children:"This notification is from your other account."}),t("div",{class:"notification-peek",onClick:f=>{const{target:p}=f;(f.target.tagName==="BUTTON"||f.target.tagName==="A")&&r()},children:t(Ve,{instance:l.instanceURL,notification:u,isStatic:!0})}),t("div",{style:{textAlign:"end"},children:t(tt,{to:"/notifications",class:"button light",onClick:r,children:[t("span",{children:"View all notifications"})," ",t(k,{icon:"arrow-right"})]})})]})]})})}return null}),vi=Gi((e,n)=>{const{instance:i}=q(),[s,o]=Gt(),[c,h]=A(!1),[r,a]=A(s.get("q")||""),l=s.get("type"),u=O(null),d=O(null);return Yi(n,()=>({setValue:f=>{a(f)},focus:()=>{d.current.focus()},select:()=>{d.current.select()},blur:()=>{d.current.blur()}})),t("form",{ref:u,class:"search-popover-container",onSubmit:f=>{var g;if(f.preventDefault(),/\/search/.test(location.hash))if(r){const m={q:r};l&&(m.type=l),o(m)}else o({});else r?location.hash=`/search?q=${encodeURIComponent(r)}${l?`&type=${l}`:""}`:location.hash="/search";(g=e==null?void 0:e.onSubmit)==null||g.call(e,f)},children:[t("input",{ref:d,value:r,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellCheck:"false",onSearch:f=>{f.target.value||o({})},onInput:f=>{a(f.target.value),h(!0)},onFocus:()=>{var f,p;h(!0),(p=(f=u.current)==null?void 0:f.querySelector(".search-popover-item"))==null||p.classList.add("focus")},onBlur:()=>{var f,p;setTimeout(()=>{h(!1)},100),(p=(f=u.current)==null?void 0:f.querySelector(".search-popover-item.focus"))==null||p.classList.remove("focus")},onKeyDown:f=>{var g;const{key:p}=f;switch(p){case"Escape":h(!1);break;case"Down":case"ArrowDown":if(f.preventDefault(),c){const m=u.current.querySelector(".search-popover-item.focus");if(m){let y=m.nextElementSibling;for(;y&&y.hidden;)y=y.nextElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(v=>v!==y).forEach(v=>{v.classList.remove("focus")}))}else{const y=u.current.querySelector(".search-popover-item");y&&y.classList.add("focus")}}break;case"Up":case"ArrowUp":if(f.preventDefault(),c){const m=document.querySelector(".search-popover-item.focus");if(m){let y=m.previousElementSibling;for(;y&&y.hidden;)y=y.previousElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(v=>v!==y).forEach(v=>{v.classList.remove("focus")}))}else{const y=document.querySelector(".search-popover-item:last-child");y&&y.classList.add("focus")}}break;case"Enter":if(c){const m=document.querySelector(".search-popover-item.focus");m&&(f.preventDefault(),m.click()),h(!1),(g=e==null?void 0:e.onSubmit)==null||g.call(e,f)}break}}}),t("div",{class:"search-popover",hidden:!c||!r,children:!!r&&[{label:t(M,{children:[r," ",t("small",{class:"insignificant",children:"‒ accounts, hashtags & posts"})]}),to:`/search?q=${encodeURIComponent(r)}`,top:!l&&!/\s/.test(r),hidden:!!l},{label:t(M,{children:["Posts with ",t("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=statuses`,hidden:/^https?:/.test(r),top:/\s/.test(r),icon:"document",queryType:"statuses"},{label:t(M,{children:["Posts tagged with ",t("mark",{children:["#",r.replace(/^#/,"")]})]}),to:`/${i}/t/${r.replace(/^#/,"")}`,hidden:/^@/.test(r)||/^https?:/.test(r)||/\s/.test(r),top:/^#/.test(r),type:"link",icon:"hashtag",queryType:"hashtags"},{label:t(M,{children:["Look up ",t("mark",{children:r})]}),to:`/${r}`,hidden:!/^https?:/.test(r),top:/^https?:/.test(r),type:"link"},{label:t(M,{children:["Accounts with ",t("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=accounts`,icon:"group",queryType:"accounts"}].sort((f,p)=>{if(l){if(f.queryType===l)return-1;if(p.queryType===l)return 1}return f.top&&!p.top?-1:!f.top&&p.top?1:0}).filter(({hidden:f})=>!f).map(({label:f,to:p,icon:g,type:m},y)=>t(tt,{to:p,class:`search-popover-item ${y===0?"focus":""}`,onClick:b=>{var v;(v=e==null?void 0:e.onSubmit)==null||v.call(e,b)},children:[t(k,{icon:g||(m==="link"?"arrow-right":"search"),class:"more-insignificant"}),t("span",{children:f})," "]}))})]})}),xs=Ht(function({onClose:n=()=>{}}){const[i,s]=A(!1),o=O(null);St(["Slash","/"],h=>{s(!0),setTimeout(()=>{var r,a,l,u;(a=(r=o.current)==null?void 0:r.focus)==null||a.call(r),(u=(l=o.current)==null?void 0:l.select)==null||u.call(l)},0)},{preventDefault:!0,ignoreEventWhen:h=>{const r=/\/search/.test(location.hash),a=!!document.querySelector("#modal-container > *");return r||a}});const c=()=>{s(!1),n()};return St("esc",h=>{var r,a;(a=(r=o.current)==null?void 0:r.blur)==null||a.call(r),c()},{enabled:i,enableOnFormTags:!0,preventDefault:!0}),t("div",{id:"search-command-container",hidden:!i,onClick:h=>{h.target===h.currentTarget&&c()},children:t(vi,{ref:o,onSubmit:()=>{c()}})})}),wi=new Set,Pt=new WeakMap,ge=new WeakMap,ce=new WeakMap,sn=new WeakMap,As=new WeakMap,be=new WeakMap,Fe=new WeakMap,ke=new WeakSet;let ee,fn=0,pn=0;const Kt="__aa_tgt",Ce="__aa_del",Be="__aa_new",Es=e=>{const n=Ns(e);n&&n.forEach(i=>Ps(i))},Rs=e=>{e.forEach(n=>{n.target===ee&&Ls(),Pt.has(n.target)&&re(n.target)})};function Ms(e){const n=sn.get(e);n==null||n.disconnect();let i=Pt.get(e),s=0;const o=5;i||(i=ve(e),Pt.set(e,i));const{offsetWidth:c,offsetHeight:h}=ee,a=[i.top-o,c-(i.left+o+i.width),h-(i.top+o+i.height),i.left-o].map(u=>`${-1*Math.floor(u)}px`).join(" "),l=new IntersectionObserver(()=>{++s>1&&re(e)},{root:ee,threshold:1,rootMargin:a});l.observe(e),sn.set(e,l)}function re(e){clearTimeout(Fe.get(e));const n=je(e),i=$e(n)?500:n.duration;Fe.set(e,setTimeout(async()=>{const s=ce.get(e);try{await(s==null?void 0:s.finished),Pt.set(e,ve(e)),Ms(e)}catch{}},i))}function Ls(){clearTimeout(Fe.get(ee)),Fe.set(ee,setTimeout(()=>{wi.forEach(e=>Ii(e,n=>yi(()=>re(n))))},100))}function _s(e){setTimeout(()=>{As.set(e,setInterval(()=>yi(re.bind(null,e)),2e3))},Math.round(2e3*Math.random()))}function yi(e){typeof requestIdleCallback=="function"?requestIdleCallback(()=>e()):requestAnimationFrame(()=>e())}let on,he;typeof window<"u"&&(ee=document.documentElement,on=new MutationObserver(Es),he=new ResizeObserver(Rs),window.addEventListener("scroll",()=>{pn=window.scrollY,fn=window.scrollX}),he.observe(ee));function Ns(e){return e.reduce((s,o)=>[...s,...Array.from(o.addedNodes),...Array.from(o.removedNodes)],[]).every(s=>s.nodeName==="#comment")?!1:e.reduce((s,o)=>{if(s===!1)return!1;if(o.target instanceof Element){if(Ge(o.target),!s.has(o.target)){s.add(o.target);for(let c=0;c<o.target.children.length;c++){const h=o.target.children.item(c);if(h){if(Ce in h)return!1;Ge(o.target,h),s.add(h)}}}if(o.removedNodes.length)for(let c=0;c<o.removedNodes.length;c++){const h=o.removedNodes[c];if(Ce in h)return!1;h instanceof Element&&(s.add(h),Ge(o.target,h),ge.set(h,[o.previousSibling,o.nextSibling]))}}return s},new Set)}function Ge(e,n){!n&&!(Kt in e)?Object.defineProperty(e,Kt,{value:e}):n&&!(Kt in n)&&Object.defineProperty(n,Kt,{value:e})}function Ps(e){var n;const i=e.isConnected,s=Pt.has(e);i&&ge.has(e)&&ge.delete(e),ce.has(e)&&((n=ce.get(e))===null||n===void 0||n.cancel()),Be in e?Ln(e):s&&i?Us(e):s&&!i?Os(e):Ln(e)}function jt(e){return Number(e.replace(/[^0-9.\-]/g,""))}function Ds(e){let n=e.parentElement;for(;n;){if(n.scrollLeft||n.scrollTop)return{x:n.scrollLeft,y:n.scrollTop};n=n.parentElement}return{x:0,y:0}}function ve(e){const n=e.getBoundingClientRect(),{x:i,y:s}=Ds(e);return{top:n.top+s,left:n.left+i,width:n.width,height:n.height}}function Si(e,n,i){let s=n.width,o=n.height,c=i.width,h=i.height;const r=getComputedStyle(e);if(r.getPropertyValue("box-sizing")==="content-box"){const l=jt(r.paddingTop)+jt(r.paddingBottom)+jt(r.borderTopWidth)+jt(r.borderBottomWidth),u=jt(r.paddingLeft)+jt(r.paddingRight)+jt(r.borderRightWidth)+jt(r.borderLeftWidth);s-=u,c-=u,o-=l,h-=l}return[s,c,o,h].map(Math.round)}function je(e){return Kt in e&&be.has(e[Kt])?be.get(e[Kt]):{duration:250,easing:"ease-in-out"}}function ki(e){if(Kt in e)return e[Kt]}function mn(e){const n=ki(e);return n?ke.has(n):!1}function Ii(e,...n){n.forEach(i=>i(e,be.has(e)));for(let i=0;i<e.children.length;i++){const s=e.children.item(i);s&&n.forEach(o=>o(s,be.has(s)))}}function gn(e){return Array.isArray(e)?e:[e]}function $e(e){return typeof e=="function"}function Us(e){const n=Pt.get(e),i=ve(e);if(!mn(e))return Pt.set(e,i);let s;if(!n)return;const o=je(e);if(typeof o!="function"){const c=n.left-i.left,h=n.top-i.top,[r,a,l,u]=Si(e,n,i),d={transform:`translate(${c}px, ${h}px)`},f={transform:"translate(0, 0)"};r!==a&&(d.width=`${r}px`,f.width=`${a}px`),l!==u&&(d.height=`${l}px`,f.height=`${u}px`),s=e.animate([d,f],{duration:o.duration,easing:o.easing})}else{const[c]=gn(o(e,"remain",n,i));s=new Animation(c),s.play()}ce.set(e,s),Pt.set(e,i),s.addEventListener("finish",re.bind(null,e))}function Ln(e){Be in e&&delete e[Be];const n=ve(e);Pt.set(e,n);const i=je(e);if(!mn(e))return;let s;if(typeof i!="function")s=e.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:i.duration*1.5,easing:"ease-in"});else{const[o]=gn(i(e,"add",n));s=new Animation(o),s.play()}ce.set(e,s),s.addEventListener("finish",re.bind(null,e))}function _n(e,n){var i;e.remove(),Pt.delete(e),ge.delete(e),ce.delete(e),(i=sn.get(e))===null||i===void 0||i.disconnect(),setTimeout(()=>{if(Ce in e&&delete e[Ce],Object.defineProperty(e,Be,{value:!0,configurable:!0}),n&&e instanceof HTMLElement)for(const s in n)e.style[s]=""},0)}function Os(e){var n;if(!ge.has(e)||!Pt.has(e))return;const[i,s]=ge.get(e);Object.defineProperty(e,Ce,{value:!0,configurable:!0});const o=window.scrollX,c=window.scrollY;if(s&&s.parentNode&&s.parentNode instanceof Element?s.parentNode.insertBefore(e,s):i&&i.parentNode?i.parentNode.appendChild(e):(n=ki(e))===null||n===void 0||n.appendChild(e),!mn(e))return _n(e);const[h,r,a,l]=Bs(e),u=je(e),d=Pt.get(e);(o!==fn||c!==pn)&&Fs(e,o,c,u);let f,p={position:"absolute",top:`${h}px`,left:`${r}px`,width:`${a}px`,height:`${l}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!$e(u))Object.assign(e.style,p),f=e.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:u.duration,easing:"ease-out"});else{const[g,m]=gn(u(e,"remove",d));(m==null?void 0:m.styleReset)!==!1&&(p=(m==null?void 0:m.styleReset)||p,Object.assign(e.style,p)),f=new Animation(g),f.play()}ce.set(e,f),f.addEventListener("finish",_n.bind(null,e,p))}function Fs(e,n,i,s){const o=fn-n,c=pn-i,h=document.documentElement.style.scrollBehavior;if(getComputedStyle(ee).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+o,window.scrollY+c),!e.parentElement)return;const a=e.parentElement;let l=a.clientHeight,u=a.clientWidth;const d=performance.now();function f(){requestAnimationFrame(()=>{if(!$e(s)){const p=l-a.clientHeight,g=u-a.clientWidth;d+s.duration>performance.now()?(window.scrollTo({left:window.scrollX-g,top:window.scrollY-p}),l=a.clientHeight,u=a.clientWidth,f()):document.documentElement.style.scrollBehavior=h}})}f()}function Bs(e){const n=Pt.get(e),[i,,s]=Si(e,n,ve(e));let o=e.parentElement;for(;o&&(getComputedStyle(o).position==="static"||o instanceof HTMLBodyElement);)o=o.parentElement;o||(o=document.body);const c=getComputedStyle(o),h=Pt.get(o)||ve(o),r=Math.round(n.top-h.top)-jt(c.borderTopWidth),a=Math.round(n.left-h.left)-jt(c.borderLeftWidth);return[r,a,i,s]}function zs(e,n={}){return on&&he&&(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!$e(n)&&!n.disrespectUserMotionPreference||(ke.add(e),getComputedStyle(e).position==="static"&&Object.assign(e.style,{position:"relative"}),Ii(e,re,_s,o=>he==null?void 0:he.observe(o)),$e(n)?be.set(e,n):be.set(e,{duration:250,easing:"ease-in-out",...n}),on.observe(e,{childList:!0}),wi.add(e))),Object.freeze({parent:e,enable:()=>{ke.add(e)},disable:()=>{ke.delete(e)},isEnabled:()=>ke.has(e)})}function Ti(e){const n=O(null),[i,s]=A(),o=c=>{i&&(c?i.enable():i.disable())};return j(()=>{n.current instanceof HTMLElement&&s(zs(n.current,e||{}))},[]),[n,o]}var bn={exports:{}},va=bn.exports;(function(e){var n=function(){var i=String.fromCharCode,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",c={};function h(a,l){if(!c[a]){c[a]={};for(var u=0;u<a.length;u++)c[a][a.charAt(u)]=u}return c[a][l]}var r={compressToBase64:function(a){if(a==null)return"";var l=r._compress(a,6,function(u){return s.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(a){return a==null?"":a==""?null:r._decompress(a.length,32,function(l){return h(s,a.charAt(l))})},compressToUTF16:function(a){return a==null?"":r._compress(a,15,function(l){return i(l+32)})+" "},decompressFromUTF16:function(a){return a==null?"":a==""?null:r._decompress(a.length,16384,function(l){return a.charCodeAt(l)-32})},compressToUint8Array:function(a){for(var l=r.compress(a),u=new Uint8Array(l.length*2),d=0,f=l.length;d<f;d++){var p=l.charCodeAt(d);u[d*2]=p>>>8,u[d*2+1]=p%256}return u},decompressFromUint8Array:function(a){if(a==null)return r.decompress(a);for(var l=new Array(a.length/2),u=0,d=l.length;u<d;u++)l[u]=a[u*2]*256+a[u*2+1];var f=[];return l.forEach(function(p){f.push(i(p))}),r.decompress(f.join(""))},compressToEncodedURIComponent:function(a){return a==null?"":r._compress(a,6,function(l){return o.charAt(l)})},decompressFromEncodedURIComponent:function(a){return a==null?"":a==""?null:(a=a.replace(/ /g,"+"),r._decompress(a.length,32,function(l){return h(o,a.charAt(l))}))},compress:function(a){return r._compress(a,16,function(l){return i(l)})},_compress:function(a,l,u){if(a==null)return"";var d,f,p={},g={},m="",y="",b="",v=2,S=3,w=2,T=[],I=0,C=0,B;for(B=0;B<a.length;B+=1)if(m=a.charAt(B),Object.prototype.hasOwnProperty.call(p,m)||(p[m]=S++,g[m]=!0),y=b+m,Object.prototype.hasOwnProperty.call(p,y))b=y;else{if(Object.prototype.hasOwnProperty.call(g,b)){if(b.charCodeAt(0)<256){for(d=0;d<w;d++)I=I<<1,C==l-1?(C=0,T.push(u(I)),I=0):C++;for(f=b.charCodeAt(0),d=0;d<8;d++)I=I<<1|f&1,C==l-1?(C=0,T.push(u(I)),I=0):C++,f=f>>1}else{for(f=1,d=0;d<w;d++)I=I<<1|f,C==l-1?(C=0,T.push(u(I)),I=0):C++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)I=I<<1|f&1,C==l-1?(C=0,T.push(u(I)),I=0):C++,f=f>>1}v--,v==0&&(v=Math.pow(2,w),w++),delete g[b]}else for(f=p[b],d=0;d<w;d++)I=I<<1|f&1,C==l-1?(C=0,T.push(u(I)),I=0):C++,f=f>>1;v--,v==0&&(v=Math.pow(2,w),w++),p[y]=S++,b=String(m)}if(b!==""){if(Object.prototype.hasOwnProperty.call(g,b)){if(b.charCodeAt(0)<256){for(d=0;d<w;d++)I=I<<1,C==l-1?(C=0,T.push(u(I)),I=0):C++;for(f=b.charCodeAt(0),d=0;d<8;d++)I=I<<1|f&1,C==l-1?(C=0,T.push(u(I)),I=0):C++,f=f>>1}else{for(f=1,d=0;d<w;d++)I=I<<1|f,C==l-1?(C=0,T.push(u(I)),I=0):C++,f=0;for(f=b.charCodeAt(0),d=0;d<16;d++)I=I<<1|f&1,C==l-1?(C=0,T.push(u(I)),I=0):C++,f=f>>1}v--,v==0&&(v=Math.pow(2,w),w++),delete g[b]}else for(f=p[b],d=0;d<w;d++)I=I<<1|f&1,C==l-1?(C=0,T.push(u(I)),I=0):C++,f=f>>1;v--,v==0&&(v=Math.pow(2,w),w++)}for(f=2,d=0;d<w;d++)I=I<<1|f&1,C==l-1?(C=0,T.push(u(I)),I=0):C++,f=f>>1;for(;;)if(I=I<<1,C==l-1){T.push(u(I));break}else C++;return T.join("")},decompress:function(a){return a==null?"":a==""?null:r._decompress(a.length,32768,function(l){return a.charCodeAt(l)})},_decompress:function(a,l,u){var d=[],f,p=4,g=4,m=3,y="",b=[],v,S,w,T,I,C,B,R={val:u(0),position:l,index:1};for(v=0;v<3;v+=1)d[v]=v;for(w=0,I=Math.pow(2,2),C=1;C!=I;)T=R.val&R.position,R.position>>=1,R.position==0&&(R.position=l,R.val=u(R.index++)),w|=(T>0?1:0)*C,C<<=1;switch(f=w){case 0:for(w=0,I=Math.pow(2,8),C=1;C!=I;)T=R.val&R.position,R.position>>=1,R.position==0&&(R.position=l,R.val=u(R.index++)),w|=(T>0?1:0)*C,C<<=1;B=i(w);break;case 1:for(w=0,I=Math.pow(2,16),C=1;C!=I;)T=R.val&R.position,R.position>>=1,R.position==0&&(R.position=l,R.val=u(R.index++)),w|=(T>0?1:0)*C,C<<=1;B=i(w);break;case 2:return""}for(d[3]=B,S=B,b.push(B);;){if(R.index>a)return"";for(w=0,I=Math.pow(2,m),C=1;C!=I;)T=R.val&R.position,R.position>>=1,R.position==0&&(R.position=l,R.val=u(R.index++)),w|=(T>0?1:0)*C,C<<=1;switch(B=w){case 0:for(w=0,I=Math.pow(2,8),C=1;C!=I;)T=R.val&R.position,R.position>>=1,R.position==0&&(R.position=l,R.val=u(R.index++)),w|=(T>0?1:0)*C,C<<=1;d[g++]=i(w),B=g-1,p--;break;case 1:for(w=0,I=Math.pow(2,16),C=1;C!=I;)T=R.val&R.position,R.position>>=1,R.position==0&&(R.position=l,R.val=u(R.index++)),w|=(T>0?1:0)*C,C<<=1;d[g++]=i(w),B=g-1,p--;break;case 2:return b.join("")}if(p==0&&(p=Math.pow(2,m),m++),d[B])y=d[B];else if(B===g)y=S+S.charAt(0);else return null;b.push(y),d[g++]=S+y.charAt(0),p--,S=y,p==0&&(p=Math.pow(2,m),m++)}}};return r}();e!=null?e.exports=n:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return n})})(bn);var Nn=bn.exports;const Hs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",qs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",Vs="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",js=200,Ws=10;async function ze(){const{masto:e}=q(),n=e.v1.followedTags.list({limit:js}),i=[];let s=0;do{const{value:o,done:c}=await n.next();if(c||(o==null?void 0:o.length)===0)break;i.push(...o),s++}while(s<Ws);return i.sort((o,c)=>o.name.localeCompare(c.name)),i.length&&setTimeout(()=>{gt.account.set("followedTags",{tags:i,updatedAt:Date.now()})},1),i}const Ys=24*60*60*1e3;async function Gs(){try{const{tags:e,updatedAt:n}=gt.account.get("followedTags")||{};return e!=null&&e.length?(Date.now()-n>Ys&&ze(),e):await ze()}catch{return[]}}const Pn=document.createElement("div"),Ks=e=>{if(!e)return[];if(e.indexOf("#")===-1)return[];Pn.innerHTML=e;const n=Pn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(i=>i.innerText.trim().replace(/^[^#]*#+/,"")):[]};function cn({children:e}){if(typeof e=="string")return e;const[n,i]=A("");return j(()=>{Promise.resolve(e).then(i)},[e]),n}const Zt=9,Zs=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],Ci={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},Pe={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},Xs=ie(async({id:e})=>(await q().masto.v1.lists.$select(e).fetch()).title),Js=ie(async({id:e})=>{const n=await q().masto.v1.accounts.$select(e).fetch();return n.username||n.acct||n.displayName}),He={following:{id:"home",title:(e,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:Xs,path:({id:e})=>`/l/${e}`,icon:"list"},public:{id:"public",title:({local:e})=>e?"Local":"Federated",subtitle:({instance:e})=>e||q().instance,path:({local:e,instance:n})=>`/${n}/p${e?"/l":""}`,icon:({local:e})=>e?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:e})=>e||q().instance,path:({instance:e})=>`/${e}/trending`,icon:"chart"},search:{id:"search",title:({query:e})=>e?`“${e}”`:"Search",path:({query:e})=>e?`/search?q=${encodeURIComponent(e)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:e})=>e?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:Js,path:({id:e})=>`/a/${e}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:e})=>e,subtitle:({instance:e})=>e||q().instance,path:({hashtag:e,instance:n,media:i})=>`${n?`/${n}`:""}/t/${e.split(/\s+/).join("+")}${i?"?media=1":""}`,icon:"hashtag"}};function wa({onClose:e}){const n=$t($),{shortcuts:i}=n,[s,o]=A(!1),[c,h]=A(!1),[r]=Ti();return t("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(k,{icon:"x"})}),t("header",{children:t("h2",{children:[t(k,{icon:"shortcut"})," Shortcuts"," ",t("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),t("main",{children:[t("p",{children:"Specify a list of shortcuts that'll appear as:"}),t("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Hs},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Vs},{value:"multi-column",label:"Multi-column",imgURL:qs}].map(({value:a,label:l,imgURL:u})=>{const d=n.settings.shortcutsViewMode===a||a==="float-button"&&!n.settings.shortcutsViewMode;return t("label",{class:d?"checked":"",children:[t("input",{type:"radio",name:"shortcuts-view-mode",value:a,checked:d,onChange:f=>{$.settings.shortcutsViewMode=f.target.value}})," ",t("img",{src:u,alt:"",width:"80",height:"58"})," ",t("span",{children:l})]},a)})}),i.length>0?t(M,{children:[t("ol",{class:"shortcuts-list",ref:r,children:i.filter(Boolean).map((a,l)=>{const u=Object.values(a).join("-"),{type:d}=a;if(!He[d])return null;let{icon:f,title:p,subtitle:g,excludeViewMode:m}=He[d];typeof p=="function"&&(p=p(a,l)),typeof g=="function"&&(g=g(a,l)),typeof f=="function"&&(f=f(a,l)),typeof m=="function"&&(m=m(a,l));const y=m==null?void 0:m.includes(n.settings.shortcutsViewMode);return t("li",{children:[t(k,{icon:f}),t("span",{class:"shortcut-text",children:[t(cn,{children:p}),g&&t(M,{children:[" ",t("small",{class:"ib insignificant",children:g})]}),y&&t("span",{class:"tag",children:"Not available in current view mode"})]}),t("span",{class:"shortcut-actions",children:[t("button",{type:"button",class:"plain small",disabled:l===0,onClick:()=>{const b=Array.from($.shortcuts);if(l>0){const v=$.shortcuts[l-1];b[l-1]=a,b[l]=v,$.shortcuts=b}},children:t(k,{icon:"arrow-up",alt:"Move up"})}),t("button",{type:"button",class:"plain small",disabled:l===i.length-1,onClick:()=>{const b=Array.from($.shortcuts);if(l<$.shortcuts.length-1){const v=$.shortcuts[l+1];b[l+1]=a,b[l]=v,$.shortcuts=b}},children:t(k,{icon:"arrow-down",alt:"Move down"})}),t("button",{type:"button",class:"plain small",onClick:()=>{o({shortcut:a,shortcutIndex:l})},children:t(k,{icon:"pencil",alt:"Edit"})})]})]},u)})}),i.length===1&&n.settings.shortcutsViewMode!=="float-button"&&t("div",{class:"ui-state insignificant",children:[t(k,{icon:"info"})," ",t("small",{children:"Add more than one shortcut/column to make this work."})]})]}):t("div",{class:"ui-state insignificant",children:[t("p",{children:n.settings.shortcutsViewMode==="multi-column"?"No columns yet. Tap on the Add column button.":"No shortcuts yet. Tap on the Add shortcut button."}),t("p",{children:["Not sure what to add?",t("br",{}),"Try adding"," ",t("a",{href:"#",onClick:a=>{a.preventDefault(),$.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),t("p",{class:"insignificant",children:i.length>=Zt&&(n.settings.shortcutsViewMode==="multi-column"?`Max ${Zt} columns`:`Max ${Zt} shortcuts`)}),t("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t("button",{type:"button",class:"light",onClick:()=>h(!0),children:"Import/export"}),t("button",{type:"button",disabled:i.length>=Zt,onClick:()=>o(!0),children:[t(k,{icon:"plus"})," ",t("span",{children:n.settings.shortcutsViewMode==="multi-column"?"Add column…":"Add shortcut…"})]})]})]}),s&&t(Dt,{onClick:a=>{a.target===a.currentTarget&&o(!1)},children:t(eo,{shortcut:s.shortcut,shortcutIndex:s.shortcutIndex,onSubmit:({result:a,mode:l})=>{l==="edit"?$.shortcuts[s.shortcutIndex]=a:$.shortcuts.push(a)},onClose:()=>o(!1)})}),c&&t(Dt,{onClick:a=>{a.target===a.currentTarget&&h(!1)},children:t(no,{shortcuts:i,onClose:()=>h(!1)})})]})}const Qs=1e3*60,to=ie(()=>{const{masto:e}=q();return e.v1.lists.list()},{maxAge:Qs}),Dn={search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function eo({onSubmit:e,disabled:n,shortcut:i,shortcutIndex:s,onClose:o}){var y,b;const c=!!i,[h,r]=A((i==null?void 0:i.type)||null),{masto:a}=q(),[l,u]=A("default"),[d,f]=A([]),[p,g]=A([]);j(()=>{(async()=>{if(h==="list")try{u("loading");const v=await to();v.sort((S,w)=>S.title.localeCompare(w.title)),f(v),u("default")}catch{u("error")}})(),(async()=>{if(h==="hashtag")try{const v=await ze();g(v)}catch{}})()},[h]);const m=O();return j(()=>{if(c&&h&&Pe[h]){const v=m.current;Pe[h].forEach(({name:S,type:w})=>{const T=v.querySelector(`[name="${S}"]`);T&&i[S]&&(w==="checkbox"?T.checked=i[S]==="on":T.value=i[S])})}},[c,h]),t("div",{id:"shortcut-settings-form",class:"sheet",children:[!!o&&t("button",{type:"button",class:"sheet-close",onClick:o,children:t(k,{icon:"x"})}),t("header",{children:t("h2",{children:[c?"Edit":"Add"," shortcut"]})}),t("main",{tabindex:"-1",children:t("form",{ref:m,onSubmit:v=>{v.preventDefault();const S=new FormData(v.target),w={};S.forEach((T,I)=>{w[I]=T==null?void 0:T.trim(),I==="instance"&&(w[I]=w[I].replace(/^https?:\/\//,"").replace(/\/+$/,""),w[I]=w[I].replace(/^@?[^@]+@/,""))}),w.type&&(e({result:w,mode:c?"edit":"add"}),v.target.reset(),r(null),o==null||o())},children:[t("p",{children:t("label",{children:[t("span",{children:"Timeline"}),t("select",{required:!0,disabled:n,onChange:v=>{r(v.target.value)},defaultValue:c?i.type:void 0,name:"type",children:[t("option",{}),Zs.map(v=>t("option",{value:v,children:Ci[v]}))]})]})}),(b=(y=Pe[h])==null?void 0:y.map)==null?void 0:b.call(y,({text:v,name:S,type:w,placeholder:T,pattern:I,notRequired:C})=>h==="list"?t("p",{children:t("label",{children:[t("span",{children:"List"}),t("select",{name:"id",required:!C,disabled:n||l==="loading",defaultValue:c?i.id:void 0,children:d.map(B=>t("option",{value:B.id,children:B.title}))})]})}):t("p",{children:t("label",{children:[t("span",{children:v})," ",t("input",{type:w,switch:w==="checkbox"||void 0,name:S,placeholder:T,required:w==="text"&&!C,disabled:n,list:h==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:I}),h==="hashtag"&&p.length>0&&t("datalist",{id:"followed-hashtags-datalist",children:p.map(B=>t("option",{value:B.name}))})]})})),!!Dn[h]&&t("p",{class:"form-note insignificant",children:[t(k,{icon:"info"}),Dn[h]]}),t("footer",{children:[t("button",{type:"submit",class:"block",disabled:n||l==="loading",children:c?"Save":"Add"}),c&&t("button",{type:"button",class:"light danger",onClick:()=>{$.shortcuts.splice(s,1),o==null||o()},children:"Remove"})]})]})})]})}function no({shortcuts:e,onClose:n}){var d;const{masto:i}=q(),s=mt(()=>!e||!e.filter(Boolean).length?"":Nn.compressToEncodedURIComponent(JSON.stringify(e.filter(Boolean))),[e]),[o,c]=A(""),[h,r]=A("default"),a=mt(()=>{if(!o)return r("default"),null;try{const f=JSON.parse(Nn.decompressFromEncodedURIComponent(o));if(!Array.isArray(f))throw new Error("Not an array");return r("default"),f}catch{try{const p=JSON.parse(o);if(!Array.isArray(p))throw new Error("Not an array");return r("default"),p}catch{return r("error"),null}}},[o]),l=$.shortcuts.length>0,u=O();return t("div",{id:"import-export-container",class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(k,{icon:"x"})}),t("header",{children:t("h2",{children:["Import/Export ",t("small",{class:"ib insignificant",children:"Shortcuts"})]})}),t("main",{tabindex:"-1",children:[t("section",{children:[t("h3",{children:[t(k,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Import"})]}),t("p",{class:"field-button",children:[t("input",{ref:u,type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:f=>{c(f.target.value)}}),$.settings.shortcutSettingsCloudImportExport&&t("button",{type:"button",class:"plain2 small",disabled:h==="cloud-downloading",onClick:async()=>{r("cloud-downloading");const f=gt.session.get("currentAccount");rt("Downloading saved shortcuts from instance server…");try{const g=(await i.v1.accounts.relationships.fetch({id:[f]}))[0];if(g){const{note:m=""}=g;if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const y=m.match(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/)[1],{v:b,dt:v,data:S}=JSON.parse(y);u.current.value=S,u.current.dispatchEvent(new Event("input"))}}r("default")}catch{r("error"),rt("Unable to download shortcuts")}},title:"Download shortcuts from instance server",children:[t(k,{icon:"cloud"}),t(k,{icon:"arrow-down"})]})]}),!!a&&Array.isArray(a)&&t(M,{children:[t("p",{children:[t("b",{children:a.length})," shortcut",a.length>1?"s":""," ",t("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),t("ol",{class:"import-settings-list",children:a.map(f=>{var p,g;return t("li",{children:[t("span",{style:{opacity:e.some(m=>Object.keys(m).every(y=>m[y]===f[y]))?1:0},children:"*"}),t("span",{children:[Ci[f.type],f.type==="list"&&" ⚠️"," ",(g=(p=Pe[f.type])==null?void 0:p.map)==null?void 0:g.call(p,({text:m,name:y,type:b})=>f[y]?t(M,{children:[t("span",{class:"tag collapsed insignificant",children:[m,":"," ",b==="checkbox"?f[y]==="on"?"✅":"❌":f[y]]})," "]}):null)]})]})})}),t("p",{children:[t("small",{children:"* Exists in current shortcuts"}),t("br",{}),t("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),h==="error"&&t("p",{class:"error",children:t("small",{children:"⚠️ Invalid settings format"})}),t("p",{children:[l&&t(M,{children:[t(oe,{confirmLabel:"Append to current shortcuts?",menuFooter:t("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const f=a.filter(m=>!$.shortcuts.some(y=>Object.keys(y).every(b=>y[b]===m[b])));if(!f.length){rt("No new shortcuts to import");return}let p=[...$.shortcuts,...f];const g=p.length>Zt;g&&(p=p.slice(0,Zt)),$.shortcuts=p,rt(g?`Shortcuts imported. Exceeded max ${Zt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!a,children:"Import & append…"})})," "]}),t(oe,{confirmLabel:l?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:l?"danger":void 0,onClick:()=>{$.shortcuts=a,rt("Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!a,children:l?"or override…":"Import…"})})]})]}),t("section",{children:[t("h3",{children:[t(k,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Export"})]}),t("p",{children:t("input",{style:{width:"100%"},type:"text",value:s,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),rt("Shortcuts copied")}catch{rt("Unable to copy shortcuts")}}}})}),t("p",{children:[t("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.clipboard.writeText(s),rt("Shortcut settings copied")}catch{rt("Unable to copy shortcut settings")}},children:[t(k,{icon:"clipboard"})," ",t("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:s}))&&t("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.share({text:s})}catch{alert("Sharing doesn't seem to work.")}},children:[t(k,{icon:"share"})," ",t("span",{children:"Share"})]})," ",$.settings.shortcutSettingsCloudImportExport&&t("button",{type:"button",class:"plain2",disabled:h==="cloud-uploading",onClick:async()=>{r("cloud-uploading");const f=gt.session.get("currentAccount");try{const g=(await i.v1.accounts.relationships.fetch({id:[f]}))[0];if(g){const{note:m=""}=g;let y="";if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const b=JSON.stringify({v:"1",dt:Date.now(),data:s});y=m.replace(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/,`<phanpy-shortcuts-settings>${b}</phanpy-shortcuts-settings>`)}else y=`${m}


<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;rt("Saving shortcuts to instance server…"),await i.v1.accounts.$select(f).note.create({comment:y}),r("default"),rt("Shortcuts saved")}}catch{r("error"),rt("Unable to save shortcuts")}},title:"Sync to instance server",children:[t(k,{icon:"cloud"}),t(k,{icon:"arrow-up"})]})," ",s.length>0&&t("small",{class:"insignificant ib",children:[s.length," characters"]})]}),!!s&&t("details",{children:[t("summary",{class:"insignificant",children:t("small",{children:"Raw Shortcuts JSON"})}),t("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(e.filter(Boolean),null,2)})]})]}),$.settings.shortcutSettingsCloudImportExport&&t("footer",{children:t("p",{children:[t(k,{icon:"cloud"})," Import/export settings from/to instance server (Very experimental)"]})})]})]})}function io(){const{instance:e}=q(),n=$t($),{shortcuts:i,settings:s}=n;if(!i.length||s.shortcutsViewMode==="multi-column"||!s.shortcutsViewMode&&s.shortcutsColumnsMode)return null;const o=O(),c=mt(()=>i.map((r,a)=>{const{type:l,...u}=r;if(!He[l])return null;let{id:d,path:f,title:p,subtitle:g,icon:m}=He[l];return typeof d=="function"&&(d=d(u,a)),typeof f=="function"&&(f=f({...u,instance:u.instance||e},a)),typeof p=="function"&&(p=p(u,a)),typeof g=="function"&&(g=g(u,a)),typeof m=="function"&&(m=m(u,a)),{id:d,path:f,title:p,subtitle:g,icon:m}}).filter(Boolean),[i]),h=Ki();return St(["1","2","3","4","5","6","7","8","9"],(r,a)=>{var u,d;const l=parseInt(a.keys[0],10)-1;if(l<c.length){const{path:f}=c[l];f&&(h(f),(d=(u=o.current)==null?void 0:u.closeMenu)==null||d.call(u))}}),t("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?t("nav",{class:"tab-bar",onContextMenu:r=>{r.preventDefault(),$.showShortcutsSettings=!0},children:t("ul",{children:c.map(({id:r,path:a,title:l,subtitle:u,icon:d},f)=>t("li",{children:t(tt,{class:u?"has-subtitle":"",to:a,onClick:p=>{if(p.target.classList.contains("is-active")){p.preventDefault();const g=document.getElementById(`${r}-page`);if(g){g.scrollTop=0;const m=g.querySelector(".updates-button");m&&m.click()}}},children:[t(k,{icon:d,size:"xl",alt:l}),t("span",{children:[t(cn,{children:l}),u&&t(M,{children:[t("br",{}),t("small",{children:u})]})]})]})},`${f}-${r}-${l}-${u}-${a}`))})}):t(Qt,{instanceRef:o,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:t("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:r=>{r.preventDefault(),$.showShortcutsSettings=!0},onTransitionStart:r=>{var a,l;try{const{target:u}=r;getComputedStyle(u).pointerEvents==="none"&&((l=(a=o.current)==null?void 0:a.closeMenu)==null||l.call(a))}catch{}},children:t(k,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:c.map(({id:r,path:a,title:l,subtitle:u,icon:d},f)=>t(Lt,{to:a,class:"glass-menu-item",children:[t(k,{icon:d,size:"l"})," ",t("span",{class:"menu-grow",children:[t("span",{children:t(cn,{children:l})}),u&&t(M,{children:[" ",t("small",{class:"more-insignificant",children:u})]})]}),t("span",{class:"menu-shortcut hide-until-focus-visible",children:f+1})]},`${f}-${r}-${l}-${u}-${a}`))})})}const so=Ht(io);function vn({list:e,onClose:n}){const{masto:i}=q(),[s,o]=A("default"),c=!!e,h=O(),r=O(),a=O();j(()=>{c&&(h.current.value=e.title,r.current.value=e.repliesPolicy,a.current&&(a.current.checked=e.exclusive))},[c]);const l=ni("@mastodon/list-exclusive");return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(k,{icon:"x"})})," ",t("header",{children:t("h2",{children:c?"Edit list":"New list"})}),t("main",{children:t("form",{class:"list-form",onSubmit:u=>{u.preventDefault();const d=new FormData(u.target),f=d.get("title"),p=d.get("replies_policy"),g=d.get("exclusive")==="on";o("loading"),(async()=>{try{let m;c?m=await i.v1.lists.$select(e.id).update({title:f,replies_policy:p,exclusive:g}):m=await i.v1.lists.create({title:f,replies_policy:p,exclusive:g}),o("default"),n==null||n({state:"success",list:m})}catch{o("error"),alert(c?"Unable to edit list.":"Unable to create list.")}})()},children:[t("div",{class:"list-form-row",children:t("label",{for:"list-title",children:["Name"," ",t("input",{ref:h,type:"text",id:"list-title",name:"title",required:!0,disabled:s==="loading",dir:"auto"})]})}),t("div",{class:"list-form-row",children:t("select",{ref:r,name:"replies_policy",required:!0,disabled:s==="loading",children:[t("option",{value:"list",children:"Show replies to list members"}),t("option",{value:"followed",children:"Show replies to people I follow"}),t("option",{value:"none",children:"Don't show replies"})]})}),l&&t("div",{class:"list-form-row",children:t("label",{class:"label-block",children:[t("input",{ref:a,type:"checkbox",name:"exclusive",disabled:s==="loading"})," ","Hide posts on this list from Home/Following"]})}),t("div",{class:"list-form-footer",children:[t("button",{type:"submit",disabled:s==="loading",children:c?"Save":"Create"}),c&&t(oe,{disabled:s==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await i.v1.lists.$select(e.id).remove(),o("default"),n==null||n({state:"deleted"})}catch{o("error"),alert("Unable to delete list.")}})()},children:t("button",{type:"button",class:"light danger",disabled:s==="loading",children:"Delete…"})})]})]})})]})}const oo=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],Un={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},On=80,$i=1e3*60*10;function co(e,n){return n.v1.accounts.familiarFollowers.fetch({id:[e]})}const ao=ie(co,{maxAge:$i});async function ro(e,n){const i=n.v1.accounts.$select(e).statuses.list({limit:20}).next(),{value:s}=await i,o={total:s.length,originals:0,replies:0,boosts:0};return s.forEach(c=>{c.reblog?o.boosts++:c.inReplyToId&&c.inReplyToAccountId!==c.account.id?o.replies++:o.originals++}),s.length&&(o.daysSinceLastPost=Math.ceil((Date.now()-new Date(s[s.length-1].createdAt))/864e5)),o}const lo=ie(ro,{maxAge:$i});function uo({account:e,fetchAccount:n=()=>{},standalone:i,instance:s,authenticated:o}){const{masto:c}=q({instance:s}),{masto:h,instance:r}=q(),[a,l]=A("default"),u=typeof e=="string",[d,f]=A(u?null:e),p=mt(()=>s===r,[s,r]);j(()=>{if(!u){f(e);return}l("loading"),(async()=>{try{const N=await n();$.accounts[`${N.id}@${s}`]=N,f(N),l("default")}catch{f(null),l("error")}})()},[u,e,n]);const{acct:g,avatar:m,avatarStatic:y,bot:b,createdAt:v,displayName:S,emojis:w,fields:T,followersCount:I,followingCount:C,group:B,id:R,lastStatusAt:U,locked:F,note:_,statusesCount:P,url:L,username:W,memorial:H,moved:et,roles:X}=d||{};let bt=!1,{header:Z,headerStatic:dt}=d||{};(!Z||/missing\.png$/.test(Z))&&m&&!/missing\.png$/.test(m)&&(Z=m,bt=!0,y&&!/missing\.png$/.test(y)&&(dt=y));const nt=mt(()=>R===gt.session.get("currentAccount"),[R]);j(()=>{const N=!!(d!=null&&d.id&&(d!=null&&d.username)&&(d!=null&&d.acct)&&(d!=null&&d.avatar)&&(d!=null&&d.avatarStatic)&&(d!=null&&d.displayName)&&(d!=null&&d.url));if(nt&&s&&N){const st=gt.local.getJSON("accounts");let pt=!1;st.forEach(ct=>{ct.info.id===d.id&&ct.instanceURL===s&&(ct.info=d,pt=!0)}),pt&&gt.local.setJSON("accounts",st)}},[nt,d,s]);const ht=mt(()=>L?new URL(L).hostname:null,[L]),[ft,xt]=A([]),wt=O(),It=O([]);async function Tt(N){(N||!wt.current)&&(wt.current=c.v1.accounts.$select(R).followers.list({limit:On}));const st=await wt.current.next();if(nt||!p)return st;const{value:pt}=st;let ct=[];if(N){const Ut=await c.v1.accounts.familiarFollowers.fetch({id:[R]});It.current=Ut[0].accounts,ct=[...It.current,...pt.filter(Ot=>!It.current.some(At=>At.id===Ot.id))]}else pt!=null&&pt.length&&(ct=pt.filter(Ut=>!It.current.some(Ot=>Ot.id===Ut.id)));return{...st,value:ct}}const vt=O();async function K(N){return(N||!vt.current)&&(vt.current=c.v1.accounts.$select(R).following.list({limit:On})),await vt.current.next()}const J=i?"div":tt,D=s?`/${s}/a/${R}`:`/a/${R}`,[ot,ut]=A([]),[Y,at]=A(),[E,G]=A("default"),Q=!!(Y!=null&&Y.total),x=async N=>{try{const st=await ao(N,h);ut(st[0].accounts.slice(0,ho))}catch{}},z=async()=>{if(R){G("loading");try{const N=await lo(R,c);at(N),G("default")}catch{G("error")}}},V=Wt(({relationship:N,currentID:st})=>{N.following||(x(st),!i&&P>0&&z())},[i,R,P]);return t("div",{tabIndex:"-1",class:`account-container ${a==="loading"?"skeleton":""}`,style:{"--header-color-1":ft[0],"--header-color-2":ft[1],"--header-color-3":ft[2],"--header-color-4":ft[3]},children:[a==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to load account."}),t("p",{children:t("a",{href:u?e:L,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",t(k,{icon:"external"})]})})]}),a==="loading"?t(M,{children:[t("header",{children:t(Xt,{avatarSize:"xxxl",skeleton:!0})}),t("main",{children:[t("div",{class:"note",children:[t("p",{children:"███████ ████ ████"}),t("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),t("div",{class:"account-metadata-box",children:[t("div",{class:"profile-metadata",children:[t("div",{class:"profile-field",children:[t("b",{class:"more-insignificant",children:"███"}),t("p",{children:"██████"})]}),t("div",{class:"profile-field",children:[t("b",{class:"more-insignificant",children:"████"}),t("p",{children:"███████████"})]})]}),t("div",{class:"stats",children:[t("div",{children:[t("span",{children:"██"})," Followers"]}),t("div",{children:[t("span",{children:"██"})," Following"]}),t("div",{children:[t("span",{children:"██"})," Posts"]})]})]}),t("div",{class:"actions",children:[t("span",{}),t("span",{class:"buttons",children:t("button",{type:"button",title:"More",class:"plain",disabled:!0,children:t(k,{icon:"more",size:"l",alt:"More"})})})]})]})]}):d&&t(M,{children:[!!et&&t("div",{class:"account-moved",children:[t("p",{children:[t("b",{children:S})," has indicated that their new account is now:"]}),t(Xt,{account:et,instance:s,onClick:N=>{N.stopPropagation(),$.showAccount=et}})]}),!!Z&&!/missing\.png$/.test(Z)&&t("img",{src:Z,alt:"",class:`header-banner ${bt?"header-is-avatar":""}`,onError:N=>{N.target.crossOrigin?N.target.src!==dt?N.target.src=dt:(N.target.removeAttribute("crossorigin"),N.target.src=Z):N.target.src!==dt?N.target.src=dt:N.target.remove()},crossOrigin:"anonymous",onLoad:N=>{N.target.classList.add("loaded");try{const st=window.OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas"),pt=st.getContext("2d",{willReadFrequently:!0});st.width=N.target.width,st.height=N.target.height,pt.imageSmoothingEnabled=!1,pt.drawImage(N.target,0,0);const ct=10,Ot=[pt.getImageData(0,0,ct,ct).data,pt.getImageData(N.target.width-ct,0,ct,ct).data,pt.getImageData(0,N.target.height-ct,ct,ct).data,pt.getImageData(N.target.width-ct,N.target.height-ct,ct,ct).data].map(At=>{let Ft=0,Vt=0,Ct=0,qt=0;for(let Bt=0;Bt<At.length;Bt+=4)Ft+=At[Bt],Vt+=At[Bt+1],Ct+=At[Bt+2],qt+=At[Bt+3];const le=At.length/4;return[Ft/le,Vt/le,Ct/le,qt/le]}).map(At=>{const[Ft,Vt,Ct,qt]=po(At);return`rgba(${Ft}, ${Vt}, ${Ct}, ${qt})`});xt(Ot)}catch{}}}),t("header",{children:t(Xt,{account:d,instance:s,avatarSize:"xxxl",external:i,internal:!i})}),t("div",{class:"faux-header-bg","aria-hidden":"true"}),t("main",{children:[!!H&&t("span",{class:"tag",children:"In Memoriam"}),!!b&&t("span",{class:"tag",children:[t(k,{icon:"bot"})," Automated"]}),!!B&&t("span",{class:"tag",children:[t(k,{icon:"group"})," Group"]}),X==null?void 0:X.map(N=>t("span",{class:"tag",children:[N.name,!!ht&&t(M,{children:[" ",t("span",{class:"more-insignificant",children:ht})]})]})),t("div",{class:"note",dir:"auto",onClick:ii({instance:r}),dangerouslySetInnerHTML:{__html:tn(_,{emojis:w})}}),t("div",{class:"account-metadata-box",children:[(T==null?void 0:T.length)>0&&t("div",{class:"profile-metadata",children:T.map(({name:N,value:st,verifiedAt:pt},ct)=>t("div",{class:`profile-field ${pt?"profile-verified":""}`,dir:"auto",children:[t("b",{children:[t(si,{text:N,emojis:w})," ",!!pt&&t(k,{icon:"check-circle",size:"s"})]}),t("p",{dangerouslySetInnerHTML:{__html:tn(st,{emojis:w})}})]},N+ct))}),t("div",{class:"stats",children:[t(J,{tabIndex:0,to:D,onClick:()=>{setTimeout(()=>{$.showGenericAccounts={heading:"Followers",fetchAccounts:Tt,instance:s,excludeRelationshipAttrs:nt?["followedBy"]:[]}},0)},children:[!!ot.length&&t("span",{class:"shazam-container-horizontal",children:t("span",{class:"shazam-container-inner stats-avatars-bunch",children:ot.map(N=>t(fe,{url:N.avatarStatic,size:"s",alt:`${N.displayName} @${N.acct}`,squircle:N==null?void 0:N.bot}))})}),t("span",{title:I,children:zt(I)})," ","Followers"]}),t(J,{class:"insignificant",tabIndex:0,to:D,onClick:()=>{setTimeout(()=>{$.showGenericAccounts={heading:"Following",fetchAccounts:K,instance:s,excludeRelationshipAttrs:nt?["following"]:[]}},0)},children:[t("span",{title:C,children:zt(C)})," ","Following",t("br",{})]}),t(J,{class:"insignificant",to:D,children:[t("span",{title:P,children:zt(P)})," ","Posts"]}),!!v&&t("div",{class:"insignificant",children:["Joined"," ",t("time",{datetime:v,children:se(v,{hideTime:!0})})]})]})]}),!!Y&&t(J,{to:D,class:"account-metadata-box",children:t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:Q?t("div",{class:"posting-stats",title:`${Math.round(Y.originals/Y.total*100)}% original posts, ${Math.round(Y.replies/Y.total*100)}% replies, ${Math.round(Y.boosts/Y.total*100)}% boosts`,children:[t("div",{children:Y.daysSinceLastPost<365?`Last ${Y.total} post${Y.total>1?"s":""} in the past 
                      ${Y.daysSinceLastPost} day${Y.daysSinceLastPost>1?"s":""}`:`
                      Last ${Y.total} posts in the past year(s)
                      `}),t("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${Y.originals/Y.total*100}%`,"--replies-percentage":`${(Y.originals+Y.replies)/Y.total*100}%`}}),t("div",{class:"posting-stats-legends",children:[t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",t("span",{class:"ib",children:[t("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):t("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),t("div",{class:"account-metadata-box",children:t("div",{class:"shazam-container no-animation",hidden:!!Y,children:t("div",{class:"shazam-container-inner",children:t("button",{type:"button",class:"posting-stats-button",disabled:E==="loading",onClick:()=>{z()},children:[t("div",{class:`posting-stats-bar posting-stats-icon ${E==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),t("footer",{children:t(fo,{info:d,instance:s,authenticated:o,onRelationshipChange:V})})]})]})}const ho=3;function fo({info:e,instance:n,authenticated:i,onRelationshipChange:s=()=>{}}){var J;if(!e)return null;const{masto:o,instance:c,authenticated:h}=q(),r=n===c,[a,l]=A("default"),[u,d]=A(null),{id:f,acct:p,url:g,username:m,locked:y,lastStatusAt:b,note:v,fields:S,moved:w}=e,T=O(f),{following:I,showingReblogs:C,notifying:B,followedBy:R,blocking:U,blockedBy:F,muting:_,mutingNotifications:P,requested:L,domainBlocking:W,endorsed:H,note:et}=u||{},[X,bt]=A(null),[Z,dt]=A(!1);j(()=>{if(e){const D=gt.session.get("currentAccount");let ot;(async()=>{if(r&&i)ot=f;else if(!r&&h){const Y=e.acct.includes("@");try{const at=await o.v2.search.fetch({q:Y?e.acct:`${e.username}@${n}`,type:"accounts",limit:1,resolve:!0});at.accounts.length&&(ot=at.accounts[0].id,bt(at.accounts[0]))}catch{}}if(!ot)return;if(D===ot){dt(!0);return}if(T.current=ot,w)return;l("loading");const ut=o.v1.accounts.relationships.fetch({id:[ot]});try{const Y=await ut;if(l("default"),Y.length){const at=Y[0];d(at),s({relationship:at,currentID:ot})}}catch{l("error")}})()}},[e,i]),j(()=>{e&&Z&&Zi(e)},[e,Z]);const nt=a==="loading",[ht,ft]=A(!1),[xt,wt]=A(!1),[It,Tt]=A(!1),[vt,K]=A([]);return t(M,{children:[t("div",{class:"actions",children:[t("span",{children:[R?t("span",{class:"tag",children:"Follows you"}):b?t("small",{class:"insignificant",children:["Last post:"," ",t("span",{class:"ib",children:se(b,{hideTime:!0})})]}):t("span",{}),_&&t("span",{class:"tag danger",children:"Muted"}),U&&t("span",{class:"tag danger",children:"Blocked"})]})," ",t("span",{class:"buttons",children:[!!et&&t("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{Tt(!0)},dir:"auto",children:t("span",{children:et})}),t(Qt,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:t("button",{type:"button",title:"More",class:"plain",disabled:nt,children:t(k,{icon:"more",size:"l",alt:"More"})}),onMenuChange:D=>{I&&D.open&&(async()=>{try{const ot=await o.v1.accounts.$select(T.current).lists.list();K(ot)}catch{}})()},children:[h&&!Z&&t(M,{children:[t(lt,{onClick:()=>{$.showCompose={draftStatus:{status:`@${(X==null?void 0:X.acct)||p} `}}},children:[t(k,{icon:"at"}),t("span",{children:["Mention @",m]})]}),t(lt,{onClick:()=>{ft(!0)},children:[t(k,{icon:"translate"}),t("span",{children:"Translate bio"})]}),t(lt,{onClick:()=>{Tt(!0)},children:[t(k,{icon:"pencil"}),t("span",{children:et?"Edit private note":"Add private note"})]}),I&&t(lt,{onClick:()=>{wt(!0)},children:[t(k,{icon:"list"}),vt.length?t(M,{children:[t("small",{class:"menu-grow",children:["Add/Remove from Lists",t("br",{}),t("span",{class:"more-insignificant",children:vt.map(D=>D.title).join(", ")})]}),t("small",{class:"more-insignificant",children:vt.length})]}):t("span",{children:"Add/Remove from Lists"})]}),t(Nt,{})]}),t(lt,{onClick:()=>{const D=`@${(X==null?void 0:X.acct)||p}`;try{navigator.clipboard.writeText(D),rt("Handle copied")}catch{rt("Unable to copy handle")}},children:[t(k,{icon:"copy"}),t("small",{children:["Copy handle",t("br",{}),t("span",{class:"more-insignificant",children:["@",(X==null?void 0:X.acct)||p]})]})]}),t(lt,{href:g,target:"_blank",children:[t(k,{icon:"external"}),t("small",{class:"menu-double-lines",children:mo(g)})]}),t("div",{class:"menu-horizontal",children:[t(lt,{onClick:()=>{try{navigator.clipboard.writeText(g),rt("Link copied")}catch{rt("Unable to copy link")}},children:[t(k,{icon:"link"}),t("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((J=navigator==null?void 0:navigator.canShare)==null?void 0:J.call(navigator,{url:g}))&&t(lt,{onClick:()=>{try{navigator.share({url:g})}catch{alert("Sharing doesn't seem to work.")}},children:[t(k,{icon:"share"}),t("span",{children:"Share…"})]})]}),!!u&&t(M,{children:[t(Nt,{}),_?t(lt,{onClick:()=>{l("loading"),(async()=>{try{const D=await o.v1.accounts.$select((X==null?void 0:X.id)||f).unmute();d(D),l("default"),rt(`Unmuted @${m}`),$.reloadGenericAccounts.id="mute",$.reloadGenericAccounts.counter++}catch{l("error")}})()},children:[t(k,{icon:"unmute"}),t("span",{children:["Unmute @",m]})]}):t(oi,{menuClassName:"menu-blur",openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:t(M,{children:[t(k,{icon:"mute"}),t("span",{class:"menu-grow",children:["Mute @",m,"…"]}),t("span",{style:{textOverflow:"clip"},children:[t(k,{icon:"time"}),t(k,{icon:"chevron-right"})]})]}),children:t("div",{class:"menu-wrap",children:oo.map(D=>t(lt,{onClick:()=>{l("loading"),(async()=>{try{const ot=await o.v1.accounts.$select((X==null?void 0:X.id)||f).mute({duration:D});d(ot),l("default"),rt(`Muted @${m} for ${Un[D]}`),$.reloadGenericAccounts.id="mute",$.reloadGenericAccounts.counter++}catch{l("error"),rt(`Unable to mute @${m}`)}})()},children:Un[D]}))})}),t(oe,{subMenu:!0,confirm:!U,confirmLabel:t(M,{children:[t(k,{icon:"block"}),t("span",{children:["Block @",m,"?"]})]}),menuItemClassName:"danger",onClick:()=>{l("loading"),(async()=>{try{if(U){const D=await o.v1.accounts.$select((X==null?void 0:X.id)||f).unblock();d(D),l("default"),rt(`Unblocked @${m}`)}else{const D=await o.v1.accounts.$select((X==null?void 0:X.id)||f).block();d(D),l("default"),rt(`Blocked @${m}`)}$.reloadGenericAccounts.id="block",$.reloadGenericAccounts.counter++}catch{l("error"),U?rt(`Unable to unblock @${m}`):rt(`Unable to block @${m}`)}})()},children:U?t(M,{children:[t(k,{icon:"unblock"}),t("span",{children:["Unblock @",m]})]}):t(M,{children:[t(k,{icon:"block"}),t("span",{children:["Block @",m,"…"]})]})}),t(lt,{className:"danger",onClick:()=>{$.showReportModal={account:X||e}},children:[t(k,{icon:"flag"}),t("span",{children:["Report @",m,"…"]})]})]}),!1]}),!u&&a==="loading"&&t(kt,{abrupt:!0}),!!u&&t(oe,{confirm:I||L,confirmLabel:t("span",{children:L?"Withdraw follow request?":`Unfollow @${e.acct||e.username}?`}),menuItemClassName:"danger",align:"end",disabled:nt,onClick:()=>{l("loading"),(async()=>{try{let D;I||L?D=await o.v1.accounts.$select(T.current).unfollow():D=await o.v1.accounts.$select(T.current).follow(),D&&d(D),l("default")}catch(D){alert(D),l("error")}})()},children:t("button",{type:"button",class:`${I||L?"light swap":""}`,"data-swap-state":I||L?"danger":"",disabled:nt,children:I?t(M,{children:[t("span",{children:"Following"}),t("span",{children:"Unfollow…"})]}):L?t(M,{children:[t("span",{children:"Requested"}),t("span",{children:"Withdraw…"})]}):y?t(M,{children:[t(k,{icon:"lock"})," ",t("span",{children:"Follow"})]}):"Follow"})})]})]}),!!ht&&t(Dt,{onClose:()=>{ft(!1)},children:t(go,{note:v,fields:S,onClose:()=>ft(!1)})}),!!xt&&t(Dt,{onClose:()=>{wt(!1)},children:t(bo,{accountID:T.current,onClose:()=>wt(!1)})}),!!It&&t(Dt,{onClose:()=>{Tt(!1)},children:t(vo,{account:e,note:et,onRelationshipChange:D=>{d(D)},onClose:()=>Tt(!1)})})]})}function po([e,n,i]){const s=.2126*e+.7152*n+.0722*i;let o;return s>=220?o=1:s<=50?o=.1:o=s/255,o=Math.min(1,o),[e,n,i,o]}function mo(e){if(!e)return;const n=new URL(e),{host:i,pathname:s}=n,o=s.replace(/\/$/,"").replace(/^\//,"");return t(M,{children:[t("span",{class:"more-insignificant",children:[i,"/"]}),t("wbr",{}),t("span",{children:o})]})}function go({note:e,fields:n,onClose:i}){const s=(n==null?void 0:n.map(({name:c,value:h})=>`${c}
${Cn(h)}`).join(`

`))||"",o=Cn(e)+(s?`

${s}`:"");return t("div",{class:"sheet",children:[!!i&&t("button",{type:"button",class:"sheet-close",onClick:i,children:t(k,{icon:"x"})}),t("header",{children:t("h2",{children:"Translated Bio"})}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:o}),t(Xi,{forceTranslate:!0,text:o})]})]})}function bo({accountID:e,onClose:n}){const{masto:i}=q(),[s,o]=A("default"),[c,h]=A([]),[r,a]=A([]),[l,u]=ci(p=>p+1,0);j(()=>{o("loading"),(async()=>{try{const p=await i.v1.lists.list();p.sort((m,y)=>m.title.localeCompare(y.title));const g=await i.v1.accounts.$select(e).lists.list();h(p),a(g),o("default")}catch{o("error")}})()},[l]);const[d,f]=A(!1);return t("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(k,{icon:"x"})}),t("header",{children:t("h2",{children:"Add/Remove from Lists"})}),t("main",{children:[c.length>0?t("ul",{class:"list-add-remove",children:c.map(p=>{const g=r.some(m=>m.id===p.id);return t("li",{children:t("button",{type:"button",class:`light ${g?"checked":""}`,disabled:s==="loading",onClick:()=>{o("loading"),(async()=>{try{g?await i.v1.lists.$select(p.id).accounts.remove({accountIds:[e]}):await i.v1.lists.$select(p.id).accounts.create({accountIds:[e]}),u()}catch{o("error"),alert(g?"Unable to remove from list.":"Unable to add to list.")}})()},children:[t(k,{icon:"check-circle"}),t("span",{children:p.title})]})})})}):s==="loading"?t("p",{class:"ui-state",children:t(kt,{abrupt:!0})}):s==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists."}),t("button",{type:"button",class:"plain2",onClick:()=>f(!0),disabled:s!=="default",children:[t(k,{icon:"plus",size:"l"})," ",t("span",{children:"New list"})]})]}),d&&t(Dt,{onClick:p=>{p.target===p.currentTarget&&f(!1)},children:t(vn,{list:d==null?void 0:d.list,onClose:p=>{p.state==="success"&&u(),f(!1)}})})]})}function vo({account:e,note:n,onRelationshipChange:i=()=>{},onClose:s=()=>{}}){const{masto:o}=q(),[c,h]=A("default"),r=O(null);return j(()=>{let a;return r.current&&!n&&(a=setTimeout(()=>{var l,u;(u=(l=r.current).focus)==null||u.call(l)},100)),()=>{clearTimeout(a)}},[]),t("div",{class:"sheet",id:"private-note-container",children:[!!s&&t("button",{type:"button",class:"sheet-close",onClick:s,children:t(k,{icon:"x"})}),t("header",{children:t("b",{children:["Private note about @",(e==null?void 0:e.username)||(e==null?void 0:e.acct)]})}),t("main",{children:t("form",{onSubmit:a=>{a.preventDefault();const u=new FormData(a.target).get("note");(u==null?void 0:u.trim())!==(n==null?void 0:n.trim())&&(h("loading"),(async()=>{try{const d=await o.v1.accounts.$select(e==null?void 0:e.id).note.create({comment:u});h("default"),i(d),s()}catch(d){h("error"),alert((d==null?void 0:d.message)||"Unable to update private note.")}})())},children:[t("textarea",{ref:r,name:"note",disabled:c==="loading",children:n}),t("footer",{children:[t("button",{type:"button",class:"light",disabled:c==="loading",onClick:()=>{s==null||s()},children:"Cancel"}),t("span",{children:[t(kt,{abrupt:!0,hidden:c!=="loading"}),t("button",{disabled:c==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}var wo=Object.defineProperty,yo=(e,n,i)=>n in e?wo(e,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[n]=i,Ee=(e,n,i)=>(yo(e,typeof n!="symbol"?n+"":n,i),i),an=new Map,Re=new WeakMap,Fn=0,So=void 0;function ko(e){return e?(Re.has(e)||(Fn+=1,Re.set(e,Fn.toString())),Re.get(e)):"0"}function Io(e){return Object.keys(e).sort().filter(n=>e[n]!==void 0).map(n=>`${n}_${n==="root"?ko(e.root):e[n]}`).toString()}function To(e){const n=Io(e);let i=an.get(n);if(!i){const s=new Map;let o;const c=new IntersectionObserver(h=>{h.forEach(r=>{var a;const l=r.isIntersecting&&o.some(u=>r.intersectionRatio>=u);e.trackVisibility&&typeof r.isVisible>"u"&&(r.isVisible=l),(a=s.get(r.target))==null||a.forEach(u=>{u(l,r)})})},e);o=c.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),i={id:n,observer:c,elements:s},an.set(n,i)}return i}function Co(e,n,i={},s=So){if(typeof window.IntersectionObserver>"u"&&s!==void 0){const a=e.getBoundingClientRect();return n(s,{isIntersecting:s,target:e,intersectionRatio:typeof i.threshold=="number"?i.threshold:0,time:0,boundingClientRect:a,intersectionRect:a,rootBounds:a}),()=>{}}const{id:o,observer:c,elements:h}=To(i),r=h.get(e)||[];return h.has(e)||h.set(e,r),r.push(n),c.observe(e),function(){r.splice(r.indexOf(n),1),r.length===0&&(h.delete(e),c.unobserve(e)),h.size===0&&(c.disconnect(),an.delete(o))}}function $o(e){return typeof e.children!="function"}var ne=class extends Ji{constructor(e){super(e),Ee(this,"node",null),Ee(this,"_unobserveCb",null),Ee(this,"handleNode",n=>{this.node&&(this.unobserve(),!n&&!this.props.triggerOnce&&!this.props.skip&&this.setState({inView:!!this.props.initialInView,entry:void 0})),this.node=n||null,this.observeNode()}),Ee(this,"handleChange",(n,i)=>{n&&this.props.triggerOnce&&this.unobserve(),$o(this.props)||this.setState({inView:n,entry:i}),this.props.onChange&&this.props.onChange(n,i)}),this.state={inView:!!e.initialInView,entry:void 0}}componentDidMount(){this.unobserve(),this.observeNode()}componentDidUpdate(e){(e.rootMargin!==this.props.rootMargin||e.root!==this.props.root||e.threshold!==this.props.threshold||e.skip!==this.props.skip||e.trackVisibility!==this.props.trackVisibility||e.delay!==this.props.delay)&&(this.unobserve(),this.observeNode())}componentWillUnmount(){this.unobserve()}observeNode(){if(!this.node||this.props.skip)return;const{threshold:e,root:n,rootMargin:i,trackVisibility:s,delay:o,fallbackInView:c}=this.props;this._unobserveCb=Co(this.node,this.handleChange,{threshold:e,root:n,rootMargin:i,trackVisibility:s,delay:o},c)}unobserve(){this._unobserveCb&&(this._unobserveCb(),this._unobserveCb=null)}render(){const{children:e}=this.props;if(typeof e=="function"){const{inView:p,entry:g}=this.state;return e({inView:p,entry:g,ref:this.handleNode})}const{as:n,triggerOnce:i,threshold:s,root:o,rootMargin:c,onChange:h,skip:r,trackVisibility:a,delay:l,initialInView:u,fallbackInView:d,...f}=this.props;return Qi(n||"div",{ref:this.handleNode,...f},e)}};async function xi(e,n={}){if(!(e!=null&&e.length))return;const{masto:i}=q(),s=gt.session.get("currentAccount"),o=e.reduce((c,h)=>(!c.includes(h.id)&&!n[h.id]&&h.id!==s&&c.push(h.id),c),[]);if(!o.length)return null;try{return(await i.v1.accounts.relationships.fetch({id:o})).reduce((r,a)=>(r[a.id]=a,r),{})}catch{return null}}function xo(e){var o;let n=[],i=[],s=0;for(let c=0;c<e.length;c++){const h=e[c];h.reblog&&!((o=h.account)!=null&&o.group)?(i.push(h),s++):(n.push(h),s<3&&(s=0))}if(e.length>10&&(i.length>e.length/4||s>=3)){const c=i.map(h=>h.id);if(i.length>e.length*3/4)n=[...n,{id:c,items:i,type:"boosts"}];else{const h=Math.floor(n.length/2);n=[...n.slice(0,h),{id:c,items:i,type:"boosts"},...n.slice(h)]}return n}else return e}function Bn(e,n){const i=gt.account.get("boostedStatusIDs")||{},s=e.filter(c=>{if(!c.reblog)return!0;const h=`${n}-${c.reblog.id}`,r=i[h];return r&&r!==c.id?!1:(i[h]=c.id,!0)}),o=Object.keys(i);return o.length>50&&o.slice(0,o.length-50).forEach(c=>{delete i[c]}),gt.account.set("boostedStatusIDs",i),s}function Ao(e,n){const i=[];let s=0;e.forEach(h=>{for(let a=0;a<i.length;a++){if(i[a].find(l=>l.id===h.id))return;if(i[a].find(l=>l.id===h.inReplyToId)||i[a].find(l=>l.inReplyToId===h.id)){i[a].push(h);return}}const r=e.find(a=>a.id===h.inReplyToId);r&&(i[s++]=[h,r])});for(let h=0;h<i.length;h++)for(let r=h+1;r<i.length;r++)i[h].find(l=>i[r].includes(l))&&(i[h]=[...i[h],...i[r]],i[h]=i[h].filter((l,u,d)=>d.findIndex(f=>f.id===l.id)===u),i.splice(r,1),r--);i.forEach(h=>{h.sort((r,a)=>!r.inReplyToId&&!a.inReplyToId?new Date(r.createdAt)-new Date(a.createdAt):r.inReplyToId===a.id?1:a.inReplyToId===r.id||!r.inReplyToId?-1:a.inReplyToId?new Date(r.createdAt)-new Date(a.createdAt):1)}),i.forEach(h=>{const r=h[0].account.id;h.forEach(a=>{a.account.id!==r&&(a._differentAuthor=!0)})}),i.length;const o=[],c=[];return e.forEach(h=>{if(h.reblog){o.push(h);return}for(let r=0;r<i.length;r++)if(i[r].find(a=>a.id===h.id)){if(c.includes(r))return;const a=i[r];a.sort((u,d)=>{const f=new Date(u.createdAt),p=new Date(d.createdAt);return f-p});const l=a[0].account.id;o.push({id:a.map(u=>u.id),items:a,type:a.every(u=>u.account.id===l)?"thread":"conversation"}),c.push(r);return}if(h.inReplyToId&&h.inReplyToAccountId!==h.account.id){const r=Yt(h.id,n);$.statusReply[r]||queueMicrotask(async()=>{try{const{masto:a}=q({instance:n}),l=await Eo(h.inReplyToId,a);Rt(l,n,{skipThreading:!0,skipUnfurling:!0}),$.statusReply[r]={id:l.id,instance:n}}catch{}})}o.push(h)}),o}const Eo=ie((e,n)=>n.v1.statuses.$select(e).fetch());async function Ro(e,n){const i=await Gs();if(!i.length)return;const{statusFollowedTags:s}=$,o=[];if(e.forEach(c=>{var f;if(c.reblog)return;const{id:h,content:r,tags:a=[]}=c,l=Yt(h,n);if((f=s[l])!=null&&f.length)return;const u=Ks(r);if(!u.length&&!a.length)return;const d=i.reduce((p,g)=>((u.some(m=>m.toLowerCase()===g.name.toLowerCase())||a.some(m=>m.name.toLowerCase()===g.name.toLowerCase()))&&p.push(g.name),p),[]);d.length&&o.push({item:c,sKey:l,followedTags:d})}),o.length){const c=o.map(r=>r.item.account),h=await xi(c);if(!h)return;o.forEach(r=>{const{item:a,sKey:l,followedTags:u}=r,d=h[a.account.id];d&&!d.following&&(s[l]=u)})}}function Mo(){$.statusFollowedTags={}}function Lo({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:s=10,scrollThresholdEnd:o=10,direction:c="vertical",distanceFromStartPx:h,distanceFromEndPx:r}={}){const[a,l]=A(null),[u,d]=A(!1),[f,p]=A(!1),[g,m]=A(!1),[y,b]=A(!1),v=c==="vertical";return Jt(()=>{const S=e.current;if(!S)return{};let w=v?S.scrollTop:S.scrollLeft;function T(){const{scrollTop:I,scrollLeft:C,scrollHeight:B,scrollWidth:R,clientHeight:U,clientWidth:F}=S,_=v?I:C,P=v?B:R,L=v?U:F,W=Math.abs(_-w),H=h||Math.min(L*n,P,_),et=r||Math.min(L*i,P,P-_-L);W>=(w<_?o:s)&&(l(w<_?"end":"start"),w=_),d(_<=0),p(_+L>=P),m(_<=H),b(_+L>=P-et)}return S.addEventListener("scroll",T,{passive:!0}),()=>S.removeEventListener("scroll",T)},[n,i,s,o]),{scrollDirection:a,reachStart:u,reachEnd:f,nearReachStart:g,nearReachEnd:y,init:()=>{e.current&&e.current.dispatchEvent(new Event("scroll"))}}}function _o({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:s=10,scrollThresholdEnd:o=10,direction:c="vertical",distanceFromStartPx:h,distanceFromEndPx:r,init:a}={},l,u){if(!l)return;const d=c==="vertical",f=O(null),p=O(null),g=ts(()=>{let m=!1,y=!1,b=!1,v=!1;const S=e.current,{scrollTop:w,scrollLeft:T,scrollHeight:I,scrollWidth:C,clientHeight:B,clientWidth:R}=S,U=d?w:T,F=d?I:C,_=d?B:R,P=Math.abs(U-f.current),L=h||Math.min(_*n,F,U),W=r||Math.min(_*i,F,F-U-_);P>=(f.current<U?o:s)&&(p.current=f.current<U?"end":"start",f.current=U),m=U<=0,y=U+_>=F,b=U<=L,v=U+_>=F-W,l({scrollDirection:p.current,reachStart:m,reachEnd:y,nearReachStart:b,nearReachEnd:v})},500);Jt(()=>{const m=e.current;return m?(f.current=m[d?"scrollTop":"scrollLeft"],m.addEventListener("scroll",g,{passive:!0}),()=>m.removeEventListener("scroll",g)):{}},[n,i,s,o,...u]),j(()=>{a&&e.current&&queueMicrotask(()=>{e.current.dispatchEvent(new Event("scroll"))})},[a])}function No({class:e,statusID:n,status:i,instance:s,parent:o,onMediaClick:c}){let h=Yt(n,s);const r=$t($);if(i||(i=r.statuses[h]||r.statuses[n],h=Yt(i==null?void 0:i.id,s)),!i)return null;const{account:{acct:a,avatar:l,avatarStatic:u,id:d,url:f,displayName:p,username:g,emojis:m,bot:y,group:b},id:v,repliesCount:S,reblogged:w,reblogsCount:T,favourited:I,favouritesCount:C,bookmarked:B,poll:R,muted:U,sensitive:F,spoilerText:_,visibility:P,language:L,editedAt:W,filtered:H,card:et,createdAt:X,inReplyToId:bt,inReplyToAccountId:Z,content:dt,mentions:nt,mediaAttachments:ht,reblog:ft,uri:xt,url:wt,emojis:It,_deleted:Tt,_pinned:vt}=i;if(!(ht!=null&&ht.length))return null;const K=Q=>{Q.shiftKey},J=mt(()=>gt.session.get("currentAccount"),[]),D=mt(()=>J&&J===d,[d,J]),ot=es(ai),ut=!D&&en(H,ot);if((ut==null?void 0:ut.action)==="hide")return null;const Y=F,E=mt(()=>(gt.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",G=o||"div";return ht.map((Q,x)=>{const z=`${h}-${Q.id}`,V=ut==null?void 0:ut.titlesStr;return t(G,{"data-state-post-id":h,onMouseEnter:K,"data-spoiler-text":_||(F?"Sensitive media":void 0),"data-filtered-text":ut?`Filtered${V?`: ${V}`:""}`:void 0,class:`
          media-post
          ${ut?"filtered":""}
          ${Y?"has-spoiler":""}
          ${E?"show-media":""}
        `,children:t(ri,{class:e,media:Q,lang:L,to:`/${s}/s/${v}?media-only=${x+1}`,onClick:c?N=>c(N,x,Q,i):void 0})},z)})}const zn=Ht(No);function Po(e){var w,T,I,C,B;const n=$t($),{masto:i,instance:s,authenticated:o}=q(),[c,h]=A(),[r,a]=A(!1);j(()=>{const R=gt.local.getJSON("accounts")||[],U=R.find(F=>F.info.id===gt.session.get("currentAccount"));U&&h(U),a(R.length>1)},[]);const l=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(R=>R.type==="following"),u=ns(()=>{$.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),d=O(),[f,p]=A(void 0),g=is([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),m=O();async function y(R){return(R||!m.current)&&(m.current=i.v1.mutes.list({limit:80})),await m.current.next()}const b=O();async function v(R){return(R||!b.current)&&(b.current=i.v1.blocks.list({limit:80})),await b.current.next()}const S=O();return t(M,{children:[t("button",{ref:d,type:"button",class:`button plain nav-menu-button ${r?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{S.current=Date.now(),p(R=>R?void 0:"open")},onContextMenu:R=>{R.preventDefault(),$.showAccounts=!0},...u(),children:[r&&t(fe,{url:((w=c==null?void 0:c.info)==null?void 0:w.avatar)||((T=c==null?void 0:c.info)==null?void 0:T.avatarStatic),size:"l",squircle:(I=c==null?void 0:c.info)==null?void 0:I.bot}),t(k,{icon:"menu",size:r?"s":"l"})]}),t(li,{menuClassName:"nav-menu",state:f,anchorRef:d,onClose:()=>{p(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-S.current<300}},portal:{target:document.body},...e,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:g,unmountOnClose:!0,children:[!!((C=n.appVersion)!=null&&C.commitHash)&&n.appVersion.commitHash!=="d863347"&&t("div",{class:"top-menu",children:[t(lt,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[t(k,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",t("span",{children:"New update available…"})]}),t(Nt,{})]}),t("section",{children:[t(Lt,{to:"/",children:[t(k,{icon:"home",size:"l"})," ",t("span",{children:"Home"})]}),o?t(M,{children:[l&&t(Lt,{to:"/following",children:[t(k,{icon:"following",size:"l"})," ",t("span",{children:"Following"})]}),t(Lt,{to:"/catchup",children:[t(k,{icon:"history2",size:"l"}),t("span",{children:"Catch-up"})]}),t(Lt,{to:"/mentions",children:[t(k,{icon:"at",size:"l"})," ",t("span",{children:"Mentions"})]}),t(Lt,{to:"/notifications",children:[t(k,{icon:"notification",size:"l"})," ",t("span",{children:"Notifications"}),n.notificationsShowNew&&t("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),t(Nt,{}),((B=c==null?void 0:c.info)==null?void 0:B.id)&&t(Lt,{to:`/${s}/a/${c.info.id}`,children:[t(k,{icon:"user",size:"l"})," ",t("span",{children:"Profile"})]}),t(Lt,{to:"/l",children:[t(k,{icon:"list",size:"l"})," ",t("span",{children:"Lists"})]}),t(Lt,{to:"/b",children:[t(k,{icon:"bookmark",size:"l"})," ",t("span",{children:"Bookmarks"})]}),t(oi,{overflow:"auto",gap:-8,label:t(M,{children:[t(k,{icon:"more",size:"l"}),t("span",{class:"menu-grow",children:"More…"}),t(k,{icon:"chevron-right"})]}),children:[t(Lt,{to:"/f",children:[t(k,{icon:"heart",size:"l"})," ",t("span",{children:"Likes"})]}),t(Lt,{to:"/ft",children:[t(k,{icon:"hashtag",size:"l"})," ",t("span",{children:"Followed Hashtags"})]}),t(Nt,{}),t(lt,{onClick:()=>{$.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:y,excludeRelationshipAttrs:["muting"]}},children:[t(k,{icon:"mute",size:"l"})," Muted users…"]}),t(lt,{onClick:()=>{$.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:v,excludeRelationshipAttrs:["blocking"]}},children:[t(k,{icon:"block",size:"l"}),"Blocked users…"]})," "]}),t(Nt,{}),t(lt,{onClick:()=>{$.showAccounts=!0},children:[t(k,{icon:"group",size:"l"})," ",t("span",{children:"Accounts…"})]})]}):t(M,{children:[t(Nt,{}),t(Lt,{to:"/login",children:[t(k,{icon:"user",size:"l"})," ",t("span",{children:"Log in"})]})]})]}),t("section",{children:[t(Nt,{}),t(Lt,{to:"/search",children:[t(k,{icon:"search",size:"l"})," ",t("span",{children:"Search"})]}),t(Lt,{to:`/${s}/trending`,children:[t(k,{icon:"chart",size:"l"})," ",t("span",{children:"Trending"})]}),t(Lt,{to:`/${s}/p/l`,children:[t(k,{icon:"building",size:"l"})," ",t("span",{children:"Local"})]}),t(Lt,{to:`/${s}/p`,children:[t(k,{icon:"earth",size:"l"})," ",t("span",{children:"Federated"})]}),o?t(M,{children:[t(Nt,{className:"divider-grow"}),t(lt,{onClick:()=>{$.showKeyboardShortcutsHelp=!0},children:[t(k,{icon:"keyboard",size:"l"})," ",t("span",{children:"Keyboard shortcuts"})]}),t(lt,{onClick:()=>{$.showShortcutsSettings=!0},children:[t(k,{icon:"shortcut",size:"l"})," ",t("span",{children:"Shortcuts / Columns…"})]}),t(lt,{onClick:()=>{$.showSettings=!0},children:[t(k,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]}):t(M,{children:[t(Nt,{}),t(lt,{onClick:()=>{$.showSettings=!0},children:[t(k,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]})]})]})]})}const xe=Ht(Po),Me={block:"nearest",inline:"center",behavior:"smooth"};function te({title:e,titleComponent:n,id:i,instance:s,emptyText:o,errorText:c,useItemID:h,boostsCarousel:r,fetchItems:a=()=>{},checkForUpdates:l=()=>{},checkForUpdatesInterval:u=15e3,headerStart:d,headerEnd:f,timelineStart:p,refresh:g,view:m,filterContext:y,showFollowedTags:b,showReplyParent:v}){const S=$t($),[w,T]=A([]),[I,C]=A("default"),[B,R]=A(!1),[U,F]=A(!1),[_,P]=A(!0),L=O(),W=m!=="media",H=ss(K=>{F(!1),I!=="loading"&&(C("loading"),(async()=>{try{let{done:J,value:D}=await a(K);if(Array.isArray(D)){const[ot,ut]=D.reduce((Y,at)=>(at._pinned?Y[0].push(at):Y[1].push(at),Y),[[],[]]);D=ut,W&&(r&&(D=xo(D)),D=Ao(D,s)),ot.length&&(D=ot.concat(D)),T(K?D:Y=>[...Y,...D]),D.length||(J=!0),R(!J)}else R(!1);C("default")}catch{C("error")}finally{H.cancel()}})())},1500,{leading:!0,trailing:!1}),et=".timeline-item, .timeline-item-alt",X=St("j, shift+j",(K,J)=>{const D=document.activeElement.closest(et),ot=D==null?void 0:D.getBoundingClientRect(),ut=Array.from(L.current.querySelectorAll(et));if(D&&ot.top<L.current.clientHeight&&ot.bottom>0){const Y=ut.indexOf(D);let at=ut[Y+1];J.shift&&(at=ut.find((E,G)=>G>Y&&!E.classList.contains("timeline-item-alt"))),at&&(at.focus(),at.scrollIntoView(Me))}else{const Y=ut.find(at=>{const E=at.getBoundingClientRect();return E.top>=44&&E.left>=0});Y&&(Y.focus(),Y.scrollIntoView(Me))}}),bt=St("k, shift+k",(K,J)=>{const D=document.activeElement.closest(et),ot=D==null?void 0:D.getBoundingClientRect(),ut=Array.from(L.current.querySelectorAll(et));if(D&&ot.top<L.current.clientHeight&&ot.bottom>0){const Y=ut.indexOf(D);let at=ut[Y-1];J.shift&&(at=ut.findLast((E,G)=>G<Y&&!E.classList.contains("timeline-item-alt"))),at&&(at.focus(),at.scrollIntoView(Me))}else{const Y=ut.find(at=>{const E=at.getBoundingClientRect();return E.top>=44&&E.left>=0});Y&&(Y.focus(),Y.scrollIntoView(Me))}}),Z=St(["enter","o"],()=>{const K=document.activeElement.closest(et);K&&K.click()}),dt=w.length>0&&I!=="loading"&&U,nt=Wt(()=>{var K;H(!0),(K=L.current)==null||K.scrollTo({top:0,behavior:"smooth"})},[H]),ht=St(".",()=>{dt&&nt()}),ft=O(),[xt,wt]=A(!1);_o({scrollableRef:L,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:K,nearReachStart:J,reachStart:D})=>{if(ft.current){const ot=K==="end"&&!J;ft.current.hidden=ot}wt(J),D&&H(!0)},[]),j(()=>{var K;(K=L.current)==null||K.scrollTo({top:0}),H(!0)},[]),j(()=>{H(!0)},[g]);const It=O(m);j(()=>{It.current!==m&&(It.current=m,T([]))},[m]);const Tt=Wt(async({disableIdleCheck:K=!1}={})=>{const J=L.current?getComputedStyle(L.current).pointerEvents==="none":!1;S.settings.autoRefresh&&L.current.scrollTop<16&&(K||window.__IDLE__)&&!Fo()&&!J?H(!0):await l()&&F(!0)},[i,H,l,S.settings.autoRefresh]),vt=O();return me(K=>{if(K){const J=Date.now()-vt.current;(!vt.current||J>1e3*3)&&Tt({disableIdleCheck:!0})}else vt.current=Date.now();P(K)},[l,Tt,S.settings.autoRefresh]),ei(Tt,_&&!U?u*(xt?1:2):null),t(ai.Provider,{value:y,children:t("div",{id:`${i}-page`,class:"deck-container",ref:K=>{L.current=K,X.current=K,bt.current=K,Z.current=K},tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{ref:ft,onClick:K=>{var J;K.target.closest("a, button")||(J=L.current)==null||J.scrollTo({top:0,behavior:"smooth"})},onDblClick:K=>{K.target.closest("a, button")||H(!0)},class:I==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),d??t(tt,{to:"/",class:"button plain home-button",children:t(k,{icon:"home",size:"l"})})]}),e&&(n||t("h1",{children:e})),t("div",{class:"header-side",children:!!f&&f})]}),dt&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:nt,children:[t(k,{icon:"arrow-up"})," New posts"]})]}),!!p&&t("div",{class:`timeline-start ${I==="loading"?"loading":""}`,children:p}),w.length?t(M,{children:[t("ul",{class:`timeline ${m?`timeline-${m}`:""}`,children:[w.map(K=>t(Do,{status:K,instance:s,useItemID:h,filterContext:y,view:m,showFollowedTags:b,showReplyParent:v},K.id+(K==null?void 0:K._pinned)+m)),B&&I==="loading"&&(m==="media"?null:t(M,{children:[t("li",{style:{height:"20vh"},children:t(Et,{skeleton:!0})}),t("li",{style:{height:"25vh"},children:t(Et,{skeleton:!0})})]}))]}),I==="default"&&(B?t(ne,{root:L.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:K=>{K&&H()},children:t("button",{type:"button",class:"plain block",onClick:()=>H(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}))]}):I==="loading"?t("ul",{class:"timeline",children:Array.from({length:5}).map((K,J)=>m==="media"?t("div",{style:{height:"50vh"}}):t("li",{children:t(Et,{skeleton:!0})},J))}):I!=="error"&&t("p",{class:"ui-state",children:o}),I==="error"&&t("p",{class:"ui-state",children:[c,t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>H(!w.length),children:"Try again"})]})]})})})}const Do=Ht(({status:e,instance:n,useItemID:i,filterContext:s,view:o,showFollowedTags:c,showReplyParent:h})=>{const{id:r,reblog:a,items:l,type:u,_pinned:d}=e;d&&(i=!1);const f=(a==null?void 0:a.id)||r,p=n?`/${n}/s/${f}`:`/s/${f}`;if(l){const m=we(l,s);let y="";if(u==="boosts"?y=`${m.length} Boosts`:u==="pinned"&&(y="Pinned posts"),u==="boosts"||u==="pinned")return m.sort((S,w)=>{const T=en(S.filtered,s),I=en(w.filtered,s);return T&&!I?1:!T&&I?-1:0}),t("li",{class:"timeline-item-carousel",children:t(Uo,{title:y,class:`${u}-carousel`,children:m.map(S=>{const{id:w,reblog:T,_pinned:I}=S,C=(T==null?void 0:T.id)||w,B=n?`/${n}/s/${C}`:`/s/${C}`;return I&&(i=!1),t("li",{children:t(tt,{class:"status-carousel-link timeline-item-alt",to:B,children:i?t(Et,{statusID:w,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):t(Et,{status:S,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},w)})})},`timeline-${r}`);const v=m.length>3;return m.map((S,w)=>{const{id:T,_differentAuthor:I}=S,C=n?`/${n}/s/${T}`:`/s/${T}`,B=w>0&&w<m.length-1,R=S.sensitive&&!!S.spoilerText,U=!I&&R&&w>0||v&&B&&(u==="thread"||u==="conversation"&&!I&&!m[w-1]._differentAuthor&&!m[w+1]._differentAuthor),F=w===0,_=w===m.length-1;return t("li",{class:`timeline-item-container timeline-item-container-type-${u} timeline-item-container-${F?"start":_?"end":"middle"} ${I?"timeline-item-diff-author":""}`,children:t(tt,{class:"status-link timeline-item",to:C,children:U?t(Oo,{status:S,instance:n}):i?t(Et,{statusID:T,instance:n,enableCommentHint:_,showFollowedTags:c}):t(Et,{status:S,instance:n,enableCommentHint:_,showFollowedTags:c})})},`timeline-${T}`)})}const g=`timeline-${r+d}`;return o==="media"?i?t(zn,{class:"timeline-item",parent:"li",statusID:r,instance:n},g):t(zn,{class:"timeline-item",parent:"li",status:e,instance:n},g):t("li",{children:t(tt,{class:"status-link timeline-item",to:p,children:i?t(Et,{statusID:r,instance:n,enableCommentHint:!0,showFollowedTags:c,showReplyParent:h}):t(Et,{status:e,instance:n,enableCommentHint:!0,showFollowedTags:c,showReplyParent:h})})},g)},(e,n)=>{var o,c;const i=(((o=e.status)==null?void 0:o.id)||"").toString(),s=(((c=n.status)==null?void 0:c.id)||"").toString();return i===s&&e.instance===n.instance&&e.view===n.view});function Uo({title:e,class:n,children:i}){const s=O(),o=O(),c=O(),[h,r]=A(!1);return j(()=>{setTimeout(()=>{r(!0)},1)},[]),t("div",{class:`status-carousel ${n}`,children:[t("header",{children:[t("h3",{children:e}),t("span",{children:[t("button",{ref:o,type:"button",class:"small plain2",onClick:()=>{var a,l;(l=s.current)==null||l.scrollBy({left:-Math.min(320,(a=s.current)==null?void 0:a.offsetWidth),behavior:"smooth"})},children:t(k,{icon:"chevron-left"})})," ",t("button",{ref:c,type:"button",class:"small plain2",onClick:()=>{var a,l;(l=s.current)==null||l.scrollBy({left:Math.min(320,(a=s.current)==null?void 0:a.offsetWidth),behavior:"smooth"})},children:t(k,{icon:"chevron-right"})})]})]}),t("ul",{ref:s,children:[t(ne,{class:"status-carousel-beacon",onChange:a=>{o.current&&(o.current.disabled=a)}}),i[0],h&&i.slice(1),t(ne,{class:"status-carousel-beacon",onChange:a=>{c.current&&(c.current.disabled=a)}})]})]})}function Oo({status:e,instance:n}){const i=$t($),{id:s,visibility:o,language:c}=e,h=di(e),r=Yt(s,n);return t("article",{class:`status compact-thread ${o==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[i.statusThreadNumber[r]?t("div",{class:"status-thread-badge",children:[t(k,{icon:"thread",size:"s"}),i.statusThreadNumber[r]?` ${i.statusThreadNumber[r]}/X`:""]}):t("div",{class:"status-thread-badge",children:t(k,{icon:"thread",size:"s"})}),t("div",{class:"content-compact",title:h,lang:c,dir:"auto",children:[h,e.sensitive&&e.spoilerText&&t(M,{children:[" ",t("span",{class:"spoiler-badge",children:t(k,{icon:"eye-close",size:"s"})})]})]})]})}function Fo(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const ue=20,wn=1983,Hn=`${wn}-01`,Bo=(()=>{try{const e=document.createElement("input");return e.setAttribute("type","month"),e.type==="month"}catch{return!1}})();async function zo(e){var s;const{masto:n}=q({instance:e}),i=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((s=i==null?void 0:i.statuses)!=null&&s.length)}const Ho=ie(zo);function qo(){const e=$t($),{id:n,...i}=ae(),[s,o]=Gt(),c=s.get("month"),h=!s.get("replies"),r=!!s.get("boosts"),a=s.get("tagged"),l=!!s.get("media"),{masto:u,instance:d,authenticated:f}=q({instance:i.instance}),{masto:p,instance:g}=q(),m=O(),y=[c,h,r,a,l],[b,v]=A(),S=O(0);j(()=>{S.current=0},y);const w=mt(()=>d===g,[d,g]),[T,I]=A(!1);j(()=>{w&&b!=null&&b.acct&&(async()=>{const Z=await Ho(d);I(Z)})()},[d,w,b==null?void 0:b.acct]);async function C(Z){var wt,It,Tt;const dt=/^\d{4}-[01]\d$/.test(c),nt=((It=(wt=c==null?void 0:c.split)==null?void 0:wt.call(c,"-"))==null?void 0:It[0])>=wn;if(dt&&nt){if(!b)return{value:[],done:!0};const[vt,K]=c.split("-"),J=parseInt(K,10)-1,D=new Date(vt,J,0),ot=`${D.getFullYear()}-${(D.getMonth()+1).toString().padStart(2,"0")}-${D.getDate().toString().padStart(2,"0")}`,ut=new Date(vt,J+1,1),Y=`${ut.getFullYear()}-${(ut.getMonth()+1).toString().padStart(2,"0")}-${ut.getDate().toString().padStart(2,"0")}`;let at;Z?(at=ue+1,S.current=0):(at=ue+S.current+1,S.current+=ue);const E=await u.v2.search.fetch({q:`from:${b.acct} after:${ot} before:${Y}`,type:"statuses",limit:at,offset:S.current});if((Tt=E==null?void 0:E.statuses)!=null&&Tt.length){const G=E.statuses.slice(0,ue);G.forEach(x=>{Rt(x,d)});const Q=E.statuses.length<=ue;return{value:G,done:Q}}else return{value:[],done:!0}}const ht=[];if(Z){const{value:vt}=await u.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(vt!=null&&vt.length&&!a&&!l){const K=vt.map(J=>(Rt(J,d),{...J,_pinned:!0}));if(K.length>=3){const J=K.map(D=>D.id);ht.push({id:J,items:K,type:"pinned"})}else ht.push(...K)}}(Z||!m.current)&&(m.current=u.v1.accounts.$select(n).statuses.list({limit:ue,exclude_replies:h,exclude_reblogs:r,only_media:l,tagged:a}));const{value:ft,done:xt}=await m.current.next();return ft!=null&&ft.length&&(ht.push(...ft),ft.forEach(vt=>{Rt(vt,d)})),{value:ht,done:xt}}const[B,R]=A([]);_t(b!=null&&b.acct?`${b!=null&&b.displayName?`${b.displayName} (${/@/.test(b.acct)?"":"@"}${b.acct})`:`${/@/.test(b.acct)?"":"@"}${b.acct}`}${h?r?" (- Boosts)":a?` (#${a})`:l?" (Media)":c?` (${new Date(c).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const U=O(),F=Wt(()=>{const Z=U.current||u.v1.accounts.$select(n).fetch();return U.current=Z,Z},[n,u]);j(()=>{(async()=>{try{const Z=await F();v(Z)}catch{}try{const Z=await u.v1.accounts.$select(n).featuredTags.list();R(Z)}catch{}})()},[n]);const{displayName:_,acct:P,emojis:L}=b||{},W=O(),H=mt(()=>{const Z=!h||r||a||l||!!c,dt=e.accounts[`${n}@${d}`];return t(M,{children:[t(uo,{instance:d,account:dt||n,fetchAccount:F,authenticated:f,standalone:!0}),t("div",{class:"filter-bar",ref:W,style:{position:"relative"},children:[Z?t(tt,{to:`/${d}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:t(k,{icon:"x",size:"l"})},"clear-filters"):t(k,{icon:"filter",class:"insignificant",size:"l"}),t(tt,{to:`/${d}/a/${n}${h?"?replies=1":""}`,onClick:()=>{h&&rt("Showing post with replies")},class:h?"":"is-active",children:"+ Replies"}),t(tt,{to:`/${d}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||rt("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),t(tt,{to:`/${d}/a/${n}${l?"":"?media=1"}`,onClick:()=>{l||rt("Showing posts with media")},class:l?"is-active":"",children:"Media"}),B.map(nt=>t(tt,{to:`/${d}/a/${n}${a===nt.name?"":`?tagged=${encodeURIComponent(nt.name)}`}`,onClick:()=>{a!==nt.name&&rt(`Showing posts tagged with #${nt.name}`)},class:a===nt.name?"is-active":"",children:t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),nt.name]})},nt.id)),T&&(Bo?t("label",{class:`filter-field ${c?"is-active":""}`,children:[t(k,{icon:"month",size:"l"}),t("input",{type:"month",disabled:!(b!=null&&b.acct),value:c||"",min:Hn,max:new Date().toISOString().slice(0,7),onInput:nt=>{const{value:ht,validity:ft}=nt.currentTarget;if(!ft.valid)return;o(ht?{month:ht}:{});const[xt,wt]=ht.split("-"),It=parseInt(wt,10)-1,Tt=new Date(xt,It);rt(`Showing posts in ${Tt.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):t(Vo,{class:`filter-field ${c?"is-active":""}`,disabled:!(b!=null&&b.acct),value:c||"",min:Hn,max:new Date().toISOString().slice(0,7),onInput:nt=>{const{value:ht,validity:ft}=nt;ft.valid&&o(ht?{month:ht}:{})}}))]})]})},[n,d,f,B,F,T,...y]);j(()=>{var dt;const Z=(dt=W.current)==null?void 0:dt.querySelector(".is-active");Z&&W.current.scrollTo({behavior:"smooth",left:Z.offsetLeft-(W.current.offsetWidth-Z.offsetWidth)/2})},[B,T,...y]);const et=mt(()=>b!=null&&b.url?new URL(b.url).hostname:null,[b]),bt=!!b&&!(d===et);return t(te,{title:`${b!=null&&b.acct?"@"+b.acct:"Posts"}`,titleComponent:t("h1",{class:"header-double-lines header-account",children:[t("b",{children:t(si,{text:_,emojis:L})}),t("div",{children:t("span",{children:["@",P]})})]}),id:"account-statuses",instance:d,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:C,useItemID:!0,view:l?"media":void 0,boostsCarousel:e.settings.boostsCarousel,timelineStart:H,refresh:[h,r,a,l,c+(b==null?void 0:b.acct)].toString(),headerEnd:t(Qt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(k,{icon:"more",size:"l"})}),children:[t(lt,{disabled:!bt,onClick:()=>{(async()=>{try{const{masto:Z}=q({instance:et}),dt=await Z.v1.accounts.lookup({acct:b.acct}),{id:nt}=dt;location.hash=`/${et}/a/${nt}`}catch{alert("Unable to fetch account info")}})()},children:[t(k,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to account's instance (",t("b",{children:et}),")"]})]}),!w&&t(lt,{onClick:()=>{(async()=>{try{const Z=await p.v1.accounts.lookup({acct:b.acct+"@"+d}),{id:dt}=Z;location.hash=`/${g}/a/${dt}`}catch{alert("Unable to fetch account info")}})()},children:[t(k,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to my instance (",t("b",{children:g}),")"]})]})]})},n)}function Vo(e){const{class:n,disabled:i,value:s,min:o,max:c,onInput:h=()=>{}}=e,[r,a]=(s==null?void 0:s.split("-"))||[],l=O(),u=O(),d=(f,p)=>{const[g,m]=(o==null?void 0:o.split("-"))||[],[y,b]=(c==null?void 0:c.split("-"))||[];return!(p<g||p>y||p===g&&f<m||p===y&&f>b)};return t("div",{class:n,children:[t(k,{icon:"month",size:"l"}),t("select",{ref:l,disabled:i,value:a||"",onInput:f=>{const{value:p}=f.currentTarget,g=u.current.value;if(!d(p,g))return{value:"",validity:{valid:!1}};h({value:p?`${g}-${p}`:"",validity:{valid:!0}})},children:[t("option",{value:"",children:"Month"}),t("option",{disabled:!0,children:"-----"}),Array.from({length:12},(f,p)=>t("option",{value:(p+1).toString().padStart(2,"0"),children:new Date(0,p).toLocaleString("default",{month:"long"})},p))]})," ",t("input",{ref:u,type:"number",disabled:i,value:r||new Date().getFullYear(),min:(o==null?void 0:o.slice(0,4))||wn,max:(c==null?void 0:c.slice(0,4))||new Date().getFullYear(),onInput:f=>{const{value:p,validity:g}=f.currentTarget,m=l.current.value;if(!g.valid||!d(m,p))return{value:"",validity:{valid:!1}};h({value:p?`${p}-${m}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const jo=20;function Ai(){_t("Bookmarks","/b");const{masto:e,instance:n}=q(),i=O();async function s(o){return(o||!i.current)&&(i.current=e.v1.bookmarks.list({limit:jo})),await i.current.next()}return t(te,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:s})}const Wo=20;function Ei(){_t("Likes","/f");const{masto:e,instance:n}=q(),i=O();async function s(o){return(o||!i.current)&&(i.current=e.v1.favourites.list({limit:Wo})),await i.current.next()}return t(te,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:s})}function Yo(){const{masto:e,instance:n}=q();_t("Followed Hashtags","/ft");const[i,s]=A("default"),[o,c]=A([]);return j(()=>{s("loading"),(async()=>{try{const h=await ze();c(h),s("default")}catch{s("error")}})()},[]),t("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),t(tt,{to:"/",class:"button plain",children:t(k,{icon:"home",size:"l"})})]}),t("h1",{children:"Followed Hashtags"}),t("div",{class:"header-side"})]})}),t("main",{children:o.length>0?t(M,{children:[t("ul",{class:"link-list",children:o.map(h=>t("li",{children:t(tt,{to:n?`/${n}/t/${h.name}`:`/t/${h.name}`,children:[t(k,{icon:"hashtag"})," ",t("span",{children:h.name})]})}))}),o.length>1&&t("footer",{class:"ui-state",children:t("small",{class:"insignificant",children:[o.length," hashtag",o.length===1?"":"s"]})})]}):i==="loading"?t("p",{class:"ui-state",children:t(kt,{abrupt:!0})}):i==="error"?t("p",{class:"ui-state",children:"Unable to load followed hashtags."}):t("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const Go=20;function yn({title:e,path:n,id:i,...s}){_t(e||"Following",n||"/following");const{masto:o,streaming:c,instance:h}=q(),r=$t($),a=O(),l=O();async function u(f){(f||!a.current)&&(a.current=o.v1.timelines.home.list({limit:Go}));const p=await a.current.next();let{value:g}=p;if(g!=null&&g.length){let m=!1;f&&(g[0].id!==l.current&&(m=!0),l.current=g[0].id),g.forEach(y=>{Rt(y,h)}),g=Bn(g,h),f&&m&&Mo(),Ro(g,h),g.sort((y,b)=>{const v=new Date(y.createdAt);return new Date(b.createdAt)-v})}return{...p,value:g}}async function d(){try{const f=await o.v1.timelines.home.list({limit:5,since_id:l.current}).next();let{value:p}=f;return!!(p!=null&&p.length&&(l.current=p[0].id,p=Bn(p,h),p=we(p,"home"),p.some(g=>!g.reblog)))}catch{return!1}}return j(()=>{let f;return(async()=>{if(c){f=c.user.subscribe();for await(const p of f){if(!f)break;if(p.event==="status.update"){const g=p.payload;Rt(g,h)}else if(p.event==="delete"){const g=p.payload,m=ui(g,h);m&&(m._deleted=!0)}}}})(),()=>{var p;(p=f==null?void 0:f.unsubscribe)==null||p.call(f),f=null}},[c]),t(te,{title:e||"Following",id:i||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:h,fetchItems:u,checkForUpdates:d,useItemID:!0,boostsCarousel:r.settings.boostsCarousel,...s,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const Ko=20,Zo=4,qn=Zo+1;function Ri({media:e,columnMode:n,...i}){let{hashtag:s,...o}=n?{}:ae();i.hashtag&&(s=i.hashtag);let c=s.trim().split(/[\s+]+/);c.sort(),s=c[0];const[h,r]=Gt(),a=e||!!h.get("media"),l=a?"?media=1":"",{masto:u,instance:d,authenticated:f}=q({instance:(i==null?void 0:i.instance)||o.instance}),{masto:p,instance:g,authenticated:m}=q(),y=c.map(_=>`#${_}`).join(" "),b=a?" (Media only)":"",v=d?`${y}${b} on ${d}`:`${y}${b}`;_t(v,"/:instance?/t/:hashtag");const S=O(),w=O(void 0);async function T(_){const P=await u.v1.timelines.tag.$select(s).list({limit:Ko,any:c.slice(1),maxId:_?void 0:w.current,onlyMedia:a}).next();let{value:L}=P;return L!=null&&L.length&&(_&&(S.current=L[0].id),L.forEach(W=>{Rt(W,d,{skipThreading:a})}),w.current=L[L.length-1].id),{...P,value:L}}async function I(){try{const _=await u.v1.timelines.tag.$select(s).list({limit:1,any:c.slice(1),since_id:S.current,onlyMedia:a}).next();let{value:P}=_;return P=we(P,"public"),!!(P!=null&&P.length)}catch{return!1}}const[C,B]=A("default"),[R,U]=A();j(()=>{(async()=>{try{const _=await u.v1.tags.$select(s).fetch();U(_)}catch{}})()},[s]);const F=c.length>=qn;return t(te,{title:v,titleComponent:!!d&&t("h1",{class:"header-double-lines",children:[t("b",{children:y}),t("div",{children:d})]}),id:"hashtag",instance:d,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:T,checkForUpdates:I,useItemID:!0,view:a?"media":void 0,refresh:a,filterContext:"public",headerEnd:t(Qt,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(k,{icon:"more",size:"l"})}),children:[!!R&&c.length===1&&t(M,{children:[t(oe,{subMenu:!0,confirm:R.following,confirmLabel:`Unfollow #${s}?`,disabled:C==="loading"||!f,onClick:()=>{B("loading"),R.following?u.v1.tags.$select(s).unfollow().then(()=>{U({...R,following:!1}),rt(`Unfollowed #${s}`)}).catch(_=>{alert(_)}).finally(()=>{B("default")}):u.v1.tags.$select(s).follow().then(()=>{U({...R,following:!0}),rt(`Followed #${s}`)}).catch(_=>{alert(_)}).finally(()=>{B("default")})},children:R.following?t(M,{children:[t(k,{icon:"check-circle"})," ",t("span",{children:"Following…"})]}):t(M,{children:[t(k,{icon:"plus"})," ",t("span",{children:"Follow"})]})}),t(Nt,{})]}),t(hi,{className:"plain",children:"Filters"}),t(lt,{type:"checkbox",checked:!!a,onClick:()=>{a?h.delete("media"):h.set("media","1"),r(h)},children:[t(k,{icon:"check-circle"})," ",t("span",{class:"menu-grow",children:"Media only"})]}),t(Nt,{}),t(os,{className:"menu-field",disabled:F,children:({ref:_})=>t("form",{onSubmit:P=>{var W,H;P.preventDefault();const L=(H=(W=P.target[0].value)==null?void 0:W.trim)==null?void 0:H.call(W);L&&!c.some(et=>et.toLowerCase()===L.toLowerCase())&&(c.push(L),c.sort(),location.hash=d?`/${d}/t/${c.join("+")}`:`/t/${c.join("+")}${l}`)},children:[t(k,{icon:"hashtag"}),t("input",{ref:_,type:"text",placeholder:F?`Max ${qn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:F})]})}),t(cs,{takeOverflow:!0,children:c.map((_,P)=>t(lt,{disabled:c.length===1,onClick:L=>{c.splice(P,1),c.sort(),location.hash=d?`/${d}/t/${c.join("+")}${l}`:`/t/${c.join("+")}${l}`},children:[t(k,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),_]})]},_))}),t(Nt,{}),t(lt,{disabled:!m,onClick:()=>{if($.shortcuts.length>=Zt){alert(`Max ${Zt} shortcuts reached. Unable to add shortcut.`);return}const _={type:"hashtag",hashtag:c.join(" "),instance:d,media:a?"on":void 0};$.shortcuts.some(L=>L.type===_.type&&L.hashtag.split(/[\s+]+/).sort().join(" ")===_.hashtag.split(/[\s+]+/).sort().join(" ")&&(L.instance?L.instance===_.instance:!0)&&(L.media?!!L.media==!!_.media:!0))?alert("This shortcut already exists"):($.shortcuts.push(_),rt("Hashtag shortcut added"))},children:[t(k,{icon:"shortcut"})," ",t("span",{children:"Add to Shorcuts"})]}),t(lt,{onClick:()=>{let _=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(_)){_&&alert("Invalid instance");return}_&&(_=_.toLowerCase().trim(),location.hash=`/${_}/t/${c.join("+")}${l}`)},children:[t(k,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),g!==d&&t(lt,{onClick:()=>{location.hash=`/${g}/t/${c.join("+")}${l}`},children:[t(k,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:g}),")"]})]})]})},d+y)}const Xo=20;function Mi(e){var m;const n=$t($),{masto:i,instance:s}=q(),o=(e==null?void 0:e.id)||((m=ae())==null?void 0:m.id),c=O(),h=O();async function r(y){(y||!h.current)&&(h.current=i.v1.timelines.list.$select(o).list({limit:Xo}));const b=await h.current.next();let{value:v}=b;return v!=null&&v.length&&(y&&(c.current=v[0].id),v.forEach(S=>{Rt(S,s)})),{...b,value:v}}async function a(){try{const y=await i.v1.timelines.list.$select(o).list({limit:1,since_id:c.current});let{value:b}=y;return b=we(b,"home"),!!(b!=null&&b.length)}catch{return!1}}const[l,u]=A({title:"List"});_t(l.title,"/l/:id"),j(()=>{(async()=>{try{const y=await i.v1.lists.$select(o).fetch();u(y)}catch{}})()},[o]);const[d,f]=A(!1),[p,g]=A(!1);return t(M,{children:[t(te,{title:l.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:s,fetchItems:r,checkForUpdates:a,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:t(tt,{to:"/l",class:"button plain",children:t(k,{icon:"list",size:"l"})}),headerEnd:t(Qt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(k,{icon:"more",size:"l"})}),children:[t(lt,{onClick:()=>f({list:l}),children:[t(k,{icon:"pencil",size:"l"}),t("span",{children:"Edit"})]}),t(lt,{onClick:()=>g(!0),children:[t(k,{icon:"group",size:"l"}),t("span",{children:"Manage members"})]})]})},o),d&&t(Dt,{onClick:y=>{y.target===y.currentTarget&&f(!1)},children:t(vn,{list:d==null?void 0:d.list,onClose:y=>{y.state==="success"&&y.list?u(y.list):y.state==="deleted"&&(location.hash="/l"),f(!1)}})}),p&&t(Dt,{onClick:y=>{y.target===y.currentTarget&&g(!1)},children:t(Qo,{listID:o,onClose:()=>g(!1)})})]})}const Jo=40;function Qo({listID:e,onClose:n}){const{masto:i,instance:s}=q(),[o,c]=A([]),[h,r]=A("default"),[a,l]=A(!1),u=O();async function d(f){l(!1),r("loading"),(async()=>{try{(f||!u.current)&&(u.current=i.v1.lists.$select(e).accounts.list({limit:Jo}));const p=await u.current.next();let{done:g,value:m}=p;m!=null&&m.length?(c(f?m:o.concat(m)),l(!g)):l(!1),r("default")}catch{r("error")}})()}return j(()=>{d(!0)},[]),t("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(k,{icon:"x"})}),t("header",{children:t("h2",{children:"Manage members"})}),t("main",{children:t("ul",{children:[o.map(f=>t("li",{children:[t(Xt,{account:f,instance:s}),t(tc,{account:f,listID:e})]},f.id)),a&&h==="default"&&t(ne,{as:"li",onChange:f=>f&&d(),children:t("button",{type:"button",class:"light block",onClick:d,children:"Show more…"})})]})})]})}function tc({account:e,listID:n}){const{masto:i}=q(),[s,o]=A("default"),[c,h]=A(!1);return t(oe,{confirm:!c,confirmLabel:t("span",{children:["Remove @",e.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{c?(o("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.create({accountIds:[e.id]}),o("default"),h(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.remove({accountIds:[e.id]}),o("default"),h(!0)}catch{o("error")}})())},children:t("button",{type:"button",class:`light ${c?"":"danger"}`,disabled:s==="loading",children:c?"Add":"Remove…"})})}const Vn=20,ec=new URLSearchParams;function Li({columnMode:e,...n}){const{masto:i,instance:s}=q(),[o]=e?[ec]:Gt(),[c,h]=A(null),r=(n==null?void 0:n.type)||o.get("type")||c;_t(`Mentions${r==="private"?" (Private)":""}`,"/mentions");const a=O(),l=O();async function u(b){(b||!a.current)&&(a.current=i.v1.notifications.list({limit:Vn,types:["mention"]}));const v=await a.current.next();let{value:S}=v;return S!=null&&S.length&&(b&&(l.current=S[0].id),S.forEach(({status:w})=>{Rt(w,s)})),{...v,value:S==null?void 0:S.map(w=>w.status)}}const d=O(),f=O();async function p(b){(b||!d.current)&&(d.current=i.v1.conversations.list({limit:Vn}));const v=await d.current.next();let{value:S}=v;return S=S==null?void 0:S.filter(w=>w.lastStatus),S!=null&&S.length&&(b&&(f.current=S[0].lastStatus.id),S.forEach(({lastStatus:w})=>{Rt(w,s)})),{...v,value:S==null?void 0:S.map(w=>w.lastStatus)}}function g(...b){return r==="private"?p(...b):u(...b)}async function m(){if(r==="private")try{const b=await i.v1.conversations.list({limit:1,since_id:f.current}).next();let{value:v}=b;return v!=null&&v.length?(f.current=v[0].lastStatus.id,!0):!1}catch{return!1}else try{const b=await i.v1.notifications.list({limit:1,types:["mention"],since_id:l.current}).next();let{value:v}=b;return v!=null&&v.length?(l.current=v[0].id,!0):!1}catch{return!1}}const y=mt(()=>t("div",{class:"filter-bar centered",children:[t(tt,{to:"/mentions",class:r?"":"is-active",onClick:b=>{e&&(b.preventDefault(),h(null))},children:"All"}),t(tt,{to:"/mentions?type=private",class:r==="private"?"is-active":"",onClick:b=>{e&&(b.preventDefault(),h("private"))},children:"Private"})]}),[r]);return t(te,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:s,fetchItems:g,checkForUpdates:m,useItemID:!0,timelineStart:y,refresh:r})}const nc={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function ic(e){return e.filter(n=>{const{type:i,id:s,createdAt:o}=n;if(!i)return!1;const c=nc[i];return c!=null&&c.length?c.every(h=>!!n[h]):!0})}function _i(e){e=ic(e);const n={},i=[];for(let c=0,h=0;c<e.length;c++){const r=e[c],{id:a,status:l,account:u,type:d,createdAt:f}=r,p=f?new Date(f).toLocaleDateString():"";let g=d;(d==="favourite"||d==="reblog")&&(g="favourite+reblog");const m=`${l==null?void 0:l.id}-${g}-${p}`,y=n[m];if(g==="follow_request")i[h++]=r;else if(y!=null&&y.account){const b=y._accounts.find(v=>v.id===u.id);b?(b._types.push(d),b._types.sort().reverse(),y.id+=`-${a}`):(u._types=[d],y._accounts.push(u),y.id+=`-${a}`)}else{u._types=[d];let b=n[m]={...r,type:g,_accounts:[u]};i[h++]=b}}const s={},o=[];for(let c=0,h=0;c<i.length;c++){const r=i[c],{id:a,account:l,_accounts:u,type:d,createdAt:f}=r,p=f?new Date(f).toLocaleDateString():"";if(d==="favourite+reblog"&&l&&u.length===1){const g=`${l==null?void 0:l.id}-${d}-${p}`,m=s[g];if(m)m._statuses.push(r.status),m.id+=`-${a}`;else{let y=s[g]={...r,type:d,_statuses:[r.status]};o[h++]=y}}else o[h++]=r}return o}function jn(e){const{masto:n}=q();return n.v1.push.subscription.create(e)}function sc(){const{masto:e}=q();return e.v1.push.subscription.fetch()}function oc(e){const{masto:n}=q();return n.v1.push.subscription.update(e)}function cc(){const{masto:e}=q();return e.v1.push.subscription.remove()}function Sn(){return"serviceWorker"in navigator&&"PushManager"in window}function ac(){return navigator.serviceWorker.getRegistration()}async function kn(){const e=await ac(),n=e?await e.pushManager.getSubscription():void 0;return{registration:e,subscription:n}}function Ni(e){const n="=".repeat((4-e.length%4)%4),i=`${e}${n}`.replace(/-/g,"+").replace(/_/g,"/"),s=window.atob(i),o=new Uint8Array(s.length);for(let c=0;c<s.length;++c)o[c]=s.charCodeAt(c);return o}async function ya(){if(!Sn())return;const{subscription:e}=await kn();let n=null;try{n=await sc()}catch(i){if(!/(not found|unknown)/i.test(i.message))throw i}if(n&&e){const i=n.endpoint===e.endpoint,{vapidKey:s}=pe(),o=n.serverKey===s;if(!i)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(e&&!n){const{vapidKey:i}=pe(),{applicationServerKey:s}=e.options,o=Ni(i).toString(),c=new Uint8Array(s).toString();if(!(o===c))throw await e.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:e,backendSubscription:n}}async function Sa({data:e,policy:n}){if(!Sn())return;let{registration:i,subscription:s}=await kn(),o=null;if(s)try{o=await oc({data:e,policy:n})}catch{o=await jn({subscription:s,data:e,policy:n})}else{const{vapidKey:c}=pe();if(!c)throw new Error("No server key found");s=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Ni(c)}),o=await jn({subscription:s,data:e,policy:n})}return{subscription:s,backendSubscription:o}}async function ka(){if(!Sn())return;const{subscription:e}=await kn();e&&(await cc(),await e.unsubscribe())}const rc=30,lc=new URLSearchParams,Le={block:"center",inline:"center",behavior:"smooth"};function dc({columnMode:e}){var at;_t("Notifications","/notifications");const{masto:n,instance:i}=q(),s=$t($),[o,c]=A("default"),[h]=e?[lc]:Gt(),r=h.get("id"),a=h.get("access_token"),[l,u]=A(!1),[d,f]=A(!1),p=O(),{nearReachEnd:g,scrollDirection:m,reachStart:y,nearReachStart:b}=Lo({scrollableRef:p}),v=m==="end"&&!b,[S,w]=A([]),[T,I]=A([]),C=O();async function B(E){(E||!C.current)&&(C.current=n.v1.notifications.list({limit:rc,excludeTypes:["follow_request"]}));const G=await C.current.next(),Q=G.value;if(Q!=null&&Q.length){Q.forEach(z=>{Rt(z.status,i,{skipThreading:!0})});const x=_i(Q);E?($.notificationsLast=Q[0],$.notifications=x,n.v1.markers.create({notifications:{lastReadId:Q[0].id}}).catch(()=>{})):$.notifications.push(...x)}return $.notificationsShowNew=!1,$.notificationsLastFetchTime=Date.now(),G}async function R(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const U=()=>{c("loading"),(async()=>{try{const E=await R();w(E),c("default")}catch{c("error")}})()};async function F(){try{return await n.v1.announcements.list()}catch{return[]}}const _=ni("@mastodon/filtered-notifications"),[P,L]=A(!1),[W,H]=A({});function et(){return n.v1.notifications.policy.fetch().catch(()=>{})}function X(){et().then(E=>{H(E)}).catch(()=>{})}const[bt,Z]=A(null);function dt(){return n.v1.notifications.requests.list()}const nt=E=>{ft(!1),c("loading"),(async()=>{try{const G=B(E);E&&(F().then(x=>{x.sort((z,V)=>{const N=new Date(z.updatedAt||z.createdAt);return new Date(V.updatedAt||V.createdAt)-N}),I(x)}).catch(()=>{}),R().then(x=>{w(x)}).catch(()=>{}),_&&X());const{done:Q}=await G;u(!Q),c("default")}catch{c("error")}})()};j(()=>{nt(!0)},[]),j(()=>{y&&nt(!0)},[y]);const[ht,ft]=A(!1),xt=Wt(({disableIdleCheck:E=!1}={})=>{var G;o!=="loading"&&s.settings.autoRefresh&&((G=p.current)==null?void 0:G.scrollTop)<16&&(E||window.__IDLE__)&&!uc()&&nt(!0)},[s.notificationsShowNew,s.settings.autoRefresh,o]),wt=O();me(E=>{let G;if(E){const Q=Date.now()-wt.current;!wt.current||Q>1e3*3?xt({disableIdleCheck:!0}):wt.current=Date.now(),G=as($,"notificationsShowNew",x=>{o!=="loading"&&(x&&xt(),ft(x))})}return()=>{G==null||G()}});const It=new Date,Tt=new Date(It-24*60*60*1e3);let vt=new Date;const K=!s.notifications.some(E=>new Date(E.createdAt).toDateString()===It.toDateString()),J=O();j(()=>{r&&($.routeNotification={id:r,accessToken:atob(a)})},[r,a]);const D=".notification",ot=St("j",()=>{const E=document.activeElement.closest(D),G=E==null?void 0:E.getBoundingClientRect(),Q=Array.from(p.current.querySelectorAll(D));if(E&&G.top<p.current.clientHeight&&G.bottom>0){const x=Q.indexOf(E);let z=Q[x+1];z&&(z.focus(),z.scrollIntoView(Le))}else{const x=Q.find(z=>{const V=z.getBoundingClientRect();return V.top>=44&&V.left>=0});x&&(x.focus(),x.scrollIntoView(Le))}}),ut=St("k",()=>{const E=document.activeElement.closest(D),G=E==null?void 0:E.getBoundingClientRect(),Q=Array.from(p.current.querySelectorAll(D));if(E&&G.top<p.current.clientHeight&&G.bottom>0){const x=Q.indexOf(E);let z=Q[x-1];z&&(z.focus(),z.scrollIntoView(Le))}else{const x=Q.find(z=>{const V=z.getBoundingClientRect();return V.top>=44&&V.left>=0});x&&(x.focus(),x.scrollIntoView(Le))}}),Y=St(["enter","o"],()=>{const E=document.activeElement.closest(D),G=E==null?void 0:E.querySelector(".status-link");G&&G.click()});return t("div",{id:"notifications-page",class:"deck-container",ref:E=>{p.current=E,ot.current=E,ut.current=E,Y.current=E},tabIndex:"-1",children:[t("div",{class:`timeline-deck deck ${d?"only-mentions":""}`,children:[t("header",{hidden:v,onClick:E=>{var G;E.target.closest("a, button")||(G=p.current)==null||G.scrollTo({top:0,behavior:"smooth"})},onDblClick:E=>{E.target.closest("a, button")||nt(!0)},class:o==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),t(tt,{to:"/",class:"button plain",children:t(k,{icon:"home",size:"l",alt:"Home"})})]}),t("h1",{children:"Notifications"}),t("div",{class:"header-side",children:_&&t("button",{type:"button",class:"button plain",onClick:()=>{L(!0)},children:t(k,{icon:"settings",size:"l",alt:"Notifications settings"})})})]}),ht&&o!=="loading"&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var E;nt(!0),(E=p.current)==null||E.scrollTo({top:0,behavior:"smooth"})},children:[t(k,{icon:"arrow-up"})," New notifications"]})]}),T.length>0&&t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("details",{class:"announcements",children:[t("summary",{children:[t("span",{children:[t(k,{icon:"announce",class:"announcement-icon",size:"l"})," ",t("b",{children:["Announcement",T.length>1?"s":""]})," ",t("small",{class:"insignificant",children:i})]}),T.length>1&&t("span",{class:"announcements-nav-buttons",children:T.map((E,G)=>t("button",{type:"button",class:"plain2 small",onClick:()=>{var Q;(Q=J.current)==null||Q.children[G].scrollIntoView({behavior:"smooth",block:"nearest"})},children:G+1}))})]}),t("ul",{class:`announcements-list-${T.length>1?"multiple":"single"}`,ref:J,children:T.map(E=>t("li",{children:t(hc,{announcement:E})}))})]})})}),S.length>0&&t("div",{class:"follow-requests",children:[t("h2",{class:"timeline-header",children:"Follow requests"}),S.length>5?t("details",{children:[t("summary",{children:[S.length," follow requests"]}),t("ul",{children:S.map(E=>t("li",{children:[t(Xt,{account:E}),t(nn,{accountID:E.id,onChange:()=>{}})]},E.id))})]}):t("ul",{children:S.map(E=>t("li",{children:[t(Xt,{account:E}),t(nn,{accountID:E.id,onChange:()=>{}})]},E.id))})]}),_&&((at=W==null?void 0:W.summary)==null?void 0:at.pendingRequestsCount)>0&&t("div",{class:"filtered-notifications",children:t("details",{onToggle:async E=>{const{open:G}=E.target;if(G){const Q=await dt();Z(Q)}},children:[t("summary",{children:["Filtered notifications from"," ",W.summary.pendingRequestsCount," people"]}),bt?(bt==null?void 0:bt.length)>0&&t("ul",{children:bt.map(E=>{var G,Q;return t("li",{children:[t("div",{class:"request-notifcations",children:[!((G=E.lastStatus)!=null&&G.id)&&t(Xt,{useAvatarStatic:!0,showStats:!0,account:E.account}),((Q=E.lastStatus)==null?void 0:Q.id)&&t("div",{class:"last-post",children:t(tt,{class:"status-link",to:`/${i}/s/${E.lastStatus.id}`,children:t(Et,{status:E.lastStatus,size:"s",readOnly:!0})})}),t(pc,{request:E})]}),t(mc,{request:E,onChange:()=>{nt(!0)}})]},E.id)})}):t("p",{class:"ui-state",children:t(kt,{abrupt:!0})})]})}),t("div",{id:"mentions-option",children:t("label",{children:[t("input",{type:"checkbox",checked:d,onChange:E=>{f(E.target.checked)}})," ","Only mentions"]})}),t("h2",{class:"timeline-header",children:"Today"}),K&&!!s.notifications.length&&t("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":t(M,{children:"…"})}),s.notifications.length?t(M,{children:s.notifications.filter(E=>E.type!=="follow_request").map(E=>{if(d&&E.type!=="mention")return null;const G=new Date(E.createdAt),Q=G.toDateString()!==vt.toDateString();Q&&(vt=G);const x=G.toDateString()===Tt.toDateString()?"Yesterday":se(vt,{hideTime:!0});return t(M,{children:[Q&&t("h2",{class:"timeline-header",children:x}),t(Ve,{instance:i,notification:E},E.id)]},E.id)})}):t(M,{children:[o==="loading"&&t(M,{children:t("ul",{class:"timeline flat",children:Array.from({length:5}).map((E,G)=>t("li",{class:"notification skeleton",children:[t("div",{class:"notification-type",children:t(k,{icon:"notification",size:"xl"})}),t("div",{class:"notification-content",children:t("p",{children:"███████████ ████"})})]}))})}),o==="error"&&t("p",{class:"ui-state",children:["Unable to load notifications",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>nt(!0),children:"Try again"})]})]}),l&&t(ne,{onChange:E=>{E&&nt()},children:t("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>nt(),style:{marginBlockEnd:"6em"},children:o==="loading"?t(kt,{abrupt:!0}):t(M,{children:"Show more…"})})})]}),_&&P&&t(Dt,{onClick:E=>{E.target===E.currentTarget&&L(!1)},children:t("div",{class:"sheet",id:"notifications-settings",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:()=>L(!1),children:t(k,{icon:"x"})}),t("header",{children:t("h2",{children:"Notifications settings"})}),t("main",{children:t("form",{onSubmit:E=>{E.preventDefault();const{filterNotFollowing:G,filterNotFollowers:Q,filterNewAccounts:x,filterPrivateMentions:z}=E.target,V={filterNotFollowing:G.checked,filterNotFollowers:Q.checked,filterNewAccounts:x.checked,filterPrivateMentions:z.checked};H({...W,...V}),L(!1),(async()=>{try{await n.v1.notifications.policy.update(V),rt("Notifications settings updated")}catch{}})()},children:[t("p",{children:"Filter out notifications from people:"}),t("p",{children:t("label",{children:[t("input",{type:"checkbox",switch:!0,defaultChecked:W.filterNotFollowing,name:"filterNotFollowing"})," ","You don't follow"]})}),t("p",{children:t("label",{children:[t("input",{type:"checkbox",switch:!0,defaultChecked:W.filterNotFollowers,name:"filterNotFollowers"})," ","Who don't follow you"]})}),t("p",{children:t("label",{children:[t("input",{type:"checkbox",switch:!0,defaultChecked:W.filterNewAccounts,name:"filterNewAccounts"})," ","With a new account"]})}),t("p",{children:t("label",{children:[t("input",{type:"checkbox",switch:!0,defaultChecked:W.filterPrivateMentions,name:"filterPrivateMentions"})," ","Who unsolicitedly private mention you"]})}),t("p",{children:t("button",{type:"submit",children:"Save"})})]})})]})})]})}function uc(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function hc({announcement:e}){const{instance:n}=q(),{contact:i}=rs(),s=i==null?void 0:i.account,{id:o,content:c,startsAt:h,endsAt:r,published:a,allDay:l,publishedAt:u,updatedAt:d,read:f,mentions:p,statuses:g,tags:m,emojis:y,reactions:b}=e,v=new Date(u),S=se(v),w=new Date(d),T=se(w);return t("div",{class:"announcement-block",children:[t(Xt,{account:s}),t("div",{class:"announcement-content",onClick:ii({mentions:p,instance:n}),dangerouslySetInnerHTML:{__html:tn(c,{emojis:y})}}),t("p",{class:"insignificant",children:[t("time",{datetime:v.toISOString(),children:se(v)}),d&&T!==S&&t(M,{children:[" ","•"," ",t("span",{class:"ib",children:["Updated"," ",t("time",{datetime:w.toISOString(),children:se(w)})]})]})]}),t("div",{class:"announcement-reactions",hidden:!0,children:b.map(I=>{const{name:C,count:B,me:R,staticUrl:U,url:F}=I;return t("button",{type:"button",class:`plain4 small ${R?"reacted":""}`,children:[F||U?t("img",{src:F||U,alt:C,width:"16",height:"16"}):t("span",{children:C})," ",t("span",{class:"count",children:zt(B)})]})})})]})}function fc(e){const{masto:n}=q();return n.v1.notifications.list({accountID:e})}function pc({request:e}){var d;const{instance:n}=q(),[i,s]=A("loading"),{account:o,lastStatus:c}=e,[h,r]=A(!1),[a,l]=A([]);function u(){r(!1)}return j(()=>{var f;(f=e==null?void 0:e.account)!=null&&f.id&&h&&(s("loading"),(async()=>{const p=await fc(e.account.id);l(p||[]),s("default")})())},[h,(d=e==null?void 0:e.account)==null?void 0:d.id]),t(M,{children:[t("button",{type:"button",class:"plain4 request-notifications-account",onClick:()=>{r(!0)},children:[t(k,{icon:"notification",class:"more-insignificant"})," ",t("small",{children:["View notifications from @",o.username]})," ",t(k,{icon:"chevron-down"})]}),h&&t(Dt,{onClick:f=>{f.target===f.currentTarget&&u()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:u,children:t(k,{icon:"x"})}),t("header",{children:t("b",{children:["Notifications from @",o.username]})}),t("main",{children:i==="loading"?t("p",{class:"ui-state",children:t(kt,{abrupt:!0})}):a.map(f=>t("div",{class:"notification-peek",onClick:p=>{const{target:g}=p;(p.target.tagName==="BUTTON"||p.target.tagName==="A")&&u()},children:t(Ve,{instance:n,notification:f,isStatic:!0})}))})]})})]})}function mc({request:e,onChange:n}){const{masto:i}=q(),[s,o]=A("default"),[c,h]=A(null),r=c!==null;return t("p",{class:"notification-request-buttons",children:[t("button",{type:"button",disabled:s==="loading"||r,onClick:()=>{o("loading"),(async()=>{try{await i.v1.notifications.requests.$select(e.id).accept(),h("accept"),o("default"),n({request:e,state:"accept"}),rt(`Notifications from @${e.account.username} will not be filtered from now on.`)}catch{o("error"),rt("Unable to accept notification request")}})()},children:"Allow"})," ",t("button",{type:"button",disabled:s==="loading"||r,class:"light danger",onClick:()=>{o("loading"),(async()=>{try{await i.v1.notifications.requests.$select(e.id).dismiss(),h("dismiss"),o("default"),n({request:e,state:"dismiss"}),rt(`Notifications from @${e.account.username} will not show up in Filtered notifications from now on.`)}catch{o("error"),rt("Unable to dismiss notification request")}})()},children:"Dismiss"}),t("span",{class:"notification-request-states",children:s==="loading"?t(kt,{abrupt:!0}):c==="accept"?t(k,{icon:"check-circle",alt:"Accepted",class:"notification-accepted"}):c==="dismiss"&&t(k,{icon:"x-circle",alt:"Dismissed",class:"notification-dismissed"})})]})}const Pi=Ht(dc),gc=20;function rn({local:e,columnMode:n,...i}){const s=$t($),o=!!e,c=n?{}:ae(),{masto:h,instance:r}=q({instance:(i==null?void 0:i.instance)||c.instance}),{masto:a,instance:l}=q(),u=`${o?"Local":"Federated"} timeline (${r})`;_t(u,o?"/:instance?/p/l":"/:instance?/p");const d=O(),f=O();async function p(m){(m||!f.current)&&(f.current=h.v1.timelines.public.list({limit:gc,local:o}));const y=await f.current.next();let{value:b}=y;return b!=null&&b.length&&(m&&(d.current=b[0].id),b.forEach(v=>{Rt(v,r)})),{...y,value:b}}async function g(){try{const m=await h.v1.timelines.public.list({limit:1,local:o,since_id:d.current}).next();let{value:y}=m;return y=we(y,"public"),!!(y!=null&&y.length)}catch{return!1}}return t(te,{title:u,titleComponent:t("h1",{class:"header-double-lines",children:[t("b",{children:o?"Local timeline":"Federated timeline"}),t("div",{children:r})]}),id:"public",instance:r,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:p,checkForUpdates:g,useItemID:!0,headerStart:t(M,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",headerEnd:t(Qt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(k,{icon:"more",size:"l"})}),children:[t(lt,{href:o?`/#/${r}/p`:`/#/${r}/p/l`,children:o?t(M,{children:[t(k,{icon:"transfer"})," ",t("span",{children:"Switch to Federated"})]}):t(M,{children:[t(k,{icon:"transfer"})," ",t("span",{children:"Switch to Local"})]})}),t(Nt,{}),t(lt,{onClick:()=>{let m=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(m)){m&&alert("Invalid instance");return}m&&(m=m.toLowerCase().trim(),location.hash=o?`/${m}/p/l`:`/${m}/p`)},children:[t(k,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),l!==r&&t(lt,{onClick:()=>{location.hash=o?`/${l}/p/l`:`/${l}/p`},children:[t(k,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:l}),")"]})]})]})},r+o)}const _e=5,Ke=40,bc=new URLSearchParams;function Di({columnMode:e,...n}){const i=e?{}:ae(),{masto:s,instance:o,authenticated:c}=q({instance:i.instance}),[h,r]=A("default"),[a]=e?[bc]:Gt(),l=O(),u=(n==null?void 0:n.query)||a.get("q"),d=e?"statuses":(n==null?void 0:n.type)||a.get("type");_t(u?`Search: ${u}${d?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[d]})`:""}`:"Search","/search");const[f,p]=A(!1),g=O(0);j(()=>{g.current=0},[u,d]);const m=O();Jt(()=>{var P,L;(L=(P=m.current)==null?void 0:P.scrollTo)==null||L.call(P,0,0)},[u,d]);const[y,b]=A([]),[v,S]=A([]),[w,T]=A([]);j(()=>{b([]),S([]),T([])},[u]);const I={statuses:b,accounts:S,hashtags:T},[C,B]=A({}),R=async P=>{if(!(P!=null&&P.length))return;const L=await xi(P,C);L&&B({...C,...L})};function U(P){P&&(g.current=0),!(!P&&!c)&&(r("loading"),P&&!d&&(b(y.slice(0,_e)),S(v.slice(0,_e)),T(w.slice(0,_e))),(async()=>{var W,H;const L={q:u,resolve:c,limit:_e};d&&(L.limit=Ke,L.type=d,c&&(L.offset=g.current));try{const et=await s.v2.search.fetch(L);if(d)if(P){I[d](et[d]);const X=(W=et[d])==null?void 0:W.length;g.current=Ke,p(!!X)}else{I[d](bt=>[...bt,...et[d]]);const X=(H=et[d])==null?void 0:H.length;g.current=g.current+Ke,p(!!X)}else b(et.statuses||[]),S(et.accounts||[]),T(et.hashtags||[]),g.current=0,p(!1);R(et.accounts),r("default")}catch{r("error")}})())}const F=O();me(P=>{var W;const L=((W=m.current)==null?void 0:W.scrollTop)===0;if(P&&L){const H=Date.now()-F.current;!F.current||H>1e3*3?U(!0):F.current=Date.now()}}),j(()=>{var P,L,W,H;(L=(P=l.current)==null?void 0:P.setValue)==null||L.call(P,u||""),u?U(!0):(H=(W=l.current)==null?void 0:W.focus)==null||H.call(W)},[u,d,o]),St(["/","Slash"],P=>{var L,W;(W=(L=l.current)==null?void 0:L.focus)==null||W.call(L)},{preventDefault:!0});const[_]=Ti();return t("div",{id:"search-page",class:"deck-container",ref:m,children:t("div",{class:"timeline-deck deck",children:[t("header",{class:h==="loading"?"loading":"",children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:t(xe,{})}),t(vi,{ref:l}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>{U(!0)},disabled:h==="loading",children:t(k,{icon:"search",size:"l"})})})]})}),t("main",{children:[!!u&&!e&&t("div",{ref:_,class:`filter-bar ${h==="loading"?"loading":""}`,children:[!!d&&t(tt,{to:`/search${u?`?q=${encodeURIComponent(u)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(u)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(u)}&type=statuses`}].sort((P,L)=>P.type===d?-1:L.type===d?1:0).map(P=>t(tt,{to:P.to,children:P.label},P.type))]}),u?t(M,{children:[(!d||d==="accounts")&&t(M,{children:[d!=="accounts"&&t("h2",{class:"timeline-header",children:["Accounts"," ",t(tt,{to:`/search?q=${encodeURIComponent(u)}&type=accounts`,children:t(k,{icon:"arrow-right",size:"l"})})]}),v.length>0?t(M,{children:[t("ul",{class:"timeline flat accounts-list",children:v.map(P=>t("li",{children:t(Xt,{account:P,instance:o,showStats:!0,relationship:C[P.id]})},P.id))}),d!=="accounts"&&t("div",{class:"ui-state",children:t(tt,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=accounts`,children:["See more accounts ",t(k,{icon:"arrow-right"})]})})]}):!d&&(h==="loading"?t("p",{class:"ui-state",children:t(kt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No accounts found."}))]}),(!d||d==="hashtags")&&t(M,{children:[d!=="hashtags"&&t("h2",{class:"timeline-header",children:["Hashtags"," ",t(tt,{to:`/search?q=${encodeURIComponent(u)}&type=hashtags`,children:t(k,{icon:"arrow-right",size:"l"})})]}),w.length>0?t(M,{children:[t("ul",{class:"link-list hashtag-list",children:w.map(P=>{var et;const{name:L,history:W}=P,H=(et=W==null?void 0:W.reduce)==null?void 0:et.call(W,(X,bt)=>X+ +bt.uses,0);return t("li",{children:t(tt,{to:o?`/${o}/t/${L}`:`/t/${L}`,children:[t(k,{icon:"hashtag"}),t("span",{children:L}),!!H&&t("span",{class:"count",children:zt(H)})]})},`${L}-${H}`)})}),d!=="hashtags"&&t("div",{class:"ui-state",children:t(tt,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=hashtags`,children:["See more hashtags ",t(k,{icon:"arrow-right"})]})})]}):!d&&(h==="loading"?t("p",{class:"ui-state",children:t(kt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No hashtags found."}))]}),(!d||d==="statuses")&&t(M,{children:[d!=="statuses"&&t("h2",{class:"timeline-header",children:["Posts"," ",t(tt,{to:`/search?q=${encodeURIComponent(u)}&type=statuses`,children:t(k,{icon:"arrow-right",size:"l"})})]}),y.length>0?t(M,{children:[t("ul",{class:"timeline",children:y.map(P=>t("li",{children:t(tt,{class:"status-link",to:o?`/${o}/s/${P.id}`:`/s/${P.id}`,children:t(Et,{status:P})})},P.id))}),d!=="statuses"&&t("div",{class:"ui-state",children:t(tt,{class:"plain button",to:`/search?q=${encodeURIComponent(u)}&type=statuses`,children:["See more posts ",t(k,{icon:"arrow-right"})]})})]}):!d&&(h==="loading"?t("p",{class:"ui-state",children:t(kt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No posts found."}))]}),!!d&&(h==="default"?f?t(ne,{onChange:P=>{P&&U()},children:t("button",{type:"button",class:"plain block",onClick:()=>U(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):h==="loading"&&t("p",{class:"ui-state",children:t(kt,{abrupt:!0})}))]}):h==="loading"?t("p",{class:"ui-state",children:t(kt,{abrupt:!0})}):t("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}function Ze(e,n,i){return Math.max(Math.min(e,i),n)}const Xe=e=>e>=.04045?Math.pow((e+.055)/1.055,2.4):e/12.92,Je=e=>e>=.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e;function Ui([e,n,i]){e=Xe(e/255),n=Xe(n/255),i=Xe(i/255);var s=.4122214708*e+.5363325363*n+.0514459929*i,o=.2119034982*e+.6806995451*n+.1073969566*i,c=.0883024619*e+.2817188376*n+.6299787005*i;return s=Math.cbrt(s),o=Math.cbrt(o),c=Math.cbrt(c),[s*.2104542553+o*.793617785+c*-.0040720468,s*1.9779984951+o*-2.428592205+c*.4505937099,s*.0259040371+o*.7827717662+c*-.808675766]}function Oi([e,n,a]){var s=e+n*.3963377774+a*.2158037573,o=e+n*-.1055613458+a*-.0638541728,c=e+n*-.0894841775+a*-1.291485548;s=s**3,o=o**3,c=c**3;var h=s*4.0767416621+o*-3.3077115913+c*.2309699292,r=s*-1.2684380046+o*2.6097574011+c*-.3413193965,a=s*-.0041960863+o*-.7034186147+c*1.707614701;return h=255*Je(h),r=255*Je(r),a=255*Je(a),h=Ze(h,0,255),r=Ze(r,0,255),a=Ze(a,0,255),h=Math.round(h),r=Math.round(r),a=Math.round(a),[h,r,a]}const vc=20,wc=ie(e=>e.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Fi({columnMode:e,...n}){const i=$t($),s=e?{}:ae(),{masto:o,instance:c}=q({instance:(n==null?void 0:n.instance)||s.instance}),{masto:h,instance:r}=q(),a=`Trending (${c})`;_t(a,"/:instance?/trending");const l=O(),[u,d]=A([]),[f,p]=A([]),g=O();async function m(v){var T;if(v||!g.current){g.current=o.v1.trends.statuses.list({limit:vc});try{const I=o.v1.trends.tags.list(),{value:C}=await I.next();C!=null&&C.length&&d(C)}catch{}try{const{value:I}=await wc(o,c),C=(T=I==null?void 0:I.filter)==null?void 0:T.call(I,B=>B.type==="link");C!=null&&C.length&&p(C)}catch{}}const S=await g.current.next();let{value:w}=S;return w!=null&&w.length&&(v&&(l.current=w[0].id),w.forEach(I=>{Rt(I,c)})),{...S,value:w}}async function y(){try{const v=await o.v1.trends.statuses.list({limit:1}).next();let{value:S}=v;return S=we(S,"public"),S!=null&&S.length&&S[0].id!==l.current?(l.current=S[0].id,!0):!1}catch{return!1}}const b=mt(()=>t(M,{children:[!!u.length&&t("div",{class:"filter-bar expandable",children:[t(k,{icon:"chart",class:"insignificant",size:"l"}),u.map((v,S)=>{const{name:w,history:T}=v,I=T.reduce((C,B)=>C+ +B.uses,0);return t(tt,{to:`/${c}/t/${w}`,children:[t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),w]}),t("span",{class:"filter-count",children:zt(I)})]},w)})]}),!!f.length&&t("div",{class:"links-bar",children:[t("header",{children:t("h3",{children:"Trending News"})}),f.map(v=>{const{authorName:S,authorUrl:w,blurhash:T,description:I,height:C,image:B,imageDescription:R,language:U,providerName:F,providerUrl:_,publishedAt:P,title:L,url:W,width:H}=v,et=new URL(W).hostname.replace(/^www\./,"").replace(/\/$/,"");let X;if(T){const bt=fi(T),Z=Ui(bt);X=Oi([.6,Z[1],Z[2]])}return t("a",{href:W,target:"_blank",rel:"noopener noreferrer",style:X?{"--accent-color":`rgb(${X.join(",")})`,"--accent-alpha-color":`rgba(${X.join(",")}, 0.4)`}:{},children:t("article",{children:[t("figure",{children:t("img",{src:B,alt:R,width:H,height:C,loading:"lazy"})}),t("div",{class:"article-body",children:[t("header",{children:[t("div",{class:"article-meta",children:[t("span",{class:"domain",children:et})," ",!!P&&t(M,{children:"· "}),!!P&&t(M,{children:t(un,{datetime:P,format:"micro"})})]}),!!L&&t("h1",{class:"title",lang:U,dir:"auto",children:L})]}),!!I&&t("p",{class:"description",lang:U,dir:"auto",children:I})]})]})},W)})]})]}),[u,f]);return t(te,{title:a,titleComponent:t("h1",{class:"header-double-lines",children:[t("b",{children:"Trending"}),t("div",{children:c})]}),id:"trending",instance:c,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:m,checkForUpdates:y,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:t(M,{}),boostsCarousel:i.settings.boostsCarousel,filterContext:"public",timelineStart:b,headerEnd:t(Qt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(k,{icon:"more",size:"l"})}),children:[t(lt,{onClick:()=>{let v=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(v)){v&&alert("Invalid instance");return}v&&(v=v.toLowerCase().trim(),location.hash=`/${v}/trending`)},children:[t(k,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]}),r!==c&&t(lt,{onClick:()=>{location.hash=`/${r}/trending`},children:[t(k,{icon:"bus"})," ",t("small",{class:"menu-double-lines",children:["Go to my instance (",t("b",{children:r}),")"]})]})]})},c)}function yc(){_t("Home","/");const e=$t($),{shortcuts:n}=e,i=n.map(s=>{if(!s)return null;const{type:o,...c}=s,h={following:yn,notifications:Pi,list:Mi,public:rn,bookmarks:Ai,favourites:Ei,hashtag:Ri,mentions:Li,trending:Fi,search:Di}[o];return!h||o==="search"&&!c.query?null:t(h,{...c,columnMode:!0},o+JSON.stringify(c))});return St(["1","2","3","4","5","6","7","8","9"],(s,o)=>{try{const c=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[c].focus()}catch{}}),t("div",{id:"columns",onContextMenu:s=>{s.target.closest(".deck > header")&&!s.target.closest("a")&&!s.target.closest("button")&&(s.preventDefault(),$.showShortcutsSettings=!0)},children:i})}function Sc(){var n;const e=$t($);return j(()=>{(async()=>{const i=await ls.drafts.keys();if(i.length){const s=ds();i.filter(c=>c.startsWith(s)).length&&($.showDrafts=!0)}})()},[]),t(M,{children:(e.settings.shortcutsViewMode==="multi-column"||!e.settings.shortcutsViewMode&&e.settings.shortcutsColumnsMode)&&((n=e.shortcuts)!=null&&n.length)?t(yc,{}):t(yn,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:t(kc,{})})})}function kc(){const e=$t($),n=O(),[i,s]=A(void 0);return t(M,{children:[t(tt,{ref:n,to:"/notifications",class:`button plain notifications-button ${e.notificationsShowNew?"has-badge":""} ${i||""}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),s(c=>c?void 0:"open"))},children:t(k,{icon:"notification",size:"l",alt:"Notifications"})}),t(Cc,{state:i,anchorRef:n,onClose:()=>s(void 0)})]})}const Ic=30,Tc=5;function Cc({anchorRef:e,state:n,onClose:i}){const{masto:s,instance:o}=q(),c=$t($),[h,r]=A("default"),a=s.v1.notifications.list({limit:Ic});async function l(){const g=await a.next(),m=g.value;if(m!=null&&m.length){m.forEach(b=>{Rt(b.status,o,{skipThreading:!0})});const y=_i(m);$.notificationsLast=m[0],$.notifications=y,s.v1.markers.create({notifications:{lastReadId:m[0].id}}).catch(()=>{})}return $.notificationsShowNew=!1,$.notificationsLastFetchTime=Date.now(),g}const[u,d]=A(!1);function f(){return s.v1.followRequests.list({limit:1})}function p(){r("loading"),(async()=>{try{await l();const g=await f();d(!!(g!=null&&g.length)),r("default")}catch{r("error")}})()}return j(()=>{n==="open"&&p()},[n]),t(li,{menuClassName:"notifications-menu",state:n,anchorRef:e,onClose:i,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[t("header",{children:t("h2",{children:"Notifications"})}),t("main",{children:c.notifications.length?t(M,{children:c.notifications.slice(0,Tc).map(g=>t(Ve,{instance:o,notification:g,disableContextMenu:!0},g.id))}):h==="loading"?t("div",{class:"ui-state",children:t(kt,{abrupt:!0})}):h==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to fetch notifications."}),t("p",{children:t("button",{type:"button",onClick:p,children:"Try again"})})]})}),t("footer",{children:[t(tt,{to:"/mentions",class:"button plain",children:[t(k,{icon:"at"})," ",t("span",{children:"Mentions"})]}),t(tt,{to:"/notifications",class:"button plain2",children:[u?t(M,{children:[t("span",{class:"tag collapsed",children:"New"})," ",t("span",{children:"Follow Requests"})]}):t("b",{children:"See all"})," ",t(k,{icon:"arrow-right"})]})]})]})}const $c=Ht(Sc),xc=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function Bi(e){const{hostname:n,pathname:i}=new URL(e);for(const s of xc){const[,o]=i.match(s)||[];if(o)return{instance:n,id:o}}return{}}function Ac(e){const{instance:n,id:i}=Bi(e);return n&&i?`/${n}/s/${i}`:null}function Ec(){const n=qe().pathname.replace(/^\//,""),i=Bi(n),s=i!=null&&i.instance?`/${i.instance}/s/${i.id}`:null,[o,c]=A("loading");return Jt(()=>{c("loading"),(async()=>{try{const{instance:h,id:r}=i,{masto:a}=q({instance:h});if(await a.v1.statuses.$select(r).fetch()){window.location.hash=s+"?view=full";return}}catch{}{const{masto:h,instance:r}=q(),a=await h.v2.search.fetch({q:n,limit:1,resolve:!0});if(a.statuses.length){const l=a.statuses[0];window.location.hash=`/${r}/s/${l.id}?view=full`}else if(a.accounts.length){const l=a.accounts[0];window.location.hash=`/${r}/a/${l.id}`}else s?window.location.hash=s+"?view=full":c("error")}})()},[s]),t("div",{class:"ui-state",tabIndex:"-1",children:[o==="loading"?t(M,{children:[t(kt,{abrupt:!0}),t("h2",{children:"Resolving…"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):t(M,{children:[t("h2",{children:"Unable to resolve URL"}),t("p",{children:t("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),t("hr",{}),t("p",{children:t(tt,{to:"/",children:"Go home"})})]})}function Rc(){const{masto:e}=q();_t("Lists","/l");const[n,i]=A("default"),[s,o]=ci(l=>l+1,0),[c,h]=A([]);j(()=>{i("loading"),(async()=>{try{const l=await e.v1.lists.list();l.sort((u,d)=>u.title.localeCompare(d.title)),h(l),i("default")}catch{i("error")}})()},[s]);const[r,a]=A(!1);return t("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(xe,{}),t(tt,{to:"/",class:"button plain",children:t(k,{icon:"home",size:"l"})})]}),t("h1",{children:"Lists"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>a(!0),children:t(k,{icon:"plus",size:"l",alt:"New list"})})})]})}),t("main",{children:c.length>0?t(M,{children:[t("ul",{class:"link-list",children:c.map(l=>t("li",{children:t(tt,{to:`/l/${l.id}`,children:t("span",{children:[t(k,{icon:"list"})," ",t("span",{children:l.title})]})})}))}),c.length>1&&t("footer",{class:"ui-state",children:t("small",{class:"insignificant",children:[c.length," list",c.length===1?"":"s"]})})]}):n==="loading"?t("p",{class:"ui-state",children:t(kt,{})}):n==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists yet."})})]}),r&&t(Dt,{onClick:l=>{l.target===l.currentTarget&&a(!1)},children:t(vn,{list:r==null?void 0:r.list,onClose:l=>{l.state==="success"&&o(),a(!1)}})})]})}const zi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e",Mc=""+new URL("instances-MzK7fGXv.json",import.meta.url).href;var Lc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:_c,PHANPY_WEBSITE:Nc}=Lc,In="read write follow push";async function Pc({instanceURL:e}){const n=new URLSearchParams({client_name:_c,redirect_uris:location.origin+location.pathname,scopes:In,website:Nc});return await(await fetch(`https://${e}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Dc({instanceURL:e,client_id:n}){const i=new URLSearchParams({client_id:n,scope:In,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${e}/oauth/authorize?${i.toString()}`}async function Uc({instanceURL:e,client_id:n,client_secret:i,code:s}){const o=new URLSearchParams({client_id:n,client_secret:i,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:s,scope:In});return await(await fetch(`https://${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}var Oc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Fc}=Oc;function Bc(){_t("Log in");const e=O(),n=gt.local.get("instanceURL"),[i,s]=A("default"),[o]=Gt(),c=o.get("instance"),h=o.get("submit"),[r,a]=A(c||(n==null?void 0:n.toLowerCase())||""),[l,u]=A([]);j(()=>{(async()=>{try{const v=await(await fetch(Mc)).json();u(v)}catch{}})()},[]);const d=b=>{b&&(gt.local.set("instanceURL",b),(async()=>{s("loading");try{const{client_id:v,client_secret:S,vapid_key:w}=await Pc({instanceURL:b});v&&S?(gt.session.set("clientID",v),gt.session.set("clientSecret",S),gt.session.set("vapidKey",w),location.href=await Dc({instanceURL:b,client_id:v})):alert("Failed to register application"),s("default")}catch{s("error")}})())},f=r?r.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,p=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(f)&&!/[\s\/\\@]/.test(f),g=f?l.filter(b=>b.includes(r)).sort((b,v)=>{const S=b.toLowerCase().startsWith(r.toLowerCase()),w=v.toLowerCase().startsWith(r.toLowerCase());return S&&!w?-1:!S&&w?1:0}).slice(0,10):[],m=p?f:g!=null&&g.length?g[0]:r?l.find(b=>b.includes(r)):null,y=b=>{b.preventDefault(),d(m)};return h&&j(()=>{d(c||m)},[]),t("main",{id:"login",style:{textAlign:"center"},children:t("form",{onSubmit:y,children:[t("h1",{children:[t("img",{src:zi,alt:"",width:"80",height:"80"}),t("br",{}),"Log in"]}),t("label",{children:[t("p",{children:"Instance"}),t("input",{value:r,required:!0,type:"text",class:"large",id:"instanceURL",ref:e,disabled:i==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellCheck:!1,placeholder:"instance domain",onInput:b=>{a(b.target.value)}}),(g==null?void 0:g.length)>0?t("ul",{id:"instances-suggestions",children:g.map((b,v)=>t("li",{children:t("button",{type:"button",class:"plain5",onClick:()=>{d(b)},children:b})}))}):t("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),i==="error"&&t("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),t("div",{children:[t("button",{disabled:i==="loading"||!r||!m,children:m?`Continue with ${m}`:"Continue"})," "]}),t(kt,{hidden:i!=="loading"}),t("hr",{}),!Fc&&t("p",{children:t("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),t("p",{children:t(tt,{to:"/",children:"Go home"})})]})})}var zc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:Ia}=zc;function Hc({mediaAttachments:e,statusID:n,instance:i,lang:s,index:o=0,onClose:c=()=>{}}){var v,S;const[h,r]=A("default"),a=O(null),[l,u]=A(o),d=O(null);Jt(()=>{var w;(w=d.current)==null||w.scrollIntoView()},[]);const f=O(n);j(()=>{const w=o*a.current.clientWidth,T=f.current!==n;T&&(f.current=n),a.current.scrollTo({left:w,behavior:T?"auto":"smooth"}),a.current.focus()},[o,n]);const[p,g]=A(!0);j(()=>{let w=()=>{c()};return a.current&&a.current.addEventListener("swiped-down",w),()=>{a.current&&a.current.removeEventListener("swiped-down",w)}},[]),St("esc",c,{ignoreEventWhen:w=>!!document.querySelector("#modal-container > *")},[c]),j(()=>{let w=()=>{const{clientWidth:T,scrollLeft:I}=a.current,C=Math.round(I/T);u(C)};return a.current&&a.current.addEventListener("scroll",w,{passive:!0}),()=>{a.current&&a.current.removeEventListener("scroll",w)}},[]),j(()=>{let w=setTimeout(()=>{var T,I;(I=(T=a.current)==null?void 0:T.focus)==null||I.call(T)},100);return()=>clearTimeout(w)},[]);const m=mt(()=>e==null?void 0:e.map(w=>{const{blurhash:T}=w;if(T){const I=fi(T),C=Ui(I);return Oi([.6,C[1],C[2]])}return null}),[e]),y=mt(()=>{var I;const T=100/m.length;return((I=m==null?void 0:m.map((C,B)=>{const R=B*T+5,U=(B+1)*T-5;return C?`
            rgba(${C==null?void 0:C.join(",")}, 0.4) ${R}%,
            rgba(${C==null?void 0:C.join(",")}, 0.4) ${U}%
          `:`
            transparent ${R}%,
            transparent ${U}%
          `}))==null?void 0:I.join(", "))||"transparent"},[m]);let b=O(null);return j(()=>()=>{var w,T;(T=(w=b.current)==null?void 0:w.hideToast)==null||T.call(w)},[]),t("div",{class:`media-modal-container media-modal-count-${e==null?void 0:e.length}`,children:[t("div",{ref:a,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:w=>{(w.target.classList.contains("carousel-item")||w.target.classList.contains("media")||w.target.classList.contains("media-zoom"))&&c()},style:e.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${y})`}:{},children:e==null?void 0:e.map((w,T)=>{const I=e.length===1?m[T]:null;return t("div",{class:"carousel-item",style:I?{"--accent-color":`rgb(${I==null?void 0:I.join(",")})`,"--accent-alpha-color":`rgba(${I==null?void 0:I.join(",")}, 0.4)`}:{},tabindex:"0",ref:T===l?d:null,onClick:C=>{C.target.classList.contains("media")||g(!p)},children:[!!w.description&&t("button",{type:"button",class:"media-alt",hidden:!p,onClick:()=>{$.showMediaAlt={alt:w.description,lang:s}},children:[t("span",{class:"alt-badge",children:"ALT"}),t("span",{class:"media-alt-desc",lang:s,dir:"auto",children:w.description})]}),t(ri,{media:w,showOriginal:!0,lang:s})]},w.id)})}),t("div",{class:"carousel-top-controls",hidden:!p,children:[t("span",{children:t("button",{type:"button",class:"carousel-button",onClick:()=>c(),children:t(k,{icon:"x"})})}),(e==null?void 0:e.length)>1?t("span",{class:"carousel-dots",children:e==null?void 0:e.map((w,T)=>t("button",{type:"button",disabled:T===l,class:`carousel-dot ${T===l?"active":""}`,onClick:I=>{I.preventDefault(),I.stopPropagation(),a.current.scrollTo({left:a.current.clientWidth*T,behavior:"smooth"}),a.current.focus()},children:t(k,{icon:"round",size:"s"})},w.id))}):t("span",{}),t("span",{children:[t(Qt,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:t("button",{type:"button",class:"carousel-button",children:t(k,{icon:"more",alt:"More"})}),children:[t(Lt,{href:((v=e[l])==null?void 0:v.remoteUrl)||((S=e[l])==null?void 0:S.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[t(k,{icon:"popout"}),t("span",{children:"Open original media"})]}),!1]})," ",t(tt,{to:`${i?`/${i}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${l+1}`:""}`,class:"button carousel-button media-post-link",children:[t("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(e==null?void 0:e.length)>1&&t("div",{class:"carousel-controls",hidden:!p,children:[t("button",{type:"button",class:"carousel-button",hidden:l===0,onClick:w=>{w.preventDefault(),w.stopPropagation(),a.current.focus(),a.current.scrollTo({left:a.current.clientWidth*(l-1),behavior:"smooth"})},children:t(k,{icon:"arrow-left"})}),t("button",{type:"button",class:"carousel-button",hidden:l===e.length-1,onClick:w=>{w.preventDefault(),w.stopPropagation(),a.current.focus(),a.current.scrollTo({left:a.current.clientWidth*(l+1),behavior:"smooth"})},children:t(k,{icon:"arrow-right"})})]})]})}const Ne=40,qc=10,Vc=5;let ln={},De={},Ue={};function Oe(e){delete De[e],delete Ue[e]}const ye={block:"nearest",inline:"center",behavior:"smooth"},Wn=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",Yn=/\/s\//i;function jc(e){const{id:n}=e,{masto:i,instance:s}=q({instance:e.instance}),o=$t($),[c,h]=Gt(),r=c.get("media"),a=c.get("media-only"),l=parseInt(r||a,10);let u=l>0;const d=c.get("mediaStatusID"),f=ui(d,s);d&&!f&&(u=!1);const p=u&&!!a,g=Yt(n,s),[m,y]=A($.statuses[g]);j(()=>{$.statuses[g]&&y($.statuses[g])},[g]);const b=mt(()=>{const{prevLocation:w}=$,T=((w==null?void 0:w.pathname)||"")+((w==null?void 0:w.search)||""),I=Te("/:instance/s/:id",T)||Te("/s/:id",T);return!T||I?"/":T},[]);j(()=>{!m&&u&&(async()=>{try{const w=await i.v1.statuses.$select(n).fetch();Rt(w,s),y(w)}catch{alert("Unable to load post."),location.hash=b}})()},[u]);const v=d?f==null?void 0:f.mediaAttachments:m==null?void 0:m.mediaAttachments,S=Wt(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():p?location.hash=b:(c.delete("media"),c.delete("mediaStatusID"),h(c))},[p,b,o.prevLocation]);return j(()=>{let w=setTimeout(()=>{const T=document.querySelector(".carousel");T&&T.focus()},100);return()=>clearTimeout(w)},[p]),t("div",{class:"deck-backdrop",children:[u?v!=null&&v.length?t(Hc,{mediaAttachments:v,statusID:d||n,instance:s,lang:m==null?void 0:m.language,index:l-1,onClose:S}):t("div",{class:"media-modal-container loading",children:t(kt,{abrupt:!0})}):t(tt,{to:b}),!p&&t(Yc,{id:n,instance:e.instance,closeLink:b})]})}function Wc(e){const{linkable:n,to:i,onClick:s,...o}=e;return n?t(tt,{class:"status-link",to:i,onClick:s,...o}):t("div",{class:"status-focus",tabIndex:0,...o})}function Yc({id:e,closeLink:n="/",instance:i}){var G,Q;const[s,o]=Gt(),c=s.get("media"),h=s.get("mediaStatusID"),r=parseInt(c,10)>0,a=O(!$.prevLocation&&(history.length===1||"navigation"in window&&((Q=(G=navigation==null?void 0:navigation.entries)==null?void 0:G.call(navigation))==null?void 0:Q.length)===1)),[l,u]=A(s.get("view")||a.current?"full":null),d=!!parseInt(s.get("translate")),{masto:f,instance:p}=q({instance:i}),{masto:g,instance:m,authenticated:y}=q(),b=p===m,v=$t($),[S,w]=A([]),[T,I]=A("default"),C=O(),B=Yt(e,p),R=O(0),U=O();j(()=>{var x;(x=U.current)==null||x.focus()},[]),j(()=>{var z;const x=bi(()=>{if(!U.current)return;const{scrollTop:V}=U.current;T!=="loading"&&(Ue[e]=V)},50);return(z=U.current)==null||z.addEventListener("scroll",x,{passive:!0}),x(),()=>{var V;x.cancel(),(V=U.current)==null||V.removeEventListener("scroll",x)}},[e,T!=="loading"]);const F=O(),_=O(),P=({reloadHero:x}={})=>{I("loading");let z;const V=De[e];if(V){const N=V.filter(st=>$.statuses[B]);w(N)}else w([{id:e}]);return(async()=>{var Ut,Ot;const N=()=>$n(()=>f.v1.statuses.$select(e).fetch(),{retries:4}),st=$n(()=>f.v1.statuses.$select(e).context.fetch(),{retries:8}),pt=!!v.statuses[B];let ct=v.statuses[B];if(!(pt&&!x))try{ct=await N(),Rt(ct,p),await new Promise(At=>{setTimeout(At,100)})}catch{I("error");return}try{let At=function(it){return it==null?void 0:it.map(Mt=>({id:Mt.id,account:Mt.account,repliesCount:Mt.repliesCount,content:Mt.content,weight:Ie(Mt),replies:At(Mt.__replies)}))};const Ft=await st,{ancestors:Vt,descendants:Ct}=Ft;R.current=(Ct==null?void 0:Ct.length)||0;const qt=new Set;Vt.forEach(it=>{Rt(it,p,{skipThreading:!0}),it.inReplyToId&&!Vt.find(Mt=>Mt.id===it.inReplyToId)&&qt.add(it.inReplyToId)});const le=Vt.every(it=>it.account.id===ct.account.id),Bt=[];Ct.forEach(it=>{if(Rt(it,p,{skipThreading:!0}),it.inReplyToId&&!Ct.find(Mt=>Mt.id===it.inReplyToId)&&it.inReplyToId!==ct.id&&qt.add(it.inReplyToId),it.inReplyToAccountId===it.account.id)Bt.push(it);else if(it.inReplyToId===ct.id)Bt.push(it);else if(!it.inReplyToAccountId&&Bt.find(Mt=>Mt.id===it.inReplyToId)&&it.account.id===ct.account.id)Bt.push(it);else{const Mt=Ct.find(qi=>qi.id===it.inReplyToId);Mt&&(Mt.__replies||(Mt.__replies=[]),Mt.__replies.push(it))}}),qt.size;const We=[...Vt.map(it=>({id:it.id,ancestor:!0,isThread:le,accountID:it.account.id,account:it.account,repliesCount:it.repliesCount,weight:Ie(it)})),{id:e,accountID:ct.account.id,weight:Ie(ct)},...Bt.map(it=>({id:it.id,account:it.account,accountID:it.account.id,descendant:!0,thread:it.account.id===ct.account.id,weight:Ie(it),replies:At(it.__replies)}))];I("default"),F.current={offsetTop:(Ut=C.current)==null?void 0:Ut.offsetTop,scrollTop:(Ot=U.current)==null?void 0:Ot.scrollTop};const Tn=We.findIndex(it=>it.id===e);Tn>=dt&&nt(Tn+1),w(We),De[e]=We,us(ct,p)}catch{I("error")}})(),_.current=Date.now(),()=>{clearTimeout(z)}};j(P,[e,f]);const[L,W]=A(!1);j(()=>{let x=setInterval(()=>{const z=Date.now();_.current&&z-_.current>=6e4&&W(!0)},6e4);return()=>{clearInterval(x)}},[]),Jt(()=>{var z,V;if(!S.length)return;const x=Ue[e];if(x)U.current.scrollTop=x;else if(F.current){const N={offsetTop:(z=C.current)==null?void 0:z.offsetTop,scrollTop:(V=U.current)==null?void 0:V.scrollTop},st=N.offsetTop-F.current.offsetTop+N.scrollTop;U.current.scrollTop=st}else S.length===1&&(U.current.scrollTop=0);F.current=null},[S]),j(()=>{v.reloadStatusPage<=0||(async()=>{try{const{instanceURL:x}=pe(),z=`https://${x}/api/v1/statuses/${e}/context`;return await(await caches.open("api")).delete(z,{ignoreVary:!0}),P({reloadHero:!0})}catch{}})()},[v.reloadStatusPage]),j(()=>()=>{Ue={},$.reloadStatusPage=0,De={},ln={},dn.clear()},[]);const H=v.statuses[B]||v.statuses[e],et=mt(()=>{if(!H)return"";const{account:x}=H,z=document.createElement("div");return z.innerHTML=x.displayName,z.innerText.trim()},[H]),X=mt(()=>{if(!H)return"";let x=di(H);return x.length>64&&(x=x.slice(0,64)+"…"),x},[H]);_t(et&&X?`${et}: "${X}"`:"Status","/:instance?/s/:id");const bt=mt(()=>{if(!H)return;const{url:x}=H;if(x)return new URL(x).hostname},[H]),Z=mt(()=>{if(bt)return bt===p},[bt,p]),[dt,nt]=A(Ne),ht=mt(()=>S.length-dt,[S.length,dt]),ft=S.some(x=>x.descendant),xt=S.filter(x=>x.ancestor),[wt,It]=A(!0),Tt=mt(()=>{if(!C.current||wt)return null;const{top:x}=C.current.getBoundingClientRect();return x>0?"down":"up"},[wt]);St("esc",()=>{location.hash=n},{enabled:!r,ignoreEventWhen:x=>!!document.querySelector("#modal-container > *")}),St("backspace",()=>{location.hash=n}),St("j",()=>{const x=document.activeElement.closest(".status-link, .status-focus"),z=x==null?void 0:x.getBoundingClientRect(),V=Array.from(U.current.querySelectorAll(Wn));if(x&&z.top<U.current.clientHeight&&z.bottom>0){const N=V.indexOf(x);let st=V[N+1];st&&(st.focus(),st.scrollIntoView(ye))}else{const N=V.find(st=>{const pt=st.getBoundingClientRect();return pt.top>=44&&pt.left>=0});N&&(N.focus(),N.scrollIntoView(ye))}}),St("k",()=>{const x=document.activeElement.closest(".status-link, .status-focus"),z=x==null?void 0:x.getBoundingClientRect(),V=Array.from(U.current.querySelectorAll(Wn));if(x&&z.top<U.current.clientHeight&&z.bottom>0){const N=V.indexOf(x);let st=V[N-1];st&&(st.focus(),st.scrollIntoView(ye))}else{const N=V.find(st=>{const pt=st.getBoundingClientRect();return pt.top>=44&&pt.left>=0});N&&(N.focus(),N.scrollIntoView(ye))}}),St("x",()=>{const x=document.activeElement.closest(".status-link, .status-focus");if(x){const z=x.nextElementSibling;z&&z.tagName.toLowerCase()==="details"&&(z.open=!z.open)}});const[vt,K]=A(!1),J=O(r?"media+status":"status"),D=Wt((x,z,V,N)=>{x.preventDefault(),x.stopPropagation(),o({media:z+1,mediaStatusID:N.id})},[e]),ot=Wt((x,z)=>{Oe(z.id)},[]);j(()=>{let x;return h&&r&&(x=setTimeout(()=>{var V;const z=(V=U.current)==null?void 0:V.querySelector(`.status-link[href*="/${h}"]`);z&&z.scrollIntoView(ye)},400)),()=>{clearTimeout(x)}},[h,r]);const ut=Wt((x,z)=>{const{id:V,ancestor:N,isThread:st,descendant:pt,thread:ct,replies:Ut,repliesCount:Ot,weight:At}=x,Ft=V===e;return t("li",{ref:Ft?C:null,class:`${N?"ancestor":""} ${pt?"descendant":""} ${ct?"thread":""} ${Ft?"hero":""}`,children:[Ft?t(M,{children:[t(ne,{threshold:.1,onChange:Ct=>{queueMicrotask(()=>{requestAnimationFrame(()=>{It(Ct)})})},class:"status-focus",tabIndex:0,children:t(Et,{statusID:V,instance:p,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:d})}),T!=="loading"&&!y?t("div",{class:"post-status-banner",children:[t("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),t(tt,{to:"/login",class:"button",children:"Log in"})]}):!b&&t("div",{class:"post-status-banner",children:[t("p",{children:["This post is from another instance (",t("b",{children:p}),"). Interactions (reply, boost, etc) are not possible."]}),t("button",{type:"button",disabled:T==="loading",onClick:()=>{I("loading"),(async()=>{try{const Ct=await g.v2.search.fetch({q:H.url,type:"statuses",resolve:!0,limit:1});if(Ct.statuses.length){const qt=Ct.statuses[0];location.hash=m?`/${m}/s/${qt.id}`:`/s/${qt.id}`}else throw new Error("No results")}catch(Ct){I("default"),alert("Error: "+Ct)}})()},children:[t(k,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):t(Wc,{linkable:st||N,to:p?`/${p}/s/${V}`:`/s/${V}`,onClick:()=>{Oe(V)},children:[z===0&&N?t(ne,{threshold:.5,onChange:Ct=>{queueMicrotask(()=>{requestAnimationFrame(()=>{K(Ct)})})},children:t(Et,{statusID:V,instance:p,withinContext:!0,size:ct||N?"m":"s",enableTranslate:!0,onMediaClick:D,onStatusLinkClick:ot})}):t(Et,{statusID:V,instance:p,withinContext:!0,size:ct||N?"m":"s",enableTranslate:!0,onMediaClick:D,onStatusLinkClick:ot,showActionsBar:!!pt}),N&&Ot>1&&t("div",{class:"replies-link",children:[t(k,{icon:"comment2"})," ",t("span",{title:Ot,children:zt(Ot)})]})," "]}),pt&&(Ut==null?void 0:Ut.length)>0&&t(Hi,{instance:p,replies:Ut,hasParentThread:ct,level:1,accWeight:At,openAll:R.current<qc,parentLink:{to:p?`/${p}/s/${V}`:`/s/${V}`,onClick:()=>Oe(V)}}),T==="loading"&&Ft&&!!(H!=null&&H.repliesCount)&&!ft&&t("div",{class:"status-loading",children:t(kt,{abrupt:H.repliesCount>=3})}),T==="error"&&Ft&&!!(H!=null&&H.repliesCount)&&!ft&&t("div",{class:"status-error",children:["Unable to load replies.",t("br",{}),t("button",{type:"button",class:"plain",onClick:()=>{$.reloadStatusPage++},children:"Try again"})]})]},V)},[e,p,T,y,b,d,D,ot,ft]),Y=mt(()=>{var x;if("navigation"in window&&(navigation!=null&&navigation.entries)){const z=navigation.entries()[navigation.currentEntry.index-1];if(z!=null&&z.url)return Yn.test(z.url)}return Yn.test((x=$.prevLocation)==null?void 0:x.pathname)},[B]),at=mt(()=>{if(!ht)return[];const x=[];function z(V){x.push(V.id),V.replies&&V.replies.forEach(z)}return S.slice(dt).forEach(z),x.map(V=>Yt(V,p))},[ht,S,dt,p]),E=mt(()=>S.slice(0,dt).map(ut),[S,dt,ut]);return t("div",{tabIndex:"-1",ref:U,class:`status-deck deck contained ${S.length>1?"padded-bottom":""} ${J.current==="status"&&!a.current?"slide-in":""} ${l?`deck-view-${l}`:""}`,onAnimationEnd:x=>{J.current==="status"&&(J.current=null)},children:[t("header",{class:`${T==="loading"?"loading":""}`,onDblClick:x=>{$.reloadStatusPage++},children:t("div",{class:"header-grid header-grid-2",children:[t("h1",{children:[Y&&t("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:t(k,{icon:"chevron-left",size:"xl"})}),!wt&&H&&T!=="loading"?t(M,{children:[t("span",{class:"hero-heading",children:[t(Qe,{account:H.account,instance:p,showAvatar:!0,short:!0})," ",t("span",{class:"insignificant",children:["•"," ",t(un,{datetime:H.createdAt,format:"micro"})]})]})," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:x=>{x.preventDefault(),x.stopPropagation(),C.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:t(k,{icon:Tt==="down"?"arrow-down":"arrow-up"})})]}):t(M,{children:["Post"," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:x=>{x.preventDefault(),x.stopPropagation(),U.current.scrollTo({top:0,behavior:"smooth"})},hidden:!xt.length||vt,title:`${xt.length} posts above ‒ Go to top`,children:[t(k,{icon:"arrow-up"}),xt.filter((x,z,V)=>V.findIndex(N=>N.accountID===x.accountID)===z).slice(0,3).map(x=>t(fe,{url:x.account.avatar,alt:x.account.displayName},x.account.id)),xt.length>3&&t(M,{children:[" ",t("span",{class:"insignificant",children:zt(xt.length)})]})]})]})]}),t("div",{class:"header-side",children:[t("button",{type:"button",class:"plain4 button-switch-view",style:{display:l==="full"?"":"none"},onClick:()=>{u(null),s.delete("media"),s.delete("media-only"),s.delete("view"),o(s)},title:"Switch to Side Peek view",children:t(k,{icon:"layout4",size:"l"})}),L&&t("button",{type:"button",class:"plain button-refresh",onClick:()=>{$.reloadStatusPage++,W(!1)},children:t(k,{icon:"refresh",size:"l"})}),t(Qt,{align:"end",portal:{target:U.current},menuButton:t("button",{type:"button",class:"button plain4",children:t(k,{icon:"more",alt:"Actions",size:"xl"})}),children:[t(lt,{disabled:T==="loading",onClick:()=>{$.reloadStatusPage++},children:[t(k,{icon:"refresh"}),t("span",{children:"Refresh"})]}),t(lt,{className:"menu-switch-view",onClick:()=>{u(l==="full"?null:"full"),s.delete("media"),s.delete("media-only"),l==="full"?s.delete("view"):s.set("view","full"),o(s)},children:[t(k,{icon:{"":"layout5",full:"layout4"}[l||""]}),t("span",{children:["Switch to ",l==="full"?"Side Peek":"Full"," view"]})]}),t(lt,{onClick:()=>{Array.from(U.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(z=>{z.click()})},children:[t(k,{icon:"eye-open"})," ",t("span",{children:"Show all sensitive content"})]}),t(Nt,{}),t(hi,{className:"plain",children:"Experimental"}),t(lt,{disabled:!bt||Z,onClick:()=>{const x=Ac(H.url);x?location.hash=x:alert("Unable to switch")},children:[t(k,{icon:"transfer"}),t("small",{class:"menu-double-lines",children:["Switch to post's instance",bt?t(M,{children:[" ","(",t("b",{children:bt}),")"]}):""]})]})]}),t(tt,{class:"button plain deck-close",to:n,children:t(k,{icon:"x",size:"xl"})})]})]})}),S.length&&H?t("ul",{class:`timeline flat contextual grow ${T==="loading"?"loading":""}`,children:[E,ht>0&&t("li",{children:t("button",{type:"button",class:"plain block show-more",disabled:T==="loading",onClick:()=>nt(x=>x+Ne),style:{marginBlockEnd:"6em"},"data-state-post-ids":at.join(" "),children:[t("div",{class:"ib avatars-bunch",children:S.slice(dt,dt+5).map(x=>t(fe,{url:x.account.avatarStatic},x.id))})," ",t("div",{class:"ib",children:["Show more…"," ",t("span",{class:"tag",children:ht>Ne?`${Ne}+`:ht})]})]})})]}):t(M,{children:[T==="loading"&&t("ul",{class:"timeline flat contextual grow loading",children:t("li",{children:t(Et,{skeleton:!0,size:"l"})})}),T==="error"&&t("p",{class:"ui-state",children:["Unable to load post",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>{$.reloadStatusPage++},children:"Try again"})]})]})]})}function Hi({replies:e,instance:n,hasParentThread:i,level:s,accWeight:o,openAll:c,parentLink:h}){const[r,a]=Gt(),l=v=>v.reduce((S,w)=>{const{repliesCount:T,replies:I}=w,C=(I==null?void 0:I.length)||T;return S+C+l(I||[])},0),u=e.length+l(e),d=e.length===u,f=e.map(v=>v.account).filter((v,S,w)=>w.findIndex(T=>T.id===v.id)===S).slice(0,3),p=mt(()=>e==null?void 0:e.reduce((v,S)=>v+(S==null?void 0:S.weight),o),[o,e==null?void 0:e.length]);let g=!1;(c||p<=Vc||!i&&u===1&&Ie(e[0])<2)&&(g=!0);const m=ln[e[0].id],y=Wt((v,S,w,T)=>{v.preventDefault(),v.stopPropagation(),a({media:S+1,mediaStatusID:T.id})},[]),b=O();return Jt(()=>{var S;function v(w){w.target.dataset.scrollLeft=w.target.scrollLeft}return(S=b.current)==null||S.addEventListener("scroll",v,{passive:!0}),()=>{var w;(w=b.current)==null||w.removeEventListener("scroll",v)}},[]),t("details",{ref:b,class:"replies",open:m||g,onToggle:v=>{const{open:S}=v.target;ln[e[0].id]=S},style:{"--comments-level":s},"data-comments-level":s,"data-comments-level-overflow":s>4,children:[t("summary",{class:"replies-summary",hidden:g,children:[t("span",{class:"avatars",children:f.map(v=>t(fe,{url:v.avatarStatic,title:`${v.displayName} @${v.username}`,squircle:v==null?void 0:v.bot},v.id))}),t("span",{class:"replies-counts",children:[t("b",{children:[t("span",{title:e.length,children:zt(e.length)})," ","repl",e.length===1?"y":"ies"]}),!d&&u>1&&t(M,{children:[" ","·"," ",t("span",{children:[t("span",{title:u,children:zt(u)})," ","comment",u===1?"":"s"]})]})]}),t(k,{icon:"chevron-down",class:"replies-summary-chevron"}),!!h&&t(tt,{class:"replies-parent-link",to:h.to,onClick:h.onClick,title:"View post with its replies",children:"»"})]}),t("ul",{children:e.map(v=>{var S,w;return t("li",{children:[t("div",{class:"status-focus",tabIndex:0,children:[t(Et,{statusID:v.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:y,showActionsBar:!0}),!((S=v.replies)!=null&&S.length)&&v.repliesCount>0&&t("div",{class:"replies-link",children:[t(k,{icon:"comment2"})," ",t("span",{title:v.repliesCount,children:zt(v.repliesCount)})]})]}),((w=v.replies)==null?void 0:w.length)&&t(Hi,{instance:n,replies:v.replies,level:s+1,accWeight:g?p:v.weight,openAll:c,parentLink:{to:n?`/${n}/s/${v.id}`:`/s/${v.id}`,onClick:()=>{Oe(v.id)}}})]},v.id)})})]})}const Gc=140,Kc=35,Zc=70,Xc=140,dn=new Map;function Ie(e){var p,g;const n=dn.get(e.id);if(n)return n;const{spoilerText:i,content:s,mediaAttachments:o,poll:c,card:h}=e,r=hs(i+s),a=o!=null&&o.length?Gc:0,l=(((p=c==null?void 0:c.options)==null?void 0:p.length)||0)*Kc,u=h&&(o!=null&&o.length||(g=c==null?void 0:c.options)!=null&&g.length)?0:Zc,f=(r+a+l+u)/Xc;return dn.set(e.id,f),f}const Jc=Ht(jc);function Qc(){const e=ae(),{id:n,instance:i}=e;return t(Jc,{id:n,instance:i})}const ta=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,ea=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,na=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,ia=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,sa=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,oa="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var ca={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Se,PHANPY_WEBSITE:Gn,PHANPY_PRIVACY_POLICY_URL:aa,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:Kn}=ca,Zn=Gn?Gn.replace(/https?:\/\//g,"").replace(/\/$/,""):null,Xn=`${"2024-03-21T23:58:46.627Z".slice(0,10).replace(/-/g,".")}.d863347`;function Jn(){return _t(null,["/","/welcome"]),t("main",{id:"welcome",children:[t("div",{class:"hero-container",children:[t("div",{class:"hero-content",children:[t("h1",{children:[t("img",{src:zi,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),t("img",{src:oa,alt:"Phanpy",width:"200"})]}),t("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),t("p",{children:t(tt,{to:Se?`/login?instance=${Se}&submit=1`:"/login",class:"button",children:Se?"Log in":"Log in with Mastodon"})}),Se&&Kn&&t("p",{children:t("a",{href:Kn,class:"button plain5",children:"Sign up"})}),!Se&&t("p",{class:"insignificant",children:t("small",{children:["Connect your existing Mastodon/Fediverse account.",t("br",{}),"Your credentials are not stored on this server."]})})]}),(Zn||Xn)&&t("p",{class:"app-site-version",children:t("small",{children:[Zn," ",Xn]})}),t("p",{children:[t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:e=>{e.preventDefault(),$.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",t("a",{href:aa,target:"_blank",children:"Privacy Policy"}),"."]})]}),t("div",{id:"why-container",children:t("div",{class:"sections",children:[t("section",{children:[t("img",{src:ta,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),t("h4",{children:"Boosts Carousel"}),t("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),t("section",{children:[t("img",{src:sa,alt:"Screenshot of nested comments thread",loading:"lazy"}),t("h4",{children:"Nested comments thread"}),t("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),t("section",{children:[t("img",{src:ea,alt:"Screenshot of grouped notifications",loading:"lazy"}),t("h4",{children:"Grouped notifications"}),t("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),t("section",{children:[t("img",{src:na,alt:"Screenshot of multi-column UI",loading:"lazy"}),t("h4",{children:"Single or multi-column"}),t("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),t("section",{children:[t("img",{src:ia,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),t("h4",{children:"Multi-hashtag timeline"}),t("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Qn=()=>{let e=setTimeout(()=>{if(!document.getElementById("columns")){const i=document.querySelectorAll("#modal-container > *");if(i!=null&&i.length){const h=i[i.length-1],r=h.querySelector('[tabindex="-1"]')||h;if(r){r.focus();return}}if(document.querySelector(".deck-backdrop"))return;const o=document.querySelectorAll(".deck-container"),c=o[o.length-1];c&&c.tabIndex===-1&&c.focus()}},100);return()=>clearTimeout(e)},ra=window.alert;window.__nativeAlert||(window.__nativeAlert=ra);window.alert=function(e){e instanceof Error&&(e!=null&&e.message)&&(e=e.message),typeof e!="string"&&(e=JSON.stringify(e));const n=fs({text:e,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};const la=mi(()=>pi(()=>import("./catchup-CmKwglby.js"),__vite__mapDeps([0,1,2,3,4,5]),import.meta.url)),da=mi(()=>pi(()=>import("./modals-sjK9tbPd.js"),__vite__mapDeps([6,1,2,3,7,4,8,9]),import.meta.url));window.__STATES__=$;window.__STATES_STATS__=()=>{const e=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};e.forEach(o=>{n[o]=Object.keys($[o]).length});const{statuses:i}=$,s=[];for(const o in i)document.querySelector(`[data-state-post-id~="${o}"], [data-state-post-ids~="${o}"]`)||s.push(o)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:e,unfurledLinks:n,notifications:i}=$;let s=0;const{instance:o}=q();for(const c in e){if(!window.__IDLE__)break;try{const h=document.querySelector(`[data-state-post-id~="${c}"], [data-state-post-ids~="${c}"]`),r=i.some(a=>{var l;return c===Yt((l=a.status)==null?void 0:l.id,o)});if(!h&&!r){delete $.statuses[c],delete $.statusQuotes[c];for(const a in n){const l=n[a];if(Yt(l.id,l.instance)===c){delete $.unfurledLinks[a];break}}s++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const e in Ae)queueMicrotask(()=>{var n,i,s,o;Array.isArray(Ae[e])?(i=(n=Ae[e])[0])==null||i.call(n):(o=(s=Ae)[e])==null||o.call(s)})},5e3);(()=>{window.__IDLE__=!0;const e=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},s=bi(n,3e3),o=()=>{window.__IDLE__=!1,s()};e.forEach(c=>{window.addEventListener(c,o,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",c=>{!c.relatedTarget&&!c.toElement&&n()},{passive:!0})})();const ua=/iPad|iPhone|iPod/.test(navigator.userAgent);ua&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const e=gt.local.get("theme");let n;if(e){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const i=n.content,s=e==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=s||"",setTimeout(()=>{n.content=i},10)}}else{const i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${i}"]`),n){const s=n.dataset.content,o=n.dataset.contentTemp;n.content=o||"",setTimeout(()=>{n.content=s},10)}}}});{const e=gt.local.get("theme");if(e){document.documentElement.classList.add(`is-${e}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",e||"dark light");const i=document.querySelector('meta[data-theme-setting="manual"]');i&&(i.name="theme-color",i.content=e==="light"?i.dataset.themeLightColor:i.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(o=>{o.name=""})}const n=gt.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}ps($,e=>{var n;for(const[i,s,o,c]of e){if(s.join(".")==="settings.shortcutsViewMode"){const h=document.getElementById("app");h&&(h.dataset.shortcutsViewMode=(n=$.shortcuts)!=null&&n.length?o:"")}s.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",o)}});function ha(){const[e,n]=A(!1),[i,s]=A("loading");j(()=>{const c=gt.local.get("instanceURL"),h=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(h){window.history.replaceState({},document.title,window.location.pathname||"/");const r=gt.session.get("clientID"),a=gt.session.get("clientSecret"),l=gt.session.get("vapidKey");(async()=>{s("loading");const{access_token:u}=await Uc({instanceURL:c,client_id:r,client_secret:a,code:h}),d=ms({instance:c,accessToken:u});await Promise.allSettled([xn(d,c),gs(d,c,u,l)]),An(),En(d),n(!0),s("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const r=pe();if(r){gt.session.set("currentAccount",r.info.id);const{client:a}=q({account:r}),{instance:l}=a;An(),En(a),s("loading"),(async()=>{try{await xn(a,l)}catch{}finally{n(!0),s("default")}})()}else s("default")}},[]);let o=qe();return $.currentLocation=o.pathname,j(Qn,[o,e]),/\/https?:/.test(o.pathname)?t(Ec,{}):t(M,{children:[t(fa,{isLoggedIn:e,loading:i==="loading"}),t(pa,{isLoggedIn:e}),i==="default"&&t(hn,{children:t(yt,{path:"/:instance?/s/:id",element:t(Qc,{})})}),e&&t(Is,{}),e&&t(so,{}),t(gi,{children:t(da,{})}),e&&t($s,{}),t(ks,{isLoggedIn:e}),i!=="loading"&&t(xs,{onClose:Qn}),t(Ts,{})]})}function fa({isLoggedIn:e,loading:n}){const i=qe(),s=mt(()=>{const{pathname:o}=i;return!/^\/(login|welcome)/i.test(o)},[i]);return t(hn,{location:s||i,children:[t(yt,{path:"/",element:e?t($c,{}):n?t(kt,{id:"loader-root"}):t(Jn,{})}),t(yt,{path:"/login",element:t(Bc,{})}),t(yt,{path:"/welcome",element:t(Jn,{})})]})}function ti(){return $.prevLocation||null}function pa({isLoggedIn:e}){const n=qe(),i=O(ti());return mt(()=>Te("/:instance/s/:id",n.pathname)||Te("/s/:id",n.pathname),[n.pathname,Te])?i.current||(i.current=ti()):i.current=null,t(hn,{location:i.current||n,children:[e&&t(M,{children:[t(yt,{path:"/notifications",element:t(Pi,{})}),t(yt,{path:"/mentions",element:t(Li,{})}),t(yt,{path:"/following",element:t(yn,{})}),t(yt,{path:"/b",element:t(Ai,{})}),t(yt,{path:"/f",element:t(Ei,{})}),t(yt,{path:"/l",children:[t(yt,{index:!0,element:t(Rc,{})}),t(yt,{path:":id",element:t(Mi,{})})]}),t(yt,{path:"/ft",element:t(Yo,{})}),t(yt,{path:"/catchup",element:t(gi,{children:t(la,{})})})]}),t(yt,{path:"/:instance?/t/:hashtag",element:t(Ri,{})}),t(yt,{path:"/:instance?/a/:id",element:t(qo,{})}),t(yt,{path:"/:instance?/p",children:[t(yt,{index:!0,element:t(rn,{})}),t(yt,{path:"l",element:t(rn,{local:!0})})]}),t(yt,{path:"/:instance?/trending",element:t(Fi,{})}),t(yt,{path:"/:instance?/search",element:t(Di,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(e=>{const n=new AbortController;return setTimeout(()=>n.abort(),e),n.signal}));vs(t(bs,{children:t(ha,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("iconify")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("iconify")&&sessionStorage.removeItem(e)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};export{uo as A,ne as I,Hc as M,xe as N,wa as S,Ro as a,zs as b,ya as c,Sa as d,ka as e,xi as f,Qn as g,Sn as i,zi as l,Oi as o,Ui as r,Ti as u};
//# sourceMappingURL=main-TOTHqHaZ.js.map
