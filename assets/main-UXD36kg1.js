const __vite__fileDeps=["./compose-5uxFFcOl.js","./vendor-nmEC-eWS.js","./status-qMJ4qIaO.js","./useTitle-tWRuLwqM.js"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
import{s as C,a as K,b as ze,c as we,g as it,d as rs,e as St,p as ut,u as js,L as Te,f as Yt,h as ls,_ as Ws,I as Ks,i as We,j as Js,k as un,l as He,m as ds,t as Xs,n as Zs,o as xn,q as Qs,r as An,v as $n}from"./useTitle-tWRuLwqM.js";import{F as H,_ as W,p as A,u as Me,x as Je,a as e,b as De,m as _,y as ft,c as hn,M as pe,d as Fe,e as Tt,q as be,f as xt,g as Ze,I as ct,A as rt,h as pn,l as _n,i as ei,s as us,j as hs,k as nt,T as ti,n as ni,o as si,P as ii,J as oi,C as ps,r as ai,t as mt,v as ci,w as ri,z as fs,B as li,D as di,E as ui,G as hi,H as Lt,K as ms,L as Rn,N as pi,R as fn,O as Ue,Q as fi,S as mi}from"./vendor-nmEC-eWS.js";import{u as mn,s as ie,o as gi,I as w,M as Re,A as tt,N as It,a as Ke,b as Qe,L as oe,g as gs,l as bi,t as En,R as gt,c as st,d as Xe,e as Le,h as bs,f as sn,E as ys,i as Ge,n as ot,S as jt,j as Ln,T as ws,k as et,m as Oe,p as Mn,q as yi,r as wi,v as vs,C as vi,w as ki,F as ks,x as Mt,y as Si,z as At,B as gn,D as Ss,G as Ii,H as Nt}from"./status-qMJ4qIaO.js";function Ct(t=()=>{},n=[]){const i=H(t);W(()=>{i.current=t},[n]),W(()=>{const s=()=>{const o=document.hidden||document.visibilityState==="hidden";i.current(!o)};return document.addEventListener("visibilitychange",s),()=>document.removeEventListener("visibilitychange",s)},[])}const Ci=1e3*3,Ti=15e3,xi=Je(function({isLoggedIn:n}){const[i,s]=A(!0);Ct(s);const o=async(u,r,p)=>{var f;if(C.notificationsLast){const c=u.v1.notifications.list({limit:1,sinceId:C.notificationsLast.id}),{value:d}=await c.next();if(d!=null&&d.length)if(p)C.notificationsShowNew=!0;else{let h;try{const g=await u.v1.markers.fetch({timeline:"notifications"});h=(f=g==null?void 0:g.notifications)==null?void 0:f.lastReadId}catch{}h?C.notificationsShowNew=d[0].id!==h:C.notificationsShowNew=!0}}};W(()=>{let u,r;if(n&&i){const{masto:p,streaming:f,instance:c}=K();(async()=>{await o(p,c);let d=!1;f&&(r=setTimeout(()=>{(async()=>{try{d=!0,u=f.user.notification.subscribe();for await(const h of u){if(!u||!i)break;h.event==="notification"&&ze(h.payload,c,{skipThreading:!0}),C.notificationsShowNew=!0}}catch{d=!1}d||(r=setInterval(()=>{o(p,c,!0)},Ti))})()},Ci))})()}return()=>{var p;(p=u==null?void 0:u.unsubscribe)==null||p.call(u),u=null,clearTimeout(r),clearInterval(r)}},[i,n]);const a=H(),l=()=>{a.current=Date.now(),fetch("./version.json").then(u=>u.json()).then(u=>{u&&(C.appVersion=u)}).catch(u=>{})};return mn(l,i&&1e3*60*30),Ct(u=>{u&&(a.current?Date.now()-a.current>1e3*60*60&&l():l())}),Me("shift+alt+k",()=>{const u=C.settings.cloakMode;C.settings.cloakMode=!u,ie({text:`Cloak mode ${u?"disabled":"enabled"}`})}),null}),Ai=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);function $i(){if(Ai){const t=document.createElement("input");t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.opacity="0",document.body.appendChild(t),t.focus(),setTimeout(()=>{document.body.removeChild(t)},500)}}function _i(){function t(n){n.shiftKey?gi()||(C.showCompose=!0):($i(),C.showCompose=!0)}return Me("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const Ri=Je(function(){const n=De(C);function i(){C.showKeyboardShortcutsHelp=!1}return Me("?, shift+?, shift+slash",s=>{C.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:s=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&e(Re,{onClose:i,children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(_,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(_,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Load new posts",keys:e("kbd",{children:"."})},{action:"Open post details",keys:e(_,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:e(_,{children:["Expand content warning or",e("br",{}),"toggle expanded/collapsed thread"]}),keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(_,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(_,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:e(_,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"c"})]})},{action:"Send post",keys:e(_,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:e(_,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:e(_,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(_,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:e(_,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"Alt"})," + ",e("kbd",{children:"k"})]})}].map(({action:s,className:o,keys:a})=>e("tr",{children:[e("th",{class:o,children:s}),e("td",{children:a})]},s))})})]})})});function Ei({onClose:t}){const{masto:n}=K(),i=we.local.getJSON("accounts"),s=it(),o=i.length>1,[a,l]=ft(r=>r+1,0),[u]=hn();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:u,children:i.map((r,p)=>{const f=r.info.id===s,c=p===0;return e("li",{children:[e("div",{children:[o&&e("span",{class:`current ${f?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(tt,{url:r.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const d=await n.v1.accounts.$select(r.info.id).fetch();r.info=d,we.local.setJSON("accounts",i),l()}catch{}}}),e(It,{account:o?{...r.info,acct:/@/.test(r.info.acct)?r.info.acct:`${r.info.acct}@${r.instanceURL}`}:r.info,showAcct:!0,onClick:()=>{f?C.showAccount=`${r.info.username}@${r.instanceURL}`:(rs(r.info.id),location.reload())}})]}),e("div",{class:"actions",children:[c&&o&&e(_,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Ke,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(pe,{onClick:()=>{C.showAccount=`${r.info.username}@${r.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(Fe,{}),o&&e(pe,{disabled:c,onClick:()=>{i.splice(p,1),i.unshift(r),we.local.setJSON("accounts",i),l()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Qe,{subMenu:!0,confirmLabel:e(_,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",r.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{i.splice(p,1),we.local.setJSON("accounts",i),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},r.info.id)})}),e("p",{children:e(oe,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),o&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const bn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e";function Pn(t){const{masto:n}=K();return n.v1.push.subscription.create(t)}function Li(){const{masto:t}=K();return t.v1.push.subscription.fetch()}function Mi(t){const{masto:n}=K();return n.v1.push.subscription.update(t)}function Pi(){const{masto:t}=K();return t.v1.push.subscription.remove()}function Jt(){return"serviceWorker"in navigator&&"PushManager"in window}function Ni(){return navigator.serviceWorker.getRegistration()}async function yn(){const t=await Ni(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Is(t){const n="=".repeat((4-t.length%4)%4),i=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),s=window.atob(i),o=new Uint8Array(s.length);for(let a=0;a<s.length;++a)o[a]=s.charCodeAt(a);return o}async function Di(){if(!Jt())return;const{subscription:t}=await yn();let n=null;try{n=await Li()}catch(i){if(!/(not found|unknown)/i.test(i.message))throw i}if(n&&t){const i=n.endpoint===t.endpoint,{vapidKey:s}=St(),o=n.serverKey===s;if(!i)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:i}=St(),{applicationServerKey:s}=t.options,o=Is(i).toString(),a=new Uint8Array(s).toString();if(!(o===a))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function Nn({data:t,policy:n}){if(!Jt())return;let{registration:i,subscription:s}=await yn(),o=null;if(s)try{o=await Mi({data:t,policy:n})}catch{o=await Pn({subscription:s,data:t,policy:n})}else{const{vapidKey:a}=St();if(!a)throw new Error("No server key found");s=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Is(a)}),o=await Pn({subscription:s,data:t,policy:n})}return{subscription:s,backendSubscription:o}}async function Dn(){if(!Jt())return;const{subscription:t}=await yn();t&&(await Pi(),await t.unsubscribe())}var Ui={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Un=16,pt=[14,15,16,17,18,19,20],{PHANPY_WEBSITE:Fn,PHANPY_PRIVACY_POLICY_URL:Fi,PHANPY_IMG_ALT_API_URL:Oi,PHANPY_GIPHY_API_KEY:Bi}=Ui;function zi({onClose:t}){const n=De(C),i=we.local.get("theme")||"auto",s=H(),o=n.settings.contentTranslationTargetLanguage||null,a=gs(),l=bi(a),u=we.local.get("textSize")||Un,[r,p]=A(we.account.get("preferences")||{}),{masto:f,authenticated:c,instance:d}=K();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:s,onInput:h=>{h.preventDefault();const y=new FormData(s.current).get("theme"),k=document.documentElement;if(y==="auto"){k.classList.remove("is-light","is-dark");const m=document.querySelector('meta[data-theme-setting="manual"]');m&&(m.name=""),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(I=>{I.name="theme-color"})}else{k.classList.toggle("is-light",y==="light"),k.classList.toggle("is-dark",y==="dark");const m=document.querySelector('meta[data-theme-setting="manual"]');m&&(m.name="theme-color",m.content=y==="light"?m.dataset.themeLightColor:m.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(I=>{I.name=""})}document.querySelector('meta[name="color-scheme"]').setAttribute("content",y==="auto"?"dark light":y),y==="auto"?we.local.del("theme"):we.local.set("theme",y)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:i==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:i==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:i!=="light"&&i!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:pt[0]},children:"A"})," ",e("input",{type:"range",min:pt[0],max:pt[pt.length-1],step:"1",value:u,list:"sizes",onChange:h=>{const g=parseInt(h.target.value,10);document.documentElement.style.setProperty("--text-size",`${g}px`),g===Un?we.local.del("textSize"):we.local.set("textSize",h.target.value)}})," ",e("span",{style:{fontSize:pt[pt.length-1]},children:"A"}),e("datalist",{id:"sizes",children:pt.map(h=>e("option",{value:h}))})]})]})]})}),c&&e(_,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:r["posting:default:visibility"]||"public",onChange:h=>{const{value:g}=h.target;(async()=>{try{await f.v1.accounts.updateCredentials({source:{privacy:g}}),p({...r,"posting:default:visibility":g}),we.account.set("preferences",{...r,"posting:default:visibility":g})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${d}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",d,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:h=>{C.settings.autoRefresh=h.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:h=>{C.settings.boostsCarousel=h.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:h=>{const{checked:g}=h.target;C.settings.contentTranslation=g,g||(C.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:o||"",disabled:!n.settings.contentTranslation,onChange:h=>{C.settings.contentTranslationTargetLanguage=h.target.value||null},children:[e("option",{value:"",children:["System language (",l,")"]}),e("option",{disabled:!0,children:"──────────"}),En.map(h=>e("option",{value:h.code,children:h.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(_,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:En.map(h=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(h.code),onChange:g=>{const{checked:y}=g.target;y?C.settings.contentTranslationHideLanguages.push(h.code):C.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(k=>k!==h.code)}})," ",h.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses external translation services, powered by"," ",e("a",{href:"https://github.com/cheeaun/lingva-api",target:"_blank",rel:"noopener noreferrer",children:"Lingva API"})," ","&"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:h=>{C.settings.contentTranslationAutoInline=h.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),!!Bi&&c&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.composerGIFPicker,onChange:h=>{C.settings.composerGIFPicker=h.target.checked}})," ","GIF Picker for composer"]}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external GIF search service, powered by"," ",e("a",{href:"https://developers.giphy.com/",target:"_blank",rel:"noopener noreferrer",children:"GIPHY"}),". G-rated (suitable for viewing by all ages), tracking parameters are stripped, referrer information is omitted from requests, but search queries and IP address information will still reach their servers."]})})]}),!!Oi&&c&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.mediaAltGenerator,onChange:h=>{C.settings.mediaAltGenerator=h.target.checked}})," ","Image description generator"," ",e(w,{icon:"sparkles2",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Only for new images while composing new posts."})}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external AI service, powered by"," ",e("a",{href:"https://github.com/cheeaun/img-alt-api",target:"_blank",rel:"noopener noreferrer",children:"img-alt-api"}),". May not work well. Only for images and in English."]})})]}),c&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.shortcutSettingsCloudImportExport,onChange:h=>{C.settings.shortcutSettingsCloudImportExport=h.target.checked}})," ",'"Cloud" import/export for shortcuts settings'," ",e(w,{icon:"cloud",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:["⚠️⚠️⚠️ Very experimental.",e("br",{}),"Stored in your own profile’s notes. Profile (private) notes are mainly used for other profiles, and hidden for own profile."]})}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Note: This feature uses currently-logged-in instance server API."})})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:h=>{C.settings.cloakMode=h.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),c&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{C.showDrafts=!0,C.showSettings=!1},children:"Unsent drafts"})})]})}),c&&e(Hi,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:bn,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:h=>{h.preventDefault(),C.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:h=>{h.preventDefault(),C.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:Fi,target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[Fn&&e(_,{children:[e("span",{class:"insignificant",children:"Site:"})," ",Fn.replace(/https?:\/\//g,"").replace(/\/$/,""),e("br",{})]}),e("span",{class:"insignificant",children:"Version:"})," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2024-05-21T20:34:22.742Z".slice(0,10).replace(/-/g,".")}.6fec85a`,onClick:h=>{h.target.select();try{navigator.clipboard.writeText(h.target.value),ie("Version string copied")}catch{ie("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/6fec85a",target:"_blank",rel:"noopener noreferrer",children:e(gt,{datetime:new Date("2024-05-21T20:34:22.742Z")})}),")"]})]})]})]})]})}function Hi({onClose:t}){if(!Jt())return null;const{instance:n}=K(),[i,s]=A("default"),o=H(),[a,l]=A(!1),[u,r]=A(!1),p=H();W(()=>{(async()=>{s("loading");try{const{subscription:c,backendSubscription:d}=await Di();if(d!=null&&d.policy&&d.policy!=="none"){l(!0);const{alerts:h,policy:g}=d;p.current=g;const{elements:y}=o.current,k=y.namedItem("policy");k&&(k.value=g),Object.keys(h).forEach(m=>{const b=y.namedItem(m);(b==null?void 0:b.type)==="checkbox"&&(b.checked=!0)})}s("default")}catch(c){/outside.*authorized/i.test(c.message)?r(!0):alert((c==null?void 0:c.message)||c),s("error")}})()},[]);const f=i==="loading";return e("form",{ref:o,onChange:()=>{setTimeout(()=>{const c=Object.fromEntries(new FormData(o.current)),d=!!c["policy-allow"],h={data:{policy:c.policy,alerts:{mention:!!c.mention,favourite:!!c.favourite,reblog:!!c.reblog,follow:!!c.follow,follow_request:!!c.followRequest,poll:!!c.poll,update:!!c.update,status:!!c.status}}};let g=0;Object.keys(h.data.alerts).forEach(k=>{h.data.alerts[k]?g++:delete h.data.alerts[k]});const y=p.current!==h.data.policy;d&&g>0?y?Dn().then(()=>{Nn(h)}).catch(k=>{alert("Failed to update subscription. Please try again.")}):Nn(h).catch(k=>{alert("Failed to update subscription. Please try again.")}):Dn().catch(k=>{alert("Failed to remove subscription. Please try again.")})},100)},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:f||u,name:"policy-allow",checked:a,onChange:async c=>{const{checked:d}=c.target;if(d){const h=await Notification.requestPermission();h==="granted"?l(!0):(l(!1),h==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else l(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:f||u||!a,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(c=>e("option",{value:c.value,children:c.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!a,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(c=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:c.value})," ",c.label]})}))})})})}),u&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(oe,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const on=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const i=document.querySelectorAll("#modal-container > *");if(i!=null&&i.length){const l=i[i.length-1],u=l.querySelector('[tabindex="-1"]')||l;if(u){u.focus();return}}if(document.querySelector(".deck-backdrop"))return;const o=document.querySelectorAll(".deck-container"),a=o[o.length-1];a&&a.tabIndex===-1&&a.focus()}},100);return()=>clearTimeout(t)};function Cs(t){if(!t)return;const n=Tt(),i=H(n.pathname);W(()=>{i.current&&n.pathname!==i.current&&(t==null||t())},[n.pathname,t])}const Ts=1e3*60,qi=24*60*60*1e3,an=ut(async()=>{const{masto:t}=K(),n=await t.v1.lists.list();return n.sort((i,s)=>i.title.localeCompare(s.title)),n.length&&setTimeout(()=>{we.account.set("lists",{lists:n,updatedAt:Date.now()})},1),n},{maxAge:Ts});async function Pt(){try{const{lists:t,updatedAt:n}=we.account.get("lists")||{};return t!=null&&t.length?(Date.now()-n>qi&&an(),t):await an()}catch{return[]}}const Vi=ut(t=>{const{masto:n}=K();return n.v1.lists.$select(t).fetch()},{maxAge:Ts});async function xs(t){const{lists:n}=we.account.get("lists")||{};if(n!=null&&n.length){const i=n.find(s=>s.id===t);if(i)return i}try{return Vi(t)}catch{return null}}async function Gi(t){const n=await xs(t);return(n==null?void 0:n.title)||""}function Yi(t){const{lists:n}=we.account.get("lists")||{};n!=null&&n.length&&(n.push(t),n.sort((i,s)=>i.title.localeCompare(s.title)),we.account.set("lists",{lists:n,updatedAt:Date.now()}))}function ji(t){const{lists:n}=we.account.get("lists")||{};if(n!=null&&n.length){const i=n.findIndex(s=>s.id===t.id);i!==-1&&(n[i]=t,n.sort((s,o)=>s.title.localeCompare(o.title)),we.account.set("lists",{lists:n,updatedAt:Date.now()}))}}function Wi(t){const{lists:n}=we.account.get("lists")||{};if(n!=null&&n.length){const i=n.findIndex(s=>s.id===t);i!==-1&&(n.splice(i,1),we.account.set("lists",{lists:n,updatedAt:Date.now()}))}}function wn({list:t,onClose:n}){const{masto:i}=K(),[s,o]=A("default"),a=!!t,l=H(),u=H(),r=H();W(()=>{a&&(l.current.value=t.title,u.current.value=t.repliesPolicy,r.current&&(r.current.checked=t.exclusive))},[a]);const p=st("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:a?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:f=>{f.preventDefault();const c=new FormData(f.target),d=c.get("title"),h=c.get("replies_policy"),g=c.get("exclusive")==="on";o("loading"),(async()=>{try{let y;a?y=await i.v1.lists.$select(t.id).update({title:d,replies_policy:h,exclusive:g}):y=await i.v1.lists.create({title:d,replies_policy:h,exclusive:g}),o("default"),n==null||n({state:"success",list:y}),setTimeout(()=>{a?ji(y):Yi(y)},1)}catch{o("error"),alert(a?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:l,type:"text",id:"list-title",name:"title",required:!0,disabled:s==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:u,name:"replies_policy",required:!0,disabled:s==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),p&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:r,type:"checkbox",name:"exclusive",disabled:s==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:s==="loading",children:a?"Save":"Create"}),a&&e(Qe,{disabled:s==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await i.v1.lists.$select(t.id).remove(),o("default"),n==null||n({state:"deleted"}),setTimeout(()=>{Wi(t.id)},1)}catch{o("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:s==="loading",children:"Delete…"})})]})]})})]})}const Ki=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],On={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},Bn=80,As=1e3*60*10;function Ji(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Xi=ut(Ji,{maxAge:As});async function Zi(t,n){const i=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:s}=await i,o={total:s.length,originals:0,replies:0,boosts:0};return s.forEach(a=>{a.reblog?o.boosts++:a.inReplyToId&&a.inReplyToAccountId!==a.account.id?o.replies++:o.originals++}),s.length&&(o.daysSinceLastPost=Math.ceil((Date.now()-new Date(s[s.length-1].createdAt))/864e5)),o}const Qi=ut(Zi,{maxAge:As});function $s({account:t,fetchAccount:n=()=>{},standalone:i,instance:s,authenticated:o}){const{masto:a}=K({instance:s}),{masto:l,instance:u}=K(),[r,p]=A("default"),f=typeof t=="string",[c,d]=A(f?null:t),h=be(()=>s===u,[s,u]);W(()=>{if(!f){d(t);return}p("loading"),(async()=>{try{const $=await n();C.accounts[`${$.id}@${s}`]=$,d($),p("default")}catch{d(null),p("error")}})()},[f,t,n]);const{acct:g,avatar:y,avatarStatic:k,bot:m,createdAt:b,displayName:I,emojis:v,fields:S,followersCount:T,followingCount:U,group:V,id:G,lastStatusAt:L,locked:ee,note:q,statusesCount:E,url:P,username:N,memorial:D,moved:Q,roles:he,hideCollections:Ie}=c||{};let ae=!1,{header:se,headerStatic:fe}=c||{};(!se||/missing\.png$/.test(se))&&y&&!/missing\.png$/.test(y)&&(se=y,ae=!0,k&&!/missing\.png$/.test(k)&&(fe=k));const ce=be(()=>G===it(),[G]);W(()=>{const $=!!(c!=null&&c.id&&(c!=null&&c.username)&&(c!=null&&c.acct)&&(c!=null&&c.avatar)&&(c!=null&&c.avatarStatic)&&(c!=null&&c.displayName)&&(c!=null&&c.url));if(ce&&s&&$){const O=we.local.getJSON("accounts");let B=!1;O.forEach(z=>{z.info.id===c.id&&z.instanceURL===s&&(z.info=c,B=!0)}),B&&we.local.setJSON("accounts",O)}},[ce,c,s]);const ye=be(()=>P?xt.toUnicode(new URL(P).hostname):null,[P]),[Se,Ce]=A([]),Be=H(),Pe=H([]);async function Ee($){var ve;($||!Be.current)&&(Be.current=a.v1.accounts.$select(G).followers.list({limit:Bn}));const O=await Be.current.next();if(ce||!h)return O;const{value:B}=O;let z=[];if($){let me=[];try{me=await a.v1.accounts.familiarFollowers.fetch({id:[G]})}catch{}Pe.current=((ve=me==null?void 0:me[0])==null?void 0:ve.accounts)||[],z=[...Pe.current,...B.filter(de=>!Pe.current.some(ge=>ge.id===de.id))]}else B!=null&&B.length&&(z=B.filter(me=>!Pe.current.some(de=>de.id===me.id)));return{...O,value:z}}const Ne=H();async function j($){return($||!Ne.current)&&(Ne.current=a.v1.accounts.$select(G).following.list({limit:Bn})),await Ne.current.next()}const le=i?"div":oe,ne=s?`/${s}/a/${G}`:`/a/${G}`,[re,xe]=A([]),[F,R]=A(),[J,te]=A("default"),M=!!(F!=null&&F.total),Y=async $=>{try{const O=await Xi($,l);xe(O[0].accounts.slice(0,eo))}catch{}},X=async()=>{if(G){te("loading");try{const $=await Qi(G,a);R($),te("default")}catch{te("error")}}},ke=Ze(({relationship:$,currentID:O})=>{$.following||(Y(O),!i&&E>0&&X())},[i,G,E]),x=Ze($=>{$.id===G&&(d($),C.accounts[`${$.id}@${s}`]=$)},[G,s]);return e("div",{tabIndex:"-1",class:`account-container ${r==="loading"?"skeleton":""}`,style:{"--header-color-1":Se[0],"--header-color-2":Se[1],"--header-color-3":Se[2],"--header-color-4":Se[3]},children:[r==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:f?t:P,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),r==="loading"?e(_,{children:[e("header",{children:e(Xe,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):c&&e(_,{children:[!!Q&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:I})," has indicated that their new account is now:"]}),e(Xe,{account:Q,instance:s,onClick:$=>{$.stopPropagation(),C.showAccount=Q}})]}),!!se&&!/missing\.png$/.test(se)&&e("img",{src:se,alt:"",class:`header-banner ${ae?"header-is-avatar":""}`,onError:$=>{$.target.crossOrigin?$.target.src!==fe?$.target.src=fe:($.target.removeAttribute("crossorigin"),$.target.src=se):$.target.src!==fe?$.target.src=fe:$.target.remove()},crossOrigin:"anonymous",onLoad:$=>{$.target.classList.add("loaded");try{const O=window.OffscreenCanvas?new OffscreenCanvas(1,1):document.createElement("canvas"),B=O.getContext("2d",{willReadFrequently:!0});O.width=$.target.width,O.height=$.target.height,B.imageSmoothingEnabled=!1,B.drawImage($.target,0,0);const z=10,me=[B.getImageData(0,0,z,z).data,B.getImageData($.target.width-z,0,z,z).data,B.getImageData(0,$.target.height-z,z,z).data,B.getImageData($.target.width-z,$.target.height-z,z,z).data].map(de=>{let ge=0,Ae=0,qe=0,$e=0;for(let ue=0;ue<de.length;ue+=4)ge+=de[ue],Ae+=de[ue+1],qe+=de[ue+2],$e+=de[ue+3];const Ve=de.length/4;return[ge/Ve,Ae/Ve,qe/Ve,$e/Ve]}).map(de=>{const[ge,Ae,qe,$e]=no(de);return`rgba(${ge}, ${Ae}, ${qe}, ${$e})`});Ce(me)}catch{}}}),e("header",{children:i?e(Ke,{shift:window.matchMedia("(min-width: calc(40em))").matches?114:64,menuButton:e("div",{children:e(Xe,{account:c,instance:s,avatarSize:"xxxl",onClick:()=>{}})}),children:[e("div",{class:"szh-menu__header",children:e(lo,{acct:g,instance:s})}),e(pe,{onClick:()=>{const $=`@${g}`;try{navigator.clipboard.writeText($),ie("Handle copied")}catch{ie("Unable to copy handle")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy handle"})]}),e(pe,{href:P,target:"_blank",children:[e(w,{icon:"external"}),e("span",{children:"Go to original profile page"})]}),e(Fe,{}),e(Le,{href:c.avatar,target:"_blank",children:[e(w,{icon:"user"}),e("span",{children:"View profile image"})]}),e(Le,{href:c.header,target:"_blank",children:[e(w,{icon:"media"}),e("span",{children:"View profile header"})]})]}):e(Xe,{account:c,instance:s,avatarSize:"xxxl",internal:!0})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!D&&e("span",{class:"tag",children:"In Memoriam"}),!!m&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!V&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),he==null?void 0:he.map($=>e("span",{class:"tag",children:[$.name,!!ye&&e(_,{children:[" ",e("span",{class:"more-insignificant",children:ye})]})]})),e("div",{class:"note",dir:"auto",onClick:bs({instance:u}),dangerouslySetInnerHTML:{__html:sn(q,{emojis:v})}}),e("div",{class:"account-metadata-box",children:[(S==null?void 0:S.length)>0&&e("div",{class:"profile-metadata",children:S.map(({name:$,value:O,verifiedAt:B},z)=>e("div",{class:`profile-field ${B?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(ys,{text:$,emojis:v})," ",!!B&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:sn(O,{emojis:v})}})]},$+z))}),e("div",{class:"stats",children:[e(le,{tabIndex:0,to:ne,onClick:()=>{setTimeout(()=>{C.showGenericAccounts={id:"followers",heading:"Followers",fetchAccounts:Ee,instance:s,excludeRelationshipAttrs:ce?["followedBy"]:[],blankCopy:Ie?"This user has chosen to not make this information available.":void 0}},0)},children:[!!re.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:re.map($=>e(tt,{url:$.avatarStatic,size:"s",alt:`${$.displayName} @${$.acct}`,squircle:$==null?void 0:$.bot}))})}),e("span",{title:T,children:Ge(T)})," ","Followers"]}),e(le,{class:"insignificant",tabIndex:0,to:ne,onClick:()=>{setTimeout(()=>{C.showGenericAccounts={heading:"Following",fetchAccounts:j,instance:s,excludeRelationshipAttrs:ce?["following"]:[],blankCopy:Ie?"This user has chosen to not make this information available.":void 0}},0)},children:[e("span",{title:U,children:Ge(U)})," ","Following",e("br",{})]}),e(le,{class:"insignificant",to:ne,children:[e("span",{title:E,children:Ge(E)})," ","Posts"]}),!!b&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:b,children:ot(b,{hideTime:!0})})]})]})]}),!!F&&e(le,{to:ne,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:M?e("div",{class:"posting-stats",title:`${Math.round(F.originals/F.total*100)}% original posts, ${Math.round(F.replies/F.total*100)}% replies, ${Math.round(F.boosts/F.total*100)}% boosts`,children:[e("div",{children:F.daysSinceLastPost<365?`Last ${F.total} post${F.total>1?"s":""} in the past 
                      ${F.daysSinceLastPost} day${F.daysSinceLastPost>1?"s":""}`:`
                      Last ${F.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${F.originals/F.total*100}%`,"--replies-percentage":`${(F.originals+F.replies)/F.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),!Q&&e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!F,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:J==="loading",onClick:()=>{X()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${J==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(to,{info:c,instance:s,standalone:i,authenticated:o,onRelationshipChange:ke,onProfileUpdate:x})})]})]})}const eo=3;function to({info:t,instance:n,standalone:i,authenticated:s,onRelationshipChange:o=()=>{},onProfileUpdate:a=()=>{}}){var xe;if(!t)return null;const{masto:l,instance:u,authenticated:r}=K(),p=n===u,[f,c]=A("default"),[d,h]=A(null),{id:g,acct:y,url:k,username:m,locked:b,lastStatusAt:I,note:v,fields:S,moved:T}=t,U=H(g),{following:V,showingReblogs:G,notifying:L,followedBy:ee,blocking:q,blockedBy:E,muting:P,mutingNotifications:N,requested:D,domainBlocking:Q,endorsed:he,note:Ie}=d||{},[ae,se]=A(null),[fe,ce]=A(!1);W(()=>{if(t){const F=it();let R;(async()=>{if(p&&s)R=g;else if(!p&&r){const te=t.acct.includes("@");try{const M=await l.v2.search.fetch({q:te?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});M.accounts.length&&(R=M.accounts[0].id,se(M.accounts[0]))}catch{}}if(!R)return;if(F===R){ce(!0);return}U.current=R,c("loading");const J=l.v1.accounts.relationships.fetch({id:[R]});try{const te=await J;if(c("default"),te.length){const M=te[0];h(M),o({relationship:M,currentID:R})}}catch{c("error")}})()}},[t,s]),W(()=>{t&&fe&&js(t)},[t,fe]);const ye=f==="loading",[Se,Ce]=A(!1),[Be,Pe]=A(!1),[Ee,Ne]=A(!1),[j,le]=A(!1),[ne,re]=A([]);return e(_,{children:[e("div",{class:"actions",children:[e("span",{children:[ee?e("span",{class:"tag",children:"Follows you"}):I?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:ot(I,{hideTime:!0})})]}):e("span",{}),P&&e("span",{class:"tag danger",children:"Muted"}),q&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!Ie&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{Ne(!0)},dir:"auto",children:e("span",{children:Ie})}),e(Ke,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:ye,children:e(w,{icon:"more",size:"l",alt:"More"})}),onMenuChange:F=>{V&&F.open&&(async()=>{try{const R=await l.v1.accounts.$select(U.current).lists.list();re(R)}catch{}})()},children:[r&&!fe&&e(_,{children:[e(pe,{onClick:()=>{C.showCompose={draftStatus:{status:`@${(ae==null?void 0:ae.acct)||y} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",m]})]}),e(pe,{onClick:()=>{Ce(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),st("@mastodon/profile-private-note")&&e(pe,{onClick:()=>{Ne(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:Ie?"Edit private note":"Add private note"})]}),V&&!!d&&e(_,{children:[e(pe,{onClick:()=>{c("loading"),(async()=>{try{const F=await l.v1.accounts.$select(U.current).follow({notify:!L});F&&h(F),c("default"),ie(F.notifying?`Notifications enabled for @${m}'s posts.`:` Notifications disabled for @${m}'s posts.`)}catch(F){alert(F),c("error")}})()},children:[e(w,{icon:"notification"}),e("span",{children:L?"Disable notifications":"Enable notifications"})]}),e(pe,{onClick:()=>{c("loading"),(async()=>{try{const F=await l.v1.accounts.$select(U.current).follow({reblogs:!G});F&&h(F),c("default"),ie(F.showingReblogs?`Boosts from @${m} disabled.`:`Boosts from @${m} enabled.`)}catch(F){alert(F),c("error")}})()},children:[e(w,{icon:"rocket"}),e("span",{children:G?"Disable boosts":"Enable boosts"})]})]}),V&&e(pe,{onClick:()=>{Pe(!0)},children:[e(w,{icon:"list"}),ne.length?e(_,{children:[e("small",{class:"menu-grow",children:["Add/Remove from Lists",e("br",{}),e("span",{class:"more-insignificant",children:ne.map(F=>F.title).join(", ")})]}),e("small",{class:"more-insignificant",children:ne.length})]}):e("span",{children:"Add/Remove from Lists"})]}),e(Fe,{})]}),e(pe,{onClick:()=>{const F=`@${(ae==null?void 0:ae.acct)||y}`;try{navigator.clipboard.writeText(F),ie("Handle copied")}catch{ie("Unable to copy handle")}},children:[e(w,{icon:"copy"}),e("small",{children:["Copy handle",e("br",{}),e("span",{class:"more-insignificant",children:["@",(ae==null?void 0:ae.acct)||y]})]})]}),e(pe,{href:k,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:so(k)})]}),e("div",{class:"menu-horizontal",children:[e(pe,{onClick:()=>{try{navigator.clipboard.writeText(k),ie("Link copied")}catch{ie("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((xe=navigator==null?void 0:navigator.canShare)==null?void 0:xe.call(navigator,{url:k}))&&e(pe,{onClick:()=>{try{navigator.share({url:k})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!d&&e(_,{children:[e(Fe,{}),P?e(pe,{onClick:()=>{c("loading"),(async()=>{try{const F=await l.v1.accounts.$select((ae==null?void 0:ae.id)||g).unmute();h(F),c("default"),ie(`Unmuted @${m}`),C.reloadGenericAccounts.id="mute",C.reloadGenericAccounts.counter++}catch{c("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",m]})]}):e(jt,{menuClassName:"menu-blur",openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(_,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",m,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:Ki.map(F=>e(pe,{onClick:()=>{c("loading"),(async()=>{try{const R=await l.v1.accounts.$select((ae==null?void 0:ae.id)||g).mute({duration:F});h(R),c("default"),ie(`Muted @${m} for ${On[F]}`),C.reloadGenericAccounts.id="mute",C.reloadGenericAccounts.counter++}catch{c("error"),ie(`Unable to mute @${m}`)}})()},children:On[F]}))})}),ee&&e(Qe,{subMenu:!0,menuItemClassName:"danger",confirmLabel:e(_,{children:[e(w,{icon:"user-x"}),e("span",{children:["Remove @",m," from followers?"]})]}),onClick:()=>{c("loading"),(async()=>{try{const F=await l.v1.accounts.$select((ae==null?void 0:ae.id)||g).removeFromFollowers();h(F),c("default"),ie(`@${m} removed from followers`),C.reloadGenericAccounts.id="followers",C.reloadGenericAccounts.counter++}catch{c("error")}})()},children:[e(w,{icon:"user-x"}),e("span",{children:"Remove follower…"})]}),e(Qe,{subMenu:!0,confirm:!q,confirmLabel:e(_,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"?"]})]}),menuItemClassName:"danger",onClick:()=>{c("loading"),(async()=>{try{if(q){const F=await l.v1.accounts.$select((ae==null?void 0:ae.id)||g).unblock();h(F),c("default"),ie(`Unblocked @${m}`)}else{const F=await l.v1.accounts.$select((ae==null?void 0:ae.id)||g).block();h(F),c("default"),ie(`Blocked @${m}`)}C.reloadGenericAccounts.id="block",C.reloadGenericAccounts.counter++}catch{c("error"),q?ie(`Unable to unblock @${m}`):ie(`Unable to block @${m}`)}})()},children:q?e(_,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",m]})]}):e(_,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"…"]})]})}),e(pe,{className:"danger",onClick:()=>{C.showReportModal={account:ae||t}},children:[e(w,{icon:"flag"}),e("span",{children:["Report @",m,"…"]})]})]}),r&&fe&&i&&st("@mastodon/profile-edit")&&e(_,{children:[e(Fe,{}),e(pe,{onClick:()=>{le(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:"Edit profile"})]})]}),!1]}),!d&&f==="loading"&&e(Te,{abrupt:!0}),!!d&&!T&&e(Qe,{confirm:V||D,confirmLabel:e("span",{children:D?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:ye,onClick:()=>{c("loading"),(async()=>{try{let F;V||D?F=await l.v1.accounts.$select(U.current).unfollow():F=await l.v1.accounts.$select(U.current).follow(),F&&h(F),c("default")}catch(F){alert(F),c("error")}})()},children:e("button",{type:"button",class:`${V||D?"light swap":""}`,"data-swap-state":V||D?"danger":"",disabled:ye,children:V?e(_,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):D?e(_,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):b?e(_,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!Se&&e(Re,{onClose:()=>{Ce(!1)},children:e(io,{note:v,fields:S,onClose:()=>Ce(!1)})}),!!Be&&e(Re,{onClose:()=>{Pe(!1)},children:e(oo,{accountID:U.current,onClose:()=>Pe(!1)})}),!!Ee&&e(Re,{onClose:()=>{Ne(!1)},children:e(ao,{account:t,note:Ie,onRelationshipChange:F=>{h(F)},onClose:()=>Ne(!1)})}),!!j&&e(Re,{onClose:()=>{le(!1)},children:e(co,{onClose:({state:F,account:R}={})=>{le(!1),F==="success"&&R&&a(R)}})})]})}function no([t,n,i]){const s=.2126*t+.7152*n+.0722*i;let o;return s>=220?o=1:s<=50?o=.1:o=s/255,o=Math.min(1,o),[t,n,i,o]}function so(t){if(!t)return;const n=new URL(t),{host:i,pathname:s}=n,o=s.replace(/\/$/,"").replace(/^\//,"");return e(_,{children:[e("span",{class:"more-insignificant",children:[xt.toUnicode(i),"/"]}),e("wbr",{}),e("span",{children:o})]})}function io({note:t,fields:n,onClose:i}){const s=(n==null?void 0:n.map(({name:a,value:l})=>`${a}
${Ln(l)}`).join(`

`))||"",o=Ln(t)+(s?`

${s}`:"");return e("div",{class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:o}),e(ws,{forceTranslate:!0,text:o})]})]})}function oo({accountID:t,onClose:n}){const{masto:i}=K(),[s,o]=A("default"),[a,l]=A([]),[u,r]=A([]),[p,f]=ft(h=>h+1,0);W(()=>{o("loading"),(async()=>{try{const h=await Pt();l(h);const g=await i.v1.accounts.$select(t).lists.list();r(g),o("default")}catch{o("error")}})()},[p]);const[c,d]=A(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[a.length>0?e("ul",{class:"list-add-remove",children:a.map(h=>{const g=u.some(y=>y.id===h.id);return e("li",{children:e("button",{type:"button",class:`light ${g?"checked":""}`,disabled:s==="loading",onClick:()=>{o("loading"),(async()=>{try{g?await i.v1.lists.$select(h.id).accounts.remove({accountIds:[t]}):await i.v1.lists.$select(h.id).accounts.create({accountIds:[t]}),f()}catch{o("error"),alert(g?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:h.title})]})})})}):s==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):s==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>d(!0),disabled:s!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),c&&e(Re,{onClick:h=>{h.target===h.currentTarget&&d(!1)},children:e(wn,{list:c==null?void 0:c.list,onClose:h=>{h.state==="success"&&f(),d(!1)}})})]})}function ao({account:t,note:n,onRelationshipChange:i=()=>{},onClose:s=()=>{}}){const{masto:o}=K(),[a,l]=A("default"),u=H(null);return W(()=>{let r;return u.current&&!n&&(r=setTimeout(()=>{var p,f;(f=(p=u.current).focus)==null||f.call(p)},100)),()=>{clearTimeout(r)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!s&&e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:r=>{r.preventDefault();const f=new FormData(r.target).get("note");(f==null?void 0:f.trim())!==(n==null?void 0:n.trim())&&(l("loading"),(async()=>{try{const c=await o.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:f});l("default"),i(c),s()}catch(c){l("error"),alert((c==null?void 0:c.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:u,name:"note",disabled:a==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:a==="loading",onClick:()=>{s==null||s()},children:"Cancel"}),e("span",{children:[e(Te,{abrupt:!0,hidden:a!=="loading"}),e("button",{disabled:a==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function co({onClose:t=()=>{}}){const{masto:n}=K(),[i,s]=A("loading"),[o,a]=A(null);W(()=>{(async()=>{try{const c=await n.v1.accounts.verifyCredentials();a(c),s("default")}catch{s("error")}})()},[]);const{displayName:l,source:u}=o||{},{note:r,fields:p}=u||{},f=H(null);return e("div",{class:"sheet",id:"edit-profile-container",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Edit profile"})}),e("main",{children:i==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):e("form",{onSubmit:c=>{c.preventDefault();const d=new FormData(c.target),h=d.get("display_name"),g=d.get("note"),y=f.current.querySelectorAll('input[name^="fields_attributes"]'),k=[];y.forEach(m=>{const b=m.name,[I,v,S]=b.match(/fields_attributes\[(\d+)\]\[(.+)\]/)||[],T=m.value?m.value.trim():"";v&&S&&T&&(k[v]||(k[v]={}),k[v][S]=T)}),k.forEach(m=>{m.name&&!m.value&&(m.value="")}),(async()=>{try{const m=await n.v1.accounts.updateCredentials({displayName:h,note:g,fieldsAttributes:k});t==null||t({state:"success",account:m})}catch(m){alert((m==null?void 0:m.message)||"Unable to update profile.")}})()},children:[e("p",{children:e("label",{children:["Name"," ",e("input",{type:"text",name:"display_name",defaultValue:l,maxLength:30,disabled:i==="loading"})]})}),e("p",{children:e("label",{children:["Bio",e("textarea",{defaultValue:r,name:"note",maxLength:500,rows:"5",disabled:i==="loading"})]})}),e("p",{children:"Extra fields"}),e("table",{ref:f,children:[e("thead",{children:e("tr",{children:[e("th",{children:"Label"}),e("th",{children:"Content"})]})}),e("tbody",{children:Array.from({length:Math.max(4,p.length)}).map((c,d)=>{const{name:h="",value:g=""}=p[d]||{};return e(ro,{name:h,value:g,index:d,disabled:i==="loading"},d)})})]}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:i==="loading",onClick:()=>{t==null||t()},children:"Cancel"}),e("button",{type:"submit",disabled:i==="loading",children:"Save"})]})]})})]})}function ro({name:t,value:n,disabled:i,index:s}){const[o,a]=A(!!n);return e("tr",{children:[e("td",{children:e("input",{type:"text",name:`fields_attributes[${s}][name]`,defaultValue:t,disabled:i,maxLength:255,required:o})}),e("td",{children:e("input",{type:"text",name:`fields_attributes[${s}][value]`,defaultValue:n,disabled:i,maxLength:255,onChange:l=>a(!!l.currentTarget.value)})})]})}function lo({acct:t,instance:n}){let[i,s]=t.split("@");return s||(s=n),e("div",{class:"handle-info",children:[e("span",{class:"handle-handle",children:[e("b",{class:"handle-username",children:i}),e("span",{class:"handle-at",children:"@"}),e("b",{class:"handle-server",children:s})]}),e("div",{class:"handle-legend",children:[e("span",{class:"ib",children:[e("span",{class:"handle-legend-icon username"})," username"]})," ",e("span",{class:"ib",children:[e("span",{class:"handle-legend-icon server"})," server domain name"]})]})]})}function uo({account:t,instance:n,onClose:i}){const{masto:s,instance:o,authenticated:a}=K({instance:n}),l=typeof t=="string";return W(()=>{l||(C.accounts[`${t.id}@${o}`]=t)},[t]),Cs(i),e("div",{class:"sheet",children:[!!i&&e("button",{type:"button",class:"sheet-close outer",onClick:i,children:e(w,{icon:"x"})}),e($s,{instance:o,authenticated:a,account:t,fetchAccount:async()=>{if(l)try{return await s.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const r=await s.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:a});if(r.accounts.length)return r.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const p=new URL(t),{hostname:f,pathname:c}=p,d=c.replace(/^\//,"").replace(/\/$/,"")+"@"+f,h=await s.v2.search.fetch({q:d,type:"accounts",limit:1,resolve:a});if(h.accounts.length)return h.accounts[0]}}else return t}})]})}function ho({onClose:t}){const{masto:n}=K(),[i,s]=A("default"),[o,a]=A([]),[l,u]=ft(p=>p+1,0);W(()=>{s("loading"),(async()=>{try{const p=await et.drafts.keys();if(p.length){const f=Yt(),c=p.filter(d=>d.startsWith(f));if(c.length){const d=await et.drafts.getMany(c);d.sort((h,g)=>new Date(g.updatedAt).getTime()-new Date(h.updatedAt).getTime()),a(d)}else a([])}else a([]);s("default")}catch{s("error")}})()},[l]);const r=(o==null?void 0:o.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(Te,{abrupt:!0,hidden:i!=="loading"})]}),r&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:r?e(_,{children:[e("ul",{class:"drafts-list",children:o.map(p=>{const{updatedAt:f,key:c,draftStatus:d,replyTo:h}=p,g=new Date(f);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:h?"reply":"quill",size:"s"})," ",e("time",{children:[!!h&&e(_,{children:["@",h.account.acct,e("br",{})]}),ot(g)]})]}),e(Qe,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:i==="loading",onClick:()=>{(async()=>{try{await et.drafts.del(c),u()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:i==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:i==="loading",class:"draft-item",onClick:async()=>{let y;if(h){s("loading");try{y=await n.v1.statuses.$select(h.id).fetch()}catch{alert("Error fetching reply-to status!"),s("default");return}s("default")}window.__COMPOSE__={draftStatus:d,replyToStatus:y},C.showCompose=!0,C.showDrafts=!1},children:e(po,{draft:p})})]},f)})}),o.length>1&&e("p",{children:e(Qe,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:i==="loading",onClick:()=>{(async()=>{s("loading");try{await et.drafts.delMany(o.map(p=>p.key)),s("default"),u()}catch{alert("Error deleting drafts! Please try again."),s("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function po({draft:t}){var c;const{draftStatus:n,replyTo:i}=t,{status:s,spoilerText:o,poll:a,mediaAttachments:l}=n,u=((c=a==null?void 0:a.options)==null?void 0:c.length)>0,r=(l==null?void 0:l.length)>0,p=u||r,f=be(()=>{if(!r)return;const d=l.find(y=>/image/.test(y.type));if(!d)return;const{file:h}=d;return URL.createObjectURL(h)},[r,l]);return e(_,{children:e("div",{class:"mini-draft",children:[p&&e("div",{class:`mini-draft-aside ${f?"has-image":""}`,style:f?{"--bg-image":`url(${f})`}:{},children:[u&&e(w,{icon:"poll"}),r&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:l==null?void 0:l.length})]})]}),e("div",{class:"mini-draft-main",children:[!!o&&e("div",{class:"mini-draft-spoiler",children:o}),!!s&&e("div",{class:"mini-draft-status",children:s})]})]})})}function fo({html:t,url:n,width:i,height:s,onClose:o=()=>{}}){return e("div",{class:"embed-modal-container",children:[e("div",{class:"top-controls",children:[e("button",{type:"button",class:"light",onClick:()=>o(),children:e(w,{icon:"x"})}),n&&e("a",{href:n,target:"_blank",rel:"noopener noreferrer",class:"button plain",children:[e("span",{children:"Open link"})," ",e(w,{icon:"external"})]})]}),e("div",{class:"embed-content",dangerouslySetInnerHTML:{__html:t},style:{"--width":i+"px","--height":s+"px","--aspect-ratio":`${i}/${s}`}})]})}async function vn(t,n={}){if(!(t!=null&&t.length))return;const{masto:i}=K(),s=it(),o=t.reduce((a,l)=>(!a.includes(l.id)&&!n[l.id]&&l.id!==s&&a.push(l.id),a),[]);if(!o.length)return null;try{return(await i.v1.accounts.relationships.fetch({id:o})).reduce((u,r)=>(u[r.id]=r,u),{})}catch{return null}}function mo({instance:t,excludeRelationshipAttrs:n=[],postID:i,onClose:s=()=>{},blankCopy:o="Nothing to show"}){const{masto:a,instance:l}=K(),u=t?t===l:!0,r=De(C),[p,f]=A("default"),[c,d]=A([]),[h,g]=A(!1);if(Cs(s),!r.showGenericAccounts)return null;const{id:y,heading:k,fetchAccounts:m,accounts:b,showReactions:I}=r.showGenericAccounts,[v,S]=A({}),T=async L=>{if(!(L!=null&&L.length)||!u)return;const ee=await vn(L,v);ee&&S({...v,...ee})},U=L=>{m&&(L&&d([]),f("loading"),(async()=>{try{const{done:ee,value:q}=await m(L);if(Array.isArray(q)){if(L){const E=[];for(let P=0;P<q.length;P++){const N=q[P],D=E.find((Q,he)=>Q.id===N.id&&P!==he);D?D._types.push(...N._types):E.push({_types:[],...N})}d(E)}else d(E=>{const P=E;for(const N of q){const D=P.find(Q=>Q.id===N.id);D?D._types.push(...N._types):P.push(N)}return P});g(!ee),T(q)}else g(!1);f("default")}catch{f("error")}})())},V=H(!0);W(()=>{(b==null?void 0:b.length)>0?(d(b),T(b)):(U(!0),V.current=!1)},[b,m]),W(()=>{var L;V.current||((L=r.reloadGenericAccounts)==null?void 0:L.id)===y&&U(!0)},[r.reloadGenericAccounts.counter]);const G=C.statuses[i];return e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:k||"Accounts"})}),e("main",{children:[G&&e(oe,{to:`/${t||l}/s/${G.id}`,class:"post-preview",children:e(Oe,{status:G,size:"s",readOnly:!0})}),c.length>0?e(_,{children:[e("ul",{class:"accounts-list",children:c.map(L=>{var E,P;const ee=v[L.id],q=`${L.id}-${((E=L._types)==null?void 0:E.length)||""}`;return e("li",{children:[I&&((P=L._types)==null?void 0:P.length)>0&&e("div",{class:"reactions-block",children:L._types.map(N=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[N],class:`${N}-icon`}))}),e("div",{class:"account-relationships",children:e(Xe,{account:L,showStats:!0,relationship:ee,excludeRelationshipAttrs:n})})]},q)})}),p==="default"?h?e(ct,{onChange:L=>{L&&U()},children:e("button",{type:"button",class:"plain block",onClick:()=>U(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):p==="loading"&&e("p",{class:"ui-state",children:e(Te,{abrupt:!0})})]}):p==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):p==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:o})]})]})}function go({alt:t,lang:n,onClose:i}){const s=De(C),[o,a]=A(!1),l=gs(!0),u=s.settings.contentTranslationHideLanguages||[],r=!!n&&n!==l&&!Mn([n],[l])&&!u.find(p=>n===p||Mn([n],[p]));return e("div",{class:"sheet",tabindex:"-1",children:[!!i&&e("button",{type:"button",class:"sheet-close outer",onClick:i,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Ke,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:[e(pe,{disabled:o,onClick:()=>{a(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]}),yi&&e(pe,{onClick:()=>{wi(t,n)},children:[e(w,{icon:"speak"}),e("span",{children:"Speak"})]})]})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(r||o)&&e(ws,{forceTranslate:o,sourceLanguage:n,text:t})]})]})}function Zt(t,n,i){return Math.max(Math.min(t,i),n)}const Qt=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,en=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function kn([t,n,i]){t=Qt(t/255),n=Qt(n/255),i=Qt(i/255);var s=.4122214708*t+.5363325363*n+.0514459929*i,o=.2119034982*t+.6806995451*n+.1073969566*i,a=.0883024619*t+.2817188376*n+.6299787005*i;return s=Math.cbrt(s),o=Math.cbrt(o),a=Math.cbrt(a),[s*.2104542553+o*.793617785+a*-.0040720468,s*1.9779984951+o*-2.428592205+a*.4505937099,s*.0259040371+o*.7827717662+a*-.808675766]}function Sn([t,n,r]){var s=t+n*.3963377774+r*.2158037573,o=t+n*-.1055613458+r*-.0638541728,a=t+n*-.0894841775+r*-1.291485548;s=s**3,o=o**3,a=a**3;var l=s*4.0767416621+o*-3.3077115913+a*.2309699292,u=s*-1.2684380046+o*2.6097574011+a*-.3413193965,r=s*-.0041960863+o*-.7034186147+a*1.707614701;return l=255*en(l),u=255*en(u),r=255*en(r),l=Zt(l,0,255),u=Zt(u,0,255),r=Zt(r,0,255),l=Math.round(l),u=Math.round(u),r=Math.round(r),[l,u,r]}var bo={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:Wc}=bo;function _s({mediaAttachments:t,statusID:n,instance:i,lang:s,index:o=0,onClose:a=()=>{}}){var b,I;const[l,u]=A("default"),r=H(null),[p,f]=A(o),c=H(null);rt(()=>{var v;(v=c.current)==null||v.scrollIntoView()},[]);const d=H(n);W(()=>{const v=o*r.current.clientWidth,S=d.current!==n;S&&(d.current=n),r.current.scrollTo({left:v,behavior:S?"auto":"smooth"}),r.current.focus()},[o,n]);const[h,g]=A(!0);W(()=>{let v=()=>{a()};return r.current&&r.current.addEventListener("swiped-down",v),()=>{r.current&&r.current.removeEventListener("swiped-down",v)}},[]),Me("esc",a,{ignoreEventWhen:v=>!!document.querySelector("#modal-container > *")},[a]),W(()=>{let v=()=>{const{clientWidth:S,scrollLeft:T}=r.current,U=Math.round(T/S);f(U)};return r.current&&r.current.addEventListener("scroll",v,{passive:!0}),()=>{r.current&&r.current.removeEventListener("scroll",v)}},[]),W(()=>{let v=setTimeout(()=>{var S,T;(T=(S=r.current)==null?void 0:S.focus)==null||T.call(S)},100);return()=>clearTimeout(v)},[]);const y=be(()=>t==null?void 0:t.map(v=>{const{blurhash:S}=v;if(S){const T=pn(S),U=kn(T);return Sn([.6,U[1],U[2]])}return null}),[t]),k=be(()=>{var T;const S=100/y.length;return((T=y==null?void 0:y.map((U,V)=>{const G=V*S+5,L=(V+1)*S-5;return U?`
            rgba(${U==null?void 0:U.join(",")}, 0.4) ${G}%,
            rgba(${U==null?void 0:U.join(",")}, 0.4) ${L}%
          `:`
            transparent ${G}%,
            transparent ${L}%
          `}))==null?void 0:T.join(", "))||"transparent"},[y]);let m=H(null);return W(()=>()=>{var v,S;(S=(v=m.current)==null?void 0:v.hideToast)==null||S.call(v)},[]),e("div",{class:`media-modal-container media-modal-count-${t==null?void 0:t.length}`,children:[e("div",{ref:r,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:v=>{(v.target.classList.contains("carousel-item")||v.target.classList.contains("media")||v.target.classList.contains("media-zoom"))&&a()},style:t.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${k})`}:{},children:t==null?void 0:t.map((v,S)=>{const T=t.length===1?y[S]:null;return e("div",{class:"carousel-item",style:T?{"--accent-color":`rgb(${T==null?void 0:T.join(",")})`,"--accent-alpha-color":`rgba(${T==null?void 0:T.join(",")}, 0.4)`}:{},tabindex:"0",ref:S===p?c:null,onClick:U=>{U.target.classList.contains("media")||g(!h)},children:[!!v.description&&e("button",{type:"button",class:"media-alt",hidden:!h,onClick:()=>{C.showMediaAlt={alt:v.description,lang:s}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:s,dir:"auto",children:v.description})]}),e(vs,{media:v,showOriginal:!0,lang:s})]},v.id)})}),e("div",{class:"carousel-top-controls",hidden:!h,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>a(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((v,S)=>e("button",{type:"button",disabled:S===p,class:`carousel-dot ${S===p?"active":""}`,onClick:T=>{T.preventDefault(),T.stopPropagation(),r.current.scrollTo({left:r.current.clientWidth*S,behavior:"smooth"}),r.current.focus()},children:e(w,{icon:"round",size:"s"})},v.id))}):e("span",{}),e("span",{children:[e(Ke,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:[e(Le,{href:((b=t[p])==null?void 0:b.remoteUrl)||((I=t[p])==null?void 0:I.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]}),!1]})," ",e(oe,{to:`${i?`/${i}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${p+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!h,children:[e("button",{type:"button",class:"carousel-button",hidden:p===0,onClick:v=>{v.preventDefault(),v.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(p-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:p===t.length-1,onClick:v=>{v.preventDefault(),v.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(p+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]})]})}const yo=[,"spam","legal","violation","other"],$t={spam:{label:"Spam",description:"Malicious links, fake engagement, or repetitive replies"},legal:{label:"Illegal",description:"Violates the law of your or the server's country"},violation:{label:"Server rule violation",description:"Breaks specific server rules",stampLabel:"Violation"},other:{label:"Other",description:"Issue doesn't fit other categories",excludeStamp:!0}};function wo({account:t,post:n,onClose:i}){const{masto:s}=K(),[o,a]=A("default"),[l,u]=t.acct.split("@"),[r,p]=be(()=>{const{rules:m,domain:b}=ls();return[m||[],b]}),[f,c]=A(null),[d,h]=A(!1),g=H(null),[y,k]=A(!1);return e("div",{class:"report-modal-container",children:[e("div",{class:"top-controls",children:[e("h1",{children:n?"Report Post":`Report @${l}`}),e("button",{type:"button",class:"plain4 small",disabled:o==="loading",onClick:()=>i(),children:e(w,{icon:"x",size:"xl"})})]}),e("main",{children:[e("div",{class:"report-preview",children:n?e(Oe,{status:n,size:"s",previewMode:!0}):e(Xe,{account:t,avatarSize:"xxl",useAvatarStatic:!0,showStats:!0,showActivity:!0})}),!!f&&!$t[f].excludeStamp&&e("span",{class:"rubber-stamp","aria-hidden":"true",children:[$t[f].stampLabel||$t[f].label,e("small",{children:"Pending review"})]},f),e("form",{onSubmit:m=>{m.preventDefault();const b=new FormData(m.target),I=Object.fromEntries(b.entries());let{category:v,comment:S,forward:T}=I;S||(S=void 0),T==="on"&&(T=!0);const U=v==="violation"?Object.entries(I).filter(([G])=>G.startsWith("rule_ids")).map(([G,L])=>L):void 0,V={category:v,comment:S,forward:T,ruleIds:U};a("loading"),(async()=>{try{await s.v1.reports.create({accountId:t.id,statusIds:n!=null&&n.id?[n.id]:void 0,category:v,comment:S,ruleIds:U,forward:T}),a("success"),ie(n?"Post reported":"Profile reported"),i()}catch(G){a("error"),ie((G==null?void 0:G.message)||(n?"Unable to report post":"Unable to report profile"))}})()},children:[e("p",{children:n?"What's the issue with this post?":"What's the issue with this profile?"}),e("section",{class:"report-categories",children:yo.map(m=>m==="violation"&&!(r!=null&&r.length)?null:e(_,{children:[e("label",{class:"report-category",children:[e("input",{type:"radio",name:"category",value:m,required:!0,disabled:o==="loading",onChange:b=>{c(b.target.value),h(b.target.value==="violation")}}),e("span",{children:[$t[m].label,"  ",e("small",{class:"ib insignificant",children:$t[m].description})]})]}),m==="violation"&&!!(r!=null&&r.length)&&e("div",{class:"shazam-container no-animation",hidden:!d,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"report-rules",ref:g,children:r.map((b,I)=>e("label",{class:"report-rule",children:[e("input",{type:"checkbox",name:`rule_ids[${I}]`,value:b.id,required:d&&!y,disabled:o==="loading",onChange:v=>{const{checked:S}=v.target;S?k(!0):g.current.querySelectorAll("input:checked").length||k(!1)}}),e("span",{children:b.text})]},b.id))})})})]},m))}),e("section",{class:"report-comment",children:[e("p",{children:e("label",{for:"report-comment",children:"Additional info"})}),e("textarea",{maxlength:"1000",rows:"1",name:"comment",id:"report-comment",disabled:o==="loading"})]}),!!u&&u!==p&&e("section",{children:e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,name:"forward",disabled:o==="loading"})," ",e("span",{children:["Forward to ",e("i",{children:u})]})]})})}),e("footer",{children:[e("button",{type:"submit",disabled:o==="loading",children:"Send Report"})," ",e("button",{type:"submit",class:"plain2",disabled:o==="loading",onClick:async()=>{try{await s.v1.accounts.$select(t.id).mute(),ie(`Muted ${l}`)}catch{ie(`Unable to mute ${l}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Mute profile"})]})," ",e("button",{type:"submit",class:"plain2",disabled:o==="loading",onClick:async()=>{try{await s.v1.accounts.$select(t.id).block(),ie(`Blocked ${l}`)}catch{ie(`Unable to block ${l}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Block profile"})]}),e(Te,{hidden:o!=="loading"})]})]})]})]})}const vo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",ko="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",So="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",Io=200,Co=10;async function Wt(){const{masto:t}=K(),n=t.v1.followedTags.list({limit:Io}),i=[];let s=0;do{const{value:o,done:a}=await n.next();if(a||(o==null?void 0:o.length)===0)break;i.push(...o),s++}while(s<Co);return i.sort((o,a)=>o.name.localeCompare(a.name)),i.length&&setTimeout(()=>{we.account.set("followedTags",{tags:i,updatedAt:Date.now()})},1),i}const To=24*60*60*1e3;async function xo(){try{const{tags:t,updatedAt:n}=we.account.get("followedTags")||{};return t!=null&&t.length?(Date.now()-n>To&&Wt(),t):await Wt()}catch{return[]}}const zn=document.createElement("div"),Ao=t=>{if(!t)return[];if(t.indexOf("#")===-1)return[];zn.innerHTML=t;const n=zn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(i=>i.innerText.trim().replace(/^[^#]*#+/,"")):[]};function zt({children:t}){if(typeof t=="string")return t;const[n,i]=A("");return W(()=>{Promise.resolve(t).then(i)},[t]),n}const at=9,$o=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],Rs={following:"Home / Following",notifications:"Notifications",list:"Lists",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},Ht={list:[{text:"List ID",name:"id",notRequired:!0}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},_o=ut(async({id:t})=>{const n=await K().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),Kt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:({id:t})=>t?"list":"lists",title:({id:t})=>t?Gi(t):"Lists",path:({id:t})=>t?`/l/${t}`:"/l",icon:"list",excludeViewMode:({id:t})=>t?[]:["multi-column"]},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||K().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||K().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t?`“${t}”`:"Search",path:({query:t})=>t?`/search?q=${encodeURIComponent(t)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:t})=>t?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:_o,path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||K().instance,path:({hashtag:t,instance:n,media:i})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}${i?"?media=1":""}`,icon:"hashtag"}};function Ro({onClose:t}){const n=De(C),{shortcuts:i}=n,[s,o]=A(!1),[a,l]=A(!1),[u]=hn();return e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:vo},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:So},{value:"multi-column",label:"Multi-column",imgURL:ko}].map(({value:r,label:p,imgURL:f})=>{const c=n.settings.shortcutsViewMode===r||r==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:c?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:r,checked:c,onChange:d=>{C.settings.shortcutsViewMode=d.target.value}})," ",e("img",{src:f,alt:"",width:"80",height:"58"})," ",e("span",{children:p})]},r)})}),i.length>0?e(_,{children:[e("ol",{class:"shortcuts-list",ref:u,children:i.filter(Boolean).map((r,p)=>{const f=Object.values(r).join("-"),{type:c}=r;if(!Kt[c])return null;let{icon:d,title:h,subtitle:g,excludeViewMode:y}=Kt[c];typeof h=="function"&&(h=h(r,p)),typeof g=="function"&&(g=g(r,p)),typeof d=="function"&&(d=d(r,p)),typeof y=="function"&&(y=y(r,p));const k=y==null?void 0:y.includes(n.settings.shortcutsViewMode);return e("li",{children:[e(w,{icon:d}),e("span",{class:"shortcut-text",children:[e(zt,{children:h}),g&&e(_,{children:[" ",e("small",{class:"ib insignificant",children:g})]}),k&&e("span",{class:"tag",children:"Not available in current view mode"})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:p===0,onClick:()=>{const m=Array.from(C.shortcuts);if(p>0){const b=C.shortcuts[p-1];m[p-1]=r,m[p]=b,C.shortcuts=m}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:p===i.length-1,onClick:()=>{const m=Array.from(C.shortcuts);if(p<C.shortcuts.length-1){const b=C.shortcuts[p+1];m[p+1]=r,m[p]=b,C.shortcuts=m}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{o({shortcut:r,shortcutIndex:p})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},f)})}),i.length===1&&n.settings.shortcutsViewMode!=="float-button"&&e("div",{class:"ui-state insignificant",children:[e(w,{icon:"info"})," ",e("small",{children:"Add more than one shortcut/column to make this work."})]})]}):e("div",{class:"ui-state insignificant",children:[e("p",{children:n.settings.shortcutsViewMode==="multi-column"?"No columns yet. Tap on the Add column button.":"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:r=>{r.preventDefault(),C.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:i.length>=at&&(n.settings.shortcutsViewMode==="multi-column"?`Max ${at} columns`:`Max ${at} shortcuts`)}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>l(!0),children:"Import/export"}),e("button",{type:"button",disabled:i.length>=at,onClick:()=>o(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:n.settings.shortcutsViewMode==="multi-column"?"Add column…":"Add shortcut…"})]})]})]}),s&&e(Re,{onClick:r=>{r.target===r.currentTarget&&o(!1)},children:e(Eo,{shortcut:s.shortcut,shortcutIndex:s.shortcutIndex,onSubmit:({result:r,mode:p})=>{p==="edit"?C.shortcuts[s.shortcutIndex]=r:C.shortcuts.push(r)},onClose:()=>o(!1)})}),a&&e(Re,{onClick:r=>{r.target===r.currentTarget&&l(!1)},children:e(Lo,{shortcuts:i,onClose:()=>l(!1)})})]})}const Hn={list:"Specific list is optional. For multi-column mode, list is required, else the column will not be shown.",search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function Eo({onSubmit:t,disabled:n,shortcut:i,shortcutIndex:s,onClose:o}){var k,m;const a=!!i,[l,u]=A((i==null?void 0:i.type)||null),{masto:r}=K(),[p,f]=A("default"),[c,d]=A([]),[h,g]=A([]);W(()=>{(async()=>{if(l==="list")try{f("loading");const b=await Pt();d(b),f("default")}catch{f("error")}})(),(async()=>{if(l==="hashtag")try{const b=await Wt();g(b)}catch{}})()},[l]);const y=H();return W(()=>{if(a&&l&&Ht[l]){const b=y.current;Ht[l].forEach(({name:I,type:v})=>{const S=b.querySelector(`[name="${I}"]`);S&&i[I]&&(v==="checkbox"?S.checked=i[I]==="on":S.value=i[I])})}},[a,l]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[a?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:y,onSubmit:b=>{b.preventDefault();const I=new FormData(b.target),v={};I.forEach((S,T)=>{v[T]=S==null?void 0:S.trim(),T==="instance"&&(v[T]=v[T].replace(/^https?:\/\//,"").replace(/\/+$/,""),v[T]=v[T].replace(/^@?[^@]+@/,""))}),v.type&&(t({result:v,mode:a?"edit":"add"}),b.target.reset(),u(null),o==null||o())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:n,onChange:b=>{u(b.target.value)},defaultValue:a?i.type:void 0,name:"type",children:[e("option",{}),$o.map(b=>e("option",{value:b,children:Rs[b]}))]})]})}),(m=(k=Ht[l])==null?void 0:k.map)==null?void 0:m.call(k,({text:b,name:I,type:v,placeholder:S,pattern:T,notRequired:U})=>l==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!U,disabled:n||p==="loading",defaultValue:a?i.id:void 0,children:[e("option",{value:""}),c.map(V=>e("option",{value:V.id,children:V.title}))]})]})}):e("p",{children:e("label",{children:[e("span",{children:b})," ",e("input",{type:v,switch:v==="checkbox"||void 0,name:I,placeholder:S,required:v==="text"&&!U,disabled:n,list:l==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:T}),l==="hashtag"&&h.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:h.map(V=>e("option",{value:V.name}))})]})})),!!Hn[l]&&e("p",{class:"form-note insignificant",children:[e(w,{icon:"info"}),Hn[l]]}),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:n||p==="loading",children:a?"Save":"Add"}),a&&e("button",{type:"button",class:"light danger",onClick:()=>{C.shortcuts.splice(s,1),o==null||o()},children:"Remove"})]})]})})]})}function Lo({shortcuts:t,onClose:n}){var c;const{masto:i}=K(),s=be(()=>!t||!t.filter(Boolean).length?"":_n.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,a]=A(""),[l,u]=A("default"),r=be(()=>{if(!o)return u("default"),null;try{const d=JSON.parse(_n.decompressFromEncodedURIComponent(o));if(!Array.isArray(d))throw new Error("Not an array");return u("default"),d}catch{try{const h=JSON.parse(o);if(!Array.isArray(h))throw new Error("Not an array");return u("default"),h}catch{return u("error"),null}}},[o]),p=C.shortcuts.length>0,f=H();return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{class:"field-button",children:[e("input",{ref:f,type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:d=>{a(d.target.value)}}),C.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2 small",disabled:l==="cloud-downloading",onClick:async()=>{u("cloud-downloading");const d=it();ie("Downloading saved shortcuts from instance server…");try{const g=(await i.v1.accounts.relationships.fetch({id:[d]}))[0];if(g){const{note:y=""}=g;if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(y)){const k=y.match(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/)[1],{v:m,dt:b,data:I}=JSON.parse(k);f.current.value=I,f.current.dispatchEvent(new Event("input"))}}u("default")}catch{u("error"),ie("Unable to download shortcuts")}},title:"Download shortcuts from instance server",children:[e(w,{icon:"cloud"}),e(w,{icon:"arrow-down"})]})]}),!!r&&Array.isArray(r)&&e(_,{children:[e("p",{children:[e("b",{children:r.length})," shortcut",r.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:r.map(d=>{var h,g;return e("li",{children:[e("span",{style:{opacity:t.some(y=>Object.keys(y).every(k=>y[k]===d[k]))?1:0},children:"*"}),e("span",{children:[Rs[d.type],d.type==="list"&&" ⚠️"," ",(g=(h=Ht[d.type])==null?void 0:h.map)==null?void 0:g.call(h,({text:y,name:k,type:m})=>d[k]?e(_,{children:[e("span",{class:"tag collapsed insignificant",children:[y,":"," ",m==="checkbox"?d[k]==="on"?"✅":"❌":d[k]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),l==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[p&&e(_,{children:[e(Qe,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const d=r.filter(y=>!C.shortcuts.some(k=>Object.keys(k).every(m=>k[m]===y[m])));if(!d.length){ie("No new shortcuts to import");return}let h=[...C.shortcuts,...d];const g=h.length>at;g&&(h=h.slice(0,at)),C.shortcuts=h,ie(g?`Shortcuts imported. Exceeded max ${at}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:"Import & append…"})})," "]}),e(Qe,{confirmLabel:p?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:p?"danger":void 0,onClick:()=>{C.shortcuts=r,ie("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:p?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:s,readOnly:!0,onClick:d=>{if(d.target.value){d.target.select();try{navigator.clipboard.writeText(d.target.value),ie("Shortcuts copied")}catch{ie("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.clipboard.writeText(s),ie("Shortcut settings copied")}catch{ie("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((c=navigator==null?void 0:navigator.canShare)==null?void 0:c.call(navigator,{text:s}))&&e("button",{type:"button",class:"plain2",disabled:!s,onClick:()=>{try{navigator.share({text:s})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",C.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2",disabled:l==="cloud-uploading",onClick:async()=>{u("cloud-uploading");const d=it();try{const g=(await i.v1.accounts.relationships.fetch({id:[d]}))[0];if(g){const{note:y=""}=g;let k="";if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(y)){const m=JSON.stringify({v:"1",dt:Date.now(),data:s});k=y.replace(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/,`<phanpy-shortcuts-settings>${m}</phanpy-shortcuts-settings>`)}else k=`${y}


<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;ie("Saving shortcuts to instance server…"),await i.v1.accounts.$select(d).note.create({comment:k}),u("default"),ie("Shortcuts saved")}}catch{u("error"),ie("Unable to save shortcuts")}},title:"Sync to instance server",children:[e(w,{icon:"cloud"}),e(w,{icon:"arrow-up"})]})," ",s.length>0&&e("small",{class:"insignificant ib",children:[s.length," characters"]})]}),!!s&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]}),C.settings.shortcutSettingsCloudImportExport&&e("footer",{children:e("p",{children:[e(w,{icon:"cloud"})," Import/export settings from/to instance server (Very experimental)"]})})]})]})}const Mo=ei(()=>Ws(()=>import("./compose-5uxFFcOl.js"),__vite__mapDeps([0,1,2,3]),import.meta.url));us(C,t=>{for(const[n,i,s,o]of t)/^show/i.test(i)&&!s&&on()});function Po(){var s,o,a,l,u,r,p,f;const t=De(C),n=hs(),i=Tt();return e(_,{children:[!!t.showCompose&&e(Re,{class:"solid",children:e(Ks,{children:e(Mo,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((s=window.__COMPOSE__)==null?void 0:s.replyToStatus)||null,editStatus:((o=C.showCompose)==null?void 0:o.editStatus)||((a=window.__COMPOSE__)==null?void 0:a.editStatus)||null,draftStatus:((l=C.showCompose)==null?void 0:l.draftStatus)||((u=window.__COMPOSE__)==null?void 0:u.draftStatus)||null,onClose:c=>{const{newStatus:d,instance:h,type:g}=c||{};C.showCompose=!1,window.__COMPOSE__=null,d&&(C.reloadStatusPage++,ie({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[g||"post"],delay:1e3,duration:1e4,onClick:y=>{y.hideToast(),C.prevLocation=i,n(h?`/${h}/s/${d.id}`:`/s/${d.id}`)}}))}})})}),!!t.showSettings&&e(Re,{onClose:()=>{C.showSettings=!1},children:e(zi,{onClose:()=>{C.showSettings=!1}})}),!!t.showAccounts&&e(Re,{onClose:()=>{C.showAccounts=!1},children:e(Ei,{onClose:()=>{C.showAccounts=!1}})}),!!t.showAccount&&e(Re,{onClose:()=>{C.showAccount=!1},children:e(uo,{account:((r=t.showAccount)==null?void 0:r.account)||t.showAccount,instance:(p=t.showAccount)==null?void 0:p.instance,onClose:({destination:c}={})=>{C.showAccount=!1}})}),!!t.showDrafts&&e(Re,{onClose:()=>{C.showDrafts=!1},children:e(ho,{onClose:()=>C.showDrafts=!1})}),!!t.showMediaModal&&e(Re,{onClick:c=>{(c.target===c.currentTarget||c.target.classList.contains("media"))&&(C.showMediaModal=!1)},children:e(_s,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{C.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(Re,{onClose:()=>{C.showShortcutsSettings=!1},children:e(Ro,{onClose:()=>C.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(Re,{onClose:()=>{C.showGenericAccounts=!1},children:e(mo,{instance:t.showGenericAccounts.instance,excludeRelationshipAttrs:t.showGenericAccounts.excludeRelationshipAttrs,postID:t.showGenericAccounts.postID,onClose:()=>C.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(Re,{onClose:c=>{C.showMediaAlt=!1},children:e(go,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(f=t.showMediaAlt)==null?void 0:f.lang,onClose:()=>{C.showMediaAlt=!1}})}),!!t.showEmbedModal&&e(Re,{class:"solid",onClose:()=>{C.showEmbedModal=!1},children:e(fo,{html:t.showEmbedModal.html,url:t.showEmbedModal.url,width:t.showEmbedModal.width,height:t.showEmbedModal.height,onClose:()=>{C.showEmbedModal=!1}})}),!!t.showReportModal&&e(Re,{onClose:()=>{C.showReportModal=!1},children:e(wo,{account:t.showReportModal.account,post:t.showReportModal.post,onClose:()=>{C.showReportModal=!1}})})]})}function cn({accountID:t,onChange:n}){const{masto:i}=K(),[s,o]=A("default"),[a,l]=A(null),[u,r]=A(null),p=u!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:s==="loading"||p,onClick:()=>{o("loading"),l("accept"),(async()=>{try{const f=await i.v1.followRequests.$select(t).authorize();if(!(f!=null&&f.followedBy))throw new Error("Follow request not accepted");r(f),n()}catch{}o("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:s==="loading"||p,class:"light danger",onClick:()=>{o("loading"),l("reject"),(async()=>{try{const f=await i.v1.followRequests.$select(t).reject();if(f!=null&&f.followedBy)throw new Error("Follow request not rejected");r(f),n()}catch{o("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:p&&a?a==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(Te,{hidden:s!=="loading"})})]})}const qn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning",severed_relationships:"heart-break",moderation_warning:"alert",emoji_reaction:"emoji2","pleroma:emoji_reaction":"emoji2"};function Vn(t,n){let i,s;return typeof n=="string"?i=n:(i=n==null?void 0:n.url,s=n==null?void 0:n.staticUrl),i?e(_,{children:["reacted to your post with"," ",e(vi,{url:i,staticUrl:s,alt:t})]}):`reacted to your post with ${t}.`}const vt={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(_,{children:["reported ",t]}),severed_relationships:t=>e(_,{children:["Lost connections with ",e("i",{children:t}),"."]}),moderation_warning:e("b",{children:"Moderation warning"}),emoji_reaction:Vn,"pleroma:emoji_reaction":Vn},No={account_suspension:({from:t,targetName:n})=>e(_,{children:["An admin from ",e("i",{children:t})," has suspended ",e("i",{children:n}),", which means you can no longer receive updates from them or interact with them."]}),domain_block:({from:t,targetName:n,followersCount:i,followingCount:s})=>e(_,{children:["An admin from ",e("i",{children:t})," has blocked ",e("i",{children:n}),". Affected followers: ",i,", followings: ",s,"."]}),user_domain_block:({targetName:t,followersCount:n,followingCount:i})=>e(_,{children:["You have blocked ",e("i",{children:t}),". Removed followers: ",n,", followings: ",i,"."]})},Do={none:"Your account has received a moderation warning.",disable:"Your account has been disabled.",mark_statuses_as_sensitive:"Some of your posts have been marked as sensitive.",delete_statuses:"Some of your posts have been deleted.",sensitive:"Your posts will be marked as sensitive from now on.",silence:"Your account has been limited.",suspend:"Your account has been suspended."},tn=50;function Uo({notification:t,instance:n,isStatic:i,disableContextMenu:s}){var G,L,ee,q,E,P;const{id:o,status:a,account:l,report:u,event:r,moderation_warning:p,_accounts:f,_statuses:c}=t;let{type:d}=t;const h=(a==null?void 0:a.reblog)||a,g=h==null?void 0:h.id,y=it(),k=y===(l==null?void 0:l.id),m=(G=a==null?void 0:a.poll)==null?void 0:G.voted,b=!!(a!=null&&a.inReplyToAccountId)&&(a==null?void 0:a.inReplyToAccountId)!==y&&((L=a==null?void 0:a.account)==null?void 0:L.id)===y;let I=0,v=0;if(d==="favourite+reblog"){for(const N of f)(ee=N._types)!=null&&ee.includes("favourite")&&I++,(q=N._types)!=null&&q.includes("reblog")&&v++;!v&&I&&(d="favourite"),!I&&v&&(d="reblog")}let S;if(d==="poll"?S=vt[k?"poll-self":m?"poll-voted":"poll"]:d==="reblog"||d==="favourite"||d==="favourite+reblog"?(c==null?void 0:c.length)>1?S=vt[`${d}+account`]:b?S=vt[`${d}_reply`]:S=vt[d]:vt[d]?S=vt[d]:S=`[Unknown notification type: ${d}]`,typeof S=="function"){const N=(c==null?void 0:c.length)||(f==null?void 0:f.length);if(d==="admin.report"){const D=u==null?void 0:u.targetAccount;D&&(S=S(e(It,{account:D,showAvatar:!0})))}else if(d==="severed_relationships"){const D=r==null?void 0:r.targetName;D&&(S=S(D))}else if((d==="emoji_reaction"||d==="pleroma:emoji_reaction")&&t.emoji){const D=t.emoji_url||((P=(E=a==null?void 0:a.emojis)==null?void 0:E.find)==null?void 0:P.call(E,Q=>(Q==null?void 0:Q.shortcode)===t.emoji.replace(/^:/,"").replace(/:$/,"")));S=S(t.emoji,D)}else N&&(S=S(N))}if(d==="mention"&&!a)return null;const T=t.createdAt&&new Date(t.createdAt).toLocaleString(),U={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[d]||"Accounts",V=()=>{C.showGenericAccounts={heading:U,accounts:f,showReactions:d==="favourite+reblog",excludeRelationshipAttrs:d==="follow"?["followedBy"]:[],postID:We(g,n)}};return e("div",{class:`notification notification-${d}`,"data-notification-id":o,tabIndex:"0",children:[e("div",{class:`notification-type notification-${d}`,title:T,children:d==="favourite+reblog"?e(_,{children:[e(w,{icon:"rocket",size:"xl",alt:d,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:d,class:"favourite-icon"})]}):e(w,{icon:qn[d]||"notification",size:"xl",alt:d})}),e("div",{class:"notification-content",children:[d!=="mention"&&e(_,{children:[e("p",{children:[!/poll|update/i.test(d)&&e(_,{children:(f==null?void 0:f.length)>1?e(_,{children:[e("b",{tabIndex:"0",onClick:V,children:[e("span",{title:f.length,children:Ge(f.length)})," ","people"]})," "]}):l&&e(_,{children:[e(It,{account:l,showAvatar:!0})," "]})}),S,d==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(gt,{datetime:t.createdAt,format:"micro"})]})]}),d==="follow_request"&&e(cn,{accountID:l.id}),d==="severed_relationships"&&e("div",{children:[No[r.type]({from:n,...r}),e("br",{}),e("a",{href:`https://${n}/severed_relationships`,target:"_blank",rel:"noopener noreferrer",children:["Learn more ",e(w,{icon:"external",size:"s"})]}),"."]}),d==="moderation_warning"&&!!p&&e("div",{children:[Do[p.action],e("br",{}),e("a",{href:`/disputes/strikes/${p.id}`,target:"_blank",rel:"noopener noreferrer",children:["Learn more ",e(w,{icon:"external",size:"s"})]}),"."]})]}),(f==null?void 0:f.length)>1&&e("p",{class:"avatars-stack",children:[f.slice(0,tn).map(N=>e(_,{children:[e("a",{href:N.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:D=>{D.preventDefault(),C.showAccount=N},children:[e(tt,{url:N.avatarStatic,size:f.length<=10?"xxl":f.length<20?"xl":f.length<30?"l":f.length<40?"m":"s",alt:`${N.displayName} @${N.acct}`,squircle:N==null?void 0:N.bot},N.id),d==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:N._types.map(D=>e(w,{icon:qn[D],size:"s",class:`${D}-icon`}))})]},N.id)," "]},N.id)),e("button",{type:"button",class:"small plain",onClick:V,children:[f.length>tn&&`+${f.length-tn}`,e(w,{icon:"chevron-down"})]})]}),(c==null?void 0:c.length)>1&&e("ul",{class:"notification-group-statuses",children:c.map(N=>e("li",{children:e(Gn,{class:`status-link status-type-${d}`,to:n?`/${n}/s/${N.id}`:`/s/${N.id}`,children:e(Oe,{status:N,size:"s",previewMode:!0,allowContextMenu:!0})})},N.id))}),a&&(!(c!=null&&c.length)||(c==null?void 0:c.length)<=1)&&e(Gn,{class:`status-link status-type-${d}`,to:n?`/${n}/s/${g}`:`/s/${g}`,onContextMenu:s?void 0:N=>{const D=N.target.querySelector(".status");if(D){if(N.metaKey)return;N.preventDefault(),D.dispatchEvent(new MouseEvent("contextmenu",{clientX:N.clientX,clientY:N.clientY}))}},children:i?e(Oe,{status:h,size:"s",readOnly:!0,allowContextMenu:!0}):e(Oe,{statusID:g,size:"s",readOnly:!0,allowContextMenu:!0})})]})]})}function Gn(t){const n=ki();return e(oe,{...t,"data-read-more":"Read more →",ref:n})}const Xt=Je(Uo,(t,n)=>{var i,s;return((i=t.notification)==null?void 0:i.id)===((s=n.notification)==null?void 0:s.id)});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",t=>{const{type:n,id:i,accessToken:s}=(t==null?void 0:t.data)||{};n==="notification"&&(C.routeNotification={id:i,accessToken:s})});const Fo=Je(function(){if(!("serviceWorker"in navigator))return null;const n=De(C),{routeNotification:i}=n,{id:s,accessToken:o}=i||{},[a,l]=A(!1);rt(()=>{if(!s||!o)return;const{instance:r}=K(),{masto:p,instance:f}=K({accessToken:o}),c=r===f,d=o?Js(o):St();(async()=>{const h=await p.v1.notifications.$select(s).fetch();if(h&&d){const g=d.instanceURL,{type:y,status:k,account:m}=h,b=!!document.querySelector("#modal-container > *"),I=y==="follow"&&!!(m!=null&&m.id),v=!!(m!=null&&m.id),S=!!(k!=null&&k.id);I&&c?C.showAccount={account:m,instance:g}:b||!c||v&&S?l({id:s,account:d,notification:h,sameInstance:c}):S?location.hash=`/${r}/s/${k.id}`:I?location.hash=`/${r}/a/${m.id}`:location.hash="/notifications"}})()},[s,o]),rt(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),Ct(r=>{r&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const u=()=>{l(!1),C.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(a){const{id:r,account:p,notification:f,sameInstance:c}=a;return e(Re,{onClick:d=>{d.target===d.currentTarget&&u()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:u,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!c&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:d=>{const{target:h}=d;(d.target.tagName==="BUTTON"||d.target.tagName==="A")&&u()},children:e(Xt,{instance:p.instanceURL,notification:f,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(oe,{to:"/notifications",class:"button light",onClick:u,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null}),Es=ni((t,n)=>{const{instance:i}=K(),[s,o]=nt(),[a,l]=A(!1),[u,r]=A(s.get("q")||""),p=s.get("type"),f=H(null),c=H(null);return ti(n,()=>({setValue:d=>{r(d)},focus:()=>{c.current.focus()},select:()=>{c.current.select()},blur:()=>{c.current.blur()}})),e("form",{ref:f,class:"search-popover-container",onSubmit:d=>{var g;if(d.preventDefault(),/\/search/.test(location.hash))if(u){const y={q:u};p&&(y.type=p),o(y)}else o({});else u?location.hash=`/search?q=${encodeURIComponent(u)}${p?`&type=${p}`:""}`:location.hash="/search";(g=t==null?void 0:t.onSubmit)==null||g.call(t,d)},children:[e("input",{ref:c,value:u,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellCheck:"false",onSearch:d=>{d.target.value||o({})},onInput:d=>{r(d.target.value),l(!0)},onFocus:()=>{var d,h;l(!0),(h=(d=f.current)==null?void 0:d.querySelector(".search-popover-item"))==null||h.classList.add("focus")},onBlur:()=>{var d,h;setTimeout(()=>{l(!1)},100),(h=(d=f.current)==null?void 0:d.querySelector(".search-popover-item.focus"))==null||h.classList.remove("focus")},onKeyDown:d=>{var g;const{key:h}=d;switch(h){case"Escape":l(!1);break;case"Down":case"ArrowDown":if(d.preventDefault(),a){const y=f.current.querySelector(".search-popover-item.focus");if(y){let k=y.nextElementSibling;for(;k&&k.hidden;)k=k.nextElementSibling;k&&(k.classList.add("focus"),Array.from(k.parentElement.children).filter(b=>b!==k).forEach(b=>{b.classList.remove("focus")}))}else{const k=f.current.querySelector(".search-popover-item");k&&k.classList.add("focus")}}break;case"Up":case"ArrowUp":if(d.preventDefault(),a){const y=document.querySelector(".search-popover-item.focus");if(y){let k=y.previousElementSibling;for(;k&&k.hidden;)k=k.previousElementSibling;k&&(k.classList.add("focus"),Array.from(k.parentElement.children).filter(b=>b!==k).forEach(b=>{b.classList.remove("focus")}))}else{const k=document.querySelector(".search-popover-item:last-child");k&&k.classList.add("focus")}}break;case"Enter":if(a){const y=document.querySelector(".search-popover-item.focus");y&&(d.preventDefault(),y.click()),l(!1),(g=t==null?void 0:t.onSubmit)==null||g.call(t,d)}break}}}),e("div",{class:"search-popover",hidden:!a||!u,children:!!u&&[{label:e(_,{children:[u," ",e("small",{class:"insignificant",children:"‒ accounts, hashtags & posts"})]}),to:`/search?q=${encodeURIComponent(u)}`,top:!p&&!/\s/.test(u),hidden:!!p},{label:e(_,{children:["Posts with ",e("q",{children:u})]}),to:`/search?q=${encodeURIComponent(u)}&type=statuses`,hidden:/^https?:/.test(u),top:/\s/.test(u),icon:"document",queryType:"statuses"},{label:e(_,{children:["Posts tagged with ",e("mark",{children:["#",u.replace(/^#/,"")]})]}),to:`/${i}/t/${u.replace(/^#/,"")}`,hidden:/^@/.test(u)||/^https?:/.test(u)||/\s/.test(u),top:/^#/.test(u),type:"link",icon:"hashtag",queryType:"hashtags"},{label:e(_,{children:["Look up ",e("mark",{children:u})]}),to:`/${u}`,hidden:!/^https?:/.test(u),top:/^https?:/.test(u),type:"link"},{label:e(_,{children:["Accounts with ",e("q",{children:u})]}),to:`/search?q=${encodeURIComponent(u)}&type=accounts`,icon:"group",queryType:"accounts"}].sort((d,h)=>{if(p){if(d.queryType===p)return-1;if(h.queryType===p)return 1}return d.top&&!h.top?-1:!d.top&&h.top?1:0}).filter(({hidden:d})=>!d).map(({label:d,to:h,icon:g,type:y},k)=>e(oe,{to:h,class:`search-popover-item ${k===0?"focus":""}`,onClick:m=>{var b;(b=t==null?void 0:t.onSubmit)==null||b.call(t,m)},children:[e(w,{icon:g||(y==="link"?"arrow-right":"search"),class:"more-insignificant"}),e("span",{children:d})," "]}))})]})}),Oo=Je(function({onClose:n=()=>{}}){const[i,s]=A(!1),o=H(null);Me(["Slash","/"],l=>{s(!0),setTimeout(()=>{var u,r,p,f;(r=(u=o.current)==null?void 0:u.focus)==null||r.call(u),(f=(p=o.current)==null?void 0:p.select)==null||f.call(p)},0)},{preventDefault:!0,ignoreEventWhen:l=>{const u=/\/search/.test(location.hash),r=!!document.querySelector("#modal-container > *");return u||r}});const a=()=>{s(!1),n()};return Me("esc",l=>{var u,r;(r=(u=o.current)==null?void 0:u.blur)==null||r.call(u),a()},{enabled:i,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!i,onClick:l=>{l.target===l.currentTarget&&a()},children:e(Es,{ref:o,onSubmit:()=>{a()}})})});function Bo(){const{instance:t}=K(),n=De(C),{shortcuts:i,settings:s}=n;if(!i.length||s.shortcutsViewMode==="multi-column"||!s.shortcutsViewMode&&s.shortcutsColumnsMode)return null;const o=H(),a=H(!1),l=i.map((f,c)=>{const{type:d,...h}=f;if(!Kt[d])return null;let{id:g,path:y,title:k,subtitle:m,icon:b}=Kt[d];return typeof g=="function"&&(g=g(h,c)),typeof y=="function"&&(y=y({...h,instance:h.instance||t},c)),typeof k=="function"&&(k=k(h,c)),typeof m=="function"&&(m=m(h,c)),typeof b=="function"&&(b=b(h,c)),g==="lists"&&(a.current=!0),{id:g,path:y,title:k,subtitle:m,icon:b}}).filter(Boolean),u=hs();Me(["1","2","3","4","5","6","7","8","9"],(f,c)=>{var h,g;const d=parseInt(c.keys[0],10)-1;if(d<l.length){const{path:y}=l[d];y&&(u(y),(g=(h=o.current)==null?void 0:h.closeMenu)==null||g.call(h))}});const[r,p]=A([]);return e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",onContextMenu:f=>{f.preventDefault(),C.showShortcutsSettings=!0},children:e("ul",{children:l.map(({id:f,path:c,title:d,subtitle:h,icon:g},y)=>e("li",{children:e(oe,{class:h?"has-subtitle":"",to:c,onClick:k=>{if(k.target.classList.contains("is-active")){k.preventDefault();const m=document.getElementById(`${f}-page`);if(m){m.scrollTop=0;const b=m.querySelector(".updates-button");b&&b.click()}}},children:[e(w,{icon:g,size:"xl",alt:d}),e("span",{children:[e(zt,{children:d}),h&&e(_,{children:[e("br",{}),e("small",{children:h})]})]})]})},`${y}-${f}-${d}-${h}-${c}`))})}):e(Ke,{instanceRef:o,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",onMenuChange:f=>{f.open&&a.current&&Pt().then(p)},menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:f=>{f.preventDefault(),C.showShortcutsSettings=!0},onTransitionStart:f=>{var c,d;try{const{target:h}=f;getComputedStyle(h).pointerEvents==="none"&&((d=(c=o.current)==null?void 0:c.closeMenu)==null||d.call(c))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:l.map(({id:f,path:c,title:d,subtitle:h,icon:g},y)=>f==="lists"?e(jt,{menuClassName:"glass-menu",overflow:"auto",gap:-8,label:e(_,{children:[e(w,{icon:g,size:"l"}),e("span",{class:"menu-grow",children:e(zt,{children:d})}),e(w,{icon:"chevron-right"})]}),children:[e(Le,{to:"/l",children:e("span",{children:"All Lists"})}),e(Fe,{}),r==null?void 0:r.map(k=>e(Le,{to:`/l/${k.id}`,children:e("span",{children:k.title})},k.id))]}):e(Le,{to:c,class:"glass-menu-item",children:[e(w,{icon:g,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(zt,{children:d})}),h&&e(_,{children:[" ",e("small",{class:"more-insignificant",children:h})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:y+1})]},`${y}-${f}-${d}-${h}-${c}`))})})}const zo=Je(Bo);function Ho(t){var o;let n=[],i=[],s=0;for(let a=0;a<t.length;a++){const l=t[a];l.reblog&&!((o=l.account)!=null&&o.group)?(i.push(l),s++):(n.push(l),s<3&&(s=0))}if(t.length>10&&(i.length>t.length/4||s>=3)){const a=i.map(l=>l.id);if(i.length>t.length*3/4)n=[...n,{id:a,items:i,type:"boosts"}];else{const l=Math.floor(n.length/2);n=[...n.slice(0,l),{id:a,items:i,type:"boosts"},...n.slice(l)]}return n}else return t}function Yn(t,n){const i=we.account.get("boostedStatusIDs")||{},s=t.filter(a=>{if(!a.reblog)return!0;const l=`${n}-${a.reblog.id}`,u=i[l];return u&&u!==a.id?!1:(i[l]=a.id,!0)}),o=Object.keys(i);return o.length>50&&o.slice(0,o.length-50).forEach(a=>{delete i[a]}),we.account.set("boostedStatusIDs",i),s}function qo(t,n){const i=[];let s=0;t.forEach(l=>{for(let r=0;r<i.length;r++){if(i[r].find(p=>p.id===l.id))return;if(i[r].find(p=>p.id===l.inReplyToId)||i[r].find(p=>p.inReplyToId===l.id)){i[r].push(l);return}}const u=t.find(r=>r.id===l.inReplyToId);u&&(i[s++]=[l,u])});for(let l=0;l<i.length;l++)for(let u=l+1;u<i.length;u++)i[l].find(p=>i[u].includes(p))&&(i[l]=[...i[l],...i[u]],i[l]=i[l].filter((p,f,c)=>c.findIndex(d=>d.id===p.id)===f),i.splice(u,1),u--);i.forEach(l=>{l.sort((u,r)=>!u.inReplyToId&&!r.inReplyToId?new Date(u.createdAt)-new Date(r.createdAt):u.inReplyToId===r.id?1:r.inReplyToId===u.id||!u.inReplyToId?-1:r.inReplyToId?new Date(u.createdAt)-new Date(r.createdAt):1)}),i.forEach(l=>{const u=l[0].account.id;l.forEach(r=>{r.account.id!==u&&(r._differentAuthor=!0)})}),i.length;const o=[],a=[];return t.forEach(l=>{if(l.reblog){o.push(l);return}for(let u=0;u<i.length;u++)if(i[u].find(r=>r.id===l.id)){if(a.includes(u))return;const r=i[u];r.sort((f,c)=>{const d=new Date(f.createdAt),h=new Date(c.createdAt);return d-h});const p=r[0].account.id;o.push({id:r.map(f=>f.id),items:r,type:r.every(f=>f.account.id===p)?"thread":"conversation"}),a.push(u);return}if(l.inReplyToId&&l.inReplyToAccountId!==l.account.id){const u=We(l.id,n);C.statusReply[u]||queueMicrotask(async()=>{try{const{masto:r}=K({instance:n}),p=await Vo(l.inReplyToId,r);ze(p,n,{skipThreading:!0,skipUnfurling:!0}),C.statusReply[u]={id:p.id,instance:n}}catch{}})}o.push(l)}),o}const Vo=ut((t,n)=>n.v1.statuses.$select(t).fetch());async function Ls(t,n){const i=await xo();if(!i.length)return;const{statusFollowedTags:s}=C,o=[];if(t.forEach(a=>{var d;if(a.reblog)return;const{id:l,content:u,tags:r=[]}=a,p=We(l,n);if((d=s[p])!=null&&d.length)return;const f=Ao(u);if(!f.length&&!r.length)return;const c=i.reduce((h,g)=>((f.some(y=>y.toLowerCase()===g.name.toLowerCase())||r.some(y=>y.name.toLowerCase()===g.name.toLowerCase()))&&h.push(g.name),h),[]);c.length&&o.push({item:a,sKey:p,followedTags:c})}),o.length){const a=o.map(u=>u.item.account),l=await vn(a);if(!l)return;o.forEach(u=>{const{item:r,sKey:p,followedTags:f}=u,c=l[r.account.id];c&&!c.following&&(s[p]=f)})}}function Go(){C.statusFollowedTags={}}function Yo({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:s=10,scrollThresholdEnd:o=10,direction:a="vertical",distanceFromStartPx:l,distanceFromEndPx:u}={}){const[r,p]=A(null),[f,c]=A(!1),[d,h]=A(!1),[g,y]=A(!1),[k,m]=A(!1),b=a==="vertical";return rt(()=>{const I=t.current;if(!I)return{};let v=b?I.scrollTop:I.scrollLeft;function S(){const{scrollTop:T,scrollLeft:U,scrollHeight:V,scrollWidth:G,clientHeight:L,clientWidth:ee}=I,q=b?T:U,E=b?V:G,P=b?L:ee,N=Math.abs(q-v),D=l||Math.min(P*n,E,q),Q=u||Math.min(P*i,E,E-q-P);N>=(v<q?o:s)&&(p(v<q?"end":"start"),v=q),c(q<=0),h(q+P>=E),y(q<=D),m(q+P>=E-Q)}return I.addEventListener("scroll",S,{passive:!0}),()=>I.removeEventListener("scroll",S)},[n,i,s,o]),{scrollDirection:r,reachStart:f,reachEnd:d,nearReachStart:g,nearReachEnd:k,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function jo({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:i=1,scrollThresholdStart:s=10,scrollThresholdEnd:o=10,direction:a="vertical",distanceFromStartPx:l,distanceFromEndPx:u,init:r}={},p,f){if(!p)return;const c=a==="vertical",d=H(null),h=H(null),g=si(()=>{let y=!1,k=!1,m=!1,b=!1;const I=t.current,{scrollTop:v,scrollLeft:S,scrollHeight:T,scrollWidth:U,clientHeight:V,clientWidth:G}=I,L=c?v:S,ee=c?T:U,q=c?V:G,E=Math.abs(L-d.current),P=l||Math.min(q*n,ee,L),N=u||Math.min(q*i,ee,ee-L-q);E>=(d.current<L?o:s)&&(h.current=d.current<L?"end":"start",d.current=L),y=L<=0,k=L+q>=ee,m=L<=P,b=L+q>=ee-N,p({scrollDirection:h.current,reachStart:y,reachEnd:k,nearReachStart:m,nearReachEnd:b})},500);rt(()=>{const y=t.current;return y?(d.current=y[c?"scrollTop":"scrollLeft"],y.addEventListener("scroll",g,{passive:!0}),()=>y.removeEventListener("scroll",g)):{}},[n,i,s,o,...f]),W(()=>{r&&t.current&&queueMicrotask(()=>{t.current.dispatchEvent(new Event("scroll"))})},[r])}function Wo({class:t,statusID:n,status:i,instance:s,parent:o,onMediaClick:a}){let l=We(n,s);const u=De(C);if(i||(i=u.statuses[l]||u.statuses[n],l=We(i==null?void 0:i.id,s)),!i)return null;const{account:{acct:r,avatar:p,avatarStatic:f,id:c,url:d,displayName:h,username:g,emojis:y,bot:k,group:m},id:b,repliesCount:I,reblogged:v,reblogsCount:S,favourited:T,favouritesCount:U,bookmarked:V,poll:G,muted:L,sensitive:ee,spoilerText:q,visibility:E,language:P,editedAt:N,filtered:D,card:Q,createdAt:he,inReplyToId:Ie,inReplyToAccountId:ae,content:se,mentions:fe,mediaAttachments:ce,reblog:ye,uri:Se,url:Ce,emojis:Be,_deleted:Pe,_pinned:Ee}=i;if(!(ce!=null&&ce.length))return null;const Ne=te=>{te.shiftKey},j=be(()=>it(),[]),le=be(()=>j&&j===c,[c,j]),ne=ii(ks),re=!le&&Mt(D,ne);if((re==null?void 0:re.action)==="hide")return null;const xe=ee,R=be(()=>(we.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",J=o||"div";return ce.map((te,M)=>{const Y=`${l}-${te.id}`,X=re==null?void 0:re.titlesStr;return e(J,{"data-state-post-id":l,onMouseEnter:Ne,"data-spoiler-text":q||(ee?"Sensitive media":void 0),"data-filtered-text":re?`Filtered${X?`: ${X}`:""}`:void 0,class:`
          media-post
          ${re?"filtered":""}
          ${xe?"has-spoiler":""}
          ${R?"show-media":""}
        `,children:e(vs,{class:t,media:te,lang:P,to:`/${s}/s/${b}?media-only=${M+1}`,onClick:a?ke=>a(ke,M,te,i):void 0})},Y)})}const jn=Je(Wo);function Ko(t){var S,T,U,V,G;const n=De(C),{masto:i,instance:s,authenticated:o}=K(),[a,l]=be(()=>{const L=we.local.getJSON("accounts")||[];return[L.find(q=>q.info.id===it())||L[0],L.length>1]},[]),u=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(L=>L.type==="following"),r=oi(()=>{C.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),p=H(),[f,c]=A(void 0),d=Si([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),h=H();async function g(L){return(L||!h.current)&&(h.current=i.v1.mutes.list({limit:80})),await h.current.next()}const y=H();async function k(L){return(L||!y.current)&&(y.current=i.v1.blocks.list({limit:80})),await y.current.next()}const m=st("@mastodon/lists"),[b,I]=A([]);W(()=>{m&&f==="open"&&Pt().then(I)},[f==="open"]);const v=H();return e(_,{children:[e("button",{ref:p,type:"button",class:`button plain nav-menu-button ${l?"with-avatar":""} ${f==="open"?"active":""}`,style:{position:"relative"},onClick:()=>{v.current=Date.now(),c(L=>L?void 0:"open")},onContextMenu:L=>{L.preventDefault(),C.showAccounts=!0},...r(),children:[l&&e(tt,{url:((S=a==null?void 0:a.info)==null?void 0:S.avatar)||((T=a==null?void 0:a.info)==null?void 0:T.avatarStatic),size:"l",squircle:(U=a==null?void 0:a.info)==null?void 0:U.bot}),e(w,{icon:"menu",size:l?"s":"l"})]}),e(ps,{menuClassName:"nav-menu",state:f,anchorRef:p,onClose:()=>{c(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-v.current<300}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:d,unmountOnClose:!0,children:[!!((V=n.appVersion)!=null&&V.commitHash)&&n.appVersion.commitHash!=="6fec85a"&&e("div",{class:"top-menu",children:[e(pe,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(Fe,{})]}),e("section",{children:[e(Le,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),o?e(_,{children:[u&&e(Le,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Le,{to:"/catchup",children:[e(w,{icon:"history2",size:"l"}),e("span",{children:"Catch-up"})]}),st("@mastodon/mentions")&&e(Le,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Le,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(Fe,{}),((G=a==null?void 0:a.info)==null?void 0:G.id)&&e(Le,{to:`/${s}/a/${a.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),(b==null?void 0:b.length)>0?e(jt,{menuClassName:"nav-submenu",overflow:"auto",gap:-8,label:e(_,{children:[e(w,{icon:"list",size:"l"}),e("span",{class:"menu-grow",children:"Lists"}),e(w,{icon:"chevron-right"})]}),children:[e(Le,{to:"/l",children:e("span",{children:"All Lists"})}),(b==null?void 0:b.length)>0&&e(_,{children:[e(Fe,{}),b.map(L=>e(Le,{to:`/l/${L.id}`,children:e("span",{children:L.title})},L.id))]})]}):m&&e(Le,{to:"/l",children:[e(w,{icon:"list",size:"l"}),e("span",{children:"Lists"})]}),e(Le,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(jt,{menuClassName:"nav-submenu",overflow:"auto",gap:-8,label:e(_,{children:[e(w,{icon:"more",size:"l"}),e("span",{class:"menu-grow",children:"More…"}),e(w,{icon:"chevron-right"})]}),children:[e(Le,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]}),e(Le,{to:"/fh",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Fe,{}),st("@mastodon/filters")&&e(Le,{to:"/ft",children:[e(w,{icon:"filters",size:"l"}),"Filters"]}),e(pe,{onClick:()=>{C.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:g,excludeRelationshipAttrs:["muting"]}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(pe,{onClick:()=>{C.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:k,excludeRelationshipAttrs:["blocking"]}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]})," "]}),e(Fe,{}),e(pe,{onClick:()=>{C.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]})]}):e(_,{children:[e(Fe,{}),e(Le,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]})]})]}),e("section",{children:[e(Fe,{}),e(Le,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Le,{to:`/${s}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]}),e(Le,{to:`/${s}/p/l`,children:[e(w,{icon:"building",size:"l"})," ",e("span",{children:"Local"})]}),e(Le,{to:`/${s}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),o?e(_,{children:[e(Fe,{className:"divider-grow"}),e(pe,{onClick:()=>{C.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(pe,{onClick:()=>{C.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(pe,{onClick:()=>{C.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(_,{children:[e(Fe,{}),e(pe,{onClick:()=>{C.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})]})]})]})}const bt=Je(Ko),Dt={block:"nearest",inline:"center",behavior:"smooth"};function lt({title:t,titleComponent:n,id:i,instance:s,emptyText:o,errorText:a,useItemID:l,boostsCarousel:u,fetchItems:r=()=>{},checkForUpdates:p=()=>{},checkForUpdatesInterval:f=15e3,headerStart:c,headerEnd:d,timelineStart:h,refresh:g,view:y,filterContext:k,showFollowedTags:m,showReplyParent:b}){const I=De(C),[v,S]=A([]),[T,U]=A("start"),[V,G]=A(!1),[L,ee]=A(!1),[q,E]=A(!0),P=H(),N=be(()=>un(),[]),D=y!=="media",Q=ai(j=>{ee(!1),T!=="loading"&&(U("loading"),(async()=>{try{let{done:le,value:ne}=await r(j);if(Array.isArray(ne)){const[re,xe]=ne.reduce((F,R)=>(R._pinned?F[0].push(R):F[1].push(R),F),[[],[]]);ne=xe,D&&(u&&(ne=Ho(ne)),ne=qo(ne,s)),re.length&&(ne=re.concat(ne)),S(j?ne:F=>[...F,...ne]),ne.length||(le=!0),G(!le)}else G(!1);U("default")}catch{U("error")}finally{Q.cancel()}})())},1500,{leading:!0,trailing:!1}),he=".timeline-item, .timeline-item-alt",Ie=Me("j, shift+j",(j,le)=>{const ne=document.activeElement.closest(he),re=ne==null?void 0:ne.getBoundingClientRect(),xe=Array.from(P.current.querySelectorAll(he));if(ne&&re.top<P.current.clientHeight&&re.bottom>0){const F=xe.indexOf(ne);let R=xe[F+1];le.shift&&(R=xe.find((J,te)=>te>F&&!J.classList.contains("timeline-item-alt"))),R&&(R.focus(),R.scrollIntoView(Dt))}else{const F=xe.find(R=>{const J=R.getBoundingClientRect();return J.top>=44&&J.left>=0});F&&(F.focus(),F.scrollIntoView(Dt))}}),ae=Me("k, shift+k",(j,le)=>{const ne=document.activeElement.closest(he),re=ne==null?void 0:ne.getBoundingClientRect(),xe=Array.from(P.current.querySelectorAll(he));if(ne&&re.top<P.current.clientHeight&&re.bottom>0){const F=xe.indexOf(ne);let R=xe[F-1];le.shift&&(R=xe.findLast((J,te)=>te<F&&!J.classList.contains("timeline-item-alt"))),R&&(R.focus(),R.scrollIntoView(Dt))}else{const F=xe.find(R=>{const J=R.getBoundingClientRect();return J.top>=44&&J.left>=0});F&&(F.focus(),F.scrollIntoView(Dt))}}),se=Me(["enter","o"],()=>{const j=document.activeElement;j!=null&&j.matches(he)&&j.click()}),fe=v.length>0&&T!=="loading"&&L,ce=Ze(()=>{var j;fe&&Q(!0),(j=P.current)==null||j.scrollTo({top:0,behavior:"smooth"})},[Q,fe]),ye=Me(".",ce),Se=H(),[Ce,Be]=A(!1);jo({scrollableRef:P,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:j,nearReachStart:le,reachStart:ne})=>{if(Se.current){const re=j==="end"&&!le;Se.current.hidden=re}Be(le),ne&&Q(!0)},[]),W(()=>{var j;(j=P.current)==null||j.scrollTo({top:0}),Q(!0)},[]),W(()=>{Q(!0)},[g]);const Pe=H(y);W(()=>{Pe.current!==y&&(Pe.current=y,S([]))},[y]);const Ee=Ze(async({disableIdleCheck:j=!1}={})=>{const le=P.current?getComputedStyle(P.current).pointerEvents==="none":!1;I.settings.autoRefresh&&P.current.scrollTop<16&&(j||window.__IDLE__)&&!Qo()&&!le?Q(!0):await p()&&ee(!0)},[i,Q,p,I.settings.autoRefresh]),Ne=H();return Ct(j=>{if(j){const le=Date.now()-Ne.current;(!Ne.current||le>1e3*3)&&Ee({disableIdleCheck:!0})}else Ne.current=Date.now();E(j)},[p,Ee,I.settings.autoRefresh]),mn(Ee,q&&!L?f*(Ce?1:2):null),e(ks.Provider,{value:k,children:e("div",{id:`${i}-page`,class:`deck-container ${N?"deck-container-media-first":""}`,ref:j=>{P.current=j,Ie.current=j,ae.current=j,se.current=j,ye.current=j},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{ref:Se,onClick:j=>{var le;j.target.closest("a, button")||(le=P.current)==null||le.scrollTo({top:0,behavior:"smooth"})},onDblClick:j=>{j.target.closest("a, button")||Q(!0)},class:T==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),c??e(oe,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!d&&d})]}),fe&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:ce,children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!h&&e("div",{class:`timeline-start ${T==="loading"?"loading":""}`,children:h}),v.length?e(_,{children:[e("ul",{class:`timeline ${y?`timeline-${y}`:""}`,children:[v.map(j=>e(Jo,{status:j,instance:s,useItemID:l,filterContext:k,view:y,showFollowedTags:m,showReplyParent:b,mediaFirst:N},j.id+(j==null?void 0:j._pinned)+y)),V&&T==="loading"&&(y==="media"?null:e(_,{children:[e("li",{style:{height:"20vh"},children:e(Oe,{skeleton:!0,mediaFirst:N})}),e("li",{style:{height:"25vh"},children:e(Oe,{skeleton:!0,mediaFirst:N})})]}))]}),T==="default"&&(V?e(ct,{root:P.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:j=>{j&&Q()},children:e("button",{type:"button",class:"plain block",onClick:()=>Q(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):T==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((j,le)=>y==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e(Oe,{skeleton:!0,mediaFirst:N})},le))}):T!=="error"&&T!=="start"&&e("p",{class:"ui-state",children:o}),T==="error"&&e("p",{class:"ui-state",children:[a,e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>Q(!v.length),children:"Try again"})]})]})})})}const Jo=Je(({status:t,instance:n,useItemID:i,filterContext:s,view:o,showFollowedTags:a,showReplyParent:l,mediaFirst:u})=>{const{id:r,reblog:p,items:f,type:c,_pinned:d}=t;d&&(i=!1);const h=(p==null?void 0:p.id)||r,g=n?`/${n}/s/${h}`:`/s/${h}`;if(f){const k=At(f,s);let m="";if(c==="boosts"?m=`${k.length} Boosts`:c==="pinned"&&(m="Pinned posts"),c==="boosts"||c==="pinned")return k.sort((v,S)=>{const T=Mt(v.filtered,s),U=Mt(S.filtered,s);return T&&!U?1:!T&&U?-1:0}),e("li",{class:"timeline-item-carousel",children:e(Xo,{title:m,class:`${c}-carousel`,children:k.map(v=>{const{id:S,reblog:T,_pinned:U}=v,V=(T==null?void 0:T.id)||S,G=n?`/${n}/s/${V}`:`/s/${V}`;return U&&(i=!1),e("li",{children:e(oe,{class:"status-carousel-link timeline-item-alt",to:G,children:i?e(Oe,{statusID:S,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0,mediaFirst:u}):e(Oe,{status:v,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0,mediaFirst:u})})},S)})})},`timeline-${r}`);const I=k.length>3;return k.map((v,S)=>{const{id:T,_differentAuthor:U}=v,V=n?`/${n}/s/${T}`:`/s/${T}`,G=S>0&&S<k.length-1,L=v.sensitive&&!!v.spoilerText,ee=!U&&L&&S>0||I&&G&&(c==="thread"||c==="conversation"&&!U&&!k[S-1]._differentAuthor&&!k[S+1]._differentAuthor),q=S===0,E=S===k.length-1;return e("li",{class:`timeline-item-container timeline-item-container-type-${c} timeline-item-container-${q?"start":E?"end":"middle"} ${U?"timeline-item-diff-author":""}`,children:e(oe,{class:"status-link timeline-item",to:V,children:ee?e(Zo,{status:v,instance:n,filterContext:s}):i?e(Oe,{statusID:T,instance:n,enableCommentHint:E,showFollowedTags:a}):e(Oe,{status:v,instance:n,enableCommentHint:E,showFollowedTags:a})})},`timeline-${T}`)})}const y=`timeline-${r+d}`;return o==="media"?i?e(jn,{class:"timeline-item",parent:"li",statusID:r,instance:n},y):e(jn,{class:"timeline-item",parent:"li",status:t,instance:n},y):e("li",{children:e(oe,{class:"status-link timeline-item",to:g,children:i?e(Oe,{statusID:r,instance:n,enableCommentHint:!0,showFollowedTags:a,showReplyParent:l,mediaFirst:u}):e(Oe,{status:t,instance:n,enableCommentHint:!0,showFollowedTags:a,showReplyParent:l,mediaFirst:u})})},y)},(t,n)=>{var o,a;const i=(((o=t.status)==null?void 0:o.id)||"").toString(),s=(((a=n.status)==null?void 0:a.id)||"").toString();return i===s&&t.instance===n.instance&&t.view===n.view});function Xo({title:t,class:n,children:i}){const s=H(),o=H(),a=H(),[l,u]=A(!1);return W(()=>{setTimeout(()=>{u(!0)},1)},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{ref:o,type:"button",class:"small plain2",onClick:()=>{var r,p;(p=s.current)==null||p.scrollBy({left:-Math.min(320,(r=s.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{ref:a,type:"button",class:"small plain2",onClick:()=>{var r,p;(p=s.current)==null||p.scrollBy({left:Math.min(320,(r=s.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:s,children:[e(ct,{class:"status-carousel-beacon",onChange:r=>{o.current&&(o.current.disabled=r)}}),i[0],l&&i.slice(1),e(ct,{class:"status-carousel-beacon",onChange:r=>{a.current&&(a.current.disabled=r)}})]})]})}function Zo({status:t,instance:n,filterContext:i}){const s=De(C),{id:o,visibility:a,language:l}=t,u=gn(t),r=We(o,n),p=Mt(t.filtered,i);return e("article",{class:`status compact-thread ${a==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[s.statusThreadNumber[r]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),s.statusThreadNumber[r]?` ${s.statusThreadNumber[r]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:u,lang:l,dir:"auto",children:p?e("b",{class:"status-filtered-badge badge-meta horizontal",title:(p==null?void 0:p.titlesStr)||"",children:[e("span",{children:"Filtered"}),": ",e("span",{children:(p==null?void 0:p.titlesStr)||""})]}):e(_,{children:[u,t.sensitive&&t.spoilerText&&e(_,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})})]})}function Qo(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const kt=20,In=1983,Wn=`${In}-01`,ea=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function ta(t){var s;const{masto:n}=K({instance:t}),i=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((s=i==null?void 0:i.statuses)!=null&&s.length)}const na=ut(ta);function sa(){const t=De(C),{id:n,...i}=mt(),[s,o]=nt(),a=s.get("month"),l=!s.get("replies"),u=!!s.get("boosts"),r=s.get("tagged"),p=!!s.get("media"),{masto:f,instance:c,authenticated:d}=K({instance:i.instance}),{masto:h,instance:g}=K(),y=H(),k=[a,l,u,r,p],[m,b]=A(),I=H(0);W(()=>{I.current=0},k);const v=be(()=>un(),[]),S=be(()=>c===g,[c,g]),[T,U]=A(!1);W(()=>{S&&m!=null&&m.acct&&(async()=>{const se=await na(c);U(se)})()},[c,S,m==null?void 0:m.acct]);async function V(se){var Be,Pe,Ee,Ne;const fe=/^\d{4}-[01]\d$/.test(a),ce=((Pe=(Be=a==null?void 0:a.split)==null?void 0:Be.call(a,"-"))==null?void 0:Pe[0])>=In;if(fe&&ce){if(!m)return{value:[],done:!0};const[j,le]=a.split("-"),ne=parseInt(le,10)-1,re=new Date(j,ne,0),xe=`${re.getFullYear()}-${(re.getMonth()+1).toString().padStart(2,"0")}-${re.getDate().toString().padStart(2,"0")}`,F=new Date(j,ne+1,1),R=`${F.getFullYear()}-${(F.getMonth()+1).toString().padStart(2,"0")}-${F.getDate().toString().padStart(2,"0")}`;let J;se?(J=kt+1,I.current=0):(J=kt+I.current+1,I.current+=kt);const te=await f.v2.search.fetch({q:`from:${m.acct} after:${xe} before:${R}`,type:"statuses",limit:J,offset:I.current});if((Ee=te==null?void 0:te.statuses)!=null&&Ee.length){const M=te.statuses.slice(0,kt);M.forEach(X=>{ze(X,c)});const Y=te.statuses.length<=kt;return{value:M,done:Y}}else return{value:[],done:!0}}let ye=[];if(se){const{value:j}=await f.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(j!=null&&j.length&&!r&&!p){const le=j.map(ne=>(ze(ne,c),{...ne,_pinned:!0}));if(le.length>=3){const ne=le.map(re=>re.id);ye.push({id:ne,items:le,type:"pinned"})}else ye.push(...le)}}(se||!y.current)&&(y.current=f.v1.accounts.$select(n).statuses.list({limit:kt,exclude_replies:l,exclude_reblogs:u,only_media:p||void 0,tagged:r}));const{value:Se,done:Ce}=await y.current.next();if(Se!=null&&Se.length){if(ye.length){let j=[];((Ne=ye[0])==null?void 0:Ne.type)==="pinned"?j=ye[0].id:j=ye.filter(ne=>ne._pinned).map(ne=>ne.id),j.every(ne=>Se.some(re=>re.id===ne))&&(ye=[])}ye.push(...Se),Se.forEach(j=>{ze(j,c)})}return{value:ye,done:Ce}}const[G,L]=A([]);He(m!=null&&m.acct?`${m!=null&&m.displayName?`${m.displayName} (${/@/.test(m.acct)?"":"@"}${m.acct})`:`${/@/.test(m.acct)?"":"@"}${m.acct}`}${l?u?" (- Boosts)":r?` (#${r})`:p?" (Media)":a?` (${new Date(a).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const ee=H(),q=Ze(()=>{const se=ee.current||f.v1.accounts.$select(n).fetch();return ee.current=se,se},[n,f]);W(()=>{(async()=>{try{const se=await q();b(se)}catch{}if(!v)try{const se=await f.v1.accounts.$select(n).featuredTags.list();L(se)}catch{}})()},[n,v]);const{displayName:E,acct:P,emojis:N}=m||{},D=H(),Q=be(()=>{const se=!l||u||r||p||!!a,fe=t.accounts[`${n}@${c}`];return e(_,{children:[e($s,{instance:c,account:fe||n,fetchAccount:q,authenticated:d,standalone:!0}),!v&&e("div",{class:"filter-bar",ref:D,style:{position:"relative"},children:[se?e(oe,{to:`/${c}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(oe,{to:`/${c}/a/${n}${l?"?replies=1":""}`,onClick:()=>{l&&ie("Showing post with replies")},class:l?"":"is-active",children:"+ Replies"}),e(oe,{to:`/${c}/a/${n}${u?"":"?boosts=0"}`,onClick:()=>{u||ie("Showing posts without boosts")},class:u?"is-active":"",children:"- Boosts"}),e(oe,{to:`/${c}/a/${n}${p?"":"?media=1"}`,onClick:()=>{p||ie("Showing posts with media")},class:p?"is-active":"",children:"Media"}),G.map(ce=>e(oe,{to:`/${c}/a/${n}${r===ce.name?"":`?tagged=${encodeURIComponent(ce.name)}`}`,onClick:()=>{r!==ce.name&&ie(`Showing posts tagged with #${ce.name}`)},class:r===ce.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),ce.name]})},ce.id)),T&&(ea?e("label",{class:`filter-field ${a?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(m!=null&&m.acct),value:a||"",min:Wn,max:new Date().toISOString().slice(0,7),onInput:ce=>{const{value:ye,validity:Se}=ce.currentTarget;if(!Se.valid)return;o(ye?{month:ye}:{});const[Ce,Be]=ye.split("-"),Pe=parseInt(Be,10)-1,Ee=new Date(Ce,Pe);ie(`Showing posts in ${Ee.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):e(ia,{class:`filter-field ${a?"is-active":""}`,disabled:!(m!=null&&m.acct),value:a||"",min:Wn,max:new Date().toISOString().slice(0,7),onInput:ce=>{const{value:ye,validity:Se}=ce;Se.valid&&o(ye?{month:ye}:{})}}))]})]})},[n,c,d,G,q,T,...k]);W(()=>{var fe;const se=(fe=D.current)==null?void 0:fe.querySelector(".is-active");se&&D.current.scrollTo({behavior:"smooth",left:se.offsetLeft-(D.current.offsetWidth-se.offsetWidth)/2})},[G,T,...k]);const he=be(()=>m!=null&&m.url?new URL(m.url).hostname:null,[m]),ae=!!m&&!(c===he);return e(lt,{title:`${m!=null&&m.acct?"@"+m.acct:"Posts"}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(ys,{text:E,emojis:N})}),e("div",{children:e("span",{children:["@",P]})})]}),id:"account-statuses",instance:c,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:V,useItemID:!0,view:p||v?"media":void 0,boostsCarousel:t.settings.boostsCarousel,timelineStart:Q,refresh:[l,u,r,p,a+(m==null?void 0:m.acct)].toString(),headerEnd:e(Ke,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(pe,{disabled:!ae,onClick:()=>{(async()=>{try{const{masto:se}=K({instance:he}),fe=await se.v1.accounts.lookup({acct:m.acct}),{id:ce}=fe;location.hash=`/${he}/a/${ce}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance"," ",he?e(_,{children:[" ","(",e("b",{children:xt.toUnicode(he)}),")"]}):null]})]}),!S&&e(pe,{onClick:()=>{(async()=>{try{const se=await h.v1.accounts.lookup({acct:m.acct+"@"+c}),{id:fe}=se;location.hash=`/${g}/a/${fe}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to my instance (",e("b",{children:g}),")"]})]})]})},n)}function ia(t){const{class:n,disabled:i,value:s,min:o,max:a,onInput:l=()=>{}}=t,[u,r]=(s==null?void 0:s.split("-"))||[],p=H(),f=H(),c=(d,h)=>{const[g,y]=(o==null?void 0:o.split("-"))||[],[k,m]=(a==null?void 0:a.split("-"))||[];return!(h<g||h>k||h===g&&d<y||h===k&&d>m)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:p,disabled:i,value:r||"",onInput:d=>{const{value:h}=d.currentTarget,g=f.current.value;if(!c(h,g))return{value:"",validity:{valid:!1}};l({value:h?`${g}-${h}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(d,h)=>e("option",{value:(h+1).toString().padStart(2,"0"),children:new Date(0,h).toLocaleString("default",{month:"long"})},h))]})," ",e("input",{ref:f,type:"number",disabled:i,value:u||new Date().getFullYear(),min:(o==null?void 0:o.slice(0,4))||In,max:(a==null?void 0:a.slice(0,4))||new Date().getFullYear(),onInput:d=>{const{value:h,validity:g}=d.currentTarget,y=p.current.value;if(!g.valid||!c(y,h))return{value:"",validity:{valid:!1}};l({value:h?`${h}-${y}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const oa=20;function Ms(){He("Bookmarks","/b");const{masto:t,instance:n}=K(),i=H();async function s(o){return(o||!i.current)&&(i.current=t.v1.bookmarks.list({limit:oa})),await i.current.next()}return e(lt,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:s})}const aa=""+new URL("catch-up-DuauQu-W.png",import.meta.url).href,ca="home",je=[{label:"last 1 hour",value:1},{label:"last 2 hours",value:2},{label:"last 3 hours",value:3},{label:"last 4 hours",value:4},{label:"last 5 hours",value:5},{label:"last 6 hours",value:6},{label:"last 7 hours",value:7},{label:"last 8 hours",value:8},{label:"last 9 hours",value:9},{label:"last 10 hours",value:10},{label:"last 11 hours",value:11},{label:"last 12 hours",value:12},{label:"beyond 12 hours",value:13}],ra=["Original","Replies","Boosts","Followed tags","Groups","Filtered"],la=["createdAt","repliesCount","favouritesCount","reblogsCount","density"],da=[null,"account"],Kn={Filtered:"filtered",Groups:"group",Boosts:"boost",Replies:"reply","Followed tags":"followedTags",Original:"original"},ua={Filtered:"filtered posts",Groups:"group posts",Boosts:"boosts",Replies:"replies","Followed tags":"followed-tag posts",Original:"original posts"},ha={createdAt:["oldest","latest"],repliesCount:["fewest replies","most replies"],favouritesCount:["fewest likes","most likes"],reblogsCount:["fewest boosts","most boosts"],density:["least dense","most dense"]};function pa(){He("Catch-up","/catchup");const{masto:t,instance:n}=K(),[i,s]=nt(),o=i.get("id"),[a,l]=A("start"),[u,r]=A(!1),p=be(()=>it(),[]),f=x=>x===p;async function c({maxCreatedAt:x}){var z,ve,me;const $=x?new Date(x):null,O=[],B=t.v1.timelines.home.list({limit:40});e:for(;;)try{const de=await B.next(),{value:ge}=de;if(ge!=null&&ge.length){await Ls(ge,n);let Ae=!1;for(let qe=0;qe<ge.length;qe++){const $e=ge[qe],Ve=new Date($e.createdAt);if(!$||Ve>=$){const Z=!f(((ve=(z=$e.reblog)==null?void 0:z.account)==null?void 0:ve.id)||$e.account.id)&&Mt(((me=$e.reblog)==null?void 0:me.filtered)||$e.filtered,ca);if((Z==null?void 0:Z.action)==="hide")continue;$e._filtered=Z;const _e=We($e.id,n);$e._followedTags=C.statusFollowedTags[_e]?[...C.statusFollowedTags[_e]]:[],O.push($e),Ae=!0}if(!Ae)break e}}else break e;await new Promise(Ae=>setTimeout(Ae,1e3))}catch{break e}return O.forEach(de=>{if(de!=null&&de.inReplyToId){const ge=O.find(Ae=>Ae.id===de.inReplyToId);ge&&!ge.inReplyToId&&(ge._thread=!0)}}),O}const[d,h]=A([]),g=H(),y=H(),k=be(()=>Yt(),[]),m=Ze(async({duration:x}={})=>{const $=Date.now(),O=x?$-x:null;l("loading");const B=await c({maxCreatedAt:O}),z=`${k}-${ci()}`;try{await et.catchup.set(z,{id:z,posts:B,count:B.length,startAt:O,endAt:$}),s({id:z})}catch{}},[]);W(()=>{o?(async()=>{const x=await et.catchup.get(o);x&&(x.posts.sort(($,O)=>$.createdAt>O.createdAt?1:-1),h(x.posts),l("results"))})():a==="results"&&(h([]),l("start"))},[o]);const[b,I]=ft(x=>x+1,0),[v,S]=A(null),[T,U]=A([]);W(()=>{(async()=>{try{const x=await et.catchup.keys();if(x.length){const $=Yt(),O=x.filter(B=>B.startsWith(`${$}-`));if(O.length){let B=await et.catchup.getMany(O);B.sort((de,ge)=>ge.endAt-de.endAt);let z=B.slice(0,3),ve=B.slice(3);const me=z.map(de=>{const{id:ge,count:Ae,startAt:qe,endAt:$e}=de;return{id:ge,count:Ae,startAt:qe,endAt:$e}});U(me),S(z[0].endAt),B=null,z=null,queueMicrotask(()=>{ve.length&&et.catchup.delMany(ve.map(de=>de.id)).then(()=>{ve=null}).catch(de=>{})});return}}}catch{}U([])})()},[b]),W(()=>{a==="start"&&I()},[a==="start"]);const[V,G]=be(()=>{var ge,Ae,qe,$e,Ve;let x=0,$=0,O=0,B=0,z=0,ve=0;const me={};for(const ue of d){ue._filtered?(x++,ue.__FILTER="filtered"):ue.group?($++,ue.__FILTER="group"):ue.reblog?(O++,ue.__FILTER="boost"):(ge=ue._followedTags)!=null&&ge.length?(z++,ue.__FILTER="followedTags"):ue.inReplyToId&&ue.inReplyToAccountId!==((Ae=ue.account)==null?void 0:Ae.id)?(B++,ue.__FILTER="reply"):(ve++,ue.__FILTER="original");const Z=ue.reblog||ue;if(ue.__FILTER!=="filtered"&&((qe=Z.card)!=null&&qe.url)&&(($e=Z.card)!=null&&$e.image)&&((Ve=Z.card)==null?void 0:Ve.type)==="link"){const{card:_e,favouritesCount:yt,reblogsCount:ht}=Z;let{url:Ye}=_e;if(Ye=Ye.replace(/\/$/,""),!me[Ye])me[Ye]={postID:Z.id,card:_e,shared:1,sharers:[ue.account],likes:yt,boosts:ht};else{if(me[Ye].sharers.find(wt=>wt.id===ue.account.id))continue;me[Ye].shared++,me[Ye].sharers.push(ue.account),me[Ye].postID!==Z.id&&(me[Ye].likes+=yt,me[Ye].boosts+=ht)}}}let de=[];for(const ue in me)de.push({url:ue,...me[ue]});if(de.sort((ue,Z)=>ue.shared>Z.shared?-1:ue.shared<Z.shared?1:ue.boosts>Z.boosts?-1:ue.boosts<Z.boosts?1:ue.likes>Z.likes?-1:ue.likes<Z.likes?1:0),de.length>10)e:for(let ue=10;ue<de.length;ue++){const{shared:Z}=de[ue];if(Z<=1){de=de.slice(0,ue);break e}}return[{Filtered:x,Groups:$,Boosts:O,Replies:B,"Followed tags":z,Original:ve},de]},[d]),[L,ee]=A("All"),[q,E]=A(null),[P,N]=A(1),[D,Q]=A("createdAt"),[he,Ie]=A("asc"),[ae,se]=A(null),[fe,ce,ye]=be(()=>{const x={},$=new Map;let O=d.filter(z=>{const ve=L==="All"||z.__FILTER===Kn[L];return ve&&(x[z.account.id]=z.account,$.set(z.account.id,($.get(z.account.id)||0)+1)),ve});const B={};return O.forEach(z=>{z.reblog&&(B[z.reblog.id]?(B[z.reblog.id].__BOOSTERS?B[z.reblog.id].__BOOSTERS.add(z.account):B[z.reblog.id].__BOOSTERS=new Set([z.account]),z.__HIDDEN=!0):B[z.reblog.id]=z)}),q&&$.has(q)&&(O=O.filter(z=>z.account.id===q||[...z.__BOOSTERS||[]].find(ve=>ve.id===q))),[O,x,Object.fromEntries($)]},[L,q,d]),Se=be(()=>{const x={};return fe.forEach($=>{x[$.id]=$}),x},[fe]),Ce=be(()=>Object.keys(ye).sort((x,$)=>ye[$]-ye[x]),[ye]),Be=be(()=>{const x={};return Ce.forEach(($,O)=>{x[$]=O}),fe.filter($=>!$.__HIDDEN).sort(($,O)=>{if(ae==="account"){const B=$.account.id,z=O.account.id,ve=x[B],me=x[z],de=ve-me;if(de!==0)return de}if(D!=="createdAt"&&($=$.reblog||$,O=O.reblog||O,D!=="density"&&$[D]===O[D]))return $.createdAt>O.createdAt?1:-1;if(D==="density"){const B=Jn($),z=Jn(O);return he==="asc"?B>z?1:-1:z>B?1:-1}return he==="asc"?$[D]>O[D]?1:-1:O[D]>$[D]?1:-1})},[fe,D,he,ae,Ce]),Pe=H(null),Ee=H(null),Ne=H(!1);W(()=>{d.length>100||Ne.current||Ee.current&&(ri(Ee.current,{duration:200}),Ne.current=!0)},[d,Ee]);const j=d.length>160?"3d":"2d",le=be(()=>j!=="2d"?null:d.map(x=>{const $=Se[x.id];return e("span",{class:`post-dot ${$?"post-dot-highlight":""}`},x.id)}),[Se]),ne=be(()=>j!=="3d"||!(d!=null&&d.length)?null:ka(d,"createdAt",320).map(($,O)=>e("div",{class:"posts-bin",children:$.map(B=>{const z=Se[B.id];return e("span",{class:`post-dot ${z?"post-dot-highlight":""}`},B.id)})},O)),[Se]),re=H(null),xe=be(()=>v?(Date.now()-v)/1e3/60/60:null,[v,P]);W(()=>{if(a!=="results")return;const x=q&&ce[q]?ce[q].username:"",$=he==="asc"?0:1,O={account:"authors"};let B=ie({duration:5e3,text:`Showing ${ua[L]||"all posts"}${x?` by @${x}`:""}, ${ha[D][$]} first${ae?`, grouped by ${ae==="account"?O[ae]:""}`:""}`});return()=>{var z;(z=B==null?void 0:B.hideToast)==null||z.call(B)}},[a,L,q,D,he,ae,ce]),W(()=>{var x;if(q&&ce[q]){const $=Ee.current.querySelector(`[data-author="${q}"]`),O=(x=Ee.current)==null?void 0:x.getBoundingClientRect(),B=$==null?void 0:$.getBoundingClientRect();B.left<O.left||B.right>O.right?$.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}):B.top<0&&$.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"})}},[q,ce]);const[F,R]=A(!1),J=".catchup-list > li > a",te=Me("j",()=>{const x=document.activeElement.closest(J),$=x==null?void 0:x.getBoundingClientRect(),O=Array.from(re.current.querySelectorAll(J));if(x&&$.top<re.current.clientHeight&&$.bottom>0){const B=O.indexOf(x),z=O[B+1];z&&(z.focus(),z.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const B=O.find(z=>z.getBoundingClientRect().top>=0);B&&(B.focus(),B.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),M=Me("k",()=>{const x=document.activeElement.closest(J),$=x==null?void 0:x.getBoundingClientRect(),O=Array.from(re.current.querySelectorAll(J));if(x&&$.top<re.current.clientHeight&&$.bottom>0){const B=O.indexOf(x);let z=O[B-1];z&&(z.focus(),z.scrollIntoView({block:"center",inline:"center",behavior:"smooth"}))}else{const B=O.find(z=>{const ve=z.getBoundingClientRect();return ve.top>=44&&ve.left>=0});B&&(B.focus(),B.scrollIntoView({block:"nearest",inline:"center",behavior:"smooth"}))}},{preventDefault:!0,ignoreModifiers:!0}),Y=Me("h, l",(x,$)=>{var B,z,ve;const O=$.keys[0];if(q){const me=Ce.indexOf(q);O==="h"?me>0&&me<Ce.length&&(E(Ce[me-1]),(B=re.current)==null||B.focus()):O==="l"&&me<Ce.length-1&&me>=0&&(E(Ce[me+1]),(z=re.current)==null||z.focus())}else O==="l"&&(E(Ce[0]),(ve=re.current)==null||ve.focus())},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]}),X=Me("esc",()=>{var x;E(null),(x=re.current)==null||x.focus()},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]}),ke=Me(".",()=>{var x;(x=re.current)==null||x.scrollTo({top:0,behavior:"smooth"})},{preventDefault:!0,ignoreModifiers:!0,enableOnFormTags:["input"]});return e("div",{ref:x=>{re.current=x,te.current=x,M.current=x,Y.current=x,X.current=x},id:"catchup-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck wide",children:[e("header",{class:`${a==="loading"?"loading":""}`,onClick:x=>{var $;x.target.closest("a, button")||($=re.current)==null||$.scrollTo({top:0,behavior:"smooth"})},children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),a==="results"&&e(oe,{to:"/catchup",class:"button plain",children:e(w,{icon:"history2",size:"l"})}),a==="start"&&e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:a!=="start"&&e(_,{children:["Catch-up ",e("sup",{children:"beta"})]})}),e("div",{class:"header-side",children:a!=="start"&&a!=="loading"&&e("button",{type:"button",class:"plain",onClick:()=>{R(!0)},children:"Help"})})]})}),e("main",{children:[a==="start"&&e("div",{class:"catchup-start",children:[e("h1",{children:["Catch-up ",e("sup",{children:"beta"})]}),e("details",{children:[e("summary",{children:"What is this?"}),e("p",{children:"Catch-up is a separate timeline for your followings, offering a high-level view at a glance, with a simple, email-inspired interface to effortlessly sort and filter through posts."}),e("img",{src:aa,width:"1200",height:"900",alt:"Preview of Catch-up UI"}),e("p",{children:e("button",{type:"button",onClick:x=>{x.target.closest("details").open=!1},children:"Let's catch up"})})]}),e("p",{children:"Let's catch up on the posts from your followings."}),e("p",{children:e("b",{children:"Show me all posts from…"})}),e("div",{class:"catchup-form",children:[e("input",{ref:g,type:"range",value:P,min:je[0].value,max:je[je.length-1].value,step:"1",list:"catchup-ranges",onChange:x=>N(+x.target.value)})," ",e("span",{style:{width:"8em"},children:[je[P-1].label,e("br",{}),e("small",{class:"insignificant",children:P==je[je.length-1].value?"until the max":ot(new Date(Date.now()-P*60*60*1e3))})]}),e("datalist",{id:"catchup-ranges",children:je.map(({label:x,value:$})=>e("option",{value:$,label:x}))})," ",e("button",{type:"button",onClick:()=>{var x;if(P<je[je.length-1].value){let $;P===je[je.length-1].value&&((x=y.current)!=null&&x.checked)?$=Date.now()-v:$=P*60*60*1e3,m({duration:$})}else m()},children:"Catch up"})]}),xe&&P>xe?e("p",{class:"catchup-info",children:[e(w,{icon:"info"})," Overlaps with your last catch-up"]}):P===je[je.length-1].value&&v?e("p",{class:"catchup-info",children:e("label",{children:[e("input",{type:"checkbox",switch:!0,checked:!0,ref:y})," ","Until the last catch-up (",Ut.format(new Date(v)),")"]})}):null,e("p",{class:"insignificant",children:e("small",{children:"Note: your instance might only show a maximum of 800 posts in the Home timeline regardless of the time range. Could be less or more."})}),!!(T!=null&&T.length)&&e("div",{class:"catchup-prev",children:[e("p",{children:"Previously…"}),e("ul",{children:T.map(x=>e("li",{children:[e(oe,{to:`/catchup?id=${x.id}`,children:[e(w,{icon:"history2"})," ",e("span",{children:x.startAt?Ut.formatRange(new Date(x.startAt),new Date(x.endAt)):`… – ${Ut.format(new Date(x.endAt))}`})]})," ",e("span",{children:[e("small",{class:"ib insignificant",children:[x.count," posts"]})," ",e("button",{type:"button",class:"light danger small",onClick:async()=>{var O;if(confirm("Remove this catch-up?")){let B=ie(`Removing Catch-up ${x.id}`);await et.catchup.del(x.id),(O=B==null?void 0:B.hideToast)==null||O.call(B),ie(`Catch-up ${x.id} removed`),I()}},children:e(w,{icon:"x"})})]})]},x.id))}),T.length>=3&&e("p",{children:e("small",{children:"Note: Only max 3 will be stored. The rest will be automatically removed."})})]})]}),a==="loading"&&e("div",{class:"ui-state catchup-start",children:[e(Te,{abrupt:!0}),e("p",{class:"insignificant",children:"Fetching posts…"}),e("p",{class:"insignificant",children:"This might take a while."})]}),a==="results"&&e(_,{children:[e("div",{class:"catchup-header",children:[d.length>0&&e("p",{children:e("b",{class:"ib",children:Ut.formatRange(new Date(d[0].createdAt),new Date(d[d.length-1].createdAt))})}),e("aside",{children:[e("button",{hidden:L==="All"&&!q&&D==="createdAt"&&he==="asc",type:"button",class:"plain4 small",onClick:()=>{ee("All"),E(null),Q("createdAt"),se(null),Ie("asc")},children:"Reset filters"}),(G==null?void 0:G.length)>0&&e("button",{type:"button",class:"plain small",onClick:()=>r(!u),children:["Top links"," ",e(w,{icon:"chevron-down",style:{transform:u?"rotate(180deg)":"rotate(0deg)"}})]})]})]}),e("div",{class:"shazam-container no-animation",hidden:!u,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"catchup-top-links links-bar",children:G.map(x=>{const{card:$,shared:O,sharers:B,likes:z,boosts:ve}=x,{blurhash:me,title:de,description:ge,url:Ae,image:qe,imageDescription:$e,language:Ve,width:ue,height:Z,publishedAt:_e}=$,yt=xt.toUnicode(new URL(Ae).hostname.replace(/^www\./,"").replace(/\/$/,""));let ht;if(me){const Ye=pn(me),wt=kn(Ye);ht=Sn([.6,wt[1],wt[2]])}return e("a",{href:Ae,target:"_blank",rel:"noopener noreferrer",style:ht?{"--accent-color":`rgb(${ht.join(",")})`,"--accent-alpha-color":`rgba(${ht.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:qe,alt:$e,width:ue,height:Z,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:yt})," ",!!_e&&e(_,{children:"· "}),!!_e&&e(_,{children:e(gt,{datetime:_e,format:"micro"})})]}),!!de&&e("h1",{class:"title",lang:Ve,dir:"auto",title:de,children:de})]}),!!ge&&e("p",{class:"description",lang:Ve,dir:"auto",title:ge,children:ge}),e("hr",{}),e("p",{style:{whiteSpace:"nowrap"},children:["Shared by"," ",B.map(Ye=>{const{avatarStatic:wt,displayName:Ys}=Ye;return e(tt,{url:wt,size:"s",alt:Ys})})]})]})]})},Ae)})})})}),d.length>=5&&(j==="3d"?e("div",{class:"catchup-posts-viz-time-bar",children:ne}):e("div",{class:"catchup-posts-viz-bar",children:le})),d.length>=2&&e("div",{class:"catchup-filters",children:[e("label",{class:"filter-cat",children:[e("input",{type:"radio",name:"filter-cat",checked:L.toLowerCase()==="all",onChange:()=>{ee("All")}}),"All ",e("span",{class:"count",children:d.length})]}),ra.map(x=>!!V[x]&&e("label",{class:"filter-cat",title:(V[x]/d.length*100).toFixed(2)+"%",children:[e("input",{type:"radio",name:"filter-cat",checked:L.toLowerCase()===x.toLowerCase(),onChange:()=>{ee(x)}}),x," ",e("span",{class:"count",children:V[x]})]},x))]}),d.length>=2&&!!ye&&e("div",{class:"catchup-filters authors-filters",ref:Ee,children:[Ce.map(x=>e("label",{class:"filter-author","data-author":x,children:[e("input",{type:"radio",name:"filter-author",checked:q===x,onChange:()=>{E(x)},onClick:()=>{q===x&&E(null)}}),e(tt,{url:ce[x].avatarStatic||ce[x].avatar,size:"xxl",alt:`${ce[x].displayName} (@${ce[x].acct})`})," ",e("span",{class:"count",children:ye[x]}),e("span",{class:"username",children:ce[x].username})]},`${x}-${ye[x]}`)),Ce.length>5&&e("small",{style:{whiteSpace:"nowrap",paddingInline:"1em",opacity:.33},children:[Ce.length," authors"]},"authors-count")]}),d.length>=2&&e("div",{class:"catchup-filters",children:[e("span",{class:"filter-label",children:"Sort"})," ",e("fieldset",{class:"radio-field-group",children:la.map(x=>e("label",{class:"filter-sort",onClick:$=>{D===x&&($.preventDefault(),$.stopPropagation(),Ie(he==="asc"?"desc":"asc"))},children:[e("input",{type:"radio",name:"filter-sort-cat",checked:D===x,onChange:()=>{Q(x);const $=/(replies|favourites|reblogs)/.test(x)?"desc":"asc";Ie($)}}),{createdAt:"Date",repliesCount:"Replies",favouritesCount:"Likes",reblogsCount:"Boosts",density:"Density"}[x],D===x&&(he==="asc"?" ↑":" ↓")]},x))}),e("span",{class:"filter-label",children:"Group"})," ",e("fieldset",{class:"radio-field-group",children:da.map(x=>e("label",{class:"filter-group",children:[e("input",{type:"radio",name:"filter-group",checked:ae===x,onChange:()=>{se(x)},disabled:x==="account"&&q}),{account:"Authors"}[x]||"None"]},x||"none"))}),q&&Ce.length>1?e("button",{type:"button",class:"plain6 small",onClick:()=>{E(null)},style:{whiteSpace:"nowrap"},children:"Show all authors"}):null]}),e("ul",{class:`catchup-list catchup-filter-${Kn[L]||""} ${D?`catchup-sort-${D}`:""} ${q&&ce[q]?"catchup-selected-author":""} ${ae?`catchup-group-${ae}`:""}`,children:Be.map((x,$)=>{var z;const O=((z=x.reblog)==null?void 0:z.id)||x.id;let B=!1;return ae==="account"&&(Pe.current&&x.account.id!==Pe.current&&$>0&&(B=!0),Pe.current=x.account.id),e(_,{children:[B&&e("li",{class:"separator"}),e(ma,{to:`/${n}/s/${O}`,post:x,root:re.current})]},`${x.id}-${B}`)})}),e("footer",{children:fe.length>5&&e("p",{children:[L==="Boosts"?"You don't have to read everything.":"That's all."," ",e("button",{type:"button",class:"textual",onClick:()=>{re.current.scrollTop=0},children:"Back to top"}),"."]})})]})]})]}),F&&e(Re,{onClose:()=>R(!1),children:e("div",{class:"sheet",id:"catchup-help-sheet",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>R(!1),children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Help"})}),e("main",{children:e("dl",{children:[e("dt",{children:"Top links"}),e("dd",{children:"Links shared by followings, sorted by shared counts, boosts and likes."}),e("dt",{children:"Sort: Density"}),e("dd",{children:'Posts are sorted by information density or depth. Shorter posts are "lighter" while longer posts are "heavier". Posts with photos are "heavier" than posts without photos.'}),e("dt",{children:"Group: Authors"}),e("dd",{children:"Posts are grouped by authors, sorted by posts count per author."}),e("dt",{children:"Keyboard shortcuts"}),e("dd",{children:[e("kbd",{children:"j"}),": Next post"]}),e("dd",{children:[e("kbd",{children:"k"}),": Previous post"]}),e("dd",{children:[e("kbd",{children:"l"}),": Next author"]}),e("dd",{children:[e("kbd",{children:"h"}),": Previous author"]}),e("dd",{children:[e("kbd",{children:"Enter"}),": Open post details"]}),e("dd",{children:[e("kbd",{children:"."}),": Scroll to top"]})]})})]})})]})}const fa=Je(function({post:t}){const{id:n,account:i,group:s,reblog:o,inReplyToId:a,inReplyToAccountId:l,_followedTags:u,_filtered:r,visibility:p,__BOOSTERS:f}=t,c=a&&l!==i.id,d=!!r,h=g=>{g.shiftKey};return e("article",{class:`post-line ${s?"group":o?"reblog":u!=null&&u.length?"followed-tags":""} ${c?"reply-to":""} ${d?"filtered":""} visibility-${p}`,onMouseEnter:h,children:[e("span",{class:"post-author",children:o?e("span",{class:"post-reblog-avatar",children:[e(tt,{url:i.avatarStatic||i.avatar,squircle:i.bot}),(f==null?void 0:f.size)>0?[...f].map(g=>e(tt,{url:g.avatarStatic||g.avatar,squircle:g.bot})):""," ",e(w,{icon:"rocket"})," ",e(It,{account:o.account,showAvatar:!0})]}):e(It,{account:i,showAvatar:!0})}),e(ya,{post:o||t,filterInfo:r}),e("span",{class:"post-meta",children:[e(wa,{post:o||t})," ",e(gt,{datetime:new Date((o==null?void 0:o.createdAt)||t.createdAt),format:"micro"})]})]})},(t,n)=>{var i,s;return((i=t==null?void 0:t.post)==null?void 0:i.id)===((s=n==null?void 0:n.post)==null?void 0:s.id)}),ma=({root:t,to:n,...i})=>{const s=H(),[o,a]=A(!1);return W(()=>{const l=new IntersectionObserver(u=>{u[0].isIntersecting&&(queueMicrotask(()=>a(!0)),l.unobserve(s.current))},{root:t,rootMargin:`${Math.max(320,screen.height*.75)}px`});return s.current&&l.observe(s.current),()=>{s.current&&l.unobserve(s.current)}},[]),o?e("li",{children:e(oe,{to:n,children:e(fa,{...i})})}):e("li",{ref:s,style:{height:"4em"}})},ga=8,ba=8;function Jn(t){var r;const{spoilerText:n,content:i,poll:s,mediaAttachments:o,card:a}=t,l=(r=s==null?void 0:s.options)!=null&&r.length?s.options.reduce((p,f)=>p+f.title,""):"";return(n.length+Ss(i)+l.length)/140+(o!=null&&o.length?ga*o.length:a!=null&&a.image?ba:0)}const dt=48;function ya({post:t,filterInfo:n}){var k;const{spoilerText:i,sensitive:s,content:o,emojis:a,poll:l,mediaAttachments:u,card:r,inReplyToId:p,inReplyToAccountId:f,account:c,_thread:d}=t,h=p&&f===c.id||!!d,g=!i&&!s,y=o?gn(t):"";return e("div",{class:"post-peek",title:i?"":y,children:[e("span",{class:"post-peek-content",children:n?e(_,{children:[h&&e(_,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-filtered",children:["Filtered",n!=null&&n.titlesStr?`: ${n.titlesStr}`:""]})]}):i?e(_,{children:[h&&e(_,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-spoiler",children:[e(w,{icon:"eye-close"})," ",i]})]}):e("div",{class:"post-peek-html",children:[h&&e(_,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),!!o&&e("div",{dangerouslySetInnerHTML:{__html:Ii(o,a)}}),!!((k=l==null?void 0:l.options)!=null&&k.length)&&l.options.map(m=>e("div",{children:[l.multiple?"▪️":"•"," ",m.title]})),!o&&(u==null?void 0:u.length)===1&&u[0].description&&e(_,{children:[e("span",{class:"post-peek-tag post-peek-alt",children:"ALT"})," ",e("div",{children:u[0].description})]})]})}),!n&&e("span",{class:"post-peek-post-content",children:[!!l&&e("span",{class:"post-peek-tag post-peek-poll",children:[e(w,{icon:"poll",size:"s"}),"Poll"]}),u!=null&&u.length?u.map(m=>{const b=m.previewUrl||m.url,I=m.previewRemoteUrl||m.remoteUrl;return e("span",{class:"post-peek-media",children:{image:(b||I)&&g?e("img",{src:b,width:dt,height:dt,alt:m.description,loading:"lazy",onError:v=>{const{src:S}=v.target;S===b&&(v.target.src=I)}}):e("span",{class:"post-peek-faux-media",children:"🖼"}),gifv:(b||I)&&g?e("img",{src:b,width:dt,height:dt,alt:m.description,loading:"lazy",onError:v=>{const{src:S}=v.target;S===b&&(v.target.src=I)}}):e("span",{class:"post-peek-faux-media",children:"🎞️"}),video:(b||I)&&g?e("img",{src:b,width:dt,height:dt,alt:m.description,loading:"lazy",onError:v=>{const{src:S}=v.target;S===b&&(v.target.src=I)}}):e("span",{class:"post-peek-faux-media",children:"📹"}),audio:e("span",{class:"post-peek-faux-media",children:"🎵"})}[m.type]||null},m.id)}):!!r&&r.image&&g&&e("span",{class:`post-peek-media post-peek-card card-${r.type||""}`,children:r.image?e("img",{src:r.image,width:dt,height:dt,alt:r.title||r.description||r.imageDescription,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"🔗"})})]})]})}function wa({post:t}){const{reblogsCount:n,repliesCount:i,favouritesCount:s}=t;return e("span",{class:"post-stats",children:[i>0&&e("span",{class:"post-stat-replies",children:[e(w,{icon:"comment2",size:"s"})," ",Ge(i)]}),s>0&&e("span",{class:"post-stat-likes",children:[e(w,{icon:"heart",size:"s"})," ",Ge(s)]}),n>0&&e("span",{class:"post-stat-boosts",children:[e(w,{icon:"rocket",size:"s"})," ",Ge(n)]})]})}const{locale:va}=new Intl.DateTimeFormat().resolvedOptions(),Ut=new Intl.DateTimeFormat(va,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"});function ka(t,n,i){const s=t.map(r=>new Date(r[n])),o=s.reduce((r,p)=>p<r?p:r,s[0]),l=s.reduce((r,p)=>p>r?p:r,s[0]).getTime()-o.getTime(),u=Array.from({length:i},()=>[]);return t.forEach(r=>{const f=(new Date(r[n]).getTime()-o.getTime())/l,c=Math.floor(f*(i-1));u[c].push(r)}),u}const Sa=20;function Ps(){He("Likes","/f");const{masto:t,instance:n}=K(),i=H();async function s(o){return(o||!i.current)&&(i.current=t.v1.favourites.list({limit:Sa})),await i.current.next()}return e(lt,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:s})}const Ia=["home","public","notifications","thread","account"],Xn=["notifications","thread","account"],Ca={home:"Home and lists",notifications:"Notifications",public:"Public timelines",thread:"Conversations",account:"Profiles"},Ta=[0,30*60,60*60,6*60*60,12*60*60,60*60*24,60*60*24*7,60*60*24*30],xa={0:"Never",1800:"30 minutes",3600:"1 hour",21600:"6 hours",43200:"12 hours",86400:"24 hours",604800:"7 days",2592e3:"30 days"};function Aa(){const{masto:t}=K();He("Filters","/ft");const[n,i]=A("default"),[s,o]=A(!1),[a,l]=ft(p=>p+1,0),[u,r]=A([]);return W(()=>{i("loading"),(async()=>{try{const p=await t.v2.filters.list();p.sort((f,c)=>f.title.localeCompare(c.title)),p.forEach(f=>{var c;(c=f.keywords)!=null&&c.length&&f.keywords.sort((d,h)=>d.id-h.id)}),r(p),i("default")}catch{i("error")}})()},[a]),e("div",{id:"filters-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Filters"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{o(!0)},children:e(w,{icon:"plus",size:"l",alt:"New filter"})})})]})}),e("main",{children:u.length>0?e(_,{children:[e("ul",{class:"filters-list",children:u.map(p=>{const{id:f,title:c,expiresAt:d,keywords:h}=p;return e("li",{children:[e("div",{children:[e("h2",{children:c}),(h==null?void 0:h.length)>0&&e("div",{children:h.map(g=>e(_,{children:[e("span",{class:"tag collapsed insignificant",children:g.wholeWord?`“${g.keyword}”`:g.keyword})," "]}))}),e("small",{class:"insignificant",children:e(Ns,{expiresAt:d})})]}),e("button",{type:"button",class:"plain",onClick:()=>{o({filter:p})},children:e(w,{icon:"pencil",size:"l",alt:"Edit filter"})})]},f)})}),u.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[u.length," filter",u.length===1?"":"s"]})})]}):n==="loading"?e("p",{class:"ui-state",children:e(Te,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load filters."}):e("p",{class:"ui-state",children:"No filters yet."})})]}),!!s&&e(Re,{title:"Add filter",onClose:()=>{o(!1)},children:e(Ra,{filter:s==null?void 0:s.filter,onClose:p=>{p.state==="success"&&l(),o(!1)}})})]})}let $a=1;const _a=()=>$a++;function Ra({filter:t,onClose:n}){const{masto:i}=K(),[s,o]=A("default"),a=!!t,{context:l,expiresAt:u,id:r,keywords:p,title:f,filterAction:c}=t||{},d=!!u,h=d&&new Date(u),[g,y]=A(p||[]),k=H(),[m,b]=A([]),[I,v]=A([]),S=g.filter(T=>!m.includes(T.id)&&!I.includes(T._id));return e("div",{class:"sheet",id:"filters-add-edit-modal",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:a?"Edit filter":"New filter"})}),e("main",{children:e("form",{onSubmit:T=>{T.preventDefault();const U=new FormData(T.target),V=U.get("title"),G=U.getAll("keyword_attributes[][id]"),L=U.getAll("keyword_attributes[][keyword]"),ee=[...k.current.querySelectorAll('input[name="keyword_attributes[][whole_word]"]')].map(D=>D.checked),q=L.map((D,Q)=>({id:G[Q]||void 0,keyword:D,wholeWord:ee[Q]}));a&&(m!=null&&m.length)&&m.forEach(D=>{q.push({id:D,_destroy:!0})});const E=U.getAll("context");let P=U.get("expires_in");const N=U.get("filter_action");!V||!(E!=null&&E.length)||(o("loading"),(async()=>{try{let D;a?(P===""||P===null?d?P=Math.floor((h-new Date)/1e3):P=null:P==="0"||P===0?P=null:P=+P,D=await i.v2.filters.$select(r).update({title:V,context:E,expiresIn:P,keywordsAttributes:q,filterAction:N})):(P=+P||null,D=await i.v2.filters.create({title:V,context:E,expiresIn:P,keywordsAttributes:q,filterAction:N})),o("default"),n==null||n({state:"success",filter:D})}catch{o("error"),alert(a?"Unable to edit filter":"Unable to create filter")}})())},children:[e("div",{class:"filter-form-row",children:e("label",{children:[e("b",{children:"Title"}),e("input",{type:"text",name:"title",defaultValue:f,disabled:s==="loading",dir:"auto",required:!0})]})}),e("div",{class:"filter-form-keywords",ref:k,children:[S.length?e("ul",{class:"filter-keywords",children:S.map(T=>{const{id:U,keyword:V,wholeWord:G,_id:L}=T;return e("li",{children:[e("input",{type:"hidden",name:"keyword_attributes[][id]",value:U}),e("input",{name:"keyword_attributes[][keyword]",type:"text",defaultValue:V,disabled:s==="loading",required:!0}),e("div",{class:"filter-keyword-actions",children:[e("label",{children:[e("input",{name:"keyword_attributes[][whole_word]",type:"checkbox",value:U,defaultChecked:G,disabled:s==="loading"})," ","Whole word"]}),e("button",{type:"button",class:"light danger small",disabled:s==="loading",onClick:()=>{U?(m.push(U),b([...m])):L&&(I.push(L),v([...I]))},children:e(w,{icon:"x"})})]})]},`${U}-${L}`)})}):e("div",{class:"filter-keywords",children:e("div",{class:"insignificant",children:"No keywords. Add one."})}),e("footer",{class:"filter-keywords-footer",children:[e("button",{type:"button",class:"light",onClick:()=>{y([...g,{_id:_a(),keyword:"",wholeWord:!0}]),setTimeout(()=>{var U,V;const T=k.current.querySelectorAll('input[type="text"]');(V=(U=T[T.length-1])==null?void 0:U.focus)==null||V.call(U)},10)},children:"Add keyword"})," ",(S==null?void 0:S.length)>1&&e("small",{class:"insignificant",children:[S.length," keyword",S.length===1?"":"s"]})]})]}),e("div",{class:"filter-form-cols",children:[e("div",{class:"filter-form-col",children:[e("div",{children:e("b",{children:"Filter from…"})}),Ia.map(T=>e("div",{children:[e("label",{class:Xn.includes(T)?"insignificant":"",children:[e("input",{type:"checkbox",name:"context",value:T,defaultChecked:l?l.includes(T):!0,disabled:s==="loading"})," ",Ca[T],Xn.includes(T)?"*":""]})," "]})),e("p",{children:e("small",{class:"insignificant",children:"* Not implemented yet"})})]}),e("div",{class:"filter-form-col",children:[a&&e(_,{children:["Status:"," ",e("b",{children:e(Ns,{expiresAt:u,showNeverExpires:!0})})]}),e("div",{children:[e("label",{for:"filters-expires_in",children:a?"Change expiry":"Expiry"}),e("select",{id:"filters-expires_in",name:"expires_in",disabled:s==="loading",defaultValue:a?void 0:0,children:[a&&e("option",{}),Ta.map(T=>e("option",{value:T,children:xa[T]}))]})]}),e("p",{children:["Filtered post will be…",e("br",{}),e("label",{class:"ib",children:[e("input",{type:"radio",name:"filter_action",value:"warn",defaultChecked:c==="warn"||!a,disabled:s==="loading"})," ","minimized"]})," ",e("label",{class:"ib",children:[e("input",{type:"radio",name:"filter_action",value:"hide",defaultChecked:c==="hide",disabled:s==="loading"})," ","hidden"]})]})]})]}),e("footer",{class:"filter-form-footer",children:[e("span",{children:[e("button",{type:"submit",disabled:s==="loading",children:a?"Save":"Create"})," ",e(Te,{abrupt:!0,hidden:s!=="loading"})]}),a&&e(Qe,{disabled:s==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this filter?",onClick:()=>{o("loading"),(async()=>{try{await i.v2.filters.$select(r).remove(),o("default"),n==null||n({state:"success"})}catch{o("error"),alert("Unable to delete filter.")}})()},children:e("button",{type:"button",class:"light danger",onClick:()=>{},disabled:s==="loading",children:"Delete…"})})]})]})})]})}function Ns({expiresAt:t,showNeverExpires:n}){const i=!!t,s=i&&new Date(t),o=i&&s<=new Date,[a,l]=ft(u=>u+1,0);return mn(l,o||3e4),o?"Expired":i?e(_,{children:["Expiring ",e(gt,{datetime:s})]}):n&&"Never expires"}function Ea(){const{masto:t,instance:n}=K();He("Followed Hashtags","/fh");const[i,s]=A("default"),[o,a]=A([]);return W(()=>{s("loading"),(async()=>{try{const l=await Wt();a(l),s("default")}catch{s("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:o.length>0?e(_,{children:[e("ul",{class:"link-list",children:o.map(l=>e("li",{children:e(oe,{to:n?`/${n}/t/${l.name}`:`/t/${l.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:l.name})]})}))}),o.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[o.length," hashtag",o.length===1?"":"s"]})})]}):i==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):i==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const La=20;function Cn({title:t,path:n,id:i,...s}){He(t||"Following",n||"/following");const{masto:o,streaming:a,instance:l}=K(),u=De(C),r=H(),p=H();async function f(d){(d||!r.current)&&(r.current=o.v1.timelines.home.list({limit:La}));const h=await r.current.next();let{value:g}=h;if(g!=null&&g.length){let y=!1;d&&(g[0].id!==p.current&&(y=!0),p.current=g[0].id),g.forEach(k=>{ze(k,l)}),g=Yn(g,l),d&&y&&Go(),Ls(g,l),g.sort((k,m)=>{const b=new Date(k.createdAt);return new Date(m.createdAt)-b})}return{...h,value:g}}async function c(){var d;try{const h=await o.v1.timelines.home.list({limit:5,since_id:p.current}).next();let{value:g}=h;const y=((d=g[0])==null?void 0:d.id)===p.current;return!!(g!=null&&g.length&&!y&&(p.current=g[0].id,g=Yn(g,l),g=At(g,"home"),g.some(k=>!k.reblog)))}catch{return!1}}return W(()=>{let d;return(async()=>{if(a){d=a.user.subscribe();for await(const h of d){if(!d)break;if(h.event==="status.update"){const g=h.payload;ze(g,l)}else if(h.event==="delete"){const g=h.payload,y=ds(g,l);y&&(y._deleted=!0)}}}})(),()=>{var h;(h=d==null?void 0:d.unsubscribe)==null||h.call(d),d=null}},[a]),e(lt,{title:t||"Following",id:i||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:l,fetchItems:f,checkForUpdates:c,useItemID:!0,boostsCarousel:u.settings.boostsCarousel,...s,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const Ma=20,Pa=4,Zn=Pa+1;function Ds({media:t,columnMode:n,...i}){let{hashtag:s,...o}=n?{}:mt();i.hashtag&&(s=i.hashtag);let a=s.trim().split(/[\s+]+/);a.sort(),s=a[0];const[l,u]=nt(),r=t||!!l.get("media"),p=r?"?media=1":"",{masto:f,instance:c,authenticated:d}=K({instance:(i==null?void 0:i.instance)||o.instance}),{masto:h,instance:g,authenticated:y}=K(),k=a.map(E=>`#${E}`).join(" "),m=r?" (Media only)":"",b=c?`${k}${m} on ${c}`:`${k}${m}`;He(b,"/:instance?/t/:hashtag");const I=H(),v=be(()=>un(),[]),S=H(void 0);async function T(E){const P=await f.v1.timelines.tag.$select(s).list({limit:Ma,any:a.slice(1),maxId:E?void 0:S.current,onlyMedia:r?!0:void 0}).next();let{value:N}=P;return N!=null&&N.length&&(E&&(I.current=N[0].id),N.forEach(D=>{ze(D,c,{skipThreading:r||v})}),S.current=N[N.length-1].id),{...P,value:N}}async function U(){var E;try{const P=await f.v1.timelines.tag.$select(s).list({limit:1,any:a.slice(1),since_id:I.current,onlyMedia:r}).next();let{value:N}=P;const D=((E=N[0])==null?void 0:E.id)===I.current;return N!=null&&N.length&&!D?(N=At(N,"public"),!0):!1}catch{return!1}}const[V,G]=A("default"),[L,ee]=A();W(()=>{(async()=>{try{const E=await f.v1.tags.$select(s).fetch();ee(E)}catch{}})()},[s]);const q=a.length>=Zn;return e(lt,{title:b,titleComponent:!!c&&e("h1",{class:"header-double-lines",children:[e("b",{children:k}),e("div",{children:c})]}),id:"hashtag",instance:c,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:T,checkForUpdates:U,useItemID:!0,view:r||v?"media":void 0,refresh:r,filterContext:"public",headerEnd:e(Ke,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!L&&a.length===1&&e(_,{children:[e(Qe,{subMenu:!0,confirm:L.following,confirmLabel:`Unfollow #${s}?`,disabled:V==="loading"||!d,onClick:()=>{G("loading"),L.following?f.v1.tags.$select(s).unfollow().then(()=>{ee({...L,following:!1}),ie(`Unfollowed #${s}`)}).catch(E=>{alert(E)}).finally(()=>{G("default")}):f.v1.tags.$select(s).follow().then(()=>{ee({...L,following:!0}),ie(`Followed #${s}`)}).catch(E=>{alert(E)}).finally(()=>{G("default")})},children:L.following?e(_,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(_,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(Fe,{})]}),!v&&e(_,{children:[e(fs,{className:"plain",children:"Filters"}),e(pe,{type:"checkbox",checked:!!r,onClick:()=>{r?l.delete("media"):l.set("media","1"),u(l)},children:[e(w,{icon:"check-circle"})," ",e("span",{class:"menu-grow",children:"Media only"})]}),e(Fe,{})]}),e(li,{className:"menu-field",disabled:q,children:({ref:E})=>e("form",{onSubmit:P=>{var D,Q;P.preventDefault();const N=(Q=(D=P.target[0].value)==null?void 0:D.trim)==null?void 0:Q.call(D);N&&!a.some(he=>he.toLowerCase()===N.toLowerCase())&&(a.push(N),a.sort(),location.hash=c?`/${c}/t/${a.join("+")}`:`/t/${a.join("+")}${p}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:E,type:"text",placeholder:q?`Max ${Zn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellCheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:q})]})}),e(di,{takeOverflow:!0,children:a.map((E,P)=>e(pe,{disabled:a.length===1,onClick:N=>{a.splice(P,1),a.sort(),location.hash=c?`/${c}/t/${a.join("+")}${p}`:`/t/${a.join("+")}${p}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),E]})]},E))}),e(Fe,{}),e(pe,{disabled:!y,onClick:()=>{if(C.shortcuts.length>=at){alert(`Max ${at} shortcuts reached. Unable to add shortcut.`);return}const E={type:"hashtag",hashtag:a.join(" "),instance:c,media:r?"on":void 0};C.shortcuts.some(N=>N.type===E.type&&N.hashtag.split(/[\s+]+/).sort().join(" ")===E.hashtag.split(/[\s+]+/).sort().join(" ")&&(N.instance?N.instance===E.instance:!0)&&(N.media?!!N.media==!!E.media:!0))?alert("This shortcut already exists"):(C.shortcuts.push(E),ie("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(pe,{onClick:()=>{let E=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(E)){E&&alert("Invalid instance");return}E&&(E=E.toLowerCase().trim(),location.hash=`/${E}/t/${a.join("+")}${p}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),g!==c&&e(pe,{onClick:()=>{location.hash=`/${g}/t/${a.join("+")}${p}`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:g}),")"]})]})]})},c+k)}const Na=20;function Us(t){var m;const n=De(C),{masto:i,instance:s}=K(),o=(t==null?void 0:t.id)||((m=mt())==null?void 0:m.id),a=H(),l=H();async function u(b){(b||!l.current)&&(l.current=i.v1.timelines.list.$select(o).list({limit:Na}));const I=await l.current.next();let{value:v}=I;return v!=null&&v.length&&(b&&(a.current=v[0].id),v.forEach(S=>{ze(S,s)})),{...I,value:v}}async function r(){var b;try{const I=await i.v1.timelines.list.$select(o).list({limit:1,since_id:a.current});let{value:v}=I;const S=((b=v[0])==null?void 0:b.id)===a.current;return v!=null&&v.length&&!S?(v=At(v,"home"),!0):!1}catch{return!1}}const[p,f]=A([]);W(()=>{Pt().then(f)},[]);const[c,d]=A({title:"List"});He(c.title,"/l/:id"),W(()=>{(async()=>{try{const b=await xs(o);d(b)}catch{}})()},[o]);const[h,g]=A(!1),[y,k]=A(!1);return e(_,{children:[e(lt,{title:c.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:s,fetchItems:u,checkForUpdates:r,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:e(Ke,{overflow:"auto",menuButton:e("button",{type:"button",class:"plain",children:[e(w,{icon:"list",size:"l",alt:"Lists"}),e(w,{icon:"chevron-down",size:"s"})]}),children:[e(Le,{to:"/l",children:e("span",{children:"All Lists"})}),(p==null?void 0:p.length)>0&&e(_,{children:[e(Fe,{}),p.map(b=>e(Le,{to:`/l/${b.id}`,children:e("span",{children:b.title})},b.id))]})]}),headerEnd:e(Ke,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(pe,{onClick:()=>g({list:c}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(pe,{onClick:()=>k(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},o),h&&e(Re,{onClick:b=>{b.target===b.currentTarget&&g(!1)},children:e(wn,{list:h==null?void 0:h.list,onClose:b=>{b.state==="success"&&b.list?d(b.list):b.state==="deleted"&&(location.hash="/l"),g(!1)}})}),y&&e(Re,{onClick:b=>{b.target===b.currentTarget&&k(!1)},children:e(Ua,{listID:o,onClose:()=>k(!1)})})]})}const Da=40;function Ua({listID:t,onClose:n}){const{masto:i,instance:s}=K(),[o,a]=A([]),[l,u]=A("default"),[r,p]=A(!1),f=H();async function c(d){p(!1),u("loading"),(async()=>{try{(d||!f.current)&&(f.current=i.v1.lists.$select(t).accounts.list({limit:Da}));const h=await f.current.next();let{done:g,value:y}=h;y!=null&&y.length?(a(d?y:o.concat(y)),p(!g)):p(!1),u("default")}catch{u("error")}})()}return W(()=>{c(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[o.map(d=>e("li",{children:[e(Xe,{account:d,instance:s}),e(Fa,{account:d,listID:t})]},d.id)),r&&l==="default"&&e(ct,{as:"li",onChange:d=>d&&c(),children:e("button",{type:"button",class:"light block",onClick:c,children:"Show more…"})})]})})]})}function Fa({account:t,listID:n}){const{masto:i}=K(),[s,o]=A("default"),[a,l]=A(!1);return e(Qe,{confirm:!a,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{a?(o("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),o("default"),l(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await i.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),o("default"),l(!0)}catch{o("error")}})())},children:e("button",{type:"button",class:`light ${a?"":"danger"}`,disabled:s==="loading",children:a?"Add":"Remove…"})})}const Oa={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function Fs(t){return t.filter(n=>{const{type:i,id:s,createdAt:o}=n;if(!i)return!1;const a=Oa[i];return a!=null&&a.length?a.every(l=>!!n[l]):!0})}function Os(t){t=Fs(t);const n={},i=[];for(let a=0,l=0;a<t.length;a++){const u=t[a],{id:r,status:p,account:f,type:c,createdAt:d}=u,h=d?new Date(d).toLocaleDateString():"";let g=c;(c==="favourite"||c==="reblog")&&(g="favourite+reblog");const y=`${p==null?void 0:p.id}-${g}-${h}`,k=n[y];if(g==="follow_request")i[l++]=u;else if(k!=null&&k.account){const m=k._accounts.find(b=>b.id===f.id);m?(m._types.push(c),m._types.sort().reverse(),k.id+=`-${r}`):(f._types=[c],k._accounts.push(f),k.id+=`-${r}`)}else{f&&(f._types=[c]);let m=n[y]={...u,type:g,_accounts:f?[f]:[]};i[l++]=m}}const s={},o=[];for(let a=0,l=0;a<i.length;a++){const u=i[a],{id:r,account:p,_accounts:f,type:c,createdAt:d}=u,h=d?new Date(d).toLocaleDateString():"";if(c==="favourite+reblog"&&p&&f.length===1){const g=`${p==null?void 0:p.id}-${c}-${h}`,y=s[g];if(y)y._statuses.push(u.status),y.id+=`-${r}`;else{let k=s[g]={...u,type:c,_statuses:[u.status]};o[l++]=k}}else o[l++]=u}return o}const Qn=20,Ba=new URLSearchParams;function Bs({columnMode:t,...n}){const{masto:i,instance:s}=K(),[o]=t?[Ba]:nt(),[a,l]=A(null),u=(n==null?void 0:n.type)||o.get("type")||a;He(`Mentions${u==="private"?" (Private)":""}`,"/mentions");const r=H(),p=H();async function f(m){(m||!r.current)&&(r.current=i.v1.notifications.list({limit:Qn,types:["mention"]}));const b=await r.current.next();let{value:I}=b;return I!=null&&I.length&&(I=Fs(I),m&&(p.current=I[0].id),I.forEach(({status:v})=>{ze(v,s)})),{...b,value:I==null?void 0:I.map(v=>v.status)}}const c=H(),d=H();async function h(m){(m||!c.current)&&(c.current=i.v1.conversations.list({limit:Qn}));const b=await c.current.next();let{value:I}=b;return I=I==null?void 0:I.filter(v=>v.lastStatus),I!=null&&I.length&&(m&&(d.current=I[0].lastStatus.id),I.forEach(({lastStatus:v})=>{ze(v,s)})),{...b,value:I==null?void 0:I.map(v=>v.lastStatus)}}function g(...m){return u==="private"?h(...m):f(...m)}async function y(){var m;if(u==="private")try{const b=await i.v1.conversations.list({limit:1,since_id:d.current}).next();let{value:I}=b;const v=((m=I[0])==null?void 0:m.id)===d.current;return I!=null&&I.length&&!v?(d.current=I[0].lastStatus.id,!0):!1}catch{return!1}else try{const b=await i.v1.notifications.list({limit:1,types:["mention"],since_id:p.current}).next();let{value:I}=b;return I!=null&&I.length?(p.current=I[0].id,!0):!1}catch{return!1}}const k=be(()=>e("div",{class:"filter-bar centered",children:[e(oe,{to:"/mentions",class:u?"":"is-active",onClick:m=>{t&&(m.preventDefault(),l(null))},children:"All"}),e(oe,{to:"/mentions?type=private",class:u==="private"?"is-active":"",onClick:m=>{t&&(m.preventDefault(),l("private"))},children:"Private"})]}),[u]);return e(lt,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:s,fetchItems:g,checkForUpdates:y,useItemID:!0,timelineStart:k,refresh:u})}const za=30,Ha=new URLSearchParams,Ft={block:"center",inline:"center",behavior:"smooth"};function qa({columnMode:t}){var F;He("Notifications","/notifications");const{masto:n,instance:i}=K(),s=De(C),[o,a]=A("default"),[l]=t?[Ha]:nt(),u=l.get("id"),r=l.get("access_token"),[p,f]=A(!1),[c,d]=A(!1),h=H(),{nearReachEnd:g,scrollDirection:y,reachStart:k,nearReachStart:m}=Yo({scrollableRef:h}),b=y==="end"&&!m,[I,v]=A([]),[S,T]=A([]),U=H();async function V(R){var M;if((R||!U.current)&&(U.current=n.v1.notifications.list({limit:za,excludeTypes:["follow_request"]})),/max_id=($|&)/i.test((M=U.current)==null?void 0:M.nextParams))return{done:!0};const J=await U.current.next(),te=J.value;if(te!=null&&te.length){te.forEach(X=>{ze(X.status,i,{skipThreading:!0})});const Y=Os(te);R?(C.notificationsLast=te[0],C.notifications=Y,n.v1.markers.create({notifications:{lastReadId:te[0].id}}).catch(()=>{})):C.notifications.push(...Y)}return C.notificationsShowNew=!1,C.notificationsLastFetchTime=Date.now(),J}async function G(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const L=()=>{a("loading"),(async()=>{try{const R=await G();v(R),a("default")}catch{a("error")}})()};async function ee(){try{return await n.v1.announcements.list()}catch{return[]}}const q=st("@mastodon/filtered-notifications"),[E,P]=A(!1),[N,D]=A({});function Q(){return n.v1.notifications.policy.fetch().catch(()=>{})}function he(){Q().then(R=>{D(R)}).catch(()=>{})}const[Ie,ae]=A(null);function se(){return n.v1.notifications.requests.list()}const fe=R=>{ye(!1),a("loading"),(async()=>{try{const J=V(R);R&&(ee().then(M=>{M.sort((Y,X)=>{const ke=new Date(Y.updatedAt||Y.createdAt);return new Date(X.updatedAt||X.createdAt)-ke}),T(M)}).catch(()=>{}),G().then(M=>{v(M)}).catch(()=>{}),q&&he());const{done:te}=await J;f(!te),a("default")}catch{a("error")}})()};W(()=>{fe(!0)},[]),W(()=>{k&&fe(!0)},[k]);const[ce,ye]=A(!1),Se=Ze(({disableIdleCheck:R=!1}={})=>{var J;o!=="loading"&&s.settings.autoRefresh&&((J=h.current)==null?void 0:J.scrollTop)<16&&(R||window.__IDLE__)&&!Va()&&fe(!0)},[s.notificationsShowNew,s.settings.autoRefresh,o]),Ce=H();Ct(R=>{if(R){const J=Date.now()-Ce.current;!Ce.current||J>1e3*3?Se({disableIdleCheck:!0}):Ce.current=Date.now()}}),W(()=>{let R=ui(C,"notificationsShowNew",J=>{o!=="loading"&&(J&&Se(),ye(J))});return()=>R==null?void 0:R()},[]);const Be=new Date,Pe=new Date(Be-24*60*60*1e3);let Ee=new Date;const Ne=!s.notifications.some(R=>new Date(R.createdAt).toDateString()===Be.toDateString()),j=H();W(()=>{u&&(C.routeNotification={id:u,accessToken:atob(r)})},[u,r]);const le=".notification",ne=Me("j",()=>{const R=document.activeElement.closest(le),J=R==null?void 0:R.getBoundingClientRect(),te=Array.from(h.current.querySelectorAll(le));if(R&&J.top<h.current.clientHeight&&J.bottom>0){const M=te.indexOf(R);let Y=te[M+1];Y&&(Y.focus(),Y.scrollIntoView(Ft))}else{const M=te.find(Y=>{const X=Y.getBoundingClientRect();return X.top>=44&&X.left>=0});M&&(M.focus(),M.scrollIntoView(Ft))}}),re=Me("k",()=>{const R=document.activeElement.closest(le),J=R==null?void 0:R.getBoundingClientRect(),te=Array.from(h.current.querySelectorAll(le));if(R&&J.top<h.current.clientHeight&&J.bottom>0){const M=te.indexOf(R);let Y=te[M-1];Y&&(Y.focus(),Y.scrollIntoView(Ft))}else{const M=te.find(Y=>{const X=Y.getBoundingClientRect();return X.top>=44&&X.left>=0});M&&(M.focus(),M.scrollIntoView(Ft))}}),xe=Me(["enter","o"],()=>{const R=document.activeElement.closest(le),J=R==null?void 0:R.querySelector(".status-link");J&&J.click()});return e("div",{id:"notifications-page",class:"deck-container",ref:R=>{h.current=R,ne.current=R,re.current=R,xe.current=R},tabIndex:"-1",children:[e("div",{class:`timeline-deck deck ${c?"only-mentions":""}`,children:[e("header",{hidden:b,onClick:R=>{var J;R.target.closest("a, button")||(J=h.current)==null||J.scrollTo({top:0,behavior:"smooth"})},onDblClick:R=>{R.target.closest("a, button")||fe(!0)},class:o==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side",children:q&&e("button",{type:"button",class:"button plain4",onClick:()=>{P(!0)},children:e(w,{icon:"settings",size:"l",alt:"Notifications settings"})})})]}),ce&&o!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var R;fe(!0),(R=h.current)==null||R.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),S.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",S.length>1?"s":""]})," ",e("small",{class:"insignificant",children:i})]}),S.length>1&&e("span",{class:"announcements-nav-buttons",children:S.map((R,J)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var te;(te=j.current)==null||te.children[J].scrollIntoView({behavior:"smooth",block:"nearest"})},children:J+1}))})]}),e("ul",{class:`announcements-list-${S.length>1?"multiple":"single"}`,ref:j,children:S.map(R=>e("li",{children:e(Ga,{announcement:R})}))})]})})}),I.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),I.length>5?e("details",{children:[e("summary",{children:[I.length," follow requests"]}),e("ul",{children:I.map(R=>e("li",{children:[e(Xe,{account:R}),e(cn,{accountID:R.id,onChange:()=>{}})]},R.id))})]}):e("ul",{children:I.map(R=>e("li",{children:[e(Xe,{account:R}),e(cn,{accountID:R.id,onChange:()=>{}})]},R.id))})]}),q&&((F=N==null?void 0:N.summary)==null?void 0:F.pendingRequestsCount)>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("div",{class:"filtered-notifications",children:e("details",{onToggle:async R=>{const{open:J}=R.target;if(J){const te=await se();ae(te)}},children:[e("summary",{children:["Filtered notifications from"," ",N.summary.pendingRequestsCount," people"]}),Ie?(Ie==null?void 0:Ie.length)>0&&e("ul",{children:Ie.map(R=>{var J,te;return e("li",{children:[e("div",{class:"request-notifcations",children:[!((J=R.lastStatus)!=null&&J.id)&&e(Xe,{useAvatarStatic:!0,showStats:!0,account:R.account}),((te=R.lastStatus)==null?void 0:te.id)&&e("div",{class:"last-post",children:e(oe,{class:"status-link",to:`/${i}/s/${R.lastStatus.id}`,children:e(Oe,{status:R.lastStatus,size:"s",readOnly:!0})})}),e(ja,{request:R})]}),e(Wa,{request:R,onChange:()=>{fe(!0)}})]},R.id)})}):e("p",{class:"ui-state",children:e(Te,{abrupt:!0})})]})})})}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:c,onChange:R=>{d(R.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),Ne&&e("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":e(_,{children:"…"})}),s.notifications.length?e(_,{children:s.notifications.filter(R=>R.type!=="follow_request").map(R=>{if(c&&R.type!=="mention")return null;const J=new Date(R.createdAt),te=J.toDateString()!==Ee.toDateString();te&&(Ee=J);const M=J.toDateString()===Pe.toDateString()?"Yesterday":ot(Ee,{hideTime:!0});return e(_,{children:[te&&e("h2",{class:"timeline-header",children:M}),e(Xt,{instance:i,notification:R},R.id)]},R.id)})}):e(_,{children:[o==="loading"&&e(_,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((R,J)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),o==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>fe(!0),children:"Try again"})]})]}),p&&e(ct,{onChange:R=>{R&&fe()},children:e("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>fe(),style:{marginBlockEnd:"6em"},children:o==="loading"?e(Te,{abrupt:!0}):e(_,{children:"Show more…"})})})]}),q&&E&&e(Re,{onClick:R=>{R.target===R.currentTarget&&P(!1)},children:e("div",{class:"sheet",id:"notifications-settings",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:()=>P(!1),children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Notifications settings"})}),e("main",{children:e("form",{onSubmit:R=>{R.preventDefault();const{filterNotFollowing:J,filterNotFollowers:te,filterNewAccounts:M,filterPrivateMentions:Y}=R.target,X={filterNotFollowing:J.checked,filterNotFollowers:te.checked,filterNewAccounts:M.checked,filterPrivateMentions:Y.checked};D({...N,...X}),P(!1),(async()=>{try{await n.v1.notifications.policy.update(X),ie("Notifications settings updated")}catch{}})()},children:[e("p",{children:"Filter out notifications from people:"}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:N.filterNotFollowing,name:"filterNotFollowing"})," ","You don't follow"]})}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:N.filterNotFollowers,name:"filterNotFollowers"})," ","Who don't follow you"]})}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:N.filterNewAccounts,name:"filterNewAccounts"})," ","With a new account"]})}),e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,defaultChecked:N.filterPrivateMentions,name:"filterPrivateMentions"})," ","Who unsolicitedly private mention you"]})}),e("p",{children:e("button",{type:"submit",children:"Save"})})]})})]})})]})}function Va(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Ga({announcement:t}){const{instance:n}=K(),{contact:i}=ls(),s=i==null?void 0:i.account,{id:o,content:a,startsAt:l,endsAt:u,published:r,allDay:p,publishedAt:f,updatedAt:c,read:d,mentions:h,statuses:g,tags:y,emojis:k,reactions:m}=t,b=new Date(f),I=ot(b),v=new Date(c),S=ot(v);return e("div",{class:"announcement-block",children:[e(Xe,{account:s}),e("div",{class:"announcement-content",onClick:bs({mentions:h,instance:n}),dangerouslySetInnerHTML:{__html:sn(a,{emojis:k})}}),e("p",{class:"insignificant",children:[e("time",{datetime:b.toISOString(),children:ot(b)}),c&&S!==I&&e(_,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:v.toISOString(),children:ot(v)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:m.map(T=>{const{name:U,count:V,me:G,staticUrl:L,url:ee}=T;return e("button",{type:"button",class:`plain4 small ${G?"reacted":""}`,children:[ee||L?e("img",{src:ee||L,alt:U,width:"16",height:"16"}):e("span",{children:U})," ",e("span",{class:"count",children:Ge(V)})]})})})]})}function Ya(t){const{masto:n}=K();return n.v1.notifications.list({accountID:t})}function ja({request:t}){var c;const{instance:n}=K(),[i,s]=A("loading"),{account:o,lastStatus:a}=t,[l,u]=A(!1),[r,p]=A([]);function f(){u(!1)}return W(()=>{var d;(d=t==null?void 0:t.account)!=null&&d.id&&l&&(s("loading"),(async()=>{const h=await Ya(t.account.id);p(h||[]),s("default")})())},[l,(c=t==null?void 0:t.account)==null?void 0:c.id]),e(_,{children:[e("button",{type:"button",class:"plain4 request-notifications-account",onClick:()=>{u(!0)},children:[e(w,{icon:"notification",class:"more-insignificant"})," ",e("small",{children:["View notifications from @",o.username]})," ",e(w,{icon:"chevron-down"})]}),l&&e(Re,{onClick:d=>{d.target===d.currentTarget&&f()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:f,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Notifications from @",o.username]})}),e("main",{children:i==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):r.map(d=>e("div",{class:"notification-peek",onClick:h=>{const{target:g}=h;(h.target.tagName==="BUTTON"||h.target.tagName==="A")&&f()},children:e(Xt,{instance:n,notification:d,isStatic:!0})}))})]})})]})}function Wa({request:t,onChange:n}){const{masto:i}=K(),[s,o]=A("default"),[a,l]=A(null),u=a!==null;return e("p",{class:"notification-request-buttons",children:[e("button",{type:"button",disabled:s==="loading"||u,onClick:()=>{o("loading"),(async()=>{try{await i.v1.notifications.requests.$select(t.id).accept(),l("accept"),o("default"),n({request:t,state:"accept"}),ie(`Notifications from @${t.account.username} will not be filtered from now on.`)}catch{o("error"),ie("Unable to accept notification request")}})()},children:"Allow"})," ",e("button",{type:"button",disabled:s==="loading"||u,class:"light danger",onClick:()=>{o("loading"),(async()=>{try{await i.v1.notifications.requests.$select(t.id).dismiss(),l("dismiss"),o("default"),n({request:t,state:"dismiss"}),ie(`Notifications from @${t.account.username} will not show up in Filtered notifications from now on.`)}catch{o("error"),ie("Unable to dismiss notification request")}})()},children:"Dismiss"}),e("span",{class:"notification-request-states",children:s==="loading"?e(Te,{abrupt:!0}):a==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"notification-accepted"}):a==="dismiss"&&e(w,{icon:"x-circle",alt:"Dismissed",class:"notification-dismissed"})})]})}const zs=Je(qa),Ka=20;function rn({local:t,columnMode:n,...i}){const s=De(C),o=!!t,a=n?{}:mt(),{masto:l,instance:u}=K({instance:(i==null?void 0:i.instance)||a.instance}),{masto:r,instance:p}=K(),f=`${o?"Local":"Federated"} timeline (${u})`;He(f,o?"/:instance?/p/l":"/:instance?/p");const c=H(),d=H();async function h(y){(y||!d.current)&&(d.current=l.v1.timelines.public.list({limit:Ka,local:o,remote:!o}));const k=await d.current.next();let{value:m}=k;return m!=null&&m.length&&(y&&(c.current=m[0].id),m.forEach(b=>{ze(b,u)})),{...k,value:m}}async function g(){var y;try{const k=await l.v1.timelines.public.list({limit:1,local:o,since_id:c.current}).next();let{value:m}=k;const b=((y=m[0])==null?void 0:y.id)===c.current;return m!=null&&m.length&&!b?(m=At(m,"public"),!0):!1}catch{return!1}}return e(lt,{title:f,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:o?"Local timeline":"Federated timeline"}),e("div",{children:u})]}),id:"public",instance:u,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:h,checkForUpdates:g,useItemID:!0,headerStart:e(_,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",headerEnd:e(Ke,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(pe,{href:o?`/#/${u}/p`:`/#/${u}/p/l`,children:o?e(_,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(_,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(Fe,{}),e(pe,{onClick:()=>{let y=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(y)){y&&alert("Invalid instance");return}y&&(y=y.toLowerCase().trim(),location.hash=o?`/${y}/p/l`:`/${y}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),p!==u&&e(pe,{onClick:()=>{location.hash=o?`/${p}/p/l`:`/${p}/p`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:p}),")"]})]})]})},u+o)}const Ot=5,nn=40,Ja=new URLSearchParams;function Hs({columnMode:t,...n}){const i=t?{}:mt(),{masto:s,instance:o,authenticated:a}=K({instance:i.instance}),[l,u]=A("default"),[r]=t?[Ja]:nt(),p=H(),f=(n==null?void 0:n.query)||r.get("q"),c=t?"statuses":(n==null?void 0:n.type)||r.get("type");He(f?`Search: ${f}${c?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[c]})`:""}`:"Search","/search");const[d,h]=A(!1),g=H(0);W(()=>{g.current=0},[f,c]);const y=H();rt(()=>{var E,P;(P=(E=y.current)==null?void 0:E.scrollTo)==null||P.call(E,0,0)},[f,c]);const[k,m]=A([]),[b,I]=A([]),[v,S]=A([]);W(()=>{m([]),I([]),S([])},[f]);const T={statuses:m,accounts:I,hashtags:S},[U,V]=A({}),G=async E=>{if(!(E!=null&&E.length))return;const P=await vn(E,U);P&&V({...U,...P})};function L(E){E&&(g.current=0),!(!E&&!a)&&(u("loading"),E&&!c&&(m(k.slice(0,Ot)),I(b.slice(0,Ot)),S(v.slice(0,Ot))),(async()=>{var N,D;const P={q:f,resolve:a,limit:Ot};c&&(P.limit=nn,P.type=c,a&&(P.offset=g.current));try{const Q=await s.v2.search.fetch(P);if(c)if(E){T[c](Q[c]);const he=(N=Q[c])==null?void 0:N.length;g.current=nn,h(!!he)}else{T[c](Ie=>[...Ie,...Q[c]]);const he=(D=Q[c])==null?void 0:D.length;g.current=g.current+nn,h(!!he)}else m(Q.statuses||[]),I(Q.accounts||[]),S(Q.hashtags||[]),g.current=0,h(!1);G(Q.accounts),u("default")}catch{u("error")}})())}const ee=H();Ct(E=>{var N;const P=((N=y.current)==null?void 0:N.scrollTop)===0;if(E&&P){const D=Date.now()-ee.current;!ee.current||D>1e3*3?L(!0):ee.current=Date.now()}}),W(()=>{var E,P,N,D;(P=(E=p.current)==null?void 0:E.setValue)==null||P.call(E,f||""),f?L(!0):(D=(N=p.current)==null?void 0:N.focus)==null||D.call(N)},[f,c,o]),Me(["/","Slash"],E=>{var P,N,D,Q;(N=(P=p.current)==null?void 0:P.focus)==null||N.call(P),(Q=(D=p.current)==null?void 0:D.select)==null||Q.call(D)},{preventDefault:!0});const[q]=hn();return e("div",{id:"search-page",class:"deck-container",ref:y,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:l==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(bt,{})}),e(Es,{ref:p}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{L(!0)},disabled:l==="loading",children:e(w,{icon:"search",size:"l"})})})]})}),e("main",{children:[!!f&&!t&&e("div",{ref:q,class:`filter-bar ${l==="loading"?"loading":""}`,children:[!!c&&e(oe,{to:`/search${f?`?q=${encodeURIComponent(f)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(f)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(f)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(f)}&type=statuses`}].sort((E,P)=>E.type===c?-1:P.type===c?1:0).map(E=>e(oe,{to:E.to,children:E.label},E.type))]}),f?e(_,{children:[(!c||c==="accounts")&&e(_,{children:[c!=="accounts"&&e("h2",{class:"timeline-header",children:["Accounts"," ",e(oe,{to:`/search?q=${encodeURIComponent(f)}&type=accounts`,children:e(w,{icon:"arrow-right",size:"l"})})]}),b.length>0?e(_,{children:[e("ul",{class:"timeline flat accounts-list",children:b.map(E=>e("li",{children:e(Xe,{account:E,instance:o,showStats:!0,relationship:U[E.id]})},E.id))}),c!=="accounts"&&e("div",{class:"ui-state",children:e(oe,{class:"plain button",to:`/search?q=${encodeURIComponent(f)}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!c&&(l==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!c||c==="hashtags")&&e(_,{children:[c!=="hashtags"&&e("h2",{class:"timeline-header",children:["Hashtags"," ",e(oe,{to:`/search?q=${encodeURIComponent(f)}&type=hashtags`,children:e(w,{icon:"arrow-right",size:"l"})})]}),v.length>0?e(_,{children:[e("ul",{class:"link-list hashtag-list",children:v.map(E=>{var Q;const{name:P,history:N}=E,D=(Q=N==null?void 0:N.reduce)==null?void 0:Q.call(N,(he,Ie)=>he+ +Ie.uses,0);return e("li",{children:e(oe,{to:o?`/${o}/t/${P}`:`/t/${P}`,children:[e(w,{icon:"hashtag"}),e("span",{children:P}),!!D&&e("span",{class:"count",children:Ge(D)})]})},`${P}-${D}`)})}),c!=="hashtags"&&e("div",{class:"ui-state",children:e(oe,{class:"plain button",to:`/search?q=${encodeURIComponent(f)}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!c&&(l==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!c||c==="statuses")&&e(_,{children:[c!=="statuses"&&e("h2",{class:"timeline-header",children:["Posts"," ",e(oe,{to:`/search?q=${encodeURIComponent(f)}&type=statuses`,children:e(w,{icon:"arrow-right",size:"l"})})]}),k.length>0?e(_,{children:[e("ul",{class:"timeline",children:k.map(E=>e("li",{children:e(oe,{class:"status-link",to:o?`/${o}/s/${E.id}`:`/s/${E.id}`,children:e(Oe,{status:E})})},E.id))}),c!=="statuses"&&e("div",{class:"ui-state",children:e(oe,{class:"plain button",to:`/search?q=${encodeURIComponent(f)}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!c&&(l==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!c&&(l==="default"?d?e(ct,{onChange:E=>{E&&L()},children:e("button",{type:"button",class:"plain block",onClick:()=>L(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):l==="loading"&&e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}))]}):l==="loading"?e("p",{class:"ui-state",children:e(Te,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const Xa=20,Za=ut(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Qa(t){return st("@pixelfed/trending")?t.pixelfed.v2.discover.posts.trending.list({range:"daily"}):t.v1.trends.statuses.list({limit:Xa})}function qs({columnMode:t,...n}){const i=De(C),s=t?{}:mt(),{masto:o,instance:a}=K({instance:(n==null?void 0:n.instance)||s.instance}),{masto:l,instance:u}=K(),r=`Trending (${a})`;He(r,"/:instance?/trending");const p=H(),[f,c]=A([]),[d,h]=A([]),g=H();async function y(b){var S;if(b||!g.current){if(g.current=Qa(o),st("@mastodon/trending-hashtags"))try{const T=o.v1.trends.tags.list(),{value:U}=await T.next();U!=null&&U.length&&c(U)}catch{}if(st("@mastodon/trending-links"))try{const{value:T}=await Za(o,a),U=(S=T==null?void 0:T.filter)==null?void 0:S.call(T,V=>V.type==="link");U!=null&&U.length&&h(U)}catch{}}const I=await g.current.next();let{value:v}=I;return v!=null&&v.length&&(b&&(p.current=v[0].id),v.forEach(T=>{ze(T,a)})),{...I,value:v}}async function k(){try{const b=await o.v1.trends.statuses.list({limit:1}).next();let{value:I}=b;return I=At(I,"public"),I!=null&&I.length&&I[0].id!==p.current?(p.current=I[0].id,!0):!1}catch{return!1}}const m=be(()=>e(_,{children:[!!f.length&&e("div",{class:"filter-bar expandable",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),f.map((b,I)=>{const{name:v,history:S}=b,T=S.reduce((U,V)=>U+ +V.uses,0);return e(oe,{to:`/${a}/t/${v}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),v]}),e("span",{class:"filter-count",children:Ge(T)})]},v)})]}),!!d.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),d.map(b=>{const{authorName:I,authorUrl:v,blurhash:S,description:T,height:U,image:V,imageDescription:G,language:L,providerName:ee,providerUrl:q,publishedAt:E,title:P,url:N,width:D}=b,Q=xt.toUnicode(new URL(N).hostname.replace(/^www\./,"").replace(/\/$/,""));let he;if(S){const Ie=pn(S),ae=kn(Ie);he=Sn([.6,ae[1],ae[2]])}return e("a",{href:N,target:"_blank",rel:"noopener noreferrer",style:he?{"--accent-color":`rgb(${he.join(",")})`,"--accent-alpha-color":`rgba(${he.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:V,alt:G,width:D,height:U,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:Q})," ",!!E&&e(_,{children:"· "}),!!E&&e(_,{children:e(gt,{datetime:E,format:"micro"})})]}),!!P&&e("h1",{class:"title",lang:L,dir:"auto",title:P,children:P})]}),!!T&&e("p",{class:"description",lang:L,dir:"auto",title:T,children:T})]})]})},N)})]})]}),[f,d]);return e(lt,{title:r,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:"Trending"}),e("div",{children:a})]}),id:"trending",instance:a,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:y,checkForUpdates:k,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(_,{}),boostsCarousel:i.settings.boostsCarousel,filterContext:"public",timelineStart:m,headerEnd:e(Ke,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(pe,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),u!==a&&e(pe,{onClick:()=>{location.hash=`/${u}/trending`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:u}),")"]})]})]})},a)}function ec(){He("Home","/");const t=De(C),{shortcuts:n}=t,i=n.map(s=>{if(!s)return null;const{type:o,...a}=s,l={following:Cn,notifications:zs,list:Us,public:rn,bookmarks:Ms,favourites:Ps,hashtag:Ds,mentions:Bs,trending:qs,search:Hs}[o];return!l||o==="search"&&!a.query||o==="list"&&!a.id?null:e(l,{...a,columnMode:!0},o+JSON.stringify(a))});return Me(["1","2","3","4","5","6","7","8","9"],(s,o)=>{try{const a=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[a].focus()}catch{}}),e("div",{id:"columns",onContextMenu:s=>{s.target.closest(".deck > header")&&!s.target.closest("a")&&!s.target.closest("button")&&(s.preventDefault(),C.showShortcutsSettings=!0)},children:i})}function tc(){var n;const t=De(C);return W(()=>{(async()=>{const i=await et.drafts.keys();if(i.length){const s=Yt();i.filter(a=>a.startsWith(s)).length&&(C.showDrafts=!0)}})()},[]),e(_,{children:(t.settings.shortcutsViewMode==="multi-column"||!t.settings.shortcutsViewMode&&t.settings.shortcutsColumnsMode)&&((n=t.shortcuts)!=null&&n.length)?e(ec,{}):e(Cn,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(nc,{})})})}function nc(){const t=De(C),n=H(),[i,s]=A(void 0);return e(_,{children:[e(oe,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${i||""}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),s(a=>a?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(oc,{state:i,anchorRef:n,onClose:()=>s(void 0)})]})}const sc=30,ic=5;function oc({anchorRef:t,state:n,onClose:i}){const{masto:s,instance:o}=K(),a=De(C),[l,u]=A("default"),r=s.v1.notifications.list({limit:sc});async function p(){const g=await r.next(),y=g.value;if(y!=null&&y.length){y.forEach(m=>{ze(m.status,o,{skipThreading:!0})});const k=Os(y);C.notificationsLast=y[0],C.notifications=k,s.v1.markers.create({notifications:{lastReadId:y[0].id}}).catch(()=>{})}return C.notificationsShowNew=!1,C.notificationsLastFetchTime=Date.now(),g}const[f,c]=A(!1);function d(){return s.v1.followRequests.list({limit:1})}function h(){u("loading"),(async()=>{try{await p();const g=await d();c(!!(g!=null&&g.length)),u("default")}catch{u("error")}})()}return W(()=>{n==="open"&&h()},[n]),e(ps,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:i,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:a.notifications.length?e(_,{children:a.notifications.slice(0,ic).map(g=>e(Xt,{instance:o,notification:g,disableContextMenu:!0},g.id))}):l==="loading"?e("div",{class:"ui-state",children:e(Te,{abrupt:!0})}):l==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:h,children:"Try again"})})]})}),e("footer",{children:[e(oe,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(oe,{to:"/notifications",class:"button plain2",children:[f?e(_,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const ac=Je(tc),cc=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i,/^\/p\/[^\/]+\/([^\/]+)/i];function Vs(t){const{hostname:n,pathname:i}=new URL(t);for(const s of cc){const[,o]=i.match(s)||[];if(o)return{instance:n,id:o}}return{}}function rc(t){const{instance:n,id:i}=Vs(t);return n&&i?`/${n}/s/${i}`:null}function lc(){const n=Tt().pathname.replace(/^\//,""),i=Vs(n),s=i!=null&&i.instance?`/${i.instance}/s/${i.id}`:null,[o,a]=A("loading");return rt(()=>{a("loading"),(async()=>{try{const{instance:l,id:u}=i,{masto:r}=K({instance:l});if(await r.v1.statuses.$select(u).fetch()){window.location.hash=s+"?view=full";return}}catch{}{const{masto:l,instance:u}=K(),r=await l.v2.search.fetch({q:n,limit:1,resolve:!0});if(r.statuses.length){const p=r.statuses[0];window.location.hash=`/${u}/s/${p.id}?view=full`}else if(r.accounts.length){const p=r.accounts[0];window.location.hash=`/${u}/a/${p.id}`}else s?window.location.hash=s+"?view=full":a("error")}})()},[s]),e("div",{class:"ui-state",tabIndex:"-1",children:[o==="loading"?e(_,{children:[e(Te,{abrupt:!0}),e("h2",{children:"Resolving…"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):e(_,{children:[e("h2",{children:"Unable to resolve URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(oe,{to:"/",children:"Go home"})})]})}function dc(){He("Lists","/l");const[t,n]=A("default"),[i,s]=ft(r=>r+1,0),[o,a]=A([]);W(()=>{n("loading"),(async()=>{try{const r=await an();a(r),n("default")}catch{n("error")}})()},[i]);const[l,u]=A(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(bt,{}),e(oe,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>u(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:o.length>0?e(_,{children:[e("ul",{class:"link-list",children:o.map(r=>e("li",{children:e(oe,{to:`/l/${r.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:r.title})]})})}))}),o.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[o.length," list",o.length===1?"":"s"]})})]}):t==="loading"?e("p",{class:"ui-state",children:e(Te,{})}):t==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),l&&e(Re,{onClick:r=>{r.target===r.currentTarget&&u(!1)},children:e(wn,{list:l==null?void 0:l.list,onClose:r=>{r.state==="success"&&s(),u(!1)}})})]})}const uc=""+new URL("instances-MzK7fGXv.json",import.meta.url).href;var hc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:pc,PHANPY_WEBSITE:fc}=hc,Tn="read write follow push";async function mc({instanceURL:t}){const n=new URLSearchParams({client_name:pc,redirect_uris:location.origin+location.pathname,scopes:Tn,website:fc});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function gc({instanceURL:t,client_id:n}){const i=new URLSearchParams({client_id:n,scope:Tn,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${i.toString()}`}async function bc({instanceURL:t,client_id:n,client_secret:i,code:s}){const o=new URLSearchParams({client_id:n,client_secret:i,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:s,scope:Tn});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}var yc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:wc}=yc;function vc(){var b,I;He("Log in");const t=H(),n=we.local.get("instanceURL"),[i,s]=A("default"),[o]=nt(),a=o.get("instance"),l=o.get("submit"),[u,r]=A(a||(n==null?void 0:n.toLowerCase())||""),[p,f]=A([]),c=H();W(()=>{(async()=>{try{const S=await(await fetch(uc)).json();f(S),c.current=new hi(S)}catch{}})()},[]);const d=v=>{v&&(we.local.set("instanceURL",v),(async()=>{s("loading");try{const{client_id:S,client_secret:T,vapid_key:U}=await mc({instanceURL:v});S&&T?(we.session.set("clientID",S),we.session.set("clientSecret",T),we.session.set("vapidKey",U),location.href=await gc({instanceURL:v,client_id:S})):alert("Failed to register application"),s("default")}catch{s("error")}})())},h=u?u.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,g=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(h)&&!/[\s\/\\@]/.test(h),y=h?(I=(b=c.current)==null?void 0:b.search(h,{limit:10}))==null?void 0:I.map(v=>v.item):[],k=g?h:y!=null&&y.length?y[0]:u?p.find(v=>v.includes(u)):null,m=v=>{v.preventDefault(),d(k)};return l&&W(()=>{d(a||k)},[]),e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:m,children:[e("h1",{children:[e("img",{src:bn,alt:"",width:"80",height:"80"}),e("br",{}),"Log in"]}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:u,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:i==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellCheck:!1,placeholder:"instance domain",onInput:v=>{r(v.target.value)}}),(y==null?void 0:y.length)>0?e("ul",{id:"instances-suggestions",children:y.map((v,S)=>e("li",{children:e("button",{type:"button",class:"plain5",onClick:()=>{d(v)},children:v})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),i==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{disabled:i==="loading"||!u||!k,children:k?`Continue with ${k}`:"Continue"})," "]}),e(Te,{hidden:i!=="loading"}),e("hr",{}),!wc&&e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(oe,{to:"/",children:"Go home"})})]})})}const Bt=40,kc=10,Sc=5;let ln={},qt={},Vt={};function Gt(t){delete qt[t],delete Vt[t]}const _t={block:"nearest",inline:"center",behavior:"smooth"},es=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",ts=/\/s\//i;function Ic(t){var v;const{id:n}=t,{masto:i,instance:s}=K({instance:t.instance}),o=De(C),[a,l]=nt(),u=a.get("media"),r=a.get("media-only"),p=parseInt(u||r,10);let f=p>0;const c=a.get("mediaStatusID"),d=ds(c,s);c&&!d&&(f=!1);const h=f&&!!r,g=We(n,s),[y,k]=A(C.statuses[g]);W(()=>{C.statuses[g]&&k(C.statuses[g])},[g]);const m=be(()=>{const{prevLocation:S}=C,T=((S==null?void 0:S.pathname)||"")+((S==null?void 0:S.search)||""),U=Lt("/:instance/s/:id",T)||Lt("/s/:id",T);return!T||U?"/":T},[]);W(()=>{!y&&f&&(async()=>{try{const S=await i.v1.statuses.$select(n).fetch();ze(S,s),k(S)}catch{alert("Unable to load post."),location.hash=m}})()},[f]);const b=c?(v=o.statuses[We(c,s)])==null?void 0:v.mediaAttachments:y==null?void 0:y.mediaAttachments,I=Ze(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():h?location.hash=m:(a.delete("media"),a.delete("mediaStatusID"),l(a))},[h,m,o.prevLocation]);return W(()=>{let S=setTimeout(()=>{const T=document.querySelector(".carousel");T&&T.focus()},100);return()=>clearTimeout(S)},[h]),e("div",{class:"deck-backdrop",children:[f?b!=null&&b.length?e(_s,{mediaAttachments:b,statusID:c||n,instance:s,lang:y==null?void 0:y.language,index:p-1,onClose:I}):e("div",{class:"media-modal-container loading",children:e(Te,{abrupt:!0})}):e(oe,{to:m}),!h&&e(Tc,{id:n,instance:t.instance,closeLink:m})]})}function Cc(t){const{linkable:n,to:i,onClick:s,...o}=t;return n?e(oe,{class:"status-link",to:i,onClick:s,...o}):e("div",{class:"status-focus",tabIndex:0,...o})}function Tc({id:t,closeLink:n="/",instance:i}){var J,te;const[s,o]=nt(),a=s.get("media"),l=s.get("mediaStatusID"),u=parseInt(a,10)>0,r=H(!C.prevLocation&&(history.length===1||"navigation"in window&&((te=(J=navigation==null?void 0:navigation.entries)==null?void 0:J.call(navigation))==null?void 0:te.length)===1)),[p,f]=A(s.get("view")||r.current?"full":null),c=!!parseInt(s.get("translate")),{masto:d,instance:h}=K({instance:i}),{masto:g,instance:y,authenticated:k}=K(),m=h===y,b=De(C),[I,v]=A([]),[S,T]=A("default"),U=H(),V=We(t,h),G=H(0),L=H();W(()=>{var M;(M=L.current)==null||M.focus()},[]),W(()=>{var Y;const M=ms(()=>{if(!L.current)return;const{scrollTop:X}=L.current;S!=="loading"&&(Vt[t]=X)},50);return(Y=L.current)==null||Y.addEventListener("scroll",M,{passive:!0}),M(),()=>{var X;M.cancel(),(X=L.current)==null||X.removeEventListener("scroll",M)}},[t,S!=="loading"]);const ee=H(),q=H(),E=({reloadHero:M}={})=>{T("loading");let Y;const X=qt[t];if(X){const ke=X.filter(x=>C.statuses[V]);v(ke)}else v([{id:t}]);return(async()=>{var B,z;const ke=()=>Rn(()=>d.v1.statuses.$select(t).fetch(),{retries:4}),x=Rn(()=>d.v1.statuses.$select(t).context.fetch(),{retries:8}),$=!!b.statuses[V];let O=b.statuses[V];if(!($&&!M))try{O=await ke(),ze(O,h),await new Promise(ve=>{setTimeout(ve,100)})}catch{T("error");return}try{let ve=function(Z){return Z==null?void 0:Z.map(_e=>({id:_e.id,account:_e.account,repliesCount:_e.repliesCount,content:_e.content,weight:Et(_e),replies:ve(_e.__replies)}))};const me=await x,{ancestors:de,descendants:ge}=me;G.current=(ge==null?void 0:ge.length)||0;const Ae=new Set;de.forEach(Z=>{ze(Z,h,{skipThreading:!0}),Z.inReplyToId&&!de.find(_e=>_e.id===Z.inReplyToId)&&Ae.add(Z.inReplyToId)});const qe=de.every(Z=>Z.account.id===O.account.id),$e=[];ge.forEach(Z=>{if(ze(Z,h,{skipThreading:!0}),Z.inReplyToId&&!ge.find(_e=>_e.id===Z.inReplyToId)&&Z.inReplyToId!==O.id&&Ae.add(Z.inReplyToId),Z.inReplyToAccountId===Z.account.id)$e.push(Z);else if(Z.inReplyToId===O.id)$e.push(Z);else if(!Z.inReplyToAccountId&&$e.find(_e=>_e.id===Z.inReplyToId)&&Z.account.id===O.account.id)$e.push(Z);else{const _e=ge.find(yt=>yt.id===Z.inReplyToId);_e&&(_e.__replies||(_e.__replies=[]),_e.__replies.push(Z))}}),Ae.size;const Ve=[...de.map(Z=>({id:Z.id,ancestor:!0,isThread:qe,accountID:Z.account.id,account:Z.account,repliesCount:Z.repliesCount,weight:Et(Z)})),{id:t,accountID:O.account.id,weight:Et(O)},...$e.map(Z=>({id:Z.id,account:Z.account,accountID:Z.account.id,descendant:!0,thread:Z.account.id===O.account.id,weight:Et(Z),replies:ve(Z.__replies)}))];T("default"),ee.current={offsetTop:(B=U.current)==null?void 0:B.offsetTop,scrollTop:(z=L.current)==null?void 0:z.scrollTop};const ue=Ve.findIndex(Z=>Z.id===t);ue>=se&&fe(ue+1),v(Ve),qt[t]=Ve,Xs(O,h)}catch{T("error")}})(),q.current=Date.now(),()=>{clearTimeout(Y)}};W(E,[t,d]);const[P,N]=A(!1);W(()=>{let M=setInterval(()=>{const Y=Date.now();q.current&&Y-q.current>=6e4&&N(!0)},6e4);return()=>{clearInterval(M)}},[]),rt(()=>{var Y,X;if(!I.length)return;const M=Vt[t];if(M)L.current.scrollTop=M;else if(ee.current){const ke={offsetTop:(Y=U.current)==null?void 0:Y.offsetTop,scrollTop:(X=L.current)==null?void 0:X.scrollTop},x=ke.offsetTop-ee.current.offsetTop+ke.scrollTop;L.current.scrollTop=x}else I.length===1&&(L.current.scrollTop=0);ee.current=null},[I]),W(()=>{b.reloadStatusPage<=0||(async()=>{try{const{instanceURL:M}=St(),Y=`https://${M}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(Y,{ignoreVary:!0}),E({reloadHero:!0})}catch{}})()},[b.reloadStatusPage]),W(()=>()=>{Vt={},C.reloadStatusPage=0,qt={},ln={},dn.clear()},[]);const D=b.statuses[V]||b.statuses[t],Q=be(()=>{if(!D)return"";const{account:M}=D,Y=document.createElement("div");return Y.innerHTML=M.displayName,Y.innerText.trim()},[D]),he=be(()=>{if(!D)return"";let M=gn(D);return M.length>64&&(M=M.slice(0,64)+"…"),M},[D]);He(Q&&he?`${Q}: "${he}"`:"Status","/:instance?/s/:id");const Ie=be(()=>{if(!D)return;const{url:M}=D;if(M)return new URL(M).hostname},[D]),ae=be(()=>{if(Ie)return Ie===h},[Ie,h]),[se,fe]=A(Bt),ce=be(()=>I.length-se,[I.length,se]),ye=I.some(M=>M.descendant),Se=I.filter(M=>M.ancestor),[Ce,Be]=A(!0),Pe=be(()=>{if(!U.current||Ce)return null;const{top:M}=U.current.getBoundingClientRect();return M>0?"down":"up"},[Ce]);Me("esc",()=>{location.hash=n},{enabled:!u,ignoreEventWhen:M=>!!document.querySelector("#modal-container > *")}),Me("backspace",()=>{location.hash=n}),Me("j",()=>{const M=document.activeElement.closest(".status-link, .status-focus"),Y=M==null?void 0:M.getBoundingClientRect(),X=Array.from(L.current.querySelectorAll(es));if(M&&Y.top<L.current.clientHeight&&Y.bottom>0){const ke=X.indexOf(M);let x=X[ke+1];x&&(x.focus(),x.scrollIntoView(_t))}else{const ke=X.find(x=>{const $=x.getBoundingClientRect();return $.top>=44&&$.left>=0});ke&&(ke.focus(),ke.scrollIntoView(_t))}}),Me("k",()=>{const M=document.activeElement.closest(".status-link, .status-focus"),Y=M==null?void 0:M.getBoundingClientRect(),X=Array.from(L.current.querySelectorAll(es));if(M&&Y.top<L.current.clientHeight&&Y.bottom>0){const ke=X.indexOf(M);let x=X[ke-1];x&&(x.focus(),x.scrollIntoView(_t))}else{const ke=X.find(x=>{const $=x.getBoundingClientRect();return $.top>=44&&$.left>=0});ke&&(ke.focus(),ke.scrollIntoView(_t))}}),Me("x",()=>{const M=document.activeElement.closest(".status-link, .status-focus");if(M){const Y=M.nextElementSibling;Y&&Y.tagName.toLowerCase()==="details"&&(Y.open=!Y.open)}});const[Ee,Ne]=A(!1),j=H(u?"media+status":"status"),le=Ze((M,Y,X,ke)=>{M.preventDefault(),M.stopPropagation(),o({media:Y+1,mediaStatusID:ke.id})},[t]),ne=Ze((M,Y)=>{Gt(Y.id)},[]);W(()=>{let M;return l&&u&&(M=setTimeout(()=>{var X;const Y=(X=L.current)==null?void 0:X.querySelector(`.status-link[href*="/${l}"]`);Y&&Y.scrollIntoView(_t)},400)),()=>{clearTimeout(M)}},[l,u]);const re=Ze((M,Y)=>{const{id:X,ancestor:ke,isThread:x,descendant:$,thread:O,replies:B,repliesCount:z,weight:ve}=M,me=X===t;return e("li",{ref:me?U:null,class:`${ke?"ancestor":""} ${$?"descendant":""} ${O?"thread":""} ${me?"hero":""}`,children:[me?e(_,{children:[e(ct,{threshold:.1,onChange:ge=>{queueMicrotask(()=>{requestAnimationFrame(()=>{Be(ge)})})},class:"status-focus",tabIndex:0,children:e(Oe,{statusID:X,instance:h,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:c})}),S!=="loading"&&!k?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(oe,{to:"/login",class:"button",children:"Log in"})]}):!m&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:h}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:S==="loading",onClick:()=>{T("loading"),(async()=>{try{const ge=await g.v2.search.fetch({q:D.url,type:"statuses",resolve:!0,limit:1});if(ge.statuses.length){const Ae=ge.statuses[0];location.hash=y?`/${y}/s/${Ae.id}`:`/s/${Ae.id}`}else throw new Error("No results")}catch(ge){T("default"),alert("Error: "+ge)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(Cc,{linkable:x||ke,to:h?`/${h}/s/${X}`:`/s/${X}`,onClick:()=>{Gt(X)},children:[Y===0&&ke?e(ct,{threshold:.5,onChange:ge=>{queueMicrotask(()=>{requestAnimationFrame(()=>{Ne(ge)})})},children:e(Oe,{statusID:X,instance:h,withinContext:!0,size:O||ke?"m":"s",enableTranslate:!0,onMediaClick:le,onStatusLinkClick:ne})}):e(Oe,{statusID:X,instance:h,withinContext:!0,size:O||ke?"m":"s",enableTranslate:!0,onMediaClick:le,onStatusLinkClick:ne,showActionsBar:!!$}),ke&&z>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:z,children:Ge(z)})]})," "]}),$&&(B==null?void 0:B.length)>0&&e(Gs,{instance:h,replies:B,hasParentThread:O,level:1,accWeight:ve,openAll:G.current<kc,parentLink:{to:h?`/${h}/s/${X}`:`/s/${X}`,onClick:()=>Gt(X)}}),S==="loading"&&me&&!!(D!=null&&D.repliesCount)&&!ye&&e("div",{class:"status-loading",children:e(Te,{abrupt:D.repliesCount>=3})}),S==="error"&&me&&!!(D!=null&&D.repliesCount)&&!ye&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{C.reloadStatusPage++},children:"Try again"})]})]},X)},[t,h,S,k,m,c,le,ne,ye]),xe=be(()=>{var M;if("navigation"in window&&(navigation!=null&&navigation.entries)){const Y=navigation.entries()[navigation.currentEntry.index-1];if(Y!=null&&Y.url)return ts.test(Y.url)}return ts.test((M=C.prevLocation)==null?void 0:M.pathname)},[V]),F=be(()=>{if(!ce)return[];const M=[];function Y(X){M.push(X.id),X.replies&&X.replies.forEach(Y)}return I.slice(se).forEach(Y),M.map(X=>We(X,h))},[ce,I,se,h]),R=be(()=>I.slice(0,se).map(re),[I,se,re]);return e("div",{tabIndex:"-1",ref:L,class:`status-deck deck contained ${I.length>1?"padded-bottom":""} ${j.current==="status"&&!r.current?"slide-in":""} ${p?`deck-view-${p}`:""}`,onAnimationEnd:M=>{j.current==="status"&&(j.current=null)},children:[e("header",{class:`${S==="loading"?"loading":""}`,onDblClick:M=>{C.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[xe&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!Ce&&D&&S!=="loading"?e(_,{children:[e("span",{class:"hero-heading",children:[e(It,{account:D.account,instance:h,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(gt,{datetime:D.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:M=>{M.preventDefault(),M.stopPropagation(),U.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:Pe==="down"?"arrow-down":"arrow-up"})})]}):e(_,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:M=>{M.preventDefault(),M.stopPropagation(),L.current.scrollTo({top:0,behavior:"smooth"})},hidden:!Se.length||Ee,title:`${Se.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),Se.filter((M,Y,X)=>X.findIndex(ke=>ke.accountID===M.accountID)===Y).slice(0,3).map(M=>e(tt,{url:M.account.avatar,alt:M.account.displayName},M.account.id)),Se.length>3&&e(_,{children:[" ",e("span",{class:"insignificant",children:Ge(Se.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:p==="full"?"":"none"},onClick:()=>{f(null),s.delete("media"),s.delete("media-only"),s.delete("view"),o(s)},title:"Switch to Side Peek view",children:e(w,{icon:"layout4",size:"l"})}),P&&e("button",{type:"button",class:"plain button-refresh",onClick:()=>{C.reloadStatusPage++,N(!1)},children:e(w,{icon:"refresh",size:"l"})}),e(Ke,{align:"end",portal:{target:L.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(pe,{disabled:S==="loading",onClick:()=>{C.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(pe,{className:"menu-switch-view",onClick:()=>{f(p==="full"?null:"full"),s.delete("media"),s.delete("media-only"),p==="full"?s.delete("view"):s.set("view","full"),o(s)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[p||""]}),e("span",{children:["Switch to ",p==="full"?"Side Peek":"Full"," view"]})]}),e(pe,{onClick:()=>{Array.from(L.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(Y=>{Y.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(Fe,{}),e(fs,{className:"plain",children:"Experimental"}),e(pe,{disabled:!Ie||ae,onClick:()=>{const M=rc(D.url);M?location.hash=M:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance",Ie?e(_,{children:[" ","(",e("b",{children:xt.toUnicode(Ie)}),")"]}):""]})]})]}),e(oe,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),I.length&&D?e("ul",{class:`timeline flat contextual grow ${S==="loading"?"loading":""}`,children:[R,ce>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:S==="loading",onClick:()=>fe(M=>M+Bt),style:{marginBlockEnd:"6em"},"data-state-post-ids":F.join(" "),children:[e("div",{class:"ib avatars-bunch",children:I.slice(se,se+5).map(M=>e(tt,{url:M.account.avatarStatic},M.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:ce>Bt?`${Bt}+`:ce})]})]})})]}):e(_,{children:[S==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Oe,{skeleton:!0,size:"l"})})}),S==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{C.reloadStatusPage++},children:"Try again"})]})]})]})}function Gs({replies:t,instance:n,hasParentThread:i,level:s,accWeight:o,openAll:a,parentLink:l}){const[u,r]=nt(),p=b=>b.reduce((I,v)=>{const{repliesCount:S,replies:T}=v,U=(T==null?void 0:T.length)||S;return I+U+p(T||[])},0),f=t.length+p(t),c=t.length===f,d=t.map(b=>b.account).filter((b,I,v)=>v.findIndex(S=>S.id===b.id)===I).slice(0,3),h=be(()=>t==null?void 0:t.reduce((b,I)=>b+(I==null?void 0:I.weight),o),[o,t==null?void 0:t.length]);let g=!1;(a||h<=Sc||!i&&f===1&&Et(t[0])<2)&&(g=!0);const y=ln[t[0].id],k=Ze((b,I,v,S)=>{b.preventDefault(),b.stopPropagation(),r({media:I+1,mediaStatusID:S.id})},[]),m=H();return rt(()=>{var I;function b(v){v.target.dataset.scrollLeft=v.target.scrollLeft}return(I=m.current)==null||I.addEventListener("scroll",b,{passive:!0}),()=>{var v;(v=m.current)==null||v.removeEventListener("scroll",b)}},[]),e("details",{ref:m,class:"replies",open:y||g,onToggle:b=>{const{open:I}=b.target;ln[t[0].id]=I},style:{"--comments-level":s},"data-comments-level":s,"data-comments-level-overflow":s>4,children:[e("summary",{class:"replies-summary",hidden:g,children:[e("span",{class:"avatars",children:d.map(b=>e(tt,{url:b.avatarStatic,title:`${b.displayName} @${b.username}`,squircle:b==null?void 0:b.bot},b.id))}),e("span",{class:"replies-counts",children:[e("b",{children:[e("span",{title:t.length,children:Ge(t.length)})," ","repl",t.length===1?"y":"ies"]}),!c&&f>1&&e(_,{children:[" ","·"," ",e("span",{children:[e("span",{title:f,children:Ge(f)})," ","comment",f===1?"":"s"]})]})]}),e(w,{icon:"chevron-down",class:"replies-summary-chevron"}),!!l&&e(oe,{class:"replies-parent-link",to:l.to,onClick:l.onClick,title:"View post with its replies",children:"»"})]}),e("ul",{children:t.map(b=>{var I,v;return e("li",{children:[e("div",{class:"status-focus",tabIndex:0,children:[e(Oe,{statusID:b.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:k,showActionsBar:!0}),!((I=b.replies)!=null&&I.length)&&b.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:b.repliesCount,children:Ge(b.repliesCount)})]})]}),((v=b.replies)==null?void 0:v.length)&&e(Gs,{instance:n,replies:b.replies,level:s+1,accWeight:g?h:b.weight,openAll:a,parentLink:{to:n?`/${n}/s/${b.id}`:`/s/${b.id}`,onClick:()=>{Gt(b.id)}}})]},b.id)})})]})}const xc=140,Ac=35,$c=70,_c=140,dn=new Map;function Et(t){var h,g;const n=dn.get(t.id);if(n)return n;const{spoilerText:i,content:s,mediaAttachments:o,poll:a,card:l}=t,u=Ss(i+s),r=o!=null&&o.length?xc:0,p=(((h=a==null?void 0:a.options)==null?void 0:h.length)||0)*Ac,f=l&&(o!=null&&o.length||(g=a==null?void 0:a.options)!=null&&g.length)?0:$c,d=(u+r+p+f)/_c;return dn.set(t.id,d),d}const Rc=Je(Ic);function Ec(){const t=mt(),{id:n,instance:i}=t;return e(Rc,{id:n,instance:i})}const Lc=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,Mc=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,Pc=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,Nc=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,Dc=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,Uc="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var Fc={PHANPY_CLIENT_NAME:"Blaede Phanpy",PHANPY_WEBSITE:"https://phanpy.blaede.family",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_GIPHY_API_KEY:"48JGsrSS1XE5w4nWe9c9hqxPbsfRWR0e",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:Rt,PHANPY_WEBSITE:ns,PHANPY_PRIVACY_POLICY_URL:Oc,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:ss}=Fc,is=ns?ns.replace(/https?:\/\//g,"").replace(/\/$/,""):null,os=`${"2024-05-21T20:34:22.742Z".slice(0,10).replace(/-/g,".")}.6fec85a`;function as(){return He(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("div",{class:"hero-content",children:[e("h1",{children:[e("img",{src:bn,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:Uc,alt:"Phanpy",width:"200"})]}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),e("p",{children:e(oe,{to:Rt?`/login?instance=${Rt}&submit=1`:"/login",class:"button",children:Rt?"Log in":"Log in with Mastodon"})}),Rt&&ss&&e("p",{children:e("a",{href:ss,class:"button plain5",children:"Sign up"})}),!Rt&&e("p",{class:"insignificant",children:e("small",{children:["Connect your existing Mastodon/Fediverse account.",e("br",{}),"Your credentials are not stored on this server."]})})]}),(is||os)&&e("p",{class:"app-site-version",children:e("small",{children:[is," ",os]})}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),C.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:Oc,target:"_blank",children:"Privacy Policy"}),"."]})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:Lc,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:Dc,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:Mc,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:Pc,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:Nc,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Bc=window.alert;window.__nativeAlert||(window.__nativeAlert=Bc);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=pi({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=C;window.__STATES_STATS__=()=>{const t=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};t.forEach(o=>{n[o]=Object.keys(C[o]).length});const{statuses:i}=C,s=[];for(const o in i)document.querySelector(`[data-state-post-id~="${o}"], [data-state-post-ids~="${o}"]`)||s.push(o)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:t,unfurledLinks:n,notifications:i}=C;let s=0;const{instance:o}=K();for(const a in t){if(!window.__IDLE__)break;try{const l=document.querySelector(`[data-state-post-id~="${a}"], [data-state-post-ids~="${a}"]`),u=i.some(r=>{var p;return a===We((p=r.status)==null?void 0:p.id,o)});if(!l&&!u){delete C.statuses[a],delete C.statusQuotes[a];for(const r in n){const p=n[r];if(We(p.id,p.instance)===a){delete C.unfurledLinks[r];break}}s++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const t in Nt)queueMicrotask(()=>{var n,i,s,o;Array.isArray(Nt[t])?(i=(n=Nt[t])[0])==null||i.call(n):(o=(s=Nt)[t])==null||o.call(s)})},5e3);(()=>{window.__IDLE__=!0;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},s=ms(n,3e3),o=()=>{window.__IDLE__=!1,s()};t.forEach(a=>{window.addEventListener(a,o,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",a=>{!a.relatedTarget&&!a.toElement&&n()},{passive:!0})})();const zc=/iPad|iPhone|iPod/.test(navigator.userAgent);zc&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const t=we.local.get("theme");let n;if(t){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const i=n.content,s=t==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=s||"",setTimeout(()=>{n.content=i},10)}}else{const i=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${i}"]`),n){const s=n.dataset.content,o=n.dataset.contentTemp;n.content=o||"",setTimeout(()=>{n.content=s},10)}}}});{const t=we.local.get("theme");if(t){document.documentElement.classList.add(`is-${t}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",t||"dark light");const i=document.querySelector('meta[data-theme-setting="manual"]');i&&(i.name="theme-color",i.content=t==="light"?i.dataset.themeLightColor:i.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(o=>{o.name=""})}const n=we.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}us(C,t=>{var n;for(const[i,s,o,a]of t){if(s.join(".")==="settings.shortcutsViewMode"){const l=document.getElementById("app");l&&(l.dataset.shortcutsViewMode=(n=C.shortcuts)!=null&&n.length?o:"")}s.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",o)}});function Hc(){const[t,n]=A(!1),[i,s]=A("loading");W(()=>{const a=we.local.get("instanceURL"),l=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(l){window.history.replaceState({},document.title,window.location.pathname||"/");const u=we.session.get("clientID"),r=we.session.get("clientSecret"),p=we.session.get("vapidKey");(async()=>{s("loading");const{access_token:f}=await bc({instanceURL:a,client_id:u,client_secret:r,code:l}),c=Zs({instance:a,accessToken:f});await Promise.allSettled([xn(c,a),Qs(c,a,f,p)]),An(),$n(c),n(!0),s("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const u=St();if(u){rs(u.info.id);const{client:r}=K({account:u}),{instance:p}=r;An(),$n(r),s("loading"),(async()=>{try{await xn(r,p)}catch{}finally{n(!0),s("default")}})()}else s("default")}},[]);let o=Tt();return C.currentLocation=o.pathname,W(on,[o,t]),/\/https?:/.test(o.pathname)?e(lc,{}):e(_,{children:[e(qc,{isLoggedIn:t,loading:i==="loading"}),e(Vc,{isLoggedIn:t}),i==="default"&&e(fn,{children:e(Ue,{path:"/:instance?/s/:id",element:e(Ec,{})})}),t&&e(_i,{}),t&&e(zo,{}),e(Po,{}),t&&e(Fo,{}),e(xi,{isLoggedIn:t}),i!=="loading"&&e(Oo,{onClose:on}),e(Ri,{})]})}function qc({isLoggedIn:t,loading:n}){const i=Tt(),s=be(()=>{const{pathname:o}=i;return!/^\/(login|welcome)/i.test(o)},[i]);return e(fn,{location:s||i,children:[e(Ue,{path:"/",element:t?e(ac,{}):n?e(Te,{id:"loader-root"}):e(as,{})}),e(Ue,{path:"/login",element:e(vc,{})}),e(Ue,{path:"/welcome",element:e(as,{})})]})}function cs(){return C.prevLocation||null}function Vc({isLoggedIn:t}){const n=Tt(),i=H(cs());return be(()=>Lt("/:instance/s/:id",n.pathname)||Lt("/s/:id",n.pathname),[n.pathname,Lt])?i.current||(i.current=cs()):i.current=null,e(fn,{location:i.current||n,children:[t&&e(_,{children:[e(Ue,{path:"/notifications",element:e(zs,{})}),e(Ue,{path:"/mentions",element:e(Bs,{})}),e(Ue,{path:"/following",element:e(Cn,{})}),e(Ue,{path:"/b",element:e(Ms,{})}),e(Ue,{path:"/f",element:e(Ps,{})}),e(Ue,{path:"/l",children:[e(Ue,{index:!0,element:e(dc,{})}),e(Ue,{path:":id",element:e(Us,{})})]}),e(Ue,{path:"/fh",element:e(Ea,{})}),e(Ue,{path:"/ft",element:e(Aa,{})}),e(Ue,{path:"/catchup",element:e(pa,{})})]}),e(Ue,{path:"/:instance?/t/:hashtag",element:e(Ds,{})}),e(Ue,{path:"/:instance?/a/:id",element:e(sa,{})}),e(Ue,{path:"/:instance?/p",children:[e(Ue,{index:!0,element:e(rn,{})}),e(Ue,{path:"l",element:e(rn,{local:!0})})]}),e(Ue,{path:"/:instance?/trending",element:e(qs,{})}),e(Ue,{path:"/:instance?/search",element:e(Hs,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));mi(e(fi,{children:e(Hc,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-UXD36kg1.js.map
