import{a as q,s as v,b as ke,u as dn,o as qn,I as w,M as pe,c as X,A as Ve,N as Nt,d as Ne,L as G,g as Qe,e as un,l as Hn,t as Ht,R as _t,f as Vn,h as _e,i as hn,j as xt,E as fn,k as Ee,m as jn,n as Oe,p as Gn,q as ie,r as ge,v as Vt,T as pn,w as et,x as mn,y as jt,z as Wn,B as Ce,C as Kn,S as we,D as Jn,F as Yn,G as gn,H as bn,J as Pt,K as Se,O as yn,P as Xn,Q as Zn,U as Qn,V as rt,W as es,X as Gt,Y as ts,Z as Wt,_ as Kt}from"./useTitle-37d18384.js";import{_,p as z,x as Ge,h as T,u as ve,o as e,a as oe,k as x,s as vt,M as We,b as Z,c as De,m as bt,F as ue,T as je,S as ns,I as st,y as Pe,g as ss,l as Jt,d as is,e as wn,f as Ut,i as os,j as Ue,A as cs,n as as,J as ls,C as vn,q as kn,r as Sn,t as Ke,v as rs,w as ds,z as nt,B as us,D as Yt,E as hs,G as fs,R as It,H as fe,K as ps,L as ms}from"./vendor-6f584d39.js";function yt(t=()=>{},n=[]){const d=_(t);z(()=>{d.current=t},[n]),z(()=>{const o=()=>{const i=document.hidden||document.visibilityState==="hidden";d.current(!i)};return document.addEventListener("visibilitychange",o),()=>document.removeEventListener("visibilitychange",o)},[])}const gs=Ge(function({isLoggedIn:n}){const[d,o]=T(!0);yt(o),z(()=>{let r;if(n&&d){const{masto:c,streaming:m,instance:l}=q();(async()=>{var u;if(v.notificationsLast){const f=c.v1.notifications.list({limit:1,since_id:v.notificationsLast.id}),{value:p}=await f.next();if(p!=null&&p.length){let a;try{const h=await c.v1.markers.fetch({timeline:"notifications"});a=(u=h==null?void 0:h.notifications)==null?void 0:u.lastReadId}catch{}a?p[0].id!==a&&(v.notificationsShowNew=!0):v.notificationsShowNew=!0}}if(m){r=m.user.notification.subscribe();for await(const f of r){if(!r)break;f.event==="notification"&&ke(f.payload,l,{skipThreading:!0}),v.notificationsShowNew=!0}}})()}return()=>{var c;(c=r==null?void 0:r.unsubscribe)==null||c.call(r),r=null}},[d,n]);const i=_(),s=()=>{i.current=Date.now(),fetch("./version.json").then(r=>r.json()).then(r=>{r&&(v.appVersion=r)}).catch(r=>{})};return dn(s,d&&1e3*60*30),yt(r=>{r&&(i.current?Date.now()-i.current>1e3*60*60&&s():s())}),null});function bs(){function t(n){n.shiftKey?qn()||(alert("Looks like your browser is blocking popups."),v.showCompose=!0):v.showCompose=!0}return ve("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const ys=Ge(function(){const n=oe(v);function d(){v.showKeyboardShortcutsHelp=!1}ve("?, shift+?",i=>{v.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")});const o=ve("esc",d,[]);return!!n.showKeyboardShortcutsHelp&&e(pe,{class:"light",onClick:i=>{i.target===i.currentTarget&&d()},children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",ref:o,children:[e("button",{type:"button",class:"sheet-close",onClick:d,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e(x,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:"Toggle expanded/collapsed thread",keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(x,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(x,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Send post",keys:e(x,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Favourite",keys:e("kbd",{children:"f"})},{action:"Boost",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})}].map(({action:i,keys:s})=>e("tr",{children:[e("th",{children:i}),e("td",{children:s})]},i))})})]})})});function ws({onClose:t}){const{masto:n}=q(),d=X.local.getJSON("accounts"),o=X.session.get("currentAccount"),i=d.length>1,[s,r]=T(0),[c,m]=vt(l=>l+1,0);return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",children:d.map((l,u)=>{const f=l.info.id===o,p=u===(s||0);return e("li",{children:[e("div",{children:[i&&e("span",{class:`current ${f?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(Ve,{url:l.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const a=await n.v1.accounts.$select(l.info.id).fetch();l.info=a,X.local.setJSON("accounts",d),m()}catch{}}}),e(Nt,{account:i?{...l.info,acct:/@/.test(l.info.acct)?l.info.acct:`${l.info.acct}@${l.instanceURL}`}:l.info,showAcct:!0,onClick:()=>{f?v.showAccount=`${l.info.username}@${l.instanceURL}`:(X.session.set("currentAccount",l.info.id),location.reload())}})]}),e("div",{class:"actions",children:[p&&i&&e(x,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(We,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(Z,{onClick:()=>{v.showAccount=`${l.info.username}@${l.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(De,{}),i&&e(Z,{disabled:p,onClick:()=>{d.splice(u,1),d.unshift(l),X.local.setJSON("accounts",d),r(u)},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Ne,{subMenu:!0,confirmLabel:e(x,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",l.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{d.splice(u,1),X.local.setJSON("accounts",d),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},u+l.id)})}),e("p",{children:e(G,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),i&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const In=""+new URL("logo-f0531a6b.svg",import.meta.url).href;function Xt(t){const{masto:n}=q();return n.v1.push.subscription.create(t)}function vs(){const{masto:t}=q();return t.v1.push.subscription.fetch()}function ks(t){const{masto:n}=q();return n.v1.push.subscription.update(t)}function Ss(){const{masto:t}=q();return t.v1.push.subscription.remove()}function kt(){return"serviceWorker"in navigator&&"PushManager"in window}function Cn(){return navigator.serviceWorker.getRegistration()}async function Ft(){const t=await Cn(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Tn(t){const n="=".repeat((4-t.length%4)%4),d=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),o=window.atob(d),i=new Uint8Array(o.length);for(let s=0;s<o.length;++s)i[s]=o.charCodeAt(s);return i}async function Is(){if(!kt())return;const{subscription:t}=await Ft();let n=null;try{n=await vs()}catch(d){if(!/(not found|unknown)/i.test(d.message))throw d}if(n&&t){const d=n.endpoint===t.endpoint,{vapidKey:o}=Qe(),i=n.serverKey===o;if(!d)throw new Error("Backend subscription endpoint changed");if(!i)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:d}=Qe(),{applicationServerKey:o}=t.options,i=Tn(d).toString(),s=new Uint8Array(o).toString();if(!(i===s))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function Zt({data:t,policy:n}){if(!kt())return;let{registration:d,subscription:o}=await Ft(),i=null;if(o)try{i=await ks({data:t,policy:n})}catch{i=await Xt({subscription:o,data:t,policy:n})}else{const{vapidKey:s}=Qe();if(!s)throw new Error("No server key found");o=await d.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Tn(s)}),i=await Xt({subscription:o,data:t,policy:n})}return{subscription:o,backendSubscription:i}}async function Qt(){if(!kt())return;const{subscription:t}=await Ft();t&&(await Ss(),await t.unsubscribe())}const en=16,He=[16,17,18,19,20];function Cs({onClose:t}){const n=oe(v),d=X.local.get("theme")||"auto",o=_(),i=n.settings.contentTranslationTargetLanguage||null,s=un(),r=Hn(s),c=X.local.get("textSize")||en,[m,l]=T(X.account.get("preferences")||{}),{masto:u,authenticated:f,instance:p}=q();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:o,onInput:a=>{a.preventDefault();const g=new FormData(o.current).get("theme"),y=document.documentElement;g==="auto"?y.classList.remove("is-light","is-dark"):(y.classList.toggle("is-light",g==="light"),y.classList.toggle("is-dark",g==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",g==="auto"?"dark light":g),g==="auto"?X.local.del("theme"):X.local.set("theme",g)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:d==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:d==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:d!=="light"&&d!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:He[0]},children:"A"})," ",e("input",{type:"range",min:He[0],max:He[He.length-1],step:"1",value:c,list:"sizes",onChange:a=>{const h=parseInt(a.target.value,10);document.documentElement.style.setProperty("--text-size",`${h}px`),h===en?X.local.del("textSize"):X.local.set("textSize",a.target.value)}})," ",e("span",{style:{fontSize:He[He.length-1]},children:"A"}),e("datalist",{id:"sizes",children:He.map(a=>e("option",{value:a}))})]})]})]})}),f&&e(x,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:m["posting:default:visibility"]||"public",onChange:a=>{const{value:h}=a.target;(async()=>{try{await u.v1.accounts.updateCredentials({source:{privacy:h}}),l({...m,"posting:default:visibility":h}),X.account.set("preferences",{...m,"posting:default:visibility":h})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${p}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",p,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:a=>{v.settings.autoRefresh=a.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:a=>{v.settings.boostsCarousel=a.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:a=>{const{checked:h}=a.target;v.settings.contentTranslation=h,h||(v.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:i||"",disabled:!n.settings.contentTranslation,onChange:a=>{v.settings.contentTranslationTargetLanguage=a.target.value||null},children:[e("option",{value:"",children:["System language (",r,")"]}),e("option",{disabled:!0,children:"──────────"}),Ht.map(a=>e("option",{value:a.code,children:a.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(x,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Ht.map(a=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(a.code),onChange:h=>{const{checked:g}=h.target;g?v.settings.contentTranslationHideLanguages.push(a.code):v.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(y=>y!==a.code)}})," ",a.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses an external API to translate, powered by"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:a=>{v.settings.contentTranslationAutoInline=a.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:a=>{v.settings.cloakMode=a.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),f&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{v.showDrafts=!0,v.showSettings=!1},children:"Unsent drafts"})})]})}),f&&e(Ts,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:In,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),v.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:a=>{a.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[e("span",{class:"insignificant",children:"Last build:"})," ",e(_t,{datetime:new Date("2023-10-13T17:29:34.650Z")})," ",e(x,{children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/adecd64",target:"_blank",rel:"noopener noreferrer",children:e("code",{children:"adecd64"})}),")"]})]})]})]})]})}function Ts({onClose:t}){if(!kt())return null;const{instance:n}=q(),[d,o]=T("default"),i=_(),[s,r]=T(!1),[c,m]=T(!1),l=_();z(()=>{(async()=>{o("loading");try{const{subscription:f,backendSubscription:p}=await Is();if(p!=null&&p.policy&&p.policy!=="none"){r(!0);const{alerts:a,policy:h}=p;l.current=h;const{elements:g}=i.current,y=g.namedItem(h);y&&(y.value=h),Object.keys(a).forEach(b=>{const k=g.namedItem(b);(k==null?void 0:k.type)==="checkbox"&&(k.checked=!0)})}o("default")}catch(f){/outside.*authorized/i.test(f.message)?m(!0):alert((f==null?void 0:f.message)||f),o("error")}})()},[]);const u=d==="loading";return e("form",{ref:i,onChange:()=>{const f=Object.fromEntries(new FormData(i.current)),p=!!f["policy-allow"],a={policy:f.policy,data:{alerts:{mention:!!f.mention,favourite:!!f.favourite,reblog:!!f.reblog,follow:!!f.follow,follow_request:!!f.followRequest,poll:!!f.poll,update:!!f.update,status:!!f.status}}};let h=0;Object.keys(a.data.alerts).forEach(y=>{a.data.alerts[y]?h++:delete a.data.alerts[y]});const g=l.current!==a.policy;p&&h>0?g?Qt().then(()=>{Zt(a)}).catch(y=>{alert("Failed to update subscription. Please try again.")}):Zt(a).catch(y=>{alert("Failed to update subscription. Please try again.")}):Qt().catch(y=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:u||c,name:"policy-allow",checked:s,onChange:async f=>{const{checked:p}=f.target;if(p){const a=await Notification.requestPermission();a==="granted"?r(!0):(r(!1),a==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else r(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:u||c||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(f=>e("option",{value:f.value,children:f.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Favourites"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(f=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:f.value})," ",f.label]})}))})})})}),c&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(G,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const $t=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const d=document.querySelectorAll("#modal-container > *");if(d!=null&&d.length){const r=d[d.length-1],c=r.querySelector('[tabindex="-1"]')||r;if(c){c.focus();return}}if(document.querySelector(".deck-backdrop"))return;const i=document.querySelectorAll(".deck-container"),s=i[i.length-1];s&&s.tabIndex===-1&&s.focus()}},100);return()=>clearTimeout(t)};function zt({list:t,onClose:n}){const{masto:d}=q(),[o,i]=T("default"),s=!!t,r=_(),c=_(),m=_();z(()=>{s&&(r.current.value=t.title,c.current.value=t.repliesPolicy,m.current&&(m.current.checked=t.exclusive))},[s]);const l=Vn("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:s?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:u=>{u.preventDefault();const f=new FormData(u.target),p=f.get("title"),a=f.get("replies_policy"),h=f.get("exclusive")==="on";i("loading"),(async()=>{try{let g;s?g=await d.v1.lists.$select(t.id).update({title:p,replies_policy:a,exclusive:h}):g=await d.v1.lists.create({title:p,replies_policy:a,exclusive:h}),i("default"),n==null||n({state:"success",list:g})}catch{i("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:r,type:"text",id:"list-title",name:"title",required:!0,disabled:o==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:c,name:"replies_policy",required:!0,disabled:o==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),l&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:m,type:"checkbox",name:"exclusive",disabled:o==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:o==="loading",children:s?"Save":"Create"}),s&&e(Ne,{disabled:o==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{i("loading"),(async()=>{try{await d.v1.lists.$select(t.id).remove(),i("default"),n==null||n({state:"deleted"})}catch{i("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete…"})})]})]})})]})}const xs=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],tn={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"},nn=80,xn=1e3*60*10;function $s(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Ls=bt($s,{maxAge:xn});async function Rs(t,n){const d=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:o}=await d,i={total:o.length,originals:0,replies:0,boosts:0};return o.forEach(s=>{s.reblog?i.boosts++:s.inReplyToId&&s.inReplyToAccountId!==s.account.id?i.replies++:i.originals++}),o.length&&(i.daysSinceLastPost=Math.ceil((Date.now()-new Date(o[o.length-1].createdAt))/864e5)),i}const As=bt(Rs,{maxAge:xn});function $n({account:t,fetchAccount:n=()=>{},standalone:d,instance:o,authenticated:i}){const{masto:s}=q({instance:o}),{masto:r}=q(),[c,m]=T("default"),l=typeof t=="string",[u,f]=T(l?null:t),p=ue(()=>t.id===X.session.get("currentAccount"),[t==null?void 0:t.id]),a=ue(()=>o===q().instance,[o]);z(()=>{if(!l){f(t);return}m("loading"),(async()=>{try{const F=await n();v.accounts[`${F.id}@${o}`]=F,f(F),m("default")}catch{f(null),m("error")}})()},[l,t,n]);const{acct:h,avatar:g,avatarStatic:y,bot:b,createdAt:k,displayName:S,emojis:I,fields:$,followersCount:U,followingCount:L,group:R,id:j,lastStatusAt:A,locked:M,note:N,statusesCount:ne,url:J,username:Te,memorial:ye,moved:Q,roles:Re}=u||{};let xe=!1,{header:D,headerStatic:Y}=u||{};(!D||/missing\.png$/.test(D))&&g&&!/missing\.png$/.test(g)&&(D=g,xe=!0,y&&!/missing\.png$/.test(y)&&(Y=y));const te=ue(()=>J?new URL(J).hostname:null,[J]),[me,$e]=T([]),Ae=_(),V=_([]);async function ee(F){(F||!Ae.current)&&(Ae.current=s.v1.accounts.$select(j).followers.list({limit:nn}));const ae=await Ae.current.next();if(p||!a)return ae;const{value:be}=ae;let se=[];if(F){const ze=await s.v1.accounts.familiarFollowers(j).fetch();V.current=ze[0].accounts,se=[...V.current,...be.filter(Be=>!V.current.some(O=>O.id===Be.id))]}else be!=null&&be.length&&(se=be.filter(ze=>!V.current.some(Be=>Be.id===ze.id)));return{...ae,value:se}}const P=_();async function W(F){return(F||!P.current)&&(P.current=s.v1.accounts.$select(j).following.list({limit:nn})),await P.current.next()}const C=d?"div":G,E=o?`/${o}/a/${j}`:`/a/${j}`,[B,K]=T([]),[H,Le]=T(),[he,le]=T("default"),de=!!(H!=null&&H.total),ce=async F=>{try{const ae=await Ls(F,r);K(ae[0].accounts.slice(0,Ms))}catch{}},Ie=async()=>{if(j){le("loading");try{const F=await As(j,s);Le(F),le("default")}catch{le("error")}}},Me=je(({relationship:F,currentID:ae})=>{F.following||(ce(ae),d||Ie())},[d]);return e("div",{class:`account-container  ${c==="loading"?"skeleton":""}`,style:{"--header-color-1":me[0],"--header-color-2":me[1],"--header-color-3":me[2],"--header-color-4":me[3]},children:[c==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:l?t:J,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),c==="loading"?e(x,{children:[e("header",{children:e(_e,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"████████ ███████"}),e("p",{children:"███████████████ ███████████████"})]}),e("p",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]}),e("div",{children:"Joined ██"})]})]})]}):u&&e(x,{children:[!!Q&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:S})," has indicated that their new account is now:"]}),e(_e,{account:Q,instance:o,onClick:F=>{F.stopPropagation(),v.showAccount=Q}})]}),D&&!/missing\.png$/.test(D)&&e("img",{src:D,alt:"",class:`header-banner ${xe?"header-is-avatar":""}`,onError:F=>{F.target.crossOrigin?F.target.src!==Y?F.target.src=Y:(F.target.removeAttribute("crossorigin"),F.target.src=D):F.target.src!==Y?F.target.src=Y:F.target.remove()},crossOrigin:"anonymous",onLoad:F=>{F.target.classList.add("loaded");try{const ae=document.createElement("canvas"),be=ae.getContext("2d",{willReadFrequently:!0});ae.width=F.target.width,ae.height=F.target.height,be.drawImage(F.target,0,0);const se=10,Be=[be.getImageData(0,0,se,se).data,be.getImageData(F.target.width-se,0,se,se).data,be.getImageData(0,F.target.height-se,se,se).data,be.getImageData(F.target.width-se,F.target.height-se,se,se).data].map(O=>{let re=0,Je=0,ct=0,at=0;for(let Ye=0;Ye<O.length;Ye+=4)re+=O[Ye],Je+=O[Ye+1],ct+=O[Ye+2],at+=O[Ye+3];const lt=O.length/4;return[re/lt,Je/lt,ct/lt,at/lt]}).map(O=>{const[re,Je,ct,at]=Es(O);return`rgba(${re}, ${Je}, ${ct}, ${at})`});$e(Be)}catch{}}}),e("header",{children:e(_e,{account:u,instance:o,avatarSize:"xxxl",external:d,internal:!d})}),e("main",{tabIndex:"-1",children:[!!ye&&e("span",{class:"tag",children:"In Memoriam"}),!!b&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!R&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),Re==null?void 0:Re.map(F=>e("span",{class:"tag",children:[F.name,!!te&&e(x,{children:[" ",e("span",{class:"more-insignificant",children:te})]})]})),e("div",{class:"note",dir:"auto",onClick:hn({instance:o}),dangerouslySetInnerHTML:{__html:xt(N,{emojis:I})}}),e("div",{class:"account-metadata-box",children:[($==null?void 0:$.length)>0&&e("div",{class:"profile-metadata",children:$.map(({name:F,value:ae,verifiedAt:be},se)=>e("div",{class:`profile-field ${be?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(fn,{text:F,emojis:I})," ",!!be&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:xt(ae,{emojis:I})}})]},F+se))}),e("div",{class:"stats",children:[e(C,{tabIndex:0,to:E,onClick:()=>{v.showAccount=!1,v.showGenericAccounts={heading:"Followers",fetchAccounts:ee}},children:[!!B.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:B.map(F=>e(Ve,{url:F.avatarStatic,size:"s",alt:`${F.displayName} @${F.acct}`,squircle:F==null?void 0:F.bot}))})}),e("span",{title:U,children:Ee(U)})," ","Followers"]}),e(C,{class:"insignificant",tabIndex:0,to:E,onClick:()=>{v.showAccount=!1,v.showGenericAccounts={heading:"Following",fetchAccounts:W}},children:[e("span",{title:L,children:Ee(L)})," ","Following",e("br",{})]}),e(C,{class:"insignificant",to:E,onClick:d?void 0:()=>{jn()},children:[e("span",{title:ne,children:Ee(ne)})," ","Posts"]}),!!k&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:k,children:Oe(k,{hideTime:!0})})]})]})]}),!!H&&e(C,{to:E,class:"account-metadata-box",onClick:()=>{v.showAccount=!1},children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:de?e("div",{class:"posting-stats",title:`${Math.round(H.originals/H.total*100)}% original posts, ${Math.round(H.replies/H.total*100)}% replies, ${Math.round(H.boosts/H.total*100)}% boosts`,children:[e("div",{children:H.daysSinceLastPost<365?`Last ${H.total} posts in the past 
                      ${H.daysSinceLastPost} day${H.daysSinceLastPost>1?"s":""}`:`
                      Last ${H.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${H.originals/H.total*100}%`,"--replies-percentage":`${(H.originals+H.replies)/H.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!H,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:he==="loading",onClick:()=>{Ie()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${he==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})}),e(Ds,{info:u,instance:o,authenticated:i,onRelationshipChange:Me})]})]})]})}const Ms=3;function Ds({info:t,instance:n,authenticated:d,onRelationshipChange:o=()=>{}}){var ee;if(!t)return null;const{masto:i,instance:s,authenticated:r}=q(),c=n===s,[m,l]=T("default"),[u,f]=T(null),{id:p,acct:a,url:h,username:g,locked:y,lastStatusAt:b,note:k,fields:S,moved:I}=t,$=_(p),{following:U,showingReblogs:L,notifying:R,followedBy:j,blocking:A,blockedBy:M,muting:N,mutingNotifications:ne,requested:J,domainBlocking:Te,endorsed:ye}=u||{},[Q,Re]=T(null),[xe,D]=T(!1);z(()=>{if(t){const P=X.session.get("currentAccount");let W;(async()=>{if(c&&d)W=p;else if(!c&&r){const E=t.acct.includes("@");try{const B=await i.v2.search.fetch({q:E?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});B.accounts.length&&(W=B.accounts[0].id,Re(B.accounts[0]))}catch{}}if(!W)return;if(P===W){D(!0);return}if($.current=W,I)return;l("loading");const C=i.v1.accounts.relationships.fetch({id:[W]});try{const E=await C;if(l("default"),E.length){const B=E[0];f(B),o({relationship:B,currentID:W})}}catch{l("error")}})()}},[t,d]),z(()=>{t&&xe&&Gn(t)},[t,xe]);const Y=m==="loading",te=_(null),[me,$e]=T(!1),[Ae,V]=T(!1);return e(x,{children:[e("div",{class:"actions",children:[e("span",{children:[j?e("span",{class:"tag",children:"Following you"}):b?e("small",{class:"insignificant",children:["Last post:"," ",Oe(b,{hideTime:!0})]}):e("span",{}),N&&e("span",{class:"tag danger",children:"Muted"}),A&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[e(We,{instanceRef:te,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:P=>{var W,C;P.target===P.currentTarget&&((C=(W=te.current)==null?void 0:W.closeMenu)==null||C.call(W))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:Y,children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[r&&!xe&&e(x,{children:[e(Z,{onClick:()=>{v.showCompose={draftStatus:{status:`@${(Q==null?void 0:Q.acct)||a} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",g]})]}),e(Z,{onClick:()=>{$e(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),U&&e(Z,{onClick:()=>{V(!0)},children:[e(w,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(De,{})]}),e(Z,{href:h,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:Ns(h)})]}),e("div",{class:"menu-horizontal",children:[e(Z,{onClick:()=>{try{navigator.clipboard.writeText(h),ie("Link copied")}catch{ie("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((ee=navigator==null?void 0:navigator.canShare)==null?void 0:ee.call(navigator,{url:h}))&&e(Z,{onClick:()=>{try{navigator.share({url:h})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!u&&e(x,{children:[e(De,{}),N?e(Z,{onClick:()=>{l("loading"),(async()=>{try{const P=await i.v1.accounts.$select((Q==null?void 0:Q.id)||p).unmute();f(P),l("default"),ie(`Unmuted @${g}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{l("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",g]})]}):e(ns,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(x,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",g,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:xs.map(P=>e(Z,{onClick:()=>{l("loading"),(async()=>{try{const W=await i.v1.accounts.$select((Q==null?void 0:Q.id)||p).mute({duration:P});f(W),l("default"),ie(`Muted @${g} for ${tn[P]}`),v.reloadGenericAccounts.id="mute",v.reloadGenericAccounts.counter++}catch{l("error"),ie(`Unable to mute @${g}`)}})()},children:tn[P]}))})}),e(Ne,{subMenu:!0,confirm:!A,confirmLabel:e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",g,"?"]})]}),menuItemClassName:"danger",onClick:()=>{l("loading"),(async()=>{try{if(A){const P=await i.v1.accounts.$select((Q==null?void 0:Q.id)||p).unblock();f(P),l("default"),ie(`Unblocked @${g}`)}else{const P=await i.v1.accounts.$select((Q==null?void 0:Q.id)||p).block();f(P),l("default"),ie(`Blocked @${g}`)}v.reloadGenericAccounts.id="block",v.reloadGenericAccounts.counter++}catch{l("error"),A?ie(`Unable to unblock @${g}`):ie(`Unable to block @${g}`)}})()},children:A?e(x,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",g]})]}):e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",g,"…"]})]})})]})]}),!u&&m==="loading"&&e(ge,{abrupt:!0}),!!u&&e(Ne,{confirm:U||J,confirmLabel:e("span",{children:J?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:Y,onClick:()=>{l("loading"),(async()=>{try{let P;U||J?P=await i.v1.accounts.$select($.current).unfollow():P=await i.v1.accounts.$select($.current).follow(),P&&f(P),l("default")}catch(P){alert(P),l("error")}})()},children:e("button",{type:"button",class:`${U||J?"light swap":""}`,"data-swap-state":U||J?"danger":"",disabled:Y,children:U?e(x,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):J?e(x,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):y?e(x,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!me&&e(pe,{class:"light",onClose:()=>{$e(!1)},children:e(_s,{note:k,fields:S,onClose:()=>$e(!1)})}),!!Ae&&e(pe,{class:"light",onClose:()=>{V(!1)},children:e(Ps,{accountID:$.current,onClose:()=>V(!1)})})]})}function Es([t,n,d]){const o=.2126*t+.7152*n+.0722*d;let i;return o>=220?i=1:o<=50?i=.1:i=o/255,i=Math.min(1,i),[t,n,d,i]}function Ns(t){if(!t)return;const n=new URL(t),{host:d,pathname:o}=n,i=o.replace(/\/$/,"").replace(/^\//,"");return e(x,{children:[e("span",{class:"more-insignificant",children:[d,"/"]}),e("wbr",{}),e("span",{children:i})]})}function _s({note:t,fields:n,onClose:d}){const o=(n==null?void 0:n.map(({name:s,value:r})=>`${s}
${Vt(r)}`).join(`

`))||"",i=Vt(t)+(o?`

${o}`:"");return e("div",{class:"sheet",children:[!!d&&e("button",{type:"button",class:"sheet-close",onClick:d,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:i}),e(pn,{forceTranslate:!0,text:i})]})]})}function Ps({accountID:t,onClose:n}){const{masto:d}=q(),[o,i]=T("default"),[s,r]=T([]),[c,m]=T([]),[l,u]=vt(a=>a+1,0);z(()=>{i("loading"),(async()=>{try{const a=await d.v1.lists.list(),h=await d.v1.accounts.$select(t).lists.list();r(a),m(h),i("default")}catch{i("error")}})()},[l]);const[f,p]=T(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[s.length>0?e("ul",{class:"list-add-remove",children:s.map(a=>{const h=c.some(g=>g.id===a.id);return e("li",{children:e("button",{type:"button",class:`light ${h?"checked":""}`,disabled:o==="loading",onClick:()=>{i("loading"),(async()=>{try{h?await d.v1.lists.$select(a.id).accounts.remove({accountIds:[t]}):await d.v1.lists.$select(a.id).accounts.create({accountIds:[t]}),u()}catch{i("error"),alert(h?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:a.title})]})})})}):o==="loading"?e("p",{class:"ui-state",children:e(ge,{abrupt:!0})}):o==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>p(!0),disabled:o!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),f&&e(pe,{class:"light",onClick:a=>{a.target===a.currentTarget&&p(!1)},children:e(zt,{list:f==null?void 0:f.list,onClose:a=>{a.state==="success"&&u(),p(!1)}})})]})}function Us({account:t,instance:n,onClose:d}){const{masto:o,instance:i,authenticated:s}=q({instance:n}),r=typeof t=="string";return z(()=>{r||(v.accounts[`${t.id}@${i}`]=t)},[t]),e("div",{class:"sheet",onClick:c=>{c.target.closest(".account-block")&&d({destination:"account-statuses"})},children:[!!d&&e("button",{type:"button",class:"sheet-close outer",onClick:d,children:e(w,{icon:"x"})}),e($n,{instance:i,authenticated:s,account:t,fetchAccount:async()=>{if(r)try{return await o.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const m=await o.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:s});if(m.accounts.length)return m.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const u=new URL(t).pathname.replace(/^\//,""),f=await o.v2.search.fetch({q:u,type:"accounts",limit:1,resolve:s});if(f.accounts.length)return f.accounts[0]}}else return t}})]})}function Fs({onClose:t}){const{masto:n}=q(),[d,o]=T("default"),[i,s]=T([]),[r,c]=vt(l=>l+1,0);z(()=>{o("loading"),(async()=>{try{const l=await et.drafts.keys();if(l.length){const u=mn(),f=l.filter(p=>p.startsWith(u));if(f.length){const p=await et.drafts.getMany(f);p.sort((a,h)=>new Date(h.updatedAt).getTime()-new Date(a.updatedAt).getTime()),s(p)}else s([])}else s([]);o("default")}catch{o("error")}})()},[r]);const m=(i==null?void 0:i.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(ge,{abrupt:!0,hidden:d!=="loading"})]}),m&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:m?e(x,{children:[e("ul",{class:"drafts-list",children:i.map(l=>{const{updatedAt:u,key:f,draftStatus:p,replyTo:a}=l,h=new Date(u);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:a?"reply":"quill",size:"s"})," ",e("time",{children:[!!a&&e(x,{children:["@",a.account.acct,e("br",{})]}),Oe(h)]})]}),e(Ne,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:d==="loading",onClick:()=>{(async()=>{try{await et.drafts.del(f),c()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:d==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:d==="loading",class:"draft-item",onClick:async()=>{let g;if(a){o("loading");try{g=await n.v1.statuses.$select(a.id).fetch()}catch{alert("Error fetching reply-to status!"),o("default");return}o("default")}window.__COMPOSE__={draftStatus:p,replyToStatus:g},v.showCompose=!0,v.showDrafts=!1},children:e(zs,{draft:l})})]},u)})}),i.length>1&&e("p",{children:e(Ne,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:d==="loading",onClick:()=>{(async()=>{o("loading");try{await et.drafts.delMany(i.map(l=>l.key)),o("default"),c()}catch{alert("Error deleting drafts! Please try again."),o("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:d==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function zs({draft:t}){var f;const{draftStatus:n,replyTo:d}=t,{status:o,spoilerText:i,poll:s,mediaAttachments:r}=n,c=((f=s==null?void 0:s.options)==null?void 0:f.length)>0,m=(r==null?void 0:r.length)>0,l=c||m,u=ue(()=>{if(!m)return;const p=r.find(g=>/image/.test(g.type));if(!p)return;const{file:a}=p;return URL.createObjectURL(a)},[m,r]);return e(x,{children:e("div",{class:"mini-draft",children:[l&&e("div",{class:`mini-draft-aside ${u?"has-image":""}`,style:u?{"--bg-image":`url(${u})`}:{},children:[c&&e(w,{icon:"poll"}),m&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:r==null?void 0:r.length})]})]}),e("div",{class:"mini-draft-main",children:[!!i&&e("div",{class:"mini-draft-spoiler",children:i}),!!o&&e("div",{class:"mini-draft-status",children:o})]})]})})}function Bs({onClose:t=()=>{}}){const n=oe(v),[d,o]=T("default"),[i,s]=T([]),[r,c]=T(!1);if(!n.showGenericAccounts)return null;const{id:m,heading:l,fetchAccounts:u,accounts:f,showReactions:p}=n.showGenericAccounts,a=h=>{u&&(h&&s([]),o("loading"),(async()=>{try{const{done:g,value:y}=await u(h);Array.isArray(y)?(s(h?y:b=>[...b,...y]),c(!g)):c(!1),o("default")}catch{o("error")}})())};return z(()=>{(f==null?void 0:f.length)>0?s(f):a(!0)},[f,u]),z(()=>{var h;((h=n.reloadGenericAccounts)==null?void 0:h.id)===m&&a(!0)},[n.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:l||"Accounts"})}),e("main",{children:i.length>0?e(x,{children:[e("ul",{class:"accounts-list",children:i.map(h=>{var g;return e("li",{children:[p&&((g=h._types)==null?void 0:g.length)>0&&e("div",{class:"reactions-block",children:h._types.map(y=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[y],class:`${y}-icon`}))}),e(_e,{account:h})]},h.id+(h._types||""))})}),d==="default"?r?e(st,{onChange:h=>{h&&a()},children:e("button",{type:"button",class:"plain block",onClick:()=>a(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):d==="loading"&&e("p",{class:"ui-state",children:e(ge,{abrupt:!0})})]}):d==="loading"?e("p",{class:"ui-state",children:e(ge,{abrupt:!0})}):d==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Ln({alt:t,lang:n,onClose:d}){const o=oe(v),[i,s]=T(!1),r=un(!0),c=o.settings.contentTranslationHideLanguages||[],m=!!n&&n!==r&&!jt([n],[r])&&!c.find(l=>n===l||jt([n],[l]));return e("div",{class:"sheet",children:[!!d&&e("button",{type:"button",class:"sheet-close outer",onClick:d,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(We,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:e(Z,{disabled:i,onClick:()=>{s(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]})})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap"},children:t}),(m||i)&&e(pn,{forceTranslate:i,sourceLanguage:n,text:t})]})]})}function Rn({mediaAttachments:t,statusID:n,instance:d,lang:o,index:i=0,onClose:s=()=>{}}){var g,y;const r=_(null),[c,m]=T(i),l=_(null);Pe(()=>{var b;(b=l.current)==null||b.scrollIntoView()},[]);const u=_(n);z(()=>{const b=i*r.current.clientWidth,k=u.current!==n;k&&(u.current=n),r.current.scrollTo({left:b,behavior:k?"auto":"smooth"}),r.current.focus()},[i,n]);const[f,p]=T(!0);z(()=>{let b=()=>{s()};return r.current&&r.current.addEventListener("swiped-down",b),()=>{r.current&&r.current.removeEventListener("swiped-down",b)}},[]),ve("esc",s,[s]);const[a,h]=T(!1);return z(()=>{let b=()=>{const{clientWidth:k,scrollLeft:S}=r.current,I=Math.round(S/k);m(I)};return r.current&&r.current.addEventListener("scroll",b,{passive:!0}),()=>{r.current&&r.current.removeEventListener("scroll",b)}},[]),z(()=>{let b=setTimeout(()=>{var k,S;(S=(k=r.current)==null?void 0:k.focus)==null||S.call(k)},100);return()=>clearTimeout(b)},[]),e("div",{class:"media-modal-container",children:[e("div",{ref:r,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:b=>{(b.target.classList.contains("carousel-item")||b.target.classList.contains("media")||b.target.classList.contains("media-zoom"))&&s()},children:t==null?void 0:t.map((b,k)=>{const{blurhash:S}=b,I=S?ss(S):null;return e("div",{class:"carousel-item",style:{"--average-color":`rgb(${I==null?void 0:I.join(",")})`,"--average-color-alpha":`rgba(${I==null?void 0:I.join(",")}, .5)`},tabindex:"0",ref:k===c?l:null,onClick:$=>{$.target!==$.currentTarget&&p(!f)},children:[!!b.description&&e("button",{type:"button",class:"media-alt",hidden:!f,onClick:()=>{h({alt:b.description,lang:o})},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:o,dir:"auto",children:b.description})]}),e(Wn,{media:b,showOriginal:!0,lang:o})]},b.id)})}),e("div",{class:"carousel-top-controls",hidden:!f,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((b,k)=>e("button",{type:"button",disabled:k===c,class:`carousel-dot ${k===c?"active":""}`,onClick:S=>{S.preventDefault(),S.stopPropagation(),r.current.scrollTo({left:r.current.clientWidth*k,behavior:"smooth"}),r.current.focus()},children:e(w,{icon:"round",size:"s"})},b.id))}):e("span",{}),e("span",{children:[e(We,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:e(Ce,{href:((g=t[c])==null?void 0:g.remoteUrl)||((y=t[c])==null?void 0:y.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]})})," ",e(G,{to:`${d?`/${d}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${c+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!f,children:[e("button",{type:"button",class:"carousel-button",hidden:c===0,onClick:b=>{b.preventDefault(),b.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(c-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:c===t.length-1,onClick:b=>{b.preventDefault(),b.stopPropagation(),r.current.focus(),r.current.scrollTo({left:r.current.clientWidth*(c+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]}),!!a&&e(pe,{class:"light",onClick:b=>{b.target===b.currentTarget&&(h(!1),r.current.focus())},children:e(Ln,{alt:a.alt||a,lang:a==null?void 0:a.lang,onClose:()=>h(!1)})})]})}const Os=""+new URL("floating-button-ef345856.svg",import.meta.url).href,qs=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,Hs=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function Lt({children:t}){if(typeof t=="string")return t;const[n,d]=T("");return z(()=>{Promise.resolve(t).then(d)},[t]),n}const Ze=9,Vs=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],An={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Favourites",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},pt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},wt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:bt(async({id:t})=>(await q().masto.v1.lists.$select(t).fetch()).title,{cacheKey:([{id:t}])=>t}),path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||q().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||q().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t,path:({query:t})=>`/search?q=${t}`,icon:"search"},"account-statuses":{id:"account-statuses",title:bt(async({id:t})=>{const n=await q().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName},{cacheKey:([{id:t}])=>t}),path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Favourites",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||q().instance,path:({hashtag:t,instance:n})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}`,icon:"hashtag"}};function js({onClose:t}){const n=oe(v),{masto:d}=q(),{shortcuts:o}=n,[i,s]=T([]),[r,c]=T([]),[m,l]=T(!1),[u,f]=T(!1);return z(()=>{(async()=>{try{const p=await d.v1.lists.list();s(p)}catch{}})(),(async()=>{try{const p=d.v1.followedTags.list(),a=[];do{const{value:h,done:g}=await p.next();if(g||(h==null?void 0:h.length)===0)break;a.push(...h)}while(!0);c(a)}catch{}})()},[]),e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:["Specify a list of shortcuts that'll appear as:",e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Os},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:Hs},{value:"multi-column",label:"Multi-column",imgURL:qs}].map(({value:p,label:a,imgURL:h})=>e("label",{children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:p,checked:n.settings.shortcutsViewMode===p||p==="float-button"&&!n.settings.shortcutsViewMode,onChange:g=>{v.settings.shortcutsViewMode=g.target.value}})," ",e("img",{src:h,alt:"",width:"80",height:"58"})," ",e("span",{children:a})]}))})]}),o.length>0?e("ol",{class:"shortcuts-list",children:o.filter(Boolean).map((p,a)=>{const h=a+Object.values(p),{type:g}=p;if(!wt[g])return null;let{icon:y,title:b,subtitle:k}=wt[g];return typeof b=="function"&&(b=b(p,a)),typeof k=="function"&&(k=k(p,a)),typeof y=="function"&&(y=y(p,a)),e("li",{children:[e(w,{icon:y}),e("span",{class:"shortcut-text",children:[e(Lt,{children:b}),k&&e(x,{children:[" ",e("small",{class:"ib insignificant",children:k})]})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:a===0,onClick:()=>{const S=Array.from(v.shortcuts);if(a>0){const I=v.shortcuts[a-1];S[a-1]=p,S[a]=I,v.shortcuts=S}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:a===o.length-1,onClick:()=>{const S=Array.from(v.shortcuts);if(a<v.shortcuts.length-1){const I=v.shortcuts[a+1];S[a+1]=p,S[a]=I,v.shortcuts=S}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{l({shortcut:p,shortcutIndex:a})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},h)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:p=>{p.preventDefault(),v.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:o.length>=Ze&&`Max ${Ze} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>f(!0),children:"Import/export"}),e("button",{type:"button",disabled:o.length>=Ze,onClick:()=>l(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),m&&e(pe,{class:"light",onClick:p=>{p.target===p.currentTarget&&l(!1)},children:e(Gs,{shortcut:m.shortcut,shortcutIndex:m.shortcutIndex,lists:i,followedHashtags:r,onSubmit:({result:p,mode:a})=>{a==="edit"?v.shortcuts[m.shortcutIndex]=p:v.shortcuts.push(p)},onClose:()=>l(!1)})}),u&&e(pe,{class:"light",onClick:p=>{p.target===p.currentTarget&&f(!1)},children:e(Ws,{shortcuts:o,onClose:()=>f(!1)})})]})}function Gs({lists:t,followedHashtags:n,onSubmit:d,disabled:o,shortcut:i,shortcutIndex:s,onClose:r}){var f,p;const c=!!i,[m,l]=T((i==null?void 0:i.type)||null),u=_();return z(()=>{if(c&&m&&pt[m]){const a=u.current;pt[m].forEach(({name:h,type:g})=>{const y=a.querySelector(`[name="${h}"]`);y&&i[h]&&(g==="checkbox"?y.checked=i[h]==="on":y.value=i[h])})}},[c,m]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!r&&e("button",{type:"button",class:"sheet-close",onClick:r,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[c?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:u,onSubmit:a=>{a.preventDefault();const h=new FormData(a.target),g={};h.forEach((y,b)=>{g[b]=y==null?void 0:y.trim(),b==="instance"&&(g[b]=g[b].replace(/^https?:\/\//,"").replace(/\/+$/,""),g[b]=g[b].replace(/^@?[^@]+@/,""))}),g.type&&(d({result:g,mode:c?"edit":"add"}),a.target.reset(),l(null),r==null||r())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:o,onChange:a=>{l(a.target.value)},defaultValue:c?i.type:void 0,name:"type",children:[e("option",{}),Vs.map(a=>e("option",{value:a,children:An[a]}))]})]})}),(p=(f=pt[m])==null?void 0:f.map)==null?void 0:p.call(f,({text:a,name:h,type:g,placeholder:y,pattern:b,notRequired:k})=>m==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!k,disabled:o,children:t.map(S=>e("option",{value:S.id,children:S.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:a})," ",e("input",{type:g,name:h,placeholder:y,required:g==="text"&&!k,disabled:o,list:m==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:b}),m==="hashtag"&&n.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:n.map(S=>e("option",{value:S.name}))})]})})),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:o,children:c?"Save":"Add"}),c&&e("button",{type:"button",class:"light danger",onClick:()=>{v.shortcuts.splice(s,1),r==null||r()},children:"Remove"})]})]})})]})}function Ws({shortcuts:t,onClose:n}){var l;const d=ue(()=>!t||!t.filter(Boolean).length?"":Jt.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,i]=T(""),[s,r]=T("default"),c=ue(()=>{if(!o)return r("default"),null;try{const u=JSON.parse(Jt.decompressFromEncodedURIComponent(o));if(!Array.isArray(u))throw new Error("Not an array");return r("default"),u}catch{try{const f=JSON.parse(o);if(!Array.isArray(f))throw new Error("Not an array");return r("default"),f}catch{return r("error"),null}}},[o]),m=v.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:u=>{i(u.target.value)}})}),!!c&&Array.isArray(c)&&e(x,{children:[e("p",{children:[e("b",{children:c.length})," shortcut",c.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:c.map(u=>{var f,p;return e("li",{children:[e("span",{style:{opacity:t.some(a=>Object.keys(a).every(h=>a[h]===u[h]))?1:0},children:"*"}),e("span",{children:[An[u.type],u.type==="list"&&" ⚠️"," ",(p=(f=pt[u.type])==null?void 0:f.map)==null?void 0:p.call(f,({text:a,name:h,type:g})=>u[h]?e(x,{children:[e("span",{class:"tag collapsed insignificant",children:[a,":"," ",g==="checkbox"?u[h]==="on"?"✅":"❌":u[h]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[m&&e(x,{children:[e(Ne,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const u=c.filter(a=>!v.shortcuts.some(h=>Object.keys(h).every(g=>h[g]===a[g])));if(!u.length){ie("No new shortcuts to import");return}let f=[...v.shortcuts,...u];const p=f.length>Ze;p&&(f=f.slice(0,Ze)),v.shortcuts=f,ie(p?`Shortcuts imported. Exceeded max ${Ze}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!c,children:"Import & append…"})})," "]}),e(Ne,{confirmLabel:m?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:m?"danger":void 0,onClick:()=>{v.shortcuts=c,ie("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!c,children:m?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:d,readOnly:!0,onClick:u=>{if(u.target.value){u.target.select();try{navigator.clipboard.writeText(u.target.value),ie("Shortcuts copied")}catch{ie("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!d,onClick:()=>{try{navigator.clipboard.writeText(d),ie("Shortcut settings copied")}catch{ie("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((l=navigator==null?void 0:navigator.canShare)==null?void 0:l.call(navigator,{text:d}))&&e("button",{type:"button",class:"plain2",disabled:!d,onClick:()=>{try{navigator.share({text:d})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",d.length>0&&e("small",{class:"insignificant",children:[d.length," characters"]})]}),!!d&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}is(v,t=>{for(const[n,d,o,i]of t)/^show/i.test(d)&&!o&&$t()});function Ks(){var o,i,s,r,c,m,l,u;const t=oe(v),n=wn(),d=Ut();return e(x,{children:[!!t.showCompose&&e(pe,{children:e(Kn,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((o=window.__COMPOSE__)==null?void 0:o.replyToStatus)||null,editStatus:((i=v.showCompose)==null?void 0:i.editStatus)||((s=window.__COMPOSE__)==null?void 0:s.editStatus)||null,draftStatus:((r=v.showCompose)==null?void 0:r.draftStatus)||((c=window.__COMPOSE__)==null?void 0:c.draftStatus)||null,onClose:f=>{const{newStatus:p,instance:a,type:h}=f||{};v.showCompose=!1,window.__COMPOSE__=null,p&&(v.reloadStatusPage++,ie({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[h||"post"],delay:1e3,duration:1e4,onClick:g=>{g.hideToast(),v.prevLocation=d,n(a?`/${a}/s/${p.id}`:`/s/${p.id}`)}}))}})}),!!t.showSettings&&e(pe,{onClose:()=>{v.showSettings=!1},children:e(Cs,{onClose:()=>{v.showSettings=!1}})}),!!t.showAccounts&&e(pe,{onClose:()=>{v.showAccounts=!1},children:e(ws,{onClose:()=>{v.showAccounts=!1}})}),!!t.showAccount&&e(pe,{class:"light",onClose:()=>{v.showAccount=!1},children:e(Us,{account:((m=t.showAccount)==null?void 0:m.account)||t.showAccount,instance:(l=t.showAccount)==null?void 0:l.instance,onClose:({destination:f}={})=>{v.showAccount=!1,f&&(v.showAccounts=!1)}})}),!!t.showDrafts&&e(pe,{onClose:()=>{v.showDrafts=!1},children:e(Fs,{onClose:()=>v.showDrafts=!1})}),!!t.showMediaModal&&e(pe,{onClick:f=>{(f.target===f.currentTarget||f.target.classList.contains("media"))&&(v.showMediaModal=!1)},children:e(Rn,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{v.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(pe,{class:"light",onClose:()=>{v.showShortcutsSettings=!1},children:e(js,{onClose:()=>v.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(pe,{class:"light",onClose:()=>{v.showGenericAccounts=!1},children:e(Bs,{onClose:()=>v.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(pe,{class:"light",onClick:f=>{f.target===f.currentTarget&&(v.showMediaAlt=!1)},children:e(Ln,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(u=t.showMediaAlt)==null?void 0:u.lang,onClose:()=>{v.showMediaAlt=!1}})})]})}function Rt({accountID:t,onChange:n}){const{masto:d}=q(),[o,i]=T("default"),[s,r]=T(null),[c,m]=T(null),l=c!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:o==="loading"||l,onClick:()=>{i("loading"),r("accept"),(async()=>{try{const u=await d.v1.followRequests.$select(t).authorize();if(!(u!=null&&u.followedBy))throw new Error("Follow request not accepted");m(u),n()}catch{}i("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:o==="loading"||l,class:"light danger",onClick:()=>{i("loading"),r("reject"),(async()=>{try{const u=await d.v1.followRequests.$select(t).reject();if(u!=null&&u.followedBy)throw new Error("Follow request not rejected");m(u),n()}catch{i("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:l&&s?s==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(ge,{hidden:o!=="loading"})})]})}const sn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},Xe={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"favourited your post.","favourite+account":t=>`favourited ${t} of your posts.`,favourite_reply:"favourited your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & favourited your post.","favourite+reblog+account":t=>`boosted & favourited ${t} of your posts.`,"favourite+reblog_reply":"boosted & favourited your reply.","admin.signup":"signed up.","admin.report":"reported a post."},Ct=50;function Bt({notification:t,instance:n,reload:d,isStatic:o}){var U,L,R,j;const{id:i,status:s,account:r,_accounts:c,_statuses:m}=t;let{type:l}=t;const u=(s==null?void 0:s.reblog)||s,f=u==null?void 0:u.id,p=X.session.get("currentAccount"),a=p===(r==null?void 0:r.id),h=(U=s==null?void 0:s.poll)==null?void 0:U.voted,g=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==p&&((L=s==null?void 0:s.account)==null?void 0:L.id)===p;let y=0,b=0;if(l==="favourite+reblog"){for(const A of c)(R=A._types)!=null&&R.includes("favourite")&&y++,(j=A._types)!=null&&j.includes("reblog")&&b++;!b&&y&&(l="favourite"),!y&&b&&(l="reblog")}let k;if(l==="poll"?k=Xe[a?"poll-self":h?"poll-voted":"poll"]:l==="reblog"||l==="favourite"||l==="favourite+reblog"?(m==null?void 0:m.length)>1?k=Xe[`${l}+account`]:g?k=Xe[`${l}_reply`]:k=Xe[l]:Xe[l]?k=Xe[l]:k=`[Unknown notification type: ${l}]`,typeof k=="function"&&(k=k((m==null?void 0:m.length)||(c==null?void 0:c.length))),l==="mention"&&!s)return null;const S=t.createdAt&&new Date(t.createdAt).toLocaleString(),I={"favourite+reblog":"Boosted/Favourited by…",favourite:"Favourited by…",reblog:"Boosted by…",follow:"Followed by…"}[l]||"Accounts",$=()=>{v.showGenericAccounts={heading:I,accounts:c,showReactions:l==="favourite+reblog"}};return e("div",{class:`notification notification-${l}`,tabIndex:"0",children:[e("div",{class:`notification-type notification-${l}`,title:S,children:l==="favourite+reblog"?e(x,{children:[e(w,{icon:"rocket",size:"xl",alt:l,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:l,class:"favourite-icon"})]}):e(w,{icon:sn[l]||"notification",size:"xl",alt:l})}),e("div",{class:"notification-content",children:[l!=="mention"&&e(x,{children:[e("p",{children:[!/poll|update/i.test(l)&&e(x,{children:(c==null?void 0:c.length)>1?e(x,{children:[e("b",{tabIndex:"0",onClick:$,children:[e("span",{title:c.length,children:Ee(c.length)})," ","people"]})," "]}):e(x,{children:[e(Nt,{account:r,showAvatar:!0})," "]})}),k,l==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(_t,{datetime:t.createdAt,format:"micro"})]})]}),l==="follow_request"&&e(Rt,{accountID:r.id,onChange:()=>{}})]}),(c==null?void 0:c.length)>1&&e("p",{class:"avatars-stack",children:[c.slice(0,Ct).map((A,M)=>e(x,{children:[e("a",{href:A.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:N=>{N.preventDefault(),v.showAccount=A},children:[e(Ve,{url:A.avatarStatic,size:c.length<=10?"xxl":c.length<20?"xl":c.length<30?"l":c.length<40?"m":"s",alt:`${A.displayName} @${A.acct}`,squircle:A==null?void 0:A.bot},A.id),l==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:A._types.map(N=>e(w,{icon:sn[N],size:"s",class:`${N}-icon`}))})]})," "]})),e("button",{type:"button",class:"small plain",onClick:$,children:[c.length>Ct&&`+${c.length-Ct}`,e(w,{icon:"chevron-down"})]})]}),(m==null?void 0:m.length)>1&&e("ul",{class:"notification-group-statuses",children:m.map(A=>e("li",{children:e(on,{class:`status-link status-type-${l}`,to:n?`/${n}/s/${A.id}`:`/s/${A.id}`,children:e(we,{status:A,size:"s"})})},A.id))}),s&&(!(m!=null&&m.length)||(m==null?void 0:m.length)<=1)&&e(on,{class:`status-link status-type-${l}`,to:n?`/${n}/s/${f}`:`/s/${f}`,onContextMenu:A=>{const M=A.target.querySelector(".status");if(M){if(A.metaKey)return;A.preventDefault(),M.dispatchEvent(new MouseEvent("contextmenu",{clientX:A.clientX,clientY:A.clientY}))}},children:o?e(we,{status:u,size:"s"}):e(we,{statusID:f,size:"s"})})]})]})}function on(t){const n=Jn();return e(G,{...t,"data-read-more":"Read more →",ref:n})}const Js=Ge(function(){if(!("serviceWorker"in navigator))return null;const n=oe(v),{routeNotification:d}=n,{id:o,accessToken:i}=d||{},[s,r]=T(!1);Pe(()=>{if(!o||!i)return;const{instance:m}=q(),{masto:l,instance:u}=q({accessToken:i}),f=m===u,p=i?Yn(i):Qe();(async()=>{const a=await l.v1.notifications.$select(o).fetch();if(a&&p){const h=p.instanceURL,{type:g,status:y,account:b}=a,k=!!document.querySelector("#modal-container > *"),S=g==="follow"&&!!(b!=null&&b.id),I=!!(b!=null&&b.id),$=!!(y!=null&&y.id);S&&f?v.showAccount={account:b,instance:h}:k||!f||I&&$?r({id:o,account:p,notification:a,sameInstance:f}):$?location.hash=`/${m}/s/${y.id}`:S?location.hash=`/${m}/a/${b.id}`:location.hash="/notifications"}})()},[o,i]),Pe(()=>{const m=l=>{const{type:u,id:f,accessToken:p}=(l==null?void 0:l.data)||{};u==="notification"&&(v.routeNotification={id:f,accessToken:p})};return navigator.serviceWorker.addEventListener("message",m),()=>{navigator.serviceWorker.removeEventListener("message",m)}},[]),Pe(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),yt(m=>{m&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const c=()=>{r(!1),v.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(s){const{id:m,account:l,notification:u,sameInstance:f}=s;return e(pe,{class:"light",onClick:p=>{p.target===p.currentTarget&&c()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:c,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!f&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:p=>{const{target:a}=p;(p.target.tagName==="BUTTON"||p.target.tagName==="A")&&c()},children:e(Bt,{instance:l.instanceURL,notification:u,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(G,{to:"/notifications",class:"button light",onClick:c,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null});const Mn=os((t,n)=>{const{instance:d}=q(),[o,i]=Ue(),[s,r]=T(!1),[c,m]=T(o.get("q")||""),l=o.get("type"),u=_(null),f=_(null);return cs(n,()=>({setValue:p=>{m(p)},focus:()=>{f.current.focus()},select:()=>{f.current.select()},blur:()=>{f.current.blur()}})),e("form",{ref:u,class:"search-popover-container",onSubmit:p=>{var h;if(p.preventDefault(),/\/search/.test(location.hash))if(c){const g={q:c};l&&(g.type=l),i(g)}else i({});else c?location.hash=`/search?q=${encodeURIComponent(c)}${l?`&type=${l}`:""}`:location.hash="/search";(h=t==null?void 0:t.onSubmit)==null||h.call(t,p)},children:[e("input",{ref:f,value:c,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:p=>{p.target.value||i({})},onInput:p=>{m(p.target.value),r(!0)},onFocus:()=>{r(!0)},onBlur:()=>{var p,a;setTimeout(()=>{r(!1)},100),(a=(p=u.current)==null?void 0:p.querySelector(".search-popover-item.focus"))==null||a.classList.remove("focus")},onKeyDown:p=>{var h;const{key:a}=p;switch(a){case"Escape":r(!1);break;case"Down":case"ArrowDown":if(p.preventDefault(),s){const g=u.current.querySelector(".search-popover-item.focus");if(g){let y=g.nextElementSibling;for(;y&&y.hidden;)y=y.nextElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(k=>k!==y).forEach(k=>{k.classList.remove("focus")}))}else{const y=u.current.querySelector(".search-popover-item");y&&y.classList.add("focus")}}break;case"Up":case"ArrowUp":if(p.preventDefault(),s){const g=document.querySelector(".search-popover-item.focus");if(g){let y=g.previousElementSibling;for(;y&&y.hidden;)y=y.previousElementSibling;y&&(y.classList.add("focus"),Array.from(y.parentElement.children).filter(k=>k!==y).forEach(k=>{k.classList.remove("focus")}))}else{const y=document.querySelector(".search-popover-item:last-child");y&&y.classList.add("focus")}}break;case"Enter":if(s){const g=document.querySelector(".search-popover-item.focus");g&&(p.preventDefault(),g.click()),r(!1),(h=t==null?void 0:t.onSubmit)==null||h.call(t,p)}break}}}),e("div",{class:"search-popover",hidden:!s||!c,children:!!c&&[{label:e(x,{children:["Posts with ",e("q",{children:c})]}),to:`/search?q=${encodeURIComponent(c)}&type=statuses`,hidden:/^https?:/.test(c)},{label:e(x,{children:["Posts tagged with ",e("mark",{children:["#",c.replace(/^#/,"")]})]}),to:`/${d}/t/${c.replace(/^#/,"")}`,hidden:/^@/.test(c)||/^https?:/.test(c)||/\s/.test(c),top:/^#/.test(c),type:"link"},{label:e(x,{children:["Look up ",e("mark",{children:c})]}),to:`/${c}`,hidden:!/^https?:/.test(c),top:/^https?:/.test(c),type:"link"},{label:e(x,{children:["Accounts with ",e("q",{children:c})]}),to:`/search?q=${encodeURIComponent(c)}&type=accounts`}].sort((p,a)=>p.top&&!a.top?-1:!p.top&&a.top?1:0).map(({label:p,to:a,hidden:h,type:g})=>e(G,{to:a,class:"search-popover-item",hidden:h,onClick:y=>{var b;(b=t==null?void 0:t.onSubmit)==null||b.call(t,y)},children:[e(w,{icon:g==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:p})," "]}))})]})}),Ys=Ge(function({onClose:n=()=>{}}){const[d,o]=T(!1),i=_(null);ve("/",r=>{o(!0),setTimeout(()=>{var c,m,l,u;(m=(c=i.current)==null?void 0:c.focus)==null||m.call(c),(u=(l=i.current)==null?void 0:l.select)==null||u.call(l)},0)},{preventDefault:!0,ignoreEventWhen:r=>{const c=/\/search/.test(location.hash),m=!!document.querySelector("#modal-container > *");return c||m}});const s=()=>{o(!1),n()};return ve("esc",r=>{var c,m;(m=(c=i.current)==null?void 0:c.blur)==null||m.call(c),s()},{enabled:d,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!d,onClick:r=>{r.target===r.currentTarget&&s()},children:e(Mn,{ref:i,onSubmit:()=>{s()}})})});function Xs(){const{instance:t}=q(),n=oe(v),{shortcuts:d}=n;if(!d.length)return null;const o=_(),i=ue(()=>d.map((r,c)=>{const{type:m,...l}=r;if(!wt[m])return null;let{id:u,path:f,title:p,subtitle:a,icon:h}=wt[m];return typeof u=="function"&&(u=u(l,c)),typeof f=="function"&&(f=f({...l,instance:l.instance||t},c)),typeof p=="function"&&(p=p(l,c)),typeof a=="function"&&(a=a(l,c)),typeof h=="function"&&(h=h(l,c)),{id:u,path:f,title:p,subtitle:a,icon:h}}).filter(Boolean),[d]),s=wn();return ve(["1","2","3","4","5","6","7","8","9"],(r,c)=>{var l,u;const m=parseInt(c.keys[0],10)-1;if(m<i.length){const{path:f}=i[m];f&&(s(f),(u=(l=o.current)==null?void 0:l.closeMenu)==null||u.call(l))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",children:e("ul",{children:i.map(({id:r,path:c,title:m,subtitle:l,icon:u},f)=>e("li",{children:e(G,{class:l?"has-subtitle":"",to:c,onClick:p=>{if(p.target.classList.contains("is-active")){p.preventDefault();const a=document.getElementById(`${r}-page`);if(a){a.scrollTop=0;const h=a.querySelector(".updates-button");h&&h.click()}}},children:[e(w,{icon:u,size:"xl",alt:m}),e("span",{children:[e(Lt,{children:m}),l&&e(x,{children:[e("br",{}),e("small",{children:l})]})]})]})},f+m))})}):e(We,{instanceRef:o,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:r=>{var c,m;try{const{target:l}=r;getComputedStyle(l).pointerEvents==="none"&&((m=(c=o.current)==null?void 0:c.closeMenu)==null||m.call(c))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:i.map(({path:r,title:c,subtitle:m,icon:l},u)=>e(Ce,{to:r,class:"glass-menu-item",children:[e(w,{icon:l,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Lt,{children:c})}),m&&e(x,{children:[" ",e("small",{class:"more-insignificant",children:m})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:u+1})]},u+c))})})}function it(t){const{containerProps:n}=t,d=as(),o=_();return e(We,{boundingBoxPadding:gn(),repositionFlag:`${d.width}x${d.height}`,...t,instanceRef:o,containerProps:{onClick:i=>{var s,r,c;i.target===i.currentTarget&&((r=(s=o.current)==null?void 0:s.closeMenu)==null||r.call(s)),(c=n==null?void 0:n.onClick)==null||c.call(n,i)},...n}})}function Zs(t){var i;let n=[],d=[],o=0;for(let s=0;s<t.length;s++){const r=t[s];r.reblog&&!((i=r.account)!=null&&i.group)?(d.push(r),o++):(n.push(r),o<3&&(o=0))}if(t.length>10&&(d.length>t.length/4||o>=3)){const s=d.map(r=>r.id);if(d.length>t.length*3/4)n=[...n,{id:s,items:d,type:"boosts"}];else{const r=Math.floor(n.length/2);n=[...n.slice(0,r),{id:s,items:d,type:"boosts"},...n.slice(r)]}return n}else return t}function cn(t,n){const d=X.account.get("boostedStatusIDs")||{},o=t.filter(s=>{if(!s.reblog)return!0;const r=`${n}-${s.reblog.id}`,c=d[r];return c&&c!==s.id?!1:(d[r]=s.id,!0)}),i=Object.keys(d);return i.length>50&&i.slice(0,i.length-50).forEach(s=>{delete d[s]}),X.account.set("boostedStatusIDs",d),o}function Qs(t){const n=[];let d=0;t.forEach(s=>{for(let c=0;c<n.length;c++){if(n[c].find(m=>m.id===s.id))return;if(n[c].find(m=>m.id===s.inReplyToId)||n[c].find(m=>m.inReplyToId===s.id)){n[c].push(s);return}}const r=t.find(c=>c.id===s.inReplyToId);r&&(n[d++]=[s,r])});for(let s=0;s<n.length;s++)for(let r=s+1;r<n.length;r++)n[s].find(m=>n[r].includes(m))&&(n[s]=[...n[s],...n[r]],n[s]=n[s].filter((m,l,u)=>u.findIndex(f=>f.id===m.id)===l),n.splice(r,1),r--);n.forEach(s=>{s.sort((r,c)=>!r.inReplyToId&&!c.inReplyToId?new Date(r.createdAt)-new Date(c.createdAt):r.inReplyToId===c.id?1:c.inReplyToId===r.id||!r.inReplyToId?-1:c.inReplyToId?new Date(r.createdAt)-new Date(c.createdAt):1)}),n.forEach(s=>{const r=s[0].account.id;s.forEach(c=>{c.account.id!==r&&(c._differentAuthor=!0)})}),n.length;const o=[],i=[];return t.forEach(s=>{if(s.reblog){o.push(s);return}for(let r=0;r<n.length;r++)if(n[r].find(c=>c.id===s.id)){if(i.includes(r))return;const c=n[r];c.sort((l,u)=>{const f=new Date(l.createdAt),p=new Date(u.createdAt);return f-p});const m=c[0].account.id;o.push({id:c.map(l=>l.id),items:c,type:c.every(l=>l.account.id===m)?"thread":"conversation"}),i.push(r);return}o.push(s)}),o}function St({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:d=1,scrollThresholdStart:o=10,scrollThresholdEnd:i=10,direction:s="vertical",distanceFromStartPx:r,distanceFromEndPx:c}={}){const[m,l]=T(null),[u,f]=T(!1),[p,a]=T(!1),[h,g]=T(!1),[y,b]=T(!1),k=s==="vertical";return Pe(()=>{const S=t.current;if(!S)return{};let I=k?S.scrollTop:S.scrollLeft;function $(){const{scrollTop:U,scrollLeft:L,scrollHeight:R,scrollWidth:j,clientHeight:A,clientWidth:M}=S,N=k?U:L,ne=k?R:j,J=k?A:M,Te=Math.abs(N-I),ye=r||Math.min(J*n,ne,N),Q=c||Math.min(J*d,ne,ne-N-J);Te>=(I<N?i:o)&&(l(I<N?"end":"start"),I=N),f(N<=0),a(N+J>=ne),g(N<=ye),b(N+J>=ne-Q)}return S.addEventListener("scroll",$,{passive:!0}),()=>S.removeEventListener("scroll",$)},[n,d,o,i]),{scrollDirection:m,reachStart:u,reachEnd:p,nearReachStart:h,nearReachEnd:y,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function ot(t){var S,I,$,U,L;const n=oe(v),{masto:d,instance:o,authenticated:i}=q(),[s,r]=T(),[c,m]=T(!1);z(()=>{const R=X.local.getJSON("accounts")||[],j=R.find(A=>A.info.id===X.session.get("currentAccount"));j&&r(j),m(R.length>1)},[]);const l=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(R=>R.type==="following"),u=ls(()=>{v.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),f=_(),[p,a]=T(void 0),h=gn([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),g=_();async function y(R){return(R||!g.current)&&(g.current=d.v1.mutes.list({limit:80})),await g.current.next()}const b=_();async function k(R){return(R||!b.current)&&(b.current=d.v1.blocks.list({limit:80})),await b.current.next()}return e(x,{children:[e("button",{ref:f,type:"button",class:`button plain nav-menu-button ${c?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{a(R=>R?void 0:"open")},onContextMenu:R=>{R.preventDefault(),v.showAccounts=!0},...u(),children:[c&&e(Ve,{url:((S=s==null?void 0:s.info)==null?void 0:S.avatar)||((I=s==null?void 0:s.info)==null?void 0:I.avatarStatic),size:"l",squircle:($=s==null?void 0:s.info)==null?void 0:$.bot}),e(w,{icon:"menu",size:c?"s":"l"})]}),e(vn,{menuClassName:"nav-menu",state:p,anchorRef:f,onClose:()=>{a(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{a(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:h,unmountOnClose:!0,children:[!!((U=n.appVersion)!=null&&U.commitHash)&&n.appVersion.commitHash!=="adecd64"&&e("div",{class:"top-menu",children:[e(Z,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(De,{})]}),e("section",{children:[e(Ce,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),i&&e(x,{children:[l&&e(Ce,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Ce,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Ce,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(De,{}),e(Ce,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(Ce,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Ce,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Ce,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Favourites"})]})]}),e(De,{}),e(Ce,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Ce,{to:`/${o}/p/l`,children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Local"})]}),e(Ce,{to:`/${o}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(Ce,{to:`/${o}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:i?e(x,{children:[e(De,{}),((L=s==null?void 0:s.info)==null?void 0:L.id)&&e(Ce,{to:`/${o}/a/${s.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(Z,{onClick:()=>{v.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(Z,{onClick:()=>{v.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:y}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(Z,{onClick:()=>{v.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:k}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(Z,{onClick:()=>{v.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(Z,{onClick:()=>{v.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts Settings…"})]}),e(Z,{onClick:()=>{v.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(x,{children:[e(De,{}),e(Ce,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(Z,{onClick:()=>{v.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const dt={block:"nearest",inline:"center",behavior:"smooth"};function Fe({title:t,titleComponent:n,id:d,instance:o,emptyText:i,errorText:s,useItemID:r,boostsCarousel:c,fetchItems:m=()=>{},checkForUpdates:l=()=>{},checkForUpdatesInterval:u=6e4,headerStart:f,headerEnd:p,timelineStart:a,allowFilters:h,refresh:g}){const y=oe(v),[b,k]=T([]),[S,I]=T("default"),[$,U]=T(!1),[L,R]=T(!1),[j,A]=T(!0),M=_(),N=kn(V=>{R(!1),S!=="loading"&&(I("loading"),(async()=>{try{let{done:ee,value:P}=await m(V);Array.isArray(P)?(c&&(P=Zs(P)),P=Qs(P),k(V?P:W=>[...W,...P]),P.length||(ee=!0),U(!ee)):U(!1),I("default")}catch{I("error")}finally{N.cancel()}})())},1500,{leading:!0,trailing:!1}),ne=".timeline-item, .timeline-item-alt",J=ve("j, shift+j",(V,ee)=>{const P=document.activeElement.closest(ne),W=P==null?void 0:P.getBoundingClientRect(),C=Array.from(M.current.querySelectorAll(ne));if(P&&W.top<M.current.clientHeight&&W.bottom>0){const E=C.indexOf(P);let B=C[E+1];ee.shift&&(B=C.find((K,H)=>H>E&&!K.classList.contains("timeline-item-alt"))),B&&(B.focus(),B.scrollIntoView(dt))}else{const E=C.find(B=>{const K=B.getBoundingClientRect();return K.top>=44&&K.left>=0});E&&(E.focus(),E.scrollIntoView(dt))}}),Te=ve("k, shift+k",(V,ee)=>{const P=document.activeElement.closest(ne),W=P==null?void 0:P.getBoundingClientRect(),C=Array.from(M.current.querySelectorAll(ne));if(P&&W.top<M.current.clientHeight&&W.bottom>0){const E=C.indexOf(P);let B=C[E-1];ee.shift&&(B=C.findLast((K,H)=>H<E&&!K.classList.contains("timeline-item-alt"))),B&&(B.focus(),B.scrollIntoView(dt))}else{const E=C.find(B=>{const K=B.getBoundingClientRect();return K.top>=44&&K.left>=0});E&&(E.focus(),E.scrollIntoView(dt))}}),ye=ve(["enter","o"],()=>{const V=document.activeElement.closest(ne);V&&V.click()}),{scrollDirection:Q,nearReachStart:Re,nearReachEnd:xe,reachStart:D,reachEnd:Y}=St({scrollableRef:M,distanceFromEnd:2,scrollThresholdStart:44});z(()=>{var V;(V=M.current)==null||V.scrollTo({top:0}),N(!0)},[]),z(()=>{N(!0)},[g]),z(()=>{D&&N(!0)},[D]),z(()=>{(xe||Y&&$)&&N()},[xe,$]);const te=Sn(5e3),me=je(async({disableHoverCheck:V=!1}={})=>{y.settings.autoRefresh&&M.current.scrollTop===0&&(V||te)&&!ni()?N(!0):await l()&&R(!0)},[d,te,N,l,y.settings.autoRefresh]),$e=_();yt(V=>{if(V){const ee=Date.now()-$e.current;(!$e.current||ee>1e3*60)&&me({disableHoverCheck:!0})}else $e.current=Date.now();A(V)},[l,me,y.settings.autoRefresh]),dn(me,j&&!L?u:null);const Ae=Q==="end"&&!Re;return e("div",{id:`${d}-page`,class:"deck-container",ref:V=>{M.current=V,J.current=V,Te.current=V,ye.current=V},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{hidden:Ae,onClick:V=>{var ee;V.target.closest("a, button")||(ee=M.current)==null||ee.scrollTo({top:0,behavior:"smooth"})},onDblClick:V=>{V.target.closest("a, button")||N(!0)},class:S==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ot,{}),f??e(G,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!p&&p})]}),b.length>0&&S!=="loading"&&!Ae&&L&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var V;N(!0),(V=M.current)==null||V.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!a&&e("div",{class:"timeline-start",children:a}),b.length?e(x,{children:[e("ul",{class:"timeline",children:[b.map(V=>{const{id:ee,reblog:P,items:W,type:C,_pinned:E}=V,B=(P==null?void 0:P.id)||ee,K=o?`/${o}/s/${B}`:`/s/${B}`;let H="";C==="boosts"?H=`${W.length} Boosts`:C==="pinned"&&(H="Pinned posts");const Le=C==="boosts"||C==="pinned";if(W){if(Le)return W.sort((le,de)=>le._filtered&&!de._filtered?1:!le._filtered&&de._filtered?-1:0),e("li",{class:"timeline-item-carousel",children:e(ei,{title:H,class:`${C}-carousel`,children:W.map(le=>{const{id:de,reblog:ce}=le,Ie=(ce==null?void 0:ce.id)||de,Me=o?`/${o}/s/${Ie}`:`/s/${Ie}`;return e("li",{children:e(G,{class:"status-carousel-link timeline-item-alt",to:Me,children:r?e(we,{statusID:de,instance:o,size:"s",contentTextWeight:!0,allowFilters:h}):e(we,{status:le,instance:o,size:"s",contentTextWeight:!0,allowFilters:h})})},de)})})},`timeline-${ee}`);const he=W.length>3;return W.map((le,de)=>{const{id:ce,_differentAuthor:Ie}=le,Me=o?`/${o}/s/${ce}`:`/s/${ce}`,F=de>0&&de<W.length-1,ae=le.sensitive&&!!le.spoilerText,be=!Ie&&ae&&de>0||he&&F&&(C==="thread"||C==="conversation"&&!Ie&&!W[de-1]._differentAuthor&&!W[de+1]._differentAuthor);return e("li",{class:`timeline-item-container timeline-item-container-type-${C} timeline-item-container-${de===0?"start":de===W.length-1?"end":"middle"} ${Ie?"timeline-item-diff-author":""}`,children:e(G,{class:"status-link timeline-item",to:Me,children:be?e(ti,{status:le,instance:o}):r?e(we,{statusID:ce,instance:o,allowFilters:h}):e(we,{status:le,instance:o,allowFilters:h})})},`timeline-${ce}`)})}return e("li",{children:e(G,{class:"status-link timeline-item",to:K,children:r?e(we,{statusID:ee,instance:o,allowFilters:h}):e(we,{status:V,instance:o,allowFilters:h})})},`timeline-${ee+E}`)}),$&&S==="loading"&&e(x,{children:[e("li",{style:{height:"20vh"},children:e(we,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(we,{skeleton:!0})})]})]}),S==="default"&&($?e(st,{onChange:V=>{V&&N()},children:e("button",{type:"button",class:"plain block",onClick:()=>N(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):S==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((V,ee)=>e("li",{children:e(we,{skeleton:!0})},ee))}):S!=="error"&&e("p",{class:"ui-state",children:i}),S==="error"&&e("p",{class:"ui-state",children:[s,e("br",{}),e("br",{}),e("button",{class:"button plain",onClick:()=>N(!b.length),children:"Try again"})]})]})})}function ei({title:t,class:n,children:d}){const o=_(),{reachStart:i,reachEnd:s,init:r}=St({scrollableRef:o,direction:"horizontal"});return z(()=>{r==null||r()},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{type:"button",class:"small plain2",disabled:i,onClick:()=>{var c,m;(m=o.current)==null||m.scrollBy({left:-Math.min(320,(c=o.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var c,m;(m=o.current)==null||m.scrollBy({left:Math.min(320,(c=o.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:o,children:d})]})}function ti({status:t,instance:n}){const d=oe(v),{id:o}=t,i=bn(t),s=Pt(o,n);return e("article",{class:"status compact-thread",tabindex:"-1",children:[d.statusThreadNumber[s]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),d.statusThreadNumber[s]?` ${d.statusThreadNumber[s]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:i,children:[i,t.sensitive&&t.spoilerText&&e(x,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function ni(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const si=20;function ii(){const t=oe(v),{id:n,...d}=Ke(),[o,i]=Ue(),s=!o.get("replies"),r=!!o.get("boosts"),c=o.get("tagged"),m=!!o.get("media"),{masto:l,instance:u,authenticated:f}=q({instance:d.instance}),p=_();async function a(A){const M=[];if(A){const{value:J}=await l.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(J!=null&&J.length&&!c&&!m)if(J.forEach(Te=>{Te._pinned=!0,ke(Te,u)}),J.length>=3){const Te=J.map(ye=>ye.id);M.push({id:Te,items:J,type:"pinned"})}else M.push(...J)}(A||!p.current)&&(p.current=l.v1.accounts.$select(n).statuses.list({limit:si,exclude_replies:s,exclude_reblogs:r,only_media:m,tagged:c}));const{value:N,done:ne}=await p.current.next();return N!=null&&N.length&&(M.push(...N),N.forEach(J=>{ke(J,u)})),{value:M,done:ne}}const[h,g]=T(),[y,b]=T([]);Se(`${h!=null&&h.displayName?h.displayName+" ":""}@${h!=null&&h.acct?h.acct:"Account posts"}`,"/:instance?/a/:id"),z(()=>{(async()=>{try{const A=await l.v1.accounts.$select(n).fetch();g(A)}catch{}try{const A=await l.v1.accounts.$select(n).featuredTags.list(n);b(A)}catch{}})()},[n]);const{displayName:k,acct:S,emojis:I}=h||{},$=_(),U=ue(()=>{const A=t.accounts[`${n}@${u}`],M=!s||r||c||m;return e(x,{children:[e($n,{instance:u,account:A||n,fetchAccount:()=>l.v1.accounts.$select(n).fetch(),authenticated:f,standalone:!0}),e("div",{class:"filter-bar",ref:$,children:[M?e(G,{to:`/${u}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})}):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(G,{to:`/${u}/a/${n}${s?"?replies=1":""}`,onClick:()=>{s&&ie("Showing post with replies")},class:s?"":"is-active",children:"+ Replies"}),e(G,{to:`/${u}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||ie("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),e(G,{to:`/${u}/a/${n}${m?"":"?media=1"}`,onClick:()=>{m||ie("Showing posts with media")},class:m?"is-active":"",children:"Media"}),y.map(N=>e(G,{to:`/${u}/a/${n}${c===N.name?"":`?tagged=${encodeURIComponent(N.name)}`}`,onClick:()=>{c!==N.name&&ie(`Showing posts tagged with #${N.name}`)},class:c===N.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),N.name]})}))]})]})},[n,u,f,s,r,y,c,m]);z(()=>{var M;const A=(M=$.current)==null?void 0:M.querySelector(".is-active");A&&$.current.scrollTo({behavior:"smooth",left:A.offsetLeft-($.current.offsetWidth-A.offsetWidth)/2})},[y,c,m,s,r]);const L=ue(()=>h!=null&&h.url?new URL(h.url).hostname:null,[h]),j=!!h&&!(u===L);return e(Fe,{title:`${h!=null&&h.acct?"@"+h.acct:"Posts"}`,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:e(fn,{text:k,emojis:I})}),e("div",{children:e("span",{children:["@",S]})})]}),id:"account-statuses",instance:u,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:a,useItemID:!0,boostsCarousel:t.settings.boostsCarousel,timelineStart:U,refresh:s+r+c+m,headerEnd:e(it,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(Z,{disabled:!j,onClick:()=>{(async()=>{try{const{masto:A}=q({instance:L}),M=await A.v1.accounts.lookup({acct:h.acct}),{id:N}=M;location.hash=`/${L}/a/${N}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:L}),")"]})]})})},n)}const oi=20;function Dn(){Se("Bookmarks","/b");const{masto:t,instance:n}=q(),d=_();async function o(i){return(i||!d.current)&&(d.current=t.v1.bookmarks.list({limit:oi})),await d.current.next()}return e(Fe,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:o})}const ci=20;function En(){Se("Favourites","/f");const{masto:t,instance:n}=q(),d=_();async function o(i){return(i||!d.current)&&(d.current=t.v1.favourites.list({limit:ci})),await d.current.next()}return e(Fe,{title:"Favourites",id:"favourites",emptyText:"No favourites yet. Go favourite something!",errorText:"Unable to load favourites",instance:n,fetchItems:o})}const ai=200;function li(){const{masto:t,instance:n}=q();Se("Followed Hashtags","/ft");const[d,o]=T("default"),[i,s]=T([]);return z(()=>{o("loading"),(async()=>{try{const r=t.v1.followedTags.list({limit:ai}),c=[];do{const{value:m,done:l}=await r.next();if(l||(m==null?void 0:m.length)===0)break;c.push(...m)}while(!0);c.sort((m,l)=>m.name.localeCompare(l.name)),s(c),o("default")}catch{o("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ot,{}),e(G,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:i.length>0?e("ul",{class:"link-list",children:i.map(r=>e("li",{children:e(G,{to:n?`/${n}/t/${r.name}`:`/t/${r.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:r.name})]})}))}):d==="loading"?e("p",{class:"ui-state",children:e(ge,{abrupt:!0})}):d==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function ri(t,n,d){var m;const{filtered:o}=t;if(!(o!=null&&o.length)||d&&((m=t.account)==null?void 0:m.id)===d)return!0;const s=o.filter(l=>{const{filter:u}=l,f=u.context.includes(n);return f?u.expiresAt?new Date(u.expiresAt)>new Date:f:!1});if(!s.length)return!0;if(s.some(l=>l.filter.filterAction==="hide"))return!1;const c=s.some(l=>l.filter.filterAction==="warn");if(c){const l=s.map(u=>u.filter.title);t._filtered={titles:l,titlesStr:l.join(" • ")}}return c}function qe(t,n){if(!(t!=null&&t.length))return[];if(!n)return t;const d=X.session.get("currentAccount");return t.filter(o=>ri(o,n,d))}const di=20;function Ot({title:t,path:n,id:d,...o}){Se(t||"Following",n||"/following");const{masto:i,streaming:s,instance:r}=q(),c=oe(v),m=_(),l=_();async function u(p){(p||!m.current)&&(m.current=i.v1.timelines.home.list({limit:di}));const a=await m.current.next();let{value:h}=a;return h!=null&&h.length&&(p&&(l.current=h[0].id),h=qe(h,"home"),h.forEach(g=>{ke(g,r)}),h=cn(h,r),h.sort((g,y)=>{const b=new Date(g.createdAt);return new Date(y.createdAt)-b})),{...a,value:h}}async function f(){try{const p=await i.v1.timelines.home.list({limit:5,since_id:l.current}).next();let{value:a}=p;return!!(a!=null&&a.length&&(l.current=a[0].id,a=cn(a,r),a=qe(a,"home"),a.some(h=>!h.reblog)))}catch{return!1}}return z(()=>{let p;return(async()=>{if(s){p=s.user.subscribe();for await(const a of p){if(!p)break;if(a.event==="status.update"){const h=a.payload;ke(h,r)}else if(a.event==="delete"){const h=a.payload,g=yn(h,r);g&&(g._deleted=!0)}}}})(),()=>{var a;(a=p==null?void 0:p.unsubscribe)==null||a.call(p),p=null}},[s]),e(Fe,{title:t||"Following",id:d||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:r,fetchItems:u,checkForUpdates:f,useItemID:!0,boostsCarousel:c.settings.boostsCarousel,...o,allowFilters:!0})}const ui=20,hi=4,an=hi+1;function Nn({columnMode:t,...n}){let{hashtag:d,...o}=t?{}:Ke();n.hashtag&&(d=n.hashtag);let i=d.trim().split(/[\s+]+/);i.sort(),d=i[0];const{masto:s,instance:r,authenticated:c}=q({instance:(n==null?void 0:n.instance)||o.instance}),{authenticated:m}=q(),l=i.map(I=>`#${I}`).join(" "),u=r?`${l} on ${r}`:l;Se(u,"/:instance?/t/:hashtag");const f=_(),p=_(void 0);async function a(I){const $=await s.v1.timelines.tag.$select(d).list({limit:ui,any:i.slice(1),maxId:I?void 0:p.current}).next(),{value:U}=$;return U!=null&&U.length&&(I&&(f.current=U[0].id),U.forEach(L=>{ke(L,r)}),p.current=U[U.length-1].id),{...$,value:U}}async function h(){try{const I=await s.v1.timelines.tag.$select(d).list({limit:1,any:i.slice(1),since_id:f.current}).next(),{value:$}=I;return!!($!=null&&$.length)}catch{return!1}}const[g,y]=T("default"),[b,k]=T();z(()=>{(async()=>{try{const I=await s.v1.tags.$select(d).fetch();k(I)}catch{}})()},[d]);const S=i.length>=an;return e(Fe,{title:u,titleComponent:!!r&&e("h1",{class:"header-account",children:[e("b",{children:l}),e("div",{children:r})]}),id:"hashtag",instance:r,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:a,checkForUpdates:h,useItemID:!0,headerEnd:e(it,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!b&&i.length===1&&e(x,{children:[e(Ne,{subMenu:!0,confirm:b.following,confirmLabel:`Unfollow #${d}?`,disabled:g==="loading"||!c,onClick:()=>{y("loading"),b.following?s.v1.tags.$select(d).unfollow().then(()=>{k({...b,following:!1}),ie(`Unfollowed #${d}`)}).catch(I=>{alert(I)}).finally(()=>{y("default")}):s.v1.tags.$select(d).follow().then(()=>{k({...b,following:!0}),ie(`Followed #${d}`)}).catch(I=>{alert(I)}).finally(()=>{y("default")})},children:b.following?e(x,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(x,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(De,{})]}),e(rs,{className:"menu-field",disabled:S,children:({ref:I})=>e("form",{onSubmit:$=>{var L,R;$.preventDefault();const U=(R=(L=$.target[0].value)==null?void 0:L.trim)==null?void 0:R.call(L);U&&!i.some(j=>j.toLowerCase()===U.toLowerCase())&&(i.push(U),i.sort(),location.hash=r?`/${r}/t/${i.join("+")}`:`/t/${i.join("+")}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:I,type:"text",placeholder:S?`Max ${an} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:S})]})}),e(ds,{takeOverflow:!0,children:i.map((I,$)=>e(Z,{disabled:i.length===1,onClick:U=>{i.splice($,1),i.sort(),location.hash=r?`/${r}/t/${i.join("+")}`:`/t/${i.join("+")}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),I]})]},I))}),e(De,{}),e(Z,{disabled:!m,onClick:()=>{const I={type:"hashtag",hashtag:i.join(" "),instance:r};v.shortcuts.some(U=>U.type===I.type&&U.hashtag.split(/[\s+]+/).sort().join(" ")===I.hashtag.split(/[\s+]+/).sort().join(" ")&&(U.instance?U.instance===I.instance:!0))?alert("This shortcut already exists"):(v.shortcuts.push(I),ie("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(Z,{onClick:()=>{let I=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(I)){I&&alert("Invalid instance");return}I&&(I=I.toLowerCase().trim(),location.hash=`/${I}/t/${i.join("+")}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},r+l)}const fi=20;function _n(t){var g;const n=oe(v),{masto:d,instance:o}=q(),i=(t==null?void 0:t.id)||((g=Ke())==null?void 0:g.id),s=_(),r=_();async function c(y){(y||!r.current)&&(r.current=d.v1.timelines.list.$select(i).list({limit:fi}));const b=await r.current.next();let{value:k}=b;return k!=null&&k.length&&(y&&(s.current=k[0].id),k=qe(k,"home"),k.forEach(S=>{ke(S,o)})),{...b,value:k}}async function m(){try{const y=await d.v1.timelines.list.$select(i).list({limit:1,since_id:s.current});let{value:b}=y;return b=qe(b,"home"),!!(b!=null&&b.length)}catch{return!1}}const[l,u]=T({title:"List"});Se(l.title,"/l/:id"),z(()=>{(async()=>{try{const y=await d.v1.lists.$select(i).fetch();u(y)}catch{}})()},[i]);const[f,p]=T(!1),[a,h]=T(!1);return e(x,{children:[e(Fe,{title:l.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:o,fetchItems:c,checkForUpdates:m,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:e(G,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(it,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(Z,{onClick:()=>p({list:l}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(Z,{onClick:()=>h(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},i),f&&e(pe,{class:"light",onClick:y=>{y.target===y.currentTarget&&p(!1)},children:e(zt,{list:f==null?void 0:f.list,onClose:y=>{y.state==="success"&&y.list?u(y.list):y.state==="deleted"&&(location.hash="/l"),p(!1)}})}),a&&e(pe,{class:"light",onClick:y=>{y.target===y.currentTarget&&h(!1)},children:e(mi,{listID:i,onClose:()=>h(!1)})})]})}const pi=40;function mi({listID:t,onClose:n}){const{masto:d,instance:o}=q(),[i,s]=T([]),[r,c]=T("default"),[m,l]=T(!1),u=_();async function f(p){l(!1),c("loading"),(async()=>{try{(p||!u.current)&&(u.current=d.v1.lists.$select(t).accounts.list({limit:pi}));const a=await u.current.next();let{done:h,value:g}=a;g!=null&&g.length?(s(p?g:i.concat(g)),l(!h)):l(!1),c("default")}catch{c("error")}})()}return z(()=>{f(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[i.map(p=>e("li",{children:[e(_e,{account:p,instance:o}),e(gi,{account:p,listID:t})]},p.id)),m&&r==="default"&&e(st,{as:"li",onChange:p=>p&&f(),children:e("button",{type:"button",class:"light block",onClick:f,children:"Show more…"})})]})})]})}function gi({account:t,listID:n}){const{masto:d}=q(),[o,i]=T("default"),[s,r]=T(!1);return e(Ne,{confirm:!s,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(i("loading"),(async()=>{try{await d.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),i("default"),r(!1)}catch{i("error")}})()):(i("loading"),(async()=>{try{await d.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),i("default"),r(!0)}catch{i("error")}})())},children:e("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:o==="loading",children:s?"Add":"Remove…"})})}const ln=20,bi=new URLSearchParams;function Pn({columnMode:t,...n}){Se("Mentions","/mentions");const{masto:d,instance:o}=q(),[i]=t?[bi]:Ue(),[s,r]=T(null),c=(n==null?void 0:n.type)||i.get("type")||s,m=_(),l=_();async function u(b){(b||!m.current)&&(m.current=d.v1.notifications.list({limit:ln,types:["mention"]}));const k=await m.current.next();let{value:S}=k;return S!=null&&S.length&&(b&&(l.current=S[0].id),S.forEach(({status:I})=>{ke(I,o)})),{...k,value:S==null?void 0:S.map(I=>I.status)}}const f=_(),p=_();async function a(b){(b||!f.current)&&(f.current=d.v1.conversations.list({limit:ln}));const k=await f.current.next();let{value:S}=k;return S=S==null?void 0:S.filter(I=>I.lastStatus),S!=null&&S.length&&(b&&(p.current=S[0].lastStatus.id),S.forEach(({lastStatus:I})=>{ke(I,o)})),{...k,value:S==null?void 0:S.map(I=>I.lastStatus)}}function h(...b){return c==="private"?a(...b):u(...b)}async function g(){if(c==="private")try{const b=await d.v1.conversations.list({limit:1,since_id:p.current}).next();let{value:k}=b;return k!=null&&k.length?(p.current=k[0].lastStatus.id,!0):!1}catch{return!1}else try{const b=await d.v1.notifications.list({limit:1,types:["mention"],since_id:l.current}).next();let{value:k}=b;return k!=null&&k.length?(l.current=k[0].id,!0):!1}catch{return!1}}const y=ue(()=>e("div",{class:"filter-bar centered",children:[e(G,{to:"/mentions",class:c?"":"is-active",onClick:b=>{t&&(b.preventDefault(),r(null))},children:"All"}),e(G,{to:"/mentions?type=private",class:c==="private"?"is-active":"",onClick:b=>{t&&(b.preventDefault(),r("private"))},children:"Private"})]}),[c]);return e(Fe,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:o,fetchItems:h,checkForUpdates:g,useItemID:!0,timelineStart:y,refresh:c})}function Un(t){const n={},d=[];for(let s=0,r=0;s<t.length;s++){const c=t[s],{status:m,account:l,type:u,createdAt:f}=c,p=new Date(f).toLocaleDateString();let a=u;(u==="favourite"||u==="reblog")&&(a="favourite+reblog");const h=`${m==null?void 0:m.id}-${a}-${p}`,g=n[h];if(a==="follow_request")d[r++]=c;else if(g!=null&&g.account){const y=g._accounts.find(b=>b.id===l.id);y?(y._types.push(u),y._types.sort().reverse()):(l._types=[u],g._accounts.push(l))}else{l._types=[u];let y=n[h]={...c,type:a,_accounts:[l]};d[r++]=y}}const o={},i=[];for(let s=0,r=0;s<d.length;s++){const c=d[s],{account:m,_accounts:l,type:u,createdAt:f}=c,p=new Date(f).toLocaleDateString();if(u==="favourite+reblog"&&m&&l.length===1){const a=`${m==null?void 0:m.id}-${u}-${p}`,h=o[a];if(h)h._statuses.push(c.status);else{let g=o[a]={...c,type:u,_statuses:[c.status]};i[r++]=g}}else i[r++]=c}return i}const yi=30,wi=new URLSearchParams;function vi({columnMode:t}){Se("Notifications","/notifications");const{masto:n,instance:d}=q(),o=oe(v),[i,s]=T("default"),[r]=t?[wi]:Ue(),c=r.get("id"),m=r.get("access_token"),[l,u]=T(!1),[f,p]=T(!1),a=_(),{nearReachEnd:h,scrollDirection:g,reachStart:y,nearReachStart:b}=St({scrollableRef:a}),k=g==="end"&&!b,[S,I]=T([]),[$,U]=T([]),L=_();async function R(D){(D||!L.current)&&(L.current=n.v1.notifications.list({limit:yi,excludeTypes:["follow_request"]}));const Y=await L.current.next(),te=Y.value;if(te!=null&&te.length){te.forEach($e=>{ke($e.status,d,{skipThreading:!0})});const me=Un(te);D?(v.notificationsLast=te[0],v.notifications=me,n.v1.markers.create({notifications:{lastReadId:te[0].id}}).catch(()=>{})):v.notifications.push(...me)}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),Y}async function j(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const A=()=>{s("loading"),(async()=>{try{const D=await j();I(D),s("default")}catch{s("error")}})()};async function M(){try{return await n.v1.announcements.list()}catch{return[]}}const N=D=>{s("loading"),(async()=>{try{const Y=R(D),te=j(),me=M();if(D){const Ae=await me;Ae.sort((ee,P)=>{const W=new Date(ee.updatedAt||ee.createdAt);return new Date(P.updatedAt||P.createdAt)-W}),U(Ae);const V=await te;I(V)}const{done:$e}=await Y;u(!$e),s("default")}catch{s("error")}})()};z(()=>{N(!0)},[]),z(()=>{y&&N(!0)},[y]),z(()=>{h&&l&&N()},[h,l]);const ne=Sn(5e3),J=je(()=>{var D;o.settings.autoRefresh&&((D=a.current)==null?void 0:D.scrollTop)===0&&ne&&!ki()&&o.notificationsShowNew&&i!=="loading"&&N(!0)},[ne,o.notificationsShowNew,o.settings.autoRefresh,i]);z(J,[o.notificationsShowNew]);const Te=new Date,ye=new Date(Te-24*60*60*1e3);let Q=new Date;const Re=!o.notifications.some(D=>new Date(D.createdAt).toDateString()===Te.toDateString()),xe=_();return z(()=>{c&&(v.routeNotification={id:c,accessToken:atob(m)})},[c,m]),z(()=>{i==="default"&&(async()=>{try{const D=await Cn();if(D!=null&&D.getNotifications){const Y=await D.getNotifications()}}catch{}})()},[i]),e("div",{id:"notifications-page",class:"deck-container",ref:a,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${f?"only-mentions":""}`,children:[e("header",{hidden:k,onClick:D=>{var Y;D.target.closest("a, button")||(Y=a.current)==null||Y.scrollTo({top:0,behavior:"smooth"})},class:i==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ot,{}),e(G,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),o.notificationsShowNew&&i!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var D;N(!0),(D=a.current)==null||D.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),$.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",$.length>1?"s":""]})," ",e("small",{class:"insignificant",children:d})]}),$.length>1&&e("span",{class:"announcements-nav-buttons",children:$.map((D,Y)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var te;(te=xe.current)==null||te.children[Y].scrollIntoView({behavior:"smooth",block:"nearest"})},children:Y+1}))})]}),e("ul",{class:`announcements-list-${$.length>1?"multiple":"single"}`,ref:xe,children:$.map(D=>e("li",{children:e(Si,{announcement:D})}))})]})})}),S.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),S.length>5?e("details",{children:[e("summary",{children:[S.length," follow requests"]}),e("ul",{children:S.map(D=>e("li",{children:[e(_e,{account:D}),e(Rt,{accountID:D.id,onChange:()=>{}})]},D.id))})]}):e("ul",{children:S.map(D=>e("li",{children:[e(_e,{account:D}),e(Rt,{accountID:D.id,onChange:()=>{}})]},D.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:f,onChange:D=>{p(D.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),Re&&!!o.notifications.length&&e("p",{class:"ui-state insignificant",children:i==="default"?"You're all caught up.":e(x,{children:"…"})}),o.notifications.length?e(x,{children:o.notifications.filter(D=>D.type!=="follow_request").map(D=>{if(f&&D.type!=="mention")return null;const Y=new Date(D.createdAt),te=Y.toDateString()!==Q.toDateString();te&&(Q=Y);const me=Y.toDateString()===ye.toDateString()?"Yesterday":Oe(Q,{hideTime:!0});return e(x,{children:[te&&e("h2",{class:"timeline-header",children:me}),e(Bt,{instance:d,notification:D,reload:()=>{N(!0),A()}},D.id)]})})}):e(x,{children:[i==="loading"&&e(x,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((D,Y)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),i==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>N(!0),children:"Try again"})]})]}),l&&e("button",{type:"button",class:"plain block",disabled:i==="loading",onClick:()=>N(),style:{marginBlockEnd:"6em"},children:i==="loading"?e(ge,{abrupt:!0}):e(x,{children:"Show more…"})})]})})}function ki(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Si({announcement:t}){const{instance:n}=q(),{contact:d}=Xn(),o=d==null?void 0:d.account,{id:i,content:s,startsAt:r,endsAt:c,published:m,allDay:l,publishedAt:u,updatedAt:f,read:p,mentions:a,statuses:h,tags:g,emojis:y,reactions:b}=t,k=new Date(u),S=Oe(k),I=new Date(f),$=Oe(I);return e("div",{class:"announcement-block",children:[e(_e,{account:o}),e("div",{class:"announcement-content",onClick:hn({mentions:a,instance:n}),dangerouslySetInnerHTML:{__html:xt(s,{emojis:y})}}),e("p",{class:"insignificant",children:[e("time",{datetime:k.toISOString(),children:Oe(k)}),f&&$!==S&&e(x,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:I.toISOString(),children:Oe(I)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:b.map(U=>{const{name:L,count:R,me:j,staticUrl:A,url:M}=U;return e("button",{type:"button",class:`plain4 small ${j?"reacted":""}`,children:[M||A?e("img",{src:M||A,alt:L,width:"16",height:"16"}):e("span",{children:L})," ",e("span",{class:"count",children:Ee(R)})]})})})]})}const Fn=Ge(vi),Ii=20;function At({local:t,columnMode:n,...d}){const o=oe(v),i=!!t,s=n?{}:Ke(),{masto:r,instance:c}=q({instance:(d==null?void 0:d.instance)||s.instance}),m=`${i?"Local":"Federated"} timeline (${c})`;Se(m,i?"/:instance?/p/l":"/:instance?/p");const l=_(),u=_();async function f(a){(a||!u.current)&&(u.current=r.v1.timelines.public.list({limit:Ii,local:i}));const h=await u.current.next();let{value:g}=h;return g!=null&&g.length&&(a&&(l.current=g[0].id),g=qe(g,"public"),g.forEach(y=>{ke(y,c)})),{...h,value:g}}async function p(){try{const a=await r.v1.timelines.public.list({limit:1,local:i,since_id:l.current}).next();let{value:h}=a;return h=qe(h,"public"),!!(h!=null&&h.length)}catch{return!1}}return e(Fe,{title:m,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:i?"Local timeline":"Federated timeline"}),e("div",{children:c})]}),id:"public",instance:c,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:p,useItemID:!0,headerStart:e(x,{}),boostsCarousel:o.settings.boostsCarousel,allowFilters:!0,headerEnd:e(it,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(Z,{href:i?`/#/${c}/p`:`/#/${c}/p/l`,children:i?e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(De,{}),e(Z,{onClick:()=>{let a=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(a)){a&&alert("Invalid instance");return}a&&(a=a.toLowerCase().trim(),location.hash=i?`/${a}/p/l`:`/${a}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})]})},c+i)}const Ci=20;function zn({columnMode:t,...n}){const d=oe(v),o=t?{}:Ke(),{masto:i,instance:s}=q({instance:(n==null?void 0:n.instance)||o.instance}),r=`Trending (${s})`;Se(r,"/:instance?/trending");const c=_(),[m,l]=T([]),u=_();async function f(h){if(h||!u.current){u.current=i.v1.trends.statuses.list({limit:Ci});try{const b=i.v1.trends.tags.list(),{value:k}=await b.next();l(k)}catch{}}const g=await u.current.next();let{value:y}=g;return y!=null&&y.length&&(h&&(c.current=y[0].id),y=qe(y,"public"),y.forEach(b=>{ke(b,s)})),{...g,value:y}}async function p(){try{const h=await i.v1.trends.statuses.list({limit:1}).next();let{value:g}=h;return g=qe(g,"public"),g!=null&&g.length&&g[0].id!==c.current?(c.current=g[0].id,!0):!1}catch{return!1}}const a=ue(()=>m.length?e("div",{class:"filter-bar",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),m.map((h,g)=>{const{name:y,history:b}=h,k=b.reduce((S,I)=>S+ +I.uses,0);return e(G,{to:`/${s}/t/${y}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),y]}),e("span",{class:"filter-count",children:k.toLocaleString()})]})})]}):null,[m]);return e(Fe,{title:r,titleComponent:e("h1",{class:"header-account",children:[e("b",{children:"Trending"}),e("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:p,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(x,{}),boostsCarousel:d.settings.boostsCarousel,allowFilters:!0,timelineStart:a,headerEnd:e(it,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:e(Z,{onClick:()=>{let h=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(h)){h&&alert("Invalid instance");return}h&&(h=h.toLowerCase().trim(),location.hash=`/${h}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]})})},s)}function Ti(){Se("Home","/");const t=oe(v),{shortcuts:n}=t,d=n.map(o=>{if(!o)return null;const{type:i,...s}=o,r={following:Ot,notifications:Fn,list:_n,public:At,bookmarks:Dn,favourites:En,hashtag:Nn,mentions:Pn,trending:zn}[i];return r?e(r,{...s,columnMode:!0},i+JSON.stringify(s)):null});return ve(["1","2","3","4","5","6","7","8","9"],(o,i)=>{try{const s=parseInt(i.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),e("div",{id:"columns",children:d})}function xi(){var n;const t=oe(v);return z(()=>{(async()=>{const d=await et.drafts.keys();if(d.length){const o=mn();d.filter(s=>s.startsWith(o)).length&&(v.showDrafts=!0)}})()},[]),e(x,{children:(t.settings.shortcutsColumnsMode||t.settings.shortcutsViewMode==="multi-column")&&((n=t.shortcuts)!=null&&n.length)?e(Ti,{}):e(Ot,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e($i,{})})})}function $i(){const t=oe(v),n=_(),[d,o]=T(void 0);return e(x,{children:[e(G,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${d}`,onClick:i=>{i.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(i.preventDefault(),o(s=>s?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(Ai,{state:d,anchorRef:n,onClose:()=>o(void 0)})]})}const Li=30,Ri=5;function Ai({anchorRef:t,state:n,onClose:d}){const{masto:o,instance:i}=q(),s=oe(v),[r,c]=T("default"),m=o.v1.notifications.list({limit:Li});async function l(){const h=await m.next(),g=h.value;if(g!=null&&g.length){g.forEach(b=>{ke(b.status,i,{skipThreading:!0})});const y=Un(g);v.notificationsLast=g[0],v.notifications=y,o.v1.markers.create({notifications:{lastReadId:g[0].id}}).catch(()=>{})}return v.notificationsShowNew=!1,v.notificationsLastFetchTime=Date.now(),h}const[u,f]=T(!1);function p(){return o.v1.followRequests.list({limit:1})}function a(){c("loading"),(async()=>{try{await l();const h=await p();f(!!(h!=null&&h.length)),c("default")}catch{c("error")}})()}return z(()=>{n==="open"&&a()},[n]),e(vn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:d,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:s.notifications.length?e(x,{children:s.notifications.slice(0,Ri).map(h=>e(Bt,{instance:i,notification:h},h.id))}):r==="loading"?e("div",{class:"ui-state",children:e(ge,{abrupt:!0})}):r==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:a,children:"Try again"})})]})}),e("footer",{children:[e(G,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(G,{to:"/notifications",class:"button plain2",children:[u?e(x,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const Mi=Ge(xi),Di=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,Ei=/\/notes\/([^\/]+)\/?$/i;function Bn(t){const{hostname:n,pathname:d}=new URL(t),[,o,i,s]=d.match(Di)||[];if(s)return`/${n}/s/${s}`;const[,r]=d.match(Ei)||[];if(r)return`/${n}/s/${r}`}function Ni(){const n=Ut().pathname.replace(/^\//,""),d=Bn(n);return Pe(()=>{d&&setTimeout(()=>{window.location.hash=d+"?view=full"},300)},[d]),e("div",{class:"ui-state",tabIndex:"-1",children:[d?e(x,{children:[e("h2",{children:"Redirecting…"}),e("p",{children:e("a",{href:`#${d}?view=full`,children:d})})]}):e(x,{children:[e("h2",{children:"Unable to process URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(G,{to:"/",children:"Go home"})})]})}function _i(){const{masto:t}=q();Se("Lists","/l");const[n,d]=T("default"),[o,i]=vt(l=>l+1,0),[s,r]=T([]);z(()=>{d("loading"),(async()=>{try{const l=await t.v1.lists.list();r(l),d("default")}catch{d("error")}})()},[o]);const[c,m]=T(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(ot,{}),e(G,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>m(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(l=>e("li",{children:e(G,{to:`/l/${l.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:l.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(ge,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),c&&e(pe,{class:"light",onClick:l=>{l.target===l.currentTarget&&m(!1)},children:e(zt,{list:c==null?void 0:c.list,onClose:l=>{l.state==="success"&&i(),m(!1)}})})]})}const Pi=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:Ui,VITE_WEBSITE:Fi}={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},qt="read write follow push";async function zi({instanceURL:t}){const n=new URLSearchParams({client_name:Ui,redirect_uris:location.origin+location.pathname,scopes:qt,website:Fi});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Bi({instanceURL:t,client_id:n}){const d=new URLSearchParams({client_id:n,scope:qt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${d.toString()}`}async function Oi({instanceURL:t,client_id:n,client_secret:d,code:o}){const i=new URLSearchParams({client_id:n,client_secret:d,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:o,scope:qt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i.toString()})).json()}function qi(){Se("Log in");const t=_(),n=X.local.get("instanceURL"),[d,o]=T("default"),[i]=Ue(),s=i.get("instance"),[r,c]=T(s||(n==null?void 0:n.toLowerCase())||""),[m,l]=T([]);z(()=>{(async()=>{try{const h=await(await fetch(Pi)).json();l(h)}catch{}})()},[]);const u=a=>{X.local.set("instanceURL",a),(async()=>{o("loading");try{const{client_id:h,client_secret:g,vapid_key:y}=await zi({instanceURL:a});h&&g?(X.session.set("clientID",h),X.session.set("clientSecret",g),X.session.set("vapidKey",y),location.href=await Bi({instanceURL:a,client_id:h})):alert("Failed to register application"),o("default")}catch{o("error")}})()},f=a=>{a.preventDefault();const{elements:h}=a.target;let g=h.instanceURL.value.toLowerCase();g=g.replace(/^https?:\/\//,"").replace(/\/+$/,""),g=g.replace(/^@?[^@]+@/,""),/\./.test(g)||(g=m.find(y=>y.includes(g))),u(g)},p=r?m.filter(a=>a.includes(r)).sort((a,h)=>{const g=a.toLowerCase().startsWith(r.toLowerCase()),y=h.toLowerCase().startsWith(r.toLowerCase());return g&&!y?-1:!g&&y?1:0}).slice(0,10):[];return e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:f,children:[e("h1",{children:"Log in"}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:r,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:d==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:a=>{c(a.target.value)}}),(p==null?void 0:p.length)>0?e("ul",{id:"instances-suggestions",children:p.map(a=>e("li",{children:e("button",{type:"button",class:"plain4",onClick:()=>{u(a)},children:a})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),d==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{class:"large",disabled:d==="loading",children:"Log in"})," "]}),e(ge,{hidden:d!=="loading"}),e("hr",{}),e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(G,{to:"/",children:"Go home"})})]})})}const ut=5,Tt=40;function Hi(t){const n=Ke(),{masto:d,instance:o,authenticated:i}=q({instance:n.instance}),[s,r]=T("default"),[c]=Ue(),m=_(),l=(t==null?void 0:t.query)||c.get("q"),u=(t==null?void 0:t.type)||c.get("type");Se(l?`Search: ${l}${u?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[u]})`:""}`:"Search","/search");const[f,p]=T(!1),a=_(0);z(()=>{a.current=0},[l,u]);const h=_();Pe(()=>{var L,R;(R=(L=h.current)==null?void 0:L.scrollTo)==null||R.call(L,0,0)},[l,u]);const[g,y]=T([]),[b,k]=T([]),[S,I]=T([]);z(()=>{y([]),k([]),I([])},[l]);const $={statuses:y,accounts:k,hashtags:I};function U(L){r("loading"),L&&!u&&(y(g.slice(0,ut)),k(b.slice(0,ut)),I(S.slice(0,ut))),(async()=>{var j,A;const R={q:l,resolve:i,limit:ut};u&&(R.limit=Tt,R.type=u,i&&(R.offset=a.current));try{const M=await d.v2.search.fetch(R);if(u)if(L){$[u](M[u]);const N=(j=M[u])==null?void 0:j.length;a.current=Tt,p(!!N)}else{$[u](ne=>[...ne,...M[u]]);const N=(A=M[u])==null?void 0:A.length;a.current=a.current+Tt,p(!!N)}else y(M.statuses),k(M.accounts),I(M.hashtags),a.current=0,p(!1);r("default")}catch{r("error")}})()}return z(()=>{var L,R,j,A;l?((R=(L=m.current)==null?void 0:L.setValue)==null||R.call(L,l),U(!0)):(A=(j=m.current)==null?void 0:j.focus)==null||A.call(j)},[l,u,o]),ve("/",L=>{var R,j;(j=(R=m.current)==null?void 0:R.focus)==null||j.call(R)},{preventDefault:!0}),e("div",{id:"search-page",class:"deck-container",ref:h,children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(ot,{})}),e(Mn,{ref:m}),e("div",{class:"header-side",children:" "})]})}),e("main",{children:[!!l&&e("div",{class:"filter-bar",children:[!!u&&e(G,{to:`/search${l?`?q=${encodeURIComponent(l)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(l)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(l)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(l)}&type=statuses`}].sort((L,R)=>L.type===u?-1:R.type===u?1:0).map(L=>e(G,{to:L.to,children:L.label}))]}),l?e(x,{children:[(!u||u==="accounts")&&e(x,{children:[u!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),b.length>0?e(x,{children:[e("ul",{class:"timeline flat accounts-list",children:b.map(L=>e("li",{children:e(_e,{account:L,instance:o,showStats:!0})},L.id))}),u!=="accounts"&&e("div",{class:"ui-state",children:e(G,{class:"plain button",to:`/search?q=${l}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?e("p",{class:"ui-state",children:e(ge,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!u||u==="hashtags")&&e(x,{children:[u!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),S.length>0?e(x,{children:[e("ul",{class:"link-list hashtag-list",children:S.map(L=>e("li",{children:e(G,{to:o?`/${o}/t/${L.name}`:`/t/${L.name}`,children:[e(w,{icon:"hashtag"}),e("span",{children:L.name})]})},L.name))}),u!=="hashtags"&&e("div",{class:"ui-state",children:e(G,{class:"plain button",to:`/search?q=${l}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?e("p",{class:"ui-state",children:e(ge,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!u||u==="statuses")&&e(x,{children:[u!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),g.length>0?e(x,{children:[e("ul",{class:"timeline",children:g.map(L=>e("li",{children:e(G,{class:"status-link",to:o?`/${o}/s/${L.id}`:`/s/${L.id}`,children:e(we,{status:L})})},L.id))}),u!=="statuses"&&e("div",{class:"ui-state",children:e(G,{class:"plain button",to:`/search?q=${l}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?e("p",{class:"ui-state",children:e(ge,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!u&&(s==="default"?f?e(st,{onChange:L=>{L&&U()},children:e("button",{type:"button",class:"plain block",onClick:()=>U(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&e("p",{class:"ui-state",children:e(ge,{abrupt:!0})}))]}):s==="loading"?e("p",{class:"ui-state",children:e(ge,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const ht=40,Vi=10,ji=5;let Mt={},mt={},gt={};function Dt(t){delete mt[t],delete gt[t]}const ft={block:"nearest",inline:"center",behavior:"smooth"};function Gi(t){const{id:n}=t,{masto:d,instance:o}=q({instance:t.instance}),i=oe(v),[s,r]=Ue(),c=s.get("media"),m=s.get("media-only"),l=parseInt(c||m,10);let u=l>0;const f=s.get("mediaStatusID"),p=yn(f,o);f&&!p&&(u=!1);const a=u&&!!m,h=Pt(n,o),[g,y]=T(v.statuses[h]);z(()=>{v.statuses[h]&&y(v.statuses[h])},[h]);const b=ue(()=>{const{prevLocation:I}=v,$=((I==null?void 0:I.pathname)||"")+((I==null?void 0:I.search)||""),U=nt("/:instance/s/:id",$)||nt("/s/:id",$);return!$||U?"/":$},[]);z(()=>{!g&&u&&(async()=>{try{const I=await d.v1.statuses.$select(n).fetch();ke(I,o),y(I)}catch{alert("Unable to load post."),location.hash=b}})()},[u]);const k=f?p==null?void 0:p.mediaAttachments:g==null?void 0:g.mediaAttachments,S=je(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&i.prevLocation?history.back():a?location.hash=b:(s.delete("media"),s.delete("mediaStatusID"),r(s))},[a,b,i.prevLocation]);return e("div",{class:"deck-backdrop",children:[u?k!=null&&k.length?e(Rn,{mediaAttachments:k,statusID:f||n,instance:o,lang:g==null?void 0:g.language,index:l-1,onClose:S}):e("div",{class:"media-modal-container loading",children:e(ge,{abrupt:!0})}):e(G,{to:b}),!a&&e(Wi,{id:n,instance:t.instance,closeLink:b})]})}function Wi({id:t,closeLink:n="/",instance:d}){var W;const[o,i]=Ue(),s=o.get("media"),r=parseInt(s,10)>0,[c,m]=T(o.get("view")),l=!!parseInt(o.get("translate")),{masto:u,instance:f}=q({instance:d}),{masto:p,instance:a,authenticated:h}=q(),g=f===a,y=oe(v),[b,k]=T([]),[S,I]=T("default"),$=_(),U=Pt(t,f),L=_(0),R=_();z(()=>{var C;(C=R.current)==null||C.focus()},[]),z(()=>{var E;const C=us(()=>{if(!R.current)return;const{scrollTop:B}=R.current;S!=="loading"&&(gt[t]=B)},50);return(E=R.current)==null||E.addEventListener("scroll",C,{passive:!0}),C(),()=>{var B;C.cancel(),(B=R.current)==null||B.removeEventListener("scroll",C)}},[t,S!=="loading"]);const j=_(),A=({reloadHero:C}={})=>{I("loading");let E;const B=mt[t];if(B){const K=B.filter(H=>v.statuses[U]);k(K)}else k([{id:t}]);return(async()=>{var le,de;const K=()=>Yt(()=>u.v1.statuses.$select(t).fetch(),{retries:4}),H=Yt(()=>u.v1.statuses.$select(t).context.fetch(),{retries:8}),Le=!!y.statuses[U];let he=y.statuses[U];if(!(Le&&!C))try{he=await K(),ke(he,f),await new Promise(ce=>{setTimeout(ce,100)})}catch{I("error");return}try{let ce=function(O){return O==null?void 0:O.map(re=>({id:re.id,account:re.account,repliesCount:re.repliesCount,content:re.content,weight:tt(re),replies:ce(re.__replies)}))};const Ie=await H,{ancestors:Me,descendants:F}=Ie;L.current=(F==null?void 0:F.length)||0;const ae=new Set;Me.forEach(O=>{ke(O,f,{skipThreading:!0}),O.inReplyToId&&!Me.find(re=>re.id===O.inReplyToId)&&ae.add(O.inReplyToId)});const be=Me.every(O=>O.account.id===he.account.id),se=[];F.forEach(O=>{if(ke(O,f,{skipThreading:!0}),O.inReplyToId&&!F.find(re=>re.id===O.inReplyToId)&&O.inReplyToId!==he.id&&ae.add(O.inReplyToId),O.inReplyToAccountId===O.account.id)se.push(O);else if(O.inReplyToId===he.id)se.push(O);else if(!O.inReplyToAccountId&&se.find(re=>re.id===O.inReplyToId)&&O.account.id===he.account.id)se.push(O);else{const re=F.find(Je=>Je.id===O.inReplyToId);re&&(re.__replies||(re.__replies=[]),re.__replies.push(O))}}),ae.size;const ze=[...Me.map(O=>({id:O.id,ancestor:!0,isThread:be,accountID:O.account.id,account:O.account,repliesCount:O.repliesCount,weight:tt(O)})),{id:t,accountID:he.account.id,weight:tt(he)},...se.map(O=>({id:O.id,account:O.account,accountID:O.account.id,descendant:!0,thread:O.account.id===he.account.id,weight:tt(O),replies:ce(O.__replies)}))];I("default"),j.current={offsetTop:(le=$.current)==null?void 0:le.offsetTop,scrollTop:(de=R.current)==null?void 0:de.scrollTop};const Be=ze.findIndex(O=>O.id===t);Be>=ye&&Q(Be+1),k(ze),mt[t]=ze,Zn(he,f)}catch{I("error")}})(),()=>{clearTimeout(E)}};z(A,[t,u]),z(()=>{var E,B;if(!b.length)return;const C=gt[t];if(C)R.current.scrollTop=C;else if(j.current){const K={offsetTop:(E=$.current)==null?void 0:E.offsetTop,scrollTop:(B=R.current)==null?void 0:B.scrollTop},H=K.offsetTop-j.current.offsetTop+K.scrollTop;R.current.scrollTop=H}else b.length===1&&(R.current.scrollTop=0);j.current=null},[b]),z(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:C}=Qe(),E=`https://${C}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(E,{ignoreVary:!0}),A({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),z(()=>()=>{gt={},v.reloadStatusPage=0,mt={},Mt={},Et.clear()},[]);const M=y.statuses[U]||y.statuses[t],N=ue(()=>{if(!M)return"";const{account:C}=M,E=document.createElement("div");return E.innerHTML=C.displayName,E.innerText.trim()},[M]),ne=ue(()=>{if(!M)return"";let C=bn(M);return C.length>64&&(C=C.slice(0,64)+"…"),C},[M]);Se(N&&ne?`${N}: "${ne}"`:"Status","/:instance?/s/:id");const J=ue(()=>{if(!M)return;const{url:C}=M;if(C)return new URL(C).hostname},[M]),Te=ue(()=>{if(J)return J===f},[J,f]),[ye,Q]=T(ht),Re=ue(()=>b.length-ye,[b.length,ye]),xe=b.some(C=>C.descendant),D=b.filter(C=>C.ancestor),[Y,te]=T(!0),me=kn(te,100),$e=ue(()=>{if(!$.current||Y)return null;const{top:C}=$.current.getBoundingClientRect();return C>0?"down":"up"},[Y]);ve("esc",()=>{location.hash=n},{enabled:!r}),ve("backspace",()=>{location.hash=n}),ve("j",()=>{const C=document.activeElement.closest(".status-link, .status-focus"),E=C==null?void 0:C.getBoundingClientRect(),B=Array.from(R.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(C&&E.top<R.current.clientHeight&&E.bottom>0){const K=B.indexOf(C);let H=B[K+1];H&&(H.focus(),H.scrollIntoView(ft))}else{const K=B.find(H=>{const Le=H.getBoundingClientRect();return Le.top>=44&&Le.left>=0});K&&(K.focus(),K.scrollIntoView(ft))}}),ve("k",()=>{const C=document.activeElement.closest(".status-link, .status-focus"),E=C==null?void 0:C.getBoundingClientRect(),B=Array.from(R.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(C&&E.top<R.current.clientHeight&&E.bottom>0){const K=B.indexOf(C);let H=B[K-1];H&&(H.focus(),H.scrollIntoView(ft))}else{const K=B.find(H=>{const Le=H.getBoundingClientRect();return Le.top>=44&&Le.left>=0});K&&(K.focus(),K.scrollIntoView(ft))}}),ve("x",()=>{const C=document.activeElement.closest(".status-link, .status-focus");if(C){const E=C.nextElementSibling;E&&E.tagName.toLowerCase()==="details"&&(E.open=!E.open)}});const{nearReachStart:Ae}=St({scrollableRef:R,distanceFromStartPx:16}),V=_(r?"media+status":"status"),ee=je((C,E,B,K)=>{C.preventDefault(),C.stopPropagation(),i({media:E+1,mediaStatusID:K.id})},[t]),P=je((C,E)=>{Dt(E.id)},[]);return e("div",{tabIndex:"-1",ref:R,class:`status-deck deck contained ${b.length>1?"padded-bottom":""} ${V.current==="status"?"slide-in":""} ${c?`deck-view-${c}`:""}`,onAnimationEnd:C=>{V.current==="status"&&(V.current=null)},children:[e("header",{class:`${Y?"inview":""} ${S==="loading"?"loading":""}`,onDblClick:C=>{v.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[!!/\/s\//i.test((W=y.prevLocation)==null?void 0:W.pathname)&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!Y&&M&&S!=="loading"?e(x,{children:[e("span",{class:"hero-heading",children:[e(Nt,{account:M.account,instance:f,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(_t,{datetime:M.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:C=>{C.preventDefault(),C.stopPropagation(),$.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:$e==="down"?"arrow-down":"arrow-up"})})]}):e(x,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:C=>{C.preventDefault(),C.stopPropagation(),R.current.scrollTo({top:0,behavior:"smooth"})},hidden:!D.length||Ae,title:`${D.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),D.filter((C,E,B)=>B.findIndex(K=>K.accountID===C.accountID)===E).slice(0,3).map(C=>e(Ve,{url:C.account.avatar,alt:C.account.displayName},C.account.id)),D.length>3&&e(x,{children:[" ",e("span",{class:"insignificant",children:Ee(D.length)})]})]})]})]}),e("div",{class:"header-side",children:[e(We,{align:"end",portal:{target:R.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(Z,{disabled:S==="loading",onClick:()=>{v.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(Z,{className:"menu-switch-view",onClick:()=>{m(c==="full"?null:"full"),o.delete("media"),o.delete("media-only"),c==="full"?o.delete("view"):o.set("view","full"),i(o)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[c||""]}),e("span",{children:["Switch to ",c==="full"?"Side Peek":"Full"," view"]})]}),e(Z,{onClick:()=>{Array.from(R.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(E=>{E.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(De,{}),e(hs,{className:"plain",children:"Experimental"}),e(Z,{disabled:Te,onClick:()=>{const C=Bn(M.url);C?location.hash=C:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance (",e("b",{children:J}),")"]})]})]}),e(G,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),b.length&&M?e("ul",{class:`timeline flat contextual grow ${S==="loading"?"loading":""}`,children:[b.slice(0,ye).map(C=>{const{id:E,ancestor:B,isThread:K,descendant:H,thread:Le,replies:he,repliesCount:le,weight:de}=C,ce=E===t;return e("li",{ref:ce?$:null,class:`${B?"ancestor":""} ${H?"descendant":""} ${Le?"thread":""} ${ce?"hero":""}`,children:[ce?e(x,{children:[e(st,{threshold:.1,onChange:me,class:"status-focus",tabIndex:0,children:e(we,{statusID:E,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:l})}),S!=="loading"&&!h?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(G,{to:"/login",class:"button",children:"Log in"})]}):!g&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:S==="loading",onClick:()=>{I("loading"),(async()=>{try{const Ie=await p.v2.search.fetch({q:M.url,type:"statuses",resolve:!0,limit:1});if(Ie.statuses.length){const Me=Ie.statuses[0];location.hash=a?`/${a}/s/${Me.id}`:`/s/${Me.id}`}else throw new Error("No results")}catch(Ie){I("default"),alert("Error: "+Ie)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(G,{class:"status-link",to:f?`/${f}/s/${E}`:`/s/${E}`,onClick:()=>{Dt(E)},children:[e(we,{statusID:E,instance:f,withinContext:!0,size:Le||B?"m":"s",enableTranslate:!0,onMediaClick:ee,onStatusLinkClick:P}),B&&K&&le>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:le,children:Ee(le)})]})," "]}),H&&(he==null?void 0:he.length)>0&&e(On,{instance:f,replies:he,hasParentThread:Le,level:1,accWeight:de,openAll:L.current<Vi}),S==="loading"&&ce&&!!(M!=null&&M.repliesCount)&&!xe&&e("div",{class:"status-loading",children:e(ge,{})}),S==="error"&&ce&&!!(M!=null&&M.repliesCount)&&!xe&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]},E)}),Re>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:S==="loading",onClick:()=>Q(C=>C+ht),style:{marginBlockEnd:"6em"},children:[e("div",{class:"ib",children:b.slice(ye,ye+5).map(C=>e(Ve,{url:C.account.avatarStatic},C.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:Re>ht?`${ht}+`:Re})]})]})})]}):e(x,{children:[S==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(we,{skeleton:!0,size:"l"})})}),S==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{v.reloadStatusPage++},children:"Try again"})]})]})]})}function On({replies:t,instance:n,hasParentThread:d,level:o,accWeight:i,openAll:s}){const[r,c]=Ue(),m=b=>b.reduce((k,S)=>{const{repliesCount:I,replies:$}=S,U=($==null?void 0:$.length)||I;return k+U+m($||[])},0),l=t.length+m(t),u=t.length===l,f=t.map(b=>b.account).filter((b,k,S)=>S.findIndex(I=>I.id===b.id)===k).slice(0,3),p=ue(()=>t==null?void 0:t.reduce((b,k)=>b+(k==null?void 0:k.weight),i),[i,t==null?void 0:t.length]);let a=!1;(s||p<=ji||!d&&l===1&&tt(t[0])<2)&&(a=!0);const h=Mt[t[0].id],g=je((b,k,S,I)=>{b.preventDefault(),b.stopPropagation(),c({media:k+1,mediaStatusID:I.id})},[]),y=_();return Pe(()=>{var k;function b(S){S.target.dataset.scrollLeft=S.target.scrollLeft}return(k=y.current)==null||k.addEventListener("scroll",b,{passive:!0}),()=>{var S;(S=y.current)==null||S.removeEventListener("scroll",b)}},[]),e("details",{ref:y,class:"replies",open:h||a,onToggle:b=>{const{open:k}=b.target;Mt[t[0].id]=k},style:{"--comments-level":o},"data-comments-level":o,"data-comments-level-overflow":o>4,children:[e("summary",{class:"replies-summary",hidden:a,children:[e("span",{class:"avatars",children:f.map(b=>e(Ve,{url:b.avatarStatic,title:`${b.displayName} @${b.username}`,squircle:b==null?void 0:b.bot},b.id))}),e("span",{children:[e("span",{title:t.length,children:Ee(t.length)})," ","repl",t.length===1?"y":"ies"]}),!u&&l>1&&e(x,{children:[" ","·"," ",e("span",{children:[e("span",{title:l,children:Ee(l)})," ","comment",l===1?"":"s"]})]})]}),e("ul",{children:t.map(b=>{var k,S;return e("li",{children:[e(G,{class:"status-link",to:n?`/${n}/s/${b.id}`:`/s/${b.id}`,onClick:()=>{Dt(b.id)},children:[e(we,{statusID:b.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:g}),!((k=b.replies)!=null&&k.length)&&b.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment"})," ",e("span",{title:b.repliesCount,children:Ee(b.repliesCount)})]})]}),((S=b.replies)==null?void 0:S.length)&&e(On,{instance:n,replies:b.replies,level:o+1,accWeight:a?p:b.weight,openAll:s})]},b.id)})})]})}const Ki=140,Ji=35,Yi=70,Xi=140,Et=new Map;function tt(t){var a,h;const n=Et.get(t.id);if(n)return n;const{spoilerText:d,content:o,mediaAttachments:i,poll:s,card:r}=t,c=Qn(d+o),m=i!=null&&i.length?Ki:0,l=(((a=s==null?void 0:s.options)==null?void 0:a.length)||0)*Ji,u=r&&(i!=null&&i.length||(h=s==null?void 0:s.options)!=null&&h.length)?0:Yi,p=(c+m+l+u)/Xi;return Et.set(t.id,p),p}const Zi=Ge(Gi);function Qi(){const t=Ke(),{id:n,instance:d}=t;return e(Zi,{id:n,instance:d})}const eo=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,to=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,no=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,so=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,io=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,oo=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function rn(){return Se(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("h1",{children:[e("img",{src:In,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:oo,alt:"Phanpy",width:"250"})]}),e("p",{children:e("big",{children:e("b",{children:e(G,{to:"/login",class:"button",children:"Log in"})})})}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:eo,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:io,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:to,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:no,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:so,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),e("hr",{}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),v.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const co=window.alert;window.__nativeAlert||(window.__nativeAlert=co);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=fs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=v;setTimeout(()=>{var t,n,d,o;for(const i in rt)Array.isArray(rt[i])?(n=(t=rt[i])[0])==null||n.call(t):(o=(d=rt)[i])==null||o.call(d)},5e3);function ao(){const t=oe(v),[n,d]=T(!1),[o,i]=T("loading");Pe(()=>{const u=X.local.get("theme");u&&(document.documentElement.classList.add(`is-${u}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",u==="auto"?"dark light":u));const f=X.local.get("textSize");f&&document.documentElement.style.setProperty("--text-size",`${f}px`)},[]),z(()=>{const u=X.local.get("instanceURL"),f=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(f){window.history.replaceState({},document.title,s.pathname||"/");const p=X.session.get("clientID"),a=X.session.get("clientSecret"),h=X.session.get("vapidKey");(async()=>{i("loading");const{access_token:g}=await Oi({instanceURL:u,client_id:p,client_secret:a,code:f}),y=es({instance:u,accessToken:g});await Promise.allSettled([Gt(y,u),ts(y,u,g,h)]),Wt(),Kt(y),d(!0),i("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const p=Qe();if(p){X.session.set("currentAccount",p.info.id);const{client:a}=q({account:p}),{instance:h}=a;Wt(),Kt(a),i("loading"),(async()=>{try{await Gt(a,h)}catch{}finally{d(!0),i("default")}})()}else i("default")}},[]);let s=Ut();v.currentLocation=s.pathname,z($t,[s,n]);const r=t.prevLocation,c=_(r||null);if(ue(()=>nt("/:instance/s/:id",s.pathname)||nt("/s/:id",s.pathname),[s.pathname,nt])?c.current||(c.current=r):c.current=null,/\/https?:/.test(s.pathname))return e(Ni,{});const l=ue(()=>{const{pathname:u}=s;return!/^\/(login|welcome)/.test(u)},[s]);return z(()=>{var f;const u=document.getElementById("app");u&&(u.dataset.shortcutsViewMode=(f=t.shortcuts)!=null&&f.length?t.settings.shortcutsViewMode:"")},[t.shortcuts,t.settings.shortcutsViewMode]),z(()=>{document.body.classList.toggle("cloak",t.settings.cloakMode)},[t.settings.cloakMode]),e(x,{children:[e(It,{location:l||s,children:[e(fe,{path:"/",element:n?e(Mi,{}):o==="loading"?e(ge,{id:"loader-root"}):e(rn,{})}),e(fe,{path:"/login",element:e(qi,{})}),e(fe,{path:"/welcome",element:e(rn,{})})]}),e(It,{location:c.current||s,children:[n&&e(fe,{path:"/notifications",element:e(Fn,{})}),n&&e(fe,{path:"/mentions",element:e(Pn,{})}),n&&e(fe,{path:"/following",element:e(Ot,{})}),n&&e(fe,{path:"/b",element:e(Dn,{})}),n&&e(fe,{path:"/f",element:e(En,{})}),n&&e(fe,{path:"/l",children:[e(fe,{index:!0,element:e(_i,{})}),e(fe,{path:":id",element:e(_n,{})})]}),n&&e(fe,{path:"/ft",element:e(li,{})}),e(fe,{path:"/:instance?/t/:hashtag",element:e(Nn,{})}),e(fe,{path:"/:instance?/a/:id",element:e(ii,{})}),e(fe,{path:"/:instance?/p",children:[e(fe,{index:!0,element:e(At,{})}),e(fe,{path:"l",element:e(At,{local:!0})})]}),e(fe,{path:"/:instance?/trending",element:e(zn,{})}),e(fe,{path:"/:instance?/search",element:e(Hi,{})})]}),o==="default"&&e(It,{children:e(fe,{path:"/:instance?/s/:id",element:e(Qi,{})})}),n&&e(bs,{}),n&&!t.settings.shortcutsColumnsMode&&t.settings.shortcutsViewMode!=="multi-column"&&e(Xs,{}),e(Ks,{}),n&&e(Js,{}),e(gs,{isLoggedIn:n}),o!=="loading"&&e(Ys,{onClose:$t}),e(ys,{})]})}ps(e(ms,{children:e(ao,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-cc266f92.js.map
