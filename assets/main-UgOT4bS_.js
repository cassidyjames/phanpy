import{s as k,a as W,b as Ee,u as Hn,c as ue,o as Cs,I as w,M as Re,d as le,A as Ze,N as dt,e as je,f as Je,L as se,g as ut,h as Vn,l as $s,t as un,R as pt,i as As,p as it,j as We,k as Gn,m as qt,E as jn,n as Oe,q as Xe,r as xs,v as Ce,w as Ht,T as Yn,x as Ve,y as _t,z as hn,B as Rs,C as Ls,D as Wn,F as Fe,G as Kn,S as _e,H as _s,J as Es,K as Ms,O as Ge,P as Zn,Q as Et,U as Ps,V as ft,W as Jn,X as Pe,Y as Ns,Z as Xn,_ as Ds,$ as Us,a0 as It,a1 as Fs,a2 as pn,a3 as Os,a4 as fn,a5 as mn}from"./useTitle-3KaK9Th3.js";import{F as O,_ as j,p as $,u as Me,w as Be,a as e,b as Te,g as x,y as kt,c as Zt,M as pe,d as ze,e as mt,q as me,x as Ke,S as zs,I as Qe,A as et,f as Jt,l as gn,s as Qn,h as es,i as Ye,T as Bs,N as qs,j as Hs,P as Vs,J as Gs,C as ts,k as js,m as at,n as Ys,o as Ws,r as ns,t as Ks,v as Zs,z as Js,B as St,D as ss,E as bn,G as Xs,R as Xt,H as Le,K as Qs,L as ei}from"./vendor-SN1LpyO7.js";function ht(t=()=>{},n=[]){const s=O(t);j(()=>{s.current=t},[n]),j(()=>{const a=()=>{const o=document.hidden||document.visibilityState==="hidden";s.current(!o)};return document.addEventListener("visibilitychange",a),()=>document.removeEventListener("visibilitychange",a)},[])}const ti=1e3*3,ni=15e3,si=Be(function({isLoggedIn:n}){const[s,a]=$(!0);ht(a);const o=async(r,c,l)=>{var p;if(k.notificationsLast){const d=r.v1.notifications.list({limit:1,sinceId:k.notificationsLast.id}),{value:f}=await d.next();if(f!=null&&f.length)if(l)k.notificationsShowNew=!0;else{let h;try{const b=await r.v1.markers.fetch({timeline:"notifications"});h=(p=b==null?void 0:b.notifications)==null?void 0:p.lastReadId}catch{}h?k.notificationsShowNew=f[0].id!==h:k.notificationsShowNew=!0}}};j(()=>{let r,c;if(n&&s){const{masto:l,streaming:p,instance:d}=W();(async()=>{await o(l,d);let f=!1;p&&(c=setTimeout(()=>{(async()=>{try{f=!0,r=p.user.notification.subscribe();for await(const h of r){if(!r||!s)break;h.event==="notification"&&Ee(h.payload,d,{skipThreading:!0}),k.notificationsShowNew=!0}}catch{f=!1}f||(c=setInterval(()=>{o(l,d,!0)},ni))})()},ti))})()}return()=>{var l;(l=r==null?void 0:r.unsubscribe)==null||l.call(r),r=null,clearTimeout(c),clearInterval(c)}},[s,n]);const i=O(),u=()=>{i.current=Date.now(),fetch("./version.json").then(r=>r.json()).then(r=>{r&&(k.appVersion=r)}).catch(r=>{})};return Hn(u,s&&1e3*60*30),ht(r=>{r&&(i.current?Date.now()-i.current>1e3*60*60&&u():u())}),Me("shift+alt+k",()=>{const r=k.settings.cloakMode;k.settings.cloakMode=!r,ue({text:`Cloak mode ${r?"disabled":"enabled"}`})}),null});function ii(){function t(n){n.shiftKey?Cs()||(k.showCompose=!0):k.showCompose=!0}return Me("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(w,{icon:"quill",size:"xl",alt:"Compose"})})}const oi=Be(function(){const n=Te(k);function s(){k.showKeyboardShortcutsHelp=!1}return Me("?, shift+?, shift+slash",a=>{k.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:a=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&e(Re,{class:"light",onClose:s,children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Load new posts",keys:e("kbd",{children:"."})},{action:"Open post details",keys:e(x,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:e(x,{children:["Expand content warning or",e("br",{}),"toggle expanded/collapsed thread"]}),keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(x,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(x,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"c"})]})},{action:"Send post",keys:e(x,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:e(x,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:e(x,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"Alt"})," + ",e("kbd",{children:"k"})]})}].map(({action:a,className:o,keys:i})=>e("tr",{children:[e("th",{class:o,children:a}),e("td",{children:i})]},a))})})]})})});function ai({onClose:t}){const{masto:n}=W(),s=le.local.getJSON("accounts"),a=le.session.get("currentAccount"),o=s.length>1,[i,u]=kt(c=>c+1,0),[r]=Zt();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:r,children:s.map((c,l)=>{const p=c.info.id===a,d=l===0;return e("li",{children:[e("div",{children:[o&&e("span",{class:`current ${p?"is-current":""}`,children:e(w,{icon:"check-circle",alt:"Current"})}),e(Ze,{url:c.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(p)try{const f=await n.v1.accounts.$select(c.info.id).fetch();c.info=f,le.local.setJSON("accounts",s),u()}catch{}}}),e(dt,{account:o?{...c.info,acct:/@/.test(c.info.acct)?c.info.acct:`${c.info.acct}@${c.instanceURL}`}:c.info,showAcct:!0,onClick:()=>{p?k.showAccount=`${c.info.username}@${c.instanceURL}`:(le.session.set("currentAccount",c.info.id),location.reload())}})]}),e("div",{class:"actions",children:[d&&o&&e(x,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(je,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(w,{icon:"more",size:"l",alt:"More"})}),children:[e(pe,{onClick:()=>{k.showAccount=`${c.info.username}@${c.instanceURL}`},children:[e(w,{icon:"user"}),e("span",{children:"View profile…"})]}),e(ze,{}),o&&e(pe,{disabled:d,onClick:()=>{s.splice(l,1),s.unshift(c),le.local.setJSON("accounts",s),u()},children:[e(w,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Je,{subMenu:!0,confirmLabel:e(x,{children:[e(w,{icon:"exit"}),e("span",{children:["Log out @",c.info.acct,"?"]})]}),disabled:!p,menuItemClassName:"danger",onClick:()=>{s.splice(l,1),le.local.setJSON("accounts",s),location.href=location.pathname||"/"},children:[e(w,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},c.info.id)})}),e("p",{children:e(se,{to:"/login",class:"button plain2",onClick:t,children:[e(w,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),o&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const Qt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e";function yn(t){const{masto:n}=W();return n.v1.push.subscription.create(t)}function ci(){const{masto:t}=W();return t.v1.push.subscription.fetch()}function ri(t){const{masto:n}=W();return n.v1.push.subscription.update(t)}function li(){const{masto:t}=W();return t.v1.push.subscription.remove()}function Nt(){return"serviceWorker"in navigator&&"PushManager"in window}function di(){return navigator.serviceWorker.getRegistration()}async function en(){const t=await di(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function is(t){const n="=".repeat((4-t.length%4)%4),s=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),a=window.atob(s),o=new Uint8Array(a.length);for(let i=0;i<a.length;++i)o[i]=a.charCodeAt(i);return o}async function ui(){if(!Nt())return;const{subscription:t}=await en();let n=null;try{n=await ci()}catch(s){if(!/(not found|unknown)/i.test(s.message))throw s}if(n&&t){const s=n.endpoint===t.endpoint,{vapidKey:a}=ut(),o=n.serverKey===a;if(!s)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:s}=ut(),{applicationServerKey:a}=t.options,o=is(s).toString(),i=new Uint8Array(a).toString();if(!(o===i))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function wn({data:t,policy:n}){if(!Nt())return;let{registration:s,subscription:a}=await en(),o=null;if(a)try{o=await ri({data:t,policy:n})}catch{o=await yn({subscription:a,data:t,policy:n})}else{const{vapidKey:i}=ut();if(!i)throw new Error("No server key found");a=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:is(i)}),o=await yn({subscription:a,data:t,policy:n})}return{subscription:a,backendSubscription:o}}async function vn(){if(!Nt())return;const{subscription:t}=await en();t&&(await li(),await t.unsubscribe())}var hi={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const Sn=16,ot=[14,15,16,17,18,19,20],{PHANPY_WEBSITE:kn,PHANPY_PRIVACY_POLICY_URL:pi,PHANPY_IMG_ALT_API_URL:fi}=hi;function mi({onClose:t}){const n=Te(k),s=le.local.get("theme")||"auto",a=O(),o=n.settings.contentTranslationTargetLanguage||null,i=Vn(),u=$s(i),r=le.local.get("textSize")||Sn,[c,l]=$(le.account.get("preferences")||{}),{masto:p,authenticated:d,instance:f}=W();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:a,onInput:h=>{h.preventDefault();const m=new FormData(a.current).get("theme"),v=document.documentElement;if(m==="auto"){v.classList.remove("is-light","is-dark");const g=document.querySelector('meta[data-theme-setting="manual"]');g&&(g.name=""),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(I=>{I.name="theme-color"})}else{v.classList.toggle("is-light",m==="light"),v.classList.toggle("is-dark",m==="dark");const g=document.querySelector('meta[data-theme-setting="manual"]');g&&(g.name="theme-color",g.content=m==="light"?g.dataset.themeLightColor:g.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(I=>{I.name=""})}document.querySelector('meta[name="color-scheme"]').setAttribute("content",m==="auto"?"dark light":m),m==="auto"?le.local.del("theme"):le.local.set("theme",m)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:s==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:s==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:s!=="light"&&s!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:ot[0]},children:"A"})," ",e("input",{type:"range",min:ot[0],max:ot[ot.length-1],step:"1",value:r,list:"sizes",onChange:h=>{const b=parseInt(h.target.value,10);document.documentElement.style.setProperty("--text-size",`${b}px`),b===Sn?le.local.del("textSize"):le.local.set("textSize",h.target.value)}})," ",e("span",{style:{fontSize:ot[ot.length-1]},children:"A"}),e("datalist",{id:"sizes",children:ot.map(h=>e("option",{value:h}))})]})]})]})}),d&&e(x,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:c["posting:default:visibility"]||"public",onChange:h=>{const{value:b}=h.target;(async()=>{try{await p.v1.accounts.updateCredentials({source:{privacy:b}}),l({...c,"posting:default:visibility":b}),le.account.set("preferences",{...c,"posting:default:visibility":b})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(w,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${f}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",f,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:h=>{k.settings.autoRefresh=h.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:h=>{k.settings.boostsCarousel=h.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:h=>{const{checked:b}=h.target;k.settings.contentTranslation=b,b||(k.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:o||"",disabled:!n.settings.contentTranslation,onChange:h=>{k.settings.contentTranslationTargetLanguage=h.target.value||null},children:[e("option",{value:"",children:["System language (",u,")"]}),e("option",{disabled:!0,children:"──────────"}),un.map(h=>e("option",{value:h.code,children:h.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(x,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:un.map(h=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(h.code),onChange:b=>{const{checked:m}=b.target;m?k.settings.contentTranslationHideLanguages.push(h.code):k.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(v=>v!==h.code)}})," ",h.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses external translation services, powered by"," ",e("a",{href:"https://github.com/cheeaun/lingva-api",target:"_blank",rel:"noopener noreferrer",children:"Lingva API"})," ","&"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:h=>{k.settings.contentTranslationAutoInline=h.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),!!fi&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.mediaAltGenerator,onChange:h=>{k.settings.mediaAltGenerator=h.target.checked}})," ","Image description generator"," ",e(w,{icon:"sparkles2",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Only for new images while composing new posts."})}),e("div",{class:"sub-section insignificant",children:e("small",{children:["Note: This feature uses external AI service, powered by"," ",e("a",{href:"https://github.com/cheeaun/img-alt-api",target:"_blank",rel:"noopener noreferrer",children:"img-alt-api"}),". May not work well. Only for images and in English."]})})]}),d&&e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.shortcutSettingsCloudImportExport,onChange:h=>{k.settings.shortcutSettingsCloudImportExport=h.target.checked}})," ",'"Cloud" import/export for shortcuts settings'," ",e(w,{icon:"cloud",class:"more-insignificant"})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:["⚠️⚠️⚠️ Very experimental.",e("br",{}),"Stored in your own profile’s notes. Profile (private) notes are mainly used for other profiles, and hidden for own profile."]})}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Note: This feature uses currently-logged-in instance server API."})})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:h=>{k.settings.cloakMode=h.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),d&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{k.showDrafts=!0,k.showSettings=!1},children:"Unsent drafts"})})]})}),d&&e(gi,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:Qt,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:h=>{h.preventDefault(),k.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:h=>{h.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:pi,target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:[kn&&e(x,{children:[e("span",{class:"insignificant",children:"Site:"})," ",kn.replace(/https?:\/\//g,"").replace(/\/$/,""),e("br",{})]}),e("span",{class:"insignificant",children:"Version:"})," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2024-02-26T19:11:53.888Z".slice(0,10).replace(/-/g,".")}.594cad4`,onClick:h=>{h.target.select();try{navigator.clipboard.writeText(h.target.value),ue("Version string copied")}catch{ue("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/594cad4",target:"_blank",rel:"noopener noreferrer",children:e(pt,{datetime:new Date("2024-02-26T19:11:53.888Z")})}),")"]})]})]})]})]})}function gi({onClose:t}){if(!Nt())return null;const{instance:n}=W(),[s,a]=$("default"),o=O(),[i,u]=$(!1),[r,c]=$(!1),l=O();j(()=>{(async()=>{a("loading");try{const{subscription:d,backendSubscription:f}=await ui();if(f!=null&&f.policy&&f.policy!=="none"){u(!0);const{alerts:h,policy:b}=f;l.current=b;const{elements:m}=o.current,v=m.namedItem(b);v&&(v.value=b),Object.keys(h).forEach(g=>{const y=m.namedItem(g);(y==null?void 0:y.type)==="checkbox"&&(y.checked=!0)})}a("default")}catch(d){/outside.*authorized/i.test(d.message)?c(!0):alert((d==null?void 0:d.message)||d),a("error")}})()},[]);const p=s==="loading";return e("form",{ref:o,onChange:()=>{const d=Object.fromEntries(new FormData(o.current)),f=!!d["policy-allow"],h={policy:d.policy,data:{alerts:{mention:!!d.mention,favourite:!!d.favourite,reblog:!!d.reblog,follow:!!d.follow,follow_request:!!d.followRequest,poll:!!d.poll,update:!!d.update,status:!!d.status}}};let b=0;Object.keys(h.data.alerts).forEach(v=>{h.data.alerts[v]?b++:delete h.data.alerts[v]});const m=l.current!==h.policy;f&&b>0?m?vn().then(()=>{wn(h)}).catch(v=>{alert("Failed to update subscription. Please try again.")}):wn(h).catch(v=>{alert("Failed to update subscription. Please try again.")}):vn().catch(v=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:p||r,name:"policy-allow",checked:i,onChange:async d=>{const{checked:f}=d.target;if(f){const h=await Notification.requestPermission();h==="granted"?u(!0):(u(!1),h==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else u(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:p||r||!i,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(d=>e("option",{value:d.value,children:d.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!i,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(d=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:d.value})," ",d.label]})}))})})})}),r&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(se,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const Vt=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const s=document.querySelectorAll("#modal-container > *");if(s!=null&&s.length){const u=s[s.length-1],r=u.querySelector('[tabindex="-1"]')||u;if(r){r.focus();return}}if(document.querySelector(".deck-backdrop"))return;const o=document.querySelectorAll(".deck-container"),i=o[o.length-1];i&&i.tabIndex===-1&&i.focus()}},100);return()=>clearTimeout(t)};function os(t){if(!t)return;const n=mt(),s=O(n.pathname);j(()=>{s.current&&n.pathname!==s.current&&(t==null||t())},[n.pathname,t])}function tn({list:t,onClose:n}){const{masto:s}=W(),[a,o]=$("default"),i=!!t,u=O(),r=O(),c=O();j(()=>{i&&(u.current.value=t.title,r.current.value=t.repliesPolicy,c.current&&(c.current.checked=t.exclusive))},[i]);const l=As("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})})," ",e("header",{children:e("h2",{children:i?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:p=>{p.preventDefault();const d=new FormData(p.target),f=d.get("title"),h=d.get("replies_policy"),b=d.get("exclusive")==="on";o("loading"),(async()=>{try{let m;i?m=await s.v1.lists.$select(t.id).update({title:f,replies_policy:h,exclusive:b}):m=await s.v1.lists.create({title:f,replies_policy:h,exclusive:b}),o("default"),n==null||n({state:"success",list:m})}catch{o("error"),alert(i?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:u,type:"text",id:"list-title",name:"title",required:!0,disabled:a==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:r,name:"replies_policy",required:!0,disabled:a==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),l&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:c,type:"checkbox",name:"exclusive",disabled:a==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:a==="loading",children:i?"Save":"Create"}),i&&e(Je,{disabled:a==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await s.v1.lists.$select(t.id).remove(),o("default"),n==null||n({state:"deleted"})}catch{o("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:a==="loading",children:"Delete…"})})]})]})})]})}const bi=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],In={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},Tn=80,as=1e3*60*10;function yi(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const wi=it(yi,{maxAge:as});async function vi(t,n){const s=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:a}=await s,o={total:a.length,originals:0,replies:0,boosts:0};return a.forEach(i=>{i.reblog?o.boosts++:i.inReplyToId&&i.inReplyToAccountId!==i.account.id?o.replies++:o.originals++}),a.length&&(o.daysSinceLastPost=Math.ceil((Date.now()-new Date(a[a.length-1].createdAt))/864e5)),o}const Si=it(vi,{maxAge:as});function cs({account:t,fetchAccount:n=()=>{},standalone:s,instance:a,authenticated:o}){const{masto:i}=W({instance:a}),{masto:u,instance:r}=W(),[c,l]=$("default"),p=typeof t=="string",[d,f]=$(p?null:t),h=me(()=>a===r,[a,r]);j(()=>{if(!p){f(t);return}l("loading"),(async()=>{try{const M=await n();k.accounts[`${M.id}@${a}`]=M,f(M),l("default")}catch{f(null),l("error")}})()},[p,t,n]);const{acct:b,avatar:m,avatarStatic:v,bot:g,createdAt:y,displayName:I,emojis:S,fields:C,followersCount:A,followingCount:_,group:q,id:B,lastStatusAt:P,locked:D,note:L,statusesCount:N,url:E,username:J,memorial:H,moved:oe,roles:ie}=d||{};let be=!1,{header:Se,headerStatic:ee}=d||{};(!Se||/missing\.png$/.test(Se))&&m&&!/missing\.png$/.test(m)&&(Se=m,be=!0,v&&!/missing\.png$/.test(v)&&(ee=v));const U=me(()=>B===le.session.get("currentAccount"),[B]);j(()=>{const M=!!(d!=null&&d.id&&(d!=null&&d.username)&&(d!=null&&d.acct)&&(d!=null&&d.avatar)&&(d!=null&&d.avatarStatic)&&(d!=null&&d.displayName)&&(d!=null&&d.url));if(U&&a&&M){const ae=le.local.getJSON("accounts");let Y=!1;ae.forEach(Z=>{Z.info.id===d.id&&Z.instanceURL===a&&(Z.info=d,Y=!0)}),Y&&le.local.setJSON("accounts",ae)}},[U,d,a]);const X=me(()=>E?new URL(E).hostname:null,[E]),[ne,ge]=$([]),ye=O(),ke=O([]);async function $e(M){(M||!ye.current)&&(ye.current=i.v1.accounts.$select(B).followers.list({limit:Tn}));const ae=await ye.current.next();if(U||!h)return ae;const{value:Y}=ae;let Z=[];if(M){const Ae=await i.v1.accounts.familiarFollowers.fetch({id:[B]});ke.current=Ae[0].accounts,Z=[...ke.current,...Y.filter(Ne=>!ke.current.some(we=>we.id===Ne.id))]}else Y!=null&&Y.length&&(Z=Y.filter(Ae=>!ke.current.some(Ne=>Ne.id===Ae.id)));return{...ae,value:Z}}const Ie=O();async function Q(M){return(M||!Ie.current)&&(Ie.current=i.v1.accounts.$select(B).following.list({limit:Tn})),await Ie.current.next()}const ce=s?"div":se,T=a?`/${a}/a/${B}`:`/a/${B}`,[z,G]=$([]),[F,K]=$(),[fe,he]=$("default"),re=!!(F!=null&&F.total),R=async M=>{try{const ae=await wi(M,u);G(ae[0].accounts.slice(0,ki))}catch{}},V=async()=>{if(B){he("loading");try{const M=await Si(B,i);K(M),he("default")}catch{he("error")}}},te=Ke(({relationship:M,currentID:ae})=>{M.following||(R(ae),!s&&N>0&&V())},[s,B,N]);return e("div",{tabIndex:"-1",class:`account-container  ${c==="loading"?"skeleton":""}`,style:{"--header-color-1":ne[0],"--header-color-2":ne[1],"--header-color-3":ne[2],"--header-color-4":ne[3]},children:[c==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:p?t:E,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(w,{icon:"external"})]})})]}),c==="loading"?e(x,{children:[e("header",{children:e(We,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(w,{icon:"more",size:"l",alt:"More"})})})]})]})]}):d&&e(x,{children:[!!oe&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:I})," has indicated that their new account is now:"]}),e(We,{account:oe,instance:a,onClick:M=>{M.stopPropagation(),k.showAccount=oe}})]}),!!Se&&!/missing\.png$/.test(Se)&&e("img",{src:Se,alt:"",class:`header-banner ${be?"header-is-avatar":""}`,onError:M=>{M.target.crossOrigin?M.target.src!==ee?M.target.src=ee:(M.target.removeAttribute("crossorigin"),M.target.src=Se):M.target.src!==ee?M.target.src=ee:M.target.remove()},crossOrigin:"anonymous",onLoad:M=>{M.target.classList.add("loaded");try{const ae=document.createElement("canvas"),Y=ae.getContext("2d",{willReadFrequently:!0});ae.width=M.target.width,ae.height=M.target.height,Y.drawImage(M.target,0,0);const Z=10,Ne=[Y.getImageData(0,0,Z,Z).data,Y.getImageData(M.target.width-Z,0,Z,Z).data,Y.getImageData(0,M.target.height-Z,Z,Z).data,Y.getImageData(M.target.width-Z,M.target.height-Z,Z,Z).data].map(we=>{let ve=0,De=0,xe=0,He=0;for(let qe=0;qe<we.length;qe+=4)ve+=we[qe],De+=we[qe+1],xe+=we[qe+2],He+=we[qe+3];const ct=we.length/4;return[ve/ct,De/ct,xe/ct,He/ct]}).map(we=>{const[ve,De,xe,He]=Ti(we);return`rgba(${ve}, ${De}, ${xe}, ${He})`});ge(Ne)}catch{}}}),e("header",{children:e(We,{account:d,instance:a,avatarSize:"xxxl",external:s,internal:!s})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!H&&e("span",{class:"tag",children:"In Memoriam"}),!!g&&e("span",{class:"tag",children:[e(w,{icon:"bot"})," Automated"]}),!!q&&e("span",{class:"tag",children:[e(w,{icon:"group"})," Group"]}),ie==null?void 0:ie.map(M=>e("span",{class:"tag",children:[M.name,!!X&&e(x,{children:[" ",e("span",{class:"more-insignificant",children:X})]})]})),e("div",{class:"note",dir:"auto",onClick:Gn({instance:r}),dangerouslySetInnerHTML:{__html:qt(L,{emojis:S})}}),e("div",{class:"account-metadata-box",children:[(C==null?void 0:C.length)>0&&e("div",{class:"profile-metadata",children:C.map(({name:M,value:ae,verifiedAt:Y},Z)=>e("div",{class:`profile-field ${Y?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(jn,{text:M,emojis:S})," ",!!Y&&e(w,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:qt(ae,{emojis:S})}})]},M+Z))}),e("div",{class:"stats",children:[e(ce,{tabIndex:0,to:T,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Followers",fetchAccounts:$e,instance:a,excludeRelationshipAttrs:U?["followedBy"]:[]}},0)},children:[!!z.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:z.map(M=>e(Ze,{url:M.avatarStatic,size:"s",alt:`${M.displayName} @${M.acct}`,squircle:M==null?void 0:M.bot}))})}),e("span",{title:A,children:Oe(A)})," ","Followers"]}),e(ce,{class:"insignificant",tabIndex:0,to:T,onClick:()=>{setTimeout(()=>{k.showGenericAccounts={heading:"Following",fetchAccounts:Q,instance:a,excludeRelationshipAttrs:U?["following"]:[]}},0)},children:[e("span",{title:_,children:Oe(_)})," ","Following",e("br",{})]}),e(ce,{class:"insignificant",to:T,children:[e("span",{title:N,children:Oe(N)})," ","Posts"]}),!!y&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:y,children:Xe(y,{hideTime:!0})})]})]})]}),!!F&&e(ce,{to:T,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:re?e("div",{class:"posting-stats",title:`${Math.round(F.originals/F.total*100)}% original posts, ${Math.round(F.replies/F.total*100)}% replies, ${Math.round(F.boosts/F.total*100)}% boosts`,children:[e("div",{children:F.daysSinceLastPost<365?`Last ${F.total} post${F.total>1?"s":""} in the past 
                      ${F.daysSinceLastPost} day${F.daysSinceLastPost>1?"s":""}`:`
                      Last ${F.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${F.originals/F.total*100}%`,"--replies-percentage":`${(F.originals+F.replies)/F.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!F,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:fe==="loading",onClick:()=>{V()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${fe==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(Ii,{info:d,instance:a,authenticated:o,onRelationshipChange:te})})]})]})}const ki=3;function Ii({info:t,instance:n,authenticated:s,onRelationshipChange:a=()=>{}}){var ce;if(!t)return null;const{masto:o,instance:i,authenticated:u}=W(),r=n===i,[c,l]=$("default"),[p,d]=$(null),{id:f,acct:h,url:b,username:m,locked:v,lastStatusAt:g,note:y,fields:I,moved:S}=t,C=O(f),{following:A,showingReblogs:_,notifying:q,followedBy:B,blocking:P,blockedBy:D,muting:L,mutingNotifications:N,requested:E,domainBlocking:J,endorsed:H,note:oe}=p||{},[ie,be]=$(null),[Se,ee]=$(!1);j(()=>{if(t){const T=le.session.get("currentAccount");let z;(async()=>{if(r&&s)z=f;else if(!r&&u){const F=t.acct.includes("@");try{const K=await o.v2.search.fetch({q:F?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});K.accounts.length&&(z=K.accounts[0].id,be(K.accounts[0]))}catch{}}if(!z)return;if(T===z){ee(!0);return}if(C.current=z,S)return;l("loading");const G=o.v1.accounts.relationships.fetch({id:[z]});try{const F=await G;if(l("default"),F.length){const K=F[0];d(K),a({relationship:K,currentID:z})}}catch{l("error")}})()}},[t,s]),j(()=>{t&&Se&&xs(t)},[t,Se]);const U=c==="loading",[X,ne]=$(!1),[ge,ye]=$(!1),[ke,$e]=$(!1),[Ie,Q]=$([]);return e(x,{children:[e("div",{class:"actions",children:[e("span",{children:[B?e("span",{class:"tag",children:"Follows you"}):g?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:Xe(g,{hideTime:!0})})]}):e("span",{}),L&&e("span",{class:"tag danger",children:"Muted"}),P&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!oe&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{$e(!0)},dir:"auto",children:e("span",{children:oe})}),e(je,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:U,children:e(w,{icon:"more",size:"l",alt:"More"})}),onMenuChange:T=>{A&&T.open&&(async()=>{try{const z=await o.v1.accounts.$select(C.current).lists.list();Q(z)}catch{}})()},children:[u&&!Se&&e(x,{children:[e(pe,{onClick:()=>{k.showCompose={draftStatus:{status:`@${(ie==null?void 0:ie.acct)||h} `}}},children:[e(w,{icon:"at"}),e("span",{children:["Mention @",m]})]}),e(pe,{onClick:()=>{ne(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(pe,{onClick:()=>{$e(!0)},children:[e(w,{icon:"pencil"}),e("span",{children:oe?"Edit private note":"Add private note"})]}),A&&e(pe,{onClick:()=>{ye(!0)},children:[e(w,{icon:"list"}),Ie.length?e(x,{children:[e("small",{class:"menu-grow",children:["Add/Remove from Lists",e("br",{}),e("span",{class:"more-insignificant",children:Ie.map(T=>T.title).join(", ")})]}),e("small",{class:"more-insignificant",children:Ie.length})]}):e("span",{children:"Add/Remove from Lists"})]}),e(ze,{})]}),e(pe,{href:b,target:"_blank",children:[e(w,{icon:"external"}),e("small",{class:"menu-double-lines",children:Ci(b)})]}),e("div",{class:"menu-horizontal",children:[e(pe,{onClick:()=>{try{navigator.clipboard.writeText(b),ue("Link copied")}catch{ue("Unable to copy link")}},children:[e(w,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((ce=navigator==null?void 0:navigator.canShare)==null?void 0:ce.call(navigator,{url:b}))&&e(pe,{onClick:()=>{try{navigator.share({url:b})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!p&&e(x,{children:[e(ze,{}),L?e(pe,{onClick:()=>{l("loading"),(async()=>{try{const T=await o.v1.accounts.$select((ie==null?void 0:ie.id)||f).unmute();d(T),l("default"),ue(`Unmuted @${m}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{l("error")}})()},children:[e(w,{icon:"unmute"}),e("span",{children:["Unmute @",m]})]}):e(zs,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(x,{children:[e(w,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",m,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(w,{icon:"time"}),e(w,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:bi.map(T=>e(pe,{onClick:()=>{l("loading"),(async()=>{try{const z=await o.v1.accounts.$select((ie==null?void 0:ie.id)||f).mute({duration:T});d(z),l("default"),ue(`Muted @${m} for ${In[T]}`),k.reloadGenericAccounts.id="mute",k.reloadGenericAccounts.counter++}catch{l("error"),ue(`Unable to mute @${m}`)}})()},children:In[T]}))})}),e(Je,{subMenu:!0,confirm:!P,confirmLabel:e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"?"]})]}),menuItemClassName:"danger",onClick:()=>{l("loading"),(async()=>{try{if(P){const T=await o.v1.accounts.$select((ie==null?void 0:ie.id)||f).unblock();d(T),l("default"),ue(`Unblocked @${m}`)}else{const T=await o.v1.accounts.$select((ie==null?void 0:ie.id)||f).block();d(T),l("default"),ue(`Blocked @${m}`)}k.reloadGenericAccounts.id="block",k.reloadGenericAccounts.counter++}catch{l("error"),P?ue(`Unable to unblock @${m}`):ue(`Unable to block @${m}`)}})()},children:P?e(x,{children:[e(w,{icon:"unblock"}),e("span",{children:["Unblock @",m]})]}):e(x,{children:[e(w,{icon:"block"}),e("span",{children:["Block @",m,"…"]})]})}),e(pe,{className:"danger",onClick:()=>{k.showReportModal={account:ie||t}},children:[e(w,{icon:"flag"}),e("span",{children:["Report @",m,"…"]})]})]}),!1]}),!p&&c==="loading"&&e(Ce,{abrupt:!0}),!!p&&e(Je,{confirm:A||E,confirmLabel:e("span",{children:E?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:U,onClick:()=>{l("loading"),(async()=>{try{let T;A||E?T=await o.v1.accounts.$select(C.current).unfollow():T=await o.v1.accounts.$select(C.current).follow(),T&&d(T),l("default")}catch(T){alert(T),l("error")}})()},children:e("button",{type:"button",class:`${A||E?"light swap":""}`,"data-swap-state":A||E?"danger":"",disabled:U,children:A?e(x,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):E?e(x,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):v?e(x,{children:[e(w,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!X&&e(Re,{class:"light",onClose:()=>{ne(!1)},children:e($i,{note:y,fields:I,onClose:()=>ne(!1)})}),!!ge&&e(Re,{class:"light",onClose:()=>{ye(!1)},children:e(Ai,{accountID:C.current,onClose:()=>ye(!1)})}),!!ke&&e(Re,{class:"light",onClose:()=>{$e(!1)},children:e(xi,{account:t,note:oe,onRelationshipChange:T=>{d(T)},onClose:()=>$e(!1)})})]})}function Ti([t,n,s]){const a=.2126*t+.7152*n+.0722*s;let o;return a>=220?o=1:a<=50?o=.1:o=a/255,o=Math.min(1,o),[t,n,s,o]}function Ci(t){if(!t)return;const n=new URL(t),{host:s,pathname:a}=n,o=a.replace(/\/$/,"").replace(/^\//,"");return e(x,{children:[e("span",{class:"more-insignificant",children:[s,"/"]}),e("wbr",{}),e("span",{children:o})]})}function $i({note:t,fields:n,onClose:s}){const a=(n==null?void 0:n.map(({name:i,value:u})=>`${i}
${Ht(u)}`).join(`

`))||"",o=Ht(t)+(a?`

${a}`:"");return e("div",{class:"sheet",children:[!!s&&e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:o}),e(Yn,{forceTranslate:!0,text:o})]})]})}function Ai({accountID:t,onClose:n}){const{masto:s}=W(),[a,o]=$("default"),[i,u]=$([]),[r,c]=$([]),[l,p]=kt(h=>h+1,0);j(()=>{o("loading"),(async()=>{try{const h=await s.v1.lists.list();h.sort((m,v)=>m.title.localeCompare(v.title));const b=await s.v1.accounts.$select(t).lists.list();u(h),c(b),o("default")}catch{o("error")}})()},[l]);const[d,f]=$(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[i.length>0?e("ul",{class:"list-add-remove",children:i.map(h=>{const b=r.some(m=>m.id===h.id);return e("li",{children:e("button",{type:"button",class:`light ${b?"checked":""}`,disabled:a==="loading",onClick:()=>{o("loading"),(async()=>{try{b?await s.v1.lists.$select(h.id).accounts.remove({accountIds:[t]}):await s.v1.lists.$select(h.id).accounts.create({accountIds:[t]}),p()}catch{o("error"),alert(b?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(w,{icon:"check-circle"}),e("span",{children:h.title})]})})})}):a==="loading"?e("p",{class:"ui-state",children:e(Ce,{abrupt:!0})}):a==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>f(!0),disabled:a!=="default",children:[e(w,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),d&&e(Re,{class:"light",onClick:h=>{h.target===h.currentTarget&&f(!1)},children:e(tn,{list:d==null?void 0:d.list,onClose:h=>{h.state==="success"&&p(),f(!1)}})})]})}function xi({account:t,note:n,onRelationshipChange:s=()=>{},onClose:a=()=>{}}){const{masto:o}=W(),[i,u]=$("default"),r=O(null);return j(()=>{let c;return r.current&&!n&&(c=setTimeout(()=>{var l,p;(p=(l=r.current).focus)==null||p.call(l)},100)),()=>{clearTimeout(c)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!a&&e("button",{type:"button",class:"sheet-close",onClick:a,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:c=>{c.preventDefault();const p=new FormData(c.target).get("note");(p==null?void 0:p.trim())!==(n==null?void 0:n.trim())&&(u("loading"),(async()=>{try{const d=await o.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:p});u("default"),s(d),a()}catch(d){u("error"),alert((d==null?void 0:d.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:r,name:"note",disabled:i==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:i==="loading",onClick:()=>{a==null||a()},children:"Cancel"}),e("span",{children:[e(Ce,{abrupt:!0,hidden:i!=="loading"}),e("button",{disabled:i==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function Ri({account:t,instance:n,onClose:s}){const{masto:a,instance:o,authenticated:i}=W({instance:n}),u=typeof t=="string";return j(()=>{u||(k.accounts[`${t.id}@${o}`]=t)},[t]),os(s),e("div",{class:"sheet",children:[!!s&&e("button",{type:"button",class:"sheet-close outer",onClick:s,children:e(w,{icon:"x"})}),e(cs,{instance:o,authenticated:i,account:t,fetchAccount:async()=>{if(u)try{return await a.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const c=await a.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:i});if(c.accounts.length)return c.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const l=new URL(t),{hostname:p,pathname:d}=l,f=d.replace(/^\//,"").replace(/\/$/,"")+"@"+p,h=await a.v2.search.fetch({q:f,type:"accounts",limit:1,resolve:i});if(h.accounts.length)return h.accounts[0]}}else return t}})]})}function Li({onClose:t}){const{masto:n}=W(),[s,a]=$("default"),[o,i]=$([]),[u,r]=kt(l=>l+1,0);j(()=>{a("loading"),(async()=>{try{const l=await Ve.drafts.keys();if(l.length){const p=_t(),d=l.filter(f=>f.startsWith(p));if(d.length){const f=await Ve.drafts.getMany(d);f.sort((h,b)=>new Date(b.updatedAt).getTime()-new Date(h.updatedAt).getTime()),i(f)}else i([])}else i([]);a("default")}catch{a("error")}})()},[u]);const c=(o==null?void 0:o.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(Ce,{abrupt:!0,hidden:s!=="loading"})]}),c&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:c?e(x,{children:[e("ul",{class:"drafts-list",children:o.map(l=>{const{updatedAt:p,key:d,draftStatus:f,replyTo:h}=l,b=new Date(p);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(w,{icon:h?"reply":"quill",size:"s"})," ",e("time",{children:[!!h&&e(x,{children:["@",h.account.acct,e("br",{})]}),Xe(b)]})]}),e(Je,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:s==="loading",onClick:()=>{(async()=>{try{await Ve.drafts.del(d),r()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:s==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:s==="loading",class:"draft-item",onClick:async()=>{let m;if(h){a("loading");try{m=await n.v1.statuses.$select(h.id).fetch()}catch{alert("Error fetching reply-to status!"),a("default");return}a("default")}window.__COMPOSE__={draftStatus:f,replyToStatus:m},k.showCompose=!0,k.showDrafts=!1},children:e(_i,{draft:l})})]},p)})}),o.length>1&&e("p",{children:e(Je,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:s==="loading",onClick:()=>{(async()=>{a("loading");try{await Ve.drafts.delMany(o.map(l=>l.key)),a("default"),r()}catch{alert("Error deleting drafts! Please try again."),a("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:s==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function _i({draft:t}){var d;const{draftStatus:n,replyTo:s}=t,{status:a,spoilerText:o,poll:i,mediaAttachments:u}=n,r=((d=i==null?void 0:i.options)==null?void 0:d.length)>0,c=(u==null?void 0:u.length)>0,l=r||c,p=me(()=>{if(!c)return;const f=u.find(m=>/image/.test(m.type));if(!f)return;const{file:h}=f;return URL.createObjectURL(h)},[c,u]);return e(x,{children:e("div",{class:"mini-draft",children:[l&&e("div",{class:`mini-draft-aside ${p?"has-image":""}`,style:p?{"--bg-image":`url(${p})`}:{},children:[r&&e(w,{icon:"poll"}),c&&e("span",{children:[e(w,{icon:"attachment"})," ",e("small",{children:u==null?void 0:u.length})]})]}),e("div",{class:"mini-draft-main",children:[!!o&&e("div",{class:"mini-draft-spoiler",children:o}),!!a&&e("div",{class:"mini-draft-status",children:a})]})]})})}function Ei({html:t,url:n,width:s,height:a,onClose:o=()=>{}}){return e("div",{class:"embed-modal-container",children:[e("div",{class:"top-controls",children:[e("button",{type:"button",class:"light",onClick:()=>o(),children:e(w,{icon:"x"})}),n&&e("a",{href:n,target:"_blank",rel:"noopener noreferrer",class:"button plain",children:[e("span",{children:"Open link"})," ",e(w,{icon:"external"})]})]}),e("div",{class:"embed-content",dangerouslySetInnerHTML:{__html:t},style:{"--width":s+"px","--height":a+"px","--aspect-ratio":`${s}/${a}`}})]})}async function nn(t,n={}){if(!(t!=null&&t.length))return;const{masto:s}=W(),a=le.session.get("currentAccount"),o=t.reduce((i,u)=>(!i.includes(u.id)&&!n[u.id]&&u.id!==a&&i.push(u.id),i),[]);if(!o.length)return null;try{return(await s.v1.accounts.relationships.fetch({id:o})).reduce((r,c)=>(r[c.id]=c,r),{})}catch{return null}}function Mi({instance:t,excludeRelationshipAttrs:n=[],onClose:s=()=>{}}){const{masto:a,instance:o}=W(),i=t?t===o:!0,u=Te(k),[r,c]=$("default"),[l,p]=$([]),[d,f]=$(!1);if(os(s),!u.showGenericAccounts)return null;const{id:h,heading:b,fetchAccounts:m,accounts:v,showReactions:g}=u.showGenericAccounts,[y,I]=$({}),S=async _=>{if(!(_!=null&&_.length)||!i)return;const q=await nn(_,y);q&&I({...y,...q})},C=_=>{m&&(_&&p([]),c("loading"),(async()=>{try{const{done:q,value:B}=await m(_);if(Array.isArray(B)){if(_){const P=[];for(let D=0;D<B.length;D++){const L=B[D],N=P.find((E,J)=>E.id===L.id&&D!==J);N?N._types.push(...L._types):P.push({_types:[],...L})}p(P)}else p(P=>{const D=P;for(const L of B){const N=D.find(E=>E.id===L.id);N?N._types.push(...L._types):D.push(L)}return D});f(!q),S(B)}else f(!1);c("default")}catch{c("error")}})())},A=O(!0);return j(()=>{(v==null?void 0:v.length)>0?(p(v),S(v)):(C(!0),A.current=!1)},[v,m]),j(()=>{var _;A.current||((_=u.reloadGenericAccounts)==null?void 0:_.id)===h&&C(!0)},[u.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:s,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:b||"Accounts"})}),e("main",{children:l.length>0?e(x,{children:[e("ul",{class:"accounts-list",children:l.map(_=>{var P,D;const q=y[_.id],B=`${_.id}-${((P=_._types)==null?void 0:P.length)||""}`;return e("li",{children:[g&&((D=_._types)==null?void 0:D.length)>0&&e("div",{class:"reactions-block",children:_._types.map(L=>e(w,{icon:{reblog:"rocket",favourite:"heart"}[L],class:`${L}-icon`}))}),e("div",{class:"account-relationships",children:e(We,{account:_,showStats:!0,relationship:q,excludeRelationshipAttrs:n})})]},B)})}),r==="default"?d?e(Qe,{onChange:_=>{_&&C()},children:e("button",{type:"button",class:"plain block",onClick:()=>C(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):r==="loading"&&e("p",{class:"ui-state",children:e(Ce,{abrupt:!0})})]}):r==="loading"?e("p",{class:"ui-state",children:e(Ce,{abrupt:!0})}):r==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function Pi({alt:t,lang:n,onClose:s}){const a=Te(k),[o,i]=$(!1),u=Vn(!0),r=a.settings.contentTranslationHideLanguages||[],c=!!n&&n!==u&&!hn([n],[u])&&!r.find(l=>n===l||hn([n],[l]));return e("div",{class:"sheet",tabindex:"-1",children:[!!s&&e("button",{type:"button",class:"sheet-close outer",onClick:s,children:e(w,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(je,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(w,{icon:"more",alt:"More",size:"xl"})}),children:[e(pe,{disabled:o,onClick:()=>{i(!0)},children:[e(w,{icon:"translate"}),e("span",{children:"Translate"})]}),Rs&&e(pe,{onClick:()=>{Ls(t,n)},children:[e(w,{icon:"speak"}),e("span",{children:"Speak"})]})]})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(c||o)&&e(Yn,{forceTranslate:o,sourceLanguage:n,text:t})]})]})}function Ut(t,n,s){return Math.max(Math.min(t,s),n)}const Ft=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,Ot=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function sn([t,n,s]){t=Ft(t/255),n=Ft(n/255),s=Ft(s/255);var a=.4122214708*t+.5363325363*n+.0514459929*s,o=.2119034982*t+.6806995451*n+.1073969566*s,i=.0883024619*t+.2817188376*n+.6299787005*s;return a=Math.cbrt(a),o=Math.cbrt(o),i=Math.cbrt(i),[a*.2104542553+o*.793617785+i*-.0040720468,a*1.9779984951+o*-2.428592205+i*.4505937099,a*.0259040371+o*.7827717662+i*-.808675766]}function on([t,n,c]){var a=t+n*.3963377774+c*.2158037573,o=t+n*-.1055613458+c*-.0638541728,i=t+n*-.0894841775+c*-1.291485548;a=a**3,o=o**3,i=i**3;var u=a*4.0767416621+o*-3.3077115913+i*.2309699292,r=a*-1.2684380046+o*2.6097574011+i*-.3413193965,c=a*-.0041960863+o*-.7034186147+i*1.707614701;return u=255*Ot(u),r=255*Ot(r),c=255*Ot(c),u=Ut(u,0,255),r=Ut(r,0,255),c=Ut(c,0,255),u=Math.round(u),r=Math.round(r),c=Math.round(c),[u,r,c]}var Ni={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_IMG_ALT_API_URL:ja}=Ni;function rs({mediaAttachments:t,statusID:n,instance:s,lang:a,index:o=0,onClose:i=()=>{}}){var y,I;const[u,r]=$("default"),c=O(null),[l,p]=$(o),d=O(null);et(()=>{var S;(S=d.current)==null||S.scrollIntoView()},[]);const f=O(n);j(()=>{const S=o*c.current.clientWidth,C=f.current!==n;C&&(f.current=n),c.current.scrollTo({left:S,behavior:C?"auto":"smooth"}),c.current.focus()},[o,n]);const[h,b]=$(!0);j(()=>{let S=()=>{i()};return c.current&&c.current.addEventListener("swiped-down",S),()=>{c.current&&c.current.removeEventListener("swiped-down",S)}},[]),Me("esc",i,{ignoreEventWhen:S=>!!document.querySelector("#modal-container > *")},[i]),j(()=>{let S=()=>{const{clientWidth:C,scrollLeft:A}=c.current,_=Math.round(A/C);p(_)};return c.current&&c.current.addEventListener("scroll",S,{passive:!0}),()=>{c.current&&c.current.removeEventListener("scroll",S)}},[]),j(()=>{let S=setTimeout(()=>{var C,A;(A=(C=c.current)==null?void 0:C.focus)==null||A.call(C)},100);return()=>clearTimeout(S)},[]);const m=me(()=>t==null?void 0:t.map(S=>{const{blurhash:C}=S;if(C){const A=Jt(C),_=sn(A);return on([.6,_[1],_[2]])}return null}),[t]),v=me(()=>{var A;const C=100/m.length;return((A=m==null?void 0:m.map((_,q)=>{const B=q*C+5,P=(q+1)*C-5;return _?`
            rgba(${_==null?void 0:_.join(",")}, 0.4) ${B}%,
            rgba(${_==null?void 0:_.join(",")}, 0.4) ${P}%
          `:`
            transparent ${B}%,
            transparent ${P}%
          `}))==null?void 0:A.join(", "))||"transparent"},[m]);let g=O(null);return j(()=>()=>{var S,C;(C=(S=g.current)==null?void 0:S.hideToast)==null||C.call(S)},[]),e("div",{class:`media-modal-container media-modal-count-${t==null?void 0:t.length}`,children:[e("div",{ref:c,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:S=>{(S.target.classList.contains("carousel-item")||S.target.classList.contains("media")||S.target.classList.contains("media-zoom"))&&i()},style:t.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${v})`}:{},children:t==null?void 0:t.map((S,C)=>{const A=t.length===1?m[C]:null;return e("div",{class:"carousel-item",style:A?{"--accent-color":`rgb(${A==null?void 0:A.join(",")})`,"--accent-alpha-color":`rgba(${A==null?void 0:A.join(",")}, 0.4)`}:{},tabindex:"0",ref:C===l?d:null,onClick:_=>{_.target.classList.contains("media")||b(!h)},children:[!!S.description&&e("button",{type:"button",class:"media-alt",hidden:!h,onClick:()=>{k.showMediaAlt={alt:S.description,lang:a}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:a,dir:"auto",children:S.description})]}),e(Wn,{media:S,showOriginal:!0,lang:a})]},S.id)})}),e("div",{class:"carousel-top-controls",hidden:!h,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>i(),children:e(w,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((S,C)=>e("button",{type:"button",disabled:C===l,class:`carousel-dot ${C===l?"active":""}`,onClick:A=>{A.preventDefault(),A.stopPropagation(),c.current.scrollTo({left:c.current.clientWidth*C,behavior:"smooth"}),c.current.focus()},children:e(w,{icon:"round",size:"s"})},S.id))}):e("span",{}),e("span",{children:[e(je,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(w,{icon:"more",alt:"More"})}),children:[e(Fe,{href:((y=t[l])==null?void 0:y.remoteUrl)||((I=t[l])==null?void 0:I.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(w,{icon:"popout"}),e("span",{children:"Open original media"})]}),!1]})," ",e(se,{to:`${s?`/${s}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${l+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!h,children:[e("button",{type:"button",class:"carousel-button",hidden:l===0,onClick:S=>{S.preventDefault(),S.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(l-1),behavior:"smooth"})},children:e(w,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:l===t.length-1,onClick:S=>{S.preventDefault(),S.stopPropagation(),c.current.focus(),c.current.scrollTo({left:c.current.clientWidth*(l+1),behavior:"smooth"})},children:e(w,{icon:"arrow-right"})})]})]})}const Di=[,"spam","legal","violation","other"],bt={spam:{label:"Spam",description:"Malicious links, fake engagement, or repetitive replies"},legal:{label:"Illegal",description:"Violates the law of your or the server's country"},violation:{label:"Server rule violation",description:"Breaks specific server rules",stampLabel:"Violation"},other:{label:"Other",description:"Issue doesn't fit other categories",excludeStamp:!0}};function Ui({account:t,post:n,onClose:s}){const{masto:a}=W(),[o,i]=$("default"),[u,r]=t.acct.split("@"),[c,l]=me(()=>{const{rules:g,domain:y}=Kn();return[g||[],y]}),[p,d]=$(null),[f,h]=$(!1),b=O(null),[m,v]=$(!1);return e("div",{class:"report-modal-container",children:[e("div",{class:"top-controls",children:[e("h1",{children:n?"Report Post":`Report @${u}`}),e("button",{type:"button",class:"plain4 small",disabled:o==="loading",onClick:()=>s(),children:e(w,{icon:"x",size:"xl"})})]}),e("main",{children:[e("div",{class:"report-preview",children:n?e(_e,{status:n,size:"s",previewMode:!0}):e(We,{account:t,avatarSize:"xxl",useAvatarStatic:!0,showStats:!0,showActivity:!0})}),!!p&&!bt[p].excludeStamp&&e("span",{class:"rubber-stamp","aria-hidden":"true",children:[bt[p].stampLabel||bt[p].label,e("small",{children:"Pending review"})]},p),e("form",{onSubmit:g=>{g.preventDefault();const y=new FormData(g.target),I=Object.fromEntries(y.entries());let{category:S,comment:C,forward:A}=I;C||(C=void 0),A==="on"&&(A=!0);const _=S==="violation"?Object.entries(I).filter(([B])=>B.startsWith("rule_ids")).map(([B,P])=>P):void 0,q={category:S,comment:C,forward:A,ruleIds:_};i("loading"),(async()=>{try{await a.v1.reports.create({accountId:t.id,statusIds:n!=null&&n.id?[n.id]:void 0,category:S,comment:C,ruleIds:_,forward:A}),i("success"),ue(n?"Post reported":"Profile reported"),s()}catch(B){i("error"),ue((B==null?void 0:B.message)||(n?"Unable to report post":"Unable to report profile"))}})()},children:[e("p",{children:n?"What's the issue with this post?":"What's the issue with this profile?"}),e("section",{class:"report-categories",children:Di.map(g=>g==="violation"&&!(c!=null&&c.length)?null:e(x,{children:[e("label",{class:"report-category",children:[e("input",{type:"radio",name:"category",value:g,required:!0,disabled:o==="loading",onChange:y=>{d(y.target.value),h(y.target.value==="violation")}}),e("span",{children:[bt[g].label,"  ",e("small",{class:"ib insignificant",children:bt[g].description})]})]}),g==="violation"&&!!(c!=null&&c.length)&&e("div",{class:"shazam-container no-animation",hidden:!f,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"report-rules",ref:b,children:c.map((y,I)=>e("label",{class:"report-rule",children:[e("input",{type:"checkbox",name:`rule_ids[${I}]`,value:y.id,required:f&&!m,disabled:o==="loading",onChange:S=>{const{checked:C}=S.target;C?v(!0):b.current.querySelectorAll("input:checked").length||v(!1)}}),e("span",{children:y.text})]},y.id))})})})]},g))}),e("section",{class:"report-comment",children:[e("p",{children:e("label",{for:"report-comment",children:"Additional info"})}),e("textarea",{maxlength:"1000",rows:"1",name:"comment",id:"report-comment",disabled:o==="loading"})]}),e("section",{children:r!==l&&e("p",{children:e("label",{children:[e("input",{type:"checkbox",switch:!0,name:"forward",disabled:o==="loading"})," ",e("span",{children:["Forward to ",e("i",{children:r})]})]})})}),e("footer",{children:[e("button",{type:"submit",disabled:o==="loading",children:"Send Report"})," ",e("button",{type:"submit",class:"plain2",disabled:o==="loading",onClick:async()=>{try{await a.v1.accounts.$select(t.id).mute(),ue(`Muted ${u}`)}catch{ue(`Unable to mute ${u}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Mute profile"})]})," ",e("button",{type:"submit",class:"plain2",disabled:o==="loading",onClick:async()=>{try{await a.v1.accounts.$select(t.id).block(),ue(`Blocked ${u}`)}catch{ue(`Unable to block ${u}`)}},children:["Send Report ",e("small",{class:"ib",children:"+ Block profile"})]}),e(Ce,{hidden:o!=="loading"})]})]})]})]})}const Fi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",Oi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",zi="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",Bi=200,qi=10;async function Mt(){const{masto:t}=W(),n=t.v1.followedTags.list({limit:Bi}),s=[];let a=0;do{const{value:o,done:i}=await n.next();if(i||(o==null?void 0:o.length)===0)break;s.push(...o),a++}while(a<qi);return s.sort((o,i)=>o.name.localeCompare(i.name)),s.length&&setTimeout(()=>{le.account.set("followedTags",{tags:s,updatedAt:Date.now()})},1),s}const Hi=24*60*60*1e3;async function Vi(){try{const{tags:t,updatedAt:n}=le.account.get("followedTags")||{};return t!=null&&t.length?(Date.now()-n>Hi&&Mt(),t):await Mt()}catch{return[]}}const Cn=document.createElement("div"),Gi=t=>{if(!t)return[];if(t.indexOf("#")===-1)return[];Cn.innerHTML=t;const n=Cn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(s=>s.innerText.trim().replace(/^[^#]*#+/,"")):[]};function Gt({children:t}){if(typeof t=="string")return t;const[n,s]=$("");return j(()=>{Promise.resolve(t).then(s)},[t]),n}const st=9,ji=["following","mentions","notifications","list","public","trending","search","hashtag","bookmarks","favourites"],ls={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},At={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text",placeholder:"Optional, unless for multi-column mode",notRequired:!0}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},Yi=it(async({id:t})=>(await W().masto.v1.lists.$select(t).fetch()).title),Wi=it(async({id:t})=>{const n=await W().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),Pt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:Yi,path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||W().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"building":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||W().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t?`“${t}”`:"Search",path:({query:t})=>t?`/search?q=${encodeURIComponent(t)}&type=statuses`:"/search",icon:"search",excludeViewMode:({query:t})=>t?[]:["multi-column"]},"account-statuses":{id:"account-statuses",title:Wi,path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||W().instance,path:({hashtag:t,instance:n,media:s})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}${s?"?media=1":""}`,icon:"hashtag"}};function Ki({onClose:t}){const n=Te(k),{shortcuts:s}=n,[a,o]=$(!1),[i,u]=$(!1),[r]=Zt();return e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[e(w,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:Fi},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:zi},{value:"multi-column",label:"Multi-column",imgURL:Oi}].map(({value:c,label:l,imgURL:p})=>{const d=n.settings.shortcutsViewMode===c||c==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:d?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:c,checked:d,onChange:f=>{k.settings.shortcutsViewMode=f.target.value}})," ",e("img",{src:p,alt:"",width:"80",height:"58"})," ",e("span",{children:l})]},c)})}),s.length>0?e(x,{children:[e("ol",{class:"shortcuts-list",ref:r,children:s.filter(Boolean).map((c,l)=>{const p=Object.values(c).join("-"),{type:d}=c;if(!Pt[d])return null;let{icon:f,title:h,subtitle:b,excludeViewMode:m}=Pt[d];typeof h=="function"&&(h=h(c,l)),typeof b=="function"&&(b=b(c,l)),typeof f=="function"&&(f=f(c,l)),typeof m=="function"&&(m=m(c,l));const v=m==null?void 0:m.includes(n.settings.shortcutsViewMode);return e("li",{children:[e(w,{icon:f}),e("span",{class:"shortcut-text",children:[e(Gt,{children:h}),b&&e(x,{children:[" ",e("small",{class:"ib insignificant",children:b})]}),v&&e("span",{class:"tag",children:"Not available in current view mode"})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:l===0,onClick:()=>{const g=Array.from(k.shortcuts);if(l>0){const y=k.shortcuts[l-1];g[l-1]=c,g[l]=y,k.shortcuts=g}},children:e(w,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:l===s.length-1,onClick:()=>{const g=Array.from(k.shortcuts);if(l<k.shortcuts.length-1){const y=k.shortcuts[l+1];g[l+1]=c,g[l]=y,k.shortcuts=g}},children:e(w,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{o({shortcut:c,shortcutIndex:l})},children:e(w,{icon:"pencil",alt:"Edit"})})]})]},p)})}),s.length===1&&n.settings.shortcutsViewMode!=="float-button"&&e("div",{class:"ui-state insignificant",children:[e(w,{icon:"info"})," ",e("small",{children:"Add more than one shortcut/column to make this work."})]})]}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:c=>{c.preventDefault(),k.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:s.length>=st&&`Max ${st} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>u(!0),children:"Import/export"}),e("button",{type:"button",disabled:s.length>=st,onClick:()=>o(!0),children:[e(w,{icon:"plus"})," ",e("span",{children:n.settings.shortcutsViewMode==="multi-column"?"Add column…":"Add shortcut…"})]})]})]}),a&&e(Re,{class:"light",onClick:c=>{c.target===c.currentTarget&&o(!1)},children:e(Xi,{shortcut:a.shortcut,shortcutIndex:a.shortcutIndex,onSubmit:({result:c,mode:l})=>{l==="edit"?k.shortcuts[a.shortcutIndex]=c:k.shortcuts.push(c)},onClose:()=>o(!1)})}),i&&e(Re,{class:"light",onClick:c=>{c.target===c.currentTarget&&u(!1)},children:e(Qi,{shortcuts:s,onClose:()=>u(!1)})})]})}const Zi=1e3*60,Ji=it(()=>{const{masto:t}=W();return t.v1.lists.list()},{maxAge:Zi}),$n={search:"For multi-column mode, search term is required, else the column will not be shown.",hashtag:"Multiple hashtags are supported. Space-separated."};function Xi({onSubmit:t,disabled:n,shortcut:s,shortcutIndex:a,onClose:o}){var v,g;const i=!!s,[u,r]=$((s==null?void 0:s.type)||null),{masto:c}=W(),[l,p]=$("default"),[d,f]=$([]),[h,b]=$([]);j(()=>{(async()=>{if(u==="list")try{p("loading");const y=await Ji();y.sort((I,S)=>I.title.localeCompare(S.title)),f(y),p("default")}catch{p("error")}})(),(async()=>{if(u==="hashtag")try{const y=await Mt();b(y)}catch{}})()},[u]);const m=O();return j(()=>{if(i&&u&&At[u]){const y=m.current;At[u].forEach(({name:I,type:S})=>{const C=y.querySelector(`[name="${I}"]`);C&&s[I]&&(S==="checkbox"?C.checked=s[I]==="on":C.value=s[I])})}},[i,u]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:[i?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:m,onSubmit:y=>{y.preventDefault();const I=new FormData(y.target),S={};I.forEach((C,A)=>{S[A]=C==null?void 0:C.trim(),A==="instance"&&(S[A]=S[A].replace(/^https?:\/\//,"").replace(/\/+$/,""),S[A]=S[A].replace(/^@?[^@]+@/,""))}),S.type&&(t({result:S,mode:i?"edit":"add"}),y.target.reset(),r(null),o==null||o())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:n,onChange:y=>{r(y.target.value)},defaultValue:i?s.type:void 0,name:"type",children:[e("option",{}),ji.map(y=>e("option",{value:y,children:ls[y]}))]})]})}),(g=(v=At[u])==null?void 0:v.map)==null?void 0:g.call(v,({text:y,name:I,type:S,placeholder:C,pattern:A,notRequired:_})=>u==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!_,disabled:n||l==="loading",defaultValue:i?s.id:void 0,children:d.map(q=>e("option",{value:q.id,children:q.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:y})," ",e("input",{type:S,switch:S==="checkbox"||void 0,name:I,placeholder:C,required:S==="text"&&!_,disabled:n,list:u==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:A}),u==="hashtag"&&h.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:h.map(q=>e("option",{value:q.name}))})]})})),!!$n[u]&&e("p",{class:"form-note insignificant",children:[e(w,{icon:"info"}),$n[u]]}),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:n||l==="loading",children:i?"Save":"Add"}),i&&e("button",{type:"button",class:"light danger",onClick:()=>{k.shortcuts.splice(a,1),o==null||o()},children:"Remove"})]})]})})]})}function Qi({shortcuts:t,onClose:n}){var d;const{masto:s}=W(),a=me(()=>!t||!t.filter(Boolean).length?"":gn.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[o,i]=$(""),[u,r]=$("default"),c=me(()=>{if(!o)return r("default"),null;try{const f=JSON.parse(gn.decompressFromEncodedURIComponent(o));if(!Array.isArray(f))throw new Error("Not an array");return r("default"),f}catch{try{const h=JSON.parse(o);if(!Array.isArray(h))throw new Error("Not an array");return r("default"),h}catch{return r("error"),null}}},[o]),l=k.shortcuts.length>0,p=O();return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{class:"field-button",children:[e("input",{ref:p,type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:f=>{i(f.target.value)}}),k.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2 small",disabled:u==="cloud-downloading",onClick:async()=>{r("cloud-downloading");const f=le.session.get("currentAccount");ue("Downloading saved shortcuts from instance server…");try{const b=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(b){const{note:m=""}=b;if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const v=m.match(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/)[1],{v:g,dt:y,data:I}=JSON.parse(v);p.current.value=I,p.current.dispatchEvent(new Event("input"))}}r("default")}catch{r("error"),ue("Unable to download shortcuts")}},title:"Download shortcuts from instance server",children:[e(w,{icon:"cloud"}),e(w,{icon:"arrow-down"})]})]}),!!c&&Array.isArray(c)&&e(x,{children:[e("p",{children:[e("b",{children:c.length})," shortcut",c.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",o.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:c.map(f=>{var h,b;return e("li",{children:[e("span",{style:{opacity:t.some(m=>Object.keys(m).every(v=>m[v]===f[v]))?1:0},children:"*"}),e("span",{children:[ls[f.type],f.type==="list"&&" ⚠️"," ",(b=(h=At[f.type])==null?void 0:h.map)==null?void 0:b.call(h,({text:m,name:v,type:g})=>f[v]?e(x,{children:[e("span",{class:"tag collapsed insignificant",children:[m,":"," ",g==="checkbox"?f[v]==="on"?"✅":"❌":f[v]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),u==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[l&&e(x,{children:[e(Je,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const f=c.filter(m=>!k.shortcuts.some(v=>Object.keys(v).every(g=>v[g]===m[g])));if(!f.length){ue("No new shortcuts to import");return}let h=[...k.shortcuts,...f];const b=h.length>st;b&&(h=h.slice(0,st)),k.shortcuts=h,ue(b?`Shortcuts imported. Exceeded max ${st}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!c,children:"Import & append…"})})," "]}),e(Je,{confirmLabel:l?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:l?"danger":void 0,onClick:()=>{k.shortcuts=c,ue("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!c,children:l?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:a,readOnly:!0,onClick:f=>{if(f.target.value){f.target.select();try{navigator.clipboard.writeText(f.target.value),ue("Shortcuts copied")}catch{ue("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.clipboard.writeText(a),ue("Shortcut settings copied")}catch{ue("Unable to copy shortcut settings")}},children:[e(w,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:a}))&&e("button",{type:"button",class:"plain2",disabled:!a,onClick:()=>{try{navigator.share({text:a})}catch{alert("Sharing doesn't seem to work.")}},children:[e(w,{icon:"share"})," ",e("span",{children:"Share"})]})," ",k.settings.shortcutSettingsCloudImportExport&&e("button",{type:"button",class:"plain2",disabled:u==="cloud-uploading",onClick:async()=>{r("cloud-uploading");const f=le.session.get("currentAccount");try{const b=(await s.v1.accounts.relationships.fetch({id:[f]}))[0];if(b){const{note:m=""}=b;let v="";if(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/.test(m)){const g=JSON.stringify({v:"1",dt:Date.now(),data:a});v=m.replace(/<phanpy-shortcuts-settings>(.*)<\/phanpy-shortcuts-settings>/,`<phanpy-shortcuts-settings>${g}</phanpy-shortcuts-settings>`)}else v=`${m}


<phanpy-shortcuts-settings>${settingsJSON}</phanpy-shortcuts-settings>`;ue("Saving shortcuts to instance server…"),await s.v1.accounts.$select(f).note.create({comment:v}),r("default"),ue("Shortcuts saved")}}catch{r("error"),ue("Unable to save shortcuts")}},title:"Sync to instance server",children:[e(w,{icon:"cloud"}),e(w,{icon:"arrow-up"})]})," ",a.length>0&&e("small",{class:"insignificant ib",children:[a.length," characters"]})]}),!!a&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]}),k.settings.shortcutSettingsCloudImportExport&&e("footer",{children:e("p",{children:[e(w,{icon:"cloud"})," Import/export settings from/to instance server (Very experimental)"]})})]})]})}Qn(k,t=>{for(const[n,s,a,o]of t)/^show/i.test(s)&&!a&&Vt()});function eo(){var a,o,i,u,r,c,l,p;const t=Te(k),n=es(),s=mt();return e(x,{children:[!!t.showCompose&&e(Re,{children:e(_s,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((a=window.__COMPOSE__)==null?void 0:a.replyToStatus)||null,editStatus:((o=k.showCompose)==null?void 0:o.editStatus)||((i=window.__COMPOSE__)==null?void 0:i.editStatus)||null,draftStatus:((u=k.showCompose)==null?void 0:u.draftStatus)||((r=window.__COMPOSE__)==null?void 0:r.draftStatus)||null,onClose:d=>{const{newStatus:f,instance:h,type:b}=d||{};k.showCompose=!1,window.__COMPOSE__=null,f&&(k.reloadStatusPage++,ue({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[b||"post"],delay:1e3,duration:1e4,onClick:m=>{m.hideToast(),k.prevLocation=s,n(h?`/${h}/s/${f.id}`:`/s/${f.id}`)}}))}})}),!!t.showSettings&&e(Re,{onClose:()=>{k.showSettings=!1},children:e(mi,{onClose:()=>{k.showSettings=!1}})}),!!t.showAccounts&&e(Re,{onClose:()=>{k.showAccounts=!1},children:e(ai,{onClose:()=>{k.showAccounts=!1}})}),!!t.showAccount&&e(Re,{class:"light",onClose:()=>{k.showAccount=!1},children:e(Ri,{account:((c=t.showAccount)==null?void 0:c.account)||t.showAccount,instance:(l=t.showAccount)==null?void 0:l.instance,onClose:({destination:d}={})=>{k.showAccount=!1}})}),!!t.showDrafts&&e(Re,{onClose:()=>{k.showDrafts=!1},children:e(Li,{onClose:()=>k.showDrafts=!1})}),!!t.showMediaModal&&e(Re,{onClick:d=>{(d.target===d.currentTarget||d.target.classList.contains("media"))&&(k.showMediaModal=!1)},children:e(rs,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{k.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(Re,{class:"light",onClose:()=>{k.showShortcutsSettings=!1},children:e(Ki,{onClose:()=>k.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(Re,{class:"light",onClose:()=>{k.showGenericAccounts=!1},children:e(Mi,{instance:t.showGenericAccounts.instance,excludeRelationshipAttrs:t.showGenericAccounts.excludeRelationshipAttrs,onClose:()=>k.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(Re,{class:"light",onClose:d=>{k.showMediaAlt=!1},children:e(Pi,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(p=t.showMediaAlt)==null?void 0:p.lang,onClose:()=>{k.showMediaAlt=!1}})}),!!t.showEmbedModal&&e(Re,{onClose:()=>{k.showEmbedModal=!1},children:e(Ei,{html:t.showEmbedModal.html,url:t.showEmbedModal.url,width:t.showEmbedModal.width,height:t.showEmbedModal.height,onClose:()=>{k.showEmbedModal=!1}})}),!!t.showReportModal&&e(Re,{onClose:()=>{k.showReportModal=!1},children:e(Ui,{account:t.showReportModal.account,post:t.showReportModal.post,onClose:()=>{k.showReportModal=!1}})})]})}function jt({accountID:t,onChange:n}){const{masto:s}=W(),[a,o]=$("default"),[i,u]=$(null),[r,c]=$(null),l=r!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:a==="loading"||l,onClick:()=>{o("loading"),u("accept"),(async()=>{try{const p=await s.v1.followRequests.$select(t).authorize();if(!(p!=null&&p.followedBy))throw new Error("Follow request not accepted");c(p),n()}catch{}o("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:a==="loading"||l,class:"light danger",onClick:()=>{o("loading"),u("reject"),(async()=>{try{const p=await s.v1.followRequests.$select(t).reject();if(p!=null&&p.followedBy)throw new Error("Follow request not rejected");c(p),n()}catch{o("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:l&&i?i==="accept"?e(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(Ce,{hidden:a!=="loading"})})]})}const An={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},rt={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(x,{children:["reported ",t]})},zt=50;function to({notification:t,instance:n,isStatic:s,disableContextMenu:a}){var _,q,B,P;const{id:o,status:i,account:u,report:r,_accounts:c,_statuses:l}=t;let{type:p}=t;const d=(i==null?void 0:i.reblog)||i,f=d==null?void 0:d.id,h=le.session.get("currentAccount"),b=h===(u==null?void 0:u.id),m=(_=i==null?void 0:i.poll)==null?void 0:_.voted,v=!!(i!=null&&i.inReplyToAccountId)&&(i==null?void 0:i.inReplyToAccountId)!==h&&((q=i==null?void 0:i.account)==null?void 0:q.id)===h;let g=0,y=0;if(p==="favourite+reblog"){for(const D of c)(B=D._types)!=null&&B.includes("favourite")&&g++,(P=D._types)!=null&&P.includes("reblog")&&y++;!y&&g&&(p="favourite"),!g&&y&&(p="reblog")}let I;if(p==="poll"?I=rt[b?"poll-self":m?"poll-voted":"poll"]:p==="reblog"||p==="favourite"||p==="favourite+reblog"?(l==null?void 0:l.length)>1?I=rt[`${p}+account`]:v?I=rt[`${p}_reply`]:I=rt[p]:rt[p]?I=rt[p]:I=`[Unknown notification type: ${p}]`,typeof I=="function"){const D=(l==null?void 0:l.length)||(c==null?void 0:c.length);if(D)I=I(D);else if(p==="admin.report"){const L=r==null?void 0:r.targetAccount;L&&(I=I(e(dt,{account:L,showAvatar:!0})))}}if(p==="mention"&&!i)return null;const S=t.createdAt&&new Date(t.createdAt).toLocaleString(),C={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[p]||"Accounts",A=()=>{k.showGenericAccounts={heading:C,accounts:c,showReactions:p==="favourite+reblog",excludeRelationshipAttrs:p==="follow"?["followedBy"]:[]}};return e("div",{class:`notification notification-${p}`,"data-notification-id":o,tabIndex:"0",children:[e("div",{class:`notification-type notification-${p}`,title:S,children:p==="favourite+reblog"?e(x,{children:[e(w,{icon:"rocket",size:"xl",alt:p,class:"reblog-icon"}),e(w,{icon:"heart",size:"xl",alt:p,class:"favourite-icon"})]}):e(w,{icon:An[p]||"notification",size:"xl",alt:p})}),e("div",{class:"notification-content",children:[p!=="mention"&&e(x,{children:[e("p",{children:[!/poll|update/i.test(p)&&e(x,{children:(c==null?void 0:c.length)>1?e(x,{children:[e("b",{tabIndex:"0",onClick:A,children:[e("span",{title:c.length,children:Oe(c.length)})," ","people"]})," "]}):e(x,{children:[e(dt,{account:u,showAvatar:!0})," "]})}),I,p==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e(pt,{datetime:t.createdAt,format:"micro"})]})]}),p==="follow_request"&&e(jt,{accountID:u.id})]}),(c==null?void 0:c.length)>1&&e("p",{class:"avatars-stack",children:[c.slice(0,zt).map(D=>e(x,{children:[e("a",{href:D.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:L=>{L.preventDefault(),k.showAccount=D},children:[e(Ze,{url:D.avatarStatic,size:c.length<=10?"xxl":c.length<20?"xl":c.length<30?"l":c.length<40?"m":"s",alt:`${D.displayName} @${D.acct}`,squircle:D==null?void 0:D.bot},D.id),p==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:D._types.map(L=>e(w,{icon:An[L],size:"s",class:`${L}-icon`}))})]},D.id)," "]},D.id)),e("button",{type:"button",class:"small plain",onClick:A,children:[c.length>zt&&`+${c.length-zt}`,e(w,{icon:"chevron-down"})]})]}),(l==null?void 0:l.length)>1&&e("ul",{class:"notification-group-statuses",children:l.map(D=>e("li",{children:e(xn,{class:`status-link status-type-${p}`,to:n?`/${n}/s/${D.id}`:`/s/${D.id}`,children:e(_e,{status:D,size:"s",previewMode:!0,allowContextMenu:!0})})},D.id))}),i&&(!(l!=null&&l.length)||(l==null?void 0:l.length)<=1)&&e(xn,{class:`status-link status-type-${p}`,to:n?`/${n}/s/${f}`:`/s/${f}`,onContextMenu:a?void 0:D=>{const L=D.target.querySelector(".status");if(L){if(D.metaKey)return;D.preventDefault(),L.dispatchEvent(new MouseEvent("contextmenu",{clientX:D.clientX,clientY:D.clientY}))}},children:s?e(_e,{status:d,size:"s",readOnly:!0,allowContextMenu:!0}):e(_e,{statusID:f,size:"s",readOnly:!0,allowContextMenu:!0})})]})]})}function xn(t){const n=Es();return e(se,{...t,"data-read-more":"Read more →",ref:n})}const an=Be(to,(t,n)=>{var s,a;return((s=t.notification)==null?void 0:s.id)===((a=n.notification)==null?void 0:a.id)});"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",t=>{const{type:n,id:s,accessToken:a}=(t==null?void 0:t.data)||{};n==="notification"&&(k.routeNotification={id:s,accessToken:a})});const no=Be(function(){if(!("serviceWorker"in navigator))return null;const n=Te(k),{routeNotification:s}=n,{id:a,accessToken:o}=s||{},[i,u]=$(!1);et(()=>{if(!a||!o)return;const{instance:c}=W(),{masto:l,instance:p}=W({accessToken:o}),d=c===p,f=o?Ms(o):ut();(async()=>{const h=await l.v1.notifications.$select(a).fetch();if(h&&f){const b=f.instanceURL,{type:m,status:v,account:g}=h,y=!!document.querySelector("#modal-container > *"),I=m==="follow"&&!!(g!=null&&g.id),S=!!(g!=null&&g.id),C=!!(v!=null&&v.id);I&&d?k.showAccount={account:g,instance:b}:y||!d||S&&C?u({id:a,account:f,notification:h,sameInstance:d}):C?location.hash=`/${c}/s/${v.id}`:I?location.hash=`/${c}/a/${g.id}`:location.hash="/notifications"}})()},[a,o]),et(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),ht(c=>{c&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const r=()=>{u(!1),k.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(i){const{id:c,account:l,notification:p,sameInstance:d}=i;return e(Re,{class:"light",onClick:f=>{f.target===f.currentTarget&&r()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:r,children:e(w,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!d&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:f=>{const{target:h}=f;(f.target.tagName==="BUTTON"||f.target.tagName==="A")&&r()},children:e(an,{instance:l.instanceURL,notification:p,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(se,{to:"/notifications",class:"button light",onClick:r,children:[e("span",{children:"View all notifications"})," ",e(w,{icon:"arrow-right"})]})})]})]})})}return null}),ds=qs((t,n)=>{const{instance:s}=W(),[a,o]=Ye(),[i,u]=$(!1),[r,c]=$(a.get("q")||""),l=a.get("type"),p=O(null),d=O(null);return Bs(n,()=>({setValue:f=>{c(f)},focus:()=>{d.current.focus()},select:()=>{d.current.select()},blur:()=>{d.current.blur()}})),e("form",{ref:p,class:"search-popover-container",onSubmit:f=>{var b;if(f.preventDefault(),/\/search/.test(location.hash))if(r){const m={q:r};l&&(m.type=l),o(m)}else o({});else r?location.hash=`/search?q=${encodeURIComponent(r)}${l?`&type=${l}`:""}`:location.hash="/search";(b=t==null?void 0:t.onSubmit)==null||b.call(t,f)},children:[e("input",{ref:d,value:r,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false",onSearch:f=>{f.target.value||o({})},onInput:f=>{c(f.target.value),u(!0)},onFocus:()=>{var f,h;u(!0),(h=(f=p.current)==null?void 0:f.querySelector(".search-popover-item"))==null||h.classList.add("focus")},onBlur:()=>{var f,h;setTimeout(()=>{u(!1)},100),(h=(f=p.current)==null?void 0:f.querySelector(".search-popover-item.focus"))==null||h.classList.remove("focus")},onKeyDown:f=>{var b;const{key:h}=f;switch(h){case"Escape":u(!1);break;case"Down":case"ArrowDown":if(f.preventDefault(),i){const m=p.current.querySelector(".search-popover-item.focus");if(m){let v=m.nextElementSibling;for(;v&&v.hidden;)v=v.nextElementSibling;v&&(v.classList.add("focus"),Array.from(v.parentElement.children).filter(y=>y!==v).forEach(y=>{y.classList.remove("focus")}))}else{const v=p.current.querySelector(".search-popover-item");v&&v.classList.add("focus")}}break;case"Up":case"ArrowUp":if(f.preventDefault(),i){const m=document.querySelector(".search-popover-item.focus");if(m){let v=m.previousElementSibling;for(;v&&v.hidden;)v=v.previousElementSibling;v&&(v.classList.add("focus"),Array.from(v.parentElement.children).filter(y=>y!==v).forEach(y=>{y.classList.remove("focus")}))}else{const v=document.querySelector(".search-popover-item:last-child");v&&v.classList.add("focus")}}break;case"Enter":if(i){const m=document.querySelector(".search-popover-item.focus");m&&(f.preventDefault(),m.click()),u(!1),(b=t==null?void 0:t.onSubmit)==null||b.call(t,f)}break}}}),e("div",{class:"search-popover",hidden:!i||!r,children:!!r&&[{label:e(x,{children:[r," ",e("small",{class:"insignificant",children:"‒ accounts, hashtags & posts"})]}),to:`/search?q=${encodeURIComponent(r)}`,top:!l&&!/\s/.test(r),hidden:!!l},{label:e(x,{children:["Posts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=statuses`,hidden:/^https?:/.test(r),top:/\s/.test(r),icon:"document",queryType:"statuses"},{label:e(x,{children:["Posts tagged with ",e("mark",{children:["#",r.replace(/^#/,"")]})]}),to:`/${s}/t/${r.replace(/^#/,"")}`,hidden:/^@/.test(r)||/^https?:/.test(r)||/\s/.test(r),top:/^#/.test(r),type:"link",icon:"hashtag",queryType:"hashtags"},{label:e(x,{children:["Look up ",e("mark",{children:r})]}),to:`/${r}`,hidden:!/^https?:/.test(r),top:/^https?:/.test(r),type:"link"},{label:e(x,{children:["Accounts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=accounts`,icon:"group",queryType:"accounts"}].sort((f,h)=>{if(l){if(f.queryType===l)return-1;if(h.queryType===l)return 1}return f.top&&!h.top?-1:!f.top&&h.top?1:0}).filter(({hidden:f})=>!f).map(({label:f,to:h,icon:b,type:m},v)=>e(se,{to:h,class:`search-popover-item ${v===0?"focus":""}`,onClick:g=>{var y;(y=t==null?void 0:t.onSubmit)==null||y.call(t,g)},children:[e(w,{icon:b||(m==="link"?"arrow-right":"search"),class:"more-insignificant"}),e("span",{children:f})," "]}))})]})}),so=Be(function({onClose:n=()=>{}}){const[s,a]=$(!1),o=O(null);Me(["Slash","/"],u=>{a(!0),setTimeout(()=>{var r,c,l,p;(c=(r=o.current)==null?void 0:r.focus)==null||c.call(r),(p=(l=o.current)==null?void 0:l.select)==null||p.call(l)},0)},{preventDefault:!0,ignoreEventWhen:u=>{const r=/\/search/.test(location.hash),c=!!document.querySelector("#modal-container > *");return r||c}});const i=()=>{a(!1),n()};return Me("esc",u=>{var r,c;(c=(r=o.current)==null?void 0:r.blur)==null||c.call(r),i()},{enabled:s,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!s,onClick:u=>{u.target===u.currentTarget&&i()},children:e(ds,{ref:o,onSubmit:()=>{i()}})})});function io(){const{instance:t}=W(),n=Te(k),{shortcuts:s,settings:a}=n;if(!s.length||a.shortcutsViewMode==="multi-column"||!a.shortcutsViewMode&&a.shortcutsColumnsMode)return null;const o=O(),i=me(()=>s.map((r,c)=>{const{type:l,...p}=r;if(!Pt[l])return null;let{id:d,path:f,title:h,subtitle:b,icon:m}=Pt[l];return typeof d=="function"&&(d=d(p,c)),typeof f=="function"&&(f=f({...p,instance:p.instance||t},c)),typeof h=="function"&&(h=h(p,c)),typeof b=="function"&&(b=b(p,c)),typeof m=="function"&&(m=m(p,c)),{id:d,path:f,title:h,subtitle:b,icon:m}}).filter(Boolean),[s]),u=es();return Me(["1","2","3","4","5","6","7","8","9"],(r,c)=>{var p,d;const l=parseInt(c.keys[0],10)-1;if(l<i.length){const{path:f}=i[l];f&&(u(f),(d=(p=o.current)==null?void 0:p.closeMenu)==null||d.call(p))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",onContextMenu:r=>{r.preventDefault(),k.showShortcutsSettings=!0},children:e("ul",{children:i.map(({id:r,path:c,title:l,subtitle:p,icon:d},f)=>e("li",{children:e(se,{class:p?"has-subtitle":"",to:c,onClick:h=>{if(h.target.classList.contains("is-active")){h.preventDefault();const b=document.getElementById(`${r}-page`);if(b){b.scrollTop=0;const m=b.querySelector(".updates-button");m&&m.click()}}},children:[e(w,{icon:d,size:"xl",alt:l}),e("span",{children:[e(Gt,{children:l}),p&&e(x,{children:[e("br",{}),e("small",{children:p})]})]})]})},`${f}-${r}-${l}-${p}-${c}`))})}):e(je,{instanceRef:o,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:r=>{r.preventDefault(),k.showShortcutsSettings=!0},onTransitionStart:r=>{var c,l;try{const{target:p}=r;getComputedStyle(p).pointerEvents==="none"&&((l=(c=o.current)==null?void 0:c.closeMenu)==null||l.call(c))}catch{}},children:e(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:i.map(({id:r,path:c,title:l,subtitle:p,icon:d},f)=>e(Fe,{to:c,class:"glass-menu-item",children:[e(w,{icon:d,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Gt,{children:l})}),p&&e(x,{children:[" ",e("small",{class:"more-insignificant",children:p})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:f+1})]},`${f}-${r}-${l}-${p}-${c}`))})})}const oo=Be(io);function ao(t){var o;let n=[],s=[],a=0;for(let i=0;i<t.length;i++){const u=t[i];u.reblog&&!((o=u.account)!=null&&o.group)?(s.push(u),a++):(n.push(u),a<3&&(a=0))}if(t.length>10&&(s.length>t.length/4||a>=3)){const i=s.map(u=>u.id);if(s.length>t.length*3/4)n=[...n,{id:i,items:s,type:"boosts"}];else{const u=Math.floor(n.length/2);n=[...n.slice(0,u),{id:i,items:s,type:"boosts"},...n.slice(u)]}return n}else return t}function Rn(t,n){const s=le.account.get("boostedStatusIDs")||{},a=t.filter(i=>{if(!i.reblog)return!0;const u=`${n}-${i.reblog.id}`,r=s[u];return r&&r!==i.id?!1:(s[u]=i.id,!0)}),o=Object.keys(s);return o.length>50&&o.slice(0,o.length-50).forEach(i=>{delete s[i]}),le.account.set("boostedStatusIDs",s),a}function co(t,n){const s=[];let a=0;t.forEach(u=>{for(let c=0;c<s.length;c++){if(s[c].find(l=>l.id===u.id))return;if(s[c].find(l=>l.id===u.inReplyToId)||s[c].find(l=>l.inReplyToId===u.id)){s[c].push(u);return}}const r=t.find(c=>c.id===u.inReplyToId);r&&(s[a++]=[u,r])});for(let u=0;u<s.length;u++)for(let r=u+1;r<s.length;r++)s[u].find(l=>s[r].includes(l))&&(s[u]=[...s[u],...s[r]],s[u]=s[u].filter((l,p,d)=>d.findIndex(f=>f.id===l.id)===p),s.splice(r,1),r--);s.forEach(u=>{u.sort((r,c)=>!r.inReplyToId&&!c.inReplyToId?new Date(r.createdAt)-new Date(c.createdAt):r.inReplyToId===c.id?1:c.inReplyToId===r.id||!r.inReplyToId?-1:c.inReplyToId?new Date(r.createdAt)-new Date(c.createdAt):1)}),s.forEach(u=>{const r=u[0].account.id;u.forEach(c=>{c.account.id!==r&&(c._differentAuthor=!0)})}),s.length;const o=[],i=[];return t.forEach(u=>{if(u.reblog){o.push(u);return}for(let r=0;r<s.length;r++)if(s[r].find(c=>c.id===u.id)){if(i.includes(r))return;const c=s[r];c.sort((p,d)=>{const f=new Date(p.createdAt),h=new Date(d.createdAt);return f-h});const l=c[0].account.id;o.push({id:c.map(p=>p.id),items:c,type:c.every(p=>p.account.id===l)?"thread":"conversation"}),i.push(r);return}if(u.inReplyToId&&u.inReplyToAccountId!==u.account.id){const r=Ge(u.id,n);k.statusReply[r]||queueMicrotask(async()=>{try{const{masto:c}=W({instance:n}),l=await ro(u.inReplyToId,c);Ee(l,n,{skipThreading:!0,skipUnfurling:!0}),k.statusReply[r]={id:l.id,instance:n}}catch{}})}o.push(u)}),o}const ro=it((t,n)=>n.v1.statuses.$select(t).fetch());async function us(t,n){const s=await Vi();if(!s.length)return;const{statusFollowedTags:a}=k,o=[];if(t.forEach(i=>{var f;if(i.reblog)return;const{id:u,content:r,tags:c=[]}=i,l=Ge(u,n);if((f=a[l])!=null&&f.length)return;const p=Gi(r);if(!p.length&&!c.length)return;const d=s.reduce((h,b)=>((p.some(m=>m.toLowerCase()===b.name.toLowerCase())||c.some(m=>m.name.toLowerCase()===b.name.toLowerCase()))&&h.push(b.name),h),[]);d.length&&o.push({item:i,sKey:l,followedTags:d})}),o.length){const i=o.map(r=>r.item.account),u=await nn(i);if(!u)return;o.forEach(r=>{const{item:c,sKey:l,followedTags:p}=r,d=u[c.account.id];d&&!d.following&&(a[l]=p)})}}function lo(){k.statusFollowedTags={}}function uo({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:a=10,scrollThresholdEnd:o=10,direction:i="vertical",distanceFromStartPx:u,distanceFromEndPx:r}={}){const[c,l]=$(null),[p,d]=$(!1),[f,h]=$(!1),[b,m]=$(!1),[v,g]=$(!1),y=i==="vertical";return et(()=>{const I=t.current;if(!I)return{};let S=y?I.scrollTop:I.scrollLeft;function C(){const{scrollTop:A,scrollLeft:_,scrollHeight:q,scrollWidth:B,clientHeight:P,clientWidth:D}=I,L=y?A:_,N=y?q:B,E=y?P:D,J=Math.abs(L-S),H=u||Math.min(E*n,N,L),oe=r||Math.min(E*s,N,N-L-E);J>=(S<L?o:a)&&(l(S<L?"end":"start"),S=L),d(L<=0),h(L+E>=N),m(L<=H),g(L+E>=N-oe)}return I.addEventListener("scroll",C,{passive:!0}),()=>I.removeEventListener("scroll",C)},[n,s,a,o]),{scrollDirection:c,reachStart:p,reachEnd:f,nearReachStart:b,nearReachEnd:v,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function hs({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:s=1,scrollThresholdStart:a=10,scrollThresholdEnd:o=10,direction:i="vertical",distanceFromStartPx:u,distanceFromEndPx:r,init:c}={},l,p){if(!l)return;const d=i==="vertical",f=O(null),h=O(null),b=Hs(()=>{let m=!1,v=!1,g=!1,y=!1;const I=t.current,{scrollTop:S,scrollLeft:C,scrollHeight:A,scrollWidth:_,clientHeight:q,clientWidth:B}=I,P=d?S:C,D=d?A:_,L=d?q:B,N=Math.abs(P-f.current),E=u||Math.min(L*n,D,P),J=r||Math.min(L*s,D,D-P-L);N>=(f.current<P?o:a)&&(h.current=f.current<P?"end":"start",f.current=P),m=P<=0,v=P+L>=D,g=P<=E,y=P+L>=D-J,l({scrollDirection:h.current,reachStart:m,reachEnd:v,nearReachStart:g,nearReachEnd:y})},500);et(()=>{const m=t.current;return m?(f.current=m[d?"scrollTop":"scrollLeft"],m.addEventListener("scroll",b,{passive:!0}),()=>m.removeEventListener("scroll",b)):{}},[n,s,a,o,...p]),j(()=>{c&&t.current&&queueMicrotask(()=>{t.current.dispatchEvent(new Event("scroll"))})},[c])}function ho({class:t,statusID:n,status:s,instance:a,parent:o,onMediaClick:i}){let u=Ge(n,a);const r=Te(k);if(s||(s=r.statuses[u]||r.statuses[n],u=Ge(s==null?void 0:s.id,a)),!s)return null;const{account:{acct:c,avatar:l,avatarStatic:p,id:d,url:f,displayName:h,username:b,emojis:m,bot:v,group:g},id:y,repliesCount:I,reblogged:S,reblogsCount:C,favourited:A,favouritesCount:_,bookmarked:q,poll:B,muted:P,sensitive:D,spoilerText:L,visibility:N,language:E,editedAt:J,filtered:H,card:oe,createdAt:ie,inReplyToId:be,inReplyToAccountId:Se,content:ee,mentions:U,mediaAttachments:X,reblog:ne,uri:ge,url:ye,emojis:ke,_deleted:$e,_pinned:Ie}=s;if(!(X!=null&&X.length))return null;const Q=re=>{re.shiftKey},ce=me(()=>le.session.get("currentAccount"),[]),T=me(()=>ce&&ce===d,[d,ce]),z=Vs(Zn),G=!T&&Et(H,z);if((G==null?void 0:G.action)==="hide")return null;const F=D,fe=me(()=>(le.account.get("preferences")||{})["reading:expand:media"]||"default",[])==="show_all",he=o||"div";return X.map((re,R)=>{const V=`${u}-${re.id}`,te=G==null?void 0:G.titlesStr;return e(he,{"data-state-post-id":u,onMouseEnter:Q,"data-spoiler-text":L||(D?"Sensitive media":void 0),"data-filtered-text":G?`Filtered${te?`: ${te}`:""}`:void 0,class:`
          media-post
          ${G?"filtered":""}
          ${F?"has-spoiler":""}
          ${fe?"show-media":""}
        `,children:e(Wn,{class:t,media:re,lang:E,to:`/${a}/s/${y}?media-only=${R+1}`,onClick:i?M=>i(M,R,re,s):void 0})},V)})}const Ln=Be(ho);function po(t){var S,C,A,_,q;const n=Te(k),{masto:s,instance:a,authenticated:o}=W(),[i,u]=$(),[r,c]=$(!1);j(()=>{const B=le.local.getJSON("accounts")||[],P=B.find(D=>D.info.id===le.session.get("currentAccount"));P&&u(P),c(B.length>1)},[]);const l=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(B=>B.type==="following"),p=Gs(()=>{k.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),d=O(),[f,h]=$(void 0),b=Ps([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),m=O();async function v(B){return(B||!m.current)&&(m.current=s.v1.mutes.list({limit:80})),await m.current.next()}const g=O();async function y(B){return(B||!g.current)&&(g.current=s.v1.blocks.list({limit:80})),await g.current.next()}const I=O();return e(x,{children:[e("button",{ref:d,type:"button",class:`button plain nav-menu-button ${r?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{I.current=Date.now(),h(B=>B?void 0:"open")},onContextMenu:B=>{B.preventDefault(),k.showAccounts=!0},...p(),children:[r&&e(Ze,{url:((S=i==null?void 0:i.info)==null?void 0:S.avatar)||((C=i==null?void 0:i.info)==null?void 0:C.avatarStatic),size:"l",squircle:(A=i==null?void 0:i.info)==null?void 0:A.bot}),e(w,{icon:"menu",size:r?"s":"l"})]}),e(ts,{menuClassName:"nav-menu",state:f,anchorRef:d,onClose:()=>{h(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{Date.now()-I.current<300||h(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:b,unmountOnClose:!0,children:[!!((_=n.appVersion)!=null&&_.commitHash)&&n.appVersion.commitHash!=="594cad4"&&e("div",{class:"top-menu",children:[e(pe,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(ze,{})]}),e("section",{children:[e(Fe,{to:"/",children:[e(w,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),o&&e(x,{children:[l&&e(Fe,{to:"/following",children:[e(w,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Fe,{to:"/catchup",children:[e(w,{icon:"history",size:"l"}),e("span",{children:"Catch-up"})]}),e(Fe,{to:"/mentions",children:[e(w,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Fe,{to:"/notifications",children:[e(w,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(ze,{}),e(Fe,{to:"/l",children:[e(w,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(Fe,{to:"/ft",children:[e(w,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Fe,{to:"/b",children:[e(w,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Fe,{to:"/f",children:[e(w,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]})]}),e(ze,{}),e(Fe,{to:"/search",children:[e(w,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Fe,{to:`/${a}/p/l`,children:[e(w,{icon:"building",size:"l"})," ",e("span",{children:"Local"})]}),e(Fe,{to:`/${a}/p`,children:[e(w,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(Fe,{to:`/${a}/trending`,children:[e(w,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:o?e(x,{children:[e(ze,{}),((q=i==null?void 0:i.info)==null?void 0:q.id)&&e(Fe,{to:`/${a}/a/${i.info.id}`,children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(pe,{onClick:()=>{k.showAccounts=!0},children:[e(w,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(pe,{onClick:()=>{k.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:v,excludeRelationshipAttrs:["muting"]}},children:[e(w,{icon:"mute",size:"l"})," Muted users…"]}),e(pe,{onClick:()=>{k.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:y,excludeRelationshipAttrs:["blocking"]}},children:[e(w,{icon:"block",size:"l"}),"Blocked users…"]}),e(ze,{className:"divider-grow"}),e(pe,{onClick:()=>{k.showKeyboardShortcutsHelp=!0},children:[e(w,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(pe,{onClick:()=>{k.showShortcutsSettings=!0},children:[e(w,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(pe,{onClick:()=>{k.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(x,{children:[e(ze,{}),e(Fe,{to:"/login",children:[e(w,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(pe,{onClick:()=>{k.showSettings=!0},children:[e(w,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const gt=Be(po),Tt={block:"nearest",inline:"center",behavior:"smooth"};function tt({title:t,titleComponent:n,id:s,instance:a,emptyText:o,errorText:i,useItemID:u,boostsCarousel:r,fetchItems:c=()=>{},checkForUpdates:l=()=>{},checkForUpdatesInterval:p=15e3,headerStart:d,headerEnd:f,timelineStart:h,refresh:b,view:m,filterContext:v,showFollowedTags:g,showReplyParent:y}){const I=Te(k),[S,C]=$([]),[A,_]=$("default"),[q,B]=$(!1),[P,D]=$(!1),[L,N]=$(!0),E=O(),J=m!=="media",H=js(Q=>{D(!1),A!=="loading"&&(_("loading"),(async()=>{try{let{done:ce,value:T}=await c(Q);if(Array.isArray(T)){const[z,G]=T.reduce((F,K)=>(K._pinned?F[0].push(K):F[1].push(K),F),[[],[]]);T=G,J&&(r&&(T=ao(T)),T=co(T,a)),z.length&&(T=z.concat(T)),C(Q?T:F=>[...F,...T]),T.length||(ce=!0),B(!ce)}else B(!1);_("default")}catch{_("error")}finally{H.cancel()}})())},1500,{leading:!0,trailing:!1}),oe=".timeline-item, .timeline-item-alt",ie=Me("j, shift+j",(Q,ce)=>{const T=document.activeElement.closest(oe),z=T==null?void 0:T.getBoundingClientRect(),G=Array.from(E.current.querySelectorAll(oe));if(T&&z.top<E.current.clientHeight&&z.bottom>0){const F=G.indexOf(T);let K=G[F+1];ce.shift&&(K=G.find((fe,he)=>he>F&&!fe.classList.contains("timeline-item-alt"))),K&&(K.focus(),K.scrollIntoView(Tt))}else{const F=G.find(K=>{const fe=K.getBoundingClientRect();return fe.top>=44&&fe.left>=0});F&&(F.focus(),F.scrollIntoView(Tt))}}),be=Me("k, shift+k",(Q,ce)=>{const T=document.activeElement.closest(oe),z=T==null?void 0:T.getBoundingClientRect(),G=Array.from(E.current.querySelectorAll(oe));if(T&&z.top<E.current.clientHeight&&z.bottom>0){const F=G.indexOf(T);let K=G[F-1];ce.shift&&(K=G.findLast((fe,he)=>he<F&&!fe.classList.contains("timeline-item-alt"))),K&&(K.focus(),K.scrollIntoView(Tt))}else{const F=G.find(K=>{const fe=K.getBoundingClientRect();return fe.top>=44&&fe.left>=0});F&&(F.focus(),F.scrollIntoView(Tt))}}),Se=Me(["enter","o"],()=>{const Q=document.activeElement.closest(oe);Q&&Q.click()}),ee=S.length>0&&A!=="loading"&&P,U=Ke(()=>{var Q;H(!0),(Q=E.current)==null||Q.scrollTo({top:0,behavior:"smooth"})},[H]),X=Me(".",()=>{ee&&U()}),ne=O(),[ge,ye]=$(!1);hs({scrollableRef:E,distanceFromEnd:2,scrollThresholdStart:44},({scrollDirection:Q,nearReachStart:ce,reachStart:T})=>{if(ne.current){const z=Q==="end"&&!ce;ne.current.hidden=z}ye(ce),T&&H(!0)},[]),j(()=>{var Q;(Q=E.current)==null||Q.scrollTo({top:0}),H(!0)},[]),j(()=>{H(!0)},[b]);const ke=O(m);j(()=>{ke.current!==m&&(ke.current=m,C([]))},[m]);const $e=Ke(async({disableIdleCheck:Q=!1}={})=>{const ce=E.current?getComputedStyle(E.current).pointerEvents==="none":!1;I.settings.autoRefresh&&E.current.scrollTop<16&&(Q||window.__IDLE__)&&!bo()&&!ce?H(!0):await l()&&D(!0)},[s,H,l,I.settings.autoRefresh]),Ie=O();return ht(Q=>{if(Q){const ce=Date.now()-Ie.current;(!Ie.current||ce>1e3*3)&&$e({disableIdleCheck:!0})}else Ie.current=Date.now();N(Q)},[l,$e,I.settings.autoRefresh]),Hn($e,L&&!P?p*(ge?1:2):null),e(Zn.Provider,{value:v,children:e("div",{id:`${s}-page`,class:"deck-container",ref:Q=>{E.current=Q,ie.current=Q,be.current=Q,Se.current=Q},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{ref:ne,onClick:Q=>{var ce;Q.target.closest("a, button")||(ce=E.current)==null||ce.scrollTo({top:0,behavior:"smooth"})},onDblClick:Q=>{Q.target.closest("a, button")||H(!0)},class:A==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(gt,{}),d??e(se,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!f&&f})]}),ee&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:U,children:[e(w,{icon:"arrow-up"})," New posts"]})]}),!!h&&e("div",{class:`timeline-start ${A==="loading"?"loading":""}`,children:h}),S.length?e(x,{children:[e("ul",{class:`timeline ${m?`timeline-${m}`:""}`,children:[S.map(Q=>e(fo,{status:Q,instance:a,useItemID:u,filterContext:v,view:m,showFollowedTags:g,showReplyParent:y},Q.id+(Q==null?void 0:Q._pinned)+m)),q&&A==="loading"&&(m==="media"?null:e(x,{children:[e("li",{style:{height:"20vh"},children:e(_e,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(_e,{skeleton:!0})})]}))]}),A==="default"&&(q?e(Qe,{root:E.current,rootMargin:`0px 0px ${screen.height*1.5}px 0px`,onChange:Q=>{Q&&H()},children:e("button",{type:"button",class:"plain block",onClick:()=>H(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):A==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((Q,ce)=>m==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e(_e,{skeleton:!0})},ce))}):A!=="error"&&e("p",{class:"ui-state",children:o}),A==="error"&&e("p",{class:"ui-state",children:[i,e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>H(!S.length),children:"Try again"})]})]})})})}const fo=Be(({status:t,instance:n,useItemID:s,filterContext:a,view:o,showFollowedTags:i,showReplyParent:u})=>{const{id:r,reblog:c,items:l,type:p,_pinned:d}=t;d&&(s=!1);const f=(c==null?void 0:c.id)||r,h=n?`/${n}/s/${f}`:`/s/${f}`;let b="";p==="boosts"?b=`${l.length} Boosts`:p==="pinned"&&(b="Pinned posts");const m=p==="boosts"||p==="pinned";if(l){const g=ft(l,a);if(m)return g.sort((I,S)=>{const C=Et(I.filtered,a),A=Et(S.filtered,a);return C&&!A?1:!C&&A?-1:0}),e("li",{class:"timeline-item-carousel",children:e(mo,{title:b,class:`${p}-carousel`,children:g.map(I=>{const{id:S,reblog:C,_pinned:A}=I,_=(C==null?void 0:C.id)||S,q=n?`/${n}/s/${_}`:`/s/${_}`;return A&&(s=!1),e("li",{children:e(se,{class:"status-carousel-link timeline-item-alt",to:q,children:s?e(_e,{statusID:S,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):e(_e,{status:I,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},S)})})},`timeline-${r}`);const y=g.length>3;return g.map((I,S)=>{const{id:C,_differentAuthor:A}=I,_=n?`/${n}/s/${C}`:`/s/${C}`,q=S>0&&S<g.length-1,B=I.sensitive&&!!I.spoilerText,P=!A&&B&&S>0||y&&q&&(p==="thread"||p==="conversation"&&!A&&!g[S-1]._differentAuthor&&!g[S+1]._differentAuthor),D=S===0,L=S===g.length-1;return e("li",{class:`timeline-item-container timeline-item-container-type-${p} timeline-item-container-${D?"start":L?"end":"middle"} ${A?"timeline-item-diff-author":""}`,children:e(se,{class:"status-link timeline-item",to:_,children:P?e(go,{status:I,instance:n}):s?e(_e,{statusID:C,instance:n,enableCommentHint:L,showFollowedTags:i}):e(_e,{status:I,instance:n,enableCommentHint:L,showFollowedTags:i})})},`timeline-${C}`)})}const v=`timeline-${r+d}`;return o==="media"?s?e(Ln,{class:"timeline-item",parent:"li",statusID:r,instance:n},v):e(Ln,{class:"timeline-item",parent:"li",status:t,instance:n},v):e("li",{children:e(se,{class:"status-link timeline-item",to:h,children:s?e(_e,{statusID:r,instance:n,enableCommentHint:!0,showFollowedTags:i,showReplyParent:u}):e(_e,{status:t,instance:n,enableCommentHint:!0,showFollowedTags:i,showReplyParent:u})})},v)},(t,n)=>{var o,i;const s=(((o=t.status)==null?void 0:o.id)||"").toString(),a=(((i=n.status)==null?void 0:i.id)||"").toString();return s===a&&t.instance===n.instance&&t.view===n.view});function mo({title:t,class:n,children:s}){const a=O(),o=O(),i=O(),[u,r]=$(!1);return j(()=>{setTimeout(()=>{r(!0)},1)},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{ref:o,type:"button",class:"small plain2",onClick:()=>{var c,l;(l=a.current)==null||l.scrollBy({left:-Math.min(320,(c=a.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-left"})})," ",e("button",{ref:i,type:"button",class:"small plain2",onClick:()=>{var c,l;(l=a.current)==null||l.scrollBy({left:Math.min(320,(c=a.current)==null?void 0:c.offsetWidth),behavior:"smooth"})},children:e(w,{icon:"chevron-right"})})]})]}),e("ul",{ref:a,children:[e(Qe,{class:"status-carousel-beacon",onChange:c=>{o.current&&(o.current.disabled=c)}}),s[0],u&&s.slice(1),e(Qe,{class:"status-carousel-beacon",onChange:c=>{i.current&&(i.current.disabled=c)}})]})]})}function go({status:t,instance:n}){const s=Te(k),{id:a,visibility:o,language:i}=t,u=Jn(t),r=Ge(a,n);return e("article",{class:`status compact-thread ${o==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[s.statusThreadNumber[r]?e("div",{class:"status-thread-badge",children:[e(w,{icon:"thread",size:"s"}),s.statusThreadNumber[r]?` ${s.statusThreadNumber[r]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(w,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:u,lang:i,dir:"auto",children:[u,t.sensitive&&t.spoilerText&&e(x,{children:[" ",e("span",{class:"spoiler-badge",children:e(w,{icon:"eye-close",size:"s"})})]})]})]})}function bo(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const lt=20,cn=1983,_n=`${cn}-01`,yo=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function wo(t){var a;const{masto:n}=W({instance:t}),s=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((a=s==null?void 0:s.statuses)!=null&&a.length)}const vo=it(wo);function So(){const t=Te(k),{id:n,...s}=at(),[a,o]=Ye(),i=a.get("month"),u=!a.get("replies"),r=!!a.get("boosts"),c=a.get("tagged"),l=!!a.get("media"),{masto:p,instance:d,authenticated:f}=W({instance:s.instance}),{masto:h,instance:b}=W(),m=O(),v=[i,u,r,c,l],[g,y]=$(),I=O(0);j(()=>{I.current=0},v);const S=me(()=>d===b,[d,b]),[C,A]=$(!1);j(()=>{S&&g!=null&&g.acct&&(async()=>{const ee=await vo(d);A(ee)})()},[d,S,g==null?void 0:g.acct]);async function _(ee){var ke,$e,Ie;const U=/^\d{4}-[01]\d$/.test(i),X=(($e=(ke=i==null?void 0:i.split)==null?void 0:ke.call(i,"-"))==null?void 0:$e[0])>=cn;if(U&&X){if(!g)return{value:[],done:!0};const[Q,ce]=i.split("-"),T=parseInt(ce,10)-1,z=new Date(Q,T,0),G=`${z.getFullYear()}-${(z.getMonth()+1).toString().padStart(2,"0")}-${z.getDate().toString().padStart(2,"0")}`,F=new Date(Q,T+1,1),K=`${F.getFullYear()}-${(F.getMonth()+1).toString().padStart(2,"0")}-${F.getDate().toString().padStart(2,"0")}`;let fe;ee?(fe=lt+1,I.current=0):(fe=lt+I.current+1,I.current+=lt);const he=await p.v2.search.fetch({q:`from:${g.acct} after:${G} before:${K}`,type:"statuses",limit:fe,offset:I.current});if((Ie=he==null?void 0:he.statuses)!=null&&Ie.length){const re=he.statuses.slice(0,lt);re.forEach(V=>{Ee(V,d)});const R=he.statuses.length<=lt;return{value:re,done:R}}else return{value:[],done:!0}}const ne=[];if(ee){const{value:Q}=await p.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(Q!=null&&Q.length&&!c&&!l){const ce=Q.map(T=>(Ee(T,d),{...T,_pinned:!0}));if(ce.length>=3){const T=ce.map(z=>z.id);ne.push({id:T,items:ce,type:"pinned"})}else ne.push(...ce)}}(ee||!m.current)&&(m.current=p.v1.accounts.$select(n).statuses.list({limit:lt,exclude_replies:u,exclude_reblogs:r,only_media:l,tagged:c}));const{value:ge,done:ye}=await m.current.next();return ge!=null&&ge.length&&(ne.push(...ge),ge.forEach(Q=>{Ee(Q,d)})),{value:ne,done:ye}}const[q,B]=$([]);Pe(g!=null&&g.acct?`${g!=null&&g.displayName?g.displayName+" ":""}@${g.acct}${u?r?" (- Boosts)":c?` (#${c})`:l?" (Media)":i?` (${new Date(i).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const P=O(),D=Ke(()=>{const ee=P.current||p.v1.accounts.$select(n).fetch();return P.current=ee,ee},[n,p]);j(()=>{(async()=>{try{const ee=await D();y(ee)}catch{}try{const ee=await p.v1.accounts.$select(n).featuredTags.list();B(ee)}catch{}})()},[n]);const{displayName:L,acct:N,emojis:E}=g||{},J=me(()=>{const ee=t.accounts[`${n}@${d}`];return e(cs,{instance:d,account:ee||n,fetchAccount:D,authenticated:f,standalone:!0})},[n,d,f,D]),H=O(),oe=me(()=>e(x,{children:[J,e("div",{class:"filter-bar",ref:H,style:{position:"relative"},children:[!u||r||c||l||!!i?e(se,{to:`/${d}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(w,{icon:"x",size:"l"})},"clear-filters"):e(w,{icon:"filter",class:"insignificant",size:"l"}),e(se,{to:`/${d}/a/${n}${u?"?replies=1":""}`,onClick:()=>{u&&ue("Showing post with replies")},class:u?"":"is-active",children:"+ Replies"}),e(se,{to:`/${d}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||ue("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),e(se,{to:`/${d}/a/${n}${l?"":"?media=1"}`,onClick:()=>{l||ue("Showing posts with media")},class:l?"is-active":"",children:"Media"}),q.map(U=>e(se,{to:`/${d}/a/${n}${c===U.name?"":`?tagged=${encodeURIComponent(U.name)}`}`,onClick:()=>{c!==U.name&&ue(`Showing posts tagged with #${U.name}`)},class:c===U.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),U.name]})},U.id)),C&&(yo?e("label",{class:`filter-field ${i?"is-active":""}`,children:[e(w,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(g!=null&&g.acct),value:i||"",min:_n,max:new Date().toISOString().slice(0,7),onInput:U=>{const{value:X,validity:ne}=U.currentTarget;if(!ne.valid)return;o(X?{month:X}:{});const[ge,ye]=X.split("-"),ke=parseInt(ye,10)-1,$e=new Date(ge,ke);ue(`Showing posts in ${$e.toLocaleString("default",{month:"long",year:"numeric"})}`)}})]}):e(ko,{class:`filter-field ${i?"is-active":""}`,disabled:!(g!=null&&g.acct),value:i||"",min:_n,max:new Date().toISOString().slice(0,7),onInput:U=>{const{value:X,validity:ne}=U;ne.valid&&o(X?{month:X}:{})}}))]})]}),[n,d,f,q,C,...v]);j(()=>{var U;const ee=(U=H.current)==null?void 0:U.querySelector(".is-active");ee&&H.current.scrollTo({behavior:"smooth",left:ee.offsetLeft-(H.current.offsetWidth-ee.offsetWidth)/2})},[q,C,...v]);const ie=me(()=>g!=null&&g.url?new URL(g.url).hostname:null,[g]),Se=!!g&&!(d===ie);return e(tt,{title:`${g!=null&&g.acct?"@"+g.acct:"Posts"}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(jn,{text:L,emojis:E})}),e("div",{children:e("span",{children:["@",N]})})]}),id:"account-statuses",instance:d,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:_,useItemID:!0,view:l?"media":void 0,boostsCarousel:t.settings.boostsCarousel,timelineStart:oe,refresh:[u,r,c,l,i+(g==null?void 0:g.acct)].toString(),headerEnd:e(je,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(pe,{disabled:!Se,onClick:()=>{(async()=>{try{const{masto:ee}=W({instance:ie}),U=await ee.v1.accounts.lookup({acct:g.acct}),{id:X}=U;location.hash=`/${ie}/a/${X}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:ie}),")"]})]}),!S&&e(pe,{onClick:()=>{(async()=>{try{const ee=await h.v1.accounts.lookup({acct:g.acct+"@"+d}),{id:U}=ee;location.hash=`/${b}/a/${U}`}catch{alert("Unable to fetch account info")}})()},children:[e(w,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to my instance (",e("b",{children:b}),")"]})]})]})},n)}function ko(t){const{class:n,disabled:s,value:a,min:o,max:i,onInput:u=()=>{}}=t,[r,c]=(a==null?void 0:a.split("-"))||[],l=O(),p=O(),d=(f,h)=>{const[b,m]=(o==null?void 0:o.split("-"))||[],[v,g]=(i==null?void 0:i.split("-"))||[];return!(h<b||h>v||h===b&&f<m||h===v&&f>g)};return e("div",{class:n,children:[e(w,{icon:"month",size:"l"}),e("select",{ref:l,disabled:s,value:c||"",onInput:f=>{const{value:h}=f.currentTarget,b=p.current.value;if(!d(h,b))return{value:"",validity:{valid:!1}};u({value:h?`${b}-${h}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(f,h)=>e("option",{value:(h+1).toString().padStart(2,"0"),children:new Date(0,h).toLocaleString("default",{month:"long"})},h))]})," ",e("input",{ref:p,type:"number",disabled:s,value:r||new Date().getFullYear(),min:(o==null?void 0:o.slice(0,4))||cn,max:(i==null?void 0:i.slice(0,4))||new Date().getFullYear(),onInput:f=>{const{value:h,validity:b}=f.currentTarget,m=l.current.value;if(!b.valid||!d(m,h))return{value:"",validity:{valid:!1}};u({value:h?`${h}-${m}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const Io=20;function ps(){Pe("Bookmarks","/b");const{masto:t,instance:n}=W(),s=O();async function a(o){return(o||!s.current)&&(s.current=t.v1.bookmarks.list({limit:Io})),await s.current.next()}return e(tt,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:a})}const To="home";function Co(){Pe("Catch-up","/catchup");const{masto:t,instance:n}=W(),[s,a]=Ye(),o=s.get("id"),[i,u]=$("start"),[r,c]=$(!1),l=me(()=>le.session.get("currentAccount"),[]),p=T=>T===l;async function d({maxCreatedAt:T}){var K,fe,he;const z=T?new Date(T):null,G=[],F=t.v1.timelines.home.list({limit:40});e:for(;;)try{const re=await F.next(),{value:R}=re;if(R!=null&&R.length){await us(R,n);let V=!1;for(let te=0;te<R.length;te++){const M=R[te],ae=new Date(M.createdAt);if(!z||ae>=z){const Z=!p(((fe=(K=M.reblog)==null?void 0:K.account)==null?void 0:fe.id)||M.account.id)&&Et(((he=M.reblog)==null?void 0:he.filtered)||M.filtered,To);if((Z==null?void 0:Z.action)==="hide")continue;M._filtered=Z;const Ae=Ge(M.id,n);M._followedTags=k.statusFollowedTags[Ae]?[...k.statusFollowedTags[Ae]]:[],G.push(M),V=!0}if(!V)break e}}else break e;await new Promise(V=>setTimeout(V,1e3))}catch{break e}return G.forEach(re=>{if(re!=null&&re.inReplyToId){const R=G.find(V=>V.id===re.inReplyToId);R&&!R.inReplyToId&&(R._thread=!0)}}),G}const[f,h]=$([]),b=O();async function m({duration:T}={}){const z=Date.now(),G=T?z-T:null;u("loading");const F=await d({maxCreatedAt:G}),fe=`${_t()}-${Ys()}`;try{await Ve.catchup.set(fe,{id:fe,posts:F,count:F.length,startAt:G,endAt:z}),a({id:fe})}catch{}}j(()=>{o?(async()=>{const T=await Ve.catchup.get(o);T&&(h(T.posts),u("results"))})():i==="results"&&(h([]),u("start"))},[o]);const[v,g]=kt(T=>T+1,0),[y,I]=$(null),[S,C]=$([]);j(()=>{(async()=>{try{const T=await Ve.catchup.keys();if(T.length){const z=_t(),G=T.filter(F=>F.startsWith(`${z}-`));if(G.length){let F=await Ve.catchup.getMany(G);F.sort((re,R)=>R.endAt-re.endAt);let K=F.slice(0,3),fe=F.slice(3);const he=K.map(re=>{const{id:R,count:V,startAt:te,endAt:M}=re;return{id:R,count:V,startAt:te,endAt:M}});C(he),I(K[0].endAt),F=null,K=null,queueMicrotask(()=>{fe.length&&Ve.catchup.delMany(fe.map(re=>re.id)).then(()=>{fe=null}).catch(re=>{})});return}}}catch{}C([])})()},[v]),j(()=>{i==="start"&&g()},[i==="start"]);const[A,_]=me(()=>{var R,V,te,M,ae;let T=0,z=0,G=0,F=0,K=0,fe=0;const he={};for(const Y of f){Y._filtered?(T++,Y.__FILTER="filtered"):Y.group?(z++,Y.__FILTER="group"):Y.reblog?(G++,Y.__FILTER="boost"):(R=Y._followedTags)!=null&&R.length?(K++,Y.__FILTER="followedTags"):Y.inReplyToId&&Y.inReplyToAccountId!==((V=Y.account)==null?void 0:V.id)?(F++,Y.__FILTER="reply"):(fe++,Y.__FILTER="original");const Z=Y.reblog||Y;if((te=Z.card)!=null&&te.url&&((M=Z.card)!=null&&M.image)&&((ae=Z.card)==null?void 0:ae.type)==="link"){const{card:Ae,favouritesCount:Ne,reblogsCount:we}=Z;let{url:ve}=Ae;if(ve=ve.replace(/\/$/,""),!he[ve])he[ve]={postID:Z.id,card:Ae,shared:1,sharers:[Y.account],likes:Ne,boosts:we};else{if(he[ve].sharers.find(De=>De.id===Y.account.id))continue;he[ve].shared++,he[ve].sharers.push(Y.account),he[ve].postID!==Z.id&&(he[ve].likes+=Ne,he[ve].boosts+=we)}}}let re=[];for(const Y in he)re.push({url:Y,...he[Y]});if(re.sort((Y,Z)=>Y.shared>Z.shared?-1:Y.shared<Z.shared?1:Y.boosts>Z.boosts?-1:Y.boosts<Z.boosts?1:Y.likes>Z.likes?-1:Y.likes<Z.likes?1:0),re.length>10)e:for(let Y=10;Y<re.length;Y++){const{shared:Z}=re[Y];if(Z<=1){re=re.slice(0,Y);break e}}return[{Filtered:T,Groups:z,Boosts:G,Replies:F,"Followed tags":K,Original:fe},re]},[f]),[q,B]=$("All"),[P,D]=$(null),[L,N]=$(1),E=[{label:"last 1 hour",value:1},{label:"last 2 hours",value:2},{label:"last 3 hours",value:3},{label:"last 4 hours",value:4},{label:"last 5 hours",value:5},{label:"last 6 hours",value:6},{label:"last 7 hours",value:7},{label:"last 8 hours",value:8},{label:"last 9 hours",value:9},{label:"last 10 hours",value:10},{label:"last 11 hours",value:11},{label:"last 12 hours",value:12},{label:"beyond 12 hours",value:13}],[J,H]=$("createdAt"),[oe,ie]=$("asc"),[be,Se]=$(null),[ee,U,X]=me(()=>{let T=[];const z={};let G=f.filter(K=>q==="All"||K.__FILTER==={Filtered:"filtered",Groups:"group",Boosts:"boost",Replies:"reply","Followed tags":"followedTags",Original:"original"}[q]);G.forEach(K=>{T.find(fe=>fe.id===K.account.id)||T.push(K.account),z[K.account.id]=(z[K.account.id]||0)+1}),P&&z[P]&&(G=G.filter(K=>K.account.id===P));const F={};for(const K of T)F[K.id]=K;return[G,F,z]},[q,P,f]),ne=me(()=>Object.keys(X).sort((T,z)=>X[z]-X[T]),[X]),ge=me(()=>{const T={};return ne.forEach((z,G)=>{T[z]=G}),ee.sort((z,G)=>{if(be==="account"){const F=z.account.id,K=G.account.id,fe=T[F],he=T[K],re=fe-he;if(re!==0)return re}return J!=="createdAt"&&(z=z.reblog||z,G=G.reblog||G,z[J]===G[J])?z.createdAt>G.createdAt?1:-1:oe==="asc"?z[J]>G[J]?1:-1:G[J]>z[J]?1:-1})},[ee,J,oe,be,ne]),ye=O(null),ke=O(null);j(()=>{ke.current&&ne.length<30&&Ws(ke.current,{duration:200})},[q,ne,ke]);const $e=me(()=>f.map(T=>{const z=ee.find(G=>G.id===T.id);return e("span",{class:`post-dot ${z?"post-dot-highlight":""}`},T.id)}),[f,ee]),Ie=O(null),Q=O(null);hs({scrollableRef:Ie},({scrollDirection:T,nearReachStart:z})=>{if(Q.current){const G=T==="end"&&!z;Q.current.hidden=G}},[]);const ce=me(()=>y?(Date.now()-y)/1e3/60/60:null,[y,L]);return e("div",{ref:Ie,id:"catchup-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck wide",children:[e("header",{ref:Q,class:`${i==="loading"?"loading":""}`,onClick:T=>{var z;T.target.closest("a, button")||(z=Ie.current)==null||z.scrollTo({top:0,behavior:"smooth"})},children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(gt,{}),e(se,{to:"/",class:"button plain home-button",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:i!=="start"&&e(x,{children:["Catch-up ",e("sup",{children:"beta"})]})}),e("div",{class:"header-side",children:i!=="start"&&i!=="loading"&&e("button",{type:"button",class:"plain",onClick:()=>{a({})},children:"Start over"})})]})}),e("main",{children:[i==="start"&&e("div",{class:"catchup-start",children:[e("h1",{children:["Catch-up ",e("sup",{children:"beta"})]}),e("p",{children:"Let's catch up on the posts from your followings."}),e("p",{children:e("b",{children:"Show me all posts from…"})}),e("div",{class:"catchup-form",children:[e("input",{ref:b,type:"range",value:L,min:E[0].value,max:E[E.length-1].value,step:"1",list:"catchup-ranges",onChange:T=>N(+T.target.value)})," ",e("span",{style:{width:"8em"},children:[E[L-1].label,e("br",{}),e("small",{class:"insignificant",children:L==E[E.length-1].value?"until the max":Xe(new Date(Date.now()-L*60*60*1e3))})]}),e("datalist",{id:"catchup-ranges",children:E.map(({label:T,value:z})=>e("option",{value:z,label:T}))})," ",e("button",{type:"button",onClick:()=>{if(L<E[E.length-1].value){const T=L*60*60*1e3;m({duration:T})}else m()},children:"Catch up"})]}),ce&&L>ce&&e("p",{class:"catchup-info",children:[e(w,{icon:"info"})," Overlaps with your last catch-up"]}),e("p",{class:"insignificant",children:e("small",{children:"Note: your instance might only show a maximum of 800 posts in the Home timeline regardless of the time range. Could be less or more."})}),!!(S!=null&&S.length)&&e("div",{class:"catchup-prev",children:[e("p",{children:"Previously…"}),e("ul",{children:S.map(T=>e("li",{children:[e(se,{to:`/catchup?id=${T.id}`,children:[e(w,{icon:"history"})," ",e("span",{children:[En(new Date(T.startAt),new Date(T.endAt))," ",e("small",{class:"ib insignificant",children:[T.count," posts"]})]})]})," ",e("button",{type:"button",class:"light danger small",onClick:async()=>{var G;if(confirm("Remove this catch-up?")){let F=ue(`Removing Catch-up ${T.id}`);await Ve.catchup.del(T.id),(G=F==null?void 0:F.hideToast)==null||G.call(F),ue(`Catch-up ${T.id} removed`),g()}},children:e(w,{icon:"x"})})]},T.id))}),S.length>=3&&e("p",{children:e("small",{children:"Note: Only max 3 will be stored. The rest will be automatically removed."})})]})]}),i==="loading"&&e("div",{class:"ui-state catchup-start",children:[e(Ce,{abrupt:!0}),e("p",{class:"insignificant",children:"Fetching posts…"}),e("p",{class:"insignificant",children:"This might take a while."})]}),i==="results"&&e(x,{children:[e("div",{class:"catchup-header",children:[f.length>0&&e("p",{children:e("b",{class:"ib",children:En(new Date(f[f.length-1].createdAt),new Date(f[0].createdAt))})}),e("aside",{children:[e("button",{hidden:q==="All"&&!P&&J==="createdAt"&&oe==="asc",type:"button",class:"plain4 small",onClick:()=>{B("All"),D(null),H("createdAt"),Se(null),ie("asc")},children:"Reset filters"}),(_==null?void 0:_.length)>0&&e("button",{type:"button",class:"plain small",onClick:()=>c(!r),children:["Top links"," ",e(w,{icon:"chevron-down",style:{transform:r?"rotate(180deg)":"rotate(0deg)"}})]})]})]}),e("div",{class:"shazam-container no-animation",hidden:!r,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"catchup-top-links links-bar",children:_.map(T=>{const{card:z,shared:G,sharers:F,likes:K,boosts:fe}=T,{blurhash:he,title:re,description:R,url:V,image:te,imageDescription:M,language:ae,width:Y,height:Z,publishedAt:Ae}=z,Ne=new URL(V).hostname.replace(/^www\./,"").replace(/\/$/,"");let we;if(he){const ve=Jt(he),De=sn(ve);we=on([.6,De[1],De[2]])}return e("a",{href:V,target:"_blank",rel:"noopener noreferrer",style:we?{"--accent-color":`rgb(${we.join(",")})`,"--accent-alpha-color":`rgba(${we.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:te,alt:M,width:Y,height:Z,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:Ne})," ",!!Ae&&e(x,{children:"· "}),!!Ae&&e(x,{children:e(pt,{datetime:Ae,format:"micro"})})]}),!!re&&e("h1",{class:"title",lang:ae,dir:"auto",children:re})]}),!!R&&e("p",{class:"description",lang:ae,dir:"auto",children:R}),e("hr",{}),e("p",{style:{whiteSpace:"nowrap"},children:["Shared by"," ",F.map(ve=>{const{avatarStatic:De,displayName:xe}=ve;return e(Ze,{url:De,size:"s",alt:xe})})]})]})]})},V)})})})}),f.length>=5&&e("div",{class:"catchup-posts-viz-bar",children:$e}),f.length>=2&&e("div",{class:"catchup-filters",children:[e("label",{class:"filter-cat",children:[e("input",{type:"radio",name:"filter-cat",checked:q.toLowerCase()==="all",onChange:()=>{B("All")}}),"All ",e("span",{class:"count",children:f.length})]}),["Original","Replies","Boosts","Followed tags","Groups","Filtered"].map(T=>!!A[T]&&e("label",{class:"filter-cat",children:[e("input",{type:"radio",name:"filter-cat",checked:q.toLowerCase()===T.toLowerCase(),onChange:()=>{B(T)}}),T," ",e("span",{class:"count",children:A[T]})]},T))]}),f.length>=2&&!!X&&e("div",{class:"catchup-filters authors-filters",ref:ke,children:[ne.map(T=>e("label",{class:"filter-author",children:[e("input",{type:"radio",name:"filter-author",checked:P===T,onChange:()=>{D(T)},onClick:()=>{P===T&&D(null)}}),e(Ze,{url:U[T].avatarStatic||U[T].avatar,size:"xxl"})," ",e("span",{class:"count",children:X[T]}),e("span",{class:"username",children:U[T].username})]},`${T}-${X[T]}`)),ne.length>5&&e("small",{style:{whiteSpace:"nowrap",paddingInline:"1em",opacity:.33},children:[ne.length," authors"]},"authors-count")]}),f.length>=2&&e("div",{class:"catchup-filters",children:[e("span",{class:"filter-label",children:"Sort"})," ",e("fieldset",{class:"radio-field-group",children:["createdAt","repliesCount","favouritesCount","reblogsCount"].map(T=>e("label",{class:"filter-sort",children:[e("input",{type:"radio",name:"filter-sort-cat",checked:J===T,onChange:()=>{H(T);const z=/(replies|favourites|reblogs)/.test(T)?"desc":"asc";ie(z)}}),{createdAt:"Date",repliesCount:"Replies",favouritesCount:"Likes",reblogsCount:"Boosts"}[T]]},T))}),e("fieldset",{class:"radio-field-group",children:["asc","desc"].map(T=>e("label",{class:"filter-sort",children:[e("input",{type:"radio",name:"filter-sort-dir",checked:oe===T,onChange:()=>{ie(T)}}),T==="asc"?"↑":"↓"]},T))}),e("span",{class:"filter-label",children:"Group"})," ",e("fieldset",{class:"radio-field-group",children:[null,"account"].map(T=>e("label",{class:"filter-group",children:[e("input",{type:"radio",name:"filter-group",checked:be===T,onChange:()=>{Se(T)},disabled:T==="account"&&P}),{account:"Authors"}[T]||"None"]},T||"none"))}),P&&ne.length>1?e("button",{type:"button",class:"plain small",onClick:()=>{D(null)},style:{whiteSpace:"nowrap"},children:"Show all authors"}):null]}),e("ul",{class:"catchup-list",children:ge.map((T,z)=>{var K;const G=((K=T.reblog)==null?void 0:K.id)||T.id;let F=!1;return be==="account"&&(ye.current&&T.account.id!==ye.current&&z>0&&(F=!0),ye.current=T.account.id),e(x,{children:[F&&e("li",{class:"separator"}),e("li",{children:e(se,{to:`/${n}/s/${G}`,children:e(Ao,{post:T,root:Ie.current})})})]},`${T.id}-${F}`)})}),e("footer",{children:ee.length>5&&e("p",{children:[q==="Boosts"?"You don't have to read everything.":"That's all."," ",e("button",{type:"button",class:"textual",onClick:()=>{Ie.current.scrollTop=0},children:"Back to top"}),"."]})})]})]})]})})}const $o=Be(function({post:t}){const{id:n,account:s,group:a,reblog:o,inReplyToId:i,inReplyToAccountId:u,_followedTags:r,_filtered:c,visibility:l}=t,p=i&&u!==s.id,d=!!c,f=h=>{h.shiftKey};return e("article",{class:`post-line ${a?"group":o?"reblog":r!=null&&r.length?"followed-tags":""} ${p?"reply-to":""} ${d?"filtered":""} visibility-${l}`,onMouseEnter:f,children:[e("span",{class:"post-author",children:o?e("span",{class:"post-reblog-avatar",children:[e(Ze,{url:s.avatarStatic||s.avatar,squircle:s.bot})," ",e(w,{icon:"rocket"})," ",e(dt,{account:o.account,showAvatar:!0})]}):e(dt,{account:s,showAvatar:!0})}),e(xo,{post:o||t,filterInfo:c}),e("span",{class:"post-meta",children:[e(Ro,{post:o||t})," ",e(pt,{datetime:new Date((o==null?void 0:o.createdAt)||t.createdAt),format:"micro"})]})]})},(t,n)=>{var s,a;return((s=t==null?void 0:t.post)==null?void 0:s.id)===((a=n==null?void 0:n.post)==null?void 0:a.id)}),Ao=({root:t,...n})=>{const s=O(),[a,o]=$(!1);return j(()=>{const i=new IntersectionObserver(u=>{u[0].isIntersecting&&(queueMicrotask(()=>o(!0)),i.unobserve(s.current))},{root:t,rootMargin:`${Math.max(320,screen.height*.75)}px`});return s.current&&i.observe(s.current),()=>{s.current&&i.unobserve(s.current)}},[]),a?e($o,{...n}):e("div",{ref:s,style:{height:"4em"}})},nt=48;function xo({post:t,filterInfo:n}){const{spoilerText:s,sensitive:a,content:o,emojis:i,poll:u,mediaAttachments:r,card:c,inReplyToId:l,inReplyToAccountId:p,account:d,_thread:f}=t,h=l&&p===d.id||!!f,b=!s&&!a,m=o?Ht(o):"";return e("div",{class:"post-peek",title:s?"":m,children:[e("span",{class:"post-peek-content",children:n?e(x,{children:[h&&e(x,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-filtered",children:["Filtered",n!=null&&n.titlesStr?`: ${n.titlesStr}`:""]})]}):s?e(x,{children:[h&&e(x,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),e("span",{class:"post-peek-spoiler",children:[e(w,{icon:"eye-close"})," ",s]})]}):e("div",{class:"post-peek-html",children:[h&&e(x,{children:[e("span",{class:"post-peek-tag post-peek-thread",children:"Thread"})," "]}),o?e("div",{dangerouslySetInnerHTML:{__html:Ns(o,i)}}):(r==null?void 0:r.length)===1&&r[0].description?e(x,{children:[e("span",{class:"post-peek-tag post-peek-alt",children:"ALT"})," ",e("div",{children:r[0].description})]}):null]})}),!n&&e("span",{class:"post-peek-post-content",children:[!!u&&e("span",{class:"post-peek-tag post-peek-poll",children:[e(w,{icon:"poll",size:"s"}),"Poll"]}),r!=null&&r.length?r.map(v=>e("span",{class:"post-peek-media",children:{image:(v.previewUrl||v.url)&&b?e("img",{src:v.previewUrl||v.url,width:nt,height:nt,alt:v.description,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"🖼"}),gifv:v.previewUrl&&b?e("img",{src:v.previewUrl,width:nt,height:nt,alt:v.description,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"🎞️"}),video:v.previewUrl&&b?e("img",{src:v.previewUrl,width:nt,height:nt,alt:v.description,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"📹"}),audio:e("span",{class:"post-peek-faux-media",children:"🎵"})}[v.type]||null},v.id)):!!c&&c.image&&b&&e("span",{class:`post-peek-media post-peek-card card-${c.type||""}`,children:c.image?e("img",{src:c.image,width:nt,height:nt,alt:c.title||c.description||c.imageDescription,loading:"lazy"}):e("span",{class:"post-peek-faux-media",children:"🔗"})})]})]})}function Ro({post:t}){const{reblogsCount:n,repliesCount:s,favouritesCount:a}=t;return e("span",{class:"post-stats",children:[s>0&&e(x,{children:[e(w,{icon:"comment2",size:"s"})," ",Oe(s)]}),a>0&&e(x,{children:[e(w,{icon:"heart",size:"s"})," ",Oe(a)]}),n>0&&e(x,{children:[e(w,{icon:"rocket",size:"s"})," ",Oe(n)]})]})}const{locale:Lo}=new Intl.DateTimeFormat().resolvedOptions(),_o=new Intl.DateTimeFormat(Lo,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"});function En(t,n){return _o.formatRange(t,n)}const Eo=20;function fs(){Pe("Likes","/f");const{masto:t,instance:n}=W(),s=O();async function a(o){return(o||!s.current)&&(s.current=t.v1.favourites.list({limit:Eo})),await s.current.next()}return e(tt,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:a})}function Mo(){const{masto:t,instance:n}=W();Pe("Followed Hashtags","/ft");const[s,a]=$("default"),[o,i]=$([]);return j(()=>{a("loading"),(async()=>{try{const u=await Mt();i(u),a("default")}catch{a("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(gt,{}),e(se,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:o.length>0?e(x,{children:[e("ul",{class:"link-list",children:o.map(u=>e("li",{children:e(se,{to:n?`/${n}/t/${u.name}`:`/t/${u.name}`,children:[e(w,{icon:"hashtag"})," ",e("span",{children:u.name})]})}))}),o.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[o.length," hashtag",o.length===1?"":"s"]})})]}):s==="loading"?e("p",{class:"ui-state",children:e(Ce,{abrupt:!0})}):s==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const Po=20;function rn({title:t,path:n,id:s,...a}){Pe(t||"Following",n||"/following");const{masto:o,streaming:i,instance:u}=W(),r=Te(k),c=O(),l=O();async function p(f){(f||!c.current)&&(c.current=o.v1.timelines.home.list({limit:Po}));const h=await c.current.next();let{value:b}=h;if(b!=null&&b.length){let m=!1;f&&(b[0].id!==l.current&&(m=!0),l.current=b[0].id),b.forEach(v=>{Ee(v,u)}),b=Rn(b,u),f&&m&&lo(),us(b,u),b.sort((v,g)=>{const y=new Date(v.createdAt);return new Date(g.createdAt)-y})}return{...h,value:b}}async function d(){try{const f=await o.v1.timelines.home.list({limit:5,since_id:l.current}).next();let{value:h}=f;return!!(h!=null&&h.length&&(l.current=h[0].id,h=Rn(h,u),h=ft(h,"home"),h.some(b=>!b.reblog)))}catch{return!1}}return j(()=>{let f;return(async()=>{if(i){f=i.user.subscribe();for await(const h of f){if(!f)break;if(h.event==="status.update"){const b=h.payload;Ee(b,u)}else if(h.event==="delete"){const b=h.payload,m=Xn(b,u);m&&(m._deleted=!0)}}}})(),()=>{var h;(h=f==null?void 0:f.unsubscribe)==null||h.call(f),f=null}},[i]),e(tt,{title:t||"Following",id:s||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:u,fetchItems:p,checkForUpdates:d,useItemID:!0,boostsCarousel:r.settings.boostsCarousel,...a,filterContext:"home",showFollowedTags:!0,showReplyParent:!0})}const No=20,Do=4,Mn=Do+1;function ms({media:t,columnMode:n,...s}){let{hashtag:a,...o}=n?{}:at();s.hashtag&&(a=s.hashtag);let i=a.trim().split(/[\s+]+/);i.sort(),a=i[0];const[u,r]=Ye(),c=t||!!u.get("media"),l=c?"?media=1":"",{masto:p,instance:d,authenticated:f}=W({instance:(s==null?void 0:s.instance)||o.instance}),{masto:h,instance:b,authenticated:m}=W(),v=i.map(L=>`#${L}`).join(" "),g=c?" (Media only)":"",y=d?`${v}${g} on ${d}`:`${v}${g}`;Pe(y,"/:instance?/t/:hashtag");const I=O(),S=O(void 0);async function C(L){const N=await p.v1.timelines.tag.$select(a).list({limit:No,any:i.slice(1),maxId:L?void 0:S.current,onlyMedia:c}).next();let{value:E}=N;return E!=null&&E.length&&(L&&(I.current=E[0].id),E.forEach(J=>{Ee(J,d,{skipThreading:c})}),S.current=E[E.length-1].id),{...N,value:E}}async function A(){try{const L=await p.v1.timelines.tag.$select(a).list({limit:1,any:i.slice(1),since_id:I.current,onlyMedia:c}).next();let{value:N}=L;return N=ft(N,"public"),!!(N!=null&&N.length)}catch{return!1}}const[_,q]=$("default"),[B,P]=$();j(()=>{(async()=>{try{const L=await p.v1.tags.$select(a).fetch();P(L)}catch{}})()},[a]);const D=i.length>=Mn;return e(tt,{title:y,titleComponent:!!d&&e("h1",{class:"header-double-lines",children:[e("b",{children:v}),e("div",{children:d})]}),id:"hashtag",instance:d,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:C,checkForUpdates:A,useItemID:!0,view:c?"media":void 0,refresh:c,filterContext:"public",headerEnd:e(je,{portal:!0,setDownOverflow:!0,overflow:"auto",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[!!B&&i.length===1&&e(x,{children:[e(Je,{subMenu:!0,confirm:B.following,confirmLabel:`Unfollow #${a}?`,disabled:_==="loading"||!f,onClick:()=>{q("loading"),B.following?p.v1.tags.$select(a).unfollow().then(()=>{P({...B,following:!1}),ue(`Unfollowed #${a}`)}).catch(L=>{alert(L)}).finally(()=>{q("default")}):p.v1.tags.$select(a).follow().then(()=>{P({...B,following:!0}),ue(`Followed #${a}`)}).catch(L=>{alert(L)}).finally(()=>{q("default")})},children:B.following?e(x,{children:[e(w,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(x,{children:[e(w,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(ze,{})]}),e(ns,{className:"plain",children:"Filters"}),e(pe,{type:"checkbox",checked:!!c,onClick:()=>{c?u.delete("media"):u.set("media","1"),r(u)},children:[e(w,{icon:"check-circle"})," ",e("span",{class:"menu-grow",children:"Media only"})]}),e(ze,{}),e(Ks,{className:"menu-field",disabled:D,children:({ref:L})=>e("form",{onSubmit:N=>{var J,H;N.preventDefault();const E=(H=(J=N.target[0].value)==null?void 0:J.trim)==null?void 0:H.call(J);E&&!i.some(oe=>oe.toLowerCase()===E.toLowerCase())&&(i.push(E),i.sort(),location.hash=d?`/${d}/t/${i.join("+")}`:`/t/${i.join("+")}${l}`)},children:[e(w,{icon:"hashtag"}),e("input",{ref:L,type:"text",placeholder:D?`Max ${Mn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:D})]})}),e(Zs,{takeOverflow:!0,children:i.map((L,N)=>e(pe,{disabled:i.length===1,onClick:E=>{i.splice(N,1),i.sort(),location.hash=d?`/${d}/t/${i.join("+")}${l}`:`/t/${i.join("+")}${l}`},children:[e(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),L]})]},L))}),e(ze,{}),e(pe,{disabled:!m,onClick:()=>{if(k.shortcuts.length>=st){alert(`Max ${st} shortcuts reached. Unable to add shortcut.`);return}const L={type:"hashtag",hashtag:i.join(" "),instance:d,media:c?"on":void 0};k.shortcuts.some(E=>E.type===L.type&&E.hashtag.split(/[\s+]+/).sort().join(" ")===L.hashtag.split(/[\s+]+/).sort().join(" ")&&(E.instance?E.instance===L.instance:!0)&&(E.media?!!E.media==!!L.media:!0))?alert("This shortcut already exists"):(k.shortcuts.push(L),ue("Hashtag shortcut added"))},children:[e(w,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(pe,{onClick:()=>{let L=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(L)){L&&alert("Invalid instance");return}L&&(L=L.toLowerCase().trim(),location.hash=`/${L}/t/${i.join("+")}${l}`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),b!==d&&e(pe,{onClick:()=>{location.hash=`/${b}/t/${i.join("+")}${l}`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:b}),")"]})]})]})},d+v)}const Uo=20;function gs(t){var m;const n=Te(k),{masto:s,instance:a}=W(),o=(t==null?void 0:t.id)||((m=at())==null?void 0:m.id),i=O(),u=O();async function r(v){(v||!u.current)&&(u.current=s.v1.timelines.list.$select(o).list({limit:Uo}));const g=await u.current.next();let{value:y}=g;return y!=null&&y.length&&(v&&(i.current=y[0].id),y.forEach(I=>{Ee(I,a)})),{...g,value:y}}async function c(){try{const v=await s.v1.timelines.list.$select(o).list({limit:1,since_id:i.current});let{value:g}=v;return g=ft(g,"home"),!!(g!=null&&g.length)}catch{return!1}}const[l,p]=$({title:"List"});Pe(l.title,"/l/:id"),j(()=>{(async()=>{try{const v=await s.v1.lists.$select(o).fetch();p(v)}catch{}})()},[o]);const[d,f]=$(!1),[h,b]=$(!1);return e(x,{children:[e(tt,{title:l.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:a,fetchItems:r,checkForUpdates:c,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",showReplyParent:!0,headerStart:e(se,{to:"/l",class:"button plain",children:e(w,{icon:"list",size:"l"})}),headerEnd:e(je,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(pe,{onClick:()=>f({list:l}),children:[e(w,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(pe,{onClick:()=>b(!0),children:[e(w,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},o),d&&e(Re,{class:"light",onClick:v=>{v.target===v.currentTarget&&f(!1)},children:e(tn,{list:d==null?void 0:d.list,onClose:v=>{v.state==="success"&&v.list?p(v.list):v.state==="deleted"&&(location.hash="/l"),f(!1)}})}),h&&e(Re,{class:"light",onClick:v=>{v.target===v.currentTarget&&b(!1)},children:e(Oo,{listID:o,onClose:()=>b(!1)})})]})}const Fo=40;function Oo({listID:t,onClose:n}){const{masto:s,instance:a}=W(),[o,i]=$([]),[u,r]=$("default"),[c,l]=$(!1),p=O();async function d(f){l(!1),r("loading"),(async()=>{try{(f||!p.current)&&(p.current=s.v1.lists.$select(t).accounts.list({limit:Fo}));const h=await p.current.next();let{done:b,value:m}=h;m!=null&&m.length?(i(f?m:o.concat(m)),l(!b)):l(!1),r("default")}catch{r("error")}})()}return j(()=>{d(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(w,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[o.map(f=>e("li",{children:[e(We,{account:f,instance:a}),e(zo,{account:f,listID:t})]},f.id)),c&&u==="default"&&e(Qe,{as:"li",onChange:f=>f&&d(),children:e("button",{type:"button",class:"light block",onClick:d,children:"Show more…"})})]})})]})}function zo({account:t,listID:n}){const{masto:s}=W(),[a,o]=$("default"),[i,u]=$(!1);return e(Je,{confirm:!i,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{i?(o("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),o("default"),u(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await s.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),o("default"),u(!0)}catch{o("error")}})())},children:e("button",{type:"button",class:`light ${i?"":"danger"}`,disabled:a==="loading",children:i?"Add":"Remove…"})})}const Pn=20,Bo=new URLSearchParams;function bs({columnMode:t,...n}){const{masto:s,instance:a}=W(),[o]=t?[Bo]:Ye(),[i,u]=$(null),r=(n==null?void 0:n.type)||o.get("type")||i;Pe(`Mentions${r==="private"?" (Private)":""}`,"/mentions");const c=O(),l=O();async function p(g){(g||!c.current)&&(c.current=s.v1.notifications.list({limit:Pn,types:["mention"]}));const y=await c.current.next();let{value:I}=y;return I!=null&&I.length&&(g&&(l.current=I[0].id),I.forEach(({status:S})=>{Ee(S,a)})),{...y,value:I==null?void 0:I.map(S=>S.status)}}const d=O(),f=O();async function h(g){(g||!d.current)&&(d.current=s.v1.conversations.list({limit:Pn}));const y=await d.current.next();let{value:I}=y;return I=I==null?void 0:I.filter(S=>S.lastStatus),I!=null&&I.length&&(g&&(f.current=I[0].lastStatus.id),I.forEach(({lastStatus:S})=>{Ee(S,a)})),{...y,value:I==null?void 0:I.map(S=>S.lastStatus)}}function b(...g){return r==="private"?h(...g):p(...g)}async function m(){if(r==="private")try{const g=await s.v1.conversations.list({limit:1,since_id:f.current}).next();let{value:y}=g;return y!=null&&y.length?(f.current=y[0].lastStatus.id,!0):!1}catch{return!1}else try{const g=await s.v1.notifications.list({limit:1,types:["mention"],since_id:l.current}).next();let{value:y}=g;return y!=null&&y.length?(l.current=y[0].id,!0):!1}catch{return!1}}const v=me(()=>e("div",{class:"filter-bar centered",children:[e(se,{to:"/mentions",class:r?"":"is-active",onClick:g=>{t&&(g.preventDefault(),u(null))},children:"All"}),e(se,{to:"/mentions?type=private",class:r==="private"?"is-active":"",onClick:g=>{t&&(g.preventDefault(),u("private"))},children:"Private"})]}),[r]);return e(tt,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:a,fetchItems:b,checkForUpdates:m,useItemID:!0,timelineStart:v,refresh:r})}const qo={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function Ho(t){return t.filter(n=>{const{type:s,id:a,createdAt:o}=n;if(!s)return!1;const i=qo[s];return i!=null&&i.length?i.every(u=>!!n[u]):!0})}function ys(t){t=Ho(t);const n={},s=[];for(let i=0,u=0;i<t.length;i++){const r=t[i],{id:c,status:l,account:p,type:d,createdAt:f}=r,h=f?new Date(f).toLocaleDateString():"";let b=d;(d==="favourite"||d==="reblog")&&(b="favourite+reblog");const m=`${l==null?void 0:l.id}-${b}-${h}`,v=n[m];if(b==="follow_request")s[u++]=r;else if(v!=null&&v.account){const g=v._accounts.find(y=>y.id===p.id);g?(g._types.push(d),g._types.sort().reverse(),v.id+=`-${c}`):(p._types=[d],v._accounts.push(p),v.id+=`-${c}`)}else{p._types=[d];let g=n[m]={...r,type:b,_accounts:[p]};s[u++]=g}}const a={},o=[];for(let i=0,u=0;i<s.length;i++){const r=s[i],{id:c,account:l,_accounts:p,type:d,createdAt:f}=r,h=f?new Date(f).toLocaleDateString():"";if(d==="favourite+reblog"&&l&&p.length===1){const b=`${l==null?void 0:l.id}-${d}-${h}`,m=a[b];if(m)m._statuses.push(r.status),m.id+=`-${c}`;else{let v=a[b]={...r,type:d,_statuses:[r.status]};o[u++]=v}}else o[u++]=r}return o}const Vo=30,Go=new URLSearchParams;function jo({columnMode:t}){Pe("Notifications","/notifications");const{masto:n,instance:s}=W(),a=Te(k),[o,i]=$("default"),[u]=t?[Go]:Ye(),r=u.get("id"),c=u.get("access_token"),[l,p]=$(!1),[d,f]=$(!1),h=O(),{nearReachEnd:b,scrollDirection:m,reachStart:v,nearReachStart:g}=uo({scrollableRef:h}),y=m==="end"&&!g,[I,S]=$([]),[C,A]=$([]),_=O();async function q(U){(U||!_.current)&&(_.current=n.v1.notifications.list({limit:Vo,excludeTypes:["follow_request"]}));const X=await _.current.next(),ne=X.value;if(ne!=null&&ne.length){ne.forEach(ye=>{Ee(ye.status,s,{skipThreading:!0})});const ge=ys(ne);U?(k.notificationsLast=ne[0],k.notifications=ge,n.v1.markers.create({notifications:{lastReadId:ne[0].id}}).catch(()=>{})):k.notifications.push(...ge)}return k.notificationsShowNew=!1,k.notificationsLastFetchTime=Date.now(),X}async function B(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const P=()=>{i("loading"),(async()=>{try{const U=await B();S(U),i("default")}catch{i("error")}})()};async function D(){try{return await n.v1.announcements.list()}catch{return[]}}const L=U=>{E(!1),i("loading"),(async()=>{try{const X=q(U);U&&(D().then(ge=>{ge.sort((ye,ke)=>{const $e=new Date(ye.updatedAt||ye.createdAt);return new Date(ke.updatedAt||ke.createdAt)-$e}),A(ge)}).catch(()=>{}),B().then(ge=>{S(ge)}).catch(()=>{}));const{done:ne}=await X;p(!ne),i("default")}catch{i("error")}})()};j(()=>{L(!0)},[]),j(()=>{v&&L(!0)},[v]);const[N,E]=$(!1),J=Ke(({disableIdleCheck:U=!1}={})=>{var X;o!=="loading"&&a.settings.autoRefresh&&((X=h.current)==null?void 0:X.scrollTop)<16&&(U||window.__IDLE__)&&!Yo()&&L(!0)},[a.notificationsShowNew,a.settings.autoRefresh,o]),H=O();ht(U=>{let X;if(U){const ne=Date.now()-H.current;!H.current||ne>1e3*3?J({disableIdleCheck:!0}):H.current=Date.now(),X=Js(k,"notificationsShowNew",ge=>{ge&&J(),E(ge)})}return()=>{X==null||X()}});const oe=new Date,ie=new Date(oe-24*60*60*1e3);let be=new Date;const Se=!a.notifications.some(U=>new Date(U.createdAt).toDateString()===oe.toDateString()),ee=O();return j(()=>{r&&(k.routeNotification={id:r,accessToken:atob(c)})},[r,c]),e("div",{id:"notifications-page",class:"deck-container",ref:h,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${d?"only-mentions":""}`,children:[e("header",{hidden:y,onClick:U=>{var X;U.target.closest("a, button")||(X=h.current)==null||X.scrollTo({top:0,behavior:"smooth"})},onDblClick:U=>{U.target.closest("a, button")||L(!0)},class:o==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(gt,{}),e(se,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),N&&o!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var U;L(!0),(U=h.current)==null||U.scrollTo({top:0,behavior:"smooth"})},children:[e(w,{icon:"arrow-up"})," New notifications"]})]}),C.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",C.length>1?"s":""]})," ",e("small",{class:"insignificant",children:s})]}),C.length>1&&e("span",{class:"announcements-nav-buttons",children:C.map((U,X)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var ne;(ne=ee.current)==null||ne.children[X].scrollIntoView({behavior:"smooth",block:"nearest"})},children:X+1}))})]}),e("ul",{class:`announcements-list-${C.length>1?"multiple":"single"}`,ref:ee,children:C.map(U=>e("li",{children:e(Wo,{announcement:U})}))})]})})}),I.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),I.length>5?e("details",{children:[e("summary",{children:[I.length," follow requests"]}),e("ul",{children:I.map(U=>e("li",{children:[e(We,{account:U}),e(jt,{accountID:U.id,onChange:()=>{}})]},U.id))})]}):e("ul",{children:I.map(U=>e("li",{children:[e(We,{account:U}),e(jt,{accountID:U.id,onChange:()=>{}})]},U.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:d,onChange:U=>{f(U.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),Se&&!!a.notifications.length&&e("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":e(x,{children:"…"})}),a.notifications.length?e(x,{children:a.notifications.filter(U=>U.type!=="follow_request").map(U=>{if(d&&U.type!=="mention")return null;const X=new Date(U.createdAt),ne=X.toDateString()!==be.toDateString();ne&&(be=X);const ge=X.toDateString()===ie.toDateString()?"Yesterday":Xe(be,{hideTime:!0});return e(x,{children:[ne&&e("h2",{class:"timeline-header",children:ge}),e(an,{instance:s,notification:U},U.id)]},U.id)})}):e(x,{children:[o==="loading"&&e(x,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((U,X)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(w,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),o==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>L(!0),children:"Try again"})]})]}),l&&e(Qe,{onChange:U=>{U&&L()},children:e("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>L(),style:{marginBlockEnd:"6em"},children:o==="loading"?e(Ce,{abrupt:!0}):e(x,{children:"Show more…"})})})]})})}function Yo(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Wo({announcement:t}){const{instance:n}=W(),{contact:s}=Kn(),a=s==null?void 0:s.account,{id:o,content:i,startsAt:u,endsAt:r,published:c,allDay:l,publishedAt:p,updatedAt:d,read:f,mentions:h,statuses:b,tags:m,emojis:v,reactions:g}=t,y=new Date(p),I=Xe(y),S=new Date(d),C=Xe(S);return e("div",{class:"announcement-block",children:[e(We,{account:a}),e("div",{class:"announcement-content",onClick:Gn({mentions:h,instance:n}),dangerouslySetInnerHTML:{__html:qt(i,{emojis:v})}}),e("p",{class:"insignificant",children:[e("time",{datetime:y.toISOString(),children:Xe(y)}),d&&C!==I&&e(x,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:S.toISOString(),children:Xe(S)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:g.map(A=>{const{name:_,count:q,me:B,staticUrl:P,url:D}=A;return e("button",{type:"button",class:`plain4 small ${B?"reacted":""}`,children:[D||P?e("img",{src:D||P,alt:_,width:"16",height:"16"}):e("span",{children:_})," ",e("span",{class:"count",children:Oe(q)})]})})})]})}const ws=Be(jo),Ko=20;function Yt({local:t,columnMode:n,...s}){const a=Te(k),o=!!t,i=n?{}:at(),{masto:u,instance:r}=W({instance:(s==null?void 0:s.instance)||i.instance}),{masto:c,instance:l}=W(),p=`${o?"Local":"Federated"} timeline (${r})`;Pe(p,o?"/:instance?/p/l":"/:instance?/p");const d=O(),f=O();async function h(m){(m||!f.current)&&(f.current=u.v1.timelines.public.list({limit:Ko,local:o}));const v=await f.current.next();let{value:g}=v;return g!=null&&g.length&&(m&&(d.current=g[0].id),g.forEach(y=>{Ee(y,r)})),{...v,value:g}}async function b(){try{const m=await u.v1.timelines.public.list({limit:1,local:o,since_id:d.current}).next();let{value:v}=m;return v=ft(v,"public"),!!(v!=null&&v.length)}catch{return!1}}return e(tt,{title:p,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:o?"Local timeline":"Federated timeline"}),e("div",{children:r})]}),id:"public",instance:r,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:h,checkForUpdates:b,useItemID:!0,headerStart:e(x,{}),boostsCarousel:a.settings.boostsCarousel,filterContext:"public",headerEnd:e(je,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(pe,{href:o?`/#/${r}/p`:`/#/${r}/p/l`,children:o?e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(x,{children:[e(w,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(ze,{}),e(pe,{onClick:()=>{let m=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(m)){m&&alert("Invalid instance");return}m&&(m=m.toLowerCase().trim(),location.hash=o?`/${m}/p/l`:`/${m}/p`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),l!==r&&e(pe,{onClick:()=>{location.hash=o?`/${l}/p/l`:`/${l}/p`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:l}),")"]})]})]})},r+o)}const Ct=5,Bt=40,Zo=new URLSearchParams;function vs({columnMode:t,...n}){const s=t?{}:at(),{masto:a,instance:o,authenticated:i}=W({instance:s.instance}),[u,r]=$("default"),[c]=t?[Zo]:Ye(),l=O(),p=(n==null?void 0:n.query)||c.get("q"),d=t?"statuses":(n==null?void 0:n.type)||c.get("type");Pe(p?`Search: ${p}${d?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[d]})`:""}`:"Search","/search");const[f,h]=$(!1),b=O(0);j(()=>{b.current=0},[p,d]);const m=O();et(()=>{var N,E;(E=(N=m.current)==null?void 0:N.scrollTo)==null||E.call(N,0,0)},[p,d]);const[v,g]=$([]),[y,I]=$([]),[S,C]=$([]);j(()=>{g([]),I([]),C([])},[p]);const A={statuses:g,accounts:I,hashtags:C},[_,q]=$({}),B=async N=>{if(!(N!=null&&N.length))return;const E=await nn(N,_);E&&q({..._,...E})};function P(N){N&&(b.current=0),!(!N&&!i)&&(r("loading"),N&&!d&&(g(v.slice(0,Ct)),I(y.slice(0,Ct)),C(S.slice(0,Ct))),(async()=>{var J,H;const E={q:p,resolve:i,limit:Ct};d&&(E.limit=Bt,E.type=d,i&&(E.offset=b.current));try{const oe=await a.v2.search.fetch(E);if(d)if(N){A[d](oe[d]);const ie=(J=oe[d])==null?void 0:J.length;b.current=Bt,h(!!ie)}else{A[d](be=>[...be,...oe[d]]);const ie=(H=oe[d])==null?void 0:H.length;b.current=b.current+Bt,h(!!ie)}else g(oe.statuses||[]),I(oe.accounts||[]),C(oe.hashtags||[]),b.current=0,h(!1);B(oe.accounts),r("default")}catch{r("error")}})())}const D=O();ht(N=>{var J;const E=((J=m.current)==null?void 0:J.scrollTop)===0;if(N&&E){const H=Date.now()-D.current;!D.current||H>1e3*3?P(!0):D.current=Date.now()}}),j(()=>{var N,E,J,H;(E=(N=l.current)==null?void 0:N.setValue)==null||E.call(N,p||""),p?P(!0):(H=(J=l.current)==null?void 0:J.focus)==null||H.call(J)},[p,d,o]),Me(["/","Slash"],N=>{var E,J;(J=(E=l.current)==null?void 0:E.focus)==null||J.call(E)},{preventDefault:!0});const[L]=Zt();return e("div",{id:"search-page",class:"deck-container",ref:m,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:u==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(gt,{})}),e(ds,{ref:l}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>{P(!0)},disabled:u==="loading",children:e(w,{icon:"search",size:"l"})})})]})}),e("main",{children:[!!p&&!t&&e("div",{ref:L,class:`filter-bar ${u==="loading"?"loading":""}`,children:[!!d&&e(se,{to:`/search${p?`?q=${encodeURIComponent(p)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(p)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(p)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(p)}&type=statuses`}].sort((N,E)=>N.type===d?-1:E.type===d?1:0).map(N=>e(se,{to:N.to,children:N.label},N.type))]}),p?e(x,{children:[(!d||d==="accounts")&&e(x,{children:[d!=="accounts"&&e("h2",{class:"timeline-header",children:["Accounts"," ",e(se,{to:`/search?q=${encodeURIComponent(p)}&type=accounts`,children:e(w,{icon:"arrow-right",size:"l"})})]}),y.length>0?e(x,{children:[e("ul",{class:"timeline flat accounts-list",children:y.map(N=>e("li",{children:e(We,{account:N,instance:o,showStats:!0,relationship:_[N.id]})},N.id))}),d!=="accounts"&&e("div",{class:"ui-state",children:e(se,{class:"plain button",to:`/search?q=${encodeURIComponent(p)}&type=accounts`,children:["See more accounts ",e(w,{icon:"arrow-right"})]})})]}):!d&&(u==="loading"?e("p",{class:"ui-state",children:e(Ce,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!d||d==="hashtags")&&e(x,{children:[d!=="hashtags"&&e("h2",{class:"timeline-header",children:["Hashtags"," ",e(se,{to:`/search?q=${encodeURIComponent(p)}&type=hashtags`,children:e(w,{icon:"arrow-right",size:"l"})})]}),S.length>0?e(x,{children:[e("ul",{class:"link-list hashtag-list",children:S.map(N=>{var oe;const{name:E,history:J}=N,H=(oe=J==null?void 0:J.reduce)==null?void 0:oe.call(J,(ie,be)=>ie+ +be.uses,0);return e("li",{children:e(se,{to:o?`/${o}/t/${E}`:`/t/${E}`,children:[e(w,{icon:"hashtag"}),e("span",{children:E}),!!H&&e("span",{class:"count",children:Oe(H)})]})},`${E}-${H}`)})}),d!=="hashtags"&&e("div",{class:"ui-state",children:e(se,{class:"plain button",to:`/search?q=${encodeURIComponent(p)}&type=hashtags`,children:["See more hashtags ",e(w,{icon:"arrow-right"})]})})]}):!d&&(u==="loading"?e("p",{class:"ui-state",children:e(Ce,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!d||d==="statuses")&&e(x,{children:[d!=="statuses"&&e("h2",{class:"timeline-header",children:["Posts"," ",e(se,{to:`/search?q=${encodeURIComponent(p)}&type=statuses`,children:e(w,{icon:"arrow-right",size:"l"})})]}),v.length>0?e(x,{children:[e("ul",{class:"timeline",children:v.map(N=>e("li",{children:e(se,{class:"status-link",to:o?`/${o}/s/${N.id}`:`/s/${N.id}`,children:e(_e,{status:N})})},N.id))}),d!=="statuses"&&e("div",{class:"ui-state",children:e(se,{class:"plain button",to:`/search?q=${encodeURIComponent(p)}&type=statuses`,children:["See more posts ",e(w,{icon:"arrow-right"})]})})]}):!d&&(u==="loading"?e("p",{class:"ui-state",children:e(Ce,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!d&&(u==="default"?f?e(Qe,{onChange:N=>{N&&P()},children:e("button",{type:"button",class:"plain block",onClick:()=>P(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):u==="loading"&&e("p",{class:"ui-state",children:e(Ce,{abrupt:!0})}))]}):u==="loading"?e("p",{class:"ui-state",children:e(Ce,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const Jo=20,Xo=it(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function Ss({columnMode:t,...n}){const s=Te(k),a=t?{}:at(),{masto:o,instance:i}=W({instance:(n==null?void 0:n.instance)||a.instance}),{masto:u,instance:r}=W(),c=`Trending (${i})`;Pe(c,"/:instance?/trending");const l=O(),[p,d]=$([]),[f,h]=$([]),b=O();async function m(y){var C;if(y||!b.current){b.current=o.v1.trends.statuses.list({limit:Jo});try{const A=o.v1.trends.tags.list(),{value:_}=await A.next();_!=null&&_.length&&d(_)}catch{}try{const{value:A}=await Xo(o),_=(C=A==null?void 0:A.filter)==null?void 0:C.call(A,q=>q.type==="link");_!=null&&_.length&&h(_)}catch{}}const I=await b.current.next();let{value:S}=I;return S!=null&&S.length&&(y&&(l.current=S[0].id),S.forEach(A=>{Ee(A,i)})),{...I,value:S}}async function v(){try{const y=await o.v1.trends.statuses.list({limit:1}).next();let{value:I}=y;return I=ft(I,"public"),I!=null&&I.length&&I[0].id!==l.current?(l.current=I[0].id,!0):!1}catch{return!1}}const g=me(()=>e(x,{children:[!!p.length&&e("div",{class:"filter-bar expandable",children:[e(w,{icon:"chart",class:"insignificant",size:"l"}),p.map((y,I)=>{const{name:S,history:C}=y,A=C.reduce((_,q)=>_+ +q.uses,0);return e(se,{to:`/${i}/t/${S}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),S]}),e("span",{class:"filter-count",children:Oe(A)})]},S)})]}),!!f.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),f.map(y=>{const{authorName:I,authorUrl:S,blurhash:C,description:A,height:_,image:q,imageDescription:B,language:P,providerName:D,providerUrl:L,publishedAt:N,title:E,url:J,width:H}=y,oe=new URL(J).hostname.replace(/^www\./,"").replace(/\/$/,"");let ie;if(C){const be=Jt(C),Se=sn(be);ie=on([.6,Se[1],Se[2]])}return e("a",{href:J,target:"_blank",rel:"noopener noreferrer",style:ie?{"--accent-color":`rgb(${ie.join(",")})`,"--accent-alpha-color":`rgba(${ie.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:q,alt:B,width:H,height:_,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:oe})," ",!!N&&e(x,{children:"· "}),!!N&&e(x,{children:e(pt,{datetime:N,format:"micro"})})]}),!!E&&e("h1",{class:"title",lang:P,dir:"auto",children:E})]}),!!A&&e("p",{class:"description",lang:P,dir:"auto",children:A})]})]})},J)})]})]}),[p,f]);return e(tt,{title:c,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:"Trending"}),e("div",{children:i})]}),id:"trending",instance:i,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:m,checkForUpdates:v,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(x,{}),boostsCarousel:s.settings.boostsCarousel,filterContext:"public",timelineStart:g,headerEnd:e(je,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(w,{icon:"more",size:"l"})}),children:[e(pe,{onClick:()=>{let y=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(y)){y&&alert("Invalid instance");return}y&&(y=y.toLowerCase().trim(),location.hash=`/${y}/trending`)},children:[e(w,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),r!==i&&e(pe,{onClick:()=>{location.hash=`/${r}/trending`},children:[e(w,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:r}),")"]})]})]})},i)}function Qo(){Pe("Home","/");const t=Te(k),{shortcuts:n}=t,s=n.map(a=>{if(!a)return null;const{type:o,...i}=a,u={following:rn,notifications:ws,list:gs,public:Yt,bookmarks:ps,favourites:fs,hashtag:ms,mentions:bs,trending:Ss,search:vs}[o];return!u||o==="search"&&!i.query?null:e(u,{...i,columnMode:!0},o+JSON.stringify(i))});return Me(["1","2","3","4","5","6","7","8","9"],(a,o)=>{try{const i=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[i].focus()}catch{}}),e("div",{id:"columns",onContextMenu:a=>{a.target.closest(".deck > header")&&!a.target.closest("a")&&!a.target.closest("button")&&(a.preventDefault(),k.showShortcutsSettings=!0)},children:s})}function ea(){var n;const t=Te(k);return j(()=>{(async()=>{const s=await Ve.drafts.keys();if(s.length){const a=_t();s.filter(i=>i.startsWith(a)).length&&(k.showDrafts=!0)}})()},[]),e(x,{children:(t.settings.shortcutsViewMode==="multi-column"||!t.settings.shortcutsViewMode&&t.settings.shortcutsColumnsMode)&&((n=t.shortcuts)!=null&&n.length)?e(Qo,{}):e(rn,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(ta,{})})})}function ta(){const t=Te(k),n=O(),[s,a]=$(void 0);return e(x,{children:[e(se,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${s||""}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),a(i=>i?void 0:"open"))},children:e(w,{icon:"notification",size:"l",alt:"Notifications"})}),e(ia,{state:s,anchorRef:n,onClose:()=>a(void 0)})]})}const na=30,sa=5;function ia({anchorRef:t,state:n,onClose:s}){const{masto:a,instance:o}=W(),i=Te(k),[u,r]=$("default"),c=a.v1.notifications.list({limit:na});async function l(){const b=await c.next(),m=b.value;if(m!=null&&m.length){m.forEach(g=>{Ee(g.status,o,{skipThreading:!0})});const v=ys(m);k.notificationsLast=m[0],k.notifications=v,a.v1.markers.create({notifications:{lastReadId:m[0].id}}).catch(()=>{})}return k.notificationsShowNew=!1,k.notificationsLastFetchTime=Date.now(),b}const[p,d]=$(!1);function f(){return a.v1.followRequests.list({limit:1})}function h(){r("loading"),(async()=>{try{await l();const b=await f();d(!!(b!=null&&b.length)),r("default")}catch{r("error")}})()}return j(()=>{n==="open"&&h()},[n]),e(ts,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:s,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:i.notifications.length?e(x,{children:i.notifications.slice(0,sa).map(b=>e(an,{instance:o,notification:b,disableContextMenu:!0},b.id))}):u==="loading"?e("div",{class:"ui-state",children:e(Ce,{abrupt:!0})}):u==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:h,children:"Try again"})})]})}),e("footer",{children:[e(se,{to:"/mentions",class:"button plain",children:[e(w,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(se,{to:"/notifications",class:"button plain2",children:[p?e(x,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(w,{icon:"arrow-right"})]})]})]})}const oa=Be(ea),aa=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function ks(t){const{hostname:n,pathname:s}=new URL(t);for(const a of aa){const[,o]=s.match(a)||[];if(o)return{instance:n,id:o}}return{}}function ca(t){const{instance:n,id:s}=ks(t);return n&&s?`/${n}/s/${s}`:null}function ra(){const n=mt().pathname.replace(/^\//,""),s=ks(n),a=s!=null&&s.instance?`/${s.instance}/s/${s.id}`:null,[o,i]=$("loading");return et(()=>{i("loading"),(async()=>{try{const{instance:u,id:r}=s,{masto:c}=W({instance:u});if(await c.v1.statuses.$select(r).fetch()){window.location.hash=a+"?view=full";return}}catch{}{const{masto:u,instance:r}=W(),c=await u.v2.search.fetch({q:n,limit:1,resolve:!0});if(c.statuses.length){const l=c.statuses[0];window.location.hash=`/${r}/s/${l.id}?view=full`}else if(c.accounts.length){const l=c.accounts[0];window.location.hash=`/${r}/a/${l.id}`}else a?window.location.hash=a+"?view=full":i("error")}})()},[a]),e("div",{class:"ui-state",tabIndex:"-1",children:[o==="loading"?e(x,{children:[e(Ce,{abrupt:!0}),e("h2",{children:"Resolving…"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):e(x,{children:[e("h2",{children:"Unable to resolve URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(se,{to:"/",children:"Go home"})})]})}function la(){const{masto:t}=W();Pe("Lists","/l");const[n,s]=$("default"),[a,o]=kt(l=>l+1,0),[i,u]=$([]);j(()=>{s("loading"),(async()=>{try{const l=await t.v1.lists.list();l.sort((p,d)=>p.title.localeCompare(d.title)),u(l),s("default")}catch{s("error")}})()},[a]);const[r,c]=$(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(gt,{}),e(se,{to:"/",class:"button plain",children:e(w,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>c(!0),children:e(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:i.length>0?e(x,{children:[e("ul",{class:"link-list",children:i.map(l=>e("li",{children:e(se,{to:`/l/${l.id}`,children:e("span",{children:[e(w,{icon:"list"})," ",e("span",{children:l.title})]})})}))}),i.length>1&&e("footer",{class:"ui-state",children:e("small",{class:"insignificant",children:[i.length," list",i.length===1?"":"s"]})})]}):n==="loading"?e("p",{class:"ui-state",children:e(Ce,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),r&&e(Re,{class:"light",onClick:l=>{l.target===l.currentTarget&&c(!1)},children:e(tn,{list:r==null?void 0:r.list,onClose:l=>{l.state==="success"&&o(),c(!1)}})})]})}const da=""+new URL("instances-MzK7fGXv.json",import.meta.url).href;var ua={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:ha,PHANPY_WEBSITE:pa}=ua,ln="read write follow push";async function fa({instanceURL:t}){const n=new URLSearchParams({client_name:ha,redirect_uris:location.origin+location.pathname,scopes:ln,website:pa});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function ma({instanceURL:t,client_id:n}){const s=new URLSearchParams({client_id:n,scope:ln,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${s.toString()}`}async function ga({instanceURL:t,client_id:n,client_secret:s,code:a}){const o=new URLSearchParams({client_id:n,client_secret:s,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:a,scope:ln});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}var ba={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:ya}=ba;function wa(){Pe("Log in");const t=O(),n=le.local.get("instanceURL"),[s,a]=$("default"),[o]=Ye(),i=o.get("instance"),u=o.get("submit"),[r,c]=$(i||(n==null?void 0:n.toLowerCase())||""),[l,p]=$([]);j(()=>{(async()=>{try{const y=await(await fetch(da)).json();p(y)}catch{}})()},[]);const d=g=>{g&&(le.local.set("instanceURL",g),(async()=>{a("loading");try{const{client_id:y,client_secret:I,vapid_key:S}=await fa({instanceURL:g});y&&I?(le.session.set("clientID",y),le.session.set("clientSecret",I),le.session.set("vapidKey",S),location.href=await ma({instanceURL:g,client_id:y})):alert("Failed to register application"),a("default")}catch{a("error")}})())},f=r?r.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,h=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(f)&&!/[\s\/\\@]/.test(f),b=f?l.filter(g=>g.includes(r)).sort((g,y)=>{const I=g.toLowerCase().startsWith(r.toLowerCase()),S=y.toLowerCase().startsWith(r.toLowerCase());return I&&!S?-1:!I&&S?1:0}).slice(0,10):[],m=h?f:b!=null&&b.length?b[0]:r?l.find(g=>g.includes(r)):null,v=g=>{g.preventDefault(),d(m)};return u&&j(()=>{d(i||m)},[]),e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:v,children:[e("h1",{children:[e("img",{src:Qt,alt:"",width:"80",height:"80"}),e("br",{}),"Log in"]}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:r,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:s==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:g=>{c(g.target.value)}}),(b==null?void 0:b.length)>0?e("ul",{id:"instances-suggestions",children:b.map((g,y)=>e("li",{children:e("button",{type:"button",class:"plain5",onClick:()=>{d(g)},children:g})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),s==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{disabled:s==="loading"||!r||!m,children:m?`Continue with ${m}`:"Continue"})," "]}),e(Ce,{hidden:s!=="loading"}),e("hr",{}),!ya&&e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(se,{to:"/",children:"Go home"})})]})})}const $t=40,va=10,Sa=5;let Wt={},xt={},Rt={};function Lt(t){delete xt[t],delete Rt[t]}const yt={block:"nearest",inline:"center",behavior:"smooth"},Nn=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",Dn=/\/s\//i;function ka(t){const{id:n}=t,{masto:s,instance:a}=W({instance:t.instance}),o=Te(k),[i,u]=Ye(),r=i.get("media"),c=i.get("media-only"),l=parseInt(r||c,10);let p=l>0;const d=i.get("mediaStatusID"),f=Xn(d,a);d&&!f&&(p=!1);const h=p&&!!c,b=Ge(n,a),[m,v]=$(k.statuses[b]);j(()=>{k.statuses[b]&&v(k.statuses[b])},[b]);const g=me(()=>{const{prevLocation:S}=k,C=((S==null?void 0:S.pathname)||"")+((S==null?void 0:S.search)||""),A=St("/:instance/s/:id",C)||St("/s/:id",C);return!C||A?"/":C},[]);j(()=>{!m&&p&&(async()=>{try{const S=await s.v1.statuses.$select(n).fetch();Ee(S,a),v(S)}catch{alert("Unable to load post."),location.hash=g}})()},[p]);const y=d?f==null?void 0:f.mediaAttachments:m==null?void 0:m.mediaAttachments,I=Ke(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():h?location.hash=g:(i.delete("media"),i.delete("mediaStatusID"),u(i))},[h,g,o.prevLocation]);return j(()=>{let S=setTimeout(()=>{const C=document.querySelector(".carousel");C&&C.focus()},100);return()=>clearTimeout(S)},[h]),e("div",{class:"deck-backdrop",children:[p?y!=null&&y.length?e(rs,{mediaAttachments:y,statusID:d||n,instance:a,lang:m==null?void 0:m.language,index:l-1,onClose:I}):e("div",{class:"media-modal-container loading",children:e(Ce,{abrupt:!0})}):e(se,{to:g}),!h&&e(Ta,{id:n,instance:t.instance,closeLink:g})]})}function Ia(t){const{linkable:n,to:s,onClick:a,...o}=t;return n?e(se,{class:"status-link",to:s,onClick:a,...o}):e("div",{class:"status-focus",tabIndex:0,...o})}function Ta({id:t,closeLink:n="/",instance:s}){var he,re;const[a,o]=Ye(),i=a.get("media"),u=a.get("mediaStatusID"),r=parseInt(i,10)>0,c=O(!k.prevLocation&&(history.length===1||"navigation"in window&&((re=(he=navigation==null?void 0:navigation.entries)==null?void 0:he.call(navigation))==null?void 0:re.length)===1)),[l,p]=$(a.get("view")||c.current?"full":null),d=!!parseInt(a.get("translate")),{masto:f,instance:h}=W({instance:s}),{masto:b,instance:m,authenticated:v}=W(),g=h===m,y=Te(k),[I,S]=$([]),[C,A]=$("default"),_=O(),q=Ge(t,h),B=O(0),P=O();j(()=>{var R;(R=P.current)==null||R.focus()},[]),j(()=>{var V;const R=ss(()=>{if(!P.current)return;const{scrollTop:te}=P.current;C!=="loading"&&(Rt[t]=te)},50);return(V=P.current)==null||V.addEventListener("scroll",R,{passive:!0}),R(),()=>{var te;R.cancel(),(te=P.current)==null||te.removeEventListener("scroll",R)}},[t,C!=="loading"]);const D=O(),L=O(),N=({reloadHero:R}={})=>{A("loading");let V;const te=xt[t];if(te){const M=te.filter(ae=>k.statuses[q]);S(M)}else S([{id:t}]);return(async()=>{var Ae,Ne;const M=()=>bn(()=>f.v1.statuses.$select(t).fetch(),{retries:4}),ae=bn(()=>f.v1.statuses.$select(t).context.fetch(),{retries:8}),Y=!!y.statuses[q];let Z=y.statuses[q];if(!(Y&&!R))try{Z=await M(),Ee(Z,h),await new Promise(we=>{setTimeout(we,100)})}catch{A("error");return}try{let we=function(de){return de==null?void 0:de.map(Ue=>({id:Ue.id,account:Ue.account,repliesCount:Ue.repliesCount,content:Ue.content,weight:vt(Ue),replies:we(Ue.__replies)}))};const ve=await ae,{ancestors:De,descendants:xe}=ve;B.current=(xe==null?void 0:xe.length)||0;const He=new Set;De.forEach(de=>{Ee(de,h,{skipThreading:!0}),de.inReplyToId&&!De.find(Ue=>Ue.id===de.inReplyToId)&&He.add(de.inReplyToId)});const ct=De.every(de=>de.account.id===Z.account.id),qe=[];xe.forEach(de=>{if(Ee(de,h,{skipThreading:!0}),de.inReplyToId&&!xe.find(Ue=>Ue.id===de.inReplyToId)&&de.inReplyToId!==Z.id&&He.add(de.inReplyToId),de.inReplyToAccountId===de.account.id)qe.push(de);else if(de.inReplyToId===Z.id)qe.push(de);else if(!de.inReplyToAccountId&&qe.find(Ue=>Ue.id===de.inReplyToId)&&de.account.id===Z.account.id)qe.push(de);else{const Ue=xe.find(Ts=>Ts.id===de.inReplyToId);Ue&&(Ue.__replies||(Ue.__replies=[]),Ue.__replies.push(de))}}),He.size;const Dt=[...De.map(de=>({id:de.id,ancestor:!0,isThread:ct,accountID:de.account.id,account:de.account,repliesCount:de.repliesCount,weight:vt(de)})),{id:t,accountID:Z.account.id,weight:vt(Z)},...qe.map(de=>({id:de.id,account:de.account,accountID:de.account.id,descendant:!0,thread:de.account.id===Z.account.id,weight:vt(de),replies:we(de.__replies)}))];A("default"),D.current={offsetTop:(Ae=_.current)==null?void 0:Ae.offsetTop,scrollTop:(Ne=P.current)==null?void 0:Ne.scrollTop};const dn=Dt.findIndex(de=>de.id===t);dn>=ee&&U(dn+1),S(Dt),xt[t]=Dt,Ds(Z,h)}catch{A("error")}})(),L.current=Date.now(),()=>{clearTimeout(V)}};j(N,[t,f]);const[E,J]=$(!1);j(()=>{let R=setInterval(()=>{const V=Date.now();L.current&&V-L.current>=6e4&&J(!0)},6e4);return()=>{clearInterval(R)}},[]),et(()=>{var V,te;if(!I.length)return;const R=Rt[t];if(R)P.current.scrollTop=R;else if(D.current){const M={offsetTop:(V=_.current)==null?void 0:V.offsetTop,scrollTop:(te=P.current)==null?void 0:te.scrollTop},ae=M.offsetTop-D.current.offsetTop+M.scrollTop;P.current.scrollTop=ae}else I.length===1&&(P.current.scrollTop=0);D.current=null},[I]),j(()=>{y.reloadStatusPage<=0||(async()=>{try{const{instanceURL:R}=ut(),V=`https://${R}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(V,{ignoreVary:!0}),N({reloadHero:!0})}catch{}})()},[y.reloadStatusPage]),j(()=>()=>{Rt={},k.reloadStatusPage=0,xt={},Wt={},Kt.clear()},[]);const H=y.statuses[q]||y.statuses[t],oe=me(()=>{if(!H)return"";const{account:R}=H,V=document.createElement("div");return V.innerHTML=R.displayName,V.innerText.trim()},[H]),ie=me(()=>{if(!H)return"";let R=Jn(H);return R.length>64&&(R=R.slice(0,64)+"…"),R},[H]);Pe(oe&&ie?`${oe}: "${ie}"`:"Status","/:instance?/s/:id");const be=me(()=>{if(!H)return;const{url:R}=H;if(R)return new URL(R).hostname},[H]),Se=me(()=>{if(be)return be===h},[be,h]),[ee,U]=$($t),X=me(()=>I.length-ee,[I.length,ee]),ne=I.some(R=>R.descendant),ge=I.filter(R=>R.ancestor),[ye,ke]=$(!0),$e=me(()=>{if(!_.current||ye)return null;const{top:R}=_.current.getBoundingClientRect();return R>0?"down":"up"},[ye]);Me("esc",()=>{location.hash=n},{enabled:!r,ignoreEventWhen:R=>!!document.querySelector("#modal-container > *")}),Me("backspace",()=>{location.hash=n}),Me("j",()=>{const R=document.activeElement.closest(".status-link, .status-focus"),V=R==null?void 0:R.getBoundingClientRect(),te=Array.from(P.current.querySelectorAll(Nn));if(R&&V.top<P.current.clientHeight&&V.bottom>0){const M=te.indexOf(R);let ae=te[M+1];ae&&(ae.focus(),ae.scrollIntoView(yt))}else{const M=te.find(ae=>{const Y=ae.getBoundingClientRect();return Y.top>=44&&Y.left>=0});M&&(M.focus(),M.scrollIntoView(yt))}}),Me("k",()=>{const R=document.activeElement.closest(".status-link, .status-focus"),V=R==null?void 0:R.getBoundingClientRect(),te=Array.from(P.current.querySelectorAll(Nn));if(R&&V.top<P.current.clientHeight&&V.bottom>0){const M=te.indexOf(R);let ae=te[M-1];ae&&(ae.focus(),ae.scrollIntoView(yt))}else{const M=te.find(ae=>{const Y=ae.getBoundingClientRect();return Y.top>=44&&Y.left>=0});M&&(M.focus(),M.scrollIntoView(yt))}}),Me("x",()=>{const R=document.activeElement.closest(".status-link, .status-focus");if(R){const V=R.nextElementSibling;V&&V.tagName.toLowerCase()==="details"&&(V.open=!V.open)}});const[Ie,Q]=$(!1),ce=O(r?"media+status":"status"),T=Ke((R,V,te,M)=>{R.preventDefault(),R.stopPropagation(),o({media:V+1,mediaStatusID:M.id})},[t]),z=Ke((R,V)=>{Lt(V.id)},[]);j(()=>{let R;return u&&r&&(R=setTimeout(()=>{var te;const V=(te=P.current)==null?void 0:te.querySelector(`.status-link[href*="/${u}"]`);V&&V.scrollIntoView(yt)},400)),()=>{clearTimeout(R)}},[u,r]);const G=Ke((R,V)=>{const{id:te,ancestor:M,isThread:ae,descendant:Y,thread:Z,replies:Ae,repliesCount:Ne,weight:we}=R,ve=te===t;return e("li",{ref:ve?_:null,class:`${M?"ancestor":""} ${Y?"descendant":""} ${Z?"thread":""} ${ve?"hero":""}`,children:[ve?e(x,{children:[e(Qe,{threshold:.1,onChange:xe=>{queueMicrotask(()=>{requestAnimationFrame(()=>{ke(xe)})})},class:"status-focus",tabIndex:0,children:e(_e,{statusID:te,instance:h,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:d})}),C!=="loading"&&!v?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(se,{to:"/login",class:"button",children:"Log in"})]}):!g&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:h}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:C==="loading",onClick:()=>{A("loading"),(async()=>{try{const xe=await b.v2.search.fetch({q:H.url,type:"statuses",resolve:!0,limit:1});if(xe.statuses.length){const He=xe.statuses[0];location.hash=m?`/${m}/s/${He.id}`:`/s/${He.id}`}else throw new Error("No results")}catch(xe){A("default"),alert("Error: "+xe)}})()},children:[e(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(Ia,{linkable:ae||M,to:h?`/${h}/s/${te}`:`/s/${te}`,onClick:()=>{Lt(te)},children:[V===0&&M?e(Qe,{threshold:.5,onChange:xe=>{queueMicrotask(()=>{requestAnimationFrame(()=>{Q(xe)})})},children:e(_e,{statusID:te,instance:h,withinContext:!0,size:Z||M?"m":"s",enableTranslate:!0,onMediaClick:T,onStatusLinkClick:z})}):e(_e,{statusID:te,instance:h,withinContext:!0,size:Z||M?"m":"s",enableTranslate:!0,onMediaClick:T,onStatusLinkClick:z,showActionsBar:!!Y}),M&&Ne>1&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:Ne,children:Oe(Ne)})]})," "]}),Y&&(Ae==null?void 0:Ae.length)>0&&e(Is,{instance:h,replies:Ae,hasParentThread:Z,level:1,accWeight:we,openAll:B.current<va,parentLink:{to:h?`/${h}/s/${te}`:`/s/${te}`,onClick:()=>Lt(te)}}),C==="loading"&&ve&&!!(H!=null&&H.repliesCount)&&!ne&&e("div",{class:"status-loading",children:e(Ce,{})}),C==="error"&&ve&&!!(H!=null&&H.repliesCount)&&!ne&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]},te)},[t,h,C,v,g,d,T,z,ne]),F=me(()=>{var R;if("navigation"in window&&(navigation!=null&&navigation.entries)){const V=navigation.entries()[navigation.currentEntry.index-1];if(V!=null&&V.url)return Dn.test(V.url)}return Dn.test((R=k.prevLocation)==null?void 0:R.pathname)},[q]),K=me(()=>{if(!X)return[];const R=[];function V(te){R.push(te.id),te.replies&&te.replies.forEach(V)}return I.slice(ee).forEach(V),R.map(te=>Ge(te,h))},[X,I,ee,h]),fe=me(()=>I.slice(0,ee).map(G),[I,ee,G]);return e("div",{tabIndex:"-1",ref:P,class:`status-deck deck contained ${I.length>1?"padded-bottom":""} ${ce.current==="status"&&!c.current?"slide-in":""} ${l?`deck-view-${l}`:""}`,onAnimationEnd:R=>{ce.current==="status"&&(ce.current=null)},children:[e("header",{class:`${C==="loading"?"loading":""}`,onDblClick:R=>{k.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[F&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(w,{icon:"chevron-left",size:"xl"})}),!ye&&H&&C!=="loading"?e(x,{children:[e("span",{class:"hero-heading",children:[e(dt,{account:H.account,instance:h,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e(pt,{datetime:H.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:R=>{R.preventDefault(),R.stopPropagation(),_.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(w,{icon:$e==="down"?"arrow-down":"arrow-up"})})]}):e(x,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:R=>{R.preventDefault(),R.stopPropagation(),P.current.scrollTo({top:0,behavior:"smooth"})},hidden:!ge.length||Ie,title:`${ge.length} posts above ‒ Go to top`,children:[e(w,{icon:"arrow-up"}),ge.filter((R,V,te)=>te.findIndex(M=>M.accountID===R.accountID)===V).slice(0,3).map(R=>e(Ze,{url:R.account.avatar,alt:R.account.displayName},R.account.id)),ge.length>3&&e(x,{children:[" ",e("span",{class:"insignificant",children:Oe(ge.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:l==="full"?"":"none"},onClick:()=>{p(null),a.delete("media"),a.delete("media-only"),a.delete("view"),o(a)},title:"Switch to Side Peek view",children:e(w,{icon:"layout4",size:"l"})}),E&&e("button",{type:"button",class:"plain button-refresh",onClick:()=>{k.reloadStatusPage++,J(!1)},children:e(w,{icon:"refresh",size:"l"})}),e(je,{align:"end",portal:{target:P.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(pe,{disabled:C==="loading",onClick:()=>{k.reloadStatusPage++},children:[e(w,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(pe,{className:"menu-switch-view",onClick:()=>{p(l==="full"?null:"full"),a.delete("media"),a.delete("media-only"),l==="full"?a.delete("view"):a.set("view","full"),o(a)},children:[e(w,{icon:{"":"layout5",full:"layout4"}[l||""]}),e("span",{children:["Switch to ",l==="full"?"Side Peek":"Full"," view"]})]}),e(pe,{onClick:()=>{Array.from(P.current.querySelectorAll(".spoiler-button:not(.spoiling), .spoiler-media-button:not(.spoiling)")).forEach(V=>{V.click()})},children:[e(w,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(ze,{}),e(ns,{className:"plain",children:"Experimental"}),e(pe,{disabled:!be||Se,onClick:()=>{const R=ca(H.url);R?location.hash=R:alert("Unable to switch")},children:[e(w,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance",be?e(x,{children:[" ","(",e("b",{children:be}),")"]}):""]})]})]}),e(se,{class:"button plain deck-close",to:n,children:e(w,{icon:"x",size:"xl"})})]})]})}),I.length&&H?e("ul",{class:`timeline flat contextual grow ${C==="loading"?"loading":""}`,children:[fe,X>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:C==="loading",onClick:()=>U(R=>R+$t),style:{marginBlockEnd:"6em"},"data-state-post-ids":K.join(" "),children:[e("div",{class:"ib avatars-bunch",children:I.slice(ee,ee+5).map(R=>e(Ze,{url:R.account.avatarStatic},R.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:X>$t?`${$t}+`:X})]})]})})]}):e(x,{children:[C==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(_e,{skeleton:!0,size:"l"})})}),C==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{k.reloadStatusPage++},children:"Try again"})]})]})]})}function Is({replies:t,instance:n,hasParentThread:s,level:a,accWeight:o,openAll:i,parentLink:u}){const[r,c]=Ye(),l=y=>y.reduce((I,S)=>{const{repliesCount:C,replies:A}=S,_=(A==null?void 0:A.length)||C;return I+_+l(A||[])},0),p=t.length+l(t),d=t.length===p,f=t.map(y=>y.account).filter((y,I,S)=>S.findIndex(C=>C.id===y.id)===I).slice(0,3),h=me(()=>t==null?void 0:t.reduce((y,I)=>y+(I==null?void 0:I.weight),o),[o,t==null?void 0:t.length]);let b=!1;(i||h<=Sa||!s&&p===1&&vt(t[0])<2)&&(b=!0);const m=Wt[t[0].id],v=Ke((y,I,S,C)=>{y.preventDefault(),y.stopPropagation(),c({media:I+1,mediaStatusID:C.id})},[]),g=O();return et(()=>{var I;function y(S){S.target.dataset.scrollLeft=S.target.scrollLeft}return(I=g.current)==null||I.addEventListener("scroll",y,{passive:!0}),()=>{var S;(S=g.current)==null||S.removeEventListener("scroll",y)}},[]),e("details",{ref:g,class:"replies",open:m||b,onToggle:y=>{const{open:I}=y.target;Wt[t[0].id]=I},style:{"--comments-level":a},"data-comments-level":a,"data-comments-level-overflow":a>4,children:[e("summary",{class:"replies-summary",hidden:b,children:[e("span",{class:"avatars",children:f.map(y=>e(Ze,{url:y.avatarStatic,title:`${y.displayName} @${y.username}`,squircle:y==null?void 0:y.bot},y.id))}),e("span",{class:"replies-counts",children:[e("b",{children:[e("span",{title:t.length,children:Oe(t.length)})," ","repl",t.length===1?"y":"ies"]}),!d&&p>1&&e(x,{children:[" ","·"," ",e("span",{children:[e("span",{title:p,children:Oe(p)})," ","comment",p===1?"":"s"]})]})]}),e(w,{icon:"chevron-down",class:"replies-summary-chevron"}),!!u&&e(se,{class:"replies-parent-link",to:u.to,onClick:u.onClick,title:"View post with its replies",children:"»"})]}),e("ul",{children:t.map(y=>{var I,S;return e("li",{children:[e("div",{class:"status-focus",tabIndex:0,children:[e(_e,{statusID:y.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:v,showActionsBar:!0}),!((I=y.replies)!=null&&I.length)&&y.repliesCount>0&&e("div",{class:"replies-link",children:[e(w,{icon:"comment2"})," ",e("span",{title:y.repliesCount,children:Oe(y.repliesCount)})]})]}),((S=y.replies)==null?void 0:S.length)&&e(Is,{instance:n,replies:y.replies,level:a+1,accWeight:b?h:y.weight,openAll:i,parentLink:{to:n?`/${n}/s/${y.id}`:`/s/${y.id}`,onClick:()=>{Lt(y.id)}}})]},y.id)})})]})}const Ca=140,$a=35,Aa=70,xa=140,Kt=new Map;function vt(t){var h,b;const n=Kt.get(t.id);if(n)return n;const{spoilerText:s,content:a,mediaAttachments:o,poll:i,card:u}=t,r=Us(s+a),c=o!=null&&o.length?Ca:0,l=(((h=i==null?void 0:i.options)==null?void 0:h.length)||0)*$a,p=u&&(o!=null&&o.length||(b=i==null?void 0:i.options)!=null&&b.length)?0:Aa,f=(r+c+l+p)/xa;return Kt.set(t.id,f),f}const Ra=Be(ka);function La(){const t=at(),{id:n,instance:s}=t;return e(Ra,{id:n,instance:s})}const _a=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,Ea=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,Ma=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,Pa=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,Na=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,Da="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";var Ua={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://mastodon.blaede.family/privacy-policy",VITE_APP_ENV:"production",PHANPY_DEFAULT_INSTANCE:"mastodon.blaede.family",PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:"https://mastodon.blaede.family/auth/sign_up",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_DEFAULT_INSTANCE:wt,PHANPY_WEBSITE:Un,PHANPY_PRIVACY_POLICY_URL:Fa,PHANPY_DEFAULT_INSTANCE_REGISTRATION_URL:Fn}=Ua,On=Un?Un.replace(/https?:\/\//g,"").replace(/\/$/,""):null,zn=`${"2024-02-26T19:11:53.888Z".slice(0,10).replace(/-/g,".")}.594cad4`;function Bn(){return Pe(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("div",{class:"hero-content",children:[e("h1",{children:[e("img",{src:Qt,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:Da,alt:"Phanpy",width:"200"})]}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),e("p",{children:e(se,{to:wt?`/login?instance=${wt}&submit=1`:"/login",class:"button",children:wt?"Log in":"Log in with Mastodon"})}),wt&&Fn&&e("p",{children:e("a",{href:Fn,class:"button plain5",children:"Sign up"})}),!wt&&e("p",{class:"insignificant",children:e("small",{children:["Connect your existing Mastodon/Fediverse account.",e("br",{}),"Your credentials are not stored on this server."]})})]}),(On||zn)&&e("p",{class:"app-site-version",children:e("small",{children:[On," ",zn]})}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),k.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:Fa,target:"_blank",children:"Privacy Policy"}),"."]})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:_a,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:Na,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:Ea,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:Ma,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:Pa,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Oa=window.alert;window.__nativeAlert||(window.__nativeAlert=Oa);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=Xs({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=k;window.__STATES_STATS__=()=>{const t=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};t.forEach(o=>{n[o]=Object.keys(k[o]).length});const{statuses:s}=k,a=[];for(const o in s)document.querySelector(`[data-state-post-id~="${o}"], [data-state-post-ids~="${o}"]`)||a.push(o)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:t,unfurledLinks:n,notifications:s}=k;let a=0;const{instance:o}=W();for(const i in t){if(!window.__IDLE__)break;try{const u=document.querySelector(`[data-state-post-id~="${i}"], [data-state-post-ids~="${i}"]`),r=s.some(c=>{var l;return i===Ge((l=c.status)==null?void 0:l.id,o)});if(!u&&!r){delete k.statuses[i],delete k.statusQuotes[i];for(const c in n){const l=n[c];if(Ge(l.id,l.instance)===i){delete k.unfurledLinks[c];break}}a++}}catch{}}},15*60*1e3);setTimeout(()=>{for(const t in It)queueMicrotask(()=>{var n,s,a,o;Array.isArray(It[t])?(s=(n=It[t])[0])==null||s.call(n):(o=(a=It)[t])==null||o.call(a)})},5e3);(()=>{window.__IDLE__=!0;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},a=ss(n,3e3),o=()=>{window.__IDLE__=!1,a()};t.forEach(i=>{window.addEventListener(i,o,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",i=>{!i.relatedTarget&&!i.toElement&&n()},{passive:!0})})();const za=/iPad|iPhone|iPod/.test(navigator.userAgent);za&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const t=le.local.get("theme");let n;if(t){if(n=document.querySelector('meta[name="theme-color"][data-theme-setting="manual"]'),n){const s=n.content,a=t==="light"?n.dataset.themeLightColorTemp:n.dataset.themeDarkColorTemp;n.content=a||"",setTimeout(()=>{n.content=s},10)}}else{const s=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";if(n=document.querySelector(`meta[name="theme-color"][media*="${s}"]`),n){const a=n.dataset.content,o=n.dataset.contentTemp;n.content=o||"",setTimeout(()=>{n.content=a},10)}}}});{const t=le.local.get("theme");if(t){document.documentElement.classList.add(`is-${t}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",t||"dark light");const s=document.querySelector('meta[data-theme-setting="manual"]');s&&(s.name="theme-color",s.content=t==="light"?s.dataset.themeLightColor:s.dataset.themeDarkColor),document.querySelectorAll('meta[data-theme-setting="auto"]').forEach(o=>{o.name=""})}const n=le.local.get("textSize");n&&document.documentElement.style.setProperty("--text-size",`${n}px`)}Qn(k,t=>{var n;for(const[s,a,o,i]of t){if(a.join(".")==="settings.shortcutsViewMode"){const u=document.getElementById("app");u&&(u.dataset.shortcutsViewMode=(n=k.shortcuts)!=null&&n.length?o:"")}a.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",o)}});function Ba(){const[t,n]=$(!1),[s,a]=$("loading");j(()=>{const i=le.local.get("instanceURL"),u=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(u){window.history.replaceState({},document.title,window.location.pathname||"/");const r=le.session.get("clientID"),c=le.session.get("clientSecret"),l=le.session.get("vapidKey");(async()=>{a("loading");const{access_token:p}=await ga({instanceURL:i,client_id:r,client_secret:c,code:u}),d=Fs({instance:i,accessToken:p});await Promise.allSettled([pn(d,i),Os(d,i,p,l)]),fn(),mn(d),n(!0),a("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const r=ut();if(r){le.session.set("currentAccount",r.info.id);const{client:c}=W({account:r}),{instance:l}=c;fn(),mn(c),a("loading"),(async()=>{try{await pn(c,l)}catch{}finally{n(!0),a("default")}})()}else a("default")}},[]);let o=mt();return k.currentLocation=o.pathname,j(Vt,[o,t]),/\/https?:/.test(o.pathname)?e(ra,{}):e(x,{children:[e(qa,{isLoggedIn:t,loading:s==="loading"}),e(Ha,{isLoggedIn:t}),s==="default"&&e(Xt,{children:e(Le,{path:"/:instance?/s/:id",element:e(La,{})})}),t&&e(ii,{}),t&&e(oo,{}),e(eo,{}),t&&e(no,{}),e(si,{isLoggedIn:t}),s!=="loading"&&e(so,{onClose:Vt}),e(oi,{})]})}function qa({isLoggedIn:t,loading:n}){const s=mt(),a=me(()=>{const{pathname:o}=s;return!/^\/(login|welcome)/i.test(o)},[s]);return e(Xt,{location:a||s,children:[e(Le,{path:"/",element:t?e(oa,{}):n?e(Ce,{id:"loader-root"}):e(Bn,{})}),e(Le,{path:"/login",element:e(wa,{})}),e(Le,{path:"/welcome",element:e(Bn,{})})]})}function qn(){return k.prevLocation||null}function Ha({isLoggedIn:t}){const n=mt(),s=O(qn());return me(()=>St("/:instance/s/:id",n.pathname)||St("/s/:id",n.pathname),[n.pathname,St])?s.current||(s.current=qn()):s.current=null,e(Xt,{location:s.current||n,children:[t&&e(x,{children:[e(Le,{path:"/notifications",element:e(ws,{})}),e(Le,{path:"/mentions",element:e(bs,{})}),e(Le,{path:"/following",element:e(rn,{})}),e(Le,{path:"/b",element:e(ps,{})}),e(Le,{path:"/f",element:e(fs,{})}),e(Le,{path:"/l",children:[e(Le,{index:!0,element:e(la,{})}),e(Le,{path:":id",element:e(gs,{})})]}),e(Le,{path:"/ft",element:e(Mo,{})}),e(Le,{path:"/catchup",element:e(Co,{})})]}),e(Le,{path:"/:instance?/t/:hashtag",element:e(ms,{})}),e(Le,{path:"/:instance?/a/:id",element:e(So,{})}),e(Le,{path:"/:instance?/p",children:[e(Le,{index:!0,element:e(Yt,{})}),e(Le,{path:"l",element:e(Yt,{local:!0})})]}),e(Le,{path:"/:instance?/trending",element:e(Ss,{})}),e(Le,{path:"/:instance?/search",element:e(vs,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));ei(e(Qs,{children:e(Ba,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-UgOT4bS_.js.map
