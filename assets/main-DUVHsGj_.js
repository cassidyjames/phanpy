import{s as S,a as z,b as Ce,u as Cn,c as de,o as rs,I as k,M as Se,d as ne,A as et,N as St,e as Ne,f as Fe,L as J,g as ot,h as xn,l as ls,t as Qt,R as $t,i as ds,p as tt,j as qe,k as Mn,m as _t,E as Ln,n as _e,q as Ye,r as us,v as ve,w as en,T as An,x as lt,y as Rn,z as tn,B as En,C as Re,D as hs,S as Me,F as fs,G as ps,H as je,J as Dn,K as Pt,O as ms,P as _n,Q as Ae,U as ft,V as Pn,W as gs,X as bs,Y as ys,Z as mt,_ as ws,$ as nn,a0 as vs,a1 as sn,a2 as on}from"./useTitle-jFZfqYHS.js";import{_,p as O,h as C,u as Le,w as ze,a as e,b as ge,g as L,s as Ct,c as Ht,M as se,d as Ee,e as ct,F as ue,T as He,S as ks,I as at,y as Ve,f as Nn,l as cn,i as Un,j as Fn,k as Oe,A as Ss,N as Is,q as Ts,J as $s,C as zn,m as On,n as nt,o as Bn,r as Cs,t as xs,v as Ms,x as ut,z as qn,B as an,D as Ls,R as Vt,E as ke,H as As,G as Rs}from"./vendor-mzv5qb3T.js";function ht(t=()=>{},n=[]){const o=_(t);O(()=>{o.current=t},[n]),O(()=>{const i=()=>{const c=document.hidden||document.visibilityState==="hidden";o.current(!c)};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)},[])}const Es=1e3*3,Ds=15e3,_s=ze(function({isLoggedIn:n}){const[o,i]=C(!0);ht(i);const c=async(r,l,d)=>{var u;if(S.notificationsLast){const h=r.v1.notifications.list({limit:1,sinceId:S.notificationsLast.id}),{value:m}=await h.next();if(m!=null&&m.length)if(d)S.notificationsShowNew=!0;else{let f;try{const y=await r.v1.markers.fetch({timeline:"notifications"});f=(u=y==null?void 0:y.notifications)==null?void 0:u.lastReadId}catch{}f?S.notificationsShowNew=m[0].id!==f:S.notificationsShowNew=!0}}};O(()=>{let r,l;if(n&&o){const{masto:d,streaming:u,instance:h}=z();(async()=>{await c(d,h);let m=!1;u&&(l=setTimeout(()=>{(async()=>{try{m=!0,r=u.user.notification.subscribe();for await(const f of r){if(!r||!o)break;f.event==="notification"&&Ce(f.payload,h,{skipThreading:!0}),S.notificationsShowNew=!0}}catch{m=!1}m||(l=setInterval(()=>{c(d,h,!0)},Ds))})()},Es))})()}return()=>{var d;(d=r==null?void 0:r.unsubscribe)==null||d.call(r),r=null,clearTimeout(l),clearInterval(l)}},[o,n]);const s=_(),a=()=>{s.current=Date.now(),fetch("./version.json").then(r=>r.json()).then(r=>{r&&(S.appVersion=r)}).catch(r=>{})};return Cn(a,o&&1e3*60*30),ht(r=>{r&&(s.current?Date.now()-s.current>1e3*60*60&&a():a())}),Le("shift+alt+k",()=>{const r=S.settings.cloakMode;S.settings.cloakMode=!r,de({text:`Cloak mode ${r?"disabled":"enabled"}`})}),null});function Ps(){function t(n){n.shiftKey?rs()||(S.showCompose=!0):S.showCompose=!0}return Le("c, shift+c",t,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),e("button",{type:"button",id:"compose-button",onClick:t,children:e(k,{icon:"quill",size:"xl",alt:"Compose"})})}const Ns=ze(function(){const n=ge(S);function o(){S.showKeyboardShortcutsHelp=!1}return Le("?, shift+?",i=>{S.showKeyboardShortcutsHelp=!0},{ignoreEventWhen:i=>!!document.querySelector("#modal-container > *")}),!!n.showKeyboardShortcutsHelp&&e(Se,{class:"light",onClose:o,children:e("div",{id:"keyboard-shortcuts-help-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:o,children:e(k,{icon:"x"})}),e("header",{children:e("h2",{children:"Keyboard shortcuts"})}),e("main",{children:e("table",{children:[{action:"Keyboard shortcuts help",keys:e("kbd",{children:"?"})},{action:"Next post",keys:e("kbd",{children:"j"})},{action:"Previous post",keys:e("kbd",{children:"k"})},{action:"Skip carousel to next post",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"j"})]})},{action:"Skip carousel to previous post",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"k"})]})},{action:"Open post details",keys:e(L,{children:[e("kbd",{children:"Enter"})," or ",e("kbd",{children:"o"})]})},{action:e(L,{children:["Expand content warning or",e("br",{}),"toggle expanded/collapsed thread"]}),keys:e("kbd",{children:"x"})},{action:"Close post or dialogs",keys:e(L,{children:[e("kbd",{children:"Esc"})," or ",e("kbd",{children:"Backspace"})]})},{action:"Focus column in multi-column mode",keys:e(L,{children:[e("kbd",{children:"1"})," to ",e("kbd",{children:"9"})]})},{action:"Compose new post",keys:e("kbd",{children:"c"})},{action:"Compose new post (new window)",className:"insignificant",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"c"})]})},{action:"Send post",keys:e(L,{children:[e("kbd",{children:"Ctrl"})," + ",e("kbd",{children:"Enter"})," or ",e("kbd",{children:"⌘"})," +"," ",e("kbd",{children:"Enter"})]})},{action:"Search",keys:e("kbd",{children:"/"})},{action:"Reply",keys:e("kbd",{children:"r"})},{action:"Reply (new window)",className:"insignificant",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"r"})]})},{action:"Like (favourite)",keys:e(L,{children:[e("kbd",{children:"l"})," or ",e("kbd",{children:"f"})]})},{action:"Boost",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"b"})]})},{action:"Bookmark",keys:e("kbd",{children:"d"})},{action:"Toggle Cloak mode",keys:e(L,{children:[e("kbd",{children:"Shift"})," + ",e("kbd",{children:"Alt"})," + ",e("kbd",{children:"k"})]})}].map(({action:i,className:c,keys:s})=>e("tr",{children:[e("th",{class:c,children:i}),e("td",{children:s})]},i))})})]})})});function Us({onClose:t}){const{masto:n}=z(),o=ne.local.getJSON("accounts"),i=ne.session.get("currentAccount"),c=o.length>1,[s,a]=Ct(l=>l+1,0),[r]=Ht();return e("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(k,{icon:"x"})}),e("header",{class:"header-grid",children:e("h2",{children:"Accounts"})}),e("main",{children:e("section",{children:[e("ul",{class:"accounts-list",ref:r,children:o.map((l,d)=>{const u=l.info.id===i,h=d===0;return e("li",{children:[e("div",{children:[c&&e("span",{class:`current ${u?"is-current":""}`,children:e(k,{icon:"check-circle",alt:"Current"})}),e(et,{url:l.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(u)try{const m=await n.v1.accounts.$select(l.info.id).fetch();l.info=m,ne.local.setJSON("accounts",o),a()}catch{}}}),e(St,{account:c?{...l.info,acct:/@/.test(l.info.acct)?l.info.acct:`${l.info.acct}@${l.instanceURL}`}:l.info,showAcct:!0,onClick:()=>{u?S.showAccount=`${l.info.username}@${l.instanceURL}`:(ne.session.set("currentAccount",l.info.id),location.reload())}})]}),e("div",{class:"actions",children:[h&&c&&e(L,{children:[e("span",{class:"tag",children:"Default"})," "]}),e(Ne,{align:"end",menuButton:e("button",{type:"button",title:"More",class:"plain more-button",children:e(k,{icon:"more",size:"l",alt:"More"})}),children:[e(se,{onClick:()=>{S.showAccount=`${l.info.username}@${l.instanceURL}`},children:[e(k,{icon:"user"}),e("span",{children:"View profile…"})]}),e(Ee,{}),c&&e(se,{disabled:h,onClick:()=>{o.splice(d,1),o.unshift(l),ne.local.setJSON("accounts",o),a()},children:[e(k,{icon:"check-circle"}),e("span",{children:"Set as default"})]}),e(Fe,{subMenu:!0,confirmLabel:e(L,{children:[e(k,{icon:"exit"}),e("span",{children:["Log out @",l.info.acct,"?"]})]}),disabled:!u,menuItemClassName:"danger",onClick:()=>{o.splice(d,1),ne.local.setJSON("accounts",o),location.href=location.pathname||"/"},children:[e(k,{icon:"exit"}),e("span",{children:"Log out…"})]})]})]})]},l.info.id)})}),e("p",{children:e(J,{to:"/login",class:"button plain2",onClick:t,children:[e(k,{icon:"plus"})," ",e("span",{children:"Add an existing account"})]})}),c&&e("p",{children:e("small",{children:["Note: ",e("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const jt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%2064%2064'%3e%3cpath%20fill='none'%20d='M0%200h63.994v63.994H0z'/%3e%3cpath%20fill='%23a4bff7'%20d='M37.774%2011.471c14.639%203.752%2019.034%2016.557%2015.889%2031.304-.696%203.261-2.563%206.661-6.356%208.693-3.204%201.717-8.07%202.537-15.338.55l-9.634-2.404C11.651%2046.992%208.378%2038.733%2010.027%2031.823c3.627-15.201%2015.543-23.48%2027.747-20.352Z'/%3e%3cpath%20fill='%23d8e7fe'%20d='M36.76%2015.429c12.289%203.15%2015.547%2014.114%2012.907%2026.493-.947%204.44-4.937%209.365-16.664%206.143l-9.684-2.417c-7.854-1.923-10.53-7.8-9.318-12.877%203.016-12.639%2012.611-19.943%2022.759-17.342Z'/%3e%3cpath%20fill='%236081e6'%20d='M27.471%2024.991c-1.457-.698-7.229%203.213-7.663%208.926-.182%202.39%204.55%203.237%205.071-.169.725-4.743%203.715-8.218%202.592-8.757Zm10.746%202.005c-2.083.327-.382%205.901-.595%2010.727-.123%202.8%204.388%203.464%204.703%202.011%201.098-5.073-2.066-13.058-4.108-12.738Z'/%3e%3c/svg%3e";function rn(t){const{masto:n}=z();return n.v1.push.subscription.create(t)}function Fs(){const{masto:t}=z();return t.v1.push.subscription.fetch()}function zs(t){const{masto:n}=z();return n.v1.push.subscription.update(t)}function Os(){const{masto:t}=z();return t.v1.push.subscription.remove()}function xt(){return"serviceWorker"in navigator&&"PushManager"in window}function Bs(){return navigator.serviceWorker.getRegistration()}async function Gt(){const t=await Bs(),n=t?await t.pushManager.getSubscription():void 0;return{registration:t,subscription:n}}function Hn(t){const n="=".repeat((4-t.length%4)%4),o=`${t}${n}`.replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(o),c=new Uint8Array(i.length);for(let s=0;s<i.length;++s)c[s]=i.charCodeAt(s);return c}async function qs(){if(!xt())return;const{subscription:t}=await Gt();let n=null;try{n=await Fs()}catch(o){if(!/(not found|unknown)/i.test(o.message))throw o}if(n&&t){const o=n.endpoint===t.endpoint,{vapidKey:i}=ot(),c=n.serverKey===i;if(!o)throw new Error("Backend subscription endpoint changed");if(!c)throw new Error("Backend subscription key and vapid key changed")}if(t&&!n){const{vapidKey:o}=ot(),{applicationServerKey:i}=t.options,c=Hn(o).toString(),s=new Uint8Array(i).toString();if(!(c===s))throw await t.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:t,backendSubscription:n}}async function ln({data:t,policy:n}){if(!xt())return;let{registration:o,subscription:i}=await Gt(),c=null;if(i)try{c=await zs({data:t,policy:n})}catch{c=await rn({subscription:i,data:t,policy:n})}else{const{vapidKey:s}=ot();if(!s)throw new Error("No server key found");i=await o.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:Hn(s)}),c=await rn({subscription:i,data:t,policy:n})}return{subscription:i,backendSubscription:c}}async function dn(){if(!xt())return;const{subscription:t}=await Gt();t&&(await Os(),await t.unsubscribe())}const un=16,Qe=[15,16,17,18,19,20];function Hs({onClose:t}){const n=ge(S),o=ne.local.get("theme")||"auto",i=_(),c=n.settings.contentTranslationTargetLanguage||null,s=xn(),a=ls(s),r=ne.local.get("textSize")||un,[l,d]=C(ne.account.get("preferences")||{}),{masto:u,authenticated:h,instance:m}=z();return e("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(k,{icon:"x"})}),e("header",{children:e("h2",{children:"Settings"})}),e("main",{children:[e("section",{children:e("ul",{children:[e("li",{children:[e("div",{children:e("label",{children:"Appearance"})}),e("div",{children:e("form",{ref:i,onInput:f=>{f.preventDefault();const g=new FormData(i.current).get("theme"),w=document.documentElement;g==="auto"?w.classList.remove("is-light","is-dark"):(w.classList.toggle("is-light",g==="light"),w.classList.toggle("is-dark",g==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",g==="auto"?"dark light":g),g==="auto"?ne.local.del("theme"):ne.local.set("theme",g)},children:e("div",{class:"radio-group",children:[e("label",{children:[e("input",{type:"radio",name:"theme",value:"light",defaultChecked:o==="light"}),e("span",{children:"Light"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"dark",defaultChecked:o==="dark"}),e("span",{children:"Dark"})]}),e("label",{children:[e("input",{type:"radio",name:"theme",value:"auto",defaultChecked:o!=="light"&&o!=="dark"}),e("span",{children:"Auto"})]})]})})})]}),e("li",{children:[e("div",{children:e("label",{children:"Text size"})}),e("div",{class:"range-group",children:[e("span",{style:{fontSize:Qe[0]},children:"A"})," ",e("input",{type:"range",min:Qe[0],max:Qe[Qe.length-1],step:"1",value:r,list:"sizes",onChange:f=>{const y=parseInt(f.target.value,10);document.documentElement.style.setProperty("--text-size",`${y}px`),y===un?ne.local.del("textSize"):ne.local.set("textSize",f.target.value)}})," ",e("span",{style:{fontSize:Qe[Qe.length-1]},children:"A"}),e("datalist",{id:"sizes",children:Qe.map(f=>e("option",{value:f}))})]})]})]})}),h&&e(L,{children:[e("h3",{children:"Posting"}),e("section",{children:e("ul",{children:e("li",{children:[e("div",{children:e("label",{for:"posting-privacy-field",children:["Default visibility"," ",e(k,{icon:"cloud",alt:"Synced",class:"synced-icon"})]})}),e("div",{children:e("select",{id:"posting-privacy-field",value:l["posting:default:visibility"]||"public",onChange:f=>{const{value:y}=f.target;(async()=>{try{await u.v1.accounts.updateCredentials({source:{privacy:y}}),d({...l,"posting:default:visibility":y}),ne.account.set("preferences",{...l,"posting:default:visibility":y})}catch{alert("Failed to update posting privacy")}})()},children:[e("option",{value:"public",children:"Public"}),e("option",{value:"unlisted",children:"Unlisted"}),e("option",{value:"private",children:"Followers only"})]})})]})})}),e("p",{class:"section-postnote",children:[e(k,{icon:"cloud",alt:"Synced",class:"synced-icon"})," ",e("small",{children:["Synced to your instance server's settings."," ",e("a",{href:`https://${m}/`,target:"_blank",rel:"noopener noreferrer",children:["Go to your instance (",m,") for more settings."]})]})]})]}),e("h3",{children:"Experiments"}),e("section",{children:e("ul",{children:[e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:f=>{S.settings.autoRefresh=f.target.checked}})," ","Auto refresh timeline posts"]})}),e("li",{children:e("label",{children:[e("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:f=>{S.settings.boostsCarousel=f.target.checked}})," ","Boosts carousel"]})}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:f=>{const{checked:y}=f.target;S.settings.contentTranslation=y,y||(S.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),e("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[e("div",{children:e("label",{children:["Translate to"," ",e("select",{value:c||"",disabled:!n.settings.contentTranslation,onChange:f=>{S.settings.contentTranslationTargetLanguage=f.target.value||null},children:[e("option",{value:"",children:["System language (",a,")"]}),e("option",{disabled:!0,children:"──────────"}),Qt.map(f=>e("option",{value:f.code,children:f.name}))]})]})}),e("hr",{}),e("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&e(L,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",e("div",{class:"checkbox-fields",children:Qt.map(f=>e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(f.code),onChange:y=>{const{checked:g}=y.target;g?S.settings.contentTranslationHideLanguages.push(f.code):S.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(w=>w!==f.code)}})," ",f.name]}))})]}),e("p",{class:"insignificant",children:e("small",{children:["Note: This feature uses an external API to translate, powered by"," ",e("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",rel:"noopener noreferrer",children:"Lingva Translate"}),"."]})}),e("hr",{}),e("div",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:f=>{S.settings.contentTranslationAutoInline=f.target.checked}})," ","Auto inline translation"]}),e("p",{class:"insignificant",children:e("small",{children:["Automatically show translation for posts in timeline. Only works for ",e("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),e("li",{children:[e("label",{children:[e("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:f=>{S.settings.cloakMode=f.target.checked}})," ","Cloak mode"," ",e("span",{class:"insignificant",children:["(",e("samp",{children:"Text"})," → ",e("samp",{children:"████"}),")"]})]}),e("div",{class:"sub-section insignificant",children:e("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),h&&e("li",{children:e("button",{type:"button",class:"light",onClick:()=>{S.showDrafts=!0,S.showSettings=!1},children:"Unsent drafts"})})]})}),h&&e(Vs,{onClose:t}),e("h3",{children:"About"}),e("section",{children:[e("div",{style:{display:"flex",flexWrap:"wrap",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[e("img",{src:jt,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),e("div",{children:[e("b",{children:"Phanpy"})," ",e("a",{href:"https://hachyderm.io/@phanpy",rel:"noopener noreferrer",onClick:f=>{f.preventDefault(),S.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),e("br",{}),e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",rel:"noopener noreferrer",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",rel:"noopener noreferrer",onClick:f=>{f.preventDefault(),S.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),e("p",{children:[e("a",{href:"https://github.com/sponsors/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Sponsor"})," ","·"," ",e("a",{href:"https://www.buymeacoffee.com/cheeaun",target:"_blank",rel:"noopener noreferrer",children:"Donate"})," ","·"," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]}),e("p",{children:["Version:"," ",e("input",{type:"text",class:"version-string",readOnly:!0,size:"18",value:`${"2023-12-20T22:18:16.556Z".slice(0,10).replace(/-/g,".")}.14a294c`,onClick:f=>{f.target.select();try{navigator.clipboard.writeText(f.target.value),de("Version string copied")}catch{de("Unable to copy version string")}}})," ",e("span",{class:"ib insignificant",children:["(",e("a",{href:"https://github.com/cheeaun/phanpy/commit/14a294c",target:"_blank",rel:"noopener noreferrer",children:e($t,{datetime:new Date("2023-12-20T22:18:16.556Z")})}),")"]})]})]})]})]})}function Vs({onClose:t}){if(!xt())return null;const{instance:n}=z(),[o,i]=C("default"),c=_(),[s,a]=C(!1),[r,l]=C(!1),d=_();O(()=>{(async()=>{i("loading");try{const{subscription:h,backendSubscription:m}=await qs();if(m!=null&&m.policy&&m.policy!=="none"){a(!0);const{alerts:f,policy:y}=m;d.current=y;const{elements:g}=c.current,w=g.namedItem(y);w&&(w.value=y),Object.keys(f).forEach(p=>{const b=g.namedItem(p);(b==null?void 0:b.type)==="checkbox"&&(b.checked=!0)})}i("default")}catch(h){/outside.*authorized/i.test(h.message)?l(!0):alert((h==null?void 0:h.message)||h),i("error")}})()},[]);const u=o==="loading";return e("form",{ref:c,onChange:()=>{const h=Object.fromEntries(new FormData(c.current)),m=!!h["policy-allow"],f={policy:h.policy,data:{alerts:{mention:!!h.mention,favourite:!!h.favourite,reblog:!!h.reblog,follow:!!h.follow,follow_request:!!h.followRequest,poll:!!h.poll,update:!!h.update,status:!!h.status}}};let y=0;Object.keys(f.data.alerts).forEach(w=>{f.data.alerts[w]?y++:delete f.data.alerts[w]});const g=d.current!==f.policy;m&&y>0?g?dn().then(()=>{ln(f)}).catch(w=>{alert("Failed to update subscription. Please try again.")}):ln(f).catch(w=>{alert("Failed to update subscription. Please try again.")}):dn().catch(w=>{alert("Failed to remove subscription. Please try again.")})},children:[e("h3",{children:"Push Notifications (beta)"}),e("section",{children:e("ul",{children:e("li",{children:[e("label",{children:[e("input",{type:"checkbox",disabled:u||r,name:"policy-allow",checked:s,onChange:async h=>{const{checked:m}=h.target;if(m){const f=await Notification.requestPermission();f==="granted"?a(!0):(a(!1),f==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else a(!1)}})," ","Allow from"," ",e("select",{name:"policy",disabled:u||r||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(h=>e("option",{value:h.value,children:h.label}))})]}),e("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:e("div",{class:"shazam-container-inner",children:e("div",{class:"sub-section",children:e("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Likes"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(h=>e("li",{children:e("label",{children:[e("input",{type:"checkbox",name:h.value})," ",h.label]})}))})})})}),r&&e("div",{class:"sub-section",children:e("p",{children:["Push permission was not granted since your last login. You'll need to"," ",e(J,{to:`/login?instance=${n}`,onClick:t,children:[e("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),e("p",{class:"section-postnote",children:e("small",{children:["NOTE: Push notifications only work for ",e("b",{children:"one account"}),"."]})})]})}const Nt=()=>{let t=setTimeout(()=>{if(!document.getElementById("columns")){const o=document.querySelectorAll("#modal-container > *");if(o!=null&&o.length){const a=o[o.length-1],r=a.querySelector('[tabindex="-1"]')||a;if(r){r.focus();return}}if(document.querySelector(".deck-backdrop"))return;const c=document.querySelectorAll(".deck-container"),s=c[c.length-1];s&&s.tabIndex===-1&&s.focus()}},100);return()=>clearTimeout(t)};function Vn(t){if(!t)return;const n=ct(),o=_(n.pathname);O(()=>{o.current&&n.pathname!==o.current&&(t==null||t())},[n.pathname,t])}function Wt({list:t,onClose:n}){const{masto:o}=z(),[i,c]=C("default"),s=!!t,a=_(),r=_(),l=_();O(()=>{s&&(a.current.value=t.title,r.current.value=t.repliesPolicy,l.current&&(l.current.checked=t.exclusive))},[s]);const d=ds("@mastodon/list-exclusive");return e("div",{class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(k,{icon:"x"})})," ",e("header",{children:e("h2",{children:s?"Edit list":"New list"})}),e("main",{children:e("form",{class:"list-form",onSubmit:u=>{u.preventDefault();const h=new FormData(u.target),m=h.get("title"),f=h.get("replies_policy"),y=h.get("exclusive")==="on";c("loading"),(async()=>{try{let g;s?g=await o.v1.lists.$select(t.id).update({title:m,replies_policy:f,exclusive:y}):g=await o.v1.lists.create({title:m,replies_policy:f,exclusive:y}),c("default"),n==null||n({state:"success",list:g})}catch{c("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[e("div",{class:"list-form-row",children:e("label",{for:"list-title",children:["Name"," ",e("input",{ref:a,type:"text",id:"list-title",name:"title",required:!0,disabled:i==="loading",dir:"auto"})]})}),e("div",{class:"list-form-row",children:e("select",{ref:r,name:"replies_policy",required:!0,disabled:i==="loading",children:[e("option",{value:"list",children:"Show replies to list members"}),e("option",{value:"followed",children:"Show replies to people I follow"}),e("option",{value:"none",children:"Don't show replies"})]})}),d&&e("div",{class:"list-form-row",children:e("label",{class:"label-block",children:[e("input",{ref:l,type:"checkbox",name:"exclusive",disabled:i==="loading"})," ","Hide posts on this list from Home/Following"]})}),e("div",{class:"list-form-footer",children:[e("button",{type:"submit",disabled:i==="loading",children:s?"Save":"Create"}),s&&e(Fe,{disabled:i==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{c("loading"),(async()=>{try{await o.v1.lists.$select(t.id).remove(),c("default"),n==null||n({state:"deleted"})}catch{c("error"),alert("Unable to delete list.")}})()},children:e("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete…"})})]})]})})]})}const js=[60*5,60*30,60*60,60*60*6,60*60*24,60*60*24*3,60*60*24*7,0],hn={0:"Forever",300:"5 minutes",1800:"30 minutes",3600:"1 hour",21600:"6 hours",86400:"1 day",259200:"3 days",604800:"1 week"},fn=80,jn=1e3*60*10;function Gs(t,n){return n.v1.accounts.familiarFollowers.fetch({id:[t]})}const Ws=tt(Gs,{maxAge:jn});async function Ks(t,n){const o=n.v1.accounts.$select(t).statuses.list({limit:20}).next(),{value:i}=await o,c={total:i.length,originals:0,replies:0,boosts:0};return i.forEach(s=>{s.reblog?c.boosts++:s.inReplyToId&&s.inReplyToAccountId!==s.account.id?c.replies++:c.originals++}),i.length&&(c.daysSinceLastPost=Math.ceil((Date.now()-new Date(i[i.length-1].createdAt))/864e5)),c}const Zs=tt(Ks,{maxAge:jn});function Gn({account:t,fetchAccount:n=()=>{},standalone:o,instance:i,authenticated:c}){const{masto:s}=z({instance:i}),{masto:a,instance:r}=z(),[l,d]=C("default"),u=typeof t=="string",[h,m]=C(u?null:t),f=ue(()=>i===r,[i,r]);O(()=>{if(!u){m(t);return}d("loading"),(async()=>{try{const H=await n();S.accounts[`${H.id}@${i}`]=H,m(H),d("default")}catch{m(null),d("error")}})()},[u,t,n]);const{acct:y,avatar:g,avatarStatic:w,bot:p,createdAt:b,displayName:v,emojis:T,fields:x,followersCount:E,followingCount:D,group:U,id:B,lastStatusAt:P,locked:M,note:$,statusesCount:A,url:N,username:G,memorial:te,moved:re,roles:Q}=h||{};let xe=!1,{header:pe,headerStatic:K}=h||{};(!pe||/missing\.png$/.test(pe))&&g&&!/missing\.png$/.test(g)&&(pe=g,xe=!0,w&&!/missing\.png$/.test(w)&&(K=w));const R=ue(()=>B===ne.session.get("currentAccount"),[B]);O(()=>{const H=!!(h!=null&&h.id&&(h!=null&&h.username)&&(h!=null&&h.acct)&&(h!=null&&h.avatar)&&(h!=null&&h.avatarStatic)&&(h!=null&&h.displayName)&&(h!=null&&h.url));if(R&&i&&H){const oe=ne.local.getJSON("accounts");let me=!1;oe.forEach(ae=>{ae.info.id===h.id&&ae.instanceURL===i&&(ae.info=h,me=!0)}),me&&ne.local.setJSON("accounts",oe)}},[R,h,i]);const j=ue(()=>N?new URL(N).hostname:null,[N]),[ee,le]=C([]),we=_(),Ie=_([]);async function Te(H){(H||!we.current)&&(we.current=s.v1.accounts.$select(B).followers.list({limit:fn}));const oe=await we.current.next();if(R||!f)return oe;const{value:me}=oe;let ae=[];if(H){const Pe=await s.v1.accounts.familiarFollowers.fetch({id:[B]});Ie.current=Pe[0].accounts,ae=[...Ie.current,...me.filter(Be=>!Ie.current.some(De=>De.id===Be.id))]}else me!=null&&me.length&&(ae=me.filter(Pe=>!Ie.current.some(Be=>Be.id===Pe.id)));return{...oe,value:ae}}const W=_();async function q(H){return(H||!W.current)&&(W.current=s.v1.accounts.$select(B).following.list({limit:fn})),await W.current.next()}const V=o?"div":J,he=i?`/${i}/a/${B}`:`/a/${B}`,[ce,X]=C([]),[I,F]=C(),[Y,ie]=C("default"),fe=!!(I!=null&&I.total),$e=async H=>{try{const oe=await Ws(H,a);X(oe[0].accounts.slice(0,Ys))}catch{}},be=async()=>{if(B){ie("loading");try{const H=await Zs(B,s);F(H),ie("default")}catch{ie("error")}}},We=He(({relationship:H,currentID:oe})=>{H.following||($e(oe),!o&&A>0&&be())},[o,B,A]);return e("div",{tabIndex:"-1",class:`account-container  ${l==="loading"?"skeleton":""}`,style:{"--header-color-1":ee[0],"--header-color-2":ee[1],"--header-color-3":ee[2],"--header-color-4":ee[3]},children:[l==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to load account."}),e("p",{children:e("a",{href:u?t:N,target:"_blank",rel:"noopener noreferrer",children:["Go to account page ",e(k,{icon:"external"})]})})]}),l==="loading"?e(L,{children:[e("header",{children:e(qe,{avatarSize:"xxxl",skeleton:!0})}),e("main",{children:[e("div",{class:"note",children:[e("p",{children:"███████ ████ ████"}),e("p",{children:"████ ████████ ██████ █████████ ████ ██"})]}),e("div",{class:"account-metadata-box",children:[e("div",{class:"profile-metadata",children:[e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"███"}),e("p",{children:"██████"})]}),e("div",{class:"profile-field",children:[e("b",{class:"more-insignificant",children:"████"}),e("p",{children:"███████████"})]})]}),e("div",{class:"stats",children:[e("div",{children:[e("span",{children:"██"})," Followers"]}),e("div",{children:[e("span",{children:"██"})," Following"]}),e("div",{children:[e("span",{children:"██"})," Posts"]})]})]}),e("div",{class:"actions",children:[e("span",{}),e("span",{class:"buttons",children:e("button",{type:"button",title:"More",class:"plain",disabled:!0,children:e(k,{icon:"more",size:"l",alt:"More"})})})]})]})]}):h&&e(L,{children:[!!re&&e("div",{class:"account-moved",children:[e("p",{children:[e("b",{children:v})," has indicated that their new account is now:"]}),e(qe,{account:re,instance:i,onClick:H=>{H.stopPropagation(),S.showAccount=re}})]}),!!pe&&!/missing\.png$/.test(pe)&&e("img",{src:pe,alt:"",class:`header-banner ${xe?"header-is-avatar":""}`,onError:H=>{H.target.crossOrigin?H.target.src!==K?H.target.src=K:(H.target.removeAttribute("crossorigin"),H.target.src=pe):H.target.src!==K?H.target.src=K:H.target.remove()},crossOrigin:"anonymous",onLoad:H=>{H.target.classList.add("loaded");try{const oe=document.createElement("canvas"),me=oe.getContext("2d",{willReadFrequently:!0});oe.width=H.target.width,oe.height=H.target.height,me.drawImage(H.target,0,0);const ae=10,Be=[me.getImageData(0,0,ae,ae).data,me.getImageData(H.target.width-ae,0,ae,ae).data,me.getImageData(0,H.target.height-ae,ae,ae).data,me.getImageData(H.target.width-ae,H.target.height-ae,ae,ae).data].map(De=>{let Ue=0,Ke=0,Xe=0,Z=0;for(let Ze=0;Ze<De.length;Ze+=4)Ue+=De[Ze],Ke+=De[Ze+1],Xe+=De[Ze+2],Z+=De[Ze+3];const ye=De.length/4;return[Ue/ye,Ke/ye,Xe/ye,Z/ye]}).map(De=>{const[Ue,Ke,Xe,Z]=Xs(De);return`rgba(${Ue}, ${Ke}, ${Xe}, ${Z})`});le(Be)}catch{}}}),e("header",{children:e(qe,{account:h,instance:i,avatarSize:"xxxl",external:o,internal:!o})}),e("div",{class:"faux-header-bg","aria-hidden":"true"}),e("main",{children:[!!te&&e("span",{class:"tag",children:"In Memoriam"}),!!p&&e("span",{class:"tag",children:[e(k,{icon:"bot"})," Automated"]}),!!U&&e("span",{class:"tag",children:[e(k,{icon:"group"})," Group"]}),Q==null?void 0:Q.map(H=>e("span",{class:"tag",children:[H.name,!!j&&e(L,{children:[" ",e("span",{class:"more-insignificant",children:j})]})]})),e("div",{class:"note",dir:"auto",onClick:Mn({instance:r}),dangerouslySetInnerHTML:{__html:_t($,{emojis:T})}}),e("div",{class:"account-metadata-box",children:[(x==null?void 0:x.length)>0&&e("div",{class:"profile-metadata",children:x.map(({name:H,value:oe,verifiedAt:me},ae)=>e("div",{class:`profile-field ${me?"profile-verified":""}`,dir:"auto",children:[e("b",{children:[e(Ln,{text:H,emojis:T})," ",!!me&&e(k,{icon:"check-circle",size:"s"})]}),e("p",{dangerouslySetInnerHTML:{__html:_t(oe,{emojis:T})}})]},H+ae))}),e("div",{class:"stats",children:[e(V,{tabIndex:0,to:he,onClick:()=>{setTimeout(()=>{S.showGenericAccounts={heading:"Followers",fetchAccounts:Te,instance:i,excludeRelationshipAttrs:["followedBy"]}},0)},children:[!!ce.length&&e("span",{class:"shazam-container-horizontal",children:e("span",{class:"shazam-container-inner stats-avatars-bunch",children:ce.map(H=>e(et,{url:H.avatarStatic,size:"s",alt:`${H.displayName} @${H.acct}`,squircle:H==null?void 0:H.bot}))})}),e("span",{title:E,children:_e(E)})," ","Followers"]}),e(V,{class:"insignificant",tabIndex:0,to:he,onClick:()=>{setTimeout(()=>{S.showGenericAccounts={heading:"Following",fetchAccounts:q,instance:i,excludeRelationshipAttrs:["following"]}},0)},children:[e("span",{title:D,children:_e(D)})," ","Following",e("br",{})]}),e(V,{class:"insignificant",to:he,children:[e("span",{title:A,children:_e(A)})," ","Posts"]}),!!b&&e("div",{class:"insignificant",children:["Joined"," ",e("time",{datetime:b,children:Ye(b,{hideTime:!0})})]})]})]}),!!I&&e(V,{to:he,class:"account-metadata-box",children:e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:fe?e("div",{class:"posting-stats",title:`${Math.round(I.originals/I.total*100)}% original posts, ${Math.round(I.replies/I.total*100)}% replies, ${Math.round(I.boosts/I.total*100)}% boosts`,children:[e("div",{children:I.daysSinceLastPost<365?`Last ${I.total} post${I.total>1?"s":""} in the past 
                      ${I.daysSinceLastPost} day${I.daysSinceLastPost>1?"s":""}`:`
                      Last ${I.total} posts in the past year(s)
                      `}),e("div",{class:"posting-stats-bar",style:{"--originals-percentage":`${I.originals/I.total*100}%`,"--replies-percentage":`${(I.originals+I.replies)/I.total*100}%`}}),e("div",{class:"posting-stats-legends",children:[e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-originals"})," ","Original"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-replies"})," ","Replies"]})," ",e("span",{class:"ib",children:[e("span",{class:"posting-stats-legend-item posting-stats-legend-item-boosts"})," ","Boosts"]})]})]}):e("div",{class:"posting-stats",children:"Post stats unavailable."})})})}),e("div",{class:"account-metadata-box",children:e("div",{class:"shazam-container no-animation",hidden:!!I,children:e("div",{class:"shazam-container-inner",children:e("button",{type:"button",class:"posting-stats-button",disabled:Y==="loading",onClick:()=>{be()},children:[e("div",{class:`posting-stats-bar posting-stats-icon ${Y==="loading"?"loading":""}`,style:{"--originals-percentage":"33%","--replies-percentage":"66%"}}),"View post stats"," "]})})})})]}),e("footer",{children:e(Js,{info:h,instance:i,authenticated:c,onRelationshipChange:We})})]})]})}const Ys=3;function Js({info:t,instance:n,authenticated:o,onRelationshipChange:i=()=>{}}){var W;if(!t)return null;const{masto:c,instance:s,authenticated:a}=z(),r=n===s,[l,d]=C("default"),[u,h]=C(null),{id:m,acct:f,url:y,username:g,locked:w,lastStatusAt:p,note:b,fields:v,moved:T}=t,x=_(m),{following:E,showingReblogs:D,notifying:U,followedBy:B,blocking:P,blockedBy:M,muting:$,mutingNotifications:A,requested:N,domainBlocking:G,endorsed:te,note:re}=u||{},[Q,xe]=C(null),[pe,K]=C(!1);O(()=>{if(t){const q=ne.session.get("currentAccount");let V;(async()=>{if(r&&o)V=m;else if(!r&&a){const ce=t.acct.includes("@");try{const X=await c.v2.search.fetch({q:ce?t.acct:`${t.username}@${n}`,type:"accounts",limit:1,resolve:!0});X.accounts.length&&(V=X.accounts[0].id,xe(X.accounts[0]))}catch{}}if(!V)return;if(q===V){K(!0);return}if(x.current=V,T)return;d("loading");const he=c.v1.accounts.relationships.fetch({id:[V]});try{const ce=await he;if(d("default"),ce.length){const X=ce[0];h(X),i({relationship:X,currentID:V})}}catch{d("error")}})()}},[t,o]),O(()=>{t&&pe&&us(t)},[t,pe]);const R=l==="loading",[j,ee]=C(!1),[le,we]=C(!1),[Ie,Te]=C(!1);return e(L,{children:[e("div",{class:"actions",children:[e("span",{children:[B?e("span",{class:"tag",children:"Following you"}):p?e("small",{class:"insignificant",children:["Last post:"," ",e("span",{class:"ib",children:Ye(p,{hideTime:!0})})]}):e("span",{}),$&&e("span",{class:"tag danger",children:"Muted"}),P&&e("span",{class:"tag danger",children:"Blocked"})]})," ",e("span",{class:"buttons",children:[!!re&&e("button",{type:"button",class:"private-note-tag",title:"Private note",onClick:()=>{Te(!0)},dir:"auto",children:e("span",{children:re})}),e(Ne,{portal:{target:document.body},containerProps:{style:{zIndex:1001}},align:"center",position:"anchor",overflow:"auto",menuButton:e("button",{type:"button",title:"More",class:"plain",disabled:R,children:e(k,{icon:"more",size:"l",alt:"More"})}),children:[a&&!pe&&e(L,{children:[e(se,{onClick:()=>{S.showCompose={draftStatus:{status:`@${(Q==null?void 0:Q.acct)||f} `}}},children:[e(k,{icon:"at"}),e("span",{children:["Mention @",g]})]}),e(se,{onClick:()=>{ee(!0)},children:[e(k,{icon:"translate"}),e("span",{children:"Translate bio"})]}),e(se,{onClick:()=>{Te(!0)},children:[e(k,{icon:"pencil"}),e("span",{children:re?"Edit private note":"Add private note"})]}),E&&e(se,{onClick:()=>{we(!0)},children:[e(k,{icon:"list"}),e("span",{children:"Add/remove from Lists"})]}),e(Ee,{})]}),e(se,{href:y,target:"_blank",children:[e(k,{icon:"external"}),e("small",{class:"menu-double-lines",children:Qs(y)})]}),e("div",{class:"menu-horizontal",children:[e(se,{onClick:()=>{try{navigator.clipboard.writeText(y),de("Link copied")}catch{de("Unable to copy link")}},children:[e(k,{icon:"link"}),e("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((W=navigator==null?void 0:navigator.canShare)==null?void 0:W.call(navigator,{url:y}))&&e(se,{onClick:()=>{try{navigator.share({url:y})}catch{alert("Sharing doesn't seem to work.")}},children:[e(k,{icon:"share"}),e("span",{children:"Share…"})]})]}),!!u&&e(L,{children:[e(Ee,{}),$?e(se,{onClick:()=>{d("loading"),(async()=>{try{const q=await c.v1.accounts.$select((Q==null?void 0:Q.id)||m).unmute();h(q),d("default"),de(`Unmuted @${g}`),S.reloadGenericAccounts.id="mute",S.reloadGenericAccounts.counter++}catch{d("error")}})()},children:[e(k,{icon:"unmute"}),e("span",{children:["Unmute @",g]})]}):e(ks,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:e(L,{children:[e(k,{icon:"mute"}),e("span",{class:"menu-grow",children:["Mute @",g,"…"]}),e("span",{style:{textOverflow:"clip"},children:[e(k,{icon:"time"}),e(k,{icon:"chevron-right"})]})]}),children:e("div",{class:"menu-wrap",children:js.map(q=>e(se,{onClick:()=>{d("loading"),(async()=>{try{const V=await c.v1.accounts.$select((Q==null?void 0:Q.id)||m).mute({duration:q});h(V),d("default"),de(`Muted @${g} for ${hn[q]}`),S.reloadGenericAccounts.id="mute",S.reloadGenericAccounts.counter++}catch{d("error"),de(`Unable to mute @${g}`)}})()},children:hn[q]}))})}),e(Fe,{subMenu:!0,confirm:!P,confirmLabel:e(L,{children:[e(k,{icon:"block"}),e("span",{children:["Block @",g,"?"]})]}),menuItemClassName:"danger",onClick:()=>{d("loading"),(async()=>{try{if(P){const q=await c.v1.accounts.$select((Q==null?void 0:Q.id)||m).unblock();h(q),d("default"),de(`Unblocked @${g}`)}else{const q=await c.v1.accounts.$select((Q==null?void 0:Q.id)||m).block();h(q),d("default"),de(`Blocked @${g}`)}S.reloadGenericAccounts.id="block",S.reloadGenericAccounts.counter++}catch{d("error"),P?de(`Unable to unblock @${g}`):de(`Unable to block @${g}`)}})()},children:P?e(L,{children:[e(k,{icon:"unblock"}),e("span",{children:["Unblock @",g]})]}):e(L,{children:[e(k,{icon:"block"}),e("span",{children:["Block @",g,"…"]})]})})]})]}),!u&&l==="loading"&&e(ve,{abrupt:!0}),!!u&&e(Fe,{confirm:E||N,confirmLabel:e("span",{children:N?"Withdraw follow request?":`Unfollow @${t.acct||t.username}?`}),menuItemClassName:"danger",align:"end",disabled:R,onClick:()=>{d("loading"),(async()=>{try{let q;E||N?q=await c.v1.accounts.$select(x.current).unfollow():q=await c.v1.accounts.$select(x.current).follow(),q&&h(q),d("default")}catch(q){alert(q),d("error")}})()},children:e("button",{type:"button",class:`${E||N?"light swap":""}`,"data-swap-state":E||N?"danger":"",disabled:R,children:E?e(L,{children:[e("span",{children:"Following"}),e("span",{children:"Unfollow…"})]}):N?e(L,{children:[e("span",{children:"Requested"}),e("span",{children:"Withdraw…"})]}):w?e(L,{children:[e(k,{icon:"lock"})," ",e("span",{children:"Follow"})]}):"Follow"})})]})]}),!!j&&e(Se,{class:"light",onClose:()=>{ee(!1)},children:e(ei,{note:b,fields:v,onClose:()=>ee(!1)})}),!!le&&e(Se,{class:"light",onClose:()=>{we(!1)},children:e(ti,{accountID:x.current,onClose:()=>we(!1)})}),!!Ie&&e(Se,{class:"light",onClose:()=>{Te(!1)},children:e(ni,{account:t,note:re,onRelationshipChange:q=>{h(q)},onClose:()=>Te(!1)})})]})}function Xs([t,n,o]){const i=.2126*t+.7152*n+.0722*o;let c;return i>=220?c=1:i<=50?c=.1:c=i/255,c=Math.min(1,c),[t,n,o,c]}function Qs(t){if(!t)return;const n=new URL(t),{host:o,pathname:i}=n,c=i.replace(/\/$/,"").replace(/^\//,"");return e(L,{children:[e("span",{class:"more-insignificant",children:[o,"/"]}),e("wbr",{}),e("span",{children:c})]})}function ei({note:t,fields:n,onClose:o}){const i=(n==null?void 0:n.map(({name:s,value:a})=>`${s}
${en(a)}`).join(`

`))||"",c=en(t)+(i?`

${i}`:"");return e("div",{class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close",onClick:o,children:e(k,{icon:"x"})}),e("header",{children:e("h2",{children:"Translated Bio"})}),e("main",{children:[e("p",{style:{whiteSpace:"pre-wrap"},children:c}),e(An,{forceTranslate:!0,text:c})]})]})}function ti({accountID:t,onClose:n}){const{masto:o}=z(),[i,c]=C("default"),[s,a]=C([]),[r,l]=C([]),[d,u]=Ct(f=>f+1,0);O(()=>{c("loading"),(async()=>{try{const f=await o.v1.lists.list();f.sort((g,w)=>g.title.localeCompare(w.title));const y=await o.v1.accounts.$select(t).lists.list();a(f),l(y),c("default")}catch{c("error")}})()},[d]);const[h,m]=C(!1);return e("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(k,{icon:"x"})}),e("header",{children:e("h2",{children:"Add/Remove from Lists"})}),e("main",{children:[s.length>0?e("ul",{class:"list-add-remove",children:s.map(f=>{const y=r.some(g=>g.id===f.id);return e("li",{children:e("button",{type:"button",class:`light ${y?"checked":""}`,disabled:i==="loading",onClick:()=>{c("loading"),(async()=>{try{y?await o.v1.lists.$select(f.id).accounts.remove({accountIds:[t]}):await o.v1.lists.$select(f.id).accounts.create({accountIds:[t]}),u()}catch{c("error"),alert(y?"Unable to remove from list.":"Unable to add to list.")}})()},children:[e(k,{icon:"check-circle"}),e("span",{children:f.title})]})})})}):i==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):i==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists."}),e("button",{type:"button",class:"plain2",onClick:()=>m(!0),disabled:i!=="default",children:[e(k,{icon:"plus",size:"l"})," ",e("span",{children:"New list"})]})]}),h&&e(Se,{class:"light",onClick:f=>{f.target===f.currentTarget&&m(!1)},children:e(Wt,{list:h==null?void 0:h.list,onClose:f=>{f.state==="success"&&u(),m(!1)}})})]})}function ni({account:t,note:n,onRelationshipChange:o=()=>{},onClose:i=()=>{}}){const{masto:c}=z(),[s,a]=C("default"),r=_(null);return O(()=>{let l;return r.current&&!n&&(l=setTimeout(()=>{var d,u;(u=(d=r.current).focus)==null||u.call(d)},100)),()=>{clearTimeout(l)}},[]),e("div",{class:"sheet",id:"private-note-container",children:[!!i&&e("button",{type:"button",class:"sheet-close",onClick:i,children:e(k,{icon:"x"})}),e("header",{children:e("b",{children:["Private note about @",(t==null?void 0:t.username)||(t==null?void 0:t.acct)]})}),e("main",{children:e("form",{onSubmit:l=>{l.preventDefault();const u=new FormData(l.target).get("note");(u==null?void 0:u.trim())!==(n==null?void 0:n.trim())&&(a("loading"),(async()=>{try{const h=await c.v1.accounts.$select(t==null?void 0:t.id).note.create({comment:u});a("default"),o(h),i()}catch(h){a("error"),alert((h==null?void 0:h.message)||"Unable to update private note.")}})())},children:[e("textarea",{ref:r,name:"note",disabled:s==="loading",children:n}),e("footer",{children:[e("button",{type:"button",class:"light",disabled:s==="loading",onClick:()=>{i==null||i()},children:"Cancel"}),e("span",{children:[e(ve,{abrupt:!0,hidden:s!=="loading"}),e("button",{disabled:s==="loading",type:"submit",children:"Save & close"})]})]})]})})]})}function si({account:t,instance:n,onClose:o}){const{masto:i,instance:c,authenticated:s}=z({instance:n}),a=typeof t=="string";return O(()=>{a||(S.accounts[`${t.id}@${c}`]=t)},[t]),Vn(o),e("div",{class:"sheet",children:[!!o&&e("button",{type:"button",class:"sheet-close outer",onClick:o,children:e(k,{icon:"x"})}),e(Gn,{instance:c,authenticated:s,account:t,fetchAccount:async()=>{if(a)try{return await i.v1.accounts.lookup({acct:t,skip_webfinger:!1})}catch{const l=await i.v2.search.fetch({q:t,type:"accounts",limit:1,resolve:s});if(l.accounts.length)return l.accounts[0];if(/https?:\/\/[^/]+\/@/.test(t)){const u=new URL(t).pathname.replace(/^\//,""),h=await i.v2.search.fetch({q:u,type:"accounts",limit:1,resolve:s});if(h.accounts.length)return h.accounts[0]}}else return t}})]})}function ii({onClose:t}){const{masto:n}=z(),[o,i]=C("default"),[c,s]=C([]),[a,r]=Ct(d=>d+1,0);O(()=>{i("loading"),(async()=>{try{const d=await lt.drafts.keys();if(d.length){const u=Rn(),h=d.filter(m=>m.startsWith(u));if(h.length){const m=await lt.drafts.getMany(h);m.sort((f,y)=>new Date(y.updatedAt).getTime()-new Date(f.updatedAt).getTime()),s(m)}else s([])}else s([]);i("default")}catch{i("error")}})()},[a]);const l=(c==null?void 0:c.length)>0;return e("div",{class:"sheet",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(k,{icon:"x"})}),e("header",{children:[e("h2",{children:["Unsent drafts ",e(ve,{abrupt:!0,hidden:o!=="loading"})]}),l&&e("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),e("main",{children:l?e(L,{children:[e("ul",{class:"drafts-list",children:c.map(d=>{const{updatedAt:u,key:h,draftStatus:m,replyTo:f}=d,y=new Date(u);return e("li",{children:[e("div",{class:"mini-draft-meta",children:[e("b",{children:[e(k,{icon:f?"reply":"quill",size:"s"})," ",e("time",{children:[!!f&&e(L,{children:["@",f.account.acct,e("br",{})]}),Ye(y)]})]}),e(Fe,{confirmLabel:e("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:o==="loading",onClick:()=>{(async()=>{try{await lt.drafts.del(h),r()}catch{alert("Error deleting draft! Please try again.")}})()},children:e("button",{type:"button",class:"small light",disabled:o==="loading",children:"Delete…"})})]}),e("button",{type:"button",disabled:o==="loading",class:"draft-item",onClick:async()=>{let g;if(f){i("loading");try{g=await n.v1.statuses.$select(f.id).fetch()}catch{alert("Error fetching reply-to status!"),i("default");return}i("default")}window.__COMPOSE__={draftStatus:m,replyToStatus:g},S.showCompose=!0,S.showDrafts=!1},children:e(oi,{draft:d})})]},u)})}),c.length>1&&e("p",{children:e(Fe,{confirmLabel:e("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:o==="loading",onClick:()=>{(async()=>{i("loading");try{await lt.drafts.delMany(c.map(d=>d.key)),i("default"),r()}catch{alert("Error deleting drafts! Please try again."),i("error")}})()},children:e("button",{type:"button",class:"light danger",disabled:o==="loading",children:"Delete all…"})})})]}):e("p",{children:"No drafts found."})})]})}function oi({draft:t}){var h;const{draftStatus:n,replyTo:o}=t,{status:i,spoilerText:c,poll:s,mediaAttachments:a}=n,r=((h=s==null?void 0:s.options)==null?void 0:h.length)>0,l=(a==null?void 0:a.length)>0,d=r||l,u=ue(()=>{if(!l)return;const m=a.find(g=>/image/.test(g.type));if(!m)return;const{file:f}=m;return URL.createObjectURL(f)},[l,a]);return e(L,{children:e("div",{class:"mini-draft",children:[d&&e("div",{class:`mini-draft-aside ${u?"has-image":""}`,style:u?{"--bg-image":`url(${u})`}:{},children:[r&&e(k,{icon:"poll"}),l&&e("span",{children:[e(k,{icon:"attachment"})," ",e("small",{children:a==null?void 0:a.length})]})]}),e("div",{class:"mini-draft-main",children:[!!c&&e("div",{class:"mini-draft-spoiler",children:c}),!!i&&e("div",{class:"mini-draft-status",children:i})]})]})})}async function Kt(t,n={}){if(!(t!=null&&t.length))return;const{masto:o}=z(),i=ne.session.get("currentAccount"),c=t.reduce((s,a)=>(!s.includes(a.id)&&!n[a.id]&&a.id!==i&&s.push(a.id),s),[]);if(!c.length)return null;try{return(await o.v1.accounts.relationships.fetch({id:c})).reduce((r,l)=>(r[l.id]=l,r),{})}catch{return null}}function ci({instance:t,excludeRelationshipAttrs:n=[],onClose:o=()=>{}}){const{masto:i,instance:c}=z(),s=t?t===c:!0,a=ge(S),[r,l]=C("default"),[d,u]=C([]),[h,m]=C(!1);if(Vn(o),!a.showGenericAccounts)return null;const{id:f,heading:y,fetchAccounts:g,accounts:w,showReactions:p}=a.showGenericAccounts,[b,v]=C({}),T=async D=>{if(!(D!=null&&D.length)||!s)return;const U=await Kt(D,b);U&&v({...b,...U})},x=D=>{g&&(D&&u([]),l("loading"),(async()=>{try{const{done:U,value:B}=await g(D);if(Array.isArray(B)){if(D){const P=[];for(let M=0;M<B.length;M++){const $=B[M],A=P.find((N,G)=>N.id===$.id&&M!==G);A?A._types.push(...$._types):P.push({_types:[],...$})}u(P)}else u(P=>{const M=P;for(const $ of B){const A=M.find(N=>N.id===$.id);A?A._types.push(...$._types):M.push($)}return M});m(!U),T(B)}else m(!1);l("default")}catch{l("error")}})())},E=_(!0);return O(()=>{(w==null?void 0:w.length)>0?(u(w),T(w)):(x(!0),E.current=!1)},[w,g]),O(()=>{var D;E.current||((D=a.reloadGenericAccounts)==null?void 0:D.id)===f&&x(!0)},[a.reloadGenericAccounts.counter]),e("div",{id:"generic-accounts-container",class:"sheet",tabindex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:o,children:e(k,{icon:"x"})}),e("header",{children:e("h2",{children:y||"Accounts"})}),e("main",{children:d.length>0?e(L,{children:[e("ul",{class:"accounts-list",children:d.map(D=>{var P,M;const U=b[D.id],B=`${D.id}-${((P=D._types)==null?void 0:P.length)||""}`;return e("li",{children:[p&&((M=D._types)==null?void 0:M.length)>0&&e("div",{class:"reactions-block",children:D._types.map($=>e(k,{icon:{reblog:"rocket",favourite:"heart"}[$],class:`${$}-icon`}))}),e("div",{class:"account-relationships",children:e(qe,{account:D,showStats:!0,relationship:U,excludeRelationshipAttrs:n})})]},B)})}),r==="default"?h?e(at,{onChange:D=>{D&&x()},children:e("button",{type:"button",class:"plain block",onClick:()=>x(),children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):r==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})})]}):r==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):r==="error"?e("p",{class:"ui-state",children:"Error loading accounts"}):e("p",{class:"ui-state insignificant",children:"Nothing to show"})})]})}function ai({alt:t,lang:n,onClose:o}){const i=ge(S),[c,s]=C(!1),a=xn(!0),r=i.settings.contentTranslationHideLanguages||[],l=!!n&&n!==a&&!tn([n],[a])&&!r.find(d=>n===d||tn([n],[d]));return e("div",{class:"sheet",tabindex:"-1",children:[!!o&&e("button",{type:"button",class:"sheet-close outer",onClick:o,children:e(k,{icon:"x"})}),e("header",{class:"header-grid",children:[e("h2",{children:"Media description"}),e("div",{class:"header-side",children:e(Ne,{align:"end",menuButton:e("button",{type:"button",class:"plain4",children:e(k,{icon:"more",alt:"More",size:"xl"})}),children:e(se,{disabled:c,onClick:()=>{s(!0)},children:[e(k,{icon:"translate"}),e("span",{children:"Translate"})]})})})]}),e("main",{lang:n,dir:"auto",children:[e("p",{style:{whiteSpace:"pre-wrap",textWrap:"pretty"},children:t}),(l||c)&&e(An,{forceTranslate:c,sourceLanguage:n,text:t})]})]})}function Lt(t,n,o){return Math.max(Math.min(t,o),n)}const At=t=>t>=.04045?Math.pow((t+.055)/1.055,2.4):t/12.92,Rt=t=>t>=.0031308?1.055*Math.pow(t,1/2.4)-.055:12.92*t;function Wn([t,n,o]){t=At(t/255),n=At(n/255),o=At(o/255);var i=.4122214708*t+.5363325363*n+.0514459929*o,c=.2119034982*t+.6806995451*n+.1073969566*o,s=.0883024619*t+.2817188376*n+.6299787005*o;return i=Math.cbrt(i),c=Math.cbrt(c),s=Math.cbrt(s),[i*.2104542553+c*.793617785+s*-.0040720468,i*1.9779984951+c*-2.428592205+s*.4505937099,i*.0259040371+c*.7827717662+s*-.808675766]}function Kn([t,n,l]){var i=t+n*.3963377774+l*.2158037573,c=t+n*-.1055613458+l*-.0638541728,s=t+n*-.0894841775+l*-1.291485548;i=i**3,c=c**3,s=s**3;var a=i*4.0767416621+c*-3.3077115913+s*.2309699292,r=i*-1.2684380046+c*2.6097574011+s*-.3413193965,l=i*-.0041960863+c*-.7034186147+s*1.707614701;return a=255*Rt(a),r=255*Rt(r),l=255*Rt(l),a=Lt(a,0,255),r=Lt(r,0,255),l=Lt(l,0,255),a=Math.round(a),r=Math.round(r),l=Math.round(l),[a,r,l]}function Zn({mediaAttachments:t,statusID:n,instance:o,lang:i,index:c=0,onClose:s=()=>{}}){var g,w;const a=_(null),[r,l]=C(c),d=_(null);Ve(()=>{var p;(p=d.current)==null||p.scrollIntoView()},[]);const u=_(n);O(()=>{const p=c*a.current.clientWidth,b=u.current!==n;b&&(u.current=n),a.current.scrollTo({left:p,behavior:b?"auto":"smooth"}),a.current.focus()},[c,n]);const[h,m]=C(!0);O(()=>{let p=()=>{s()};return a.current&&a.current.addEventListener("swiped-down",p),()=>{a.current&&a.current.removeEventListener("swiped-down",p)}},[]),Le("esc",s,{ignoreEventWhen:p=>!!document.querySelector("#modal-container > *")},[s]),O(()=>{let p=()=>{const{clientWidth:b,scrollLeft:v}=a.current,T=Math.round(v/b);l(T)};return a.current&&a.current.addEventListener("scroll",p,{passive:!0}),()=>{a.current&&a.current.removeEventListener("scroll",p)}},[]),O(()=>{let p=setTimeout(()=>{var b,v;(v=(b=a.current)==null?void 0:b.focus)==null||v.call(b)},100);return()=>clearTimeout(p)},[]);const f=ue(()=>t==null?void 0:t.map(p=>{const{blurhash:b}=p;if(b){const v=Nn(b),T=Wn(v);return Kn([.6,T[1],T[2]])}return null}),[t]),y=ue(()=>{var v;const b=100/f.length;return((v=f==null?void 0:f.map((T,x)=>{const E=x*b+5,D=(x+1)*b-5;return T?`
            rgba(${T==null?void 0:T.join(",")}, 0.4) ${E}%,
            rgba(${T==null?void 0:T.join(",")}, 0.4) ${D}%
          `:`
            transparent ${E}%,
            transparent ${D}%
          `}))==null?void 0:v.join(", "))||"transparent"},[f]);return e("div",{class:`media-modal-container media-modal-count-${t==null?void 0:t.length}`,children:[e("div",{ref:a,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:p=>{(p.target.classList.contains("carousel-item")||p.target.classList.contains("media")||p.target.classList.contains("media-zoom"))&&s()},style:t.length>1?{backgroundAttachment:"local",backgroundImage:`linear-gradient(
            to right, ${y})`}:{},children:t==null?void 0:t.map((p,b)=>{const v=t.length===1?f[b]:null;return e("div",{class:"carousel-item",style:v?{"--accent-color":`rgb(${v==null?void 0:v.join(",")})`,"--accent-alpha-color":`rgba(${v==null?void 0:v.join(",")}, 0.4)`}:{},tabindex:"0",ref:b===r?d:null,onClick:T=>{T.target.classList.contains("media")||m(!h)},children:[!!p.description&&e("button",{type:"button",class:"media-alt",hidden:!h,onClick:()=>{S.showMediaAlt={alt:p.description,lang:i}},children:[e("span",{class:"alt-badge",children:"ALT"}),e("span",{class:"media-alt-desc",lang:i,dir:"auto",children:p.description})]}),e(En,{media:p,showOriginal:!0,lang:i})]},p.id)})}),e("div",{class:"carousel-top-controls",hidden:!h,children:[e("span",{children:e("button",{type:"button",class:"carousel-button",onClick:()=>s(),children:e(k,{icon:"x"})})}),(t==null?void 0:t.length)>1?e("span",{class:"carousel-dots",children:t==null?void 0:t.map((p,b)=>e("button",{type:"button",disabled:b===r,class:`carousel-dot ${b===r?"active":""}`,onClick:v=>{v.preventDefault(),v.stopPropagation(),a.current.scrollTo({left:a.current.clientWidth*b,behavior:"smooth"}),a.current.focus()},children:e(k,{icon:"round",size:"s"})},p.id))}):e("span",{}),e("span",{children:[e(Ne,{overflow:"auto",align:"end",position:"anchor",gap:4,menuClassName:"glass-menu",menuButton:e("button",{type:"button",class:"carousel-button",children:e(k,{icon:"more",alt:"More"})}),children:e(Re,{href:((g=t[r])==null?void 0:g.remoteUrl)||((w=t[r])==null?void 0:w.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[e(k,{icon:"popout"}),e("span",{children:"Open original media"})]})})," ",e(J,{to:`${o?`/${o}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${r+1}`:""}`,class:"button carousel-button media-post-link",children:[e("span",{class:"button-label",children:"View post "}),"»"]})]})]}),(t==null?void 0:t.length)>1&&e("div",{class:"carousel-controls",hidden:!h,children:[e("button",{type:"button",class:"carousel-button",hidden:r===0,onClick:p=>{p.preventDefault(),p.stopPropagation(),a.current.focus(),a.current.scrollTo({left:a.current.clientWidth*(r-1),behavior:"smooth"})},children:e(k,{icon:"arrow-left"})}),e("button",{type:"button",class:"carousel-button",hidden:r===t.length-1,onClick:p=>{p.preventDefault(),p.stopPropagation(),a.current.focus(),a.current.scrollTo({left:a.current.clientWidth*(r+1),behavior:"smooth"})},children:e(k,{icon:"arrow-right"})})]})]})}const ri="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%234169E1'%20d='M14%2052a4%204%200%201%201-8%200%204%204%200%200%201%208%200Zm64-42a4%204%200%201%201-8%200%204%204%200%200%201%208%200Z'/%3e%3c/svg%3e",li="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2082%2062'%3e%3crect%20width='78'%20height='58'%20x='2'%20y='2'%20fill='%23999'%20fill-opacity='.3'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3crect%20width='18'%20height='46'%20x='8'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='32'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3crect%20width='18'%20height='46'%20x='56'%20y='8'%20fill='%23fff'%20stroke='%23999'%20stroke-width='2'%20rx='1'/%3e%3c/svg%3e",di="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20fill='none'%20viewBox='0%200%2084%2062'%3e%3crect%20width='64'%20height='48'%20x='18'%20y='2'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M19%203h62v10H19z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M43%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M52%208a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3crect%20width='32'%20height='48'%20x='2'%20y='12'%20fill='%23fff'%20stroke='%23999'%20stroke-width='3'%20rx='4'/%3e%3cpath%20fill='%23999'%20fill-opacity='.3'%20d='M3%2049h30v10H3z'/%3e%3cpath%20stroke='%234169E1'%20stroke-width='2'%20d='M11%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3cpath%20stroke='%23999'%20stroke-width='2'%20d='M20%2054a2%202%200%201%201-4%200%202%202%200%200%201%204%200Zm9%200a2%202%200%201%201-4%200%202%202%200%200%201%204%200Z'/%3e%3c/svg%3e",ui=200,hi=10;async function It(){const{masto:t}=z(),n=t.v1.followedTags.list({limit:ui}),o=[];let i=0;do{const{value:c,done:s}=await n.next();if(s||(c==null?void 0:c.length)===0)break;o.push(...c),i++}while(i<hi);return o.sort((c,s)=>c.name.localeCompare(s.name)),o.length&&setTimeout(()=>{ne.account.set("followedTags",{tags:o,updatedAt:Date.now()})},1),o}const fi=24*60*60*1e3;async function pi(){try{const{tags:t,updatedAt:n}=ne.account.get("followedTags")||{};return t!=null&&t.length?(Date.now()-n>fi&&It(),t):await It()}catch{return[]}}const pn=document.createElement("div"),mi=t=>{if(!t)return[];if(t.indexOf("#")===-1)return[];pn.innerHTML=t;const n=pn.querySelectorAll("a.hashtag");return n.length?Array.from(n).map(o=>o.innerText.trim().replace(/^[^#]*#+/,"")):[]};function Ut({children:t}){if(typeof t=="string")return t;const[n,o]=C("");return O(()=>{Promise.resolve(t).then(o)},[t]),n}const Je=9,gi=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],Yn={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Likes",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},wt={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Media only",name:"media",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},bi=tt(async({id:t})=>(await z().masto.v1.lists.$select(t).fetch()).title),yi=tt(async({id:t})=>{const n=await z().masto.v1.accounts.$select(t).fetch();return n.username||n.acct||n.displayName}),Tt={following:{id:"home",title:(t,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:bi,path:({id:t})=>`/l/${t}`,icon:"list"},public:{id:"public",title:({local:t})=>t?"Local":"Federated",subtitle:({instance:t})=>t||z().instance,path:({local:t,instance:n})=>`/${n}/p${t?"/l":""}`,icon:({local:t})=>t?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:t})=>t||z().instance,path:({instance:t})=>`/${t}/trending`,icon:"chart"},search:{id:"search",title:({query:t})=>t,path:({query:t})=>`/search?q=${t}`,icon:"search"},"account-statuses":{id:"account-statuses",title:yi,path:({id:t})=>`/a/${t}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Likes",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:t})=>t,subtitle:({instance:t})=>t||z().instance,path:({hashtag:t,instance:n,media:o})=>`${n?`/${n}`:""}/t/${t.split(/\s+/).join("+")}${o?"?media=1":""}`,icon:"hashtag"}};function wi({onClose:t}){const n=ge(S),{shortcuts:o}=n,[i,c]=C(!1),[s,a]=C(!1),[r]=Ht();return e("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!t&&e("button",{type:"button",class:"sheet-close",onClick:t,children:e(k,{icon:"x"})}),e("header",{children:e("h2",{children:[e(k,{icon:"shortcut"})," Shortcuts"," ",e("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),e("main",{children:[e("p",{children:"Specify a list of shortcuts that'll appear as:"}),e("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:ri},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:di},{value:"multi-column",label:"Multi-column",imgURL:li}].map(({value:l,label:d,imgURL:u})=>{const h=n.settings.shortcutsViewMode===l||l==="float-button"&&!n.settings.shortcutsViewMode;return e("label",{class:h?"checked":"",children:[e("input",{type:"radio",name:"shortcuts-view-mode",value:l,checked:h,onChange:m=>{S.settings.shortcutsViewMode=m.target.value}})," ",e("img",{src:u,alt:"",width:"80",height:"58"})," ",e("span",{children:d})]},l)})}),o.length>0?e("ol",{class:"shortcuts-list",ref:r,children:o.filter(Boolean).map((l,d)=>{const u=Object.values(l).join("-"),{type:h}=l;if(!Tt[h])return null;let{icon:m,title:f,subtitle:y}=Tt[h];return typeof f=="function"&&(f=f(l,d)),typeof y=="function"&&(y=y(l,d)),typeof m=="function"&&(m=m(l,d)),e("li",{children:[e(k,{icon:m}),e("span",{class:"shortcut-text",children:[e(Ut,{children:f}),y&&e(L,{children:[" ",e("small",{class:"ib insignificant",children:y})]})]}),e("span",{class:"shortcut-actions",children:[e("button",{type:"button",class:"plain small",disabled:d===0,onClick:()=>{const g=Array.from(S.shortcuts);if(d>0){const w=S.shortcuts[d-1];g[d-1]=l,g[d]=w,S.shortcuts=g}},children:e(k,{icon:"arrow-up",alt:"Move up"})}),e("button",{type:"button",class:"plain small",disabled:d===o.length-1,onClick:()=>{const g=Array.from(S.shortcuts);if(d<S.shortcuts.length-1){const w=S.shortcuts[d+1];g[d+1]=l,g[d]=w,S.shortcuts=g}},children:e(k,{icon:"arrow-down",alt:"Move down"})}),e("button",{type:"button",class:"plain small",onClick:()=>{c({shortcut:l,shortcutIndex:d})},children:e(k,{icon:"pencil",alt:"Edit"})})]})]},u)})}):e("div",{class:"ui-state insignificant",children:[e("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),e("p",{children:["Not sure what to add?",e("br",{}),"Try adding"," ",e("a",{href:"#",onClick:l=>{l.preventDefault(),S.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),e("p",{class:"insignificant",children:o.length>=Je&&`Max ${Je} shortcuts`}),e("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e("button",{type:"button",class:"light",onClick:()=>a(!0),children:"Import/export"}),e("button",{type:"button",disabled:o.length>=Je,onClick:()=>c(!0),children:[e(k,{icon:"plus"})," ",e("span",{children:"Add shortcut"})]})]})]}),i&&e(Se,{class:"light",onClick:l=>{l.target===l.currentTarget&&c(!1)},children:e(Si,{shortcut:i.shortcut,shortcutIndex:i.shortcutIndex,onSubmit:({result:l,mode:d})=>{d==="edit"?S.shortcuts[i.shortcutIndex]=l:S.shortcuts.push(l)},onClose:()=>c(!1)})}),s&&e(Se,{class:"light",onClick:l=>{l.target===l.currentTarget&&a(!1)},children:e(Ii,{shortcuts:o,onClose:()=>a(!1)})})]})}const vi=1e3*60,ki=tt(()=>{const{masto:t}=z();return t.v1.lists.list()},{maxAge:vi});function Si({onSubmit:t,disabled:n,shortcut:o,shortcutIndex:i,onClose:c}){var w,p;const s=!!o,[a,r]=C((o==null?void 0:o.type)||null),{masto:l}=z(),[d,u]=C("default"),[h,m]=C([]),[f,y]=C([]);O(()=>{(async()=>{if(a==="list")try{u("loading");const b=await ki();b.sort((v,T)=>v.title.localeCompare(T.title)),m(b),u("default")}catch{u("error")}})(),(async()=>{if(a==="hashtag")try{const b=await It();y(b)}catch{}})()},[a]);const g=_();return O(()=>{if(s&&a&&wt[a]){const b=g.current;wt[a].forEach(({name:v,type:T})=>{const x=b.querySelector(`[name="${v}"]`);x&&o[v]&&(T==="checkbox"?x.checked=o[v]==="on":x.value=o[v])})}},[s,a]),e("div",{id:"shortcut-settings-form",class:"sheet",children:[!!c&&e("button",{type:"button",class:"sheet-close",onClick:c,children:e(k,{icon:"x"})}),e("header",{children:e("h2",{children:[s?"Edit":"Add"," shortcut"]})}),e("main",{tabindex:"-1",children:e("form",{ref:g,onSubmit:b=>{b.preventDefault();const v=new FormData(b.target),T={};v.forEach((x,E)=>{T[E]=x==null?void 0:x.trim(),E==="instance"&&(T[E]=T[E].replace(/^https?:\/\//,"").replace(/\/+$/,""),T[E]=T[E].replace(/^@?[^@]+@/,""))}),T.type&&(t({result:T,mode:s?"edit":"add"}),b.target.reset(),r(null),c==null||c())},children:[e("p",{children:e("label",{children:[e("span",{children:"Timeline"}),e("select",{required:!0,disabled:n,onChange:b=>{r(b.target.value)},defaultValue:s?o.type:void 0,name:"type",children:[e("option",{}),gi.map(b=>e("option",{value:b,children:Yn[b]}))]})]})}),(p=(w=wt[a])==null?void 0:w.map)==null?void 0:p.call(w,({text:b,name:v,type:T,placeholder:x,pattern:E,notRequired:D})=>a==="list"?e("p",{children:e("label",{children:[e("span",{children:"List"}),e("select",{name:"id",required:!D,disabled:n||d==="loading",defaultValue:s?o.id:void 0,children:h.map(U=>e("option",{value:U.id,children:U.title}))})]})}):e("p",{children:e("label",{children:[e("span",{children:b})," ",e("input",{type:T,name:v,placeholder:x,required:T==="text"&&!D,disabled:n,list:a==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:E}),a==="hashtag"&&f.length>0&&e("datalist",{id:"followed-hashtags-datalist",children:f.map(U=>e("option",{value:U.name}))})]})})),e("footer",{children:[e("button",{type:"submit",class:"block",disabled:n||d==="loading",children:s?"Save":"Add"}),s&&e("button",{type:"button",class:"light danger",onClick:()=>{S.shortcuts.splice(i,1),c==null||c()},children:"Remove"})]})]})})]})}function Ii({shortcuts:t,onClose:n}){var d;const o=ue(()=>!t||!t.filter(Boolean).length?"":cn.compressToEncodedURIComponent(JSON.stringify(t.filter(Boolean))),[t]),[i,c]=C(""),[s,a]=C("default"),r=ue(()=>{if(!i)return a("default"),null;try{const u=JSON.parse(cn.decompressFromEncodedURIComponent(i));if(!Array.isArray(u))throw new Error("Not an array");return a("default"),u}catch{try{const h=JSON.parse(i);if(!Array.isArray(h))throw new Error("Not an array");return a("default"),h}catch{return a("error"),null}}},[i]),l=S.shortcuts.length>0;return e("div",{id:"import-export-container",class:"sheet",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(k,{icon:"x"})}),e("header",{children:e("h2",{children:["Import/Export ",e("small",{class:"ib insignificant",children:"Shortcuts"})]})}),e("main",{tabindex:"-1",children:[e("section",{children:[e("h3",{children:[e(k,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Import"})]}),e("p",{children:e("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:u=>{c(u.target.value)}})}),!!r&&Array.isArray(r)&&e(L,{children:[e("p",{children:[e("b",{children:r.length})," shortcut",r.length>1?"s":""," ",e("small",{class:"insignificant",children:["(",i.length," characters)"]})]}),e("ol",{class:"import-settings-list",children:r.map(u=>{var h,m;return e("li",{children:[e("span",{style:{opacity:t.some(f=>Object.keys(f).every(y=>f[y]===u[y]))?1:0},children:"*"}),e("span",{children:[Yn[u.type],u.type==="list"&&" ⚠️"," ",(m=(h=wt[u.type])==null?void 0:h.map)==null?void 0:m.call(h,({text:f,name:y,type:g})=>u[y]?e(L,{children:[e("span",{class:"tag collapsed insignificant",children:[f,":"," ",g==="checkbox"?u[y]==="on"?"✅":"❌":u[y]]})," "]}):null)]})]})})}),e("p",{children:[e("small",{children:"* Exists in current shortcuts"}),e("br",{}),e("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&e("p",{class:"error",children:e("small",{children:"⚠️ Invalid settings format"})}),e("p",{children:[l&&e(L,{children:[e(Fe,{confirmLabel:"Append to current shortcuts?",menuFooter:e("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const u=r.filter(f=>!S.shortcuts.some(y=>Object.keys(y).every(g=>y[g]===f[g])));if(!u.length){de("No new shortcuts to import");return}let h=[...S.shortcuts,...u];const m=h.length>Je;m&&(h=h.slice(0,Je)),S.shortcuts=h,de(m?`Shortcuts imported. Exceeded max ${Je}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:"Import & append…"})})," "]}),e(Fe,{confirmLabel:l?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:l?"danger":void 0,onClick:()=>{S.shortcuts=r,de("Shortcuts imported"),n==null||n()},children:e("button",{type:"button",class:"plain2",disabled:!r,children:l?"or override…":"Import…"})})]})]}),e("section",{children:[e("h3",{children:[e(k,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",e("span",{children:"Export"})]}),e("p",{children:e("input",{style:{width:"100%"},type:"text",value:o,readOnly:!0,onClick:u=>{if(u.target.value){u.target.select();try{navigator.clipboard.writeText(u.target.value),de("Shortcuts copied")}catch{de("Unable to copy shortcuts")}}}})}),e("p",{children:[e("button",{type:"button",class:"plain2",disabled:!o,onClick:()=>{try{navigator.clipboard.writeText(o),de("Shortcut settings copied")}catch{de("Unable to copy shortcut settings")}},children:[e(k,{icon:"clipboard"})," ",e("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:o}))&&e("button",{type:"button",class:"plain2",disabled:!o,onClick:()=>{try{navigator.share({text:o})}catch{alert("Sharing doesn't seem to work.")}},children:[e(k,{icon:"share"})," ",e("span",{children:"Share"})]})," ",o.length>0&&e("small",{class:"insignificant",children:[o.length," characters"]})]}),!!o&&e("details",{children:[e("summary",{class:"insignificant",children:e("small",{children:"Raw Shortcuts JSON"})}),e("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(t.filter(Boolean),null,2)})]})]})]})]})}Un(S,t=>{for(const[n,o,i,c]of t)/^show/i.test(o)&&!i&&Nt()});function Ti(){var i,c,s,a,r,l,d,u;const t=ge(S),n=Fn(),o=ct();return e(L,{children:[!!t.showCompose&&e(Se,{children:e(hs,{replyToStatus:typeof t.showCompose!="boolean"?t.showCompose.replyToStatus:((i=window.__COMPOSE__)==null?void 0:i.replyToStatus)||null,editStatus:((c=S.showCompose)==null?void 0:c.editStatus)||((s=window.__COMPOSE__)==null?void 0:s.editStatus)||null,draftStatus:((a=S.showCompose)==null?void 0:a.draftStatus)||((r=window.__COMPOSE__)==null?void 0:r.draftStatus)||null,onClose:h=>{const{newStatus:m,instance:f,type:y}=h||{};S.showCompose=!1,window.__COMPOSE__=null,m&&(S.reloadStatusPage++,de({text:{post:"Post published. Check it out.",reply:"Reply posted. Check it out.",edit:"Post updated. Check it out."}[y||"post"],delay:1e3,duration:1e4,onClick:g=>{g.hideToast(),S.prevLocation=o,n(f?`/${f}/s/${m.id}`:`/s/${m.id}`)}}))}})}),!!t.showSettings&&e(Se,{onClose:()=>{S.showSettings=!1},children:e(Hs,{onClose:()=>{S.showSettings=!1}})}),!!t.showAccounts&&e(Se,{onClose:()=>{S.showAccounts=!1},children:e(Us,{onClose:()=>{S.showAccounts=!1}})}),!!t.showAccount&&e(Se,{class:"light",onClose:()=>{S.showAccount=!1},children:e(si,{account:((l=t.showAccount)==null?void 0:l.account)||t.showAccount,instance:(d=t.showAccount)==null?void 0:d.instance,onClose:({destination:h}={})=>{S.showAccount=!1}})}),!!t.showDrafts&&e(Se,{onClose:()=>{S.showDrafts=!1},children:e(ii,{onClose:()=>S.showDrafts=!1})}),!!t.showMediaModal&&e(Se,{onClick:h=>{(h.target===h.currentTarget||h.target.classList.contains("media"))&&(S.showMediaModal=!1)},children:e(Zn,{mediaAttachments:t.showMediaModal.mediaAttachments,instance:t.showMediaModal.instance,index:t.showMediaModal.index,statusID:t.showMediaModal.statusID,onClose:()=>{S.showMediaModal=!1}})}),!!t.showShortcutsSettings&&e(Se,{class:"light",onClose:()=>{S.showShortcutsSettings=!1},children:e(wi,{onClose:()=>S.showShortcutsSettings=!1})}),!!t.showGenericAccounts&&e(Se,{class:"light",onClose:()=>{S.showGenericAccounts=!1},children:e(ci,{instance:t.showGenericAccounts.instance,excludeRelationshipAttrs:t.showGenericAccounts.excludeRelationshipAttrs,onClose:()=>S.showGenericAccounts=!1})}),!!t.showMediaAlt&&e(Se,{class:"light",onClose:h=>{S.showMediaAlt=!1},children:e(ai,{alt:t.showMediaAlt.alt||t.showMediaAlt,lang:(u=t.showMediaAlt)==null?void 0:u.lang,onClose:()=>{S.showMediaAlt=!1}})})]})}function Ft({accountID:t,onChange:n}){const{masto:o}=z(),[i,c]=C("default"),[s,a]=C(null),[r,l]=C(null),d=r!==null;return e("p",{class:"follow-request-buttons",children:[e("button",{type:"button",disabled:i==="loading"||d,onClick:()=>{c("loading"),a("accept"),(async()=>{try{const u=await o.v1.followRequests.$select(t).authorize();if(!(u!=null&&u.followedBy))throw new Error("Follow request not accepted");l(u),n()}catch{}c("default")})()},children:"Accept"})," ",e("button",{type:"button",disabled:i==="loading"||d,class:"light danger",onClick:()=>{c("loading"),a("reject"),(async()=>{try{const u=await o.v1.followRequests.$select(t).reject();if(u!=null&&u.followedBy)throw new Error("Follow request not rejected");l(u),n()}catch{c("default")}})()},children:"Reject"}),e("span",{class:"follow-request-states",children:d&&s?s==="accept"?e(k,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):e(k,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):e(ve,{hidden:i!=="loading"})})]})}const mn={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},st={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":t=>`boosted ${t} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"liked your post.","favourite+account":t=>`liked ${t} of your posts.`,favourite_reply:"liked your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & liked your post.","favourite+reblog+account":t=>`boosted & liked ${t} of your posts.`,"favourite+reblog_reply":"boosted & liked your reply.","admin.sign_up":"signed up.","admin.report":t=>e(L,{children:["reported ",t]})},Et=50;function $i({notification:t,instance:n,isStatic:o,disableContextMenu:i}){var D,U,B,P;const{id:c,status:s,account:a,report:r,_accounts:l,_statuses:d}=t;let{type:u}=t;const h=(s==null?void 0:s.reblog)||s,m=h==null?void 0:h.id,f=ne.session.get("currentAccount"),y=f===(a==null?void 0:a.id),g=(D=s==null?void 0:s.poll)==null?void 0:D.voted,w=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==f&&((U=s==null?void 0:s.account)==null?void 0:U.id)===f;let p=0,b=0;if(u==="favourite+reblog"){for(const M of l)(B=M._types)!=null&&B.includes("favourite")&&p++,(P=M._types)!=null&&P.includes("reblog")&&b++;!b&&p&&(u="favourite"),!p&&b&&(u="reblog")}let v;if(u==="poll"?v=st[y?"poll-self":g?"poll-voted":"poll"]:u==="reblog"||u==="favourite"||u==="favourite+reblog"?(d==null?void 0:d.length)>1?v=st[`${u}+account`]:w?v=st[`${u}_reply`]:v=st[u]:st[u]?v=st[u]:v=`[Unknown notification type: ${u}]`,typeof v=="function"){const M=(d==null?void 0:d.length)||(l==null?void 0:l.length);if(M)v=v(M);else if(u==="admin.report"){const $=r==null?void 0:r.targetAccount;$&&(v=v(e(St,{account:$,showAvatar:!0})))}}if(u==="mention"&&!s)return null;const T=t.createdAt&&new Date(t.createdAt).toLocaleString(),x={"favourite+reblog":"Boosted/Liked by…",favourite:"Liked by…",reblog:"Boosted by…",follow:"Followed by…"}[u]||"Accounts",E=()=>{S.showGenericAccounts={heading:x,accounts:l,showReactions:u==="favourite+reblog",excludeRelationshipAttrs:u==="follow"?["followedBy"]:[]}};return e("div",{class:`notification notification-${u}`,"data-notification-id":c,tabIndex:"0",children:[e("div",{class:`notification-type notification-${u}`,title:T,children:u==="favourite+reblog"?e(L,{children:[e(k,{icon:"rocket",size:"xl",alt:u,class:"reblog-icon"}),e(k,{icon:"heart",size:"xl",alt:u,class:"favourite-icon"})]}):e(k,{icon:mn[u]||"notification",size:"xl",alt:u})}),e("div",{class:"notification-content",children:[u!=="mention"&&e(L,{children:[e("p",{children:[!/poll|update/i.test(u)&&e(L,{children:(l==null?void 0:l.length)>1?e(L,{children:[e("b",{tabIndex:"0",onClick:E,children:[e("span",{title:l.length,children:_e(l.length)})," ","people"]})," "]}):e(L,{children:[e(St,{account:a,showAvatar:!0})," "]})}),v,u==="mention"&&e("span",{class:"insignificant",children:[" ","•"," ",e($t,{datetime:t.createdAt,format:"micro"})]})]}),u==="follow_request"&&e(Ft,{accountID:a.id})]}),(l==null?void 0:l.length)>1&&e("p",{class:"avatars-stack",children:[l.slice(0,Et).map(M=>e(L,{children:[e("a",{href:M.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:$=>{$.preventDefault(),S.showAccount=M},children:[e(et,{url:M.avatarStatic,size:l.length<=10?"xxl":l.length<20?"xl":l.length<30?"l":l.length<40?"m":"s",alt:`${M.displayName} @${M.acct}`,squircle:M==null?void 0:M.bot},M.id),u==="favourite+reblog"&&e("div",{class:"account-sub-icons",children:M._types.map($=>e(k,{icon:mn[$],size:"s",class:`${$}-icon`}))})]},M.id)," "]},M.id)),e("button",{type:"button",class:"small plain",onClick:E,children:[l.length>Et&&`+${l.length-Et}`,e(k,{icon:"chevron-down"})]})]}),(d==null?void 0:d.length)>1&&e("ul",{class:"notification-group-statuses",children:d.map(M=>e("li",{children:e(gn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${M.id}`:`/s/${M.id}`,children:e(Me,{status:M,size:"s"})})},M.id))}),s&&(!(d!=null&&d.length)||(d==null?void 0:d.length)<=1)&&e(gn,{class:`status-link status-type-${u}`,to:n?`/${n}/s/${m}`:`/s/${m}`,onContextMenu:i?void 0:M=>{const $=M.target.querySelector(".status");if($){if(M.metaKey)return;M.preventDefault(),$.dispatchEvent(new MouseEvent("contextmenu",{clientX:M.clientX,clientY:M.clientY}))}},children:o?e(Me,{status:h,size:"s"}):e(Me,{statusID:m,size:"s"})})]})]})}function gn(t){const n=fs();return e(J,{...t,"data-read-more":"Read more →",ref:n})}const Zt=ze($i),Ci=ze(function(){if(!("serviceWorker"in navigator))return null;const n=ge(S),{routeNotification:o}=n,{id:i,accessToken:c}=o||{},[s,a]=C(!1);Ve(()=>{if(!i||!c)return;const{instance:l}=z(),{masto:d,instance:u}=z({accessToken:c}),h=l===u,m=c?ps(c):ot();(async()=>{const f=await d.v1.notifications.$select(i).fetch();if(f&&m){const y=m.instanceURL,{type:g,status:w,account:p}=f,b=!!document.querySelector("#modal-container > *"),v=g==="follow"&&!!(p!=null&&p.id),T=!!(p!=null&&p.id),x=!!(w!=null&&w.id);v&&h?S.showAccount={account:p,instance:y}:b||!h||T&&x?a({id:i,account:m,notification:f,sameInstance:h}):x?location.hash=`/${l}/s/${w.id}`:v?location.hash=`/${l}/a/${p.id}`:location.hash="/notifications"}})()},[i,c]),Ve(()=>{const l=d=>{const{type:u,id:h,accessToken:m}=(d==null?void 0:d.data)||{};u==="notification"&&(S.routeNotification={id:h,accessToken:m})};return navigator.serviceWorker.addEventListener("message",l),()=>{navigator.serviceWorker.removeEventListener("message",l)}},[]),Ve(()=>{navigator!=null&&navigator.clearAppBadge&&navigator.clearAppBadge()},[]),ht(l=>{l&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const r=()=>{a(!1),S.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(s){const{id:l,account:d,notification:u,sameInstance:h}=s;return e(Se,{class:"light",onClick:m=>{m.target===m.currentTarget&&r()},children:e("div",{class:"sheet",tabIndex:"-1",children:[e("button",{type:"button",class:"sheet-close",onClick:r,children:e(k,{icon:"x"})}),e("header",{children:e("b",{children:"Notification"})}),e("main",{children:[!h&&e("p",{children:"This notification is from your other account."}),e("div",{class:"notification-peek",onClick:m=>{const{target:f}=m;(m.target.tagName==="BUTTON"||m.target.tagName==="A")&&r()},children:e(Zt,{instance:d.instanceURL,notification:u,isStatic:!0})}),e("div",{style:{textAlign:"end"},children:e(J,{to:"/notifications",class:"button light",onClick:r,children:[e("span",{children:"View all notifications"})," ",e(k,{icon:"arrow-right"})]})})]})]})})}return null}),Jn=Is((t,n)=>{const{instance:o}=z(),[i,c]=Oe(),[s,a]=C(!1),[r,l]=C(i.get("q")||""),d=i.get("type"),u=_(null),h=_(null);return Ss(n,()=>({setValue:m=>{l(m)},focus:()=>{h.current.focus()},select:()=>{h.current.select()},blur:()=>{h.current.blur()}})),e("form",{ref:u,class:"search-popover-container",onSubmit:m=>{var y;if(m.preventDefault(),/\/search/.test(location.hash))if(r){const g={q:r};d&&(g.type=d),c(g)}else c({});else r?location.hash=`/search?q=${encodeURIComponent(r)}${d?`&type=${d}`:""}`:location.hash="/search";(y=t==null?void 0:t.onSubmit)==null||y.call(t,m)},children:[e("input",{ref:h,value:r,name:"q",type:"search",placeholder:"Search",dir:"auto",autocomplete:"off",autocorrect:"off",autocapitalize:"off",onSearch:m=>{m.target.value||c({})},onInput:m=>{l(m.target.value),a(!0)},onFocus:()=>{a(!0)},onBlur:()=>{var m,f;setTimeout(()=>{a(!1)},100),(f=(m=u.current)==null?void 0:m.querySelector(".search-popover-item.focus"))==null||f.classList.remove("focus")},onKeyDown:m=>{var y;const{key:f}=m;switch(f){case"Escape":a(!1);break;case"Down":case"ArrowDown":if(m.preventDefault(),s){const g=u.current.querySelector(".search-popover-item.focus");if(g){let w=g.nextElementSibling;for(;w&&w.hidden;)w=w.nextElementSibling;w&&(w.classList.add("focus"),Array.from(w.parentElement.children).filter(b=>b!==w).forEach(b=>{b.classList.remove("focus")}))}else{const w=u.current.querySelector(".search-popover-item");w&&w.classList.add("focus")}}break;case"Up":case"ArrowUp":if(m.preventDefault(),s){const g=document.querySelector(".search-popover-item.focus");if(g){let w=g.previousElementSibling;for(;w&&w.hidden;)w=w.previousElementSibling;w&&(w.classList.add("focus"),Array.from(w.parentElement.children).filter(b=>b!==w).forEach(b=>{b.classList.remove("focus")}))}else{const w=document.querySelector(".search-popover-item:last-child");w&&w.classList.add("focus")}}break;case"Enter":if(s){const g=document.querySelector(".search-popover-item.focus");g&&(m.preventDefault(),g.click()),a(!1),(y=t==null?void 0:t.onSubmit)==null||y.call(t,m)}break}}}),e("div",{class:"search-popover",hidden:!s||!r,children:!!r&&[{label:e(L,{children:["Posts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=statuses`,hidden:/^https?:/.test(r)},{label:e(L,{children:["Posts tagged with ",e("mark",{children:["#",r.replace(/^#/,"")]})]}),to:`/${o}/t/${r.replace(/^#/,"")}`,hidden:/^@/.test(r)||/^https?:/.test(r)||/\s/.test(r),top:/^#/.test(r),type:"link"},{label:e(L,{children:["Look up ",e("mark",{children:r})]}),to:`/${r}`,hidden:!/^https?:/.test(r),top:/^https?:/.test(r),type:"link"},{label:e(L,{children:["Accounts with ",e("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=accounts`}].sort((m,f)=>m.top&&!f.top?-1:!m.top&&f.top?1:0).map(({label:m,to:f,hidden:y,type:g})=>e(J,{to:f,class:"search-popover-item",hidden:y,onClick:w=>{var p;(p=t==null?void 0:t.onSubmit)==null||p.call(t,w)},children:[e(k,{icon:g==="link"?"arrow-right":"search",class:"more-insignificant"}),e("span",{children:m})," "]}))})]})}),xi=ze(function({onClose:n=()=>{}}){const[o,i]=C(!1),c=_(null);Le("/",a=>{i(!0),setTimeout(()=>{var r,l,d,u;(l=(r=c.current)==null?void 0:r.focus)==null||l.call(r),(u=(d=c.current)==null?void 0:d.select)==null||u.call(d)},0)},{preventDefault:!0,ignoreEventWhen:a=>{const r=/\/search/.test(location.hash),l=!!document.querySelector("#modal-container > *");return r||l}});const s=()=>{i(!1),n()};return Le("esc",a=>{var r,l;(l=(r=c.current)==null?void 0:r.blur)==null||l.call(r),s()},{enabled:o,enableOnFormTags:!0,preventDefault:!0}),e("div",{id:"search-command-container",hidden:!o,onClick:a=>{a.target===a.currentTarget&&s()},children:e(Jn,{ref:c,onSubmit:()=>{s()}})})});function Mi(){const{instance:t}=z(),n=ge(S),{shortcuts:o,settings:i}=n;if(!o.length||i.shortcutsViewMode==="multi-column"||!i.shortcutsViewMode&&i.shortcutsColumnsMode)return null;const c=_(),s=ue(()=>o.map((r,l)=>{const{type:d,...u}=r;if(!Tt[d])return null;let{id:h,path:m,title:f,subtitle:y,icon:g}=Tt[d];return typeof h=="function"&&(h=h(u,l)),typeof m=="function"&&(m=m({...u,instance:u.instance||t},l)),typeof f=="function"&&(f=f(u,l)),typeof y=="function"&&(y=y(u,l)),typeof g=="function"&&(g=g(u,l)),{id:h,path:m,title:f,subtitle:y,icon:g}}).filter(Boolean),[o]),a=Fn();return Le(["1","2","3","4","5","6","7","8","9"],(r,l)=>{var u,h;const d=parseInt(l.keys[0],10)-1;if(d<s.length){const{path:m}=s[d];m&&(a(m),(h=(u=c.current)==null?void 0:u.closeMenu)==null||h.call(u))}}),e("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?e("nav",{class:"tab-bar",onContextMenu:r=>{r.preventDefault(),S.showShortcutsSettings=!0},children:e("ul",{children:s.map(({id:r,path:l,title:d,subtitle:u,icon:h},m)=>e("li",{children:e(J,{class:u?"has-subtitle":"",to:l,onClick:f=>{if(f.target.classList.contains("is-active")){f.preventDefault();const y=document.getElementById(`${r}-page`);if(y){y.scrollTop=0;const g=y.querySelector(".updates-button");g&&g.click()}}},children:[e(k,{icon:h,size:"xl",alt:d}),e("span",{children:[e(Ut,{children:d}),u&&e(L,{children:[e("br",{}),e("small",{children:u})]})]})]})},`${m}-${r}-${d}-${u}-${l}`))})}):e(Ne,{instanceRef:c,overflow:"auto",viewScroll:"close",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:e("button",{type:"button",id:"shortcuts-button",class:"plain",onContextMenu:r=>{r.preventDefault(),S.showShortcutsSettings=!0},onTransitionStart:r=>{var l,d;try{const{target:u}=r;getComputedStyle(u).pointerEvents==="none"&&((d=(l=c.current)==null?void 0:l.closeMenu)==null||d.call(l))}catch{}},children:e(k,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:s.map(({id:r,path:l,title:d,subtitle:u,icon:h},m)=>e(Re,{to:l,class:"glass-menu-item",children:[e(k,{icon:h,size:"l"})," ",e("span",{class:"menu-grow",children:[e("span",{children:e(Ut,{children:d})}),u&&e(L,{children:[" ",e("small",{class:"more-insignificant",children:u})]})]}),e("span",{class:"menu-shortcut hide-until-focus-visible",children:m+1})]},`${m}-${r}-${d}-${u}-${l}`))})})}const Li=ze(Mi);function Ai(t){var c;let n=[],o=[],i=0;for(let s=0;s<t.length;s++){const a=t[s];a.reblog&&!((c=a.account)!=null&&c.group)?(o.push(a),i++):(n.push(a),i<3&&(i=0))}if(t.length>10&&(o.length>t.length/4||i>=3)){const s=o.map(a=>a.id);if(o.length>t.length*3/4)n=[...n,{id:s,items:o,type:"boosts"}];else{const a=Math.floor(n.length/2);n=[...n.slice(0,a),{id:s,items:o,type:"boosts"},...n.slice(a)]}return n}else return t}function bn(t,n){const o=ne.account.get("boostedStatusIDs")||{},i=t.filter(s=>{if(!s.reblog)return!0;const a=`${n}-${s.reblog.id}`,r=o[a];return r&&r!==s.id?!1:(o[a]=s.id,!0)}),c=Object.keys(o);return c.length>50&&c.slice(0,c.length-50).forEach(s=>{delete o[s]}),ne.account.set("boostedStatusIDs",o),i}function Ri(t){const n=[];let o=0;t.forEach(s=>{for(let r=0;r<n.length;r++){if(n[r].find(l=>l.id===s.id))return;if(n[r].find(l=>l.id===s.inReplyToId)||n[r].find(l=>l.inReplyToId===s.id)){n[r].push(s);return}}const a=t.find(r=>r.id===s.inReplyToId);a&&(n[o++]=[s,a])});for(let s=0;s<n.length;s++)for(let a=s+1;a<n.length;a++)n[s].find(l=>n[a].includes(l))&&(n[s]=[...n[s],...n[a]],n[s]=n[s].filter((l,d,u)=>u.findIndex(h=>h.id===l.id)===d),n.splice(a,1),a--);n.forEach(s=>{s.sort((a,r)=>!a.inReplyToId&&!r.inReplyToId?new Date(a.createdAt)-new Date(r.createdAt):a.inReplyToId===r.id?1:r.inReplyToId===a.id||!a.inReplyToId?-1:r.inReplyToId?new Date(a.createdAt)-new Date(r.createdAt):1)}),n.forEach(s=>{const a=s[0].account.id;s.forEach(r=>{r.account.id!==a&&(r._differentAuthor=!0)})}),n.length;const i=[],c=[];return t.forEach(s=>{if(s.reblog){i.push(s);return}for(let a=0;a<n.length;a++)if(n[a].find(r=>r.id===s.id)){if(c.includes(a))return;const r=n[a];r.sort((d,u)=>{const h=new Date(d.createdAt),m=new Date(u.createdAt);return h-m});const l=r[0].account.id;i.push({id:r.map(d=>d.id),items:r,type:r.every(d=>d.account.id===l)?"thread":"conversation"}),c.push(a);return}i.push(s)}),i}async function Ei(t,n){const o=await pi();if(!o.length)return;const{statusFollowedTags:i}=S,c=[];if(t.forEach(s=>{var m;if(s.reblog)return;const{id:a,content:r,tags:l=[]}=s,d=je(a,n);if((m=i[d])!=null&&m.length)return;const u=mi(r);if(!u.length&&!l.length)return;const h=o.reduce((f,y)=>((u.some(g=>g.toLowerCase()===y.name.toLowerCase())||l.some(g=>g.name.toLowerCase()===y.name.toLowerCase()))&&f.push(y.name),f),[]);h.length&&c.push({item:s,sKey:d,followedTags:h})}),c.length){const s=c.map(r=>r.item.account),a=await Kt(s);if(!a)return;c.forEach(r=>{const{item:l,sKey:d,followedTags:u}=r;a[l.account.id].following||(i[d]=u)})}}function Di(){S.statusFollowedTags={}}function Mt({scrollableRef:t,distanceFromStart:n=1,distanceFromEnd:o=1,scrollThresholdStart:i=10,scrollThresholdEnd:c=10,direction:s="vertical",distanceFromStartPx:a,distanceFromEndPx:r}={}){const[l,d]=C(null),[u,h]=C(!1),[m,f]=C(!1),[y,g]=C(!1),[w,p]=C(!1),b=s==="vertical";return Ve(()=>{const v=t.current;if(!v)return{};let T=b?v.scrollTop:v.scrollLeft;function x(){const{scrollTop:E,scrollLeft:D,scrollHeight:U,scrollWidth:B,clientHeight:P,clientWidth:M}=v,$=b?E:D,A=b?U:B,N=b?P:M,G=Math.abs($-T),te=a||Math.min(N*n,A,$),re=r||Math.min(N*o,A,A-$-N);G>=(T<$?c:i)&&(d(T<$?"end":"start"),T=$),h($<=0),f($+N>=A),g($<=te),p($+N>=A-re)}return v.addEventListener("scroll",x,{passive:!0}),()=>v.removeEventListener("scroll",x)},[n,o,i,c]),{scrollDirection:l,reachStart:u,reachEnd:m,nearReachStart:y,nearReachEnd:w,init:()=>{t.current&&t.current.dispatchEvent(new Event("scroll"))}}}function _i({class:t,statusID:n,status:o,instance:i,parent:c,onMediaClick:s}){let a=je(n,i);const r=ge(S);if(o||(o=r.statuses[a]||r.statuses[n],a=je(o==null?void 0:o.id,i)),!o)return null;const{account:{acct:l,avatar:d,avatarStatic:u,id:h,url:m,displayName:f,username:y,emojis:g,bot:w,group:p},id:b,repliesCount:v,reblogged:T,reblogsCount:x,favourited:E,favouritesCount:D,bookmarked:U,poll:B,muted:P,sensitive:M,spoilerText:$,visibility:A,language:N,editedAt:G,filtered:te,card:re,createdAt:Q,inReplyToId:xe,inReplyToAccountId:pe,content:K,mentions:R,mediaAttachments:j,reblog:ee,uri:le,url:we,emojis:Ie,_deleted:Te,_pinned:W}=o;if(!(j!=null&&j.length))return null;const q=Y=>{Y.shiftKey},V=ue(()=>ne.session.get("currentAccount"),[]),he=ue(()=>V&&V===h,[h,V]),ce=Ts(Dn),X=!he&&Pt(te,ce);if((X==null?void 0:X.action)==="hide")return null;const I=$||M,F=c||"div";return j.map((Y,ie)=>{const fe=`${a}-${Y.id}`,$e=X==null?void 0:X.titlesStr;return e(F,{"data-state-post-id":a,onMouseEnter:q,"data-spoiler-text":$||(M?"Sensitive media":void 0),"data-filtered-text":X?`Filtered${$e?`: ${$e}`:""}`:void 0,class:`
          media-post
          ${X?"filtered":""}
          ${I?"has-spoiler":""}
        `,children:e(En,{class:t,media:Y,lang:N,to:`/${i}/s/${b}?media-only=${ie+1}`,onClick:s?be=>s(be,ie,Y,o):void 0})},fe)})}const yn=ze(_i);function pt(t){var v,T,x,E,D;const n=ge(S),{masto:o,instance:i,authenticated:c}=z(),[s,a]=C(),[r,l]=C(!1);O(()=>{const U=ne.local.getJSON("accounts")||[],B=U.find(P=>P.info.id===ne.session.get("currentAccount"));B&&a(B),l(U.length>1)},[]);const d=(n.settings.shortcutsViewMode==="multi-column"||!n.settings.shortcutsViewMode&&n.settings.shortcutsColumnsMode)&&!n.shortcuts.find(U=>U.type==="following"),u=$s(()=>{S.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),h=_(),[m,f]=C(void 0),y=ms([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]),g=_();async function w(U){return(U||!g.current)&&(g.current=o.v1.mutes.list({limit:80})),await g.current.next()}const p=_();async function b(U){return(U||!p.current)&&(p.current=o.v1.blocks.list({limit:80})),await p.current.next()}return e(L,{children:[e("button",{ref:h,type:"button",class:`button plain nav-menu-button ${r?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{f(U=>U?void 0:"open")},onContextMenu:U=>{U.preventDefault(),S.showAccounts=!0},...u(),children:[r&&e(et,{url:((v=s==null?void 0:s.info)==null?void 0:v.avatar)||((T=s==null?void 0:s.info)==null?void 0:T.avatarStatic),size:"l",squircle:(x=s==null?void 0:s.info)==null?void 0:x.bot}),e(k,{icon:"menu",size:r?"s":"l"})]}),e(zn,{menuClassName:"nav-menu",state:m,anchorRef:h,onClose:()=>{f(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{f(void 0)}},portal:{target:document.body},...t,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:y,unmountOnClose:!0,children:[!!((E=n.appVersion)!=null&&E.commitHash)&&n.appVersion.commitHash!=="14a294c"&&e("div",{class:"top-menu",children:[e(se,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[e(k,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",e("span",{children:"New update available…"})]}),e(Ee,{})]}),e("section",{children:[e(Re,{to:"/",children:[e(k,{icon:"home",size:"l"})," ",e("span",{children:"Home"})]}),c&&e(L,{children:[d&&e(Re,{to:"/following",children:[e(k,{icon:"following",size:"l"})," ",e("span",{children:"Following"})]}),e(Re,{to:"/mentions",children:[e(k,{icon:"at",size:"l"})," ",e("span",{children:"Mentions"})]}),e(Re,{to:"/notifications",children:[e(k,{icon:"notification",size:"l"})," ",e("span",{children:"Notifications"}),n.notificationsShowNew&&e("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),e(Ee,{}),e(Re,{to:"/l",children:[e(k,{icon:"list",size:"l"})," ",e("span",{children:"Lists"})]}),e(Re,{to:"/ft",children:[e(k,{icon:"hashtag",size:"l"})," ",e("span",{children:"Followed Hashtags"})]}),e(Re,{to:"/b",children:[e(k,{icon:"bookmark",size:"l"})," ",e("span",{children:"Bookmarks"})]}),e(Re,{to:"/f",children:[e(k,{icon:"heart",size:"l"})," ",e("span",{children:"Likes"})]})]}),e(Ee,{}),e(Re,{to:"/search",children:[e(k,{icon:"search",size:"l"})," ",e("span",{children:"Search"})]}),e(Re,{to:`/${i}/p/l`,children:[e(k,{icon:"group",size:"l"})," ",e("span",{children:"Local"})]}),e(Re,{to:`/${i}/p`,children:[e(k,{icon:"earth",size:"l"})," ",e("span",{children:"Federated"})]}),e(Re,{to:`/${i}/trending`,children:[e(k,{icon:"chart",size:"l"})," ",e("span",{children:"Trending"})]})]}),e("section",{children:c?e(L,{children:[e(Ee,{}),((D=s==null?void 0:s.info)==null?void 0:D.id)&&e(Re,{to:`/${i}/a/${s.info.id}`,children:[e(k,{icon:"user",size:"l"})," ",e("span",{children:"Profile"})]}),e(se,{onClick:()=>{S.showAccounts=!0},children:[e(k,{icon:"group",size:"l"})," ",e("span",{children:"Accounts…"})]}),e(se,{onClick:()=>{S.showGenericAccounts={id:"mute",heading:"Muted users",fetchAccounts:w,excludeRelationshipAttrs:["muting"]}},children:[e(k,{icon:"mute",size:"l"})," Muted users…"]}),e(se,{onClick:()=>{S.showGenericAccounts={id:"block",heading:"Blocked users",fetchAccounts:b,excludeRelationshipAttrs:["blocking"]}},children:[e(k,{icon:"block",size:"l"}),"Blocked users…"]}),e(Ee,{className:"divider-grow"}),e(se,{onClick:()=>{S.showKeyboardShortcutsHelp=!0},children:[e(k,{icon:"keyboard",size:"l"})," ",e("span",{children:"Keyboard shortcuts"})]}),e(se,{onClick:()=>{S.showShortcutsSettings=!0},children:[e(k,{icon:"shortcut",size:"l"})," ",e("span",{children:"Shortcuts / Columns…"})]}),e(se,{onClick:()=>{S.showSettings=!0},children:[e(k,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]}):e(L,{children:[e(Ee,{}),e(Re,{to:"/login",children:[e(k,{icon:"user",size:"l"})," ",e("span",{children:"Log in"})]}),e(se,{onClick:()=>{S.showSettings=!0},children:[e(k,{icon:"gear",size:"l"})," ",e("span",{children:"Settings…"})]})]})})]})]})}const gt={block:"nearest",inline:"center",behavior:"smooth"};function Ge({title:t,titleComponent:n,id:o,instance:i,emptyText:c,errorText:s,useItemID:a,boostsCarousel:r,fetchItems:l=()=>{},checkForUpdates:d=()=>{},checkForUpdatesInterval:u=15e3,headerStart:h,headerEnd:m,timelineStart:f,refresh:y,view:g,filterContext:w,showFollowedTags:p}){const b=ge(S),[v,T]=C([]),[x,E]=C("default"),[D,U]=C(!1),[B,P]=C(!1),[M,$]=C(!0),A=_(),N=g!=="media",G=On(W=>{P(!1),x!=="loading"&&(E("loading"),(async()=>{try{let{done:q,value:V}=await l(W);if(Array.isArray(V)){const[he,ce]=V.reduce((X,I)=>(I._pinned?X[0].push(I):X[1].push(I),X),[[],[]]);V=ce,N&&(r&&(V=Ai(V)),V=Ri(V)),he.length&&(V=he.concat(V)),T(W?V:X=>[...X,...V]),V.length||(q=!0),U(!q)}else U(!1);E("default")}catch{E("error")}finally{G.cancel()}})())},1500,{leading:!0,trailing:!1}),te=".timeline-item, .timeline-item-alt",re=Le("j, shift+j",(W,q)=>{const V=document.activeElement.closest(te),he=V==null?void 0:V.getBoundingClientRect(),ce=Array.from(A.current.querySelectorAll(te));if(V&&he.top<A.current.clientHeight&&he.bottom>0){const X=ce.indexOf(V);let I=ce[X+1];q.shift&&(I=ce.find((F,Y)=>Y>X&&!F.classList.contains("timeline-item-alt"))),I&&(I.focus(),I.scrollIntoView(gt))}else{const X=ce.find(I=>{const F=I.getBoundingClientRect();return F.top>=44&&F.left>=0});X&&(X.focus(),X.scrollIntoView(gt))}}),Q=Le("k, shift+k",(W,q)=>{const V=document.activeElement.closest(te),he=V==null?void 0:V.getBoundingClientRect(),ce=Array.from(A.current.querySelectorAll(te));if(V&&he.top<A.current.clientHeight&&he.bottom>0){const X=ce.indexOf(V);let I=ce[X-1];q.shift&&(I=ce.findLast((F,Y)=>Y<X&&!F.classList.contains("timeline-item-alt"))),I&&(I.focus(),I.scrollIntoView(gt))}else{const X=ce.find(I=>{const F=I.getBoundingClientRect();return F.top>=44&&F.left>=0});X&&(X.focus(),X.scrollIntoView(gt))}}),xe=Le(["enter","o"],()=>{const W=document.activeElement.closest(te);W&&W.click()}),{scrollDirection:pe,nearReachStart:K,nearReachEnd:R,reachStart:j,reachEnd:ee}=Mt({scrollableRef:A,distanceFromEnd:2,scrollThresholdStart:44});O(()=>{var W;(W=A.current)==null||W.scrollTo({top:0}),G(!0)},[]),O(()=>{G(!0)},[y]),O(()=>{j&&G(!0)},[j]),O(()=>{(R||ee&&D)&&G()},[R,D]);const le=_(g);O(()=>{le.current!==g&&(le.current=g,T([]))},[g]);const we=He(async({disableIdleCheck:W=!1}={})=>{const q=A.current?getComputedStyle(A.current).pointerEvents==="none":!1;b.settings.autoRefresh&&A.current.scrollTop<16&&(W||window.__IDLE__)&&!Fi()&&!q?G(!0):await d()&&P(!0)},[o,G,d,b.settings.autoRefresh]),Ie=_();ht(W=>{if(W){const q=Date.now()-Ie.current;(!Ie.current||q>1e3*3)&&we({disableIdleCheck:!0})}else Ie.current=Date.now();$(W)},[d,we,b.settings.autoRefresh]),Cn(we,M&&!B?u*(K?1:2):null);const Te=pe==="end"&&!K;return e(Dn.Provider,{value:w,children:e("div",{id:`${o}-page`,class:"deck-container",ref:W=>{A.current=W,re.current=W,Q.current=W,xe.current=W},tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{hidden:Te,onClick:W=>{var q;W.target.closest("a, button")||(q=A.current)==null||q.scrollTo({top:0,behavior:"smooth"})},onDblClick:W=>{W.target.closest("a, button")||G(!0)},class:x==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(pt,{}),h??e(J,{to:"/",class:"button plain home-button",children:e(k,{icon:"home",size:"l"})})]}),t&&(n||e("h1",{children:t})),e("div",{class:"header-side",children:!!m&&m})]}),v.length>0&&x!=="loading"&&!Te&&B&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var W;G(!0),(W=A.current)==null||W.scrollTo({top:0,behavior:"smooth"})},children:[e(k,{icon:"arrow-up"})," New posts"]})]}),!!f&&e("div",{class:`timeline-start ${x==="loading"?"loading":""}`,children:f}),v.length?e(L,{children:[e("ul",{class:`timeline ${g?`timeline-${g}`:""}`,children:[v.map(W=>e(Pi,{status:W,instance:i,useItemID:a,filterContext:w,view:g,showFollowedTags:p},W.id+(W==null?void 0:W._pinned)+g)),D&&x==="loading"&&(g==="media"?null:e(L,{children:[e("li",{style:{height:"20vh"},children:e(Me,{skeleton:!0})}),e("li",{style:{height:"25vh"},children:e(Me,{skeleton:!0})})]}))]}),x==="default"&&(D?e(at,{onChange:W=>{W&&G()},children:e("button",{type:"button",class:"plain block",onClick:()=>G(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}))]}):x==="loading"?e("ul",{class:"timeline",children:Array.from({length:5}).map((W,q)=>g==="media"?e("div",{style:{height:"50vh"}}):e("li",{children:e(Me,{skeleton:!0})},q))}):x!=="error"&&e("p",{class:"ui-state",children:c}),x==="error"&&e("p",{class:"ui-state",children:[s,e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>G(!v.length),children:"Try again"})]})]})})})}function Pi({status:t,instance:n,useItemID:o,filterContext:i,view:c,showFollowedTags:s}){const{id:a,reblog:r,items:l,type:d,_pinned:u}=t;u&&(o=!1);const h=(r==null?void 0:r.id)||a,m=n?`/${n}/s/${h}`:`/s/${h}`;let f="";d==="boosts"?f=`${l.length} Boosts`:d==="pinned"&&(f="Pinned posts");const y=d==="boosts"||d==="pinned";if(l){if(y)return l.sort((p,b)=>{const v=Pt(p.filtered,i),T=Pt(b.filtered,i);return v&&!T?1:!v&&T?-1:0}),e("li",{class:"timeline-item-carousel",children:e(Ni,{title:f,class:`${d}-carousel`,children:l.map(p=>{const{id:b,reblog:v,_pinned:T}=p,x=(v==null?void 0:v.id)||b,E=n?`/${n}/s/${x}`:`/s/${x}`;return T&&(o=!1),e("li",{children:e(J,{class:"status-carousel-link timeline-item-alt",to:E,children:o?e(Me,{statusID:b,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0}):e(Me,{status:p,instance:n,size:"s",contentTextWeight:!0,enableCommentHint:!0})})},b)})})},`timeline-${a}`);const w=l.length>3;return l.map((p,b)=>{const{id:v,_differentAuthor:T}=p,x=n?`/${n}/s/${v}`:`/s/${v}`,E=b>0&&b<l.length-1,D=p.sensitive&&!!p.spoilerText,U=!T&&D&&b>0||w&&E&&(d==="thread"||d==="conversation"&&!T&&!l[b-1]._differentAuthor&&!l[b+1]._differentAuthor),B=b===0,P=b===l.length-1;return e("li",{class:`timeline-item-container timeline-item-container-type-${d} timeline-item-container-${B?"start":P?"end":"middle"} ${T?"timeline-item-diff-author":""}`,children:e(J,{class:"status-link timeline-item",to:x,children:U?e(Ui,{status:p,instance:n}):o?e(Me,{statusID:v,instance:n,enableCommentHint:P,showFollowedTags:s}):e(Me,{status:p,instance:n,enableCommentHint:P,showFollowedTags:s})})},`timeline-${v}`)})}const g=`timeline-${a+u}`;return c==="media"?o?e(yn,{class:"timeline-item",parent:"li",statusID:a,instance:n},g):e(yn,{class:"timeline-item",parent:"li",status:t,instance:n},g):e("li",{children:e(J,{class:"status-link timeline-item",to:m,children:o?e(Me,{statusID:a,instance:n,enableCommentHint:!0,showFollowedTags:s}):e(Me,{status:t,instance:n,enableCommentHint:!0,showFollowedTags:s})})},g)}function Ni({title:t,class:n,children:o}){const i=_(),{reachStart:c,reachEnd:s,init:a}=Mt({scrollableRef:i,direction:"horizontal"});return O(()=>{a==null||a()},[]),e("div",{class:`status-carousel ${n}`,children:[e("header",{children:[e("h3",{children:t}),e("span",{children:[e("button",{type:"button",class:"small plain2",disabled:c,onClick:()=>{var r,l;(l=i.current)==null||l.scrollBy({left:-Math.min(320,(r=i.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(k,{icon:"chevron-left"})})," ",e("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var r,l;(l=i.current)==null||l.scrollBy({left:Math.min(320,(r=i.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:e(k,{icon:"chevron-right"})})]})]}),e("ul",{ref:i,children:o})]})}function Ui({status:t,instance:n}){const o=ge(S),{id:i,visibility:c}=t,s=_n(t),a=je(i,n);return e("article",{class:`status compact-thread ${c==="direct"?"visibility-direct":""}`,tabindex:"-1",children:[o.statusThreadNumber[a]?e("div",{class:"status-thread-badge",children:[e(k,{icon:"thread",size:"s"}),o.statusThreadNumber[a]?` ${o.statusThreadNumber[a]}/X`:""]}):e("div",{class:"status-thread-badge",children:e(k,{icon:"thread",size:"s"})}),e("div",{class:"content-compact",title:s,children:[s,t.sensitive&&t.spoilerText&&e(L,{children:[" ",e("span",{class:"spoiler-badge",children:e(k,{icon:"eye-close",size:"s"})})]})]})]})}function Fi(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const it=20,Yt=1983,wn=`${Yt}-01`,zi=(()=>{try{const t=document.createElement("input");return t.setAttribute("type","month"),t.type==="month"}catch{return!1}})();async function Oi(t){var i;const{masto:n}=z({instance:t}),o=await n.v2.search.fetch({q:"from:me",type:"statuses",limit:1});return!!((i=o==null?void 0:o.statuses)!=null&&i.length)}const Bi=tt(Oi);function qi(){const t=ge(S),{id:n,...o}=nt(),[i,c]=Oe(),s=i.get("month"),a=!i.get("replies"),r=!!i.get("boosts"),l=i.get("tagged"),d=!!i.get("media"),{masto:u,instance:h,authenticated:m}=z({instance:o.instance}),{masto:f,instance:y}=z(),g=_(),w=[s,a,r,l,d],[p,b]=C(),v=_(0);O(()=>{v.current=0},w);const T=ue(()=>h===y,[h,y]),[x,E]=C(!1);O(()=>{T&&p!=null&&p.acct&&(async()=>{const K=await Bi(h);E(K)})()},[h,T,p==null?void 0:p.acct]);async function D(K){var Ie,Te,W;const R=/^\d{4}-[01]\d$/.test(s),j=((Te=(Ie=s==null?void 0:s.split)==null?void 0:Ie.call(s,"-"))==null?void 0:Te[0])>=Yt;if(R&&j){if(!p)return{value:[],done:!0};const[q,V]=s.split("-"),he=parseInt(V,10)-1,ce=new Date(q,he,0),X=`${ce.getFullYear()}-${(ce.getMonth()+1).toString().padStart(2,"0")}-${ce.getDate().toString().padStart(2,"0")}`,I=new Date(q,he+1,1),F=`${I.getFullYear()}-${(I.getMonth()+1).toString().padStart(2,"0")}-${I.getDate().toString().padStart(2,"0")}`;let Y;K?(Y=it+1,v.current=0):(Y=it+v.current+1,v.current+=it);const ie=await u.v2.search.fetch({q:`from:${p.acct} after:${X} before:${F}`,type:"statuses",limit:Y,offset:v.current});if((W=ie==null?void 0:ie.statuses)!=null&&W.length){const fe=ie.statuses.slice(0,it);fe.forEach(be=>{Ce(be,h)});const $e=ie.statuses.length<=it;return{value:fe,done:$e}}else return{value:[],done:!0}}const ee=[];if(K){const{value:q}=await u.v1.accounts.$select(n).statuses.list({pinned:!0}).next();if(q!=null&&q.length&&!l&&!d){const V=q.map(he=>(Ce(he,h),{...he,_pinned:!0}));if(V.length>=3){const he=V.map(ce=>ce.id);ee.push({id:he,items:V,type:"pinned"})}else ee.push(...V)}}(K||!g.current)&&(g.current=u.v1.accounts.$select(n).statuses.list({limit:it,exclude_replies:a,exclude_reblogs:r,only_media:d,tagged:l}));const{value:le,done:we}=await g.current.next();return le!=null&&le.length&&(ee.push(...le),le.forEach(q=>{Ce(q,h)})),{value:ee,done:we}}const[U,B]=C([]);Ae(p!=null&&p.acct?`${p!=null&&p.displayName?p.displayName+" ":""}@${p.acct}${a?r?" (- Boosts)":l?` (#${l})`:d?" (Media)":s?` (${new Date(s).toLocaleString("default",{month:"long",year:"numeric"})})`:"":" (+ Replies)"}`:"Account posts","/:instance?/a/:id");const P=_(),M=He(()=>{const K=P.current||u.v1.accounts.$select(n).fetch();return P.current=K,K},[n,u]);O(()=>{(async()=>{try{const K=await M();b(K)}catch{}try{const K=await u.v1.accounts.$select(n).featuredTags.list();B(K)}catch{}})()},[n]);const{displayName:$,acct:A,emojis:N}=p||{},G=ue(()=>{const K=t.accounts[`${n}@${h}`];return e(Gn,{instance:h,account:K||n,fetchAccount:M,authenticated:m,standalone:!0})},[n,h,m,M]),te=_(),re=ue(()=>e(L,{children:[G,e("div",{class:"filter-bar",ref:te,style:{position:"relative"},children:[!a||r||l||d||!!s?e(J,{to:`/${h}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:e(k,{icon:"x",size:"l"})},"clear-filters"):e(k,{icon:"filter",class:"insignificant",size:"l"}),e(J,{to:`/${h}/a/${n}${a?"?replies=1":""}`,onClick:()=>{a&&de("Showing post with replies")},class:a?"":"is-active",children:"+ Replies"}),e(J,{to:`/${h}/a/${n}${r?"":"?boosts=0"}`,onClick:()=>{r||de("Showing posts without boosts")},class:r?"is-active":"",children:"- Boosts"}),e(J,{to:`/${h}/a/${n}${d?"":"?media=1"}`,onClick:()=>{d||de("Showing posts with media")},class:d?"is-active":"",children:"Media"}),U.map(R=>e(J,{to:`/${h}/a/${n}${l===R.name?"":`?tagged=${encodeURIComponent(R.name)}`}`,onClick:()=>{l!==R.name&&de(`Showing posts tagged with #${R.name}`)},class:l===R.name?"is-active":"",children:e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),R.name]})},R.id)),x&&(zi?e("label",{class:`filter-field ${s?"is-active":""}`,children:[e(k,{icon:"month",size:"l"}),e("input",{type:"month",disabled:!(p!=null&&p.acct),value:s||"",min:wn,max:new Date().toISOString().slice(0,7),onInput:R=>{const{value:j,validity:ee}=R.currentTarget;ee.valid&&(c(j?{month:j}:{}),de(`Showing posts in ${new Date(j).toLocaleString("default",{month:"long",year:"numeric"})}`))}})]}):e(Hi,{class:`filter-field ${s?"is-active":""}`,disabled:!(p!=null&&p.acct),value:s||"",min:wn,max:new Date().toISOString().slice(0,7),onInput:R=>{const{value:j,validity:ee}=R;ee.valid&&c(j?{month:j}:{})}}))]})]}),[n,h,m,U,x,...w]);O(()=>{var R;const K=(R=te.current)==null?void 0:R.querySelector(".is-active");K&&te.current.scrollTo({behavior:"smooth",left:K.offsetLeft-(te.current.offsetWidth-K.offsetWidth)/2})},[U,x,...w]);const Q=ue(()=>p!=null&&p.url?new URL(p.url).hostname:null,[p]),pe=!!p&&!(h===Q);return e(Ge,{title:`${p!=null&&p.acct?"@"+p.acct:"Posts"}`,titleComponent:e("h1",{class:"header-double-lines header-account",children:[e("b",{children:e(Ln,{text:$,emojis:N})}),e("div",{children:e("span",{children:["@",A]})})]}),id:"account-statuses",instance:h,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:D,useItemID:!0,view:d?"media":void 0,boostsCarousel:t.settings.boostsCarousel,timelineStart:re,refresh:[a,r,l,d,s+(p==null?void 0:p.acct)].toString(),headerEnd:e(Ne,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(k,{icon:"more",size:"l"})}),children:[e(se,{disabled:!pe,onClick:()=>{(async()=>{try{const{masto:K}=z({instance:Q}),R=await K.v1.accounts.lookup({acct:p.acct}),{id:j}=R;location.hash=`/${Q}/a/${j}`}catch{alert("Unable to fetch account info")}})()},children:[e(k,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to account's instance (",e("b",{children:Q}),")"]})]}),!T&&e(se,{onClick:()=>{(async()=>{try{const K=await f.v1.accounts.lookup({acct:p.acct+"@"+h}),{id:R}=K;location.hash=`/${y}/a/${R}`}catch{alert("Unable to fetch account info")}})()},children:[e(k,{icon:"transfer"})," ",e("small",{class:"menu-double-lines",children:["Switch to my instance (",e("b",{children:y}),")"]})]})]})},n)}function Hi(t){const{class:n,disabled:o,value:i,min:c,max:s,onInput:a=()=>{}}=t,[r,l]=(i==null?void 0:i.split("-"))||[],d=_(),u=_(),h=(m,f)=>{const[y,g]=(c==null?void 0:c.split("-"))||[],[w,p]=(s==null?void 0:s.split("-"))||[];return!(f<y||f>w||f===y&&m<g||f===w&&m>p)};return e("div",{class:n,children:[e(k,{icon:"month",size:"l"}),e("select",{ref:d,disabled:o,value:l||"",onInput:m=>{const{value:f}=m.currentTarget,y=u.current.value;if(!h(f,y))return{value:"",validity:{valid:!1}};a({value:f?`${y}-${f}`:"",validity:{valid:!0}})},children:[e("option",{value:"",children:"Month"}),e("option",{disabled:!0,children:"-----"}),Array.from({length:12},(m,f)=>e("option",{value:(f+1).toString().padStart(2,"0"),children:new Date(0,f).toLocaleString("default",{month:"long"})},f))]})," ",e("input",{ref:u,type:"number",disabled:o,value:r||new Date().getFullYear(),min:(c==null?void 0:c.slice(0,4))||Yt,max:(s==null?void 0:s.slice(0,4))||new Date().getFullYear(),onInput:m=>{const{value:f,validity:y}=m.currentTarget,g=d.current.value;if(!y.valid||!h(g,f))return{value:"",validity:{valid:!1}};a({value:f?`${f}-${g}`:"",validity:{valid:!0}})},style:{width:"4.5em"}})]})}const Vi=20;function Xn(){Ae("Bookmarks","/b");const{masto:t,instance:n}=z(),o=_();async function i(c){return(c||!o.current)&&(o.current=t.v1.bookmarks.list({limit:Vi})),await o.current.next()}return e(Ge,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:i})}const ji=20;function Qn(){Ae("Likes","/f");const{masto:t,instance:n}=z(),o=_();async function i(c){return(c||!o.current)&&(o.current=t.v1.favourites.list({limit:ji})),await o.current.next()}return e(Ge,{title:"Likes",id:"favourites",emptyText:"No likes yet. Go like something!",errorText:"Unable to load likes",instance:n,fetchItems:i})}function Gi(){const{masto:t,instance:n}=z();Ae("Followed Hashtags","/ft");const[o,i]=C("default"),[c,s]=C([]);return O(()=>{i("loading"),(async()=>{try{const a=await It();s(a),i("default")}catch{i("error")}})()},[]),e("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(pt,{}),e(J,{to:"/",class:"button plain",children:e(k,{icon:"home",size:"l"})})]}),e("h1",{children:"Followed Hashtags"}),e("div",{class:"header-side"})]})}),e("main",{children:c.length>0?e("ul",{class:"link-list",children:c.map(a=>e("li",{children:e(J,{to:n?`/${n}/t/${a.name}`:`/t/${a.name}`,children:[e(k,{icon:"hashtag"})," ",e("span",{children:a.name})]})}))}):o==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):o==="error"?e("p",{class:"ui-state",children:"Unable to load followed hashtags."}):e("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}const Wi=20;function Jt({title:t,path:n,id:o,...i}){Ae(t||"Following",n||"/following");const{masto:c,streaming:s,instance:a}=z(),r=ge(S),l=_(),d=_();async function u(m){(m||!l.current)&&(l.current=c.v1.timelines.home.list({limit:Wi}));const f=await l.current.next();let{value:y}=f;if(y!=null&&y.length){let g=!1;m&&(y[0].id!==d.current&&(g=!0),d.current=y[0].id),y.forEach(w=>{Ce(w,a)}),y=bn(y,a),m&&g&&Di(),Ei(y,a),y.sort((w,p)=>{const b=new Date(w.createdAt);return new Date(p.createdAt)-b})}return{...f,value:y}}async function h(){try{const m=await c.v1.timelines.home.list({limit:5,since_id:d.current}).next();let{value:f}=m;return!!(f!=null&&f.length&&(d.current=f[0].id,f=bn(f,a),f=ft(f,"home"),f.some(y=>!y.reblog)))}catch{return!1}}return O(()=>{let m;return(async()=>{if(s){m=s.user.subscribe();for await(const f of m){if(!m)break;if(f.event==="status.update"){const y=f.payload;Ce(y,a)}else if(f.event==="delete"){const y=f.payload,g=Pn(y,a);g&&(g._deleted=!0)}}}})(),()=>{var f;(f=m==null?void 0:m.unsubscribe)==null||f.call(m),m=null}},[s]),e(Ge,{title:t||"Following",id:o||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:a,fetchItems:u,checkForUpdates:h,useItemID:!0,boostsCarousel:r.settings.boostsCarousel,...i,filterContext:"home",showFollowedTags:!0})}const Ki=20,Zi=4,vn=Zi+1;function es({media:t,columnMode:n,...o}){let{hashtag:i,...c}=n?{}:nt();o.hashtag&&(i=o.hashtag);let s=i.trim().split(/[\s+]+/);s.sort(),i=s[0];const[a,r]=Oe(),l=t||!!a.get("media"),d=l?"?media=1":"",{masto:u,instance:h,authenticated:m}=z({instance:(o==null?void 0:o.instance)||c.instance}),{masto:f,instance:y,authenticated:g}=z(),w=s.map($=>`#${$}`).join(" "),p=l?" (Media only)":"",b=h?`${w}${p} on ${h}`:`${w}${p}`;Ae(b,"/:instance?/t/:hashtag");const v=_(),T=_(void 0);async function x($){const A=await u.v1.timelines.tag.$select(i).list({limit:Ki,any:s.slice(1),maxId:$?void 0:T.current,onlyMedia:l}).next();let{value:N}=A;return N!=null&&N.length&&($&&(v.current=N[0].id),N.forEach(G=>{Ce(G,h,{skipThreading:l})}),T.current=N[N.length-1].id),{...A,value:N}}async function E(){try{const $=await u.v1.timelines.tag.$select(i).list({limit:1,any:s.slice(1),since_id:v.current,onlyMedia:l}).next();let{value:A}=$;return A=ft(A,"public"),!!(A!=null&&A.length)}catch{return!1}}const[D,U]=C("default"),[B,P]=C();O(()=>{(async()=>{try{const $=await u.v1.tags.$select(i).fetch();P($)}catch{}})()},[i]);const M=s.length>=vn;return e(Ge,{title:b,titleComponent:!!h&&e("h1",{class:"header-double-lines",children:[e("b",{children:w}),e("div",{children:h})]}),id:"hashtag",instance:h,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:x,checkForUpdates:E,useItemID:!0,view:l?"media":void 0,refresh:l,filterContext:"public",headerEnd:e(Ne,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(k,{icon:"more",size:"l"})}),children:[!!B&&s.length===1&&e(L,{children:[e(Fe,{subMenu:!0,confirm:B.following,confirmLabel:`Unfollow #${i}?`,disabled:D==="loading"||!m,onClick:()=>{U("loading"),B.following?u.v1.tags.$select(i).unfollow().then(()=>{P({...B,following:!1}),de(`Unfollowed #${i}`)}).catch($=>{alert($)}).finally(()=>{U("default")}):u.v1.tags.$select(i).follow().then(()=>{P({...B,following:!0}),de(`Followed #${i}`)}).catch($=>{alert($)}).finally(()=>{U("default")})},children:B.following?e(L,{children:[e(k,{icon:"check-circle"})," ",e("span",{children:"Following…"})]}):e(L,{children:[e(k,{icon:"plus"})," ",e("span",{children:"Follow"})]})}),e(Ee,{})]}),e(Bn,{className:"plain",children:"Filters"}),e(se,{type:"checkbox",checked:!!l,onClick:()=>{l?a.delete("media"):a.set("media","1"),r(a)},children:[e(k,{icon:"check-circle"})," ",e("span",{class:"menu-grow",children:"Media only"})]}),e(Ee,{}),e(Cs,{className:"menu-field",disabled:M,children:({ref:$})=>e("form",{onSubmit:A=>{var G,te;A.preventDefault();const N=(te=(G=A.target[0].value)==null?void 0:G.trim)==null?void 0:te.call(G);N&&!s.some(re=>re.toLowerCase()===N.toLowerCase())&&(s.push(N),s.sort(),location.hash=h?`/${h}/t/${s.join("+")}`:`/t/${s.join("+")}${d}`)},children:[e(k,{icon:"hashtag"}),e("input",{ref:$,type:"text",placeholder:M?`Max ${vn} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:M})]})}),e(xs,{takeOverflow:!0,children:s.map(($,A)=>e(se,{disabled:s.length===1,onClick:N=>{s.splice(A,1),s.sort(),location.hash=h?`/${h}/t/${s.join("+")}${d}`:`/t/${s.join("+")}${d}`},children:[e(k,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),$]})]},$))}),e(Ee,{}),e(se,{disabled:!g,onClick:()=>{if(S.shortcuts.length>=Je){alert(`Max ${Je} shortcuts reached. Unable to add shortcut.`);return}const $={type:"hashtag",hashtag:s.join(" "),instance:h,media:l?"on":void 0};S.shortcuts.some(N=>N.type===$.type&&N.hashtag.split(/[\s+]+/).sort().join(" ")===$.hashtag.split(/[\s+]+/).sort().join(" ")&&(N.instance?N.instance===$.instance:!0)&&(N.media?!!N.media==!!$.media:!0))?alert("This shortcut already exists"):(S.shortcuts.push($),de("Hashtag shortcut added"))},children:[e(k,{icon:"shortcut"})," ",e("span",{children:"Add to Shorcuts"})]}),e(se,{onClick:()=>{let $=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test($)){$&&alert("Invalid instance");return}$&&($=$.toLowerCase().trim(),location.hash=`/${$}/t/${s.join("+")}${d}`)},children:[e(k,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),y!==h&&e(se,{onClick:()=>{location.hash=`/${y}/t/${s.join("+")}${d}`},children:[e(k,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:y}),")"]})]})]})},h+w)}const Yi=20;function ts(t){var g;const n=ge(S),{masto:o,instance:i}=z(),c=(t==null?void 0:t.id)||((g=nt())==null?void 0:g.id),s=_(),a=_();async function r(w){(w||!a.current)&&(a.current=o.v1.timelines.list.$select(c).list({limit:Yi}));const p=await a.current.next();let{value:b}=p;return b!=null&&b.length&&(w&&(s.current=b[0].id),b.forEach(v=>{Ce(v,i)})),{...p,value:b}}async function l(){try{const w=await o.v1.timelines.list.$select(c).list({limit:1,since_id:s.current});let{value:p}=w;return p=ft(p,"home"),!!(p!=null&&p.length)}catch{return!1}}const[d,u]=C({title:"List"});Ae(d.title,"/l/:id"),O(()=>{(async()=>{try{const w=await o.v1.lists.$select(c).fetch();u(w)}catch{}})()},[c]);const[h,m]=C(!1),[f,y]=C(!1);return e(L,{children:[e(Ge,{title:d.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:i,fetchItems:r,checkForUpdates:l,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,filterContext:"home",headerStart:e(J,{to:"/l",class:"button plain",children:e(k,{icon:"list",size:"l"})}),headerEnd:e(Ne,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(k,{icon:"more",size:"l"})}),children:[e(se,{onClick:()=>m({list:d}),children:[e(k,{icon:"pencil",size:"l"}),e("span",{children:"Edit"})]}),e(se,{onClick:()=>y(!0),children:[e(k,{icon:"group",size:"l"}),e("span",{children:"Manage members"})]})]})},c),h&&e(Se,{class:"light",onClick:w=>{w.target===w.currentTarget&&m(!1)},children:e(Wt,{list:h==null?void 0:h.list,onClose:w=>{w.state==="success"&&w.list?u(w.list):w.state==="deleted"&&(location.hash="/l"),m(!1)}})}),f&&e(Se,{class:"light",onClick:w=>{w.target===w.currentTarget&&y(!1)},children:e(Xi,{listID:c,onClose:()=>y(!1)})})]})}const Ji=40;function Xi({listID:t,onClose:n}){const{masto:o,instance:i}=z(),[c,s]=C([]),[a,r]=C("default"),[l,d]=C(!1),u=_();async function h(m){d(!1),r("loading"),(async()=>{try{(m||!u.current)&&(u.current=o.v1.lists.$select(t).accounts.list({limit:Ji}));const f=await u.current.next();let{done:y,value:g}=f;g!=null&&g.length?(s(m?g:c.concat(g)),d(!y)):d(!1),r("default")}catch{r("error")}})()}return O(()=>{h(!0)},[]),e("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&e("button",{type:"button",class:"sheet-close",onClick:n,children:e(k,{icon:"x"})}),e("header",{children:e("h2",{children:"Manage members"})}),e("main",{children:e("ul",{children:[c.map(m=>e("li",{children:[e(qe,{account:m,instance:i}),e(Qi,{account:m,listID:t})]},m.id)),l&&a==="default"&&e(at,{as:"li",onChange:m=>m&&h(),children:e("button",{type:"button",class:"light block",onClick:h,children:"Show more…"})})]})})]})}function Qi({account:t,listID:n}){const{masto:o}=z(),[i,c]=C("default"),[s,a]=C(!1);return e(Fe,{confirm:!s,confirmLabel:e("span",{children:["Remove @",t.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(c("loading"),(async()=>{try{await o.v1.lists.$select(n).accounts.create({accountIds:[t.id]}),c("default"),a(!1)}catch{c("error")}})()):(c("loading"),(async()=>{try{await o.v1.lists.$select(n).accounts.remove({accountIds:[t.id]}),c("default"),a(!0)}catch{c("error")}})())},children:e("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:i==="loading",children:s?"Add":"Remove…"})})}const kn=20,eo=new URLSearchParams;function ns({columnMode:t,...n}){const{masto:o,instance:i}=z(),[c]=t?[eo]:Oe(),[s,a]=C(null),r=(n==null?void 0:n.type)||c.get("type")||s;Ae(`Mentions${r==="private"?" (Private)":""}`,"/mentions");const l=_(),d=_();async function u(p){(p||!l.current)&&(l.current=o.v1.notifications.list({limit:kn,types:["mention"]}));const b=await l.current.next();let{value:v}=b;return v!=null&&v.length&&(p&&(d.current=v[0].id),v.forEach(({status:T})=>{Ce(T,i)})),{...b,value:v==null?void 0:v.map(T=>T.status)}}const h=_(),m=_();async function f(p){(p||!h.current)&&(h.current=o.v1.conversations.list({limit:kn}));const b=await h.current.next();let{value:v}=b;return v=v==null?void 0:v.filter(T=>T.lastStatus),v!=null&&v.length&&(p&&(m.current=v[0].lastStatus.id),v.forEach(({lastStatus:T})=>{Ce(T,i)})),{...b,value:v==null?void 0:v.map(T=>T.lastStatus)}}function y(...p){return r==="private"?f(...p):u(...p)}async function g(){if(r==="private")try{const p=await o.v1.conversations.list({limit:1,since_id:m.current}).next();let{value:b}=p;return b!=null&&b.length?(m.current=b[0].lastStatus.id,!0):!1}catch{return!1}else try{const p=await o.v1.notifications.list({limit:1,types:["mention"],since_id:d.current}).next();let{value:b}=p;return b!=null&&b.length?(d.current=b[0].id,!0):!1}catch{return!1}}const w=ue(()=>e("div",{class:"filter-bar centered",children:[e(J,{to:"/mentions",class:r?"":"is-active",onClick:p=>{t&&(p.preventDefault(),a(null))},children:"All"}),e(J,{to:"/mentions?type=private",class:r==="private"?"is-active":"",onClick:p=>{t&&(p.preventDefault(),a("private"))},children:"Private"})]}),[r]);return e(Ge,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:i,fetchItems:y,checkForUpdates:g,useItemID:!0,timelineStart:w,refresh:r})}const to={mention:["account","status"],status:["account","status"],reblog:["account","status"],follow:["account"],follow_request:["account"],favourite:["account","status"],poll:["status"],update:["status"]};function no(t){return t.filter(n=>{const{type:o,id:i,createdAt:c}=n;if(!o)return!1;const s=to[o];return s!=null&&s.length?s.every(a=>!!n[a]):!0})}function ss(t){t=no(t);const n={},o=[];for(let s=0,a=0;s<t.length;s++){const r=t[s],{id:l,status:d,account:u,type:h,createdAt:m}=r,f=m?new Date(m).toLocaleDateString():"";let y=h;(h==="favourite"||h==="reblog")&&(y="favourite+reblog");const g=`${d==null?void 0:d.id}-${y}-${f}`,w=n[g];if(y==="follow_request")o[a++]=r;else if(w!=null&&w.account){const p=w._accounts.find(b=>b.id===u.id);p?(p._types.push(h),p._types.sort().reverse(),w.id+=`-${l}`):(u._types=[h],w._accounts.push(u),w.id+=`-${l}`)}else{u._types=[h];let p=n[g]={...r,type:y,_accounts:[u]};o[a++]=p}}const i={},c=[];for(let s=0,a=0;s<o.length;s++){const r=o[s],{id:l,account:d,_accounts:u,type:h,createdAt:m}=r,f=m?new Date(m).toLocaleDateString():"";if(h==="favourite+reblog"&&d&&u.length===1){const y=`${d==null?void 0:d.id}-${h}-${f}`,g=i[y];if(g)g._statuses.push(r.status),g.id+=`-${l}`;else{let w=i[y]={...r,type:h,_statuses:[r.status]};c[a++]=w}}else c[a++]=r}return c}const so=30,io=new URLSearchParams;function oo({columnMode:t}){Ae("Notifications","/notifications");const{masto:n,instance:o}=z(),i=ge(S),[c,s]=C("default"),[a]=t?[io]:Oe(),r=a.get("id"),l=a.get("access_token"),[d,u]=C(!1),[h,m]=C(!1),f=_(),{nearReachEnd:y,scrollDirection:g,reachStart:w,nearReachStart:p}=Mt({scrollableRef:f}),b=g==="end"&&!p,[v,T]=C([]),[x,E]=C([]),D=_();async function U(R){(R||!D.current)&&(D.current=n.v1.notifications.list({limit:so,excludeTypes:["follow_request"]}));const j=await D.current.next(),ee=j.value;if(ee!=null&&ee.length){ee.forEach(we=>{Ce(we.status,o,{skipThreading:!0})});const le=ss(ee);R?(S.notificationsLast=ee[0],S.notifications=le,n.v1.markers.create({notifications:{lastReadId:ee[0].id}}).catch(()=>{})):S.notifications.push(...le)}return S.notificationsShowNew=!1,S.notificationsLastFetchTime=Date.now(),j}async function B(){try{return await n.v1.followRequests.list({limit:80})}catch{return[]}}const P=()=>{s("loading"),(async()=>{try{const R=await B();T(R),s("default")}catch{s("error")}})()};async function M(){try{return await n.v1.announcements.list()}catch{return[]}}const $=R=>{N(!1),s("loading"),(async()=>{try{const j=U(R);R&&(M().then(le=>{le.sort((we,Ie)=>{const Te=new Date(we.updatedAt||we.createdAt);return new Date(Ie.updatedAt||Ie.createdAt)-Te}),E(le)}).catch(()=>{}),B().then(le=>{T(le)}).catch(()=>{}));const{done:ee}=await j;u(!ee),s("default")}catch{s("error")}})()};O(()=>{$(!0)},[]),O(()=>{w&&$(!0)},[w]);const[A,N]=C(!1),G=He(({disableIdleCheck:R=!1}={})=>{var j;c!=="loading"&&i.settings.autoRefresh&&((j=f.current)==null?void 0:j.scrollTop)<16&&(R||window.__IDLE__)&&!co()&&$(!0)},[i.notificationsShowNew,i.settings.autoRefresh,c]),te=_();ht(R=>{let j;if(R){const ee=Date.now()-te.current;!te.current||ee>1e3*3?G({disableIdleCheck:!0}):te.current=Date.now(),j=Ms(S,"notificationsShowNew",le=>{le&&G(),N(le)})}return()=>{j==null||j()}});const re=new Date,Q=new Date(re-24*60*60*1e3);let xe=new Date;const pe=!i.notifications.some(R=>new Date(R.createdAt).toDateString()===re.toDateString()),K=_();return O(()=>{r&&(S.routeNotification={id:r,accessToken:atob(l)})},[r,l]),e("div",{id:"notifications-page",class:"deck-container",ref:f,tabIndex:"-1",children:e("div",{class:`timeline-deck deck ${h?"only-mentions":""}`,children:[e("header",{hidden:b,onClick:R=>{var j;R.target.closest("a, button")||(j=f.current)==null||j.scrollTo({top:0,behavior:"smooth"})},class:c==="loading"?"loading":"",children:[e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(pt,{}),e(J,{to:"/",class:"button plain",children:e(k,{icon:"home",size:"l",alt:"Home"})})]}),e("h1",{children:"Notifications"}),e("div",{class:"header-side"})]}),A&&c!=="loading"&&e("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var R;$(!0),(R=f.current)==null||R.scrollTo({top:0,behavior:"smooth"})},children:[e(k,{icon:"arrow-up"})," New notifications"]})]}),x.length>0&&e("div",{class:"shazam-container",children:e("div",{class:"shazam-container-inner",children:e("details",{class:"announcements",children:[e("summary",{children:[e("span",{children:[e(k,{icon:"announce",class:"announcement-icon",size:"l"})," ",e("b",{children:["Announcement",x.length>1?"s":""]})," ",e("small",{class:"insignificant",children:o})]}),x.length>1&&e("span",{class:"announcements-nav-buttons",children:x.map((R,j)=>e("button",{type:"button",class:"plain2 small",onClick:()=>{var ee;(ee=K.current)==null||ee.children[j].scrollIntoView({behavior:"smooth",block:"nearest"})},children:j+1}))})]}),e("ul",{class:`announcements-list-${x.length>1?"multiple":"single"}`,ref:K,children:x.map(R=>e("li",{children:e(ao,{announcement:R})}))})]})})}),v.length>0&&e("div",{class:"follow-requests",children:[e("h2",{class:"timeline-header",children:"Follow requests"}),v.length>5?e("details",{children:[e("summary",{children:[v.length," follow requests"]}),e("ul",{children:v.map(R=>e("li",{children:[e(qe,{account:R}),e(Ft,{accountID:R.id,onChange:()=>{}})]},R.id))})]}):e("ul",{children:v.map(R=>e("li",{children:[e(qe,{account:R}),e(Ft,{accountID:R.id,onChange:()=>{}})]},R.id))})]}),e("div",{id:"mentions-option",children:e("label",{children:[e("input",{type:"checkbox",checked:h,onChange:R=>{m(R.target.checked)}})," ","Only mentions"]})}),e("h2",{class:"timeline-header",children:"Today"}),pe&&!!i.notifications.length&&e("p",{class:"ui-state insignificant",children:c==="default"?"You're all caught up.":e(L,{children:"…"})}),i.notifications.length?e(L,{children:i.notifications.filter(R=>R.type!=="follow_request").map(R=>{if(h&&R.type!=="mention")return null;const j=new Date(R.createdAt),ee=j.toDateString()!==xe.toDateString();ee&&(xe=j);const le=j.toDateString()===Q.toDateString()?"Yesterday":Ye(xe,{hideTime:!0});return e(L,{children:[ee&&e("h2",{class:"timeline-header",children:le}),e(Zt,{instance:o,notification:R},R.id)]},R.id)})}):e(L,{children:[c==="loading"&&e(L,{children:e("ul",{class:"timeline flat",children:Array.from({length:5}).map((R,j)=>e("li",{class:"notification skeleton",children:[e("div",{class:"notification-type",children:e(k,{icon:"notification",size:"xl"})}),e("div",{class:"notification-content",children:e("p",{children:"███████████ ████"})})]}))})}),c==="error"&&e("p",{class:"ui-state",children:["Unable to load notifications",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>$(!0),children:"Try again"})]})]}),d&&e(at,{onChange:R=>{R&&$()},children:e("button",{type:"button",class:"plain block",disabled:c==="loading",onClick:()=>$(),style:{marginBlockEnd:"6em"},children:c==="loading"?e(ve,{abrupt:!0}):e(L,{children:"Show more…"})})})]})})}function co(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function ao({announcement:t}){const{instance:n}=z(),{contact:o}=gs(),i=o==null?void 0:o.account,{id:c,content:s,startsAt:a,endsAt:r,published:l,allDay:d,publishedAt:u,updatedAt:h,read:m,mentions:f,statuses:y,tags:g,emojis:w,reactions:p}=t,b=new Date(u),v=Ye(b),T=new Date(h),x=Ye(T);return e("div",{class:"announcement-block",children:[e(qe,{account:i}),e("div",{class:"announcement-content",onClick:Mn({mentions:f,instance:n}),dangerouslySetInnerHTML:{__html:_t(s,{emojis:w})}}),e("p",{class:"insignificant",children:[e("time",{datetime:b.toISOString(),children:Ye(b)}),h&&x!==v&&e(L,{children:[" ","•"," ",e("span",{class:"ib",children:["Updated"," ",e("time",{datetime:T.toISOString(),children:Ye(T)})]})]})]}),e("div",{class:"announcement-reactions",hidden:!0,children:p.map(E=>{const{name:D,count:U,me:B,staticUrl:P,url:M}=E;return e("button",{type:"button",class:`plain4 small ${B?"reacted":""}`,children:[M||P?e("img",{src:M||P,alt:D,width:"16",height:"16"}):e("span",{children:D})," ",e("span",{class:"count",children:_e(U)})]})})})]})}const is=ze(oo),ro=20;function zt({local:t,columnMode:n,...o}){const i=ge(S),c=!!t,s=n?{}:nt(),{masto:a,instance:r}=z({instance:(o==null?void 0:o.instance)||s.instance}),{masto:l,instance:d}=z(),u=`${c?"Local":"Federated"} timeline (${r})`;Ae(u,c?"/:instance?/p/l":"/:instance?/p");const h=_(),m=_();async function f(g){(g||!m.current)&&(m.current=a.v1.timelines.public.list({limit:ro,local:c}));const w=await m.current.next();let{value:p}=w;return p!=null&&p.length&&(g&&(h.current=p[0].id),p.forEach(b=>{Ce(b,r)})),{...w,value:p}}async function y(){try{const g=await a.v1.timelines.public.list({limit:1,local:c,since_id:h.current}).next();let{value:w}=g;return w=ft(w,"public"),!!(w!=null&&w.length)}catch{return!1}}return e(Ge,{title:u,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:c?"Local timeline":"Federated timeline"}),e("div",{children:r})]}),id:"public",instance:r,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:y,useItemID:!0,headerStart:e(L,{}),boostsCarousel:i.settings.boostsCarousel,filterContext:"public",headerEnd:e(Ne,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(k,{icon:"more",size:"l"})}),children:[e(se,{href:c?`/#/${r}/p`:`/#/${r}/p/l`,children:c?e(L,{children:[e(k,{icon:"transfer"})," ",e("span",{children:"Switch to Federated"})]}):e(L,{children:[e(k,{icon:"transfer"})," ",e("span",{children:"Switch to Local"})]})}),e(Ee,{}),e(se,{onClick:()=>{let g=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(g)){g&&alert("Invalid instance");return}g&&(g=g.toLowerCase().trim(),location.hash=c?`/${g}/p/l`:`/${g}/p`)},children:[e(k,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),d!==r&&e(se,{onClick:()=>{location.hash=c?`/${d}/p/l`:`/${d}/p`},children:[e(k,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:d}),")"]})]})]})},r+c)}const lo=20,uo=tt(t=>t.v1.trends.links.list().next(),{maxAge:10*60*1e3});function os({columnMode:t,...n}){const o=ge(S),i=t?{}:nt(),{masto:c,instance:s}=z({instance:(n==null?void 0:n.instance)||i.instance}),{masto:a,instance:r}=z(),l=`Trending (${s})`;Ae(l,"/:instance?/trending");const d=_(),[u,h]=C([]),[m,f]=C([]),y=_();async function g(b){var x;if(b||!y.current){y.current=c.v1.trends.statuses.list({limit:lo});try{const E=c.v1.trends.tags.list(),{value:D}=await E.next();D!=null&&D.length&&h(D)}catch{}try{const{value:E}=await uo(c),D=(x=E==null?void 0:E.filter)==null?void 0:x.call(E,U=>U.type==="link");D!=null&&D.length&&f(D)}catch{}}const v=await y.current.next();let{value:T}=v;return T!=null&&T.length&&(b&&(d.current=T[0].id),T.forEach(E=>{Ce(E,s)})),{...v,value:T}}async function w(){try{const b=await c.v1.trends.statuses.list({limit:1}).next();let{value:v}=b;return v=ft(v,"public"),v!=null&&v.length&&v[0].id!==d.current?(d.current=v[0].id,!0):!1}catch{return!1}}const p=ue(()=>e(L,{children:[!!u.length&&e("div",{class:"filter-bar expandable",children:[e(k,{icon:"chart",class:"insignificant",size:"l"}),u.map((b,v)=>{const{name:T,history:x}=b,E=x.reduce((D,U)=>D+ +U.uses,0);return e(J,{to:`/${s}/t/${T}`,children:[e("span",{children:[e("span",{class:"more-insignificant",children:"#"}),T]}),e("span",{class:"filter-count",children:_e(E)})]},T)})]}),!!m.length&&e("div",{class:"links-bar",children:[e("header",{children:e("h3",{children:"Trending News"})}),m.map(b=>{const{authorName:v,authorUrl:T,blurhash:x,description:E,height:D,image:U,imageDescription:B,language:P,providerName:M,providerUrl:$,publishedAt:A,title:N,url:G,width:te}=b,re=new URL(G).hostname.replace(/^www\./,"").replace(/\/$/,"");let Q;if(x){const xe=Nn(x),pe=Wn(xe);Q=Kn([.6,pe[1],pe[2]])}return e("a",{href:G,target:"_blank",rel:"noopener noreferrer",style:Q?{"--accent-color":`rgb(${Q.join(",")})`,"--accent-alpha-color":`rgba(${Q.join(",")}, 0.4)`}:{},children:e("article",{children:[e("figure",{children:e("img",{src:U,alt:B,width:te,height:D,loading:"lazy"})}),e("div",{class:"article-body",children:[e("header",{children:[e("div",{class:"article-meta",children:[e("span",{class:"domain",children:re})," ",!!A&&e(L,{children:"· "}),!!A&&e(L,{children:e($t,{datetime:A,format:"micro"})})]}),!!N&&e("h1",{class:"title",lang:P,dir:"auto",children:N})]}),!!E&&e("p",{class:"description",lang:P,dir:"auto",children:E})]})]})},G)})]})]}),[u,m]);return e(Ge,{title:l,titleComponent:e("h1",{class:"header-double-lines",children:[e("b",{children:"Trending"}),e("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:g,checkForUpdates:w,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:e(L,{}),boostsCarousel:o.settings.boostsCarousel,filterContext:"public",timelineStart:p,headerEnd:e(Ne,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:e("button",{type:"button",class:"plain",children:e(k,{icon:"more",size:"l"})}),children:[e(se,{onClick:()=>{let b=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(b)){b&&alert("Invalid instance");return}b&&(b=b.toLowerCase().trim(),location.hash=`/${b}/trending`)},children:[e(k,{icon:"bus"})," ",e("span",{children:"Go to another instance…"})]}),r!==s&&e(se,{onClick:()=>{location.hash=`/${r}/trending`},children:[e(k,{icon:"bus"})," ",e("small",{class:"menu-double-lines",children:["Go to my instance (",e("b",{children:r}),")"]})]})]})},s)}function ho(){Ae("Home","/");const t=ge(S),{shortcuts:n}=t,o=n.map(i=>{if(!i)return null;const{type:c,...s}=i,a={following:Jt,notifications:is,list:ts,public:zt,bookmarks:Xn,favourites:Qn,hashtag:es,mentions:ns,trending:os}[c];return a?e(a,{...s,columnMode:!0},c+JSON.stringify(s)):null});return Le(["1","2","3","4","5","6","7","8","9"],(i,c)=>{try{const s=parseInt(c.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),e("div",{id:"columns",onContextMenu:i=>{i.target.closest(".deck > header")&&!i.target.closest("a")&&!i.target.closest("button")&&(i.preventDefault(),S.showShortcutsSettings=!0)},children:o})}function fo(){var n;const t=ge(S);return O(()=>{(async()=>{const o=await lt.drafts.keys();if(o.length){const i=Rn();o.filter(s=>s.startsWith(i)).length&&(S.showDrafts=!0)}})()},[]),e(L,{children:(t.settings.shortcutsViewMode==="multi-column"||!t.settings.shortcutsViewMode&&t.settings.shortcutsColumnsMode)&&((n=t.shortcuts)!=null&&n.length)?e(ho,{}):e(Jt,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:e(po,{})})})}function po(){const t=ge(S),n=_(),[o,i]=C(void 0);return e(L,{children:[e(J,{ref:n,to:"/notifications",class:`button plain notifications-button ${t.notificationsShowNew?"has-badge":""} ${o||""}`,onClick:c=>{c.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(c.preventDefault(),i(s=>s?void 0:"open"))},children:e(k,{icon:"notification",size:"l",alt:"Notifications"})}),e(bo,{state:o,anchorRef:n,onClose:()=>i(void 0)})]})}const mo=30,go=5;function bo({anchorRef:t,state:n,onClose:o}){const{masto:i,instance:c}=z(),s=ge(S),[a,r]=C("default"),l=i.v1.notifications.list({limit:mo});async function d(){const y=await l.next(),g=y.value;if(g!=null&&g.length){g.forEach(p=>{Ce(p.status,c,{skipThreading:!0})});const w=ss(g);S.notificationsLast=g[0],S.notifications=w,i.v1.markers.create({notifications:{lastReadId:g[0].id}}).catch(()=>{})}return S.notificationsShowNew=!1,S.notificationsLastFetchTime=Date.now(),y}const[u,h]=C(!1);function m(){return i.v1.followRequests.list({limit:1})}function f(){r("loading"),(async()=>{try{await d();const y=await m();h(!!(y!=null&&y.length)),r("default")}catch{r("error")}})()}return O(()=>{n==="open"&&f()},[n]),e(zn,{menuClassName:"notifications-menu",state:n,anchorRef:t,onClose:o,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[e("header",{children:e("h2",{children:"Notifications"})}),e("main",{children:s.notifications.length?e(L,{children:s.notifications.slice(0,go).map(y=>e(Zt,{instance:c,notification:y,disableContextMenu:!0},y.id))}):a==="loading"?e("div",{class:"ui-state",children:e(ve,{abrupt:!0})}):a==="error"&&e("div",{class:"ui-state",children:[e("p",{children:"Unable to fetch notifications."}),e("p",{children:e("button",{type:"button",onClick:f,children:"Try again"})})]})}),e("footer",{children:[e(J,{to:"/mentions",class:"button plain",children:[e(k,{icon:"at"})," ",e("span",{children:"Mentions"})]}),e(J,{to:"/notifications",class:"button plain2",children:[u?e(L,{children:[e("span",{class:"tag collapsed",children:"New"})," ",e("span",{children:"Follow Requests"})]}):e("b",{children:"See all"})," ",e(k,{icon:"arrow-right"})]})]})]})}const yo=ze(fo),wo=[/^\/@[^@\/]+\/(?:statuses|posts)\/([^\/]+)/i,/\/notes\/([^\/]+)/i,/^\/(?:notice|objects)\/([a-z0-9-]+)/i,/\/@[^@\/]+@?[^\/]+?\/([^\/]+)/i];function cs(t){const{hostname:n,pathname:o}=new URL(t);for(const i of wo){const[,c]=o.match(i)||[];if(c)return{instance:n,id:c}}return null}function vo(t){const{instance:n,id:o}=cs(t);return n&&o?`/${n}/s/${o}`:null}function ko(){const n=ct().pathname.replace(/^\//,""),o=cs(n),i=o!=null&&o.instance?`/${o.instance}/s/${o.id}`:null,[c,s]=C("loading");return Ve(()=>{s("loading"),(async()=>{try{const{instance:a,id:r}=o,{masto:l}=z({instance:a});if(await l.v1.statuses.$select(r).fetch()){window.location.hash=i+"?view=full";return}}catch{}{const{masto:a,instance:r}=z(),l=await a.v2.search.fetch({q:n,type:"statuses",limit:1,resolve:!0});if(l.statuses.length){const d=l.statuses[0];window.location.hash=`/${r}/s/${d.id}?view=full`}else window.location.hash=i+"?view=full"}})()},[i]),e("div",{class:"ui-state",tabIndex:"-1",children:[c==="loading"?e(L,{children:[e(ve,{abrupt:!0}),e("h2",{children:"Resolving…"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}):e(L,{children:[e("h2",{children:"Unable to resolve URL"}),e("p",{children:e("a",{href:n,target:"_blank",rel:"noopener noreferrer",children:n})})]}),e("hr",{}),e("p",{children:e(J,{to:"/",children:"Go home"})})]})}function So(){const{masto:t}=z();Ae("Lists","/l");const[n,o]=C("default"),[i,c]=Ct(d=>d+1,0),[s,a]=C([]);O(()=>{o("loading"),(async()=>{try{const d=await t.v1.lists.list();d.sort((u,h)=>u.title.localeCompare(h.title)),a(d),o("default")}catch{o("error")}})()},[i]);const[r,l]=C(!1);return e("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[e("div",{class:"timeline-deck deck",children:[e("header",{children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:[e(pt,{}),e(J,{to:"/",class:"button plain",children:e(k,{icon:"home",size:"l"})})]}),e("h1",{children:"Lists"}),e("div",{class:"header-side",children:e("button",{type:"button",class:"plain",onClick:()=>l(!0),children:e(k,{icon:"plus",size:"l",alt:"New list"})})})]})}),e("main",{children:s.length>0?e("ul",{class:"link-list",children:s.map(d=>e("li",{children:e(J,{to:`/l/${d.id}`,children:e("span",{children:[e(k,{icon:"list"})," ",e("span",{children:d.title})]})})}))}):n==="loading"?e("p",{class:"ui-state",children:e(ve,{})}):n==="error"?e("p",{class:"ui-state",children:"Unable to load lists."}):e("p",{class:"ui-state",children:"No lists yet."})})]}),r&&e(Se,{class:"light",onClick:d=>{d.target===d.currentTarget&&l(!1)},children:e(Wt,{list:r==null?void 0:r.list,onClose:d=>{d.state==="success"&&c(),l(!1)}})})]})}const Io=""+new URL("instances-cddSOnAA.json",import.meta.url).href;var To={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_CLIENT_NAME:$o,VITE_WEBSITE:Co}=To,Xt="read write follow push";async function xo({instanceURL:t}){const n=new URLSearchParams({client_name:$o,redirect_uris:location.origin+location.pathname,scopes:Xt,website:Co});return await(await fetch(`https://${t}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function Mo({instanceURL:t,client_id:n}){const o=new URLSearchParams({client_id:n,scope:Xt,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${t}/oauth/authorize?${o.toString()}`}async function Lo({instanceURL:t,client_id:n,client_secret:o,code:i}){const c=new URLSearchParams({client_id:n,client_secret:o,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:i,scope:Xt});return await(await fetch(`https://${t}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c.toString()})).json()}function Ao(){Ae("Log in");const t=_(),n=ne.local.get("instanceURL"),[o,i]=C("default"),[c]=Oe(),s=c.get("instance"),[a,r]=C(s||(n==null?void 0:n.toLowerCase())||""),[l,d]=C([]);O(()=>{(async()=>{try{const p=await(await fetch(Io)).json();d(p)}catch{}})()},[]);const u=w=>{w&&(ne.local.set("instanceURL",w),(async()=>{i("loading");try{const{client_id:p,client_secret:b,vapid_key:v}=await xo({instanceURL:w});p&&b?(ne.session.set("clientID",p),ne.session.set("clientSecret",b),ne.session.set("vapidKey",v),location.href=await Mo({instanceURL:w,client_id:p})):alert("Failed to register application"),i("default")}catch{i("error")}})())},h=a?a.replace(/^https?:\/\//,"").replace(/\/+$/,"").replace(/^@?[^@]+@/,"").trim():null,m=/[^\s\r\n\t\/\\]+\.[^\s\r\n\t\/\\]+/.test(h)&&!/[\s\/\\@]/.test(h),f=h?l.filter(w=>w.includes(a)).sort((w,p)=>{const b=w.toLowerCase().startsWith(a.toLowerCase()),v=p.toLowerCase().startsWith(a.toLowerCase());return b&&!v?-1:!b&&v?1:0}).slice(0,10):[],y=m?h:f!=null&&f.length?f[0]:a?l.find(w=>w.includes(a)):null;return e("main",{id:"login",style:{textAlign:"center"},children:e("form",{onSubmit:w=>{w.preventDefault(),u(y)},children:[e("h1",{children:[e("img",{src:jt,alt:"",width:"80",height:"80"}),e("br",{}),"Log in"]}),e("label",{children:[e("p",{children:"Instance"}),e("input",{value:a,required:!0,type:"text",class:"large",id:"instanceURL",ref:t,disabled:o==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:w=>{r(w.target.value)}}),(f==null?void 0:f.length)>0?e("ul",{id:"instances-suggestions",children:f.map((w,p)=>e("li",{children:e("button",{type:"button",class:"plain5",onClick:()=>{u(w)},children:w})}))}):e("div",{id:"instances-eg",children:"e.g. “mastodon.social”"})]}),o==="error"&&e("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),e("div",{children:[e("button",{disabled:o==="loading"||!a||!y,children:y?`Continue with ${y}`:"Continue"})," "]}),e(ve,{hidden:o!=="loading"}),e("hr",{}),e("p",{children:e("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),e("p",{children:e(J,{to:"/",children:"Go home"})})]})})}const bt=5,Dt=40;function Ro(t){const n=nt(),{masto:o,instance:i,authenticated:c}=z({instance:n.instance}),[s,a]=C("default"),[r]=Oe(),l=_(),d=(t==null?void 0:t.query)||r.get("q"),u=(t==null?void 0:t.type)||r.get("type");Ae(d?`Search: ${d}${u?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[u]})`:""}`:"Search","/search");const[h,m]=C(!1),f=_(0);O(()=>{f.current=0},[d,u]);const y=_();Ve(()=>{var M,$;($=(M=y.current)==null?void 0:M.scrollTo)==null||$.call(M,0,0)},[d,u]);const[g,w]=C([]),[p,b]=C([]),[v,T]=C([]);O(()=>{w([]),b([]),T([])},[d]);const x={statuses:w,accounts:b,hashtags:T},[E,D]=C({}),U=async M=>{if(!(M!=null&&M.length))return;const $=await Kt(M,E);$&&D({...E,...$})};function B(M){!M&&!c||(a("loading"),M&&!u&&(w(g.slice(0,bt)),b(p.slice(0,bt)),T(v.slice(0,bt))),(async()=>{var A,N;const $={q:d,resolve:c,limit:bt};u&&($.limit=Dt,$.type=u,c&&($.offset=f.current));try{const G=await o.v2.search.fetch($);if(u)if(M){x[u](G[u]);const te=(A=G[u])==null?void 0:A.length;f.current=Dt,m(!!te)}else{x[u](re=>[...re,...G[u]]);const te=(N=G[u])==null?void 0:N.length;f.current=f.current+Dt,m(!!te)}else w(G.statuses||[]),b(G.accounts||[]),T(G.hashtags||[]),f.current=0,m(!1);U(G.accounts),a("default")}catch{a("error")}})())}O(()=>{var M,$,A,N;d?(($=(M=l.current)==null?void 0:M.setValue)==null||$.call(M,d),B(!0)):(N=(A=l.current)==null?void 0:A.focus)==null||N.call(A)},[d,u,i]),Le("/",M=>{var $,A;(A=($=l.current)==null?void 0:$.focus)==null||A.call($)},{preventDefault:!0});const[P]=Ht();return e("div",{id:"search-page",class:"deck-container",ref:y,children:e("div",{class:"timeline-deck deck",children:[e("header",{class:s==="loading"?"loading":"",children:e("div",{class:"header-grid",children:[e("div",{class:"header-side",children:e(pt,{})}),e(Jn,{ref:l}),e("div",{class:"header-side",children:" "})]})}),e("main",{children:[!!d&&e("div",{ref:P,class:`filter-bar ${s==="loading"?"loading":""}`,children:[!!u&&e(J,{to:`/search${d?`?q=${encodeURIComponent(d)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(d)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(d)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(d)}&type=statuses`}].sort((M,$)=>M.type===u?-1:$.type===u?1:0).map(M=>e(J,{to:M.to,children:M.label},M.type))]}),d?e(L,{children:[(!u||u==="accounts")&&e(L,{children:[u!=="accounts"&&e("h2",{class:"timeline-header",children:"Accounts"}),p.length>0?e(L,{children:[e("ul",{class:"timeline flat accounts-list",children:p.map(M=>e("li",{children:e(qe,{account:M,instance:i,showStats:!0,relationship:E[M.id]})},M.id))}),u!=="accounts"&&e("div",{class:"ui-state",children:e(J,{class:"plain button",to:`/search?q=${d}&type=accounts`,children:["See more accounts ",e(k,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No accounts found."}))]}),(!u||u==="hashtags")&&e(L,{children:[u!=="hashtags"&&e("h2",{class:"timeline-header",children:"Hashtags"}),v.length>0?e(L,{children:[e("ul",{class:"link-list hashtag-list",children:v.map(M=>{var G;const{name:$,history:A}=M,N=(G=A==null?void 0:A.reduce)==null?void 0:G.call(A,(te,re)=>te+ +re.uses,0);return e("li",{children:e(J,{to:i?`/${i}/t/${$}`:`/t/${$}`,children:[e(k,{icon:"hashtag"}),e("span",{children:$}),!!N&&e("span",{class:"count",children:_e(N)})]})},`${$}-${N}`)})}),u!=="hashtags"&&e("div",{class:"ui-state",children:e(J,{class:"plain button",to:`/search?q=${d}&type=hashtags`,children:["See more hashtags ",e(k,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No hashtags found."}))]}),(!u||u==="statuses")&&e(L,{children:[u!=="statuses"&&e("h2",{class:"timeline-header",children:"Posts"}),g.length>0?e(L,{children:[e("ul",{class:"timeline",children:g.map(M=>e("li",{children:e(J,{class:"status-link",to:i?`/${i}/s/${M.id}`:`/s/${M.id}`,children:e(Me,{status:M})})},M.id))}),u!=="statuses"&&e("div",{class:"ui-state",children:e(J,{class:"plain button",to:`/search?q=${d}&type=statuses`,children:["See more posts ",e(k,{icon:"arrow-right"})]})})]}):!u&&(s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"No posts found."}))]}),!!u&&(s==="default"?h?e(at,{onChange:M=>{M&&B()},children:e("button",{type:"button",class:"plain block",onClick:()=>B(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):e("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}))]}):s==="loading"?e("p",{class:"ui-state",children:e(ve,{abrupt:!0})}):e("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const yt=40,Eo=10,Do=5;let Ot={},vt={},kt={};function Bt(t){delete vt[t],delete kt[t]}const rt={block:"nearest",inline:"center",behavior:"smooth"},Sn=".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)",In=/\/s\//i;function _o(t){const{id:n}=t,{masto:o,instance:i}=z({instance:t.instance}),c=ge(S),[s,a]=Oe(),r=s.get("media"),l=s.get("media-only"),d=parseInt(r||l,10);let u=d>0;const h=s.get("mediaStatusID"),m=Pn(h,i);h&&!m&&(u=!1);const f=u&&!!l,y=je(n,i),[g,w]=C(S.statuses[y]);O(()=>{S.statuses[y]&&w(S.statuses[y])},[y]);const p=ue(()=>{const{prevLocation:T}=S,x=((T==null?void 0:T.pathname)||"")+((T==null?void 0:T.search)||""),E=ut("/:instance/s/:id",x)||ut("/s/:id",x);return!x||E?"/":x},[]);O(()=>{!g&&u&&(async()=>{try{const T=await o.v1.statuses.$select(n).fetch();Ce(T,i),w(T)}catch{alert("Unable to load post."),location.hash=p}})()},[u]);const b=h?m==null?void 0:m.mediaAttachments:g==null?void 0:g.mediaAttachments,v=He(()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&c.prevLocation?history.back():f?location.hash=p:(s.delete("media"),s.delete("mediaStatusID"),a(s))},[f,p,c.prevLocation]);return O(()=>{let T=setTimeout(()=>{const x=document.querySelector(".carousel");x&&x.focus()},100);return()=>clearTimeout(T)},[f]),e("div",{class:"deck-backdrop",children:[u?b!=null&&b.length?e(Zn,{mediaAttachments:b,statusID:h||n,instance:i,lang:g==null?void 0:g.language,index:d-1,onClose:v}):e("div",{class:"media-modal-container loading",children:e(ve,{abrupt:!0})}):e(J,{to:p}),!f&&e(Po,{id:n,instance:t.instance,closeLink:p})]})}function Po({id:t,closeLink:n="/",instance:o}){var ce,X;const[i,c]=Oe(),s=i.get("media"),a=i.get("mediaStatusID"),r=parseInt(s,10)>0,l=_(!S.prevLocation&&(history.length===1||"navigation"in window&&((X=(ce=navigation==null?void 0:navigation.entries)==null?void 0:ce.call(navigation))==null?void 0:X.length)===1)),[d,u]=C(i.get("view")||l.current?"full":null),h=!!parseInt(i.get("translate")),{masto:m,instance:f}=z({instance:o}),{masto:y,instance:g,authenticated:w}=z(),p=f===g,b=ge(S),[v,T]=C([]),[x,E]=C("default"),D=_(),U=je(t,f),B=_(0),P=_();O(()=>{var I;(I=P.current)==null||I.focus()},[]),O(()=>{var F;const I=qn(()=>{if(!P.current)return;const{scrollTop:Y}=P.current;x!=="loading"&&(kt[t]=Y)},50);return(F=P.current)==null||F.addEventListener("scroll",I,{passive:!0}),I(),()=>{var Y;I.cancel(),(Y=P.current)==null||Y.removeEventListener("scroll",I)}},[t,x!=="loading"]);const M=_(),$=({reloadHero:I}={})=>{E("loading");let F;const Y=vt[t];if(Y){const ie=Y.filter(fe=>S.statuses[U]);T(ie)}else T([{id:t}]);return(async()=>{var We,H;const ie=()=>an(()=>m.v1.statuses.$select(t).fetch(),{retries:4}),fe=an(()=>m.v1.statuses.$select(t).context.fetch(),{retries:8}),$e=!!b.statuses[U];let be=b.statuses[U];if(!($e&&!I))try{be=await ie(),Ce(be,f),await new Promise(oe=>{setTimeout(oe,100)})}catch{E("error");return}try{let oe=function(Z){return Z==null?void 0:Z.map(ye=>({id:ye.id,account:ye.account,repliesCount:ye.repliesCount,content:ye.content,weight:dt(ye),replies:oe(ye.__replies)}))};const me=await fe,{ancestors:ae,descendants:Pe}=me;B.current=(Pe==null?void 0:Pe.length)||0;const Be=new Set;ae.forEach(Z=>{Ce(Z,f,{skipThreading:!0}),Z.inReplyToId&&!ae.find(ye=>ye.id===Z.inReplyToId)&&Be.add(Z.inReplyToId)});const De=ae.every(Z=>Z.account.id===be.account.id),Ue=[];Pe.forEach(Z=>{if(Ce(Z,f,{skipThreading:!0}),Z.inReplyToId&&!Pe.find(ye=>ye.id===Z.inReplyToId)&&Z.inReplyToId!==be.id&&Be.add(Z.inReplyToId),Z.inReplyToAccountId===Z.account.id)Ue.push(Z);else if(Z.inReplyToId===be.id)Ue.push(Z);else if(!Z.inReplyToAccountId&&Ue.find(ye=>ye.id===Z.inReplyToId)&&Z.account.id===be.account.id)Ue.push(Z);else{const ye=Pe.find(Ze=>Ze.id===Z.inReplyToId);ye&&(ye.__replies||(ye.__replies=[]),ye.__replies.push(Z))}}),Be.size;const Ke=[...ae.map(Z=>({id:Z.id,ancestor:!0,isThread:De,accountID:Z.account.id,account:Z.account,repliesCount:Z.repliesCount,weight:dt(Z)})),{id:t,accountID:be.account.id,weight:dt(be)},...Ue.map(Z=>({id:Z.id,account:Z.account,accountID:Z.account.id,descendant:!0,thread:Z.account.id===be.account.id,weight:dt(Z),replies:oe(Z.__replies)}))];E("default"),M.current={offsetTop:(We=D.current)==null?void 0:We.offsetTop,scrollTop:(H=P.current)==null?void 0:H.scrollTop};const Xe=Ke.findIndex(Z=>Z.id===t);Xe>=Q&&xe(Xe+1),T(Ke),vt[t]=Ke,bs(be,f)}catch{E("error")}})(),()=>{clearTimeout(F)}};O($,[t,m]),O(()=>{var F,Y;if(!v.length)return;const I=kt[t];if(I)P.current.scrollTop=I;else if(M.current){const ie={offsetTop:(F=D.current)==null?void 0:F.offsetTop,scrollTop:(Y=P.current)==null?void 0:Y.scrollTop},fe=ie.offsetTop-M.current.offsetTop+ie.scrollTop;P.current.scrollTop=fe}else v.length===1&&(P.current.scrollTop=0);M.current=null},[v]),O(()=>{b.reloadStatusPage<=0||(async()=>{try{const{instanceURL:I}=ot(),F=`https://${I}/api/v1/statuses/${t}/context`;return await(await caches.open("api")).delete(F,{ignoreVary:!0}),$({reloadHero:!0})}catch{}})()},[b.reloadStatusPage]),O(()=>()=>{kt={},S.reloadStatusPage=0,vt={},Ot={},qt.clear()},[]);const A=b.statuses[U]||b.statuses[t],N=ue(()=>{if(!A)return"";const{account:I}=A,F=document.createElement("div");return F.innerHTML=I.displayName,F.innerText.trim()},[A]),G=ue(()=>{if(!A)return"";let I=_n(A);return I.length>64&&(I=I.slice(0,64)+"…"),I},[A]);Ae(N&&G?`${N}: "${G}"`:"Status","/:instance?/s/:id");const te=ue(()=>{if(!A)return;const{url:I}=A;if(I)return new URL(I).hostname},[A]),re=ue(()=>{if(te)return te===f},[te,f]),[Q,xe]=C(yt),pe=ue(()=>v.length-Q,[v.length,Q]),K=v.some(I=>I.descendant),R=v.filter(I=>I.ancestor),[j,ee]=C(!0),le=On(ee,100),we=ue(()=>{if(!D.current||j)return null;const{top:I}=D.current.getBoundingClientRect();return I>0?"down":"up"},[j]);Le("esc",()=>{location.hash=n},{enabled:!r,ignoreEventWhen:I=>!!document.querySelector("#modal-container > *")}),Le("backspace",()=>{location.hash=n}),Le("j",()=>{const I=document.activeElement.closest(".status-link, .status-focus"),F=I==null?void 0:I.getBoundingClientRect(),Y=Array.from(P.current.querySelectorAll(Sn));if(I&&F.top<P.current.clientHeight&&F.bottom>0){const ie=Y.indexOf(I);let fe=Y[ie+1];fe&&(fe.focus(),fe.scrollIntoView(rt))}else{const ie=Y.find(fe=>{const $e=fe.getBoundingClientRect();return $e.top>=44&&$e.left>=0});ie&&(ie.focus(),ie.scrollIntoView(rt))}}),Le("k",()=>{const I=document.activeElement.closest(".status-link, .status-focus"),F=I==null?void 0:I.getBoundingClientRect(),Y=Array.from(P.current.querySelectorAll(Sn));if(I&&F.top<P.current.clientHeight&&F.bottom>0){const ie=Y.indexOf(I);let fe=Y[ie-1];fe&&(fe.focus(),fe.scrollIntoView(rt))}else{const ie=Y.find(fe=>{const $e=fe.getBoundingClientRect();return $e.top>=44&&$e.left>=0});ie&&(ie.focus(),ie.scrollIntoView(rt))}}),Le("x",()=>{const I=document.activeElement.closest(".status-link, .status-focus");if(I){const F=I.nextElementSibling;F&&F.tagName.toLowerCase()==="details"&&(F.open=!F.open)}});const{nearReachStart:Ie}=Mt({scrollableRef:P,distanceFromStartPx:16}),Te=_(r?"media+status":"status"),W=He((I,F,Y,ie)=>{I.preventDefault(),I.stopPropagation(),c({media:F+1,mediaStatusID:ie.id})},[t]),q=He((I,F)=>{Bt(F.id)},[]);O(()=>{let I;return a&&r&&(I=setTimeout(()=>{var Y;const F=(Y=P.current)==null?void 0:Y.querySelector(`.status-link[href*="/${a}"]`);F&&F.scrollIntoView(rt)},400)),()=>{clearTimeout(I)}},[a,r]);const V=He(I=>{const{id:F,ancestor:Y,isThread:ie,descendant:fe,thread:$e,replies:be,repliesCount:We,weight:H}=I,oe=F===t;return e("li",{ref:oe?D:null,class:`${Y?"ancestor":""} ${fe?"descendant":""} ${$e?"thread":""} ${oe?"hero":""}`,children:[oe?e(L,{children:[e(at,{threshold:.1,onChange:le,class:"status-focus",tabIndex:0,children:e(Me,{statusID:F,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:h})}),x!=="loading"&&!w?e("div",{class:"post-status-banner",children:[e("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),e(J,{to:"/login",class:"button",children:"Log in"})]}):!p&&e("div",{class:"post-status-banner",children:[e("p",{children:["This post is from another instance (",e("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),e("button",{type:"button",disabled:x==="loading",onClick:()=>{E("loading"),(async()=>{try{const me=await y.v2.search.fetch({q:A.url,type:"statuses",resolve:!0,limit:1});if(me.statuses.length){const ae=me.statuses[0];location.hash=g?`/${g}/s/${ae.id}`:`/s/${ae.id}`}else throw new Error("No results")}catch(me){E("default"),alert("Error: "+me)}})()},children:[e(k,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):e(J,{class:"status-link",to:f?`/${f}/s/${F}`:`/s/${F}`,onClick:()=>{Bt(F)},children:[e(Me,{statusID:F,instance:f,withinContext:!0,size:$e||Y?"m":"s",enableTranslate:!0,onMediaClick:W,onStatusLinkClick:q}),Y&&ie&&We>1&&e("div",{class:"replies-link",children:[e(k,{icon:"comment2"})," ",e("span",{title:We,children:_e(We)})]})," "]}),fe&&(be==null?void 0:be.length)>0&&e(as,{instance:f,replies:be,hasParentThread:$e,level:1,accWeight:H,openAll:B.current<Eo}),x==="loading"&&oe&&!!(A!=null&&A.repliesCount)&&!K&&e("div",{class:"status-loading",children:e(ve,{})}),x==="error"&&oe&&!!(A!=null&&A.repliesCount)&&!K&&e("div",{class:"status-error",children:["Unable to load replies.",e("br",{}),e("button",{type:"button",class:"plain",onClick:()=>{S.reloadStatusPage++},children:"Try again"})]})]},F)},[t,f,x,w,p,h,W,q,K]),he=ue(()=>{var I;if("navigation"in window&&(navigation!=null&&navigation.entries)){const F=navigation.entries()[navigation.currentEntry.index-1];if(F!=null&&F.url)return In.test(F.url)}return In.test((I=S.prevLocation)==null?void 0:I.pathname)},[U]);return e("div",{tabIndex:"-1",ref:P,class:`status-deck deck contained ${v.length>1?"padded-bottom":""} ${Te.current==="status"&&!l.current?"slide-in":""} ${d?`deck-view-${d}`:""}`,onAnimationEnd:I=>{Te.current==="status"&&(Te.current=null)},children:[e("header",{class:`${j?"inview":""} ${x==="loading"?"loading":""}`,onDblClick:I=>{S.reloadStatusPage++},children:e("div",{class:"header-grid header-grid-2",children:[e("h1",{children:[he&&e("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:e(k,{icon:"chevron-left",size:"xl"})}),!j&&A&&x!=="loading"?e(L,{children:[e("span",{class:"hero-heading",children:[e(St,{account:A.account,instance:f,showAvatar:!0,short:!0})," ",e("span",{class:"insignificant",children:["•"," ",e($t,{datetime:A.createdAt,format:"micro"})]})]})," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),D.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:e(k,{icon:we==="down"?"arrow-down":"arrow-up"})})]}):e(L,{children:["Post"," ",e("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),P.current.scrollTo({top:0,behavior:"smooth"})},hidden:!R.length||Ie,title:`${R.length} posts above ‒ Go to top`,children:[e(k,{icon:"arrow-up"}),R.filter((I,F,Y)=>Y.findIndex(ie=>ie.accountID===I.accountID)===F).slice(0,3).map(I=>e(et,{url:I.account.avatar,alt:I.account.displayName},I.account.id)),R.length>3&&e(L,{children:[" ",e("span",{class:"insignificant",children:_e(R.length)})]})]})]})]}),e("div",{class:"header-side",children:[e("button",{type:"button",class:"plain4 button-switch-view",style:{display:d==="full"?"":"none"},onClick:()=>{u(null),i.delete("media"),i.delete("media-only"),i.delete("view"),c(i)},title:"Switch to Side Peek view",children:e(k,{icon:"layout4",size:"l"})}),e(Ne,{align:"end",portal:{target:P.current},menuButton:e("button",{type:"button",class:"button plain4",children:e(k,{icon:"more",alt:"Actions",size:"xl"})}),children:[e(se,{disabled:x==="loading",onClick:()=>{S.reloadStatusPage++},children:[e(k,{icon:"refresh"}),e("span",{children:"Refresh"})]}),e(se,{className:"menu-switch-view",onClick:()=>{u(d==="full"?null:"full"),i.delete("media"),i.delete("media-only"),d==="full"?i.delete("view"):i.set("view","full"),c(i)},children:[e(k,{icon:{"":"layout5",full:"layout4"}[d||""]}),e("span",{children:["Switch to ",d==="full"?"Side Peek":"Full"," view"]})]}),e(se,{onClick:()=>{Array.from(P.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(F=>{F.click()})},children:[e(k,{icon:"eye-open"})," ",e("span",{children:"Show all sensitive content"})]}),e(Ee,{}),e(Bn,{className:"plain",children:"Experimental"}),e(se,{disabled:!te||re,onClick:()=>{const I=vo(A.url);I?location.hash=I:alert("Unable to switch")},children:[e(k,{icon:"transfer"}),e("small",{class:"menu-double-lines",children:["Switch to post's instance",te?e(L,{children:[" ","(",e("b",{children:te}),")"]}):""]})]})]}),e(J,{class:"button plain deck-close",to:n,children:e(k,{icon:"x",size:"xl"})})]})]})}),v.length&&A?e("ul",{class:`timeline flat contextual grow ${x==="loading"?"loading":""}`,children:[v.slice(0,Q).map(V),pe>0&&e("li",{children:e("button",{type:"button",class:"plain block show-more",disabled:x==="loading",onClick:()=>xe(I=>I+yt),style:{marginBlockEnd:"6em"},"data-state-post-ids":v.slice(Q).map(I=>je(I.id,f)).join(" "),children:[e("div",{class:"ib avatars-bunch",children:v.slice(Q,Q+5).map(I=>e(et,{url:I.account.avatarStatic},I.id))})," ",e("div",{class:"ib",children:["Show more…"," ",e("span",{class:"tag",children:pe>yt?`${yt}+`:pe})]})]})})]}):e(L,{children:[x==="loading"&&e("ul",{class:"timeline flat contextual grow loading",children:e("li",{children:e(Me,{skeleton:!0,size:"l"})})}),x==="error"&&e("p",{class:"ui-state",children:["Unable to load post",e("br",{}),e("br",{}),e("button",{type:"button",onClick:()=>{S.reloadStatusPage++},children:"Try again"})]})]})]})}function as({replies:t,instance:n,hasParentThread:o,level:i,accWeight:c,openAll:s}){const[a,r]=Oe(),l=p=>p.reduce((b,v)=>{const{repliesCount:T,replies:x}=v,E=(x==null?void 0:x.length)||T;return b+E+l(x||[])},0),d=t.length+l(t),u=t.length===d,h=t.map(p=>p.account).filter((p,b,v)=>v.findIndex(T=>T.id===p.id)===b).slice(0,3),m=ue(()=>t==null?void 0:t.reduce((p,b)=>p+(b==null?void 0:b.weight),c),[c,t==null?void 0:t.length]);let f=!1;(s||m<=Do||!o&&d===1&&dt(t[0])<2)&&(f=!0);const y=Ot[t[0].id],g=He((p,b,v,T)=>{p.preventDefault(),p.stopPropagation(),r({media:b+1,mediaStatusID:T.id})},[]),w=_();return Ve(()=>{var b;function p(v){v.target.dataset.scrollLeft=v.target.scrollLeft}return(b=w.current)==null||b.addEventListener("scroll",p,{passive:!0}),()=>{var v;(v=w.current)==null||v.removeEventListener("scroll",p)}},[]),e("details",{ref:w,class:"replies",open:y||f,onToggle:p=>{const{open:b}=p.target;Ot[t[0].id]=b},style:{"--comments-level":i},"data-comments-level":i,"data-comments-level-overflow":i>4,children:[e("summary",{class:"replies-summary",hidden:f,children:[e("span",{class:"avatars",children:h.map(p=>e(et,{url:p.avatarStatic,title:`${p.displayName} @${p.username}`,squircle:p==null?void 0:p.bot},p.id))}),e("b",{children:[e("span",{title:t.length,children:_e(t.length)})," ","repl",t.length===1?"y":"ies"]}),!u&&d>1&&e(L,{children:[" ","·"," ",e("span",{children:[e("span",{title:d,children:_e(d)})," ","comment",d===1?"":"s"]})]})]}),e("ul",{children:t.map(p=>{var b,v;return e("li",{children:[e(J,{class:"status-link",to:n?`/${n}/s/${p.id}`:`/s/${p.id}`,onClick:()=>{Bt(p.id)},children:[e(Me,{statusID:p.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:g}),!((b=p.replies)!=null&&b.length)&&p.repliesCount>0&&e("div",{class:"replies-link",children:[e(k,{icon:"comment2"})," ",e("span",{title:p.repliesCount,children:_e(p.repliesCount)})]})]}),((v=p.replies)==null?void 0:v.length)&&e(as,{instance:n,replies:p.replies,level:i+1,accWeight:f?m:p.weight,openAll:s})]},p.id)})})]})}const No=140,Uo=35,Fo=70,zo=140,qt=new Map;function dt(t){var f,y;const n=qt.get(t.id);if(n)return n;const{spoilerText:o,content:i,mediaAttachments:c,poll:s,card:a}=t,r=ys(o+i),l=c!=null&&c.length?No:0,d=(((f=s==null?void 0:s.options)==null?void 0:f.length)||0)*Uo,u=a&&(c!=null&&c.length||(y=s==null?void 0:s.options)!=null&&y.length)?0:Fo,m=(r+l+d+u)/zo;return qt.set(t.id,m),m}const Oo=ze(_o);function Bo(){const t=nt(),{id:n,instance:o}=t;return e(Oo,{id:n,instance:o})}const qo=""+new URL("boosts-carousel-YjmjXTE6.jpg",import.meta.url).href,Ho=""+new URL("grouped-notifications-xYMFVY91.jpg",import.meta.url).href,Vo=""+new URL("multi-column-ETnJNDVb.jpg",import.meta.url).href,jo=""+new URL("multi-hashtag-timeline-x-SDVR4g.jpg",import.meta.url).href,Go=""+new URL("nested-comments-thread-Ib-fZGS3.jpg",import.meta.url).href,Wo="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xml:space='preserve'%20fill-rule='evenodd'%20stroke-linejoin='round'%20stroke-miterlimit='2'%20clip-rule='evenodd'%20viewBox='0%200%20102%2028'%3e%3cpath%20fill='none'%20d='M0%200h101.5v27.5H0z'/%3e%3cg%20fill-rule='nonzero'%3e%3cpath%20fill='url(%23a)'%20d='M2.32%2021.85c1.4%200%202.21-.85%202.21-2.3v-4.64H8.5c4.45%200%207.54-2.9%207.54-7.24%200-4.35-2.98-7.24-7.32-7.24h-6.4C.93.43.11%201.28.11%202.73v16.82c0%201.45.82%202.3%202.21%202.3Zm2.21-10.4V3.94h3c2.54%200%204%201.34%204%203.75s-1.47%203.76-4%203.76h-3Z'/%3e%3cpath%20fill='url(%23b)'%20d='M20.52%2021.88c1.25%200%202.13-.76%202.13-2.23v-7.04c0-2.07%201.2-3.49%203.21-3.49%201.95%200%202.95%201.23%202.95%203.25v7.28c0%201.47.89%202.23%202.13%202.23%201.26%200%202.14-.76%202.14-2.23v-8.18c0-3.64-1.99-5.9-5.48-5.9-2.38%200-4.1%201.12-4.93%203.1h-.09V2.3c0-1.38-.78-2.2-2.1-2.2-1.31%200-2.1.82-2.1%202.2v17.34c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23c)'%20d='M40.45%2021.82c1.96%200%203.93-.98%204.8-2.65h.1v.8c.08%201.27.89%201.91%202.05%201.91%201.21%200%202.08-.73%202.08-2.15v-8.95c0-3.17-2.63-5.25-6.65-5.25-3.26%200-5.78%201.16-6.5%203.04-.15.32-.23.63-.23.96%200%20.97.75%201.64%201.79%201.64.69%200%201.23-.26%201.7-.79.95-1.23%201.74-1.65%203.04-1.65%201.62%200%202.64.85%202.64%202.31v1.04l-3.95.24c-3.93.23-6.13%201.88-6.13%204.74%200%202.83%202.27%204.76%205.26%204.76Zm1.4-3.09c-1.43%200-2.4-.73-2.4-1.9%200-1.12.91-1.83%202.51-1.95l3.31-.2v1.14c0%201.7-1.54%202.91-3.41%202.91Z'/%3e%3cpath%20fill='url(%23d)'%20d='M54.37%2021.88c1.26%200%202.14-.76%202.14-2.23v-7.09c0-2.03%201.21-3.44%203.13-3.44s2.89%201.17%202.89%203.22v7.31c0%201.47.88%202.23%202.14%202.23%201.24%200%202.13-.76%202.13-2.23v-8.2c0-3.68-1.96-5.87-5.45-5.87-2.41%200-4%201.07-4.83%203.01h-.09v-.87c0-1.35-.85-2.17-2.14-2.17-1.28%200-2.06.82-2.06%202.15v11.95c0%201.47.9%202.23%202.14%202.23Z'/%3e%3cpath%20fill='url(%23e)'%20d='M71.65%2027.17c1.26%200%202.14-.76%202.14-2.23v-6h.09a5.15%205.15%200%200%200%204.88%202.88c3.92%200%206.35-3.05%206.35-8.1%200-5.07-2.44-8.1-6.43-8.1a5.12%205.12%200%200%200-4.86%202.99h-.09v-.85c0-1.45-.88-2.21-2.1-2.21-1.24%200-2.11.76-2.11%202.2v17.2c0%201.46.89%202.22%202.13%202.22Zm5.6-8.8c-2.1%200-3.47-1.8-3.47-4.65%200-2.81%201.37-4.67%203.47-4.67%202.14%200%203.49%201.83%203.49%204.67%200%202.86-1.35%204.66-3.5%204.66Z'/%3e%3cpath%20fill='url(%23f)'%20d='M89.61%2027.39c3.44%200%205.26-1.5%206.73-5.55l4.81-13.1a4%204%200%200%200%20.24-1.26c0-1.13-.85-1.93-2.08-1.93-1.1%200-1.71.51-2.07%201.7l-3.4%2010.9h-.08L90.35%207.28c-.36-1.25-.94-1.73-2.07-1.73-1.26%200-2.21.83-2.21%201.99%200%20.35.09.82.25%201.26l5%2013.21-.21.56c-.52%201.1-1.32%201.42-2.07%201.42l-.75-.01c-.96%200-1.56.54-1.56%201.4%200%201.29%201%202%202.88%202Z'/%3e%3c/g%3e%3cdefs%3e%3cradialGradient%20id='a'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='b'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='c'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='d'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='e'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='f'%20cx='0'%20cy='0'%20r='1'%20gradientTransform='rotate(28.51%20.06%20.22)%20scale(57.6252)'%20gradientUnits='userSpaceOnUse'%3e%3cstop%20offset='0'%20stop-color='%23a4bff7'/%3e%3cstop%20offset='1'%20stop-color='%236081e6'/%3e%3c/radialGradient%3e%3c/defs%3e%3c/svg%3e";function Tn(){return Ae(null,["/","/welcome"]),e("main",{id:"welcome",children:[e("div",{class:"hero-container",children:[e("div",{class:"hero-content",children:[e("h1",{children:[e("img",{src:jt,alt:"",width:"160",height:"160",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),e("img",{src:Wo,alt:"Phanpy",width:"200"})]}),e("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."}),e("p",{children:e(J,{to:"/login",class:"button",children:"Log in with Mastodon"})}),e("p",{class:"insignificant",children:e("small",{children:["Connect your existing Mastodon/Fediverse account.",e("br",{}),"Your credentials are not stored on this server."]})})]}),e("p",{children:[e("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",e("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:t=>{t.preventDefault(),S.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",e("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]}),e("div",{id:"why-container",children:e("div",{class:"sections",children:[e("section",{children:[e("img",{src:qo,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),e("h4",{children:"Boosts Carousel"}),e("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),e("section",{children:[e("img",{src:Go,alt:"Screenshot of nested comments thread",loading:"lazy"}),e("h4",{children:"Nested comments thread"}),e("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),e("section",{children:[e("img",{src:Ho,alt:"Screenshot of grouped notifications",loading:"lazy"}),e("h4",{children:"Grouped notifications"}),e("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),e("section",{children:[e("img",{src:Vo,alt:"Screenshot of multi-column UI",loading:"lazy"}),e("h4",{children:"Single or multi-column"}),e("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),e("section",{children:[e("img",{src:jo,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),e("h4",{children:"Multi-hashtag timeline"}),e("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})})]})}const Ko=window.alert;window.__nativeAlert||(window.__nativeAlert=Ko);window.alert=function(t){t instanceof Error&&(t!=null&&t.message)&&(t=t.message),typeof t!="string"&&(t=JSON.stringify(t));const n=Ls({text:t,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=S;window.__STATES_STATS__=()=>{const t=["statuses","accounts","spoilers","unfurledLinks","statusQuotes"],n={};t.forEach(c=>{n[c]=Object.keys(S[c]).length});const{statuses:o}=S,i=[];for(const c in o)document.querySelector(`[data-state-post-id~="${c}"], [data-state-post-ids~="${c}"]`)||i.push(c)};setInterval(()=>{if(!window.__IDLE__)return;const{statuses:t,unfurledLinks:n,notifications:o}=S;let i=0;const{instance:c}=z();for(const s in t){if(!window.__IDLE__)break;try{const a=document.querySelector(`[data-state-post-id~="${s}"], [data-state-post-ids~="${s}"]`),r=o.some(l=>{var d;return s===je((d=l.status)==null?void 0:d.id,c)});if(!a&&!r){delete S.statuses[s],delete S.statusQuotes[s];for(const l in n){const d=n[l];if(je(d.id,d.instance)===s){delete S.unfurledLinks[l];break}}i++}}catch{}}},15*60*1e3);setTimeout(()=>{var t,n,o,i;for(const c in mt)Array.isArray(mt[c])?(n=(t=mt[c])[0])==null||n.call(t):(i=(o=mt)[c])==null||i.call(o)},5e3);(()=>{window.__IDLE__=!0;const t=["mousemove","mousedown","resize","keydown","touchstart","pointerdown","pointermove","wheel"],n=()=>{window.__IDLE__=!0},i=qn(n,3e3),c=()=>{window.__IDLE__=!1,i()};t.forEach(s=>{window.addEventListener(s,c,{passive:!0,capture:!0})}),window.addEventListener("blur",n,{passive:!0}),document.documentElement.addEventListener("mouseleave",s=>{!s.relatedTarget&&!s.toElement&&n()},{passive:!0})})();const Zo=/iPad|iPhone|iPod/.test(navigator.userAgent);Zo&&document.addEventListener("visibilitychange",()=>{if(document.visibilityState==="visible"){const t=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",n=document.querySelector(`meta[name="theme-color"][media*="${t}"]`),o=n==null?void 0:n.getAttribute("content");o&&(n.content="",setTimeout(()=>{n.content=o},10))}});Un(S,t=>{var n;for(const[o,i,c,s]of t){if(i.join(".")==="settings.shortcutsViewMode"){const a=document.getElementById("app");a&&(a.dataset.shortcutsViewMode=(n=S.shortcuts)!=null&&n.length?c:"")}i.join(".")==="settings.cloakMode"&&document.body.classList.toggle("cloak",c)}});function Yo(){const[t,n]=C(!1),[o,i]=C("loading");Ve(()=>{const s=ne.local.get("theme");s&&(document.documentElement.classList.add(`is-${s}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",s==="auto"?"dark light":s));const a=ne.local.get("textSize");a&&document.documentElement.style.setProperty("--text-size",`${a}px`)},[]),O(()=>{const s=ne.local.get("instanceURL"),a=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(a){window.history.replaceState({},document.title,window.location.pathname||"/");const r=ne.session.get("clientID"),l=ne.session.get("clientSecret"),d=ne.session.get("vapidKey");(async()=>{i("loading");const{access_token:u}=await Lo({instanceURL:s,client_id:r,client_secret:l,code:a}),h=ws({instance:s,accessToken:u});await Promise.allSettled([nn(h,s),vs(h,s,u,d)]),sn(),on(h),n(!0),i("default")})()}else{window.__IGNORE_GET_ACCOUNT_ERROR__=!0;const r=ot();if(r){ne.session.set("currentAccount",r.info.id);const{client:l}=z({account:r}),{instance:d}=l;sn(),on(l),i("loading"),(async()=>{try{await nn(l,d)}catch{}finally{n(!0),i("default")}})()}else i("default")}},[]);let c=ct();return S.currentLocation=c.pathname,O(Nt,[c,t]),/\/https?:/.test(c.pathname)?e(ko,{}):e(L,{children:[e(Jo,{isLoggedIn:t,loading:o==="loading"}),e(Xo,{isLoggedIn:t}),o==="default"&&e(Vt,{children:e(ke,{path:"/:instance?/s/:id",element:e(Bo,{})})}),t&&e(Ps,{}),t&&e(Li,{}),e(Ti,{}),t&&e(Ci,{}),e(_s,{isLoggedIn:t}),o!=="loading"&&e(xi,{onClose:Nt}),e(Ns,{})]})}function Jo({isLoggedIn:t,loading:n}){const o=ct(),i=ue(()=>{const{pathname:c}=o;return!/^\/(login|welcome)/.test(c)},[o]);return e(Vt,{location:i||o,children:[e(ke,{path:"/",element:t?e(yo,{}):n?e(ve,{id:"loader-root"}):e(Tn,{})}),e(ke,{path:"/login",element:e(Ao,{})}),e(ke,{path:"/welcome",element:e(Tn,{})})]})}function $n(){return S.prevLocation||null}function Xo({isLoggedIn:t}){const n=ct(),o=_($n());return ue(()=>ut("/:instance/s/:id",n.pathname)||ut("/s/:id",n.pathname),[n.pathname,ut])?o.current||(o.current=$n()):o.current=null,e(Vt,{location:o.current||n,children:[t&&e(L,{children:[e(ke,{path:"/notifications",element:e(is,{})}),e(ke,{path:"/mentions",element:e(ns,{})}),e(ke,{path:"/following",element:e(Jt,{})}),e(ke,{path:"/b",element:e(Xn,{})}),e(ke,{path:"/f",element:e(Qn,{})}),e(ke,{path:"/l",children:[e(ke,{index:!0,element:e(So,{})}),e(ke,{path:":id",element:e(ts,{})})]}),e(ke,{path:"/ft",element:e(Gi,{})})]}),e(ke,{path:"/:instance?/t/:hashtag",element:e(es,{})}),e(ke,{path:"/:instance?/a/:id",element:e(qi,{})}),e(ke,{path:"/:instance?/p",children:[e(ke,{index:!0,element:e(zt,{})}),e(ke,{path:"l",element:e(zt,{local:!0})})]}),e(ke,{path:"/:instance?/trending",element:e(os,{})}),e(ke,{path:"/:instance?/search",element:e(Ro,{})})]})}"AbortSignal"in window&&(AbortSignal.timeout=AbortSignal.timeout||(t=>{const n=new AbortController;return setTimeout(()=>n.abort(),t),n.signal}));Rs(e(As,{children:e(Yo,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(t=>{t.startsWith("iconify")&&localStorage.removeItem(t)}),Object.keys(sessionStorage).forEach(t=>{t.startsWith("iconify")&&sessionStorage.removeItem(t)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-DUVHsGj_.js.map
