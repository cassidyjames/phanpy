import{L as D,O as B,Q as F,V as Q,W,X as z,s as G,D as X,Y as Z,a as U,t as J,A as tt}from"./vendor-YNBWu-Mz.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();const et="modulepreload",nt=function(t,e){return new URL(t,e).href},q={},Ct=function(e,n,i){let o=Promise.resolve();if(n&&n.length>0){const s=document.getElementsByTagName("link"),r=document.querySelector("meta[property=csp-nonce]"),c=(r==null?void 0:r.nonce)||(r==null?void 0:r.getAttribute("nonce"));o=Promise.all(n.map(u=>{if(u=nt(u,i),u in q)return;q[u]=!0;const h=u.endsWith(".css"),L=h?'[rel="stylesheet"]':"";if(!!i)for(let g=s.length-1;g>=0;g--){const f=s[g];if(f.href===u&&(!h||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${L}`))return;const w=document.createElement("link");if(w.rel=h?"stylesheet":et,h||(w.as="script",w.crossOrigin=""),w.href=u,c&&w.setAttribute("nonce",c),document.head.appendChild(w),h)return new Promise((g,f)=>{w.addEventListener("load",g),w.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${u}`)))})}))}return o.then(()=>e()).catch(s=>{const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s})};function K(t){const e=a.local.getJSON("accounts")||[];return t&&e.find(n=>n.info.id===t)||e[0]}function st(t){return(a.local.getJSON("accounts")||[]).find(n=>n.accessToken===t)}function ot(t){return(a.local.getJSON("accounts")||[]).find(n=>n.instanceURL===t)}function $(){window.__IGNORE_GET_ACCOUNT_ERROR__;const t=a.session.get("currentAccount");return K(t)}function I(){const t=$(),{instanceURL:e,info:{id:n}}=t;return`${n}@${e}`}function rt(t){const e=a.local.getJSON("accounts")||[],n=e.find(i=>i.info.id===t.info.id);n?(n.info=t.info,n.instanceURL=t.instanceURL,n.accessToken=t.accessToken,n.vapidKey=t.vapidKey):e.push(t),a.local.setJSON("accounts",e),a.session.set("currentAccount",t.info.id)}function Et(t){const e=a.local.getJSON("accounts")||[],n=e.find(i=>i.info.id===t.id);n&&(n.info.displayName!==t.displayName||n.info.avatar!==t.avatar||n.info.avatar_static!==t.avatar_static)&&(n.info={...n.info,...t},a.local.setJSON("accounts",e))}let M=null;function it(){if(M)return M;try{const t=$(),e=a.local.getJSON("instances"),n=t.instanceURL.toLowerCase();return M=e[n]}catch(t){return alert(`Failed to load instance configuration. Please try again.

${t}`),a.local.del("instances"),location.reload(),{}}}function at(t){const{configuration:e,maxMediaAttachments:n,maxTootChars:i,pleroma:o,pollLimits:s}=t,r=(e==null?void 0:e.statuses)||{};n&&(r.maxMediaAttachments??(r.maxMediaAttachments=n)),i&&(r.maxCharacters??(r.maxCharacters=i));const c=(e==null?void 0:e.polls)||{};return s&&(c.maxCharactersPerOption??(c.maxCharactersPerOption=s.maxOptionChars),c.maxExpiration??(c.maxExpiration=s.maxExpiration),c.maxOptions??(c.maxOptions=s.maxOptions),c.minExpiration??(c.minExpiration=s.minExpiration)),{...e,statuses:r,polls:c}}function vt(){const t=it();return at(t)}const E={get:t=>{try{return localStorage.getItem(t)}catch{return null}},getJSON:t=>{try{return JSON.parse(E.get(t))}catch{return null}},set:(t,e)=>{try{return localStorage.setItem(t,e)}catch{return null}},setJSON:(t,e)=>{try{return E.set(t,JSON.stringify(e))}catch{return null}},del:t=>{try{return localStorage.removeItem(t)}catch{return null}}},x={get:t=>{try{return sessionStorage.getItem(t)}catch{return null}},getJSON:t=>{try{return JSON.parse(x.get(t))}catch{return null}},set:(t,e)=>{try{return sessionStorage.setItem(t,e)}catch{return null}},setJSON:(t,e)=>{try{return x.set(t,JSON.stringify(e))}catch{return null}},del:t=>{try{return sessionStorage.removeItem(t)}catch{return null}}},ct={get:t=>{try{return E.getJSON(t)[I()]}catch{return null}},set:(t,e)=>{try{const n=E.getJSON(t)||{};return n[I()]=e,E.setJSON(t,n)}catch{return null}},del:t=>{try{const e=E.getJSON(t)||{};return delete e[I()],E.setJSON(t,e)}catch{return null}}},a={local:E,session:x,account:ct},P="mastodon.social",b={},T={};window.__ACCOUNT_APIS__=T;let m;function C({instance:t,accessToken:e}){/^https?:\/\//.test(t)&&(t=t.replace(/^https?:\/\//,"").replace(/\/+$/,"").toLowerCase());const n=t?`https://${t}`:`https://${P}`,o={masto:D({url:n,accessToken:e,timeout:3e4}),instance:t,accessToken:e};return b[t]=o,T[t]||(T[t]={}),e&&(T[t][e]=o),o}async function Rt(t,e){const{masto:n,accessToken:i}=t;let o;try{o=await n.v2.instance.fetch()}catch{}if(!o)try{o=await n.v1.instance.fetch()}catch{}if(!o)return;const{uri:s,urls:{streamingApi:r}={},domain:c,configuration:{urls:{streaming:u}={}}={}}=o,h=a.local.getJSON("instances")||{};if((s||c)&&(h[(c||s).replace(/^https?:\/\//,"").replace(/\/+$/,"").toLowerCase()]=o),e&&(h[e.toLowerCase()]=o),a.local.setJSON("instances",h),"WebSocket"in window&&(r||u)){const S=B({streamingApiUrl:u||r,accessToken:i,implementation:WebSocket});t.streaming=S}}async function _t(t,e,n,i){const{masto:o}=t,s=await o.v1.accounts.verifyCredentials();a.session.set("currentAccount",s.id),rt({info:s,instanceURL:e.toLowerCase(),accessToken:n,vapidKey:i})}async function Pt(t){try{const{masto:e}=t,n=await e.v1.preferences.fetch();a.account.set("preferences",n)}catch{}}function O({instance:t,accessToken:e,accountID:n,account:i}={}){var u,h,L,S,w;if(t&&(t=t.toLowerCase().trim()),t&&e){const g=((u=T[t])==null?void 0:u[e])||C({instance:t,accessToken:e}),{masto:f,streaming:A}=g;return{masto:f,streaming:A,client:g,authenticated:!0,instance:t}}if(e)for(const g in T)if(T[g][e]){const f=T[g][e],{masto:A,streaming:p}=f;return{masto:A,streaming:p,client:f,authenticated:!0,instance:g}}else{const f=st(e);if(f){const A=f.accessToken,p=f.instanceURL.toLowerCase().trim(),y=C({instance:p,accessToken:A}),{masto:d,streaming:N}=y;return{masto:d,streaming:N,client:y,authenticated:!0,instance:p}}else throw new Error("Access token not found")}if(i||n)if(i=i||K(n),i){const g=i.accessToken,f=i.instanceURL.toLowerCase().trim(),A=((h=T[f])==null?void 0:h[g])||C({instance:f,accessToken:g}),{masto:p,streaming:y}=A;return{masto:p,streaming:y,client:A,authenticated:!0,instance:f}}else throw new Error(`Account ${n} not found`);const o=$();if(t){if((m==null?void 0:m.instance)===t)return{masto:m.masto,streaming:m.streaming,client:m,authenticated:!0,instance:t};if((o==null?void 0:o.instanceURL)===t){const{accessToken:d}=o;return m=((L=T[t])==null?void 0:L[d])||C({instance:t,accessToken:d}),{masto:m.masto,streaming:m.streaming,client:m,authenticated:!0,instance:t}}const g=ot(t);if(g){const d=g.accessToken,N=((S=T[t])==null?void 0:S[d])||C({instance:t,accessToken:d}),{masto:R,streaming:_}=N;return{masto:R,streaming:_,client:N,authenticated:!0,instance:t}}const f=b[t]||C({instance:t}),{masto:A,streaming:p,accessToken:y}=f;return{masto:A,streaming:p,client:f,authenticated:!!y,instance:t}}if(m)return{masto:m.masto,streaming:m.streaming,client:m,authenticated:!0,instance:m.instance};if(o){const{accessToken:g,instanceURL:f}=o;return m=((w=T[f])==null?void 0:w[g])||C({instance:f,accessToken:g}),{masto:m.masto,streaming:m.streaming,client:m,authenticated:!0,instance:f}}const s=b[P]||C({instance:P}),{masto:r,streaming:c}=s;return{masto:r,streaming:c,client:s,authenticated:!1,instance:P}}window.__API__={currentAccountApi:m,apis:b,accountApis:T};function ut(t){try{const{pathname:e,hash:n}=new URL(t);return/^\/.*\/\d+$/i.test(e)||/^\/(@[^/]+|users\/[^/]+)\/(statuses|posts)\/\w+\/?$/i.test(e)||/^\/notes\/[a-z0-9]+$/i.test(e)||/^\/(notice|objects)\/[a-z0-9-]+$/i.test(e)||/#\/[^\/]+\.[^\/]+\/s\/.+/i.test(n)}catch{return!1}}window._moize=F;function lt(t,e={}){return F(t,{...e,maxSize:50,isDeepEqual:!0})}function ft(t,e={}){return lt(t,{isPromise:!0,...e})}function ht(t,e){let n=[],i=!1;function o(){if(n.length===0){i=!1;return}n.shift()(),setTimeout(o,e)}return function(...s){const r=()=>t.apply(this,s);n.push(r),i||(i=!0,setTimeout(o,e))}}const gt=Q({limit:1,interval:1e3}),dt=/(twitter|github)\.com/i,H={};function mt(t,e){var A;const n=W(k);if(dt.test(e)||H[e])return;if(new RegExp(t+"/").test((A=n.unfurledLinks[e])==null?void 0:A.url))return Promise.resolve(n.unfurledLinks[e]);let o,s=e;/\/\/elk\.[^\/]+\/[^\/]+\.[^\/]+/i.test(s)&&(s=s.replace(/elk\.[^\/]+\//i,"")),/\/\/trunks\.[^\/]+\/status\/[^\/]+\.[^\/]+/i.test(s)&&(s=s.replace(/trunks\.[^\/]+\/status\//i,"")),/\/#\/[^\/]+\.[^\/]+\/s\/.+/i.test(s)&&(s=`https://${s.split("/#/")[1].replace(/\/s\//i,"/@fakeUsername/")}`);let r;try{r=new URL(s)}catch{return}const c=r.hostname,u=r.pathname,L=/\/@([^@\/]+)@?([^\/]+)?\/(\d+)$/i.exec(u);if(L){const p=L[3],{masto:y}=O({instance:c});o=y.v1.statuses.$select(p).fetch().then(d=>{if(d!=null&&d.id)return{status:d,instance:c};throw new Error("No results")})}const{masto:S}=O({instance:t}),w=S.v2.search.fetch({q:s,type:"statuses",resolve:!0,limit:1}).then(p=>{const{statuses:y}=p;if(y.length>0){const d=y.filter(N=>{var R;return!((R=N.content)!=null&&R.toLowerCase().includes(s.toLowerCase()))});if(d.length===1)return{status:d[0],instance:t}}throw new Error("No results")});function g(p){const{status:y,instance:d}=p,{id:N}=y,R=`/${d}/s/${N}`,_={id:N,instance:d,url:R};return k.unfurledLinks[e]=_,Y(y,d,{skipThreading:!0}),_}function f(p){H[e]=!0}return o?Promise.race([w,new Promise((y,d)=>setTimeout(d,3e3))]).catch(()=>o.catch(()=>w)).then(g).catch(f):w.then(g).catch(f)}const pt=gt(mt),l=z({appVersion:{},prevLocation:null,currentLocation:null,statuses:{},statusThreadNumber:{},home:[],homeNew:[],homeLast:null,homeLastFetchTime:null,notifications:[],notificationsLast:null,notificationsNew:[],notificationsShowNew:!1,notificationsLastFetchTime:null,reloadStatusPage:0,reloadGenericAccounts:{id:null,counter:0},spoilers:{},spoilersMedia:{},scrollPositions:{},unfurledLinks:{},statusQuotes:{},statusFollowedTags:{},statusReply:{},accounts:{},routeNotification:null,showCompose:!1,showSettings:!1,showAccount:!1,showAccounts:!1,showDrafts:!1,showMediaModal:!1,showShortcutsSettings:!1,showKeyboardShortcutsHelp:!1,showGenericAccounts:!1,showMediaAlt:!1,showEmbedModal:!1,showReportModal:!1,shortcuts:[],settings:{autoRefresh:!1,shortcutsViewMode:null,shortcutsColumnsMode:!1,boostsCarousel:!0,contentTranslation:!0,contentTranslationTargetLanguage:null,contentTranslationHideLanguages:[],contentTranslationAutoInline:!1,shortcutSettingsCloudImportExport:!1,mediaAltGenerator:!1,cloakMode:!1}}),k=l;function bt(){l.notificationsLast=a.account.get("notificationsLast")||null,l.shortcuts=a.account.get("shortcuts")??[],l.settings.autoRefresh=a.account.get("settings-autoRefresh")??!1,l.settings.shortcutsViewMode=a.account.get("settings-shortcutsViewMode")??null,a.account.get("settings-shortcutsColumnsMode")&&(l.settings.shortcutsColumnsMode=!0),l.settings.boostsCarousel=a.account.get("settings-boostsCarousel")??!0,l.settings.contentTranslation=a.account.get("settings-contentTranslation")??!0,l.settings.contentTranslationTargetLanguage=a.account.get("settings-contentTranslationTargetLanguage")||null,l.settings.contentTranslationHideLanguages=a.account.get("settings-contentTranslationHideLanguages")||[],l.settings.contentTranslationAutoInline=a.account.get("settings-contentTranslationAutoInline")??!1,l.settings.shortcutSettingsCloudImportExport=a.account.get("settings-shortcutSettingsCloudImportExport")??!1,l.settings.mediaAltGenerator=a.account.get("settings-mediaAltGenerator")??!1,l.settings.cloakMode=a.account.get("settings-cloakMode")??!1}G(l,"notificationsLast",t=>{a.account.set("notificationsLast",l.notificationsLast)});X(l,t=>{for(const[e,n,i,o]of t)n.join(".")==="settings.autoRefresh"&&a.account.set("settings-autoRefresh",!!i),n.join(".")==="settings.boostsCarousel"&&a.account.set("settings-boostsCarousel",!!i),n.join(".")==="settings.shortcutsViewMode"&&a.account.set("settings-shortcutsViewMode",i),n.join(".")==="settings.contentTranslation"&&a.account.set("settings-contentTranslation",!!i),n.join(".")==="settings.contentTranslationAutoInline"&&a.account.set("settings-contentTranslationAutoInline",!!i),n.join(".")==="settings.shortcutSettingsCloudImportExport"&&a.account.set("settings-shortcutSettingsCloudImportExport",!!i),n.join(".")==="settings.contentTranslationTargetLanguage"&&a.account.set("settings-contentTranslationTargetLanguage",i),/^settings\.contentTranslationHideLanguages/i.test(n.join("."))&&a.account.set("settings-contentTranslationHideLanguages",l.settings.contentTranslationHideLanguages),n.join(".")==="settings.mediaAltGenerator"&&a.account.set("settings-mediaAltGenerator",!!i),(n==null?void 0:n[0])==="shortcuts"&&a.account.set("shortcuts",l.shortcuts),n.join(".")==="settings.cloakMode"&&a.account.set("settings-cloakMode",!!i)});function v(t,e){if(t)return e?`${e}/${t}`:t}function wt(t,e){if(e){const n=v(t,e);return l.statuses[n]}return l.statuses[t]}function Y(t,e,n){typeof e=="object"&&(n=e,e=null);const{override:i=!0,skipThreading:o=!1,skipUnfurling:s=!1}=n||{};if(!t)return;const r=wt(t.id,e);!i&&r||Z(t,r)||(queueMicrotask(()=>{var u,h;const c=v(t.id,e);if(r!=null&&r._pinned&&(t._pinned=r._pinned),l.statuses[c]=t,(u=t.reblog)!=null&&u.id){const L=v(t.reblog.id,e);l.statuses[L]=t.reblog}if((h=t.quote)!=null&&h.id){const L=v(t.quote.id,e);l.statuses[L]=t.quote,l.statusQuotes[c]=[{id:t.quote.id,instance:e}]}}),o||queueMicrotask(()=>{Lt(t.reblog||t,e)}),s||queueMicrotask(()=>{St(t.reblog||t,e)}))}function yt(t,e){const{masto:n,instance:i}=O({instance:e});let o=0;async function s(r,c=0){const{inReplyToId:u,inReplyToAccountId:h}=r;if(!u||h!==r.account.id)return[r];if(u&&h!==r.account.id)throw"Not a thread";const L=v(u,i);let S=l.statuses[L];if(!S){if(o++>3)throw"Too many fetches for thread";await new Promise(w=>setTimeout(w,500*o)),S=await At(u,n),Y(S,i,{skipThreading:!0})}return[...await s(S,++c),r]}return s(t).then(r=>{r.length>1&&r.forEach((c,u)=>{const h=v(c.id,i);l.statusThreadNumber[h]=u+1})}).catch(r=>{})}const Lt=ht(yt,100),j=document.createElement("div");function St(t,e){const{instance:n}=O(),i=t==null?void 0:t.content;if(/<a/i.test(i)){const s=v(t==null?void 0:t.id,e);j.innerHTML=i,[...j.querySelectorAll("a[href]:not(.u-url):not(.mention):not(.hashtag)")].filter(c=>{const u=c.href;return!(u===t.url||u===t.uri)&&ut(u)}).forEach((c,u)=>{pt(n,c.href).then(h=>{h&&s&&(Array.isArray(l.statusQuotes[s])||(l.statusQuotes[s]=[]),l.statusQuotes[s][u]||l.statusQuotes[s].splice(u,0,h))})})}}const At=ft((t,e)=>e.v1.statuses.$select(t).fetch());function Ot({abrupt:t,hidden:e,...n}){return U("span",{...n,class:`loader-container ${t?"abrupt":""} ${e?"hidden":""}`,children:U("span",{class:"loader"})})}var Tt={PHANPY_CLIENT_NAME:"Phanpy",PHANPY_WEBSITE:"https://phanpy.social",PHANPY_LINGVA_INSTANCES:"lingva.phanpy.social lingva.lunar.icu lingva.garudalinux.org translate.plausibility.cloud",PHANPY_PRIVACY_POLICY_URL:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{PHANPY_CLIENT_NAME:V}=Tt;function kt(t,e){function n(){const{currentLocation:i}=k,o=Array.isArray(e);let s=o?e:[];!o&&/:?\w+\?/.test(e)&&(s.push(e.replace(/(:\w+)\?/g,"$1")),s.push(e.replace(/\/?:\w+\?/g,"")));let r=!1;s.length?r=s.some(c=>J(c,i)):e&&(r=J(e,i)),r&&(document.title=t?`${t} / ${V}`:V)}tt(()=>{const i=G(k,"currentLocation",n);return n(),i},[t,e])}export{Ot as L,Ct as _,O as a,Y as b,a as c,v as d,$ as e,kt as f,st as g,wt as h,it as i,I as j,C as k,Rt as l,_t as m,bt as n,Pt as o,ft as p,lt as q,ut as r,k as s,Lt as t,Et as u,pt as v,vt as w};
//# sourceMappingURL=useTitle-3DvqVLcR.js.map
